{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/redis/modified_file/88cd9ebc0964c9daf32d97631b5eeba5fd0e8b09",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/redis/modified_file/88cd9ebc0964c9daf32d97631b5eeba5fd0e8b09/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/redis/modified_file/88cd9ebc0964c9daf32d97631b5eeba5fd0e8b09/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/redis/modified_file/88cd9ebc0964c9daf32d97631b5eeba5fd0e8b09/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 950,
          "old_api": "dictIsRehashing",
          "new_api": "dictCompareKeys",
          "old_text": "dictIsRehashing(d)",
          "new_text": "dictCompareKeys(d, key, he->key)",
          "old_line_content": "        if (!dictIsRehashing(d)) break;",
          "new_line_content": "            if (dictCompareKeys(d, key, he->key))",
          "content_same": false
        },
        {
          "line": 1043,
          "old_api": "memcpy",
          "new_api": "strlen",
          "old_text": "memcpy(copy, key, len)",
          "new_text": "strlen(key)",
          "old_line_content": "    memcpy(copy, key, len);",
          "new_line_content": "    int len = strlen(key);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 898,
          "old_api": null,
          "new_api": "dictIsRehashing",
          "old_text": null,
          "new_text": "dictIsRehashing(d)",
          "old_line_content": "",
          "new_line_content": "    if (dictIsRehashing(d)) return DICT_OK;",
          "content_same": false
        },
        {
          "line": 1027,
          "old_api": null,
          "new_api": "_dictPrintStatsHt",
          "old_text": null,
          "new_text": "_dictPrintStatsHt(&d->ht[0])",
          "old_line_content": "    }",
          "new_line_content": "    _dictPrintStatsHt(&d->ht[0]);",
          "content_same": false
        },
        {
          "line": 1028,
          "old_api": null,
          "new_api": "dictIsRehashing",
          "old_text": null,
          "new_text": "dictIsRehashing(d)",
          "old_line_content": "}",
          "new_line_content": "    if (dictIsRehashing(d)) {",
          "content_same": false
        },
        {
          "line": 1029,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\"-- Rehashing into ht[1]:\\n\")",
          "old_line_content": "",
          "new_line_content": "        printf(\"-- Rehashing into ht[1]:\\n\");",
          "content_same": false
        },
        {
          "line": 1030,
          "old_api": null,
          "new_api": "_dictPrintStatsHt",
          "old_text": null,
          "new_text": "_dictPrintStatsHt(&d->ht[1])",
          "old_line_content": "/* ----------------------- StringCopy Hash Table Type ------------------------*/",
          "new_line_content": "        _dictPrintStatsHt(&d->ht[1]);",
          "content_same": false
        },
        {
          "line": 901,
          "old_api": null,
          "new_api": "dictExpand",
          "old_text": null,
          "new_text": "dictExpand(d, DICT_HT_INITIAL_SIZE)",
          "old_line_content": "     * elements/buckets is over the \"safe\" threshold, we resize doubling",
          "new_line_content": "    if (d->ht[0].size == 0) return dictExpand(d, DICT_HT_INITIAL_SIZE);",
          "content_same": false
        },
        {
          "line": 1038,
          "old_api": null,
          "new_api": "strlen",
          "old_text": null,
          "new_text": "strlen(key)",
          "old_line_content": "{",
          "new_line_content": "    return dictGenHashFunction(key, strlen(key));",
          "content_same": false
        },
        {
          "line": 911,
          "old_api": null,
          "new_api": "dictExpand",
          "old_text": null,
          "new_text": "dictExpand(d, d->ht[0].used*2)",
          "old_line_content": "",
          "new_line_content": "        return dictExpand(d, d->ht[0].used*2);",
          "content_same": false
        },
        {
          "line": 1044,
          "old_api": null,
          "new_api": "zmalloc",
          "old_text": null,
          "new_text": "zmalloc(len+1)",
          "old_line_content": "    copy[len] = '\\0';",
          "new_line_content": "    char *copy = zmalloc(len+1);",
          "content_same": false
        },
        {
          "line": 1045,
          "old_api": null,
          "new_api": "DICT_NOTUSED",
          "old_text": null,
          "new_text": "DICT_NOTUSED(privdata)",
          "old_line_content": "    return copy;",
          "new_line_content": "    DICT_NOTUSED(privdata);",
          "content_same": false
        },
        {
          "line": 1047,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(copy, key, len)",
          "old_line_content": "",
          "new_line_content": "    memcpy(copy, key, len);",
          "content_same": false
        },
        {
          "line": 1055,
          "old_api": null,
          "new_api": "DICT_NOTUSED",
          "old_text": null,
          "new_text": "DICT_NOTUSED(privdata)",
          "old_line_content": "",
          "new_line_content": "    DICT_NOTUSED(privdata);",
          "content_same": false
        },
        {
          "line": 1057,
          "old_api": null,
          "new_api": "strcmp",
          "old_text": null,
          "new_text": "strcmp(key1, key2)",
          "old_line_content": "{",
          "new_line_content": "    return strcmp(key1, key2) == 0;",
          "content_same": false
        },
        {
          "line": 1062,
          "old_api": null,
          "new_api": "DICT_NOTUSED",
          "old_text": null,
          "new_text": "DICT_NOTUSED(privdata)",
          "old_line_content": "",
          "new_line_content": "    DICT_NOTUSED(privdata);",
          "content_same": false
        },
        {
          "line": 1064,
          "old_api": null,
          "new_api": "zfree",
          "old_text": null,
          "new_text": "zfree(key)",
          "old_line_content": "    _dictStringCopyHTHashFunction, /* hash function */",
          "new_line_content": "    zfree(key);",
          "content_same": false
        },
        {
          "line": 941,
          "old_api": null,
          "new_api": "_dictExpandIfNeeded",
          "old_text": null,
          "new_text": "_dictExpandIfNeeded(d)",
          "old_line_content": "    for (table = 0; table <= 1; table++) {",
          "new_line_content": "    if (_dictExpandIfNeeded(d) == DICT_ERR)",
          "content_same": false
        },
        {
          "line": 944,
          "old_api": null,
          "new_api": "dictHashKey",
          "old_text": null,
          "new_text": "dictHashKey(d, key)",
          "old_line_content": "        he = d->ht[table].table[idx];",
          "new_line_content": "    h = dictHashKey(d, key);",
          "content_same": false
        },
        {
          "line": 954,
          "old_api": null,
          "new_api": "dictIsRehashing",
          "old_text": null,
          "new_text": "dictIsRehashing(d)",
          "old_line_content": "",
          "new_line_content": "        if (!dictIsRehashing(d)) break;",
          "content_same": false
        },
        {
          "line": 830,
          "old_api": null,
          "new_api": "dictSize",
          "old_text": null,
          "new_text": "dictSize(d)",
          "old_line_content": "        m0 = t0->sizemask;",
          "new_line_content": "    if (dictSize(d) == 0) return 0;",
          "content_same": false
        },
        {
          "line": 832,
          "old_api": null,
          "new_api": "dictIsRehashing",
          "old_text": null,
          "new_text": "dictIsRehashing(d)",
          "old_line_content": "        /* Emit entries at cursor */",
          "new_line_content": "    if (!dictIsRehashing(d)) {",
          "content_same": false
        },
        {
          "line": 960,
          "old_api": null,
          "new_api": "_dictClear",
          "old_text": null,
          "new_text": "_dictClear(d,&d->ht[0],callback)",
          "old_line_content": "}",
          "new_line_content": "    _dictClear(d,&d->ht[0],callback);",
          "content_same": false
        },
        {
          "line": 961,
          "old_api": null,
          "new_api": "_dictClear",
          "old_text": null,
          "new_text": "_dictClear(d,&d->ht[1],callback)",
          "old_line_content": "",
          "new_line_content": "    _dictClear(d,&d->ht[1],callback);",
          "content_same": false
        },
        {
          "line": 839,
          "old_api": null,
          "new_api": "fn",
          "old_text": null,
          "new_text": "fn(privdata, de)",
          "old_line_content": "    } else {",
          "new_line_content": "            fn(privdata, de);",
          "content_same": false
        },
        {
          "line": 859,
          "old_api": null,
          "new_api": "fn",
          "old_text": null,
          "new_text": "fn(privdata, de)",
          "old_line_content": "        /* Iterate over indices in larger table that are the expansion",
          "new_line_content": "            fn(privdata, de);",
          "content_same": false
        },
        {
          "line": 988,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\"No stats available for empty dictionaries\\n\")",
          "old_line_content": "    for (i = 0; i < DICT_STATS_VECTLEN; i++) clvector[i] = 0;",
          "new_line_content": "        printf(\"No stats available for empty dictionaries\\n\");",
          "content_same": false
        },
        {
          "line": 869,
          "old_api": null,
          "new_api": "fn",
          "old_text": null,
          "new_text": "fn(privdata, de)",
          "old_line_content": "            /* Increment bits not covered by the smaller mask */",
          "new_line_content": "                fn(privdata, de);",
          "content_same": false
        },
        {
          "line": 885,
          "old_api": null,
          "new_api": "rev",
          "old_text": null,
          "new_text": "rev(v)",
          "old_line_content": "    return v;",
          "new_line_content": "    v = rev(v);",
          "content_same": false
        },
        {
          "line": 887,
          "old_api": null,
          "new_api": "rev",
          "old_text": null,
          "new_text": "rev(v)",
          "old_line_content": "",
          "new_line_content": "    v = rev(v);",
          "content_same": false
        },
        {
          "line": 1016,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\" max chain length: %ld\\n\", maxchainlen)",
          "old_line_content": "    for (i = 0; i < DICT_STATS_VECTLEN-1; i++) {",
          "new_line_content": "    printf(\" max chain length: %ld\\n\", maxchainlen);",
          "content_same": false
        },
        {
          "line": 1017,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\" avg chain length (counted): %.02f\\n\", (float)totchainlen/slots)",
          "old_line_content": "        if (clvector[i] == 0) continue;",
          "new_line_content": "    printf(\" avg chain length (counted): %.02f\\n\", (float)totchainlen/slots);",
          "content_same": false
        },
        {
          "line": 1019,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\" Chain length distribution:\\n\")",
          "old_line_content": "    }",
          "new_line_content": "    printf(\" Chain length distribution:\\n\");",
          "content_same": false
        },
        {
          "line": 1022,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\"   %s%ld: %ld (%.02f%%)\\n\",(i == DICT_STATS_VECTLEN-1)?\">= \":\"\", i, clvector[i], ((float)clvector[i]/ht->size)*100)",
          "old_line_content": "void dictPrintStats(dict *d) {",
          "new_line_content": "        printf(\"   %s%ld: %ld (%.02f%%)\\n\",(i == DICT_STATS_VECTLEN-1)?\">= \":\"\", i, clvector[i], ((float)clvector[i]/ht->size)*100);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 1024,
          "old_api": "dictIsRehashing",
          "new_api": null,
          "old_text": "dictIsRehashing(d)",
          "new_text": null,
          "old_line_content": "    if (dictIsRehashing(d)) {",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 1025,
          "old_api": "printf",
          "new_api": null,
          "old_text": "printf(\"-- Rehashing into ht[1]:\\n\")",
          "new_text": null,
          "old_line_content": "        printf(\"-- Rehashing into ht[1]:\\n\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1026,
          "old_api": "_dictPrintStatsHt",
          "new_api": null,
          "old_text": "_dictPrintStatsHt(&d->ht[1])",
          "new_text": null,
          "old_line_content": "        _dictPrintStatsHt(&d->ht[1]);",
          "new_line_content": "void dictPrintStats(dict *d) {",
          "content_same": false
        },
        {
          "line": 897,
          "old_api": "dictExpand",
          "new_api": null,
          "old_text": "dictExpand(d, DICT_HT_INITIAL_SIZE)",
          "new_text": null,
          "old_line_content": "    if (d->ht[0].size == 0) return dictExpand(d, DICT_HT_INITIAL_SIZE);",
          "new_line_content": "    /* Incremental rehashing already in progress. Return. */",
          "content_same": false
        },
        {
          "line": 1034,
          "old_api": "strlen",
          "new_api": null,
          "old_text": "strlen(key)",
          "new_text": null,
          "old_line_content": "    return dictGenHashFunction(key, strlen(key));",
          "new_line_content": "/* ----------------------- StringCopy Hash Table Type ------------------------*/",
          "content_same": false
        },
        {
          "line": 907,
          "old_api": "dictExpand",
          "new_api": null,
          "old_text": "dictExpand(d, d->ht[0].used*2)",
          "new_text": null,
          "old_line_content": "        return dictExpand(d, d->ht[0].used*2);",
          "new_line_content": "    if (d->ht[0].used >= d->ht[0].size &&",
          "content_same": false
        },
        {
          "line": 1039,
          "old_api": "strlen",
          "new_api": null,
          "old_text": "strlen(key)",
          "new_text": null,
          "old_line_content": "    int len = strlen(key);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 1040,
          "old_api": "zmalloc",
          "new_api": null,
          "old_text": "zmalloc(len+1)",
          "new_text": null,
          "old_line_content": "    char *copy = zmalloc(len+1);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1041,
          "old_api": "DICT_NOTUSED",
          "new_api": null,
          "old_text": "DICT_NOTUSED(privdata)",
          "new_text": null,
          "old_line_content": "    DICT_NOTUSED(privdata);",
          "new_line_content": "static void *_dictStringDup(void *privdata, const void *key)",
          "content_same": false
        },
        {
          "line": 1051,
          "old_api": "DICT_NOTUSED",
          "new_api": null,
          "old_text": "DICT_NOTUSED(privdata)",
          "new_text": null,
          "old_line_content": "    DICT_NOTUSED(privdata);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1053,
          "old_api": "strcmp",
          "new_api": null,
          "old_text": "strcmp(key1, key2)",
          "new_text": null,
          "old_line_content": "    return strcmp(key1, key2) == 0;",
          "new_line_content": "        const void *key2)",
          "content_same": false
        },
        {
          "line": 1058,
          "old_api": "DICT_NOTUSED",
          "new_api": null,
          "old_text": "DICT_NOTUSED(privdata)",
          "new_text": null,
          "old_line_content": "    DICT_NOTUSED(privdata);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 1060,
          "old_api": "zfree",
          "new_api": null,
          "old_text": "zfree(key)",
          "new_text": null,
          "old_line_content": "    zfree(key);",
          "new_line_content": "static void _dictStringDestructor(void *privdata, void *key)",
          "content_same": false
        },
        {
          "line": 937,
          "old_api": "_dictExpandIfNeeded",
          "new_api": null,
          "old_text": "_dictExpandIfNeeded(d)",
          "new_text": null,
          "old_line_content": "    if (_dictExpandIfNeeded(d) == DICT_ERR)",
          "new_line_content": "    unsigned int h, idx, table;",
          "content_same": false
        },
        {
          "line": 940,
          "old_api": "dictHashKey",
          "new_api": null,
          "old_text": "dictHashKey(d, key)",
          "new_text": null,
          "old_line_content": "    h = dictHashKey(d, key);",
          "new_line_content": "    /* Expand the hash table if needed */",
          "content_same": false
        },
        {
          "line": 946,
          "old_api": "dictCompareKeys",
          "new_api": null,
          "old_text": "dictCompareKeys(d, key, he->key)",
          "new_text": null,
          "old_line_content": "            if (dictCompareKeys(d, key, he->key))",
          "new_line_content": "        idx = h & d->ht[table].sizemask;",
          "content_same": false
        },
        {
          "line": 826,
          "old_api": "dictSize",
          "new_api": null,
          "old_text": "dictSize(d)",
          "new_text": null,
          "old_line_content": "    if (dictSize(d) == 0) return 0;",
          "new_line_content": "    dictht *t0, *t1;",
          "content_same": false
        },
        {
          "line": 828,
          "old_api": "dictIsRehashing",
          "new_api": null,
          "old_text": "dictIsRehashing(d)",
          "new_text": null,
          "old_line_content": "    if (!dictIsRehashing(d)) {",
          "new_line_content": "    unsigned long m0, m1;",
          "content_same": false
        },
        {
          "line": 956,
          "old_api": "_dictClear",
          "new_api": null,
          "old_text": "_dictClear(d,&d->ht[0],callback)",
          "new_text": null,
          "old_line_content": "    _dictClear(d,&d->ht[0],callback);",
          "new_line_content": "    return idx;",
          "content_same": false
        },
        {
          "line": 957,
          "old_api": "_dictClear",
          "new_api": null,
          "old_text": "_dictClear(d,&d->ht[1],callback)",
          "new_text": null,
          "old_line_content": "    _dictClear(d,&d->ht[1],callback);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 835,
          "old_api": "fn",
          "new_api": null,
          "old_text": "fn(privdata, de)",
          "new_text": null,
          "old_line_content": "            fn(privdata, de);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 855,
          "old_api": "fn",
          "new_api": null,
          "old_text": "fn(privdata, de)",
          "new_text": null,
          "old_line_content": "            fn(privdata, de);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 984,
          "old_api": "printf",
          "new_api": null,
          "old_text": "printf(\"No stats available for empty dictionaries\\n\")",
          "new_text": null,
          "old_line_content": "        printf(\"No stats available for empty dictionaries\\n\");",
          "new_line_content": "    unsigned long totchainlen = 0;",
          "content_same": false
        },
        {
          "line": 865,
          "old_api": "fn",
          "new_api": null,
          "old_text": "fn(privdata, de)",
          "new_text": null,
          "old_line_content": "                fn(privdata, de);",
          "new_line_content": "        do {",
          "content_same": false
        },
        {
          "line": 1008,
          "old_api": "printf",
          "new_api": null,
          "old_text": "printf(\"Hash table stats:\\n\")",
          "new_text": null,
          "old_line_content": "    printf(\"Hash table stats:\\n\");",
          "new_line_content": "        clvector[(chainlen < DICT_STATS_VECTLEN) ? chainlen : (DICT_STATS_VECTLEN-1)]++;",
          "content_same": false
        },
        {
          "line": 881,
          "old_api": "rev",
          "new_api": null,
          "old_text": "rev(v)",
          "new_text": null,
          "old_line_content": "    v = rev(v);",
          "new_line_content": "     * operates on the masked bits of the smaller table */",
          "content_same": false
        },
        {
          "line": 1009,
          "old_api": "printf",
          "new_api": null,
          "old_text": "printf(\" table size: %ld\\n\", ht->size)",
          "new_text": null,
          "old_line_content": "    printf(\" table size: %ld\\n\", ht->size);",
          "new_line_content": "        if (chainlen > maxchainlen) maxchainlen = chainlen;",
          "content_same": false
        },
        {
          "line": 883,
          "old_api": "rev",
          "new_api": null,
          "old_text": "rev(v)",
          "new_text": null,
          "old_line_content": "    v = rev(v);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1010,
          "old_api": "printf",
          "new_api": null,
          "old_text": "printf(\" number of elements: %ld\\n\", ht->used)",
          "new_text": null,
          "old_line_content": "    printf(\" number of elements: %ld\\n\", ht->used);",
          "new_line_content": "        totchainlen += chainlen;",
          "content_same": false
        },
        {
          "line": 1011,
          "old_api": "printf",
          "new_api": null,
          "old_text": "printf(\" different slots: %ld\\n\", slots)",
          "new_text": null,
          "old_line_content": "    printf(\" different slots: %ld\\n\", slots);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 894,
          "old_api": "dictIsRehashing",
          "new_api": null,
          "old_text": "dictIsRehashing(d)",
          "new_text": null,
          "old_line_content": "    if (dictIsRehashing(d)) return DICT_OK;",
          "new_line_content": "/* Expand the hash table if needed */",
          "content_same": false
        },
        {
          "line": 1023,
          "old_api": "_dictPrintStatsHt",
          "new_api": null,
          "old_text": "_dictPrintStatsHt(&d->ht[0])",
          "new_text": null,
          "old_line_content": "    _dictPrintStatsHt(&d->ht[0]);",
          "new_line_content": "    }",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 2,
      "total_additions": 32,
      "total_deletions": 32,
      "total_api_changes": 66
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 4,
        "api_related_lines": 66,
        "non_api_lines": 4,
        "non_api_line_numbers": [
          704,
          705,
          706,
          707
        ]
      }
    },
    "api_calls_before": 120,
    "api_calls_after": 120,
    "diff_info": {
      "added_lines": 4,
      "removed_lines": 0,
      "total_diff_lines": 16
    }
  }
}