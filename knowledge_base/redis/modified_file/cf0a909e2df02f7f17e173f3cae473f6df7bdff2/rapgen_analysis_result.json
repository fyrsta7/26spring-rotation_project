{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/redis/modified_file/cf0a909e2df02f7f17e173f3cae473f6df7bdff2",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/redis/modified_file/cf0a909e2df02f7f17e173f3cae473f6df7bdff2/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/redis/modified_file/cf0a909e2df02f7f17e173f3cae473f6df7bdff2/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/redis/modified_file/cf0a909e2df02f7f17e173f3cae473f6df7bdff2/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 491,
          "old_api": "listFirst",
          "new_api": "dictGetVal",
          "old_text": "listFirst(clients)",
          "new_text": "dictGetVal(de)",
          "old_line_content": "            listNode *clientnode = listFirst(clients);",
          "new_line_content": "        list *clients = dictGetVal(de);",
          "content_same": false
        },
        {
          "line": 514,
          "old_api": "moduleUnblockClient",
          "new_api": "elapsedStart",
          "old_text": "moduleUnblockClient(receiver)",
          "new_text": "elapsedStart(&replyTimer)",
          "old_line_content": "            moduleUnblockClient(receiver);",
          "new_line_content": "            elapsedStart(&replyTimer);",
          "content_same": false
        },
        {
          "line": 574,
          "old_api": "serveClientsBlockedOnListKey",
          "new_api": "lookupKeyWrite",
          "old_text": "serveClientsBlockedOnListKey(o,rl)",
          "new_text": "lookupKeyWrite(rl->db,rl->key)",
          "old_line_content": "                    serveClientsBlockedOnListKey(o,rl);",
          "new_line_content": "            robj *o = lookupKeyWrite(rl->db,rl->key);",
          "content_same": false
        },
        {
          "line": 578,
          "old_api": "serveClientsBlockedOnStreamKey",
          "new_api": "serveClientsBlockedOnListKey",
          "old_text": "serveClientsBlockedOnStreamKey(o,rl)",
          "new_text": "serveClientsBlockedOnListKey(o,rl)",
          "old_line_content": "                    serveClientsBlockedOnStreamKey(o,rl);",
          "new_line_content": "                    serveClientsBlockedOnListKey(o,rl);",
          "content_same": false
        },
        {
          "line": 582,
          "old_api": "serveClientsBlockedOnKeyByModule",
          "new_api": "serveClientsBlockedOnStreamKey",
          "old_text": "serveClientsBlockedOnKeyByModule(rl)",
          "new_text": "serveClientsBlockedOnStreamKey(o,rl)",
          "old_line_content": "                serveClientsBlockedOnKeyByModule(rl);",
          "new_line_content": "                    serveClientsBlockedOnStreamKey(o,rl);",
          "content_same": false
        },
        {
          "line": 591,
          "old_api": "listRelease",
          "new_api": "decrRefCount",
          "old_text": "listRelease(l)",
          "new_text": "decrRefCount(rl->key)",
          "old_line_content": "        listRelease(l); /* We have the new list on place at this point. */",
          "new_line_content": "            decrRefCount(rl->key);",
          "content_same": false
        },
        {
          "line": 646,
          "old_api": "incrRefCount",
          "new_api": "dictAdd",
          "old_text": "incrRefCount(keys[j])",
          "new_text": "dictAdd(c->bpop.keys,keys[j],bki)",
          "old_line_content": "        incrRefCount(keys[j]);",
          "new_line_content": "        if (dictAdd(c->bpop.keys,keys[j],bki) != DICT_OK) {",
          "content_same": false
        },
        {
          "line": 659,
          "old_api": "dictGetVal",
          "new_api": "dictAdd",
          "old_text": "dictGetVal(de)",
          "new_text": "dictAdd(c->db->blocking_keys,keys[j],l)",
          "old_line_content": "            l = dictGetVal(de);",
          "new_line_content": "            retval = dictAdd(c->db->blocking_keys,keys[j],l);",
          "content_same": false
        },
        {
          "line": 661,
          "old_api": "listAddNodeTail",
          "new_api": "serverAssertWithInfo",
          "old_text": "listAddNodeTail(l,c)",
          "new_text": "serverAssertWithInfo(c,keys[j],retval == DICT_OK)",
          "old_line_content": "        listAddNodeTail(l,c);",
          "new_line_content": "            serverAssertWithInfo(c,keys[j],retval == DICT_OK);",
          "content_same": false
        },
        {
          "line": 678,
          "old_api": "dictGetKey",
          "new_api": "dictSize",
          "old_text": "dictGetKey(de)",
          "new_text": "dictSize(c->bpop.keys)",
          "old_line_content": "        robj *key = dictGetKey(de);",
          "new_line_content": "    serverAssertWithInfo(c,NULL,dictSize(c->bpop.keys) != 0);",
          "content_same": false
        },
        {
          "line": 679,
          "old_api": "dictGetVal",
          "new_api": "dictGetIterator",
          "old_text": "dictGetVal(de)",
          "new_text": "dictGetIterator(c->bpop.keys)",
          "old_line_content": "        bkinfo *bki = dictGetVal(de);",
          "new_line_content": "    di = dictGetIterator(c->bpop.keys);",
          "content_same": false
        },
        {
          "line": 682,
          "old_api": "dictFetchValue",
          "new_api": "dictGetKey",
          "old_text": "dictFetchValue(c->db->blocking_keys,key)",
          "new_text": "dictGetKey(de)",
          "old_line_content": "        l = dictFetchValue(c->db->blocking_keys,key);",
          "new_line_content": "        robj *key = dictGetKey(de);",
          "content_same": false
        },
        {
          "line": 683,
          "old_api": "serverAssertWithInfo",
          "new_api": "dictGetVal",
          "old_text": "serverAssertWithInfo(c,key,l != NULL)",
          "new_text": "dictGetVal(de)",
          "old_line_content": "        serverAssertWithInfo(c,key,l != NULL);",
          "new_line_content": "        bkinfo *bki = dictGetVal(de);",
          "content_same": false
        },
        {
          "line": 686,
          "old_api": "listLength",
          "new_api": "dictFetchValue",
          "old_text": "listLength(l)",
          "new_text": "dictFetchValue(c->db->blocking_keys,key)",
          "old_line_content": "        if (listLength(l) == 0)",
          "new_line_content": "        l = dictFetchValue(c->db->blocking_keys,key);",
          "content_same": false
        },
        {
          "line": 687,
          "old_api": "dictDelete",
          "new_api": "serverAssertWithInfo",
          "old_text": "dictDelete(c->db->blocking_keys,key)",
          "new_text": "serverAssertWithInfo(c,key,l != NULL)",
          "old_line_content": "            dictDelete(c->db->blocking_keys,key);",
          "new_line_content": "        serverAssertWithInfo(c,key,l != NULL);",
          "content_same": false
        },
        {
          "line": 751,
          "old_api": "listAddNodeTail",
          "new_api": "zmalloc",
          "old_text": "listAddNodeTail(server.ready_keys,rl)",
          "new_text": "zmalloc(sizeof(*rl))",
          "old_line_content": "    listAddNodeTail(server.ready_keys,rl);",
          "new_line_content": "    rl = zmalloc(sizeof(*rl));",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 641,
          "old_api": null,
          "new_api": "zmalloc",
          "old_text": null,
          "new_text": "zmalloc(sizeof(*bki))",
          "old_line_content": "        /* If the key already exists in the dictionary ignore it. */",
          "new_line_content": "        bkinfo *bki = zmalloc(sizeof(*bki));",
          "content_same": false
        },
        {
          "line": 515,
          "old_api": null,
          "new_api": "moduleTryServeClientBlockedOnKey",
          "old_text": null,
          "new_text": "moduleTryServeClientBlockedOnKey(receiver, rl->key)",
          "old_line_content": "        }",
          "new_line_content": "            if (!moduleTryServeClientBlockedOnKey(receiver, rl->key)) continue;",
          "content_same": false
        },
        {
          "line": 516,
          "old_api": null,
          "new_api": "elapsedUs",
          "old_text": null,
          "new_text": "elapsedUs(replyTimer)",
          "old_line_content": "    }",
          "new_line_content": "            updateStatsOnUnblock(receiver, 0, elapsedUs(replyTimer));",
          "content_same": false
        },
        {
          "line": 518,
          "old_api": null,
          "new_api": "moduleUnblockClient",
          "old_text": null,
          "new_text": "moduleUnblockClient(receiver)",
          "old_line_content": "",
          "new_line_content": "            moduleUnblockClient(receiver);",
          "content_same": false
        },
        {
          "line": 647,
          "old_api": null,
          "new_api": "zfree",
          "old_text": null,
          "new_text": "zfree(bki)",
          "old_line_content": "",
          "new_line_content": "            zfree(bki);",
          "content_same": false
        },
        {
          "line": 650,
          "old_api": null,
          "new_api": "incrRefCount",
          "old_text": null,
          "new_text": "incrRefCount(keys[j])",
          "old_line_content": "        if (de == NULL) {",
          "new_line_content": "        incrRefCount(keys[j]);",
          "content_same": false
        },
        {
          "line": 653,
          "old_api": null,
          "new_api": "dictFind",
          "old_text": null,
          "new_text": "dictFind(c->db->blocking_keys,keys[j])",
          "old_line_content": "            /* For every key we take a list of clients blocked for it */",
          "new_line_content": "        de = dictFind(c->db->blocking_keys,keys[j]);",
          "content_same": false
        },
        {
          "line": 658,
          "old_api": null,
          "new_api": "listCreate",
          "old_text": null,
          "new_text": "listCreate()",
          "old_line_content": "        } else {",
          "new_line_content": "            l = listCreate();",
          "content_same": false
        },
        {
          "line": 660,
          "old_api": null,
          "new_api": "incrRefCount",
          "old_text": null,
          "new_text": "incrRefCount(keys[j])",
          "old_line_content": "        }",
          "new_line_content": "            incrRefCount(keys[j]);",
          "content_same": false
        },
        {
          "line": 663,
          "old_api": null,
          "new_api": "dictGetVal",
          "old_text": null,
          "new_text": "dictGetVal(de)",
          "old_line_content": "    }",
          "new_line_content": "            l = dictGetVal(de);",
          "content_same": false
        },
        {
          "line": 665,
          "old_api": null,
          "new_api": "listAddNodeTail",
          "old_text": null,
          "new_text": "listAddNodeTail(l,c)",
          "old_line_content": "}",
          "new_line_content": "        listAddNodeTail(l,c);",
          "content_same": false
        },
        {
          "line": 666,
          "old_api": null,
          "new_api": "listLast",
          "old_text": null,
          "new_text": "listLast(l)",
          "old_line_content": "",
          "new_line_content": "        bki->listnode = listLast(l);",
          "content_same": false
        },
        {
          "line": 668,
          "old_api": null,
          "new_api": "blockClient",
          "old_text": null,
          "new_text": "blockClient(c,btype)",
          "old_line_content": " * You should never call this function directly, but unblockClient() instead. */",
          "new_line_content": "    blockClient(c,btype);",
          "content_same": false
        },
        {
          "line": 545,
          "old_api": null,
          "new_api": "listLength",
          "old_text": null,
          "new_text": "listLength(server.ready_keys)",
          "old_line_content": "         * locally. This way as we run the old list we are free to call",
          "new_line_content": "    while(listLength(server.ready_keys) != 0) {",
          "content_same": false
        },
        {
          "line": 553,
          "old_api": null,
          "new_api": "listCreate",
          "old_text": null,
          "new_text": "listCreate()",
          "old_line_content": "            readyList *rl = ln->value;",
          "new_line_content": "        server.ready_keys = listCreate();",
          "content_same": false
        },
        {
          "line": 681,
          "old_api": null,
          "new_api": "dictNext",
          "old_text": null,
          "new_text": "dictNext(di)",
          "old_line_content": "        /* Remove this client from the list of clients waiting for this key. */",
          "new_line_content": "    while((de = dictNext(di)) != NULL) {",
          "content_same": false
        },
        {
          "line": 555,
          "old_api": null,
          "new_api": "listLength",
          "old_text": null,
          "new_text": "listLength(l)",
          "old_line_content": "            /* First of all remove this key from db->ready_keys so that",
          "new_line_content": "        while(listLength(l) != 0) {",
          "content_same": false
        },
        {
          "line": 556,
          "old_api": null,
          "new_api": "listFirst",
          "old_text": null,
          "new_text": "listFirst(l)",
          "old_line_content": "             * we can safely call signalKeyAsReady() against this key. */",
          "new_line_content": "            listNode *ln = listFirst(l);",
          "content_same": false
        },
        {
          "line": 688,
          "old_api": null,
          "new_api": "listDelNode",
          "old_text": null,
          "new_text": "listDelNode(l,bki->listnode)",
          "old_line_content": "    }",
          "new_line_content": "        listDelNode(l,bki->listnode);",
          "content_same": false
        },
        {
          "line": 561,
          "old_api": null,
          "new_api": "dictDelete",
          "old_text": null,
          "new_text": "dictDelete(rl->db->ready_keys,rl->key)",
          "old_line_content": "             * reference time, and not against the wallclock time. This",
          "new_line_content": "            dictDelete(rl->db->ready_keys,rl->key);",
          "content_same": false
        },
        {
          "line": 690,
          "old_api": null,
          "new_api": "listLength",
          "old_text": null,
          "new_text": "listLength(l)",
          "old_line_content": "",
          "new_line_content": "        if (listLength(l) == 0)",
          "content_same": false
        },
        {
          "line": 691,
          "old_api": null,
          "new_api": "dictDelete",
          "old_text": null,
          "new_text": "dictDelete(c->db->blocking_keys,key)",
          "old_line_content": "    /* Cleanup the client structure */",
          "new_line_content": "            dictDelete(c->db->blocking_keys,key);",
          "content_same": false
        },
        {
          "line": 693,
          "old_api": null,
          "new_api": "dictReleaseIterator",
          "old_text": null,
          "new_text": "dictReleaseIterator(di)",
          "old_line_content": "    if (c->bpop.target) {",
          "new_line_content": "    dictReleaseIterator(di);",
          "content_same": false
        },
        {
          "line": 696,
          "old_api": null,
          "new_api": "dictEmpty",
          "old_text": null,
          "new_text": "dictEmpty(c->bpop.keys,NULL)",
          "old_line_content": "    }",
          "new_line_content": "    dictEmpty(c->bpop.keys,NULL);",
          "content_same": false
        },
        {
          "line": 571,
          "old_api": null,
          "new_api": "updateCachedTime",
          "old_text": null,
          "new_text": "updateCachedTime(0)",
          "old_line_content": "",
          "new_line_content": "            updateCachedTime(0);",
          "content_same": false
        },
        {
          "line": 702,
          "old_api": null,
          "new_api": "decrRefCount",
          "old_text": null,
          "new_text": "decrRefCount(c->bpop.xread_group)",
          "old_line_content": "    }",
          "new_line_content": "        decrRefCount(c->bpop.xread_group);",
          "content_same": false
        },
        {
          "line": 703,
          "old_api": null,
          "new_api": "decrRefCount",
          "old_text": null,
          "new_text": "decrRefCount(c->bpop.xread_consumer)",
          "old_line_content": "}",
          "new_line_content": "        decrRefCount(c->bpop.xread_consumer);",
          "content_same": false
        },
        {
          "line": 580,
          "old_api": null,
          "new_api": "serveClientsBlockedOnSortedSetKey",
          "old_text": null,
          "new_text": "serveClientsBlockedOnSortedSetKey(o,rl)",
          "old_line_content": "                 * regardless of the object type: we don't know what the",
          "new_line_content": "                    serveClientsBlockedOnSortedSetKey(o,rl);",
          "content_same": false
        },
        {
          "line": 586,
          "old_api": null,
          "new_api": "serveClientsBlockedOnKeyByModule",
          "old_text": null,
          "new_text": "serveClientsBlockedOnKeyByModule(rl)",
          "old_line_content": "            /* Free this item. */",
          "new_line_content": "                serveClientsBlockedOnKeyByModule(rl);",
          "content_same": false
        },
        {
          "line": 592,
          "old_api": null,
          "new_api": "zfree",
          "old_text": null,
          "new_text": "zfree(rl)",
          "old_line_content": "    }",
          "new_line_content": "            zfree(rl);",
          "content_same": false
        },
        {
          "line": 593,
          "old_api": null,
          "new_api": "listDelNode",
          "old_text": null,
          "new_text": "listDelNode(l,ln)",
          "old_line_content": "}",
          "new_line_content": "            listDelNode(l,ln);",
          "content_same": false
        },
        {
          "line": 595,
          "old_api": null,
          "new_api": "listRelease",
          "old_text": null,
          "new_text": "listRelease(l)",
          "old_line_content": "/* This is how the current blocking lists/sorted sets/streams work, we use",
          "new_line_content": "        listRelease(l); /* We have the new list on place at this point. */",
          "content_same": false
        },
        {
          "line": 730,
          "old_api": null,
          "new_api": "getBlockedTypeByType",
          "old_text": null,
          "new_text": "getBlockedTypeByType(type)",
          "old_line_content": "    }",
          "new_line_content": "    int btype = getBlockedTypeByType(type);",
          "content_same": false
        },
        {
          "line": 745,
          "old_api": null,
          "new_api": "dictFind",
          "old_text": null,
          "new_text": "dictFind(db->blocking_keys,key)",
          "old_line_content": "",
          "new_line_content": "    if (dictFind(db->blocking_keys,key) == NULL) return;",
          "content_same": false
        },
        {
          "line": 489,
          "old_api": null,
          "new_api": "dictFind",
          "old_text": null,
          "new_text": "dictFind(rl->db->blocking_keys,rl->key)",
          "old_line_content": "",
          "new_line_content": "    de = dictFind(rl->db->blocking_keys,rl->key);",
          "content_same": false
        },
        {
          "line": 748,
          "old_api": null,
          "new_api": "dictFind",
          "old_text": null,
          "new_text": "dictFind(db->ready_keys,key)",
          "old_line_content": "    rl->key = key;",
          "new_line_content": "    if (dictFind(db->ready_keys,key) != NULL) return;",
          "content_same": false
        },
        {
          "line": 492,
          "old_api": null,
          "new_api": "listLength",
          "old_text": null,
          "new_text": "listLength(clients)",
          "old_line_content": "            client *receiver = clientnode->value;",
          "new_line_content": "        int numclients = listLength(clients);",
          "content_same": false
        },
        {
          "line": 495,
          "old_api": null,
          "new_api": "listFirst",
          "old_text": null,
          "new_text": "listFirst(clients)",
          "old_line_content": "             * we'll not run into it again: clients here may not be",
          "new_line_content": "            listNode *clientnode = listFirst(clients);",
          "content_same": false
        },
        {
          "line": 754,
          "old_api": null,
          "new_api": "incrRefCount",
          "old_text": null,
          "new_text": "incrRefCount(key)",
          "old_line_content": "     * to avoid adding it multiple times into a list with a simple O(1)",
          "new_line_content": "    incrRefCount(key);",
          "content_same": false
        },
        {
          "line": 755,
          "old_api": null,
          "new_api": "listAddNodeTail",
          "old_text": null,
          "new_text": "listAddNodeTail(server.ready_keys,rl)",
          "old_line_content": "     * check. */",
          "new_line_content": "    listAddNodeTail(server.ready_keys,rl);",
          "content_same": false
        },
        {
          "line": 503,
          "old_api": null,
          "new_api": "listRotateHeadToTail",
          "old_text": null,
          "new_text": "listRotateHeadToTail(clients)",
          "old_line_content": "            /* Note that if *this* client cannot be served by this key,",
          "new_line_content": "            listRotateHeadToTail(clients);",
          "content_same": false
        },
        {
          "line": 760,
          "old_api": null,
          "new_api": "incrRefCount",
          "old_text": null,
          "new_text": "incrRefCount(key)",
          "old_line_content": "",
          "new_line_content": "    incrRefCount(key);",
          "content_same": false
        },
        {
          "line": 761,
          "old_api": null,
          "new_api": "dictAdd",
          "old_text": null,
          "new_text": "dictAdd(db->ready_keys,key,NULL)",
          "old_line_content": "",
          "new_line_content": "    serverAssert(dictAdd(db->ready_keys,key,NULL) == DICT_OK);",
          "content_same": false
        },
        {
          "line": 636,
          "old_api": null,
          "new_api": "incrRefCount",
          "old_text": null,
          "new_text": "incrRefCount(target)",
          "old_line_content": "         * is blocked for. */",
          "new_line_content": "    if (target != NULL) incrRefCount(target);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 512,
          "old_api": "elapsedUs",
          "new_api": null,
          "old_text": "elapsedUs(replyTimer)",
          "new_text": null,
          "old_line_content": "            updateStatsOnUnblock(receiver, 0, elapsedUs(replyTimer));",
          "new_line_content": "             * to continue after the first failure. */",
          "content_same": false
        },
        {
          "line": 642,
          "old_api": "dictAdd",
          "new_api": null,
          "old_text": "dictAdd(c->bpop.keys,keys[j],bki)",
          "new_text": null,
          "old_line_content": "        if (dictAdd(c->bpop.keys,keys[j],bki) != DICT_OK) {",
          "new_line_content": "        if (btype == BLOCKED_STREAM)",
          "content_same": false
        },
        {
          "line": 643,
          "old_api": "zfree",
          "new_api": null,
          "old_text": "zfree(bki)",
          "new_text": null,
          "old_line_content": "            zfree(bki);",
          "new_line_content": "            bki->stream_id = ids[j];",
          "content_same": false
        },
        {
          "line": 649,
          "old_api": "dictFind",
          "new_api": null,
          "old_text": "dictFind(c->db->blocking_keys,keys[j])",
          "new_text": null,
          "old_line_content": "        de = dictFind(c->db->blocking_keys,keys[j]);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 654,
          "old_api": "listCreate",
          "new_api": null,
          "old_text": "listCreate()",
          "new_text": null,
          "old_line_content": "            l = listCreate();",
          "new_line_content": "        if (de == NULL) {",
          "content_same": false
        },
        {
          "line": 655,
          "old_api": "dictAdd",
          "new_api": null,
          "old_text": "dictAdd(c->db->blocking_keys,keys[j],l)",
          "new_text": null,
          "old_line_content": "            retval = dictAdd(c->db->blocking_keys,keys[j],l);",
          "new_line_content": "            int retval;",
          "content_same": false
        },
        {
          "line": 656,
          "old_api": "incrRefCount",
          "new_api": null,
          "old_text": "incrRefCount(keys[j])",
          "new_text": null,
          "old_line_content": "            incrRefCount(keys[j]);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 657,
          "old_api": "serverAssertWithInfo",
          "new_api": null,
          "old_text": "serverAssertWithInfo(c,keys[j],retval == DICT_OK)",
          "new_text": null,
          "old_line_content": "            serverAssertWithInfo(c,keys[j],retval == DICT_OK);",
          "new_line_content": "            /* For every key we take a list of clients blocked for it */",
          "content_same": false
        },
        {
          "line": 662,
          "old_api": "listLast",
          "new_api": null,
          "old_text": "listLast(l)",
          "new_text": null,
          "old_line_content": "        bki->listnode = listLast(l);",
          "new_line_content": "        } else {",
          "content_same": false
        },
        {
          "line": 664,
          "old_api": "blockClient",
          "new_api": null,
          "old_text": "blockClient(c,btype)",
          "new_text": null,
          "old_line_content": "    blockClient(c,btype);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 541,
          "old_api": "listLength",
          "new_api": null,
          "old_text": "listLength(server.ready_keys)",
          "new_text": null,
          "old_line_content": "    while(listLength(server.ready_keys) != 0) {",
          "new_line_content": " * other side of the linked list. However as long as the key starts to",
          "content_same": false
        },
        {
          "line": 674,
          "old_api": "dictSize",
          "new_api": null,
          "old_text": "dictSize(c->bpop.keys)",
          "new_text": null,
          "old_line_content": "    serverAssertWithInfo(c,NULL,dictSize(c->bpop.keys) != 0);",
          "new_line_content": "    dictEntry *de;",
          "content_same": false
        },
        {
          "line": 675,
          "old_api": "dictGetIterator",
          "new_api": null,
          "old_text": "dictGetIterator(c->bpop.keys)",
          "new_text": null,
          "old_line_content": "    di = dictGetIterator(c->bpop.keys);",
          "new_line_content": "    dictIterator *di;",
          "content_same": false
        },
        {
          "line": 549,
          "old_api": "listCreate",
          "new_api": null,
          "old_text": "listCreate()",
          "new_text": null,
          "old_line_content": "        server.ready_keys = listCreate();",
          "new_line_content": "         * locally. This way as we run the old list we are free to call",
          "content_same": false
        },
        {
          "line": 677,
          "old_api": "dictNext",
          "new_api": null,
          "old_text": "dictNext(di)",
          "new_text": null,
          "old_line_content": "    while((de = dictNext(di)) != NULL) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 551,
          "old_api": "listLength",
          "new_api": null,
          "old_text": "listLength(l)",
          "new_text": null,
          "old_line_content": "        while(listLength(l) != 0) {",
          "new_line_content": "         * when handling clients blocked into BLMOVE. */",
          "content_same": false
        },
        {
          "line": 552,
          "old_api": "listFirst",
          "new_api": null,
          "old_text": "listFirst(l)",
          "new_text": null,
          "old_line_content": "            listNode *ln = listFirst(l);",
          "new_line_content": "        l = server.ready_keys;",
          "content_same": false
        },
        {
          "line": 684,
          "old_api": "listDelNode",
          "new_api": null,
          "old_text": "listDelNode(l,bki->listnode)",
          "new_text": null,
          "old_line_content": "        listDelNode(l,bki->listnode);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 557,
          "old_api": "dictDelete",
          "new_api": null,
          "old_text": "dictDelete(rl->db->ready_keys,rl->key)",
          "new_text": null,
          "old_line_content": "            dictDelete(rl->db->ready_keys,rl->key);",
          "new_line_content": "            readyList *rl = ln->value;",
          "content_same": false
        },
        {
          "line": 689,
          "old_api": "dictReleaseIterator",
          "new_api": null,
          "old_text": "dictReleaseIterator(di)",
          "new_text": null,
          "old_line_content": "    dictReleaseIterator(di);",
          "new_line_content": "        /* If the list is empty we need to remove it to avoid wasting memory */",
          "content_same": false
        },
        {
          "line": 692,
          "old_api": "dictEmpty",
          "new_api": null,
          "old_text": "dictEmpty(c->bpop.keys,NULL)",
          "new_text": null,
          "old_line_content": "    dictEmpty(c->bpop.keys,NULL);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 694,
          "old_api": "decrRefCount",
          "new_api": null,
          "old_text": "decrRefCount(c->bpop.target)",
          "new_text": null,
          "old_line_content": "        decrRefCount(c->bpop.target);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 567,
          "old_api": "updateCachedTime",
          "new_api": null,
          "old_text": "updateCachedTime(0)",
          "new_text": null,
          "old_line_content": "            updateCachedTime(0);",
          "new_line_content": "             * that) without the risk of it being freed in the second",
          "content_same": false
        },
        {
          "line": 570,
          "old_api": "lookupKeyWrite",
          "new_api": null,
          "old_text": "lookupKeyWrite(rl->db,rl->key)",
          "new_text": null,
          "old_line_content": "            robj *o = lookupKeyWrite(rl->db,rl->key);",
          "new_line_content": "            server.fixed_time_expire++;",
          "content_same": false
        },
        {
          "line": 699,
          "old_api": "decrRefCount",
          "new_api": null,
          "old_text": "decrRefCount(c->bpop.xread_consumer)",
          "new_text": null,
          "old_line_content": "        decrRefCount(c->bpop.xread_consumer);",
          "new_line_content": "        c->bpop.target = NULL;",
          "content_same": false
        },
        {
          "line": 576,
          "old_api": "serveClientsBlockedOnSortedSetKey",
          "new_api": null,
          "old_text": "serveClientsBlockedOnSortedSetKey(o,rl)",
          "new_text": null,
          "old_line_content": "                    serveClientsBlockedOnSortedSetKey(o,rl);",
          "new_line_content": "            if (o != NULL) {",
          "content_same": false
        },
        {
          "line": 587,
          "old_api": "decrRefCount",
          "new_api": null,
          "old_text": "decrRefCount(rl->key)",
          "new_text": null,
          "old_line_content": "            decrRefCount(rl->key);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 588,
          "old_api": "zfree",
          "new_api": null,
          "old_text": "zfree(rl)",
          "new_text": null,
          "old_line_content": "            zfree(rl);",
          "new_line_content": "            server.fixed_time_expire--;",
          "content_same": false
        },
        {
          "line": 589,
          "old_api": "listDelNode",
          "new_api": null,
          "old_text": "listDelNode(l,ln)",
          "new_text": null,
          "old_line_content": "            listDelNode(l,ln);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 726,
          "old_api": "getBlockedTypeByType",
          "new_api": null,
          "old_text": "getBlockedTypeByType(type)",
          "new_text": null,
          "old_line_content": "    int btype = getBlockedTypeByType(type);",
          "new_line_content": "void signalKeyAsReady(redisDb *db, robj *key, int type) {",
          "content_same": false
        },
        {
          "line": 741,
          "old_api": "dictFind",
          "new_api": null,
          "old_text": "dictFind(db->blocking_keys,key)",
          "new_text": null,
          "old_line_content": "    if (dictFind(db->blocking_keys,key) == NULL) return;",
          "new_line_content": "        return;",
          "content_same": false
        },
        {
          "line": 485,
          "old_api": "dictFind",
          "new_api": null,
          "old_text": "dictFind(rl->db->blocking_keys,rl->key)",
          "new_text": null,
          "old_line_content": "    de = dictFind(rl->db->blocking_keys,rl->key);",
          "new_line_content": "    if (!server.blocked_clients_by_type[BLOCKED_MODULE]) return;",
          "content_same": false
        },
        {
          "line": 487,
          "old_api": "dictGetVal",
          "new_api": null,
          "old_text": "dictGetVal(de)",
          "new_text": null,
          "old_line_content": "        list *clients = dictGetVal(de);",
          "new_line_content": "    /* We serve clients in the same order they blocked for",
          "content_same": false
        },
        {
          "line": 744,
          "old_api": "dictFind",
          "new_api": null,
          "old_text": "dictFind(db->ready_keys,key)",
          "new_text": null,
          "old_line_content": "    if (dictFind(db->ready_keys,key) != NULL) return;",
          "new_line_content": "    /* No clients blocking for this key? No need to queue it. */",
          "content_same": false
        },
        {
          "line": 488,
          "old_api": "listLength",
          "new_api": null,
          "old_text": "listLength(clients)",
          "new_text": null,
          "old_line_content": "        int numclients = listLength(clients);",
          "new_line_content": "     * this key, from the first blocked to the last. */",
          "content_same": false
        },
        {
          "line": 747,
          "old_api": "zmalloc",
          "new_api": null,
          "old_text": "zmalloc(sizeof(*rl))",
          "new_text": null,
          "old_line_content": "    rl = zmalloc(sizeof(*rl));",
          "new_line_content": "    /* Key was already signaled? No need to queue it again. */",
          "content_same": false
        },
        {
          "line": 750,
          "old_api": "incrRefCount",
          "new_api": null,
          "old_text": "incrRefCount(key)",
          "new_text": null,
          "old_line_content": "    incrRefCount(key);",
          "new_line_content": "    /* Ok, we need to queue this key into server.ready_keys. */",
          "content_same": false
        },
        {
          "line": 499,
          "old_api": "listRotateHeadToTail",
          "new_api": null,
          "old_text": "listRotateHeadToTail(clients)",
          "new_text": null,
          "old_line_content": "            listRotateHeadToTail(clients);",
          "new_line_content": "             * we'll not run into it again: clients here may not be",
          "content_same": false
        },
        {
          "line": 756,
          "old_api": "incrRefCount",
          "new_api": null,
          "old_text": "incrRefCount(key)",
          "new_text": null,
          "old_line_content": "    incrRefCount(key);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 757,
          "old_api": "dictAdd",
          "new_api": null,
          "old_text": "dictAdd(db->ready_keys,key,NULL)",
          "new_text": null,
          "old_line_content": "    serverAssert(dictAdd(db->ready_keys,key,NULL) == DICT_OK);",
          "new_line_content": "    /* We also add the key in the db->ready_keys dictionary in order",
          "content_same": false
        },
        {
          "line": 632,
          "old_api": "incrRefCount",
          "new_api": null,
          "old_text": "incrRefCount(target)",
          "new_text": null,
          "old_line_content": "    if (target != NULL) incrRefCount(target);",
          "new_line_content": "    c->bpop.target = target;",
          "content_same": false
        },
        {
          "line": 637,
          "old_api": "zmalloc",
          "new_api": null,
          "old_text": "zmalloc(sizeof(*bki))",
          "new_text": null,
          "old_line_content": "        bkinfo *bki = zmalloc(sizeof(*bki));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 510,
          "old_api": "elapsedStart",
          "new_api": null,
          "old_text": "elapsedStart(&replyTimer)",
          "new_text": null,
          "old_line_content": "            elapsedStart(&replyTimer);",
          "new_line_content": "             * different modules with different triggers to consider if a key",
          "content_same": false
        },
        {
          "line": 511,
          "old_api": "moduleTryServeClientBlockedOnKey",
          "new_api": null,
          "old_text": "moduleTryServeClientBlockedOnKey(receiver, rl->key)",
          "new_text": null,
          "old_line_content": "            if (!moduleTryServeClientBlockedOnKey(receiver, rl->key)) continue;",
          "new_line_content": "             * is ready or not. This means we can't exit the loop but need",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 16,
      "total_additions": 44,
      "total_deletions": 44,
      "total_api_changes": 104
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 4,
        "api_related_lines": 104,
        "non_api_lines": 3,
        "non_api_line_numbers": [
          483,
          484,
          486
        ]
      }
    },
    "api_calls_before": 155,
    "api_calls_after": 155,
    "diff_info": {
      "added_lines": 4,
      "removed_lines": 0,
      "total_diff_lines": 16
    }
  }
}