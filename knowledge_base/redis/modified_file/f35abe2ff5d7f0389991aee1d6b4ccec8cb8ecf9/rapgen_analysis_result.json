{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/redis/modified_file/f35abe2ff5d7f0389991aee1d6b4ccec8cb8ecf9",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/redis/modified_file/f35abe2ff5d7f0389991aee1d6b4ccec8cb8ecf9/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/redis/modified_file/f35abe2ff5d7f0389991aee1d6b4ccec8cb8ecf9/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/redis/modified_file/f35abe2ff5d7f0389991aee1d6b4ccec8cb8ecf9/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 118,
          "old_api": "dictNext",
          "new_api": "setDeferredMultiBulkLength",
          "old_text": "dictNext(di)",
          "new_text": "setDeferredMultiBulkLength(c,replylen,samples)",
          "old_line_content": "    while((de = dictNext(di)) != NULL) {",
          "new_line_content": "    setDeferredMultiBulkLength(c,replylen,samples);",
          "content_same": false
        },
        {
          "line": 128,
          "old_api": "dictReleaseIterator",
          "new_api": "dictGetIterator",
          "old_text": "dictReleaseIterator(di)",
          "new_text": "dictGetIterator(server.latency_events)",
          "old_line_content": "    dictReleaseIterator(di);",
          "new_line_content": "    di = dictGetIterator(server.latency_events);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 129,
          "old_api": null,
          "new_api": "dictNext",
          "old_text": null,
          "new_text": "dictNext(di)",
          "old_line_content": "}",
          "new_line_content": "    while((de = dictNext(di)) != NULL) {",
          "content_same": false
        },
        {
          "line": 130,
          "old_api": null,
          "new_api": "dictGetKey",
          "old_text": null,
          "new_text": "dictGetKey(de)",
          "old_line_content": "",
          "new_line_content": "        char *event = dictGetKey(de);",
          "content_same": false
        },
        {
          "line": 131,
          "old_api": null,
          "new_api": "dictGetVal",
          "old_text": null,
          "new_text": "dictGetVal(de)",
          "old_line_content": "/* LATENCY command implementations.",
          "new_line_content": "        struct latencyTimeSeries *ts = dictGetVal(de);",
          "content_same": false
        },
        {
          "line": 134,
          "old_api": null,
          "new_api": "addReplyMultiBulkLen",
          "old_text": null,
          "new_text": "addReplyMultiBulkLen(c,3)",
          "old_line_content": " * LATENCY LATEST: return the latest latency for all the events classes.",
          "new_line_content": "        addReplyMultiBulkLen(c,3);",
          "content_same": false
        },
        {
          "line": 135,
          "old_api": null,
          "new_api": "addReplyBulkCString",
          "old_text": null,
          "new_text": "addReplyBulkCString(c,event)",
          "old_line_content": " * LATENCY DOCTOR: returns an human readable analysis of instance latency.",
          "new_line_content": "        addReplyBulkCString(c,event);",
          "content_same": false
        },
        {
          "line": 136,
          "old_api": null,
          "new_api": "addReplyLongLong",
          "old_text": null,
          "new_text": "addReplyLongLong(c,ts->samples[last].time)",
          "old_line_content": " * LATENCY GRAPH: provide an ASCII graph of the latency of the specified event.",
          "new_line_content": "        addReplyLongLong(c,ts->samples[last].time);",
          "content_same": false
        },
        {
          "line": 137,
          "old_api": null,
          "new_api": "addReplyLongLong",
          "old_text": null,
          "new_text": "addReplyLongLong(c,ts->samples[last].latency)",
          "old_line_content": " */",
          "new_line_content": "        addReplyLongLong(c,ts->samples[last].latency);",
          "content_same": false
        },
        {
          "line": 139,
          "old_api": null,
          "new_api": "dictReleaseIterator",
          "old_text": null,
          "new_text": "dictReleaseIterator(di)",
          "old_line_content": "    struct latencyTimeSeries *ts;",
          "new_line_content": "    dictReleaseIterator(di);",
          "content_same": false
        },
        {
          "line": 152,
          "old_api": null,
          "new_api": "strcasecmp",
          "old_text": null,
          "new_text": "strcasecmp(c->argv[1]->ptr,\"samples\")",
          "old_line_content": "    }",
          "new_line_content": "    if (!strcasecmp(c->argv[1]->ptr,\"samples\") && c->argc == 3) {",
          "content_same": false
        },
        {
          "line": 154,
          "old_api": null,
          "new_api": "dictFetchValue",
          "old_text": null,
          "new_text": "dictFetchValue(server.latency_events,c->argv[2]->ptr)",
          "old_line_content": "",
          "new_line_content": "        ts = dictFetchValue(server.latency_events,c->argv[2]->ptr);",
          "content_same": false
        },
        {
          "line": 156,
          "old_api": null,
          "new_api": "latencyCommandReplyWithSamples",
          "old_text": null,
          "new_text": "latencyCommandReplyWithSamples(c,ts)",
          "old_line_content": "    /* Common error when the user asks for an event we have no latency",
          "new_line_content": "        latencyCommandReplyWithSamples(c,ts);",
          "content_same": false
        },
        {
          "line": 157,
          "old_api": null,
          "new_api": "strcasecmp",
          "old_text": null,
          "new_text": "strcasecmp(c->argv[1]->ptr,\"latest\")",
          "old_line_content": "     * information about. */",
          "new_line_content": "    } else if (!strcasecmp(c->argv[1]->ptr,\"latest\") && c->argc == 2) {",
          "content_same": false
        },
        {
          "line": 159,
          "old_api": null,
          "new_api": "latencyCommandReplyWithLatestEvents",
          "old_text": null,
          "new_text": "latencyCommandReplyWithLatestEvents(c)",
          "old_line_content": "        \"No samples available for event '%s'\", c->argv[2]->ptr);",
          "new_line_content": "        latencyCommandReplyWithLatestEvents(c);",
          "content_same": false
        },
        {
          "line": 161,
          "old_api": null,
          "new_api": "addReply",
          "old_text": null,
          "new_text": "addReply(c,shared.syntaxerr)",
          "old_line_content": "",
          "new_line_content": "        addReply(c,shared.syntaxerr);",
          "content_same": false
        },
        {
          "line": 169,
          "old_api": null,
          "new_api": "addReplyErrorFormat",
          "old_text": null,
          "new_text": "addReplyErrorFormat(c,\n        \"No samples available for event '%s'\", c->argv[2]->ptr)",
          "old_line_content": "",
          "new_line_content": "    addReplyErrorFormat(c,",
          "content_same": false
        },
        {
          "line": 72,
          "old_api": null,
          "new_api": "time",
          "old_text": null,
          "new_text": "time(NULL)",
          "old_line_content": "",
          "new_line_content": "    time_t now = time(NULL);",
          "content_same": false
        },
        {
          "line": 77,
          "old_api": null,
          "new_api": "zmalloc",
          "old_text": null,
          "new_text": "zmalloc(sizeof(*ts))",
          "old_line_content": "        ts->max = 0;",
          "new_line_content": "        ts = zmalloc(sizeof(*ts));",
          "content_same": false
        },
        {
          "line": 80,
          "old_api": null,
          "new_api": "memset",
          "old_text": null,
          "new_text": "memset(ts->samples,0,sizeof(ts->samples))",
          "old_line_content": "    }",
          "new_line_content": "        memset(ts->samples,0,sizeof(ts->samples));",
          "content_same": false
        },
        {
          "line": 81,
          "old_api": null,
          "new_api": "zstrdup",
          "old_text": null,
          "new_text": "zstrdup(event)",
          "old_line_content": "",
          "new_line_content": "        dictAdd(server.latency_events,zstrdup(event),ts);",
          "content_same": false
        },
        {
          "line": 93,
          "old_api": null,
          "new_api": "time",
          "old_text": null,
          "new_text": "time(NULL)",
          "old_line_content": " * in memory for the specified time series. */",
          "new_line_content": "    ts->samples[ts->idx].time = time(NULL);",
          "content_same": false
        },
        {
          "line": 106,
          "old_api": null,
          "new_api": "addDeferredMultiBulkLength",
          "old_text": null,
          "new_text": "addDeferredMultiBulkLength(c)",
          "old_line_content": "    }",
          "new_line_content": "    void *replylen = addDeferredMultiBulkLength(c);",
          "content_same": false
        },
        {
          "line": 113,
          "old_api": null,
          "new_api": "addReplyMultiBulkLen",
          "old_text": null,
          "new_text": "addReplyMultiBulkLen(c,2)",
          "old_line_content": "    dictIterator *di;",
          "new_line_content": "        addReplyMultiBulkLen(c,2);",
          "content_same": false
        },
        {
          "line": 114,
          "old_api": null,
          "new_api": "addReplyLongLong",
          "old_text": null,
          "new_text": "addReplyLongLong(c,ts->samples[i].time)",
          "old_line_content": "    dictEntry *de;",
          "new_line_content": "        addReplyLongLong(c,ts->samples[i].time);",
          "content_same": false
        },
        {
          "line": 115,
          "old_api": null,
          "new_api": "addReplyLongLong",
          "old_text": null,
          "new_text": "addReplyLongLong(c,ts->samples[i].latency)",
          "old_line_content": "",
          "new_line_content": "        addReplyLongLong(c,ts->samples[i].latency);",
          "content_same": false
        },
        {
          "line": 127,
          "old_api": null,
          "new_api": "dictSize",
          "old_text": null,
          "new_text": "dictSize(server.latency_events)",
          "old_line_content": "    }",
          "new_line_content": "    addReplyMultiBulkLen(c,dictSize(server.latency_events));",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 141,
          "old_api": "strcasecmp",
          "new_api": null,
          "old_text": "strcasecmp(c->argv[1]->ptr,\"samples\")",
          "new_text": null,
          "old_line_content": "    if (!strcasecmp(c->argv[1]->ptr,\"samples\") && c->argc == 3) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 143,
          "old_api": "dictFetchValue",
          "new_api": null,
          "old_text": "dictFetchValue(server.latency_events,c->argv[2]->ptr)",
          "new_text": null,
          "old_line_content": "        ts = dictFetchValue(server.latency_events,c->argv[2]->ptr);",
          "new_line_content": " *",
          "content_same": false
        },
        {
          "line": 145,
          "old_api": "latencyCommandReplyWithSamples",
          "new_api": null,
          "old_text": "latencyCommandReplyWithSamples(c,ts)",
          "new_text": null,
          "old_line_content": "        latencyCommandReplyWithSamples(c,ts);",
          "new_line_content": " * LATENCY LATEST: return the latest latency for all the events classes.",
          "content_same": false
        },
        {
          "line": 146,
          "old_api": "strcasecmp",
          "new_api": null,
          "old_text": "strcasecmp(c->argv[1]->ptr,\"latest\")",
          "new_text": null,
          "old_line_content": "    } else if (!strcasecmp(c->argv[1]->ptr,\"latest\") && c->argc == 2) {",
          "new_line_content": " * LATENCY DOCTOR: returns an human readable analysis of instance latency.",
          "content_same": false
        },
        {
          "line": 148,
          "old_api": "latencyCommandReplyWithLatestEvents",
          "new_api": null,
          "old_text": "latencyCommandReplyWithLatestEvents(c)",
          "new_text": null,
          "old_line_content": "        latencyCommandReplyWithLatestEvents(c);",
          "new_line_content": " */",
          "content_same": false
        },
        {
          "line": 150,
          "old_api": "addReply",
          "new_api": null,
          "old_text": "addReply(c,shared.syntaxerr)",
          "new_text": null,
          "old_line_content": "        addReply(c,shared.syntaxerr);",
          "new_line_content": "    struct latencyTimeSeries *ts;",
          "content_same": false
        },
        {
          "line": 158,
          "old_api": "addReplyErrorFormat",
          "new_api": null,
          "old_text": "addReplyErrorFormat(c,\n        \"No samples available for event '%s'\", c->argv[2]->ptr)",
          "new_text": null,
          "old_line_content": "    addReplyErrorFormat(c,",
          "new_line_content": "        /* LATENCY LATEST */",
          "content_same": false
        },
        {
          "line": 75,
          "old_api": "zmalloc",
          "new_api": null,
          "old_text": "zmalloc(sizeof(*ts))",
          "new_text": null,
          "old_line_content": "        ts = zmalloc(sizeof(*ts));",
          "new_line_content": "    /* Create the time series if it does not exist. */",
          "content_same": false
        },
        {
          "line": 78,
          "old_api": "memset",
          "new_api": null,
          "old_text": "memset(ts->samples,0,sizeof(ts->samples))",
          "new_text": null,
          "old_line_content": "        memset(ts->samples,0,sizeof(ts->samples));",
          "new_line_content": "        ts->idx = 0;",
          "content_same": false
        },
        {
          "line": 79,
          "old_api": "zstrdup",
          "new_api": null,
          "old_text": "zstrdup(event)",
          "new_text": null,
          "old_line_content": "        dictAdd(server.latency_events,zstrdup(event),ts);",
          "new_line_content": "        ts->max = 0;",
          "content_same": false
        },
        {
          "line": 82,
          "old_api": "time",
          "new_api": null,
          "old_text": "time(NULL)",
          "new_text": null,
          "old_line_content": "    ts->samples[ts->idx].time = time(NULL);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 95,
          "old_api": "addDeferredMultiBulkLength",
          "new_api": null,
          "old_text": "addDeferredMultiBulkLength(c)",
          "new_text": null,
          "old_line_content": "    void *replylen = addDeferredMultiBulkLength(c);",
          "new_line_content": "    if (latency > ts->max) ts->max = latency;",
          "content_same": false
        },
        {
          "line": 102,
          "old_api": "addReplyMultiBulkLen",
          "new_api": null,
          "old_text": "addReplyMultiBulkLen(c,2)",
          "new_text": null,
          "old_line_content": "        addReplyMultiBulkLen(c,2);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 103,
          "old_api": "addReplyLongLong",
          "new_api": null,
          "old_text": "addReplyLongLong(c,ts->samples[i].time)",
          "new_text": null,
          "old_line_content": "        addReplyLongLong(c,ts->samples[i].time);",
          "new_line_content": "/* latencyCommand() helper to produce a time-delay reply for all the samples",
          "content_same": false
        },
        {
          "line": 104,
          "old_api": "addReplyLongLong",
          "new_api": null,
          "old_text": "addReplyLongLong(c,ts->samples[i].latency)",
          "new_text": null,
          "old_line_content": "        addReplyLongLong(c,ts->samples[i].latency);",
          "new_line_content": " * in memory for the specified time series. */",
          "content_same": false
        },
        {
          "line": 107,
          "old_api": "setDeferredMultiBulkLength",
          "new_api": null,
          "old_text": "setDeferredMultiBulkLength(c,replylen,samples)",
          "new_text": null,
          "old_line_content": "    setDeferredMultiBulkLength(c,replylen,samples);",
          "new_line_content": "    int samples = 0, j;",
          "content_same": false
        },
        {
          "line": 116,
          "old_api": "dictSize",
          "new_api": null,
          "old_text": "dictSize(server.latency_events)",
          "new_text": null,
          "old_line_content": "    addReplyMultiBulkLen(c,dictSize(server.latency_events));",
          "new_line_content": "        samples++;",
          "content_same": false
        },
        {
          "line": 117,
          "old_api": "dictGetIterator",
          "new_api": null,
          "old_text": "dictGetIterator(server.latency_events)",
          "new_text": null,
          "old_line_content": "    di = dictGetIterator(server.latency_events);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 119,
          "old_api": "dictGetKey",
          "new_api": null,
          "old_text": "dictGetKey(de)",
          "new_text": null,
          "old_line_content": "        char *event = dictGetKey(de);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 120,
          "old_api": "dictGetVal",
          "new_api": null,
          "old_text": "dictGetVal(de)",
          "new_text": null,
          "old_line_content": "        struct latencyTimeSeries *ts = dictGetVal(de);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 123,
          "old_api": "addReplyMultiBulkLen",
          "new_api": null,
          "old_text": "addReplyMultiBulkLen(c,3)",
          "new_text": null,
          "old_line_content": "        addReplyMultiBulkLen(c,3);",
          "new_line_content": "void latencyCommandReplyWithLatestEvents(redisClient *c) {",
          "content_same": false
        },
        {
          "line": 124,
          "old_api": "addReplyBulkCString",
          "new_api": null,
          "old_text": "addReplyBulkCString(c,event)",
          "new_text": null,
          "old_line_content": "        addReplyBulkCString(c,event);",
          "new_line_content": "    dictIterator *di;",
          "content_same": false
        },
        {
          "line": 125,
          "old_api": "addReplyLongLong",
          "new_api": null,
          "old_text": "addReplyLongLong(c,ts->samples[last].time)",
          "new_text": null,
          "old_line_content": "        addReplyLongLong(c,ts->samples[last].time);",
          "new_line_content": "    dictEntry *de;",
          "content_same": false
        },
        {
          "line": 126,
          "old_api": "addReplyLongLong",
          "new_api": null,
          "old_text": "addReplyLongLong(c,ts->samples[last].latency)",
          "new_text": null,
          "old_line_content": "        addReplyLongLong(c,ts->samples[last].latency);",
          "new_line_content": "",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 2,
      "total_additions": 25,
      "total_deletions": 24,
      "total_api_changes": 51
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 11,
        "api_related_lines": 51,
        "non_api_lines": 10,
        "non_api_line_numbers": [
          73,
          84,
          85,
          86,
          87,
          88,
          89,
          90,
          91,
          92
        ]
      }
    },
    "api_calls_before": 33,
    "api_calls_after": 34,
    "diff_info": {
      "added_lines": 11,
      "removed_lines": 0,
      "total_diff_lines": 30
    }
  }
}