{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/redis/modified_file/4a64286c363267acff39b1f2ec9d4b47640871c0",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/redis/modified_file/4a64286c363267acff39b1f2ec9d4b47640871c0/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/redis/modified_file/4a64286c363267acff39b1f2ec9d4b47640871c0/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/redis/modified_file/4a64286c363267acff39b1f2ec9d4b47640871c0/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 3182,
          "old_api": "clusterDelSlot",
          "new_api": "clusterDoBeforeSleep",
          "old_text": "clusterDelSlot(slot)",
          "new_text": "clusterDoBeforeSleep(CLUSTER_TODO_FSYNC_CONFIG)",
          "old_line_content": "            clusterDelSlot(slot);",
          "new_line_content": "                    clusterDoBeforeSleep(CLUSTER_TODO_FSYNC_CONFIG);",
          "content_same": false
        },
        {
          "line": 3189,
          "old_api": "addReply",
          "new_api": "addReplyError",
          "old_text": "addReply(c,shared.ok)",
          "new_text": "addReplyError(c,\"Invalid CLUSTER SETSLOT action or number of arguments\")",
          "old_line_content": "        addReply(c,shared.ok);",
          "new_line_content": "            addReplyError(c,\"Invalid CLUSTER SETSLOT action or number of arguments\");",
          "content_same": false
        },
        {
          "line": 3236,
          "old_api": "strcasecmp",
          "new_api": "sdsempty",
          "old_text": "strcasecmp(c->argv[1]->ptr,\"saveconfig\")",
          "new_text": "sdsempty()",
          "old_line_content": "    } else if (!strcasecmp(c->argv[1]->ptr,\"saveconfig\") && c->argc == 2) {",
          "new_line_content": "        addReplySds(c,sdscatprintf(sdsempty(),\"$%lu\\r\\n\",",
          "content_same": false
        },
        {
          "line": 3237,
          "old_api": "clusterSaveConfig",
          "new_api": "sdslen",
          "old_text": "clusterSaveConfig(1)",
          "new_text": "sdslen(info)",
          "old_line_content": "        int retval = clusterSaveConfig(1);",
          "new_line_content": "            (unsigned long)sdslen(info)));",
          "content_same": false
        },
        {
          "line": 3240,
          "old_api": "addReply",
          "new_api": "strcasecmp",
          "old_text": "addReply(c,shared.ok)",
          "new_text": "strcasecmp(c->argv[1]->ptr,\"saveconfig\")",
          "old_line_content": "            addReply(c,shared.ok);",
          "new_line_content": "    } else if (!strcasecmp(c->argv[1]->ptr,\"saveconfig\") && c->argc == 2) {",
          "content_same": false
        },
        {
          "line": 3244,
          "old_api": "strcasecmp",
          "new_api": "addReply",
          "old_text": "strcasecmp(c->argv[1]->ptr,\"keyslot\")",
          "new_text": "addReply(c,shared.ok)",
          "old_line_content": "    } else if (!strcasecmp(c->argv[1]->ptr,\"keyslot\") && c->argc == 3) {",
          "new_line_content": "            addReply(c,shared.ok);",
          "content_same": false
        },
        {
          "line": 3248,
          "old_api": "sdslen",
          "new_api": "strcasecmp",
          "old_text": "sdslen(key)",
          "new_text": "strcasecmp(c->argv[1]->ptr,\"keyslot\")",
          "old_line_content": "        addReplyLongLong(c,keyHashSlot(key,sdslen(key)));",
          "new_line_content": "    } else if (!strcasecmp(c->argv[1]->ptr,\"keyslot\") && c->argc == 3) {",
          "content_same": false
        },
        {
          "line": 3253,
          "old_api": "getLongLongFromObjectOrReply",
          "new_api": "strcasecmp",
          "old_text": "getLongLongFromObjectOrReply(c,c->argv[2],&slot,NULL)",
          "new_text": "strcasecmp(c->argv[1]->ptr,\"countkeysinslot\")",
          "old_line_content": "        if (getLongLongFromObjectOrReply(c,c->argv[2],&slot,NULL) != REDIS_OK)",
          "new_line_content": "    } else if (!strcasecmp(c->argv[1]->ptr,\"countkeysinslot\") && c->argc == 3) {",
          "content_same": false
        },
        {
          "line": 3260,
          "old_api": "strcasecmp",
          "new_api": "addReplyError",
          "old_text": "strcasecmp(c->argv[1]->ptr,\"getkeysinslot\")",
          "new_text": "addReplyError(c,\"Invalid slot\")",
          "old_line_content": "    } else if (!strcasecmp(c->argv[1]->ptr,\"getkeysinslot\") && c->argc == 4) {",
          "new_line_content": "            addReplyError(c,\"Invalid slot\");",
          "content_same": false
        },
        {
          "line": 3275,
          "old_api": "zmalloc",
          "new_api": "addReplyError",
          "old_text": "zmalloc(sizeof(robj*)*maxkeys)",
          "new_text": "addReplyError(c,\"Invalid slot or number of keys\")",
          "old_line_content": "        keys = zmalloc(sizeof(robj*)*maxkeys);",
          "new_line_content": "            addReplyError(c,\"Invalid slot or number of keys\");",
          "content_same": false
        },
        {
          "line": 3279,
          "old_api": "zfree",
          "new_api": "zmalloc",
          "old_text": "zfree(keys)",
          "new_text": "zmalloc(sizeof(robj*)*maxkeys)",
          "old_line_content": "        zfree(keys);",
          "new_line_content": "        keys = zmalloc(sizeof(robj*)*maxkeys);",
          "content_same": false
        },
        {
          "line": 3280,
          "old_api": "strcasecmp",
          "new_api": "getKeysInSlot",
          "old_text": "strcasecmp(c->argv[1]->ptr,\"forget\")",
          "new_text": "getKeysInSlot(slot, keys, maxkeys)",
          "old_line_content": "    } else if (!strcasecmp(c->argv[1]->ptr,\"forget\") && c->argc == 3) {",
          "new_line_content": "        numkeys = getKeysInSlot(slot, keys, maxkeys);",
          "content_same": false
        },
        {
          "line": 3282,
          "old_api": "clusterLookupNode",
          "new_api": "addReplyBulk",
          "old_text": "clusterLookupNode(c->argv[2]->ptr)",
          "new_text": "addReplyBulk(c,keys[j])",
          "old_line_content": "        clusterNode *n = clusterLookupNode(c->argv[2]->ptr);",
          "new_line_content": "        for (j = 0; j < numkeys; j++) addReplyBulk(c,keys[j]);",
          "content_same": false
        },
        {
          "line": 3294,
          "old_api": "clusterBlacklistAddNode",
          "new_api": "nodeIsSlave",
          "old_text": "clusterBlacklistAddNode(n)",
          "new_text": "nodeIsSlave(myself)",
          "old_line_content": "        clusterBlacklistAddNode(n);",
          "new_line_content": "        } else if (nodeIsSlave(myself) && myself->slaveof == n) {",
          "content_same": false
        },
        {
          "line": 3295,
          "old_api": "clusterDelNode",
          "new_api": "addReplyError",
          "old_text": "clusterDelNode(n)",
          "new_text": "addReplyError(c,\"Can't forget my master!\")",
          "old_line_content": "        clusterDelNode(n);",
          "new_line_content": "            addReplyError(c,\"Can't forget my master!\");",
          "content_same": false
        },
        {
          "line": 3298,
          "old_api": "strcasecmp",
          "new_api": "clusterBlacklistAddNode",
          "old_text": "strcasecmp(c->argv[1]->ptr,\"replicate\")",
          "new_text": "clusterBlacklistAddNode(n)",
          "old_line_content": "    } else if (!strcasecmp(c->argv[1]->ptr,\"replicate\") && c->argc == 3) {",
          "new_line_content": "        clusterBlacklistAddNode(n);",
          "content_same": false
        },
        {
          "line": 3300,
          "old_api": "clusterLookupNode",
          "new_api": "clusterDoBeforeSleep",
          "old_text": "clusterLookupNode(c->argv[2]->ptr)",
          "new_text": "clusterDoBeforeSleep(CLUSTER_TODO_UPDATE_STATE|CLUSTER_TODO_SAVE_CONFIG)",
          "old_line_content": "        clusterNode *n = clusterLookupNode(c->argv[2]->ptr);",
          "new_line_content": "        clusterDoBeforeSleep(CLUSTER_TODO_UPDATE_STATE|CLUSTER_TODO_SAVE_CONFIG);",
          "content_same": false
        },
        {
          "line": 3304,
          "old_api": "addReplyErrorFormat",
          "new_api": "clusterLookupNode",
          "old_text": "addReplyErrorFormat(c,\"Unknown node %s\", (char*)c->argv[2]->ptr)",
          "new_text": "clusterLookupNode(c->argv[2]->ptr)",
          "old_line_content": "            addReplyErrorFormat(c,\"Unknown node %s\", (char*)c->argv[2]->ptr);",
          "new_line_content": "        clusterNode *n = clusterLookupNode(c->argv[2]->ptr);",
          "content_same": false
        },
        {
          "line": 3335,
          "old_api": "clusterLookupNode",
          "new_api": "clusterDoBeforeSleep",
          "old_text": "clusterLookupNode(c->argv[2]->ptr)",
          "new_text": "clusterDoBeforeSleep(CLUSTER_TODO_UPDATE_STATE|CLUSTER_TODO_SAVE_CONFIG)",
          "old_line_content": "        clusterNode *n = clusterLookupNode(c->argv[2]->ptr);",
          "new_line_content": "        clusterDoBeforeSleep(CLUSTER_TODO_UPDATE_STATE|CLUSTER_TODO_SAVE_CONFIG);",
          "content_same": false
        },
        {
          "line": 3344,
          "old_api": "nodeIsSlave",
          "new_api": "addReplyErrorFormat",
          "old_text": "nodeIsSlave(n)",
          "new_text": "addReplyErrorFormat(c,\"Unknown node %s\", (char*)c->argv[2]->ptr)",
          "old_line_content": "        if (nodeIsSlave(n)) {",
          "new_line_content": "            addReplyErrorFormat(c,\"Unknown node %s\", (char*)c->argv[2]->ptr);",
          "content_same": false
        },
        {
          "line": 3349,
          "old_api": "addReplyMultiBulkLen",
          "new_api": "addReplyError",
          "old_text": "addReplyMultiBulkLen(c,n->numslaves)",
          "new_text": "addReplyError(c,\"The specified node is not a master\")",
          "old_line_content": "        addReplyMultiBulkLen(c,n->numslaves);",
          "new_line_content": "            addReplyError(c,\"The specified node is not a master\");",
          "content_same": false
        },
        {
          "line": 3353,
          "old_api": "sdsfree",
          "new_api": "addReplyMultiBulkLen",
          "old_text": "sdsfree(ni)",
          "new_text": "addReplyMultiBulkLen(c,n->numslaves)",
          "old_line_content": "            sdsfree(ni);",
          "new_line_content": "        addReplyMultiBulkLen(c,n->numslaves);",
          "content_same": false
        },
        {
          "line": 3355,
          "old_api": "strcasecmp",
          "new_api": "clusterGenNodeDescription",
          "old_text": "strcasecmp(c->argv[1]->ptr,\"failover\")",
          "new_text": "clusterGenNodeDescription(n->slaves[j])",
          "old_line_content": "    } else if (!strcasecmp(c->argv[1]->ptr,\"failover\") && c->argc == 2) {",
          "new_line_content": "            sds ni = clusterGenNodeDescription(n->slaves[j]);",
          "content_same": false
        },
        {
          "line": 3356,
          "old_api": "nodeIsMaster",
          "new_api": "addReplyBulkCString",
          "old_text": "nodeIsMaster(myself)",
          "new_text": "addReplyBulkCString(c,ni)",
          "old_line_content": "        if (nodeIsMaster(myself)) {",
          "new_line_content": "            addReplyBulkCString(c,ni);",
          "content_same": false
        },
        {
          "line": 3357,
          "old_api": "addReplyError",
          "new_api": "sdsfree",
          "old_text": "addReplyError(c,\"You should send CLUSTER FAILOVER to a slave\")",
          "new_text": "sdsfree(ni)",
          "old_line_content": "            addReplyError(c,\"You should send CLUSTER FAILOVER to a slave\");",
          "new_line_content": "            sdsfree(ni);",
          "content_same": false
        },
        {
          "line": 3359,
          "old_api": "nodeFailed",
          "new_api": "strcasecmp",
          "old_text": "nodeFailed(myself->slaveof)",
          "new_text": "strcasecmp(c->argv[1]->ptr,\"failover\")",
          "old_line_content": "        } else if (myself->slaveof == NULL || nodeFailed(myself->slaveof) ||",
          "new_line_content": "    } else if (!strcasecmp(c->argv[1]->ptr,\"failover\") && c->argc == 2) {",
          "content_same": false
        },
        {
          "line": 3366,
          "old_api": "resetManualFailover",
          "new_api": "addReplyError",
          "old_text": "resetManualFailover()",
          "new_text": "addReplyError(c,\"Master is down or failed, \"\n                            \"please use CLUSTER FAILOVER FORCE\")",
          "old_line_content": "        resetManualFailover();",
          "new_line_content": "            addReplyError(c,\"Master is down or failed, \"",
          "content_same": false
        },
        {
          "line": 3370,
          "old_api": "addReply",
          "new_api": "resetManualFailover",
          "old_text": "addReply(c,shared.ok)",
          "new_text": "resetManualFailover()",
          "old_line_content": "        addReply(c,shared.ok);",
          "new_line_content": "        resetManualFailover();",
          "content_same": false
        },
        {
          "line": 3372,
          "old_api": "addReplyError",
          "new_api": "clusterSendMFStart",
          "old_text": "addReplyError(c,\"Wrong CLUSTER subcommand or number of arguments\")",
          "new_text": "clusterSendMFStart(myself->slaveof)",
          "old_line_content": "        addReplyError(c,\"Wrong CLUSTER subcommand or number of arguments\");",
          "new_line_content": "        clusterSendMFStart(myself->slaveof);",
          "content_same": false
        },
        {
          "line": 3406,
          "old_api": "sdslen",
          "new_api": "sdscatlen",
          "old_text": "sdslen(payload->io.buffer.ptr)",
          "new_text": "sdscatlen(payload->io.buffer.ptr,buf,2)",
          "old_line_content": "                sdslen(payload->io.buffer.ptr));",
          "new_line_content": "    payload->io.buffer.ptr = sdscatlen(payload->io.buffer.ptr,buf,2);",
          "content_same": false
        },
        {
          "line": 3452,
          "old_api": "addReplyBulk",
          "new_api": "createDumpPayload",
          "old_text": "addReplyBulk(c,dumpobj)",
          "new_text": "createDumpPayload(&payload,o)",
          "old_line_content": "    addReplyBulk(c,dumpobj);",
          "new_line_content": "    createDumpPayload(&payload,o);",
          "content_same": false
        },
        {
          "line": 3495,
          "old_api": "rioInitWithBuffer",
          "new_api": "addReplyError",
          "old_text": "rioInitWithBuffer(&payload,c->argv[3]->ptr)",
          "new_text": "addReplyError(c,\"DUMP payload version or checksum are wrong\")",
          "old_line_content": "    rioInitWithBuffer(&payload,c->argv[3]->ptr);",
          "new_line_content": "        addReplyError(c,\"DUMP payload version or checksum are wrong\");",
          "content_same": false
        },
        {
          "line": 3499,
          "old_api": "addReplyError",
          "new_api": "rioInitWithBuffer",
          "old_text": "addReplyError(c,\"Bad data format\")",
          "new_text": "rioInitWithBuffer(&payload,c->argv[3]->ptr)",
          "old_line_content": "        addReplyError(c,\"Bad data format\");",
          "new_line_content": "    rioInitWithBuffer(&payload,c->argv[3]->ptr);",
          "content_same": false
        },
        {
          "line": 3508,
          "old_api": "mstime",
          "new_api": "dbDelete",
          "old_text": "mstime()",
          "new_text": "dbDelete(c->db,c->argv[1])",
          "old_line_content": "    if (ttl) setExpire(c->db,c->argv[1],mstime()+ttl);",
          "new_line_content": "    if (replace) dbDelete(c->db,c->argv[1]);",
          "content_same": false
        },
        {
          "line": 3545,
          "old_api": "sdslen",
          "new_api": "sdsempty",
          "old_text": "sdslen(host->ptr)",
          "new_text": "sdsempty()",
          "old_line_content": "    name = sdscatlen(name,host->ptr,sdslen(host->ptr));",
          "new_line_content": "    sds name = sdsempty();",
          "content_same": false
        },
        {
          "line": 3550,
          "old_api": "sdsfree",
          "new_api": "sdscatlen",
          "old_text": "sdsfree(name)",
          "new_text": "sdscatlen(name,\":\",1)",
          "old_line_content": "        sdsfree(name);",
          "new_line_content": "    name = sdscatlen(name,\":\",1);",
          "content_same": false
        },
        {
          "line": 3560,
          "old_api": "close",
          "new_api": "dictSize",
          "old_text": "close(cs->fd)",
          "new_text": "dictSize(server.migrate_cached_sockets)",
          "old_line_content": "        close(cs->fd);",
          "new_line_content": "    if (dictSize(server.migrate_cached_sockets) == MIGRATE_SOCKET_CACHE_ITEMS) {",
          "content_same": false
        },
        {
          "line": 3562,
          "old_api": "dictGetKey",
          "new_api": "dictGetRandomKey",
          "old_text": "dictGetKey(de)",
          "new_text": "dictGetRandomKey(server.migrate_cached_sockets)",
          "old_line_content": "        dictDelete(server.migrate_cached_sockets,dictGetKey(de));",
          "new_line_content": "        dictEntry *de = dictGetRandomKey(server.migrate_cached_sockets);",
          "content_same": false
        },
        {
          "line": 3566,
          "old_api": "anetTcpNonBlockConnect",
          "new_api": "dictGetKey",
          "old_text": "anetTcpNonBlockConnect(server.neterr,c->argv[1]->ptr,\n                atoi(c->argv[2]->ptr))",
          "new_text": "dictGetKey(de)",
          "old_line_content": "    fd = anetTcpNonBlockConnect(server.neterr,c->argv[1]->ptr,",
          "new_line_content": "        dictDelete(server.migrate_cached_sockets,dictGetKey(de));",
          "content_same": false
        },
        {
          "line": 3570,
          "old_api": "addReplyErrorFormat",
          "new_api": "anetTcpNonBlockConnect",
          "old_text": "addReplyErrorFormat(c,\"Can't connect to target node: %s\",\n            server.neterr)",
          "new_text": "anetTcpNonBlockConnect(server.neterr,c->argv[1]->ptr,\n                atoi(c->argv[2]->ptr))",
          "old_line_content": "        addReplyErrorFormat(c,\"Can't connect to target node: %s\",",
          "new_line_content": "    fd = anetTcpNonBlockConnect(server.neterr,c->argv[1]->ptr,",
          "content_same": false
        },
        {
          "line": 3574,
          "old_api": "anetEnableTcpNoDelay",
          "new_api": "addReplyErrorFormat",
          "old_text": "anetEnableTcpNoDelay(server.neterr,fd)",
          "new_text": "addReplyErrorFormat(c,\"Can't connect to target node: %s\",\n            server.neterr)",
          "old_line_content": "    anetEnableTcpNoDelay(server.neterr,fd);",
          "new_line_content": "        addReplyErrorFormat(c,\"Can't connect to target node: %s\",",
          "content_same": false
        },
        {
          "line": 3578,
          "old_api": "sdsfree",
          "new_api": "anetEnableTcpNoDelay",
          "old_text": "sdsfree(name)",
          "new_text": "anetEnableTcpNoDelay(server.neterr,fd)",
          "old_line_content": "        sdsfree(name);",
          "new_line_content": "    anetEnableTcpNoDelay(server.neterr,fd);",
          "content_same": false
        },
        {
          "line": 3598,
          "old_api": "sdscatlen",
          "new_api": "sdsempty",
          "old_text": "sdscatlen(name,\":\",1)",
          "new_text": "sdsempty()",
          "old_line_content": "    name = sdscatlen(name,\":\",1);",
          "new_line_content": "    sds name = sdsempty();",
          "content_same": false
        },
        {
          "line": 3602,
          "old_api": "sdsfree",
          "new_api": "sdscatlen",
          "old_text": "sdsfree(name)",
          "new_text": "sdscatlen(name,\":\",1)",
          "old_line_content": "        sdsfree(name);",
          "new_line_content": "    name = sdscatlen(name,\":\",1);",
          "content_same": false
        },
        {
          "line": 3606,
          "old_api": "close",
          "new_api": "sdsfree",
          "old_text": "close(cs->fd)",
          "new_text": "sdsfree(name)",
          "old_line_content": "    close(cs->fd);",
          "new_line_content": "        sdsfree(name);",
          "content_same": false
        },
        {
          "line": 3613,
          "old_api": "dictGetSafeIterator",
          "new_api": "sdsfree",
          "old_text": "dictGetSafeIterator(server.migrate_cached_sockets)",
          "new_text": "sdsfree(name)",
          "old_line_content": "    dictIterator *di = dictGetSafeIterator(server.migrate_cached_sockets);",
          "new_line_content": "    sdsfree(name);",
          "content_same": false
        },
        {
          "line": 3617,
          "old_api": "dictGetVal",
          "new_api": "dictGetSafeIterator",
          "old_text": "dictGetVal(de)",
          "new_text": "dictGetSafeIterator(server.migrate_cached_sockets)",
          "old_line_content": "        migrateCachedSocket *cs = dictGetVal(de);",
          "new_line_content": "    dictIterator *di = dictGetSafeIterator(server.migrate_cached_sockets);",
          "content_same": false
        },
        {
          "line": 3620,
          "old_api": "close",
          "new_api": "dictNext",
          "old_text": "close(cs->fd)",
          "new_text": "dictNext(di)",
          "old_line_content": "            close(cs->fd);",
          "new_line_content": "    while((de = dictNext(di)) != NULL) {",
          "content_same": false
        },
        {
          "line": 3621,
          "old_api": "zfree",
          "new_api": "dictGetVal",
          "old_text": "zfree(cs)",
          "new_text": "dictGetVal(de)",
          "old_line_content": "            zfree(cs);",
          "new_line_content": "        migrateCachedSocket *cs = dictGetVal(de);",
          "content_same": false
        },
        {
          "line": 3625,
          "old_api": "dictReleaseIterator",
          "new_api": "zfree",
          "old_text": "dictReleaseIterator(di)",
          "new_text": "zfree(cs)",
          "old_line_content": "    dictReleaseIterator(di);",
          "new_line_content": "            zfree(cs);",
          "content_same": false
        },
        {
          "line": 3676,
          "old_api": "sdsempty",
          "new_api": "migrateGetSocket",
          "old_text": "sdsempty()",
          "new_text": "migrateGetSocket(c,c->argv[1],c->argv[2],timeout)",
          "old_line_content": "    rioInitWithBuffer(&cmd,sdsempty());",
          "new_line_content": "    fd = migrateGetSocket(c,c->argv[1],c->argv[2],timeout);",
          "content_same": false
        },
        {
          "line": 3681,
          "old_api": "getExpire",
          "new_api": "rioWriteBulkCount",
          "old_text": "getExpire(c->db,c->argv[3])",
          "new_text": "rioWriteBulkCount(&cmd,'*',2)",
          "old_line_content": "    expireat = getExpire(c->db,c->argv[3]);",
          "new_line_content": "    redisAssertWithInfo(c,NULL,rioWriteBulkCount(&cmd,'*',2));",
          "content_same": false
        },
        {
          "line": 3683,
          "old_api": "mstime",
          "new_api": "rioWriteBulkLongLong",
          "old_text": "mstime()",
          "new_text": "rioWriteBulkLongLong(&cmd,dbid)",
          "old_line_content": "        ttl = expireat-mstime();",
          "new_line_content": "    redisAssertWithInfo(c,NULL,rioWriteBulkLongLong(&cmd,dbid));",
          "content_same": false
        },
        {
          "line": 3692,
          "old_api": "sdsEncodedObject",
          "new_api": "redisAssertWithInfo",
          "old_text": "sdsEncodedObject(c->argv[3])",
          "new_text": "redisAssertWithInfo(c,NULL,\n            rioWriteBulkString(&cmd,\"RESTORE-ASKING\",14))",
          "old_line_content": "    redisAssertWithInfo(c,NULL,sdsEncodedObject(c->argv[3]));",
          "new_line_content": "        redisAssertWithInfo(c,NULL,",
          "content_same": false
        },
        {
          "line": 3693,
          "old_api": "sdslen",
          "new_api": "rioWriteBulkString",
          "old_text": "sdslen(c->argv[3]->ptr)",
          "new_text": "rioWriteBulkString(&cmd,\"RESTORE-ASKING\",14)",
          "old_line_content": "    redisAssertWithInfo(c,NULL,rioWriteBulkString(&cmd,c->argv[3]->ptr,sdslen(c->argv[3]->ptr)));",
          "new_line_content": "            rioWriteBulkString(&cmd,\"RESTORE-ASKING\",14));",
          "content_same": false
        },
        {
          "line": 3698,
          "old_api": "createDumpPayload",
          "new_api": "rioWriteBulkLongLong",
          "old_text": "createDumpPayload(&payload,o)",
          "new_text": "rioWriteBulkLongLong(&cmd,ttl)",
          "old_line_content": "    createDumpPayload(&payload,o);",
          "new_line_content": "    redisAssertWithInfo(c,NULL,rioWriteBulkLongLong(&cmd,ttl));",
          "content_same": false
        },
        {
          "line": 3748,
          "old_api": "createStringObject",
          "new_api": "addReply",
          "old_text": "createStringObject(\"DEL\",3)",
          "new_text": "addReply(c,shared.ok)",
          "old_line_content": "            aux = createStringObject(\"DEL\",3);",
          "new_line_content": "            addReply(c,shared.ok);",
          "content_same": false
        },
        {
          "line": 3754,
          "old_api": "sdsfree",
          "new_api": "decrRefCount",
          "old_text": "sdsfree(cmd.io.buffer.ptr)",
          "new_text": "decrRefCount(aux)",
          "old_line_content": "    sdsfree(cmd.io.buffer.ptr);",
          "new_line_content": "            decrRefCount(aux);",
          "content_same": false
        },
        {
          "line": 3762,
          "old_api": "sdsnew",
          "new_api": "sdsfree",
          "old_text": "sdsnew(\"-IOERR error or timeout writing to target instance\\r\\n\")",
          "new_text": "sdsfree(cmd.io.buffer.ptr)",
          "old_line_content": "        sdsnew(\"-IOERR error or timeout writing to target instance\\r\\n\"));",
          "new_line_content": "    sdsfree(cmd.io.buffer.ptr);",
          "content_same": false
        },
        {
          "line": 3766,
          "old_api": "sdsfree",
          "new_api": "sdsnew",
          "old_text": "sdsfree(cmd.io.buffer.ptr)",
          "new_text": "sdsnew(\"-IOERR error or timeout writing to target instance\\r\\n\")",
          "old_line_content": "    sdsfree(cmd.io.buffer.ptr);",
          "new_line_content": "        sdsnew(\"-IOERR error or timeout writing to target instance\\r\\n\"));",
          "content_same": false
        },
        {
          "line": 3770,
          "old_api": "sdsnew",
          "new_api": "sdsfree",
          "old_text": "sdsnew(\"-IOERR error or timeout reading from target node\\r\\n\")",
          "new_text": "sdsfree(cmd.io.buffer.ptr)",
          "old_line_content": "        sdsnew(\"-IOERR error or timeout reading from target node\\r\\n\"));",
          "new_line_content": "    sdsfree(cmd.io.buffer.ptr);",
          "content_same": false
        },
        {
          "line": 3788,
          "old_api": "addReply",
          "new_api": "addReplyError",
          "old_text": "addReply(c,shared.ok)",
          "new_text": "addReplyError(c,\"This instance has cluster support disabled\")",
          "old_line_content": "    addReply(c,shared.ok);",
          "new_line_content": "        addReplyError(c,\"This instance has cluster support disabled\");",
          "content_same": false
        },
        {
          "line": 3800,
          "old_api": "addReply",
          "new_api": "addReplyError",
          "old_text": "addReply(c,shared.ok)",
          "new_text": "addReplyError(c,\"This instance has cluster support disabled\")",
          "old_line_content": "    addReply(c,shared.ok);",
          "new_line_content": "        addReplyError(c,\"This instance has cluster support disabled\");",
          "content_same": false
        },
        {
          "line": 3870,
          "old_api": "equalStringObjects",
          "new_api": "redisAssertWithInfo",
          "old_text": "equalStringObjects(firstkey,margv[keyindex[j]])",
          "new_text": "redisAssertWithInfo(c,firstkey,n != NULL)",
          "old_line_content": "                if (!equalStringObjects(firstkey,margv[keyindex[j]])) {",
          "new_line_content": "                redisAssertWithInfo(c,firstkey,n != NULL);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 3584,
          "old_api": null,
          "new_api": "close",
          "old_text": null,
          "new_text": "close(fd)",
          "old_line_content": "    /* Add to the cache and return it to the caller. */",
          "new_line_content": "        close(fd);",
          "content_same": false
        },
        {
          "line": 3589,
          "old_api": null,
          "new_api": "zmalloc",
          "old_text": null,
          "new_text": "zmalloc(sizeof(*cs))",
          "old_line_content": "    return fd;",
          "new_line_content": "    cs = zmalloc(sizeof(*cs));",
          "content_same": false
        },
        {
          "line": 3592,
          "old_api": null,
          "new_api": "dictAdd",
          "old_text": null,
          "new_text": "dictAdd(server.migrate_cached_sockets,name,cs)",
          "old_line_content": "/* Free a migrate cached connection. */",
          "new_line_content": "    dictAdd(server.migrate_cached_sockets,name,cs);",
          "content_same": false
        },
        {
          "line": 3601,
          "old_api": null,
          "new_api": "sdslen",
          "old_text": null,
          "new_text": "sdslen(host->ptr)",
          "old_line_content": "    if (!cs) {",
          "new_line_content": "    name = sdscatlen(name,host->ptr,sdslen(host->ptr));",
          "content_same": false
        },
        {
          "line": 3603,
          "old_api": null,
          "new_api": "sdslen",
          "old_text": null,
          "new_text": "sdslen(port->ptr)",
          "old_line_content": "        return;",
          "new_line_content": "    name = sdscatlen(name,port->ptr,sdslen(port->ptr));",
          "content_same": false
        },
        {
          "line": 3604,
          "old_api": null,
          "new_api": "dictFetchValue",
          "old_text": null,
          "new_text": "dictFetchValue(server.migrate_cached_sockets,name)",
          "old_line_content": "    }",
          "new_line_content": "    cs = dictFetchValue(server.migrate_cached_sockets,name);",
          "content_same": false
        },
        {
          "line": 3610,
          "old_api": null,
          "new_api": "close",
          "old_text": null,
          "new_text": "close(cs->fd)",
          "old_line_content": "}",
          "new_line_content": "    close(cs->fd);",
          "content_same": false
        },
        {
          "line": 3611,
          "old_api": null,
          "new_api": "zfree",
          "old_text": null,
          "new_text": "zfree(cs)",
          "old_line_content": "",
          "new_line_content": "    zfree(cs);",
          "content_same": false
        },
        {
          "line": 3612,
          "old_api": null,
          "new_api": "dictDelete",
          "old_text": null,
          "new_text": "dictDelete(server.migrate_cached_sockets,name)",
          "old_line_content": "void migrateCloseTimedoutSockets(void) {",
          "new_line_content": "    dictDelete(server.migrate_cached_sockets,name);",
          "content_same": false
        },
        {
          "line": 3624,
          "old_api": null,
          "new_api": "close",
          "old_text": null,
          "new_text": "close(cs->fd)",
          "old_line_content": "    }",
          "new_line_content": "            close(cs->fd);",
          "content_same": false
        },
        {
          "line": 3626,
          "old_api": null,
          "new_api": "dictGetKey",
          "old_text": null,
          "new_text": "dictGetKey(de)",
          "old_line_content": "}",
          "new_line_content": "            dictDelete(server.migrate_cached_sockets,dictGetKey(de));",
          "content_same": false
        },
        {
          "line": 3629,
          "old_api": null,
          "new_api": "dictReleaseIterator",
          "old_text": null,
          "new_text": "dictReleaseIterator(di)",
          "old_line_content": "void migrateCommand(redisClient *c) {",
          "new_line_content": "    dictReleaseIterator(di);",
          "content_same": false
        },
        {
          "line": 3650,
          "old_api": null,
          "new_api": "strcasecmp",
          "old_text": null,
          "new_text": "strcasecmp(c->argv[j]->ptr,\"copy\")",
          "old_line_content": "        } else {",
          "new_line_content": "        if (!strcasecmp(c->argv[j]->ptr,\"copy\")) {",
          "content_same": false
        },
        {
          "line": 3652,
          "old_api": null,
          "new_api": "strcasecmp",
          "old_text": null,
          "new_text": "strcasecmp(c->argv[j]->ptr,\"replace\")",
          "old_line_content": "            return;",
          "new_line_content": "        } else if (!strcasecmp(c->argv[j]->ptr,\"replace\")) {",
          "content_same": false
        },
        {
          "line": 3655,
          "old_api": null,
          "new_api": "addReply",
          "old_text": null,
          "new_text": "addReply(c,shared.syntaxerr)",
          "old_line_content": "",
          "new_line_content": "            addReply(c,shared.syntaxerr);",
          "content_same": false
        },
        {
          "line": 3661,
          "old_api": null,
          "new_api": "getLongFromObjectOrReply",
          "old_text": null,
          "new_text": "getLongFromObjectOrReply(c,c->argv[5],&timeout,NULL)",
          "old_line_content": "    if (timeout <= 0) timeout = 1000;",
          "new_line_content": "    if (getLongFromObjectOrReply(c,c->argv[5],&timeout,NULL) != REDIS_OK)",
          "content_same": false
        },
        {
          "line": 3663,
          "old_api": null,
          "new_api": "getLongFromObjectOrReply",
          "old_text": null,
          "new_text": "getLongFromObjectOrReply(c,c->argv[4],&dbid,NULL)",
          "old_line_content": "    /* Check if the key is here. If not we reply with success as there is",
          "new_line_content": "    if (getLongFromObjectOrReply(c,c->argv[4],&dbid,NULL) != REDIS_OK)",
          "content_same": false
        },
        {
          "line": 3670,
          "old_api": null,
          "new_api": "lookupKeyRead",
          "old_text": null,
          "new_text": "lookupKeyRead(c->db,c->argv[3])",
          "old_line_content": "    ",
          "new_line_content": "    if ((o = lookupKeyRead(c->db,c->argv[3])) == NULL) {",
          "content_same": false
        },
        {
          "line": 3671,
          "old_api": null,
          "new_api": "sdsnew",
          "old_text": null,
          "new_text": "sdsnew(\"+NOKEY\\r\\n\")",
          "old_line_content": "    /* Connect */",
          "new_line_content": "        addReplySds(c,sdsnew(\"+NOKEY\\r\\n\"));",
          "content_same": false
        },
        {
          "line": 3680,
          "old_api": null,
          "new_api": "sdsempty",
          "old_text": null,
          "new_text": "sdsempty()",
          "old_line_content": "",
          "new_line_content": "    rioInitWithBuffer(&cmd,sdsempty());",
          "content_same": false
        },
        {
          "line": 3682,
          "old_api": null,
          "new_api": "rioWriteBulkString",
          "old_text": null,
          "new_text": "rioWriteBulkString(&cmd,\"SELECT\",6)",
          "old_line_content": "    if (expireat != -1) {",
          "new_line_content": "    redisAssertWithInfo(c,NULL,rioWriteBulkString(&cmd,\"SELECT\",6));",
          "content_same": false
        },
        {
          "line": 3685,
          "old_api": null,
          "new_api": "getExpire",
          "old_text": null,
          "new_text": "getExpire(c->db,c->argv[3])",
          "old_line_content": "    }",
          "new_line_content": "    expireat = getExpire(c->db,c->argv[3]);",
          "content_same": false
        },
        {
          "line": 3687,
          "old_api": null,
          "new_api": "mstime",
          "old_text": null,
          "new_text": "mstime()",
          "old_line_content": "    if (server.cluster_enabled)",
          "new_line_content": "        ttl = expireat-mstime();",
          "content_same": false
        },
        {
          "line": 3177,
          "old_api": null,
          "new_api": "clusterGetMaxEpoch",
          "old_text": null,
          "new_text": "clusterGetMaxEpoch()",
          "old_line_content": "                server.cluster->currentEpoch++;",
          "new_line_content": "                uint64_t maxEpoch = clusterGetMaxEpoch();",
          "content_same": false
        },
        {
          "line": 3690,
          "old_api": null,
          "new_api": "rioWriteBulkCount",
          "old_text": null,
          "new_text": "rioWriteBulkCount(&cmd,'*',replace ? 5 : 4)",
          "old_line_content": "    else",
          "new_line_content": "    redisAssertWithInfo(c,NULL,rioWriteBulkCount(&cmd,'*',replace ? 5 : 4));",
          "content_same": false
        },
        {
          "line": 3695,
          "old_api": null,
          "new_api": "rioWriteBulkString",
          "old_text": null,
          "new_text": "rioWriteBulkString(&cmd,\"RESTORE\",7)",
          "old_line_content": "",
          "new_line_content": "        redisAssertWithInfo(c,NULL,rioWriteBulkString(&cmd,\"RESTORE\",7));",
          "content_same": false
        },
        {
          "line": 3696,
          "old_api": null,
          "new_api": "sdsEncodedObject",
          "old_text": null,
          "new_text": "sdsEncodedObject(c->argv[3])",
          "old_line_content": "    /* Emit the payload argument, that is the serialized object using",
          "new_line_content": "    redisAssertWithInfo(c,NULL,sdsEncodedObject(c->argv[3]));",
          "content_same": false
        },
        {
          "line": 3697,
          "old_api": null,
          "new_api": "sdslen",
          "old_text": null,
          "new_text": "sdslen(c->argv[3]->ptr)",
          "old_line_content": "     * the DUMP format. */",
          "new_line_content": "    redisAssertWithInfo(c,NULL,rioWriteBulkString(&cmd,c->argv[3]->ptr,sdslen(c->argv[3]->ptr)));",
          "content_same": false
        },
        {
          "line": 3186,
          "old_api": null,
          "new_api": "clusterDelSlot",
          "old_text": null,
          "new_text": "clusterDelSlot(slot)",
          "old_line_content": "            return;",
          "new_line_content": "            clusterDelSlot(slot);",
          "content_same": false
        },
        {
          "line": 3187,
          "old_api": null,
          "new_api": "clusterAddSlot",
          "old_text": null,
          "new_text": "clusterAddSlot(n,slot)",
          "old_line_content": "        }",
          "new_line_content": "            clusterAddSlot(n,slot);",
          "content_same": false
        },
        {
          "line": 3702,
          "old_api": null,
          "new_api": "createDumpPayload",
          "old_text": null,
          "new_text": "createDumpPayload(&payload,o)",
          "old_line_content": "",
          "new_line_content": "    createDumpPayload(&payload,o);",
          "content_same": false
        },
        {
          "line": 3703,
          "old_api": null,
          "new_api": "rioWriteBulkString",
          "old_text": null,
          "new_text": "rioWriteBulkString(&cmd,payload.io.buffer.ptr,\n                                sdslen(payload.io.buffer.ptr))",
          "old_line_content": "    /* Add the REPLACE option to the RESTORE command if it was specified",
          "new_line_content": "    redisAssertWithInfo(c,NULL,rioWriteBulkString(&cmd,payload.io.buffer.ptr,",
          "content_same": false
        },
        {
          "line": 3192,
          "old_api": null,
          "new_api": "clusterDoBeforeSleep",
          "old_text": null,
          "new_text": "clusterDoBeforeSleep(CLUSTER_TODO_SAVE_CONFIG|CLUSTER_TODO_UPDATE_STATE)",
          "old_line_content": "        char *statestr[] = {\"ok\",\"fail\",\"needhelp\"};",
          "new_line_content": "        clusterDoBeforeSleep(CLUSTER_TODO_SAVE_CONFIG|CLUSTER_TODO_UPDATE_STATE);",
          "content_same": false
        },
        {
          "line": 3193,
          "old_api": null,
          "new_api": "addReply",
          "old_text": null,
          "new_text": "addReply(c,shared.ok)",
          "old_line_content": "        int slots_assigned = 0, slots_ok = 0, slots_pfail = 0, slots_fail = 0;",
          "new_line_content": "        addReply(c,shared.ok);",
          "content_same": false
        },
        {
          "line": 3194,
          "old_api": null,
          "new_api": "strcasecmp",
          "old_text": null,
          "new_text": "strcasecmp(c->argv[1]->ptr,\"info\")",
          "old_line_content": "        int j;",
          "new_line_content": "    } else if (!strcasecmp(c->argv[1]->ptr,\"info\") && c->argc == 2) {",
          "content_same": false
        },
        {
          "line": 3704,
          "old_api": null,
          "new_api": "sdslen",
          "old_text": null,
          "new_text": "sdslen(payload.io.buffer.ptr)",
          "old_line_content": "     * as a MIGRATE option. */",
          "new_line_content": "                                sdslen(payload.io.buffer.ptr)));",
          "content_same": false
        },
        {
          "line": 3705,
          "old_api": null,
          "new_api": "sdsfree",
          "old_text": null,
          "new_text": "sdsfree(payload.io.buffer.ptr)",
          "old_line_content": "    if (replace)",
          "new_line_content": "    sdsfree(payload.io.buffer.ptr);",
          "content_same": false
        },
        {
          "line": 3710,
          "old_api": null,
          "new_api": "rioWriteBulkString",
          "old_text": null,
          "new_text": "rioWriteBulkString(&cmd,\"REPLACE\",7)",
          "old_line_content": "    {",
          "new_line_content": "        redisAssertWithInfo(c,NULL,rioWriteBulkString(&cmd,\"REPLACE\",7));",
          "content_same": false
        },
        {
          "line": 3205,
          "old_api": null,
          "new_api": "nodeFailed",
          "old_text": null,
          "new_text": "nodeFailed(n)",
          "old_line_content": "            } else {",
          "new_line_content": "            if (nodeFailed(n)) {",
          "content_same": false
        },
        {
          "line": 3207,
          "old_api": null,
          "new_api": "nodeTimedOut",
          "old_text": null,
          "new_text": "nodeTimedOut(n)",
          "old_line_content": "            }",
          "new_line_content": "            } else if (nodeTimedOut(n)) {",
          "content_same": false
        },
        {
          "line": 3719,
          "old_api": null,
          "new_api": "sdslen",
          "old_text": null,
          "new_text": "sdslen(buf)",
          "old_line_content": "            pos += nwritten;",
          "new_line_content": "        while ((towrite = sdslen(buf)-pos) > 0) {",
          "content_same": false
        },
        {
          "line": 3721,
          "old_api": null,
          "new_api": "syncWrite",
          "old_text": null,
          "new_text": "syncWrite(fd,buf+pos,towrite,timeout)",
          "old_line_content": "    }",
          "new_line_content": "            nwritten = syncWrite(fd,buf+pos,towrite,timeout);",
          "content_same": false
        },
        {
          "line": 3214,
          "old_api": null,
          "new_api": "sdsempty",
          "old_text": null,
          "new_text": "sdsempty()",
          "old_line_content": "            \"cluster_slots_pfail:%d\\r\\n\"",
          "new_line_content": "        sds info = sdscatprintf(sdsempty(),",
          "content_same": false
        },
        {
          "line": 3733,
          "old_api": null,
          "new_api": "syncReadLine",
          "old_text": null,
          "new_text": "syncReadLine(fd, buf1, sizeof(buf1), timeout)",
          "old_line_content": "        if (buf1[0] == '-' || buf2[0] == '-') {",
          "new_line_content": "        if (syncReadLine(fd, buf1, sizeof(buf1), timeout) <= 0)",
          "content_same": false
        },
        {
          "line": 3735,
          "old_api": null,
          "new_api": "syncReadLine",
          "old_text": null,
          "new_text": "syncReadLine(fd, buf2, sizeof(buf2), timeout)",
          "old_line_content": "                (buf1[0] == '-') ? buf1+1 : buf2+1);",
          "new_line_content": "        if (syncReadLine(fd, buf2, sizeof(buf2), timeout) <= 0)",
          "content_same": false
        },
        {
          "line": 3738,
          "old_api": null,
          "new_api": "addReplyErrorFormat",
          "old_text": null,
          "new_text": "addReplyErrorFormat(c,\"Target instance replied with error: %s\",\n                (buf1[0] == '-') ? buf1+1 : buf2+1)",
          "old_line_content": "",
          "new_line_content": "            addReplyErrorFormat(c,\"Target instance replied with error: %s\",",
          "content_same": false
        },
        {
          "line": 3230,
          "old_api": null,
          "new_api": "dictSize",
          "old_text": null,
          "new_text": "dictSize(server.cluster->nodes)",
          "old_line_content": "            server.cluster->stats_bus_messages_received",
          "new_line_content": "            dictSize(server.cluster->nodes),",
          "content_same": false
        },
        {
          "line": 3745,
          "old_api": null,
          "new_api": "dbDelete",
          "old_text": null,
          "new_text": "dbDelete(c->db,c->argv[3])",
          "old_line_content": "            server.dirty++;",
          "new_line_content": "                dbDelete(c->db,c->argv[3]);",
          "content_same": false
        },
        {
          "line": 3746,
          "old_api": null,
          "new_api": "signalModifiedKey",
          "old_text": null,
          "new_text": "signalModifiedKey(c->db,c->argv[3])",
          "old_line_content": "",
          "new_line_content": "                signalModifiedKey(c->db,c->argv[3]);",
          "content_same": false
        },
        {
          "line": 3238,
          "old_api": null,
          "new_api": "addReplySds",
          "old_text": null,
          "new_text": "addReplySds(c,info)",
          "old_line_content": "",
          "new_line_content": "        addReplySds(c,info);",
          "content_same": false
        },
        {
          "line": 3239,
          "old_api": null,
          "new_api": "addReply",
          "old_text": null,
          "new_text": "addReply(c,shared.crlf)",
          "old_line_content": "        if (retval == 0)",
          "new_line_content": "        addReply(c,shared.crlf);",
          "content_same": false
        },
        {
          "line": 3752,
          "old_api": null,
          "new_api": "createStringObject",
          "old_text": null,
          "new_text": "createStringObject(\"DEL\",3)",
          "old_line_content": "    }",
          "new_line_content": "            aux = createStringObject(\"DEL\",3);",
          "content_same": false
        },
        {
          "line": 3241,
          "old_api": null,
          "new_api": "clusterSaveConfig",
          "old_text": null,
          "new_text": "clusterSaveConfig(1)",
          "old_line_content": "        else",
          "new_line_content": "        int retval = clusterSaveConfig(1);",
          "content_same": false
        },
        {
          "line": 3753,
          "old_api": null,
          "new_api": "rewriteClientCommandVector",
          "old_text": null,
          "new_text": "rewriteClientCommandVector(c,2,aux,c->argv[3])",
          "old_line_content": "",
          "new_line_content": "            rewriteClientCommandVector(c,2,aux,c->argv[3]);",
          "content_same": false
        },
        {
          "line": 3246,
          "old_api": null,
          "new_api": "addReplyErrorFormat",
          "old_text": null,
          "new_text": "addReplyErrorFormat(c,\"error saving the cluster node config: %s\",\n                strerror(errno))",
          "old_line_content": "        sds key = c->argv[2]->ptr;",
          "new_line_content": "            addReplyErrorFormat(c,\"error saving the cluster node config: %s\",",
          "content_same": false
        },
        {
          "line": 3247,
          "old_api": null,
          "new_api": "strerror",
          "old_text": null,
          "new_text": "strerror(errno)",
          "old_line_content": "",
          "new_line_content": "                strerror(errno));",
          "content_same": false
        },
        {
          "line": 3763,
          "old_api": null,
          "new_api": "migrateCloseSocket",
          "old_text": null,
          "new_text": "migrateCloseSocket(c->argv[1],c->argv[2])",
          "old_line_content": "    return;",
          "new_line_content": "    migrateCloseSocket(c->argv[1],c->argv[2]);",
          "content_same": false
        },
        {
          "line": 3252,
          "old_api": null,
          "new_api": "sdslen",
          "old_text": null,
          "new_text": "sdslen(key)",
          "old_line_content": "",
          "new_line_content": "        addReplyLongLong(c,keyHashSlot(key,sdslen(key)));",
          "content_same": false
        },
        {
          "line": 3765,
          "old_api": null,
          "new_api": "addReplySds",
          "old_text": null,
          "new_text": "addReplySds(c,\n        sdsnew(\"-IOERR error or timeout writing to target instance\\r\\n\"))",
          "old_line_content": "socket_rd_err:",
          "new_line_content": "    addReplySds(c,",
          "content_same": false
        },
        {
          "line": 3257,
          "old_api": null,
          "new_api": "getLongLongFromObjectOrReply",
          "old_text": null,
          "new_text": "getLongLongFromObjectOrReply(c,c->argv[2],&slot,NULL)",
          "old_line_content": "            return;",
          "new_line_content": "        if (getLongLongFromObjectOrReply(c,c->argv[2],&slot,NULL) != REDIS_OK)",
          "content_same": false
        },
        {
          "line": 3771,
          "old_api": null,
          "new_api": "migrateCloseSocket",
          "old_text": null,
          "new_text": "migrateCloseSocket(c->argv[1],c->argv[2])",
          "old_line_content": "    return;",
          "new_line_content": "    migrateCloseSocket(c->argv[1],c->argv[2]);",
          "content_same": false
        },
        {
          "line": 3773,
          "old_api": null,
          "new_api": "addReplySds",
          "old_text": null,
          "new_text": "addReplySds(c,\n        sdsnew(\"-IOERR error or timeout reading from target node\\r\\n\"))",
          "old_line_content": "",
          "new_line_content": "    addReplySds(c,",
          "content_same": false
        },
        {
          "line": 3774,
          "old_api": null,
          "new_api": "sdsnew",
          "old_text": null,
          "new_text": "sdsnew(\"-IOERR error or timeout reading from target node\\r\\n\")",
          "old_line_content": "/* -----------------------------------------------------------------------------",
          "new_line_content": "        sdsnew(\"-IOERR error or timeout reading from target node\\r\\n\"));",
          "content_same": false
        },
        {
          "line": 3263,
          "old_api": null,
          "new_api": "countKeysInSlot",
          "old_text": null,
          "new_text": "countKeysInSlot(slot)",
          "old_line_content": "        unsigned int numkeys, j;",
          "new_line_content": "        addReplyLongLong(c,countKeysInSlot(slot));",
          "content_same": false
        },
        {
          "line": 3264,
          "old_api": null,
          "new_api": "strcasecmp",
          "old_text": null,
          "new_text": "strcasecmp(c->argv[1]->ptr,\"getkeysinslot\")",
          "old_line_content": "        robj **keys;",
          "new_line_content": "    } else if (!strcasecmp(c->argv[1]->ptr,\"getkeysinslot\") && c->argc == 4) {",
          "content_same": false
        },
        {
          "line": 3270,
          "old_api": null,
          "new_api": "getLongLongFromObjectOrReply",
          "old_text": null,
          "new_text": "getLongLongFromObjectOrReply(c,c->argv[2],&slot,NULL)",
          "old_line_content": "        if (slot < 0 || slot >= REDIS_CLUSTER_SLOTS || maxkeys < 0) {",
          "new_line_content": "        if (getLongLongFromObjectOrReply(c,c->argv[2],&slot,NULL) != REDIS_OK)",
          "content_same": false
        },
        {
          "line": 3272,
          "old_api": null,
          "new_api": "getLongLongFromObjectOrReply",
          "old_text": null,
          "new_text": "getLongLongFromObjectOrReply(c,c->argv[3],&maxkeys,NULL)",
          "old_line_content": "            return;",
          "new_line_content": "        if (getLongLongFromObjectOrReply(c,c->argv[3],&maxkeys,NULL) != REDIS_OK)",
          "content_same": false
        },
        {
          "line": 3792,
          "old_api": null,
          "new_api": "addReply",
          "old_text": null,
          "new_text": "addReply(c,shared.ok)",
          "old_line_content": " * In this mode slaves will not redirect clients as long as clients access",
          "new_line_content": "    addReply(c,shared.ok);",
          "content_same": false
        },
        {
          "line": 3281,
          "old_api": null,
          "new_api": "addReplyMultiBulkLen",
          "old_text": null,
          "new_text": "addReplyMultiBulkLen(c,numkeys)",
          "old_line_content": "        /* CLUSTER FORGET <NODE ID> */",
          "new_line_content": "        addReplyMultiBulkLen(c,numkeys);",
          "content_same": false
        },
        {
          "line": 3283,
          "old_api": null,
          "new_api": "zfree",
          "old_text": null,
          "new_text": "zfree(keys)",
          "old_line_content": "",
          "new_line_content": "        zfree(keys);",
          "content_same": false
        },
        {
          "line": 3284,
          "old_api": null,
          "new_api": "strcasecmp",
          "old_text": null,
          "new_text": "strcasecmp(c->argv[1]->ptr,\"forget\")",
          "old_line_content": "        if (!n) {",
          "new_line_content": "    } else if (!strcasecmp(c->argv[1]->ptr,\"forget\") && c->argc == 3) {",
          "content_same": false
        },
        {
          "line": 3286,
          "old_api": null,
          "new_api": "clusterLookupNode",
          "old_text": null,
          "new_text": "clusterLookupNode(c->argv[2]->ptr)",
          "old_line_content": "            return;",
          "new_line_content": "        clusterNode *n = clusterLookupNode(c->argv[2]->ptr);",
          "content_same": false
        },
        {
          "line": 3289,
          "old_api": null,
          "new_api": "addReplyErrorFormat",
          "old_text": null,
          "new_text": "addReplyErrorFormat(c,\"Unknown node %s\", (char*)c->argv[2]->ptr)",
          "old_line_content": "            return;",
          "new_line_content": "            addReplyErrorFormat(c,\"Unknown node %s\", (char*)c->argv[2]->ptr);",
          "content_same": false
        },
        {
          "line": 3292,
          "old_api": null,
          "new_api": "addReplyError",
          "old_text": null,
          "new_text": "addReplyError(c,\"I tried hard but I can't forget myself...\")",
          "old_line_content": "            return;",
          "new_line_content": "            addReplyError(c,\"I tried hard but I can't forget myself...\");",
          "content_same": false
        },
        {
          "line": 3804,
          "old_api": null,
          "new_api": "addReply",
          "old_text": null,
          "new_text": "addReply(c,shared.ok)",
          "old_line_content": "void readwriteCommand(redisClient *c) {",
          "new_line_content": "    addReply(c,shared.ok);",
          "content_same": false
        },
        {
          "line": 3810,
          "old_api": null,
          "new_api": "addReply",
          "old_text": null,
          "new_text": "addReply(c,shared.ok)",
          "old_line_content": " * For the function to succeed the command should only target a single",
          "new_line_content": "    addReply(c,shared.ok);",
          "content_same": false
        },
        {
          "line": 3299,
          "old_api": null,
          "new_api": "clusterDelNode",
          "old_text": null,
          "new_text": "clusterDelNode(n)",
          "old_line_content": "        /* CLUSTER REPLICATE <NODE ID> */",
          "new_line_content": "        clusterDelNode(n);",
          "content_same": false
        },
        {
          "line": 3301,
          "old_api": null,
          "new_api": "addReply",
          "old_text": null,
          "new_text": "addReply(c,shared.ok)",
          "old_line_content": "",
          "new_line_content": "        addReply(c,shared.ok);",
          "content_same": false
        },
        {
          "line": 3302,
          "old_api": null,
          "new_api": "strcasecmp",
          "old_text": null,
          "new_text": "strcasecmp(c->argv[1]->ptr,\"replicate\")",
          "old_line_content": "        /* Lookup the specified node in our table. */",
          "new_line_content": "    } else if (!strcasecmp(c->argv[1]->ptr,\"replicate\") && c->argc == 3) {",
          "content_same": false
        },
        {
          "line": 3308,
          "old_api": null,
          "new_api": "addReplyErrorFormat",
          "old_text": null,
          "new_text": "addReplyErrorFormat(c,\"Unknown node %s\", (char*)c->argv[2]->ptr)",
          "old_line_content": "        /* I can't replicate myself. */",
          "new_line_content": "            addReplyErrorFormat(c,\"Unknown node %s\", (char*)c->argv[2]->ptr);",
          "content_same": false
        },
        {
          "line": 3314,
          "old_api": null,
          "new_api": "addReplyError",
          "old_text": null,
          "new_text": "addReplyError(c,\"Can't replicate myself\")",
          "old_line_content": "        /* Can't replicate a slave. */",
          "new_line_content": "            addReplyError(c,\"Can't replicate myself\");",
          "content_same": false
        },
        {
          "line": 3320,
          "old_api": null,
          "new_api": "addReplyError",
          "old_text": null,
          "new_text": "addReplyError(c,\"I can only replicate a master, not a slave.\")",
          "old_line_content": "        /* If the instance is currently a master, it should have no assigned",
          "new_line_content": "            addReplyError(c,\"I can only replicate a master, not a slave.\");",
          "content_same": false
        },
        {
          "line": 3327,
          "old_api": null,
          "new_api": "nodeIsMaster",
          "old_text": null,
          "new_text": "nodeIsMaster(myself)",
          "old_line_content": "        }",
          "new_line_content": "        if (nodeIsMaster(myself) &&",
          "content_same": false
        },
        {
          "line": 3328,
          "old_api": null,
          "new_api": "dictSize",
          "old_text": null,
          "new_text": "dictSize(server.db[0].dict)",
          "old_line_content": "",
          "new_line_content": "            (myself->numslots != 0 || dictSize(server.db[0].dict) != 0)) {",
          "content_same": false
        },
        {
          "line": 3329,
          "old_api": null,
          "new_api": "addReplyError",
          "old_text": null,
          "new_text": "addReplyError(c,\"To set a master the node must be empty and without assigned slots.\")",
          "old_line_content": "        /* Set the master. */",
          "new_line_content": "            addReplyError(c,\"To set a master the node must be empty and without assigned slots.\");",
          "content_same": false
        },
        {
          "line": 3334,
          "old_api": null,
          "new_api": "clusterSetMaster",
          "old_text": null,
          "new_text": "clusterSetMaster(n)",
          "old_line_content": "        /* CLUSTER SLAVES <NODE ID> */",
          "new_line_content": "        clusterSetMaster(n);",
          "content_same": false
        },
        {
          "line": 3336,
          "old_api": null,
          "new_api": "addReply",
          "old_text": null,
          "new_text": "addReply(c,shared.ok)",
          "old_line_content": "        int j;",
          "new_line_content": "        addReply(c,shared.ok);",
          "content_same": false
        },
        {
          "line": 3337,
          "old_api": null,
          "new_api": "strcasecmp",
          "old_text": null,
          "new_text": "strcasecmp(c->argv[1]->ptr,\"slaves\")",
          "old_line_content": "",
          "new_line_content": "    } else if (!strcasecmp(c->argv[1]->ptr,\"slaves\") && c->argc == 3) {",
          "content_same": false
        },
        {
          "line": 3339,
          "old_api": null,
          "new_api": "clusterLookupNode",
          "old_text": null,
          "new_text": "clusterLookupNode(c->argv[2]->ptr)",
          "old_line_content": "        if (!n) {",
          "new_line_content": "        clusterNode *n = clusterLookupNode(c->argv[2]->ptr);",
          "content_same": false
        },
        {
          "line": 3348,
          "old_api": null,
          "new_api": "nodeIsSlave",
          "old_text": null,
          "new_text": "nodeIsSlave(n)",
          "old_line_content": "",
          "new_line_content": "        if (nodeIsSlave(n)) {",
          "content_same": false
        },
        {
          "line": 3860,
          "old_api": null,
          "new_api": "getKeysFromCommand",
          "old_text": null,
          "new_text": "getKeysFromCommand(mcmd,margv,margc,&numkeys,\n                                      REDIS_GETKEYS_ALL)",
          "old_line_content": "                /* This is the first key we see. Check what is the slot",
          "new_line_content": "        keyindex = getKeysFromCommand(mcmd,margv,margc,&numkeys,",
          "content_same": false
        },
        {
          "line": 3868,
          "old_api": null,
          "new_api": "sdslen",
          "old_text": null,
          "new_text": "sdslen(firstkey->ptr)",
          "old_line_content": "                /* If it is not the first key, make sure it is exactly",
          "new_line_content": "                slot = keyHashSlot((char*)firstkey->ptr, sdslen(firstkey->ptr));",
          "content_same": false
        },
        {
          "line": 3360,
          "old_api": null,
          "new_api": "nodeIsMaster",
          "old_text": null,
          "new_text": "nodeIsMaster(myself)",
          "old_line_content": "                   myself->slaveof->link == NULL)",
          "new_line_content": "        if (nodeIsMaster(myself)) {",
          "content_same": false
        },
        {
          "line": 3361,
          "old_api": null,
          "new_api": "addReplyError",
          "old_text": null,
          "new_text": "addReplyError(c,\"You should send CLUSTER FAILOVER to a slave\")",
          "old_line_content": "        {",
          "new_line_content": "            addReplyError(c,\"You should send CLUSTER FAILOVER to a slave\");",
          "content_same": false
        },
        {
          "line": 3874,
          "old_api": null,
          "new_api": "equalStringObjects",
          "old_text": null,
          "new_text": "equalStringObjects(firstkey,margv[keyindex[j]])",
          "old_line_content": "            }",
          "new_line_content": "                if (!equalStringObjects(firstkey,margv[keyindex[j]])) {",
          "content_same": false
        },
        {
          "line": 3363,
          "old_api": null,
          "new_api": "nodeFailed",
          "old_text": null,
          "new_text": "nodeFailed(myself->slaveof)",
          "old_line_content": "                            \"please use CLUSTER FAILOVER FORCE\");",
          "new_line_content": "        } else if (myself->slaveof == NULL || nodeFailed(myself->slaveof) ||",
          "content_same": false
        },
        {
          "line": 3875,
          "old_api": null,
          "new_api": "getKeysFreeResult",
          "old_text": null,
          "new_text": "getKeysFreeResult(keyindex)",
          "old_line_content": "        }",
          "new_line_content": "                    getKeysFreeResult(keyindex);",
          "content_same": false
        },
        {
          "line": 3880,
          "old_api": null,
          "new_api": "getKeysFreeResult",
          "old_text": null,
          "new_text": "getKeysFreeResult(keyindex)",
          "old_line_content": "     * without redirections. */",
          "new_line_content": "        getKeysFreeResult(keyindex);",
          "content_same": false
        },
        {
          "line": 3371,
          "old_api": null,
          "new_api": "mstime",
          "old_text": null,
          "new_text": "mstime()",
          "old_line_content": "    } else {",
          "new_line_content": "        server.cluster->mf_end = mstime() + REDIS_CLUSTER_MF_TIMEOUT;",
          "content_same": false
        },
        {
          "line": 3373,
          "old_api": null,
          "new_api": "redisLog",
          "old_text": null,
          "new_text": "redisLog(REDIS_WARNING,\"Manual failover user request accepted.\")",
          "old_line_content": "    }",
          "new_line_content": "        redisLog(REDIS_WARNING,\"Manual failover user request accepted.\");",
          "content_same": false
        },
        {
          "line": 3374,
          "old_api": null,
          "new_api": "addReply",
          "old_text": null,
          "new_text": "addReply(c,shared.ok)",
          "old_line_content": "}",
          "new_line_content": "        addReply(c,shared.ok);",
          "content_same": false
        },
        {
          "line": 3376,
          "old_api": null,
          "new_api": "addReplyError",
          "old_text": null,
          "new_text": "addReplyError(c,\"Wrong CLUSTER subcommand or number of arguments\")",
          "old_line_content": "/* -----------------------------------------------------------------------------",
          "new_line_content": "        addReplyError(c,\"Wrong CLUSTER subcommand or number of arguments\");",
          "content_same": false
        },
        {
          "line": 3892,
          "old_api": null,
          "new_api": "lookupKeyRead",
          "old_text": null,
          "new_text": "lookupKeyRead(&server.db[0],firstkey)",
          "old_line_content": "    }",
          "new_line_content": "        if (lookupKeyRead(&server.db[0],firstkey) == NULL) {",
          "content_same": false
        },
        {
          "line": 3392,
          "old_api": null,
          "new_api": "sdsempty",
          "old_text": null,
          "new_text": "sdsempty()",
          "old_line_content": "    /* Write the footer, this is how it looks like:",
          "new_line_content": "    rioInitWithBuffer(payload,sdsempty());",
          "content_same": false
        },
        {
          "line": 3393,
          "old_api": null,
          "new_api": "rdbSaveObjectType",
          "old_text": null,
          "new_text": "rdbSaveObjectType(payload,o)",
          "old_line_content": "     * ----------------+---------------------+---------------+",
          "new_line_content": "    redisAssert(rdbSaveObjectType(payload,o));",
          "content_same": false
        },
        {
          "line": 3394,
          "old_api": null,
          "new_api": "rdbSaveObject",
          "old_text": null,
          "new_text": "rdbSaveObject(payload,o)",
          "old_line_content": "     * ... RDB payload | 2 bytes RDB version | 8 bytes CRC64 |",
          "new_line_content": "    redisAssert(rdbSaveObject(payload,o));",
          "content_same": false
        },
        {
          "line": 3910,
          "old_api": null,
          "new_api": "nodeIsSlave",
          "old_text": null,
          "new_text": "nodeIsSlave(myself)",
          "old_line_content": "    }",
          "new_line_content": "        nodeIsSlave(myself) &&",
          "content_same": false
        },
        {
          "line": 3409,
          "old_api": null,
          "new_api": "crc64",
          "old_text": null,
          "new_text": "crc64(0,(unsigned char*)payload->io.buffer.ptr,\n                sdslen(payload->io.buffer.ptr))",
          "old_line_content": "}",
          "new_line_content": "    crc = crc64(0,(unsigned char*)payload->io.buffer.ptr,",
          "content_same": false
        },
        {
          "line": 3410,
          "old_api": null,
          "new_api": "sdslen",
          "old_text": null,
          "new_text": "sdslen(payload->io.buffer.ptr)",
          "old_line_content": "",
          "new_line_content": "                sdslen(payload->io.buffer.ptr));",
          "content_same": false
        },
        {
          "line": 3411,
          "old_api": null,
          "new_api": "memrev64ifbe",
          "old_text": null,
          "new_text": "memrev64ifbe(&crc)",
          "old_line_content": "/* Verify that the RDB version of the dump payload matches the one of this Redis",
          "new_line_content": "    memrev64ifbe(&crc);",
          "content_same": false
        },
        {
          "line": 3412,
          "old_api": null,
          "new_api": "sdscatlen",
          "old_text": null,
          "new_text": "sdscatlen(payload->io.buffer.ptr,&crc,8)",
          "old_line_content": " * instance and that the checksum is ok.",
          "new_line_content": "    payload->io.buffer.ptr = sdscatlen(payload->io.buffer.ptr,&crc,8);",
          "content_same": false
        },
        {
          "line": 3433,
          "old_api": null,
          "new_api": "crc64",
          "old_text": null,
          "new_text": "crc64(0,p,len-8)",
          "old_line_content": "",
          "new_line_content": "    crc = crc64(0,p,len-8);",
          "content_same": false
        },
        {
          "line": 3434,
          "old_api": null,
          "new_api": "memrev64ifbe",
          "old_text": null,
          "new_text": "memrev64ifbe(&crc)",
          "old_line_content": "/* DUMP keyname",
          "new_line_content": "    memrev64ifbe(&crc);",
          "content_same": false
        },
        {
          "line": 3435,
          "old_api": null,
          "new_api": "memcmp",
          "old_text": null,
          "new_text": "memcmp(&crc,footer+2,8)",
          "old_line_content": " * DUMP is actually not used by Redis Cluster but it is the obvious",
          "new_line_content": "    return (memcmp(&crc,footer+2,8) == 0) ? REDIS_OK : REDIS_ERR;",
          "content_same": false
        },
        {
          "line": 3446,
          "old_api": null,
          "new_api": "lookupKeyRead",
          "old_text": null,
          "new_text": "lookupKeyRead(c->db,c->argv[1])",
          "old_line_content": "",
          "new_line_content": "    if ((o = lookupKeyRead(c->db,c->argv[1])) == NULL) {",
          "content_same": false
        },
        {
          "line": 3447,
          "old_api": null,
          "new_api": "addReply",
          "old_text": null,
          "new_text": "addReply(c,shared.nullbulk)",
          "old_line_content": "    /* Create the DUMP encoded representation. */",
          "new_line_content": "        addReply(c,shared.nullbulk);",
          "content_same": false
        },
        {
          "line": 3455,
          "old_api": null,
          "new_api": "createObject",
          "old_text": null,
          "new_text": "createObject(REDIS_STRING,payload.io.buffer.ptr)",
          "old_line_content": "}",
          "new_line_content": "    dumpobj = createObject(REDIS_STRING,payload.io.buffer.ptr);",
          "content_same": false
        },
        {
          "line": 3456,
          "old_api": null,
          "new_api": "addReplyBulk",
          "old_text": null,
          "new_text": "addReplyBulk(c,dumpobj)",
          "old_line_content": "",
          "new_line_content": "    addReplyBulk(c,dumpobj);",
          "content_same": false
        },
        {
          "line": 3457,
          "old_api": null,
          "new_api": "decrRefCount",
          "old_text": null,
          "new_text": "decrRefCount(dumpobj)",
          "old_line_content": "/* RESTORE key ttl serialized-value [REPLACE] */",
          "new_line_content": "    decrRefCount(dumpobj);",
          "content_same": false
        },
        {
          "line": 3470,
          "old_api": null,
          "new_api": "strcasecmp",
          "old_text": null,
          "new_text": "strcasecmp(c->argv[j]->ptr,\"replace\")",
          "old_line_content": "            return;",
          "new_line_content": "        if (!strcasecmp(c->argv[j]->ptr,\"replace\")) {",
          "content_same": false
        },
        {
          "line": 3473,
          "old_api": null,
          "new_api": "addReply",
          "old_text": null,
          "new_text": "addReply(c,shared.syntaxerr)",
          "old_line_content": "",
          "new_line_content": "            addReply(c,shared.syntaxerr);",
          "content_same": false
        },
        {
          "line": 3479,
          "old_api": null,
          "new_api": "lookupKeyWrite",
          "old_text": null,
          "new_text": "lookupKeyWrite(c->db,c->argv[1])",
          "old_line_content": "",
          "new_line_content": "    if (!replace && lookupKeyWrite(c->db,c->argv[1]) != NULL) {",
          "content_same": false
        },
        {
          "line": 3480,
          "old_api": null,
          "new_api": "addReplyError",
          "old_text": null,
          "new_text": "addReplyError(c,\"Target key name is busy.\")",
          "old_line_content": "    /* Check if the TTL value makes sense */",
          "new_line_content": "        addReplyError(c,\"Target key name is busy.\");",
          "content_same": false
        },
        {
          "line": 3485,
          "old_api": null,
          "new_api": "getLongLongFromObjectOrReply",
          "old_text": null,
          "new_text": "getLongLongFromObjectOrReply(c,c->argv[2],&ttl,NULL)",
          "old_line_content": "        return;",
          "new_line_content": "    if (getLongLongFromObjectOrReply(c,c->argv[2],&ttl,NULL) != REDIS_OK) {",
          "content_same": false
        },
        {
          "line": 3488,
          "old_api": null,
          "new_api": "addReplyError",
          "old_text": null,
          "new_text": "addReplyError(c,\"Invalid TTL value, must be >= 0\")",
          "old_line_content": "    /* Verify RDB version and data checksum. */",
          "new_line_content": "        addReplyError(c,\"Invalid TTL value, must be >= 0\");",
          "content_same": false
        },
        {
          "line": 3493,
          "old_api": null,
          "new_api": "sdslen",
          "old_text": null,
          "new_text": "sdslen(c->argv[3]->ptr)",
          "old_line_content": "    }",
          "new_line_content": "    if (verifyDumpPayload(c->argv[3]->ptr,sdslen(c->argv[3]->ptr)) == REDIS_ERR)",
          "content_same": false
        },
        {
          "line": 3500,
          "old_api": null,
          "new_api": "rdbLoadObjectType",
          "old_text": null,
          "new_text": "rdbLoadObjectType(&payload)",
          "old_line_content": "        return;",
          "new_line_content": "    if (((type = rdbLoadObjectType(&payload)) == -1) ||",
          "content_same": false
        },
        {
          "line": 3501,
          "old_api": null,
          "new_api": "rdbLoadObject",
          "old_text": null,
          "new_text": "rdbLoadObject(type,&payload)",
          "old_line_content": "    }",
          "new_line_content": "        ((obj = rdbLoadObject(type,&payload)) == NULL))",
          "content_same": false
        },
        {
          "line": 3503,
          "old_api": null,
          "new_api": "addReplyError",
          "old_text": null,
          "new_text": "addReplyError(c,\"Bad data format\")",
          "old_line_content": "    /* Remove the old key if needed. */",
          "new_line_content": "        addReplyError(c,\"Bad data format\");",
          "content_same": false
        },
        {
          "line": 3511,
          "old_api": null,
          "new_api": "dbAdd",
          "old_text": null,
          "new_text": "dbAdd(c->db,c->argv[1],obj)",
          "old_line_content": "    server.dirty++;",
          "new_line_content": "    dbAdd(c->db,c->argv[1],obj);",
          "content_same": false
        },
        {
          "line": 3512,
          "old_api": null,
          "new_api": "mstime",
          "old_text": null,
          "new_text": "mstime()",
          "old_line_content": "}",
          "new_line_content": "    if (ttl) setExpire(c->db,c->argv[1],mstime()+ttl);",
          "content_same": false
        },
        {
          "line": 3513,
          "old_api": null,
          "new_api": "signalModifiedKey",
          "old_text": null,
          "new_text": "signalModifiedKey(c->db,c->argv[1])",
          "old_line_content": "",
          "new_line_content": "    signalModifiedKey(c->db,c->argv[1]);",
          "content_same": false
        },
        {
          "line": 3514,
          "old_api": null,
          "new_api": "addReply",
          "old_text": null,
          "new_text": "addReply(c,shared.ok)",
          "old_line_content": "/* MIGRATE socket cache implementation.",
          "new_line_content": "    addReply(c,shared.ok);",
          "content_same": false
        },
        {
          "line": 3549,
          "old_api": null,
          "new_api": "sdslen",
          "old_text": null,
          "new_text": "sdslen(host->ptr)",
          "old_line_content": "    if (cs) {",
          "new_line_content": "    name = sdscatlen(name,host->ptr,sdslen(host->ptr));",
          "content_same": false
        },
        {
          "line": 3551,
          "old_api": null,
          "new_api": "sdslen",
          "old_text": null,
          "new_text": "sdslen(port->ptr)",
          "old_line_content": "        cs->last_use_time = server.unixtime;",
          "new_line_content": "    name = sdscatlen(name,port->ptr,sdslen(port->ptr));",
          "content_same": false
        },
        {
          "line": 3552,
          "old_api": null,
          "new_api": "dictFetchValue",
          "old_text": null,
          "new_text": "dictFetchValue(server.migrate_cached_sockets,name)",
          "old_line_content": "        return cs->fd;",
          "new_line_content": "    cs = dictFetchValue(server.migrate_cached_sockets,name);",
          "content_same": false
        },
        {
          "line": 3554,
          "old_api": null,
          "new_api": "sdsfree",
          "old_text": null,
          "new_text": "sdsfree(name)",
          "old_line_content": "",
          "new_line_content": "        sdsfree(name);",
          "content_same": false
        },
        {
          "line": 3563,
          "old_api": null,
          "new_api": "dictGetVal",
          "old_text": null,
          "new_text": "dictGetVal(de)",
          "old_line_content": "    }",
          "new_line_content": "        cs = dictGetVal(de);",
          "content_same": false
        },
        {
          "line": 3564,
          "old_api": null,
          "new_api": "close",
          "old_text": null,
          "new_text": "close(cs->fd)",
          "old_line_content": "",
          "new_line_content": "        close(cs->fd);",
          "content_same": false
        },
        {
          "line": 3565,
          "old_api": null,
          "new_api": "zfree",
          "old_text": null,
          "new_text": "zfree(cs)",
          "old_line_content": "    /* Create the socket */",
          "new_line_content": "        zfree(cs);",
          "content_same": false
        },
        {
          "line": 3571,
          "old_api": null,
          "new_api": "atoi",
          "old_text": null,
          "new_text": "atoi(c->argv[2]->ptr)",
          "old_line_content": "            server.neterr);",
          "new_line_content": "                atoi(c->argv[2]->ptr));",
          "content_same": false
        },
        {
          "line": 3573,
          "old_api": null,
          "new_api": "sdsfree",
          "old_text": null,
          "new_text": "sdsfree(name)",
          "old_line_content": "    }",
          "new_line_content": "        sdsfree(name);",
          "content_same": false
        },
        {
          "line": 3581,
          "old_api": null,
          "new_api": "aeWait",
          "old_text": null,
          "new_text": "aeWait(fd,AE_WRITABLE,timeout)",
          "old_line_content": "        return -1;",
          "new_line_content": "    if ((aeWait(fd,AE_WRITABLE,timeout) & AE_WRITABLE) == 0) {",
          "content_same": false
        },
        {
          "line": 3582,
          "old_api": null,
          "new_api": "sdsfree",
          "old_text": null,
          "new_text": "sdsfree(name)",
          "old_line_content": "    }",
          "new_line_content": "        sdsfree(name);",
          "content_same": false
        },
        {
          "line": 3583,
          "old_api": null,
          "new_api": "sdsnew",
          "old_text": null,
          "new_text": "sdsnew(\"-IOERR error or timeout connecting to the client\\r\\n\")",
          "old_line_content": "",
          "new_line_content": "        addReplySds(c,sdsnew(\"-IOERR error or timeout connecting to the client\\r\\n\"));",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 3585,
          "old_api": "zmalloc",
          "new_api": null,
          "old_text": "zmalloc(sizeof(*cs))",
          "new_text": null,
          "old_line_content": "    cs = zmalloc(sizeof(*cs));",
          "new_line_content": "        return -1;",
          "content_same": false
        },
        {
          "line": 3588,
          "old_api": "dictAdd",
          "new_api": null,
          "old_text": "dictAdd(server.migrate_cached_sockets,name,cs)",
          "new_text": null,
          "old_line_content": "    dictAdd(server.migrate_cached_sockets,name,cs);",
          "new_line_content": "    /* Add to the cache and return it to the caller. */",
          "content_same": false
        },
        {
          "line": 3594,
          "old_api": "sdsempty",
          "new_api": null,
          "old_text": "sdsempty()",
          "new_text": null,
          "old_line_content": "    sds name = sdsempty();",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 3597,
          "old_api": "sdslen",
          "new_api": null,
          "old_text": "sdslen(host->ptr)",
          "new_text": null,
          "old_line_content": "    name = sdscatlen(name,host->ptr,sdslen(host->ptr));",
          "new_line_content": "void migrateCloseSocket(robj *host, robj *port) {",
          "content_same": false
        },
        {
          "line": 3599,
          "old_api": "sdslen",
          "new_api": null,
          "old_text": "sdslen(port->ptr)",
          "new_text": null,
          "old_line_content": "    name = sdscatlen(name,port->ptr,sdslen(port->ptr));",
          "new_line_content": "    migrateCachedSocket *cs;",
          "content_same": false
        },
        {
          "line": 3600,
          "old_api": "dictFetchValue",
          "new_api": null,
          "old_text": "dictFetchValue(server.migrate_cached_sockets,name)",
          "new_text": null,
          "old_line_content": "    cs = dictFetchValue(server.migrate_cached_sockets,name);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 3607,
          "old_api": "zfree",
          "new_api": null,
          "old_text": "zfree(cs)",
          "new_text": null,
          "old_line_content": "    zfree(cs);",
          "new_line_content": "        return;",
          "content_same": false
        },
        {
          "line": 3608,
          "old_api": "dictDelete",
          "new_api": null,
          "old_text": "dictDelete(server.migrate_cached_sockets,name)",
          "new_text": null,
          "old_line_content": "    dictDelete(server.migrate_cached_sockets,name);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 3609,
          "old_api": "sdsfree",
          "new_api": null,
          "old_text": "sdsfree(name)",
          "new_text": null,
          "old_line_content": "    sdsfree(name);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 3616,
          "old_api": "dictNext",
          "new_api": null,
          "old_text": "dictNext(di)",
          "new_text": null,
          "old_line_content": "    while((de = dictNext(di)) != NULL) {",
          "new_line_content": "void migrateCloseTimedoutSockets(void) {",
          "content_same": false
        },
        {
          "line": 3622,
          "old_api": "dictGetKey",
          "new_api": null,
          "old_text": "dictGetKey(de)",
          "new_text": null,
          "old_line_content": "            dictDelete(server.migrate_cached_sockets,dictGetKey(de));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 3646,
          "old_api": "strcasecmp",
          "new_api": null,
          "old_text": "strcasecmp(c->argv[j]->ptr,\"copy\")",
          "new_text": null,
          "old_line_content": "        if (!strcasecmp(c->argv[j]->ptr,\"copy\")) {",
          "new_line_content": "    ttl = 0;",
          "content_same": false
        },
        {
          "line": 3648,
          "old_api": "strcasecmp",
          "new_api": null,
          "old_text": "strcasecmp(c->argv[j]->ptr,\"replace\")",
          "new_text": null,
          "old_line_content": "        } else if (!strcasecmp(c->argv[j]->ptr,\"replace\")) {",
          "new_line_content": "    /* Parse additional options */",
          "content_same": false
        },
        {
          "line": 3651,
          "old_api": "addReply",
          "new_api": null,
          "old_text": "addReply(c,shared.syntaxerr)",
          "new_text": null,
          "old_line_content": "            addReply(c,shared.syntaxerr);",
          "new_line_content": "            copy = 1;",
          "content_same": false
        },
        {
          "line": 3657,
          "old_api": "getLongFromObjectOrReply",
          "new_api": null,
          "old_text": "getLongFromObjectOrReply(c,c->argv[5],&timeout,NULL)",
          "new_text": null,
          "old_line_content": "    if (getLongFromObjectOrReply(c,c->argv[5],&timeout,NULL) != REDIS_OK)",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 3659,
          "old_api": "getLongFromObjectOrReply",
          "new_api": null,
          "old_text": "getLongFromObjectOrReply(c,c->argv[4],&dbid,NULL)",
          "new_text": null,
          "old_line_content": "    if (getLongFromObjectOrReply(c,c->argv[4],&dbid,NULL) != REDIS_OK)",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 3666,
          "old_api": "lookupKeyRead",
          "new_api": null,
          "old_text": "lookupKeyRead(c->db,c->argv[3])",
          "new_text": null,
          "old_line_content": "    if ((o = lookupKeyRead(c->db,c->argv[3])) == NULL) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 3667,
          "old_api": "sdsnew",
          "new_api": null,
          "old_text": "sdsnew(\"+NOKEY\\r\\n\")",
          "new_text": null,
          "old_line_content": "        addReplySds(c,sdsnew(\"+NOKEY\\r\\n\"));",
          "new_line_content": "    /* Check if the key is here. If not we reply with success as there is",
          "content_same": false
        },
        {
          "line": 3672,
          "old_api": "migrateGetSocket",
          "new_api": null,
          "old_text": "migrateGetSocket(c,c->argv[1],c->argv[2],timeout)",
          "new_text": null,
          "old_line_content": "    fd = migrateGetSocket(c,c->argv[1],c->argv[2],timeout);",
          "new_line_content": "        return;",
          "content_same": false
        },
        {
          "line": 3677,
          "old_api": "rioWriteBulkCount",
          "new_api": null,
          "old_text": "rioWriteBulkCount(&cmd,'*',2)",
          "new_text": null,
          "old_line_content": "    redisAssertWithInfo(c,NULL,rioWriteBulkCount(&cmd,'*',2));",
          "new_line_content": "    if (fd == -1) return; /* error sent to the client by migrateGetSocket() */",
          "content_same": false
        },
        {
          "line": 3678,
          "old_api": "rioWriteBulkString",
          "new_api": null,
          "old_text": "rioWriteBulkString(&cmd,\"SELECT\",6)",
          "new_text": null,
          "old_line_content": "    redisAssertWithInfo(c,NULL,rioWriteBulkString(&cmd,\"SELECT\",6));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 3679,
          "old_api": "rioWriteBulkLongLong",
          "new_api": null,
          "old_text": "rioWriteBulkLongLong(&cmd,dbid)",
          "new_text": null,
          "old_line_content": "    redisAssertWithInfo(c,NULL,rioWriteBulkLongLong(&cmd,dbid));",
          "new_line_content": "    /* Create RESTORE payload and generate the protocol to call the command. */",
          "content_same": false
        },
        {
          "line": 3686,
          "old_api": "rioWriteBulkCount",
          "new_api": null,
          "old_text": "rioWriteBulkCount(&cmd,'*',replace ? 5 : 4)",
          "new_text": null,
          "old_line_content": "    redisAssertWithInfo(c,NULL,rioWriteBulkCount(&cmd,'*',replace ? 5 : 4));",
          "new_line_content": "    if (expireat != -1) {",
          "content_same": false
        },
        {
          "line": 3688,
          "old_api": "redisAssertWithInfo",
          "new_api": null,
          "old_text": "redisAssertWithInfo(c,NULL,\n            rioWriteBulkString(&cmd,\"RESTORE-ASKING\",14))",
          "new_text": null,
          "old_line_content": "        redisAssertWithInfo(c,NULL,",
          "new_line_content": "        if (ttl < 1) ttl = 1;",
          "content_same": false
        },
        {
          "line": 3689,
          "old_api": "rioWriteBulkString",
          "new_api": null,
          "old_text": "rioWriteBulkString(&cmd,\"RESTORE-ASKING\",14)",
          "new_text": null,
          "old_line_content": "            rioWriteBulkString(&cmd,\"RESTORE-ASKING\",14));",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 3179,
          "old_api": "clusterDoBeforeSleep",
          "new_api": null,
          "old_text": "clusterDoBeforeSleep(CLUSTER_TODO_FSYNC_CONFIG)",
          "new_text": null,
          "old_line_content": "                clusterDoBeforeSleep(CLUSTER_TODO_FSYNC_CONFIG);",
          "new_line_content": "                if (myself->configEpoch != maxEpoch) {",
          "content_same": false
        },
        {
          "line": 3691,
          "old_api": "rioWriteBulkString",
          "new_api": null,
          "old_text": "rioWriteBulkString(&cmd,\"RESTORE\",7)",
          "new_text": null,
          "old_line_content": "        redisAssertWithInfo(c,NULL,rioWriteBulkString(&cmd,\"RESTORE\",7));",
          "new_line_content": "    if (server.cluster_enabled)",
          "content_same": false
        },
        {
          "line": 3694,
          "old_api": "rioWriteBulkLongLong",
          "new_api": null,
          "old_text": "rioWriteBulkLongLong(&cmd,ttl)",
          "new_text": null,
          "old_line_content": "    redisAssertWithInfo(c,NULL,rioWriteBulkLongLong(&cmd,ttl));",
          "new_line_content": "    else",
          "content_same": false
        },
        {
          "line": 3183,
          "old_api": "clusterAddSlot",
          "new_api": null,
          "old_text": "clusterAddSlot(n,slot)",
          "new_text": null,
          "old_line_content": "            clusterAddSlot(n,slot);",
          "new_line_content": "                }",
          "content_same": false
        },
        {
          "line": 3185,
          "old_api": "addReplyError",
          "new_api": null,
          "old_text": "addReplyError(c,\"Invalid CLUSTER SETSLOT action or number of arguments\")",
          "new_text": null,
          "old_line_content": "            addReplyError(c,\"Invalid CLUSTER SETSLOT action or number of arguments\");",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 3699,
          "old_api": "rioWriteBulkString",
          "new_api": null,
          "old_text": "rioWriteBulkString(&cmd,payload.io.buffer.ptr,\n                                sdslen(payload.io.buffer.ptr))",
          "new_text": null,
          "old_line_content": "    redisAssertWithInfo(c,NULL,rioWriteBulkString(&cmd,payload.io.buffer.ptr,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 3188,
          "old_api": "clusterDoBeforeSleep",
          "new_api": null,
          "old_text": "clusterDoBeforeSleep(CLUSTER_TODO_SAVE_CONFIG|CLUSTER_TODO_UPDATE_STATE)",
          "new_text": null,
          "old_line_content": "        clusterDoBeforeSleep(CLUSTER_TODO_SAVE_CONFIG|CLUSTER_TODO_UPDATE_STATE);",
          "new_line_content": "        } else {",
          "content_same": false
        },
        {
          "line": 3700,
          "old_api": "sdslen",
          "new_api": null,
          "old_text": "sdslen(payload.io.buffer.ptr)",
          "new_text": null,
          "old_line_content": "                                sdslen(payload.io.buffer.ptr)));",
          "new_line_content": "    /* Emit the payload argument, that is the serialized object using",
          "content_same": false
        },
        {
          "line": 3190,
          "old_api": "strcasecmp",
          "new_api": null,
          "old_text": "strcasecmp(c->argv[1]->ptr,\"info\")",
          "new_text": null,
          "old_line_content": "    } else if (!strcasecmp(c->argv[1]->ptr,\"info\") && c->argc == 2) {",
          "new_line_content": "            return;",
          "content_same": false
        },
        {
          "line": 3701,
          "old_api": "sdsfree",
          "new_api": null,
          "old_text": "sdsfree(payload.io.buffer.ptr)",
          "new_text": null,
          "old_line_content": "    sdsfree(payload.io.buffer.ptr);",
          "new_line_content": "     * the DUMP format. */",
          "content_same": false
        },
        {
          "line": 3706,
          "old_api": "rioWriteBulkString",
          "new_api": null,
          "old_text": "rioWriteBulkString(&cmd,\"REPLACE\",7)",
          "new_text": null,
          "old_line_content": "        redisAssertWithInfo(c,NULL,rioWriteBulkString(&cmd,\"REPLACE\",7));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 3201,
          "old_api": "nodeFailed",
          "new_api": null,
          "old_text": "nodeFailed(n)",
          "new_text": null,
          "old_line_content": "            if (nodeFailed(n)) {",
          "new_line_content": "            clusterNode *n = server.cluster->slots[j];",
          "content_same": false
        },
        {
          "line": 3203,
          "old_api": "nodeTimedOut",
          "new_api": null,
          "old_text": "nodeTimedOut(n)",
          "new_text": null,
          "old_line_content": "            } else if (nodeTimedOut(n)) {",
          "new_line_content": "            if (n == NULL) continue;",
          "content_same": false
        },
        {
          "line": 3715,
          "old_api": "sdslen",
          "new_api": null,
          "old_text": "sdslen(buf)",
          "new_text": null,
          "old_line_content": "        while ((towrite = sdslen(buf)-pos) > 0) {",
          "new_line_content": "        sds buf = cmd.io.buffer.ptr;",
          "content_same": false
        },
        {
          "line": 3717,
          "old_api": "syncWrite",
          "new_api": null,
          "old_text": "syncWrite(fd,buf+pos,towrite,timeout)",
          "new_text": null,
          "old_line_content": "            nwritten = syncWrite(fd,buf+pos,towrite,timeout);",
          "new_line_content": "        int nwritten = 0;",
          "content_same": false
        },
        {
          "line": 3210,
          "old_api": "sdsempty",
          "new_api": null,
          "old_text": "sdsempty()",
          "new_text": null,
          "old_line_content": "        sds info = sdscatprintf(sdsempty(),",
          "new_line_content": "                slots_ok++;",
          "content_same": false
        },
        {
          "line": 3729,
          "old_api": "syncReadLine",
          "new_api": null,
          "old_text": "syncReadLine(fd, buf1, sizeof(buf1), timeout)",
          "new_text": null,
          "old_line_content": "        if (syncReadLine(fd, buf1, sizeof(buf1), timeout) <= 0)",
          "new_line_content": "        char buf1[1024];",
          "content_same": false
        },
        {
          "line": 3731,
          "old_api": "syncReadLine",
          "new_api": null,
          "old_text": "syncReadLine(fd, buf2, sizeof(buf2), timeout)",
          "new_text": null,
          "old_line_content": "        if (syncReadLine(fd, buf2, sizeof(buf2), timeout) <= 0)",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 3734,
          "old_api": "addReplyErrorFormat",
          "new_api": null,
          "old_text": "addReplyErrorFormat(c,\"Target instance replied with error: %s\",\n                (buf1[0] == '-') ? buf1+1 : buf2+1)",
          "new_text": null,
          "old_line_content": "            addReplyErrorFormat(c,\"Target instance replied with error: %s\",",
          "new_line_content": "            goto socket_rd_err;",
          "content_same": false
        },
        {
          "line": 3226,
          "old_api": "dictSize",
          "new_api": null,
          "old_text": "dictSize(server.cluster->nodes)",
          "new_text": null,
          "old_line_content": "            dictSize(server.cluster->nodes),",
          "new_line_content": "            slots_assigned,",
          "content_same": false
        },
        {
          "line": 3741,
          "old_api": "dbDelete",
          "new_api": null,
          "old_text": "dbDelete(c->db,c->argv[3])",
          "new_text": null,
          "old_line_content": "                dbDelete(c->db,c->argv[3]);",
          "new_line_content": "            robj *aux;",
          "content_same": false
        },
        {
          "line": 3742,
          "old_api": "signalModifiedKey",
          "new_api": null,
          "old_text": "signalModifiedKey(c->db,c->argv[3])",
          "new_text": null,
          "old_line_content": "                signalModifiedKey(c->db,c->argv[3]);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 3232,
          "old_api": "sdsempty",
          "new_api": null,
          "old_text": "sdsempty()",
          "new_text": null,
          "old_line_content": "        addReplySds(c,sdscatprintf(sdsempty(),\"$%lu\\r\\n\",",
          "new_line_content": "            (unsigned long long) server.cluster->currentEpoch,",
          "content_same": false
        },
        {
          "line": 3233,
          "old_api": "sdslen",
          "new_api": null,
          "old_text": "sdslen(info)",
          "new_text": null,
          "old_line_content": "            (unsigned long)sdslen(info)));",
          "new_line_content": "            server.cluster->stats_bus_messages_sent,",
          "content_same": false
        },
        {
          "line": 3234,
          "old_api": "addReplySds",
          "new_api": null,
          "old_text": "addReplySds(c,info)",
          "new_text": null,
          "old_line_content": "        addReplySds(c,info);",
          "new_line_content": "            server.cluster->stats_bus_messages_received",
          "content_same": false
        },
        {
          "line": 3235,
          "old_api": "addReply",
          "new_api": null,
          "old_text": "addReply(c,shared.crlf)",
          "new_text": null,
          "old_line_content": "        addReply(c,shared.crlf);",
          "new_line_content": "        );",
          "content_same": false
        },
        {
          "line": 3744,
          "old_api": "addReply",
          "new_api": null,
          "old_text": "addReply(c,shared.ok)",
          "new_text": null,
          "old_line_content": "            addReply(c,shared.ok);",
          "new_line_content": "                /* No COPY option: remove the local key, signal the change. */",
          "content_same": false
        },
        {
          "line": 3749,
          "old_api": "rewriteClientCommandVector",
          "new_api": null,
          "old_text": "rewriteClientCommandVector(c,2,aux,c->argv[3])",
          "new_text": null,
          "old_line_content": "            rewriteClientCommandVector(c,2,aux,c->argv[3]);",
          "new_line_content": "            server.dirty++;",
          "content_same": false
        },
        {
          "line": 3750,
          "old_api": "decrRefCount",
          "new_api": null,
          "old_text": "decrRefCount(aux)",
          "new_text": null,
          "old_line_content": "            decrRefCount(aux);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 3242,
          "old_api": "addReplyErrorFormat",
          "new_api": null,
          "old_text": "addReplyErrorFormat(c,\"error saving the cluster node config: %s\",\n                strerror(errno))",
          "new_text": null,
          "old_line_content": "            addReplyErrorFormat(c,\"error saving the cluster node config: %s\",",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 3243,
          "old_api": "strerror",
          "new_api": null,
          "old_text": "strerror(errno)",
          "new_text": null,
          "old_line_content": "                strerror(errno));",
          "new_line_content": "        if (retval == 0)",
          "content_same": false
        },
        {
          "line": 3759,
          "old_api": "migrateCloseSocket",
          "new_api": null,
          "old_text": "migrateCloseSocket(c->argv[1],c->argv[2])",
          "new_text": null,
          "old_line_content": "    migrateCloseSocket(c->argv[1],c->argv[2]);",
          "new_line_content": "    return;",
          "content_same": false
        },
        {
          "line": 3249,
          "old_api": "strcasecmp",
          "new_api": null,
          "old_text": "strcasecmp(c->argv[1]->ptr,\"countkeysinslot\")",
          "new_text": null,
          "old_line_content": "    } else if (!strcasecmp(c->argv[1]->ptr,\"countkeysinslot\") && c->argc == 3) {",
          "new_line_content": "        /* CLUSTER KEYSLOT <key> */",
          "content_same": false
        },
        {
          "line": 3761,
          "old_api": "addReplySds",
          "new_api": null,
          "old_text": "addReplySds(c,\n        sdsnew(\"-IOERR error or timeout writing to target instance\\r\\n\"))",
          "new_text": null,
          "old_line_content": "    addReplySds(c,",
          "new_line_content": "socket_wr_err:",
          "content_same": false
        },
        {
          "line": 3767,
          "old_api": "migrateCloseSocket",
          "new_api": null,
          "old_text": "migrateCloseSocket(c->argv[1],c->argv[2])",
          "new_text": null,
          "old_line_content": "    migrateCloseSocket(c->argv[1],c->argv[2]);",
          "new_line_content": "    return;",
          "content_same": false
        },
        {
          "line": 3256,
          "old_api": "addReplyError",
          "new_api": null,
          "old_text": "addReplyError(c,\"Invalid slot\")",
          "new_text": null,
          "old_line_content": "            addReplyError(c,\"Invalid slot\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 3769,
          "old_api": "addReplySds",
          "new_api": null,
          "old_text": "addReplySds(c,\n        sdsnew(\"-IOERR error or timeout reading from target node\\r\\n\"))",
          "new_text": null,
          "old_line_content": "    addReplySds(c,",
          "new_line_content": "socket_rd_err:",
          "content_same": false
        },
        {
          "line": 3259,
          "old_api": "countKeysInSlot",
          "new_api": null,
          "old_text": "countKeysInSlot(slot)",
          "new_text": null,
          "old_line_content": "        addReplyLongLong(c,countKeysInSlot(slot));",
          "new_line_content": "        if (slot < 0 || slot >= REDIS_CLUSTER_SLOTS) {",
          "content_same": false
        },
        {
          "line": 3266,
          "old_api": "getLongLongFromObjectOrReply",
          "new_api": null,
          "old_text": "getLongLongFromObjectOrReply(c,c->argv[2],&slot,NULL)",
          "new_text": null,
          "old_line_content": "        if (getLongLongFromObjectOrReply(c,c->argv[2],&slot,NULL) != REDIS_OK)",
          "new_line_content": "        long long maxkeys, slot;",
          "content_same": false
        },
        {
          "line": 3268,
          "old_api": "getLongLongFromObjectOrReply",
          "new_api": null,
          "old_text": "getLongLongFromObjectOrReply(c,c->argv[3],&maxkeys,NULL)",
          "new_text": null,
          "old_line_content": "        if (getLongLongFromObjectOrReply(c,c->argv[3],&maxkeys,NULL) != REDIS_OK)",
          "new_line_content": "        robj **keys;",
          "content_same": false
        },
        {
          "line": 3271,
          "old_api": "addReplyError",
          "new_api": null,
          "old_text": "addReplyError(c,\"Invalid slot or number of keys\")",
          "new_text": null,
          "old_line_content": "            addReplyError(c,\"Invalid slot or number of keys\");",
          "new_line_content": "            return;",
          "content_same": false
        },
        {
          "line": 3784,
          "old_api": "addReplyError",
          "new_api": null,
          "old_text": "addReplyError(c,\"This instance has cluster support disabled\")",
          "new_text": null,
          "old_line_content": "        addReplyError(c,\"This instance has cluster support disabled\");",
          "new_line_content": " * the target instance. See the Redis Cluster specification for more",
          "content_same": false
        },
        {
          "line": 3276,
          "old_api": "getKeysInSlot",
          "new_api": null,
          "old_text": "getKeysInSlot(slot, keys, maxkeys)",
          "new_text": null,
          "old_line_content": "        numkeys = getKeysInSlot(slot, keys, maxkeys);",
          "new_line_content": "            return;",
          "content_same": false
        },
        {
          "line": 3277,
          "old_api": "addReplyMultiBulkLen",
          "new_api": null,
          "old_text": "addReplyMultiBulkLen(c,numkeys)",
          "new_text": null,
          "old_line_content": "        addReplyMultiBulkLen(c,numkeys);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 3278,
          "old_api": "addReplyBulk",
          "new_api": null,
          "old_text": "addReplyBulk(c,keys[j])",
          "new_text": null,
          "old_line_content": "        for (j = 0; j < numkeys; j++) addReplyBulk(c,keys[j]);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 3796,
          "old_api": "addReplyError",
          "new_api": null,
          "old_text": "addReplyError(c,\"This instance has cluster support disabled\")",
          "new_text": null,
          "old_line_content": "        addReplyError(c,\"This instance has cluster support disabled\");",
          "new_line_content": " * In this mode slaves will not redirect clients as long as clients access",
          "content_same": false
        },
        {
          "line": 3285,
          "old_api": "addReplyErrorFormat",
          "new_api": null,
          "old_text": "addReplyErrorFormat(c,\"Unknown node %s\", (char*)c->argv[2]->ptr)",
          "new_text": null,
          "old_line_content": "            addReplyErrorFormat(c,\"Unknown node %s\", (char*)c->argv[2]->ptr);",
          "new_line_content": "        /* CLUSTER FORGET <NODE ID> */",
          "content_same": false
        },
        {
          "line": 3288,
          "old_api": "addReplyError",
          "new_api": null,
          "old_text": "addReplyError(c,\"I tried hard but I can't forget myself...\")",
          "new_text": null,
          "old_line_content": "            addReplyError(c,\"I tried hard but I can't forget myself...\");",
          "new_line_content": "        if (!n) {",
          "content_same": false
        },
        {
          "line": 3290,
          "old_api": "nodeIsSlave",
          "new_api": null,
          "old_text": "nodeIsSlave(myself)",
          "new_text": null,
          "old_line_content": "        } else if (nodeIsSlave(myself) && myself->slaveof == n) {",
          "new_line_content": "            return;",
          "content_same": false
        },
        {
          "line": 3291,
          "old_api": "addReplyError",
          "new_api": null,
          "old_text": "addReplyError(c,\"Can't forget my master!\")",
          "new_text": null,
          "old_line_content": "            addReplyError(c,\"Can't forget my master!\");",
          "new_line_content": "        } else if (n == myself) {",
          "content_same": false
        },
        {
          "line": 3806,
          "old_api": "addReply",
          "new_api": null,
          "old_text": "addReply(c,shared.ok)",
          "new_text": null,
          "old_line_content": "    addReply(c,shared.ok);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 3296,
          "old_api": "clusterDoBeforeSleep",
          "new_api": null,
          "old_text": "clusterDoBeforeSleep(CLUSTER_TODO_UPDATE_STATE|CLUSTER_TODO_SAVE_CONFIG)",
          "new_text": null,
          "old_line_content": "        clusterDoBeforeSleep(CLUSTER_TODO_UPDATE_STATE|CLUSTER_TODO_SAVE_CONFIG);",
          "new_line_content": "            return;",
          "content_same": false
        },
        {
          "line": 3297,
          "old_api": "addReply",
          "new_api": null,
          "old_text": "addReply(c,shared.ok)",
          "new_text": null,
          "old_line_content": "        addReply(c,shared.ok);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 3310,
          "old_api": "addReplyError",
          "new_api": null,
          "old_text": "addReplyError(c,\"Can't replicate myself\")",
          "new_text": null,
          "old_line_content": "            addReplyError(c,\"Can't replicate myself\");",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 3316,
          "old_api": "addReplyError",
          "new_api": null,
          "old_text": "addReplyError(c,\"I can only replicate a master, not a slave.\")",
          "new_text": null,
          "old_line_content": "            addReplyError(c,\"I can only replicate a master, not a slave.\");",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 3323,
          "old_api": "nodeIsMaster",
          "new_api": null,
          "old_text": "nodeIsMaster(myself)",
          "new_text": null,
          "old_line_content": "        if (nodeIsMaster(myself) &&",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 3324,
          "old_api": "dictSize",
          "new_api": null,
          "old_text": "dictSize(server.db[0].dict)",
          "new_text": null,
          "old_line_content": "            (myself->numslots != 0 || dictSize(server.db[0].dict) != 0)) {",
          "new_line_content": "        /* If the instance is currently a master, it should have no assigned",
          "content_same": false
        },
        {
          "line": 3325,
          "old_api": "addReplyError",
          "new_api": null,
          "old_text": "addReplyError(c,\"To set a master the node must be empty and without assigned slots.\")",
          "new_text": null,
          "old_line_content": "            addReplyError(c,\"To set a master the node must be empty and without assigned slots.\");",
          "new_line_content": "         * slots nor keys to accept to replicate some other node.",
          "content_same": false
        },
        {
          "line": 3330,
          "old_api": "clusterSetMaster",
          "new_api": null,
          "old_text": "clusterSetMaster(n)",
          "new_text": null,
          "old_line_content": "        clusterSetMaster(n);",
          "new_line_content": "            return;",
          "content_same": false
        },
        {
          "line": 3331,
          "old_api": "clusterDoBeforeSleep",
          "new_api": null,
          "old_text": "clusterDoBeforeSleep(CLUSTER_TODO_UPDATE_STATE|CLUSTER_TODO_SAVE_CONFIG)",
          "new_text": null,
          "old_line_content": "        clusterDoBeforeSleep(CLUSTER_TODO_UPDATE_STATE|CLUSTER_TODO_SAVE_CONFIG);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 3332,
          "old_api": "addReply",
          "new_api": null,
          "old_text": "addReply(c,shared.ok)",
          "new_text": null,
          "old_line_content": "        addReply(c,shared.ok);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 3333,
          "old_api": "strcasecmp",
          "new_api": null,
          "old_text": "strcasecmp(c->argv[1]->ptr,\"slaves\")",
          "new_text": null,
          "old_line_content": "    } else if (!strcasecmp(c->argv[1]->ptr,\"slaves\") && c->argc == 3) {",
          "new_line_content": "        /* Set the master. */",
          "content_same": false
        },
        {
          "line": 3340,
          "old_api": "addReplyErrorFormat",
          "new_api": null,
          "old_text": "addReplyErrorFormat(c,\"Unknown node %s\", (char*)c->argv[2]->ptr)",
          "new_text": null,
          "old_line_content": "            addReplyErrorFormat(c,\"Unknown node %s\", (char*)c->argv[2]->ptr);",
          "new_line_content": "        int j;",
          "content_same": false
        },
        {
          "line": 3856,
          "old_api": "getKeysFromCommand",
          "new_api": null,
          "old_text": "getKeysFromCommand(mcmd,margv,margc,&numkeys,\n                                      REDIS_GETKEYS_ALL)",
          "new_text": null,
          "old_line_content": "        keyindex = getKeysFromCommand(mcmd,margv,margc,&numkeys,",
          "new_line_content": "        mcmd = ms->commands[i].cmd;",
          "content_same": false
        },
        {
          "line": 3345,
          "old_api": "addReplyError",
          "new_api": null,
          "old_text": "addReplyError(c,\"The specified node is not a master\")",
          "new_text": null,
          "old_line_content": "            addReplyError(c,\"The specified node is not a master\");",
          "new_line_content": "            return;",
          "content_same": false
        },
        {
          "line": 3351,
          "old_api": "clusterGenNodeDescription",
          "new_api": null,
          "old_text": "clusterGenNodeDescription(n->slaves[j])",
          "new_text": null,
          "old_line_content": "            sds ni = clusterGenNodeDescription(n->slaves[j]);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 3352,
          "old_api": "addReplyBulkCString",
          "new_api": null,
          "old_text": "addReplyBulkCString(c,ni)",
          "new_text": null,
          "old_line_content": "            addReplyBulkCString(c,ni);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 3864,
          "old_api": "sdslen",
          "new_api": null,
          "old_text": "sdslen(firstkey->ptr)",
          "new_text": null,
          "old_line_content": "                slot = keyHashSlot((char*)firstkey->ptr, sdslen(firstkey->ptr));",
          "new_line_content": "                /* This is the first key we see. Check what is the slot",
          "content_same": false
        },
        {
          "line": 3866,
          "old_api": "redisAssertWithInfo",
          "new_api": null,
          "old_text": "redisAssertWithInfo(c,firstkey,n != NULL)",
          "new_text": null,
          "old_line_content": "                redisAssertWithInfo(c,firstkey,n != NULL);",
          "new_line_content": "                firstkey = margv[keyindex[j]];",
          "content_same": false
        },
        {
          "line": 3871,
          "old_api": "getKeysFreeResult",
          "new_api": null,
          "old_text": "getKeysFreeResult(keyindex)",
          "new_text": null,
          "old_line_content": "                    getKeysFreeResult(keyindex);",
          "new_line_content": "            } else {",
          "content_same": false
        },
        {
          "line": 3362,
          "old_api": "addReplyError",
          "new_api": null,
          "old_text": "addReplyError(c,\"Master is down or failed, \"\n                            \"please use CLUSTER FAILOVER FORCE\")",
          "new_text": null,
          "old_line_content": "            addReplyError(c,\"Master is down or failed, \"",
          "new_line_content": "            return;",
          "content_same": false
        },
        {
          "line": 3876,
          "old_api": "getKeysFreeResult",
          "new_api": null,
          "old_text": "getKeysFreeResult(keyindex)",
          "new_text": null,
          "old_line_content": "        getKeysFreeResult(keyindex);",
          "new_line_content": "                    return NULL;",
          "content_same": false
        },
        {
          "line": 3367,
          "old_api": "mstime",
          "new_api": null,
          "old_text": "mstime()",
          "new_text": null,
          "old_line_content": "        server.cluster->mf_end = mstime() + REDIS_CLUSTER_MF_TIMEOUT;",
          "new_line_content": "                            \"please use CLUSTER FAILOVER FORCE\");",
          "content_same": false
        },
        {
          "line": 3368,
          "old_api": "clusterSendMFStart",
          "new_api": null,
          "old_text": "clusterSendMFStart(myself->slaveof)",
          "new_text": null,
          "old_line_content": "        clusterSendMFStart(myself->slaveof);",
          "new_line_content": "            return;",
          "content_same": false
        },
        {
          "line": 3369,
          "old_api": "redisLog",
          "new_api": null,
          "old_text": "redisLog(REDIS_WARNING,\"Manual failover user request accepted.\")",
          "new_text": null,
          "old_line_content": "        redisLog(REDIS_WARNING,\"Manual failover user request accepted.\");",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 3888,
          "old_api": "lookupKeyRead",
          "new_api": null,
          "old_text": "lookupKeyRead(&server.db[0],firstkey)",
          "new_text": null,
          "old_line_content": "        if (lookupKeyRead(&server.db[0],firstkey) == NULL) {",
          "new_line_content": "     * Then we need to check if we have the key. If we have it we can reply.",
          "content_same": false
        },
        {
          "line": 3388,
          "old_api": "sdsempty",
          "new_api": null,
          "old_text": "sdsempty()",
          "new_text": null,
          "old_line_content": "    rioInitWithBuffer(payload,sdsempty());",
          "new_line_content": "    uint64_t crc;",
          "content_same": false
        },
        {
          "line": 3389,
          "old_api": "rdbSaveObjectType",
          "new_api": null,
          "old_text": "rdbSaveObjectType(payload,o)",
          "new_text": null,
          "old_line_content": "    redisAssert(rdbSaveObjectType(payload,o));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 3390,
          "old_api": "rdbSaveObject",
          "new_api": null,
          "old_text": "rdbSaveObject(payload,o)",
          "new_text": null,
          "old_line_content": "    redisAssert(rdbSaveObject(payload,o));",
          "new_line_content": "    /* Serialize the object in a RDB-like format. It consist of an object type",
          "content_same": false
        },
        {
          "line": 3906,
          "old_api": "nodeIsSlave",
          "new_api": null,
          "old_text": "nodeIsSlave(myself)",
          "new_text": null,
          "old_line_content": "        nodeIsSlave(myself) &&",
          "new_line_content": "     * node is a slave and the request is about an hash slot our master",
          "content_same": false
        },
        {
          "line": 3402,
          "old_api": "sdscatlen",
          "new_api": null,
          "old_text": "sdscatlen(payload->io.buffer.ptr,buf,2)",
          "new_text": null,
          "old_line_content": "    payload->io.buffer.ptr = sdscatlen(payload->io.buffer.ptr,buf,2);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 3405,
          "old_api": "crc64",
          "new_api": null,
          "old_text": "crc64(0,(unsigned char*)payload->io.buffer.ptr,\n                sdslen(payload->io.buffer.ptr))",
          "new_text": null,
          "old_line_content": "    crc = crc64(0,(unsigned char*)payload->io.buffer.ptr,",
          "new_line_content": "    buf[1] = (REDIS_RDB_VERSION >> 8) & 0xff;",
          "content_same": false
        },
        {
          "line": 3407,
          "old_api": "memrev64ifbe",
          "new_api": null,
          "old_text": "memrev64ifbe(&crc)",
          "new_text": null,
          "old_line_content": "    memrev64ifbe(&crc);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 3408,
          "old_api": "sdscatlen",
          "new_api": null,
          "old_text": "sdscatlen(payload->io.buffer.ptr,&crc,8)",
          "new_text": null,
          "old_line_content": "    payload->io.buffer.ptr = sdscatlen(payload->io.buffer.ptr,&crc,8);",
          "new_line_content": "    /* CRC64 */",
          "content_same": false
        },
        {
          "line": 3429,
          "old_api": "crc64",
          "new_api": null,
          "old_text": "crc64(0,p,len-8)",
          "new_text": null,
          "old_line_content": "    crc = crc64(0,p,len-8);",
          "new_line_content": "    rdbver = (footer[1] << 8) | footer[0];",
          "content_same": false
        },
        {
          "line": 3430,
          "old_api": "memrev64ifbe",
          "new_api": null,
          "old_text": "memrev64ifbe(&crc)",
          "new_text": null,
          "old_line_content": "    memrev64ifbe(&crc);",
          "new_line_content": "    if (rdbver != REDIS_RDB_VERSION) return REDIS_ERR;",
          "content_same": false
        },
        {
          "line": 3431,
          "old_api": "memcmp",
          "new_api": null,
          "old_text": "memcmp(&crc,footer+2,8)",
          "new_text": null,
          "old_line_content": "    return (memcmp(&crc,footer+2,8) == 0) ? REDIS_OK : REDIS_ERR;",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 3442,
          "old_api": "lookupKeyRead",
          "new_api": null,
          "old_text": "lookupKeyRead(c->db,c->argv[1])",
          "new_text": null,
          "old_line_content": "    if ((o = lookupKeyRead(c->db,c->argv[1])) == NULL) {",
          "new_line_content": "    robj *o, *dumpobj;",
          "content_same": false
        },
        {
          "line": 3443,
          "old_api": "addReply",
          "new_api": null,
          "old_text": "addReply(c,shared.nullbulk)",
          "new_text": null,
          "old_line_content": "        addReply(c,shared.nullbulk);",
          "new_line_content": "    rio payload;",
          "content_same": false
        },
        {
          "line": 3448,
          "old_api": "createDumpPayload",
          "new_api": null,
          "old_text": "createDumpPayload(&payload,o)",
          "new_text": null,
          "old_line_content": "    createDumpPayload(&payload,o);",
          "new_line_content": "        return;",
          "content_same": false
        },
        {
          "line": 3451,
          "old_api": "createObject",
          "new_api": null,
          "old_text": "createObject(REDIS_STRING,payload.io.buffer.ptr)",
          "new_text": null,
          "old_line_content": "    dumpobj = createObject(REDIS_STRING,payload.io.buffer.ptr);",
          "new_line_content": "    /* Create the DUMP encoded representation. */",
          "content_same": false
        },
        {
          "line": 3453,
          "old_api": "decrRefCount",
          "new_api": null,
          "old_text": "decrRefCount(dumpobj)",
          "new_text": null,
          "old_line_content": "    decrRefCount(dumpobj);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 3466,
          "old_api": "strcasecmp",
          "new_api": null,
          "old_text": "strcasecmp(c->argv[j]->ptr,\"replace\")",
          "new_text": null,
          "old_line_content": "        if (!strcasecmp(c->argv[j]->ptr,\"replace\")) {",
          "new_line_content": "    robj *obj;",
          "content_same": false
        },
        {
          "line": 3469,
          "old_api": "addReply",
          "new_api": null,
          "old_text": "addReply(c,shared.syntaxerr)",
          "new_text": null,
          "old_line_content": "            addReply(c,shared.syntaxerr);",
          "new_line_content": "    for (j = 4; j < c->argc; j++) {",
          "content_same": false
        },
        {
          "line": 3475,
          "old_api": "lookupKeyWrite",
          "new_api": null,
          "old_text": "lookupKeyWrite(c->db,c->argv[1])",
          "new_text": null,
          "old_line_content": "    if (!replace && lookupKeyWrite(c->db,c->argv[1]) != NULL) {",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 3476,
          "old_api": "addReplyError",
          "new_api": null,
          "old_text": "addReplyError(c,\"Target key name is busy.\")",
          "new_text": null,
          "old_line_content": "        addReplyError(c,\"Target key name is busy.\");",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 3481,
          "old_api": "getLongLongFromObjectOrReply",
          "new_api": null,
          "old_text": "getLongLongFromObjectOrReply(c,c->argv[2],&ttl,NULL)",
          "new_text": null,
          "old_line_content": "    if (getLongLongFromObjectOrReply(c,c->argv[2],&ttl,NULL) != REDIS_OK) {",
          "new_line_content": "        return;",
          "content_same": false
        },
        {
          "line": 3484,
          "old_api": "addReplyError",
          "new_api": null,
          "old_text": "addReplyError(c,\"Invalid TTL value, must be >= 0\")",
          "new_text": null,
          "old_line_content": "        addReplyError(c,\"Invalid TTL value, must be >= 0\");",
          "new_line_content": "    /* Check if the TTL value makes sense */",
          "content_same": false
        },
        {
          "line": 3489,
          "old_api": "sdslen",
          "new_api": null,
          "old_text": "sdslen(c->argv[3]->ptr)",
          "new_text": null,
          "old_line_content": "    if (verifyDumpPayload(c->argv[3]->ptr,sdslen(c->argv[3]->ptr)) == REDIS_ERR)",
          "new_line_content": "        return;",
          "content_same": false
        },
        {
          "line": 3491,
          "old_api": "addReplyError",
          "new_api": null,
          "old_text": "addReplyError(c,\"DUMP payload version or checksum are wrong\")",
          "new_text": null,
          "old_line_content": "        addReplyError(c,\"DUMP payload version or checksum are wrong\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 3496,
          "old_api": "rdbLoadObjectType",
          "new_api": null,
          "old_text": "rdbLoadObjectType(&payload)",
          "new_text": null,
          "old_line_content": "    if (((type = rdbLoadObjectType(&payload)) == -1) ||",
          "new_line_content": "        return;",
          "content_same": false
        },
        {
          "line": 3497,
          "old_api": "rdbLoadObject",
          "new_api": null,
          "old_text": "rdbLoadObject(type,&payload)",
          "new_text": null,
          "old_line_content": "        ((obj = rdbLoadObject(type,&payload)) == NULL))",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 3504,
          "old_api": "dbDelete",
          "new_api": null,
          "old_text": "dbDelete(c->db,c->argv[1])",
          "new_text": null,
          "old_line_content": "    if (replace) dbDelete(c->db,c->argv[1]);",
          "new_line_content": "        return;",
          "content_same": false
        },
        {
          "line": 3507,
          "old_api": "dbAdd",
          "new_api": null,
          "old_text": "dbAdd(c->db,c->argv[1],obj)",
          "new_text": null,
          "old_line_content": "    dbAdd(c->db,c->argv[1],obj);",
          "new_line_content": "    /* Remove the old key if needed. */",
          "content_same": false
        },
        {
          "line": 3509,
          "old_api": "signalModifiedKey",
          "new_api": null,
          "old_text": "signalModifiedKey(c->db,c->argv[1])",
          "new_text": null,
          "old_line_content": "    signalModifiedKey(c->db,c->argv[1]);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 3510,
          "old_api": "addReply",
          "new_api": null,
          "old_text": "addReply(c,shared.ok)",
          "new_text": null,
          "old_line_content": "    addReply(c,shared.ok);",
          "new_line_content": "    /* Create the key and set the TTL if any */",
          "content_same": false
        },
        {
          "line": 3541,
          "old_api": "sdsempty",
          "new_api": null,
          "old_text": "sdsempty()",
          "new_text": null,
          "old_line_content": "    sds name = sdsempty();",
          "new_line_content": " * should be called so that the connection will be craeted from scratch",
          "content_same": false
        },
        {
          "line": 3546,
          "old_api": "sdscatlen",
          "new_api": null,
          "old_text": "sdscatlen(name,\":\",1)",
          "new_text": null,
          "old_line_content": "    name = sdscatlen(name,\":\",1);",
          "new_line_content": "    migrateCachedSocket *cs;",
          "content_same": false
        },
        {
          "line": 3547,
          "old_api": "sdslen",
          "new_api": null,
          "old_text": "sdslen(port->ptr)",
          "new_text": null,
          "old_line_content": "    name = sdscatlen(name,port->ptr,sdslen(port->ptr));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 3548,
          "old_api": "dictFetchValue",
          "new_api": null,
          "old_text": "dictFetchValue(server.migrate_cached_sockets,name)",
          "new_text": null,
          "old_line_content": "    cs = dictFetchValue(server.migrate_cached_sockets,name);",
          "new_line_content": "    /* Check if we have an already cached socket for this ip:port pair. */",
          "content_same": false
        },
        {
          "line": 3556,
          "old_api": "dictSize",
          "new_api": null,
          "old_text": "dictSize(server.migrate_cached_sockets)",
          "new_text": null,
          "old_line_content": "    if (dictSize(server.migrate_cached_sockets) == MIGRATE_SOCKET_CACHE_ITEMS) {",
          "new_line_content": "        return cs->fd;",
          "content_same": false
        },
        {
          "line": 3558,
          "old_api": "dictGetRandomKey",
          "new_api": null,
          "old_text": "dictGetRandomKey(server.migrate_cached_sockets)",
          "new_text": null,
          "old_line_content": "        dictEntry *de = dictGetRandomKey(server.migrate_cached_sockets);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 3559,
          "old_api": "dictGetVal",
          "new_api": null,
          "old_text": "dictGetVal(de)",
          "new_text": null,
          "old_line_content": "        cs = dictGetVal(de);",
          "new_line_content": "    /* No cached socket, create one. */",
          "content_same": false
        },
        {
          "line": 3561,
          "old_api": "zfree",
          "new_api": null,
          "old_text": "zfree(cs)",
          "new_text": null,
          "old_line_content": "        zfree(cs);",
          "new_line_content": "        /* Too many items, drop one at random. */",
          "content_same": false
        },
        {
          "line": 3567,
          "old_api": "atoi",
          "new_api": null,
          "old_text": "atoi(c->argv[2]->ptr)",
          "new_text": null,
          "old_line_content": "                atoi(c->argv[2]->ptr));",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 3569,
          "old_api": "sdsfree",
          "new_api": null,
          "old_text": "sdsfree(name)",
          "new_text": null,
          "old_line_content": "        sdsfree(name);",
          "new_line_content": "    /* Create the socket */",
          "content_same": false
        },
        {
          "line": 3577,
          "old_api": "aeWait",
          "new_api": null,
          "old_text": "aeWait(fd,AE_WRITABLE,timeout)",
          "new_text": null,
          "old_line_content": "    if ((aeWait(fd,AE_WRITABLE,timeout) & AE_WRITABLE) == 0) {",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 3579,
          "old_api": "sdsnew",
          "new_api": null,
          "old_text": "sdsnew(\"-IOERR error or timeout connecting to the client\\r\\n\")",
          "new_text": null,
          "old_line_content": "        addReplySds(c,sdsnew(\"-IOERR error or timeout connecting to the client\\r\\n\"));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 3580,
          "old_api": "close",
          "new_api": null,
          "old_text": "close(fd)",
          "new_text": null,
          "old_line_content": "        close(fd);",
          "new_line_content": "    /* Check if it connects within the specified timeout. */",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 64,
      "total_additions": 145,
      "total_deletions": 144,
      "total_api_changes": 353
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 7,
        "api_related_lines": 353,
        "non_api_lines": 3,
        "non_api_line_numbers": [
          3178,
          3180,
          3181
        ]
      }
    },
    "api_calls_before": 946,
    "api_calls_after": 947,
    "diff_info": {
      "added_lines": 7,
      "removed_lines": 3,
      "total_diff_lines": 22
    }
  }
}