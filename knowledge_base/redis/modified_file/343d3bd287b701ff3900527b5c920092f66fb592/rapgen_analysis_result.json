{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/redis/modified_file/343d3bd287b701ff3900527b5c920092f66fb592",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/redis/modified_file/343d3bd287b701ff3900527b5c920092f66fb592/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/redis/modified_file/343d3bd287b701ff3900527b5c920092f66fb592/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/redis/modified_file/343d3bd287b701ff3900527b5c920092f66fb592/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 83,
          "old_api": "dbOverwrite",
          "new_api": "addReplyError",
          "old_text": "dbOverwrite(c->db,c->argv[1],o)",
          "new_text": "addReplyError(c,err)",
          "old_line_content": "            dbOverwrite(c->db,c->argv[1],o);",
          "new_line_content": "        addReplyError(c,err);",
          "content_same": false
        },
        {
          "line": 89,
          "old_api": "sdsgrowzero",
          "new_api": "sdsempty",
          "old_text": "sdsgrowzero(o->ptr,byte+1)",
          "new_text": "sdsempty()",
          "old_line_content": "    o->ptr = sdsgrowzero(o->ptr,byte+1);",
          "new_line_content": "        o = createObject(REDIS_STRING,sdsempty());",
          "content_same": false
        },
        {
          "line": 116,
          "old_api": "lookupKeyReadOrReply",
          "new_api": "signalModifiedKey",
          "old_text": "lookupKeyReadOrReply(c,c->argv[1],shared.czero)",
          "new_text": "signalModifiedKey(c->db,c->argv[1])",
          "old_line_content": "    if ((o = lookupKeyReadOrReply(c,c->argv[1],shared.czero)) == NULL ||",
          "new_line_content": "    signalModifiedKey(c->db,c->argv[1]);",
          "content_same": false
        },
        {
          "line": 129,
          "old_api": "addReply",
          "new_api": "getBitOffsetFromArgument",
          "old_text": "addReply(c, bitval ? shared.cone : shared.czero)",
          "new_text": "getBitOffsetFromArgument(c,c->argv[2],&bitoffset)",
          "old_line_content": "    addReply(c, bitval ? shared.cone : shared.czero);",
          "new_line_content": "    if (getBitOffsetFromArgument(c,c->argv[2],&bitoffset) != REDIS_OK)",
          "content_same": false
        },
        {
          "line": 164,
          "old_api": "zmalloc",
          "new_api": "strcasecmp",
          "old_text": "zmalloc(sizeof(long) * numkeys)",
          "new_text": "strcasecmp(opname,\"not\")",
          "old_line_content": "    len = zmalloc(sizeof(long) * numkeys);",
          "new_line_content": "    else if((opname[0] == 'n' || opname[0] == 'N') && !strcasecmp(opname,\"not\"))",
          "content_same": false
        },
        {
          "line": 180,
          "old_api": "sdslen",
          "new_api": "zmalloc",
          "old_text": "sdslen(o->ptr)",
          "new_text": "zmalloc(sizeof(long) * numkeys)",
          "old_line_content": "        len[j] = sdslen(o->ptr);",
          "new_line_content": "    len = zmalloc(sizeof(long) * numkeys);",
          "content_same": false
        },
        {
          "line": 228,
          "old_api": "lookupKeyReadOrReply",
          "new_api": "dbDelete",
          "old_text": "lookupKeyReadOrReply(c,c->argv[1],shared.czero)",
          "new_text": "dbDelete(c->db,targetkey)",
          "old_line_content": "    if ((o = lookupKeyReadOrReply(c,c->argv[1],shared.czero)) == NULL ||",
          "new_line_content": "    } else if (dbDelete(c->db,targetkey)) {",
          "content_same": false
        },
        {
          "line": 229,
          "old_api": "checkType",
          "new_api": "signalModifiedKey",
          "old_text": "checkType(c,o,REDIS_STRING)",
          "new_text": "signalModifiedKey(c->db,targetkey)",
          "old_line_content": "        checkType(c,o,REDIS_STRING)) return;",
          "new_line_content": "        signalModifiedKey(c->db,targetkey);",
          "content_same": false
        },
        {
          "line": 245,
          "old_api": "getLongFromObjectOrReply",
          "new_api": "checkType",
          "old_text": "getLongFromObjectOrReply(c,c->argv[3],&end,NULL)",
          "new_text": "checkType(c,o,REDIS_STRING)",
          "old_line_content": "        if (getLongFromObjectOrReply(c,c->argv[3],&end,NULL) != REDIS_OK)",
          "new_line_content": "        checkType(c,o,REDIS_STRING)) return;",
          "content_same": false
        },
        {
          "line": 259,
          "old_api": "addReply",
          "new_api": "getLongFromObjectOrReply",
          "old_text": "addReply(c,shared.syntaxerr)",
          "new_text": "getLongFromObjectOrReply(c,c->argv[2],&start,NULL)",
          "old_line_content": "        addReply(c,shared.syntaxerr);",
          "new_line_content": "        if (getLongFromObjectOrReply(c,c->argv[2],&start,NULL) != REDIS_OK)",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 132,
          "old_api": null,
          "new_api": "lookupKeyReadOrReply",
          "old_text": null,
          "new_text": "lookupKeyReadOrReply(c,c->argv[1],shared.czero)",
          "old_line_content": "/* BITOP op_name target_key src_key1 src_key2 src_key3 ... src_keyN */",
          "new_line_content": "    if ((o = lookupKeyReadOrReply(c,c->argv[1],shared.czero)) == NULL ||",
          "content_same": false
        },
        {
          "line": 261,
          "old_api": null,
          "new_api": "getLongFromObjectOrReply",
          "old_text": null,
          "new_text": "getLongFromObjectOrReply(c,c->argv[3],&end,NULL)",
          "old_line_content": "    }",
          "new_line_content": "        if (getLongFromObjectOrReply(c,c->argv[3],&end,NULL) != REDIS_OK)",
          "content_same": false
        },
        {
          "line": 133,
          "old_api": null,
          "new_api": "checkType",
          "old_text": null,
          "new_text": "checkType(c,o,REDIS_STRING)",
          "old_line_content": "void bitopCommand(redisClient *c) {",
          "new_line_content": "        checkType(c,o,REDIS_STRING)) return;",
          "content_same": false
        },
        {
          "line": 138,
          "old_api": null,
          "new_api": "ll2string",
          "old_text": null,
          "new_text": "ll2string(llbuf,sizeof(llbuf),(long)o->ptr)",
          "old_line_content": "    long *len, maxlen = 0; /* Array of length of src strings, and max len. */",
          "new_line_content": "        if (byte < (size_t)ll2string(llbuf,sizeof(llbuf),(long)o->ptr))",
          "content_same": false
        },
        {
          "line": 141,
          "old_api": null,
          "new_api": "sdslen",
          "old_text": null,
          "new_text": "sdslen(o->ptr)",
          "old_line_content": "    /* Parse the operation name. */",
          "new_line_content": "        if (byte < sdslen(o->ptr))",
          "content_same": false
        },
        {
          "line": 145,
          "old_api": null,
          "new_api": "addReply",
          "old_text": null,
          "new_text": "addReply(c, bitval ? shared.cone : shared.czero)",
          "old_line_content": "        op = BITOP_OR;",
          "new_line_content": "    addReply(c, bitval ? shared.cone : shared.czero);",
          "content_same": false
        },
        {
          "line": 275,
          "old_api": null,
          "new_api": "addReply",
          "old_text": null,
          "new_text": "addReply(c,shared.syntaxerr)",
          "old_line_content": "",
          "new_line_content": "        addReply(c,shared.syntaxerr);",
          "content_same": false
        },
        {
          "line": 282,
          "old_api": null,
          "new_api": "addReply",
          "old_text": null,
          "new_text": "addReply(c,shared.czero)",
          "old_line_content": "",
          "new_line_content": "        addReply(c,shared.czero);",
          "content_same": false
        },
        {
          "line": 158,
          "old_api": null,
          "new_api": "strcasecmp",
          "old_text": null,
          "new_text": "strcasecmp(opname,\"and\")",
          "old_line_content": "        return;",
          "new_line_content": "    if ((opname[0] == 'a' || opname[0] == 'A') && !strcasecmp(opname,\"and\"))",
          "content_same": false
        },
        {
          "line": 286,
          "old_api": null,
          "new_api": "popcount",
          "old_text": null,
          "new_text": "popcount(p+start,bytes)",
          "old_line_content": "",
          "new_line_content": "        addReplyLongLong(c,popcount(p+start,bytes));",
          "content_same": false
        },
        {
          "line": 160,
          "old_api": null,
          "new_api": "strcasecmp",
          "old_text": null,
          "new_text": "strcasecmp(opname,\"or\")",
          "old_line_content": "",
          "new_line_content": "    else if((opname[0] == 'o' || opname[0] == 'O') && !strcasecmp(opname,\"or\"))",
          "content_same": false
        },
        {
          "line": 162,
          "old_api": null,
          "new_api": "strcasecmp",
          "old_text": null,
          "new_text": "strcasecmp(opname,\"xor\")",
          "old_line_content": "    numkeys = c->argc - 3;",
          "new_line_content": "    else if((opname[0] == 'x' || opname[0] == 'X') && !strcasecmp(opname,\"xor\"))",
          "content_same": false
        },
        {
          "line": 167,
          "old_api": null,
          "new_api": "addReply",
          "old_text": null,
          "new_text": "addReply(c,shared.syntaxerr)",
          "old_line_content": "        /* Handle non-existing keys as empty strings. */",
          "new_line_content": "        addReply(c,shared.syntaxerr);",
          "content_same": false
        },
        {
          "line": 43,
          "old_api": null,
          "new_api": "__builtin_popcount",
          "old_text": null,
          "new_text": "__builtin_popcount(aux)",
          "old_line_content": " * -------------------------------------------------------------------------- */",
          "new_line_content": "        bits += __builtin_popcount(aux);",
          "content_same": false
        },
        {
          "line": 173,
          "old_api": null,
          "new_api": "addReplyError",
          "old_text": null,
          "new_text": "addReplyError(c,\"BITOP NOT must be called with a single source key.\")",
          "old_line_content": "        /* Return an error if one of the keys is not a string. */",
          "new_line_content": "        addReplyError(c,\"BITOP NOT must be called with a single source key.\");",
          "content_same": false
        },
        {
          "line": 179,
          "old_api": null,
          "new_api": "zmalloc",
          "old_text": null,
          "new_text": "zmalloc(sizeof(unsigned char*) * numkeys)",
          "old_line_content": "        src[j] = o->ptr;",
          "new_line_content": "    src = zmalloc(sizeof(unsigned char*) * numkeys);",
          "content_same": false
        },
        {
          "line": 182,
          "old_api": null,
          "new_api": "lookupKeyRead",
          "old_text": null,
          "new_text": "lookupKeyRead(c->db,c->argv[j+3])",
          "old_line_content": "    }",
          "new_line_content": "        o = lookupKeyRead(c->db,c->argv[j+3]);",
          "content_same": false
        },
        {
          "line": 190,
          "old_api": null,
          "new_api": "checkType",
          "old_text": null,
          "new_text": "checkType(c,o,REDIS_STRING)",
          "old_line_content": "        for (j = 0; j < maxlen; j++) {",
          "new_line_content": "        if (checkType(c,o,REDIS_STRING)) {",
          "content_same": false
        },
        {
          "line": 191,
          "old_api": null,
          "new_api": "zfree",
          "old_text": null,
          "new_text": "zfree(src)",
          "old_line_content": "            output = (len[0] <= j) ? 0 : src[0][j];",
          "new_line_content": "            zfree(src);",
          "content_same": false
        },
        {
          "line": 192,
          "old_api": null,
          "new_api": "zfree",
          "old_text": null,
          "new_text": "zfree(len)",
          "old_line_content": "            if (op == BITOP_NOT) output = ~output;",
          "new_line_content": "            zfree(len);",
          "content_same": false
        },
        {
          "line": 196,
          "old_api": null,
          "new_api": "sdslen",
          "old_text": null,
          "new_text": "sdslen(o->ptr)",
          "old_line_content": "                case BITOP_AND: output &= byte; break;",
          "new_line_content": "        len[j] = sdslen(o->ptr);",
          "content_same": false
        },
        {
          "line": 202,
          "old_api": null,
          "new_api": "sdsnewlen",
          "old_text": null,
          "new_text": "sdsnewlen(NULL,maxlen)",
          "old_line_content": "        }",
          "new_line_content": "        res = (unsigned char*) sdsnewlen(NULL,maxlen);",
          "content_same": false
        },
        {
          "line": 75,
          "old_api": null,
          "new_api": "getBitOffsetFromArgument",
          "old_text": null,
          "new_text": "getBitOffsetFromArgument(c,c->argv[2],&bitoffset)",
          "old_line_content": "    } else {",
          "new_line_content": "    if (getBitOffsetFromArgument(c,c->argv[2],&bitoffset) != REDIS_OK)",
          "content_same": false
        },
        {
          "line": 78,
          "old_api": null,
          "new_api": "getLongFromObjectOrReply",
          "old_text": null,
          "new_text": "getLongFromObjectOrReply(c,c->argv[3],&on,err)",
          "old_line_content": "        /* Create a copy when the object is shared or encoded. */",
          "new_line_content": "    if (getLongFromObjectOrReply(c,c->argv[3],&on,err) != REDIS_OK)",
          "content_same": false
        },
        {
          "line": 87,
          "old_api": null,
          "new_api": "lookupKeyWrite",
          "old_text": null,
          "new_text": "lookupKeyWrite(c->db,c->argv[1])",
          "old_line_content": "    /* Grow sds value to the right length if necessary */",
          "new_line_content": "    o = lookupKeyWrite(c->db,c->argv[1]);",
          "content_same": false
        },
        {
          "line": 90,
          "old_api": null,
          "new_api": "dbAdd",
          "old_text": null,
          "new_text": "dbAdd(c->db,c->argv[1],o)",
          "old_line_content": "",
          "new_line_content": "        dbAdd(c->db,c->argv[1],o);",
          "content_same": false
        },
        {
          "line": 92,
          "old_api": null,
          "new_api": "checkType",
          "old_text": null,
          "new_text": "checkType(c,o,REDIS_STRING)",
          "old_line_content": "    byteval = ((char*)o->ptr)[byte];",
          "new_line_content": "        if (checkType(c,o,REDIS_STRING)) return;",
          "content_same": false
        },
        {
          "line": 220,
          "old_api": null,
          "new_api": "zfree",
          "old_text": null,
          "new_text": "zfree(src)",
          "old_line_content": "void bitcountCommand(redisClient *c) {",
          "new_line_content": "    zfree(src);",
          "content_same": false
        },
        {
          "line": 221,
          "old_api": null,
          "new_api": "zfree",
          "old_text": null,
          "new_text": "zfree(len)",
          "old_line_content": "    robj *o;",
          "new_line_content": "    zfree(len);",
          "content_same": false
        },
        {
          "line": 96,
          "old_api": null,
          "new_api": "getDecodedObject",
          "old_text": null,
          "new_text": "getDecodedObject(o)",
          "old_line_content": "    /* Update byte with new bit value and return original value */",
          "new_line_content": "            robj *decoded = getDecodedObject(o);",
          "content_same": false
        },
        {
          "line": 97,
          "old_api": null,
          "new_api": "sdslen",
          "old_text": null,
          "new_text": "sdslen(decoded->ptr)",
          "old_line_content": "    byteval &= ~(1 << bit);",
          "new_line_content": "            o = createStringObject(decoded->ptr, sdslen(decoded->ptr));",
          "content_same": false
        },
        {
          "line": 98,
          "old_api": null,
          "new_api": "decrRefCount",
          "old_text": null,
          "new_text": "decrRefCount(decoded)",
          "old_line_content": "    byteval |= ((on & 0x1) << bit);",
          "new_line_content": "            decrRefCount(decoded);",
          "content_same": false
        },
        {
          "line": 99,
          "old_api": null,
          "new_api": "dbOverwrite",
          "old_text": null,
          "new_text": "dbOverwrite(c->db,c->argv[1],o)",
          "old_line_content": "    ((char*)o->ptr)[byte] = byteval;",
          "new_line_content": "            dbOverwrite(c->db,c->argv[1],o);",
          "content_same": false
        },
        {
          "line": 225,
          "old_api": null,
          "new_api": "createObject",
          "old_text": null,
          "new_text": "createObject(REDIS_STRING,res)",
          "old_line_content": "    size_t strlen;",
          "new_line_content": "        o = createObject(REDIS_STRING,res);",
          "content_same": false
        },
        {
          "line": 226,
          "old_api": null,
          "new_api": "setKey",
          "old_text": null,
          "new_text": "setKey(c->db,targetkey,o)",
          "old_line_content": "",
          "new_line_content": "        setKey(c->db,targetkey,o);",
          "content_same": false
        },
        {
          "line": 227,
          "old_api": null,
          "new_api": "decrRefCount",
          "old_text": null,
          "new_text": "decrRefCount(o)",
          "old_line_content": "    /* Lookup, check for type, and return 0 for non existing keys. */",
          "new_line_content": "        decrRefCount(o);",
          "content_same": false
        },
        {
          "line": 232,
          "old_api": null,
          "new_api": "addReplyLongLong",
          "old_text": null,
          "new_text": "addReplyLongLong(c,maxlen)",
          "old_line_content": "     * array if our string was integer encoded. */",
          "new_line_content": "    addReplyLongLong(c,maxlen); /* Return the output string length in bytes. */",
          "content_same": false
        },
        {
          "line": 105,
          "old_api": null,
          "new_api": "sdsgrowzero",
          "old_text": null,
          "new_text": "sdsgrowzero(o->ptr,byte+1)",
          "old_line_content": "/* GETBIT key offset */",
          "new_line_content": "    o->ptr = sdsgrowzero(o->ptr,byte+1);",
          "content_same": false
        },
        {
          "line": 244,
          "old_api": null,
          "new_api": "lookupKeyReadOrReply",
          "old_text": null,
          "new_text": "lookupKeyReadOrReply(c,c->argv[1],shared.czero)",
          "old_line_content": "            return;",
          "new_line_content": "    if ((o = lookupKeyReadOrReply(c,c->argv[1],shared.czero)) == NULL ||",
          "content_same": false
        },
        {
          "line": 118,
          "old_api": null,
          "new_api": "addReply",
          "old_text": null,
          "new_text": "addReply(c, bitval ? shared.cone : shared.czero)",
          "old_line_content": "",
          "new_line_content": "    addReply(c, bitval ? shared.cone : shared.czero);",
          "content_same": false
        },
        {
          "line": 251,
          "old_api": null,
          "new_api": "ll2string",
          "old_text": null,
          "new_text": "ll2string(llbuf,sizeof(llbuf),(long)o->ptr)",
          "old_line_content": "        if (end < 0) end = 0;",
          "new_line_content": "        strlen = ll2string(llbuf,sizeof(llbuf),(long)o->ptr);",
          "content_same": false
        },
        {
          "line": 254,
          "old_api": null,
          "new_api": "sdslen",
          "old_text": null,
          "new_text": "sdslen(o->ptr)",
          "old_line_content": "        /* The whole string. */",
          "new_line_content": "        strlen = sdslen(o->ptr);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 266,
          "old_api": "addReply",
          "new_api": null,
          "old_text": "addReply(c,shared.czero)",
          "new_text": null,
          "old_line_content": "        addReply(c,shared.czero);",
          "new_line_content": "        if (start < 0) start = 0;",
          "content_same": false
        },
        {
          "line": 142,
          "old_api": "strcasecmp",
          "new_api": null,
          "old_text": "strcasecmp(opname,\"and\")",
          "new_text": null,
          "old_line_content": "    if ((opname[0] == 'a' || opname[0] == 'A') && !strcasecmp(opname,\"and\"))",
          "new_line_content": "            bitval = ((char*)o->ptr)[byte] & (1 << bit);",
          "content_same": false
        },
        {
          "line": 270,
          "old_api": "popcount",
          "new_api": null,
          "old_text": "popcount(p+start,bytes)",
          "new_text": null,
          "old_line_content": "        addReplyLongLong(c,popcount(p+start,bytes));",
          "new_line_content": "        /* The whole string. */",
          "content_same": false
        },
        {
          "line": 144,
          "old_api": "strcasecmp",
          "new_api": null,
          "old_text": "strcasecmp(opname,\"or\")",
          "new_text": null,
          "old_line_content": "    else if((opname[0] == 'o' || opname[0] == 'O') && !strcasecmp(opname,\"or\"))",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 146,
          "old_api": "strcasecmp",
          "new_api": null,
          "old_text": "strcasecmp(opname,\"xor\")",
          "new_text": null,
          "old_line_content": "    else if((opname[0] == 'x' || opname[0] == 'X') && !strcasecmp(opname,\"xor\"))",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 148,
          "old_api": "strcasecmp",
          "new_api": null,
          "old_text": "strcasecmp(opname,\"not\")",
          "new_text": null,
          "old_line_content": "    else if((opname[0] == 'n' || opname[0] == 'N') && !strcasecmp(opname,\"not\"))",
          "new_line_content": "/* BITOP op_name target_key src_key1 src_key2 src_key3 ... src_keyN */",
          "content_same": false
        },
        {
          "line": 151,
          "old_api": "addReply",
          "new_api": null,
          "old_text": "addReply(c,shared.syntaxerr)",
          "new_text": null,
          "old_line_content": "        addReply(c,shared.syntaxerr);",
          "new_line_content": "    robj *o, *targetkey = c->argv[2];",
          "content_same": false
        },
        {
          "line": 157,
          "old_api": "addReplyError",
          "new_api": null,
          "old_text": "addReplyError(c,\"BITOP NOT must be called with a single source key.\")",
          "new_text": null,
          "old_line_content": "        addReplyError(c,\"BITOP NOT must be called with a single source key.\");",
          "new_line_content": "    /* Parse the operation name. */",
          "content_same": false
        },
        {
          "line": 163,
          "old_api": "zmalloc",
          "new_api": null,
          "old_text": "zmalloc(sizeof(unsigned char*) * numkeys)",
          "new_text": null,
          "old_line_content": "    src = zmalloc(sizeof(unsigned char*) * numkeys);",
          "new_line_content": "        op = BITOP_XOR;",
          "content_same": false
        },
        {
          "line": 166,
          "old_api": "lookupKeyRead",
          "new_api": null,
          "old_text": "lookupKeyRead(c->db,c->argv[j+3])",
          "new_text": null,
          "old_line_content": "        o = lookupKeyRead(c->db,c->argv[j+3]);",
          "new_line_content": "    else {",
          "content_same": false
        },
        {
          "line": 174,
          "old_api": "checkType",
          "new_api": null,
          "old_text": "checkType(c,o,REDIS_STRING)",
          "new_text": null,
          "old_line_content": "        if (checkType(c,o,REDIS_STRING)) {",
          "new_line_content": "        return;",
          "content_same": false
        },
        {
          "line": 175,
          "old_api": "zfree",
          "new_api": null,
          "old_text": "zfree(src)",
          "new_text": null,
          "old_line_content": "            zfree(src);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 176,
          "old_api": "zfree",
          "new_api": null,
          "old_text": "zfree(len)",
          "new_text": null,
          "old_line_content": "            zfree(len);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 186,
          "old_api": "sdsnewlen",
          "new_api": null,
          "old_text": "sdsnewlen(NULL,maxlen)",
          "new_text": null,
          "old_line_content": "        res = (unsigned char*) sdsnewlen(NULL,maxlen);",
          "new_line_content": "            len[j] = 0;",
          "content_same": false
        },
        {
          "line": 59,
          "old_api": "getBitOffsetFromArgument",
          "new_api": null,
          "old_text": "getBitOffsetFromArgument(c,c->argv[2],&bitoffset)",
          "new_text": null,
          "old_line_content": "    if (getBitOffsetFromArgument(c,c->argv[2],&bitoffset) != REDIS_OK)",
          "new_line_content": " * -------------------------------------------------------------------------- */",
          "content_same": false
        },
        {
          "line": 62,
          "old_api": "getLongFromObjectOrReply",
          "new_api": null,
          "old_text": "getLongFromObjectOrReply(c,c->argv[3],&on,err)",
          "new_text": null,
          "old_line_content": "    if (getLongFromObjectOrReply(c,c->argv[3],&on,err) != REDIS_OK)",
          "new_line_content": "#define BITOP_OR    1",
          "content_same": false
        },
        {
          "line": 67,
          "old_api": "addReplyError",
          "new_api": null,
          "old_text": "addReplyError(c,err)",
          "new_text": null,
          "old_line_content": "        addReplyError(c,err);",
          "new_line_content": "void setbitCommand(redisClient *c) {",
          "content_same": false
        },
        {
          "line": 71,
          "old_api": "lookupKeyWrite",
          "new_api": null,
          "old_text": "lookupKeyWrite(c->db,c->argv[1])",
          "new_text": null,
          "old_line_content": "    o = lookupKeyWrite(c->db,c->argv[1]);",
          "new_line_content": "    int byte, bit;",
          "content_same": false
        },
        {
          "line": 73,
          "old_api": "sdsempty",
          "new_api": null,
          "old_text": "sdsempty()",
          "new_text": null,
          "old_line_content": "        o = createObject(REDIS_STRING,sdsempty());",
          "new_line_content": "    long on;",
          "content_same": false
        },
        {
          "line": 74,
          "old_api": "dbAdd",
          "new_api": null,
          "old_text": "dbAdd(c->db,c->argv[1],o)",
          "new_text": null,
          "old_line_content": "        dbAdd(c->db,c->argv[1],o);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 76,
          "old_api": "checkType",
          "new_api": null,
          "old_text": "checkType(c,o,REDIS_STRING)",
          "new_text": null,
          "old_line_content": "        if (checkType(c,o,REDIS_STRING)) return;",
          "new_line_content": "        return;",
          "content_same": false
        },
        {
          "line": 204,
          "old_api": "zfree",
          "new_api": null,
          "old_text": "zfree(src)",
          "new_text": null,
          "old_line_content": "    zfree(src);",
          "new_line_content": "        long i;",
          "content_same": false
        },
        {
          "line": 205,
          "old_api": "zfree",
          "new_api": null,
          "old_text": "zfree(len)",
          "new_text": null,
          "old_line_content": "    zfree(len);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 80,
          "old_api": "getDecodedObject",
          "new_api": null,
          "old_text": "getDecodedObject(o)",
          "new_text": null,
          "old_line_content": "            robj *decoded = getDecodedObject(o);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 81,
          "old_api": "sdslen",
          "new_api": null,
          "old_text": "sdslen(decoded->ptr)",
          "new_text": null,
          "old_line_content": "            o = createStringObject(decoded->ptr, sdslen(decoded->ptr));",
          "new_line_content": "    /* Bits can only be set or cleared... */",
          "content_same": false
        },
        {
          "line": 82,
          "old_api": "decrRefCount",
          "new_api": null,
          "old_text": "decrRefCount(decoded)",
          "new_text": null,
          "old_line_content": "            decrRefCount(decoded);",
          "new_line_content": "    if (on & ~1) {",
          "content_same": false
        },
        {
          "line": 209,
          "old_api": "createObject",
          "new_api": null,
          "old_text": "createObject(REDIS_STRING,res)",
          "new_text": null,
          "old_line_content": "        o = createObject(REDIS_STRING,res);",
          "new_line_content": "            for (i = 1; i < numkeys; i++) {",
          "content_same": false
        },
        {
          "line": 210,
          "old_api": "setKey",
          "new_api": null,
          "old_text": "setKey(c->db,targetkey,o)",
          "new_text": null,
          "old_line_content": "        setKey(c->db,targetkey,o);",
          "new_line_content": "                byte = (len[i] <= j) ? 0 : src[i][j];",
          "content_same": false
        },
        {
          "line": 211,
          "old_api": "decrRefCount",
          "new_api": null,
          "old_text": "decrRefCount(o)",
          "new_text": null,
          "old_line_content": "        decrRefCount(o);",
          "new_line_content": "                switch(op) {",
          "content_same": false
        },
        {
          "line": 212,
          "old_api": "dbDelete",
          "new_api": null,
          "old_text": "dbDelete(c->db,targetkey)",
          "new_text": null,
          "old_line_content": "    } else if (dbDelete(c->db,targetkey)) {",
          "new_line_content": "                case BITOP_AND: output &= byte; break;",
          "content_same": false
        },
        {
          "line": 213,
          "old_api": "signalModifiedKey",
          "new_api": null,
          "old_text": "signalModifiedKey(c->db,targetkey)",
          "new_text": null,
          "old_line_content": "        signalModifiedKey(c->db,targetkey);",
          "new_line_content": "                case BITOP_OR:  output |= byte; break;",
          "content_same": false
        },
        {
          "line": 216,
          "old_api": "addReplyLongLong",
          "new_api": null,
          "old_text": "addReplyLongLong(c,maxlen)",
          "new_text": null,
          "old_line_content": "    addReplyLongLong(c,maxlen); /* Return the output string length in bytes. */",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 100,
          "old_api": "signalModifiedKey",
          "new_api": null,
          "old_text": "signalModifiedKey(c->db,c->argv[1])",
          "new_text": null,
          "old_line_content": "    signalModifiedKey(c->db,c->argv[1]);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 102,
          "old_api": "addReply",
          "new_api": null,
          "old_text": "addReply(c, bitval ? shared.cone : shared.czero)",
          "new_text": null,
          "old_line_content": "    addReply(c, bitval ? shared.cone : shared.czero);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 235,
          "old_api": "ll2string",
          "new_api": null,
          "old_text": "ll2string(llbuf,sizeof(llbuf),(long)o->ptr)",
          "new_text": null,
          "old_line_content": "        strlen = ll2string(llbuf,sizeof(llbuf),(long)o->ptr);",
          "new_line_content": "/* BITCOUNT key [start end] */",
          "content_same": false
        },
        {
          "line": 238,
          "old_api": "sdslen",
          "new_api": null,
          "old_text": "sdslen(o->ptr)",
          "new_text": null,
          "old_line_content": "        strlen = sdslen(o->ptr);",
          "new_line_content": "    long start, end;",
          "content_same": false
        },
        {
          "line": 113,
          "old_api": "getBitOffsetFromArgument",
          "new_api": null,
          "old_text": "getBitOffsetFromArgument(c,c->argv[2],&bitoffset)",
          "new_text": null,
          "old_line_content": "    if (getBitOffsetFromArgument(c,c->argv[2],&bitoffset) != REDIS_OK)",
          "new_line_content": "    byteval &= ~(1 << bit);",
          "content_same": false
        },
        {
          "line": 243,
          "old_api": "getLongFromObjectOrReply",
          "new_api": null,
          "old_text": "getLongFromObjectOrReply(c,c->argv[2],&start,NULL)",
          "new_text": null,
          "old_line_content": "        if (getLongFromObjectOrReply(c,c->argv[2],&start,NULL) != REDIS_OK)",
          "new_line_content": "    /* Lookup, check for type, and return 0 for non existing keys. */",
          "content_same": false
        },
        {
          "line": 117,
          "old_api": "checkType",
          "new_api": null,
          "old_text": "checkType(c,o,REDIS_STRING)",
          "new_text": null,
          "old_line_content": "        checkType(c,o,REDIS_STRING)) return;",
          "new_line_content": "    server.dirty++;",
          "content_same": false
        },
        {
          "line": 122,
          "old_api": "ll2string",
          "new_api": null,
          "old_text": "ll2string(llbuf,sizeof(llbuf),(long)o->ptr)",
          "new_text": null,
          "old_line_content": "        if (byte < (size_t)ll2string(llbuf,sizeof(llbuf),(long)o->ptr))",
          "new_line_content": "void getbitCommand(redisClient *c) {",
          "content_same": false
        },
        {
          "line": 125,
          "old_api": "sdslen",
          "new_api": null,
          "old_text": "sdslen(o->ptr)",
          "new_text": null,
          "old_line_content": "        if (byte < sdslen(o->ptr))",
          "new_line_content": "    size_t bitoffset;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 10,
      "total_additions": 42,
      "total_deletions": 41,
      "total_api_changes": 93
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 19,
        "api_related_lines": 93,
        "non_api_lines": 18,
        "non_api_line_numbers": [
          33,
          34,
          36,
          37,
          38,
          39,
          40,
          41,
          42,
          44,
          45,
          46,
          47,
          48,
          49,
          50,
          51,
          52
        ]
      }
    },
    "api_calls_before": 56,
    "api_calls_after": 57,
    "diff_info": {
      "added_lines": 18,
      "removed_lines": 2,
      "total_diff_lines": 34
    }
  }
}