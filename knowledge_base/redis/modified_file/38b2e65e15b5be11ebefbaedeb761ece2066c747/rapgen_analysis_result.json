{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/redis/modified_file/38b2e65e15b5be11ebefbaedeb761ece2066c747",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/redis/modified_file/38b2e65e15b5be11ebefbaedeb761ece2066c747/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/redis/modified_file/38b2e65e15b5be11ebefbaedeb761ece2066c747/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/redis/modified_file/38b2e65e15b5be11ebefbaedeb761ece2066c747/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 379,
          "old_api": "decrRefCount",
          "new_api": "sdsRemoveFreeSpace",
          "old_text": "decrRefCount(o)",
          "new_text": "sdsRemoveFreeSpace(o->ptr)",
          "old_line_content": "        decrRefCount(o);",
          "new_line_content": "                o->ptr = sdsRemoveFreeSpace(o->ptr);",
          "content_same": false
        },
        {
          "line": 395,
          "old_api": "sdsEncodedObject",
          "new_api": "incrRefCount",
          "old_text": "sdsEncodedObject(o)",
          "new_text": "incrRefCount(shared.integers[value])",
          "old_line_content": "    if (sdsEncodedObject(o)) {",
          "new_line_content": "        incrRefCount(shared.integers[value]);",
          "content_same": false
        },
        {
          "line": 442,
          "old_api": "strcoll",
          "new_api": "sdsEncodedObject",
          "old_text": "strcoll(astr,bstr)",
          "new_text": "sdsEncodedObject(a)",
          "old_line_content": "        return strcoll(astr,bstr);",
          "new_line_content": "    if (sdsEncodedObject(a)) {",
          "content_same": false
        },
        {
          "line": 496,
          "old_api": "redisAssertWithInfo",
          "new_api": "sdslen",
          "old_text": "redisAssertWithInfo(NULL,o,o->type == REDIS_STRING)",
          "new_text": "sdslen(o->ptr)",
          "old_line_content": "        redisAssertWithInfo(NULL,o,o->type == REDIS_STRING);",
          "new_line_content": "        return sdslen(o->ptr);",
          "content_same": false
        },
        {
          "line": 500,
          "old_api": "isspace",
          "new_api": "ll2string",
          "old_text": "isspace(((char*)o->ptr)[0])",
          "new_text": "ll2string(buf,32,(long)o->ptr)",
          "old_line_content": "            if (isspace(((char*)o->ptr)[0]) ||",
          "new_line_content": "        return ll2string(buf,32,(long)o->ptr);",
          "content_same": false
        },
        {
          "line": 538,
          "old_api": "redisAssertWithInfo",
          "new_api": "addReplyError",
          "old_text": "redisAssertWithInfo(NULL,o,o->type == REDIS_STRING)",
          "new_text": "addReplyError(c,\"value is not a valid float\")",
          "old_line_content": "        redisAssertWithInfo(NULL,o,o->type == REDIS_STRING);",
          "new_line_content": "            addReplyError(c,\"value is not a valid float\");",
          "content_same": false
        },
        {
          "line": 557,
          "old_api": "getLongDoubleFromObject",
          "new_api": "isspace",
          "old_text": "getLongDoubleFromObject(o, &value)",
          "new_text": "isspace(((char*)o->ptr)[0])",
          "old_line_content": "    if (getLongDoubleFromObject(o, &value) != REDIS_OK) {",
          "new_line_content": "            if (isspace(((char*)o->ptr)[0]) || eptr[0] != '\\0' ||",
          "content_same": false
        },
        {
          "line": 576,
          "old_api": "redisAssertWithInfo",
          "new_api": "addReplyError",
          "old_text": "redisAssertWithInfo(NULL,o,o->type == REDIS_STRING)",
          "new_text": "addReplyError(c,\"value is not a valid float\")",
          "old_line_content": "        redisAssertWithInfo(NULL,o,o->type == REDIS_STRING);",
          "new_line_content": "            addReplyError(c,\"value is not a valid float\");",
          "content_same": false
        },
        {
          "line": 595,
          "old_api": "getLongLongFromObject",
          "new_api": "isspace",
          "old_text": "getLongLongFromObject(o, &value)",
          "new_text": "isspace(((char*)o->ptr)[0])",
          "old_line_content": "    if (getLongLongFromObject(o, &value) != REDIS_OK) {",
          "new_line_content": "            if (isspace(((char*)o->ptr)[0]) || eptr[0] != '\\0' ||",
          "content_same": false
        },
        {
          "line": 610,
          "old_api": "getLongLongFromObjectOrReply",
          "new_api": "getLongLongFromObject",
          "old_text": "getLongLongFromObjectOrReply(c, o, &value, msg)",
          "new_text": "getLongLongFromObject(o, &value)",
          "old_line_content": "    if (getLongLongFromObjectOrReply(c, o, &value, msg) != REDIS_OK) return REDIS_ERR;",
          "new_line_content": "    if (getLongLongFromObject(o, &value) != REDIS_OK) {",
          "content_same": false
        },
        {
          "line": 669,
          "old_api": "strcasecmp",
          "new_api": "dictGetVal",
          "old_text": "strcasecmp(c->argv[1]->ptr,\"refcount\")",
          "new_text": "dictGetVal(de)",
          "old_line_content": "    if (!strcasecmp(c->argv[1]->ptr,\"refcount\") && c->argc == 3) {",
          "new_line_content": "    return (robj*) dictGetVal(de);",
          "content_same": false
        },
        {
          "line": 673,
          "old_api": "strcasecmp",
          "new_api": "objectCommandLookup",
          "old_text": "strcasecmp(c->argv[1]->ptr,\"encoding\")",
          "new_text": "objectCommandLookup(c,key)",
          "old_line_content": "    } else if (!strcasecmp(c->argv[1]->ptr,\"encoding\") && c->argc == 3) {",
          "new_line_content": "    robj *o = objectCommandLookup(c,key);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 512,
          "old_api": null,
          "new_api": "sdsEncodedObject",
          "old_text": null,
          "new_text": "sdsEncodedObject(o)",
          "old_line_content": "    }",
          "new_line_content": "        if (sdsEncodedObject(o)) {",
          "content_same": false
        },
        {
          "line": 514,
          "old_api": null,
          "new_api": "strtod",
          "old_text": null,
          "new_text": "strtod(o->ptr, &eptr)",
          "old_line_content": "    return REDIS_OK;",
          "new_line_content": "            value = strtod(o->ptr, &eptr);",
          "content_same": false
        },
        {
          "line": 515,
          "old_api": null,
          "new_api": "isspace",
          "old_text": null,
          "new_text": "isspace(((char*)o->ptr)[0])",
          "old_line_content": "}",
          "new_line_content": "            if (isspace(((char*)o->ptr)[0]) ||",
          "content_same": false
        },
        {
          "line": 520,
          "old_api": null,
          "new_api": "isnan",
          "old_text": null,
          "new_text": "isnan(value)",
          "old_line_content": "        if (msg != NULL) {",
          "new_line_content": "                isnan(value))",
          "content_same": false
        },
        {
          "line": 394,
          "old_api": null,
          "new_api": "decrRefCount",
          "old_text": null,
          "new_text": "decrRefCount(o)",
          "old_line_content": "",
          "new_line_content": "        decrRefCount(o);",
          "content_same": false
        },
        {
          "line": 525,
          "old_api": null,
          "new_api": "redisPanic",
          "old_text": null,
          "new_text": "redisPanic(\"Unknown string encoding\")",
          "old_line_content": "        return REDIS_ERR;",
          "new_line_content": "            redisPanic(\"Unknown string encoding\");",
          "content_same": false
        },
        {
          "line": 398,
          "old_api": null,
          "new_api": "sdsfree",
          "old_text": null,
          "new_text": "sdsfree(o->ptr)",
          "old_line_content": "    }",
          "new_line_content": "        if (o->encoding == REDIS_ENCODING_RAW) sdsfree(o->ptr);",
          "content_same": false
        },
        {
          "line": 534,
          "old_api": null,
          "new_api": "getDoubleFromObject",
          "old_text": null,
          "new_text": "getDoubleFromObject(o, &value)",
          "old_line_content": "",
          "new_line_content": "    if (getDoubleFromObject(o, &value) != REDIS_OK) {",
          "content_same": false
        },
        {
          "line": 536,
          "old_api": null,
          "new_api": "addReplyError",
          "old_text": null,
          "new_text": "addReplyError(c,(char*)msg)",
          "old_line_content": "        value = 0;",
          "new_line_content": "            addReplyError(c,(char*)msg);",
          "content_same": false
        },
        {
          "line": 410,
          "old_api": null,
          "new_api": "sdsEncodedObject",
          "old_text": null,
          "new_text": "sdsEncodedObject(o)",
          "old_line_content": "/* Compare two string objects via strcmp() or strcoll() depending on flags.",
          "new_line_content": "    if (sdsEncodedObject(o)) {",
          "content_same": false
        },
        {
          "line": 411,
          "old_api": null,
          "new_api": "incrRefCount",
          "old_text": null,
          "new_text": "incrRefCount(o)",
          "old_line_content": " * Note that the objects may be integer-encoded. In such a case we",
          "new_line_content": "        incrRefCount(o);",
          "content_same": false
        },
        {
          "line": 668,
          "old_api": null,
          "new_api": "dictFind",
          "old_text": null,
          "new_text": "dictFind(c->db->dict,key->ptr)",
          "old_line_content": "",
          "new_line_content": "    if ((de = dictFind(c->db->dict,key->ptr)) == NULL) return NULL;",
          "content_same": false
        },
        {
          "line": 417,
          "old_api": null,
          "new_api": "ll2string",
          "old_text": null,
          "new_text": "ll2string(buf,32,(long)o->ptr)",
          "old_line_content": "",
          "new_line_content": "        ll2string(buf,32,(long)o->ptr);",
          "content_same": false
        },
        {
          "line": 418,
          "old_api": null,
          "new_api": "strlen",
          "old_text": null,
          "new_text": "strlen(buf)",
          "old_line_content": "#define REDIS_COMPARE_BINARY (1<<0)",
          "new_line_content": "        dec = createStringObject(buf,strlen(buf));",
          "content_same": false
        },
        {
          "line": 675,
          "old_api": null,
          "new_api": "addReply",
          "old_text": null,
          "new_text": "addReply(c, reply)",
          "old_line_content": "                == NULL) return;",
          "new_line_content": "    if (!o) addReply(c, reply);",
          "content_same": false
        },
        {
          "line": 421,
          "old_api": null,
          "new_api": "redisPanic",
          "old_text": null,
          "new_text": "redisPanic(\"Unknown encoding type\")",
          "old_line_content": "int compareStringObjectsWithFlags(robj *a, robj *b, int flags) {",
          "new_line_content": "        redisPanic(\"Unknown encoding type\");",
          "content_same": false
        },
        {
          "line": 553,
          "old_api": null,
          "new_api": "redisAssertWithInfo",
          "old_text": null,
          "new_text": "redisAssertWithInfo(NULL,o,o->type == REDIS_STRING)",
          "old_line_content": "}",
          "new_line_content": "        redisAssertWithInfo(NULL,o,o->type == REDIS_STRING);",
          "content_same": false
        },
        {
          "line": 554,
          "old_api": null,
          "new_api": "sdsEncodedObject",
          "old_text": null,
          "new_text": "sdsEncodedObject(o)",
          "old_line_content": "",
          "new_line_content": "        if (sdsEncodedObject(o)) {",
          "content_same": false
        },
        {
          "line": 556,
          "old_api": null,
          "new_api": "strtold",
          "old_text": null,
          "new_text": "strtold(o->ptr, &eptr)",
          "old_line_content": "    long double value;",
          "new_line_content": "            value = strtold(o->ptr, &eptr);",
          "content_same": false
        },
        {
          "line": 684,
          "old_api": null,
          "new_api": "strcasecmp",
          "old_text": null,
          "new_text": "strcasecmp(c->argv[1]->ptr,\"refcount\")",
          "old_line_content": "}",
          "new_line_content": "    if (!strcasecmp(c->argv[1]->ptr,\"refcount\") && c->argc == 3) {",
          "content_same": false
        },
        {
          "line": 558,
          "old_api": null,
          "new_api": "isnan",
          "old_text": null,
          "new_text": "isnan(value)",
          "old_line_content": "        if (msg != NULL) {",
          "new_line_content": "                errno == ERANGE || isnan(value))",
          "content_same": false
        },
        {
          "line": 685,
          "old_api": null,
          "new_api": "objectCommandLookupOrReply",
          "old_text": null,
          "new_text": "objectCommandLookupOrReply(c,c->argv[2],shared.nullbulk)",
          "old_line_content": "",
          "new_line_content": "        if ((o = objectCommandLookupOrReply(c,c->argv[2],shared.nullbulk))",
          "content_same": false
        },
        {
          "line": 687,
          "old_api": null,
          "new_api": "addReplyLongLong",
          "old_text": null,
          "new_text": "addReplyLongLong(c,o->refcount)",
          "old_line_content": "",
          "new_line_content": "        addReplyLongLong(c,o->refcount);",
          "content_same": false
        },
        {
          "line": 688,
          "old_api": null,
          "new_api": "strcasecmp",
          "old_text": null,
          "new_text": "strcasecmp(c->argv[1]->ptr,\"encoding\")",
          "old_line_content": "",
          "new_line_content": "    } else if (!strcasecmp(c->argv[1]->ptr,\"encoding\") && c->argc == 3) {",
          "content_same": false
        },
        {
          "line": 689,
          "old_api": null,
          "new_api": "objectCommandLookupOrReply",
          "old_text": null,
          "new_text": "objectCommandLookupOrReply(c,c->argv[2],shared.nullbulk)",
          "old_line_content": "",
          "new_line_content": "        if ((o = objectCommandLookupOrReply(c,c->argv[2],shared.nullbulk))",
          "content_same": false
        },
        {
          "line": 563,
          "old_api": null,
          "new_api": "redisPanic",
          "old_text": null,
          "new_text": "redisPanic(\"Unknown string encoding\")",
          "old_line_content": "        return REDIS_ERR;",
          "new_line_content": "            redisPanic(\"Unknown string encoding\");",
          "content_same": false
        },
        {
          "line": 691,
          "old_api": null,
          "new_api": "strEncoding",
          "old_text": null,
          "new_text": "strEncoding(o->encoding)",
          "old_line_content": "",
          "new_line_content": "        addReplyBulkCString(c,strEncoding(o->encoding));",
          "content_same": false
        },
        {
          "line": 692,
          "old_api": null,
          "new_api": "strcasecmp",
          "old_text": null,
          "new_text": "strcasecmp(c->argv[1]->ptr,\"idletime\")",
          "old_line_content": "",
          "new_line_content": "    } else if (!strcasecmp(c->argv[1]->ptr,\"idletime\") && c->argc == 3) {",
          "content_same": false
        },
        {
          "line": 693,
          "old_api": null,
          "new_api": "objectCommandLookupOrReply",
          "old_text": null,
          "new_text": "objectCommandLookupOrReply(c,c->argv[2],shared.nullbulk)",
          "old_line_content": "",
          "new_line_content": "        if ((o = objectCommandLookupOrReply(c,c->argv[2],shared.nullbulk))",
          "content_same": false
        },
        {
          "line": 695,
          "old_api": null,
          "new_api": "estimateObjectIdleTime",
          "old_text": null,
          "new_text": "estimateObjectIdleTime(o)",
          "old_line_content": "",
          "new_line_content": "        addReplyLongLong(c,estimateObjectIdleTime(o));",
          "content_same": false
        },
        {
          "line": 437,
          "old_api": null,
          "new_api": "redisAssertWithInfo",
          "old_text": null,
          "new_text": "redisAssertWithInfo(NULL,a,a->type == REDIS_STRING && b->type == REDIS_STRING)",
          "old_line_content": "    } else {",
          "new_line_content": "    redisAssertWithInfo(NULL,a,a->type == REDIS_STRING && b->type == REDIS_STRING);",
          "content_same": false
        },
        {
          "line": 697,
          "old_api": null,
          "new_api": "addReplyError",
          "old_text": null,
          "new_text": "addReplyError(c,\"Syntax error. Try OBJECT (refcount|encoding|idletime)\")",
          "old_line_content": "",
          "new_line_content": "        addReplyError(c,\"Syntax error. Try OBJECT (refcount|encoding|idletime)\");",
          "content_same": false
        },
        {
          "line": 572,
          "old_api": null,
          "new_api": "getLongDoubleFromObject",
          "old_text": null,
          "new_text": "getLongDoubleFromObject(o, &value)",
          "old_line_content": "",
          "new_line_content": "    if (getLongDoubleFromObject(o, &value) != REDIS_OK) {",
          "content_same": false
        },
        {
          "line": 444,
          "old_api": null,
          "new_api": "sdslen",
          "old_text": null,
          "new_text": "sdslen(astr)",
          "old_line_content": "        int cmp;",
          "new_line_content": "        alen = sdslen(astr);",
          "content_same": false
        },
        {
          "line": 574,
          "old_api": null,
          "new_api": "addReplyError",
          "old_text": null,
          "new_text": "addReplyError(c,(char*)msg)",
          "old_line_content": "        value = 0;",
          "new_line_content": "            addReplyError(c,(char*)msg);",
          "content_same": false
        },
        {
          "line": 446,
          "old_api": null,
          "new_api": "ll2string",
          "old_text": null,
          "new_text": "ll2string(bufa,sizeof(bufa),(long) a->ptr)",
          "old_line_content": "        minlen = (alen < blen) ? alen : blen;",
          "new_line_content": "        alen = ll2string(bufa,sizeof(bufa),(long) a->ptr);",
          "content_same": false
        },
        {
          "line": 449,
          "old_api": null,
          "new_api": "sdsEncodedObject",
          "old_text": null,
          "new_text": "sdsEncodedObject(b)",
          "old_line_content": "        return cmp;",
          "new_line_content": "    if (sdsEncodedObject(b)) {",
          "content_same": false
        },
        {
          "line": 451,
          "old_api": null,
          "new_api": "sdslen",
          "old_text": null,
          "new_text": "sdslen(bstr)",
          "old_line_content": "}",
          "new_line_content": "        blen = sdslen(bstr);",
          "content_same": false
        },
        {
          "line": 453,
          "old_api": null,
          "new_api": "ll2string",
          "old_text": null,
          "new_text": "ll2string(bufb,sizeof(bufb),(long) b->ptr)",
          "old_line_content": "/* Wrapper for compareStringObjectsWithFlags() using binary comparison. */",
          "new_line_content": "        blen = ll2string(bufb,sizeof(bufb),(long) b->ptr);",
          "content_same": false
        },
        {
          "line": 457,
          "old_api": null,
          "new_api": "strcoll",
          "old_text": null,
          "new_text": "strcoll(astr,bstr)",
          "old_line_content": "",
          "new_line_content": "        return strcoll(astr,bstr);",
          "content_same": false
        },
        {
          "line": 462,
          "old_api": null,
          "new_api": "memcmp",
          "old_text": null,
          "new_text": "memcmp(astr,bstr,minlen)",
          "old_line_content": "",
          "new_line_content": "        cmp = memcmp(astr,bstr,minlen);",
          "content_same": false
        },
        {
          "line": 591,
          "old_api": null,
          "new_api": "redisAssertWithInfo",
          "old_text": null,
          "new_text": "redisAssertWithInfo(NULL,o,o->type == REDIS_STRING)",
          "old_line_content": "}",
          "new_line_content": "        redisAssertWithInfo(NULL,o,o->type == REDIS_STRING);",
          "content_same": false
        },
        {
          "line": 592,
          "old_api": null,
          "new_api": "sdsEncodedObject",
          "old_text": null,
          "new_text": "sdsEncodedObject(o)",
          "old_line_content": "",
          "new_line_content": "        if (sdsEncodedObject(o)) {",
          "content_same": false
        },
        {
          "line": 594,
          "old_api": null,
          "new_api": "strtoll",
          "old_text": null,
          "new_text": "strtoll(o->ptr, &eptr, 10)",
          "old_line_content": "    long long value;",
          "new_line_content": "            value = strtoll(o->ptr, &eptr, 10);",
          "content_same": false
        },
        {
          "line": 470,
          "old_api": null,
          "new_api": "compareStringObjectsWithFlags",
          "old_text": null,
          "new_text": "compareStringObjectsWithFlags(a,b,REDIS_COMPARE_BINARY)",
          "old_line_content": "        /* If both strings are integer encoded just check if the stored",
          "new_line_content": "    return compareStringObjectsWithFlags(a,b,REDIS_COMPARE_BINARY);",
          "content_same": false
        },
        {
          "line": 601,
          "old_api": null,
          "new_api": "redisPanic",
          "old_text": null,
          "new_text": "redisPanic(\"Unknown string encoding\")",
          "old_line_content": "        return REDIS_ERR;",
          "new_line_content": "            redisPanic(\"Unknown string encoding\");",
          "content_same": false
        },
        {
          "line": 475,
          "old_api": null,
          "new_api": "compareStringObjectsWithFlags",
          "old_text": null,
          "new_text": "compareStringObjectsWithFlags(a,b,REDIS_COMPARE_COLL)",
          "old_line_content": "    }",
          "new_line_content": "    return compareStringObjectsWithFlags(a,b,REDIS_COMPARE_COLL);",
          "content_same": false
        },
        {
          "line": 612,
          "old_api": null,
          "new_api": "addReplyError",
          "old_text": null,
          "new_text": "addReplyError(c,(char*)msg)",
          "old_line_content": "        if (msg != NULL) {",
          "new_line_content": "            addReplyError(c,(char*)msg);",
          "content_same": false
        },
        {
          "line": 614,
          "old_api": null,
          "new_api": "addReplyError",
          "old_text": null,
          "new_text": "addReplyError(c,\"value is not an integer or out of range\")",
          "old_line_content": "        } else {",
          "new_line_content": "            addReplyError(c,\"value is not an integer or out of range\");",
          "content_same": false
        },
        {
          "line": 489,
          "old_api": null,
          "new_api": "compareStringObjects",
          "old_text": null,
          "new_text": "compareStringObjects(a,b)",
          "old_line_content": "int getDoubleFromObject(robj *o, double *target) {",
          "new_line_content": "        return compareStringObjects(a,b) == 0;",
          "content_same": false
        },
        {
          "line": 494,
          "old_api": null,
          "new_api": "redisAssertWithInfo",
          "old_text": null,
          "new_text": "redisAssertWithInfo(NULL,o,o->type == REDIS_STRING)",
          "old_line_content": "        value = 0;",
          "new_line_content": "    redisAssertWithInfo(NULL,o,o->type == REDIS_STRING);",
          "content_same": false
        },
        {
          "line": 495,
          "old_api": null,
          "new_api": "sdsEncodedObject",
          "old_text": null,
          "new_text": "sdsEncodedObject(o)",
          "old_line_content": "    } else {",
          "new_line_content": "    if (sdsEncodedObject(o)) {",
          "content_same": false
        },
        {
          "line": 625,
          "old_api": null,
          "new_api": "getLongLongFromObjectOrReply",
          "old_text": null,
          "new_text": "getLongLongFromObjectOrReply(c, o, &value, msg)",
          "old_line_content": "    case REDIS_ENCODING_RAW: return \"raw\";",
          "new_line_content": "    if (getLongLongFromObjectOrReply(c, o, &value, msg) != REDIS_OK) return REDIS_ERR;",
          "content_same": false
        },
        {
          "line": 628,
          "old_api": null,
          "new_api": "addReplyError",
          "old_text": null,
          "new_text": "addReplyError(c,(char*)msg)",
          "old_line_content": "    case REDIS_ENCODING_LINKEDLIST: return \"linkedlist\";",
          "new_line_content": "            addReplyError(c,(char*)msg);",
          "content_same": false
        },
        {
          "line": 630,
          "old_api": null,
          "new_api": "addReplyError",
          "old_text": null,
          "new_text": "addReplyError(c,\"value is out of range\")",
          "old_line_content": "    case REDIS_ENCODING_INTSET: return \"intset\";",
          "new_line_content": "            addReplyError(c,\"value is out of range\");",
          "content_same": false
        },
        {
          "line": 377,
          "old_api": null,
          "new_api": "sdsavail",
          "old_text": null,
          "new_text": "sdsavail(s)",
          "old_line_content": "     * algorithm to work well. */",
          "new_line_content": "                sdsavail(s) > len/10)",
          "content_same": false
        },
        {
          "line": 511,
          "old_api": null,
          "new_api": "redisAssertWithInfo",
          "old_text": null,
          "new_text": "redisAssertWithInfo(NULL,o,o->type == REDIS_STRING)",
          "old_line_content": "        }",
          "new_line_content": "        redisAssertWithInfo(NULL,o,o->type == REDIS_STRING);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 519,
          "old_api": "getDoubleFromObject",
          "new_api": null,
          "old_text": "getDoubleFromObject(o, &value)",
          "new_text": null,
          "old_line_content": "    if (getDoubleFromObject(o, &value) != REDIS_OK) {",
          "new_line_content": "                errno == EINVAL ||",
          "content_same": false
        },
        {
          "line": 521,
          "old_api": "addReplyError",
          "new_api": null,
          "old_text": "addReplyError(c,(char*)msg)",
          "new_text": null,
          "old_line_content": "            addReplyError(c,(char*)msg);",
          "new_line_content": "                return REDIS_ERR;",
          "content_same": false
        },
        {
          "line": 523,
          "old_api": "addReplyError",
          "new_api": null,
          "old_text": "addReplyError(c,\"value is not a valid float\")",
          "new_text": null,
          "old_line_content": "            addReplyError(c,\"value is not a valid float\");",
          "new_line_content": "            value = (long)o->ptr;",
          "content_same": false
        },
        {
          "line": 396,
          "old_api": "incrRefCount",
          "new_api": null,
          "old_text": "incrRefCount(o)",
          "new_text": null,
          "old_line_content": "        incrRefCount(o);",
          "new_line_content": "        return shared.integers[value];",
          "content_same": false
        },
        {
          "line": 653,
          "old_api": "dictFind",
          "new_api": null,
          "old_text": "dictFind(c->db->dict,key->ptr)",
          "new_text": null,
          "old_line_content": "    if ((de = dictFind(c->db->dict,key->ptr)) == NULL) return NULL;",
          "new_line_content": " * requested, using an approximated LRU algorithm. */",
          "content_same": false
        },
        {
          "line": 654,
          "old_api": "dictGetVal",
          "new_api": null,
          "old_text": "dictGetVal(de)",
          "new_text": null,
          "old_line_content": "    return (robj*) dictGetVal(de);",
          "new_line_content": "unsigned long estimateObjectIdleTime(robj *o) {",
          "content_same": false
        },
        {
          "line": 658,
          "old_api": "objectCommandLookup",
          "new_api": null,
          "old_text": "objectCommandLookup(c,key)",
          "new_text": null,
          "old_line_content": "    robj *o = objectCommandLookup(c,key);",
          "new_line_content": "        return ((REDIS_LRU_CLOCK_MAX - o->lru) + server.lruclock) *",
          "content_same": false
        },
        {
          "line": 402,
          "old_api": "ll2string",
          "new_api": null,
          "old_text": "ll2string(buf,32,(long)o->ptr)",
          "new_text": null,
          "old_line_content": "        ll2string(buf,32,(long)o->ptr);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 660,
          "old_api": "addReply",
          "new_api": null,
          "old_text": "addReply(c, reply)",
          "new_text": null,
          "old_line_content": "    if (!o) addReply(c, reply);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 403,
          "old_api": "strlen",
          "new_api": null,
          "old_text": "strlen(buf)",
          "new_text": null,
          "old_line_content": "        dec = createStringObject(buf,strlen(buf));",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 406,
          "old_api": "redisPanic",
          "new_api": null,
          "old_text": "redisPanic(\"Unknown encoding type\")",
          "new_text": null,
          "old_line_content": "        redisPanic(\"Unknown encoding type\");",
          "new_line_content": " * If the object is already raw-encoded just increment the ref count. */",
          "content_same": false
        },
        {
          "line": 539,
          "old_api": "sdsEncodedObject",
          "new_api": null,
          "old_text": "sdsEncodedObject(o)",
          "new_text": null,
          "old_line_content": "        if (sdsEncodedObject(o)) {",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 541,
          "old_api": "strtold",
          "new_api": null,
          "old_text": "strtold(o->ptr, &eptr)",
          "new_text": null,
          "old_line_content": "            value = strtold(o->ptr, &eptr);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 542,
          "old_api": "isspace",
          "new_api": null,
          "old_text": "isspace(((char*)o->ptr)[0])",
          "new_text": null,
          "old_line_content": "            if (isspace(((char*)o->ptr)[0]) || eptr[0] != '\\0' ||",
          "new_line_content": "    *target = value;",
          "content_same": false
        },
        {
          "line": 543,
          "old_api": "isnan",
          "new_api": null,
          "old_text": "isnan(value)",
          "new_text": null,
          "old_line_content": "                errno == ERANGE || isnan(value))",
          "new_line_content": "    return REDIS_OK;",
          "content_same": false
        },
        {
          "line": 670,
          "old_api": "objectCommandLookupOrReply",
          "new_api": null,
          "old_text": "objectCommandLookupOrReply(c,c->argv[2],shared.nullbulk)",
          "new_text": null,
          "old_line_content": "        if ((o = objectCommandLookupOrReply(c,c->argv[2],shared.nullbulk))",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 672,
          "old_api": "addReplyLongLong",
          "new_api": null,
          "old_text": "addReplyLongLong(c,o->refcount)",
          "new_text": null,
          "old_line_content": "        addReplyLongLong(c,o->refcount);",
          "new_line_content": "robj *objectCommandLookupOrReply(redisClient *c, robj *key, robj *reply) {",
          "content_same": false
        },
        {
          "line": 674,
          "old_api": "objectCommandLookupOrReply",
          "new_api": null,
          "old_text": "objectCommandLookupOrReply(c,c->argv[2],shared.nullbulk)",
          "new_text": null,
          "old_line_content": "        if ((o = objectCommandLookupOrReply(c,c->argv[2],shared.nullbulk))",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 548,
          "old_api": "redisPanic",
          "new_api": null,
          "old_text": "redisPanic(\"Unknown string encoding\")",
          "new_text": null,
          "old_line_content": "            redisPanic(\"Unknown string encoding\");",
          "new_line_content": "    char *eptr;",
          "content_same": false
        },
        {
          "line": 676,
          "old_api": "strEncoding",
          "new_api": null,
          "old_text": "strEncoding(o->encoding)",
          "new_text": null,
          "old_line_content": "        addReplyBulkCString(c,strEncoding(o->encoding));",
          "new_line_content": "    return o;",
          "content_same": false
        },
        {
          "line": 677,
          "old_api": "strcasecmp",
          "new_api": null,
          "old_text": "strcasecmp(c->argv[1]->ptr,\"idletime\")",
          "new_text": null,
          "old_line_content": "    } else if (!strcasecmp(c->argv[1]->ptr,\"idletime\") && c->argc == 3) {",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 678,
          "old_api": "objectCommandLookupOrReply",
          "new_api": null,
          "old_text": "objectCommandLookupOrReply(c,c->argv[2],shared.nullbulk)",
          "new_text": null,
          "old_line_content": "        if ((o = objectCommandLookupOrReply(c,c->argv[2],shared.nullbulk))",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 680,
          "old_api": "estimateObjectIdleTime",
          "new_api": null,
          "old_text": "estimateObjectIdleTime(o)",
          "new_text": null,
          "old_line_content": "        addReplyLongLong(c,estimateObjectIdleTime(o));",
          "new_line_content": " * Usage: OBJECT <verb> ... arguments ... */",
          "content_same": false
        },
        {
          "line": 422,
          "old_api": "redisAssertWithInfo",
          "new_api": null,
          "old_text": "redisAssertWithInfo(NULL,a,a->type == REDIS_STRING && b->type == REDIS_STRING)",
          "new_text": null,
          "old_line_content": "    redisAssertWithInfo(NULL,a,a->type == REDIS_STRING && b->type == REDIS_STRING);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 682,
          "old_api": "addReplyError",
          "new_api": null,
          "old_text": "addReplyError(c,\"Syntax error. Try OBJECT (refcount|encoding|idletime)\")",
          "new_text": null,
          "old_line_content": "        addReplyError(c,\"Syntax error. Try OBJECT (refcount|encoding|idletime)\");",
          "new_line_content": "    robj *o;",
          "content_same": false
        },
        {
          "line": 427,
          "old_api": "sdsEncodedObject",
          "new_api": null,
          "old_text": "sdsEncodedObject(a)",
          "new_text": null,
          "old_line_content": "    if (sdsEncodedObject(a)) {",
          "new_line_content": " * use ll2string() to get a string representation of the numbers on the stack",
          "content_same": false
        },
        {
          "line": 429,
          "old_api": "sdslen",
          "new_api": null,
          "old_text": "sdslen(astr)",
          "new_text": null,
          "old_line_content": "        alen = sdslen(astr);",
          "new_line_content": " *",
          "content_same": false
        },
        {
          "line": 559,
          "old_api": "addReplyError",
          "new_api": null,
          "old_text": "addReplyError(c,(char*)msg)",
          "new_text": null,
          "old_line_content": "            addReplyError(c,(char*)msg);",
          "new_line_content": "                return REDIS_ERR;",
          "content_same": false
        },
        {
          "line": 431,
          "old_api": "ll2string",
          "new_api": null,
          "old_text": "ll2string(bufa,sizeof(bufa),(long) a->ptr)",
          "new_text": null,
          "old_line_content": "        alen = ll2string(bufa,sizeof(bufa),(long) a->ptr);",
          "new_line_content": " * is used. */",
          "content_same": false
        },
        {
          "line": 561,
          "old_api": "addReplyError",
          "new_api": null,
          "old_text": "addReplyError(c,\"value is not a valid float\")",
          "new_text": null,
          "old_line_content": "            addReplyError(c,\"value is not a valid float\");",
          "new_line_content": "            value = (long)o->ptr;",
          "content_same": false
        },
        {
          "line": 434,
          "old_api": "sdsEncodedObject",
          "new_api": null,
          "old_text": "sdsEncodedObject(b)",
          "new_text": null,
          "old_line_content": "    if (sdsEncodedObject(b)) {",
          "new_line_content": "#define REDIS_COMPARE_COLL (1<<1)",
          "content_same": false
        },
        {
          "line": 436,
          "old_api": "sdslen",
          "new_api": null,
          "old_text": "sdslen(bstr)",
          "new_text": null,
          "old_line_content": "        blen = sdslen(bstr);",
          "new_line_content": "int compareStringObjectsWithFlags(robj *a, robj *b, int flags) {",
          "content_same": false
        },
        {
          "line": 438,
          "old_api": "ll2string",
          "new_api": null,
          "old_text": "ll2string(bufb,sizeof(bufb),(long) b->ptr)",
          "new_text": null,
          "old_line_content": "        blen = ll2string(bufb,sizeof(bufb),(long) b->ptr);",
          "new_line_content": "    char bufa[128], bufb[128], *astr, *bstr;",
          "content_same": false
        },
        {
          "line": 447,
          "old_api": "memcmp",
          "new_api": null,
          "old_text": "memcmp(astr,bstr,minlen)",
          "new_text": null,
          "old_line_content": "        cmp = memcmp(astr,bstr,minlen);",
          "new_line_content": "        astr = bufa;",
          "content_same": false
        },
        {
          "line": 577,
          "old_api": "sdsEncodedObject",
          "new_api": null,
          "old_text": "sdsEncodedObject(o)",
          "new_text": null,
          "old_line_content": "        if (sdsEncodedObject(o)) {",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 579,
          "old_api": "strtoll",
          "new_api": null,
          "old_text": "strtoll(o->ptr, &eptr, 10)",
          "new_text": null,
          "old_line_content": "            value = strtoll(o->ptr, &eptr, 10);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 580,
          "old_api": "isspace",
          "new_api": null,
          "old_text": "isspace(((char*)o->ptr)[0])",
          "new_text": null,
          "old_line_content": "            if (isspace(((char*)o->ptr)[0]) || eptr[0] != '\\0' ||",
          "new_line_content": "    *target = value;",
          "content_same": false
        },
        {
          "line": 455,
          "old_api": "compareStringObjectsWithFlags",
          "new_api": null,
          "old_text": "compareStringObjectsWithFlags(a,b,REDIS_COMPARE_BINARY)",
          "new_text": null,
          "old_line_content": "    return compareStringObjectsWithFlags(a,b,REDIS_COMPARE_BINARY);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 586,
          "old_api": "redisPanic",
          "new_api": null,
          "old_text": "redisPanic(\"Unknown string encoding\")",
          "new_text": null,
          "old_line_content": "            redisPanic(\"Unknown string encoding\");",
          "new_line_content": "    char *eptr;",
          "content_same": false
        },
        {
          "line": 460,
          "old_api": "compareStringObjectsWithFlags",
          "new_api": null,
          "old_text": "compareStringObjectsWithFlags(a,b,REDIS_COMPARE_COLL)",
          "new_text": null,
          "old_line_content": "    return compareStringObjectsWithFlags(a,b,REDIS_COMPARE_COLL);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 597,
          "old_api": "addReplyError",
          "new_api": null,
          "old_text": "addReplyError(c,(char*)msg)",
          "new_text": null,
          "old_line_content": "            addReplyError(c,(char*)msg);",
          "new_line_content": "                return REDIS_ERR;",
          "content_same": false
        },
        {
          "line": 599,
          "old_api": "addReplyError",
          "new_api": null,
          "old_text": "addReplyError(c,\"value is not an integer or out of range\")",
          "new_text": null,
          "old_line_content": "            addReplyError(c,\"value is not an integer or out of range\");",
          "new_line_content": "            value = (long)o->ptr;",
          "content_same": false
        },
        {
          "line": 474,
          "old_api": "compareStringObjects",
          "new_api": null,
          "old_text": "compareStringObjects(a,b)",
          "new_text": null,
          "old_line_content": "        return compareStringObjects(a,b) == 0;",
          "new_line_content": "int collateStringObjects(robj *a, robj *b) {",
          "content_same": false
        },
        {
          "line": 479,
          "old_api": "redisAssertWithInfo",
          "new_api": null,
          "old_text": "redisAssertWithInfo(NULL,o,o->type == REDIS_STRING)",
          "new_text": null,
          "old_line_content": "    redisAssertWithInfo(NULL,o,o->type == REDIS_STRING);",
          "new_line_content": " * point of view of a string comparison, otherwise 0 is returned. Note that",
          "content_same": false
        },
        {
          "line": 480,
          "old_api": "sdsEncodedObject",
          "new_api": null,
          "old_text": "sdsEncodedObject(o)",
          "new_text": null,
          "old_line_content": "    if (sdsEncodedObject(o)) {",
          "new_line_content": " * this function is faster then checking for (compareStringObject(a,b) == 0)",
          "content_same": false
        },
        {
          "line": 481,
          "old_api": "sdslen",
          "new_api": null,
          "old_text": "sdslen(o->ptr)",
          "new_text": null,
          "old_line_content": "        return sdslen(o->ptr);",
          "new_line_content": " * because it can perform some more optimization. */",
          "content_same": false
        },
        {
          "line": 613,
          "old_api": "addReplyError",
          "new_api": null,
          "old_text": "addReplyError(c,(char*)msg)",
          "new_text": null,
          "old_line_content": "            addReplyError(c,(char*)msg);",
          "new_line_content": "        } else {",
          "content_same": false
        },
        {
          "line": 485,
          "old_api": "ll2string",
          "new_api": null,
          "old_text": "ll2string(buf,32,(long)o->ptr)",
          "new_text": null,
          "old_line_content": "        return ll2string(buf,32,(long)o->ptr);",
          "new_line_content": "        /* If both strings are integer encoded just check if the stored",
          "content_same": false
        },
        {
          "line": 615,
          "old_api": "addReplyError",
          "new_api": null,
          "old_text": "addReplyError(c,\"value is out of range\")",
          "new_text": null,
          "old_line_content": "            addReplyError(c,\"value is out of range\");",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 497,
          "old_api": "sdsEncodedObject",
          "new_api": null,
          "old_text": "sdsEncodedObject(o)",
          "new_text": null,
          "old_line_content": "        if (sdsEncodedObject(o)) {",
          "new_line_content": "    } else {",
          "content_same": false
        },
        {
          "line": 499,
          "old_api": "strtod",
          "new_api": null,
          "old_text": "strtod(o->ptr, &eptr)",
          "new_text": null,
          "old_line_content": "            value = strtod(o->ptr, &eptr);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 505,
          "old_api": "isnan",
          "new_api": null,
          "old_text": "isnan(value)",
          "new_text": null,
          "old_line_content": "                isnan(value))",
          "new_line_content": "    double value;",
          "content_same": false
        },
        {
          "line": 380,
          "old_api": "incrRefCount",
          "new_api": null,
          "old_text": "incrRefCount(shared.integers[value])",
          "new_text": null,
          "old_line_content": "        incrRefCount(shared.integers[value]);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 510,
          "old_api": "redisPanic",
          "new_api": null,
          "old_text": "redisPanic(\"Unknown string encoding\")",
          "new_text": null,
          "old_line_content": "            redisPanic(\"Unknown string encoding\");",
          "new_line_content": "    } else {",
          "content_same": false
        },
        {
          "line": 383,
          "old_api": "sdsfree",
          "new_api": null,
          "old_text": "sdsfree(o->ptr)",
          "new_text": null,
          "old_line_content": "        if (o->encoding == REDIS_ENCODING_RAW) sdsfree(o->ptr);",
          "new_line_content": "        }",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 12,
      "total_additions": 57,
      "total_deletions": 55,
      "total_api_changes": 124
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 16,
        "api_related_lines": 124,
        "non_api_lines": 13,
        "non_api_line_numbers": [
          366,
          367,
          368,
          369,
          370,
          371,
          372,
          373,
          374,
          375,
          376,
          378,
          381
        ]
      }
    },
    "api_calls_before": 144,
    "api_calls_after": 146,
    "diff_info": {
      "added_lines": 16,
      "removed_lines": 1,
      "total_diff_lines": 29
    }
  }
}