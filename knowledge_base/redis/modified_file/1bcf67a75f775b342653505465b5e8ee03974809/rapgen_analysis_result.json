{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/redis/modified_file/1bcf67a75f775b342653505465b5e8ee03974809",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/redis/modified_file/1bcf67a75f775b342653505465b5e8ee03974809/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/redis/modified_file/1bcf67a75f775b342653505465b5e8ee03974809/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/redis/modified_file/1bcf67a75f775b342653505465b5e8ee03974809/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 839,
          "old_api": "fn",
          "new_api": "dictIsRehashing",
          "old_text": "fn(privdata, de)",
          "new_text": "dictIsRehashing(d)",
          "old_line_content": "            fn(privdata, de);",
          "new_line_content": "    if (!dictIsRehashing(d)) {",
          "content_same": false
        },
        {
          "line": 961,
          "old_api": "_dictClear",
          "new_api": "dictIsRehashing",
          "old_text": "_dictClear(d,&d->ht[1],callback)",
          "new_text": "dictIsRehashing(d)",
          "old_line_content": "    _dictClear(d,&d->ht[1],callback);",
          "new_line_content": "        if (!dictIsRehashing(d)) break;",
          "content_same": false
        },
        {
          "line": 1045,
          "old_api": "DICT_NOTUSED",
          "new_api": "strlen",
          "old_text": "DICT_NOTUSED(privdata)",
          "new_text": "strlen(key)",
          "old_line_content": "    DICT_NOTUSED(privdata);",
          "new_line_content": "    return dictGenHashFunction(key, strlen(key));",
          "content_same": false
        },
        {
          "line": 1064,
          "old_api": "zfree",
          "new_api": "strcmp",
          "old_text": "zfree(key)",
          "new_text": "strcmp(key1, key2)",
          "old_line_content": "    zfree(key);",
          "new_line_content": "    return strcmp(key1, key2) == 0;",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 1024,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\" avg chain length (counted): %.02f\\n\", (float)totchainlen/slots)",
          "old_line_content": "}",
          "new_line_content": "    printf(\" avg chain length (counted): %.02f\\n\", (float)totchainlen/slots);",
          "content_same": false
        },
        {
          "line": 1025,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\" avg chain length (computed): %.02f\\n\", (float)ht->used/slots)",
          "old_line_content": "",
          "new_line_content": "    printf(\" avg chain length (computed): %.02f\\n\", (float)ht->used/slots);",
          "content_same": false
        },
        {
          "line": 1026,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\" Chain length distribution:\\n\")",
          "old_line_content": "void dictPrintStats(dict *d) {",
          "new_line_content": "    printf(\" Chain length distribution:\\n\");",
          "content_same": false
        },
        {
          "line": 905,
          "old_api": null,
          "new_api": "dictIsRehashing",
          "old_text": null,
          "new_text": "dictIsRehashing(d)",
          "old_line_content": "     * elements/buckets is over the \"safe\" threshold, we resize doubling",
          "new_line_content": "    if (dictIsRehashing(d)) return DICT_OK;",
          "content_same": false
        },
        {
          "line": 1034,
          "old_api": null,
          "new_api": "_dictPrintStatsHt",
          "old_text": null,
          "new_text": "_dictPrintStatsHt(&d->ht[0])",
          "old_line_content": "/* ----------------------- StringCopy Hash Table Type ------------------------*/",
          "new_line_content": "    _dictPrintStatsHt(&d->ht[0]);",
          "content_same": false
        },
        {
          "line": 1035,
          "old_api": null,
          "new_api": "dictIsRehashing",
          "old_text": null,
          "new_text": "dictIsRehashing(d)",
          "old_line_content": "",
          "new_line_content": "    if (dictIsRehashing(d)) {",
          "content_same": false
        },
        {
          "line": 1036,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\"-- Rehashing into ht[1]:\\n\")",
          "old_line_content": "static unsigned int _dictStringCopyHTHashFunction(const void *key)",
          "new_line_content": "        printf(\"-- Rehashing into ht[1]:\\n\");",
          "content_same": false
        },
        {
          "line": 1037,
          "old_api": null,
          "new_api": "_dictPrintStatsHt",
          "old_text": null,
          "new_text": "_dictPrintStatsHt(&d->ht[1])",
          "old_line_content": "{",
          "new_line_content": "        _dictPrintStatsHt(&d->ht[1]);",
          "content_same": false
        },
        {
          "line": 908,
          "old_api": null,
          "new_api": "dictExpand",
          "old_text": null,
          "new_text": "dictExpand(d, DICT_HT_INITIAL_SIZE)",
          "old_line_content": "        (dict_can_resize ||",
          "new_line_content": "    if (d->ht[0].size == 0) return dictExpand(d, DICT_HT_INITIAL_SIZE);",
          "content_same": false
        },
        {
          "line": 1020,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\" table size: %ld\\n\", ht->size)",
          "old_line_content": "    for (i = 0; i < DICT_STATS_VECTLEN-1; i++) {",
          "new_line_content": "    printf(\" table size: %ld\\n\", ht->size);",
          "content_same": false
        },
        {
          "line": 918,
          "old_api": null,
          "new_api": "dictExpand",
          "old_text": null,
          "new_text": "dictExpand(d, d->ht[0].used*2)",
          "old_line_content": "{",
          "new_line_content": "        return dictExpand(d, d->ht[0].used*2);",
          "content_same": false
        },
        {
          "line": 1050,
          "old_api": null,
          "new_api": "strlen",
          "old_text": null,
          "new_text": "strlen(key)",
          "old_line_content": "}",
          "new_line_content": "    int len = strlen(key);",
          "content_same": false
        },
        {
          "line": 1051,
          "old_api": null,
          "new_api": "zmalloc",
          "old_text": null,
          "new_text": "zmalloc(len+1)",
          "old_line_content": "",
          "new_line_content": "    char *copy = zmalloc(len+1);",
          "content_same": false
        },
        {
          "line": 1052,
          "old_api": null,
          "new_api": "DICT_NOTUSED",
          "old_text": null,
          "new_text": "DICT_NOTUSED(privdata)",
          "old_line_content": "static int _dictStringCopyHTKeyCompare(void *privdata, const void *key1,",
          "new_line_content": "    DICT_NOTUSED(privdata);",
          "content_same": false
        },
        {
          "line": 1054,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(copy, key, len)",
          "old_line_content": "{",
          "new_line_content": "    memcpy(copy, key, len);",
          "content_same": false
        },
        {
          "line": 1069,
          "old_api": null,
          "new_api": "DICT_NOTUSED",
          "old_text": null,
          "new_text": "DICT_NOTUSED(privdata)",
          "old_line_content": "    _dictStringDup,                /* key dup */",
          "new_line_content": "    DICT_NOTUSED(privdata);",
          "content_same": false
        },
        {
          "line": 1071,
          "old_api": null,
          "new_api": "zfree",
          "old_text": null,
          "new_text": "zfree(key)",
          "old_line_content": "    _dictStringCopyHTKeyCompare,   /* key compare */",
          "new_line_content": "    zfree(key);",
          "content_same": false
        },
        {
          "line": 948,
          "old_api": null,
          "new_api": "_dictExpandIfNeeded",
          "old_text": null,
          "new_text": "_dictExpandIfNeeded(d)",
          "old_line_content": "        he = d->ht[table].table[idx];",
          "new_line_content": "    if (_dictExpandIfNeeded(d) == DICT_ERR)",
          "content_same": false
        },
        {
          "line": 951,
          "old_api": null,
          "new_api": "dictHashKey",
          "old_text": null,
          "new_text": "dictHashKey(d, key)",
          "old_line_content": "                return -1;",
          "new_line_content": "    h = dictHashKey(d, key);",
          "content_same": false
        },
        {
          "line": 957,
          "old_api": null,
          "new_api": "dictCompareKeys",
          "old_text": null,
          "new_text": "dictCompareKeys(d, key, he->key)",
          "old_line_content": "}",
          "new_line_content": "            if (dictCompareKeys(d, key, he->key))",
          "content_same": false
        },
        {
          "line": 837,
          "old_api": null,
          "new_api": "dictSize",
          "old_text": null,
          "new_text": "dictSize(d)",
          "old_line_content": "        de = t0->table[v & m0];",
          "new_line_content": "    if (dictSize(d) == 0) return 0;",
          "content_same": false
        },
        {
          "line": 967,
          "old_api": null,
          "new_api": "_dictClear",
          "old_text": null,
          "new_text": "_dictClear(d,&d->ht[0],callback)",
          "old_line_content": "    dict_can_resize = 1;",
          "new_line_content": "    _dictClear(d,&d->ht[0],callback);",
          "content_same": false
        },
        {
          "line": 968,
          "old_api": null,
          "new_api": "_dictClear",
          "old_text": null,
          "new_text": "_dictClear(d,&d->ht[1],callback)",
          "old_line_content": "}",
          "new_line_content": "    _dictClear(d,&d->ht[1],callback);",
          "content_same": false
        },
        {
          "line": 846,
          "old_api": null,
          "new_api": "fn",
          "old_text": null,
          "new_text": "fn(privdata, de)",
          "old_line_content": "",
          "new_line_content": "            fn(privdata, de);",
          "content_same": false
        },
        {
          "line": 866,
          "old_api": null,
          "new_api": "fn",
          "old_text": null,
          "new_text": "fn(privdata, de)",
          "old_line_content": "            /* Emit entries at cursor */",
          "new_line_content": "            fn(privdata, de);",
          "content_same": false
        },
        {
          "line": 995,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\"No stats available for empty dictionaries\\n\")",
          "old_line_content": "",
          "new_line_content": "        printf(\"No stats available for empty dictionaries\\n\");",
          "content_same": false
        },
        {
          "line": 876,
          "old_api": null,
          "new_api": "fn",
          "old_text": null,
          "new_text": "fn(privdata, de)",
          "old_line_content": "            /* Continue while bits covered by mask difference is non-zero */",
          "new_line_content": "                fn(privdata, de);",
          "content_same": false
        },
        {
          "line": 892,
          "old_api": null,
          "new_api": "rev",
          "old_text": null,
          "new_text": "rev(v)",
          "old_line_content": "/* ------------------------- private functions ------------------------------ */",
          "new_line_content": "    v = rev(v);",
          "content_same": false
        },
        {
          "line": 1021,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\" number of elements: %ld\\n\", ht->used)",
          "old_line_content": "        if (clvector[i] == 0) continue;",
          "new_line_content": "    printf(\" number of elements: %ld\\n\", ht->used);",
          "content_same": false
        },
        {
          "line": 894,
          "old_api": null,
          "new_api": "rev",
          "old_text": null,
          "new_text": "rev(v)",
          "old_line_content": "/* Expand the hash table if needed */",
          "new_line_content": "    v = rev(v);",
          "content_same": false
        },
        {
          "line": 1023,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\" max chain length: %ld\\n\", maxchainlen)",
          "old_line_content": "    }",
          "new_line_content": "    printf(\" max chain length: %ld\\n\", maxchainlen);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 898,
          "old_api": "dictIsRehashing",
          "new_api": null,
          "old_text": "dictIsRehashing(d)",
          "new_text": null,
          "old_line_content": "    if (dictIsRehashing(d)) return DICT_OK;",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1027,
          "old_api": "_dictPrintStatsHt",
          "new_api": null,
          "old_text": "_dictPrintStatsHt(&d->ht[0])",
          "new_text": null,
          "old_line_content": "    _dictPrintStatsHt(&d->ht[0]);",
          "new_line_content": "    for (i = 0; i < DICT_STATS_VECTLEN-1; i++) {",
          "content_same": false
        },
        {
          "line": 1028,
          "old_api": "dictIsRehashing",
          "new_api": null,
          "old_text": "dictIsRehashing(d)",
          "new_text": null,
          "old_line_content": "    if (dictIsRehashing(d)) {",
          "new_line_content": "        if (clvector[i] == 0) continue;",
          "content_same": false
        },
        {
          "line": 901,
          "old_api": "dictExpand",
          "new_api": null,
          "old_text": "dictExpand(d, DICT_HT_INITIAL_SIZE)",
          "new_text": null,
          "old_line_content": "    if (d->ht[0].size == 0) return dictExpand(d, DICT_HT_INITIAL_SIZE);",
          "new_line_content": "/* Expand the hash table if needed */",
          "content_same": false
        },
        {
          "line": 1030,
          "old_api": "_dictPrintStatsHt",
          "new_api": null,
          "old_text": "_dictPrintStatsHt(&d->ht[1])",
          "new_text": null,
          "old_line_content": "        _dictPrintStatsHt(&d->ht[1]);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1038,
          "old_api": "strlen",
          "new_api": null,
          "old_text": "strlen(key)",
          "new_text": null,
          "old_line_content": "    return dictGenHashFunction(key, strlen(key));",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 911,
          "old_api": "dictExpand",
          "new_api": null,
          "old_text": "dictExpand(d, d->ht[0].used*2)",
          "new_text": null,
          "old_line_content": "        return dictExpand(d, d->ht[0].used*2);",
          "new_line_content": "     * table (global setting) or we should avoid it but the ratio between",
          "content_same": false
        },
        {
          "line": 1043,
          "old_api": "strlen",
          "new_api": null,
          "old_text": "strlen(key)",
          "new_text": null,
          "old_line_content": "    int len = strlen(key);",
          "new_line_content": "static unsigned int _dictStringCopyHTHashFunction(const void *key)",
          "content_same": false
        },
        {
          "line": 1044,
          "old_api": "zmalloc",
          "new_api": null,
          "old_text": "zmalloc(len+1)",
          "new_text": null,
          "old_line_content": "    char *copy = zmalloc(len+1);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 1047,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(copy, key, len)",
          "new_text": null,
          "old_line_content": "    memcpy(copy, key, len);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1055,
          "old_api": "DICT_NOTUSED",
          "new_api": null,
          "old_text": "DICT_NOTUSED(privdata)",
          "new_text": null,
          "old_line_content": "    DICT_NOTUSED(privdata);",
          "new_line_content": "    copy[len] = '\\0';",
          "content_same": false
        },
        {
          "line": 1057,
          "old_api": "strcmp",
          "new_api": null,
          "old_text": "strcmp(key1, key2)",
          "new_text": null,
          "old_line_content": "    return strcmp(key1, key2) == 0;",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 941,
          "old_api": "_dictExpandIfNeeded",
          "new_api": null,
          "old_text": "_dictExpandIfNeeded(d)",
          "new_text": null,
          "old_line_content": "    if (_dictExpandIfNeeded(d) == DICT_ERR)",
          "new_line_content": " * index is always returned in the context of the second (new) hash table. */",
          "content_same": false
        },
        {
          "line": 944,
          "old_api": "dictHashKey",
          "new_api": null,
          "old_text": "dictHashKey(d, key)",
          "new_text": null,
          "old_line_content": "    h = dictHashKey(d, key);",
          "new_line_content": "    unsigned int h, idx, table;",
          "content_same": false
        },
        {
          "line": 950,
          "old_api": "dictCompareKeys",
          "new_api": null,
          "old_text": "dictCompareKeys(d, key, he->key)",
          "new_text": null,
          "old_line_content": "            if (dictCompareKeys(d, key, he->key))",
          "new_line_content": "    /* Compute the key hash value */",
          "content_same": false
        },
        {
          "line": 954,
          "old_api": "dictIsRehashing",
          "new_api": null,
          "old_text": "dictIsRehashing(d)",
          "new_text": null,
          "old_line_content": "        if (!dictIsRehashing(d)) break;",
          "new_line_content": "        /* Search if this slot does not already contain the given key */",
          "content_same": false
        },
        {
          "line": 830,
          "old_api": "dictSize",
          "new_api": null,
          "old_text": "dictSize(d)",
          "new_text": null,
          "old_line_content": "    if (dictSize(d) == 0) return 0;",
          "new_line_content": "                       dictScanFunction *fn,",
          "content_same": false
        },
        {
          "line": 832,
          "old_api": "dictIsRehashing",
          "new_api": null,
          "old_text": "dictIsRehashing(d)",
          "new_text": null,
          "old_line_content": "    if (!dictIsRehashing(d)) {",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 960,
          "old_api": "_dictClear",
          "new_api": null,
          "old_text": "_dictClear(d,&d->ht[0],callback)",
          "new_text": null,
          "old_line_content": "    _dictClear(d,&d->ht[0],callback);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 1016,
          "old_api": "printf",
          "new_api": null,
          "old_text": "printf(\" max chain length: %ld\\n\", maxchainlen)",
          "new_text": null,
          "old_line_content": "    printf(\" max chain length: %ld\\n\", maxchainlen);",
          "new_line_content": "        if (chainlen > maxchainlen) maxchainlen = chainlen;",
          "content_same": false
        },
        {
          "line": 859,
          "old_api": "fn",
          "new_api": null,
          "old_text": "fn(privdata, de)",
          "new_text": null,
          "old_line_content": "            fn(privdata, de);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 988,
          "old_api": "printf",
          "new_api": null,
          "old_text": "printf(\"No stats available for empty dictionaries\\n\")",
          "new_text": null,
          "old_line_content": "        printf(\"No stats available for empty dictionaries\\n\");",
          "new_line_content": "#define DICT_STATS_VECTLEN 50",
          "content_same": false
        },
        {
          "line": 869,
          "old_api": "fn",
          "new_api": null,
          "old_text": "fn(privdata, de)",
          "new_text": null,
          "old_line_content": "                fn(privdata, de);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1015,
          "old_api": "printf",
          "new_api": null,
          "old_text": "printf(\" different slots: %ld\\n\", slots)",
          "new_text": null,
          "old_line_content": "    printf(\" different slots: %ld\\n\", slots);",
          "new_line_content": "        clvector[(chainlen < DICT_STATS_VECTLEN) ? chainlen : (DICT_STATS_VECTLEN-1)]++;",
          "content_same": false
        },
        {
          "line": 1012,
          "old_api": "printf",
          "new_api": null,
          "old_text": "printf(\"Hash table stats:\\n\")",
          "new_text": null,
          "old_line_content": "    printf(\"Hash table stats:\\n\");",
          "new_line_content": "            chainlen++;",
          "content_same": false
        },
        {
          "line": 885,
          "old_api": "rev",
          "new_api": null,
          "old_text": "rev(v)",
          "new_text": null,
          "old_line_content": "    v = rev(v);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1013,
          "old_api": "printf",
          "new_api": null,
          "old_text": "printf(\" table size: %ld\\n\", ht->size)",
          "new_text": null,
          "old_line_content": "    printf(\" table size: %ld\\n\", ht->size);",
          "new_line_content": "            he = he->next;",
          "content_same": false
        },
        {
          "line": 887,
          "old_api": "rev",
          "new_api": null,
          "old_text": "rev(v)",
          "new_text": null,
          "old_line_content": "    v = rev(v);",
          "new_line_content": "    /* Set unmasked bits so incrementing the reversed cursor",
          "content_same": false
        },
        {
          "line": 1014,
          "old_api": "printf",
          "new_api": null,
          "old_text": "printf(\" number of elements: %ld\\n\", ht->used)",
          "new_text": null,
          "old_line_content": "    printf(\" number of elements: %ld\\n\", ht->used);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 1017,
          "old_api": "printf",
          "new_api": null,
          "old_text": "printf(\" avg chain length (counted): %.02f\\n\", (float)totchainlen/slots)",
          "new_text": null,
          "old_line_content": "    printf(\" avg chain length (counted): %.02f\\n\", (float)totchainlen/slots);",
          "new_line_content": "        totchainlen += chainlen;",
          "content_same": false
        },
        {
          "line": 1018,
          "old_api": "printf",
          "new_api": null,
          "old_text": "printf(\" avg chain length (computed): %.02f\\n\", (float)ht->used/slots)",
          "new_text": null,
          "old_line_content": "    printf(\" avg chain length (computed): %.02f\\n\", (float)ht->used/slots);",
          "new_line_content": "    }",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 4,
      "total_additions": 31,
      "total_deletions": 31,
      "total_api_changes": 66
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 8,
        "api_related_lines": 66,
        "non_api_lines": 8,
        "non_api_line_numbers": [
          707,
          708,
          709,
          710,
          711,
          712,
          713,
          714
        ]
      }
    },
    "api_calls_before": 120,
    "api_calls_after": 120,
    "diff_info": {
      "added_lines": 8,
      "removed_lines": 1,
      "total_diff_lines": 21
    }
  }
}