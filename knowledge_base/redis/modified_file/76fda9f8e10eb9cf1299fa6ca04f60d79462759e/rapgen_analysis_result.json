{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/redis/modified_file/76fda9f8e10eb9cf1299fa6ca04f60d79462759e",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/redis/modified_file/76fda9f8e10eb9cf1299fa6ca04f60d79462759e/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/redis/modified_file/76fda9f8e10eb9cf1299fa6ca04f60d79462759e/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/redis/modified_file/76fda9f8e10eb9cf1299fa6ca04f60d79462759e/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 996,
          "old_api": "addReply",
          "new_api": "rewriteClientCommandArgument",
          "old_text": "addReply(c, shared.noscripterr)",
          "new_text": "rewriteClientCommandArgument(c,1,script)",
          "old_line_content": "        addReply(c, shared.noscripterr);",
          "new_line_content": "            rewriteClientCommandArgument(c,1,script);",
          "content_same": false
        },
        {
          "line": 1015,
          "old_api": "lua_pushnumber",
          "new_api": "evalGenericCommand",
          "old_text": "lua_pushnumber(L, r)",
          "new_text": "evalGenericCommand(c,1)",
          "old_line_content": "      lua_pushnumber(L, r);  /* Number between 0 and 1 */",
          "new_line_content": "    evalGenericCommand(c,1);",
          "content_same": false
        },
        {
          "line": 1027,
          "old_api": "luaL_argcheck",
          "new_api": "redisLrand48",
          "old_text": "luaL_argcheck(L, l<=u, 2, \"interval is empty\")",
          "new_text": "redisLrand48()",
          "old_line_content": "      luaL_argcheck(L, l<=u, 2, \"interval is empty\");",
          "new_line_content": "  lua_Number r = (lua_Number)(redisLrand48()%REDIS_LRAND48_MAX) /",
          "content_same": false
        },
        {
          "line": 1031,
          "old_api": "luaL_error",
          "new_api": "lua_pushnumber",
          "old_text": "luaL_error(L, \"wrong number of arguments\")",
          "new_text": "lua_pushnumber(L, r)",
          "old_line_content": "    default: return luaL_error(L, \"wrong number of arguments\");",
          "new_line_content": "      lua_pushnumber(L, r);  /* Number between 0 and 1 */",
          "content_same": false
        },
        {
          "line": 1037,
          "old_api": "luaL_checkint",
          "new_api": "floor",
          "old_text": "luaL_checkint(L, 1)",
          "new_text": "floor(r*u)",
          "old_line_content": "  redisSrand48(luaL_checkint(L, 1));",
          "new_line_content": "      lua_pushnumber(L, floor(r*u)+1);  /* int between 1 and `u' */",
          "content_same": false
        },
        {
          "line": 1047,
          "old_api": "scriptingReset",
          "new_api": "luaL_error",
          "old_text": "scriptingReset()",
          "new_text": "luaL_error(L, \"wrong number of arguments\")",
          "old_line_content": "        scriptingReset();",
          "new_line_content": "    default: return luaL_error(L, \"wrong number of arguments\");",
          "content_same": false
        },
        {
          "line": 1067,
          "old_api": "sdslen",
          "new_api": "strcasecmp",
          "old_text": "sdslen(c->argv[2]->ptr)",
          "new_text": "strcasecmp(c->argv[1]->ptr,\"exists\")",
          "old_line_content": "        sha1hex(funcname+2,c->argv[2]->ptr,sdslen(c->argv[2]->ptr));",
          "new_line_content": "    } else if (c->argc >= 2 && !strcasecmp(c->argv[1]->ptr,\"exists\")) {",
          "content_same": false
        },
        {
          "line": 1070,
          "old_api": "luaCreateFunction",
          "new_api": "addReplyMultiBulkLen",
          "old_text": "luaCreateFunction(c,server.lua,funcname,c->argv[2])",
          "new_text": "addReplyMultiBulkLen(c, c->argc-2)",
          "old_line_content": "            if (luaCreateFunction(c,server.lua,funcname,c->argv[2])",
          "new_line_content": "        addReplyMultiBulkLen(c, c->argc-2);",
          "content_same": false
        },
        {
          "line": 1072,
          "old_api": "sdsfree",
          "new_api": "dictFind",
          "old_text": "sdsfree(sha)",
          "new_text": "dictFind(server.lua_scripts,c->argv[j]->ptr)",
          "old_line_content": "                sdsfree(sha);",
          "new_line_content": "            if (dictFind(server.lua_scripts,c->argv[j]->ptr))",
          "content_same": false
        },
        {
          "line": 1077,
          "old_api": "sdsfree",
          "new_api": "strcasecmp",
          "old_text": "sdsfree(sha)",
          "new_text": "strcasecmp(c->argv[1]->ptr,\"load\")",
          "old_line_content": "        sdsfree(sha);",
          "new_line_content": "    } else if (c->argc == 3 && !strcasecmp(c->argv[1]->ptr,\"load\")) {",
          "content_same": false
        },
        {
          "line": 1083,
          "old_api": "sdsnew",
          "new_api": "sdslen",
          "old_text": "sdsnew(\"-UNKILLABLE Sorry the script already executed write commands against the dataset. You can either wait the script termination or kill the server in a hard way using the SHUTDOWN NOSAVE command.\\r\\n\")",
          "new_text": "sdslen(c->argv[2]->ptr)",
          "old_line_content": "            addReplySds(c,sdsnew(\"-UNKILLABLE Sorry the script already executed write commands against the dataset. You can either wait the script termination or kill the server in a hard way using the SHUTDOWN NOSAVE command.\\r\\n\"));",
          "new_line_content": "        sha1hex(funcname+2,c->argv[2]->ptr,sdslen(c->argv[2]->ptr));",
          "content_same": false
        },
        {
          "line": 1086,
          "old_api": "addReply",
          "new_api": "luaCreateFunction",
          "old_text": "addReply(c,shared.ok)",
          "new_text": "luaCreateFunction(c,server.lua,funcname,c->argv[2])",
          "old_line_content": "            addReply(c,shared.ok);",
          "new_line_content": "            if (luaCreateFunction(c,server.lua,funcname,c->argv[2])",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 1029,
          "old_api": null,
          "new_api": "lua_gettop",
          "old_text": null,
          "new_text": "lua_gettop(L)",
          "old_line_content": "      break;",
          "new_line_content": "  switch (lua_gettop(L)) {  /* check number of arguments */",
          "content_same": false
        },
        {
          "line": 1035,
          "old_api": null,
          "new_api": "luaL_checkint",
          "old_text": null,
          "new_text": "luaL_checkint(L, 1)",
          "old_line_content": "",
          "new_line_content": "      int u = luaL_checkint(L, 1);",
          "content_same": false
        },
        {
          "line": 1036,
          "old_api": null,
          "new_api": "luaL_argcheck",
          "old_text": null,
          "new_text": "luaL_argcheck(L, 1<=u, 1, \"interval is empty\")",
          "old_line_content": "int redis_math_randomseed (lua_State *L) {",
          "new_line_content": "      luaL_argcheck(L, 1<=u, 1, \"interval is empty\");",
          "content_same": false
        },
        {
          "line": 1041,
          "old_api": null,
          "new_api": "luaL_checkint",
          "old_text": null,
          "new_text": "luaL_checkint(L, 1)",
          "old_line_content": "/* ---------------------------------------------------------------------------",
          "new_line_content": "      int l = luaL_checkint(L, 1);",
          "content_same": false
        },
        {
          "line": 1042,
          "old_api": null,
          "new_api": "luaL_checkint",
          "old_text": null,
          "new_text": "luaL_checkint(L, 2)",
          "old_line_content": " * SCRIPT command for script environment introspection and control",
          "new_line_content": "      int u = luaL_checkint(L, 2);",
          "content_same": false
        },
        {
          "line": 1043,
          "old_api": null,
          "new_api": "luaL_argcheck",
          "old_text": null,
          "new_text": "luaL_argcheck(L, l<=u, 2, \"interval is empty\")",
          "old_line_content": " * ------------------------------------------------------------------------- */",
          "new_line_content": "      luaL_argcheck(L, l<=u, 2, \"interval is empty\");",
          "content_same": false
        },
        {
          "line": 1044,
          "old_api": null,
          "new_api": "floor",
          "old_text": null,
          "new_text": "floor(r*(u-l+1))",
          "old_line_content": "",
          "new_line_content": "      lua_pushnumber(L, floor(r*(u-l+1))+l);  /* int between `l' and `u' */",
          "content_same": false
        },
        {
          "line": 1053,
          "old_api": null,
          "new_api": "luaL_checkint",
          "old_text": null,
          "new_text": "luaL_checkint(L, 1)",
          "old_line_content": "",
          "new_line_content": "  redisSrand48(luaL_checkint(L, 1));",
          "content_same": false
        },
        {
          "line": 1062,
          "old_api": null,
          "new_api": "strcasecmp",
          "old_text": null,
          "new_text": "strcasecmp(c->argv[1]->ptr,\"flush\")",
          "old_line_content": "        char funcname[43];",
          "new_line_content": "    if (c->argc == 2 && !strcasecmp(c->argv[1]->ptr,\"flush\")) {",
          "content_same": false
        },
        {
          "line": 1063,
          "old_api": null,
          "new_api": "scriptingReset",
          "old_text": null,
          "new_text": "scriptingReset()",
          "old_line_content": "        sds sha;",
          "new_line_content": "        scriptingReset();",
          "content_same": false
        },
        {
          "line": 1064,
          "old_api": null,
          "new_api": "addReply",
          "old_text": null,
          "new_text": "addReply(c,shared.ok)",
          "old_line_content": "",
          "new_line_content": "        addReply(c,shared.ok);",
          "content_same": false
        },
        {
          "line": 1065,
          "old_api": null,
          "new_api": "replicationScriptCacheFlush",
          "old_text": null,
          "new_text": "replicationScriptCacheFlush()",
          "old_line_content": "        funcname[0] = 'f';",
          "new_line_content": "        replicationScriptCacheFlush();",
          "content_same": false
        },
        {
          "line": 1073,
          "old_api": null,
          "new_api": "addReply",
          "old_text": null,
          "new_text": "addReply(c,shared.cone)",
          "old_line_content": "                return;",
          "new_line_content": "                addReply(c,shared.cone);",
          "content_same": false
        },
        {
          "line": 1075,
          "old_api": null,
          "new_api": "addReply",
          "old_text": null,
          "new_text": "addReply(c,shared.czero)",
          "old_line_content": "        }",
          "new_line_content": "                addReply(c,shared.czero);",
          "content_same": false
        },
        {
          "line": 1084,
          "old_api": null,
          "new_api": "sdsnewlen",
          "old_text": null,
          "new_text": "sdsnewlen(funcname+2,40)",
          "old_line_content": "        } else {",
          "new_line_content": "        sha = sdsnewlen(funcname+2,40);",
          "content_same": false
        },
        {
          "line": 1085,
          "old_api": null,
          "new_api": "dictFind",
          "old_text": null,
          "new_text": "dictFind(server.lua_scripts,sha)",
          "old_line_content": "            server.lua_kill = 1;",
          "new_line_content": "        if (dictFind(server.lua_scripts,sha) == NULL) {",
          "content_same": false
        },
        {
          "line": 959,
          "old_api": null,
          "new_api": "lua_gc",
          "old_text": null,
          "new_text": "lua_gc(lua,LUA_GCSTEP,LUA_GC_CYCLE_PERIOD)",
          "old_line_content": "    /* EVALSHA should be propagated to Slave and AOF file as full EVAL, unless",
          "new_line_content": "            lua_gc(lua,LUA_GCSTEP,LUA_GC_CYCLE_PERIOD);",
          "content_same": false
        },
        {
          "line": 1088,
          "old_api": null,
          "new_api": "sdsfree",
          "old_text": null,
          "new_text": "sdsfree(sha)",
          "old_line_content": "    } else {",
          "new_line_content": "                sdsfree(sha);",
          "content_same": false
        },
        {
          "line": 1092,
          "old_api": null,
          "new_api": "addReplyBulkCBuffer",
          "old_text": null,
          "new_text": "addReplyBulkCBuffer(c,funcname+2,40)",
          "old_line_content": "",
          "new_line_content": "        addReplyBulkCBuffer(c,funcname+2,40);",
          "content_same": false
        },
        {
          "line": 965,
          "old_api": null,
          "new_api": "addReplyErrorFormat",
          "old_text": null,
          "new_text": "addReplyErrorFormat(c,\"Error running script (call to %s): %s\\n\",\n            funcname, lua_tostring(lua,-1))",
          "old_line_content": "     *",
          "new_line_content": "        addReplyErrorFormat(c,\"Error running script (call to %s): %s\\n\",",
          "content_same": false
        },
        {
          "line": 966,
          "old_api": null,
          "new_api": "lua_tostring",
          "old_text": null,
          "new_text": "lua_tostring(lua,-1)",
          "old_line_content": "     * For repliation, everytime a new slave attaches to the master, we need to",
          "new_line_content": "            funcname, lua_tostring(lua,-1));",
          "content_same": false
        },
        {
          "line": 967,
          "old_api": null,
          "new_api": "lua_pop",
          "old_text": null,
          "new_text": "lua_pop(lua,2)",
          "old_line_content": "     * flush our cache of scripts that can be replicated as EVALSHA, while",
          "new_line_content": "        lua_pop(lua,2); /* Consume the Lua reply and remove error handler. */",
          "content_same": false
        },
        {
          "line": 1093,
          "old_api": null,
          "new_api": "sdsfree",
          "old_text": null,
          "new_text": "sdsfree(sha)",
          "old_line_content": "",
          "new_line_content": "        sdsfree(sha);",
          "content_same": false
        },
        {
          "line": 1094,
          "old_api": null,
          "new_api": "forceCommandPropagation",
          "old_text": null,
          "new_text": "forceCommandPropagation(c,REDIS_PROPAGATE_REPL|REDIS_PROPAGATE_AOF)",
          "old_line_content": "",
          "new_line_content": "        forceCommandPropagation(c,REDIS_PROPAGATE_REPL|REDIS_PROPAGATE_AOF);",
          "content_same": false
        },
        {
          "line": 1095,
          "old_api": null,
          "new_api": "strcasecmp",
          "old_text": null,
          "new_text": "strcasecmp(c->argv[1]->ptr,\"kill\")",
          "old_line_content": "",
          "new_line_content": "    } else if (c->argc == 2 && !strcasecmp(c->argv[1]->ptr,\"kill\")) {",
          "content_same": false
        },
        {
          "line": 971,
          "old_api": null,
          "new_api": "luaReplyToRedisReply",
          "old_text": null,
          "new_text": "luaReplyToRedisReply(c,lua)",
          "old_line_content": "            /* This script is not in our script cache, replicate it as",
          "new_line_content": "        luaReplyToRedisReply(c,lua); /* Convert and consume the reply. */",
          "content_same": false
        },
        {
          "line": 972,
          "old_api": null,
          "new_api": "lua_pop",
          "old_text": null,
          "new_text": "lua_pop(lua,1)",
          "old_line_content": "             * EVAL, then add it into the script cache, as from now on",
          "new_line_content": "        lua_pop(lua,1); /* Remove the error handler. */",
          "content_same": false
        },
        {
          "line": 1097,
          "old_api": null,
          "new_api": "sdsnew",
          "old_text": null,
          "new_text": "sdsnew(\"-NOTBUSY No scripts in execution right now.\\r\\n\")",
          "old_line_content": "",
          "new_line_content": "            addReplySds(c,sdsnew(\"-NOTBUSY No scripts in execution right now.\\r\\n\"));",
          "content_same": false
        },
        {
          "line": 1099,
          "old_api": null,
          "new_api": "sdsnew",
          "old_text": null,
          "new_text": "sdsnew(\"-UNKILLABLE Sorry the script already executed write commands against the dataset. You can either wait the script termination or kill the server in a hard way using the SHUTDOWN NOSAVE command.\\r\\n\")",
          "old_line_content": "",
          "new_line_content": "            addReplySds(c,sdsnew(\"-UNKILLABLE Sorry the script already executed write commands against the dataset. You can either wait the script termination or kill the server in a hard way using the SHUTDOWN NOSAVE command.\\r\\n\"));",
          "content_same": false
        },
        {
          "line": 1102,
          "old_api": null,
          "new_api": "addReply",
          "old_text": null,
          "new_text": "addReply(c,shared.ok)",
          "old_line_content": "",
          "new_line_content": "            addReply(c,shared.ok);",
          "content_same": false
        },
        {
          "line": 1105,
          "old_api": null,
          "new_api": "addReplyError",
          "old_text": null,
          "new_text": "addReplyError(c, \"Unknown SCRIPT subcommand or wrong # of args.\")",
          "old_line_content": "",
          "new_line_content": "        addReplyError(c, \"Unknown SCRIPT subcommand or wrong # of args.\");",
          "content_same": false
        },
        {
          "line": 986,
          "old_api": null,
          "new_api": "replicationScriptCacheExists",
          "old_text": null,
          "new_text": "replicationScriptCacheExists(c->argv[1]->ptr)",
          "old_line_content": "void evalCommand(redisClient *c) {",
          "new_line_content": "        if (!replicationScriptCacheExists(c->argv[1]->ptr)) {",
          "content_same": false
        },
        {
          "line": 990,
          "old_api": null,
          "new_api": "dictFetchValue",
          "old_text": null,
          "new_text": "dictFetchValue(server.lua_scripts,c->argv[1]->ptr)",
          "old_line_content": "void evalShaCommand(redisClient *c) {",
          "new_line_content": "            robj *script = dictFetchValue(server.lua_scripts,c->argv[1]->ptr);",
          "content_same": false
        },
        {
          "line": 992,
          "old_api": null,
          "new_api": "replicationScriptCacheAdd",
          "old_text": null,
          "new_text": "replicationScriptCacheAdd(c->argv[1]->ptr)",
          "old_line_content": "        /* We know that a match is not possible if the provided SHA is",
          "new_line_content": "            replicationScriptCacheAdd(c->argv[1]->ptr);",
          "content_same": false
        },
        {
          "line": 993,
          "old_api": null,
          "new_api": "redisAssertWithInfo",
          "old_text": null,
          "new_text": "redisAssertWithInfo(c,NULL,script != NULL)",
          "old_line_content": "         * not the right length. So we return an error ASAP, this way",
          "new_line_content": "            redisAssertWithInfo(c,NULL,script != NULL);",
          "content_same": false
        },
        {
          "line": 994,
          "old_api": null,
          "new_api": "rewriteClientCommandArgument",
          "old_text": null,
          "new_text": "rewriteClientCommandArgument(c,0,\n                resetRefCount(createStringObject(\"EVAL\",4)))",
          "old_line_content": "         * evalGenericCommand() can be implemented without string length",
          "new_line_content": "            rewriteClientCommandArgument(c,0,",
          "content_same": false
        },
        {
          "line": 995,
          "old_api": null,
          "new_api": "createStringObject",
          "old_text": null,
          "new_text": "createStringObject(\"EVAL\",4)",
          "old_line_content": "         * sanity check */",
          "new_line_content": "                resetRefCount(createStringObject(\"EVAL\",4)));",
          "content_same": false
        },
        {
          "line": 997,
          "old_api": null,
          "new_api": "forceCommandPropagation",
          "old_text": null,
          "new_text": "forceCommandPropagation(c,REDIS_PROPAGATE_REPL|REDIS_PROPAGATE_AOF)",
          "old_line_content": "        return;",
          "new_line_content": "            forceCommandPropagation(c,REDIS_PROPAGATE_REPL|REDIS_PROPAGATE_AOF);",
          "content_same": false
        },
        {
          "line": 1003,
          "old_api": null,
          "new_api": "evalGenericCommand",
          "old_text": null,
          "new_text": "evalGenericCommand(c,0)",
          "old_line_content": " * by specific libc random() implementations and will output the same sequence",
          "new_line_content": "    evalGenericCommand(c,0);",
          "content_same": false
        },
        {
          "line": 1007,
          "old_api": null,
          "new_api": "sdslen",
          "old_text": null,
          "new_text": "sdslen(c->argv[1]->ptr)",
          "old_line_content": " * rand() replaced by redisLrand48(). */",
          "new_line_content": "    if (sdslen(c->argv[1]->ptr) != 40) {",
          "content_same": false
        },
        {
          "line": 1012,
          "old_api": null,
          "new_api": "addReply",
          "old_text": null,
          "new_text": "addReply(c, shared.noscripterr)",
          "old_line_content": "                                (lua_Number)REDIS_LRAND48_MAX;",
          "new_line_content": "        addReply(c, shared.noscripterr);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 1025,
          "old_api": "luaL_checkint",
          "new_api": null,
          "old_text": "luaL_checkint(L, 1)",
          "new_text": null,
          "old_line_content": "      int l = luaL_checkint(L, 1);",
          "new_line_content": "  /* the `%' avoids the (rare) case of r==1, and is needed also because on",
          "content_same": false
        },
        {
          "line": 1026,
          "old_api": "luaL_checkint",
          "new_api": null,
          "old_text": "luaL_checkint(L, 2)",
          "new_text": null,
          "old_line_content": "      int u = luaL_checkint(L, 2);",
          "new_line_content": "     some systems (SunOS!) `rand()' may return a value larger than RAND_MAX */",
          "content_same": false
        },
        {
          "line": 1028,
          "old_api": "floor",
          "new_api": null,
          "old_text": "floor(r*(u-l+1))",
          "new_text": null,
          "old_line_content": "      lua_pushnumber(L, floor(r*(u-l+1))+l);  /* int between `l' and `u' */",
          "new_line_content": "                                (lua_Number)REDIS_LRAND48_MAX;",
          "content_same": false
        },
        {
          "line": 1046,
          "old_api": "strcasecmp",
          "new_api": null,
          "old_text": "strcasecmp(c->argv[1]->ptr,\"flush\")",
          "new_text": null,
          "old_line_content": "    if (c->argc == 2 && !strcasecmp(c->argv[1]->ptr,\"flush\")) {",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1048,
          "old_api": "addReply",
          "new_api": null,
          "old_text": "addReply(c,shared.ok)",
          "new_text": null,
          "old_line_content": "        addReply(c,shared.ok);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 1049,
          "old_api": "replicationScriptCacheFlush",
          "new_api": null,
          "old_text": "replicationScriptCacheFlush()",
          "new_text": null,
          "old_line_content": "        replicationScriptCacheFlush();",
          "new_line_content": "  return 1;",
          "content_same": false
        },
        {
          "line": 1051,
          "old_api": "strcasecmp",
          "new_api": null,
          "old_text": "strcasecmp(c->argv[1]->ptr,\"exists\")",
          "new_text": null,
          "old_line_content": "    } else if (c->argc >= 2 && !strcasecmp(c->argv[1]->ptr,\"exists\")) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1054,
          "old_api": "addReplyMultiBulkLen",
          "new_api": null,
          "old_text": "addReplyMultiBulkLen(c, c->argc-2)",
          "new_text": null,
          "old_line_content": "        addReplyMultiBulkLen(c, c->argc-2);",
          "new_line_content": "  return 0;",
          "content_same": false
        },
        {
          "line": 1056,
          "old_api": "dictFind",
          "new_api": null,
          "old_text": "dictFind(server.lua_scripts,c->argv[j]->ptr)",
          "new_text": null,
          "old_line_content": "            if (dictFind(server.lua_scripts,c->argv[j]->ptr))",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1057,
          "old_api": "addReply",
          "new_api": null,
          "old_text": "addReply(c,shared.cone)",
          "new_text": null,
          "old_line_content": "                addReply(c,shared.cone);",
          "new_line_content": "/* ---------------------------------------------------------------------------",
          "content_same": false
        },
        {
          "line": 1059,
          "old_api": "addReply",
          "new_api": null,
          "old_text": "addReply(c,shared.czero)",
          "new_text": null,
          "old_line_content": "                addReply(c,shared.czero);",
          "new_line_content": " * ------------------------------------------------------------------------- */",
          "content_same": false
        },
        {
          "line": 1061,
          "old_api": "strcasecmp",
          "new_api": null,
          "old_text": "strcasecmp(c->argv[1]->ptr,\"load\")",
          "new_text": null,
          "old_line_content": "    } else if (c->argc == 3 && !strcasecmp(c->argv[1]->ptr,\"load\")) {",
          "new_line_content": "void scriptCommand(redisClient *c) {",
          "content_same": false
        },
        {
          "line": 1068,
          "old_api": "sdsnewlen",
          "new_api": null,
          "old_text": "sdsnewlen(funcname+2,40)",
          "new_text": null,
          "old_line_content": "        sha = sdsnewlen(funcname+2,40);",
          "new_line_content": "        int j;",
          "content_same": false
        },
        {
          "line": 1069,
          "old_api": "dictFind",
          "new_api": null,
          "old_text": "dictFind(server.lua_scripts,sha)",
          "new_text": null,
          "old_line_content": "        if (dictFind(server.lua_scripts,sha) == NULL) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 946,
          "old_api": "lua_gc",
          "new_api": null,
          "old_text": "lua_gc(lua,LUA_GCSTEP,1)",
          "new_text": null,
          "old_line_content": "    lua_gc(lua,LUA_GCSTEP,1);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1076,
          "old_api": "addReplyBulkCBuffer",
          "new_api": null,
          "old_text": "addReplyBulkCBuffer(c,funcname+2,40)",
          "new_text": null,
          "old_line_content": "        addReplyBulkCBuffer(c,funcname+2,40);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 949,
          "old_api": "addReplyErrorFormat",
          "new_api": null,
          "old_text": "addReplyErrorFormat(c,\"Error running script (call to %s): %s\\n\",\n            funcname, lua_tostring(lua,-1))",
          "new_text": null,
          "old_line_content": "        addReplyErrorFormat(c,\"Error running script (call to %s): %s\\n\",",
          "new_line_content": "     *",
          "content_same": false
        },
        {
          "line": 950,
          "old_api": "lua_tostring",
          "new_api": null,
          "old_text": "lua_tostring(lua,-1)",
          "new_text": null,
          "old_line_content": "            funcname, lua_tostring(lua,-1));",
          "new_line_content": "     * The call is performed every LUA_GC_CYCLE_PERIOD executed commands",
          "content_same": false
        },
        {
          "line": 951,
          "old_api": "lua_pop",
          "new_api": null,
          "old_text": "lua_pop(lua,2)",
          "new_text": null,
          "old_line_content": "        lua_pop(lua,2); /* Consume the Lua reply and remove error handler. */",
          "new_line_content": "     * (and for LUA_GC_CYCLE_PERIOD collection steps) because calling it",
          "content_same": false
        },
        {
          "line": 1078,
          "old_api": "forceCommandPropagation",
          "new_api": null,
          "old_text": "forceCommandPropagation(c,REDIS_PROPAGATE_REPL|REDIS_PROPAGATE_AOF)",
          "new_text": null,
          "old_line_content": "        forceCommandPropagation(c,REDIS_PROPAGATE_REPL|REDIS_PROPAGATE_AOF);",
          "new_line_content": "        char funcname[43];",
          "content_same": false
        },
        {
          "line": 1079,
          "old_api": "strcasecmp",
          "new_api": null,
          "old_text": "strcasecmp(c->argv[1]->ptr,\"kill\")",
          "new_text": null,
          "old_line_content": "    } else if (c->argc == 2 && !strcasecmp(c->argv[1]->ptr,\"kill\")) {",
          "new_line_content": "        sds sha;",
          "content_same": false
        },
        {
          "line": 1081,
          "old_api": "sdsnew",
          "new_api": null,
          "old_text": "sdsnew(\"-NOTBUSY No scripts in execution right now.\\r\\n\")",
          "new_text": null,
          "old_line_content": "            addReplySds(c,sdsnew(\"-NOTBUSY No scripts in execution right now.\\r\\n\"));",
          "new_line_content": "        funcname[0] = 'f';",
          "content_same": false
        },
        {
          "line": 955,
          "old_api": "luaReplyToRedisReply",
          "new_api": null,
          "old_text": "luaReplyToRedisReply(c,lua)",
          "new_text": null,
          "old_line_content": "        luaReplyToRedisReply(c,lua); /* Convert and consume the reply. */",
          "new_line_content": "        static long gc_count = 0;",
          "content_same": false
        },
        {
          "line": 956,
          "old_api": "lua_pop",
          "new_api": null,
          "old_text": "lua_pop(lua,1)",
          "new_text": null,
          "old_line_content": "        lua_pop(lua,1); /* Remove the error handler. */",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1089,
          "old_api": "addReplyError",
          "new_api": null,
          "old_text": "addReplyError(c, \"Unknown SCRIPT subcommand or wrong # of args.\")",
          "new_text": null,
          "old_line_content": "        addReplyError(c, \"Unknown SCRIPT subcommand or wrong # of args.\");",
          "new_line_content": "                return;",
          "content_same": false
        },
        {
          "line": 970,
          "old_api": "replicationScriptCacheExists",
          "new_api": null,
          "old_text": "replicationScriptCacheExists(c->argv[1]->ptr)",
          "new_text": null,
          "old_line_content": "        if (!replicationScriptCacheExists(c->argv[1]->ptr)) {",
          "new_line_content": "         * send it to * the client. */",
          "content_same": false
        },
        {
          "line": 974,
          "old_api": "dictFetchValue",
          "new_api": null,
          "old_text": "dictFetchValue(server.lua_scripts,c->argv[1]->ptr)",
          "new_text": null,
          "old_line_content": "            robj *script = dictFetchValue(server.lua_scripts,c->argv[1]->ptr);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 976,
          "old_api": "replicationScriptCacheAdd",
          "new_api": null,
          "old_text": "replicationScriptCacheAdd(c->argv[1]->ptr)",
          "new_text": null,
          "old_line_content": "            replicationScriptCacheAdd(c->argv[1]->ptr);",
          "new_line_content": "     * we are sure that the script was already in the context of all the",
          "content_same": false
        },
        {
          "line": 977,
          "old_api": "redisAssertWithInfo",
          "new_api": null,
          "old_text": "redisAssertWithInfo(c,NULL,script != NULL)",
          "new_text": null,
          "old_line_content": "            redisAssertWithInfo(c,NULL,script != NULL);",
          "new_line_content": "     * attached slaves *and* the current AOF file if enabled.",
          "content_same": false
        },
        {
          "line": 978,
          "old_api": "rewriteClientCommandArgument",
          "new_api": null,
          "old_text": "rewriteClientCommandArgument(c,0,\n                resetRefCount(createStringObject(\"EVAL\",4)))",
          "new_text": null,
          "old_line_content": "            rewriteClientCommandArgument(c,0,",
          "new_line_content": "     *",
          "content_same": false
        },
        {
          "line": 979,
          "old_api": "createStringObject",
          "new_api": null,
          "old_text": "createStringObject(\"EVAL\",4)",
          "new_text": null,
          "old_line_content": "                resetRefCount(createStringObject(\"EVAL\",4)));",
          "new_line_content": "     * To do so we use a cache of SHA1s of scripts that we already propagated",
          "content_same": false
        },
        {
          "line": 980,
          "old_api": "rewriteClientCommandArgument",
          "new_api": null,
          "old_text": "rewriteClientCommandArgument(c,1,script)",
          "new_text": null,
          "old_line_content": "            rewriteClientCommandArgument(c,1,script);",
          "new_line_content": "     * as full EVAL, that's called the Replication Script Cache.",
          "content_same": false
        },
        {
          "line": 981,
          "old_api": "forceCommandPropagation",
          "new_api": null,
          "old_text": "forceCommandPropagation(c,REDIS_PROPAGATE_REPL|REDIS_PROPAGATE_AOF)",
          "new_text": null,
          "old_line_content": "            forceCommandPropagation(c,REDIS_PROPAGATE_REPL|REDIS_PROPAGATE_AOF);",
          "new_line_content": "     *",
          "content_same": false
        },
        {
          "line": 987,
          "old_api": "evalGenericCommand",
          "new_api": null,
          "old_text": "evalGenericCommand(c,0)",
          "new_text": null,
          "old_line_content": "    evalGenericCommand(c,0);",
          "new_line_content": "            /* This script is not in our script cache, replicate it as",
          "content_same": false
        },
        {
          "line": 991,
          "old_api": "sdslen",
          "new_api": null,
          "old_text": "sdslen(c->argv[1]->ptr)",
          "new_text": null,
          "old_line_content": "    if (sdslen(c->argv[1]->ptr) != 40) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 999,
          "old_api": "evalGenericCommand",
          "new_api": null,
          "old_text": "evalGenericCommand(c,1)",
          "new_text": null,
          "old_line_content": "    evalGenericCommand(c,1);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1011,
          "old_api": "redisLrand48",
          "new_api": null,
          "old_text": "redisLrand48()",
          "new_text": null,
          "old_line_content": "  lua_Number r = (lua_Number)(redisLrand48()%REDIS_LRAND48_MAX) /",
          "new_line_content": "         * sanity check */",
          "content_same": false
        },
        {
          "line": 1013,
          "old_api": "lua_gettop",
          "new_api": null,
          "old_text": "lua_gettop(L)",
          "new_text": null,
          "old_line_content": "  switch (lua_gettop(L)) {  /* check number of arguments */",
          "new_line_content": "        return;",
          "content_same": false
        },
        {
          "line": 1019,
          "old_api": "luaL_checkint",
          "new_api": null,
          "old_text": "luaL_checkint(L, 1)",
          "new_text": null,
          "old_line_content": "      int u = luaL_checkint(L, 1);",
          "new_line_content": " * by specific libc random() implementations and will output the same sequence",
          "content_same": false
        },
        {
          "line": 1020,
          "old_api": "luaL_argcheck",
          "new_api": null,
          "old_text": "luaL_argcheck(L, 1<=u, 1, \"interval is empty\")",
          "new_text": null,
          "old_line_content": "      luaL_argcheck(L, 1<=u, 1, \"interval is empty\");",
          "new_line_content": " * (for the same seed) in every arch. */",
          "content_same": false
        },
        {
          "line": 1021,
          "old_api": "floor",
          "new_api": null,
          "old_text": "floor(r*u)",
          "new_text": null,
          "old_line_content": "      lua_pushnumber(L, floor(r*u)+1);  /* int between 1 and `u' */",
          "new_line_content": "",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 12,
      "total_additions": 41,
      "total_deletions": 41,
      "total_api_changes": 94
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 17,
        "api_related_lines": 94,
        "non_api_lines": 10,
        "non_api_line_numbers": [
          960,
          961,
          962,
          947,
          948,
          952,
          953,
          954,
          957,
          958
        ]
      }
    },
    "api_calls_before": 360,
    "api_calls_after": 360,
    "diff_info": {
      "added_lines": 17,
      "removed_lines": 1,
      "total_diff_lines": 30
    }
  }
}