{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/redis/modified_file/e52a036ac636b182fff37fdb1c7177fe48d08f03",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/redis/modified_file/e52a036ac636b182fff37fdb1c7177fe48d08f03/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/redis/modified_file/e52a036ac636b182fff37fdb1c7177fe48d08f03/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/redis/modified_file/e52a036ac636b182fff37fdb1c7177fe48d08f03/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 5163,
          "old_api": "rioWriteBulkString",
          "new_api": "rioWriteBulkCount",
          "old_text": "rioWriteBulkString(&cmd,\"RESTORE-ASKING\",14)",
          "new_text": "rioWriteBulkCount(&cmd,'*',replace ? 5 : 4)",
          "old_line_content": "                rioWriteBulkString(&cmd,\"RESTORE-ASKING\",14));",
          "new_line_content": "            rioWriteBulkCount(&cmd,'*',replace ? 5 : 4));",
          "content_same": false
        },
        {
          "line": 5166,
          "old_api": "sdsEncodedObject",
          "new_api": "serverAssertWithInfo",
          "old_text": "sdsEncodedObject(kv[j])",
          "new_text": "serverAssertWithInfo(c,NULL,\n                rioWriteBulkString(&cmd,\"RESTORE-ASKING\",14))",
          "old_line_content": "        serverAssertWithInfo(c,NULL,sdsEncodedObject(kv[j]));",
          "new_line_content": "            serverAssertWithInfo(c,NULL,",
          "content_same": false
        },
        {
          "line": 5169,
          "old_api": "rioWriteBulkLongLong",
          "new_api": "rioWriteBulkString",
          "old_text": "rioWriteBulkLongLong(&cmd,ttl)",
          "new_text": "rioWriteBulkString(&cmd,\"RESTORE\",7)",
          "old_line_content": "        serverAssertWithInfo(c,NULL,rioWriteBulkLongLong(&cmd,ttl));",
          "new_line_content": "            serverAssertWithInfo(c,NULL,rioWriteBulkString(&cmd,\"RESTORE\",7));",
          "content_same": false
        },
        {
          "line": 5173,
          "old_api": "createDumpPayload",
          "new_api": "rioWriteBulkLongLong",
          "old_text": "createDumpPayload(&payload,ov[j])",
          "new_text": "rioWriteBulkLongLong(&cmd,ttl)",
          "old_line_content": "        createDumpPayload(&payload,ov[j]);",
          "new_line_content": "        serverAssertWithInfo(c,NULL,rioWriteBulkLongLong(&cmd,ttl));",
          "content_same": false
        },
        {
          "line": 5177,
          "old_api": "sdsfree",
          "new_api": "createDumpPayload",
          "old_text": "sdsfree(payload.io.buffer.ptr)",
          "new_text": "createDumpPayload(&payload,ov[j])",
          "old_line_content": "        sdsfree(payload.io.buffer.ptr);",
          "new_line_content": "        createDumpPayload(&payload,ov[j]);",
          "content_same": false
        },
        {
          "line": 5282,
          "old_api": "zfree",
          "new_api": "replaceClientCommandVector",
          "old_text": "zfree(newargv)",
          "new_text": "replaceClientCommandVector(c,del_idx,newargv)",
          "old_line_content": "            zfree(newargv);",
          "new_line_content": "            replaceClientCommandVector(c,del_idx,newargv);",
          "content_same": false
        },
        {
          "line": 5359,
          "old_api": "addReply",
          "new_api": "addReplyError",
          "old_text": "addReply(c,shared.ok)",
          "new_text": "addReplyError(c,\"This instance has cluster support disabled\")",
          "old_line_content": "    addReply(c,shared.ok);",
          "new_line_content": "        addReplyError(c,\"This instance has cluster support disabled\");",
          "content_same": false
        },
        {
          "line": 5371,
          "old_api": "addReply",
          "new_api": "addReplyError",
          "old_text": "addReply(c,shared.ok)",
          "new_text": "addReplyError(c,\"This instance has cluster support disabled\")",
          "old_line_content": "    addReply(c,shared.ok);",
          "new_line_content": "        addReplyError(c,\"This instance has cluster support disabled\");",
          "content_same": false
        },
        {
          "line": 5457,
          "old_api": "sdslen",
          "new_api": "getKeysFromCommand",
          "old_text": "sdslen(thiskey->ptr)",
          "new_text": "getKeysFromCommand(mcmd,margv,margc,&numkeys)",
          "old_line_content": "                                       sdslen(thiskey->ptr));",
          "new_line_content": "        keyindex = getKeysFromCommand(mcmd,margv,margc,&numkeys);",
          "content_same": false
        },
        {
          "line": 5598,
          "old_api": "sdsempty",
          "new_api": "sdsnew",
          "old_text": "sdsempty()",
          "new_text": "sdsnew(\"-CLUSTERDOWN Hash slot not served\\r\\n\")",
          "old_line_content": "        addReplySds(c,sdscatprintf(sdsempty(),",
          "new_line_content": "        addReplySds(c,sdsnew(\"-CLUSTERDOWN Hash slot not served\\r\\n\"));",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 5633,
          "old_api": null,
          "new_api": "clusterRedirectClient",
          "old_text": null,
          "new_text": "clusterRedirectClient(c,NULL,0,CLUSTER_REDIR_DOWN_STATE)",
          "old_line_content": "        /* All keys must belong to the same slot, so check first key only. */",
          "new_line_content": "            clusterRedirectClient(c,NULL,0,CLUSTER_REDIR_DOWN_STATE);",
          "content_same": false
        },
        {
          "line": 5250,
          "old_api": null,
          "new_api": "dbDelete",
          "old_text": null,
          "new_text": "dbDelete(c->db,kv[j])",
          "old_line_content": "                /* Populate the argument vector to replace the old one. */",
          "new_line_content": "                dbDelete(c->db,kv[j]);",
          "content_same": false
        },
        {
          "line": 5251,
          "old_api": null,
          "new_api": "signalModifiedKey",
          "old_text": null,
          "new_text": "signalModifiedKey(c->db,kv[j])",
          "old_line_content": "                newargv[del_idx++] = kv[j];",
          "new_line_content": "                signalModifiedKey(c->db,kv[j]);",
          "content_same": false
        },
        {
          "line": 5381,
          "old_api": null,
          "new_api": "addReply",
          "old_text": null,
          "new_text": "addReply(c,shared.ok)",
          "old_line_content": " * For the function to succeed the command should only target either:",
          "new_line_content": "    addReply(c,shared.ok);",
          "content_same": false
        },
        {
          "line": 5638,
          "old_api": null,
          "new_api": "dictGetIterator",
          "old_text": null,
          "new_text": "dictGetIterator(c->bpop.keys)",
          "old_line_content": "            clusterNode *node = server.cluster->slots[slot];",
          "new_line_content": "        di = dictGetIterator(c->bpop.keys);",
          "content_same": false
        },
        {
          "line": 5639,
          "old_api": null,
          "new_api": "dictNext",
          "old_text": null,
          "new_text": "dictNext(di)",
          "old_line_content": "",
          "new_line_content": "        if ((de = dictNext(di)) != NULL) {",
          "content_same": false
        },
        {
          "line": 5256,
          "old_api": null,
          "new_api": "incrRefCount",
          "old_text": null,
          "new_text": "incrRefCount(kv[j])",
          "old_line_content": "",
          "new_line_content": "                incrRefCount(kv[j]);",
          "content_same": false
        },
        {
          "line": 5513,
          "old_api": null,
          "new_api": "lookupKeyRead",
          "old_text": null,
          "new_text": "lookupKeyRead(&server.db[0],thiskey)",
          "old_line_content": "        }",
          "new_line_content": "                lookupKeyRead(&server.db[0],thiskey) == NULL)",
          "content_same": false
        },
        {
          "line": 5640,
          "old_api": null,
          "new_api": "dictGetKey",
          "old_text": null,
          "new_text": "dictGetKey(de)",
          "old_line_content": "            /* We send an error and unblock the client if:",
          "new_line_content": "            robj *key = dictGetKey(de);",
          "content_same": false
        },
        {
          "line": 5641,
          "old_api": null,
          "new_api": "sdslen",
          "old_text": null,
          "new_text": "sdslen(key->ptr)",
          "old_line_content": "             * 1) The slot is unassigned, emitting a cluster down error.",
          "new_line_content": "            int slot = keyHashSlot((char*)key->ptr, sdslen(key->ptr));",
          "content_same": false
        },
        {
          "line": 5518,
          "old_api": null,
          "new_api": "getKeysFreeResult",
          "old_text": null,
          "new_text": "getKeysFreeResult(keyindex)",
          "old_line_content": "     * without redirections or errors in all the cases. */",
          "new_line_content": "        getKeysFreeResult(keyindex);",
          "content_same": false
        },
        {
          "line": 5651,
          "old_api": null,
          "new_api": "clusterRedirectClient",
          "old_text": null,
          "new_text": "clusterRedirectClient(c,NULL,0,\n                        CLUSTER_REDIR_DOWN_UNBOUND)",
          "old_line_content": "                        CLUSTER_REDIR_MOVED);",
          "new_line_content": "                    clusterRedirectClient(c,NULL,0,",
          "content_same": false
        },
        {
          "line": 5654,
          "old_api": null,
          "new_api": "clusterRedirectClient",
          "old_text": null,
          "new_text": "clusterRedirectClient(c,node,slot,\n                        CLUSTER_REDIR_MOVED)",
          "old_line_content": "                return 1;",
          "new_line_content": "                    clusterRedirectClient(c,node,slot,",
          "content_same": false
        },
        {
          "line": 5273,
          "old_api": null,
          "new_api": "migrateCloseSocket",
          "old_text": null,
          "new_text": "migrateCloseSocket(c->argv[1],c->argv[2])",
          "old_line_content": "         * this only for the keys for which we received an acknowledgement",
          "new_line_content": "    if (socket_error) migrateCloseSocket(c->argv[1],c->argv[2]);",
          "content_same": false
        },
        {
          "line": 5661,
          "old_api": null,
          "new_api": "dictReleaseIterator",
          "old_text": null,
          "new_text": "dictReleaseIterator(di)",
          "old_line_content": "",
          "new_line_content": "        dictReleaseIterator(di);",
          "content_same": false
        },
        {
          "line": 5280,
          "old_api": null,
          "new_api": "createStringObject",
          "old_text": null,
          "new_text": "createStringObject(\"DEL\",3)",
          "old_line_content": "        } else {",
          "new_line_content": "            newargv[0] = createStringObject(\"DEL\",3);",
          "content_same": false
        },
        {
          "line": 5154,
          "old_api": null,
          "new_api": "getExpire",
          "old_text": null,
          "new_text": "getExpire(c->db,kv[j])",
          "old_line_content": "        if (expireat != -1) {",
          "new_line_content": "        long long expireat = getExpire(c->db,kv[j]);",
          "content_same": false
        },
        {
          "line": 5157,
          "old_api": null,
          "new_api": "mstime",
          "old_text": null,
          "new_text": "mstime()",
          "old_line_content": "        }",
          "new_line_content": "            ttl = expireat-mstime();",
          "content_same": false
        },
        {
          "line": 5286,
          "old_api": null,
          "new_api": "zfree",
          "old_text": null,
          "new_text": "zfree(newargv)",
          "old_line_content": "",
          "new_line_content": "            zfree(newargv);",
          "content_same": false
        },
        {
          "line": 5170,
          "old_api": null,
          "new_api": "sdsEncodedObject",
          "old_text": null,
          "new_text": "sdsEncodedObject(kv[j])",
          "old_line_content": "",
          "new_line_content": "        serverAssertWithInfo(c,NULL,sdsEncodedObject(kv[j]));",
          "content_same": false
        },
        {
          "line": 5171,
          "old_api": null,
          "new_api": "rioWriteBulkString",
          "old_text": null,
          "new_text": "rioWriteBulkString(&cmd,kv[j]->ptr,\n                sdslen(kv[j]->ptr))",
          "old_line_content": "        /* Emit the payload argument, that is the serialized object using",
          "new_line_content": "        serverAssertWithInfo(c,NULL,rioWriteBulkString(&cmd,kv[j]->ptr,",
          "content_same": false
        },
        {
          "line": 5172,
          "old_api": null,
          "new_api": "sdslen",
          "old_text": null,
          "new_text": "sdslen(kv[j]->ptr)",
          "old_line_content": "         * the DUMP format. */",
          "new_line_content": "                sdslen(kv[j]->ptr)));",
          "content_same": false
        },
        {
          "line": 5178,
          "old_api": null,
          "new_api": "serverAssertWithInfo",
          "old_text": null,
          "new_text": "serverAssertWithInfo(c,NULL,\n            rioWriteBulkString(&cmd,payload.io.buffer.ptr,\n                               sdslen(payload.io.buffer.ptr)))",
          "old_line_content": "",
          "new_line_content": "        serverAssertWithInfo(c,NULL,",
          "content_same": false
        },
        {
          "line": 5179,
          "old_api": null,
          "new_api": "rioWriteBulkString",
          "old_text": null,
          "new_text": "rioWriteBulkString(&cmd,payload.io.buffer.ptr,\n                               sdslen(payload.io.buffer.ptr))",
          "old_line_content": "        /* Add the REPLACE option to the RESTORE command if it was specified",
          "new_line_content": "            rioWriteBulkString(&cmd,payload.io.buffer.ptr,",
          "content_same": false
        },
        {
          "line": 5180,
          "old_api": null,
          "new_api": "sdslen",
          "old_text": null,
          "new_text": "sdslen(payload.io.buffer.ptr)",
          "old_line_content": "         * as a MIGRATE option. */",
          "new_line_content": "                               sdslen(payload.io.buffer.ptr)));",
          "content_same": false
        },
        {
          "line": 5181,
          "old_api": null,
          "new_api": "sdsfree",
          "old_text": null,
          "new_text": "sdsfree(payload.io.buffer.ptr)",
          "old_line_content": "        if (replace)",
          "new_line_content": "        sdsfree(payload.io.buffer.ptr);",
          "content_same": false
        },
        {
          "line": 5307,
          "old_api": null,
          "new_api": "addReply",
          "old_text": null,
          "new_text": "addReply(c,shared.ok)",
          "old_line_content": "    }",
          "new_line_content": "        addReply(c,shared.ok);",
          "content_same": false
        },
        {
          "line": 5568,
          "old_api": null,
          "new_api": "nodeIsSlave",
          "old_text": null,
          "new_text": "nodeIsSlave(myself)",
          "old_line_content": "    }",
          "new_line_content": "        nodeIsSlave(myself) &&",
          "content_same": false
        },
        {
          "line": 5313,
          "old_api": null,
          "new_api": "sdsfree",
          "old_text": null,
          "new_text": "sdsfree(cmd.io.buffer.ptr)",
          "old_line_content": "/* On socket errors we try to close the cached socket and try again.",
          "new_line_content": "    sdsfree(cmd.io.buffer.ptr);",
          "content_same": false
        },
        {
          "line": 5186,
          "old_api": null,
          "new_api": "rioWriteBulkString",
          "old_text": null,
          "new_text": "rioWriteBulkString(&cmd,\"REPLACE\",7)",
          "old_line_content": "    errno = 0;",
          "new_line_content": "            serverAssertWithInfo(c,NULL,rioWriteBulkString(&cmd,\"REPLACE\",7));",
          "content_same": false
        },
        {
          "line": 5314,
          "old_api": null,
          "new_api": "zfree",
          "old_text": null,
          "new_text": "zfree(newargv)",
          "old_line_content": " * It is very common for the cached socket to get closed, if just reopening",
          "new_line_content": "    zfree(ov); zfree(kv); zfree(newargv);",
          "content_same": false
        },
        {
          "line": 5323,
          "old_api": null,
          "new_api": "sdsfree",
          "old_text": null,
          "new_text": "sdsfree(cmd.io.buffer.ptr)",
          "old_line_content": "     * is idempotent, the host/port arguments are now gone, so don't do it",
          "new_line_content": "    sdsfree(cmd.io.buffer.ptr);",
          "content_same": false
        },
        {
          "line": 5196,
          "old_api": null,
          "new_api": "sdslen",
          "old_text": null,
          "new_text": "sdslen(buf)",
          "old_line_content": "                write_error = 1;",
          "new_line_content": "        while ((towrite = sdslen(buf)-pos) > 0) {",
          "content_same": false
        },
        {
          "line": 5198,
          "old_api": null,
          "new_api": "syncWrite",
          "old_text": null,
          "new_text": "syncWrite(cs->fd,buf+pos,towrite,timeout)",
          "old_line_content": "            }",
          "new_line_content": "            nwritten = syncWrite(cs->fd,buf+pos,towrite,timeout);",
          "content_same": false
        },
        {
          "line": 5329,
          "old_api": null,
          "new_api": "migrateCloseSocket",
          "old_text": null,
          "new_text": "migrateCloseSocket(c->argv[1],c->argv[2])",
          "old_line_content": "    /* Retry only if it's not a timeout and we never attempted a retry",
          "new_line_content": "    if (!argv_rewritten) migrateCloseSocket(c->argv[1],c->argv[2]);",
          "content_same": false
        },
        {
          "line": 5330,
          "old_api": null,
          "new_api": "zfree",
          "old_text": null,
          "new_text": "zfree(newargv)",
          "old_line_content": "     * (or the code jumping here did not set may_retry to zero). */",
          "new_line_content": "    zfree(newargv);",
          "content_same": false
        },
        {
          "line": 5460,
          "old_api": null,
          "new_api": "keyHashSlot",
          "old_text": null,
          "new_text": "keyHashSlot((char*)thiskey->ptr,\n                                       sdslen(thiskey->ptr))",
          "old_line_content": "                /* This is the first key we see. Check what is the slot",
          "new_line_content": "            int thisslot = keyHashSlot((char*)thiskey->ptr,",
          "content_same": false
        },
        {
          "line": 5461,
          "old_api": null,
          "new_api": "sdslen",
          "old_text": null,
          "new_text": "sdslen(thiskey->ptr)",
          "old_line_content": "                 * and node. */",
          "new_line_content": "                                       sdslen(thiskey->ptr));",
          "content_same": false
        },
        {
          "line": 5589,
          "old_api": null,
          "new_api": "sdsnew",
          "old_text": null,
          "new_text": "sdsnew(\"-CROSSSLOT Keys in request don't hash to the same slot\\r\\n\")",
          "old_line_content": "         * a migration or import in progress. */",
          "new_line_content": "        addReplySds(c,sdsnew(\"-CROSSSLOT Keys in request don't hash to the same slot\\r\\n\"));",
          "content_same": false
        },
        {
          "line": 5596,
          "old_api": null,
          "new_api": "sdsnew",
          "old_text": null,
          "new_text": "sdsnew(\"-CLUSTERDOWN The cluster is down\\r\\n\")",
          "old_line_content": "               error_code == CLUSTER_REDIR_ASK)",
          "new_line_content": "        addReplySds(c,sdsnew(\"-CLUSTERDOWN The cluster is down\\r\\n\"));",
          "content_same": false
        },
        {
          "line": 5341,
          "old_api": null,
          "new_api": "zfree",
          "old_text": null,
          "new_text": "zfree(kv)",
          "old_line_content": "            write_error ? \"writing\" : \"reading\"));",
          "new_line_content": "    zfree(ov); zfree(kv);",
          "content_same": false
        },
        {
          "line": 5342,
          "old_api": null,
          "new_api": "addReplySds",
          "old_text": null,
          "new_text": "addReplySds(c,\n        sdscatprintf(sdsempty(),\n            \"-IOERR error or timeout %s to target instance\\r\\n\",\n            write_error ? \"writing\" : \"reading\"))",
          "old_line_content": "    return;",
          "new_line_content": "    addReplySds(c,",
          "content_same": false
        },
        {
          "line": 5343,
          "old_api": null,
          "new_api": "sdsempty",
          "old_text": null,
          "new_text": "sdsempty()",
          "old_line_content": "}",
          "new_line_content": "        sdscatprintf(sdsempty(),",
          "content_same": false
        },
        {
          "line": 5216,
          "old_api": null,
          "new_api": "syncReadLine",
          "old_text": null,
          "new_text": "syncReadLine(cs->fd, buf1, sizeof(buf1), timeout)",
          "old_line_content": "    int error_from_target = 0;",
          "new_line_content": "    if (select && syncReadLine(cs->fd, buf1, sizeof(buf1), timeout) <= 0)",
          "content_same": false
        },
        {
          "line": 5602,
          "old_api": null,
          "new_api": "sdsempty",
          "old_text": null,
          "new_text": "sdsempty()",
          "old_line_content": "    } else {",
          "new_line_content": "        addReplySds(c,sdscatprintf(sdsempty(),",
          "content_same": false
        },
        {
          "line": 5475,
          "old_api": null,
          "new_api": "getKeysFreeResult",
          "old_text": null,
          "new_text": "getKeysFreeResult(keyindex)",
          "old_line_content": "                }",
          "new_line_content": "                    getKeysFreeResult(keyindex);",
          "content_same": false
        },
        {
          "line": 5607,
          "old_api": null,
          "new_api": "serverPanic",
          "old_text": null,
          "new_text": "serverPanic(\"getNodeByQuery() unknown error.\")",
          "old_line_content": "/* This function is called by the function processing clients incrementally",
          "new_line_content": "        serverPanic(\"getNodeByQuery() unknown error.\");",
          "content_same": false
        },
        {
          "line": 5224,
          "old_api": null,
          "new_api": "zmalloc",
          "old_text": null,
          "new_text": "zmalloc(sizeof(robj*)*(num_keys_non_expired+1))",
          "old_line_content": "            socket_error = 1;",
          "new_line_content": "    if (!copy) newargv = zmalloc(sizeof(robj*)*(num_keys_non_expired+1));",
          "content_same": false
        },
        {
          "line": 5227,
          "old_api": null,
          "new_api": "syncReadLine",
          "old_text": null,
          "new_text": "syncReadLine(cs->fd, buf2, sizeof(buf2), timeout)",
          "old_line_content": "        if ((password && buf0[0] == '-') ||",
          "new_line_content": "        if (syncReadLine(cs->fd, buf2, sizeof(buf2), timeout) <= 0) {",
          "content_same": false
        },
        {
          "line": 5363,
          "old_api": null,
          "new_api": "addReply",
          "old_text": null,
          "new_text": "addReply(c,shared.ok)",
          "old_line_content": " * In this mode slaves will not redirect clients as long as clients access",
          "new_line_content": "    addReply(c,shared.ok);",
          "content_same": false
        },
        {
          "line": 5496,
          "old_api": null,
          "new_api": "equalStringObjects",
          "old_text": null,
          "new_text": "equalStringObjects(firstkey,thiskey)",
          "old_line_content": "                        if (error_code)",
          "new_line_content": "                if (!equalStringObjects(firstkey,thiskey)) {",
          "content_same": false
        },
        {
          "line": 5499,
          "old_api": null,
          "new_api": "getKeysFreeResult",
          "old_text": null,
          "new_text": "getKeysFreeResult(keyindex)",
          "old_line_content": "                    } else {",
          "new_line_content": "                        getKeysFreeResult(keyindex);",
          "content_same": false
        },
        {
          "line": 5244,
          "old_api": null,
          "new_api": "addReplyErrorFormat",
          "old_text": null,
          "new_text": "addReplyErrorFormat(c,\"Target instance replied with error: %s\",\n                    errbuf+1)",
          "old_line_content": "            if (!copy) {",
          "new_line_content": "                addReplyErrorFormat(c,\"Target instance replied with error: %s\",",
          "content_same": false
        },
        {
          "line": 5375,
          "old_api": null,
          "new_api": "addReply",
          "old_text": null,
          "new_text": "addReply(c,shared.ok)",
          "old_line_content": "void readwriteCommand(client *c) {",
          "new_line_content": "    addReply(c,shared.ok);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 5377,
          "old_api": "addReply",
          "new_api": null,
          "old_text": "addReply(c,shared.ok)",
          "new_text": null,
          "old_line_content": "    addReply(c,shared.ok);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 5495,
          "old_api": "getKeysFreeResult",
          "new_api": null,
          "old_text": "getKeysFreeResult(keyindex)",
          "new_text": null,
          "old_line_content": "                        getKeysFreeResult(keyindex);",
          "new_line_content": "                 * the same key as the first we saw. */",
          "content_same": false
        },
        {
          "line": 5634,
          "old_api": "dictGetIterator",
          "new_api": null,
          "old_text": "dictGetIterator(c->bpop.keys)",
          "new_text": null,
          "old_line_content": "        di = dictGetIterator(c->bpop.keys);",
          "new_line_content": "            return 1;",
          "content_same": false
        },
        {
          "line": 5252,
          "old_api": "incrRefCount",
          "new_api": null,
          "old_text": "incrRefCount(kv[j])",
          "new_text": null,
          "old_line_content": "                incrRefCount(kv[j]);",
          "new_line_content": "                server.dirty++;",
          "content_same": false
        },
        {
          "line": 5509,
          "old_api": "lookupKeyRead",
          "new_api": null,
          "old_text": "lookupKeyRead(&server.db[0],thiskey)",
          "new_text": null,
          "old_line_content": "                lookupKeyRead(&server.db[0],thiskey) == NULL)",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 5635,
          "old_api": "dictNext",
          "new_api": null,
          "old_text": "dictNext(di)",
          "new_text": null,
          "old_line_content": "        if ((de = dictNext(di)) != NULL) {",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 5636,
          "old_api": "dictGetKey",
          "new_api": null,
          "old_text": "dictGetKey(de)",
          "new_text": null,
          "old_line_content": "            robj *key = dictGetKey(de);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 5637,
          "old_api": "sdslen",
          "new_api": null,
          "old_text": "sdslen(key->ptr)",
          "new_text": null,
          "old_line_content": "            int slot = keyHashSlot((char*)key->ptr, sdslen(key->ptr));",
          "new_line_content": "        /* All keys must belong to the same slot, so check first key only. */",
          "content_same": false
        },
        {
          "line": 5514,
          "old_api": "getKeysFreeResult",
          "new_api": null,
          "old_text": "getKeysFreeResult(keyindex)",
          "new_text": null,
          "old_line_content": "        getKeysFreeResult(keyindex);",
          "new_line_content": "            {",
          "content_same": false
        },
        {
          "line": 5647,
          "old_api": "clusterRedirectClient",
          "new_api": null,
          "old_text": "clusterRedirectClient(c,NULL,0,\n                        CLUSTER_REDIR_DOWN_UNBOUND)",
          "new_text": null,
          "old_line_content": "                    clusterRedirectClient(c,NULL,0,",
          "new_line_content": "            if (node != myself &&",
          "content_same": false
        },
        {
          "line": 5650,
          "old_api": "clusterRedirectClient",
          "new_api": null,
          "old_text": "clusterRedirectClient(c,node,slot,\n                        CLUSTER_REDIR_MOVED)",
          "new_text": null,
          "old_line_content": "                    clusterRedirectClient(c,node,slot,",
          "new_line_content": "                if (node == NULL) {",
          "content_same": false
        },
        {
          "line": 5269,
          "old_api": "migrateCloseSocket",
          "new_api": null,
          "old_text": "migrateCloseSocket(c->argv[1],c->argv[2])",
          "new_text": null,
          "old_line_content": "    if (socket_error) migrateCloseSocket(c->argv[1],c->argv[2]);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 5653,
          "old_api": "dictReleaseIterator",
          "new_api": null,
          "old_text": "dictReleaseIterator(di)",
          "new_text": null,
          "old_line_content": "                dictReleaseIterator(di);",
          "new_line_content": "                } else {",
          "content_same": false
        },
        {
          "line": 5276,
          "old_api": "createStringObject",
          "new_api": null,
          "old_text": "createStringObject(\"DEL\",3)",
          "new_text": null,
          "old_line_content": "            newargv[0] = createStringObject(\"DEL\",3);",
          "new_line_content": "        /* Translate MIGRATE as DEL for replication/AOF. Note that we do",
          "content_same": false
        },
        {
          "line": 5278,
          "old_api": "replaceClientCommandVector",
          "new_api": null,
          "old_text": "replaceClientCommandVector(c,del_idx,newargv)",
          "new_text": null,
          "old_line_content": "            replaceClientCommandVector(c,del_idx,newargv);",
          "new_line_content": "         * from the receiving Redis server, by using the del_idx index. */",
          "content_same": false
        },
        {
          "line": 5152,
          "old_api": "getExpire",
          "new_api": null,
          "old_text": "getExpire(c->db,kv[j])",
          "new_text": null,
          "old_line_content": "        long long expireat = getExpire(c->db,kv[j]);",
          "new_line_content": "    for (j = 0; j < num_keys; j++) {",
          "content_same": false
        },
        {
          "line": 5155,
          "old_api": "mstime",
          "new_api": null,
          "old_text": "mstime()",
          "new_text": null,
          "old_line_content": "            ttl = expireat-mstime();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 5158,
          "old_api": "serverAssertWithInfo",
          "new_api": null,
          "old_text": "serverAssertWithInfo(c,NULL,\n            rioWriteBulkCount(&cmd,'*',replace ? 5 : 4))",
          "new_text": null,
          "old_line_content": "        serverAssertWithInfo(c,NULL,",
          "new_line_content": "            if (ttl < 0) continue;",
          "content_same": false
        },
        {
          "line": 5159,
          "old_api": "rioWriteBulkCount",
          "new_api": null,
          "old_text": "rioWriteBulkCount(&cmd,'*',replace ? 5 : 4)",
          "new_text": null,
          "old_line_content": "            rioWriteBulkCount(&cmd,'*',replace ? 5 : 4));",
          "new_line_content": "            if (ttl < 1) ttl = 1;",
          "content_same": false
        },
        {
          "line": 5165,
          "old_api": "rioWriteBulkString",
          "new_api": null,
          "old_text": "rioWriteBulkString(&cmd,\"RESTORE\",7)",
          "new_text": null,
          "old_line_content": "            serverAssertWithInfo(c,NULL,rioWriteBulkString(&cmd,\"RESTORE\",7));",
          "new_line_content": "        if (server.cluster_enabled)",
          "content_same": false
        },
        {
          "line": 5168,
          "old_api": "sdslen",
          "new_api": null,
          "old_text": "sdslen(kv[j]->ptr)",
          "new_text": null,
          "old_line_content": "                sdslen(kv[j]->ptr)));",
          "new_line_content": "        else",
          "content_same": false
        },
        {
          "line": 5174,
          "old_api": "serverAssertWithInfo",
          "new_api": null,
          "old_text": "serverAssertWithInfo(c,NULL,\n            rioWriteBulkString(&cmd,payload.io.buffer.ptr,\n                               sdslen(payload.io.buffer.ptr)))",
          "new_text": null,
          "old_line_content": "        serverAssertWithInfo(c,NULL,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 5175,
          "old_api": "rioWriteBulkString",
          "new_api": null,
          "old_text": "rioWriteBulkString(&cmd,payload.io.buffer.ptr,\n                               sdslen(payload.io.buffer.ptr))",
          "new_text": null,
          "old_line_content": "            rioWriteBulkString(&cmd,payload.io.buffer.ptr,",
          "new_line_content": "        /* Emit the payload argument, that is the serialized object using",
          "content_same": false
        },
        {
          "line": 5176,
          "old_api": "sdslen",
          "new_api": null,
          "old_text": "sdslen(payload.io.buffer.ptr)",
          "new_text": null,
          "old_line_content": "                               sdslen(payload.io.buffer.ptr)));",
          "new_line_content": "         * the DUMP format. */",
          "content_same": false
        },
        {
          "line": 5303,
          "old_api": "addReply",
          "new_api": null,
          "old_text": "addReply(c,shared.ok)",
          "new_text": null,
          "old_line_content": "        addReply(c,shared.ok);",
          "new_line_content": "         * Note: If we reached this point, even if socket_error is true",
          "content_same": false
        },
        {
          "line": 5564,
          "old_api": "nodeIsSlave",
          "new_api": null,
          "old_text": "nodeIsSlave(myself)",
          "new_text": null,
          "old_line_content": "        nodeIsSlave(myself) &&",
          "new_line_content": "     * is serving, we can reply without redirection. */",
          "content_same": false
        },
        {
          "line": 5309,
          "old_api": "sdsfree",
          "new_api": null,
          "old_text": "sdsfree(cmd.io.buffer.ptr)",
          "new_text": null,
          "old_line_content": "    sdsfree(cmd.io.buffer.ptr);",
          "new_line_content": "        /* On error we already sent it in the for loop above, and set",
          "content_same": false
        },
        {
          "line": 5182,
          "old_api": "rioWriteBulkString",
          "new_api": null,
          "old_text": "rioWriteBulkString(&cmd,\"REPLACE\",7)",
          "new_text": null,
          "old_line_content": "            serverAssertWithInfo(c,NULL,rioWriteBulkString(&cmd,\"REPLACE\",7));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 5310,
          "old_api": "zfree",
          "new_api": null,
          "old_text": "zfree(newargv)",
          "new_text": null,
          "old_line_content": "    zfree(ov); zfree(kv); zfree(newargv);",
          "new_line_content": "         * the currently selected socket to -1 to force SELECT the next time. */",
          "content_same": false
        },
        {
          "line": 5319,
          "old_api": "sdsfree",
          "new_api": null,
          "old_text": "sdsfree(cmd.io.buffer.ptr)",
          "new_text": null,
          "old_line_content": "    sdsfree(cmd.io.buffer.ptr);",
          "new_line_content": " * it works it's a shame to notify the error to the caller. */",
          "content_same": false
        },
        {
          "line": 5192,
          "old_api": "sdslen",
          "new_api": null,
          "old_text": "sdslen(buf)",
          "new_text": null,
          "old_line_content": "        while ((towrite = sdslen(buf)-pos) > 0) {",
          "new_line_content": "        sds buf = cmd.io.buffer.ptr;",
          "content_same": false
        },
        {
          "line": 5194,
          "old_api": "syncWrite",
          "new_api": null,
          "old_text": "syncWrite(cs->fd,buf+pos,towrite,timeout)",
          "new_text": null,
          "old_line_content": "            nwritten = syncWrite(cs->fd,buf+pos,towrite,timeout);",
          "new_line_content": "        int nwritten = 0;",
          "content_same": false
        },
        {
          "line": 5325,
          "old_api": "migrateCloseSocket",
          "new_api": null,
          "old_text": "migrateCloseSocket(c->argv[1],c->argv[2])",
          "new_text": null,
          "old_line_content": "    if (!argv_rewritten) migrateCloseSocket(c->argv[1],c->argv[2]);",
          "new_line_content": "    /* If the command was rewritten as DEL and there was a socket error,",
          "content_same": false
        },
        {
          "line": 5326,
          "old_api": "zfree",
          "new_api": null,
          "old_text": "zfree(newargv)",
          "new_text": null,
          "old_line_content": "    zfree(newargv);",
          "new_line_content": "     * we already closed the socket earlier. While migrateCloseSocket()",
          "content_same": false
        },
        {
          "line": 5453,
          "old_api": "getKeysFromCommand",
          "new_api": null,
          "old_text": "getKeysFromCommand(mcmd,margv,margc,&numkeys)",
          "new_text": null,
          "old_line_content": "        keyindex = getKeysFromCommand(mcmd,margv,margc,&numkeys);",
          "new_line_content": "        mcmd = ms->commands[i].cmd;",
          "content_same": false
        },
        {
          "line": 5456,
          "old_api": "keyHashSlot",
          "new_api": null,
          "old_text": "keyHashSlot((char*)thiskey->ptr,\n                                       sdslen(thiskey->ptr))",
          "new_text": null,
          "old_line_content": "            int thisslot = keyHashSlot((char*)thiskey->ptr,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 5585,
          "old_api": "sdsnew",
          "new_api": null,
          "old_text": "sdsnew(\"-CROSSSLOT Keys in request don't hash to the same slot\\r\\n\")",
          "new_text": null,
          "old_line_content": "        addReplySds(c,sdsnew(\"-CROSSSLOT Keys in request don't hash to the same slot\\r\\n\"));",
          "new_line_content": " * node we want to mention in the redirection. Moreover hashslot should",
          "content_same": false
        },
        {
          "line": 5590,
          "old_api": "sdsnew",
          "new_api": null,
          "old_text": "sdsnew(\"-TRYAGAIN Multiple keys request during rehashing of slot\\r\\n\")",
          "new_text": null,
          "old_line_content": "        addReplySds(c,sdsnew(\"-TRYAGAIN Multiple keys request during rehashing of slot\\r\\n\"));",
          "new_line_content": "    } else if (error_code == CLUSTER_REDIR_UNSTABLE) {",
          "content_same": false
        },
        {
          "line": 5208,
          "old_api": "syncReadLine",
          "new_api": null,
          "old_text": "syncReadLine(cs->fd, buf0, sizeof(buf0), timeout)",
          "new_text": null,
          "old_line_content": "    if (password && syncReadLine(cs->fd, buf0, sizeof(buf0), timeout) <= 0)",
          "new_line_content": "    char buf1[1024]; /* Select reply. */",
          "content_same": false
        },
        {
          "line": 5337,
          "old_api": "zfree",
          "new_api": null,
          "old_text": "zfree(kv)",
          "new_text": null,
          "old_line_content": "    zfree(ov); zfree(kv);",
          "new_line_content": "        goto try_again;",
          "content_same": false
        },
        {
          "line": 5338,
          "old_api": "addReplySds",
          "new_api": null,
          "old_text": "addReplySds(c,\n        sdscatprintf(sdsempty(),\n            \"-IOERR error or timeout %s to target instance\\r\\n\",\n            write_error ? \"writing\" : \"reading\"))",
          "new_text": null,
          "old_line_content": "    addReplySds(c,",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 5339,
          "old_api": "sdsempty",
          "new_api": null,
          "old_text": "sdsempty()",
          "new_text": null,
          "old_line_content": "        sdscatprintf(sdsempty(),",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 5592,
          "old_api": "sdsnew",
          "new_api": null,
          "old_text": "sdsnew(\"-CLUSTERDOWN The cluster is down\\r\\n\")",
          "new_text": null,
          "old_line_content": "        addReplySds(c,sdsnew(\"-CLUSTERDOWN The cluster is down\\r\\n\"));",
          "new_line_content": "         * but the slot is not \"stable\" currently as there is",
          "content_same": false
        },
        {
          "line": 5471,
          "old_api": "getKeysFreeResult",
          "new_api": null,
          "old_text": "getKeysFreeResult(keyindex)",
          "new_text": null,
          "old_line_content": "                    getKeysFreeResult(keyindex);",
          "new_line_content": "                 * state. However the state is yet to be updated, so this was",
          "content_same": false
        },
        {
          "line": 5603,
          "old_api": "serverPanic",
          "new_api": null,
          "old_text": "serverPanic(\"getNodeByQuery() unknown error.\")",
          "new_text": null,
          "old_line_content": "        serverPanic(\"getNodeByQuery() unknown error.\");",
          "new_line_content": "            \"-%s %d %s:%d\\r\\n\",",
          "content_same": false
        },
        {
          "line": 5220,
          "old_api": "zmalloc",
          "new_api": null,
          "old_text": "zmalloc(sizeof(robj*)*(num_keys+1))",
          "new_text": null,
          "old_line_content": "    if (!copy) newargv = zmalloc(sizeof(robj*)*(num_keys+1));",
          "new_line_content": "    int error_from_target = 0;",
          "content_same": false
        },
        {
          "line": 5223,
          "old_api": "syncReadLine",
          "new_api": null,
          "old_text": "syncReadLine(cs->fd, buf2, sizeof(buf2), timeout)",
          "new_text": null,
          "old_line_content": "        if (syncReadLine(cs->fd, buf2, sizeof(buf2), timeout) <= 0) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 5355,
          "old_api": "addReplyError",
          "new_api": null,
          "old_text": "addReplyError(c,\"This instance has cluster support disabled\")",
          "new_text": null,
          "old_line_content": "        addReplyError(c,\"This instance has cluster support disabled\");",
          "new_line_content": " * the target instance. See the Redis Cluster specification for more",
          "content_same": false
        },
        {
          "line": 5492,
          "old_api": "equalStringObjects",
          "new_api": null,
          "old_text": "equalStringObjects(firstkey,thiskey)",
          "new_text": null,
          "old_line_content": "                if (!equalStringObjects(firstkey,thiskey)) {",
          "new_line_content": "                }",
          "content_same": false
        },
        {
          "line": 5367,
          "old_api": "addReplyError",
          "new_api": null,
          "old_text": "addReplyError(c,\"This instance has cluster support disabled\")",
          "new_text": null,
          "old_line_content": "        addReplyError(c,\"This instance has cluster support disabled\");",
          "new_line_content": " * In this mode slaves will not redirect clients as long as clients access",
          "content_same": false
        },
        {
          "line": 5240,
          "old_api": "addReplyErrorFormat",
          "new_api": null,
          "old_text": "addReplyErrorFormat(c,\"Target instance replied with error: %s\",\n                    errbuf+1)",
          "new_text": null,
          "old_line_content": "                addReplyErrorFormat(c,\"Target instance replied with error: %s\",",
          "new_line_content": "                else if (select && buf1[0] == '-') errbuf = buf1;",
          "content_same": false
        },
        {
          "line": 5629,
          "old_api": "clusterRedirectClient",
          "new_api": null,
          "old_text": "clusterRedirectClient(c,NULL,0,CLUSTER_REDIR_DOWN_STATE)",
          "new_text": null,
          "old_line_content": "            clusterRedirectClient(c,NULL,0,CLUSTER_REDIR_DOWN_STATE);",
          "new_line_content": "        dictIterator *di;",
          "content_same": false
        },
        {
          "line": 5246,
          "old_api": "dbDelete",
          "new_api": null,
          "old_text": "dbDelete(c->db,kv[j])",
          "new_text": null,
          "old_line_content": "                dbDelete(c->db,kv[j]);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 5247,
          "old_api": "signalModifiedKey",
          "new_api": null,
          "old_text": "signalModifiedKey(c->db,kv[j])",
          "new_text": null,
          "old_line_content": "                signalModifiedKey(c->db,kv[j]);",
          "new_line_content": "        } else {",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 10,
      "total_additions": 54,
      "total_deletions": 54,
      "total_api_changes": 118
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 10,
        "api_related_lines": 118,
        "non_api_lines": 6,
        "non_api_line_numbers": [
          5161,
          5225,
          5230,
          5167,
          5232,
          5234
        ]
      }
    },
    "api_calls_before": 1225,
    "api_calls_after": 1225,
    "diff_info": {
      "added_lines": 8,
      "removed_lines": 4,
      "total_diff_lines": 69
    }
  }
}