{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/redis/modified_file/1bd0b54957ea71ac69d30d91806936161ac2b65f",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/redis/modified_file/1bd0b54957ea71ac69d30d91806936161ac2b65f/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/redis/modified_file/1bd0b54957ea71ac69d30d91806936161ac2b65f/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/redis/modified_file/1bd0b54957ea71ac69d30d91806936161ac2b65f/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 427,
          "old_api": "mstime",
          "new_api": "dictSetUnsignedIntegerVal",
          "old_text": "mstime()",
          "new_text": "dictSetUnsignedIntegerVal(de,new_dbids)",
          "old_line_content": "        if ((cycles % 64) == 0 && mstime()-start > 1) break;",
          "new_line_content": "            dictSetUnsignedIntegerVal(de,new_dbids);",
          "content_same": false
        },
        {
          "line": 467,
          "old_api": "dictSize",
          "new_api": "dictGetUnsignedIntegerVal",
          "old_text": "dictSize(slaveKeysWithExpire)",
          "new_text": "dictGetUnsignedIntegerVal(de)",
          "old_line_content": "    return dictSize(slaveKeysWithExpire);",
          "new_line_content": "    uint64_t dbids = dictGetUnsignedIntegerVal(de);",
          "content_same": false
        },
        {
          "line": 649,
          "old_api": "notifyKeyspaceEvent",
          "new_api": "dbGenericDelete",
          "old_text": "notifyKeyspaceEvent(NOTIFY_GENERIC,\"del\",key,c->db->id)",
          "new_text": "dbGenericDelete(c->db,key,server.lazyfree_lazy_expire,DB_FLAG_KEY_EXPIRED)",
          "old_line_content": "        notifyKeyspaceEvent(NOTIFY_GENERIC,\"del\",key,c->db->id);",
          "new_line_content": "        int deleted = dbGenericDelete(c->db,key,server.lazyfree_lazy_expire,DB_FLAG_KEY_EXPIRED);",
          "content_same": false
        },
        {
          "line": 650,
          "old_api": "addReply",
          "new_api": "serverAssertWithInfo",
          "old_text": "addReply(c, shared.cone)",
          "new_text": "serverAssertWithInfo(c,key,deleted)",
          "old_line_content": "        addReply(c, shared.cone);",
          "new_line_content": "        serverAssertWithInfo(c,key,deleted);",
          "content_same": false
        },
        {
          "line": 658,
          "old_api": "rewriteClientCommandArgument",
          "new_api": "addReply",
          "old_text": "rewriteClientCommandArgument(c,0,shared.pexpireat)",
          "new_text": "addReply(c, shared.cone)",
          "old_line_content": "            rewriteClientCommandArgument(c,0,shared.pexpireat);",
          "new_line_content": "        addReply(c, shared.cone);",
          "content_same": false
        },
        {
          "line": 677,
          "old_api": "commandTimeSnapshot",
          "new_api": "notifyKeyspaceEvent",
          "old_text": "commandTimeSnapshot()",
          "new_text": "notifyKeyspaceEvent(NOTIFY_GENERIC,\"expire\",key,c->db->id)",
          "old_line_content": "    expireGenericCommand(c,commandTimeSnapshot(),UNIT_SECONDS);",
          "new_line_content": "        notifyKeyspaceEvent(NOTIFY_GENERIC,\"expire\",key,c->db->id);",
          "content_same": false
        },
        {
          "line": 700,
          "old_api": "lookupKeyReadWithFlags",
          "new_api": "expireGenericCommand",
          "old_text": "lookupKeyReadWithFlags(c->db,c->argv[1],LOOKUP_NOTOUCH)",
          "new_text": "expireGenericCommand(c,0,UNIT_MILLISECONDS)",
          "old_line_content": "    if (lookupKeyReadWithFlags(c->db,c->argv[1],LOOKUP_NOTOUCH) == NULL) {",
          "new_line_content": "    expireGenericCommand(c,0,UNIT_MILLISECONDS);",
          "content_same": false
        },
        {
          "line": 709,
          "old_api": "commandTimeSnapshot",
          "new_api": "addReplyLongLong",
          "old_text": "commandTimeSnapshot()",
          "new_text": "addReplyLongLong(c,-2)",
          "old_line_content": "        ttl = output_abs ? expire : expire-commandTimeSnapshot();",
          "new_line_content": "        addReplyLongLong(c,-2);",
          "content_same": false
        },
        {
          "line": 715,
          "old_api": "addReplyLongLong",
          "new_api": "getExpire",
          "old_text": "addReplyLongLong(c,output_ms ? ttl : ((ttl+500)/1000))",
          "new_text": "getExpire(c->db,c->argv[1])",
          "old_line_content": "        addReplyLongLong(c,output_ms ? ttl : ((ttl+500)/1000));",
          "new_line_content": "    expire = getExpire(c->db,c->argv[1]);",
          "content_same": false
        },
        {
          "line": 721,
          "old_api": "ttlGenericCommand",
          "new_api": "addReplyLongLong",
          "old_text": "ttlGenericCommand(c, 0, 0)",
          "new_text": "addReplyLongLong(c,-1)",
          "old_line_content": "    ttlGenericCommand(c, 0, 0);",
          "new_line_content": "        addReplyLongLong(c,-1);",
          "content_same": false
        },
        {
          "line": 744,
          "old_api": "notifyKeyspaceEvent",
          "new_api": "ttlGenericCommand",
          "old_text": "notifyKeyspaceEvent(NOTIFY_GENERIC,\"persist\",c->argv[1],c->db->id)",
          "new_text": "ttlGenericCommand(c, 1, 1)",
          "old_line_content": "            notifyKeyspaceEvent(NOTIFY_GENERIC,\"persist\",c->argv[1],c->db->id);",
          "new_line_content": "    ttlGenericCommand(c, 1, 1);",
          "content_same": false
        },
        {
          "line": 751,
          "old_api": "addReply",
          "new_api": "signalModifiedKey",
          "old_text": "addReply(c,shared.czero)",
          "new_text": "signalModifiedKey(c,c->db,c->argv[1])",
          "old_line_content": "        addReply(c,shared.czero);",
          "new_line_content": "            signalModifiedKey(c,c->db,c->argv[1]);",
          "content_same": false
        },
        {
          "line": 759,
          "old_api": "lookupKeyRead",
          "new_api": "addReply",
          "old_text": "lookupKeyRead(c->db,c->argv[j])",
          "new_text": "addReply(c,shared.czero)",
          "old_line_content": "        if (lookupKeyRead(c->db,c->argv[j]) != NULL) touched++;",
          "new_line_content": "        addReply(c,shared.czero);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 640,
          "old_api": null,
          "new_api": "addReply",
          "old_text": null,
          "new_text": "addReply(c,shared.czero)",
          "old_line_content": "",
          "new_line_content": "                addReply(c,shared.czero);",
          "content_same": false
        },
        {
          "line": 768,
          "old_api": null,
          "new_api": "addReplyLongLong",
          "old_text": null,
          "new_text": "addReplyLongLong(c,touched)",
          "old_line_content": "",
          "new_line_content": "    addReplyLongLong(c,touched);",
          "content_same": false
        },
        {
          "line": 258,
          "old_api": null,
          "new_api": "dbSize",
          "old_text": null,
          "new_text": "dbSize(db, DB_EXPIRES)",
          "old_line_content": "            data.sampled = 0;",
          "new_line_content": "            if ((num = dbSize(db, DB_EXPIRES)) == 0) {",
          "content_same": false
        },
        {
          "line": 385,
          "old_api": null,
          "new_api": "mstime",
          "old_text": null,
          "new_text": "mstime()",
          "old_line_content": "         * bits set in the value bitmap. */",
          "new_line_content": "    mstime_t start = mstime();",
          "content_same": false
        },
        {
          "line": 387,
          "old_api": null,
          "new_api": "dictGetRandomKey",
          "old_text": null,
          "new_text": "dictGetRandomKey(slaveKeysWithExpire)",
          "old_line_content": "        while(dbids && dbid < server.dbnum) {",
          "new_line_content": "        dictEntry *de = dictGetRandomKey(slaveKeysWithExpire);",
          "content_same": false
        },
        {
          "line": 388,
          "old_api": null,
          "new_api": "dictGetKey",
          "old_text": null,
          "new_text": "dictGetKey(de)",
          "old_line_content": "            if ((dbids & 1) != 0) {",
          "new_line_content": "        sds keyname = dictGetKey(de);",
          "content_same": false
        },
        {
          "line": 646,
          "old_api": null,
          "new_api": "checkAlreadyExpired",
          "old_text": null,
          "new_text": "checkAlreadyExpired(when)",
          "old_line_content": "        aux = server.lazyfree_lazy_expire ? shared.unlink : shared.del;",
          "new_line_content": "    if (checkAlreadyExpired(when)) {",
          "content_same": false
        },
        {
          "line": 262,
          "old_api": null,
          "new_api": "mstime",
          "old_text": null,
          "new_text": "mstime()",
          "old_line_content": "",
          "new_line_content": "            data.now = mstime();",
          "content_same": false
        },
        {
          "line": 389,
          "old_api": null,
          "new_api": "dictGetUnsignedIntegerVal",
          "old_text": null,
          "new_text": "dictGetUnsignedIntegerVal(de)",
          "old_line_content": "                redisDb *db = server.db+dbid;",
          "new_line_content": "        uint64_t dbids = dictGetUnsignedIntegerVal(de);",
          "content_same": false
        },
        {
          "line": 521,
          "old_api": null,
          "new_api": "strcasecmp",
          "old_text": null,
          "new_text": "strcasecmp(opt,\"nx\")",
          "old_line_content": "            gt = 1;",
          "new_line_content": "        if (!strcasecmp(opt,\"nx\")) {",
          "content_same": false
        },
        {
          "line": 524,
          "old_api": null,
          "new_api": "strcasecmp",
          "old_text": null,
          "new_text": "strcasecmp(opt,\"xx\")",
          "old_line_content": "            lt = 1;",
          "new_line_content": "        } else if (!strcasecmp(opt,\"xx\")) {",
          "content_same": false
        },
        {
          "line": 398,
          "old_api": null,
          "new_api": "getKeySlot",
          "old_text": null,
          "new_text": "getKeySlot(keyname)",
          "old_line_content": "                     * but they might propagate to AOF) and trigger module hooks. */",
          "new_line_content": "                dictEntry *expire = dictFind(db->expires[getKeySlot(keyname)],keyname);",
          "content_same": false
        },
        {
          "line": 527,
          "old_api": null,
          "new_api": "strcasecmp",
          "old_text": null,
          "new_text": "strcasecmp(opt,\"gt\")",
          "old_line_content": "            return C_ERR;",
          "new_line_content": "        } else if (!strcasecmp(opt,\"gt\")) {",
          "content_same": false
        },
        {
          "line": 655,
          "old_api": null,
          "new_api": "rewriteClientCommandVector",
          "old_text": null,
          "new_text": "rewriteClientCommandVector(c,2,aux,key)",
          "old_line_content": "        /* Propagate as PEXPIREAT millisecond-timestamp",
          "new_line_content": "        rewriteClientCommandVector(c,2,aux,key);",
          "content_same": false
        },
        {
          "line": 656,
          "old_api": null,
          "new_api": "signalModifiedKey",
          "old_text": null,
          "new_text": "signalModifiedKey(c,c->db,key)",
          "old_line_content": "         * Only rewrite the command arg if not already PEXPIREAT */",
          "new_line_content": "        signalModifiedKey(c,c->db,key);",
          "content_same": false
        },
        {
          "line": 530,
          "old_api": null,
          "new_api": "strcasecmp",
          "old_text": null,
          "new_text": "strcasecmp(opt,\"lt\")",
          "old_line_content": "    }",
          "new_line_content": "        } else if (!strcasecmp(opt,\"lt\")) {",
          "content_same": false
        },
        {
          "line": 657,
          "old_api": null,
          "new_api": "notifyKeyspaceEvent",
          "old_text": null,
          "new_text": "notifyKeyspaceEvent(NOTIFY_GENERIC,\"del\",key,c->db->id)",
          "old_line_content": "        if (c->cmd->proc != pexpireatCommand) {",
          "new_line_content": "        notifyKeyspaceEvent(NOTIFY_GENERIC,\"del\",key,c->db->id);",
          "content_same": false
        },
        {
          "line": 402,
          "old_api": null,
          "new_api": "activeExpireCycleTryExpire",
          "old_text": null,
          "new_text": "activeExpireCycleTryExpire(server.db+dbid,expire,start)",
          "old_line_content": "                /* If the key was not expired in this DB, we need to set the",
          "new_line_content": "                    activeExpireCycleTryExpire(server.db+dbid,expire,start))",
          "content_same": false
        },
        {
          "line": 661,
          "old_api": null,
          "new_api": "setExpire",
          "old_text": null,
          "new_text": "setExpire(c,c->db,key,when)",
          "old_line_content": "        /* Avoid creating a string object when it's the same as argv[2] parameter  */",
          "new_line_content": "        setExpire(c,c->db,key,when);",
          "content_same": false
        },
        {
          "line": 534,
          "old_api": null,
          "new_api": "addReplyErrorFormat",
          "old_text": null,
          "new_text": "addReplyErrorFormat(c, \"Unsupported option %s\", opt)",
          "old_line_content": "        return C_ERR;",
          "new_line_content": "            addReplyErrorFormat(c, \"Unsupported option %s\", opt);",
          "content_same": false
        },
        {
          "line": 662,
          "old_api": null,
          "new_api": "addReply",
          "old_text": null,
          "new_text": "addReply(c,shared.cone)",
          "old_line_content": "        if (basetime != 0 || unit == UNIT_SECONDS) {",
          "new_line_content": "        addReply(c,shared.cone);",
          "content_same": false
        },
        {
          "line": 407,
          "old_api": null,
          "new_api": "postExecutionUnitOperations",
          "old_text": null,
          "new_text": "postExecutionUnitOperations()",
          "old_line_content": "                    noexpire++;",
          "new_line_content": "                    postExecutionUnitOperations();",
          "content_same": false
        },
        {
          "line": 666,
          "old_api": null,
          "new_api": "rewriteClientCommandArgument",
          "old_text": null,
          "new_text": "rewriteClientCommandArgument(c,0,shared.pexpireat)",
          "old_line_content": "        }",
          "new_line_content": "            rewriteClientCommandArgument(c,0,shared.pexpireat);",
          "content_same": false
        },
        {
          "line": 541,
          "old_api": null,
          "new_api": "addReplyError",
          "old_text": null,
          "new_text": "addReplyError(c, \"NX and XX, GT or LT options at the same time are not compatible\")",
          "old_line_content": "",
          "new_line_content": "        addReplyError(c, \"NX and XX, GT or LT options at the same time are not compatible\");",
          "content_same": false
        },
        {
          "line": 671,
          "old_api": null,
          "new_api": "createStringObjectFromLongLong",
          "old_text": null,
          "new_text": "createStringObjectFromLongLong(when)",
          "old_line_content": "        return;",
          "new_line_content": "            robj *when_obj = createStringObjectFromLongLong(when);",
          "content_same": false
        },
        {
          "line": 672,
          "old_api": null,
          "new_api": "rewriteClientCommandArgument",
          "old_text": null,
          "new_text": "rewriteClientCommandArgument(c,2,when_obj)",
          "old_line_content": "    }",
          "new_line_content": "            rewriteClientCommandArgument(c,2,when_obj);",
          "content_same": false
        },
        {
          "line": 673,
          "old_api": null,
          "new_api": "decrRefCount",
          "old_text": null,
          "new_text": "decrRefCount(when_obj)",
          "old_line_content": "}",
          "new_line_content": "            decrRefCount(when_obj);",
          "content_same": false
        },
        {
          "line": 546,
          "old_api": null,
          "new_api": "addReplyError",
          "old_text": null,
          "new_text": "addReplyError(c, \"GT and LT options at the same time are not compatible\")",
          "old_line_content": " * Expires Commands",
          "new_line_content": "        addReplyError(c, \"GT and LT options at the same time are not compatible\");",
          "content_same": false
        },
        {
          "line": 288,
          "old_api": null,
          "new_api": "dbScan",
          "old_text": null,
          "new_text": "dbScan(db, DB_EXPIRES, db->expires_cursor, -1, expireScanCallback, isExpiryDictValidForSamplingCb, &data)",
          "old_line_content": "",
          "new_line_content": "                db->expires_cursor = dbScan(db, DB_EXPIRES, db->expires_cursor, -1, expireScanCallback, isExpiryDictValidForSamplingCb, &data);",
          "content_same": false
        },
        {
          "line": 676,
          "old_api": null,
          "new_api": "signalModifiedKey",
          "old_text": null,
          "new_text": "signalModifiedKey(c,c->db,key)",
          "old_line_content": "void expireCommand(client *c) {",
          "new_line_content": "        signalModifiedKey(c,c->db,key);",
          "content_same": false
        },
        {
          "line": 685,
          "old_api": null,
          "new_api": "commandTimeSnapshot",
          "old_text": null,
          "new_text": "commandTimeSnapshot()",
          "old_line_content": "/* PEXPIRE key milliseconds [ NX | XX | GT | LT] */",
          "new_line_content": "    expireGenericCommand(c,commandTimeSnapshot(),UNIT_SECONDS);",
          "content_same": false
        },
        {
          "line": 429,
          "old_api": null,
          "new_api": "dictDelete",
          "old_text": null,
          "new_text": "dictDelete(slaveKeysWithExpire,keyname)",
          "old_line_content": "    }",
          "new_line_content": "            dictDelete(slaveKeysWithExpire,keyname);",
          "content_same": false
        },
        {
          "line": 178,
          "old_api": null,
          "new_api": "ustime",
          "old_text": null,
          "new_text": "ustime()",
          "old_line_content": "",
          "new_line_content": "    long long start = ustime(), timelimit, elapsed;",
          "content_same": false
        },
        {
          "line": 690,
          "old_api": null,
          "new_api": "expireGenericCommand",
          "old_text": null,
          "new_text": "expireGenericCommand(c,0,UNIT_SECONDS)",
          "old_line_content": "/* PEXPIREAT key unix-time-milliseconds [ NX | XX | GT | LT] */",
          "new_line_content": "    expireGenericCommand(c,0,UNIT_SECONDS);",
          "content_same": false
        },
        {
          "line": 435,
          "old_api": null,
          "new_api": "mstime",
          "old_text": null,
          "new_text": "mstime()",
          "old_line_content": "    if (slaveKeysWithExpire == NULL) {",
          "new_line_content": "        if ((cycles % 64) == 0 && mstime()-start > 1) break;",
          "content_same": false
        },
        {
          "line": 436,
          "old_api": null,
          "new_api": "dictSize",
          "old_text": null,
          "new_text": "dictSize(slaveKeysWithExpire)",
          "old_line_content": "        static dictType dt = {",
          "new_line_content": "        if (dictSize(slaveKeysWithExpire) == 0) break;",
          "content_same": false
        },
        {
          "line": 183,
          "old_api": null,
          "new_api": "isPausedActionsWithUpdate",
          "old_text": null,
          "new_text": "isPausedActionsWithUpdate(PAUSE_ACTION_EXPIRE)",
          "old_line_content": "",
          "new_line_content": "    if (isPausedActionsWithUpdate(PAUSE_ACTION_EXPIRE)) return;",
          "content_same": false
        },
        {
          "line": 695,
          "old_api": null,
          "new_api": "commandTimeSnapshot",
          "old_text": null,
          "new_text": "commandTimeSnapshot()",
          "old_line_content": "/* Implements TTL, PTTL, EXPIRETIME and PEXPIRETIME */",
          "new_line_content": "    expireGenericCommand(c,commandTimeSnapshot(),UNIT_MILLISECONDS);",
          "content_same": false
        },
        {
          "line": 312,
          "old_api": null,
          "new_api": "ustime",
          "old_text": null,
          "new_text": "ustime()",
          "old_line_content": "             * an acceptable amount of stale keys (logically expired but yet",
          "new_line_content": "                elapsed = ustime()-start;",
          "content_same": false
        },
        {
          "line": 573,
          "old_api": null,
          "new_api": "parseExtendedExpireArgumentsOrReply",
          "old_text": null,
          "new_text": "parseExtendedExpireArgumentsOrReply(c, &flag)",
          "old_line_content": "     * overflow by either unit conversion or basetime addition. */",
          "new_line_content": "    if (parseExtendedExpireArgumentsOrReply(c, &flag) != C_OK) {",
          "content_same": false
        },
        {
          "line": 577,
          "old_api": null,
          "new_api": "getLongLongFromObjectOrReply",
          "old_text": null,
          "new_text": "getLongLongFromObjectOrReply(c, param, &when, NULL)",
          "old_line_content": "            return;",
          "new_line_content": "    if (getLongLongFromObjectOrReply(c, param, &when, NULL) != C_OK)",
          "content_same": false
        },
        {
          "line": 708,
          "old_api": null,
          "new_api": "lookupKeyReadWithFlags",
          "old_text": null,
          "new_text": "lookupKeyReadWithFlags(c->db,c->argv[1],LOOKUP_NOTOUCH)",
          "old_line_content": "    if (expire != -1) {",
          "new_line_content": "    if (lookupKeyReadWithFlags(c->db,c->argv[1],LOOKUP_NOTOUCH) == NULL) {",
          "content_same": false
        },
        {
          "line": 453,
          "old_api": null,
          "new_api": "dictCreate",
          "old_text": null,
          "new_text": "dictCreate(&dt)",
          "old_line_content": "     * as it scans to find keys to remove. */",
          "new_line_content": "        slaveKeysWithExpire = dictCreate(&dt);",
          "content_same": false
        },
        {
          "line": 326,
          "old_api": null,
          "new_api": "ustime",
          "old_text": null,
          "new_text": "ustime()",
          "old_line_content": "        current_perc = (double)total_expired/total_sampled;",
          "new_line_content": "    elapsed = ustime()-start;",
          "content_same": false
        },
        {
          "line": 584,
          "old_api": null,
          "new_api": "addReplyErrorExpireTime",
          "old_text": null,
          "new_text": "addReplyErrorExpireTime(c)",
          "old_line_content": "        return;",
          "new_line_content": "            addReplyErrorExpireTime(c);",
          "content_same": false
        },
        {
          "line": 328,
          "old_api": null,
          "new_api": "latencyAddSampleIfNeeded",
          "old_text": null,
          "new_text": "latencyAddSampleIfNeeded(\"expire-cycle\",elapsed/1000)",
          "old_line_content": "        current_perc = 0;",
          "new_line_content": "    latencyAddSampleIfNeeded(\"expire-cycle\",elapsed/1000);",
          "content_same": false
        },
        {
          "line": 457,
          "old_api": null,
          "new_api": "dictAddOrFind",
          "old_text": null,
          "new_text": "dictAddOrFind(slaveKeysWithExpire,key->ptr)",
          "old_line_content": "    }",
          "new_line_content": "    dictEntry *de = dictAddOrFind(slaveKeysWithExpire,key->ptr);",
          "content_same": false
        },
        {
          "line": 717,
          "old_api": null,
          "new_api": "commandTimeSnapshot",
          "old_text": null,
          "new_text": "commandTimeSnapshot()",
          "old_line_content": "}",
          "new_line_content": "        ttl = output_abs ? expire : expire-commandTimeSnapshot();",
          "content_same": false
        },
        {
          "line": 462,
          "old_api": null,
          "new_api": "dictGetKey",
          "old_text": null,
          "new_text": "dictGetKey(de)",
          "old_line_content": "}",
          "new_line_content": "    if (dictGetKey(de) == key->ptr) {",
          "content_same": false
        },
        {
          "line": 591,
          "old_api": null,
          "new_api": "addReplyErrorExpireTime",
          "old_text": null,
          "new_text": "addReplyErrorExpireTime(c)",
          "old_line_content": "        return;",
          "new_line_content": "        addReplyErrorExpireTime(c);",
          "content_same": false
        },
        {
          "line": 463,
          "old_api": null,
          "new_api": "sdsdup",
          "old_text": null,
          "new_text": "sdsdup(key->ptr)",
          "old_line_content": "",
          "new_line_content": "        dictSetKey(slaveKeysWithExpire, de, sdsdup(key->ptr));",
          "content_same": false
        },
        {
          "line": 464,
          "old_api": null,
          "new_api": "dictSetUnsignedIntegerVal",
          "old_text": null,
          "new_text": "dictSetUnsignedIntegerVal(de,0)",
          "old_line_content": "/* Return the number of keys we are tracking. */",
          "new_line_content": "        dictSetUnsignedIntegerVal(de,0);",
          "content_same": false
        },
        {
          "line": 723,
          "old_api": null,
          "new_api": "addReplyLongLong",
          "old_text": null,
          "new_text": "addReplyLongLong(c,output_ms ? ttl : ((ttl+500)/1000))",
          "old_line_content": "",
          "new_line_content": "        addReplyLongLong(c,output_ms ? ttl : ((ttl+500)/1000));",
          "content_same": false
        },
        {
          "line": 597,
          "old_api": null,
          "new_api": "lookupKeyWrite",
          "old_text": null,
          "new_text": "lookupKeyWrite(c->db,key)",
          "old_line_content": "        /* NX option is set, check current expiry */",
          "new_line_content": "    if (lookupKeyWrite(c->db,key) == NULL) {",
          "content_same": false
        },
        {
          "line": 598,
          "old_api": null,
          "new_api": "addReply",
          "old_text": null,
          "new_text": "addReply(c,shared.czero)",
          "old_line_content": "        if (flag & EXPIRE_NX) {",
          "new_line_content": "        addReply(c,shared.czero);",
          "content_same": false
        },
        {
          "line": 469,
          "old_api": null,
          "new_api": "dictSetUnsignedIntegerVal",
          "old_text": null,
          "new_text": "dictSetUnsignedIntegerVal(de,dbids)",
          "old_line_content": "",
          "new_line_content": "    dictSetUnsignedIntegerVal(de,dbids);",
          "content_same": false
        },
        {
          "line": 729,
          "old_api": null,
          "new_api": "ttlGenericCommand",
          "old_text": null,
          "new_text": "ttlGenericCommand(c, 0, 0)",
          "old_line_content": "/* EXPIRETIME key */",
          "new_line_content": "    ttlGenericCommand(c, 0, 0);",
          "content_same": false
        },
        {
          "line": 603,
          "old_api": null,
          "new_api": "getExpire",
          "old_text": null,
          "new_text": "getExpire(c->db, key)",
          "old_line_content": "        }",
          "new_line_content": "        current_expire = getExpire(c->db, key);",
          "content_same": false
        },
        {
          "line": 475,
          "old_api": null,
          "new_api": "dictSize",
          "old_text": null,
          "new_text": "dictSize(slaveKeysWithExpire)",
          "old_line_content": " * but it is not worth it since anyway race conditions using the same set",
          "new_line_content": "    return dictSize(slaveKeysWithExpire);",
          "content_same": false
        },
        {
          "line": 734,
          "old_api": null,
          "new_api": "ttlGenericCommand",
          "old_text": null,
          "new_text": "ttlGenericCommand(c, 1, 0)",
          "old_line_content": "/* PEXPIRETIME key */",
          "new_line_content": "    ttlGenericCommand(c, 1, 0);",
          "content_same": false
        },
        {
          "line": 608,
          "old_api": null,
          "new_api": "addReply",
          "old_text": null,
          "new_text": "addReply(c,shared.czero)",
          "old_line_content": "                /* reply 0 when the key has no expiry */",
          "new_line_content": "                addReply(c,shared.czero);",
          "content_same": false
        },
        {
          "line": 739,
          "old_api": null,
          "new_api": "ttlGenericCommand",
          "old_text": null,
          "new_text": "ttlGenericCommand(c, 0, 1)",
          "old_line_content": "/* PERSIST key */",
          "new_line_content": "    ttlGenericCommand(c, 0, 1);",
          "content_same": false
        },
        {
          "line": 228,
          "old_api": null,
          "new_api": "serverAssert",
          "old_text": null,
          "new_text": "serverAssert(server.also_propagate.numops == 0)",
          "old_line_content": "",
          "new_line_content": "    serverAssert(server.also_propagate.numops == 0);",
          "content_same": false
        },
        {
          "line": 488,
          "old_api": null,
          "new_api": "dictRelease",
          "old_text": null,
          "new_text": "dictRelease(slaveKeysWithExpire)",
          "old_line_content": "     * of a slave instance.",
          "new_line_content": "        dictRelease(slaveKeysWithExpire);",
          "content_same": false
        },
        {
          "line": 617,
          "old_api": null,
          "new_api": "addReply",
          "old_text": null,
          "new_text": "addReply(c,shared.czero)",
          "old_line_content": "             * so expire command with gt always fail the GT. */",
          "new_line_content": "                addReply(c,shared.czero);",
          "content_same": false
        },
        {
          "line": 749,
          "old_api": null,
          "new_api": "lookupKeyWrite",
          "old_text": null,
          "new_text": "lookupKeyWrite(c->db,c->argv[1])",
          "old_line_content": "        }",
          "new_line_content": "    if (lookupKeyWrite(c->db,c->argv[1])) {",
          "content_same": false
        },
        {
          "line": 750,
          "old_api": null,
          "new_api": "removeExpire",
          "old_text": null,
          "new_text": "removeExpire(c->db,c->argv[1])",
          "old_line_content": "    } else {",
          "new_line_content": "        if (removeExpire(c->db,c->argv[1])) {",
          "content_same": false
        },
        {
          "line": 752,
          "old_api": null,
          "new_api": "notifyKeyspaceEvent",
          "old_text": null,
          "new_text": "notifyKeyspaceEvent(NOTIFY_GENERIC,\"persist\",c->argv[1],c->db->id)",
          "old_line_content": "    }",
          "new_line_content": "            notifyKeyspaceEvent(NOTIFY_GENERIC,\"persist\",c->argv[1],c->db->id);",
          "content_same": false
        },
        {
          "line": 753,
          "old_api": null,
          "new_api": "addReply",
          "old_text": null,
          "new_text": "addReply(c,shared.cone)",
          "old_line_content": "}",
          "new_line_content": "            addReply(c,shared.cone);",
          "content_same": false
        },
        {
          "line": 628,
          "old_api": null,
          "new_api": "addReply",
          "old_text": null,
          "new_text": "addReply(c,shared.czero)",
          "old_line_content": "             * but 'when' can still be negative at this point, so if there is",
          "new_line_content": "                addReply(c,shared.czero);",
          "content_same": false
        },
        {
          "line": 756,
          "old_api": null,
          "new_api": "addReply",
          "old_text": null,
          "new_text": "addReply(c,shared.czero)",
          "old_line_content": "void touchCommand(client *c) {",
          "new_line_content": "            addReply(c,shared.czero);",
          "content_same": false
        },
        {
          "line": 500,
          "old_api": null,
          "new_api": "commandTimeSnapshot",
          "old_text": null,
          "new_text": "commandTimeSnapshot()",
          "old_line_content": "/* Parse additional flags of expire commands",
          "new_line_content": "    return (when <= commandTimeSnapshot() && !server.loading && !server.masterhost);",
          "content_same": false
        },
        {
          "line": 247,
          "old_api": null,
          "new_api": "dbSize",
          "old_text": null,
          "new_text": "dbSize(db, DB_EXPIRES)",
          "old_line_content": "            iteration++;",
          "new_line_content": "        if (dbSize(db, DB_EXPIRES)) dbs_performed++;",
          "content_same": false
        },
        {
          "line": 382,
          "old_api": null,
          "new_api": "dictSize",
          "old_text": null,
          "new_text": "dictSize(slaveKeysWithExpire)",
          "old_line_content": "        uint64_t new_dbids = 0;",
          "new_line_content": "        dictSize(slaveKeysWithExpire) == 0) return;",
          "content_same": false
        },
        {
          "line": 767,
          "old_api": null,
          "new_api": "lookupKeyRead",
          "old_text": null,
          "new_text": "lookupKeyRead(c->db,c->argv[j])",
          "old_line_content": "",
          "new_line_content": "        if (lookupKeyRead(c->db,c->argv[j]) != NULL) touched++;",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 513,
          "old_api": "strcasecmp",
          "new_api": null,
          "old_text": "strcasecmp(opt,\"nx\")",
          "new_text": null,
          "old_line_content": "        if (!strcasecmp(opt,\"nx\")) {",
          "new_line_content": " * - GT: set expiry only when the new expiry is greater than current one",
          "content_same": false
        },
        {
          "line": 641,
          "old_api": "dbGenericDelete",
          "new_api": null,
          "old_text": "dbGenericDelete(c->db,key,server.lazyfree_lazy_expire,DB_FLAG_KEY_EXPIRED)",
          "new_text": null,
          "old_line_content": "        int deleted = dbGenericDelete(c->db,key,server.lazyfree_lazy_expire,DB_FLAG_KEY_EXPIRED);",
          "new_line_content": "                return;",
          "content_same": false
        },
        {
          "line": 642,
          "old_api": "serverAssertWithInfo",
          "new_api": null,
          "old_text": "serverAssertWithInfo(c,key,deleted)",
          "new_text": null,
          "old_line_content": "        serverAssertWithInfo(c,key,deleted);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 516,
          "old_api": "strcasecmp",
          "new_api": null,
          "old_text": "strcasecmp(opt,\"xx\")",
          "new_text": null,
          "old_line_content": "        } else if (!strcasecmp(opt,\"xx\")) {",
          "new_line_content": "    int nx = 0, xx = 0, gt = 0, lt = 0;",
          "content_same": false
        },
        {
          "line": 390,
          "old_api": "getKeySlot",
          "new_api": null,
          "old_text": "getKeySlot(keyname)",
          "new_text": null,
          "old_line_content": "                dictEntry *expire = dictFind(db->expires[getKeySlot(keyname)],keyname);",
          "new_line_content": "        uint64_t new_dbids = 0;",
          "content_same": false
        },
        {
          "line": 519,
          "old_api": "strcasecmp",
          "new_api": null,
          "old_text": "strcasecmp(opt,\"gt\")",
          "new_text": null,
          "old_line_content": "        } else if (!strcasecmp(opt,\"gt\")) {",
          "new_line_content": "    while (j < c->argc) {",
          "content_same": false
        },
        {
          "line": 647,
          "old_api": "rewriteClientCommandVector",
          "new_api": null,
          "old_text": "rewriteClientCommandVector(c,2,aux,key)",
          "new_text": null,
          "old_line_content": "        rewriteClientCommandVector(c,2,aux,key);",
          "new_line_content": "        robj *aux;",
          "content_same": false
        },
        {
          "line": 648,
          "old_api": "signalModifiedKey",
          "new_api": null,
          "old_text": "signalModifiedKey(c,c->db,key)",
          "new_text": null,
          "old_line_content": "        signalModifiedKey(c,c->db,key);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 522,
          "old_api": "strcasecmp",
          "new_api": null,
          "old_text": "strcasecmp(opt,\"lt\")",
          "new_text": null,
          "old_line_content": "        } else if (!strcasecmp(opt,\"lt\")) {",
          "new_line_content": "            *flags |= EXPIRE_NX;",
          "content_same": false
        },
        {
          "line": 394,
          "old_api": "activeExpireCycleTryExpire",
          "new_api": null,
          "old_text": "activeExpireCycleTryExpire(server.db+dbid,expire,start)",
          "new_text": null,
          "old_line_content": "                    activeExpireCycleTryExpire(server.db+dbid,expire,start))",
          "new_line_content": "        int dbid = 0;",
          "content_same": false
        },
        {
          "line": 653,
          "old_api": "setExpire",
          "new_api": null,
          "old_text": "setExpire(c,c->db,key,when)",
          "new_text": null,
          "old_line_content": "        setExpire(c,c->db,key,when);",
          "new_line_content": "        /* Replicate/AOF this as an explicit DEL or UNLINK. */",
          "content_same": false
        },
        {
          "line": 526,
          "old_api": "addReplyErrorFormat",
          "new_api": null,
          "old_text": "addReplyErrorFormat(c, \"Unsupported option %s\", opt)",
          "new_text": null,
          "old_line_content": "            addReplyErrorFormat(c, \"Unsupported option %s\", opt);",
          "new_line_content": "            xx = 1;",
          "content_same": false
        },
        {
          "line": 654,
          "old_api": "addReply",
          "new_api": null,
          "old_text": "addReply(c,shared.cone)",
          "new_text": null,
          "old_line_content": "        addReply(c,shared.cone);",
          "new_line_content": "        aux = server.lazyfree_lazy_expire ? shared.unlink : shared.del;",
          "content_same": false
        },
        {
          "line": 399,
          "old_api": "postExecutionUnitOperations",
          "new_api": null,
          "old_text": "postExecutionUnitOperations()",
          "new_text": null,
          "old_line_content": "                    postExecutionUnitOperations();",
          "new_line_content": "                int expired = 0;",
          "content_same": false
        },
        {
          "line": 533,
          "old_api": "addReplyError",
          "new_api": null,
          "old_text": "addReplyError(c, \"NX and XX, GT or LT options at the same time are not compatible\")",
          "new_text": null,
          "old_line_content": "        addReplyError(c, \"NX and XX, GT or LT options at the same time are not compatible\");",
          "new_line_content": "        } else {",
          "content_same": false
        },
        {
          "line": 663,
          "old_api": "createStringObjectFromLongLong",
          "new_api": null,
          "old_text": "createStringObjectFromLongLong(when)",
          "new_text": null,
          "old_line_content": "            robj *when_obj = createStringObjectFromLongLong(when);",
          "new_line_content": "        /* Propagate as PEXPIREAT millisecond-timestamp",
          "content_same": false
        },
        {
          "line": 664,
          "old_api": "rewriteClientCommandArgument",
          "new_api": null,
          "old_text": "rewriteClientCommandArgument(c,2,when_obj)",
          "new_text": null,
          "old_line_content": "            rewriteClientCommandArgument(c,2,when_obj);",
          "new_line_content": "         * Only rewrite the command arg if not already PEXPIREAT */",
          "content_same": false
        },
        {
          "line": 665,
          "old_api": "decrRefCount",
          "new_api": null,
          "old_text": "decrRefCount(when_obj)",
          "new_text": null,
          "old_line_content": "            decrRefCount(when_obj);",
          "new_line_content": "        if (c->cmd->proc != pexpireatCommand) {",
          "content_same": false
        },
        {
          "line": 538,
          "old_api": "addReplyError",
          "new_api": null,
          "old_text": "addReplyError(c, \"GT and LT options at the same time are not compatible\")",
          "new_text": null,
          "old_line_content": "        addReplyError(c, \"GT and LT options at the same time are not compatible\");",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 280,
          "old_api": "dbScan",
          "new_api": null,
          "old_text": "dbScan(db, DB_EXPIRES, db->expires_cursor, -1, expireScanCallback, isExpiryDictValidForSamplingCb, &data)",
          "new_text": null,
          "old_line_content": "                db->expires_cursor = dbScan(db, DB_EXPIRES, db->expires_cursor, -1, expireScanCallback, isExpiryDictValidForSamplingCb, &data);",
          "new_line_content": "             * buckets that we scanned. However scanning for free buckets",
          "content_same": false
        },
        {
          "line": 668,
          "old_api": "signalModifiedKey",
          "new_api": null,
          "old_text": "signalModifiedKey(c,c->db,key)",
          "new_text": null,
          "old_line_content": "        signalModifiedKey(c,c->db,key);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 669,
          "old_api": "notifyKeyspaceEvent",
          "new_api": null,
          "old_text": "notifyKeyspaceEvent(NOTIFY_GENERIC,\"expire\",key,c->db->id)",
          "new_text": null,
          "old_line_content": "        notifyKeyspaceEvent(NOTIFY_GENERIC,\"expire\",key,c->db->id);",
          "new_line_content": "        /* Avoid creating a string object when it's the same as argv[2] parameter  */",
          "content_same": false
        },
        {
          "line": 419,
          "old_api": "dictSetUnsignedIntegerVal",
          "new_api": null,
          "old_text": "dictSetUnsignedIntegerVal(de,new_dbids)",
          "new_text": null,
          "old_line_content": "            dictSetUnsignedIntegerVal(de,new_dbids);",
          "new_line_content": "            dbid++;",
          "content_same": false
        },
        {
          "line": 421,
          "old_api": "dictDelete",
          "new_api": null,
          "old_text": "dictDelete(slaveKeysWithExpire,keyname)",
          "new_text": null,
          "old_line_content": "            dictDelete(slaveKeysWithExpire,keyname);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 682,
          "old_api": "expireGenericCommand",
          "new_api": null,
          "old_text": "expireGenericCommand(c,0,UNIT_SECONDS)",
          "new_text": null,
          "old_line_content": "    expireGenericCommand(c,0,UNIT_SECONDS);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 428,
          "old_api": "dictSize",
          "new_api": null,
          "old_text": "dictSize(slaveKeysWithExpire)",
          "new_text": null,
          "old_line_content": "        if (dictSize(slaveKeysWithExpire) == 0) break;",
          "new_line_content": "        else",
          "content_same": false
        },
        {
          "line": 687,
          "old_api": "commandTimeSnapshot",
          "new_api": null,
          "old_text": "commandTimeSnapshot()",
          "new_text": null,
          "old_line_content": "    expireGenericCommand(c,commandTimeSnapshot(),UNIT_MILLISECONDS);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 304,
          "old_api": "ustime",
          "new_api": null,
          "old_text": "ustime()",
          "new_text": null,
          "old_line_content": "                elapsed = ustime()-start;",
          "new_line_content": "                if (db->avg_ttl == 0) db->avg_ttl = avg_ttl;",
          "content_same": false
        },
        {
          "line": 177,
          "old_api": "ustime",
          "new_api": null,
          "old_text": "ustime()",
          "new_text": null,
          "old_line_content": "    long long start = ustime(), timelimit, elapsed;",
          "new_line_content": "    int dbs_performed = 0;",
          "content_same": false
        },
        {
          "line": 692,
          "old_api": "expireGenericCommand",
          "new_api": null,
          "old_text": "expireGenericCommand(c,0,UNIT_MILLISECONDS)",
          "new_text": null,
          "old_line_content": "    expireGenericCommand(c,0,UNIT_MILLISECONDS);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 565,
          "old_api": "parseExtendedExpireArgumentsOrReply",
          "new_api": null,
          "old_text": "parseExtendedExpireArgumentsOrReply(c, &flag)",
          "new_text": null,
          "old_line_content": "    if (parseExtendedExpireArgumentsOrReply(c, &flag) != C_OK) {",
          "new_line_content": " * Additional flags are supported and parsed via parseExtendedExpireArguments */",
          "content_same": false
        },
        {
          "line": 182,
          "old_api": "isPausedActionsWithUpdate",
          "new_api": null,
          "old_text": "isPausedActionsWithUpdate(PAUSE_ACTION_EXPIRE)",
          "new_text": null,
          "old_line_content": "    if (isPausedActionsWithUpdate(PAUSE_ACTION_EXPIRE)) return;",
          "new_line_content": "     * will have failed over and the new primary will send us the expire. */",
          "content_same": false
        },
        {
          "line": 569,
          "old_api": "getLongLongFromObjectOrReply",
          "new_api": null,
          "old_text": "getLongLongFromObjectOrReply(c, param, &when, NULL)",
          "new_text": null,
          "old_line_content": "    if (getLongLongFromObjectOrReply(c, param, &when, NULL) != C_OK)",
          "new_line_content": "    long long current_expire = -1;",
          "content_same": false
        },
        {
          "line": 701,
          "old_api": "addReplyLongLong",
          "new_api": null,
          "old_text": "addReplyLongLong(c,-2)",
          "new_text": null,
          "old_line_content": "        addReplyLongLong(c,-2);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 318,
          "old_api": "ustime",
          "new_api": null,
          "old_text": "ustime()",
          "new_text": null,
          "old_line_content": "    elapsed = ustime()-start;",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 445,
          "old_api": "dictCreate",
          "new_api": null,
          "old_text": "dictCreate(&dt)",
          "new_text": null,
          "old_line_content": "        slaveKeysWithExpire = dictCreate(&dt);",
          "new_line_content": "            dictSdsHash,                /* hash function */",
          "content_same": false
        },
        {
          "line": 576,
          "old_api": "addReplyErrorExpireTime",
          "new_api": null,
          "old_text": "addReplyErrorExpireTime(c)",
          "new_text": null,
          "old_line_content": "            addReplyErrorExpireTime(c);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 320,
          "old_api": "latencyAddSampleIfNeeded",
          "new_api": null,
          "old_text": "latencyAddSampleIfNeeded(\"expire-cycle\",elapsed/1000)",
          "new_text": null,
          "old_line_content": "    latencyAddSampleIfNeeded(\"expire-cycle\",elapsed/1000);",
          "new_line_content": "             * an acceptable amount of stale keys (logically expired but yet",
          "content_same": false
        },
        {
          "line": 449,
          "old_api": "dictAddOrFind",
          "new_api": null,
          "old_text": "dictAddOrFind(slaveKeysWithExpire,key->ptr)",
          "new_text": null,
          "old_line_content": "    dictEntry *de = dictAddOrFind(slaveKeysWithExpire,key->ptr);",
          "new_line_content": "            dictSdsDestructor,          /* key destructor */",
          "content_same": false
        },
        {
          "line": 707,
          "old_api": "getExpire",
          "new_api": null,
          "old_text": "getExpire(c->db,c->argv[1])",
          "new_text": null,
          "old_line_content": "    expire = getExpire(c->db,c->argv[1]);",
          "new_line_content": "    /* If the key does not exist at all, return -2 */",
          "content_same": false
        },
        {
          "line": 454,
          "old_api": "dictGetKey",
          "new_api": null,
          "old_text": "dictGetKey(de)",
          "new_text": null,
          "old_line_content": "    if (dictGetKey(de) == key->ptr) {",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 583,
          "old_api": "addReplyErrorExpireTime",
          "new_api": null,
          "old_text": "addReplyErrorExpireTime(c)",
          "new_text": null,
          "old_line_content": "        addReplyErrorExpireTime(c);",
          "new_line_content": "        if (when > LLONG_MAX / 1000 || when < LLONG_MIN / 1000) {",
          "content_same": false
        },
        {
          "line": 455,
          "old_api": "sdsdup",
          "new_api": null,
          "old_text": "sdsdup(key->ptr)",
          "new_text": null,
          "old_line_content": "        dictSetKey(slaveKeysWithExpire, de, sdsdup(key->ptr));",
          "new_line_content": "    if (db->id > 63) return;",
          "content_same": false
        },
        {
          "line": 713,
          "old_api": "addReplyLongLong",
          "new_api": null,
          "old_text": "addReplyLongLong(c,-1)",
          "new_text": null,
          "old_line_content": "        addReplyLongLong(c,-1);",
          "new_line_content": "    /* The key exists. Return -1 if it has no expire, or the actual",
          "content_same": false
        },
        {
          "line": 456,
          "old_api": "dictSetUnsignedIntegerVal",
          "new_api": null,
          "old_text": "dictSetUnsignedIntegerVal(de,0)",
          "new_text": null,
          "old_line_content": "        dictSetUnsignedIntegerVal(de,0);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 459,
          "old_api": "dictGetUnsignedIntegerVal",
          "new_api": null,
          "old_text": "dictGetUnsignedIntegerVal(de)",
          "new_text": null,
          "old_line_content": "    uint64_t dbids = dictGetUnsignedIntegerVal(de);",
          "new_line_content": "     * representing the key: we don't want to need to take those keys",
          "content_same": false
        },
        {
          "line": 589,
          "old_api": "lookupKeyWrite",
          "new_api": null,
          "old_text": "lookupKeyWrite(c->db,key)",
          "new_text": null,
          "old_line_content": "    if (lookupKeyWrite(c->db,key) == NULL) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 590,
          "old_api": "addReply",
          "new_api": null,
          "old_text": "addReply(c,shared.czero)",
          "new_text": null,
          "old_line_content": "        addReply(c,shared.czero);",
          "new_line_content": "    if (when > LLONG_MAX - basetime) {",
          "content_same": false
        },
        {
          "line": 461,
          "old_api": "dictSetUnsignedIntegerVal",
          "new_api": null,
          "old_text": "dictSetUnsignedIntegerVal(de,dbids)",
          "new_text": null,
          "old_line_content": "    dictSetUnsignedIntegerVal(de,dbids);",
          "new_line_content": "     * as it scans to find keys to remove. */",
          "content_same": false
        },
        {
          "line": 595,
          "old_api": "getExpire",
          "new_api": null,
          "old_text": "getExpire(c->db, key)",
          "new_text": null,
          "old_line_content": "        current_expire = getExpire(c->db, key);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 726,
          "old_api": "ttlGenericCommand",
          "new_api": null,
          "old_text": "ttlGenericCommand(c, 1, 0)",
          "new_text": null,
          "old_line_content": "    ttlGenericCommand(c, 1, 0);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 600,
          "old_api": "addReply",
          "new_api": null,
          "old_text": "addReply(c,shared.czero)",
          "new_text": null,
          "old_line_content": "                addReply(c,shared.czero);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 731,
          "old_api": "ttlGenericCommand",
          "new_api": null,
          "old_text": "ttlGenericCommand(c, 0, 1)",
          "new_text": null,
          "old_line_content": "    ttlGenericCommand(c, 0, 1);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 736,
          "old_api": "ttlGenericCommand",
          "new_api": null,
          "old_text": "ttlGenericCommand(c, 1, 1)",
          "new_text": null,
          "old_line_content": "    ttlGenericCommand(c, 1, 1);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 609,
          "old_api": "addReply",
          "new_api": null,
          "old_text": "addReply(c,shared.czero)",
          "new_text": null,
          "old_line_content": "                addReply(c,shared.czero);",
          "new_line_content": "                return;",
          "content_same": false
        },
        {
          "line": 480,
          "old_api": "dictRelease",
          "new_api": null,
          "old_text": "dictRelease(slaveKeysWithExpire)",
          "new_text": null,
          "old_line_content": "        dictRelease(slaveKeysWithExpire);",
          "new_line_content": " * the same name/db and it is no longer a good idea to expire them.",
          "content_same": false
        },
        {
          "line": 227,
          "old_api": "serverAssert",
          "new_api": null,
          "old_text": "serverAssert(server.also_propagate.numops == 0)",
          "new_text": null,
          "old_line_content": "    serverAssert(server.also_propagate.numops == 0);",
          "new_line_content": "    /* Try to smoke-out bugs (server.also_propagate should be empty here) */",
          "content_same": false
        },
        {
          "line": 741,
          "old_api": "lookupKeyWrite",
          "new_api": null,
          "old_text": "lookupKeyWrite(c->db,c->argv[1])",
          "new_text": null,
          "old_line_content": "    if (lookupKeyWrite(c->db,c->argv[1])) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 742,
          "old_api": "removeExpire",
          "new_api": null,
          "old_text": "removeExpire(c->db,c->argv[1])",
          "new_text": null,
          "old_line_content": "        if (removeExpire(c->db,c->argv[1])) {",
          "new_line_content": "/* PEXPIRETIME key */",
          "content_same": false
        },
        {
          "line": 743,
          "old_api": "signalModifiedKey",
          "new_api": null,
          "old_text": "signalModifiedKey(c,c->db,c->argv[1])",
          "new_text": null,
          "old_line_content": "            signalModifiedKey(c,c->db,c->argv[1]);",
          "new_line_content": "void pexpiretimeCommand(client *c) {",
          "content_same": false
        },
        {
          "line": 745,
          "old_api": "addReply",
          "new_api": null,
          "old_text": "addReply(c,shared.cone)",
          "new_text": null,
          "old_line_content": "            addReply(c,shared.cone);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 620,
          "old_api": "addReply",
          "new_api": null,
          "old_text": "addReply(c,shared.czero)",
          "new_text": null,
          "old_line_content": "                addReply(c,shared.czero);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 748,
          "old_api": "addReply",
          "new_api": null,
          "old_text": "addReply(c,shared.czero)",
          "new_text": null,
          "old_line_content": "            addReply(c,shared.czero);",
          "new_line_content": "void persistCommand(client *c) {",
          "content_same": false
        },
        {
          "line": 492,
          "old_api": "commandTimeSnapshot",
          "new_api": null,
          "old_text": "commandTimeSnapshot()",
          "new_text": null,
          "old_line_content": "    return (when <= commandTimeSnapshot() && !server.loading && !server.masterhost);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 760,
          "old_api": "addReplyLongLong",
          "new_api": null,
          "old_text": "addReplyLongLong(c,touched)",
          "new_text": null,
          "old_line_content": "    addReplyLongLong(c,touched);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 374,
          "old_api": "dictSize",
          "new_api": null,
          "old_text": "dictSize(slaveKeysWithExpire)",
          "new_text": null,
          "old_line_content": "        dictSize(slaveKeysWithExpire) == 0) return;",
          "new_line_content": " * to the max 64 bit unsigned value when we know there is a key with a DB",
          "content_same": false
        },
        {
          "line": 254,
          "old_api": "mstime",
          "new_api": null,
          "old_text": "mstime()",
          "new_text": null,
          "old_line_content": "            data.now = mstime();",
          "new_line_content": "            unsigned long num;",
          "content_same": false
        },
        {
          "line": 632,
          "old_api": "addReply",
          "new_api": null,
          "old_text": "addReply(c,shared.czero)",
          "new_text": null,
          "old_line_content": "                addReply(c,shared.czero);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 377,
          "old_api": "mstime",
          "new_api": null,
          "old_text": "mstime()",
          "new_text": null,
          "old_line_content": "    mstime_t start = mstime();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 250,
          "old_api": "dbSize",
          "new_api": null,
          "old_text": "dbSize(db, DB_EXPIRES)",
          "new_text": null,
          "old_line_content": "            if ((num = dbSize(db, DB_EXPIRES)) == 0) {",
          "new_line_content": "         * a big percentage of keys to expire, compared to the number of keys",
          "content_same": false
        },
        {
          "line": 379,
          "old_api": "dictGetRandomKey",
          "new_api": null,
          "old_text": "dictGetRandomKey(slaveKeysWithExpire)",
          "new_text": null,
          "old_line_content": "        dictEntry *de = dictGetRandomKey(slaveKeysWithExpire);",
          "new_line_content": " * check if they should be evicted. */",
          "content_same": false
        },
        {
          "line": 380,
          "old_api": "dictGetKey",
          "new_api": null,
          "old_text": "dictGetKey(de)",
          "new_text": null,
          "old_line_content": "        sds keyname = dictGetKey(de);",
          "new_line_content": "void expireSlaveKeys(void) {",
          "content_same": false
        },
        {
          "line": 381,
          "old_api": "dictGetUnsignedIntegerVal",
          "new_api": null,
          "old_text": "dictGetUnsignedIntegerVal(de)",
          "new_text": null,
          "old_line_content": "        uint64_t dbids = dictGetUnsignedIntegerVal(de);",
          "new_line_content": "    if (slaveKeysWithExpire == NULL ||",
          "content_same": false
        },
        {
          "line": 638,
          "old_api": "checkAlreadyExpired",
          "new_api": null,
          "old_text": "checkAlreadyExpired(when)",
          "new_text": null,
          "old_line_content": "    if (checkAlreadyExpired(when)) {",
          "new_line_content": "            if (current_expire != -1 && when >= current_expire) {",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 13,
      "total_additions": 75,
      "total_deletions": 74,
      "total_api_changes": 162
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 10,
        "api_related_lines": 162,
        "non_api_lines": 8,
        "non_api_line_numbers": [
          229,
          230,
          231,
          232,
          233,
          234,
          235,
          248
        ]
      }
    },
    "api_calls_before": 104,
    "api_calls_after": 105,
    "diff_info": {
      "added_lines": 9,
      "removed_lines": 1,
      "total_diff_lines": 36
    }
  }
}