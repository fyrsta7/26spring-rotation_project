{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/swift/modified_file/ef5187f713f9101b1d96c7245b8a59a73f6b61d4",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/swift/modified_file/ef5187f713f9101b1d96c7245b8a59a73f6b61d4/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/swift/modified_file/ef5187f713f9101b1d96c7245b8a59a73f6b61d4/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/swift/modified_file/ef5187f713f9101b1d96c7245b8a59a73f6b61d4/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 1258,
          "old_api": "pop_back",
          "new_api": "assert",
          "old_text": "WorkList.pop_back()",
          "new_text": "assert(Lap <= MaxLaps && \"Possible bug tracking recursion!\")",
          "old_line_content": "          WorkList.pop_back();",
          "new_line_content": "      assert(Lap <= MaxLaps && \"Possible bug tracking recursion!\");",
          "content_same": false
        },
        {
          "line": 1282,
          "old_api": "getEligibleFunction",
          "new_api": "dyn_cast<ApplyInst>(&I)",
          "old_text": "getEligibleFunction(AI)",
          "new_text": "dyn_cast<ApplyInst>(&I)",
          "old_line_content": "      auto *Callee = getEligibleFunction(AI);",
          "new_line_content": "      ApplyInst *AI = dyn_cast<ApplyInst>(&I);",
          "content_same": false
        },
        {
          "line": 1288,
          "old_api": "pushChildren",
          "new_api": "llvm::dbgs()",
          "old_text": "domOrder.pushChildren(block)",
          "new_text": "llvm::dbgs()",
          "old_line_content": "    domOrder.pushChildren(block);",
          "new_line_content": "        DEBUG(llvm::dbgs() << \"    inline in cold block:\" <<  *AI);",
          "content_same": false
        },
        {
          "line": 1310,
          "old_api": "PM->getAnalysis<CallGraphAnalysis>()",
          "new_api": "append",
          "old_text": "PM->getAnalysis<CallGraphAnalysis>()",
          "new_text": "PassName.append(\" Performance Inliner\")",
          "old_line_content": "    CallGraphAnalysis *CGA = PM->getAnalysis<CallGraphAnalysis>();",
          "new_line_content": "    PassName.append(\" Performance Inliner\");",
          "content_same": false
        },
        {
          "line": 1314,
          "old_api": "getOptions",
          "new_api": "PM->getAnalysis<CallGraphAnalysis>()",
          "old_text": "getOptions()",
          "new_text": "PM->getAnalysis<CallGraphAnalysis>()",
          "old_line_content": "    if (getOptions().InlineThreshold == 0) {",
          "new_line_content": "    CallGraphAnalysis *CGA = PM->getAnalysis<CallGraphAnalysis>();",
          "content_same": false
        },
        {
          "line": 1315,
          "old_api": "llvm::dbgs()",
          "new_api": "PM->getAnalysis<DominanceAnalysis>()",
          "old_text": "llvm::dbgs()",
          "new_text": "PM->getAnalysis<DominanceAnalysis>()",
          "old_line_content": "      DEBUG(llvm::dbgs() << \"*** The Performance Inliner is disabled ***\\n\");",
          "new_line_content": "    DominanceAnalysis *DA = PM->getAnalysis<DominanceAnalysis>();",
          "content_same": false
        },
        {
          "line": 1319,
          "old_api": "getOptions",
          "new_api": "llvm::dbgs()",
          "old_text": "getOptions()",
          "new_text": "llvm::dbgs()",
          "old_line_content": "    SILPerformanceInliner Inliner(getOptions().InlineThreshold,",
          "new_line_content": "      DEBUG(llvm::dbgs() << \"*** The Performance Inliner is disabled ***\\n\");",
          "content_same": false
        },
        {
          "line": 1323,
          "old_api": "getBottomUpFunctionOrder",
          "new_api": "getOptions",
          "old_text": "CG.getBottomUpFunctionOrder()",
          "new_text": "getOptions()",
          "old_line_content": "    auto &BottomUpFunctions = CG.getBottomUpFunctionOrder();",
          "new_line_content": "    SILPerformanceInliner Inliner(getOptions().InlineThreshold,",
          "content_same": false
        },
        {
          "line": 1334,
          "old_api": "back",
          "new_api": "push_back",
          "old_text": "WorkList.back()",
          "new_text": "WorkList.push_back(*I)",
          "old_line_content": "      Inliner.inlineDevirtualizeAndSpecialize(WorkList.back(), this, CGA, DA,",
          "new_line_content": "      WorkList.push_back(*I);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 1280,
          "old_api": null,
          "new_api": "getNext",
          "old_text": null,
          "new_text": "domOrder.getNext()",
          "old_line_content": "        continue;",
          "new_line_content": "  while (SILBasicBlock *block = domOrder.getNext()) {",
          "content_same": false
        },
        {
          "line": 1286,
          "old_api": null,
          "new_api": "getEligibleFunction",
          "old_text": null,
          "new_text": "getEligibleFunction(AI)",
          "old_line_content": "      }",
          "new_line_content": "      auto *Callee = getEligibleFunction(AI);",
          "content_same": false
        },
        {
          "line": 1287,
          "old_api": null,
          "new_api": "isProfitableInColdBlock",
          "old_text": null,
          "new_text": "isProfitableInColdBlock(Callee)",
          "old_line_content": "    }",
          "new_line_content": "      if (Callee && isProfitableInColdBlock(Callee)) {",
          "content_same": false
        },
        {
          "line": 1289,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "AppliesToInline.push_back(AI)",
          "old_line_content": "  }",
          "new_line_content": "        AppliesToInline.push_back(AI);",
          "content_same": false
        },
        {
          "line": 1292,
          "old_api": null,
          "new_api": "pushChildren",
          "old_text": null,
          "new_text": "domOrder.pushChildren(block)",
          "old_line_content": "",
          "new_line_content": "    domOrder.pushChildren(block);",
          "content_same": false
        },
        {
          "line": 1316,
          "old_api": null,
          "new_api": "PM->getAnalysis<SILLoopAnalysis>()",
          "old_text": null,
          "new_text": "PM->getAnalysis<SILLoopAnalysis>()",
          "old_line_content": "      return;",
          "new_line_content": "    SILLoopAnalysis *LA = PM->getAnalysis<SILLoopAnalysis>();",
          "content_same": false
        },
        {
          "line": 1318,
          "old_api": null,
          "new_api": "getOptions",
          "old_text": null,
          "new_text": "getOptions()",
          "old_line_content": "",
          "new_line_content": "    if (getOptions().InlineThreshold == 0) {",
          "content_same": false
        },
        {
          "line": 1326,
          "old_api": null,
          "new_api": "getOrBuildCallGraph",
          "old_text": null,
          "new_text": "CGA->getOrBuildCallGraph()",
          "old_line_content": "    llvm::SmallVector<SILFunction *, 32> WorkList;",
          "new_line_content": "    auto &CG = CGA->getOrBuildCallGraph();",
          "content_same": false
        },
        {
          "line": 1327,
          "old_api": null,
          "new_api": "getBottomUpFunctionOrder",
          "old_text": null,
          "new_text": "CG.getBottomUpFunctionOrder()",
          "old_line_content": "    // FIXME: std::reverse_copy would be better, but it crashes.",
          "new_line_content": "    auto &BottomUpFunctions = CG.getBottomUpFunctionOrder();",
          "content_same": false
        },
        {
          "line": 1332,
          "old_api": null,
          "new_api": "rend",
          "old_text": null,
          "new_text": "BottomUpFunctions.rend()",
          "old_line_content": "    // Inline functions bottom up from the leafs.",
          "new_line_content": "    for (auto I = BottomUpFunctions.rbegin(), E = BottomUpFunctions.rend();",
          "content_same": false
        },
        {
          "line": 1337,
          "old_api": null,
          "new_api": "empty",
          "old_text": null,
          "new_text": "WorkList.empty()",
          "old_line_content": "    }",
          "new_line_content": "    while (!WorkList.empty()) {",
          "content_same": false
        },
        {
          "line": 1338,
          "old_api": null,
          "new_api": "back",
          "old_text": null,
          "new_text": "WorkList.back()",
          "old_line_content": "  }",
          "new_line_content": "      Inliner.inlineDevirtualizeAndSpecialize(WorkList.back(), this, CGA, DA,",
          "content_same": false
        },
        {
          "line": 1340,
          "old_api": null,
          "new_api": "pop_back",
          "old_text": null,
          "new_text": "WorkList.pop_back()",
          "old_line_content": "  StringRef getName() override { return PassName; }",
          "new_line_content": "      WorkList.pop_back();",
          "content_same": false
        },
        {
          "line": 1244,
          "old_api": null,
          "new_api": "pop_back",
          "old_text": null,
          "new_text": "WorkList.pop_back()",
          "old_line_content": "      } else {",
          "new_line_content": "          WorkList.pop_back();",
          "content_same": false
        },
        {
          "line": 1249,
          "old_api": null,
          "new_api": "pop_back",
          "old_text": null,
          "new_text": "WorkList.pop_back()",
          "old_line_content": "      if (Lap > MaxLaps)",
          "new_line_content": "        WorkList.pop_back();",
          "content_same": false
        },
        {
          "line": 1261,
          "old_api": null,
          "new_api": "back",
          "old_text": null,
          "new_text": "WorkList.back()",
          "old_line_content": "    }",
          "new_line_content": "        while (WorkList.back() != Initial)",
          "content_same": false
        },
        {
          "line": 1262,
          "old_api": null,
          "new_api": "pop_back",
          "old_text": null,
          "new_text": "WorkList.pop_back()",
          "old_line_content": "",
          "new_line_content": "          WorkList.pop_back();",
          "content_same": false
        },
        {
          "line": 1267,
          "old_api": null,
          "new_api": "back",
          "old_text": null,
          "new_text": "WorkList.back()",
          "old_line_content": "}",
          "new_line_content": "    assert(WorkList.back() == Initial &&",
          "content_same": false
        },
        {
          "line": 1269,
          "old_api": null,
          "new_api": "pop_back",
          "old_text": null,
          "new_text": "WorkList.pop_back()",
          "old_line_content": "// Find functions in cold blocks which are forced to be inlined.",
          "new_line_content": "    WorkList.pop_back();",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 1312,
          "old_api": "PM->getAnalysis<SILLoopAnalysis>()",
          "new_api": null,
          "old_text": "PM->getAnalysis<SILLoopAnalysis>()",
          "new_text": null,
          "old_line_content": "    SILLoopAnalysis *LA = PM->getAnalysis<SILLoopAnalysis>();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1283,
          "old_api": "isProfitableInColdBlock",
          "new_api": null,
          "old_text": "isProfitableInColdBlock(Callee)",
          "new_text": null,
          "old_line_content": "      if (Callee && isProfitableInColdBlock(Callee)) {",
          "new_line_content": "      if (!AI)",
          "content_same": false
        },
        {
          "line": 1284,
          "old_api": "llvm::dbgs()",
          "new_api": null,
          "old_text": "llvm::dbgs()",
          "new_text": null,
          "old_line_content": "        DEBUG(llvm::dbgs() << \"    inline in cold block:\" <<  *AI);",
          "new_line_content": "        continue;",
          "content_same": false
        },
        {
          "line": 1285,
          "old_api": "push_back",
          "new_api": null,
          "old_text": "AppliesToInline.push_back(AI)",
          "new_text": null,
          "old_line_content": "        AppliesToInline.push_back(AI);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1254,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(Lap <= MaxLaps && \"Possible bug tracking recursion!\")",
          "new_text": null,
          "old_line_content": "      assert(Lap <= MaxLaps && \"Possible bug tracking recursion!\");",
          "new_line_content": "      // It's possible to construct real code where this will hit, but",
          "content_same": false
        },
        {
          "line": 1257,
          "old_api": "back",
          "new_api": null,
          "old_text": "WorkList.back()",
          "new_text": null,
          "old_line_content": "        while (WorkList.back() != Initial)",
          "new_line_content": "      // builds, and not hang on bots or user machines.",
          "content_same": false
        },
        {
          "line": 1322,
          "old_api": "getOrBuildCallGraph",
          "new_api": null,
          "old_text": "CGA->getOrBuildCallGraph()",
          "new_text": null,
          "old_line_content": "    auto &CG = CGA->getOrBuildCallGraph();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1263,
          "old_api": "back",
          "new_api": null,
          "old_text": "WorkList.back()",
          "new_text": null,
          "old_line_content": "    assert(WorkList.back() == Initial &&",
          "new_line_content": "        break;",
          "content_same": false
        },
        {
          "line": 1328,
          "old_api": "rend",
          "new_api": null,
          "old_text": "BottomUpFunctions.rend()",
          "new_text": null,
          "old_line_content": "    for (auto I = BottomUpFunctions.rbegin(), E = BottomUpFunctions.rend();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1265,
          "old_api": "pop_back",
          "new_api": null,
          "old_text": "WorkList.pop_back()",
          "new_text": null,
          "old_line_content": "    WorkList.pop_back();",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1330,
          "old_api": "push_back",
          "new_api": null,
          "old_text": "WorkList.push_back(*I)",
          "new_text": null,
          "old_line_content": "      WorkList.push_back(*I);",
          "new_line_content": "    llvm::SmallVector<SILFunction *, 32> WorkList;",
          "content_same": false
        },
        {
          "line": 1333,
          "old_api": "empty",
          "new_api": null,
          "old_text": "WorkList.empty()",
          "new_text": null,
          "old_line_content": "    while (!WorkList.empty()) {",
          "new_line_content": "         I != E; ++I)",
          "content_same": false
        },
        {
          "line": 1336,
          "old_api": "pop_back",
          "new_api": null,
          "old_text": "WorkList.pop_back()",
          "new_text": null,
          "old_line_content": "      WorkList.pop_back();",
          "new_line_content": "    // Inline functions bottom up from the leafs.",
          "content_same": false
        },
        {
          "line": 1306,
          "old_api": "append",
          "new_api": null,
          "old_text": "PassName.append(\" Performance Inliner\")",
          "new_text": null,
          "old_line_content": "    PassName.append(\" Performance Inliner\");",
          "new_line_content": "  std::string PassName;",
          "content_same": false
        },
        {
          "line": 1276,
          "old_api": "getNext",
          "new_api": null,
          "old_text": "domOrder.getNext()",
          "new_text": null,
          "old_line_content": "  while (SILBasicBlock *block = domOrder.getNext()) {",
          "new_line_content": "                                            AppliesToInline,",
          "content_same": false
        },
        {
          "line": 1245,
          "old_api": "pop_back",
          "new_api": null,
          "old_text": "WorkList.pop_back()",
          "new_text": null,
          "old_line_content": "        WorkList.pop_back();",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 1278,
          "old_api": "dyn_cast<ApplyInst>(&I)",
          "new_api": null,
          "old_text": "dyn_cast<ApplyInst>(&I)",
          "new_text": null,
          "old_line_content": "      ApplyInst *AI = dyn_cast<ApplyInst>(&I);",
          "new_line_content": "                                            DominanceInfo *DT) {",
          "content_same": false
        },
        {
          "line": 1311,
          "old_api": "PM->getAnalysis<DominanceAnalysis>()",
          "new_api": null,
          "old_text": "PM->getAnalysis<DominanceAnalysis>()",
          "new_text": null,
          "old_line_content": "    DominanceAnalysis *DA = PM->getAnalysis<DominanceAnalysis>();",
          "new_line_content": "  }",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 9,
      "total_additions": 19,
      "total_deletions": 18,
      "total_api_changes": 46
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 4,
        "api_related_lines": 46,
        "non_api_lines": 3,
        "non_api_line_numbers": [
          1241,
          1242,
          1243
        ]
      }
    },
    "api_calls_before": 441,
    "api_calls_after": 442,
    "diff_info": {
      "added_lines": 4,
      "removed_lines": 0,
      "total_diff_lines": 16
    }
  }
}