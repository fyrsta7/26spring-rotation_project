diff --git a/lib/Frontend/DiagnosticVerifier.cpp b/lib/Frontend/DiagnosticVerifier.cpp
index e95f0eae5e9..e1274e586ba 100644
--- a/lib/Frontend/DiagnosticVerifier.cpp
+++ b/lib/Frontend/DiagnosticVerifier.cpp
@@ -47,8 +47,19 @@ CapturedFixItInfo::getLineColumnRange(const SourceManager &SM,
 
   std::tie(LineColRange.StartLine, LineColRange.StartCol) =
       SM.getPresumedLineAndColumnForLoc(SrcRange.getStart(), BufferID);
-  std::tie(LineColRange.EndLine, LineColRange.EndCol) =
-      SM.getPresumedLineAndColumnForLoc(SrcRange.getEnd(), BufferID);
+
+  // We don't have to compute much if the end location is on the same line.
+  if (SrcRange.getByteLength() == 0) {
+    LineColRange.EndLine = LineColRange.StartLine;
+    LineColRange.EndCol = LineColRange.StartCol;
+  } else if (SM.extractText(SrcRange, BufferID).find_first_of("\n\r") ==
+             StringRef::npos) {
+    LineColRange.EndLine = LineColRange.StartLine;
+    LineColRange.EndCol = LineColRange.StartCol + SrcRange.getByteLength();
+  } else {
+    std::tie(LineColRange.EndLine, LineColRange.EndCol) =
+        SM.getPresumedLineAndColumnForLoc(SrcRange.getEnd(), BufferID);
+  }
 
   return LineColRange;
 }
