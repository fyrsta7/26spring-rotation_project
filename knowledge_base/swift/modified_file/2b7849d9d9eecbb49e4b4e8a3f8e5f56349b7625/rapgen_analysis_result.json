{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/swift/modified_file/2b7849d9d9eecbb49e4b4e8a3f8e5f56349b7625",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/swift/modified_file/2b7849d9d9eecbb49e4b4e8a3f8e5f56349b7625/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/swift/modified_file/2b7849d9d9eecbb49e4b4e8a3f8e5f56349b7625/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/swift/modified_file/2b7849d9d9eecbb49e4b4e8a3f8e5f56349b7625/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 70,
          "old_api": "getCanonicalDecl",
          "new_api": "const_cast<clang::Decl*>(decl)",
          "old_text": "decl->getCanonicalDecl()",
          "new_text": "const_cast<clang::Decl*>(decl)",
          "old_line_content": "  if (!GlobalClangDecls.insert(decl->getCanonicalDecl()).second)",
          "new_line_content": "                          clang::DeclGroupRef(const_cast<clang::Decl*>(decl)));",
          "content_same": false
        },
        {
          "line": 84,
          "old_api": "isFileContext",
          "new_api": "isFunctionOrMethod",
          "old_text": "DC->isFileContext()",
          "new_text": "DC->isFunctionOrMethod()",
          "old_line_content": "      if (DC->isFileContext())",
          "new_line_content": "      if (DC->isFunctionOrMethod())",
          "content_same": false
        },
        {
          "line": 86,
          "old_api": "cast<const clang::Decl>(DC)",
          "new_api": "isFileContext",
          "old_text": "cast<const clang::Decl>(DC)",
          "new_text": "DC->isFileContext()",
          "old_line_content": "      D = cast<const clang::Decl>(DC);",
          "new_line_content": "      if (DC->isFileContext())",
          "content_same": false
        },
        {
          "line": 88,
          "old_api": "getCanonicalDecl",
          "new_api": "cast<const clang::Decl>(DC)",
          "old_text": "D->getCanonicalDecl()",
          "new_text": "cast<const clang::Decl>(DC)",
          "old_line_content": "    if (!GlobalClangDecls.insert(D->getCanonicalDecl()).second)",
          "new_line_content": "      D = cast<const clang::Decl>(DC);",
          "content_same": false
        },
        {
          "line": 90,
          "old_api": "push_back",
          "new_api": "getCanonicalDecl",
          "old_text": "stack.push_back(D)",
          "new_text": "D->getCanonicalDecl()",
          "old_line_content": "    stack.push_back(D);",
          "new_line_content": "    if (!GlobalClangDecls.insert(D->getCanonicalDecl()).second)",
          "content_same": false
        },
        {
          "line": 95,
          "old_api": "getDeclWithExecutableCode",
          "new_api": "empty",
          "old_text": "getDeclWithExecutableCode(next)",
          "new_text": "stack.empty()",
          "old_line_content": "    if (clang::Decl *executableDecl = getDeclWithExecutableCode(next)) {",
          "new_line_content": "  while (!stack.empty()) {",
          "content_same": false
        },
        {
          "line": 96,
          "old_api": "TraverseDecl",
          "new_api": "pop_back_val",
          "old_text": "refFinder.TraverseDecl(executableDecl)",
          "new_text": "stack.pop_back_val()",
          "old_line_content": "        refFinder.TraverseDecl(executableDecl);",
          "new_line_content": "    auto *next = const_cast<clang::Decl *>(stack.pop_back_val());",
          "content_same": false
        },
        {
          "line": 110,
          "old_api": "GetAddrOfGlobal",
          "new_api": "emitClangDecl",
          "old_text": "ClangCodeGen->GetAddrOfGlobal(global, (bool) forDefinition)",
          "new_text": "emitClangDecl(decl)",
          "old_line_content": "  return ClangCodeGen->GetAddrOfGlobal(global, (bool) forDefinition);",
          "new_line_content": "    emitClangDecl(decl);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 97,
          "old_api": null,
          "new_api": "getDeclWithExecutableCode",
          "old_text": null,
          "new_text": "getDeclWithExecutableCode(next)",
          "old_line_content": "        next = executableDecl;",
          "new_line_content": "    if (clang::Decl *executableDecl = getDeclWithExecutableCode(next)) {",
          "content_same": false
        },
        {
          "line": 98,
          "old_api": null,
          "new_api": "TraverseDecl",
          "old_text": null,
          "new_text": "refFinder.TraverseDecl(executableDecl)",
          "old_line_content": "    }",
          "new_line_content": "        refFinder.TraverseDecl(executableDecl);",
          "content_same": false
        },
        {
          "line": 68,
          "old_api": null,
          "new_api": "const_cast<clang::Decl *>(decl)",
          "old_text": null,
          "new_text": "const_cast<clang::Decl *>(decl)",
          "old_line_content": "  }",
          "new_line_content": "  if (getDeclWithExecutableCode(const_cast<clang::Decl *>(decl)) == nullptr) {",
          "content_same": false
        },
        {
          "line": 69,
          "old_api": null,
          "new_api": "HandleTopLevelDecl",
          "old_text": null,
          "new_text": "ClangCodeGen->HandleTopLevelDecl(\n                          clang::DeclGroupRef(const_cast<clang::Decl*>(decl)))",
          "old_line_content": "",
          "new_line_content": "    ClangCodeGen->HandleTopLevelDecl(",
          "content_same": false
        },
        {
          "line": 101,
          "old_api": null,
          "new_api": "clang::DeclGroupRef(next)",
          "old_text": null,
          "new_text": "clang::DeclGroupRef(next)",
          "old_line_content": "}",
          "new_line_content": "    ClangCodeGen->HandleTopLevelDecl(clang::DeclGroupRef(next));",
          "content_same": false
        },
        {
          "line": 75,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "stack.push_back(decl)",
          "old_line_content": "  ClangDeclRefFinder refFinder([&](const clang::DeclRefExpr *DRE) {",
          "new_line_content": "  stack.push_back(decl);",
          "content_same": false
        },
        {
          "line": 109,
          "old_api": null,
          "new_api": "getDecl",
          "old_text": null,
          "new_text": "global.getDecl()",
          "old_line_content": "",
          "new_line_content": "  if (auto decl = global.getDecl())",
          "content_same": false
        },
        {
          "line": 78,
          "old_api": null,
          "new_api": "getDecl",
          "old_text": null,
          "new_text": "DRE->getDecl()",
          "old_line_content": "    // If it's a member of a file-level decl, like a C++ static member variable,",
          "new_line_content": "    const clang::Decl *D = DRE->getDecl();",
          "content_same": false
        },
        {
          "line": 112,
          "old_api": null,
          "new_api": "GetAddrOfGlobal",
          "old_text": null,
          "new_text": "ClangCodeGen->GetAddrOfGlobal(global, (bool) forDefinition)",
          "old_line_content": "",
          "new_line_content": "  return ClangCodeGen->GetAddrOfGlobal(global, (bool) forDefinition);",
          "content_same": false
        },
        {
          "line": 83,
          "old_api": null,
          "new_api": "getParent",
          "old_text": null,
          "new_text": "DC->getParent()",
          "old_line_content": "        return;",
          "new_line_content": "    for (auto *DC = D->getDeclContext();; DC = DC->getParent()) {",
          "content_same": false
        },
        {
          "line": 116,
          "old_api": null,
          "new_api": "HandleTranslationUnit",
          "old_text": null,
          "new_text": "ClangCodeGen->HandleTranslationUnit(\n      *const_cast<clang::ASTContext *>(ClangASTContext))",
          "old_line_content": "}",
          "new_line_content": "  ClangCodeGen->HandleTranslationUnit(",
          "content_same": false
        },
        {
          "line": 117,
          "old_api": null,
          "new_api": "const_cast<clang::ASTContext *>(ClangASTContext)",
          "old_text": null,
          "new_text": "const_cast<clang::ASTContext *>(ClangASTContext)",
          "old_line_content": "",
          "new_line_content": "      *const_cast<clang::ASTContext *>(ClangASTContext));",
          "content_same": false
        },
        {
          "line": 92,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "stack.push_back(D)",
          "old_line_content": "",
          "new_line_content": "    stack.push_back(D);",
          "content_same": false
        },
        {
          "line": 63,
          "old_api": null,
          "new_api": "getCanonicalDecl",
          "old_text": null,
          "new_text": "decl->getCanonicalDecl()",
          "old_line_content": "  // can't reference any other declarations that we would need to emit.",
          "new_line_content": "  if (!GlobalClangDecls.insert(decl->getCanonicalDecl()).second)",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 64,
          "old_api": "const_cast<clang::Decl *>(decl)",
          "new_api": null,
          "old_text": "const_cast<clang::Decl *>(decl)",
          "new_text": null,
          "old_line_content": "  if (getDeclWithExecutableCode(const_cast<clang::Decl *>(decl)) == nullptr) {",
          "new_line_content": "    return;",
          "content_same": false
        },
        {
          "line": 65,
          "old_api": "HandleTopLevelDecl",
          "new_api": null,
          "old_text": "ClangCodeGen->HandleTopLevelDecl(\n                          clang::DeclGroupRef(const_cast<clang::Decl*>(decl)))",
          "new_text": null,
          "old_line_content": "    ClangCodeGen->HandleTopLevelDecl(",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 66,
          "old_api": "const_cast<clang::Decl*>(decl)",
          "new_api": null,
          "old_text": "const_cast<clang::Decl*>(decl)",
          "new_text": null,
          "old_line_content": "                          clang::DeclGroupRef(const_cast<clang::Decl*>(decl)));",
          "new_line_content": "  // Fast path for the case where `decl` doesn't contain executable code, so it",
          "content_same": false
        },
        {
          "line": 99,
          "old_api": "clang::DeclGroupRef(next)",
          "new_api": null,
          "old_text": "clang::DeclGroupRef(next)",
          "new_text": null,
          "old_line_content": "    ClangCodeGen->HandleTopLevelDecl(clang::DeclGroupRef(next));",
          "new_line_content": "        next = executableDecl;",
          "content_same": false
        },
        {
          "line": 73,
          "old_api": "push_back",
          "new_api": null,
          "old_text": "stack.push_back(decl)",
          "new_text": null,
          "old_line_content": "  stack.push_back(decl);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 107,
          "old_api": "getDecl",
          "new_api": null,
          "old_text": "global.getDecl()",
          "new_text": null,
          "old_line_content": "  if (auto decl = global.getDecl())",
          "new_line_content": "                                      ForDefinition_t forDefinition) {",
          "content_same": false
        },
        {
          "line": 76,
          "old_api": "getDecl",
          "new_api": null,
          "old_text": "DRE->getDecl()",
          "new_text": null,
          "old_line_content": "    const clang::Decl *D = DRE->getDecl();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 108,
          "old_api": "emitClangDecl",
          "new_api": null,
          "old_text": "emitClangDecl(decl)",
          "new_text": null,
          "old_line_content": "    emitClangDecl(decl);",
          "new_line_content": "  // Register the decl with the clang code generator.",
          "content_same": false
        },
        {
          "line": 81,
          "old_api": "getParent",
          "new_api": null,
          "old_text": "DC->getParent()",
          "new_text": null,
          "old_line_content": "    for (auto *DC = D->getDeclContext();; DC = DC->getParent()) {",
          "new_line_content": "    // we want to add the entire file-level declaration because Clang doesn't",
          "content_same": false
        },
        {
          "line": 82,
          "old_api": "isFunctionOrMethod",
          "new_api": null,
          "old_text": "DC->isFunctionOrMethod()",
          "new_text": null,
          "old_line_content": "      if (DC->isFunctionOrMethod())",
          "new_line_content": "    // expect to see members directly here.",
          "content_same": false
        },
        {
          "line": 114,
          "old_api": "HandleTranslationUnit",
          "new_api": null,
          "old_text": "ClangCodeGen->HandleTranslationUnit(\n      *const_cast<clang::ASTContext *>(ClangASTContext))",
          "new_text": null,
          "old_line_content": "  ClangCodeGen->HandleTranslationUnit(",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 115,
          "old_api": "const_cast<clang::ASTContext *>(ClangASTContext)",
          "new_api": null,
          "old_text": "const_cast<clang::ASTContext *>(ClangASTContext)",
          "new_text": null,
          "old_line_content": "      *const_cast<clang::ASTContext *>(ClangASTContext));",
          "new_line_content": "void IRGenModule::finalizeClangCodeGen() {",
          "content_same": false
        },
        {
          "line": 93,
          "old_api": "empty",
          "new_api": null,
          "old_text": "stack.empty()",
          "new_text": null,
          "old_line_content": "  while (!stack.empty()) {",
          "new_line_content": "  });",
          "content_same": false
        },
        {
          "line": 94,
          "old_api": "pop_back_val",
          "new_api": null,
          "old_text": "stack.pop_back_val()",
          "new_text": null,
          "old_line_content": "    auto *next = const_cast<clang::Decl *>(stack.pop_back_val());",
          "new_line_content": "",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 8,
      "total_additions": 14,
      "total_deletions": 14,
      "total_api_changes": 36
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 6,
        "api_related_lines": 36,
        "non_api_lines": 2,
        "non_api_line_numbers": [
          67,
          71
        ]
      }
    },
    "api_calls_before": 36,
    "api_calls_after": 36,
    "diff_info": {
      "added_lines": 5,
      "removed_lines": 3,
      "total_diff_lines": 44
    }
  }
}