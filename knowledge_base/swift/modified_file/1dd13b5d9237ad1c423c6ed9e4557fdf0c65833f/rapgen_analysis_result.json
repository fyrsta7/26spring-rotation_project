{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/swift/modified_file/1dd13b5d9237ad1c423c6ed9e4557fdf0c65833f",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/swift/modified_file/1dd13b5d9237ad1c423c6ed9e4557fdf0c65833f/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/swift/modified_file/1dd13b5d9237ad1c423c6ed9e4557fdf0c65833f/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/swift/modified_file/1dd13b5d9237ad1c423c6ed9e4557fdf0c65833f/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 1014,
          "old_api": "empty",
          "new_api": "getReversePostOrder",
          "old_text": "WorkList.empty()",
          "new_text": "PO->getReversePostOrder()",
          "old_line_content": "  while (!WorkList.empty()) {",
          "new_line_content": "  for (SILBasicBlock *B : PO->getReversePostOrder()) {",
          "content_same": false
        },
        {
          "line": 1015,
          "old_api": "pop_back_val",
          "new_api": "push_back",
          "old_text": "WorkList.pop_back_val()",
          "new_text": "WorkList.push_back(B)",
          "old_line_content": "    SILBasicBlock *BB = WorkList.pop_back_val();",
          "new_line_content": "    WorkList.push_back(B);",
          "content_same": false
        },
        {
          "line": 1016,
          "old_api": "processBasicBlockWithGenKillSet",
          "new_api": "insert",
          "old_text": "processBasicBlockWithGenKillSet(BB)",
          "new_text": "HandledBBs.insert(B)",
          "old_line_content": "    if (processBasicBlockWithGenKillSet(BB)) {",
          "new_line_content": "    HandledBBs.insert(B);",
          "content_same": false
        },
        {
          "line": 1018,
          "old_api": "push_back",
          "new_api": "empty",
          "old_text": "WorkList.push_back(X)",
          "new_text": "WorkList.empty()",
          "old_line_content": "        WorkList.push_back(X);",
          "new_line_content": "  while (!WorkList.empty()) {",
          "content_same": false
        },
        {
          "line": 1025,
          "old_api": "processBasicBlockForDSE",
          "new_api": "end",
          "old_text": "processBasicBlockForDSE(B)",
          "new_text": "HandledBBs.end()",
          "old_line_content": "    processBasicBlockForDSE(B);",
          "new_line_content": "        if (HandledBBs.find(X) != HandledBBs.end())",
          "content_same": false
        },
        {
          "line": 1034,
          "old_api": "getNextNode",
          "new_api": "getPostOrder",
          "old_text": "cast<SILInstruction>(I.first)->getNextNode()",
          "new_text": "PO->getPostOrder()",
          "old_line_content": "      SILInstruction *IT = cast<SILInstruction>(I.first)->getNextNode();",
          "new_line_content": "  for (SILBasicBlock *B : PO->getPostOrder()) {",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 1027,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "WorkList.push_back(X)",
          "old_line_content": "",
          "new_line_content": "        WorkList.push_back(X);",
          "content_same": false
        },
        {
          "line": 1035,
          "old_api": null,
          "new_api": "processBasicBlockForDSE",
          "old_text": null,
          "new_text": "processBasicBlockForDSE(B)",
          "old_line_content": "      SILBuilderWithScope Builder(IT);",
          "new_line_content": "    processBasicBlockForDSE(B);",
          "content_same": false
        },
        {
          "line": 1042,
          "old_api": null,
          "new_api": "getBlockState",
          "old_text": null,
          "new_text": "getBlockState(&BB)",
          "old_line_content": "      // This way, we get rid of pass dependence on DCE.",
          "new_line_content": "    for (auto &I : getBlockState(&BB)->LiveStores) {",
          "content_same": false
        },
        {
          "line": 1044,
          "old_api": null,
          "new_api": "getNextNode",
          "old_text": null,
          "new_text": "cast<SILInstruction>(I.first)->getNextNode()",
          "old_line_content": "    }",
          "new_line_content": "      SILInstruction *IT = cast<SILInstruction>(I.first)->getNextNode();",
          "content_same": false
        },
        {
          "line": 1046,
          "old_api": null,
          "new_api": "getLoc",
          "old_text": null,
          "new_text": "I.first.getLoc().getValue()",
          "old_line_content": "  return Changed;",
          "new_line_content": "      Builder.createStore(I.first.getLoc().getValue(), I.second, I.first);",
          "content_same": false
        },
        {
          "line": 1049,
          "old_api": null,
          "new_api": "getBlockState",
          "old_text": null,
          "new_text": "getBlockState(&BB)",
          "old_line_content": "//===----------------------------------------------------------------------===//",
          "new_line_content": "    for (auto &I : getBlockState(&BB)->DeadStores) {",
          "content_same": false
        },
        {
          "line": 1051,
          "old_api": null,
          "new_api": "llvm::dbgs()",
          "old_text": null,
          "new_text": "llvm::dbgs()",
          "old_line_content": "//===----------------------------------------------------------------------===//",
          "new_line_content": "      DEBUG(llvm::dbgs() << \"*** Removing: \" << *I << \" ***\\n\");",
          "content_same": false
        },
        {
          "line": 1053,
          "old_api": null,
          "new_api": "recursivelyDeleteTriviallyDeadInstructions",
          "old_text": null,
          "new_text": "recursivelyDeleteTriviallyDeadInstructions(I, true)",
          "old_line_content": "namespace {",
          "new_line_content": "      recursivelyDeleteTriviallyDeadInstructions(I, true);",
          "content_same": false
        },
        {
          "line": 1071,
          "old_api": null,
          "new_api": "PM->getAnalysis<AliasAnalysis>()",
          "old_text": null,
          "new_text": "PM->getAnalysis<AliasAnalysis>()",
          "old_line_content": "  }",
          "new_line_content": "    auto *AA = PM->getAnalysis<AliasAnalysis>();",
          "content_same": false
        },
        {
          "line": 1072,
          "old_api": null,
          "new_api": "PM->getAnalysis<EscapeAnalysis>()",
          "old_text": null,
          "new_text": "PM->getAnalysis<EscapeAnalysis>()",
          "old_line_content": "};",
          "new_line_content": "    auto *EA = PM->getAnalysis<EscapeAnalysis>();",
          "content_same": false
        },
        {
          "line": 1073,
          "old_api": null,
          "new_api": "PM->getAnalysis<TypeExpansionAnalysis>()",
          "old_text": null,
          "new_text": "PM->getAnalysis<TypeExpansionAnalysis>()",
          "old_line_content": "",
          "new_line_content": "    auto *TE = PM->getAnalysis<TypeExpansionAnalysis>();",
          "content_same": false
        },
        {
          "line": 1074,
          "old_api": null,
          "new_api": "getFunction",
          "old_text": null,
          "new_text": "getFunction()",
          "old_line_content": "} // end anonymous namespace",
          "new_line_content": "    SILFunction *F = getFunction();",
          "content_same": false
        },
        {
          "line": 1075,
          "old_api": null,
          "new_api": "getName",
          "old_text": null,
          "new_text": "F->getName()",
          "old_line_content": "",
          "new_line_content": "    DEBUG(llvm::dbgs() << \"*** DSE on function: \" << F->getName() << \" ***\\n\");",
          "content_same": false
        },
        {
          "line": 1077,
          "old_api": null,
          "new_api": "getModule",
          "old_text": null,
          "new_text": "F->getModule()",
          "old_line_content": "  return new DeadStoreElimination();",
          "new_line_content": "    DSEContext DSE(F, &F->getModule(), PM, AA, EA, TE);",
          "content_same": false
        },
        {
          "line": 1078,
          "old_api": null,
          "new_api": "run",
          "old_text": null,
          "new_text": "DSE.run()",
          "old_line_content": "}",
          "new_line_content": "    if (DSE.run()) {",
          "content_same": false
        },
        {
          "line": 1079,
          "old_api": null,
          "new_api": "invalidateAnalysis",
          "old_text": null,
          "new_text": "invalidateAnalysis(SILAnalysis::InvalidationKind::Instructions)",
          "old_line_content": "",
          "new_line_content": "      invalidateAnalysis(SILAnalysis::InvalidationKind::Instructions);",
          "content_same": false
        },
        {
          "line": 1019,
          "old_api": null,
          "new_api": "pop_back_val",
          "old_text": null,
          "new_text": "WorkList.pop_back_val()",
          "old_line_content": "    }",
          "new_line_content": "    SILBasicBlock *BB = WorkList.pop_back_val();",
          "content_same": false
        },
        {
          "line": 1020,
          "old_api": null,
          "new_api": "erase",
          "old_text": null,
          "new_text": "HandledBBs.erase(BB)",
          "old_line_content": "  }",
          "new_line_content": "    HandledBBs.erase(BB);",
          "content_same": false
        },
        {
          "line": 1021,
          "old_api": null,
          "new_api": "processBasicBlockWithGenKillSet",
          "old_text": null,
          "new_text": "processBasicBlockWithGenKillSet(BB)",
          "old_line_content": "",
          "new_line_content": "    if (processBasicBlockWithGenKillSet(BB)) {",
          "content_same": false
        },
        {
          "line": 1022,
          "old_api": null,
          "new_api": "getPreds",
          "old_text": null,
          "new_text": "BB->getPreds()",
          "old_line_content": "  // The data flow has stabilized, run one last iteration over all the basic",
          "new_line_content": "      for (auto X : BB->getPreds()) {",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 1024,
          "old_api": "getPostOrder",
          "new_api": null,
          "old_text": "PO->getPostOrder()",
          "new_text": null,
          "old_line_content": "  for (SILBasicBlock *B : PO->getPostOrder()) {",
          "new_line_content": "        // in the worklist.",
          "content_same": false
        },
        {
          "line": 1061,
          "old_api": "PM->getAnalysis<AliasAnalysis>()",
          "new_api": null,
          "old_text": "PM->getAnalysis<AliasAnalysis>()",
          "new_text": null,
          "old_line_content": "    auto *AA = PM->getAnalysis<AliasAnalysis>();",
          "new_line_content": "//===----------------------------------------------------------------------===//",
          "content_same": false
        },
        {
          "line": 1062,
          "old_api": "PM->getAnalysis<EscapeAnalysis>()",
          "new_api": null,
          "old_text": "PM->getAnalysis<EscapeAnalysis>()",
          "new_text": null,
          "old_line_content": "    auto *EA = PM->getAnalysis<EscapeAnalysis>();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1063,
          "old_api": "PM->getAnalysis<TypeExpansionAnalysis>()",
          "new_api": null,
          "old_text": "PM->getAnalysis<TypeExpansionAnalysis>()",
          "new_text": null,
          "old_line_content": "    auto *TE = PM->getAnalysis<TypeExpansionAnalysis>();",
          "new_line_content": "namespace {",
          "content_same": false
        },
        {
          "line": 1032,
          "old_api": "getBlockState",
          "new_api": null,
          "old_text": "getBlockState(&BB)",
          "new_text": null,
          "old_line_content": "    for (auto &I : getBlockState(&BB)->LiveStores) {",
          "new_line_content": "  // The data flow has stabilized, run one last iteration over all the basic",
          "content_same": false
        },
        {
          "line": 1064,
          "old_api": "getFunction",
          "new_api": null,
          "old_text": "getFunction()",
          "new_text": null,
          "old_line_content": "    SILFunction *F = getFunction();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1065,
          "old_api": "getName",
          "new_api": null,
          "old_text": "F->getName()",
          "new_text": null,
          "old_line_content": "    DEBUG(llvm::dbgs() << \"*** DSE on function: \" << F->getName() << \" ***\\n\");",
          "new_line_content": "class DeadStoreElimination : public SILFunctionTransform {",
          "content_same": false
        },
        {
          "line": 1067,
          "old_api": "getModule",
          "new_api": null,
          "old_text": "F->getModule()",
          "new_text": null,
          "old_line_content": "    DSEContext DSE(F, &F->getModule(), PM, AA, EA, TE);",
          "new_line_content": "  StringRef getName() override { return \"SIL Dead Store Elimination\"; }",
          "content_same": false
        },
        {
          "line": 1036,
          "old_api": "getLoc",
          "new_api": null,
          "old_text": "I.first.getLoc().getValue()",
          "new_text": null,
          "old_line_content": "      Builder.createStore(I.first.getLoc().getValue(), I.second, I.first);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 1068,
          "old_api": "run",
          "new_api": null,
          "old_text": "DSE.run()",
          "new_text": null,
          "old_line_content": "    if (DSE.run()) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1069,
          "old_api": "invalidateAnalysis",
          "new_api": null,
          "old_text": "invalidateAnalysis(SILAnalysis::InvalidationKind::Instructions)",
          "new_text": null,
          "old_line_content": "      invalidateAnalysis(SILAnalysis::InvalidationKind::Instructions);",
          "new_line_content": "  /// The entry point to the transformation.",
          "content_same": false
        },
        {
          "line": 1039,
          "old_api": "getBlockState",
          "new_api": null,
          "old_text": "getBlockState(&BB)",
          "new_text": null,
          "old_line_content": "    for (auto &I : getBlockState(&BB)->DeadStores) {",
          "new_line_content": "  bool Changed = false;",
          "content_same": false
        },
        {
          "line": 1041,
          "old_api": "llvm::dbgs()",
          "new_api": null,
          "old_text": "llvm::dbgs()",
          "new_text": null,
          "old_line_content": "      DEBUG(llvm::dbgs() << \"*** Removing: \" << *I << \" ***\\n\");",
          "new_line_content": "    // Create the stores that are alive due to partial dead stores.",
          "content_same": false
        },
        {
          "line": 1043,
          "old_api": "recursivelyDeleteTriviallyDeadInstructions",
          "new_api": null,
          "old_text": "recursivelyDeleteTriviallyDeadInstructions(I, true)",
          "new_text": null,
          "old_line_content": "      recursivelyDeleteTriviallyDeadInstructions(I, true);",
          "new_line_content": "      Changed = true;",
          "content_same": false
        },
        {
          "line": 1011,
          "old_api": "getPostOrder",
          "new_api": null,
          "old_text": "PO->getPostOrder()",
          "new_text": null,
          "old_line_content": "  for (SILBasicBlock *B : PO->getPostOrder()) {",
          "new_line_content": "  llvm::DenseSet<SILBasicBlock *> HandledBBs;",
          "content_same": false
        },
        {
          "line": 1012,
          "old_api": "push_back",
          "new_api": null,
          "old_text": "WorkList.push_back(B)",
          "new_text": null,
          "old_line_content": "    WorkList.push_back(B);",
          "new_line_content": "  // Push into reverse post order so that we can pop from the back and get",
          "content_same": false
        },
        {
          "line": 1017,
          "old_api": "getPreds",
          "new_api": null,
          "old_text": "BB->getPreds()",
          "new_text": null,
          "old_line_content": "      for (auto X : BB->getPreds())",
          "new_line_content": "  }",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 6,
      "total_additions": 20,
      "total_deletions": 17,
      "total_api_changes": 43
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 13,
        "api_related_lines": 43,
        "non_api_lines": 4,
        "non_api_line_numbers": [
          1026,
          1028,
          1013,
          1023
        ]
      }
    },
    "api_calls_before": 228,
    "api_calls_after": 232,
    "diff_info": {
      "added_lines": 12,
      "removed_lines": 2,
      "total_diff_lines": 32
    }
  }
}