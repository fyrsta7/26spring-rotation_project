{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/swift/modified_file/1b79b742db8bba4e1b6c0687f3dbe25735a060dc",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/swift/modified_file/1b79b742db8bba4e1b6c0687f3dbe25735a060dc/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/swift/modified_file/1b79b742db8bba4e1b6c0687f3dbe25735a060dc/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/swift/modified_file/1b79b742db8bba4e1b6c0687f3dbe25735a060dc/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 409,
          "old_api": "empty",
          "new_api": "isTransparent",
          "old_text": "CalleeFunction->empty()",
          "new_text": "CalleeFunction->isTransparent()",
          "old_line_content": "  if (CalleeFunction->empty()",
          "new_line_content": "  if (CalleeFunction->isTransparent() == IsNotTransparent)",
          "content_same": false
        },
        {
          "line": 420,
          "old_api": "hasValidLinkageForFragileRef",
          "new_api": "empty",
          "old_text": "CalleeFunction->hasValidLinkageForFragileRef()",
          "new_text": "CalleeFunction->empty()",
          "old_line_content": "    if (!CalleeFunction->hasValidLinkageForFragileRef()) {",
          "new_line_content": "  if (CalleeFunction->empty())",
          "content_same": false
        },
        {
          "line": 423,
          "old_api": "llvm_unreachable",
          "new_api": "isSerialized",
          "old_text": "llvm_unreachable(\"Should never be inlining a resilient function into \"\n                       \"a fragile function\")",
          "new_text": "F->isSerialized()",
          "old_line_content": "      llvm_unreachable(\"Should never be inlining a resilient function into \"",
          "new_line_content": "  if (F->isSerialized() &&",
          "content_same": false
        },
        {
          "line": 440,
          "old_api": "replaceDeadApply",
          "new_api": "tryDevirtualizeApply",
          "old_text": "replaceDeadApply(InnerAI, NewInstPair.first)",
          "new_text": "tryDevirtualizeApply(InnerAI, CHA)",
          "old_line_content": "  replaceDeadApply(InnerAI, NewInstPair.first);",
          "new_line_content": "  auto NewInstPair = tryDevirtualizeApply(InnerAI, CHA);",
          "content_same": false
        },
        {
          "line": 442,
          "old_api": "getInstruction",
          "new_api": "std::make_tuple(InnerAI, I)",
          "old_text": "NewInstPair.second.getInstruction()",
          "new_text": "std::make_tuple(InnerAI, I)",
          "old_line_content": "  auto newApplyAI = NewInstPair.second.getInstruction();",
          "new_line_content": "    return std::make_tuple(InnerAI, I);",
          "content_same": false
        },
        {
          "line": 445,
          "old_api": "FullApplySite::isa(newApplyAI)",
          "new_api": "replaceDeadApply",
          "old_text": "FullApplySite::isa(newApplyAI)",
          "new_text": "replaceDeadApply(InnerAI, NewInstPair.first)",
          "old_line_content": "  return std::make_tuple(FullApplySite::isa(newApplyAI),",
          "new_line_content": "  replaceDeadApply(InnerAI, NewInstPair.first);",
          "content_same": false
        },
        {
          "line": 480,
          "old_api": "getStartSourceLoc",
          "new_api": "contains",
          "old_text": "L.getStartSourceLoc()",
          "new_text": "CurrentInliningSet.contains(F)",
          "old_line_content": "    diagnose(F->getModule().getASTContext(), L.getStartSourceLoc(),",
          "new_line_content": "  if (CurrentInliningSet.contains(F)) {",
          "content_same": false
        },
        {
          "line": 492,
          "old_api": "end",
          "new_api": "add",
          "old_text": "F->end()",
          "new_text": "SetFactory.add(CurrentInliningSet, F)",
          "old_line_content": "  for (auto BI = F->begin(), BE = F->end(); BI != BE; ++BI) {",
          "new_line_content": "  CurrentInliningSet = SetFactory.add(CurrentInliningSet, F);",
          "content_same": false
        },
        {
          "line": 499,
          "old_api": "getParent",
          "new_api": "FullApplySite::isa(&*II)",
          "old_text": "InnerAI.getParent()",
          "new_text": "FullApplySite::isa(&*II)",
          "old_line_content": "      auto *ApplyBlock = InnerAI.getParent();",
          "new_line_content": "      FullApplySite InnerAI = FullApplySite::isa(&*II);",
          "content_same": false
        },
        {
          "line": 547,
          "old_api": "getInstruction",
          "new_api": "registerDeleteNotificationHandler",
          "old_text": "InnerAI.getInstruction()",
          "new_text": "F->getModule().registerDeleteNotificationHandler(\n          &OpenedArchetypesTracker)",
          "old_line_content": "          InnerAI.getInstruction());",
          "new_line_content": "      F->getModule().registerDeleteNotificationHandler(",
          "content_same": false
        },
        {
          "line": 589,
          "old_api": "getInstruction",
          "new_api": "end",
          "old_text": "InnerAI.getInstruction()->eraseFromParent()",
          "new_text": "ApplyBlock->end()",
          "old_line_content": "      InnerAI.getInstruction()->eraseFromParent();",
          "new_line_content": "      II = prev_or_default(II, ApplyBlock->begin(), ApplyBlock->end());",
          "content_same": false
        },
        {
          "line": 605,
          "old_api": "getParent",
          "new_api": "cleanupCalleeValue",
          "old_text": "II->getParent()",
          "new_text": "cleanupCalleeValue(CalleeValue, FullArgs)",
          "old_line_content": "      assert(BI == SILFunction::iterator(II->getParent()) &&",
          "new_line_content": "      cleanupCalleeValue(CalleeValue, FullArgs);",
          "content_same": false
        },
        {
          "line": 670,
          "old_api": "getRefCount",
          "new_api": "end",
          "old_text": "F.getRefCount()",
          "new_text": "M->end()",
          "old_line_content": "      if (F.getRefCount() != 0) continue;",
          "new_line_content": "    for (auto FI = M->begin(), E = M->end(); FI != E; ) {",
          "content_same": false
        },
        {
          "line": 673,
          "old_api": "isTransparent",
          "new_api": "invalidateAnalysis",
          "old_text": "F.isTransparent()",
          "new_text": "invalidateAnalysis(&F, SILAnalysis::InvalidationKind::Everything)",
          "old_line_content": "      if (!F.isTransparent())",
          "new_line_content": "      invalidateAnalysis(&F, SILAnalysis::InvalidationKind::Everything);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 514,
          "old_api": null,
          "new_api": "getCallee",
          "old_text": null,
          "new_text": "InnerAI.getCallee()",
          "old_line_content": "",
          "new_line_content": "      SILValue CalleeValue = InnerAI.getCallee();",
          "content_same": false
        },
        {
          "line": 643,
          "old_api": null,
          "new_api": "getAnalysis<ClassHierarchyAnalysis>()",
          "old_text": null,
          "new_text": "getAnalysis<ClassHierarchyAnalysis>()",
          "old_line_content": "    ImmutableFunctionSet::Factory SetFactory;",
          "new_line_content": "    ClassHierarchyAnalysis *CHA = getAnalysis<ClassHierarchyAnalysis>();",
          "content_same": false
        },
        {
          "line": 644,
          "old_api": null,
          "new_api": "getModule",
          "old_text": null,
          "new_text": "getModule()",
          "old_line_content": "",
          "new_line_content": "    SILModule *M = getModule();",
          "content_same": false
        },
        {
          "line": 517,
          "old_api": null,
          "new_api": "getCalleeFunction",
          "old_text": null,
          "new_text": "getCalleeFunction(\n          F, InnerAI, IsThick, CaptureArgs, FullArgs, PAI, Mode)",
          "old_line_content": "",
          "new_line_content": "      SILFunction *CalleeFunction = getCalleeFunction(",
          "content_same": false
        },
        {
          "line": 645,
          "old_api": null,
          "new_api": "getOptions",
          "old_text": null,
          "new_text": "getOptions()",
          "old_line_content": "    for (auto &F : *M) {",
          "new_line_content": "    SILModule::LinkingMode Mode = getOptions().LinkMode;",
          "content_same": false
        },
        {
          "line": 646,
          "old_api": null,
          "new_api": "getOptions",
          "old_text": null,
          "new_text": "getOptions()",
          "old_line_content": "      // Don't inline into thunks, even transparent callees.",
          "new_line_content": "    bool ShouldCleanup = !getOptions().DebugSerialization;",
          "content_same": false
        },
        {
          "line": 524,
          "old_api": null,
          "new_api": "runOnFunctionRecursively",
          "old_text": null,
          "new_text": "runOnFunctionRecursively(CalleeFunction, InnerAI, Mode,\n                                    FullyInlinedSet, SetFactory,\n                                    CurrentInliningSet, CHA)",
          "old_line_content": "        // FIXME: possibly it could be worth recovering and attempting other",
          "new_line_content": "      if (!runOnFunctionRecursively(CalleeFunction, InnerAI, Mode,",
          "content_same": false
        },
        {
          "line": 652,
          "old_api": null,
          "new_api": "isThunk",
          "old_text": null,
          "new_text": "F.isThunk()",
          "old_line_content": "                               Mode, FullyInlinedSet,",
          "new_line_content": "      if (F.isThunk())",
          "content_same": false
        },
        {
          "line": 655,
          "old_api": null,
          "new_api": "getEmptySet",
          "old_text": null,
          "new_text": "runOnFunctionRecursively(&F,\n                               FullApplySite(static_cast<ApplyInst*>(nullptr)),\n                               Mode, FullyInlinedSet,\n                               SetFactory, SetFactory.getEmptySet(), CHA)",
          "old_line_content": "",
          "new_line_content": "      runOnFunctionRecursively(&F,",
          "content_same": false
        },
        {
          "line": 656,
          "old_api": null,
          "new_api": "static_cast<ApplyInst*>(nullptr)",
          "old_text": null,
          "new_text": "static_cast<ApplyInst*>(nullptr)",
          "old_line_content": "    if (!ShouldCleanup)",
          "new_line_content": "                               FullApplySite(static_cast<ApplyInst*>(nullptr)),",
          "content_same": false
        },
        {
          "line": 658,
          "old_api": null,
          "new_api": "getEmptySet",
          "old_text": null,
          "new_text": "SetFactory.getEmptySet()",
          "old_line_content": "",
          "new_line_content": "                               SetFactory, SetFactory.getEmptySet(), CHA);",
          "content_same": false
        },
        {
          "line": 533,
          "old_api": null,
          "new_api": "getLoc",
          "old_text": null,
          "new_text": "AI.getLoc()",
          "old_line_content": "        return false;",
          "new_line_content": "          SILLocation L = AI.getLoc();",
          "content_same": false
        },
        {
          "line": 534,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(L && \"Must have location for transparent inline apply\")",
          "old_line_content": "      }",
          "new_line_content": "          assert(L && \"Must have location for transparent inline apply\");",
          "content_same": false
        },
        {
          "line": 535,
          "old_api": null,
          "new_api": "getStartSourceLoc",
          "old_text": null,
          "new_text": "L.getStartSourceLoc()",
          "old_line_content": "",
          "new_line_content": "          diagnose(F->getModule().getASTContext(), L.getStartSourceLoc(),",
          "content_same": false
        },
        {
          "line": 413,
          "old_api": null,
          "new_api": "empty",
          "old_text": null,
          "new_text": "CalleeFunction->empty()",
          "old_line_content": "  // If the CalleeFunction is a not-transparent definition, we can not process",
          "new_line_content": "  if (CalleeFunction->empty()) {",
          "content_same": false
        },
        {
          "line": 543,
          "old_api": null,
          "new_api": "getSubstitutions",
          "old_text": null,
          "new_text": "PAI->getSubstitutions()",
          "old_line_content": "          &OpenedArchetypesTracker);",
          "new_line_content": "                   ? PAI->getSubstitutions()",
          "content_same": false
        },
        {
          "line": 544,
          "old_api": null,
          "new_api": "getSubstitutions",
          "old_text": null,
          "new_text": "InnerAI.getSubstitutions()",
          "old_line_content": "      // The callee only needs to know about opened archetypes used in",
          "new_line_content": "                   : InnerAI.getSubstitutions());",
          "content_same": false
        },
        {
          "line": 416,
          "old_api": null,
          "new_api": "getModule",
          "old_text": null,
          "new_text": "AI.getModule().loadFunction(CalleeFunction)",
          "old_line_content": "    return nullptr;",
          "new_line_content": "      AI.getModule().loadFunction(CalleeFunction);",
          "content_same": false
        },
        {
          "line": 675,
          "old_api": null,
          "new_api": "getRefCount",
          "old_text": null,
          "new_text": "F.getRefCount()",
          "old_line_content": "",
          "new_line_content": "      if (F.getRefCount() != 0) continue;",
          "content_same": false
        },
        {
          "line": 678,
          "old_api": null,
          "new_api": "isTransparent",
          "old_text": null,
          "new_text": "F.isTransparent()",
          "old_line_content": "      // Being marked transparent controls this.",
          "new_line_content": "      if (!F.isTransparent())",
          "content_same": false
        },
        {
          "line": 551,
          "old_api": null,
          "new_api": "registerUsedOpenedArchetypes",
          "old_text": null,
          "new_text": "OpenedArchetypesTracker.registerUsedOpenedArchetypes(\n          InnerAI.getInstruction())",
          "old_line_content": "",
          "new_line_content": "      OpenedArchetypesTracker.registerUsedOpenedArchetypes(",
          "content_same": false
        },
        {
          "line": 552,
          "old_api": null,
          "new_api": "getInstruction",
          "old_text": null,
          "new_text": "InnerAI.getInstruction()",
          "old_line_content": "      SILInliner Inliner(*F, *CalleeFunction,",
          "new_line_content": "          InnerAI.getInstruction());",
          "content_same": false
        },
        {
          "line": 424,
          "old_api": null,
          "new_api": "hasValidLinkageForFragileInline",
          "old_text": null,
          "new_text": "CalleeFunction->hasValidLinkageForFragileInline()",
          "old_line_content": "                       \"a fragile function\");",
          "new_line_content": "      !CalleeFunction->hasValidLinkageForFragileInline()) {",
          "content_same": false
        },
        {
          "line": 554,
          "old_api": null,
          "new_api": "registerUsedOpenedArchetypes",
          "old_text": null,
          "new_text": "OpenedArchetypesTracker.registerUsedOpenedArchetypes(PAI)",
          "old_line_content": "                         OpenedArchetypesTracker);",
          "new_line_content": "        OpenedArchetypesTracker.registerUsedOpenedArchetypes(PAI);",
          "content_same": false
        },
        {
          "line": 425,
          "old_api": null,
          "new_api": "hasValidLinkageForFragileRef",
          "old_text": null,
          "new_text": "CalleeFunction->hasValidLinkageForFragileRef()",
          "old_line_content": "    }",
          "new_line_content": "    if (!CalleeFunction->hasValidLinkageForFragileRef()) {",
          "content_same": false
        },
        {
          "line": 684,
          "old_api": null,
          "new_api": "isPossiblyUsedExternally",
          "old_text": null,
          "new_text": "F.isPossiblyUsedExternally()",
          "old_line_content": "        continue;",
          "new_line_content": "      if (F.isPossiblyUsedExternally()) continue;",
          "content_same": false
        },
        {
          "line": 426,
          "old_api": null,
          "new_api": "getName",
          "old_text": null,
          "new_text": "F->getName()",
          "old_line_content": "    return nullptr;",
          "new_line_content": "      llvm::errs() << \"caller: \" << F->getName() << \"\\n\";",
          "content_same": false
        },
        {
          "line": 427,
          "old_api": null,
          "new_api": "getName",
          "old_text": null,
          "new_text": "CalleeFunction->getName()",
          "old_line_content": "  }",
          "new_line_content": "      llvm::errs() << \"callee: \" << CalleeFunction->getName() << \"\\n\";",
          "content_same": false
        },
        {
          "line": 428,
          "old_api": null,
          "new_api": "llvm_unreachable",
          "old_text": null,
          "new_text": "llvm_unreachable(\"Should never be inlining a resilient function into \"\n                       \"a fragile function\")",
          "old_line_content": "",
          "new_line_content": "      llvm_unreachable(\"Should never be inlining a resilient function into \"",
          "content_same": false
        },
        {
          "line": 560,
          "old_api": null,
          "new_api": "canInlineFunction",
          "old_text": null,
          "new_text": "Inliner.canInlineFunction(InnerAI)",
          "old_line_content": "        continue;",
          "new_line_content": "      if (!Inliner.canInlineFunction(InnerAI)) {",
          "content_same": false
        },
        {
          "line": 688,
          "old_api": null,
          "new_api": "getRepresentation",
          "old_text": null,
          "new_text": "F.getRepresentation()",
          "old_line_content": "      // Okay, just erase the function from the module.",
          "new_line_content": "      if (F.getRepresentation() == SILFunctionTypeRepresentation::ObjCMethod)",
          "content_same": false
        },
        {
          "line": 691,
          "old_api": null,
          "new_api": "notifyDeleteFunction",
          "old_text": null,
          "new_text": "notifyDeleteFunction(&F)",
          "old_line_content": "  }",
          "new_line_content": "      notifyDeleteFunction(&F);",
          "content_same": false
        },
        {
          "line": 564,
          "old_api": null,
          "new_api": "getInstruction",
          "old_text": null,
          "new_text": "InnerAI.getInstruction()->getIterator()",
          "old_line_content": "      // instruction inlined in the case that it succeeds. We purposely",
          "new_line_content": "        II = InnerAI.getInstruction()->getIterator();",
          "content_same": false
        },
        {
          "line": 694,
          "old_api": null,
          "new_api": "eraseFunction",
          "old_text": null,
          "new_text": "M->eraseFunction(&F)",
          "old_line_content": "} // end anonymous namespace",
          "new_line_content": "      M->eraseFunction(&F);",
          "content_same": false
        },
        {
          "line": 573,
          "old_api": null,
          "new_api": "getName",
          "old_text": null,
          "new_text": "CalleeFunction->getName()",
          "old_line_content": "      // reference counts for correctness.",
          "new_line_content": "      DEBUG(llvm::errs() << \"Inlining @\" << CalleeFunction->getName()",
          "content_same": false
        },
        {
          "line": 574,
          "old_api": null,
          "new_api": "getFunction",
          "old_text": null,
          "new_text": "InnerAI.getFunction()->getName()",
          "old_line_content": "      if (IsThick) {",
          "new_line_content": "                         << \" into @\" << InnerAI.getFunction()->getName()",
          "content_same": false
        },
        {
          "line": 447,
          "old_api": null,
          "new_api": "getInstruction",
          "old_text": null,
          "new_text": "NewInstPair.second.getInstruction()",
          "old_line_content": "}",
          "new_line_content": "  auto newApplyAI = NewInstPair.second.getInstruction();",
          "content_same": false
        },
        {
          "line": 448,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(newApplyAI && \"devirtualized but removed apply site?\")",
          "old_line_content": "",
          "new_line_content": "  assert(newApplyAI && \"devirtualized but removed apply site?\");",
          "content_same": false
        },
        {
          "line": 450,
          "old_api": null,
          "new_api": "FullApplySite::isa(newApplyAI)",
          "old_text": null,
          "new_text": "FullApplySite::isa(newApplyAI)",
          "old_line_content": "/// first recursively inlining all mandatory apply instructions in those",
          "new_line_content": "  return std::make_tuple(FullApplySite::isa(newApplyAI),",
          "content_same": false
        },
        {
          "line": 451,
          "old_api": null,
          "new_api": "getIterator",
          "old_text": null,
          "new_text": "newApplyAI->getIterator()",
          "old_line_content": "/// functions into their bodies if necessary.",
          "new_line_content": "                         newApplyAI->getIterator());",
          "content_same": false
        },
        {
          "line": 582,
          "old_api": null,
          "new_api": "getType",
          "old_text": null,
          "new_text": "PAI->getType().castTo<SILFunctionType>()->isCalleeGuaranteed()",
          "old_line_content": "      // is valid after inlining is done.  Inlining deletes the apply, and can",
          "new_line_content": "            PAI->getType().castTo<SILFunctionType>()->isCalleeGuaranteed();",
          "content_same": false
        },
        {
          "line": 583,
          "old_api": null,
          "new_api": "fixupReferenceCounts",
          "old_text": null,
          "new_text": "fixupReferenceCounts(II, CalleeValue, CaptureArgs, IsCalleeGuaranteed)",
          "old_line_content": "      // introduce multiple new basic blocks.",
          "new_line_content": "        fixupReferenceCounts(II, CalleeValue, CaptureArgs, IsCalleeGuaranteed);",
          "content_same": false
        },
        {
          "line": 591,
          "old_api": null,
          "new_api": "inlineFunction",
          "old_text": null,
          "new_text": "Inliner.inlineFunction(InnerAI, FullArgs)",
          "old_line_content": "      // Reestablish our iterator if it wrapped.",
          "new_line_content": "      Inliner.inlineFunction(InnerAI, FullArgs);",
          "content_same": false
        },
        {
          "line": 594,
          "old_api": null,
          "new_api": "getInstruction",
          "old_text": null,
          "new_text": "InnerAI.getInstruction()->eraseFromParent()",
          "old_line_content": "",
          "new_line_content": "      InnerAI.getInstruction()->eraseFromParent();",
          "content_same": false
        },
        {
          "line": 597,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "ApplyBlock->end()",
          "old_line_content": "",
          "new_line_content": "      if (II == ApplyBlock->end())",
          "content_same": false
        },
        {
          "line": 598,
          "old_api": null,
          "new_api": "begin",
          "old_text": null,
          "new_text": "ApplyBlock->begin()",
          "old_line_content": "      // Now that the IR is correct, see if we can remove dead callee",
          "new_line_content": "        II = ApplyBlock->begin();",
          "content_same": false
        },
        {
          "line": 476,
          "old_api": null,
          "new_api": "count",
          "old_text": null,
          "new_text": "FullyInlinedSet.count(F)",
          "old_line_content": "    // This cannot happen on a top-level call, so AI should be non-null.",
          "new_line_content": "  if (FullyInlinedSet.count(F))",
          "content_same": false
        },
        {
          "line": 608,
          "old_api": null,
          "new_api": "SILFunction::iterator(ApplyBlock)",
          "old_text": null,
          "new_text": "SILFunction::iterator(ApplyBlock)",
          "old_line_content": "    }",
          "new_line_content": "      BI = SILFunction::iterator(ApplyBlock);",
          "content_same": false
        },
        {
          "line": 609,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "ApplyBlock->end()",
          "old_line_content": "  }",
          "new_line_content": "      IE = ApplyBlock->end();",
          "content_same": false
        },
        {
          "line": 610,
          "old_api": null,
          "new_api": "getParent",
          "old_text": null,
          "new_text": "II->getParent()",
          "old_line_content": "",
          "new_line_content": "      assert(BI == SILFunction::iterator(II->getParent()) &&",
          "content_same": false
        },
        {
          "line": 482,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(AI && \"Cannot have circular inline without apply\")",
          "old_line_content": "    return false;",
          "new_line_content": "    assert(AI && \"Cannot have circular inline without apply\");",
          "content_same": false
        },
        {
          "line": 483,
          "old_api": null,
          "new_api": "getLoc",
          "old_text": null,
          "new_text": "AI.getLoc()",
          "old_line_content": "  }",
          "new_line_content": "    SILLocation L = AI.getLoc();",
          "content_same": false
        },
        {
          "line": 484,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(L && \"Must have location for transparent inline apply\")",
          "old_line_content": "",
          "new_line_content": "    assert(L && \"Must have location for transparent inline apply\");",
          "content_same": false
        },
        {
          "line": 485,
          "old_api": null,
          "new_api": "getStartSourceLoc",
          "old_text": null,
          "new_text": "L.getStartSourceLoc()",
          "old_line_content": "  // Add to the current inlining set (immutably, so we only affect the set",
          "new_line_content": "    diagnose(F->getModule().getASTContext(), L.getStartSourceLoc(),",
          "content_same": false
        },
        {
          "line": 618,
          "old_api": null,
          "new_api": "insert",
          "old_text": null,
          "new_text": "FullyInlinedSet.insert(F)",
          "old_line_content": "//                          Top Level Driver",
          "new_line_content": "  FullyInlinedSet.insert(F);",
          "content_same": false
        },
        {
          "line": 497,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "F->end()",
          "old_line_content": "        continue;",
          "new_line_content": "  for (auto BI = F->begin(), BE = F->end(); BI != BE; ++BI) {",
          "content_same": false
        },
        {
          "line": 498,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "BI->end()",
          "old_line_content": "",
          "new_line_content": "    for (auto II = BI->begin(), IE = BI->end(); II != IE; ++II) {",
          "content_same": false
        },
        {
          "line": 504,
          "old_api": null,
          "new_api": "getParent",
          "old_text": null,
          "new_text": "InnerAI.getParent()",
          "old_line_content": "      // know that InnerAI dominates II though.",
          "new_line_content": "      auto *ApplyBlock = InnerAI.getParent();",
          "content_same": false
        },
        {
          "line": 510,
          "old_api": null,
          "new_api": "tryDevirtualizeApplyHelper",
          "old_text": null,
          "new_text": "tryDevirtualizeApplyHelper(InnerAI, II, CHA)",
          "old_line_content": "      bool IsThick;",
          "new_line_content": "      std::tie(InnerAI, II) = tryDevirtualizeApplyHelper(InnerAI, II, CHA);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 512,
          "old_api": "getCalleeFunction",
          "new_api": null,
          "old_text": "getCalleeFunction(\n          F, InnerAI, IsThick, CaptureArgs, FullArgs, PAI, Mode)",
          "new_text": null,
          "old_line_content": "      SILFunction *CalleeFunction = getCalleeFunction(",
          "new_line_content": "        continue;",
          "content_same": false
        },
        {
          "line": 640,
          "old_api": "getOptions",
          "new_api": null,
          "old_text": "getOptions()",
          "new_text": null,
          "old_line_content": "    SILModule::LinkingMode Mode = getOptions().LinkMode;",
          "new_line_content": "class MandatoryInlining : public SILModuleTransform {",
          "content_same": false
        },
        {
          "line": 641,
          "old_api": "getOptions",
          "new_api": null,
          "old_text": "getOptions()",
          "new_text": null,
          "old_line_content": "    bool ShouldCleanup = !getOptions().DebugSerialization;",
          "new_line_content": "  /// The entry point to the transformation.",
          "content_same": false
        },
        {
          "line": 519,
          "old_api": "runOnFunctionRecursively",
          "new_api": null,
          "old_text": "runOnFunctionRecursively(CalleeFunction, InnerAI, Mode,\n                                    FullyInlinedSet, SetFactory,\n                                    CurrentInliningSet, CHA)",
          "new_text": null,
          "old_line_content": "      if (!runOnFunctionRecursively(CalleeFunction, InnerAI, Mode,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 647,
          "old_api": "isThunk",
          "new_api": null,
          "old_text": "F.isThunk()",
          "new_text": null,
          "old_line_content": "      if (F.isThunk())",
          "new_line_content": "    DenseFunctionSet FullyInlinedSet;",
          "content_same": false
        },
        {
          "line": 650,
          "old_api": "getEmptySet",
          "new_api": null,
          "old_text": "runOnFunctionRecursively(&F,\n                               FullApplySite(static_cast<ApplyInst*>(nullptr)),\n                               Mode, FullyInlinedSet,\n                               SetFactory, SetFactory.getEmptySet(), CHA)",
          "new_text": null,
          "old_line_content": "      runOnFunctionRecursively(&F,",
          "new_line_content": "    for (auto &F : *M) {",
          "content_same": false
        },
        {
          "line": 651,
          "old_api": "static_cast<ApplyInst*>(nullptr)",
          "new_api": null,
          "old_text": "static_cast<ApplyInst*>(nullptr)",
          "new_text": null,
          "old_line_content": "                               FullApplySite(static_cast<ApplyInst*>(nullptr)),",
          "new_line_content": "      // Don't inline into thunks, even transparent callees.",
          "content_same": false
        },
        {
          "line": 653,
          "old_api": "getEmptySet",
          "new_api": null,
          "old_text": "SetFactory.getEmptySet()",
          "new_text": null,
          "old_line_content": "                               SetFactory, SetFactory.getEmptySet(), CHA);",
          "new_line_content": "        continue;",
          "content_same": false
        },
        {
          "line": 528,
          "old_api": "getLoc",
          "new_api": null,
          "old_text": "AI.getLoc()",
          "new_text": null,
          "old_line_content": "          SILLocation L = AI.getLoc();",
          "new_line_content": "        // trace back the failure if we have more information.",
          "content_same": false
        },
        {
          "line": 529,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(L && \"Must have location for transparent inline apply\")",
          "new_text": null,
          "old_line_content": "          assert(L && \"Must have location for transparent inline apply\");",
          "new_line_content": "        // FIXME: possibly it could be worth recovering and attempting other",
          "content_same": false
        },
        {
          "line": 530,
          "old_api": "getStartSourceLoc",
          "new_api": null,
          "old_text": "L.getStartSourceLoc()",
          "new_text": null,
          "old_line_content": "          diagnose(F->getModule().getASTContext(), L.getStartSourceLoc(),",
          "new_line_content": "        // inlines within this same recursive call rather than simply",
          "content_same": false
        },
        {
          "line": 665,
          "old_api": "end",
          "new_api": null,
          "old_text": "M->end()",
          "new_text": null,
          "old_line_content": "    for (auto FI = M->begin(), E = M->end(); FI != E; ) {",
          "new_line_content": "    // transparent functions that are deserialized from another module that are",
          "content_same": false
        },
        {
          "line": 538,
          "old_api": "getSubstitutions",
          "new_api": null,
          "old_text": "PAI->getSubstitutions()",
          "new_text": null,
          "old_line_content": "                   ? PAI->getSubstitutions()",
          "new_line_content": "        return false;",
          "content_same": false
        },
        {
          "line": 539,
          "old_api": "getSubstitutions",
          "new_api": null,
          "old_text": "InnerAI.getSubstitutions()",
          "new_text": null,
          "old_line_content": "                   : InnerAI.getSubstitutions());",
          "new_line_content": "      }",
          "content_same": false
        },
        {
          "line": 668,
          "old_api": "invalidateAnalysis",
          "new_api": null,
          "old_text": "invalidateAnalysis(&F, SILAnalysis::InvalidationKind::Everything)",
          "new_text": null,
          "old_line_content": "      invalidateAnalysis(&F, SILAnalysis::InvalidationKind::Everything);",
          "new_line_content": "    // We do this with a simple linear scan, because transparent functions that",
          "content_same": false
        },
        {
          "line": 410,
          "old_api": "getModule",
          "new_api": null,
          "old_text": "AI.getModule().linkFunction(CalleeFunction, Mode)",
          "new_text": null,
          "old_line_content": "      && !AI.getModule().linkFunction(CalleeFunction, Mode))",
          "new_line_content": "    return nullptr;",
          "content_same": false
        },
        {
          "line": 542,
          "old_api": "registerDeleteNotificationHandler",
          "new_api": null,
          "old_text": "F->getModule().registerDeleteNotificationHandler(\n          &OpenedArchetypesTracker)",
          "new_text": null,
          "old_line_content": "      F->getModule().registerDeleteNotificationHandler(",
          "new_line_content": "      auto Subs = (PAI",
          "content_same": false
        },
        {
          "line": 415,
          "old_api": "isTransparent",
          "new_api": null,
          "old_text": "CalleeFunction->isTransparent()",
          "new_text": null,
          "old_line_content": "  if (CalleeFunction->isTransparent() == IsNotTransparent)",
          "new_line_content": "    if (Mode != SILOptions::LinkingMode::LinkNone)",
          "content_same": false
        },
        {
          "line": 546,
          "old_api": "registerUsedOpenedArchetypes",
          "new_api": null,
          "old_text": "OpenedArchetypesTracker.registerUsedOpenedArchetypes(\n          InnerAI.getInstruction())",
          "new_text": null,
          "old_line_content": "      OpenedArchetypesTracker.registerUsedOpenedArchetypes(",
          "new_line_content": "      SILOpenedArchetypesTracker OpenedArchetypesTracker(F);",
          "content_same": false
        },
        {
          "line": 418,
          "old_api": "isSerialized",
          "new_api": null,
          "old_text": "F->isSerialized()",
          "new_text": null,
          "old_line_content": "  if (F->isSerialized() &&",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 419,
          "old_api": "hasValidLinkageForFragileInline",
          "new_api": null,
          "old_text": "CalleeFunction->hasValidLinkageForFragileInline()",
          "new_text": null,
          "old_line_content": "      !CalleeFunction->hasValidLinkageForFragileInline()) {",
          "new_line_content": "  // If we fail to load it, bail.",
          "content_same": false
        },
        {
          "line": 549,
          "old_api": "registerUsedOpenedArchetypes",
          "new_api": null,
          "old_text": "OpenedArchetypesTracker.registerUsedOpenedArchetypes(PAI)",
          "new_text": null,
          "old_line_content": "        OpenedArchetypesTracker.registerUsedOpenedArchetypes(PAI);",
          "new_line_content": "      // The callee only needs to know about opened archetypes used in",
          "content_same": false
        },
        {
          "line": 421,
          "old_api": "getName",
          "new_api": null,
          "old_text": "F->getName()",
          "new_text": null,
          "old_line_content": "      llvm::errs() << \"caller: \" << F->getName() << \"\\n\";",
          "new_line_content": "    return nullptr;",
          "content_same": false
        },
        {
          "line": 679,
          "old_api": "isPossiblyUsedExternally",
          "new_api": null,
          "old_text": "F.isPossiblyUsedExternally()",
          "new_text": null,
          "old_line_content": "      if (F.isPossiblyUsedExternally()) continue;",
          "new_line_content": "        continue;",
          "content_same": false
        },
        {
          "line": 422,
          "old_api": "getName",
          "new_api": null,
          "old_text": "CalleeFunction->getName()",
          "new_text": null,
          "old_line_content": "      llvm::errs() << \"callee: \" << CalleeFunction->getName() << \"\\n\";",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 555,
          "old_api": "canInlineFunction",
          "new_api": null,
          "old_text": "Inliner.canInlineFunction(InnerAI)",
          "new_text": null,
          "old_line_content": "      if (!Inliner.canInlineFunction(InnerAI)) {",
          "new_line_content": "      }",
          "content_same": false
        },
        {
          "line": 683,
          "old_api": "getRepresentation",
          "new_api": null,
          "old_text": "F.getRepresentation()",
          "new_text": null,
          "old_line_content": "      if (F.getRepresentation() == SILFunctionTypeRepresentation::ObjCMethod)",
          "new_line_content": "      // Being marked transparent controls this.",
          "content_same": false
        },
        {
          "line": 686,
          "old_api": "notifyDeleteFunction",
          "new_api": null,
          "old_text": "notifyDeleteFunction(&F)",
          "new_text": null,
          "old_line_content": "      notifyDeleteFunction(&F);",
          "new_line_content": "      // ObjC functions are called through the runtime and are therefore alive",
          "content_same": false
        },
        {
          "line": 559,
          "old_api": "getInstruction",
          "new_api": null,
          "old_text": "InnerAI.getInstruction()->getIterator()",
          "new_text": null,
          "old_line_content": "        II = InnerAI.getInstruction()->getIterator();",
          "new_line_content": "                         OpenedArchetypesTracker);",
          "content_same": false
        },
        {
          "line": 689,
          "old_api": "eraseFunction",
          "new_api": null,
          "old_text": "M->eraseFunction(&F)",
          "new_text": null,
          "old_line_content": "      M->eraseFunction(&F);",
          "new_line_content": "        continue;",
          "content_same": false
        },
        {
          "line": 435,
          "old_api": "tryDevirtualizeApply",
          "new_api": null,
          "old_text": "tryDevirtualizeApply(InnerAI, CHA)",
          "new_text": null,
          "old_line_content": "  auto NewInstPair = tryDevirtualizeApply(InnerAI, CHA);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 437,
          "old_api": "std::make_tuple(InnerAI, I)",
          "new_api": null,
          "old_text": "std::make_tuple(InnerAI, I)",
          "new_text": null,
          "old_line_content": "    return std::make_tuple(InnerAI, I);",
          "new_line_content": "static std::tuple<FullApplySite, SILBasicBlock::iterator>",
          "content_same": false
        },
        {
          "line": 568,
          "old_api": "getName",
          "new_api": null,
          "old_text": "CalleeFunction->getName()",
          "new_text": null,
          "old_line_content": "      DEBUG(llvm::errs() << \"Inlining @\" << CalleeFunction->getName()",
          "new_line_content": "      // Inline function at I, which also changes I to refer to the first",
          "content_same": false
        },
        {
          "line": 569,
          "old_api": "getFunction",
          "new_api": null,
          "old_text": "InnerAI.getFunction()->getName()",
          "new_text": null,
          "old_line_content": "                         << \" into @\" << InnerAI.getFunction()->getName()",
          "new_line_content": "      // instruction inlined in the case that it succeeds. We purposely",
          "content_same": false
        },
        {
          "line": 443,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(newApplyAI && \"devirtualized but removed apply site?\")",
          "new_text": null,
          "old_line_content": "  assert(newApplyAI && \"devirtualized but removed apply site?\");",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 446,
          "old_api": "getIterator",
          "new_api": null,
          "old_text": "newApplyAI->getIterator()",
          "new_text": null,
          "old_line_content": "                         newApplyAI->getIterator());",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 577,
          "old_api": "getType",
          "new_api": null,
          "old_text": "PAI->getType().castTo<SILFunctionType>()->isCalleeGuaranteed()",
          "new_text": null,
          "old_line_content": "            PAI->getType().castTo<SILFunctionType>()->isCalleeGuaranteed();",
          "new_line_content": "      // If we intend to inline a thick function, then we need to balance the",
          "content_same": false
        },
        {
          "line": 578,
          "old_api": "fixupReferenceCounts",
          "new_api": null,
          "old_text": "fixupReferenceCounts(II, CalleeValue, CaptureArgs, IsCalleeGuaranteed)",
          "new_text": null,
          "old_line_content": "        fixupReferenceCounts(II, CalleeValue, CaptureArgs, IsCalleeGuaranteed);",
          "new_line_content": "      // reference counts for correctness.",
          "content_same": false
        },
        {
          "line": 584,
          "old_api": "end",
          "new_api": null,
          "old_text": "ApplyBlock->end()",
          "new_text": null,
          "old_line_content": "      II = prev_or_default(II, ApplyBlock->begin(), ApplyBlock->end());",
          "new_line_content": "      }",
          "content_same": false
        },
        {
          "line": 586,
          "old_api": "inlineFunction",
          "new_api": null,
          "old_text": "Inliner.inlineFunction(InnerAI, FullArgs)",
          "new_text": null,
          "old_line_content": "      Inliner.inlineFunction(InnerAI, FullArgs);",
          "new_line_content": "      // Decrement our iterator (carefully, to avoid going off the front) so it",
          "content_same": false
        },
        {
          "line": 592,
          "old_api": "end",
          "new_api": null,
          "old_text": "ApplyBlock->end()",
          "new_text": null,
          "old_line_content": "      if (II == ApplyBlock->end())",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 593,
          "old_api": "begin",
          "new_api": null,
          "old_text": "ApplyBlock->begin()",
          "new_text": null,
          "old_line_content": "        II = ApplyBlock->begin();",
          "new_line_content": "      // We were able to inline successfully. Remove the apply.",
          "content_same": false
        },
        {
          "line": 471,
          "old_api": "count",
          "new_api": null,
          "old_text": "FullyInlinedSet.count(F)",
          "new_text": null,
          "old_line_content": "  if (FullyInlinedSet.count(F))",
          "new_line_content": "                         DenseFunctionSet &FullyInlinedSet,",
          "content_same": false
        },
        {
          "line": 600,
          "old_api": "cleanupCalleeValue",
          "new_api": null,
          "old_text": "cleanupCalleeValue(CalleeValue, FullArgs)",
          "new_text": null,
          "old_line_content": "      cleanupCalleeValue(CalleeValue, FullArgs);",
          "new_line_content": "      // Update the iterator when instructions are removed.",
          "content_same": false
        },
        {
          "line": 603,
          "old_api": "SILFunction::iterator(ApplyBlock)",
          "new_api": null,
          "old_text": "SILFunction::iterator(ApplyBlock)",
          "new_text": null,
          "old_line_content": "      BI = SILFunction::iterator(ApplyBlock);",
          "new_line_content": "      // Now that the IR is correct, see if we can remove dead callee",
          "content_same": false
        },
        {
          "line": 604,
          "old_api": "end",
          "new_api": null,
          "old_text": "ApplyBlock->end()",
          "new_text": null,
          "old_line_content": "      IE = ApplyBlock->end();",
          "new_line_content": "      // computations (e.g. dead partial_apply closures).",
          "content_same": false
        },
        {
          "line": 475,
          "old_api": "contains",
          "new_api": null,
          "old_text": "CurrentInliningSet.contains(F)",
          "new_text": null,
          "old_line_content": "  if (CurrentInliningSet.contains(F)) {",
          "new_line_content": "  // Avoid reprocessing functions needlessly.",
          "content_same": false
        },
        {
          "line": 477,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(AI && \"Cannot have circular inline without apply\")",
          "new_text": null,
          "old_line_content": "    assert(AI && \"Cannot have circular inline without apply\");",
          "new_line_content": "    return true;",
          "content_same": false
        },
        {
          "line": 478,
          "old_api": "getLoc",
          "new_api": null,
          "old_text": "AI.getLoc()",
          "new_text": null,
          "old_line_content": "    SILLocation L = AI.getLoc();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 479,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(L && \"Must have location for transparent inline apply\")",
          "new_text": null,
          "old_line_content": "    assert(L && \"Must have location for transparent inline apply\");",
          "new_line_content": "  // Prevent attempt to circularly inline.",
          "content_same": false
        },
        {
          "line": 613,
          "old_api": "insert",
          "new_api": null,
          "old_text": "FullyInlinedSet.insert(F)",
          "new_text": null,
          "old_line_content": "  FullyInlinedSet.insert(F);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 487,
          "old_api": "add",
          "new_api": null,
          "old_text": "SetFactory.add(CurrentInliningSet, F)",
          "new_text": null,
          "old_line_content": "  CurrentInliningSet = SetFactory.add(CurrentInliningSet, F);",
          "new_line_content": "    return false;",
          "content_same": false
        },
        {
          "line": 493,
          "old_api": "end",
          "new_api": null,
          "old_text": "BI->end()",
          "new_text": null,
          "old_line_content": "    for (auto II = BI->begin(), IE = BI->end(); II != IE; ++II) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 494,
          "old_api": "FullApplySite::isa(&*II)",
          "new_api": null,
          "old_text": "FullApplySite::isa(&*II)",
          "new_text": null,
          "old_line_content": "      FullApplySite InnerAI = FullApplySite::isa(&*II);",
          "new_line_content": "  SmallVector<std::pair<SILValue, ParameterConvention>, 16> CaptureArgs;",
          "content_same": false
        },
        {
          "line": 505,
          "old_api": "tryDevirtualizeApplyHelper",
          "new_api": null,
          "old_text": "tryDevirtualizeApplyHelper(InnerAI, II, CHA)",
          "new_text": null,
          "old_line_content": "      std::tie(InnerAI, II) = tryDevirtualizeApplyHelper(InnerAI, II, CHA);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 509,
          "old_api": "getCallee",
          "new_api": null,
          "old_text": "InnerAI.getCallee()",
          "new_text": null,
          "old_line_content": "      SILValue CalleeValue = InnerAI.getCallee();",
          "new_line_content": "      // know that InnerAI dominates II though.",
          "content_same": false
        },
        {
          "line": 638,
          "old_api": "getAnalysis<ClassHierarchyAnalysis>()",
          "new_api": null,
          "old_text": "getAnalysis<ClassHierarchyAnalysis>()",
          "new_text": null,
          "old_line_content": "    ClassHierarchyAnalysis *CHA = getAnalysis<ClassHierarchyAnalysis>();",
          "new_line_content": "/// really need to devirtualize this early without actually inlining, but it can",
          "content_same": false
        },
        {
          "line": 639,
          "old_api": "getModule",
          "new_api": null,
          "old_text": "getModule()",
          "new_text": null,
          "old_line_content": "    SILModule *M = getModule();",
          "new_line_content": "/// unblock other optimizations in the mandatory pipeline.",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 14,
      "total_additions": 59,
      "total_deletions": 58,
      "total_api_changes": 131
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 16,
        "api_related_lines": 131,
        "non_api_lines": 6,
        "non_api_line_numbers": [
          417,
          407,
          408,
          411,
          412,
          414
        ]
      }
    },
    "api_calls_before": 240,
    "api_calls_after": 241,
    "diff_info": {
      "added_lines": 11,
      "removed_lines": 6,
      "total_diff_lines": 34
    }
  }
}