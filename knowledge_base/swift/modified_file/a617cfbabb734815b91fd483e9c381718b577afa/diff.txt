diff --git a/lib/AST/ASTDumper.cpp b/lib/AST/ASTDumper.cpp
index 631ebe05093..1917c025847 100644
--- a/lib/AST/ASTDumper.cpp
+++ b/lib/AST/ASTDumper.cpp
@@ -1818,7 +1818,9 @@ bool Substitution::operator!=(const Substitution &Other) const {
 }
 
 bool Substitution::operator==(const Substitution &Other) const {
-  return Archetype->getCanonicalType() == Other.Archetype->getCanonicalType() &&
+  // The archetypes may be missing, but we can compare them directly
+  // because archetypes are always canonical.
+  return Archetype == Other.Archetype &&
     Replacement->getCanonicalType() == Other.Replacement->getCanonicalType() &&
     Conformance.equals(Other.Conformance);
 }
