{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/swift/modified_file/6fef7ee8d71effba92104ba6bf1a5df66b8d2d18",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/swift/modified_file/6fef7ee8d71effba92104ba6bf1a5df66b8d2d18/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/swift/modified_file/6fef7ee8d71effba92104ba6bf1a5df66b8d2d18/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/swift/modified_file/6fef7ee8d71effba92104ba6bf1a5df66b8d2d18/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 280,
          "old_api": "dyn_cast<ApplyInst>(I++)",
          "new_api": "end",
          "old_text": "dyn_cast<ApplyInst>(I++)",
          "new_text": "BB.end()",
          "old_line_content": "      ApplyInst *AI = dyn_cast<ApplyInst>(I++);",
          "new_line_content": "    auto I = BB.begin(), E = BB.end();",
          "content_same": false
        },
        {
          "line": 290,
          "old_api": "getInlinableFunction",
          "new_api": "llvm::dbgs()",
          "old_text": "getInlinableFunction(AI)",
          "new_text": "llvm::dbgs()",
          "old_line_content": "    SILFunction *Callee = getInlinableFunction(AI);",
          "new_line_content": "    DEBUG(llvm::dbgs() << \"  Found call site:\" <<  *AI);",
          "content_same": false
        },
        {
          "line": 306,
          "old_api": "llvm::dbgs()",
          "new_api": "getFunctionCost",
          "old_text": "llvm::dbgs()",
          "new_text": "getFunctionCost(Callee)",
          "old_line_content": "      DEBUG(llvm::dbgs() << \"  Function too big to inline. Skipping.\\n\");",
          "new_line_content": "    unsigned CalleeCost = getFunctionCost(Callee);",
          "content_same": false
        },
        {
          "line": 316,
          "old_api": "getName",
          "new_api": "push_back",
          "old_text": "Callee->getName()",
          "new_text": "Args.push_back(Arg)",
          "old_line_content": "    DEBUG(llvm::dbgs() << \"  Inlining \" << Callee->getName() << \" Into \" <<",
          "new_line_content": "    Args.push_back(Arg);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 261,
          "old_api": null,
          "new_api": "llvm::dbgs()",
          "old_text": null,
          "new_text": "llvm::dbgs()",
          "old_line_content": "",
          "new_line_content": "  DEBUG(llvm::dbgs() << \"  Found cost: \" << Cost << \"\\n\");",
          "content_same": false
        },
        {
          "line": 273,
          "old_api": null,
          "new_api": "getName",
          "old_text": null,
          "new_text": "Caller->getName()",
          "old_line_content": "",
          "new_line_content": "  DEBUG(llvm::dbgs() << \"Visiting Function: \" << Caller->getName() << \"\\n\");",
          "content_same": false
        },
        {
          "line": 283,
          "old_api": null,
          "new_api": "dyn_cast<ApplyInst>(I++)",
          "old_text": null,
          "new_text": "dyn_cast<ApplyInst>(I++)",
          "old_line_content": "    }",
          "new_line_content": "      ApplyInst *AI = dyn_cast<ApplyInst>(I++);",
          "content_same": false
        },
        {
          "line": 285,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "CallSites.push_back(AI)",
          "old_line_content": "",
          "new_line_content": "        CallSites.push_back(AI);",
          "content_same": false
        },
        {
          "line": 293,
          "old_api": null,
          "new_api": "getInlinableFunction",
          "old_text": null,
          "new_text": "getInlinableFunction(AI)",
          "old_line_content": "",
          "new_line_content": "    SILFunction *Callee = getInlinableFunction(AI);",
          "content_same": false
        },
        {
          "line": 297,
          "old_api": null,
          "new_api": "getName",
          "old_text": null,
          "new_text": "Callee->getName()",
          "old_line_content": "    if (Callee == Caller) {",
          "new_line_content": "    DEBUG(llvm::dbgs() << \"  Found callee:\" <<  Callee->getName() << \".\\n\");",
          "content_same": false
        },
        {
          "line": 301,
          "old_api": null,
          "new_api": "llvm::dbgs()",
          "old_text": null,
          "new_text": "llvm::dbgs()",
          "old_line_content": "",
          "new_line_content": "      DEBUG(llvm::dbgs() << \"  Skipping recursive calls.\\n\");",
          "content_same": false
        },
        {
          "line": 309,
          "old_api": null,
          "new_api": "llvm::dbgs()",
          "old_text": null,
          "new_text": "llvm::dbgs()",
          "old_line_content": "",
          "new_line_content": "      DEBUG(llvm::dbgs() << \"  Function too big to inline. Skipping.\\n\");",
          "content_same": false
        },
        {
          "line": 315,
          "old_api": null,
          "new_api": "getArguments",
          "old_text": null,
          "new_text": "AI->getArguments()",
          "old_line_content": "    // Ok, we are within budget. Attempt to inline.",
          "new_line_content": "    for (const auto &Arg : AI->getArguments())",
          "content_same": false
        },
        {
          "line": 319,
          "old_api": null,
          "new_api": "getName",
          "old_text": null,
          "new_text": "Callee->getName()",
          "old_line_content": "    // We already moved the iterator to the next instruction because the AI",
          "new_line_content": "    DEBUG(llvm::dbgs() << \"  Inlining \" << Callee->getName() << \" Into \" <<",
          "content_same": false
        },
        {
          "line": 320,
          "old_api": null,
          "new_api": "getName",
          "old_text": null,
          "new_text": "Caller->getName()",
          "old_line_content": "    // will be erased by the inliner. Notice that we will skip all of the",
          "new_line_content": "          Caller->getName() << \"\\n\");",
          "content_same": false
        },
        {
          "line": 326,
          "old_api": null,
          "new_api": "ArrayRef<Substitution>()",
          "old_text": null,
          "new_text": "ArrayRef<Substitution>()",
          "old_line_content": "}",
          "new_line_content": "    Inliner.inlineFunction(AI, Callee, ArrayRef<Substitution>(), Args);",
          "content_same": false
        },
        {
          "line": 339,
          "old_api": null,
          "new_api": "llvm::dbgs()",
          "old_text": null,
          "new_text": "llvm::dbgs()",
          "old_line_content": "",
          "new_line_content": "    DEBUG(llvm::dbgs() << \"*** The SIL performance Inliner is disabled ***\\n\");",
          "content_same": false
        },
        {
          "line": 345,
          "old_api": null,
          "new_api": "TopDownCallGraphOrder",
          "old_text": null,
          "new_text": "TopDownCallGraphOrder(M, Worklist)",
          "old_line_content": "  // inst.",
          "new_line_content": "  TopDownCallGraphOrder(M, Worklist);",
          "content_same": false
        },
        {
          "line": 349,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "Worklist.size()",
          "old_line_content": "",
          "new_line_content": "  while (Worklist.size()) {",
          "content_same": false
        },
        {
          "line": 350,
          "old_api": null,
          "new_api": "back",
          "old_text": null,
          "new_text": "Worklist.back()",
          "old_line_content": "    // Do not inline into transparent functions. This is exposing a diagnostics",
          "new_line_content": "    SILFunction *F = Worklist.back();",
          "content_same": false
        },
        {
          "line": 351,
          "old_api": null,
          "new_api": "pop_back",
          "old_text": null,
          "new_text": "Worklist.pop_back()",
          "old_line_content": "    // bug. We will still inline after we perform mandatory inlining of the",
          "new_line_content": "    Worklist.pop_back();",
          "content_same": false
        },
        {
          "line": 356,
          "old_api": null,
          "new_api": "inlineCallsIntoFunction",
          "old_text": null,
          "new_text": "inlineCallsIntoFunction(F)",
          "old_line_content": "",
          "new_line_content": "    inlineCallsIntoFunction(F);",
          "content_same": false
        },
        {
          "line": 230,
          "old_api": null,
          "new_api": "llvm_unreachable",
          "old_text": null,
          "new_text": "llvm_unreachable(\"not valid in canonical sil\")",
          "old_line_content": "",
          "new_line_content": "      llvm_unreachable(\"not valid in canonical sil\");",
          "content_same": false
        },
        {
          "line": 236,
          "old_api": null,
          "new_api": "getName",
          "old_text": null,
          "new_text": "F->getName()",
          "old_line_content": "    return 0;",
          "new_line_content": "  DEBUG(llvm::dbgs() << \"  Calculating cost for \" << F->getName() << \".\\n\");",
          "content_same": false
        },
        {
          "line": 238,
          "old_api": null,
          "new_api": "isTransparent",
          "old_text": null,
          "new_text": "F->isTransparent()",
          "old_line_content": "  unsigned Cost = 0;",
          "new_line_content": "  if (F->isTransparent() == IsTransparent_t::IsTransparent)",
          "content_same": false
        },
        {
          "line": 244,
          "old_api": null,
          "new_api": "instructionInlineCost",
          "old_text": null,
          "new_text": "instructionInlineCost(I)",
          "old_line_content": "      // passed the threshold.",
          "new_line_content": "      Cost += unsigned(instructionInlineCost(I));",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 258,
          "old_api": "llvm::dbgs()",
          "new_api": null,
          "old_text": "llvm::dbgs()",
          "new_text": null,
          "old_line_content": "  DEBUG(llvm::dbgs() << \"  Found cost: \" << Cost << \"\\n\");",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 270,
          "old_api": "getName",
          "new_api": null,
          "old_text": "Caller->getName()",
          "new_text": null,
          "old_line_content": "  DEBUG(llvm::dbgs() << \"Visiting Function: \" << Caller->getName() << \"\\n\");",
          "new_line_content": "static void inlineCallsIntoFunction(SILFunction *Caller) {",
          "content_same": false
        },
        {
          "line": 277,
          "old_api": "end",
          "new_api": null,
          "old_text": "BB.end()",
          "new_text": null,
          "old_line_content": "    auto I = BB.begin(), E = BB.end();",
          "new_line_content": "  // Collect all of the ApplyInsts in this function. We will be changing the",
          "content_same": false
        },
        {
          "line": 282,
          "old_api": "push_back",
          "new_api": null,
          "old_text": "CallSites.push_back(AI)",
          "new_text": null,
          "old_line_content": "        CallSites.push_back(AI);",
          "new_line_content": "      // Check if this is a call site.",
          "content_same": false
        },
        {
          "line": 287,
          "old_api": "llvm::dbgs()",
          "new_api": null,
          "old_text": "llvm::dbgs()",
          "new_text": null,
          "old_line_content": "    DEBUG(llvm::dbgs() << \"  Found call site:\" <<  *AI);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 294,
          "old_api": "getName",
          "new_api": null,
          "old_text": "Callee->getName()",
          "new_text": null,
          "old_line_content": "    DEBUG(llvm::dbgs() << \"  Found callee:\" <<  Callee->getName() << \".\\n\");",
          "new_line_content": "    if (!Callee)",
          "content_same": false
        },
        {
          "line": 298,
          "old_api": "llvm::dbgs()",
          "new_api": null,
          "old_text": "llvm::dbgs()",
          "new_text": null,
          "old_line_content": "      DEBUG(llvm::dbgs() << \"  Skipping recursive calls.\\n\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 303,
          "old_api": "getFunctionCost",
          "new_api": null,
          "old_text": "getFunctionCost(Callee)",
          "new_text": null,
          "old_line_content": "    unsigned CalleeCost = getFunctionCost(Callee);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 312,
          "old_api": "getArguments",
          "new_api": null,
          "old_text": "AI->getArguments()",
          "new_text": null,
          "old_line_content": "    for (const auto &Arg : AI->getArguments())",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 313,
          "old_api": "push_back",
          "new_api": null,
          "old_text": "Args.push_back(Arg)",
          "new_text": null,
          "old_line_content": "    Args.push_back(Arg);",
          "new_line_content": "    // Add the arguments from AI into a SILValue list.",
          "content_same": false
        },
        {
          "line": 317,
          "old_api": "getName",
          "new_api": null,
          "old_text": "Caller->getName()",
          "new_text": null,
          "old_line_content": "          Caller->getName() << \"\\n\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 323,
          "old_api": "ArrayRef<Substitution>()",
          "new_api": null,
          "old_text": "ArrayRef<Substitution>()",
          "new_text": null,
          "old_line_content": "    Inliner.inlineFunction(AI, Callee, ArrayRef<Substitution>(), Args);",
          "new_line_content": "    // will be erased by the inliner. Notice that we will skip all of the",
          "content_same": false
        },
        {
          "line": 333,
          "old_api": "llvm::dbgs()",
          "new_api": null,
          "old_text": "llvm::dbgs()",
          "new_text": null,
          "old_line_content": "  DEBUG(llvm::dbgs() << \"*** SIL Performance Inlining ***\\n\\n\");",
          "new_line_content": "//===----------------------------------------------------------------------===//",
          "content_same": false
        },
        {
          "line": 342,
          "old_api": "TopDownCallGraphOrder",
          "new_api": null,
          "old_text": "TopDownCallGraphOrder(M, Worklist)",
          "new_text": null,
          "old_line_content": "  TopDownCallGraphOrder(M, Worklist);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 346,
          "old_api": "size",
          "new_api": null,
          "old_text": "Worklist.size()",
          "new_text": null,
          "old_line_content": "  while (Worklist.size()) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 347,
          "old_api": "back",
          "new_api": null,
          "old_text": "Worklist.back()",
          "new_text": null,
          "old_line_content": "    SILFunction *F = Worklist.back();",
          "new_line_content": "  // For each function in the worklist, attempt to inline its list of apply",
          "content_same": false
        },
        {
          "line": 348,
          "old_api": "pop_back",
          "new_api": null,
          "old_text": "Worklist.pop_back()",
          "new_text": null,
          "old_line_content": "    Worklist.pop_back();",
          "new_line_content": "  // inst.",
          "content_same": false
        },
        {
          "line": 353,
          "old_api": "inlineCallsIntoFunction",
          "new_api": null,
          "old_text": "inlineCallsIntoFunction(F)",
          "new_text": null,
          "old_line_content": "    inlineCallsIntoFunction(F);",
          "new_line_content": "    // Do not inline into transparent functions. This is exposing a diagnostics",
          "content_same": false
        },
        {
          "line": 227,
          "old_api": "llvm_unreachable",
          "new_api": null,
          "old_text": "llvm_unreachable(\"not valid in canonical sil\")",
          "new_text": null,
          "old_line_content": "      llvm_unreachable(\"not valid in canonical sil\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 233,
          "old_api": "getName",
          "new_api": null,
          "old_text": "F->getName()",
          "new_text": null,
          "old_line_content": "  DEBUG(llvm::dbgs() << \"  Calculating cost for \" << F->getName() << \".\\n\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 235,
          "old_api": "isTransparent",
          "new_api": null,
          "old_text": "F->isTransparent()",
          "new_text": null,
          "old_line_content": "  if (F->isTransparent() == IsTransparent_t::IsTransparent)",
          "new_line_content": "static unsigned getFunctionCost(SILFunction *F) {",
          "content_same": false
        },
        {
          "line": 241,
          "old_api": "instructionInlineCost",
          "new_api": null,
          "old_text": "instructionInlineCost(I)",
          "new_text": null,
          "old_line_content": "      Cost += unsigned(instructionInlineCost(I));",
          "new_line_content": "  unsigned Cost = 0;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 4,
      "total_additions": 22,
      "total_deletions": 22,
      "total_api_changes": 48
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 7,
        "api_related_lines": 48,
        "non_api_lines": 7,
        "non_api_line_numbers": [
          160,
          161,
          204,
          157,
          221,
          158,
          159
        ]
      }
    },
    "api_calls_before": 72,
    "api_calls_after": 72,
    "diff_info": {
      "added_lines": 5,
      "removed_lines": 2,
      "total_diff_lines": 33
    }
  }
}