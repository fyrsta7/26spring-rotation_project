{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/swift/modified_file/88f323320e0ab62cd31a3e2d67dd65b590fe95ff",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/swift/modified_file/88f323320e0ab62cd31a3e2d67dd65b590fe95ff/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/swift/modified_file/88f323320e0ab62cd31a3e2d67dd65b590fe95ff/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/swift/modified_file/88f323320e0ab62cd31a3e2d67dd65b590fe95ff/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 213,
          "old_api": "getCalleeFromApplyInst",
          "new_api": "llvm::dbgs()",
          "old_text": "getCalleeFromApplyInst(AI)",
          "new_text": "llvm::dbgs()",
          "old_line_content": "    SILFunction *Callee = getCalleeFromApplyInst(AI);",
          "new_line_content": "    DEBUG(llvm::dbgs() << \"  Visiting Apply Inst \" << *AI);",
          "content_same": false
        },
        {
          "line": 250,
          "old_api": "llvm::dbgs()",
          "new_api": "push_back",
          "old_text": "llvm::dbgs()",
          "new_text": "Args.push_back(Arg)",
          "old_line_content": "    DEBUG(llvm::dbgs() << \"    Everything Looks Good! Inlining...\");",
          "new_line_content": "      Args.push_back(Arg);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 269,
          "old_api": null,
          "new_api": "unsigned",
          "old_text": null,
          "new_text": "unsigned(HitCostLimit)",
          "old_line_content": "//===----------------------------------------------------------------------===//",
          "new_line_content": "  NumTimesHitCostLimit += unsigned(HitCostLimit);",
          "content_same": false
        },
        {
          "line": 278,
          "old_api": null,
          "new_api": "llvm::dbgs()",
          "old_text": null,
          "new_text": "llvm::dbgs()",
          "old_line_content": "",
          "new_line_content": "  DEBUG(llvm::dbgs() << \"*** SIL Performance Inlining ***\\n\\n\");",
          "content_same": false
        },
        {
          "line": 284,
          "old_api": null,
          "new_api": "collectApplyInst",
          "old_text": null,
          "new_text": "collectApplyInst(Fn, FunctionToCallMap)",
          "old_line_content": "  std::vector<SILFunction *> Worklist;",
          "new_line_content": "    collectApplyInst(Fn, FunctionToCallMap);",
          "content_same": false
        },
        {
          "line": 288,
          "old_api": null,
          "new_api": "TopDownCallGraphOrder",
          "old_text": null,
          "new_text": "TopDownCallGraphOrder(M, Worklist)",
          "old_line_content": "  // inst.",
          "new_line_content": "  TopDownCallGraphOrder(M, Worklist);",
          "content_same": false
        },
        {
          "line": 292,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "Worklist.size()",
          "old_line_content": "",
          "new_line_content": "  while (Worklist.size()) {",
          "content_same": false
        },
        {
          "line": 293,
          "old_api": null,
          "new_api": "back",
          "old_text": null,
          "new_text": "Worklist.back()",
          "old_line_content": "    // If we have any applies in F, it will have an entry in",
          "new_line_content": "    SILFunction *F = Worklist.back();",
          "content_same": false
        },
        {
          "line": 294,
          "old_api": null,
          "new_api": "pop_back",
          "old_text": null,
          "new_text": "Worklist.pop_back()",
          "old_line_content": "    // FunctionsToCallMap. If it does, attempt to inline those applies.",
          "new_line_content": "    Worklist.pop_back();",
          "content_same": false
        },
        {
          "line": 298,
          "old_api": null,
          "new_api": "count",
          "old_text": null,
          "new_text": "FunctionToCallMap.count(F)",
          "old_line_content": "}",
          "new_line_content": "    if (FunctionToCallMap.count(F))",
          "content_same": false
        },
        {
          "line": 299,
          "old_api": null,
          "new_api": "inlineCallsIntoFunction",
          "old_text": null,
          "new_text": "inlineCallsIntoFunction(F, FunctionToCallMap[F])",
          "old_line_content": "",
          "new_line_content": "      inlineCallsIntoFunction(F, FunctionToCallMap[F]);",
          "content_same": false
        },
        {
          "line": 172,
          "old_api": null,
          "new_api": "isTransparent",
          "old_text": null,
          "new_text": "F->isTransparent()",
          "old_line_content": "  unsigned i = 0;",
          "new_line_content": "  if (F->isTransparent() == IsTransparent_t::IsTransparent)",
          "content_same": false
        },
        {
          "line": 178,
          "old_api": null,
          "new_api": "instructionInlineCost",
          "old_text": null,
          "new_text": "instructionInlineCost(I)",
          "old_line_content": "      // not going to inline this given function, so there is no point in",
          "new_line_content": "      i += instructionInlineCost(I);",
          "content_same": false
        },
        {
          "line": 204,
          "old_api": null,
          "new_api": "functionInlineCost",
          "old_text": null,
          "new_text": "functionInlineCost(F)",
          "old_line_content": "",
          "new_line_content": "  unsigned CurrentCost = functionInlineCost(F);",
          "content_same": false
        },
        {
          "line": 205,
          "old_api": null,
          "new_api": "getName",
          "old_text": null,
          "new_text": "F->getName()",
          "old_line_content": "  bool HitCostLimit = false;",
          "new_line_content": "  DEBUG(llvm::dbgs() << \"Visiting Function: \" << F->getName() << \". Initial \"",
          "content_same": false
        },
        {
          "line": 216,
          "old_api": null,
          "new_api": "getCalleeFromApplyInst",
          "old_text": null,
          "new_text": "getCalleeFromApplyInst(AI)",
          "old_line_content": "",
          "new_line_content": "    SILFunction *Callee = getCalleeFromApplyInst(AI);",
          "content_same": false
        },
        {
          "line": 217,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(Callee && \"We already know at this point that callees are valid for \"\n           \"inlining.\")",
          "old_line_content": "    // If the Callee is F, skip it to prevent circular inlining...",
          "new_line_content": "    assert(Callee && \"We already know at this point that callees are valid for \"",
          "content_same": false
        },
        {
          "line": 222,
          "old_api": null,
          "new_api": "llvm::dbgs()",
          "old_text": null,
          "new_text": "llvm::dbgs()",
          "old_line_content": "",
          "new_line_content": "      DEBUG(llvm::dbgs() << \"    Recursive Call... Skipping...\\n\");",
          "content_same": false
        },
        {
          "line": 227,
          "old_api": null,
          "new_api": "functionInlineCost",
          "old_text": null,
          "new_text": "functionInlineCost(Callee)",
          "old_line_content": "    if (CalleeCost > InlineCostThreshold)",
          "new_line_content": "    unsigned CalleeCost = functionInlineCost(Callee);",
          "content_same": false
        },
        {
          "line": 237,
          "old_api": null,
          "new_api": "llvm::dbgs()",
          "old_text": null,
          "new_text": "llvm::dbgs()",
          "old_line_content": "    // If we would go over our threshold, continue. There may be other functions",
          "new_line_content": "    DEBUG(llvm::dbgs() << \"    Old Cost = \" << CurrentCost << \"; CalleeCost = \"",
          "content_same": false
        },
        {
          "line": 249,
          "old_api": null,
          "new_api": "getArguments",
          "old_text": null,
          "new_text": "AI->getArguments()",
          "old_line_content": "    // Ok, we are within budget. Attempt to inline.",
          "new_line_content": "    for (const auto &Arg : AI->getArguments())",
          "content_same": false
        },
        {
          "line": 253,
          "old_api": null,
          "new_api": "llvm::dbgs()",
          "old_text": null,
          "new_text": "llvm::dbgs()",
          "old_line_content": "",
          "new_line_content": "    DEBUG(llvm::dbgs() << \"    Everything Looks Good! Inlining...\");",
          "content_same": false
        },
        {
          "line": 254,
          "old_api": null,
          "new_api": "inlineFunction",
          "old_text": null,
          "new_text": "Inliner.inlineFunction(SILInliner::InlineKind::PerformanceInline, AI,\n                           Callee, ArrayRef<Substitution>(), Args)",
          "old_line_content": "    // Perform book keeping.",
          "new_line_content": "    Inliner.inlineFunction(SILInliner::InlineKind::PerformanceInline, AI,",
          "content_same": false
        },
        {
          "line": 255,
          "old_api": null,
          "new_api": "ArrayRef<Substitution>()",
          "old_text": null,
          "new_text": "ArrayRef<Substitution>()",
          "old_line_content": "    CurrentCost = NewCost;",
          "new_line_content": "                           Callee, ArrayRef<Substitution>(), Args);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 266,
          "old_api": "unsigned",
          "new_api": null,
          "old_text": "unsigned(HitCostLimit)",
          "new_text": null,
          "old_line_content": "  NumTimesHitCostLimit += unsigned(HitCostLimit);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 275,
          "old_api": "llvm::dbgs()",
          "new_api": null,
          "old_text": "llvm::dbgs()",
          "new_text": null,
          "old_line_content": "  DEBUG(llvm::dbgs() << \"*** SIL Performance Inlining ***\\n\\n\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 281,
          "old_api": "collectApplyInst",
          "new_api": null,
          "old_text": "collectApplyInst(Fn, FunctionToCallMap)",
          "new_text": null,
          "old_line_content": "    collectApplyInst(Fn, FunctionToCallMap);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 285,
          "old_api": "TopDownCallGraphOrder",
          "new_api": null,
          "old_text": "TopDownCallGraphOrder(M, Worklist)",
          "new_text": null,
          "old_line_content": "  TopDownCallGraphOrder(M, Worklist);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 289,
          "old_api": "size",
          "new_api": null,
          "old_text": "Worklist.size()",
          "new_text": null,
          "old_line_content": "  while (Worklist.size()) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 290,
          "old_api": "back",
          "new_api": null,
          "old_text": "Worklist.back()",
          "new_text": null,
          "old_line_content": "    SILFunction *F = Worklist.back();",
          "new_line_content": "  // For each function in the worklist, attempt to inline its list of apply",
          "content_same": false
        },
        {
          "line": 291,
          "old_api": "pop_back",
          "new_api": null,
          "old_text": "Worklist.pop_back()",
          "new_text": null,
          "old_line_content": "    Worklist.pop_back();",
          "new_line_content": "  // inst.",
          "content_same": false
        },
        {
          "line": 295,
          "old_api": "count",
          "new_api": null,
          "old_text": "FunctionToCallMap.count(F)",
          "new_text": null,
          "old_line_content": "    if (FunctionToCallMap.count(F))",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 296,
          "old_api": "inlineCallsIntoFunction",
          "new_api": null,
          "old_text": "inlineCallsIntoFunction(F, FunctionToCallMap[F])",
          "new_text": null,
          "old_line_content": "      inlineCallsIntoFunction(F, FunctionToCallMap[F]);",
          "new_line_content": "    // If we have any applies in F, it will have an entry in",
          "content_same": false
        },
        {
          "line": 175,
          "old_api": "instructionInlineCost",
          "new_api": null,
          "old_text": "instructionInlineCost(I)",
          "new_text": null,
          "old_line_content": "      i += instructionInlineCost(I);",
          "new_line_content": "  unsigned i = 0;",
          "content_same": false
        },
        {
          "line": 201,
          "old_api": "functionInlineCost",
          "new_api": null,
          "old_text": "functionInlineCost(F)",
          "new_text": null,
          "old_line_content": "  unsigned CurrentCost = functionInlineCost(F);",
          "new_line_content": "  SILInliner Inliner(*F);",
          "content_same": false
        },
        {
          "line": 202,
          "old_api": "getName",
          "new_api": null,
          "old_text": "F->getName()",
          "new_text": null,
          "old_line_content": "  DEBUG(llvm::dbgs() << \"Visiting Function: \" << F->getName() << \". Initial \"",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 210,
          "old_api": "llvm::dbgs()",
          "new_api": null,
          "old_text": "llvm::dbgs()",
          "new_text": null,
          "old_line_content": "    DEBUG(llvm::dbgs() << \"  Visiting Apply Inst \" << *AI);",
          "new_line_content": "  // For each apply in our list...",
          "content_same": false
        },
        {
          "line": 214,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(Callee && \"We already know at this point that callees are valid for \"\n           \"inlining.\")",
          "new_text": null,
          "old_line_content": "    assert(Callee && \"We already know at this point that callees are valid for \"",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 219,
          "old_api": "llvm::dbgs()",
          "new_api": null,
          "old_text": "llvm::dbgs()",
          "new_text": null,
          "old_line_content": "      DEBUG(llvm::dbgs() << \"    Recursive Call... Skipping...\\n\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 224,
          "old_api": "functionInlineCost",
          "new_api": null,
          "old_text": "functionInlineCost(Callee)",
          "new_text": null,
          "old_line_content": "    unsigned CalleeCost = functionInlineCost(Callee);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 234,
          "old_api": "llvm::dbgs()",
          "new_api": null,
          "old_text": "llvm::dbgs()",
          "new_text": null,
          "old_line_content": "    DEBUG(llvm::dbgs() << \"    Old Cost = \" << CurrentCost << \"; CalleeCost = \"",
          "new_line_content": "    // caller...",
          "content_same": false
        },
        {
          "line": 246,
          "old_api": "getArguments",
          "new_api": null,
          "old_text": "AI->getArguments()",
          "new_text": null,
          "old_line_content": "    for (const auto &Arg : AI->getArguments())",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 247,
          "old_api": "push_back",
          "new_api": null,
          "old_text": "Args.push_back(Arg)",
          "new_text": null,
          "old_line_content": "      Args.push_back(Arg);",
          "new_line_content": "    // Add the arguments from AI into a SILValue list.",
          "content_same": false
        },
        {
          "line": 251,
          "old_api": "inlineFunction",
          "new_api": null,
          "old_text": "Inliner.inlineFunction(SILInliner::InlineKind::PerformanceInline, AI,\n                           Callee, ArrayRef<Substitution>(), Args)",
          "new_text": null,
          "old_line_content": "    Inliner.inlineFunction(SILInliner::InlineKind::PerformanceInline, AI,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 252,
          "old_api": "ArrayRef<Substitution>()",
          "new_api": null,
          "old_text": "ArrayRef<Substitution>()",
          "new_text": null,
          "old_line_content": "                           Callee, ArrayRef<Substitution>(), Args);",
          "new_line_content": "    // Ok, we are within budget. Attempt to inline.",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 2,
      "total_additions": 22,
      "total_deletions": 21,
      "total_api_changes": 45
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 3,
        "api_related_lines": 45,
        "non_api_lines": 2,
        "non_api_line_numbers": [
          173,
          174
        ]
      }
    },
    "api_calls_before": 55,
    "api_calls_after": 56,
    "diff_info": {
      "added_lines": 3,
      "removed_lines": 0,
      "total_diff_lines": 15
    }
  }
}