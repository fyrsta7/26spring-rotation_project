{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/swift/modified_file/6c8d6a0f45ef858d26946bd7941c0585da9331c5",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/swift/modified_file/6c8d6a0f45ef858d26946bd7941c0585da9331c5/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/swift/modified_file/6c8d6a0f45ef858d26946bd7941c0585da9331c5/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/swift/modified_file/6c8d6a0f45ef858d26946bd7941c0585da9331c5/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 2150,
          "old_api": "getAsTagDecl",
          "new_api": "getClangSema",
          "old_text": "typedefType->getAsTagDecl()",
          "new_text": "nameImporter.getClangSema()",
          "old_line_content": "              typedefType->getAsTagDecl())) {",
          "new_line_content": "  auto &sema = nameImporter.getClangSema();",
          "content_same": false
        },
        {
          "line": 2164,
          "old_api": "getTranslationUnitDecl",
          "new_api": "std::make_unique<SwiftLookupTableWriter>(this, writer, swiftCtx,\n                                                  buffersForDiagnostics,\n                                                  availability)",
          "old_text": "sema.Context.getTranslationUnitDecl()->noload_decls()",
          "new_text": "std::make_unique<SwiftLookupTableWriter>(this, writer, swiftCtx,\n                                                  buffersForDiagnostics,\n                                                  availability)",
          "old_line_content": "  for (auto decl : sema.Context.getTranslationUnitDecl()->noload_decls()) {",
          "new_line_content": "  return std::make_unique<SwiftLookupTableWriter>(this, writer, swiftCtx,",
          "content_same": false
        },
        {
          "line": 2177,
          "old_api": "std::make_unique<SwiftLookupTableWriter>(this, writer, swiftCtx,\n                                                  buffersForDiagnostics,\n                                                  availability)",
          "new_api": "assert",
          "old_text": "std::make_unique<SwiftLookupTableWriter>(this, writer, swiftCtx,\n                                                  buffersForDiagnostics,\n                                                  availability)",
          "new_text": "assert(metadata.MajorVersion == SWIFT_LOOKUP_TABLE_VERSION_MAJOR)",
          "old_line_content": "  return std::make_unique<SwiftLookupTableWriter>(this, writer, swiftCtx,",
          "new_line_content": "  assert(metadata.MajorVersion == SWIFT_LOOKUP_TABLE_VERSION_MAJOR);",
          "content_same": false
        },
        {
          "line": 2207,
          "old_api": "erase",
          "new_api": "std::move(tableReader)",
          "old_text": "lookupTables.erase(moduleName)",
          "new_text": "std::move(tableReader)",
          "old_line_content": "      lookupTables.erase(moduleName);",
          "new_line_content": "  return std::move(tableReader);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 2176,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(metadata.BlockName == \"swift.lookup\")",
          "old_line_content": "SwiftNameLookupExtension::createExtensionWriter(clang::ASTWriter &writer) {",
          "new_line_content": "  assert(metadata.BlockName == \"swift.lookup\");",
          "content_same": false
        },
        {
          "line": 2178,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(metadata.MinorVersion == SWIFT_LOOKUP_TABLE_VERSION_MINOR)",
          "old_line_content": "                                                  buffersForDiagnostics,",
          "new_line_content": "  assert(metadata.MinorVersion == SWIFT_LOOKUP_TABLE_VERSION_MINOR);",
          "content_same": false
        },
        {
          "line": 2151,
          "old_api": null,
          "new_api": "getTranslationUnitDecl",
          "old_text": null,
          "new_text": "sema.Context.getTranslationUnitDecl()->noload_decls()",
          "old_line_content": "        // Adding template instantiation behind typedef as a top-level entry",
          "new_line_content": "  for (auto decl : sema.Context.getTranslationUnitDecl()->noload_decls()) {",
          "content_same": false
        },
        {
          "line": 2152,
          "old_api": null,
          "new_api": "populateTableWithDecl",
          "old_text": null,
          "new_text": "populateTableWithDecl(table, nameImporter, decl)",
          "old_line_content": "        // so the instantiation appears in the API.",
          "new_line_content": "    populateTableWithDecl(table, nameImporter, decl);",
          "content_same": false
        },
        {
          "line": 2156,
          "old_api": null,
          "new_api": "addMacrosToLookupTable",
          "old_text": null,
          "new_text": "addMacrosToLookupTable(table, nameImporter)",
          "old_line_content": "      }",
          "new_line_content": "  addMacrosToLookupTable(table, nameImporter);",
          "content_same": false
        },
        {
          "line": 2159,
          "old_api": null,
          "new_api": "finalizeLookupTable",
          "old_text": null,
          "new_text": "finalizeLookupTable(table, nameImporter, buffersForDiagnostics)",
          "old_line_content": "}",
          "new_line_content": "  finalizeLookupTable(table, nameImporter, buffersForDiagnostics);",
          "content_same": false
        },
        {
          "line": 2194,
          "old_api": null,
          "new_api": "erase",
          "old_text": null,
          "new_text": "lookupTables.erase(moduleName)",
          "old_line_content": "  std::unique_ptr<SwiftLookupTable> *target = nullptr;",
          "new_line_content": "      lookupTables.erase(moduleName);",
          "content_same": false
        },
        {
          "line": 2199,
          "old_api": null,
          "new_api": "SwiftLookupTableReader::create(this, reader, mod, onRemove,\n                                                    stream)",
          "old_text": null,
          "new_text": "SwiftLookupTableReader::create(this, reader, mod, onRemove,\n                                                    stream)",
          "old_line_content": "  } else {",
          "new_line_content": "  auto tableReader = SwiftLookupTableReader::create(this, reader, mod, onRemove,",
          "content_same": false
        },
        {
          "line": 2204,
          "old_api": null,
          "new_api": "get",
          "old_text": null,
          "new_text": "tableReader.get()",
          "old_line_content": "    // Local function used to remove this entry when the reader goes away.",
          "new_line_content": "  target->reset(new SwiftLookupTable(tableReader.get()));",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 2146,
          "old_api": "dyn_cast<clang::TypedefNameDecl>(named)",
          "new_api": null,
          "old_text": "dyn_cast<clang::TypedefNameDecl>(named)",
          "new_text": null,
          "old_line_content": "  if (auto typedefDecl = dyn_cast<clang::TypedefNameDecl>(named)) {",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 2147,
          "old_api": "getUnderlyingType",
          "new_api": null,
          "old_text": "dyn_cast<clang::TemplateSpecializationType>(\n            typedefDecl->getUnderlyingType())",
          "new_text": null,
          "old_line_content": "    if (auto typedefType = dyn_cast<clang::TemplateSpecializationType>(",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2148,
          "old_api": "getUnderlyingType",
          "new_api": null,
          "old_text": "typedefDecl->getUnderlyingType()",
          "new_text": null,
          "old_line_content": "            typedefDecl->getUnderlyingType())) {",
          "new_line_content": "void SwiftLookupTableWriter::populateTable(SwiftLookupTable &table,",
          "content_same": false
        },
        {
          "line": 2149,
          "old_api": "getAsTagDecl",
          "new_api": null,
          "old_text": "dyn_cast<clang::ClassTemplateSpecializationDecl>(\n              typedefType->getAsTagDecl())",
          "new_text": null,
          "old_line_content": "      if (auto CTSD = dyn_cast<clang::ClassTemplateSpecializationDecl>(",
          "new_line_content": "                                           NameImporter &nameImporter) {",
          "content_same": false
        },
        {
          "line": 2212,
          "old_api": "SwiftLookupTableReader::create(this, reader, mod, onRemove,\n                                                    stream)",
          "new_api": null,
          "old_text": "SwiftLookupTableReader::create(this, reader, mod, onRemove,\n                                                    stream)",
          "new_text": null,
          "old_line_content": "  auto tableReader = SwiftLookupTableReader::create(this, reader, mod, onRemove,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2153,
          "old_api": "isa<clang::ClassTemplatePartialSpecializationDecl>(CTSD)",
          "new_api": null,
          "old_text": "isa<clang::ClassTemplatePartialSpecializationDecl>(CTSD)",
          "new_text": null,
          "old_line_content": "        assert(!isa<clang::ClassTemplatePartialSpecializationDecl>(CTSD) &&",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 2217,
          "old_api": "get",
          "new_api": null,
          "old_text": "tableReader.get()",
          "new_text": null,
          "old_line_content": "  target->reset(new SwiftLookupTable(tableReader.get()));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2155,
          "old_api": "addEntryToLookupTable",
          "new_api": null,
          "old_text": "addEntryToLookupTable(table, CTSD, nameImporter)",
          "new_text": null,
          "old_line_content": "        addEntryToLookupTable(table, CTSD, nameImporter);",
          "new_line_content": "  // Add macros to the lookup table.",
          "content_same": false
        },
        {
          "line": 2220,
          "old_api": "std::move(tableReader)",
          "new_api": null,
          "old_text": "std::move(tableReader)",
          "new_text": null,
          "old_line_content": "  return std::move(tableReader);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2189,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(metadata.BlockName == \"swift.lookup\")",
          "new_text": null,
          "old_line_content": "  assert(metadata.BlockName == \"swift.lookup\");",
          "new_line_content": "    if (*target) return nullptr;",
          "content_same": false
        },
        {
          "line": 2190,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(metadata.MajorVersion == SWIFT_LOOKUP_TABLE_VERSION_MAJOR)",
          "new_text": null,
          "old_line_content": "  assert(metadata.MajorVersion == SWIFT_LOOKUP_TABLE_VERSION_MAJOR);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2191,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(metadata.MinorVersion == SWIFT_LOOKUP_TABLE_VERSION_MINOR)",
          "new_text": null,
          "old_line_content": "  assert(metadata.MinorVersion == SWIFT_LOOKUP_TABLE_VERSION_MINOR);",
          "new_line_content": "    // Local function used to remove this entry when the reader goes away.",
          "content_same": false
        },
        {
          "line": 2163,
          "old_api": "getClangSema",
          "new_api": null,
          "old_text": "nameImporter.getClangSema()",
          "new_text": null,
          "old_line_content": "  auto &sema = nameImporter.getClangSema();",
          "new_line_content": "SwiftNameLookupExtension::createExtensionWriter(clang::ASTWriter &writer) {",
          "content_same": false
        },
        {
          "line": 2165,
          "old_api": "populateTableWithDecl",
          "new_api": null,
          "old_text": "populateTableWithDecl(table, nameImporter, decl)",
          "new_text": null,
          "old_line_content": "    populateTableWithDecl(table, nameImporter, decl);",
          "new_line_content": "                                                  buffersForDiagnostics,",
          "content_same": false
        },
        {
          "line": 2169,
          "old_api": "addMacrosToLookupTable",
          "new_api": null,
          "old_text": "addMacrosToLookupTable(table, nameImporter)",
          "new_text": null,
          "old_line_content": "  addMacrosToLookupTable(table, nameImporter);",
          "new_line_content": "std::unique_ptr<clang::ModuleFileExtensionReader>",
          "content_same": false
        },
        {
          "line": 2172,
          "old_api": "finalizeLookupTable",
          "new_api": null,
          "old_text": "finalizeLookupTable(table, nameImporter, buffersForDiagnostics)",
          "new_text": null,
          "old_line_content": "  finalizeLookupTable(table, nameImporter, buffersForDiagnostics);",
          "new_line_content": "    clang::ASTReader &reader, clang::serialization::ModuleFile &mod,",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 4,
      "total_additions": 9,
      "total_deletions": 16,
      "total_api_changes": 29
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 13,
        "api_related_lines": 29,
        "non_api_lines": 5,
        "non_api_line_numbers": [
          2157,
          2161,
          2167,
          2171,
          2173
        ]
      }
    },
    "api_calls_before": 693,
    "api_calls_after": 685,
    "diff_info": {
      "added_lines": 1,
      "removed_lines": 14,
      "total_diff_lines": 45
    }
  }
}