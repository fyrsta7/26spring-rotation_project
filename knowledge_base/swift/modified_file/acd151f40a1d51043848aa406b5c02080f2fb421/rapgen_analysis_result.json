{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/swift/modified_file/acd151f40a1d51043848aa406b5c02080f2fb421",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/swift/modified_file/acd151f40a1d51043848aa406b5c02080f2fb421/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/swift/modified_file/acd151f40a1d51043848aa406b5c02080f2fb421/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/swift/modified_file/acd151f40a1d51043848aa406b5c02080f2fb421/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 119,
          "old_api": "getName",
          "new_api": "hasOneUse",
          "old_text": "F->getName()",
          "new_text": "Op->hasOneUse()",
          "old_line_content": "  DEBUG(llvm::dbgs() << \"  Calculating cost for \" << F->getName() << \".\\n\");",
          "new_line_content": "          Op->hasOneUse())",
          "content_same": false
        },
        {
          "line": 164,
          "old_api": "dyn_cast<ApplyInst>(I++)",
          "new_api": "getName",
          "old_text": "dyn_cast<ApplyInst>(I++)",
          "new_text": "Caller->getName()",
          "old_line_content": "      ApplyInst *AI = dyn_cast<ApplyInst>(I++);",
          "new_line_content": "  DEBUG(llvm::dbgs() << \"Visiting Function: \" << Caller->getName() << \"\\n\");",
          "content_same": false
        },
        {
          "line": 171,
          "old_api": "llvm::dbgs()",
          "new_api": "end",
          "old_text": "llvm::dbgs()",
          "new_text": "BB.end()",
          "old_line_content": "    DEBUG(llvm::dbgs() << \"  Found call site:\" <<  *AI);",
          "new_line_content": "    auto I = BB.begin(), E = BB.end();",
          "content_same": false
        },
        {
          "line": 174,
          "old_api": "getInlinableFunction",
          "new_api": "dyn_cast<ApplyInst>(I++)",
          "old_text": "getInlinableFunction(AI)",
          "new_text": "dyn_cast<ApplyInst>(I++)",
          "old_line_content": "    SILFunction *Callee = getInlinableFunction(AI);",
          "new_line_content": "      ApplyInst *AI = dyn_cast<ApplyInst>(I++);",
          "content_same": false
        },
        {
          "line": 197,
          "old_api": "push_back",
          "new_api": "getFunctionCost",
          "old_text": "Args.push_back(Arg)",
          "new_text": "getFunctionCost(Callee)",
          "old_line_content": "    Args.push_back(Arg);",
          "new_line_content": "    unsigned CalleeCost = getFunctionCost(Callee);",
          "content_same": false
        },
        {
          "line": 200,
          "old_api": "getName",
          "new_api": "llvm::dbgs()",
          "old_text": "Callee->getName()",
          "new_text": "llvm::dbgs()",
          "old_line_content": "    DEBUG(llvm::dbgs() << \"  Inlining \" << Callee->getName() << \" Into \" <<",
          "new_line_content": "      DEBUG(llvm::dbgs() << \"  Budget exceeded.\\n\");",
          "content_same": false
        },
        {
          "line": 207,
          "old_api": "ArrayRef<Substitution>()",
          "new_api": "push_back",
          "old_text": "ArrayRef<Substitution>()",
          "new_text": "Args.push_back(Arg)",
          "old_line_content": "    Inliner.inlineFunction(AI, Callee, ArrayRef<Substitution>(), Args);",
          "new_line_content": "    Args.push_back(Arg);",
          "content_same": false
        },
        {
          "line": 210,
          "old_api": "llvm::dbgs()",
          "new_api": "getName",
          "old_text": "llvm::dbgs()",
          "new_text": "Callee->getName()",
          "old_line_content": "    DEBUG(llvm::dbgs() << \"  Remaining budget \" << InlineBudget << \"\\n\");",
          "new_line_content": "    DEBUG(llvm::dbgs() << \"  Inlining \" << Callee->getName() << \" Into \" <<",
          "content_same": false
        },
        {
          "line": 232,
          "old_api": "size",
          "new_api": "llvm::dbgs()",
          "old_text": "Worklist.size()",
          "new_text": "llvm::dbgs()",
          "old_line_content": "  while (Worklist.size()) {",
          "new_line_content": "    DEBUG(llvm::dbgs() << \"*** The SIL performance Inliner is disabled ***\\n\");",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 129,
          "old_api": null,
          "new_api": "getName",
          "old_text": null,
          "new_text": "F->getName()",
          "old_line_content": "      // If i is greater than the InlineCostThreshold, we already know we are",
          "new_line_content": "  DEBUG(llvm::dbgs() << \"  Calculating cost for \" << F->getName() << \".\\n\");",
          "content_same": false
        },
        {
          "line": 131,
          "old_api": null,
          "new_api": "isTransparent",
          "old_text": null,
          "new_text": "F->isTransparent()",
          "old_line_content": "      // continuing to visit instructions.",
          "new_line_content": "  if (F->isTransparent() == IsTransparent_t::IsTransparent)",
          "content_same": false
        },
        {
          "line": 137,
          "old_api": null,
          "new_api": "instructionInlineCost",
          "old_text": null,
          "new_text": "instructionInlineCost(I)",
          "old_line_content": "  }",
          "new_line_content": "      Cost += instructionInlineCost(I);",
          "content_same": false
        },
        {
          "line": 143,
          "old_api": null,
          "new_api": "llvm::dbgs()",
          "old_text": null,
          "new_text": "llvm::dbgs()",
          "old_line_content": "//===----------------------------------------------------------------------===//",
          "new_line_content": "        DEBUG(llvm::dbgs() << \"  Cost too high.\\n\");",
          "content_same": false
        },
        {
          "line": 149,
          "old_api": null,
          "new_api": "llvm::dbgs()",
          "old_text": null,
          "new_text": "llvm::dbgs()",
          "old_line_content": "static void inlineCallsIntoFunction(SILFunction *Caller) {",
          "new_line_content": "  DEBUG(llvm::dbgs() << \"  Found cost: \" << Cost << \"\\n\");",
          "content_same": false
        },
        {
          "line": 176,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "CallSites.push_back(AI)",
          "old_line_content": "      continue;",
          "new_line_content": "        CallSites.push_back(AI);",
          "content_same": false
        },
        {
          "line": 181,
          "old_api": null,
          "new_api": "llvm::dbgs()",
          "old_text": null,
          "new_text": "llvm::dbgs()",
          "old_line_content": "    if (Callee == Caller) {",
          "new_line_content": "    DEBUG(llvm::dbgs() << \"  Found call site:\" <<  *AI);",
          "content_same": false
        },
        {
          "line": 184,
          "old_api": null,
          "new_api": "getInlinableFunction",
          "old_text": null,
          "new_text": "getInlinableFunction(AI)",
          "old_line_content": "    }",
          "new_line_content": "    SILFunction *Callee = getInlinableFunction(AI);",
          "content_same": false
        },
        {
          "line": 188,
          "old_api": null,
          "new_api": "getName",
          "old_text": null,
          "new_text": "Callee->getName()",
          "old_line_content": "",
          "new_line_content": "    DEBUG(llvm::dbgs() << \"  Found callee:\" <<  Callee->getName() << \".\\n\");",
          "content_same": false
        },
        {
          "line": 192,
          "old_api": null,
          "new_api": "llvm::dbgs()",
          "old_text": null,
          "new_text": "llvm::dbgs()",
          "old_line_content": "    }",
          "new_line_content": "      DEBUG(llvm::dbgs() << \"  Skipping recursive calls.\\n\");",
          "content_same": false
        },
        {
          "line": 206,
          "old_api": null,
          "new_api": "getArguments",
          "old_text": null,
          "new_text": "AI->getArguments()",
          "old_line_content": "    // our next invocation of the inliner.",
          "new_line_content": "    for (const auto &Arg : AI->getArguments())",
          "content_same": false
        },
        {
          "line": 211,
          "old_api": null,
          "new_api": "getName",
          "old_text": null,
          "new_text": "Caller->getName()",
          "old_line_content": "  }",
          "new_line_content": "          Caller->getName() << \"\\n\");",
          "content_same": false
        },
        {
          "line": 217,
          "old_api": null,
          "new_api": "ArrayRef<Substitution>()",
          "old_text": null,
          "new_text": "ArrayRef<Substitution>()",
          "old_line_content": "",
          "new_line_content": "    Inliner.inlineFunction(AI, Callee, ArrayRef<Substitution>(), Args);",
          "content_same": false
        },
        {
          "line": 220,
          "old_api": null,
          "new_api": "llvm::dbgs()",
          "old_text": null,
          "new_text": "llvm::dbgs()",
          "old_line_content": "",
          "new_line_content": "    DEBUG(llvm::dbgs() << \"  Remaining budget \" << InlineBudget << \"\\n\");",
          "content_same": false
        },
        {
          "line": 229,
          "old_api": null,
          "new_api": "llvm::dbgs()",
          "old_text": null,
          "new_text": "llvm::dbgs()",
          "old_line_content": "",
          "new_line_content": "  DEBUG(llvm::dbgs() << \"*** SIL Performance Inlining ***\\n\\n\");",
          "content_same": false
        },
        {
          "line": 238,
          "old_api": null,
          "new_api": "TopDownCallGraphOrder",
          "old_text": null,
          "new_text": "TopDownCallGraphOrder(M, Worklist)",
          "old_line_content": "    // transparent function.",
          "new_line_content": "  TopDownCallGraphOrder(M, Worklist);",
          "content_same": false
        },
        {
          "line": 242,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "Worklist.size()",
          "old_line_content": "",
          "new_line_content": "  while (Worklist.size()) {",
          "content_same": false
        },
        {
          "line": 243,
          "old_api": null,
          "new_api": "back",
          "old_text": null,
          "new_text": "Worklist.back()",
          "old_line_content": "",
          "new_line_content": "    SILFunction *F = Worklist.back();",
          "content_same": false
        },
        {
          "line": 116,
          "old_api": null,
          "new_api": "getOperand",
          "old_text": null,
          "new_text": "I.getOperand(0)",
          "old_line_content": "",
          "new_line_content": "      SILValue Op = I.getOperand(0);",
          "content_same": false
        },
        {
          "line": 117,
          "old_api": null,
          "new_api": "getKind",
          "old_text": null,
          "new_text": "Op->getKind()",
          "old_line_content": "/// \\brief Returns the inlining cost of the function.",
          "new_line_content": "      if ((Op->getKind() == ValueKind::TupleElementAddrInst ||",
          "content_same": false
        },
        {
          "line": 118,
          "old_api": null,
          "new_api": "getKind",
          "old_text": null,
          "new_text": "Op->getKind()",
          "old_line_content": "static unsigned getFunctionCost(SILFunction *F) {",
          "new_line_content": "           Op->getKind() == ValueKind::StructElementAddrInst) &&",
          "content_same": false
        },
        {
          "line": 244,
          "old_api": null,
          "new_api": "pop_back",
          "old_text": null,
          "new_text": "Worklist.pop_back()",
          "old_line_content": "",
          "new_line_content": "    Worklist.pop_back();",
          "content_same": false
        },
        {
          "line": 249,
          "old_api": null,
          "new_api": "inlineCallsIntoFunction",
          "old_text": null,
          "new_text": "inlineCallsIntoFunction(F)",
          "old_line_content": "",
          "new_line_content": "    inlineCallsIntoFunction(F);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 133,
          "old_api": "llvm::dbgs()",
          "new_api": null,
          "old_text": "llvm::dbgs()",
          "new_text": null,
          "old_line_content": "        DEBUG(llvm::dbgs() << \"  Cost too high.\\n\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 139,
          "old_api": "llvm::dbgs()",
          "new_api": null,
          "old_text": "llvm::dbgs()",
          "new_text": null,
          "old_line_content": "  DEBUG(llvm::dbgs() << \"  Found cost: \" << Cost << \"\\n\");",
          "new_line_content": "      // If i is greater than the InlineCostThreshold, we already know we are",
          "content_same": false
        },
        {
          "line": 154,
          "old_api": "getName",
          "new_api": null,
          "old_text": "Caller->getName()",
          "new_text": null,
          "old_line_content": "  DEBUG(llvm::dbgs() << \"Visiting Function: \" << Caller->getName() << \"\\n\");",
          "new_line_content": "//                                  Inliner",
          "content_same": false
        },
        {
          "line": 161,
          "old_api": "end",
          "new_api": null,
          "old_text": "BB.end()",
          "new_text": null,
          "old_line_content": "    auto I = BB.begin(), E = BB.end();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 166,
          "old_api": "push_back",
          "new_api": null,
          "old_text": "CallSites.push_back(AI)",
          "new_text": null,
          "old_line_content": "        CallSites.push_back(AI);",
          "new_line_content": "  llvm::SmallVector<ApplyInst*, 8> CallSites;",
          "content_same": false
        },
        {
          "line": 178,
          "old_api": "getName",
          "new_api": null,
          "old_text": "Callee->getName()",
          "new_text": null,
          "old_line_content": "    DEBUG(llvm::dbgs() << \"  Found callee:\" <<  Callee->getName() << \".\\n\");",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 182,
          "old_api": "llvm::dbgs()",
          "new_api": null,
          "old_text": "llvm::dbgs()",
          "new_text": null,
          "old_line_content": "      DEBUG(llvm::dbgs() << \"  Skipping recursive calls.\\n\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 187,
          "old_api": "getFunctionCost",
          "new_api": null,
          "old_text": "getFunctionCost(Callee)",
          "new_text": null,
          "old_line_content": "    unsigned CalleeCost = getFunctionCost(Callee);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 190,
          "old_api": "llvm::dbgs()",
          "new_api": null,
          "old_text": "llvm::dbgs()",
          "new_text": null,
          "old_line_content": "      DEBUG(llvm::dbgs() << \"  Budget exceeded.\\n\");",
          "new_line_content": "    // Prevent circular inlining.",
          "content_same": false
        },
        {
          "line": 196,
          "old_api": "getArguments",
          "new_api": null,
          "old_text": "AI->getArguments()",
          "new_text": null,
          "old_line_content": "    for (const auto &Arg : AI->getArguments())",
          "new_line_content": "    // Calculate the inlining cost of the callee.",
          "content_same": false
        },
        {
          "line": 201,
          "old_api": "getName",
          "new_api": null,
          "old_text": "Caller->getName()",
          "new_text": null,
          "old_line_content": "          Caller->getName() << \"\\n\");",
          "new_line_content": "      continue;",
          "content_same": false
        },
        {
          "line": 219,
          "old_api": "llvm::dbgs()",
          "new_api": null,
          "old_text": "llvm::dbgs()",
          "new_text": null,
          "old_line_content": "  DEBUG(llvm::dbgs() << \"*** SIL Performance Inlining ***\\n\\n\");",
          "new_line_content": "    InlineBudget -= CalleeCost;",
          "content_same": false
        },
        {
          "line": 222,
          "old_api": "llvm::dbgs()",
          "new_api": null,
          "old_text": "llvm::dbgs()",
          "new_text": null,
          "old_line_content": "    DEBUG(llvm::dbgs() << \"*** The SIL performance Inliner is disabled ***\\n\");",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 228,
          "old_api": "TopDownCallGraphOrder",
          "new_api": null,
          "old_text": "TopDownCallGraphOrder(M, Worklist)",
          "new_text": null,
          "old_line_content": "  TopDownCallGraphOrder(M, Worklist);",
          "new_line_content": "void swift::performSILPerformanceInlining(SILModule *M) {",
          "content_same": false
        },
        {
          "line": 233,
          "old_api": "back",
          "new_api": null,
          "old_text": "Worklist.back()",
          "new_text": null,
          "old_line_content": "    SILFunction *F = Worklist.back();",
          "new_line_content": "    return;",
          "content_same": false
        },
        {
          "line": 234,
          "old_api": "pop_back",
          "new_api": null,
          "old_text": "Worklist.pop_back()",
          "new_text": null,
          "old_line_content": "    Worklist.pop_back();",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 239,
          "old_api": "inlineCallsIntoFunction",
          "new_api": null,
          "old_text": "inlineCallsIntoFunction(F)",
          "new_text": null,
          "old_line_content": "    inlineCallsIntoFunction(F);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 121,
          "old_api": "isTransparent",
          "new_api": null,
          "old_text": "F->isTransparent()",
          "new_text": null,
          "old_line_content": "  if (F->isTransparent() == IsTransparent_t::IsTransparent)",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 127,
          "old_api": "instructionInlineCost",
          "new_api": null,
          "old_text": "instructionInlineCost(I)",
          "new_text": null,
          "old_line_content": "      Cost += instructionInlineCost(I);",
          "new_line_content": "/// \\brief Returns the inlining cost of the function.",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 9,
      "total_additions": 23,
      "total_deletions": 19,
      "total_api_changes": 51
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 10,
        "api_related_lines": 51,
        "non_api_lines": 5,
        "non_api_line_numbers": [
          112,
          113,
          114,
          115,
          120
        ]
      }
    },
    "api_calls_before": 68,
    "api_calls_after": 72,
    "diff_info": {
      "added_lines": 10,
      "removed_lines": 0,
      "total_diff_lines": 22
    }
  }
}