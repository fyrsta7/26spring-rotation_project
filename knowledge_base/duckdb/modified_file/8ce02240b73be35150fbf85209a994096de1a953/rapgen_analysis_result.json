{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/duckdb/modified_file/8ce02240b73be35150fbf85209a994096de1a953",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/duckdb/modified_file/8ce02240b73be35150fbf85209a994096de1a953/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/duckdb/modified_file/8ce02240b73be35150fbf85209a994096de1a953/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/duckdb/modified_file/8ce02240b73be35150fbf85209a994096de1a953/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 197,
          "old_api": "size",
          "new_api": "ProbeHashTable",
          "old_text": "state->cached_chunk.size()",
          "new_text": "ProbeHashTable(context, chunk, state)",
          "old_line_content": "\t\t\tif (state->cached_chunk.size() > 0) {",
          "new_line_content": "\t\tProbeHashTable(context, chunk, state);",
          "content_same": false
        },
        {
          "line": 200,
          "old_api": "Reset",
          "new_api": "size",
          "old_text": "state->cached_chunk.Reset()",
          "new_text": "state->cached_chunk.size()",
          "old_line_content": "\t\t\t\tstate->cached_chunk.Reset();",
          "new_line_content": "\t\t\tif (state->cached_chunk.size() > 0) {",
          "content_same": false
        },
        {
          "line": 203,
          "old_api": "IsRightOuterJoin",
          "new_api": "Reset",
          "old_text": "IsRightOuterJoin(join_type)",
          "new_text": "state->cached_chunk.Reset()",
          "old_line_content": "\t\t\t    if (IsRightOuterJoin(join_type)) {",
          "new_line_content": "\t\t\t\tstate->cached_chunk.Reset();",
          "content_same": false
        },
        {
          "line": 215,
          "old_api": "Reference",
          "new_api": "Append",
          "old_text": "chunk.Reference(state->cached_chunk)",
          "new_text": "state->cached_chunk.Append(chunk)",
          "old_line_content": "\t\t\t\t\tchunk.Reference(state->cached_chunk);",
          "new_line_content": "\t\t\t\tstate->cached_chunk.Append(chunk);",
          "content_same": false
        },
        {
          "line": 216,
          "old_api": "Reset",
          "new_api": "size",
          "old_text": "state->cached_chunk.Reset()",
          "new_text": "state->cached_chunk.size()",
          "old_line_content": "\t\t\t\t\tstate->cached_chunk.Reset();",
          "new_line_content": "\t\t\t\tif (state->cached_chunk.size() >= (STANDARD_VECTOR_SIZE - 64)) {",
          "content_same": false
        },
        {
          "line": 237,
          "old_api": "size",
          "new_api": "reinterpret_cast<PhysicalHashJoinState *>(state_p)",
          "old_text": "state->child_chunk.size()",
          "new_text": "reinterpret_cast<PhysicalHashJoinState *>(state_p)",
          "old_line_content": "\tif (state->child_chunk.size() > 0 && state->scan_structure) {",
          "new_line_content": "\tauto state = reinterpret_cast<PhysicalHashJoinState *>(state_p);",
          "content_same": false
        },
        {
          "line": 240,
          "old_api": "Next",
          "new_api": "size",
          "old_text": "state->scan_structure->Next(state->join_keys, state->child_chunk, chunk)",
          "new_text": "state->child_chunk.size()",
          "old_line_content": "\t\tstate->scan_structure->Next(state->join_keys, state->child_chunk, chunk);",
          "new_line_content": "\tif (state->child_chunk.size() > 0 && state->scan_structure) {",
          "content_same": false
        },
        {
          "line": 262,
          "old_api": "Probe",
          "new_api": "Execute",
          "old_text": "sink.hash_table->Probe(state->join_keys)",
          "new_text": "state->probe_executor.Execute(state->child_chunk, state->join_keys)",
          "old_line_content": "\t\tstate->scan_structure = sink.hash_table->Probe(state->join_keys);",
          "new_line_content": "\t\tstate->probe_executor.Execute(state->child_chunk, state->join_keys);",
          "content_same": false
        },
        {
          "line": 267,
          "old_api": "reinterpret_cast<PhysicalHashJoinState &>(state)",
          "new_api": "size",
          "old_text": "reinterpret_cast<PhysicalHashJoinState &>(state)",
          "new_text": "chunk.size()",
          "old_line_content": "\tauto &state_p = reinterpret_cast<PhysicalHashJoinState &>(state);",
          "new_line_content": "\t} while (chunk.size() == 0);",
          "content_same": false
        },
        {
          "line": 270,
          "old_api": "FinalizeOperatorState",
          "new_api": "reinterpret_cast<PhysicalHashJoinState &>(state)",
          "old_text": "children[0]->FinalizeOperatorState(*state.child_state, context)",
          "new_text": "reinterpret_cast<PhysicalHashJoinState &>(state)",
          "old_line_content": "\t\tchildren[0]->FinalizeOperatorState(*state.child_state, context);",
          "new_line_content": "\tauto &state_p = reinterpret_cast<PhysicalHashJoinState &>(state);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 257,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "sink.hash_table->size()",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\tif (sink.hash_table->size() == 0) {",
          "content_same": false
        },
        {
          "line": 258,
          "old_api": null,
          "new_api": "ConstructEmptyJoinResult",
          "old_text": null,
          "new_text": "ConstructEmptyJoinResult(sink.hash_table->join_type, sink.hash_table->has_null, state->child_chunk, chunk)",
          "old_line_content": "\t\t// resolve the join keys for the left chunk",
          "new_line_content": "\t\t\tConstructEmptyJoinResult(sink.hash_table->join_type, sink.hash_table->has_null, state->child_chunk, chunk);",
          "content_same": false
        },
        {
          "line": 265,
          "old_api": null,
          "new_api": "Probe",
          "old_text": null,
          "new_text": "sink.hash_table->Probe(state->join_keys)",
          "old_line_content": "}",
          "new_line_content": "\t\tstate->scan_structure = sink.hash_table->Probe(state->join_keys);",
          "content_same": false
        },
        {
          "line": 266,
          "old_api": null,
          "new_api": "Next",
          "old_text": null,
          "new_text": "state->scan_structure->Next(state->join_keys, state->child_chunk, chunk)",
          "old_line_content": "void PhysicalHashJoin::FinalizeOperatorState(PhysicalOperatorState &state, ExecutionContext &context) {",
          "new_line_content": "\t\tstate->scan_structure->Next(state->join_keys, state->child_chunk, chunk);",
          "content_same": false
        },
        {
          "line": 271,
          "old_api": null,
          "new_api": "Flush",
          "old_text": null,
          "new_text": "context.thread.profiler.Flush(this, &state_p.probe_executor, \"probe_executor\", 0)",
          "old_line_content": "\t}",
          "new_line_content": "\tcontext.thread.profiler.Flush(this, &state_p.probe_executor, \"probe_executor\", 0);",
          "content_same": false
        },
        {
          "line": 272,
          "old_api": null,
          "new_api": "empty",
          "old_text": null,
          "new_text": "children.empty()",
          "old_line_content": "}",
          "new_line_content": "\tif (!children.empty() && state.child_state) {",
          "content_same": false
        },
        {
          "line": 273,
          "old_api": null,
          "new_api": "FinalizeOperatorState",
          "old_text": null,
          "new_text": "children[0]->FinalizeOperatorState(*state.child_state, context)",
          "old_line_content": "void PhysicalHashJoin::Combine(ExecutionContext &context, GlobalOperatorState &gstate, LocalSinkState &lstate) {",
          "new_line_content": "\t\tchildren[0]->FinalizeOperatorState(*state.child_state, context);",
          "content_same": false
        },
        {
          "line": 278,
          "old_api": null,
          "new_api": "Flush",
          "old_text": null,
          "new_text": "context.thread.profiler.Flush(this, &state.build_executor, \"build_executor\", 1)",
          "old_line_content": "",
          "new_line_content": "\tcontext.thread.profiler.Flush(this, &state.build_executor, \"build_executor\", 1);",
          "content_same": false
        },
        {
          "line": 279,
          "old_api": null,
          "new_api": "Flush",
          "old_text": null,
          "new_text": "context.client.profiler->Flush(context.thread.profiler)",
          "old_line_content": "} // namespace duckdb",
          "new_line_content": "\tcontext.client.profiler->Flush(context.thread.profiler);",
          "content_same": false
        },
        {
          "line": 192,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "sink.hash_table->size()",
          "old_line_content": "\t}",
          "new_line_content": "\tif (sink.hash_table->size() == 0 && join_is_inner_right_semi) {",
          "content_same": false
        },
        {
          "line": 198,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "chunk.size()",
          "old_line_content": "\t\t\t\t// finished probing but cached data remains, return cached chunk",
          "new_line_content": "\t\tif (chunk.size() == 0) {",
          "content_same": false
        },
        {
          "line": 202,
          "old_api": null,
          "new_api": "Reference",
          "old_text": null,
          "new_text": "chunk.Reference(state->cached_chunk)",
          "old_line_content": "#endif",
          "new_line_content": "\t\t\t\tchunk.Reference(state->cached_chunk);",
          "content_same": false
        },
        {
          "line": 206,
          "old_api": null,
          "new_api": "IsRightOuterJoin",
          "old_text": null,
          "new_text": "IsRightOuterJoin(join_type)",
          "old_line_content": "\t\t\t}",
          "new_line_content": "\t\t\t    if (IsRightOuterJoin(join_type)) {",
          "content_same": false
        },
        {
          "line": 208,
          "old_api": null,
          "new_api": "ScanFullOuter",
          "old_text": null,
          "new_text": "sink.hash_table->ScanFullOuter(chunk, sink.ht_scan_state)",
          "old_line_content": "\t\t} else {",
          "new_line_content": "\t\t\t\tsink.hash_table->ScanFullOuter(chunk, sink.ht_scan_state);",
          "content_same": false
        },
        {
          "line": 218,
          "old_api": null,
          "new_api": "Reference",
          "old_text": null,
          "new_text": "chunk.Reference(state->cached_chunk)",
          "old_line_content": "\t\t\t\t} else {",
          "new_line_content": "\t\t\t\t\tchunk.Reference(state->cached_chunk);",
          "content_same": false
        },
        {
          "line": 219,
          "old_api": null,
          "new_api": "Reset",
          "old_text": null,
          "new_text": "state->cached_chunk.Reset()",
          "old_line_content": "\t\t\t\t\t// chunk cache not full: probe again",
          "new_line_content": "\t\t\t\t\tstate->cached_chunk.Reset();",
          "content_same": false
        },
        {
          "line": 223,
          "old_api": null,
          "new_api": "Reset",
          "old_text": null,
          "new_text": "chunk.Reset()",
          "old_line_content": "\t\t\t\treturn;",
          "new_line_content": "\t\t\t\t\tchunk.Reset();",
          "content_same": false
        },
        {
          "line": 243,
          "old_api": null,
          "new_api": "Next",
          "old_text": null,
          "new_text": "state->scan_structure->Next(state->join_keys, state->child_chunk, chunk)",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\tstate->scan_structure->Next(state->join_keys, state->child_chunk, chunk);",
          "content_same": false
        },
        {
          "line": 244,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "chunk.size()",
          "old_line_content": "\t\tstate->scan_structure = nullptr;",
          "new_line_content": "\t\tif (chunk.size() > 0) {",
          "content_same": false
        },
        {
          "line": 253,
          "old_api": null,
          "new_api": "get",
          "old_text": null,
          "new_text": "state->child_state.get()",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\tchildren[0]->GetChunk(context, state->child_chunk, state->child_state.get());",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 259,
          "old_api": "Execute",
          "new_api": null,
          "old_text": "state->probe_executor.Execute(state->child_chunk, state->join_keys)",
          "new_text": null,
          "old_line_content": "\t\tstate->probe_executor.Execute(state->child_chunk, state->join_keys);",
          "new_line_content": "\t\t\treturn;",
          "content_same": false
        },
        {
          "line": 263,
          "old_api": "Next",
          "new_api": null,
          "old_text": "state->scan_structure->Next(state->join_keys, state->child_chunk, chunk)",
          "new_text": null,
          "old_line_content": "\t\tstate->scan_structure->Next(state->join_keys, state->child_chunk, chunk);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 264,
          "old_api": "size",
          "new_api": null,
          "old_text": "chunk.size()",
          "new_text": null,
          "old_line_content": "\t} while (chunk.size() == 0);",
          "new_line_content": "\t\t// perform the actual probe",
          "content_same": false
        },
        {
          "line": 268,
          "old_api": "Flush",
          "new_api": null,
          "old_text": "context.thread.profiler.Flush(this, &state_p.probe_executor, \"probe_executor\", 0)",
          "new_text": null,
          "old_line_content": "\tcontext.thread.profiler.Flush(this, &state_p.probe_executor, \"probe_executor\", 0);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 269,
          "old_api": "empty",
          "new_api": null,
          "old_text": "children.empty()",
          "new_text": null,
          "old_line_content": "\tif (!children.empty() && state.child_state) {",
          "new_line_content": "void PhysicalHashJoin::FinalizeOperatorState(PhysicalOperatorState &state, ExecutionContext &context) {",
          "content_same": false
        },
        {
          "line": 275,
          "old_api": "Flush",
          "new_api": null,
          "old_text": "context.thread.profiler.Flush(this, &state.build_executor, \"build_executor\", 1)",
          "new_text": null,
          "old_line_content": "\tcontext.thread.profiler.Flush(this, &state.build_executor, \"build_executor\", 1);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 276,
          "old_api": "Flush",
          "new_api": null,
          "old_text": "context.client.profiler->Flush(context.thread.profiler)",
          "new_text": null,
          "old_line_content": "\tcontext.client.profiler->Flush(context.thread.profiler);",
          "new_line_content": "void PhysicalHashJoin::Combine(ExecutionContext &context, GlobalOperatorState &gstate, LocalSinkState &lstate) {",
          "content_same": false
        },
        {
          "line": 188,
          "old_api": "size",
          "new_api": null,
          "old_text": "sink.hash_table->size()",
          "new_text": null,
          "old_line_content": "\tif (sink.hash_table->size() == 0 &&",
          "new_line_content": "\tbool join_is_inner_right_semi =",
          "content_same": false
        },
        {
          "line": 194,
          "old_api": "ProbeHashTable",
          "new_api": null,
          "old_text": "ProbeHashTable(context, chunk, state)",
          "new_text": null,
          "old_line_content": "\t\tProbeHashTable(context, chunk, state);",
          "new_line_content": "\t\treturn;",
          "content_same": false
        },
        {
          "line": 195,
          "old_api": "size",
          "new_api": null,
          "old_text": "chunk.size()",
          "new_text": null,
          "old_line_content": "\t\tif (chunk.size() == 0) {",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 199,
          "old_api": "Reference",
          "new_api": null,
          "old_text": "chunk.Reference(state->cached_chunk)",
          "new_text": null,
          "old_line_content": "\t\t\t\tchunk.Reference(state->cached_chunk);",
          "new_line_content": "#if STANDARD_VECTOR_SIZE >= 128",
          "content_same": false
        },
        {
          "line": 205,
          "old_api": "ScanFullOuter",
          "new_api": null,
          "old_text": "sink.hash_table->ScanFullOuter(chunk, sink.ht_scan_state)",
          "new_text": null,
          "old_line_content": "\t\t\t\tsink.hash_table->ScanFullOuter(chunk, sink.ht_scan_state);",
          "new_line_content": "#endif",
          "content_same": false
        },
        {
          "line": 210,
          "old_api": "size",
          "new_api": null,
          "old_text": "chunk.size()",
          "new_text": null,
          "old_line_content": "\t\t\tif (chunk.size() < 64) {",
          "new_line_content": "\t\t\treturn;",
          "content_same": false
        },
        {
          "line": 212,
          "old_api": "Append",
          "new_api": null,
          "old_text": "state->cached_chunk.Append(chunk)",
          "new_text": null,
          "old_line_content": "\t\t\t\tstate->cached_chunk.Append(chunk);",
          "new_line_content": "#if STANDARD_VECTOR_SIZE >= 128",
          "content_same": false
        },
        {
          "line": 220,
          "old_api": "Reset",
          "new_api": null,
          "old_text": "chunk.Reset()",
          "new_text": null,
          "old_line_content": "\t\t\t\t\tchunk.Reset();",
          "new_line_content": "\t\t\t\t\treturn;",
          "content_same": false
        },
        {
          "line": 234,
          "old_api": "reinterpret_cast<PhysicalHashJoinState *>(state_p)",
          "new_api": null,
          "old_text": "reinterpret_cast<PhysicalHashJoinState *>(state_p)",
          "new_text": null,
          "old_line_content": "\tauto state = reinterpret_cast<PhysicalHashJoinState *>(state_p);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 241,
          "old_api": "size",
          "new_api": null,
          "old_text": "chunk.size()",
          "new_text": null,
          "old_line_content": "\t\tif (chunk.size() > 0) {",
          "new_line_content": "\t\t// still have elements remaining from the previous probe (i.e. we got",
          "content_same": false
        },
        {
          "line": 250,
          "old_api": "get",
          "new_api": null,
          "old_text": "state->child_state.get()",
          "new_text": null,
          "old_line_content": "\t\tchildren[0]->GetChunk(context, state->child_chunk, state->child_state.get());",
          "new_line_content": "\t// probe the HT",
          "content_same": false
        },
        {
          "line": 251,
          "old_api": "size",
          "new_api": null,
          "old_text": "state->child_chunk.size()",
          "new_text": null,
          "old_line_content": "\t\tif (state->child_chunk.size() == 0) {",
          "new_line_content": "\tdo {",
          "content_same": false
        },
        {
          "line": 255,
          "old_api": "ConstructEmptyJoinResult",
          "new_api": null,
          "old_text": "ConstructEmptyJoinResult(sink.hash_table->join_type, sink.hash_table->has_null, state->child_chunk, chunk)",
          "new_text": null,
          "old_line_content": "\t\t\tConstructEmptyJoinResult(sink.hash_table->join_type, sink.hash_table->has_null, state->child_chunk, chunk);",
          "new_line_content": "\t\t\treturn;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 10,
      "total_additions": 20,
      "total_deletions": 20,
      "total_api_changes": 50
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 9,
        "api_related_lines": 50,
        "non_api_lines": 4,
        "non_api_line_numbers": [
          193,
          204,
          196,
          191
        ]
      }
    },
    "api_calls_before": 103,
    "api_calls_after": 103,
    "diff_info": {
      "added_lines": 7,
      "removed_lines": 4,
      "total_diff_lines": 37
    }
  }
}