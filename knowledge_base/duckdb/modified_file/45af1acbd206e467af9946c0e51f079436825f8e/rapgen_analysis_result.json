{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/duckdb/modified_file/45af1acbd206e467af9946c0e51f079436825f8e",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/duckdb/modified_file/45af1acbd206e467af9946c0e51f079436825f8e/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/duckdb/modified_file/45af1acbd206e467af9946c0e51f079436825f8e/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/duckdb/modified_file/45af1acbd206e467af9946c0e51f079436825f8e/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 326,
          "old_api": "AggregateInit",
          "new_api": "Initialize",
          "old_text": "AggregateInit()",
          "new_text": "statel.Initialize(false, level_size)",
          "old_line_content": "\t\t\tAggregateInit();",
          "new_line_content": "\t\t\tstatel.Initialize(false, level_size);",
          "content_same": false
        },
        {
          "line": 344,
          "old_api": "size",
          "new_api": "get",
          "old_text": "levels_flat_start.size()",
          "new_text": "levels_flat_native.get()",
          "old_line_content": "\tif (levels_flat_start.size() > 1) {",
          "new_line_content": "\t\taggr.function.initialize(levels_flat_native.get());",
          "content_same": false
        },
        {
          "line": 359,
          "old_api": "Allocator::DefaultAllocator()",
          "new_api": "data",
          "old_text": "Allocator::DefaultAllocator()",
          "new_text": "state.data()",
          "old_line_content": "\t\tAggregateInputData aggr_input_data(aggr.GetFunctionData(), Allocator::DefaultAllocator());",
          "new_line_content": "\t\taggr.function.window(input_ref->data.data(), filter_mask, aggr_input_data, inputs.ColumnCount(), state.data(),",
          "content_same": false
        },
        {
          "line": 368,
          "old_api": "UseCombineAPI",
          "new_api": "WindowSegmentValue",
          "old_text": "UseCombineAPI()",
          "new_text": "WindowSegmentValue(0, begin, end)",
          "old_line_content": "\tif (!aggr.function.combine || !UseCombineAPI()) {",
          "new_line_content": "\t\tWindowSegmentValue(0, begin, end);",
          "content_same": false
        },
        {
          "line": 369,
          "old_api": "WindowSegmentValue",
          "new_api": "AggegateFinal",
          "old_text": "WindowSegmentValue(0, begin, end)",
          "new_text": "AggegateFinal(result, rid)",
          "old_line_content": "\t\tWindowSegmentValue(0, begin, end);",
          "new_line_content": "\t\tAggegateFinal(result, rid);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 352,
          "old_api": null,
          "new_api": "UseWindowAPI",
          "old_text": null,
          "new_text": "UseWindowAPI()",
          "old_line_content": "\t// If we have a window function, use that",
          "new_line_content": "\tif (aggr.function.window && UseWindowAPI()) {",
          "content_same": false
        },
        {
          "line": 355,
          "old_api": null,
          "new_api": "FrameBounds",
          "old_text": null,
          "new_text": "FrameBounds(begin, end)",
          "old_line_content": "\t\tauto prev = frame;",
          "new_line_content": "\t\tframe = FrameBounds(begin, end);",
          "content_same": false
        },
        {
          "line": 387,
          "old_api": null,
          "new_api": "WindowSegmentValue",
          "old_text": null,
          "new_text": "WindowSegmentValue(l_idx, group_end, end)",
          "old_line_content": "\t\tif (end != group_end) {",
          "new_line_content": "\t\t\tWindowSegmentValue(l_idx, group_end, end);",
          "content_same": false
        },
        {
          "line": 358,
          "old_api": null,
          "new_api": "Allocator::DefaultAllocator()",
          "old_text": null,
          "new_text": "Allocator::DefaultAllocator()",
          "old_line_content": "\t\t// Extract the range",
          "new_line_content": "\t\tAggregateInputData aggr_input_data(aggr.GetFunctionData(), Allocator::DefaultAllocator());",
          "content_same": false
        },
        {
          "line": 393,
          "old_api": null,
          "new_api": "AggegateFinal",
          "old_text": null,
          "new_text": "AggegateFinal(result, rid)",
          "old_line_content": "",
          "new_line_content": "\tAggegateFinal(result, rid);",
          "content_same": false
        },
        {
          "line": 330,
          "old_api": null,
          "new_api": "AggregateInit",
          "old_text": null,
          "new_text": "AggregateInit()",
          "old_line_content": "",
          "new_line_content": "\t\t\tAggregateInit();",
          "content_same": false
        },
        {
          "line": 331,
          "old_api": null,
          "new_api": "MinValue",
          "old_text": null,
          "new_text": "MinValue(level_size, pos + TREE_FANOUT)",
          "old_line_content": "\t\t\tlevels_flat_offset++;",
          "new_line_content": "\t\t\tWindowSegmentValue(level_current, pos, MinValue(level_size, pos + TREE_FANOUT));",
          "content_same": false
        },
        {
          "line": 364,
          "old_api": null,
          "new_api": "AggregateInit",
          "old_text": null,
          "new_text": "AggregateInit()",
          "old_line_content": "",
          "new_line_content": "\tAggregateInit();",
          "content_same": false
        },
        {
          "line": 333,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "state.size()",
          "old_line_content": "",
          "new_line_content": "\t\t\tmemcpy(levels_flat_native.get() + (levels_flat_offset * state.size()), state.data(), state.size());",
          "content_same": false
        },
        {
          "line": 367,
          "old_api": null,
          "new_api": "UseCombineAPI",
          "old_text": null,
          "new_text": "UseCombineAPI()",
          "old_line_content": "\t// Aggregate everything at once if we can't combine states",
          "new_line_content": "\tif (!aggr.function.combine || !UseCombineAPI()) {",
          "content_same": false
        },
        {
          "line": 338,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "levels_flat_start.push_back(levels_flat_offset)",
          "old_line_content": "\t// Corner case: single element in the window",
          "new_line_content": "\t\tlevels_flat_start.push_back(levels_flat_offset);",
          "content_same": false
        },
        {
          "line": 373,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "levels_flat_start.size()",
          "old_line_content": "",
          "new_line_content": "\tfor (idx_t l_idx = 0; l_idx < levels_flat_start.size() + 1; l_idx++) {",
          "content_same": false
        },
        {
          "line": 377,
          "old_api": null,
          "new_api": "WindowSegmentValue",
          "old_text": null,
          "new_text": "WindowSegmentValue(l_idx, begin, end)",
          "old_line_content": "\t\tif (parent_begin == parent_end) {",
          "new_line_content": "\t\t\tWindowSegmentValue(l_idx, begin, end);",
          "content_same": false
        },
        {
          "line": 349,
          "old_api": null,
          "new_api": "D_ASSERT",
          "old_text": null,
          "new_text": "D_ASSERT(input_ref)",
          "old_line_content": "void WindowSegmentTree::Compute(Vector &result, idx_t rid, idx_t begin, idx_t end) {",
          "new_line_content": "\tD_ASSERT(input_ref);",
          "content_same": false
        },
        {
          "line": 382,
          "old_api": null,
          "new_api": "WindowSegmentValue",
          "old_text": null,
          "new_text": "WindowSegmentValue(l_idx, begin, group_begin + TREE_FANOUT)",
          "old_line_content": "\t\tif (begin != group_begin) {",
          "new_line_content": "\t\t\tWindowSegmentValue(l_idx, begin, group_begin + TREE_FANOUT);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 353,
          "old_api": "UseWindowAPI",
          "new_api": null,
          "old_text": "UseWindowAPI()",
          "new_text": null,
          "old_line_content": "\tif (aggr.function.window && UseWindowAPI()) {",
          "new_line_content": "\t\t// Frame boundaries",
          "content_same": false
        },
        {
          "line": 356,
          "old_api": "FrameBounds",
          "new_api": null,
          "old_text": "FrameBounds(begin, end)",
          "new_text": null,
          "old_line_content": "\t\tframe = FrameBounds(begin, end);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 388,
          "old_api": "WindowSegmentValue",
          "new_api": null,
          "old_text": "WindowSegmentValue(l_idx, group_end, end)",
          "new_text": null,
          "old_line_content": "\t\t\tWindowSegmentValue(l_idx, group_end, end);",
          "new_line_content": "\t\t}",
          "content_same": false
        },
        {
          "line": 327,
          "old_api": "MinValue",
          "new_api": null,
          "old_text": "MinValue(level_size, pos + TREE_FANOUT)",
          "new_text": null,
          "old_line_content": "\t\t\tWindowSegmentValue(level_current, pos, MinValue(level_size, pos + TREE_FANOUT));",
          "new_line_content": "\t\t}",
          "content_same": false
        },
        {
          "line": 360,
          "old_api": "data",
          "new_api": null,
          "old_text": "state.data()",
          "new_text": null,
          "old_line_content": "\t\taggr.function.window(input_ref->data.data(), filter_mask, aggr_input_data, inputs.ColumnCount(), state.data(),",
          "new_line_content": "\t\t                     frame, prev, result, rid, 0);",
          "content_same": false
        },
        {
          "line": 329,
          "old_api": "size",
          "new_api": null,
          "old_text": "state.size()",
          "new_text": null,
          "old_line_content": "\t\t\tmemcpy(levels_flat_native.get() + (levels_flat_offset * state.size()), state.data(), state.size());",
          "new_line_content": "\t\t\t// compute the aggregate for this entry in the segment tree",
          "content_same": false
        },
        {
          "line": 394,
          "old_api": "AggegateFinal",
          "new_api": null,
          "old_text": "AggegateFinal(result, rid)",
          "new_text": null,
          "old_line_content": "\tAggegateFinal(result, rid);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 365,
          "old_api": "AggregateInit",
          "new_api": null,
          "old_text": "AggregateInit()",
          "new_text": null,
          "old_line_content": "\tAggregateInit();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 334,
          "old_api": "push_back",
          "new_api": null,
          "old_text": "levels_flat_start.push_back(levels_flat_offset)",
          "new_text": null,
          "old_line_content": "\t\tlevels_flat_start.push_back(levels_flat_offset);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 370,
          "old_api": "AggegateFinal",
          "new_api": null,
          "old_text": "AggegateFinal(result, rid)",
          "new_text": null,
          "old_line_content": "\t\tAggegateFinal(result, rid);",
          "new_line_content": "\t\treturn;",
          "content_same": false
        },
        {
          "line": 340,
          "old_api": "get",
          "new_api": null,
          "old_text": "levels_flat_native.get()",
          "new_text": null,
          "old_line_content": "\t\taggr.function.initialize(levels_flat_native.get());",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 374,
          "old_api": "size",
          "new_api": null,
          "old_text": "levels_flat_start.size()",
          "new_text": null,
          "old_line_content": "\tfor (idx_t l_idx = 0; l_idx < levels_flat_start.size() + 1; l_idx++) {",
          "new_line_content": "\t\tidx_t parent_begin = begin / TREE_FANOUT;",
          "content_same": false
        },
        {
          "line": 345,
          "old_api": "Initialize",
          "new_api": null,
          "old_text": "statel.Initialize(false, levels_flat_start[1] - levels_flat_start[0])",
          "new_text": null,
          "old_line_content": "\t\tstatel.Initialize(false, levels_flat_start[1] - levels_flat_start[0]);",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 378,
          "old_api": "WindowSegmentValue",
          "new_api": null,
          "old_text": "WindowSegmentValue(l_idx, begin, end)",
          "new_text": null,
          "old_line_content": "\t\t\tWindowSegmentValue(l_idx, begin, end);",
          "new_line_content": "\t\t\tbreak;",
          "content_same": false
        },
        {
          "line": 350,
          "old_api": "D_ASSERT",
          "new_api": null,
          "old_text": "D_ASSERT(input_ref)",
          "new_text": null,
          "old_line_content": "\tD_ASSERT(input_ref);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 383,
          "old_api": "WindowSegmentValue",
          "new_api": null,
          "old_text": "WindowSegmentValue(l_idx, begin, group_begin + TREE_FANOUT)",
          "new_text": null,
          "old_line_content": "\t\t\tWindowSegmentValue(l_idx, begin, group_begin + TREE_FANOUT);",
          "new_line_content": "\t\t\tparent_begin++;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 5,
      "total_additions": 15,
      "total_deletions": 16,
      "total_api_changes": 36
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 9,
        "api_related_lines": 36,
        "non_api_lines": 5,
        "non_api_line_numbers": [
          324,
          325,
          342,
          343,
          346
        ]
      }
    },
    "api_calls_before": 167,
    "api_calls_after": 166,
    "diff_info": {
      "added_lines": 4,
      "removed_lines": 5,
      "total_diff_lines": 28
    }
  }
}