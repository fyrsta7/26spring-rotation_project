{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/duckdb/modified_file/6a099fdb8fb397b9ba3d5a7914460e2f5085018e",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/duckdb/modified_file/6a099fdb8fb397b9ba3d5a7914460e2f5085018e/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/duckdb/modified_file/6a099fdb8fb397b9ba3d5a7914460e2f5085018e/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/duckdb/modified_file/6a099fdb8fb397b9ba3d5a7914460e2f5085018e/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 385,
          "old_api": "size",
          "new_api": "Append",
          "old_text": "types.size()",
          "new_text": "collection->Append(chunk_p)",
          "old_line_content": "\t\tthrow InvalidInputException(\"incorrect column count in AppendDataChunk, expected %d, got %d\", types.size(),",
          "new_line_content": "\t\tcollection->Append(chunk_p);",
          "content_same": false
        },
        {
          "line": 392,
          "old_api": "Initialize",
          "new_api": "ColumnCount",
          "old_text": "cast_chunk.Initialize(allocator, types)",
          "new_text": "chunk_p.ColumnCount()",
          "old_line_content": "\tcast_chunk.Initialize(allocator, types);",
          "new_line_content": "\tauto count = chunk_p.ColumnCount();",
          "content_same": false
        },
        {
          "line": 393,
          "old_api": "SetCardinality",
          "new_api": "size",
          "old_text": "cast_chunk.SetCardinality(size)",
          "new_text": "types.size()",
          "old_line_content": "\tcast_chunk.SetCardinality(size);",
          "new_line_content": "\tif (count != types.size()) {",
          "content_same": false
        },
        {
          "line": 402,
          "old_api": "VectorOperations::DefaultTryCast(chunk_p.data[i], cast_chunk.data[i], size, &error_msg)",
          "new_api": "SetCardinality",
          "old_text": "VectorOperations::DefaultTryCast(chunk_p.data[i], cast_chunk.data[i], size, &error_msg)",
          "new_text": "cast_chunk.SetCardinality(size)",
          "old_line_content": "\t\tauto success = VectorOperations::DefaultTryCast(chunk_p.data[i], cast_chunk.data[i], size, &error_msg);",
          "new_line_content": "\tcast_chunk.SetCardinality(size);",
          "content_same": false
        },
        {
          "line": 411,
          "old_api": "Flush",
          "new_api": "VectorOperations::DefaultTryCast(chunk_p.data[i], cast_chunk.data[i], size, &error_msg)",
          "old_text": "Flush()",
          "new_text": "VectorOperations::DefaultTryCast(chunk_p.data[i], cast_chunk.data[i], size, &error_msg)",
          "old_line_content": "\t\tFlush();",
          "new_line_content": "\t\tauto success = VectorOperations::DefaultTryCast(chunk_p.data[i], cast_chunk.data[i], size, &error_msg);",
          "content_same": false
        },
        {
          "line": 419,
          "old_api": "Append",
          "new_api": "Count",
          "old_text": "collection->Append(chunk)",
          "new_text": "collection->Count()",
          "old_line_content": "\tcollection->Append(chunk);",
          "new_line_content": "\tif (collection->Count() >= flush_count) {",
          "content_same": false
        },
        {
          "line": 420,
          "old_api": "Reset",
          "new_api": "Flush",
          "old_text": "chunk.Reset()",
          "new_text": "Flush()",
          "old_line_content": "\tchunk.Reset();",
          "new_line_content": "\t\tFlush();",
          "content_same": false
        },
        {
          "line": 429,
          "old_api": "InvalidInputException",
          "new_api": "Reset",
          "old_text": "InvalidInputException(\"Failed to Flush appender: incomplete append to row!\")",
          "new_text": "chunk.Reset()",
          "old_line_content": "\t\tthrow InvalidInputException(\"Failed to Flush appender: incomplete append to row!\");",
          "new_line_content": "\tchunk.Reset();",
          "content_same": false
        },
        {
          "line": 438,
          "old_api": "Reset",
          "new_api": "InvalidInputException",
          "old_text": "collection->Reset()",
          "new_text": "InvalidInputException(\"Failed to Flush appender: incomplete append to row!\")",
          "old_line_content": "\tcollection->Reset();",
          "new_line_content": "\t\tthrow InvalidInputException(\"Failed to Flush appender: incomplete append to row!\");",
          "content_same": false
        },
        {
          "line": 447,
          "old_api": "find",
          "new_api": "Reset",
          "old_text": "default_values.find(column)",
          "new_text": "collection->Reset()",
          "old_line_content": "\tauto it = default_values.find(column);",
          "new_line_content": "\tcollection->Reset();",
          "content_same": false
        },
        {
          "line": 452,
          "old_api": "Name",
          "new_api": "Append",
          "old_text": "column_def.Name()",
          "new_text": "context->Append(*description, collection)",
          "old_line_content": "\t\t    column_def.Name());",
          "new_line_content": "\tcontext->Append(*description, collection);",
          "content_same": false
        },
        {
          "line": 459,
          "old_api": "Binder::CreateBinder(context)",
          "new_api": "Name",
          "old_text": "Binder::CreateBinder(context)",
          "new_text": "NotImplementedException(\n\t\t    \"AppendDefault is currently not supported for column \\\"%s\\\" because default expression is not foldable.\",\n\t\t    column_def.Name())",
          "old_line_content": "\tauto binder = Binder::CreateBinder(context);",
          "new_line_content": "\t\tthrow NotImplementedException(",
          "content_same": false
        },
        {
          "line": 461,
          "old_api": "GetStorage",
          "new_api": "Name",
          "old_text": "table.GetStorage().LocalAppend(table, context, collection, bound_constraints)",
          "new_text": "column_def.Name()",
          "old_line_content": "\ttable.GetStorage().LocalAppend(table, context, collection, bound_constraints);",
          "new_line_content": "\t\t    column_def.Name());",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 386,
          "old_api": null,
          "new_api": "Count",
          "old_text": null,
          "new_text": "collection->Count()",
          "old_line_content": "\t\t                            count);",
          "new_line_content": "\t\tif (collection->Count() >= flush_count) {",
          "content_same": false
        },
        {
          "line": 387,
          "old_api": null,
          "new_api": "Flush",
          "old_text": null,
          "new_text": "Flush()",
          "old_line_content": "\t}",
          "new_line_content": "\t\t\tFlush();",
          "content_same": false
        },
        {
          "line": 394,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "types.size()",
          "old_line_content": "",
          "new_line_content": "\t\tthrow InvalidInputException(\"incorrect column count in AppendDataChunk, expected %d, got %d\", types.size(),",
          "content_same": false
        },
        {
          "line": 399,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "chunk_p.size()",
          "old_line_content": "\t\t}",
          "new_line_content": "\tauto size = chunk_p.size();",
          "content_same": false
        },
        {
          "line": 401,
          "old_api": null,
          "new_api": "Initialize",
          "old_text": null,
          "new_text": "cast_chunk.Initialize(allocator, types)",
          "old_line_content": "\t\tstring error_msg;",
          "new_line_content": "\tcast_chunk.Initialize(allocator, types);",
          "content_same": false
        },
        {
          "line": 406,
          "old_api": null,
          "new_api": "Reference",
          "old_text": null,
          "new_text": "cast_chunk.data[i].Reference(chunk_p.data[i])",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\t\tcast_chunk.data[i].Reference(chunk_p.data[i]);",
          "content_same": false
        },
        {
          "line": 413,
          "old_api": null,
          "new_api": "ToString",
          "old_text": null,
          "new_text": "InvalidInputException(\"type mismatch in AppendDataChunk, expected %s, got %s for column %d\",\n\t\t\t                            types[i].ToString(), chunk_p.data[i].GetType().ToString(), i)",
          "old_line_content": "}",
          "new_line_content": "\t\t\tthrow InvalidInputException(\"type mismatch in AppendDataChunk, expected %s, got %s for column %d\",",
          "content_same": false
        },
        {
          "line": 414,
          "old_api": null,
          "new_api": "GetType",
          "old_text": null,
          "new_text": "chunk_p.data[i].GetType().ToString()",
          "old_line_content": "",
          "new_line_content": "\t\t\t                            types[i].ToString(), chunk_p.data[i].GetType().ToString(), i);",
          "content_same": false
        },
        {
          "line": 418,
          "old_api": null,
          "new_api": "Append",
          "old_text": null,
          "new_text": "collection->Append(cast_chunk)",
          "old_line_content": "\t}",
          "new_line_content": "\tcollection->Append(cast_chunk);",
          "content_same": false
        },
        {
          "line": 425,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "chunk.size()",
          "old_line_content": "",
          "new_line_content": "\tif (chunk.size() == 0) {",
          "content_same": false
        },
        {
          "line": 428,
          "old_api": null,
          "new_api": "Append",
          "old_text": null,
          "new_text": "collection->Append(chunk)",
          "old_line_content": "\tif (column != 0) {",
          "new_line_content": "\tcollection->Append(chunk);",
          "content_same": false
        },
        {
          "line": 430,
          "old_api": null,
          "new_api": "Count",
          "old_text": null,
          "new_text": "collection->Count()",
          "old_line_content": "\t}",
          "new_line_content": "\tif (collection->Count() >= flush_count) {",
          "content_same": false
        },
        {
          "line": 431,
          "old_api": null,
          "new_api": "Flush",
          "old_text": null,
          "new_text": "Flush()",
          "old_line_content": "",
          "new_line_content": "\t\tFlush();",
          "content_same": false
        },
        {
          "line": 441,
          "old_api": null,
          "new_api": "FlushChunk",
          "old_text": null,
          "new_text": "FlushChunk()",
          "old_line_content": "",
          "new_line_content": "\tFlushChunk();",
          "content_same": false
        },
        {
          "line": 442,
          "old_api": null,
          "new_api": "Count",
          "old_text": null,
          "new_text": "collection->Count()",
          "old_line_content": "void Appender::FlushInternal(ColumnDataCollection &collection) {",
          "new_line_content": "\tif (collection->Count() == 0) {",
          "content_same": false
        },
        {
          "line": 445,
          "old_api": null,
          "new_api": "FlushInternal",
          "old_text": null,
          "new_text": "FlushInternal(*collection)",
          "old_line_content": "",
          "new_line_content": "\tFlushInternal(*collection);",
          "content_same": false
        },
        {
          "line": 456,
          "old_api": null,
          "new_api": "find",
          "old_text": null,
          "new_text": "default_values.find(column)",
          "old_line_content": "}",
          "new_line_content": "\tauto it = default_values.find(column);",
          "content_same": false
        },
        {
          "line": 458,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "default_values.end()",
          "old_line_content": "void InternalAppender::FlushInternal(ColumnDataCollection &collection) {",
          "new_line_content": "\tif (it == default_values.end()) {",
          "content_same": false
        },
        {
          "line": 464,
          "old_api": null,
          "new_api": "Append",
          "old_text": null,
          "new_text": "Append(default_value)",
          "old_line_content": "void BaseAppender::Close() {",
          "new_line_content": "\tAppend(default_value);",
          "content_same": false
        },
        {
          "line": 468,
          "old_api": null,
          "new_api": "Binder::CreateBinder(context)",
          "old_text": null,
          "new_text": "Binder::CreateBinder(context)",
          "old_line_content": "}",
          "new_line_content": "\tauto binder = Binder::CreateBinder(context);",
          "content_same": false
        },
        {
          "line": 469,
          "old_api": null,
          "new_api": "BindConstraints",
          "old_text": null,
          "new_text": "binder->BindConstraints(table)",
          "old_line_content": "",
          "new_line_content": "\tauto bound_constraints = binder->BindConstraints(table);",
          "content_same": false
        },
        {
          "line": 470,
          "old_api": null,
          "new_api": "GetStorage",
          "old_text": null,
          "new_text": "table.GetStorage().LocalAppend(table, context, collection, bound_constraints)",
          "old_line_content": "} // namespace duckdb",
          "new_line_content": "\ttable.GetStorage().LocalAppend(table, context, collection, bound_constraints);",
          "content_same": false
        },
        {
          "line": 474,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "types.size()",
          "old_line_content": "",
          "new_line_content": "\tif (column == 0 || column == types.size()) {",
          "content_same": false
        },
        {
          "line": 475,
          "old_api": null,
          "new_api": "Flush",
          "old_text": null,
          "new_text": "Flush()",
          "old_line_content": "",
          "new_line_content": "\t\tFlush();",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 384,
          "old_api": "size",
          "new_api": null,
          "old_text": "types.size()",
          "new_text": null,
          "old_line_content": "\tif (count != types.size()) {",
          "new_line_content": "\tif (chunk_types == types) {",
          "content_same": false
        },
        {
          "line": 390,
          "old_api": "size",
          "new_api": null,
          "old_text": "chunk_p.size()",
          "new_text": null,
          "old_line_content": "\tauto size = chunk_p.size();",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 396,
          "old_api": "GetType",
          "new_api": null,
          "old_text": "chunk_p.data[i].GetType()",
          "new_text": null,
          "old_line_content": "\t\tif (chunk_p.data[i].GetType() == types[i]) {",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 397,
          "old_api": "Reference",
          "new_api": null,
          "old_text": "cast_chunk.data[i].Reference(chunk_p.data[i])",
          "new_text": null,
          "old_line_content": "\t\t\tcast_chunk.data[i].Reference(chunk_p.data[i]);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 404,
          "old_api": "ToString",
          "new_api": null,
          "old_text": "InvalidInputException(\"type mismatch in AppendDataChunk, expected %s, got %s for column %d\",\n\t\t\t                            types[i].ToString(), chunk_p.data[i].GetType().ToString(), i)",
          "new_text": null,
          "old_line_content": "\t\t\tthrow InvalidInputException(\"type mismatch in AppendDataChunk, expected %s, got %s for column %d\",",
          "new_line_content": "\tfor (idx_t i = 0; i < count; i++) {",
          "content_same": false
        },
        {
          "line": 409,
          "old_api": "Append",
          "new_api": null,
          "old_text": "collection->Append(cast_chunk)",
          "new_text": null,
          "old_line_content": "\tcollection->Append(cast_chunk);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 410,
          "old_api": "Count",
          "new_api": null,
          "old_text": "collection->Count()",
          "new_text": null,
          "old_line_content": "\tif (collection->Count() >= flush_count) {",
          "new_line_content": "\t\tstring error_msg;",
          "content_same": false
        },
        {
          "line": 416,
          "old_api": "size",
          "new_api": null,
          "old_text": "chunk.size()",
          "new_text": null,
          "old_line_content": "\tif (chunk.size() == 0) {",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 421,
          "old_api": "Count",
          "new_api": null,
          "old_text": "collection->Count()",
          "new_text": null,
          "old_line_content": "\tif (collection->Count() >= flush_count) {",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 422,
          "old_api": "Flush",
          "new_api": null,
          "old_text": "Flush()",
          "new_text": null,
          "old_line_content": "\t\tFlush();",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 432,
          "old_api": "FlushChunk",
          "new_api": null,
          "old_text": "FlushChunk()",
          "new_text": null,
          "old_line_content": "\tFlushChunk();",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 433,
          "old_api": "Count",
          "new_api": null,
          "old_text": "collection->Count()",
          "new_text": null,
          "old_line_content": "\tif (collection->Count() == 0) {",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 436,
          "old_api": "FlushInternal",
          "new_api": null,
          "old_text": "FlushInternal(*collection)",
          "new_text": null,
          "old_line_content": "\tFlushInternal(*collection);",
          "new_line_content": "\t// check that all vectors have the same length before appending",
          "content_same": false
        },
        {
          "line": 443,
          "old_api": "Append",
          "new_api": null,
          "old_text": "context->Append(*description, collection)",
          "new_text": null,
          "old_line_content": "\tcontext->Append(*description, collection);",
          "new_line_content": "\t\treturn;",
          "content_same": false
        },
        {
          "line": 449,
          "old_api": "end",
          "new_api": null,
          "old_text": "default_values.end()",
          "new_text": null,
          "old_line_content": "\tif (it == default_values.end()) {",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 450,
          "old_api": "Name",
          "new_api": null,
          "old_text": "NotImplementedException(\n\t\t    \"AppendDefault is currently not supported for column \\\"%s\\\" because default expression is not foldable.\",\n\t\t    column_def.Name())",
          "new_text": null,
          "old_line_content": "\t\tthrow NotImplementedException(",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 455,
          "old_api": "Append",
          "new_api": null,
          "old_text": "Append(default_value)",
          "new_text": null,
          "old_line_content": "\tAppend(default_value);",
          "new_line_content": "void Appender::AppendDefault() {",
          "content_same": false
        },
        {
          "line": 460,
          "old_api": "BindConstraints",
          "new_api": null,
          "old_text": "binder->BindConstraints(table)",
          "new_text": null,
          "old_line_content": "\tauto bound_constraints = binder->BindConstraints(table);",
          "new_line_content": "\t\t    \"AppendDefault is currently not supported for column \\\"%s\\\" because default expression is not foldable.\",",
          "content_same": false
        },
        {
          "line": 465,
          "old_api": "size",
          "new_api": null,
          "old_text": "types.size()",
          "new_text": null,
          "old_line_content": "\tif (column == 0 || column == types.size()) {",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 466,
          "old_api": "Flush",
          "new_api": null,
          "old_text": "Flush()",
          "new_text": null,
          "old_line_content": "\t\tFlush();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 383,
          "old_api": "ColumnCount",
          "new_api": null,
          "old_text": "chunk_p.ColumnCount()",
          "new_text": null,
          "old_line_content": "\tauto count = chunk_p.ColumnCount();",
          "new_line_content": "\t// Early-out, if types match.",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 13,
      "total_additions": 24,
      "total_deletions": 21,
      "total_api_changes": 58
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 9,
        "api_related_lines": 58,
        "non_api_lines": 3,
        "non_api_line_numbers": [
          388,
          389,
          391
        ]
      }
    },
    "api_calls_before": 157,
    "api_calls_after": 160,
    "diff_info": {
      "added_lines": 9,
      "removed_lines": 0,
      "total_diff_lines": 21
    }
  }
}