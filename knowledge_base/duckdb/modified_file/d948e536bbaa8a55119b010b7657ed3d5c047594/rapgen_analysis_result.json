{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/duckdb/modified_file/d948e536bbaa8a55119b010b7657ed3d5c047594",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/duckdb/modified_file/d948e536bbaa8a55119b010b7657ed3d5c047594/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/duckdb/modified_file/d948e536bbaa8a55119b010b7657ed3d5c047594/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/duckdb/modified_file/d948e536bbaa8a55119b010b7657ed3d5c047594/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 158,
          "old_api": "size",
          "new_api": "Initialize",
          "old_text": "input.size()",
          "new_text": "row.Initialize(allocator, payload_types)",
          "old_line_content": "\t\t\tfor (sel_t i = 0; i < input.size(); ++i) {",
          "new_line_content": "\t\t\trow.Initialize(allocator, payload_types);",
          "content_same": false
        },
        {
          "line": 163,
          "old_api": "finalize",
          "new_api": "Reference",
          "old_text": "aggregate.finalize(statev, aggr_input_data, result, 1, i)",
          "new_text": "DictionaryVector::Child(row.data[col_idx]).Reference(payload.data[col_idx])",
          "old_line_content": "\t\t\t\taggregate.finalize(statev, aggr_input_data, result, 1, i);",
          "new_line_content": "\t\t\t\tDictionaryVector::Child(row.data[col_idx]).Reference(payload.data[col_idx]);",
          "content_same": false
        },
        {
          "line": 184,
          "old_api": "GetExpressionType",
          "new_api": "FlatVector::GetData<int64_t>(chunk.data[col_idx])",
          "old_text": "expr.GetExpressionType()",
          "new_text": "FlatVector::GetData<int64_t>(chunk.data[col_idx])",
          "old_line_content": "\t\t\tthrow NotImplementedException(\"%s for StreamingWindow\", ExpressionTypeToString(expr.GetExpressionType()));",
          "new_line_content": "\t\t\tauto rdata = FlatVector::GetData<int64_t>(chunk.data[col_idx]);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 195,
          "old_api": null,
          "new_api": "SetCardinality",
          "old_text": null,
          "new_text": "chunk.SetCardinality(count)",
          "old_line_content": "\t\tif (i > 0) {",
          "new_line_content": "\tchunk.SetCardinality(count);",
          "content_same": false
        },
        {
          "line": 167,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "input.size()",
          "old_line_content": "\t\tcase ExpressionType::WINDOW_FIRST_VALUE:",
          "new_line_content": "\t\t\tfor (idx_t i = 0; i < input.size(); ++i) {",
          "content_same": false
        },
        {
          "line": 168,
          "old_api": null,
          "new_api": "set_index",
          "old_text": null,
          "new_text": "sel.set_index(0, i)",
          "old_line_content": "\t\tcase ExpressionType::WINDOW_PERCENT_RANK:",
          "new_line_content": "\t\t\t\tsel.set_index(0, i);",
          "content_same": false
        },
        {
          "line": 169,
          "old_api": null,
          "new_api": "ColumnCount",
          "old_text": null,
          "new_text": "row.ColumnCount()",
          "old_line_content": "\t\tcase ExpressionType::WINDOW_RANK:",
          "new_line_content": "\t\t\t\taggregate.update(row.data.data(), aggr_input_data, row.ColumnCount(), statev, 1);",
          "content_same": false
        },
        {
          "line": 170,
          "old_api": null,
          "new_api": "finalize",
          "old_text": null,
          "new_text": "aggregate.finalize(statev, aggr_input_data, result, 1, i)",
          "old_line_content": "\t\tcase ExpressionType::WINDOW_RANK_DENSE: {",
          "new_line_content": "\t\t\t\taggregate.finalize(statev, aggr_input_data, result, 1, i);",
          "content_same": false
        },
        {
          "line": 201,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "select_list.size()",
          "old_line_content": "}",
          "new_line_content": "\tfor (idx_t i = 0; i < select_list.size(); i++) {",
          "content_same": false
        },
        {
          "line": 205,
          "old_api": null,
          "new_api": "GetName",
          "old_text": null,
          "new_text": "select_list[i]->GetName()",
          "old_line_content": "",
          "new_line_content": "\t\tresult += select_list[i]->GetName();",
          "content_same": false
        },
        {
          "line": 179,
          "old_api": null,
          "new_api": "Reference",
          "old_text": null,
          "new_text": "chunk.data[col_idx].Reference(*state.const_vectors[expr_idx])",
          "old_line_content": "\t\t\t\trdata[i] = gstate.row_number + i;",
          "new_line_content": "\t\t\tchunk.data[col_idx].Reference(*state.const_vectors[expr_idx]);",
          "content_same": false
        },
        {
          "line": 156,
          "old_api": null,
          "new_api": "Flatten",
          "old_text": null,
          "new_text": "payload.Flatten()",
          "old_line_content": "\t\t\tDataChunk row;",
          "new_line_content": "\t\t\tpayload.Flatten();",
          "content_same": false
        },
        {
          "line": 191,
          "old_api": null,
          "new_api": "GetExpressionType",
          "old_text": null,
          "new_text": "expr.GetExpressionType()",
          "old_line_content": "",
          "new_line_content": "\t\t\tthrow NotImplementedException(\"%s for StreamingWindow\", ExpressionTypeToString(expr.GetExpressionType()));",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 194,
          "old_api": "size",
          "new_api": null,
          "old_text": "select_list.size()",
          "new_text": null,
          "old_line_content": "\tfor (idx_t i = 0; i < select_list.size(); i++) {",
          "new_line_content": "\tgstate.row_number += count;",
          "content_same": false
        },
        {
          "line": 198,
          "old_api": "GetName",
          "new_api": null,
          "old_text": "select_list[i]->GetName()",
          "new_text": null,
          "old_line_content": "\t\tresult += select_list[i]->GetName();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 172,
          "old_api": "Reference",
          "new_api": null,
          "old_text": "chunk.data[col_idx].Reference(*state.const_vectors[expr_idx])",
          "new_text": null,
          "old_line_content": "\t\t\tchunk.data[col_idx].Reference(*state.const_vectors[expr_idx]);",
          "new_line_content": "\t\t\tbreak;",
          "content_same": false
        },
        {
          "line": 177,
          "old_api": "FlatVector::GetData<int64_t>(chunk.data[col_idx])",
          "new_api": null,
          "old_text": "FlatVector::GetData<int64_t>(chunk.data[col_idx])",
          "new_text": null,
          "old_line_content": "\t\t\tauto rdata = FlatVector::GetData<int64_t>(chunk.data[col_idx]);",
          "new_line_content": "\t\tcase ExpressionType::WINDOW_RANK_DENSE: {",
          "content_same": false
        },
        {
          "line": 188,
          "old_api": "SetCardinality",
          "new_api": null,
          "old_text": "chunk.SetCardinality(count)",
          "new_text": null,
          "old_line_content": "\tchunk.SetCardinality(count);",
          "new_line_content": "\t\t\tbreak;",
          "content_same": false
        },
        {
          "line": 157,
          "old_api": "Initialize",
          "new_api": null,
          "old_text": "row.Initialize(allocator, payload_types)",
          "new_text": null,
          "old_line_content": "\t\t\trow.Initialize(allocator, payload_types);",
          "new_line_content": "\t\t\tDataChunk row;",
          "content_same": false
        },
        {
          "line": 159,
          "old_api": "Reset",
          "new_api": null,
          "old_text": "row.Reset()",
          "new_text": null,
          "old_line_content": "\t\t\t\trow.Reset();",
          "new_line_content": "\t\t\tsel_t s = 0;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 3,
      "total_additions": 10,
      "total_deletions": 7,
      "total_api_changes": 20
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 13,
        "api_related_lines": 20,
        "non_api_lines": 7,
        "non_api_line_numbers": [
          160,
          161,
          162,
          164,
          165,
          166,
          155
        ]
      }
    },
    "api_calls_before": 66,
    "api_calls_after": 70,
    "diff_info": {
      "added_lines": 12,
      "removed_lines": 5,
      "total_diff_lines": 31
    }
  }
}