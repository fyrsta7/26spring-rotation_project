{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/duckdb/modified_file/18060736d7ecb0b2658050d951150533a557e92a",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/duckdb/modified_file/18060736d7ecb0b2658050d951150533a557e92a/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/duckdb/modified_file/18060736d7ecb0b2658050d951150533a557e92a/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/duckdb/modified_file/18060736d7ecb0b2658050d951150533a557e92a/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 244,
          "old_api": "destructor",
          "new_api": "data",
          "old_text": "aggr.function.destructor(statef, aggr_input_data, 1)",
          "new_text": "state.data()",
          "old_line_content": "\t\taggr.function.destructor(statef, aggr_input_data, 1);",
          "new_line_content": "\taggr.function.initialize(state.data());",
          "content_same": false
        },
        {
          "line": 249,
          "old_api": "data",
          "new_api": "finalize",
          "old_text": "state.data()",
          "new_text": "aggr.function.finalize(statef, aggr_input_data, result, 1, rid)",
          "old_line_content": "\taggr.function.initialize(state.data());",
          "new_line_content": "\taggr.function.finalize(statef, aggr_input_data, result, 1, rid);",
          "content_same": false
        },
        {
          "line": 266,
          "old_api": "Allocator::DefaultAllocator()",
          "new_api": "SetCardinality",
          "old_text": "Allocator::DefaultAllocator()",
          "new_text": "inputs.SetCardinality(flush_count)",
          "old_line_content": "\tAggregateInputData aggr_input_data(aggr.GetFunctionData(), Allocator::DefaultAllocator());",
          "new_line_content": "\t\tinputs.SetCardinality(flush_count);",
          "content_same": false
        },
        {
          "line": 271,
          "old_api": "SetCardinality",
          "new_api": "ColumnCount",
          "old_text": "inputs.SetCardinality(flush_count)",
          "new_text": "inputs.ColumnCount()",
          "old_line_content": "\t\tinputs.SetCardinality(flush_count);",
          "new_line_content": "\t\tfor (column_t i = 0; i < inputs.ColumnCount(); i++) {",
          "content_same": false
        },
        {
          "line": 290,
          "old_api": "D_ASSERT",
          "new_api": "AllValid",
          "old_text": "D_ASSERT(count <= TREE_FANOUT)",
          "new_text": "filter_mask.AllValid()",
          "old_line_content": "\tD_ASSERT(count <= TREE_FANOUT);",
          "new_line_content": "\tif (filter_mask.AllValid()) {",
          "content_same": false
        },
        {
          "line": 299,
          "old_api": "FlushStates",
          "new_api": "RowIsValid",
          "old_text": "FlushStates(0)",
          "new_text": "filter_mask.RowIsValid(i)",
          "old_line_content": "\t\t\t\tFlushStates(0);",
          "new_line_content": "\t\t\tif (filter_mask.RowIsValid(i)) {",
          "content_same": false
        },
        {
          "line": 322,
          "old_api": "ExtractFrame",
          "new_api": "FlatVector::GetData<data_ptr_t>(statel)",
          "old_text": "ExtractFrame(begin, end)",
          "new_text": "FlatVector::GetData<data_ptr_t>(statel)",
          "old_line_content": "\t\tExtractFrame(begin, end);",
          "new_line_content": "\t\tauto pdata = FlatVector::GetData<data_ptr_t>(statel);",
          "content_same": false
        },
        {
          "line": 327,
          "old_api": "FlatVector::GetData<data_ptr_t>(statel)",
          "new_api": "FlushStates",
          "old_text": "FlatVector::GetData<data_ptr_t>(statel)",
          "new_text": "FlushStates(l_idx)",
          "old_line_content": "\t\tauto pdata = FlatVector::GetData<data_ptr_t>(statel);",
          "new_line_content": "\t\t\t\tFlushStates(l_idx);",
          "content_same": false
        },
        {
          "line": 339,
          "old_api": "D_ASSERT",
          "new_api": "size",
          "old_text": "D_ASSERT(input_ref)",
          "new_text": "input_ref->size()",
          "old_line_content": "\tD_ASSERT(input_ref);",
          "new_line_content": "\tidx_t level_nodes = input_ref->size();",
          "content_same": false
        },
        {
          "line": 357,
          "old_api": "size",
          "new_api": "MinValue",
          "old_text": "input_ref->size()",
          "new_text": "MinValue(level_size, pos + TREE_FANOUT)",
          "old_line_content": "\twhile ((level_size = (level_current == 0 ? input_ref->size()",
          "new_line_content": "\t\t\tWindowSegmentValue(level_current, pos, MinValue(level_size, pos + TREE_FANOUT));",
          "content_same": false
        },
        {
          "line": 365,
          "old_api": "size",
          "new_api": "push_back",
          "old_text": "state.size()",
          "new_text": "levels_flat_start.push_back(levels_flat_offset)",
          "old_line_content": "\t\t\tmemcpy(levels_flat_native.get() + (levels_flat_offset * state.size()), state.data(), state.size());",
          "new_line_content": "\t\tlevels_flat_start.push_back(levels_flat_offset);",
          "content_same": false
        },
        {
          "line": 376,
          "old_api": "get",
          "new_api": "D_ASSERT",
          "old_text": "levels_flat_native.get()",
          "new_text": "D_ASSERT(input_ref)",
          "old_line_content": "\t\taggr.function.initialize(levels_flat_native.get());",
          "new_line_content": "\tD_ASSERT(input_ref);",
          "content_same": false
        },
        {
          "line": 392,
          "old_api": "data",
          "new_api": "AggregateInit",
          "old_text": "state.data()",
          "new_text": "AggregateInit()",
          "old_line_content": "\t\taggr.function.window(input_ref->data.data(), filter_mask, aggr_input_data, inputs.ColumnCount(), state.data(),",
          "new_line_content": "\tAggregateInit();",
          "content_same": false
        },
        {
          "line": 397,
          "old_api": "AggregateInit",
          "new_api": "UseCombineAPI",
          "old_text": "AggregateInit()",
          "new_text": "UseCombineAPI()",
          "old_line_content": "\tAggregateInit();",
          "new_line_content": "\tif (!aggr.function.combine || !UseCombineAPI()) {",
          "content_same": false
        },
        {
          "line": 404,
          "old_api": "FlushStates",
          "new_api": "size",
          "old_text": "FlushStates(l_idx)",
          "new_text": "levels_flat_start.size()",
          "old_line_content": "\t\tFlushStates(l_idx);",
          "new_line_content": "\tfor (; l_idx < levels_flat_start.size() + 1; l_idx++) {",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 386,
          "old_api": null,
          "new_api": "Allocator::DefaultAllocator()",
          "old_text": null,
          "new_text": "Allocator::DefaultAllocator()",
          "old_line_content": "\t\t// Frame boundaries",
          "new_line_content": "\t\tAggregateInputData aggr_input_data(aggr.GetFunctionData(), Allocator::DefaultAllocator());",
          "content_same": false
        },
        {
          "line": 387,
          "old_api": null,
          "new_api": "data",
          "old_text": null,
          "new_text": "state.data()",
          "old_line_content": "\t\tauto prev = frame;",
          "new_line_content": "\t\taggr.function.window(input_ref->data.data(), filter_mask, aggr_input_data, inputs.ColumnCount(), state.data(),",
          "content_same": false
        },
        {
          "line": 261,
          "old_api": null,
          "new_api": "Allocator::DefaultAllocator()",
          "old_text": null,
          "new_text": "Allocator::DefaultAllocator()",
          "old_line_content": "void WindowSegmentTree::FlushStates(idx_t l_idx) {",
          "new_line_content": "\tAggregateInputData aggr_input_data(aggr.GetFunctionData(), Allocator::DefaultAllocator());",
          "content_same": false
        },
        {
          "line": 263,
          "old_api": null,
          "new_api": "Verify",
          "old_text": null,
          "new_text": "statel.Verify(flush_count)",
          "old_line_content": "\t\treturn;",
          "new_line_content": "\t\tstatel.Verify(flush_count);",
          "content_same": false
        },
        {
          "line": 264,
          "old_api": null,
          "new_api": "combine",
          "old_text": null,
          "new_text": "aggr.function.combine(statel, statep, aggr_input_data, flush_count)",
          "old_line_content": "\t}",
          "new_line_content": "\t\taggr.function.combine(statel, statep, aggr_input_data, flush_count);",
          "content_same": false
        },
        {
          "line": 267,
          "old_api": null,
          "new_api": "ColumnCount",
          "old_text": null,
          "new_text": "inputs.ColumnCount()",
          "old_line_content": "\tif (l_idx) {",
          "new_line_content": "\t\taggr.function.update(&inputs.data[0], aggr_input_data, inputs.ColumnCount(), statep, flush_count);",
          "content_same": false
        },
        {
          "line": 398,
          "old_api": null,
          "new_api": "WindowSegmentValue",
          "old_text": null,
          "new_text": "WindowSegmentValue(l_idx, begin, end)",
          "old_line_content": "\tidx_t l_idx = 0;",
          "new_line_content": "\t\tWindowSegmentValue(l_idx, begin, end);",
          "content_same": false
        },
        {
          "line": 399,
          "old_api": null,
          "new_api": "FlushStates",
          "old_text": null,
          "new_text": "FlushStates(l_idx)",
          "old_line_content": "",
          "new_line_content": "\t\tFlushStates(l_idx);",
          "content_same": false
        },
        {
          "line": 400,
          "old_api": null,
          "new_api": "AggegateFinal",
          "old_text": null,
          "new_text": "AggegateFinal(result, rid)",
          "old_line_content": "\t// Aggregate everything at once if we can't combine states",
          "new_line_content": "\t\tAggegateFinal(result, rid);",
          "content_same": false
        },
        {
          "line": 273,
          "old_api": null,
          "new_api": "GetVectorType",
          "old_text": null,
          "new_text": "v.GetVectorType()",
          "old_line_content": "",
          "new_line_content": "\t\t\tif (v.GetVectorType() != VectorType::DICTIONARY_VECTOR ||",
          "content_same": false
        },
        {
          "line": 274,
          "old_api": null,
          "new_api": "data",
          "old_text": null,
          "new_text": "filter_sel.data()",
          "old_line_content": "\t\t//\tSome update functions mangle our dictionaries.",
          "new_line_content": "\t\t\t    DictionaryVector::SelVector(v).data() != filter_sel.data()) {",
          "content_same": false
        },
        {
          "line": 275,
          "old_api": null,
          "new_api": "Slice",
          "old_text": null,
          "new_text": "v.Slice(input_ref->data[i], filter_sel, STANDARD_VECTOR_SIZE)",
          "old_line_content": "\t\t//\tso we have to check and unmangle them...",
          "new_line_content": "\t\t\t\tv.Slice(input_ref->data[i], filter_sel, STANDARD_VECTOR_SIZE);",
          "content_same": false
        },
        {
          "line": 408,
          "old_api": null,
          "new_api": "WindowSegmentValue",
          "old_text": null,
          "new_text": "WindowSegmentValue(l_idx, begin, end)",
          "old_line_content": "",
          "new_line_content": "\t\t\tWindowSegmentValue(l_idx, begin, end);",
          "content_same": false
        },
        {
          "line": 285,
          "old_api": null,
          "new_api": "D_ASSERT",
          "old_text": null,
          "new_text": "D_ASSERT(count <= TREE_FANOUT)",
          "old_line_content": "\tflush_count = 0;",
          "new_line_content": "\tD_ASSERT(count <= TREE_FANOUT);",
          "content_same": false
        },
        {
          "line": 292,
          "old_api": null,
          "new_api": "set_index",
          "old_text": null,
          "new_text": "filter_sel.set_index(flush_count++, begin + i)",
          "old_line_content": "\t//\tIf we are not filtering,",
          "new_line_content": "\t\t\tfilter_sel.set_index(flush_count++, begin + i);",
          "content_same": false
        },
        {
          "line": 294,
          "old_api": null,
          "new_api": "FlushStates",
          "old_text": null,
          "new_text": "FlushStates(0)",
          "old_line_content": "\t//\tOtherwise set it to the input rows that pass the filter",
          "new_line_content": "\t\t\t\tFlushStates(0);",
          "content_same": false
        },
        {
          "line": 425,
          "old_api": null,
          "new_api": "FlushStates",
          "old_text": null,
          "new_text": "FlushStates(l_idx)",
          "old_line_content": "\t\tbegin = parent_begin;",
          "new_line_content": "\t\t\tFlushStates(l_idx);",
          "content_same": false
        },
        {
          "line": 300,
          "old_api": null,
          "new_api": "set_index",
          "old_text": null,
          "new_text": "filter_sel.set_index(flush_count++, i)",
          "old_line_content": "\t\t\t}",
          "new_line_content": "\t\t\t\tfilter_sel.set_index(flush_count++, i);",
          "content_same": false
        },
        {
          "line": 429,
          "old_api": null,
          "new_api": "FlushStates",
          "old_text": null,
          "new_text": "FlushStates(l_idx)",
          "old_line_content": "\t\tif (!l_idx) {",
          "new_line_content": "\tFlushStates(l_idx);",
          "content_same": false
        },
        {
          "line": 302,
          "old_api": null,
          "new_api": "FlushStates",
          "old_text": null,
          "new_text": "FlushStates(0)",
          "old_line_content": "\t} else {",
          "new_line_content": "\t\t\t\t\tFlushStates(0);",
          "content_same": false
        },
        {
          "line": 431,
          "old_api": null,
          "new_api": "AggegateFinal",
          "old_text": null,
          "new_text": "AggegateFinal(result, rid)",
          "old_line_content": "\t\t}",
          "new_line_content": "\tAggegateFinal(result, rid);",
          "content_same": false
        },
        {
          "line": 310,
          "old_api": null,
          "new_api": "D_ASSERT",
          "old_text": null,
          "new_text": "D_ASSERT(begin <= end)",
          "old_line_content": "\t\t}",
          "new_line_content": "\tD_ASSERT(begin <= end);",
          "content_same": false
        },
        {
          "line": 311,
          "old_api": null,
          "new_api": "ColumnCount",
          "old_text": null,
          "new_text": "inputs.ColumnCount()",
          "old_line_content": "\t}",
          "new_line_content": "\tif (begin == end || inputs.ColumnCount() == 0) {",
          "content_same": false
        },
        {
          "line": 317,
          "old_api": null,
          "new_api": "ExtractFrame",
          "old_text": null,
          "new_text": "ExtractFrame(begin, end)",
          "old_line_content": "\t\treturn;",
          "new_line_content": "\t\tExtractFrame(begin, end);",
          "content_same": false
        },
        {
          "line": 320,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "state.size()",
          "old_line_content": "\tconst auto count = end - begin;",
          "new_line_content": "\t\tdata_ptr_t begin_ptr = levels_flat_native.get() + state.size() * (begin + levels_flat_start[l_idx - 1]);",
          "content_same": false
        },
        {
          "line": 202,
          "old_api": null,
          "new_api": "GetVectorType",
          "old_text": null,
          "new_text": "leaf.GetVectorType()",
          "old_line_content": "\t\t\t\tauto &v = inputs.data[i];",
          "new_line_content": "\t\t\t\tD_ASSERT(leaf.GetVectorType() == VectorType::FLAT_VECTOR);",
          "content_same": false
        },
        {
          "line": 334,
          "old_api": null,
          "new_api": "D_ASSERT",
          "old_text": null,
          "new_text": "D_ASSERT(input_ref)",
          "old_line_content": "\t\t}",
          "new_line_content": "\tD_ASSERT(input_ref);",
          "content_same": false
        },
        {
          "line": 207,
          "old_api": null,
          "new_api": "Initialize",
          "old_text": null,
          "new_text": "filter_sel.Initialize()",
          "old_line_content": "\t\t\t\tdefault:",
          "new_line_content": "\t\t\tfilter_sel.Initialize();",
          "content_same": false
        },
        {
          "line": 335,
          "old_api": null,
          "new_api": "ColumnCount",
          "old_text": null,
          "new_text": "inputs.ColumnCount()",
          "old_line_content": "\t}",
          "new_line_content": "\tD_ASSERT(inputs.ColumnCount() > 0);",
          "content_same": false
        },
        {
          "line": 209,
          "old_api": null,
          "new_api": "Slice",
          "old_text": null,
          "new_text": "inputs.Slice(filter_sel, STANDARD_VECTOR_SIZE)",
          "old_line_content": "\t\t\t\t}",
          "new_line_content": "\t\t\tinputs.Slice(filter_sel, STANDARD_VECTOR_SIZE);",
          "content_same": false
        },
        {
          "line": 210,
          "old_api": null,
          "new_api": "UseCombineAPI",
          "old_text": null,
          "new_text": "UseCombineAPI()",
          "old_line_content": "\t\t\t}",
          "new_line_content": "\t\t\tif (aggr.function.combine && UseCombineAPI()) {",
          "content_same": false
        },
        {
          "line": 211,
          "old_api": null,
          "new_api": "ConstructTree",
          "old_text": null,
          "new_text": "ConstructTree()",
          "old_line_content": "\t\t\t//\tThe inputs share an SV so we can quickly pick out values",
          "new_line_content": "\t\t\t\tConstructTree();",
          "content_same": false
        },
        {
          "line": 345,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "levels_flat_start.push_back(0)",
          "old_line_content": "\tdo {",
          "new_line_content": "\tlevels_flat_start.push_back(0);",
          "content_same": false
        },
        {
          "line": 380,
          "old_api": null,
          "new_api": "UseWindowAPI",
          "old_text": null,
          "new_text": "UseWindowAPI()",
          "old_line_content": "void WindowSegmentTree::Compute(Vector &result, idx_t rid, idx_t begin, idx_t end) {",
          "new_line_content": "\tif (aggr.function.window && UseWindowAPI()) {",
          "content_same": false
        },
        {
          "line": 222,
          "old_api": null,
          "new_api": "Allocator::DefaultAllocator()",
          "old_text": null,
          "new_text": "Allocator::DefaultAllocator()",
          "old_line_content": "WindowSegmentTree::~WindowSegmentTree() {",
          "new_line_content": "\tAggregateInputData aggr_input_data(aggr.GetFunctionData(), Allocator::DefaultAllocator());",
          "content_same": false
        },
        {
          "line": 352,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "input_ref->size()",
          "old_line_content": "\tidx_t levels_flat_offset = 0;",
          "new_line_content": "\twhile ((level_size = (level_current == 0 ? input_ref->size()",
          "content_same": false
        },
        {
          "line": 228,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "state.size()",
          "old_line_content": "\t// call the destructor for all the intermediate states",
          "new_line_content": "\t\taddress_data[count++] = data_ptr_t(levels_flat_native.get() + i * state.size());",
          "content_same": false
        },
        {
          "line": 356,
          "old_api": null,
          "new_api": "AggregateInit",
          "old_text": null,
          "new_text": "AggregateInit()",
          "old_line_content": "\t// iterate over the levels of the segment tree",
          "new_line_content": "\t\t\tAggregateInit();",
          "content_same": false
        },
        {
          "line": 230,
          "old_api": null,
          "new_api": "destructor",
          "old_text": null,
          "new_text": "aggr.function.destructor(addresses, aggr_input_data, count)",
          "old_line_content": "\tVector addresses(LogicalType::POINTER, data_ptr_cast(address_data));",
          "new_line_content": "\t\t\taggr.function.destructor(addresses, aggr_input_data, count);",
          "content_same": false
        },
        {
          "line": 358,
          "old_api": null,
          "new_api": "FlushStates",
          "old_text": null,
          "new_text": "FlushStates(level_current)",
          "old_line_content": "\t                                         : levels_flat_offset - levels_flat_start[level_current - 1])) > 1) {",
          "new_line_content": "\t\t\tFlushStates(level_current);",
          "content_same": false
        },
        {
          "line": 360,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "state.size()",
          "old_line_content": "\t\t\t// compute the aggregate for this entry in the segment tree",
          "new_line_content": "\t\t\tmemcpy(levels_flat_native.get() + (levels_flat_offset * state.size()), state.data(), state.size());",
          "content_same": false
        },
        {
          "line": 238,
          "old_api": null,
          "new_api": "UseWindowAPI",
          "old_text": null,
          "new_text": "UseWindowAPI()",
          "old_line_content": "\t}",
          "new_line_content": "\tif (aggr.function.window && UseWindowAPI()) {",
          "content_same": false
        },
        {
          "line": 239,
          "old_api": null,
          "new_api": "destructor",
          "old_text": null,
          "new_text": "aggr.function.destructor(statef, aggr_input_data, 1)",
          "old_line_content": "\tif (count > 0) {",
          "new_line_content": "\t\taggr.function.destructor(statef, aggr_input_data, 1);",
          "content_same": false
        },
        {
          "line": 371,
          "old_api": null,
          "new_api": "get",
          "old_text": null,
          "new_text": "levels_flat_native.get()",
          "old_line_content": "\t\tlevel_current++;",
          "new_line_content": "\t\taggr.function.initialize(levels_flat_native.get());",
          "content_same": false
        },
        {
          "line": 248,
          "old_api": null,
          "new_api": "Allocator::DefaultAllocator()",
          "old_text": null,
          "new_text": "Allocator::DefaultAllocator()",
          "old_line_content": "void WindowSegmentTree::AggregateInit() {",
          "new_line_content": "\tAggregateInputData aggr_input_data(aggr.GetFunctionData(), Allocator::DefaultAllocator());",
          "content_same": false
        },
        {
          "line": 252,
          "old_api": null,
          "new_api": "destructor",
          "old_text": null,
          "new_text": "aggr.function.destructor(statef, aggr_input_data, 1)",
          "old_line_content": "void WindowSegmentTree::AggegateFinal(Vector &result, idx_t rid) {",
          "new_line_content": "\t\taggr.function.destructor(statef, aggr_input_data, 1);",
          "content_same": false
        },
        {
          "line": 383,
          "old_api": null,
          "new_api": "FrameBounds",
          "old_text": null,
          "new_text": "FrameBounds(begin, end)",
          "old_line_content": "\t// If we have a window function, use that",
          "new_line_content": "\t\tframe = FrameBounds(begin, end);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 257,
          "old_api": "destructor",
          "new_api": null,
          "old_text": "aggr.function.destructor(statef, aggr_input_data, 1)",
          "new_text": null,
          "old_line_content": "\t\taggr.function.destructor(statef, aggr_input_data, 1);",
          "new_line_content": "\tif (!flush_count) {",
          "content_same": false
        },
        {
          "line": 385,
          "old_api": "UseWindowAPI",
          "new_api": null,
          "old_text": "UseWindowAPI()",
          "new_text": null,
          "old_line_content": "\tif (aggr.function.window && UseWindowAPI()) {",
          "new_line_content": "\t\t// Extract the range",
          "content_same": false
        },
        {
          "line": 388,
          "old_api": "FrameBounds",
          "new_api": null,
          "old_text": "FrameBounds(begin, end)",
          "new_text": null,
          "old_line_content": "\t\tframe = FrameBounds(begin, end);",
          "new_line_content": "\t\t                     frame, prev, result, rid, 0);",
          "content_same": false
        },
        {
          "line": 391,
          "old_api": "Allocator::DefaultAllocator()",
          "new_api": null,
          "old_text": "Allocator::DefaultAllocator()",
          "new_text": null,
          "old_line_content": "\t\tAggregateInputData aggr_input_data(aggr.GetFunctionData(), Allocator::DefaultAllocator());",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 268,
          "old_api": "Verify",
          "new_api": null,
          "old_text": "statel.Verify(flush_count)",
          "new_text": null,
          "old_line_content": "\t\tstatel.Verify(flush_count);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 269,
          "old_api": "combine",
          "new_api": null,
          "old_text": "aggr.function.combine(statel, statep, aggr_input_data, flush_count)",
          "new_text": null,
          "old_line_content": "\t\taggr.function.combine(statel, statep, aggr_input_data, flush_count);",
          "new_line_content": "\t\t//\tSome update functions mangle our dictionaries.",
          "content_same": false
        },
        {
          "line": 272,
          "old_api": "ColumnCount",
          "new_api": null,
          "old_text": "inputs.ColumnCount()",
          "new_text": null,
          "old_line_content": "\t\taggr.function.update(&inputs.data[0], aggr_input_data, inputs.ColumnCount(), statep, flush_count);",
          "new_line_content": "\t\t\tauto &v = inputs.data[i];",
          "content_same": false
        },
        {
          "line": 402,
          "old_api": "UseCombineAPI",
          "new_api": null,
          "old_text": "UseCombineAPI()",
          "new_text": null,
          "old_line_content": "\tif (!aggr.function.combine || !UseCombineAPI()) {",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 403,
          "old_api": "WindowSegmentValue",
          "new_api": null,
          "old_text": "WindowSegmentValue(l_idx, begin, end)",
          "new_text": null,
          "old_line_content": "\t\tWindowSegmentValue(l_idx, begin, end);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 276,
          "old_api": "ColumnCount",
          "new_api": null,
          "old_text": "inputs.ColumnCount()",
          "new_text": null,
          "old_line_content": "\t\tfor (column_t i = 0; i < inputs.ColumnCount(); i++) {",
          "new_line_content": "\t\t\t}",
          "content_same": false
        },
        {
          "line": 405,
          "old_api": "AggegateFinal",
          "new_api": null,
          "old_text": "AggegateFinal(result, rid)",
          "new_text": null,
          "old_line_content": "\t\tAggegateFinal(result, rid);",
          "new_line_content": "\t\tidx_t parent_begin = begin / TREE_FANOUT;",
          "content_same": false
        },
        {
          "line": 278,
          "old_api": "GetVectorType",
          "new_api": null,
          "old_text": "v.GetVectorType()",
          "new_text": null,
          "old_line_content": "\t\t\tif (v.GetVectorType() != VectorType::DICTIONARY_VECTOR ||",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 279,
          "old_api": "data",
          "new_api": null,
          "old_text": "filter_sel.data()",
          "new_text": null,
          "old_line_content": "\t\t\t    DictionaryVector::SelVector(v).data() != filter_sel.data()) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 280,
          "old_api": "Slice",
          "new_api": null,
          "old_text": "v.Slice(input_ref->data[i], filter_sel, STANDARD_VECTOR_SIZE)",
          "new_text": null,
          "old_line_content": "\t\t\t\tv.Slice(input_ref->data[i], filter_sel, STANDARD_VECTOR_SIZE);",
          "new_line_content": "\tflush_count = 0;",
          "content_same": false
        },
        {
          "line": 409,
          "old_api": "size",
          "new_api": null,
          "old_text": "levels_flat_start.size()",
          "new_text": null,
          "old_line_content": "\tfor (; l_idx < levels_flat_start.size() + 1; l_idx++) {",
          "new_line_content": "\t\t\tbreak;",
          "content_same": false
        },
        {
          "line": 295,
          "old_api": "AllValid",
          "new_api": null,
          "old_text": "filter_mask.AllValid()",
          "new_text": null,
          "old_line_content": "\tif (filter_mask.AllValid()) {",
          "new_line_content": "\t\t\t}",
          "content_same": false
        },
        {
          "line": 423,
          "old_api": "WindowSegmentValue",
          "new_api": null,
          "old_text": "WindowSegmentValue(l_idx, group_end, end)",
          "new_text": null,
          "old_line_content": "\t\t\tWindowSegmentValue(l_idx, group_end, end);",
          "new_line_content": "\t\t//\tFlush leaf values separately.",
          "content_same": false
        },
        {
          "line": 297,
          "old_api": "set_index",
          "new_api": null,
          "old_text": "filter_sel.set_index(flush_count++, begin + i)",
          "new_text": null,
          "old_line_content": "\t\t\tfilter_sel.set_index(flush_count++, begin + i);",
          "new_line_content": "\t} else {",
          "content_same": false
        },
        {
          "line": 430,
          "old_api": "FlushStates",
          "new_api": null,
          "old_text": "FlushStates(l_idx)",
          "new_text": null,
          "old_line_content": "\t\t\tFlushStates(l_idx);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 304,
          "old_api": "RowIsValid",
          "new_api": null,
          "old_text": "filter_mask.RowIsValid(i)",
          "new_text": null,
          "old_line_content": "\t\t\tif (filter_mask.RowIsValid(i)) {",
          "new_line_content": "\t\t\t}",
          "content_same": false
        },
        {
          "line": 305,
          "old_api": "set_index",
          "new_api": null,
          "old_text": "filter_sel.set_index(flush_count++, i)",
          "new_text": null,
          "old_line_content": "\t\t\t\tfilter_sel.set_index(flush_count++, i);",
          "new_line_content": "\t\t}",
          "content_same": false
        },
        {
          "line": 434,
          "old_api": "FlushStates",
          "new_api": null,
          "old_text": "FlushStates(l_idx)",
          "new_text": null,
          "old_line_content": "\tFlushStates(l_idx);",
          "new_line_content": "} // namespace duckdb",
          "content_same": false
        },
        {
          "line": 307,
          "old_api": "FlushStates",
          "new_api": null,
          "old_text": "FlushStates(0)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\tFlushStates(0);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 436,
          "old_api": "AggegateFinal",
          "new_api": null,
          "old_text": "AggegateFinal(result, rid)",
          "new_text": null,
          "old_line_content": "\tAggegateFinal(result, rid);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 315,
          "old_api": "D_ASSERT",
          "new_api": null,
          "old_text": "D_ASSERT(begin <= end)",
          "new_text": null,
          "old_line_content": "\tD_ASSERT(begin <= end);",
          "new_line_content": "\tconst auto count = end - begin;",
          "content_same": false
        },
        {
          "line": 316,
          "old_api": "ColumnCount",
          "new_api": null,
          "old_text": "inputs.ColumnCount()",
          "new_text": null,
          "old_line_content": "\tif (begin == end || inputs.ColumnCount() == 0) {",
          "new_line_content": "\tif (l_idx == 0) {",
          "content_same": false
        },
        {
          "line": 201,
          "old_api": "ColumnCount",
          "new_api": null,
          "old_text": "inputs.ColumnCount()",
          "new_text": null,
          "old_line_content": "\t\t\tfor (column_t i = 0; i < inputs.ColumnCount(); i++) {",
          "new_line_content": "\t\t\tfor (auto &leaf : inputs.data) {",
          "content_same": false
        },
        {
          "line": 330,
          "old_api": "size",
          "new_api": null,
          "old_text": "state.size()",
          "new_text": null,
          "old_line_content": "\t\t\tbegin_ptr += state.size();",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 203,
          "old_api": "GetVectorType",
          "new_api": null,
          "old_text": "v.GetVectorType()",
          "new_text": null,
          "old_line_content": "\t\t\t\tswitch (v.GetVectorType()) {",
          "new_line_content": "\t\t\t}",
          "content_same": false
        },
        {
          "line": 332,
          "old_api": "FlushStates",
          "new_api": null,
          "old_text": "FlushStates(l_idx)",
          "new_text": null,
          "old_line_content": "\t\t\t\tFlushStates(l_idx);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 206,
          "old_api": "size",
          "new_api": null,
          "old_text": "input->size()",
          "new_text": null,
          "old_line_content": "\t\t\t\t\tv.Flatten(input->size());",
          "new_line_content": "\t\t\t//\tinstad of just Slice/Reference.",
          "content_same": false
        },
        {
          "line": 212,
          "old_api": "Initialize",
          "new_api": null,
          "old_text": "filter_sel.Initialize()",
          "new_text": null,
          "old_line_content": "\t\t\tfilter_sel.Initialize();",
          "new_line_content": "\t\t\t}",
          "content_same": false
        },
        {
          "line": 340,
          "old_api": "ColumnCount",
          "new_api": null,
          "old_text": "inputs.ColumnCount()",
          "new_text": null,
          "old_line_content": "\tD_ASSERT(inputs.ColumnCount() > 0);",
          "new_line_content": "\tdo {",
          "content_same": false
        },
        {
          "line": 214,
          "old_api": "Slice",
          "new_api": null,
          "old_text": "inputs.Slice(filter_sel, STANDARD_VECTOR_SIZE)",
          "new_text": null,
          "old_line_content": "\t\t\tinputs.Slice(filter_sel, STANDARD_VECTOR_SIZE);",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 215,
          "old_api": "UseCombineAPI",
          "new_api": null,
          "old_text": "UseCombineAPI()",
          "new_text": null,
          "old_line_content": "\t\t\tif (aggr.function.combine && UseCombineAPI()) {",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 216,
          "old_api": "ConstructTree",
          "new_api": null,
          "old_text": "ConstructTree()",
          "new_text": null,
          "old_line_content": "\t\t\t\tConstructTree();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 349,
          "old_api": "size",
          "new_api": null,
          "old_text": "state.size()",
          "new_text": null,
          "old_line_content": "\tlevels_flat_native = make_unsafe_uniq_array<data_t>(internal_nodes * state.size());",
          "new_line_content": "\t// level 0 is data itself",
          "content_same": false
        },
        {
          "line": 350,
          "old_api": "push_back",
          "new_api": null,
          "old_text": "levels_flat_start.push_back(0)",
          "new_text": null,
          "old_line_content": "\tlevels_flat_start.push_back(0);",
          "new_line_content": "\tidx_t level_size;",
          "content_same": false
        },
        {
          "line": 227,
          "old_api": "Allocator::DefaultAllocator()",
          "new_api": null,
          "old_text": "Allocator::DefaultAllocator()",
          "new_text": null,
          "old_line_content": "\tAggregateInputData aggr_input_data(aggr.GetFunctionData(), Allocator::DefaultAllocator());",
          "new_line_content": "\tfor (idx_t i = 0; i < internal_nodes; i++) {",
          "content_same": false
        },
        {
          "line": 233,
          "old_api": "size",
          "new_api": null,
          "old_text": "state.size()",
          "new_text": null,
          "old_line_content": "\t\taddress_data[count++] = data_ptr_t(levels_flat_native.get() + i * state.size());",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 361,
          "old_api": "AggregateInit",
          "new_api": null,
          "old_text": "AggregateInit()",
          "new_text": null,
          "old_line_content": "\t\t\tAggregateInit();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 362,
          "old_api": "MinValue",
          "new_api": null,
          "old_text": "MinValue(level_size, pos + TREE_FANOUT)",
          "new_text": null,
          "old_line_content": "\t\t\tWindowSegmentValue(level_current, pos, MinValue(level_size, pos + TREE_FANOUT));",
          "new_line_content": "\t\t\tlevels_flat_offset++;",
          "content_same": false
        },
        {
          "line": 363,
          "old_api": "FlushStates",
          "new_api": null,
          "old_text": "FlushStates(level_current)",
          "new_text": null,
          "old_line_content": "\t\t\tFlushStates(level_current);",
          "new_line_content": "\t\t}",
          "content_same": false
        },
        {
          "line": 240,
          "old_api": "destructor",
          "new_api": null,
          "old_text": "aggr.function.destructor(addresses, aggr_input_data, count)",
          "new_text": null,
          "old_line_content": "\t\taggr.function.destructor(addresses, aggr_input_data, count);",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 370,
          "old_api": "push_back",
          "new_api": null,
          "old_text": "levels_flat_start.push_back(levels_flat_offset)",
          "new_text": null,
          "old_line_content": "\t\tlevels_flat_start.push_back(levels_flat_offset);",
          "new_line_content": "\tif (levels_flat_offset == 0) {",
          "content_same": false
        },
        {
          "line": 243,
          "old_api": "UseWindowAPI",
          "new_api": null,
          "old_text": "UseWindowAPI()",
          "new_text": null,
          "old_line_content": "\tif (aggr.function.window && UseWindowAPI()) {",
          "new_line_content": "void WindowSegmentTree::AggregateInit() {",
          "content_same": false
        },
        {
          "line": 381,
          "old_api": "D_ASSERT",
          "new_api": null,
          "old_text": "D_ASSERT(input_ref)",
          "new_text": null,
          "old_line_content": "\tD_ASSERT(input_ref);",
          "new_line_content": "\t\t// Frame boundaries",
          "content_same": false
        },
        {
          "line": 253,
          "old_api": "Allocator::DefaultAllocator()",
          "new_api": null,
          "old_text": "Allocator::DefaultAllocator()",
          "new_text": null,
          "old_line_content": "\tAggregateInputData aggr_input_data(aggr.GetFunctionData(), Allocator::DefaultAllocator());",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 254,
          "old_api": "finalize",
          "new_api": null,
          "old_text": "aggr.function.finalize(statef, aggr_input_data, result, 1, rid)",
          "new_text": null,
          "old_line_content": "\taggr.function.finalize(statef, aggr_input_data, result, 1, rid);",
          "new_line_content": "}",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 15,
      "total_additions": 47,
      "total_deletions": 49,
      "total_api_changes": 111
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 10,
        "api_related_lines": 111,
        "non_api_lines": 4,
        "non_api_line_numbers": [
          200,
          204,
          205,
          208
        ]
      }
    },
    "api_calls_before": 172,
    "api_calls_after": 170,
    "diff_info": {
      "added_lines": 5,
      "removed_lines": 10,
      "total_diff_lines": 29
    }
  }
}