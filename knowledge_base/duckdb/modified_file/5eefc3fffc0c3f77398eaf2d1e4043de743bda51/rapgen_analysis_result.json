{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/duckdb/modified_file/5eefc3fffc0c3f77398eaf2d1e4043de743bda51",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/duckdb/modified_file/5eefc3fffc0c3f77398eaf2d1e4043de743bda51/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/duckdb/modified_file/5eefc3fffc0c3f77398eaf2d1e4043de743bda51/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/duckdb/modified_file/5eefc3fffc0c3f77398eaf2d1e4043de743bda51/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 105,
          "old_api": "std::move(plan)",
          "new_api": "VisitOperator",
          "old_text": "std::move(plan)",
          "new_text": "rewriter.VisitOperator(*plan)",
          "old_line_content": "\t\tplan = filter_pullup.Rewrite(std::move(plan));",
          "new_line_content": "\tRunOptimizer(OptimizerType::EXPRESSION_REWRITER, [&]() { rewriter.VisitOperator(*plan); });",
          "content_same": false
        },
        {
          "line": 132,
          "old_api": "Optimize",
          "new_api": "std::move(plan)",
          "old_text": "RunOptimizer(OptimizerType::JOIN_ORDER, [&]() {\n\t\tJoinOrderOptimizer optimizer(context);\n\t\tplan = optimizer.Optimize(std::move(plan));\n\t})",
          "new_text": "std::move(plan)",
          "old_line_content": "\tRunOptimizer(OptimizerType::JOIN_ORDER, [&]() {",
          "new_line_content": "\t\tplan = deliminator.Optimize(std::move(plan));",
          "content_same": false
        },
        {
          "line": 188,
          "old_api": "PropagateStatistics",
          "new_api": "VisitOperator",
          "old_text": "RunOptimizer(OptimizerType::STATISTICS_PROPAGATION, [&]() {\n\t\tStatisticsPropagator propagator(*this, *plan);\n\t\tpropagator.PropagateStatistics(plan);\n\t\tstatistics_map = propagator.GetStatisticsMap();\n\t})",
          "new_text": "column_lifetime.VisitOperator(*plan)",
          "old_line_content": "\tRunOptimizer(OptimizerType::STATISTICS_PROPAGATION, [&]() {",
          "new_line_content": "\t\tcolumn_lifetime.VisitOperator(*plan);",
          "content_same": false
        },
        {
          "line": 195,
          "old_api": "VisitOperator",
          "new_api": "PropagateStatistics",
          "old_text": "RunOptimizer(OptimizerType::COMMON_AGGREGATE, [&]() {\n\t\tCommonAggregateOptimizer common_aggregate;\n\t\tcommon_aggregate.VisitOperator(*plan);\n\t})",
          "new_text": "propagator.PropagateStatistics(plan)",
          "old_line_content": "\tRunOptimizer(OptimizerType::COMMON_AGGREGATE, [&]() {",
          "new_line_content": "\t\tpropagator.PropagateStatistics(plan);",
          "content_same": false
        },
        {
          "line": 212,
          "old_api": "DBConfig::GetConfig(context)",
          "new_api": "Rewrite",
          "old_text": "DBConfig::GetConfig(context)",
          "new_text": "RunOptimizer(OptimizerType::REORDER_FILTER, [&]() {\n\t\tExpressionHeuristics expression_heuristics(*this);\n\t\tplan = expression_heuristics.Rewrite(std::move(plan));\n\t})",
          "old_line_content": "\tfor (auto &optimizer_extension : DBConfig::GetConfig(context).optimizer_extensions) {",
          "new_line_content": "\tRunOptimizer(OptimizerType::REORDER_FILTER, [&]() {",
          "content_same": false
        },
        {
          "line": 214,
          "old_api": "get",
          "new_api": "std::move(plan)",
          "old_text": "optimizer_extension.optimizer_info.get()",
          "new_text": "std::move(plan)",
          "old_line_content": "\t\t\tOptimizerExtensionInput input {GetContext(), *this, optimizer_extension.optimizer_info.get()};",
          "new_line_content": "\t\tplan = expression_heuristics.Rewrite(std::move(plan));",
          "content_same": false
        },
        {
          "line": 219,
          "old_api": "Planner::VerifyPlan(context, plan)",
          "new_api": "get",
          "old_text": "Planner::VerifyPlan(context, plan)",
          "new_text": "optimizer_extension.optimizer_info.get()",
          "old_line_content": "\tPlanner::VerifyPlan(context, plan);",
          "new_line_content": "\t\t\tOptimizerExtensionInput input {GetContext(), *this, optimizer_extension.optimizer_info.get()};",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 130,
          "old_api": null,
          "new_api": "Optimize",
          "old_text": null,
          "new_text": "RunOptimizer(OptimizerType::DELIMINATOR, [&]() {\n\t\tDeliminator deliminator;\n\t\tplan = deliminator.Optimize(std::move(plan));\n\t})",
          "old_line_content": "\t// then we perform the join ordering optimization",
          "new_line_content": "\tRunOptimizer(OptimizerType::DELIMINATOR, [&]() {",
          "content_same": false
        },
        {
          "line": 137,
          "old_api": null,
          "new_api": "Optimize",
          "old_text": null,
          "new_text": "RunOptimizer(OptimizerType::JOIN_ORDER, [&]() {\n\t\tJoinOrderOptimizer optimizer(context);\n\t\tplan = optimizer.Optimize(std::move(plan));\n\t})",
          "old_line_content": "\t// rewrites UNNESTs in DelimJoins by moving them to the projection",
          "new_line_content": "\tRunOptimizer(OptimizerType::JOIN_ORDER, [&]() {",
          "content_same": false
        },
        {
          "line": 139,
          "old_api": null,
          "new_api": "std::move(plan)",
          "old_text": null,
          "new_text": "std::move(plan)",
          "old_line_content": "\t\tUnnestRewriter unnest_rewriter;",
          "new_line_content": "\t\tplan = optimizer.Optimize(std::move(plan));",
          "content_same": false
        },
        {
          "line": 143,
          "old_api": null,
          "new_api": "Optimize",
          "old_text": null,
          "new_text": "RunOptimizer(OptimizerType::UNNEST_REWRITER, [&]() {\n\t\tUnnestRewriter unnest_rewriter;\n\t\tplan = unnest_rewriter.Optimize(std::move(plan));\n\t})",
          "old_line_content": "\t// removes unused columns",
          "new_line_content": "\tRunOptimizer(OptimizerType::UNNEST_REWRITER, [&]() {",
          "content_same": false
        },
        {
          "line": 145,
          "old_api": null,
          "new_api": "std::move(plan)",
          "old_text": null,
          "new_text": "std::move(plan)",
          "old_line_content": "\t\tRemoveUnusedColumns unused(binder, context, true);",
          "new_line_content": "\t\tplan = unnest_rewriter.Optimize(std::move(plan));",
          "content_same": false
        },
        {
          "line": 149,
          "old_api": null,
          "new_api": "VisitOperator",
          "old_text": null,
          "new_text": "RunOptimizer(OptimizerType::UNUSED_COLUMNS, [&]() {\n\t\tRemoveUnusedColumns unused(binder, context, true);\n\t\tunused.VisitOperator(*plan);\n\t})",
          "old_line_content": "\t// Remove duplicate groups from aggregates",
          "new_line_content": "\tRunOptimizer(OptimizerType::UNUSED_COLUMNS, [&]() {",
          "content_same": false
        },
        {
          "line": 151,
          "old_api": null,
          "new_api": "VisitOperator",
          "old_text": null,
          "new_text": "unused.VisitOperator(*plan)",
          "old_line_content": "\t\tRemoveDuplicateGroups remove;",
          "new_line_content": "\t\tunused.VisitOperator(*plan);",
          "content_same": false
        },
        {
          "line": 155,
          "old_api": null,
          "new_api": "VisitOperator",
          "old_text": null,
          "new_text": "RunOptimizer(OptimizerType::DUPLICATE_GROUPS, [&]() {\n\t\tRemoveDuplicateGroups remove;\n\t\tremove.VisitOperator(*plan);\n\t})",
          "old_line_content": "\t// then we extract common subexpressions inside the different operators",
          "new_line_content": "\tRunOptimizer(OptimizerType::DUPLICATE_GROUPS, [&]() {",
          "content_same": false
        },
        {
          "line": 157,
          "old_api": null,
          "new_api": "VisitOperator",
          "old_text": null,
          "new_text": "remove.VisitOperator(*plan)",
          "old_line_content": "\t\tCommonSubExpressionOptimizer cse_optimizer(binder);",
          "new_line_content": "\t\tremove.VisitOperator(*plan);",
          "content_same": false
        },
        {
          "line": 161,
          "old_api": null,
          "new_api": "VisitOperator",
          "old_text": null,
          "new_text": "RunOptimizer(OptimizerType::COMMON_SUBEXPRESSIONS, [&]() {\n\t\tCommonSubExpressionOptimizer cse_optimizer(binder);\n\t\tcse_optimizer.VisitOperator(*plan);\n\t})",
          "old_line_content": "\t// Once we know the column lifetime, we have more information regarding",
          "new_line_content": "\tRunOptimizer(OptimizerType::COMMON_SUBEXPRESSIONS, [&]() {",
          "content_same": false
        },
        {
          "line": 168,
          "old_api": null,
          "new_api": "VisitOperator",
          "old_text": null,
          "new_text": "RunOptimizer(OptimizerType::BUILD_SIDE_PROBE_SIDE, [&]() {\n\t\tBuildProbeSideOptimizer build_probe_side_optimizer(context, *plan);\n\t\tbuild_probe_side_optimizer.VisitOperator(*plan);\n\t})",
          "old_line_content": "\t// pushes LIMIT below PROJECTION",
          "new_line_content": "\tRunOptimizer(OptimizerType::BUILD_SIDE_PROBE_SIDE, [&]() {",
          "content_same": false
        },
        {
          "line": 170,
          "old_api": null,
          "new_api": "VisitOperator",
          "old_text": null,
          "new_text": "build_probe_side_optimizer.VisitOperator(*plan)",
          "old_line_content": "\t\tLimitPushdown limit_pushdown;",
          "new_line_content": "\t\tbuild_probe_side_optimizer.VisitOperator(*plan);",
          "content_same": false
        },
        {
          "line": 174,
          "old_api": null,
          "new_api": "Optimize",
          "old_text": null,
          "new_text": "RunOptimizer(OptimizerType::LIMIT_PUSHDOWN, [&]() {\n\t\tLimitPushdown limit_pushdown;\n\t\tplan = limit_pushdown.Optimize(std::move(plan));\n\t})",
          "old_line_content": "\t// transform ORDER BY + LIMIT to TopN",
          "new_line_content": "\tRunOptimizer(OptimizerType::LIMIT_PUSHDOWN, [&]() {",
          "content_same": false
        },
        {
          "line": 176,
          "old_api": null,
          "new_api": "std::move(plan)",
          "old_text": null,
          "new_text": "std::move(plan)",
          "old_line_content": "\t\tTopN topn;",
          "new_line_content": "\t\tplan = limit_pushdown.Optimize(std::move(plan));",
          "content_same": false
        },
        {
          "line": 180,
          "old_api": null,
          "new_api": "Optimize",
          "old_text": null,
          "new_text": "RunOptimizer(OptimizerType::TOP_N, [&]() {\n\t\tTopN topn;\n\t\tplan = topn.Optimize(std::move(plan));\n\t})",
          "old_line_content": "\t// creates projection maps so unused columns are projected out early",
          "new_line_content": "\tRunOptimizer(OptimizerType::TOP_N, [&]() {",
          "content_same": false
        },
        {
          "line": 182,
          "old_api": null,
          "new_api": "std::move(plan)",
          "old_text": null,
          "new_text": "std::move(plan)",
          "old_line_content": "\t\tColumnLifetimeAnalyzer column_lifetime(true);",
          "new_line_content": "\t\tplan = topn.Optimize(std::move(plan));",
          "content_same": false
        },
        {
          "line": 186,
          "old_api": null,
          "new_api": "VisitOperator",
          "old_text": null,
          "new_text": "RunOptimizer(OptimizerType::COLUMN_LIFETIME, [&]() {\n\t\tColumnLifetimeAnalyzer column_lifetime(true);\n\t\tcolumn_lifetime.VisitOperator(*plan);\n\t})",
          "old_line_content": "\t// perform statistics propagation",
          "new_line_content": "\tRunOptimizer(OptimizerType::COLUMN_LIFETIME, [&]() {",
          "content_same": false
        },
        {
          "line": 193,
          "old_api": null,
          "new_api": "PropagateStatistics",
          "old_text": null,
          "new_text": "RunOptimizer(OptimizerType::STATISTICS_PROPAGATION, [&]() {\n\t\tStatisticsPropagator propagator(*this, *plan);\n\t\tpropagator.PropagateStatistics(plan);\n\t\tstatistics_map = propagator.GetStatisticsMap();\n\t})",
          "old_line_content": "",
          "new_line_content": "\tRunOptimizer(OptimizerType::STATISTICS_PROPAGATION, [&]() {",
          "content_same": false
        },
        {
          "line": 196,
          "old_api": null,
          "new_api": "GetStatisticsMap",
          "old_text": null,
          "new_text": "propagator.GetStatisticsMap()",
          "old_line_content": "\t\tCommonAggregateOptimizer common_aggregate;",
          "new_line_content": "\t\tstatistics_map = propagator.GetStatisticsMap();",
          "content_same": false
        },
        {
          "line": 200,
          "old_api": null,
          "new_api": "VisitOperator",
          "old_text": null,
          "new_text": "RunOptimizer(OptimizerType::COMMON_AGGREGATE, [&]() {\n\t\tCommonAggregateOptimizer common_aggregate;\n\t\tcommon_aggregate.VisitOperator(*plan);\n\t})",
          "old_line_content": "\t// creates projection maps so unused columns are projected out early",
          "new_line_content": "\tRunOptimizer(OptimizerType::COMMON_AGGREGATE, [&]() {",
          "content_same": false
        },
        {
          "line": 202,
          "old_api": null,
          "new_api": "VisitOperator",
          "old_text": null,
          "new_text": "common_aggregate.VisitOperator(*plan)",
          "old_line_content": "\t\tColumnLifetimeAnalyzer column_lifetime(true);",
          "new_line_content": "\t\tcommon_aggregate.VisitOperator(*plan);",
          "content_same": false
        },
        {
          "line": 206,
          "old_api": null,
          "new_api": "VisitOperator",
          "old_text": null,
          "new_text": "RunOptimizer(OptimizerType::COLUMN_LIFETIME, [&]() {\n\t\tColumnLifetimeAnalyzer column_lifetime(true);\n\t\tcolumn_lifetime.VisitOperator(*plan);\n\t})",
          "old_line_content": "\t// apply simple expression heuristics to get an initial reordering",
          "new_line_content": "\tRunOptimizer(OptimizerType::COLUMN_LIFETIME, [&]() {",
          "content_same": false
        },
        {
          "line": 208,
          "old_api": null,
          "new_api": "VisitOperator",
          "old_text": null,
          "new_text": "column_lifetime.VisitOperator(*plan)",
          "old_line_content": "\t\tExpressionHeuristics expression_heuristics(*this);",
          "new_line_content": "\t\tcolumn_lifetime.VisitOperator(*plan);",
          "content_same": false
        },
        {
          "line": 217,
          "old_api": null,
          "new_api": "DBConfig::GetConfig(context)",
          "old_text": null,
          "new_text": "DBConfig::GetConfig(context)",
          "old_line_content": "\t}",
          "new_line_content": "\tfor (auto &optimizer_extension : DBConfig::GetConfig(context).optimizer_extensions) {",
          "content_same": false
        },
        {
          "line": 218,
          "old_api": null,
          "new_api": "get",
          "old_text": null,
          "new_text": "RunOptimizer(OptimizerType::EXTENSION, [&]() {\n\t\t\tOptimizerExtensionInput input {GetContext(), *this, optimizer_extension.optimizer_info.get()};\n\t\t\toptimizer_extension.optimize_function(input, plan);\n\t\t})",
          "old_line_content": "",
          "new_line_content": "\t\tRunOptimizer(OptimizerType::EXTENSION, [&]() {",
          "content_same": false
        },
        {
          "line": 220,
          "old_api": null,
          "new_api": "optimize_function",
          "old_text": null,
          "new_text": "optimizer_extension.optimize_function(input, plan)",
          "old_line_content": "",
          "new_line_content": "\t\t\toptimizer_extension.optimize_function(input, plan);",
          "content_same": false
        },
        {
          "line": 224,
          "old_api": null,
          "new_api": "Planner::VerifyPlan(context, plan)",
          "old_text": null,
          "new_text": "Planner::VerifyPlan(context, plan)",
          "old_line_content": "} // namespace duckdb",
          "new_line_content": "\tPlanner::VerifyPlan(context, plan);",
          "content_same": false
        },
        {
          "line": 226,
          "old_api": null,
          "new_api": "std::move(plan)",
          "old_text": null,
          "new_text": "std::move(plan)",
          "old_line_content": "",
          "new_line_content": "\treturn std::move(plan);",
          "content_same": false
        },
        {
          "line": 102,
          "old_api": null,
          "new_api": "std::move(plan_p)",
          "old_text": null,
          "new_text": "std::move(plan_p)",
          "old_line_content": "\t// perform filter pullup",
          "new_line_content": "\tthis->plan = std::move(plan_p);",
          "content_same": false
        },
        {
          "line": 108,
          "old_api": null,
          "new_api": "Rewrite",
          "old_text": null,
          "new_text": "RunOptimizer(OptimizerType::FILTER_PULLUP, [&]() {\n\t\tFilterPullup filter_pullup;\n\t\tplan = filter_pullup.Rewrite(std::move(plan));\n\t})",
          "old_line_content": "\t// perform filter pushdown",
          "new_line_content": "\tRunOptimizer(OptimizerType::FILTER_PULLUP, [&]() {",
          "content_same": false
        },
        {
          "line": 110,
          "old_api": null,
          "new_api": "std::move(plan)",
          "old_text": null,
          "new_text": "std::move(plan)",
          "old_line_content": "\t\tFilterPushdown filter_pushdown(*this);",
          "new_line_content": "\t\tplan = filter_pullup.Rewrite(std::move(plan));",
          "content_same": false
        },
        {
          "line": 124,
          "old_api": null,
          "new_api": "Rewrite",
          "old_text": null,
          "new_text": "RunOptimizer(OptimizerType::IN_CLAUSE, [&]() {\n\t\tInClauseRewriter ic_rewriter(context, *this);\n\t\tplan = ic_rewriter.Rewrite(std::move(plan));\n\t})",
          "old_line_content": "\t// removes any redundant DelimGets/DelimJoins",
          "new_line_content": "\tRunOptimizer(OptimizerType::IN_CLAUSE, [&]() {",
          "content_same": false
        },
        {
          "line": 126,
          "old_api": null,
          "new_api": "std::move(plan)",
          "old_text": null,
          "new_text": "std::move(plan)",
          "old_line_content": "\t\tDeliminator deliminator;",
          "new_line_content": "\t\tplan = ic_rewriter.Rewrite(std::move(plan));",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 134,
          "old_api": "std::move(plan)",
          "new_api": null,
          "old_text": "std::move(plan)",
          "new_text": null,
          "old_line_content": "\t\tplan = optimizer.Optimize(std::move(plan));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 138,
          "old_api": "Optimize",
          "new_api": null,
          "old_text": "RunOptimizer(OptimizerType::UNNEST_REWRITER, [&]() {\n\t\tUnnestRewriter unnest_rewriter;\n\t\tplan = unnest_rewriter.Optimize(std::move(plan));\n\t})",
          "new_text": null,
          "old_line_content": "\tRunOptimizer(OptimizerType::UNNEST_REWRITER, [&]() {",
          "new_line_content": "\t\tJoinOrderOptimizer optimizer(context);",
          "content_same": false
        },
        {
          "line": 140,
          "old_api": "std::move(plan)",
          "new_api": null,
          "old_text": "std::move(plan)",
          "new_text": null,
          "old_line_content": "\t\tplan = unnest_rewriter.Optimize(std::move(plan));",
          "new_line_content": "\t});",
          "content_same": false
        },
        {
          "line": 144,
          "old_api": "VisitOperator",
          "new_api": null,
          "old_text": "RunOptimizer(OptimizerType::UNUSED_COLUMNS, [&]() {\n\t\tRemoveUnusedColumns unused(binder, context, true);\n\t\tunused.VisitOperator(*plan);\n\t})",
          "new_text": null,
          "old_line_content": "\tRunOptimizer(OptimizerType::UNUSED_COLUMNS, [&]() {",
          "new_line_content": "\t\tUnnestRewriter unnest_rewriter;",
          "content_same": false
        },
        {
          "line": 146,
          "old_api": "VisitOperator",
          "new_api": null,
          "old_text": "unused.VisitOperator(*plan)",
          "new_text": null,
          "old_line_content": "\t\tunused.VisitOperator(*plan);",
          "new_line_content": "\t});",
          "content_same": false
        },
        {
          "line": 150,
          "old_api": "VisitOperator",
          "new_api": null,
          "old_text": "RunOptimizer(OptimizerType::DUPLICATE_GROUPS, [&]() {\n\t\tRemoveDuplicateGroups remove;\n\t\tremove.VisitOperator(*plan);\n\t})",
          "new_text": null,
          "old_line_content": "\tRunOptimizer(OptimizerType::DUPLICATE_GROUPS, [&]() {",
          "new_line_content": "\t\tRemoveUnusedColumns unused(binder, context, true);",
          "content_same": false
        },
        {
          "line": 152,
          "old_api": "VisitOperator",
          "new_api": null,
          "old_text": "remove.VisitOperator(*plan)",
          "new_text": null,
          "old_line_content": "\t\tremove.VisitOperator(*plan);",
          "new_line_content": "\t});",
          "content_same": false
        },
        {
          "line": 156,
          "old_api": "VisitOperator",
          "new_api": null,
          "old_text": "RunOptimizer(OptimizerType::COMMON_SUBEXPRESSIONS, [&]() {\n\t\tCommonSubExpressionOptimizer cse_optimizer(binder);\n\t\tcse_optimizer.VisitOperator(*plan);\n\t})",
          "new_text": null,
          "old_line_content": "\tRunOptimizer(OptimizerType::COMMON_SUBEXPRESSIONS, [&]() {",
          "new_line_content": "\t\tRemoveDuplicateGroups remove;",
          "content_same": false
        },
        {
          "line": 158,
          "old_api": "VisitOperator",
          "new_api": null,
          "old_text": "cse_optimizer.VisitOperator(*plan)",
          "new_text": null,
          "old_line_content": "\t\tcse_optimizer.VisitOperator(*plan);",
          "new_line_content": "\t});",
          "content_same": false
        },
        {
          "line": 165,
          "old_api": "VisitOperator",
          "new_api": null,
          "old_text": "build_probe_side_optimizer.VisitOperator(*plan)",
          "new_text": null,
          "old_line_content": "\t\tbuild_probe_side_optimizer.VisitOperator(*plan);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 169,
          "old_api": "Optimize",
          "new_api": null,
          "old_text": "RunOptimizer(OptimizerType::LIMIT_PUSHDOWN, [&]() {\n\t\tLimitPushdown limit_pushdown;\n\t\tplan = limit_pushdown.Optimize(std::move(plan));\n\t})",
          "new_text": null,
          "old_line_content": "\tRunOptimizer(OptimizerType::LIMIT_PUSHDOWN, [&]() {",
          "new_line_content": "\t\tBuildProbeSideOptimizer build_probe_side_optimizer(context, *plan);",
          "content_same": false
        },
        {
          "line": 171,
          "old_api": "std::move(plan)",
          "new_api": null,
          "old_text": "std::move(plan)",
          "new_text": null,
          "old_line_content": "\t\tplan = limit_pushdown.Optimize(std::move(plan));",
          "new_line_content": "\t});",
          "content_same": false
        },
        {
          "line": 175,
          "old_api": "Optimize",
          "new_api": null,
          "old_text": "RunOptimizer(OptimizerType::TOP_N, [&]() {\n\t\tTopN topn;\n\t\tplan = topn.Optimize(std::move(plan));\n\t})",
          "new_text": null,
          "old_line_content": "\tRunOptimizer(OptimizerType::TOP_N, [&]() {",
          "new_line_content": "\t\tLimitPushdown limit_pushdown;",
          "content_same": false
        },
        {
          "line": 177,
          "old_api": "std::move(plan)",
          "new_api": null,
          "old_text": "std::move(plan)",
          "new_text": null,
          "old_line_content": "\t\tplan = topn.Optimize(std::move(plan));",
          "new_line_content": "\t});",
          "content_same": false
        },
        {
          "line": 181,
          "old_api": "VisitOperator",
          "new_api": null,
          "old_text": "RunOptimizer(OptimizerType::COLUMN_LIFETIME, [&]() {\n\t\tColumnLifetimeAnalyzer column_lifetime(true);\n\t\tcolumn_lifetime.VisitOperator(*plan);\n\t})",
          "new_text": null,
          "old_line_content": "\tRunOptimizer(OptimizerType::COLUMN_LIFETIME, [&]() {",
          "new_line_content": "\t\tTopN topn;",
          "content_same": false
        },
        {
          "line": 183,
          "old_api": "VisitOperator",
          "new_api": null,
          "old_text": "column_lifetime.VisitOperator(*plan)",
          "new_text": null,
          "old_line_content": "\t\tcolumn_lifetime.VisitOperator(*plan);",
          "new_line_content": "\t});",
          "content_same": false
        },
        {
          "line": 190,
          "old_api": "PropagateStatistics",
          "new_api": null,
          "old_text": "propagator.PropagateStatistics(plan)",
          "new_text": null,
          "old_line_content": "\t\tpropagator.PropagateStatistics(plan);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 191,
          "old_api": "GetStatisticsMap",
          "new_api": null,
          "old_text": "propagator.GetStatisticsMap()",
          "new_text": null,
          "old_line_content": "\t\tstatistics_map = propagator.GetStatisticsMap();",
          "new_line_content": "\t// perform statistics propagation",
          "content_same": false
        },
        {
          "line": 197,
          "old_api": "VisitOperator",
          "new_api": null,
          "old_text": "common_aggregate.VisitOperator(*plan)",
          "new_text": null,
          "old_line_content": "\t\tcommon_aggregate.VisitOperator(*plan);",
          "new_line_content": "\t});",
          "content_same": false
        },
        {
          "line": 201,
          "old_api": "VisitOperator",
          "new_api": null,
          "old_text": "RunOptimizer(OptimizerType::COLUMN_LIFETIME, [&]() {\n\t\tColumnLifetimeAnalyzer column_lifetime(true);\n\t\tcolumn_lifetime.VisitOperator(*plan);\n\t})",
          "new_text": null,
          "old_line_content": "\tRunOptimizer(OptimizerType::COLUMN_LIFETIME, [&]() {",
          "new_line_content": "\t\tCommonAggregateOptimizer common_aggregate;",
          "content_same": false
        },
        {
          "line": 203,
          "old_api": "VisitOperator",
          "new_api": null,
          "old_text": "column_lifetime.VisitOperator(*plan)",
          "new_text": null,
          "old_line_content": "\t\tcolumn_lifetime.VisitOperator(*plan);",
          "new_line_content": "\t});",
          "content_same": false
        },
        {
          "line": 207,
          "old_api": "Rewrite",
          "new_api": null,
          "old_text": "RunOptimizer(OptimizerType::REORDER_FILTER, [&]() {\n\t\tExpressionHeuristics expression_heuristics(*this);\n\t\tplan = expression_heuristics.Rewrite(std::move(plan));\n\t})",
          "new_text": null,
          "old_line_content": "\tRunOptimizer(OptimizerType::REORDER_FILTER, [&]() {",
          "new_line_content": "\t\tColumnLifetimeAnalyzer column_lifetime(true);",
          "content_same": false
        },
        {
          "line": 209,
          "old_api": "std::move(plan)",
          "new_api": null,
          "old_text": "std::move(plan)",
          "new_text": null,
          "old_line_content": "\t\tplan = expression_heuristics.Rewrite(std::move(plan));",
          "new_line_content": "\t});",
          "content_same": false
        },
        {
          "line": 213,
          "old_api": "get",
          "new_api": null,
          "old_text": "RunOptimizer(OptimizerType::EXTENSION, [&]() {\n\t\t\tOptimizerExtensionInput input {GetContext(), *this, optimizer_extension.optimizer_info.get()};\n\t\t\toptimizer_extension.optimize_function(input, plan);\n\t\t})",
          "new_text": null,
          "old_line_content": "\t\tRunOptimizer(OptimizerType::EXTENSION, [&]() {",
          "new_line_content": "\t\tExpressionHeuristics expression_heuristics(*this);",
          "content_same": false
        },
        {
          "line": 215,
          "old_api": "optimize_function",
          "new_api": null,
          "old_text": "optimizer_extension.optimize_function(input, plan)",
          "new_text": null,
          "old_line_content": "\t\t\toptimizer_extension.optimize_function(input, plan);",
          "new_line_content": "\t});",
          "content_same": false
        },
        {
          "line": 221,
          "old_api": "std::move(plan)",
          "new_api": null,
          "old_text": "std::move(plan)",
          "new_text": null,
          "old_line_content": "\treturn std::move(plan);",
          "new_line_content": "\t\t});",
          "content_same": false
        },
        {
          "line": 97,
          "old_api": "std::move(plan_p)",
          "new_api": null,
          "old_text": "std::move(plan_p)",
          "new_text": null,
          "old_line_content": "\tthis->plan = std::move(plan_p);",
          "new_line_content": "\t\treturn plan_p; // skip optimizing simple & often-occurring plans unaffected by rewrites",
          "content_same": false
        },
        {
          "line": 100,
          "old_api": "VisitOperator",
          "new_api": null,
          "old_text": "rewriter.VisitOperator(*plan)",
          "new_text": null,
          "old_line_content": "\tRunOptimizer(OptimizerType::EXPRESSION_REWRITER, [&]() { rewriter.VisitOperator(*plan); });",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 103,
          "old_api": "Rewrite",
          "new_api": null,
          "old_text": "RunOptimizer(OptimizerType::FILTER_PULLUP, [&]() {\n\t\tFilterPullup filter_pullup;\n\t\tplan = filter_pullup.Rewrite(std::move(plan));\n\t})",
          "new_text": null,
          "old_line_content": "\tRunOptimizer(OptimizerType::FILTER_PULLUP, [&]() {",
          "new_line_content": "\t// first we perform expression rewrites using the ExpressionRewriter",
          "content_same": false
        },
        {
          "line": 109,
          "old_api": "Rewrite",
          "new_api": null,
          "old_text": "RunOptimizer(OptimizerType::FILTER_PUSHDOWN, [&]() {\n\t\tFilterPushdown filter_pushdown(*this);\n\t\tplan = filter_pushdown.Rewrite(std::move(plan));\n\t})",
          "new_text": null,
          "old_line_content": "\tRunOptimizer(OptimizerType::FILTER_PUSHDOWN, [&]() {",
          "new_line_content": "\t\tFilterPullup filter_pullup;",
          "content_same": false
        },
        {
          "line": 111,
          "old_api": "std::move(plan)",
          "new_api": null,
          "old_text": "std::move(plan)",
          "new_text": null,
          "old_line_content": "\t\tplan = filter_pushdown.Rewrite(std::move(plan));",
          "new_line_content": "\t});",
          "content_same": false
        },
        {
          "line": 125,
          "old_api": "Optimize",
          "new_api": null,
          "old_text": "RunOptimizer(OptimizerType::DELIMINATOR, [&]() {\n\t\tDeliminator deliminator;\n\t\tplan = deliminator.Optimize(std::move(plan));\n\t})",
          "new_text": null,
          "old_line_content": "\tRunOptimizer(OptimizerType::DELIMINATOR, [&]() {",
          "new_line_content": "\t\tInClauseRewriter ic_rewriter(context, *this);",
          "content_same": false
        },
        {
          "line": 127,
          "old_api": "std::move(plan)",
          "new_api": null,
          "old_text": "std::move(plan)",
          "new_text": null,
          "old_line_content": "\t\tplan = deliminator.Optimize(std::move(plan));",
          "new_line_content": "\t});",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 7,
      "total_additions": 33,
      "total_deletions": 33,
      "total_api_changes": 73
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 5,
        "api_related_lines": 73,
        "non_api_lines": 5,
        "non_api_line_numbers": [
          96,
          92,
          93,
          94,
          95
        ]
      }
    },
    "api_calls_before": 104,
    "api_calls_after": 104,
    "diff_info": {
      "added_lines": 5,
      "removed_lines": 0,
      "total_diff_lines": 17
    }
  }
}