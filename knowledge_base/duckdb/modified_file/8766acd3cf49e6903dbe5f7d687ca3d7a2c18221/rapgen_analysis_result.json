{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/duckdb/modified_file/8766acd3cf49e6903dbe5f7d687ca3d7a2c18221",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/duckdb/modified_file/8766acd3cf49e6903dbe5f7d687ca3d7a2c18221/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/duckdb/modified_file/8766acd3cf49e6903dbe5f7d687ca3d7a2c18221/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/duckdb/modified_file/8766acd3cf49e6903dbe5f7d687ca3d7a2c18221/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 58,
          "old_api": "MergeIndexes",
          "new_api": "InternalException",
          "old_text": "Cast<ART>().MergeIndexes(state, other_index)",
          "new_text": "InternalException(\"Unimplemented index type for merge\")",
          "old_line_content": "\t\treturn Cast<ART>().MergeIndexes(state, other_index);",
          "new_line_content": "\t\tthrow InternalException(\"Unimplemented index type for merge\");",
          "content_same": false
        },
        {
          "line": 71,
          "old_api": "Vacuum",
          "new_api": "InternalException",
          "old_text": "Cast<ART>().Vacuum(state)",
          "new_text": "InternalException(\"Unimplemented index type for vacuum\")",
          "old_line_content": "\t\treturn Cast<ART>().Vacuum(state);",
          "new_line_content": "\t\tthrow InternalException(\"Unimplemented index type for vacuum\");",
          "content_same": false
        },
        {
          "line": 84,
          "old_api": "make_uniq<BoundReferenceExpression>(expr->return_type, column_ids[bound_colref.binding.column_index])",
          "new_api": "ExpressionIterator::EnumerateChildren(\n\t    *expr, [this](unique_ptr<Expression> &expr) { expr = BindExpression(std::move(expr)); })",
          "old_text": "make_uniq<BoundReferenceExpression>(expr->return_type, column_ids[bound_colref.binding.column_index])",
          "new_text": "ExpressionIterator::EnumerateChildren(\n\t    *expr, [this](unique_ptr<Expression> &expr) { expr = BindExpression(std::move(expr)); })",
          "old_line_content": "\t\treturn make_uniq<BoundReferenceExpression>(expr->return_type, column_ids[bound_colref.binding.column_index]);",
          "new_line_content": "\tExpressionIterator::EnumerateChildren(",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 65,
          "old_api": null,
          "new_api": "InitializeLock",
          "old_text": null,
          "new_text": "InitializeLock(state)",
          "old_line_content": "",
          "new_line_content": "\tInitializeLock(state);",
          "content_same": false
        },
        {
          "line": 34,
          "old_api": null,
          "new_api": "unique_lock<mutex>(lock)",
          "old_text": null,
          "new_text": "unique_lock<mutex>(lock)",
          "old_line_content": "",
          "new_line_content": "\tstate.index_lock = unique_lock<mutex>(lock);",
          "content_same": false
        },
        {
          "line": 99,
          "old_api": null,
          "new_api": "NotImplementedException",
          "old_text": null,
          "new_text": "NotImplementedException(\"The implementation of this index serialization does not exist.\")",
          "old_line_content": "",
          "new_line_content": "\tthrow NotImplementedException(\"The implementation of this index serialization does not exist.\");",
          "content_same": false
        },
        {
          "line": 69,
          "old_api": null,
          "new_api": "Vacuum",
          "old_text": null,
          "new_text": "Cast<ART>().Vacuum(state)",
          "old_line_content": "\tswitch (this->type) {",
          "new_line_content": "\t\treturn Cast<ART>().Vacuum(state);",
          "content_same": false
        },
        {
          "line": 39,
          "old_api": null,
          "new_api": "InitializeLock",
          "old_text": null,
          "new_text": "InitializeLock(state)",
          "old_line_content": "PreservedError Index::Append(DataChunk &entries, Vector &row_identifiers) {",
          "new_line_content": "\tInitializeLock(state);",
          "content_same": false
        },
        {
          "line": 40,
          "old_api": null,
          "new_api": "Append",
          "old_text": null,
          "new_text": "Append(state, entries, row_identifiers)",
          "old_line_content": "\tIndexLock state;",
          "new_line_content": "\treturn Append(state, entries, row_identifiers);",
          "content_same": false
        },
        {
          "line": 104,
          "old_api": null,
          "new_api": "ColumnCount",
          "old_text": null,
          "new_text": "input.ColumnCount()",
          "old_line_content": "string Index::AppendRowError(DataChunk &input, idx_t index) {",
          "new_line_content": "\tfor (idx_t c = 0; c < input.ColumnCount(); c++) {",
          "content_same": false
        },
        {
          "line": 76,
          "old_api": null,
          "new_api": "Execute",
          "old_text": null,
          "new_text": "executor.Execute(input, result)",
          "old_line_content": "",
          "new_line_content": "\texecutor.Execute(input, result);",
          "content_same": false
        },
        {
          "line": 45,
          "old_api": null,
          "new_api": "InitializeLock",
          "old_text": null,
          "new_text": "InitializeLock(state)",
          "old_line_content": "void Index::Delete(DataChunk &entries, Vector &row_identifiers) {",
          "new_line_content": "\tInitializeLock(state);",
          "content_same": false
        },
        {
          "line": 46,
          "old_api": null,
          "new_api": "Delete",
          "old_text": null,
          "new_text": "Delete(state, entries, row_identifiers)",
          "old_line_content": "\tIndexLock state;",
          "new_line_content": "\tDelete(state, entries, row_identifiers);",
          "content_same": false
        },
        {
          "line": 108,
          "old_api": null,
          "new_api": "GetValue",
          "old_text": null,
          "new_text": "input.GetValue(c, index).ToString()",
          "old_line_content": "\t\t\terror += \", \";",
          "new_line_content": "\t\terror += input.GetValue(c, index).ToString();",
          "content_same": false
        },
        {
          "line": 81,
          "old_api": null,
          "new_api": "expr->Cast<BoundColumnRefExpression>()",
          "old_text": null,
          "new_text": "expr->Cast<BoundColumnRefExpression>()",
          "old_line_content": "unique_ptr<Expression> Index::BindExpression(unique_ptr<Expression> expr) {",
          "new_line_content": "\t\tauto &bound_colref = expr->Cast<BoundColumnRefExpression>();",
          "content_same": false
        },
        {
          "line": 82,
          "old_api": null,
          "new_api": "make_uniq<BoundReferenceExpression>(expr->return_type, column_ids[bound_colref.binding.column_index])",
          "old_text": null,
          "new_text": "make_uniq<BoundReferenceExpression>(expr->return_type, column_ids[bound_colref.binding.column_index])",
          "old_line_content": "\tif (expr->type == ExpressionType::BOUND_COLUMN_REF) {",
          "new_line_content": "\t\treturn make_uniq<BoundReferenceExpression>(expr->return_type, column_ids[bound_colref.binding.column_index]);",
          "content_same": false
        },
        {
          "line": 52,
          "old_api": null,
          "new_api": "InitializeLock",
          "old_text": null,
          "new_text": "InitializeLock(state)",
          "old_line_content": "",
          "new_line_content": "\tInitializeLock(state);",
          "content_same": false
        },
        {
          "line": 85,
          "old_api": null,
          "new_api": "std::move(expr)",
          "old_text": null,
          "new_text": "std::move(expr)",
          "old_line_content": "\t}",
          "new_line_content": "\t    *expr, [this](unique_ptr<Expression> &expr) { expr = BindExpression(std::move(expr)); });",
          "content_same": false
        },
        {
          "line": 56,
          "old_api": null,
          "new_api": "MergeIndexes",
          "old_text": null,
          "new_text": "Cast<ART>().MergeIndexes(state, other_index)",
          "old_line_content": "\tswitch (this->type) {",
          "new_line_content": "\t\treturn Cast<ART>().MergeIndexes(state, other_index);",
          "content_same": false
        },
        {
          "line": 91,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "column_id_set.end()",
          "old_line_content": "bool Index::IndexIsUpdated(const vector<PhysicalIndex> &column_ids) const {",
          "new_line_content": "\t\tif (column_id_set.find(column.index) != column_id_set.end()) {",
          "content_same": false
        },
        {
          "line": 30,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "column_ids.end()",
          "old_line_content": "\tfor (auto column_id : column_ids) {",
          "new_line_content": "\tcolumn_id_set.insert(column_ids.begin(), column_ids.end());",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 67,
          "old_api": "InitializeLock",
          "new_api": null,
          "old_text": "InitializeLock(state)",
          "new_text": null,
          "old_line_content": "\tInitializeLock(state);",
          "new_line_content": "\tswitch (this->type) {",
          "content_same": false
        },
        {
          "line": 36,
          "old_api": "unique_lock<mutex>(lock)",
          "new_api": null,
          "old_text": "unique_lock<mutex>(lock)",
          "new_text": null,
          "old_line_content": "\tstate.index_lock = unique_lock<mutex>(lock);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 101,
          "old_api": "NotImplementedException",
          "new_api": null,
          "old_text": "NotImplementedException(\"The implementation of this index serialization does not exist.\")",
          "new_text": null,
          "old_line_content": "\tthrow NotImplementedException(\"The implementation of this index serialization does not exist.\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 41,
          "old_api": "InitializeLock",
          "new_api": null,
          "old_text": "InitializeLock(state)",
          "new_text": null,
          "old_line_content": "\tInitializeLock(state);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 42,
          "old_api": "Append",
          "new_api": null,
          "old_text": "Append(state, entries, row_identifiers)",
          "new_text": null,
          "old_line_content": "\treturn Append(state, entries, row_identifiers);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 73,
          "old_api": "InternalException",
          "new_api": null,
          "old_text": "InternalException(\"Unimplemented index type for vacuum\")",
          "new_text": null,
          "old_line_content": "\t\tthrow InternalException(\"Unimplemented index type for vacuum\");",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 106,
          "old_api": "ColumnCount",
          "new_api": null,
          "old_text": "input.ColumnCount()",
          "new_text": null,
          "old_line_content": "\tfor (idx_t c = 0; c < input.ColumnCount(); c++) {",
          "new_line_content": "\t\t\terror += \", \";",
          "content_same": false
        },
        {
          "line": 78,
          "old_api": "Execute",
          "new_api": null,
          "old_text": "executor.Execute(input, result)",
          "new_text": null,
          "old_line_content": "\texecutor.Execute(input, result);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 47,
          "old_api": "InitializeLock",
          "new_api": null,
          "old_text": "InitializeLock(state)",
          "new_text": null,
          "old_line_content": "\tInitializeLock(state);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 48,
          "old_api": "Delete",
          "new_api": null,
          "old_text": "Delete(state, entries, row_identifiers)",
          "new_text": null,
          "old_line_content": "\tDelete(state, entries, row_identifiers);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 110,
          "old_api": "GetValue",
          "new_api": null,
          "old_text": "input.GetValue(c, index).ToString()",
          "new_text": null,
          "old_line_content": "\t\terror += input.GetValue(c, index).ToString();",
          "new_line_content": "\treturn error;",
          "content_same": false
        },
        {
          "line": 83,
          "old_api": "expr->Cast<BoundColumnRefExpression>()",
          "new_api": null,
          "old_text": "expr->Cast<BoundColumnRefExpression>()",
          "new_text": null,
          "old_line_content": "\t\tauto &bound_colref = expr->Cast<BoundColumnRefExpression>();",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 54,
          "old_api": "InitializeLock",
          "new_api": null,
          "old_text": "InitializeLock(state)",
          "new_text": null,
          "old_line_content": "\tInitializeLock(state);",
          "new_line_content": "\tswitch (this->type) {",
          "content_same": false
        },
        {
          "line": 86,
          "old_api": "ExpressionIterator::EnumerateChildren(\n\t    *expr, [this](unique_ptr<Expression> &expr) { expr = BindExpression(std::move(expr)); })",
          "new_api": null,
          "old_text": "ExpressionIterator::EnumerateChildren(\n\t    *expr, [this](unique_ptr<Expression> &expr) { expr = BindExpression(std::move(expr)); })",
          "new_text": null,
          "old_line_content": "\tExpressionIterator::EnumerateChildren(",
          "new_line_content": "\treturn expr;",
          "content_same": false
        },
        {
          "line": 87,
          "old_api": "std::move(expr)",
          "new_api": null,
          "old_text": "std::move(expr)",
          "new_text": null,
          "old_line_content": "\t    *expr, [this](unique_ptr<Expression> &expr) { expr = BindExpression(std::move(expr)); });",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 60,
          "old_api": "InternalException",
          "new_api": null,
          "old_text": "InternalException(\"Unimplemented index type for merge\")",
          "new_text": null,
          "old_line_content": "\t\tthrow InternalException(\"Unimplemented index type for merge\");",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 93,
          "old_api": "end",
          "new_api": null,
          "old_text": "column_id_set.end()",
          "new_text": null,
          "old_line_content": "\t\tif (column_id_set.find(column.index) != column_id_set.end()) {",
          "new_line_content": "\t\t}",
          "content_same": false
        },
        {
          "line": 31,
          "old_api": "insert",
          "new_api": null,
          "old_text": "column_id_set.insert(column_id)",
          "new_text": null,
          "old_line_content": "\t\tcolumn_id_set.insert(column_id);",
          "new_line_content": "}",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 3,
      "total_additions": 18,
      "total_deletions": 18,
      "total_api_changes": 39
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 3,
        "api_related_lines": 39,
        "non_api_lines": 1,
        "non_api_line_numbers": [
          32
        ]
      }
    },
    "api_calls_before": 37,
    "api_calls_after": 39,
    "diff_info": {
      "added_lines": 1,
      "removed_lines": 3,
      "total_diff_lines": 16
    }
  }
}