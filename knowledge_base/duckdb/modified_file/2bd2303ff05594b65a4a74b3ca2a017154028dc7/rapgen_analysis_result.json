{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/duckdb/modified_file/2bd2303ff05594b65a4a74b3ca2a017154028dc7",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/duckdb/modified_file/2bd2303ff05594b65a4a74b3ca2a017154028dc7/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/duckdb/modified_file/2bd2303ff05594b65a4a74b3ca2a017154028dc7/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/duckdb/modified_file/2bd2303ff05594b65a4a74b3ca2a017154028dc7/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 838,
          "old_api": "GetBlockOffset",
          "new_api": "NotImplementedException",
          "old_text": "segment.GetBlockOffset()",
          "new_text": "NotImplementedException(\"TODO\")",
          "old_line_content": "\t\tauto base_ptr = handle.Ptr() + segment.GetBlockOffset();",
          "new_line_content": "\t\tthrow NotImplementedException(\"TODO\");",
          "content_same": false
        },
        {
          "line": 850,
          "old_api": "reserve",
          "new_api": "explicit",
          "old_text": "container_metadata.reserve(container_count)",
          "new_text": "explicit",
          "old_line_content": "\t\tcontainer_metadata.reserve(container_count);",
          "new_line_content": "\texplicit RoaringScanState(ColumnSegment &segment) : segment(segment) {",
          "content_same": false
        },
        {
          "line": 851,
          "old_api": "reserve",
          "new_api": "BufferManager::GetBufferManager(segment.db)",
          "old_text": "data_start_position.reserve(container_count)",
          "new_text": "BufferManager::GetBufferManager(segment.db)",
          "old_line_content": "\t\tdata_start_position.reserve(container_count);",
          "new_line_content": "\t\tauto &buffer_manager = BufferManager::GetBufferManager(segment.db);",
          "content_same": false
        },
        {
          "line": 857,
          "old_api": "push_back",
          "new_api": "GetBlockOffset",
          "old_text": "data_start_position.push_back(position)",
          "new_text": "segment.GetBlockOffset()",
          "old_line_content": "\t\t\tdata_start_position.push_back(position);",
          "new_line_content": "\t\tauto metadata_offset = Load<idx_t>(base_ptr + segment.GetBlockOffset());",
          "content_same": false
        },
        {
          "line": 865,
          "old_api": "NumberOfRuns",
          "new_api": "reserve",
          "old_text": "metadata.NumberOfRuns()",
          "new_text": "container_metadata.reserve(container_count)",
          "old_line_content": "\t\t\treturn sizeof(RunContainerRLEPair) * metadata.NumberOfRuns();",
          "new_line_content": "\t\tcontainer_metadata.reserve(container_count);",
          "content_same": false
        },
        {
          "line": 914,
          "old_api": "reinterpret_cast<RunContainerRLEPair *>(data_ptr)",
          "new_api": "UseContainerStateCache",
          "old_text": "reinterpret_cast<RunContainerRLEPair *>(data_ptr)",
          "new_text": "UseContainerStateCache(container_index, internal_offset)",
          "old_line_content": "\t\t\t\t    container_index, container_size, reinterpret_cast<RunContainerRLEPair *>(data_ptr),",
          "new_line_content": "\t\tif (UseContainerStateCache(container_index, internal_offset)) {",
          "content_same": false
        },
        {
          "line": 917,
          "old_api": "NumberOfRuns",
          "new_api": "GetContainerMetadata",
          "old_text": "make_uniq<RunContainerScanState<NON_NULLS>>(\n\t\t\t\t    container_index, container_size, reinterpret_cast<RunContainerRLEPair *>(data_ptr),\n\t\t\t\t    metadata.NumberOfRuns())",
          "new_text": "GetContainerMetadata(container_index)",
          "old_line_content": "\t\t\t\tcurrent_container = make_uniq<RunContainerScanState<NON_NULLS>>(",
          "new_line_content": "\t\tauto metadata = GetContainerMetadata(container_index);",
          "content_same": false
        },
        {
          "line": 918,
          "old_api": "reinterpret_cast<RunContainerRLEPair *>(data_ptr)",
          "new_api": "GetStartOfContainerData",
          "old_text": "reinterpret_cast<RunContainerRLEPair *>(data_ptr)",
          "new_text": "GetStartOfContainerData(container_index)",
          "old_line_content": "\t\t\t\t    container_index, container_size, reinterpret_cast<RunContainerRLEPair *>(data_ptr),",
          "new_line_content": "\t\tauto data_ptr = GetStartOfContainerData(container_index);",
          "content_same": false
        },
        {
          "line": 922,
          "old_api": "IsInverted",
          "new_api": "MinValue<idx_t>(segment_count - start_of_container, ROARING_CONTAINER_SIZE)",
          "old_text": "metadata.IsInverted()",
          "new_text": "MinValue<idx_t>(segment_count - start_of_container, ROARING_CONTAINER_SIZE)",
          "old_line_content": "\t\t\tif (metadata.IsInverted()) {",
          "new_line_content": "\t\tauto container_size = MinValue<idx_t>(segment_count - start_of_container, ROARING_CONTAINER_SIZE);",
          "content_same": false
        },
        {
          "line": 923,
          "old_api": "Cardinality",
          "new_api": "IsUncompressed",
          "old_text": "make_uniq<ArrayContainerScanState<NULLS>>(\n\t\t\t\t    container_index, container_size, reinterpret_cast<uint16_t *>(data_ptr), metadata.Cardinality())",
          "new_text": "metadata.IsUncompressed()",
          "old_line_content": "\t\t\t\tcurrent_container = make_uniq<ArrayContainerScanState<NULLS>>(",
          "new_line_content": "\t\tif (metadata.IsUncompressed()) {",
          "content_same": false
        },
        {
          "line": 924,
          "old_api": "Cardinality",
          "new_api": "make_uniq<BitsetContainerScanState>(container_index, container_size,\n\t\t\t                                                        reinterpret_cast<uint8_t *>(data_ptr))",
          "old_text": "metadata.Cardinality()",
          "new_text": "make_uniq<BitsetContainerScanState>(container_index, container_size,\n\t\t\t                                                        reinterpret_cast<uint8_t *>(data_ptr))",
          "old_line_content": "\t\t\t\t    container_index, container_size, reinterpret_cast<uint16_t *>(data_ptr), metadata.Cardinality());",
          "new_line_content": "\t\t\tcurrent_container = make_uniq<BitsetContainerScanState>(container_index, container_size,",
          "content_same": false
        },
        {
          "line": 926,
          "old_api": "Cardinality",
          "new_api": "IsRun",
          "old_text": "make_uniq<ArrayContainerScanState<NON_NULLS>>(\n\t\t\t\t    container_index, container_size, reinterpret_cast<uint16_t *>(data_ptr), metadata.Cardinality())",
          "new_text": "metadata.IsRun()",
          "old_line_content": "\t\t\t\tcurrent_container = make_uniq<ArrayContainerScanState<NON_NULLS>>(",
          "new_line_content": "\t\t} else if (metadata.IsRun()) {",
          "content_same": false
        },
        {
          "line": 927,
          "old_api": "Cardinality",
          "new_api": "IsInverted",
          "old_text": "metadata.Cardinality()",
          "new_text": "metadata.IsInverted()",
          "old_line_content": "\t\t\t\t    container_index, container_size, reinterpret_cast<uint16_t *>(data_ptr), metadata.Cardinality());",
          "new_line_content": "\t\t\tif (metadata.IsInverted()) {",
          "content_same": false
        },
        {
          "line": 933,
          "old_api": "Skip",
          "new_api": "reinterpret_cast<RunContainerRLEPair *>(data_ptr)",
          "old_text": "Skip(scan_state, internal_offset)",
          "new_text": "reinterpret_cast<RunContainerRLEPair *>(data_ptr)",
          "old_line_content": "\t\t\tSkip(scan_state, internal_offset);",
          "new_line_content": "\t\t\t\t    container_index, container_size, reinterpret_cast<RunContainerRLEPair *>(data_ptr),",
          "content_same": false
        },
        {
          "line": 939,
          "old_api": "ScanPartial",
          "new_api": "Cardinality",
          "old_text": "scan_state.ScanPartial(result, offset, to_scan)",
          "new_text": "metadata.Cardinality()",
          "old_line_content": "\t\tscan_state.ScanPartial(result, offset, to_scan);",
          "new_line_content": "\t\t\t\t    container_index, container_size, reinterpret_cast<uint16_t *>(data_ptr), metadata.Cardinality());",
          "content_same": false
        },
        {
          "line": 954,
          "old_api": "GetContainerIndex",
          "new_api": "ScanPartial",
          "old_text": "GetContainerIndex(start_idx + scanned, internal_offset)",
          "new_text": "scan_state.ScanPartial(result, offset, to_scan)",
          "old_line_content": "\t\t\tidx_t vector_idx = GetContainerIndex(start_idx + scanned, internal_offset);",
          "new_line_content": "\t\tscan_state.ScanPartial(result, offset, to_scan);",
          "content_same": false
        },
        {
          "line": 995,
          "old_api": "RoaringScanPartial",
          "new_api": "std::move(result)",
          "old_text": "RoaringScanPartial(segment, state, scan_count, result, 0)",
          "new_text": "std::move(result)",
          "old_line_content": "\tRoaringScanPartial(segment, state, scan_count, result, 0);",
          "new_line_content": "\treturn std::move(result);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 776,
          "old_api": null,
          "new_api": "SetInvalid",
          "old_text": null,
          "new_text": "result_mask.SetInvalid(result_offset + index)",
          "old_line_content": "\t\t\t\tif (array_index + to_scan < count && array[array_index] == scanned_count &&",
          "new_line_content": "\t\t\t\t\tresult_mask.SetInvalid(result_offset + index);",
          "content_same": false
        },
        {
          "line": 1033,
          "old_api": null,
          "new_api": "CompressionFunction",
          "old_text": null,
          "new_text": "CompressionFunction(CompressionType::COMPRESSION_ROARING, data_type, roaring::RoaringInitAnalyze,\n\t                           roaring::RoaringAnalyze, roaring::RoaringFinalAnalyze, roaring::RoaringInitCompression,\n\t                           roaring::RoaringCompress, roaring::RoaringFinalizeCompress, roaring::RoaringInitScan,\n\t                           roaring::RoaringScan, roaring::RoaringScanPartial, roaring::RoaringFetchRow,\n\t                           roaring::RoaringSkip)",
          "old_line_content": "",
          "new_line_content": "\treturn CompressionFunction(CompressionType::COMPRESSION_ROARING, data_type, roaring::RoaringInitAnalyze,",
          "content_same": false
        },
        {
          "line": 786,
          "old_api": null,
          "new_api": "SetInvalid",
          "old_text": null,
          "new_text": "result_mask.SetInvalid(result_offset + i)",
          "old_line_content": "\t\t\t\t\tidx_t valid_start = valid_pos - scanned_count;",
          "new_line_content": "\t\t\t\t\t\tresult_mask.SetInvalid(result_offset + i);",
          "content_same": false
        },
        {
          "line": 1043,
          "old_api": null,
          "new_api": "GetCompressionFunction",
          "old_text": null,
          "new_text": "GetCompressionFunction(type)",
          "old_line_content": "} // namespace duckdb",
          "new_line_content": "\t\treturn GetCompressionFunction(type);",
          "content_same": false
        },
        {
          "line": 1045,
          "old_api": null,
          "new_api": "InternalException",
          "old_text": null,
          "new_text": "InternalException(\"Unsupported type for Roaring\")",
          "old_line_content": "",
          "new_line_content": "\t\tthrow InternalException(\"Unsupported type for Roaring\");",
          "content_same": false
        },
        {
          "line": 920,
          "old_api": null,
          "new_api": "load",
          "old_text": null,
          "new_text": "segment.count.load()",
          "old_line_content": "\t\t\t}",
          "new_line_content": "\t\tauto segment_count = segment.count.load();",
          "content_same": false
        },
        {
          "line": 925,
          "old_api": null,
          "new_api": "reinterpret_cast<uint8_t *>(data_ptr)",
          "old_text": null,
          "new_text": "reinterpret_cast<uint8_t *>(data_ptr)",
          "old_line_content": "\t\t\t} else {",
          "new_line_content": "\t\t\t                                                        reinterpret_cast<uint8_t *>(data_ptr));",
          "content_same": false
        },
        {
          "line": 928,
          "old_api": null,
          "new_api": "NumberOfRuns",
          "old_text": null,
          "new_text": "make_uniq<RunContainerScanState<NULLS>>(\n\t\t\t\t    container_index, container_size, reinterpret_cast<RunContainerRLEPair *>(data_ptr),\n\t\t\t\t    metadata.NumberOfRuns())",
          "old_line_content": "\t\t\t}",
          "new_line_content": "\t\t\t\tcurrent_container = make_uniq<RunContainerScanState<NULLS>>(",
          "content_same": false
        },
        {
          "line": 929,
          "old_api": null,
          "new_api": "reinterpret_cast<RunContainerRLEPair *>(data_ptr)",
          "old_text": null,
          "new_text": "reinterpret_cast<RunContainerRLEPair *>(data_ptr)",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\t\t\t    container_index, container_size, reinterpret_cast<RunContainerRLEPair *>(data_ptr),",
          "content_same": false
        },
        {
          "line": 930,
          "old_api": null,
          "new_api": "NumberOfRuns",
          "old_text": null,
          "new_text": "metadata.NumberOfRuns()",
          "old_line_content": "",
          "new_line_content": "\t\t\t\t    metadata.NumberOfRuns());",
          "content_same": false
        },
        {
          "line": 932,
          "old_api": null,
          "new_api": "NumberOfRuns",
          "old_text": null,
          "new_text": "make_uniq<RunContainerScanState<NON_NULLS>>(\n\t\t\t\t    container_index, container_size, reinterpret_cast<RunContainerRLEPair *>(data_ptr),\n\t\t\t\t    metadata.NumberOfRuns())",
          "old_line_content": "\t\tif (internal_offset) {",
          "new_line_content": "\t\t\t\tcurrent_container = make_uniq<RunContainerScanState<NON_NULLS>>(",
          "content_same": false
        },
        {
          "line": 806,
          "old_api": null,
          "new_api": "MinValue<idx_t>(valid_start, to_scan)",
          "old_text": null,
          "new_text": "MinValue<idx_t>(valid_start, to_scan)",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\t\t\t\t\tidx_t invalid_end = MinValue<idx_t>(valid_start, to_scan);",
          "content_same": false
        },
        {
          "line": 934,
          "old_api": null,
          "new_api": "NumberOfRuns",
          "old_text": null,
          "new_text": "metadata.NumberOfRuns()",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\t\t\t    metadata.NumberOfRuns());",
          "content_same": false
        },
        {
          "line": 808,
          "old_api": null,
          "new_api": "SetInvalid",
          "old_text": null,
          "new_text": "result_mask.SetInvalid(result_offset + j)",
          "old_line_content": "",
          "new_line_content": "\t\t\t\t\t\t\tresult_mask.SetInvalid(result_offset + j);",
          "content_same": false
        },
        {
          "line": 937,
          "old_api": null,
          "new_api": "IsInverted",
          "old_text": null,
          "new_text": "metadata.IsInverted()",
          "old_line_content": "",
          "new_line_content": "\t\t\tif (metadata.IsInverted()) {",
          "content_same": false
        },
        {
          "line": 938,
          "old_api": null,
          "new_api": "Cardinality",
          "old_text": null,
          "new_text": "make_uniq<ArrayContainerScanState<NULLS>>(\n\t\t\t\t    container_index, container_size, reinterpret_cast<uint16_t *>(data_ptr), metadata.Cardinality())",
          "old_line_content": "\tvoid ScanInternal(ContainerScanState &scan_state, idx_t to_scan, Vector &result, idx_t offset) {",
          "new_line_content": "\t\t\t\tcurrent_container = make_uniq<ArrayContainerScanState<NULLS>>(",
          "content_same": false
        },
        {
          "line": 941,
          "old_api": null,
          "new_api": "Cardinality",
          "old_text": null,
          "new_text": "make_uniq<ArrayContainerScanState<NON_NULLS>>(\n\t\t\t\t    container_index, container_size, reinterpret_cast<uint16_t *>(data_ptr), metadata.Cardinality())",
          "old_line_content": "",
          "new_line_content": "\t\t\t\tcurrent_container = make_uniq<ArrayContainerScanState<NON_NULLS>>(",
          "content_same": false
        },
        {
          "line": 942,
          "old_api": null,
          "new_api": "Cardinality",
          "old_text": null,
          "new_text": "metadata.Cardinality()",
          "old_line_content": "\tidx_t GetContainerIndex(idx_t start_index, idx_t &offset) {",
          "new_line_content": "\t\t\t\t    container_index, container_size, reinterpret_cast<uint16_t *>(data_ptr), metadata.Cardinality());",
          "content_same": false
        },
        {
          "line": 688,
          "old_api": null,
          "new_api": "SetInvalid",
          "old_text": null,
          "new_text": "result_mask.SetInvalid(result_offset + i)",
          "old_line_content": "\t\t\t\t\tidx_t valid_start = valid_pos - scanned_count;",
          "new_line_content": "\t\t\t\t\t\tresult_mask.SetInvalid(result_offset + i);",
          "content_same": false
        },
        {
          "line": 948,
          "old_api": null,
          "new_api": "Skip",
          "old_text": null,
          "new_text": "Skip(scan_state, internal_offset)",
          "old_line_content": "\tvoid ScanPartial(idx_t start_idx, Vector &result, idx_t offset, idx_t count) {",
          "new_line_content": "\t\t\tSkip(scan_state, internal_offset);",
          "content_same": false
        },
        {
          "line": 708,
          "old_api": null,
          "new_api": "MinValue<idx_t>(valid_start, to_scan)",
          "old_text": null,
          "new_text": "MinValue<idx_t>(valid_start, to_scan)",
          "old_line_content": "\t\t\tscanned_count += to_scan;",
          "new_line_content": "\t\t\t\t\t\tidx_t invalid_end = MinValue<idx_t>(valid_start, to_scan);",
          "content_same": false
        },
        {
          "line": 964,
          "old_api": null,
          "new_api": "Flatten",
          "old_text": null,
          "new_text": "result.Flatten(count)",
          "old_line_content": "",
          "new_line_content": "\t\tresult.Flatten(count);",
          "content_same": false
        },
        {
          "line": 710,
          "old_api": null,
          "new_api": "SetInvalid",
          "old_text": null,
          "new_text": "result_mask.SetInvalid(result_offset + j)",
          "old_line_content": "\t}",
          "new_line_content": "\t\t\t\t\t\t\tresult_mask.SetInvalid(result_offset + j);",
          "content_same": false
        },
        {
          "line": 969,
          "old_api": null,
          "new_api": "GetContainerIndex",
          "old_text": null,
          "new_text": "GetContainerIndex(start_idx + scanned, internal_offset)",
          "old_line_content": "public:",
          "new_line_content": "\t\t\tidx_t vector_idx = GetContainerIndex(start_idx + scanned, internal_offset);",
          "content_same": false
        },
        {
          "line": 970,
          "old_api": null,
          "new_api": "LoadContainer",
          "old_text": null,
          "new_text": "LoadContainer(vector_idx, internal_offset)",
          "old_line_content": "\tBufferHandle handle;",
          "new_line_content": "\t\t\tauto &scan_state = LoadContainer(vector_idx, internal_offset);",
          "content_same": false
        },
        {
          "line": 716,
          "old_api": null,
          "new_api": "MinValue<idx_t>(i + 1 + runs[run_index].length, to_scan)",
          "old_text": null,
          "new_text": "MinValue<idx_t>(i + 1 + runs[run_index].length, to_scan)",
          "old_line_content": "};",
          "new_line_content": "\t\t\t\t\t\tidx_t valid_end = MinValue<idx_t>(i + 1 + runs[run_index].length, to_scan);",
          "content_same": false
        },
        {
          "line": 972,
          "old_api": null,
          "new_api": "MinValue<idx_t>(remaining, remaining_in_container)",
          "old_text": null,
          "new_text": "MinValue<idx_t>(remaining, remaining_in_container)",
          "old_line_content": "\tunique_ptr<ContainerScanState> current_container;",
          "new_line_content": "\t\t\tidx_t to_scan = MinValue<idx_t>(remaining, remaining_in_container);",
          "content_same": false
        },
        {
          "line": 973,
          "old_api": null,
          "new_api": "ScanInternal",
          "old_text": null,
          "new_text": "ScanInternal(scan_state, to_scan, result, offset + scanned)",
          "old_line_content": "\tdata_ptr_t data_ptr;",
          "new_line_content": "\t\t\tScanInternal(scan_state, to_scan, result, offset + scanned);",
          "content_same": false
        },
        {
          "line": 977,
          "old_api": null,
          "new_api": "D_ASSERT",
          "old_text": null,
          "new_text": "D_ASSERT(scanned == count)",
          "old_line_content": "",
          "new_line_content": "\t\tD_ASSERT(scanned == count);",
          "content_same": false
        },
        {
          "line": 852,
          "old_api": null,
          "new_api": "Pin",
          "old_text": null,
          "new_text": "buffer_manager.Pin(segment.block)",
          "old_line_content": "\t\tidx_t position = 0;",
          "new_line_content": "\t\thandle = buffer_manager.Pin(segment.block);",
          "content_same": false
        },
        {
          "line": 853,
          "old_api": null,
          "new_api": "GetBlockOffset",
          "old_text": null,
          "new_text": "segment.GetBlockOffset()",
          "old_line_content": "\t\tfor (idx_t i = 0; i < container_count; i++) {",
          "new_line_content": "\t\tauto base_ptr = handle.Ptr() + segment.GetBlockOffset();",
          "content_same": false
        },
        {
          "line": 860,
          "old_api": null,
          "new_api": "load",
          "old_text": null,
          "new_text": "segment.count.load()",
          "old_line_content": "\t}",
          "new_line_content": "\t\tauto segment_count = segment.count.load();",
          "content_same": false
        },
        {
          "line": 866,
          "old_api": null,
          "new_api": "reserve",
          "old_text": null,
          "new_text": "data_start_position.reserve(container_count)",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\tdata_start_position.reserve(container_count);",
          "content_same": false
        },
        {
          "line": 994,
          "old_api": null,
          "new_api": "make_uniq<RoaringScanState>(segment)",
          "old_text": null,
          "new_text": "make_uniq<RoaringScanState>(segment)",
          "old_line_content": "void RoaringScan(ColumnSegment &segment, ColumnScanState &state, idx_t scan_count, Vector &result) {",
          "new_line_content": "\tauto result = make_uniq<RoaringScanState>(segment);",
          "content_same": false
        },
        {
          "line": 869,
          "old_api": null,
          "new_api": "Load<ContainerMetadata>(metadata_ptr)",
          "old_text": null,
          "new_text": "Load<ContainerMetadata>(metadata_ptr)",
          "old_line_content": "\t\t\treturn ROARING_CONTAINER_SIZE / ValidityMask::BITS_PER_VALUE;",
          "new_line_content": "\t\t\tauto metadata = Load<ContainerMetadata>(metadata_ptr);",
          "content_same": false
        },
        {
          "line": 742,
          "old_api": null,
          "new_api": "FlatVector::Validity(result)",
          "old_text": null,
          "new_text": "FlatVector::Validity(result)",
          "old_line_content": "\t\t\t\t// TODO: optimization",
          "new_line_content": "\t\tauto &result_mask = FlatVector::Validity(result);",
          "content_same": false
        },
        {
          "line": 870,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "container_metadata.push_back(metadata)",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\t\tcontainer_metadata.push_back(metadata);",
          "content_same": false
        },
        {
          "line": 872,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "data_start_position.push_back(position)",
          "old_line_content": "\t}",
          "new_line_content": "\t\t\tdata_start_position.push_back(position);",
          "content_same": false
        },
        {
          "line": 873,
          "old_api": null,
          "new_api": "SkipVector",
          "old_text": null,
          "new_text": "SkipVector(metadata)",
          "old_line_content": "",
          "new_line_content": "\t\t\tposition += SkipVector(metadata);",
          "content_same": false
        },
        {
          "line": 1003,
          "old_api": null,
          "new_api": "state.scan_state->Cast<RoaringScanState>()",
          "old_text": null,
          "new_text": "state.scan_state->Cast<RoaringScanState>()",
          "old_line_content": "",
          "new_line_content": "\tauto &scan_state = state.scan_state->Cast<RoaringScanState>();",
          "content_same": false
        },
        {
          "line": 1004,
          "old_api": null,
          "new_api": "GetRelativeIndex",
          "old_text": null,
          "new_text": "segment.GetRelativeIndex(state.row_index)",
          "old_line_content": "\t// TODO: implement",
          "new_line_content": "\tauto start = segment.GetRelativeIndex(state.row_index);",
          "content_same": false
        },
        {
          "line": 1006,
          "old_api": null,
          "new_api": "ScanPartial",
          "old_text": null,
          "new_text": "scan_state.ScanPartial(start, result, result_offset, scan_count)",
          "old_line_content": "",
          "new_line_content": "\tscan_state.ScanPartial(start, result, result_offset, scan_count);",
          "content_same": false
        },
        {
          "line": 879,
          "old_api": null,
          "new_api": "IsRun",
          "old_text": null,
          "new_text": "metadata.IsRun()",
          "old_line_content": "\t\tif (current_container->container_index != container_index) {",
          "new_line_content": "\t\tif (metadata.IsRun()) {",
          "content_same": false
        },
        {
          "line": 880,
          "old_api": null,
          "new_api": "NumberOfRuns",
          "old_text": null,
          "new_text": "metadata.NumberOfRuns()",
          "old_line_content": "\t\t\t// Not the same container",
          "new_line_content": "\t\t\treturn sizeof(RunContainerRLEPair) * metadata.NumberOfRuns();",
          "content_same": false
        },
        {
          "line": 882,
          "old_api": null,
          "new_api": "IsUncompressed",
          "old_text": null,
          "new_text": "metadata.IsUncompressed()",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\tif (metadata.IsUncompressed()) {",
          "content_same": false
        },
        {
          "line": 1010,
          "old_api": null,
          "new_api": "RoaringScanPartial",
          "old_text": null,
          "new_text": "RoaringScanPartial(segment, state, scan_count, result, 0)",
          "old_line_content": "}",
          "new_line_content": "\tRoaringScanPartial(segment, state, scan_count, result, 0);",
          "content_same": false
        },
        {
          "line": 886,
          "old_api": null,
          "new_api": "Cardinality",
          "old_text": null,
          "new_text": "metadata.Cardinality()",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\treturn sizeof(uint16_t) * metadata.Cardinality();",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 771,
          "old_api": "SetInvalid",
          "new_api": null,
          "old_text": "result_mask.SetInvalid(result_offset + i)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\t\tresult_mask.SetInvalid(result_offset + i);",
          "new_line_content": "\t\t\t\t\t}",
          "content_same": false
        },
        {
          "line": 1028,
          "old_api": "GetCompressionFunction",
          "new_api": null,
          "old_text": "GetCompressionFunction(type)",
          "new_text": null,
          "old_line_content": "\t\treturn GetCompressionFunction(type);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 899,
          "old_api": "UseContainerStateCache",
          "new_api": null,
          "old_text": "UseContainerStateCache(container_index, internal_offset)",
          "new_text": null,
          "old_line_content": "\t\tif (UseContainerStateCache(container_index, internal_offset)) {",
          "new_line_content": "\t\t\t// Not the same scan offset",
          "content_same": false
        },
        {
          "line": 1030,
          "old_api": "InternalException",
          "new_api": null,
          "old_text": "InternalException(\"Unsupported type for Roaring\")",
          "new_text": null,
          "old_line_content": "\t\tthrow InternalException(\"Unsupported type for Roaring\");",
          "new_line_content": "// Get Function",
          "content_same": false
        },
        {
          "line": 902,
          "old_api": "GetContainerMetadata",
          "new_api": null,
          "old_text": "GetContainerMetadata(container_index)",
          "new_text": null,
          "old_line_content": "\t\tauto metadata = GetContainerMetadata(container_index);",
          "new_line_content": "\t\treturn true;",
          "content_same": false
        },
        {
          "line": 903,
          "old_api": "GetStartOfContainerData",
          "new_api": null,
          "old_text": "GetStartOfContainerData(container_index)",
          "new_text": null,
          "old_line_content": "\t\tauto data_ptr = GetStartOfContainerData(container_index);",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 905,
          "old_api": "load",
          "new_api": null,
          "old_text": "segment.count.load()",
          "new_text": null,
          "old_line_content": "\t\tauto segment_count = segment.count.load();",
          "new_line_content": "\tContainerMetadata GetContainerMetadata(idx_t container_index) {",
          "content_same": false
        },
        {
          "line": 907,
          "old_api": "MinValue<idx_t>(segment_count - start_of_container, ROARING_CONTAINER_SIZE)",
          "new_api": null,
          "old_text": "MinValue<idx_t>(segment_count - start_of_container, ROARING_CONTAINER_SIZE)",
          "new_text": null,
          "old_line_content": "\t\tauto container_size = MinValue<idx_t>(segment_count - start_of_container, ROARING_CONTAINER_SIZE);",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 908,
          "old_api": "IsUncompressed",
          "new_api": null,
          "old_text": "metadata.IsUncompressed()",
          "new_text": null,
          "old_line_content": "\t\tif (metadata.IsUncompressed()) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 909,
          "old_api": "make_uniq<BitsetContainerScanState>(container_index, container_size,\n\t\t\t                                                        reinterpret_cast<uint8_t *>(data_ptr))",
          "new_api": null,
          "old_text": "make_uniq<BitsetContainerScanState>(container_index, container_size,\n\t\t\t                                                        reinterpret_cast<uint8_t *>(data_ptr))",
          "new_text": null,
          "old_line_content": "\t\t\tcurrent_container = make_uniq<BitsetContainerScanState>(container_index, container_size,",
          "new_line_content": "\tdata_ptr_t GetStartOfContainerData(idx_t container_index) {",
          "content_same": false
        },
        {
          "line": 910,
          "old_api": "reinterpret_cast<uint8_t *>(data_ptr)",
          "new_api": null,
          "old_text": "reinterpret_cast<uint8_t *>(data_ptr)",
          "new_text": null,
          "old_line_content": "\t\t\t                                                        reinterpret_cast<uint8_t *>(data_ptr));",
          "new_line_content": "\t\treturn data_ptr + data_start_position[container_index];",
          "content_same": false
        },
        {
          "line": 911,
          "old_api": "IsRun",
          "new_api": null,
          "old_text": "metadata.IsRun()",
          "new_text": null,
          "old_line_content": "\t\t} else if (metadata.IsRun()) {",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 912,
          "old_api": "IsInverted",
          "new_api": null,
          "old_text": "metadata.IsInverted()",
          "new_text": null,
          "old_line_content": "\t\t\tif (metadata.IsInverted()) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 913,
          "old_api": "NumberOfRuns",
          "new_api": null,
          "old_text": "make_uniq<RunContainerScanState<NULLS>>(\n\t\t\t\t    container_index, container_size, reinterpret_cast<RunContainerRLEPair *>(data_ptr),\n\t\t\t\t    metadata.NumberOfRuns())",
          "new_text": null,
          "old_line_content": "\t\t\t\tcurrent_container = make_uniq<RunContainerScanState<NULLS>>(",
          "new_line_content": "\tContainerScanState &LoadContainer(idx_t container_index, idx_t internal_offset) {",
          "content_same": false
        },
        {
          "line": 915,
          "old_api": "NumberOfRuns",
          "new_api": null,
          "old_text": "metadata.NumberOfRuns()",
          "new_text": null,
          "old_line_content": "\t\t\t\t    metadata.NumberOfRuns());",
          "new_line_content": "\t\t\treturn *current_container;",
          "content_same": false
        },
        {
          "line": 791,
          "old_api": "MinValue<idx_t>(valid_start, to_scan)",
          "new_api": null,
          "old_text": "MinValue<idx_t>(valid_start, to_scan)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\t\tidx_t invalid_end = MinValue<idx_t>(valid_start, to_scan);",
          "new_line_content": "\t\t\t\tif (array_index + to_scan < count && array[array_index] == scanned_count &&",
          "content_same": false
        },
        {
          "line": 919,
          "old_api": "NumberOfRuns",
          "new_api": null,
          "old_text": "metadata.NumberOfRuns()",
          "new_text": null,
          "old_line_content": "\t\t\t\t    metadata.NumberOfRuns());",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 793,
          "old_api": "SetInvalid",
          "new_api": null,
          "old_text": "result_mask.SetInvalid(result_offset + j)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\t\t\tresult_mask.SetInvalid(result_offset + j);",
          "new_line_content": "\t\t\t\t\t// All bits are set, no action required",
          "content_same": false
        },
        {
          "line": 693,
          "old_api": "MinValue<idx_t>(valid_start, to_scan)",
          "new_api": null,
          "old_text": "MinValue<idx_t>(valid_start, to_scan)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\t\tidx_t invalid_end = MinValue<idx_t>(valid_start, to_scan);",
          "new_line_content": "\t\t\t\t    runs[run_index].start + runs[run_index].length + 1 >= scanned_count + to_scan) {",
          "content_same": false
        },
        {
          "line": 949,
          "old_api": "Flatten",
          "new_api": null,
          "old_text": "result.Flatten(count)",
          "new_text": null,
          "old_line_content": "\t\tresult.Flatten(count);",
          "new_line_content": "\t\t}",
          "content_same": false
        },
        {
          "line": 823,
          "old_api": "NotImplementedException",
          "new_api": null,
          "old_text": "NotImplementedException(\"TODO\")",
          "new_text": null,
          "old_line_content": "\t\tthrow NotImplementedException(\"TODO\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 695,
          "old_api": "SetInvalid",
          "new_api": null,
          "old_text": "result_mask.SetInvalid(result_offset + j)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\t\t\tresult_mask.SetInvalid(result_offset + j);",
          "new_line_content": "\t\t\t\t\t// no action required",
          "content_same": false
        },
        {
          "line": 955,
          "old_api": "LoadContainer",
          "new_api": null,
          "old_text": "LoadContainer(vector_idx, internal_offset)",
          "new_text": null,
          "old_line_content": "\t\t\tauto &scan_state = LoadContainer(vector_idx, internal_offset);",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 701,
          "old_api": "MinValue<idx_t>(i + 1 + runs[run_index].length, to_scan)",
          "new_api": null,
          "old_text": "MinValue<idx_t>(i + 1 + runs[run_index].length, to_scan)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\t\tidx_t valid_end = MinValue<idx_t>(i + 1 + runs[run_index].length, to_scan);",
          "new_line_content": "\t\t\t\t\t// Determine the next valid position within the scan range, if available",
          "content_same": false
        },
        {
          "line": 957,
          "old_api": "MinValue<idx_t>(remaining, remaining_in_container)",
          "new_api": null,
          "old_text": "MinValue<idx_t>(remaining, remaining_in_container)",
          "new_text": null,
          "old_line_content": "\t\t\tidx_t to_scan = MinValue<idx_t>(remaining, remaining_in_container);",
          "new_line_content": "\tidx_t GetContainerIndex(idx_t start_index, idx_t &offset) {",
          "content_same": false
        },
        {
          "line": 958,
          "old_api": "ScanInternal",
          "new_api": null,
          "old_text": "ScanInternal(scan_state, to_scan, result, offset + scanned)",
          "new_text": null,
          "old_line_content": "\t\t\tScanInternal(scan_state, to_scan, result, offset + scanned);",
          "new_line_content": "\t\tidx_t container_index = start_index / ROARING_CONTAINER_SIZE;",
          "content_same": false
        },
        {
          "line": 962,
          "old_api": "D_ASSERT",
          "new_api": null,
          "old_text": "D_ASSERT(scanned == count)",
          "new_text": null,
          "old_line_content": "\t\tD_ASSERT(scanned == count);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 835,
          "old_api": "explicit",
          "new_api": null,
          "old_text": "explicit",
          "new_text": null,
          "old_line_content": "\texplicit RoaringScanState(ColumnSegment &segment) : segment(segment) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 836,
          "old_api": "BufferManager::GetBufferManager(segment.db)",
          "new_api": null,
          "old_text": "BufferManager::GetBufferManager(segment.db)",
          "new_text": null,
          "old_line_content": "\t\tauto &buffer_manager = BufferManager::GetBufferManager(segment.db);",
          "new_line_content": "public:",
          "content_same": false
        },
        {
          "line": 837,
          "old_api": "Pin",
          "new_api": null,
          "old_text": "buffer_manager.Pin(segment.block)",
          "new_text": null,
          "old_line_content": "\t\thandle = buffer_manager.Pin(segment.block);",
          "new_line_content": "\tvoid ScanPartial(Vector &result, idx_t result_offset, idx_t to_scan) {",
          "content_same": false
        },
        {
          "line": 842,
          "old_api": "GetBlockOffset",
          "new_api": null,
          "old_text": "segment.GetBlockOffset()",
          "new_text": null,
          "old_line_content": "\t\tauto metadata_offset = Load<idx_t>(base_ptr + segment.GetBlockOffset());",
          "new_line_content": "\t// FIXME: should this use a ValidityMask ?",
          "content_same": false
        },
        {
          "line": 845,
          "old_api": "load",
          "new_api": null,
          "old_text": "segment.count.load()",
          "new_text": null,
          "old_line_content": "\t\tauto segment_count = segment.count.load();",
          "new_line_content": "\tidx_t bit_index = 0;",
          "content_same": false
        },
        {
          "line": 979,
          "old_api": "make_uniq<RoaringScanState>(segment)",
          "new_api": null,
          "old_text": "make_uniq<RoaringScanState>(segment)",
          "new_text": null,
          "old_line_content": "\tauto result = make_uniq<RoaringScanState>(segment);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 980,
          "old_api": "std::move(result)",
          "new_api": null,
          "old_text": "std::move(result)",
          "new_text": null,
          "old_line_content": "\treturn std::move(result);",
          "new_line_content": "\tvoid Skip(ContainerScanState &scan_state, idx_t skip_count) {",
          "content_same": false
        },
        {
          "line": 854,
          "old_api": "Load<ContainerMetadata>(metadata_ptr)",
          "new_api": null,
          "old_text": "Load<ContainerMetadata>(metadata_ptr)",
          "new_text": null,
          "old_line_content": "\t\t\tauto metadata = Load<ContainerMetadata>(metadata_ptr);",
          "new_line_content": "\t\tdata_ptr = base_ptr + sizeof(idx_t);",
          "content_same": false
        },
        {
          "line": 727,
          "old_api": "FlatVector::Validity(result)",
          "new_api": null,
          "old_text": "FlatVector::Validity(result)",
          "new_text": null,
          "old_line_content": "\t\tauto &result_mask = FlatVector::Validity(result);",
          "new_line_content": "public:",
          "content_same": false
        },
        {
          "line": 855,
          "old_api": "push_back",
          "new_api": null,
          "old_text": "container_metadata.push_back(metadata)",
          "new_text": null,
          "old_line_content": "\t\t\tcontainer_metadata.push_back(metadata);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 858,
          "old_api": "SkipVector",
          "new_api": null,
          "old_text": "SkipVector(metadata)",
          "new_text": null,
          "old_line_content": "\t\t\tposition += SkipVector(metadata);",
          "new_line_content": "\t\tauto metadata_ptr = base_ptr + metadata_offset - sizeof(ContainerMetadata);",
          "content_same": false
        },
        {
          "line": 988,
          "old_api": "state.scan_state->Cast<RoaringScanState>()",
          "new_api": null,
          "old_text": "state.scan_state->Cast<RoaringScanState>()",
          "new_text": null,
          "old_line_content": "\tauto &scan_state = state.scan_state->Cast<RoaringScanState>();",
          "new_line_content": "\tdata_ptr_t data_ptr;",
          "content_same": false
        },
        {
          "line": 989,
          "old_api": "GetRelativeIndex",
          "new_api": null,
          "old_text": "segment.GetRelativeIndex(state.row_index)",
          "new_text": null,
          "old_line_content": "\tauto start = segment.GetRelativeIndex(state.row_index);",
          "new_line_content": "\tvector<ContainerMetadata> container_metadata;",
          "content_same": false
        },
        {
          "line": 991,
          "old_api": "ScanPartial",
          "new_api": null,
          "old_text": "scan_state.ScanPartial(start, result, result_offset, scan_count)",
          "new_text": null,
          "old_line_content": "\tscan_state.ScanPartial(start, result, result_offset, scan_count);",
          "new_line_content": "};",
          "content_same": false
        },
        {
          "line": 864,
          "old_api": "IsRun",
          "new_api": null,
          "old_text": "metadata.IsRun()",
          "new_text": null,
          "old_line_content": "\t\tif (metadata.IsRun()) {",
          "new_line_content": "\t\t}",
          "content_same": false
        },
        {
          "line": 867,
          "old_api": "IsUncompressed",
          "new_api": null,
          "old_text": "metadata.IsUncompressed()",
          "new_text": null,
          "old_line_content": "\t\tif (metadata.IsUncompressed()) {",
          "new_line_content": "\t\tidx_t position = 0;",
          "content_same": false
        },
        {
          "line": 871,
          "old_api": "Cardinality",
          "new_api": null,
          "old_text": "metadata.Cardinality()",
          "new_text": null,
          "old_line_content": "\t\treturn sizeof(uint16_t) * metadata.Cardinality();",
          "new_line_content": "\t\t\tmetadata_ptr -= sizeof(ContainerMetadata);",
          "content_same": false
        },
        {
          "line": 746,
          "old_api": "SetInvalid",
          "new_api": null,
          "old_text": "result_mask.SetInvalid(result_offset + i)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\t\tresult_mask.SetInvalid(result_offset + i);",
          "new_line_content": "\t\t// scanned.",
          "content_same": false
        },
        {
          "line": 1018,
          "old_api": "CompressionFunction",
          "new_api": null,
          "old_text": "CompressionFunction(CompressionType::COMPRESSION_ROARING, data_type, roaring::RoaringInitAnalyze,\n\t                           roaring::RoaringAnalyze, roaring::RoaringFinalAnalyze, roaring::RoaringInitCompression,\n\t                           roaring::RoaringCompress, roaring::RoaringFinalizeCompress, roaring::RoaringInitScan,\n\t                           roaring::RoaringScan, roaring::RoaringScanPartial, roaring::RoaringFetchRow,\n\t                           roaring::RoaringSkip)",
          "new_text": null,
          "old_line_content": "\treturn CompressionFunction(CompressionType::COMPRESSION_ROARING, data_type, roaring::RoaringInitAnalyze,",
          "new_line_content": "",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 17,
      "total_additions": 47,
      "total_deletions": 46,
      "total_api_changes": 110
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 15,
        "api_related_lines": 110,
        "non_api_lines": 12,
        "non_api_line_numbers": [
          684,
          685,
          686,
          687,
          689,
          690,
          691,
          692,
          694,
          696,
          697,
          698
        ]
      }
    },
    "api_calls_before": 207,
    "api_calls_after": 208,
    "diff_info": {
      "added_lines": 15,
      "removed_lines": 0,
      "total_diff_lines": 27
    }
  }
}