{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mongo/modified_file/dc922edc3172d36b3d2005d75c79519ceb7d2764",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mongo/modified_file/dc922edc3172d36b3d2005d75c79519ceb7d2764/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mongo/modified_file/dc922edc3172d36b3d2005d75c79519ceb7d2764/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mongo/modified_file/dc922edc3172d36b3d2005d75c79519ceb7d2764/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 985,
          "old_api": "currentIsDup",
          "new_api": "advance",
          "old_text": "cursor->currentIsDup()",
          "new_text": "cursor->advance()",
          "old_line_content": "                            if ( cursor->currentIsDup() ) {",
          "new_line_content": "                                cursor->advance();",
          "content_same": false
        },
        {
          "line": 991,
          "old_api": "advance",
          "new_api": "currentIsDup",
          "old_text": "cursor->advance()",
          "new_text": "cursor->currentIsDup()",
          "old_line_content": "                                cursor->advance();",
          "new_line_content": "                            if ( cursor->currentIsDup() ) {",
          "content_same": false
        },
        {
          "line": 996,
          "old_api": "advance",
          "new_api": "current",
          "old_text": "cursor->advance()",
          "new_text": "cursor->current()",
          "old_line_content": "                            cursor->advance();",
          "new_line_content": "                            BSONObj o = cursor->current();",
          "content_same": false
        },
        {
          "line": 1005,
          "old_api": "map",
          "new_api": "reset",
          "old_text": "config.mapper->map( o )",
          "new_text": "mt.reset()",
          "old_line_content": "                            config.mapper->map( o );",
          "new_line_content": "                            if ( config.verbose ) mt.reset();",
          "content_same": false
        },
        {
          "line": 1006,
          "old_api": "micros",
          "new_api": "map",
          "old_text": "mt.micros()",
          "new_text": "config.mapper->map( o )",
          "old_line_content": "                            if ( config.verbose ) mapTime += mt.micros();",
          "new_line_content": "                            config.mapper->map( o );",
          "content_same": false
        },
        {
          "line": 1015,
          "old_api": "micros",
          "new_api": "checkSize",
          "old_text": "t.micros()",
          "new_text": "state.checkSize()",
          "old_line_content": "                                inReduce += t.micros();",
          "new_line_content": "                                state.checkSize();",
          "content_same": false
        },
        {
          "line": 1018,
          "old_api": "release",
          "new_api": "stillOk",
          "old_text": "cursor.release()",
          "new_text": "yield.stillOk()",
          "old_line_content": "                                    cursor.release();",
          "new_line_content": "                                if ( ! yield.stillOk() ) {",
          "content_same": false
        },
        {
          "line": 1035,
          "old_api": "numEmits",
          "new_api": "appendNumber",
          "old_text": "state.numEmits()",
          "new_text": "countsBuilder.appendNumber( \"input\" , num )",
          "old_line_content": "                    countsBuilder.appendNumber( \"emit\" , state.numEmits() );",
          "new_line_content": "                    countsBuilder.appendNumber( \"input\" , num );",
          "content_same": false
        },
        {
          "line": 1040,
          "old_api": "millis",
          "new_api": "append",
          "old_text": "t.millis()",
          "new_text": "timingBuilder.append( \"mapTime\" , mapTime / 1000 )",
          "old_line_content": "                    timingBuilder.append( \"emitLoop\" , t.millis() );",
          "new_line_content": "                    timingBuilder.append( \"mapTime\" , mapTime / 1000 );",
          "content_same": false
        },
        {
          "line": 1049,
          "old_api": "prepTempCollection",
          "new_api": "dumpToInc",
          "old_text": "state.prepTempCollection()",
          "new_text": "state.dumpToInc()",
          "old_line_content": "                    state.prepTempCollection();",
          "new_line_content": "                    state.dumpToInc();",
          "content_same": false
        },
        {
          "line": 1052,
          "old_api": "micros",
          "new_api": "finalReduce",
          "old_text": "t.micros()",
          "new_text": "state.finalReduce( op , pm )",
          "old_line_content": "                    inReduce += t.micros();",
          "new_line_content": "                    state.finalReduce( op , pm );",
          "content_same": false
        },
        {
          "line": 1053,
          "old_api": "numReduces",
          "new_api": "micros",
          "old_text": "state.numReduces()",
          "new_text": "t.micros()",
          "old_line_content": "                    countsBuilder.appendNumber( \"reduce\" , state.numReduces() );",
          "new_line_content": "                    inReduce += t.micros();",
          "content_same": false
        },
        {
          "line": 1054,
          "old_api": "append",
          "new_api": "numReduces",
          "old_text": "timingBuilder.append( \"reduceTime\" , inReduce / 1000 )",
          "new_text": "state.numReduces()",
          "old_line_content": "                    timingBuilder.append( \"reduceTime\" , inReduce / 1000 );",
          "new_line_content": "                    countsBuilder.appendNumber( \"reduce\" , state.numReduces() );",
          "content_same": false
        },
        {
          "line": 1055,
          "old_api": "jsMode",
          "new_api": "append",
          "old_text": "state.jsMode()",
          "new_text": "timingBuilder.append( \"reduceTime\" , inReduce / 1000 )",
          "old_line_content": "                    timingBuilder.append( \"mode\" , state.jsMode() ? \"js\" : \"mixed\" );",
          "new_line_content": "                    timingBuilder.append( \"reduceTime\" , inReduce / 1000 );",
          "content_same": false
        },
        {
          "line": 1065,
          "old_api": "appendResults",
          "new_api": "postProcessCollection",
          "old_text": "state.appendResults( result )",
          "new_text": "state.postProcessCollection()",
          "old_line_content": "                state.appendResults( result );",
          "new_line_content": "                long long finalCount = state.postProcessCollection();",
          "content_same": false
        },
        {
          "line": 1072,
          "old_api": "append",
          "new_api": "empty",
          "old_text": "loc.append( \"db\" , config.outDB )",
          "new_text": "config.outDB.empty()",
          "old_line_content": "                        loc.append( \"db\" , config.outDB );",
          "new_line_content": "                    if ( !config.outDB.empty())",
          "content_same": false
        },
        {
          "line": 1073,
          "old_api": "empty",
          "new_api": "append",
          "old_text": "config.finalShort.empty()",
          "new_text": "loc.append( \"db\" , config.outDB )",
          "old_line_content": "                    if ( !config.finalShort.empty() )",
          "new_line_content": "                        loc.append( \"db\" , config.outDB );",
          "content_same": false
        },
        {
          "line": 1074,
          "old_api": "append",
          "new_api": "empty",
          "old_text": "loc.append( \"collection\" , config.finalShort )",
          "new_text": "config.finalShort.empty()",
          "old_line_content": "                        loc.append( \"collection\" , config.finalShort );",
          "new_line_content": "                    if ( !config.finalShort.empty() )",
          "content_same": false
        },
        {
          "line": 1075,
          "old_api": "obj",
          "new_api": "append",
          "old_text": "loc.obj()",
          "new_text": "loc.append( \"collection\" , config.finalShort )",
          "old_line_content": "                    result.append(\"result\", loc.obj());",
          "new_line_content": "                        loc.append( \"collection\" , config.finalShort );",
          "content_same": false
        },
        {
          "line": 1079,
          "old_api": "append",
          "new_api": "empty",
          "old_text": "result.append( \"result\" , config.finalShort )",
          "new_text": "config.finalShort.empty()",
          "old_line_content": "                        result.append( \"result\" , config.finalShort );",
          "new_line_content": "                    if ( !config.finalShort.empty() )",
          "content_same": false
        },
        {
          "line": 1082,
          "old_api": "appendNumber",
          "new_api": "millis",
          "old_text": "countsBuilder.appendNumber( \"output\" , finalCount )",
          "new_text": "t.millis()",
          "old_line_content": "                countsBuilder.appendNumber( \"output\" , finalCount );",
          "new_line_content": "                result.append( \"timeMillis\" , t.millis() );",
          "content_same": false
        },
        {
          "line": 1083,
          "old_api": "obj",
          "new_api": "appendNumber",
          "old_text": "timingBuilder.obj()",
          "new_text": "countsBuilder.appendNumber( \"output\" , finalCount )",
          "old_line_content": "                if ( config.verbose ) result.append( \"timing\" , timingBuilder.obj() );",
          "new_line_content": "                countsBuilder.appendNumber( \"output\" , finalCount );",
          "content_same": false
        },
        {
          "line": 1125,
          "old_api": "next",
          "new_api": "more",
          "old_text": "i.next()",
          "new_text": "i.more()",
          "old_line_content": "                        BSONElement e = i.next();",
          "new_line_content": "                    while ( i.more() ) {",
          "content_same": false
        },
        {
          "line": 1126,
          "old_api": "fieldName",
          "new_api": "next",
          "old_text": "e.fieldName()",
          "new_text": "i.next()",
          "old_line_content": "                        string shard = e.fieldName();",
          "new_line_content": "                        BSONElement e = i.next();",
          "content_same": false
        },
        {
          "line": 1131,
          "old_api": "insert",
          "new_api": "valuestrsafe",
          "old_text": "servers.insert( shard )",
          "new_text": "res[\"result\"].valuestrsafe()",
          "old_line_content": "                        servers.insert( shard );",
          "new_line_content": "                        uassert( 10078 ,  \"something bad happened\" , shardedOutputCollection == res[\"result\"].valuestrsafe() );",
          "content_same": false
        },
        {
          "line": 1132,
          "old_api": "appendAs",
          "new_api": "insert",
          "old_text": "shardCounts.appendAs( res[\"counts\"] , shard )",
          "new_text": "servers.insert( shard )",
          "old_line_content": "                        shardCounts.appendAs( res[\"counts\"] , shard );",
          "new_line_content": "                        servers.insert( shard );",
          "content_same": false
        },
        {
          "line": 1135,
          "old_api": "more",
          "new_api": "embeddedObjectUserCheck",
          "old_text": "j.more()",
          "new_text": "res[\"counts\"].embeddedObjectUserCheck()",
          "old_line_content": "                        while ( j.more() ) {",
          "new_line_content": "                        BSONObjIterator j( res[\"counts\"].embeddedObjectUserCheck() );",
          "content_same": false
        },
        {
          "line": 1136,
          "old_api": "next",
          "new_api": "more",
          "old_text": "j.next()",
          "new_text": "j.more()",
          "old_line_content": "                            BSONElement temp = j.next();",
          "new_line_content": "                        while ( j.more() ) {",
          "content_same": false
        },
        {
          "line": 1137,
          "old_api": "numberLong",
          "new_api": "next",
          "old_text": "temp.numberLong()",
          "new_text": "j.next()",
          "old_line_content": "                            counts[temp.fieldName()] += temp.numberLong();",
          "new_line_content": "                            BSONElement temp = j.next();",
          "content_same": false
        },
        {
          "line": 1154,
          "old_api": "init",
          "new_api": "sort",
          "old_text": "cursor.init()",
          "new_text": "Query().sort( sortKey )",
          "old_line_content": "                    cursor.init();",
          "new_line_content": "                                                        Query().sort( sortKey ) );",
          "content_same": false
        },
        {
          "line": 1161,
          "old_api": "append",
          "new_api": "empty",
          "old_text": "loc.append( \"db\" , config.outDB )",
          "new_text": "config.outDB.empty()",
          "old_line_content": "                            loc.append( \"db\" , config.outDB );",
          "new_line_content": "                        if ( !config.outDB.empty())",
          "content_same": false
        },
        {
          "line": 1162,
          "old_api": "empty",
          "new_api": "append",
          "old_text": "config.finalShort.empty()",
          "new_text": "loc.append( \"db\" , config.outDB )",
          "old_line_content": "                        if ( !config.finalShort.empty() )",
          "new_line_content": "                            loc.append( \"db\" , config.outDB );",
          "content_same": false
        },
        {
          "line": 1163,
          "old_api": "append",
          "new_api": "empty",
          "old_text": "loc.append( \"collection\" , config.finalShort )",
          "new_text": "config.finalShort.empty()",
          "old_line_content": "                            loc.append( \"collection\" , config.finalShort );",
          "new_line_content": "                        if ( !config.finalShort.empty() )",
          "content_same": false
        },
        {
          "line": 1164,
          "old_api": "obj",
          "new_api": "append",
          "old_text": "loc.obj()",
          "new_text": "loc.append( \"collection\" , config.finalShort )",
          "old_line_content": "                        result.append(\"result\", loc.obj());",
          "new_line_content": "                            loc.append( \"collection\" , config.finalShort );",
          "content_same": false
        },
        {
          "line": 1168,
          "old_api": "append",
          "new_api": "empty",
          "old_text": "result.append( \"result\" , config.finalShort )",
          "new_text": "config.finalShort.empty()",
          "old_line_content": "                            result.append( \"result\" , config.finalShort );",
          "new_line_content": "                        if ( !config.finalShort.empty() )",
          "content_same": false
        },
        {
          "line": 1172,
          "old_api": "next",
          "new_api": "more",
          "old_text": "cursor.next().getOwned()",
          "new_text": "cursor.more()",
          "old_line_content": "                        BSONObj t = cursor.next().getOwned();",
          "new_line_content": "                    while ( cursor.more() ) {",
          "content_same": false
        },
        {
          "line": 1175,
          "old_api": "push_back",
          "new_api": "size",
          "old_text": "values.push_back( t )",
          "new_text": "values.size()",
          "old_line_content": "                            values.push_back( t );",
          "new_line_content": "                        if ( values.size() == 0 ) {",
          "content_same": false
        },
        {
          "line": 1180,
          "old_api": "push_back",
          "new_api": "begin",
          "old_text": "values.push_back( t )",
          "new_text": "values.begin()",
          "old_line_content": "                            values.push_back( t );",
          "new_line_content": "                        if ( t.woSortOrder( *(values.begin()) , sortKey ) == 0 ) {",
          "content_same": false
        },
        {
          "line": 1186,
          "old_api": "clear",
          "new_api": "get",
          "old_text": "values.clear()",
          "new_text": "config.finalizer.get()",
          "old_line_content": "                        values.clear();",
          "new_line_content": "                        state.emit( config.reducer->finalReduce( values , config.finalizer.get() ) );",
          "content_same": false
        },
        {
          "line": 1187,
          "old_api": "push_back",
          "new_api": "clear",
          "old_text": "values.push_back( t )",
          "new_text": "values.clear()",
          "old_line_content": "                        values.push_back( t );",
          "new_line_content": "                        values.clear();",
          "content_same": false
        },
        {
          "line": 1191,
          "old_api": "get",
          "new_api": "size",
          "old_text": "config.finalizer.get()",
          "new_text": "values.size()",
          "old_line_content": "                        state.emit( config.reducer->finalReduce( values , config.finalizer.get() ) );",
          "new_line_content": "                    if ( values.size() )",
          "content_same": false
        },
        {
          "line": 1196,
          "old_api": "postProcessCollection",
          "new_api": "dumpToInc",
          "old_text": "state.postProcessCollection()",
          "new_text": "state.dumpToInc()",
          "old_line_content": "                state.postProcessCollection();",
          "new_line_content": "                state.dumpToInc();",
          "content_same": false
        },
        {
          "line": 1197,
          "old_api": "appendResults",
          "new_api": "postProcessCollection",
          "old_text": "state.appendResults( result )",
          "new_text": "state.postProcessCollection()",
          "old_line_content": "                state.appendResults( result );",
          "new_line_content": "                state.postProcessCollection();",
          "content_same": false
        },
        {
          "line": 1202,
          "old_api": "done",
          "new_api": "dropCollection",
          "old_text": "conn.done()",
          "new_text": "conn->dropCollection( dbname + \".\" + shardedOutputCollection )",
          "old_line_content": "                    conn.done();",
          "new_line_content": "                    conn->dropCollection( dbname + \".\" + shardedOutputCollection );",
          "content_same": false
        },
        {
          "line": 1210,
          "old_api": "append",
          "new_api": "end",
          "old_text": "c.append( i->first , i->second )",
          "new_text": "counts.end()",
          "old_line_content": "                        c.append( i->first , i->second );",
          "new_line_content": "                    for ( map<string,long long>::iterator i=counts.begin(); i!=counts.end(); i++ ) {",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 1025,
          "old_api": null,
          "new_api": "hit",
          "old_text": null,
          "new_text": "pm.hit()",
          "old_line_content": "",
          "new_line_content": "                            pm.hit();",
          "content_same": false
        },
        {
          "line": 1156,
          "old_api": null,
          "new_api": "init",
          "old_text": null,
          "new_text": "state.init()",
          "old_line_content": "",
          "new_line_content": "                    state.init();",
          "content_same": false
        },
        {
          "line": 1031,
          "old_api": null,
          "new_api": "finished",
          "old_text": null,
          "new_text": "pm.finished()",
          "old_line_content": "",
          "new_line_content": "                    pm.finished();",
          "content_same": false
        },
        {
          "line": 1159,
          "old_api": null,
          "new_api": "empty",
          "old_text": null,
          "new_text": "config.outDB.empty()",
          "old_line_content": "                        BSONObjBuilder loc;",
          "new_line_content": "                    if (!config.outDB.empty()) {",
          "content_same": false
        },
        {
          "line": 1033,
          "old_api": null,
          "new_api": "checkForInterrupt",
          "old_text": null,
          "new_text": "killCurrentOp.checkForInterrupt()",
          "old_line_content": "                    // update counters",
          "new_line_content": "                    killCurrentOp.checkForInterrupt();",
          "content_same": false
        },
        {
          "line": 1037,
          "old_api": null,
          "new_api": "numEmits",
          "old_text": null,
          "new_text": "state.numEmits()",
          "old_line_content": "                        shouldHaveData = true;",
          "new_line_content": "                    if ( state.numEmits() )",
          "content_same": false
        },
        {
          "line": 1165,
          "old_api": null,
          "new_api": "obj",
          "old_text": null,
          "new_text": "loc.obj()",
          "old_line_content": "                    }",
          "new_line_content": "                        result.append(\"result\", loc.obj());",
          "content_same": false
        },
        {
          "line": 1041,
          "old_api": null,
          "new_api": "millis",
          "old_text": null,
          "new_text": "t.millis()",
          "old_line_content": "",
          "new_line_content": "                    timingBuilder.append( \"emitLoop\" , t.millis() );",
          "content_same": false
        },
        {
          "line": 1169,
          "old_api": null,
          "new_api": "append",
          "old_text": null,
          "new_text": "result.append( \"result\" , config.finalShort )",
          "old_line_content": "                    }",
          "new_line_content": "                            result.append( \"result\" , config.finalShort );",
          "content_same": false
        },
        {
          "line": 1043,
          "old_api": null,
          "new_api": "setMessage",
          "old_text": null,
          "new_text": "op->setMessage( \"m/r: (2/3) final reduce in memory\" )",
          "old_line_content": "                    Timer t;",
          "new_line_content": "                    op->setMessage( \"m/r: (2/3) final reduce in memory\" );",
          "content_same": false
        },
        {
          "line": 1173,
          "old_api": null,
          "new_api": "next",
          "old_text": null,
          "new_text": "cursor.next().getOwned()",
          "old_line_content": "",
          "new_line_content": "                        BSONObj t = cursor.next().getOwned();",
          "content_same": false
        },
        {
          "line": 1047,
          "old_api": null,
          "new_api": "reduceInMemory",
          "old_text": null,
          "new_text": "state.reduceInMemory()",
          "old_line_content": "                    // if not inline: dump the in memory map to inc collection, all data is on disk",
          "new_line_content": "                    state.reduceInMemory();",
          "content_same": false
        },
        {
          "line": 1176,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "values.push_back( t )",
          "old_line_content": "                            continue;",
          "new_line_content": "                            values.push_back( t );",
          "content_same": false
        },
        {
          "line": 1050,
          "old_api": null,
          "new_api": "prepTempCollection",
          "old_text": null,
          "new_text": "state.prepTempCollection()",
          "old_line_content": "                    // final reduce",
          "new_line_content": "                    state.prepTempCollection();",
          "content_same": false
        },
        {
          "line": 1181,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "values.push_back( t )",
          "old_line_content": "                            continue;",
          "new_line_content": "                            values.push_back( t );",
          "content_same": false
        },
        {
          "line": 1151,
          "old_api": null,
          "new_api": "BSON",
          "old_text": null,
          "new_text": "BSON( \"_id\" << 1 )",
          "old_line_content": "",
          "new_line_content": "                    BSONObj sortKey = BSON( \"_id\" << 1 );",
          "content_same": false
        },
        {
          "line": 1056,
          "old_api": null,
          "new_api": "jsMode",
          "old_text": null,
          "new_text": "state.jsMode()",
          "old_line_content": "",
          "new_line_content": "                    timingBuilder.append( \"mode\" , state.jsMode() ? \"js\" : \"mixed\" );",
          "content_same": false
        },
        {
          "line": 1188,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "values.push_back( t )",
          "old_line_content": "                    }",
          "new_line_content": "                        values.push_back( t );",
          "content_same": false
        },
        {
          "line": 1061,
          "old_api": null,
          "new_api": "log",
          "old_text": null,
          "new_text": "log()",
          "old_line_content": "                    throw;",
          "new_line_content": "                    log() << \"mr failed, removing collection\" << endl;",
          "content_same": false
        },
        {
          "line": 1192,
          "old_api": null,
          "new_api": "get",
          "old_text": null,
          "new_text": "config.finalizer.get()",
          "old_line_content": "                }",
          "new_line_content": "                        state.emit( config.reducer->finalReduce( values , config.finalizer.get() ) );",
          "content_same": false
        },
        {
          "line": 1066,
          "old_api": null,
          "new_api": "appendResults",
          "old_text": null,
          "new_text": "state.appendResults( result )",
          "old_line_content": "",
          "new_line_content": "                state.appendResults( result );",
          "content_same": false
        },
        {
          "line": 1068,
          "old_api": null,
          "new_api": "millis",
          "old_text": null,
          "new_text": "t.millis()",
          "old_line_content": "",
          "new_line_content": "                timingBuilder.append( \"total\" , t.millis() );",
          "content_same": false
        },
        {
          "line": 1070,
          "old_api": null,
          "new_api": "empty",
          "old_text": null,
          "new_text": "config.outDB.empty()",
          "old_line_content": "                    BSONObjBuilder loc;",
          "new_line_content": "                if (!config.outDB.empty()) {",
          "content_same": false
        },
        {
          "line": 1198,
          "old_api": null,
          "new_api": "appendResults",
          "old_text": null,
          "new_text": "state.appendResults( result )",
          "old_line_content": "",
          "new_line_content": "                state.appendResults( result );",
          "content_same": false
        },
        {
          "line": 1200,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "servers.end()",
          "old_line_content": "                    ScopedDbConnection conn( i->_server );",
          "new_line_content": "                for ( set<ServerAndQuery>::iterator i=servers.begin(); i!=servers.end(); i++ ) {",
          "content_same": false
        },
        {
          "line": 1203,
          "old_api": null,
          "new_api": "done",
          "old_text": null,
          "new_text": "conn.done()",
          "old_line_content": "                }",
          "new_line_content": "                    conn.done();",
          "content_same": false
        },
        {
          "line": 1076,
          "old_api": null,
          "new_api": "obj",
          "old_text": null,
          "new_text": "loc.obj()",
          "old_line_content": "                }",
          "new_line_content": "                    result.append(\"result\", loc.obj());",
          "content_same": false
        },
        {
          "line": 1206,
          "old_api": null,
          "new_api": "obj",
          "old_text": null,
          "new_text": "shardCounts.obj()",
          "old_line_content": "",
          "new_line_content": "                result.append( \"shardCounts\" , shardCounts.obj() );",
          "content_same": false
        },
        {
          "line": 1080,
          "old_api": null,
          "new_api": "append",
          "old_text": null,
          "new_text": "result.append( \"result\" , config.finalShort )",
          "old_line_content": "                }",
          "new_line_content": "                        result.append( \"result\" , config.finalShort );",
          "content_same": false
        },
        {
          "line": 1211,
          "old_api": null,
          "new_api": "append",
          "old_text": null,
          "new_text": "c.append( i->first , i->second )",
          "old_line_content": "                    }",
          "new_line_content": "                        c.append( i->first , i->second );",
          "content_same": false
        },
        {
          "line": 1085,
          "old_api": null,
          "new_api": "obj",
          "old_text": null,
          "new_text": "countsBuilder.obj()",
          "old_line_content": "",
          "new_line_content": "                result.append( \"counts\" , countsBuilder.obj() );",
          "content_same": false
        },
        {
          "line": 1213,
          "old_api": null,
          "new_api": "obj",
          "old_text": null,
          "new_text": "c.obj()",
          "old_line_content": "                }",
          "new_line_content": "                    result.append( \"counts\" , c.obj() );",
          "content_same": false
        },
        {
          "line": 1088,
          "old_api": null,
          "new_api": "append",
          "old_text": null,
          "new_text": "result.append( \"cmd\" , cmd )",
          "old_line_content": "                    errmsg = \"there were emits but no data!\";",
          "new_line_content": "                    result.append( \"cmd\" , cmd );",
          "content_same": false
        },
        {
          "line": 1109,
          "old_api": null,
          "new_api": "valuestrsafe",
          "old_text": null,
          "new_text": "cmdObj[\"shardedOutputCollection\"].valuestrsafe()",
          "old_line_content": "",
          "new_line_content": "                string shardedOutputCollection = cmdObj[\"shardedOutputCollection\"].valuestrsafe();",
          "content_same": false
        },
        {
          "line": 1111,
          "old_api": null,
          "new_api": "firstElement",
          "old_text": null,
          "new_text": "cmdObj.firstElement().embeddedObjectUserCheck()",
          "old_line_content": "                config.incLong = config.tempLong;",
          "new_line_content": "                Config config( dbname , cmdObj.firstElement().embeddedObjectUserCheck() );",
          "content_same": false
        },
        {
          "line": 984,
          "old_api": null,
          "new_api": "currentMatches",
          "old_text": null,
          "new_text": "cursor->currentMatches()",
          "old_line_content": "                            // make sure we dont process duplicates in case data gets moved around during map",
          "new_line_content": "                            if ( ! cursor->currentMatches() ) {",
          "content_same": false
        },
        {
          "line": 1119,
          "old_api": null,
          "new_api": "embeddedObjectUserCheck",
          "old_text": null,
          "new_text": "cmdObj[\"shards\"].embeddedObjectUserCheck()",
          "old_line_content": "                vector< auto_ptr<DBClientCursor> > shardCursors;",
          "new_line_content": "                BSONObj shards = cmdObj[\"shards\"].embeddedObjectUserCheck();",
          "content_same": false
        },
        {
          "line": 992,
          "old_api": null,
          "new_api": "advance",
          "old_text": null,
          "new_text": "cursor->advance()",
          "old_line_content": "                                continue;",
          "new_line_content": "                                cursor->advance();",
          "content_same": false
        },
        {
          "line": 997,
          "old_api": null,
          "new_api": "advance",
          "old_text": null,
          "new_text": "cursor->advance()",
          "old_line_content": "",
          "new_line_content": "                            cursor->advance();",
          "content_same": false
        },
        {
          "line": 1127,
          "old_api": null,
          "new_api": "fieldName",
          "old_text": null,
          "new_text": "e.fieldName()",
          "old_line_content": "",
          "new_line_content": "                        string shard = e.fieldName();",
          "content_same": false
        },
        {
          "line": 1001,
          "old_api": null,
          "new_api": "belongsToMe",
          "old_text": null,
          "new_text": "chunkManager->belongsToMe( o )",
          "old_line_content": "                                continue;",
          "new_line_content": "                            if ( chunkManager && ! chunkManager->belongsToMe( o ) )",
          "content_same": false
        },
        {
          "line": 1129,
          "old_api": null,
          "new_api": "embeddedObjectUserCheck",
          "old_text": null,
          "new_text": "e.embeddedObjectUserCheck()",
          "old_line_content": "",
          "new_line_content": "                        BSONObj res = e.embeddedObjectUserCheck();",
          "content_same": false
        },
        {
          "line": 1133,
          "old_api": null,
          "new_api": "appendAs",
          "old_text": null,
          "new_text": "shardCounts.appendAs( res[\"counts\"] , shard )",
          "old_line_content": "",
          "new_line_content": "                        shardCounts.appendAs( res[\"counts\"] , shard );",
          "content_same": false
        },
        {
          "line": 1007,
          "old_api": null,
          "new_api": "micros",
          "old_text": null,
          "new_text": "mt.micros()",
          "old_line_content": "",
          "new_line_content": "                            if ( config.verbose ) mapTime += mt.micros();",
          "content_same": false
        },
        {
          "line": 1138,
          "old_api": null,
          "new_api": "numberLong",
          "old_text": null,
          "new_text": "temp.numberLong()",
          "old_line_content": "                        }",
          "new_line_content": "                            counts[temp.fieldName()] += temp.numberLong();",
          "content_same": false
        },
        {
          "line": 1012,
          "old_api": null,
          "new_api": "get",
          "old_text": null,
          "new_text": "cursor.get()",
          "old_line_content": "                                Timer t;",
          "new_line_content": "                                ClientCursor::YieldLock yield (cursor.get());",
          "content_same": false
        },
        {
          "line": 1016,
          "old_api": null,
          "new_api": "micros",
          "old_text": null,
          "new_text": "t.micros()",
          "old_line_content": "",
          "new_line_content": "                                inReduce += t.micros();",
          "content_same": false
        },
        {
          "line": 1146,
          "old_api": null,
          "new_api": "prepTempCollection",
          "old_text": null,
          "new_text": "state.prepTempCollection()",
          "old_line_content": "",
          "new_line_content": "                state.prepTempCollection();",
          "content_same": false
        },
        {
          "line": 1019,
          "old_api": null,
          "new_api": "release",
          "old_text": null,
          "new_text": "cursor.release()",
          "old_line_content": "                                    break;",
          "new_line_content": "                                    cursor.release();",
          "content_same": false
        },
        {
          "line": 1023,
          "old_api": null,
          "new_api": "checkForInterrupt",
          "old_text": null,
          "new_text": "killCurrentOp.checkForInterrupt()",
          "old_line_content": "                            }",
          "new_line_content": "                                killCurrentOp.checkForInterrupt();",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 1024,
          "old_api": "hit",
          "new_api": null,
          "old_text": "pm.hit()",
          "new_text": null,
          "old_line_content": "                            pm.hit();",
          "new_line_content": "                            }",
          "content_same": false
        },
        {
          "line": 1145,
          "old_api": "prepTempCollection",
          "new_api": null,
          "old_text": "state.prepTempCollection()",
          "new_text": null,
          "old_line_content": "                state.prepTempCollection();",
          "new_line_content": "                State state(config);",
          "content_same": false
        },
        {
          "line": 1153,
          "old_api": "sort",
          "new_api": null,
          "old_text": "Query().sort( sortKey )",
          "new_text": null,
          "old_line_content": "                                                        Query().sort( sortKey ) );",
          "new_line_content": "                    ParallelSortClusteredCursor cursor( servers , dbname + \".\" + shardedOutputCollection ,",
          "content_same": false
        },
        {
          "line": 1030,
          "old_api": "finished",
          "new_api": null,
          "old_text": "pm.finished()",
          "new_text": null,
          "old_line_content": "                    pm.finished();",
          "new_line_content": "                    }",
          "content_same": false
        },
        {
          "line": 1158,
          "old_api": "empty",
          "new_api": null,
          "old_text": "config.outDB.empty()",
          "new_text": null,
          "old_line_content": "                    if (!config.outDB.empty()) {",
          "new_line_content": "                    BSONList values;",
          "content_same": false
        },
        {
          "line": 1032,
          "old_api": "checkForInterrupt",
          "new_api": null,
          "old_text": "killCurrentOp.checkForInterrupt()",
          "new_text": null,
          "old_line_content": "                    killCurrentOp.checkForInterrupt();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1160,
          "old_api": "empty",
          "new_api": null,
          "old_text": "config.outDB.empty()",
          "new_text": null,
          "old_line_content": "                        if ( !config.outDB.empty())",
          "new_line_content": "                        BSONObjBuilder loc;",
          "content_same": false
        },
        {
          "line": 1034,
          "old_api": "appendNumber",
          "new_api": null,
          "old_text": "countsBuilder.appendNumber( \"input\" , num )",
          "new_text": null,
          "old_line_content": "                    countsBuilder.appendNumber( \"input\" , num );",
          "new_line_content": "                    // update counters",
          "content_same": false
        },
        {
          "line": 1039,
          "old_api": "append",
          "new_api": null,
          "old_text": "timingBuilder.append( \"mapTime\" , mapTime / 1000 )",
          "new_text": null,
          "old_line_content": "                    timingBuilder.append( \"mapTime\" , mapTime / 1000 );",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1167,
          "old_api": "empty",
          "new_api": null,
          "old_text": "config.finalShort.empty()",
          "new_text": null,
          "old_line_content": "                        if ( !config.finalShort.empty() )",
          "new_line_content": "                    else {",
          "content_same": false
        },
        {
          "line": 1042,
          "old_api": "setMessage",
          "new_api": null,
          "old_text": "op->setMessage( \"m/r: (2/3) final reduce in memory\" )",
          "new_text": null,
          "old_line_content": "                    op->setMessage( \"m/r: (2/3) final reduce in memory\" );",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1171,
          "old_api": "more",
          "new_api": null,
          "old_text": "cursor.more()",
          "new_text": null,
          "old_line_content": "                    while ( cursor.more() ) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1046,
          "old_api": "reduceInMemory",
          "new_api": null,
          "old_text": "state.reduceInMemory()",
          "new_text": null,
          "old_line_content": "                    state.reduceInMemory();",
          "new_line_content": "                    // this will be the last reduce needed for inline mode",
          "content_same": false
        },
        {
          "line": 1174,
          "old_api": "size",
          "new_api": null,
          "old_text": "values.size()",
          "new_text": null,
          "old_line_content": "                        if ( values.size() == 0 ) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1048,
          "old_api": "dumpToInc",
          "new_api": null,
          "old_text": "state.dumpToInc()",
          "new_text": null,
          "old_line_content": "                    state.dumpToInc();",
          "new_line_content": "                    // if not inline: dump the in memory map to inc collection, all data is on disk",
          "content_same": false
        },
        {
          "line": 1150,
          "old_api": "BSON",
          "new_api": null,
          "old_text": "BSON( \"_id\" << 1 )",
          "new_text": null,
          "old_line_content": "                    BSONObj sortKey = BSON( \"_id\" << 1 );",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1051,
          "old_api": "finalReduce",
          "new_api": null,
          "old_text": "state.finalReduce( op , pm )",
          "new_text": null,
          "old_line_content": "                    state.finalReduce( op , pm );",
          "new_line_content": "                    // final reduce",
          "content_same": false
        },
        {
          "line": 1179,
          "old_api": "begin",
          "new_api": null,
          "old_text": "values.begin()",
          "new_text": null,
          "old_line_content": "                        if ( t.woSortOrder( *(values.begin()) , sortKey ) == 0 ) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1185,
          "old_api": "get",
          "new_api": null,
          "old_text": "config.finalizer.get()",
          "new_text": null,
          "old_line_content": "                        state.emit( config.reducer->finalReduce( values , config.finalizer.get() ) );",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1060,
          "old_api": "log",
          "new_api": null,
          "old_text": "log()",
          "new_text": null,
          "old_line_content": "                    log() << \"mr failed, removing collection\" << endl;",
          "new_line_content": "                catch ( ... ) {",
          "content_same": false
        },
        {
          "line": 1190,
          "old_api": "size",
          "new_api": null,
          "old_text": "values.size()",
          "new_text": null,
          "old_line_content": "                    if ( values.size() )",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1064,
          "old_api": "postProcessCollection",
          "new_api": null,
          "old_text": "state.postProcessCollection()",
          "new_text": null,
          "old_line_content": "                long long finalCount = state.postProcessCollection();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1067,
          "old_api": "millis",
          "new_api": null,
          "old_text": "t.millis()",
          "new_text": null,
          "old_line_content": "                timingBuilder.append( \"total\" , t.millis() );",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1195,
          "old_api": "dumpToInc",
          "new_api": null,
          "old_text": "state.dumpToInc()",
          "new_text": null,
          "old_line_content": "                state.dumpToInc();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1069,
          "old_api": "empty",
          "new_api": null,
          "old_text": "config.outDB.empty()",
          "new_text": null,
          "old_line_content": "                if (!config.outDB.empty()) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1071,
          "old_api": "empty",
          "new_api": null,
          "old_text": "config.outDB.empty()",
          "new_text": null,
          "old_line_content": "                    if ( !config.outDB.empty())",
          "new_line_content": "                    BSONObjBuilder loc;",
          "content_same": false
        },
        {
          "line": 1199,
          "old_api": "end",
          "new_api": null,
          "old_text": "servers.end()",
          "new_text": null,
          "old_line_content": "                for ( set<ServerAndQuery>::iterator i=servers.begin(); i!=servers.end(); i++ ) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1201,
          "old_api": "dropCollection",
          "new_api": null,
          "old_text": "conn->dropCollection( dbname + \".\" + shardedOutputCollection )",
          "new_text": null,
          "old_line_content": "                    conn->dropCollection( dbname + \".\" + shardedOutputCollection );",
          "new_line_content": "                    ScopedDbConnection conn( i->_server );",
          "content_same": false
        },
        {
          "line": 1205,
          "old_api": "obj",
          "new_api": null,
          "old_text": "shardCounts.obj()",
          "new_text": null,
          "old_line_content": "                result.append( \"shardCounts\" , shardCounts.obj() );",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1078,
          "old_api": "empty",
          "new_api": null,
          "old_text": "config.finalShort.empty()",
          "new_text": null,
          "old_line_content": "                    if ( !config.finalShort.empty() )",
          "new_line_content": "                else {",
          "content_same": false
        },
        {
          "line": 1081,
          "old_api": "millis",
          "new_api": null,
          "old_text": "t.millis()",
          "new_text": null,
          "old_line_content": "                result.append( \"timeMillis\" , t.millis() );",
          "new_line_content": "                }",
          "content_same": false
        },
        {
          "line": 1209,
          "old_api": "end",
          "new_api": null,
          "old_text": "counts.end()",
          "new_text": null,
          "old_line_content": "                    for ( map<string,long long>::iterator i=counts.begin(); i!=counts.end(); i++ ) {",
          "new_line_content": "                    BSONObjBuilder c;",
          "content_same": false
        },
        {
          "line": 1212,
          "old_api": "obj",
          "new_api": null,
          "old_text": "c.obj()",
          "new_text": null,
          "old_line_content": "                    result.append( \"counts\" , c.obj() );",
          "new_line_content": "                    }",
          "content_same": false
        },
        {
          "line": 1087,
          "old_api": "append",
          "new_api": null,
          "old_text": "result.append( \"cmd\" , cmd )",
          "new_text": null,
          "old_line_content": "                    result.append( \"cmd\" , cmd );",
          "new_line_content": "                if ( finalCount == 0 && shouldHaveData ) {",
          "content_same": false
        },
        {
          "line": 1108,
          "old_api": "valuestrsafe",
          "new_api": null,
          "old_text": "cmdObj[\"shardedOutputCollection\"].valuestrsafe()",
          "new_text": null,
          "old_line_content": "                string shardedOutputCollection = cmdObj[\"shardedOutputCollection\"].valuestrsafe();",
          "new_line_content": "            bool run(const string& dbname , BSONObj& cmdObj, string& errmsg, BSONObjBuilder& result, bool) {",
          "content_same": false
        },
        {
          "line": 1110,
          "old_api": "firstElement",
          "new_api": null,
          "old_text": "cmdObj.firstElement().embeddedObjectUserCheck()",
          "new_text": null,
          "old_line_content": "                Config config( dbname , cmdObj.firstElement().embeddedObjectUserCheck() );",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 986,
          "old_api": "advance",
          "new_api": null,
          "old_text": "cursor->advance()",
          "new_text": null,
          "old_line_content": "                                cursor->advance();",
          "new_line_content": "                                continue;",
          "content_same": false
        },
        {
          "line": 990,
          "old_api": "currentMatches",
          "new_api": null,
          "old_text": "cursor->currentMatches()",
          "new_text": null,
          "old_line_content": "                            if ( ! cursor->currentMatches() ) {",
          "new_line_content": "                            // TODO This won't actually help when data gets moved, it's to handle multikeys.",
          "content_same": false
        },
        {
          "line": 1118,
          "old_api": "embeddedObjectUserCheck",
          "new_api": null,
          "old_text": "cmdObj[\"shards\"].embeddedObjectUserCheck()",
          "new_text": null,
          "old_line_content": "                BSONObj shards = cmdObj[\"shards\"].embeddedObjectUserCheck();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 995,
          "old_api": "current",
          "new_api": null,
          "old_text": "cursor->current()",
          "new_text": null,
          "old_line_content": "                            BSONObj o = cursor->current();",
          "new_line_content": "                                                        ",
          "content_same": false
        },
        {
          "line": 1124,
          "old_api": "more",
          "new_api": null,
          "old_text": "i.more()",
          "new_text": null,
          "old_line_content": "                    while ( i.more() ) {",
          "new_line_content": "                    BSONObjIterator i( shards );",
          "content_same": false
        },
        {
          "line": 1000,
          "old_api": "belongsToMe",
          "new_api": null,
          "old_text": "chunkManager->belongsToMe( o )",
          "new_text": null,
          "old_line_content": "                            if ( chunkManager && ! chunkManager->belongsToMe( o ) )",
          "new_line_content": "                            // because of a chunk migration",
          "content_same": false
        },
        {
          "line": 1128,
          "old_api": "embeddedObjectUserCheck",
          "new_api": null,
          "old_text": "e.embeddedObjectUserCheck()",
          "new_text": null,
          "old_line_content": "                        BSONObj res = e.embeddedObjectUserCheck();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1130,
          "old_api": "valuestrsafe",
          "new_api": null,
          "old_text": "res[\"result\"].valuestrsafe()",
          "new_text": null,
          "old_line_content": "                        uassert( 10078 ,  \"something bad happened\" , shardedOutputCollection == res[\"result\"].valuestrsafe() );",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1004,
          "old_api": "reset",
          "new_api": null,
          "old_text": "mt.reset()",
          "new_text": null,
          "old_line_content": "                            if ( config.verbose ) mt.reset();",
          "new_line_content": "                            // do map",
          "content_same": false
        },
        {
          "line": 1134,
          "old_api": "embeddedObjectUserCheck",
          "new_api": null,
          "old_text": "res[\"counts\"].embeddedObjectUserCheck()",
          "new_text": null,
          "old_line_content": "                        BSONObjIterator j( res[\"counts\"].embeddedObjectUserCheck() );",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1011,
          "old_api": "get",
          "new_api": null,
          "old_text": "cursor.get()",
          "new_text": null,
          "old_line_content": "                                ClientCursor::YieldLock yield (cursor.get());",
          "new_line_content": "                                // try to yield lock regularly",
          "content_same": false
        },
        {
          "line": 1014,
          "old_api": "checkSize",
          "new_api": null,
          "old_text": "state.checkSize()",
          "new_text": null,
          "old_line_content": "                                state.checkSize();",
          "new_line_content": "                                // check if map needs to be dumped to disk",
          "content_same": false
        },
        {
          "line": 1017,
          "old_api": "stillOk",
          "new_api": null,
          "old_text": "yield.stillOk()",
          "new_text": null,
          "old_line_content": "                                if ( ! yield.stillOk() ) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1022,
          "old_api": "checkForInterrupt",
          "new_api": null,
          "old_text": "killCurrentOp.checkForInterrupt()",
          "new_text": null,
          "old_line_content": "                                killCurrentOp.checkForInterrupt();",
          "new_line_content": "",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 45,
      "total_additions": 50,
      "total_deletions": 50,
      "total_api_changes": 145
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 8,
        "api_related_lines": 145,
        "non_api_lines": 3,
        "non_api_line_numbers": [
          978,
          994,
          989
        ]
      }
    },
    "api_calls_before": 526,
    "api_calls_after": 526,
    "diff_info": {
      "added_lines": 6,
      "removed_lines": 5,
      "total_diff_lines": 35
    }
  }
}