{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mongo/modified_file/111fb9e41d6fac036c71f2d43763e3c7d3d492fa",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mongo/modified_file/111fb9e41d6fac036c71f2d43763e3c7d3d492fa/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mongo/modified_file/111fb9e41d6fac036c71f2d43763e3c7d3d492fa/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mongo/modified_file/111fb9e41d6fac036c71f2d43763e3c7d3d492fa/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": true,
    "api_changes": {
      "replacements": [
        {
          "line": 41,
          "old_api": "begin",
          "new_api": "nFields",
          "old_text": "pBsonObj->begin()",
          "new_text": "pBsonObj->nFields()",
          "old_line_content": "        BSONObjIterator bsonIterator(pBsonObj->begin());",
          "new_line_content": "        const int fields = pBsonObj->nFields();",
          "content_same": false
        },
        {
          "line": 42,
          "old_api": "more",
          "new_api": "reserve",
          "old_text": "bsonIterator.more()",
          "new_text": "vFieldName.reserve(fields)",
          "old_line_content": "        while(bsonIterator.more()) {",
          "new_line_content": "        vFieldName.reserve(fields);",
          "content_same": false
        },
        {
          "line": 43,
          "old_api": "next",
          "new_api": "reserve",
          "old_text": "bsonIterator.next()",
          "new_text": "vpValue.reserve(fields)",
          "old_line_content": "            BSONElement bsonElement(bsonIterator.next());",
          "new_line_content": "        vpValue.reserve(fields);",
          "content_same": false
        },
        {
          "line": 44,
          "old_api": "fieldName",
          "new_api": "begin",
          "old_text": "bsonElement.fieldName()",
          "new_text": "pBsonObj->begin()",
          "old_line_content": "            string fieldName(bsonElement.fieldName());",
          "new_line_content": "        BSONObjIterator bsonIterator(pBsonObj->begin());",
          "content_same": false
        },
        {
          "line": 52,
          "old_api": "push_back",
          "new_api": "Value::createFromBsonElement(&bsonElement)",
          "old_text": "vpValue.push_back(pValue)",
          "new_text": "Value::createFromBsonElement(&bsonElement)",
          "old_line_content": "            vpValue.push_back(pValue);",
          "new_line_content": "                Value::createFromBsonElement(&bsonElement));",
          "content_same": false
        },
        {
          "line": 80,
          "old_api": "addField",
          "new_api": "size",
          "old_text": "pNew->addField(vFieldName[i], vpValue[i])",
          "new_text": "vFieldName.size()",
          "old_line_content": "            pNew->addField(vFieldName[i], vpValue[i]);",
          "new_line_content": "        const size_t n = vFieldName.size();",
          "content_same": false
        },
        {
          "line": 157,
          "old_api": "compare",
          "new_api": "size",
          "old_text": "fieldName.compare(vFieldName[i])",
          "new_text": "vFieldName.size()",
          "old_line_content": "            if (fieldName.compare(vFieldName[i]) == 0)",
          "new_line_content": "        const size_t n = vFieldName.size();",
          "content_same": false
        },
        {
          "line": 168,
          "old_api": "hash_combine",
          "new_api": "size",
          "old_text": "vpValue[i]->hash_combine(seed)",
          "new_text": "vFieldName.size()",
          "old_line_content": "            vpValue[i]->hash_combine(seed);",
          "new_line_content": "        const size_t n = vFieldName.size();",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 137,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "vFieldName.size()",
          "old_line_content": "                return vpValue[i];",
          "new_line_content": "        const size_t n = vFieldName.size();",
          "content_same": false
        },
        {
          "line": 139,
          "old_api": null,
          "new_api": "compare",
          "old_text": null,
          "new_text": "fieldName.compare(vFieldName[i])",
          "old_line_content": "",
          "new_line_content": "            if (fieldName.compare(vFieldName[i]) == 0)",
          "content_same": false
        },
        {
          "line": 144,
          "old_api": null,
          "new_api": "intrusive_ptr<const Value>()",
          "old_text": null,
          "new_text": "intrusive_ptr<const Value>()",
          "old_line_content": "    size_t Document::getApproximateSize() const {",
          "new_line_content": "        return intrusive_ptr<const Value>();",
          "content_same": false
        },
        {
          "line": 149,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "vpValue.size()",
          "old_line_content": "",
          "new_line_content": "        const size_t n = vpValue.size();",
          "content_same": false
        },
        {
          "line": 151,
          "old_api": null,
          "new_api": "getApproximateSize",
          "old_text": null,
          "new_text": "vpValue[i]->getApproximateSize()",
          "old_line_content": "    }",
          "new_line_content": "            size += vpValue[i]->getApproximateSize();",
          "content_same": false
        },
        {
          "line": 160,
          "old_api": null,
          "new_api": "compare",
          "old_text": null,
          "new_text": "fieldName.compare(vFieldName[i])",
          "old_line_content": "",
          "new_line_content": "            if (fieldName.compare(vFieldName[i]) == 0)",
          "content_same": false
        },
        {
          "line": 170,
          "old_api": null,
          "new_api": "boost::hash_combine(seed, vFieldName[i])",
          "old_text": null,
          "new_text": "boost::hash_combine(seed, vFieldName[i])",
          "old_line_content": "    }",
          "new_line_content": "            boost::hash_combine(seed, vFieldName[i]);",
          "content_same": false
        },
        {
          "line": 171,
          "old_api": null,
          "new_api": "hash_combine",
          "old_text": null,
          "new_text": "vpValue[i]->hash_combine(seed)",
          "old_line_content": "",
          "new_line_content": "            vpValue[i]->hash_combine(seed);",
          "content_same": false
        },
        {
          "line": 45,
          "old_api": null,
          "new_api": "more",
          "old_text": null,
          "new_text": "bsonIterator.more()",
          "old_line_content": "",
          "new_line_content": "        while(bsonIterator.more()) {",
          "content_same": false
        },
        {
          "line": 46,
          "old_api": null,
          "new_api": "next",
          "old_text": null,
          "new_text": "bsonIterator.next()",
          "old_line_content": "            // LATER check pDependencies",
          "new_line_content": "            BSONElement bsonElement(bsonIterator.next());",
          "content_same": false
        },
        {
          "line": 47,
          "old_api": null,
          "new_api": "fieldName",
          "old_text": null,
          "new_text": "bsonElement.fieldName()",
          "old_line_content": "            // LATER grovel through structures???",
          "new_line_content": "            string fieldName(bsonElement.fieldName());",
          "content_same": false
        },
        {
          "line": 177,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "rL->vFieldName.size()",
          "old_line_content": "        for(size_t i = 0; true; ++i) {",
          "new_line_content": "        const size_t lSize = rL->vFieldName.size();",
          "content_same": false
        },
        {
          "line": 178,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "rR->vFieldName.size()",
          "old_line_content": "            if (i >= lSize) {",
          "new_line_content": "        const size_t rSize = rR->vFieldName.size();",
          "content_same": false
        },
        {
          "line": 54,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "vFieldName.push_back(fieldName)",
          "old_line_content": "    }",
          "new_line_content": "            vFieldName.push_back(fieldName);",
          "content_same": false
        },
        {
          "line": 55,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "vpValue.push_back(pValue)",
          "old_line_content": "",
          "new_line_content": "            vpValue.push_back(pValue);",
          "content_same": false
        },
        {
          "line": 60,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "vFieldName.size()",
          "old_line_content": "    }",
          "new_line_content": "        const size_t n = vFieldName.size();",
          "content_same": false
        },
        {
          "line": 62,
          "old_api": null,
          "new_api": "addToBsonObj",
          "old_text": null,
          "new_text": "vpValue[i]->addToBsonObj(pBuilder, vFieldName[i])",
          "old_line_content": "    intrusive_ptr<Document> Document::create(size_t sizeHint) {",
          "new_line_content": "            vpValue[i]->addToBsonObj(pBuilder, vFieldName[i]);",
          "content_same": false
        },
        {
          "line": 191,
          "old_api": null,
          "new_api": "compare",
          "old_text": null,
          "new_text": "rL->vFieldName[i].compare(rR->vFieldName[i])",
          "old_line_content": "",
          "new_line_content": "            const int nameCmp = rL->vFieldName[i].compare(rR->vFieldName[i]);",
          "content_same": false
        },
        {
          "line": 195,
          "old_api": null,
          "new_api": "Value::compare(rL->vpValue[i], rR->vpValue[i])",
          "old_text": null,
          "new_text": "Value::compare(rL->vpValue[i], rR->vpValue[i])",
          "old_line_content": "        }",
          "new_line_content": "            const int valueCmp = Value::compare(rL->vpValue[i], rR->vpValue[i]);",
          "content_same": false
        },
        {
          "line": 201,
          "old_api": null,
          "new_api": "verify",
          "old_text": null,
          "new_text": "verify(false)",
          "old_line_content": "",
          "new_line_content": "        verify(false);",
          "content_same": false
        },
        {
          "line": 74,
          "old_api": null,
          "new_api": "reserve",
          "old_text": null,
          "new_text": "vFieldName.reserve(sizeHint)",
          "old_line_content": "    }",
          "new_line_content": "            vFieldName.reserve(sizeHint);",
          "content_same": false
        },
        {
          "line": 75,
          "old_api": null,
          "new_api": "reserve",
          "old_text": null,
          "new_text": "vpValue.reserve(sizeHint)",
          "old_line_content": "",
          "new_line_content": "            vpValue.reserve(sizeHint);",
          "content_same": false
        },
        {
          "line": 83,
          "old_api": null,
          "new_api": "addField",
          "old_text": null,
          "new_text": "pNew->addField(vFieldName[i], vpValue[i])",
          "old_line_content": "    }",
          "new_line_content": "            pNew->addField(vFieldName[i], vpValue[i]);",
          "content_same": false
        },
        {
          "line": 213,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "pDocument->vFieldName.size()",
          "old_line_content": "    pair<string, intrusive_ptr<const Value> > FieldIterator::next() {",
          "new_line_content": "        return (index < pDocument->vFieldName.size());",
          "content_same": false
        },
        {
          "line": 217,
          "old_api": null,
          "new_api": "more",
          "old_text": null,
          "new_text": "more()",
          "old_line_content": "        ++index;",
          "new_line_content": "        verify(more());",
          "content_same": false
        },
        {
          "line": 92,
          "old_api": null,
          "new_api": "intrusive_ptr<Document>(this)",
          "old_text": null,
          "new_text": "intrusive_ptr<Document>(this)",
          "old_line_content": "    intrusive_ptr<const Value> Document::getValue(const string &fieldName) {",
          "new_line_content": "        return new FieldIterator(intrusive_ptr<Document>(this));",
          "content_same": false
        },
        {
          "line": 106,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "vFieldName.size()",
          "old_line_content": "                return vpValue[i];",
          "new_line_content": "        const size_t n = vFieldName.size();",
          "content_same": false
        },
        {
          "line": 108,
          "old_api": null,
          "new_api": "compare",
          "old_text": null,
          "new_text": "fieldName.compare(vFieldName[i])",
          "old_line_content": "",
          "new_line_content": "            if (fieldName.compare(vFieldName[i]) == 0)",
          "content_same": false
        },
        {
          "line": 112,
          "old_api": null,
          "new_api": "intrusive_ptr<const Value>()",
          "old_text": null,
          "new_text": "intrusive_ptr<const Value>()",
          "old_line_content": "    void Document::addField(const string &fieldName,",
          "new_line_content": "        return(intrusive_ptr<const Value>());",
          "content_same": false
        },
        {
          "line": 117,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "vFieldName.push_back(fieldName)",
          "old_line_content": "",
          "new_line_content": "        vFieldName.push_back(fieldName);",
          "content_same": false
        },
        {
          "line": 118,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "vpValue.push_back(pValue)",
          "old_line_content": "    void Document::setField(size_t index,",
          "new_line_content": "        vpValue.push_back(pValue);",
          "content_same": false
        },
        {
          "line": 125,
          "old_api": null,
          "new_api": "get",
          "old_text": null,
          "new_text": "pValue.get()",
          "old_line_content": "            return;",
          "new_line_content": "        if (!pValue.get()) {",
          "content_same": false
        },
        {
          "line": 126,
          "old_api": null,
          "new_api": "begin",
          "old_text": null,
          "new_text": "vFieldName.begin()",
          "old_line_content": "        }",
          "new_line_content": "            vFieldName.erase(vFieldName.begin() + index);",
          "content_same": false
        },
        {
          "line": 127,
          "old_api": null,
          "new_api": "begin",
          "old_text": null,
          "new_text": "vpValue.begin()",
          "old_line_content": "",
          "new_line_content": "            vpValue.erase(vpValue.begin() + index);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 134,
          "old_api": "size",
          "new_api": null,
          "old_text": "vFieldName.size()",
          "new_text": null,
          "old_line_content": "        const size_t n = vFieldName.size();",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 136,
          "old_api": "compare",
          "new_api": null,
          "old_text": "fieldName.compare(vFieldName[i])",
          "new_text": null,
          "old_line_content": "            if (fieldName.compare(vFieldName[i]) == 0)",
          "new_line_content": "    intrusive_ptr<const Value> Document::getField(const string &fieldName) const {",
          "content_same": false
        },
        {
          "line": 141,
          "old_api": "intrusive_ptr<const Value>()",
          "new_api": null,
          "old_text": "intrusive_ptr<const Value>()",
          "new_text": null,
          "old_line_content": "        return intrusive_ptr<const Value>();",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 146,
          "old_api": "size",
          "new_api": null,
          "old_text": "vpValue.size()",
          "new_text": null,
          "old_line_content": "        const size_t n = vpValue.size();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 148,
          "old_api": "getApproximateSize",
          "new_api": null,
          "old_text": "vpValue[i]->getApproximateSize()",
          "new_text": null,
          "old_line_content": "            size += vpValue[i]->getApproximateSize();",
          "new_line_content": "        size_t size = sizeof(Document);",
          "content_same": false
        },
        {
          "line": 154,
          "old_api": "size",
          "new_api": null,
          "old_text": "vFieldName.size()",
          "new_text": null,
          "old_line_content": "        const size_t n = vFieldName.size();",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 165,
          "old_api": "size",
          "new_api": null,
          "old_text": "vFieldName.size()",
          "new_text": null,
          "old_line_content": "        const size_t n = vFieldName.size();",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 167,
          "old_api": "boost::hash_combine(seed, vFieldName[i])",
          "new_api": null,
          "old_text": "boost::hash_combine(seed, vFieldName[i])",
          "new_text": null,
          "old_line_content": "            boost::hash_combine(seed, vFieldName[i]);",
          "new_line_content": "    void Document::hash_combine(size_t &seed) const {",
          "content_same": false
        },
        {
          "line": 174,
          "old_api": "size",
          "new_api": null,
          "old_text": "rL->vFieldName.size()",
          "new_text": null,
          "old_line_content": "        const size_t lSize = rL->vFieldName.size();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 175,
          "old_api": "size",
          "new_api": null,
          "old_text": "rR->vFieldName.size()",
          "new_text": null,
          "old_line_content": "        const size_t rSize = rR->vFieldName.size();",
          "new_line_content": "    int Document::compare(const intrusive_ptr<Document> &rL,",
          "content_same": false
        },
        {
          "line": 49,
          "old_api": "Value::createFromBsonElement(&bsonElement)",
          "new_api": null,
          "old_text": "Value::createFromBsonElement(&bsonElement)",
          "new_text": null,
          "old_line_content": "                Value::createFromBsonElement(&bsonElement));",
          "new_line_content": "            // LATER check pDependencies",
          "content_same": false
        },
        {
          "line": 51,
          "old_api": "push_back",
          "new_api": null,
          "old_text": "vFieldName.push_back(fieldName)",
          "new_text": null,
          "old_line_content": "            vFieldName.push_back(fieldName);",
          "new_line_content": "            intrusive_ptr<const Value> pValue(",
          "content_same": false
        },
        {
          "line": 57,
          "old_api": "size",
          "new_api": null,
          "old_text": "vFieldName.size()",
          "new_text": null,
          "old_line_content": "        const size_t n = vFieldName.size();",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 59,
          "old_api": "addToBsonObj",
          "new_api": null,
          "old_text": "vpValue[i]->addToBsonObj(pBuilder, vFieldName[i])",
          "new_text": null,
          "old_line_content": "            vpValue[i]->addToBsonObj(pBuilder, vFieldName[i]);",
          "new_line_content": "    void Document::toBson(BSONObjBuilder *pBuilder) {",
          "content_same": false
        },
        {
          "line": 188,
          "old_api": "compare",
          "new_api": null,
          "old_text": "rL->vFieldName[i].compare(rR->vFieldName[i])",
          "new_text": null,
          "old_line_content": "            const int nameCmp = rL->vFieldName[i].compare(rR->vFieldName[i]);",
          "new_line_content": "            if (i >= rSize)",
          "content_same": false
        },
        {
          "line": 192,
          "old_api": "Value::compare(rL->vpValue[i], rR->vpValue[i])",
          "new_api": null,
          "old_text": "Value::compare(rL->vpValue[i], rR->vpValue[i])",
          "new_text": null,
          "old_line_content": "            const int valueCmp = Value::compare(rL->vpValue[i], rR->vpValue[i]);",
          "new_line_content": "            if (nameCmp)",
          "content_same": false
        },
        {
          "line": 198,
          "old_api": "verify",
          "new_api": null,
          "old_text": "verify(false)",
          "new_text": null,
          "old_line_content": "        verify(false);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 71,
          "old_api": "reserve",
          "new_api": null,
          "old_text": "vFieldName.reserve(sizeHint)",
          "new_text": null,
          "old_line_content": "            vFieldName.reserve(sizeHint);",
          "new_line_content": "        vFieldName(),",
          "content_same": false
        },
        {
          "line": 72,
          "old_api": "reserve",
          "new_api": null,
          "old_text": "vpValue.reserve(sizeHint)",
          "new_text": null,
          "old_line_content": "            vpValue.reserve(sizeHint);",
          "new_line_content": "        vpValue() {",
          "content_same": false
        },
        {
          "line": 77,
          "old_api": "size",
          "new_api": null,
          "old_text": "vFieldName.size()",
          "new_text": null,
          "old_line_content": "        const size_t n = vFieldName.size();",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 210,
          "old_api": "size",
          "new_api": null,
          "old_text": "pDocument->vFieldName.size()",
          "new_text": null,
          "old_line_content": "        return (index < pDocument->vFieldName.size());",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 214,
          "old_api": "more",
          "new_api": null,
          "old_text": "more()",
          "new_text": null,
          "old_line_content": "        verify(more());",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 89,
          "old_api": "intrusive_ptr<Document>(this)",
          "new_api": null,
          "old_text": "intrusive_ptr<Document>(this)",
          "new_text": null,
          "old_line_content": "        return new FieldIterator(intrusive_ptr<Document>(this));",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 103,
          "old_api": "size",
          "new_api": null,
          "old_text": "vFieldName.size()",
          "new_text": null,
          "old_line_content": "        const size_t n = vFieldName.size();",
          "new_line_content": "          in a particular place as we would with a statically compilable",
          "content_same": false
        },
        {
          "line": 105,
          "old_api": "compare",
          "new_api": null,
          "old_text": "fieldName.compare(vFieldName[i])",
          "new_text": null,
          "old_line_content": "            if (fieldName.compare(vFieldName[i]) == 0)",
          "new_line_content": "        */",
          "content_same": false
        },
        {
          "line": 109,
          "old_api": "intrusive_ptr<const Value>()",
          "new_api": null,
          "old_text": "intrusive_ptr<const Value>()",
          "new_text": null,
          "old_line_content": "        return(intrusive_ptr<const Value>());",
          "new_line_content": "                return vpValue[i];",
          "content_same": false
        },
        {
          "line": 114,
          "old_api": "push_back",
          "new_api": null,
          "old_text": "vFieldName.push_back(fieldName)",
          "new_text": null,
          "old_line_content": "        vFieldName.push_back(fieldName);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 115,
          "old_api": "push_back",
          "new_api": null,
          "old_text": "vpValue.push_back(pValue)",
          "new_text": null,
          "old_line_content": "        vpValue.push_back(pValue);",
          "new_line_content": "    void Document::addField(const string &fieldName,",
          "content_same": false
        },
        {
          "line": 122,
          "old_api": "get",
          "new_api": null,
          "old_text": "pValue.get()",
          "new_text": null,
          "old_line_content": "        if (!pValue.get()) {",
          "new_line_content": "                            const string &fieldName,",
          "content_same": false
        },
        {
          "line": 123,
          "old_api": "begin",
          "new_api": null,
          "old_text": "vFieldName.begin()",
          "new_text": null,
          "old_line_content": "            vFieldName.erase(vFieldName.begin() + index);",
          "new_line_content": "                            const intrusive_ptr<const Value> &pValue) {",
          "content_same": false
        },
        {
          "line": 124,
          "old_api": "begin",
          "new_api": null,
          "old_text": "vpValue.begin()",
          "new_text": null,
          "old_line_content": "            vpValue.erase(vpValue.begin() + index);",
          "new_line_content": "        /* special case:  should this field be removed? */",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 8,
      "total_additions": 34,
      "total_deletions": 31,
      "total_api_changes": 73
    },
    "non_api_changes": {
      "has_non_api_changes": false,
      "evidence": {
        "total_diff_lines": 3,
        "api_related_lines": 73,
        "non_api_lines": 0,
        "non_api_line_numbers": []
      }
    },
    "api_calls_before": 42,
    "api_calls_after": 45,
    "diff_info": {
      "added_lines": 3,
      "removed_lines": 0,
      "total_diff_lines": 15
    }
  }
}