{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mongo/modified_file/2dbc13e674091e4d67c0933be3018ee8e05c56ea",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mongo/modified_file/2dbc13e674091e4d67c0933be3018ee8e05c56ea/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mongo/modified_file/2dbc13e674091e4d67c0933be3018ee8e05c56ea/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mongo/modified_file/2dbc13e674091e4d67c0933be3018ee8e05c56ea/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 60,
          "old_api": "obj",
          "new_api": "append",
          "old_text": "temp.obj()",
          "new_text": "temp.append( o[\"_id\"] )",
          "old_line_content": "                    key = temp.obj();",
          "new_line_content": "                    temp.append( o[\"_id\"] );",
          "content_same": false
        },
        {
          "line": 69,
          "old_api": "type",
          "new_api": "invokeSafe",
          "old_text": "s->type( \"return\" )",
          "new_text": "s->invokeSafe( reduce , args )",
          "old_line_content": "            if ( s->type( \"return\" ) == Array ){",
          "new_line_content": "            s->invokeSafe( reduce , args );",
          "content_same": false
        },
        {
          "line": 70,
          "old_api": "uassert",
          "new_api": "type",
          "old_text": "uassert(\"reduce -> multiple not supported yet\",0)",
          "new_text": "s->type( \"return\" )",
          "old_line_content": "                uassert(\"reduce -> multiple not supported yet\",0);                ",
          "new_line_content": "            if ( s->type( \"return\" ) == Array ){",
          "content_same": false
        },
        {
          "line": 71,
          "old_api": "BSONObj",
          "new_api": "uassert",
          "old_text": "BSONObj()",
          "new_text": "uassert(\"reduce -> multiple not supported yet\",0)",
          "old_line_content": "                return BSONObj();",
          "new_line_content": "                uassert(\"reduce -> multiple not supported yet\",0);                ",
          "content_same": false
        },
        {
          "line": 76,
          "old_api": "obj",
          "new_api": "append",
          "old_text": "b.obj()",
          "new_text": "s->append( b , \"value\" , \"return\" )",
          "old_line_content": "            return b.obj();",
          "new_line_content": "            s->append( b , \"value\" , \"return\" );",
          "content_same": false
        },
        {
          "line": 103,
          "old_api": "begin",
          "new_api": "size",
          "old_text": "all.begin()",
          "new_text": "all.size()",
          "old_line_content": "                        insert( key , *(all.begin()) );",
          "new_line_content": "                    if ( all.size() == 1 ){",
          "content_same": false
        },
        {
          "line": 106,
          "old_api": "reduceValues",
          "new_api": "size",
          "old_text": "reduceValues( all , _scope , _reduce )",
          "new_text": "all.size()",
          "old_line_content": "                        BSONObj res = reduceValues( all , _scope , _reduce );",
          "new_line_content": "                    else if ( all.size() > 1 ){",
          "content_same": false
        },
        {
          "line": 107,
          "old_api": "insert",
          "new_api": "reduceValues",
          "old_text": "insert( key , res )",
          "new_text": "reduceValues( all , _scope , _reduce )",
          "old_line_content": "                        insert( key , res );",
          "new_line_content": "                        BSONObj res = reduceValues( all , _scope , _reduce );",
          "content_same": false
        },
        {
          "line": 128,
          "old_api": "insert",
          "new_api": "obj",
          "old_text": "_db->insert( _coll , o )",
          "new_text": "b.obj()",
          "old_line_content": "                    _db->insert( _coll , o );",
          "new_line_content": "                    BSONObj o = b.obj();",
          "content_same": false
        },
        {
          "line": 137,
          "old_api": "objsize",
          "new_api": "push_back",
          "old_text": "value.objsize()",
          "new_text": "all.push_back( value )",
          "old_line_content": "                _size += key.objsize() + value.objsize() + 32;",
          "new_line_content": "                all.push_back( value );",
          "content_same": false
        },
        {
          "line": 146,
          "old_api": "log",
          "new_api": "reduceInMemory",
          "old_text": "log(1)",
          "new_text": "reduceInMemory()",
          "old_line_content": "                log(1) << \"  mr: did reduceInMemory  \" << before << \" -->> \" << _size << endl;",
          "new_line_content": "                reduceInMemory();",
          "content_same": false
        },
        {
          "line": 152,
          "old_api": "log",
          "new_api": "dump",
          "old_text": "log(1)",
          "new_text": "dump()",
          "old_line_content": "                log(1) << \"  mr: dumping to db\" << endl;",
          "new_line_content": "                dump();",
          "content_same": false
        },
        {
          "line": 157,
          "old_api": "end",
          "new_api": "find",
          "old_text": "_nums.end()",
          "new_text": "_nums.find( key )",
          "old_line_content": "                if ( i != _nums.end() )",
          "new_line_content": "                KeyNums::iterator i = _nums.find( key );",
          "content_same": false
        },
        {
          "line": 192,
          "old_api": "obj",
          "new_api": "next",
          "old_text": "b.obj()",
          "new_text": "i.next()",
          "old_line_content": "                key = b.obj();",
          "new_line_content": "                b.appendAs( i.next() , \"_id\" );",
          "content_same": false
        },
        {
          "line": 199,
          "old_api": "next",
          "new_api": "firstElement",
          "old_text": "i.next()",
          "new_text": "key.firstElement()",
          "old_line_content": "                b.appendAs( i.next() , \"value\" );",
          "new_line_content": "                b.append( key.firstElement() );",
          "content_same": false
        },
        {
          "line": 200,
          "old_api": "obj",
          "new_api": "next",
          "old_text": "b.obj()",
          "new_text": "i.next()",
          "old_line_content": "                value = b.obj();",
          "new_line_content": "                b.appendAs( i.next() , \"value\" );",
          "content_same": false
        },
        {
          "line": 203,
          "old_api": "insert",
          "new_api": "more",
          "old_text": "_tlmr->insert( key , value )",
          "new_text": "i.more()",
          "old_line_content": "            _tlmr->insert( key , value );",
          "new_line_content": "            assert( ! i.more() );",
          "content_same": false
        },
        {
          "line": 204,
          "old_api": "BSON",
          "new_api": "insert",
          "old_text": "BSON( \"x\" << 1 )",
          "new_text": "_tlmr->insert( key , value )",
          "old_line_content": "            return BSON( \"x\" << 1 );",
          "new_line_content": "            _tlmr->insert( key , value );",
          "content_same": false
        },
        {
          "line": 213,
          "old_api": "BSONObj",
          "new_api": "resetNum",
          "old_text": "BSONObj()",
          "new_text": "_tlmr->resetNum()",
          "old_line_content": "            return BSONObj();",
          "new_line_content": "            _tlmr->resetNum();",
          "content_same": false
        },
        {
          "line": 220,
          "old_api": "trueValue",
          "new_api": "database",
          "old_text": "cmd[\"keeptemp\"].trueValue()",
          "new_text": "cc().database()",
          "old_line_content": "            if ( ! cmd[\"keeptemp\"].trueValue() )",
          "new_line_content": "            ss << cc().database()->name << \".\";",
          "content_same": false
        },
        {
          "line": 223,
          "old_api": "str",
          "new_api": "time",
          "old_text": "ss.str()",
          "new_text": "time(0)",
          "old_line_content": "            return ss.str();",
          "new_line_content": "            ss << \"mr.\" << cmd.firstElement().fieldName() << \"_\" << time(0) << \"_\" << inc++;",
          "content_same": false
        },
        {
          "line": 240,
          "old_api": "BSON",
          "new_api": "reduceValues",
          "old_text": "BSON( \"_id\" << 1 )",
          "new_text": "reduceValues( values , s , reduce )",
          "old_line_content": "                db.update( resultColl , res.extractFields( BSON( \"_id\" << 1 ) ) , res , true );",
          "new_line_content": "                BSONObj res = reduceValues( values , s , reduce );",
          "content_same": false
        },
        {
          "line": 250,
          "old_api": "count",
          "new_api": "size",
          "old_text": "db.count( resultColl , key  )",
          "new_text": "values.size()",
          "old_line_content": "                    assert( db.count( resultColl , key  ) == 1 );",
          "new_line_content": "                if ( values.size() == 1 ){",
          "content_same": false
        },
        {
          "line": 255,
          "old_api": "doReduce",
          "new_api": "remove",
          "old_text": "doReduce( resultColl , values , s , reduce )",
          "new_text": "db.remove( resultColl , key )",
          "old_line_content": "                doReduce( resultColl , values , s , reduce );",
          "new_line_content": "                db.remove( resultColl , key );",
          "content_same": false
        },
        {
          "line": 264,
          "old_api": "log",
          "new_api": "firstElement",
          "old_text": "log(1)",
          "new_text": "cmdObj.firstElement().valuestr()",
          "old_line_content": "                log(1) << \"mr ns: \" << ns << endl;",
          "new_line_content": "                string ns = cc().database()->name + '.' + cmdObj.firstElement().valuestr();",
          "content_same": false
        },
        {
          "line": 273,
          "old_api": "database",
          "new_api": "getPooledScope",
          "old_text": "cc().database()->name.c_str()",
          "new_text": "globalScriptEngine->getPooledScope( ns )",
          "old_line_content": "                s->localConnect( cc().database()->name.c_str() );",
          "new_line_content": "                auto_ptr<Scope> s = globalScriptEngine->getPooledScope( ns );",
          "content_same": false
        },
        {
          "line": 276,
          "old_api": "tempCollectionName",
          "new_api": "trueValue",
          "old_text": "tempCollectionName( cmdObj )",
          "new_text": "cmdObj[\"keeptemp\"].trueValue()",
          "old_line_content": "                string resultColl = tempCollectionName( cmdObj );",
          "new_line_content": "                bool istemp = ! cmdObj[\"keeptemp\"].trueValue();",
          "content_same": false
        },
        {
          "line": 281,
          "old_api": "valuestr",
          "new_api": "type",
          "old_text": "cmdObj[\"out\"].valuestr()",
          "new_text": "cmdObj[\"out\"].type()",
          "old_line_content": "                    finalOutput = cc().database()->name + \".\" + cmdObj[\"out\"].valuestr();",
          "new_line_content": "                if ( cmdObj[\"out\"].type() == String )",
          "content_same": false
        },
        {
          "line": 285,
          "old_api": "log",
          "new_api": "database",
          "old_text": "log(1)",
          "new_text": "cc().database()->name.size()",
          "old_line_content": "                log(1) << \"\\t resultColl: \" << resultColl << \" short: \" << resultCollShort << endl;",
          "new_line_content": "                string finalOutputShort = finalOutput.substr( cc().database()->name.size() + 1 );",
          "content_same": false
        },
        {
          "line": 286,
          "old_api": "dropCollection",
          "new_api": "log",
          "old_text": "db.dropCollection( resultColl )",
          "new_text": "log(1)",
          "old_line_content": "                db.dropCollection( resultColl );",
          "new_line_content": "                log(1) << \"\\t resultColl: \" << resultColl << \" short: \" << resultCollShort << endl;",
          "content_same": false
        },
        {
          "line": 297,
          "old_api": "init",
          "new_api": "getMongo",
          "old_text": "s->execSetup( \"MR.init()\" )",
          "new_text": "s->execSetup( (string)\"tempcoll = db[\\\"\" + resultCollShort + \"\\\"]; db.getMongo().setSlaveOk();\" , \"tempcoll1\" )",
          "old_line_content": "                    s->execSetup( \"MR.init()\" );",
          "new_line_content": "                    s->execSetup( (string)\"tempcoll = db[\\\"\" + resultCollShort + \"\\\"]; db.getMongo().setSlaveOk();\" , \"tempcoll1\" );",
          "content_same": false
        },
        {
          "line": 307,
          "old_api": "reset",
          "new_api": "get",
          "old_text": "_tlmr.reset( mrtl )",
          "new_text": "s.get()",
          "old_line_content": "                    _tlmr.reset( mrtl );",
          "new_line_content": "                    MRTL * mrtl = new MRTL( &db , resultColl , s.get() , reduceFunction );",
          "content_same": false
        },
        {
          "line": 312,
          "old_api": "embeddedObjectUserCheck",
          "new_api": "type",
          "old_text": "cmdObj[\"query\"].embeddedObjectUserCheck()",
          "new_text": "cmdObj[\"query\"].type()",
          "old_line_content": "                        filter = cmdObj[\"query\"].embeddedObjectUserCheck();",
          "new_line_content": "                    if ( cmdObj[\"query\"].type() == Object ){",
          "content_same": false
        },
        {
          "line": 317,
          "old_api": "embeddedObjectUserCheck",
          "new_api": "type",
          "old_text": "cmdObj[\"sort\"].embeddedObjectUserCheck()",
          "new_text": "cmdObj[\"sort\"].type()",
          "old_line_content": "                        q.sort( cmdObj[\"sort\"].embeddedObjectUserCheck() );",
          "new_line_content": "                    if ( cmdObj[\"sort\"].type() == Object )",
          "content_same": false
        },
        {
          "line": 320,
          "old_api": "query",
          "new_api": "count",
          "old_text": "db.query( ns , q )",
          "new_text": "db.count( ns , filter )",
          "old_line_content": "                    auto_ptr<DBClientCursor> cursor = db.query( ns , q );",
          "new_line_content": "                    ProgressMeter pm( db.count( ns , filter ) );",
          "content_same": false
        },
        {
          "line": 324,
          "old_api": "next",
          "new_api": "more",
          "old_text": "cursor->next()",
          "new_text": "cursor->more()",
          "old_line_content": "                        BSONObj o = cursor->next(); ",
          "new_line_content": "                    while ( cursor->more() ){",
          "content_same": false
        },
        {
          "line": 329,
          "old_api": "BSONObj",
          "new_api": "setThis",
          "old_text": "BSONObj()",
          "new_text": "s->setThis( &o )",
          "old_line_content": "                        if ( s->invoke( mapFunction , BSONObj() , 0 , true ) )",
          "new_line_content": "                        s->setThis( &o );",
          "content_same": false
        },
        {
          "line": 330,
          "old_api": "getError",
          "new_api": "BSONObj",
          "old_text": "s->getError()",
          "new_text": "BSONObj()",
          "old_line_content": "                            throw UserException( (string)\"map invoke failed: \" + s->getError() );",
          "new_line_content": "                        if ( s->invoke( mapFunction , BSONObj() , 0 , true ) )",
          "content_same": false
        },
        {
          "line": 338,
          "old_api": "micros",
          "new_api": "check",
          "old_text": "t.micros()",
          "new_text": "s->exec( \"MR.check();\" , \"reduce-i\" , false , true , true )",
          "old_line_content": "                            inReduce += t.micros();",
          "new_line_content": "                            s->exec( \"MR.check();\" , \"reduce-i\" , false , true , true );",
          "content_same": false
        },
        {
          "line": 346,
          "old_api": "getNumber",
          "new_api": "append",
          "old_text": "s->getNumber( \"$numEmits\" )",
          "new_text": "countsBuilder.append( \"input\" , num )",
          "old_line_content": "                    numEmits = (long long)(s->getNumber( \"$numEmits\" ));",
          "new_line_content": "                    countsBuilder.append( \"input\" , num );",
          "content_same": false
        },
        {
          "line": 347,
          "old_api": "append",
          "new_api": "getNumber",
          "old_text": "countsBuilder.append( \"emit\" , numEmits )",
          "new_text": "s->getNumber( \"$numEmits\" )",
          "old_line_content": "                    countsBuilder.append( \"emit\" , numEmits );",
          "new_line_content": "                    numEmits = (long long)(s->getNumber( \"$numEmits\" ));",
          "content_same": false
        },
        {
          "line": 350,
          "old_api": "millis",
          "new_api": "append",
          "old_text": "t.millis()",
          "new_text": "timingBuilder.append( \"mapTime\" , mapTime / 1000 )",
          "old_line_content": "                    timingBuilder.append( \"emitLoop\" , t.millis() );",
          "new_line_content": "                    timingBuilder.append( \"mapTime\" , mapTime / 1000 );",
          "content_same": false
        },
        {
          "line": 355,
          "old_api": "dump",
          "new_api": "reduceInMemory",
          "old_text": "mrtl->dump()",
          "new_text": "mrtl->reduceInMemory()",
          "old_line_content": "                    mrtl->dump();",
          "new_line_content": "                    mrtl->reduceInMemory();",
          "content_same": false
        },
        {
          "line": 360,
          "old_api": "micros",
          "new_api": "doReduce",
          "old_text": "t.micros()",
          "new_text": "s->exec( \"MR.doReduce(true)\" , \"reduce\" , false , true , true )",
          "old_line_content": "                        inReduce += t.micros();",
          "new_line_content": "                        s->exec( \"MR.doReduce(true)\" , \"reduce\" , false , true , true );",
          "content_same": false
        },
        {
          "line": 361,
          "old_api": "append",
          "new_api": "micros",
          "old_text": "timingBuilder.append( \"reduce\" , inReduce / 1000 )",
          "new_text": "t.micros()",
          "old_line_content": "                        timingBuilder.append( \"reduce\" , inReduce / 1000 );",
          "new_line_content": "                        inReduce += t.micros();",
          "content_same": false
        },
        {
          "line": 369,
          "old_api": "ascode",
          "new_api": "type",
          "old_text": "cmdObj[\"finalize\"].ascode()",
          "new_text": "cmdObj[\"finalize\"].type()",
          "old_line_content": "                        s->execSetup( (string)\"$finalize = \" + cmdObj[\"finalize\"].ascode() );",
          "new_line_content": "                    if ( cmdObj[\"finalize\"].type() ){",
          "content_same": false
        },
        {
          "line": 370,
          "old_api": "finalize",
          "new_api": "ascode",
          "old_text": "s->execSetup( \"MR.finalize()\" )",
          "new_text": "cmdObj[\"finalize\"].ascode()",
          "old_line_content": "                        s->execSetup( \"MR.finalize()\" );",
          "new_line_content": "                        s->execSetup( (string)\"$finalize = \" + cmdObj[\"finalize\"].ascode() );",
          "content_same": false
        },
        {
          "line": 374,
          "old_api": "reset",
          "new_api": "cleanup",
          "old_text": "_tlmr.reset( 0 )",
          "new_text": "s->execSetup( \"MR.cleanup()\" )",
          "old_line_content": "                    _tlmr.reset( 0 );",
          "new_line_content": "                    s->execSetup( \"MR.cleanup()\" );",
          "content_same": false
        },
        {
          "line": 401,
          "old_api": "dropCollection",
          "new_api": "log",
          "old_text": "db.dropCollection( resultColl )",
          "new_text": "log()",
          "old_line_content": "                    db.dropCollection( resultColl );",
          "new_line_content": "                    log() << \"mr failed, removing collection\" << endl;",
          "content_same": false
        },
        {
          "line": 421,
          "old_api": "millis",
          "new_api": "append",
          "old_text": "t.millis()",
          "new_text": "result.append( \"result\" , finalOutputShort )",
          "old_line_content": "                result.append( \"timeMillis\" , t.millis() );",
          "new_line_content": "                result.append( \"result\" , finalOutputShort );",
          "content_same": false
        },
        {
          "line": 422,
          "old_api": "count",
          "new_api": "millis",
          "old_text": "db.count( finalOutput )",
          "new_text": "t.millis()",
          "old_line_content": "                countsBuilder.append( \"output\" , (long long)(db.count( finalOutput )) );",
          "new_line_content": "                result.append( \"timeMillis\" , t.millis() );",
          "content_same": false
        },
        {
          "line": 423,
          "old_api": "obj",
          "new_api": "count",
          "old_text": "timingBuilder.obj()",
          "new_text": "db.count( finalOutput )",
          "old_line_content": "                if ( verboseOutput ) result.append( \"timing\" , timingBuilder.obj() );",
          "new_line_content": "                countsBuilder.append( \"output\" , (long long)(db.count( finalOutput )) );",
          "content_same": false
        },
        {
          "line": 443,
          "old_api": "valuestrsafe",
          "new_api": "database",
          "old_text": "cmdObj[\"shardedOutputCollection\"].valuestrsafe()",
          "new_text": "cc().database()",
          "old_line_content": "                string shardedOutputCollection = cmdObj[\"shardedOutputCollection\"].valuestrsafe();",
          "new_line_content": "                string dbname = cc().database()->name;",
          "content_same": false
        },
        {
          "line": 456,
          "old_api": "next",
          "new_api": "more",
          "old_text": "i.next()",
          "new_text": "i.more()",
          "old_line_content": "                    BSONElement e = i.next();",
          "new_line_content": "                while ( i.more() ){",
          "content_same": false
        },
        {
          "line": 457,
          "old_api": "fieldName",
          "new_api": "next",
          "old_text": "e.fieldName()",
          "new_text": "i.next()",
          "old_line_content": "                    string shard = e.fieldName();",
          "new_line_content": "                    BSONElement e = i.next();",
          "content_same": false
        },
        {
          "line": 462,
          "old_api": "insert",
          "new_api": "valuestrsafe",
          "old_text": "servers.insert( shard )",
          "new_text": "res[\"result\"].valuestrsafe()",
          "old_line_content": "                    servers.insert( shard );",
          "new_line_content": "                    uassert( \"something bad happened\" , shardedOutputCollection == res[\"result\"].valuestrsafe() );",
          "content_same": false
        },
        {
          "line": 463,
          "old_api": "c_str",
          "new_api": "insert",
          "old_text": "shard.c_str()",
          "new_text": "servers.insert( shard )",
          "old_line_content": "                    shardCounts.appendAs( res[\"counts\"] , shard.c_str() );",
          "new_line_content": "                    servers.insert( shard );",
          "content_same": false
        },
        {
          "line": 466,
          "old_api": "more",
          "new_api": "embeddedObjectUserCheck",
          "old_text": "j.more()",
          "new_text": "res[\"counts\"].embeddedObjectUserCheck()",
          "old_line_content": "                    while ( j.more() ){",
          "new_line_content": "                    BSONObjIterator j( res[\"counts\"].embeddedObjectUserCheck() );",
          "content_same": false
        },
        {
          "line": 467,
          "old_api": "next",
          "new_api": "more",
          "old_text": "j.next()",
          "new_text": "j.more()",
          "old_line_content": "                        BSONElement temp = j.next();",
          "new_line_content": "                    while ( j.more() ){",
          "content_same": false
        },
        {
          "line": 468,
          "old_api": "numberLong",
          "new_api": "next",
          "old_text": "temp.numberLong()",
          "new_text": "j.next()",
          "old_line_content": "                        counts[temp.fieldName()] += temp.numberLong();",
          "new_line_content": "                        BSONElement temp = j.next();",
          "content_same": false
        },
        {
          "line": 480,
          "old_api": "ascode",
          "new_api": "getPooledScope",
          "old_text": "origCmd[\"reduce\"].ascode().c_str()",
          "new_text": "globalScriptEngine->getPooledScope( ns )",
          "old_line_content": "                ScriptingFunction reduceFunction = s->createFunction( origCmd[\"reduce\"].ascode().c_str() );",
          "new_line_content": "                auto_ptr<Scope> s = globalScriptEngine->getPooledScope( ns );",
          "content_same": false
        },
        {
          "line": 485,
          "old_api": "size",
          "new_api": "valuestrsafe",
          "old_text": "output.size()",
          "new_text": "origCmd[\"out\"].valuestrsafe()",
          "old_line_content": "                if ( output.size() == 0 )",
          "new_line_content": "                string output = origCmd[\"out\"].valuestrsafe();",
          "content_same": false
        },
        {
          "line": 486,
          "old_api": "tempCollectionName",
          "new_api": "size",
          "old_text": "tempCollectionName( origCmd )",
          "new_text": "output.size()",
          "old_line_content": "                    output = tempCollectionName( origCmd );",
          "new_line_content": "                if ( output.size() == 0 )",
          "content_same": false
        },
        {
          "line": 493,
          "old_api": "next",
          "new_api": "more",
          "old_text": "cursor.next()",
          "new_text": "cursor.more()",
          "old_line_content": "                    BSONObj t = cursor.next();",
          "new_line_content": "                while ( cursor.more() ){",
          "content_same": false
        },
        {
          "line": 496,
          "old_api": "push_back",
          "new_api": "size",
          "old_text": "values.push_back( t )",
          "new_text": "values.size()",
          "old_line_content": "                        values.push_back( t );",
          "new_line_content": "                    if ( values.size() == 0 ){",
          "content_same": false
        },
        {
          "line": 501,
          "old_api": "push_back",
          "new_api": "begin",
          "old_text": "values.push_back( t )",
          "new_text": "values.begin()",
          "old_line_content": "                        values.push_back( t );",
          "new_line_content": "                    if ( t.woSortOrder( *(values.begin()) , sortKey ) == 0 ){",
          "content_same": false
        },
        {
          "line": 506,
          "old_api": "clear",
          "new_api": "get",
          "old_text": "values.clear()",
          "new_text": "s.get()",
          "old_line_content": "                    values.clear();",
          "new_line_content": "                    db.insert( fulloutput , reduceValues( values , s.get() , reduceFunction ) );",
          "content_same": false
        },
        {
          "line": 507,
          "old_api": "push_back",
          "new_api": "clear",
          "old_text": "values.push_back( t )",
          "new_text": "values.clear()",
          "old_line_content": "                    values.push_back( t );",
          "new_line_content": "                    values.clear();",
          "content_same": false
        },
        {
          "line": 511,
          "old_api": "get",
          "new_api": "size",
          "old_text": "s.get()",
          "new_text": "values.size()",
          "old_line_content": "                    db.insert( fulloutput , reduceValues( values , s.get() , reduceFunction ) );",
          "new_line_content": "                if ( values.size() )",
          "content_same": false
        },
        {
          "line": 523,
          "old_api": "append",
          "new_api": "end",
          "old_text": "c.append( i->first , i->second )",
          "new_text": "counts.end()",
          "old_line_content": "                        c.append( i->first , i->second );",
          "new_line_content": "                    for ( map<string,long long>::iterator i=counts.begin(); i!=counts.end(); i++ ){",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 512,
          "old_api": null,
          "new_api": "get",
          "old_text": null,
          "new_text": "s.get()",
          "old_line_content": "                ",
          "new_line_content": "                    db.insert( fulloutput , reduceValues( values , s.get() , reduceFunction ) );",
          "content_same": false
        },
        {
          "line": 514,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "servers.end()",
          "old_line_content": "                    ScopedDbConnection conn( i->_server );",
          "new_line_content": "                for ( set<ServerAndQuery>::iterator i=servers.begin(); i!=servers.end(); i++ ){",
          "content_same": false
        },
        {
          "line": 516,
          "old_api": null,
          "new_api": "dropCollection",
          "old_text": null,
          "new_text": "conn->dropCollection( dbname + \".\" + shardedOutputCollection )",
          "old_line_content": "                }",
          "new_line_content": "                    conn->dropCollection( dbname + \".\" + shardedOutputCollection );",
          "content_same": false
        },
        {
          "line": 519,
          "old_api": null,
          "new_api": "obj",
          "old_text": null,
          "new_text": "shardCounts.obj()",
          "old_line_content": "                ",
          "new_line_content": "                result.append( \"shardCounts\" , shardCounts.obj() );",
          "content_same": false
        },
        {
          "line": 524,
          "old_api": null,
          "new_api": "append",
          "old_text": null,
          "new_text": "c.append( i->first , i->second )",
          "old_line_content": "                    }",
          "new_line_content": "                        c.append( i->first , i->second );",
          "content_same": false
        },
        {
          "line": 526,
          "old_api": null,
          "new_api": "obj",
          "old_text": null,
          "new_text": "c.obj()",
          "old_line_content": "                }",
          "new_line_content": "                    result.append( \"counts\" , c.obj() );",
          "content_same": false
        },
        {
          "line": 48,
          "old_api": null,
          "new_api": "begin",
          "old_text": null,
          "new_text": "values.begin()->getField( \"value\" ).size()",
          "old_line_content": "            BSONObj key;",
          "new_line_content": "            int sizeEstimate = ( values.size() * values.begin()->getField( \"value\" ).size() ) + 128;",
          "content_same": false
        },
        {
          "line": 55,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "values.end()",
          "old_line_content": "                BSONObj o = *i;",
          "new_line_content": "            for ( list<BSONObj>::iterator i=values.begin(); i!=values.end(); i++){",
          "content_same": false
        },
        {
          "line": 58,
          "old_api": null,
          "new_api": "append",
          "old_text": null,
          "new_text": "reduceArgs.append( o[\"_id\"] )",
          "old_line_content": "                    BSONObjBuilder temp;",
          "new_line_content": "                    reduceArgs.append( o[\"_id\"] );",
          "content_same": false
        },
        {
          "line": 61,
          "old_api": null,
          "new_api": "obj",
          "old_text": null,
          "new_text": "temp.obj()",
          "old_line_content": "                }",
          "new_line_content": "                    key = temp.obj();",
          "content_same": false
        },
        {
          "line": 63,
          "old_api": null,
          "new_api": "c_str",
          "old_text": null,
          "new_text": "BSONObjBuilder::numStr( n++ ).c_str()",
          "old_line_content": "            }",
          "new_line_content": "                valueBuilder.appendAs( o[\"value\"] , BSONObjBuilder::numStr( n++ ).c_str() );",
          "content_same": false
        },
        {
          "line": 67,
          "old_api": null,
          "new_api": "obj",
          "old_text": null,
          "new_text": "reduceArgs.obj()",
          "old_line_content": "            ",
          "new_line_content": "            BSONObj args = reduceArgs.obj();",
          "content_same": false
        },
        {
          "line": 72,
          "old_api": null,
          "new_api": "BSONObj",
          "old_text": null,
          "new_text": "BSONObj()",
          "old_line_content": "            }",
          "new_line_content": "                return BSONObj();",
          "content_same": false
        },
        {
          "line": 77,
          "old_api": null,
          "new_api": "obj",
          "old_text": null,
          "new_text": "b.obj()",
          "old_line_content": "        }",
          "new_line_content": "            return b.obj();",
          "content_same": false
        },
        {
          "line": 99,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "old->end()",
          "old_line_content": "                    BSONObj key = i->first;",
          "new_line_content": "                for ( InMemory::iterator i=old->begin(); i!=old->end(); i++ ){",
          "content_same": false
        },
        {
          "line": 104,
          "old_api": null,
          "new_api": "begin",
          "old_text": null,
          "new_text": "all.begin()",
          "old_line_content": "                    }",
          "new_line_content": "                        insert( key , *(all.begin()) );",
          "content_same": false
        },
        {
          "line": 108,
          "old_api": null,
          "new_api": "insert",
          "old_text": null,
          "new_text": "insert( key , res )",
          "old_line_content": "                    }",
          "new_line_content": "                        insert( key , res );",
          "content_same": false
        },
        {
          "line": 116,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "_temp->end()",
          "old_line_content": "                    BSONObj key = i->first;",
          "new_line_content": "                for ( InMemory::iterator i=_temp->begin(); i!=_temp->end(); i++ ){",
          "content_same": false
        },
        {
          "line": 119,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "all.size()",
          "old_line_content": "                        continue;",
          "new_line_content": "                    if ( all.size() < 1 )",
          "content_same": false
        },
        {
          "line": 121,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "all.size()",
          "old_line_content": "                    ",
          "new_line_content": "                    assert( all.size() == 1 );",
          "content_same": false
        },
        {
          "line": 123,
          "old_api": null,
          "new_api": "begin",
          "old_text": null,
          "new_text": "all.begin()",
          "old_line_content": "",
          "new_line_content": "                    BSONObj value = *(all.begin());",
          "content_same": false
        },
        {
          "line": 126,
          "old_api": null,
          "new_api": "appendElements",
          "old_text": null,
          "new_text": "b.appendElements( value )",
          "old_line_content": "                ",
          "new_line_content": "                    b.appendElements( value );",
          "content_same": false
        },
        {
          "line": 129,
          "old_api": null,
          "new_api": "insert",
          "old_text": null,
          "new_text": "_db->insert( _coll , o )",
          "old_line_content": "                }",
          "new_line_content": "                    _db->insert( _coll , o );",
          "content_same": false
        },
        {
          "line": 131,
          "old_api": null,
          "new_api": "clear",
          "old_text": null,
          "new_text": "_temp->clear()",
          "old_line_content": "                _size = 0;",
          "new_line_content": "                _temp->clear();",
          "content_same": false
        },
        {
          "line": 138,
          "old_api": null,
          "new_api": "objsize",
          "old_text": null,
          "new_text": "value.objsize()",
          "old_line_content": "            }",
          "new_line_content": "                _size += key.objsize() + value.objsize() + 32;",
          "content_same": false
        },
        {
          "line": 147,
          "old_api": null,
          "new_api": "log",
          "old_text": null,
          "new_text": "log(1)",
          "old_line_content": "",
          "new_line_content": "                log(1) << \"  mr: did reduceInMemory  \" << before << \" -->> \" << _size << endl;",
          "content_same": false
        },
        {
          "line": 153,
          "old_api": null,
          "new_api": "log",
          "old_text": null,
          "new_text": "log(1)",
          "old_line_content": "            }",
          "new_line_content": "                log(1) << \"  mr: dumping to db\" << endl;",
          "content_same": false
        },
        {
          "line": 158,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "_nums.end()",
          "old_line_content": "                    return i->second;",
          "new_line_content": "                if ( i != _nums.end() )",
          "content_same": false
        },
        {
          "line": 160,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "_nums.size()",
          "old_line_content": "                _nums[key] = n;",
          "new_line_content": "                int n = _nums.size() + 1;",
          "content_same": false
        },
        {
          "line": 166,
          "old_api": null,
          "new_api": "clear",
          "old_text": null,
          "new_text": "_nums.clear()",
          "old_line_content": "            }",
          "new_line_content": "                _nums.clear();",
          "content_same": false
        },
        {
          "line": 190,
          "old_api": null,
          "new_api": "more",
          "old_text": null,
          "new_text": "i.more()",
          "old_line_content": "                BSONObjBuilder b;",
          "new_line_content": "                assert( i.more() );",
          "content_same": false
        },
        {
          "line": 193,
          "old_api": null,
          "new_api": "obj",
          "old_text": null,
          "new_text": "b.obj()",
          "old_line_content": "            }",
          "new_line_content": "                key = b.obj();",
          "content_same": false
        },
        {
          "line": 197,
          "old_api": null,
          "new_api": "more",
          "old_text": null,
          "new_text": "i.more()",
          "old_line_content": "                BSONObjBuilder b;",
          "new_line_content": "                assert( i.more() );",
          "content_same": false
        },
        {
          "line": 201,
          "old_api": null,
          "new_api": "obj",
          "old_text": null,
          "new_text": "b.obj()",
          "old_line_content": "            }",
          "new_line_content": "                value = b.obj();",
          "content_same": false
        },
        {
          "line": 205,
          "old_api": null,
          "new_api": "BSON",
          "old_text": null,
          "new_text": "BSON( \"x\" << 1 )",
          "old_line_content": "        }",
          "new_line_content": "            return BSON( \"x\" << 1 );",
          "content_same": false
        },
        {
          "line": 209,
          "old_api": null,
          "new_api": "getNum",
          "old_text": null,
          "new_text": "_tlmr->getNum( args )",
          "old_line_content": "        }",
          "new_line_content": "            return BSON( \"\" << _tlmr->getNum( args ) );",
          "content_same": false
        },
        {
          "line": 214,
          "old_api": null,
          "new_api": "BSONObj",
          "old_text": null,
          "new_text": "BSONObj()",
          "old_line_content": "        }",
          "new_line_content": "            return BSONObj();",
          "content_same": false
        },
        {
          "line": 221,
          "old_api": null,
          "new_api": "trueValue",
          "old_text": null,
          "new_text": "cmd[\"keeptemp\"].trueValue()",
          "old_line_content": "                ss << \"tmp.\";",
          "new_line_content": "            if ( ! cmd[\"keeptemp\"].trueValue() )",
          "content_same": false
        },
        {
          "line": 224,
          "old_api": null,
          "new_api": "str",
          "old_text": null,
          "new_text": "ss.str()",
          "old_line_content": "        }",
          "new_line_content": "            return ss.str();",
          "content_same": false
        },
        {
          "line": 237,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "values.size()",
          "old_line_content": "                    return;",
          "new_line_content": "                if ( values.size() == 0 )",
          "content_same": false
        },
        {
          "line": 241,
          "old_api": null,
          "new_api": "BSON",
          "old_text": null,
          "new_text": "BSON( \"_id\" << 1 )",
          "old_line_content": "            }",
          "new_line_content": "                db.update( resultColl , res.extractFields( BSON( \"_id\" << 1 ) ) , res , true );",
          "content_same": false
        },
        {
          "line": 245,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "values.size()",
          "old_line_content": "                    return;",
          "new_line_content": "                if ( values.size() == 0 )",
          "content_same": false
        },
        {
          "line": 248,
          "old_api": null,
          "new_api": "BSON",
          "old_text": null,
          "new_text": "BSON( \"_id\" << 1 )",
          "old_line_content": "                ",
          "new_line_content": "                BSONObj key = values.begin()->extractFields( BSON( \"_id\" << 1 ) );",
          "content_same": false
        },
        {
          "line": 251,
          "old_api": null,
          "new_api": "count",
          "old_text": null,
          "new_text": "db.count( resultColl , key  )",
          "old_line_content": "                    return;",
          "new_line_content": "                    assert( db.count( resultColl , key  ) == 1 );",
          "content_same": false
        },
        {
          "line": 256,
          "old_api": null,
          "new_api": "doReduce",
          "old_text": null,
          "new_text": "doReduce( resultColl , values , s , reduce )",
          "old_line_content": "            }",
          "new_line_content": "                doReduce( resultColl , values , s , reduce );",
          "content_same": false
        },
        {
          "line": 262,
          "old_api": null,
          "new_api": "trueValue",
          "old_text": null,
          "new_text": "cmdObj[\"verbose\"].trueValue()",
          "old_line_content": "",
          "new_line_content": "                bool verboseOutput = cmdObj[\"verbose\"].trueValue();",
          "content_same": false
        },
        {
          "line": 265,
          "old_api": null,
          "new_api": "log",
          "old_text": null,
          "new_text": "log(1)",
          "old_line_content": "                ",
          "new_line_content": "                log(1) << \"mr ns: \" << ns << endl;",
          "content_same": false
        },
        {
          "line": 267,
          "old_api": null,
          "new_api": "exists",
          "old_text": null,
          "new_text": "db.exists( ns )",
          "old_line_content": "                    errmsg = \"ns doesn't exist\";",
          "new_line_content": "                if ( ! db.exists( ns ) ){",
          "content_same": false
        },
        {
          "line": 274,
          "old_api": null,
          "new_api": "database",
          "old_text": null,
          "new_text": "cc().database()->name.c_str()",
          "old_line_content": "                ",
          "new_line_content": "                s->localConnect( cc().database()->name.c_str() );",
          "content_same": false
        },
        {
          "line": 277,
          "old_api": null,
          "new_api": "tempCollectionName",
          "old_text": null,
          "new_text": "tempCollectionName( cmdObj )",
          "old_line_content": "                if ( istemp )",
          "new_line_content": "                string resultColl = tempCollectionName( cmdObj );",
          "content_same": false
        },
        {
          "line": 279,
          "old_api": null,
          "new_api": "addTempCollection",
          "old_text": null,
          "new_text": "currentClient->addTempCollection( resultColl )",
          "old_line_content": "                string finalOutput = resultColl;",
          "new_line_content": "                    currentClient->addTempCollection( resultColl );",
          "content_same": false
        },
        {
          "line": 282,
          "old_api": null,
          "new_api": "valuestr",
          "old_text": null,
          "new_text": "cmdObj[\"out\"].valuestr()",
          "old_line_content": "                ",
          "new_line_content": "                    finalOutput = cc().database()->name + \".\" + cmdObj[\"out\"].valuestr();",
          "content_same": false
        },
        {
          "line": 287,
          "old_api": null,
          "new_api": "dropCollection",
          "old_text": null,
          "new_text": "db.dropCollection( resultColl )",
          "old_line_content": "            ",
          "new_line_content": "                db.dropCollection( resultColl );",
          "content_same": false
        },
        {
          "line": 298,
          "old_api": null,
          "new_api": "init",
          "old_text": null,
          "new_text": "s->execSetup( \"MR.init()\" )",
          "old_line_content": "",
          "new_line_content": "                    s->execSetup( \"MR.init()\" );",
          "content_same": false
        },
        {
          "line": 301,
          "old_api": null,
          "new_api": "injectNative",
          "old_text": null,
          "new_text": "s->injectNative( \"reset_num\" , reset_num )",
          "old_line_content": "                    ",
          "new_line_content": "                    s->injectNative( \"reset_num\" , reset_num );",
          "content_same": false
        },
        {
          "line": 305,
          "old_api": null,
          "new_api": "ascode",
          "old_text": null,
          "new_text": "cmdObj[\"reduce\"].ascode()",
          "old_line_content": "                    ",
          "new_line_content": "                    s->execSetup( (string)\"$reduce = \" + cmdObj[\"reduce\"].ascode() );",
          "content_same": false
        },
        {
          "line": 308,
          "old_api": null,
          "new_api": "reset",
          "old_text": null,
          "new_text": "_tlmr.reset( mrtl )",
          "old_line_content": "",
          "new_line_content": "                    _tlmr.reset( mrtl );",
          "content_same": false
        },
        {
          "line": 313,
          "old_api": null,
          "new_api": "embeddedObjectUserCheck",
          "old_text": null,
          "new_text": "cmdObj[\"query\"].embeddedObjectUserCheck()",
          "old_line_content": "                        q = filter;",
          "new_line_content": "                        filter = cmdObj[\"query\"].embeddedObjectUserCheck();",
          "content_same": false
        },
        {
          "line": 318,
          "old_api": null,
          "new_api": "embeddedObjectUserCheck",
          "old_text": null,
          "new_text": "cmdObj[\"sort\"].embeddedObjectUserCheck()",
          "old_line_content": "",
          "new_line_content": "                        q.sort( cmdObj[\"sort\"].embeddedObjectUserCheck() );",
          "content_same": false
        },
        {
          "line": 321,
          "old_api": null,
          "new_api": "query",
          "old_text": null,
          "new_text": "db.query( ns , q )",
          "old_line_content": "                    long long mapTime = 0;",
          "new_line_content": "                    auto_ptr<DBClientCursor> cursor = db.query( ns , q );",
          "content_same": false
        },
        {
          "line": 325,
          "old_api": null,
          "new_api": "next",
          "old_text": null,
          "new_text": "cursor->next()",
          "old_line_content": "                    ",
          "new_line_content": "                        BSONObj o = cursor->next(); ",
          "content_same": false
        },
        {
          "line": 327,
          "old_api": null,
          "new_api": "reset",
          "old_text": null,
          "new_text": "mt.reset()",
          "old_line_content": "                        ",
          "new_line_content": "                        if ( verboseOutput ) mt.reset();",
          "content_same": false
        },
        {
          "line": 331,
          "old_api": null,
          "new_api": "getError",
          "old_text": null,
          "new_text": "s->getError()",
          "old_line_content": "                        ",
          "new_line_content": "                            throw UserException( (string)\"map invoke failed: \" + s->getError() );",
          "content_same": false
        },
        {
          "line": 333,
          "old_api": null,
          "new_api": "micros",
          "old_text": null,
          "new_text": "mt.micros()",
          "old_line_content": "                    ",
          "new_line_content": "                        if ( verboseOutput ) mapTime += mt.micros();",
          "content_same": false
        },
        {
          "line": 339,
          "old_api": null,
          "new_api": "micros",
          "old_text": null,
          "new_text": "t.micros()",
          "old_line_content": "                            //mrtl->checkSize();",
          "new_line_content": "                            inReduce += t.micros();",
          "content_same": false
        },
        {
          "line": 342,
          "old_api": null,
          "new_api": "hit",
          "old_text": null,
          "new_text": "pm.hit()",
          "old_line_content": "                    }",
          "new_line_content": "                        pm.hit();",
          "content_same": false
        },
        {
          "line": 348,
          "old_api": null,
          "new_api": "append",
          "old_text": null,
          "new_text": "countsBuilder.append( \"emit\" , numEmits )",
          "old_line_content": "                    ",
          "new_line_content": "                    countsBuilder.append( \"emit\" , numEmits );",
          "content_same": false
        },
        {
          "line": 351,
          "old_api": null,
          "new_api": "millis",
          "old_text": null,
          "new_text": "t.millis()",
          "old_line_content": "                    ",
          "new_line_content": "                    timingBuilder.append( \"emitLoop\" , t.millis() );",
          "content_same": false
        },
        {
          "line": 356,
          "old_api": null,
          "new_api": "dump",
          "old_text": null,
          "new_text": "mrtl->dump()",
          "old_line_content": "                                     ",
          "new_line_content": "                    mrtl->dump();",
          "content_same": false
        },
        {
          "line": 362,
          "old_api": null,
          "new_api": "append",
          "old_text": null,
          "new_text": "timingBuilder.append( \"reduce\" , inReduce / 1000 )",
          "old_line_content": "                    }",
          "new_line_content": "                        timingBuilder.append( \"reduce\" , inReduce / 1000 );",
          "content_same": false
        },
        {
          "line": 366,
          "old_api": null,
          "new_api": "getNumber",
          "old_text": null,
          "new_text": "s->getNumber( \"$numReducesToDB\" )",
          "old_line_content": "                    }",
          "new_line_content": "                        countsBuilder.append( \"reducesToDB\" , s->getNumber( \"$numReducesToDB\" ) );",
          "content_same": false
        },
        {
          "line": 371,
          "old_api": null,
          "new_api": "finalize",
          "old_text": null,
          "new_text": "s->execSetup( \"MR.finalize()\" )",
          "old_line_content": "                    }",
          "new_line_content": "                        s->execSetup( \"MR.finalize()\" );",
          "content_same": false
        },
        {
          "line": 375,
          "old_api": null,
          "new_api": "reset",
          "old_text": null,
          "new_text": "_tlmr.reset( 0 )",
          "old_line_content": "                    /*",
          "new_line_content": "                    _tlmr.reset( 0 );",
          "content_same": false
        },
        {
          "line": 402,
          "old_api": null,
          "new_api": "dropCollection",
          "old_text": null,
          "new_text": "db.dropCollection( resultColl )",
          "old_line_content": "                    throw;",
          "new_line_content": "                    db.dropCollection( resultColl );",
          "content_same": false
        },
        {
          "line": 409,
          "old_api": null,
          "new_api": "dropCollection",
          "old_text": null,
          "new_text": "db.dropCollection( finalOutput )",
          "old_line_content": "                    BSONObj info;",
          "new_line_content": "                    db.dropCollection( finalOutput );",
          "content_same": false
        },
        {
          "line": 411,
          "old_api": null,
          "new_api": "BSON",
          "old_text": null,
          "new_text": "BSON( \"renameCollection\" << resultColl << \"to\" << finalOutput )",
          "old_line_content": "                }",
          "new_line_content": "                    uassert( \"rename failed\" , db.runCommand( \"admin\" , BSON( \"renameCollection\" << resultColl << \"to\" << finalOutput ) , info ) );",
          "content_same": false
        },
        {
          "line": 414,
          "old_api": null,
          "new_api": "count",
          "old_text": null,
          "new_text": "db.count( finalOutput )",
          "old_line_content": "                    errmsg = \"there were emits but no data!\";",
          "new_line_content": "                if ( db.count( finalOutput ) == 0 && numEmits > 0 ){",
          "content_same": false
        },
        {
          "line": 419,
          "old_api": null,
          "new_api": "millis",
          "old_text": null,
          "new_text": "t.millis()",
          "old_line_content": "                ",
          "new_line_content": "                timingBuilder.append( \"total\" , t.millis() );",
          "content_same": false
        },
        {
          "line": 425,
          "old_api": null,
          "new_api": "obj",
          "old_text": null,
          "new_text": "countsBuilder.obj()",
          "old_line_content": "                ",
          "new_line_content": "                result.append( \"counts\" , countsBuilder.obj() );",
          "content_same": false
        },
        {
          "line": 444,
          "old_api": null,
          "new_api": "valuestrsafe",
          "old_text": null,
          "new_text": "cmdObj[\"shardedOutputCollection\"].valuestrsafe()",
          "old_line_content": "",
          "new_line_content": "                string shardedOutputCollection = cmdObj[\"shardedOutputCollection\"].valuestrsafe();",
          "content_same": false
        },
        {
          "line": 446,
          "old_api": null,
          "new_api": "firstElement",
          "old_text": null,
          "new_text": "cmdObj.firstElement().embeddedObjectUserCheck()",
          "old_line_content": "                ",
          "new_line_content": "                BSONObj origCmd = cmdObj.firstElement().embeddedObjectUserCheck();",
          "content_same": false
        },
        {
          "line": 453,
          "old_api": null,
          "new_api": "embeddedObjectUserCheck",
          "old_text": null,
          "new_text": "cmdObj[\"shards\"].embeddedObjectUserCheck()",
          "old_line_content": "                vector< auto_ptr<DBClientCursor> > shardCursors;",
          "new_line_content": "                BSONObj shards = cmdObj[\"shards\"].embeddedObjectUserCheck();",
          "content_same": false
        },
        {
          "line": 458,
          "old_api": null,
          "new_api": "fieldName",
          "old_text": null,
          "new_text": "e.fieldName()",
          "old_line_content": "",
          "new_line_content": "                    string shard = e.fieldName();",
          "content_same": false
        },
        {
          "line": 460,
          "old_api": null,
          "new_api": "embeddedObjectUserCheck",
          "old_text": null,
          "new_text": "e.embeddedObjectUserCheck()",
          "old_line_content": "                    ",
          "new_line_content": "                    BSONObj res = e.embeddedObjectUserCheck();",
          "content_same": false
        },
        {
          "line": 464,
          "old_api": null,
          "new_api": "c_str",
          "old_text": null,
          "new_text": "shard.c_str()",
          "old_line_content": "",
          "new_line_content": "                    shardCounts.appendAs( res[\"counts\"] , shard.c_str() );",
          "content_same": false
        },
        {
          "line": 469,
          "old_api": null,
          "new_api": "numberLong",
          "old_text": null,
          "new_text": "temp.numberLong()",
          "old_line_content": "                    }",
          "new_line_content": "                        counts[temp.fieldName()] += temp.numberLong();",
          "content_same": false
        },
        {
          "line": 474,
          "old_api": null,
          "new_api": "BSON",
          "old_text": null,
          "new_text": "BSON( \"_id\" << 1 )",
          "old_line_content": "",
          "new_line_content": "                BSONObj sortKey = BSON( \"_id\" << 1 );",
          "content_same": false
        },
        {
          "line": 477,
          "old_api": null,
          "new_api": "sort",
          "old_text": null,
          "new_text": "Query().sort( sortKey )",
          "old_line_content": "                ",
          "new_line_content": "                                                    Query().sort( sortKey ) );",
          "content_same": false
        },
        {
          "line": 481,
          "old_api": null,
          "new_api": "ascode",
          "old_text": null,
          "new_text": "origCmd[\"reduce\"].ascode().c_str()",
          "old_line_content": "",
          "new_line_content": "                ScriptingFunction reduceFunction = s->createFunction( origCmd[\"reduce\"].ascode().c_str() );",
          "content_same": false
        },
        {
          "line": 487,
          "old_api": null,
          "new_api": "tempCollectionName",
          "old_text": null,
          "new_text": "tempCollectionName( origCmd )",
          "old_line_content": "                string fulloutput = dbname + \".\" + output;",
          "new_line_content": "                    output = tempCollectionName( origCmd );",
          "content_same": false
        },
        {
          "line": 489,
          "old_api": null,
          "new_api": "append",
          "old_text": null,
          "new_text": "result.append( \"result\" , output )",
          "old_line_content": "",
          "new_line_content": "                result.append( \"result\" , output );",
          "content_same": false
        },
        {
          "line": 494,
          "old_api": null,
          "new_api": "next",
          "old_text": null,
          "new_text": "cursor.next()",
          "old_line_content": "                                        ",
          "new_line_content": "                    BSONObj t = cursor.next();",
          "content_same": false
        },
        {
          "line": 497,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "values.push_back( t )",
          "old_line_content": "                        continue;",
          "new_line_content": "                        values.push_back( t );",
          "content_same": false
        },
        {
          "line": 502,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "values.push_back( t )",
          "old_line_content": "                        continue;",
          "new_line_content": "                        values.push_back( t );",
          "content_same": false
        },
        {
          "line": 508,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "values.push_back( t )",
          "old_line_content": "                }",
          "new_line_content": "                    values.push_back( t );",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 513,
          "old_api": "end",
          "new_api": null,
          "old_text": "servers.end()",
          "new_text": null,
          "old_line_content": "                for ( set<ServerAndQuery>::iterator i=servers.begin(); i!=servers.end(); i++ ){",
          "new_line_content": "                ",
          "content_same": false
        },
        {
          "line": 515,
          "old_api": "dropCollection",
          "new_api": null,
          "old_text": "conn->dropCollection( dbname + \".\" + shardedOutputCollection )",
          "new_text": null,
          "old_line_content": "                    conn->dropCollection( dbname + \".\" + shardedOutputCollection );",
          "new_line_content": "                    ScopedDbConnection conn( i->_server );",
          "content_same": false
        },
        {
          "line": 518,
          "old_api": "obj",
          "new_api": null,
          "old_text": "shardCounts.obj()",
          "new_text": null,
          "old_line_content": "                result.append( \"shardCounts\" , shardCounts.obj() );",
          "new_line_content": "                ",
          "content_same": false
        },
        {
          "line": 522,
          "old_api": "end",
          "new_api": null,
          "old_text": "counts.end()",
          "new_text": null,
          "old_line_content": "                    for ( map<string,long long>::iterator i=counts.begin(); i!=counts.end(); i++ ){",
          "new_line_content": "                    BSONObjBuilder c;",
          "content_same": false
        },
        {
          "line": 525,
          "old_api": "obj",
          "new_api": null,
          "old_text": "c.obj()",
          "new_text": null,
          "old_line_content": "                    result.append( \"counts\" , c.obj() );",
          "new_line_content": "                    }",
          "content_same": false
        },
        {
          "line": 54,
          "old_api": "end",
          "new_api": null,
          "old_text": "values.end()",
          "new_text": null,
          "old_line_content": "            for ( list<BSONObj>::iterator i=values.begin(); i!=values.end(); i++){",
          "new_line_content": "            int n = 0;",
          "content_same": false
        },
        {
          "line": 57,
          "old_api": "append",
          "new_api": null,
          "old_text": "reduceArgs.append( o[\"_id\"] )",
          "new_text": null,
          "old_line_content": "                    reduceArgs.append( o[\"_id\"] );",
          "new_line_content": "                if ( n == 0 ){",
          "content_same": false
        },
        {
          "line": 59,
          "old_api": "append",
          "new_api": null,
          "old_text": "temp.append( o[\"_id\"] )",
          "new_text": null,
          "old_line_content": "                    temp.append( o[\"_id\"] );",
          "new_line_content": "                    BSONObjBuilder temp;",
          "content_same": false
        },
        {
          "line": 62,
          "old_api": "c_str",
          "new_api": null,
          "old_text": "BSONObjBuilder::numStr( n++ ).c_str()",
          "new_text": null,
          "old_line_content": "                valueBuilder.appendAs( o[\"value\"] , BSONObjBuilder::numStr( n++ ).c_str() );",
          "new_line_content": "                }",
          "content_same": false
        },
        {
          "line": 65,
          "old_api": "obj",
          "new_api": null,
          "old_text": "valueBuilder.obj()",
          "new_text": null,
          "old_line_content": "            reduceArgs.appendArray( \"values\" , valueBuilder.obj() );",
          "new_line_content": "        ",
          "content_same": false
        },
        {
          "line": 68,
          "old_api": "invokeSafe",
          "new_api": null,
          "old_text": "s->invokeSafe( reduce , args )",
          "new_text": null,
          "old_line_content": "            s->invokeSafe( reduce , args );",
          "new_line_content": "            ",
          "content_same": false
        },
        {
          "line": 74,
          "old_api": "append",
          "new_api": null,
          "old_text": "b.append( key[\"_id\"] )",
          "new_text": null,
          "old_line_content": "            b.append( key[\"_id\"] );",
          "new_line_content": "            BSONObjBuilder b;",
          "content_same": false
        },
        {
          "line": 98,
          "old_api": "end",
          "new_api": null,
          "old_text": "old->end()",
          "new_text": null,
          "old_line_content": "                for ( InMemory::iterator i=old->begin(); i!=old->end(); i++ ){",
          "new_line_content": "                ",
          "content_same": false
        },
        {
          "line": 102,
          "old_api": "size",
          "new_api": null,
          "old_text": "all.size()",
          "new_text": null,
          "old_line_content": "                    if ( all.size() == 1 ){",
          "new_line_content": "                    ",
          "content_same": false
        },
        {
          "line": 105,
          "old_api": "size",
          "new_api": null,
          "old_text": "all.size()",
          "new_text": null,
          "old_line_content": "                    else if ( all.size() > 1 ){",
          "new_line_content": "                    }",
          "content_same": false
        },
        {
          "line": 115,
          "old_api": "end",
          "new_api": null,
          "old_text": "_temp->end()",
          "new_text": null,
          "old_line_content": "                for ( InMemory::iterator i=_temp->begin(); i!=_temp->end(); i++ ){",
          "new_line_content": "            void dump(){",
          "content_same": false
        },
        {
          "line": 118,
          "old_api": "size",
          "new_api": null,
          "old_text": "all.size()",
          "new_text": null,
          "old_line_content": "                    if ( all.size() < 1 )",
          "new_line_content": "                    list<BSONObj>& all = i->second;",
          "content_same": false
        },
        {
          "line": 120,
          "old_api": "size",
          "new_api": null,
          "old_text": "all.size()",
          "new_text": null,
          "old_line_content": "                    assert( all.size() == 1 );",
          "new_line_content": "                        continue;",
          "content_same": false
        },
        {
          "line": 122,
          "old_api": "begin",
          "new_api": null,
          "old_text": "all.begin()",
          "new_text": null,
          "old_line_content": "                    BSONObj value = *(all.begin());",
          "new_line_content": "                    ",
          "content_same": false
        },
        {
          "line": 125,
          "old_api": "appendElements",
          "new_api": null,
          "old_text": "b.appendElements( value )",
          "new_text": null,
          "old_line_content": "                    b.appendElements( value );",
          "new_line_content": "                    BSONObjBuilder b;",
          "content_same": false
        },
        {
          "line": 127,
          "old_api": "obj",
          "new_api": null,
          "old_text": "b.obj()",
          "new_text": null,
          "old_line_content": "                    BSONObj o = b.obj();",
          "new_line_content": "                ",
          "content_same": false
        },
        {
          "line": 130,
          "old_api": "clear",
          "new_api": null,
          "old_text": "_temp->clear()",
          "new_text": null,
          "old_line_content": "                _temp->clear();",
          "new_line_content": "                }",
          "content_same": false
        },
        {
          "line": 136,
          "old_api": "push_back",
          "new_api": null,
          "old_text": "all.push_back( value )",
          "new_text": null,
          "old_line_content": "                all.push_back( value );",
          "new_line_content": "                list<BSONObj>& all = (*_temp)[key];",
          "content_same": false
        },
        {
          "line": 145,
          "old_api": "reduceInMemory",
          "new_api": null,
          "old_text": "reduceInMemory()",
          "new_text": null,
          "old_line_content": "                reduceInMemory();",
          "new_line_content": "                long before = _size;",
          "content_same": false
        },
        {
          "line": 151,
          "old_api": "dump",
          "new_api": null,
          "old_text": "dump()",
          "new_text": null,
          "old_line_content": "                dump();",
          "new_line_content": "                ",
          "content_same": false
        },
        {
          "line": 156,
          "old_api": "find",
          "new_api": null,
          "old_text": "_nums.find( key )",
          "new_text": null,
          "old_line_content": "                KeyNums::iterator i = _nums.find( key );",
          "new_line_content": "            int getNum( const BSONObj& key ){",
          "content_same": false
        },
        {
          "line": 159,
          "old_api": "size",
          "new_api": null,
          "old_text": "_nums.size()",
          "new_text": null,
          "old_line_content": "                int n = _nums.size() + 1;",
          "new_line_content": "                    return i->second;",
          "content_same": false
        },
        {
          "line": 165,
          "old_api": "clear",
          "new_api": null,
          "old_text": "_nums.clear()",
          "new_text": null,
          "old_line_content": "                _nums.clear();",
          "new_line_content": "            void resetNum(){",
          "content_same": false
        },
        {
          "line": 189,
          "old_api": "more",
          "new_api": null,
          "old_text": "i.more()",
          "new_text": null,
          "old_line_content": "                assert( i.more() );",
          "new_line_content": "            {",
          "content_same": false
        },
        {
          "line": 191,
          "old_api": "next",
          "new_api": null,
          "old_text": "i.next()",
          "new_text": null,
          "old_line_content": "                b.appendAs( i.next() , \"_id\" );",
          "new_line_content": "                BSONObjBuilder b;",
          "content_same": false
        },
        {
          "line": 196,
          "old_api": "more",
          "new_api": null,
          "old_text": "i.more()",
          "new_text": null,
          "old_line_content": "                assert( i.more() );",
          "new_line_content": "            {",
          "content_same": false
        },
        {
          "line": 198,
          "old_api": "firstElement",
          "new_api": null,
          "old_text": "key.firstElement()",
          "new_text": null,
          "old_line_content": "                b.append( key.firstElement() );",
          "new_line_content": "                BSONObjBuilder b;",
          "content_same": false
        },
        {
          "line": 202,
          "old_api": "more",
          "new_api": null,
          "old_text": "i.more()",
          "new_text": null,
          "old_line_content": "            assert( ! i.more() );",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 208,
          "old_api": "getNum",
          "new_api": null,
          "old_text": "_tlmr->getNum( args )",
          "new_text": null,
          "old_line_content": "            return BSON( \"\" << _tlmr->getNum( args ) );",
          "new_line_content": "        BSONObj get_num( const BSONObj& args ){",
          "content_same": false
        },
        {
          "line": 212,
          "old_api": "resetNum",
          "new_api": null,
          "old_text": "_tlmr->resetNum()",
          "new_text": null,
          "old_line_content": "            _tlmr->resetNum();",
          "new_line_content": "        BSONObj reset_num( const BSONObj& args ){",
          "content_same": false
        },
        {
          "line": 219,
          "old_api": "database",
          "new_api": null,
          "old_text": "cc().database()",
          "new_text": null,
          "old_line_content": "            ss << cc().database()->name << \".\";",
          "new_line_content": "            stringstream ss;",
          "content_same": false
        },
        {
          "line": 222,
          "old_api": "time",
          "new_api": null,
          "old_text": "time(0)",
          "new_text": null,
          "old_line_content": "            ss << \"mr.\" << cmd.firstElement().fieldName() << \"_\" << time(0) << \"_\" << inc++;",
          "new_line_content": "                ss << \"tmp.\";",
          "content_same": false
        },
        {
          "line": 236,
          "old_api": "size",
          "new_api": null,
          "old_text": "values.size()",
          "new_text": null,
          "old_line_content": "                if ( values.size() == 0 )",
          "new_line_content": "            void doReduce( const string& resultColl , list<BSONObj>& values , Scope * s , ScriptingFunction reduce ){",
          "content_same": false
        },
        {
          "line": 239,
          "old_api": "reduceValues",
          "new_api": null,
          "old_text": "reduceValues( values , s , reduce )",
          "new_text": null,
          "old_line_content": "                BSONObj res = reduceValues( values , s , reduce );",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 244,
          "old_api": "size",
          "new_api": null,
          "old_text": "values.size()",
          "new_text": null,
          "old_line_content": "                if ( values.size() == 0 )",
          "new_line_content": "            void finalReduce( const string& resultColl , list<BSONObj>& values , Scope * s , ScriptingFunction reduce ){",
          "content_same": false
        },
        {
          "line": 247,
          "old_api": "BSON",
          "new_api": null,
          "old_text": "BSON( \"_id\" << 1 )",
          "new_text": null,
          "old_line_content": "                BSONObj key = values.begin()->extractFields( BSON( \"_id\" << 1 ) );",
          "new_line_content": "                ",
          "content_same": false
        },
        {
          "line": 249,
          "old_api": "size",
          "new_api": null,
          "old_text": "values.size()",
          "new_text": null,
          "old_line_content": "                if ( values.size() == 1 ){",
          "new_line_content": "                ",
          "content_same": false
        },
        {
          "line": 254,
          "old_api": "remove",
          "new_api": null,
          "old_text": "db.remove( resultColl , key )",
          "new_text": null,
          "old_line_content": "                db.remove( resultColl , key );",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 261,
          "old_api": "trueValue",
          "new_api": null,
          "old_text": "cmdObj[\"verbose\"].trueValue()",
          "new_text": null,
          "old_line_content": "                bool verboseOutput = cmdObj[\"verbose\"].trueValue();",
          "new_line_content": "                Client::GodScope cg;",
          "content_same": false
        },
        {
          "line": 263,
          "old_api": "firstElement",
          "new_api": null,
          "old_text": "cmdObj.firstElement().valuestr()",
          "new_text": null,
          "old_line_content": "                string ns = cc().database()->name + '.' + cmdObj.firstElement().valuestr();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 266,
          "old_api": "exists",
          "new_api": null,
          "old_text": "db.exists( ns )",
          "new_text": null,
          "old_line_content": "                if ( ! db.exists( ns ) ){",
          "new_line_content": "                ",
          "content_same": false
        },
        {
          "line": 272,
          "old_api": "getPooledScope",
          "new_api": null,
          "old_text": "globalScriptEngine->getPooledScope( ns )",
          "new_text": null,
          "old_line_content": "                auto_ptr<Scope> s = globalScriptEngine->getPooledScope( ns );",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 275,
          "old_api": "trueValue",
          "new_api": null,
          "old_text": "cmdObj[\"keeptemp\"].trueValue()",
          "new_text": null,
          "old_line_content": "                bool istemp = ! cmdObj[\"keeptemp\"].trueValue();",
          "new_line_content": "                ",
          "content_same": false
        },
        {
          "line": 278,
          "old_api": "addTempCollection",
          "new_api": null,
          "old_text": "currentClient->addTempCollection( resultColl )",
          "new_text": null,
          "old_line_content": "                    currentClient->addTempCollection( resultColl );",
          "new_line_content": "                if ( istemp )",
          "content_same": false
        },
        {
          "line": 280,
          "old_api": "type",
          "new_api": null,
          "old_text": "cmdObj[\"out\"].type()",
          "new_text": null,
          "old_line_content": "                if ( cmdObj[\"out\"].type() == String )",
          "new_line_content": "                string finalOutput = resultColl;",
          "content_same": false
        },
        {
          "line": 283,
          "old_api": "database",
          "new_api": null,
          "old_text": "cc().database()->name.size()",
          "new_text": null,
          "old_line_content": "                string resultCollShort = resultColl.substr( cc().database()->name.size() + 1 );",
          "new_line_content": "                ",
          "content_same": false
        },
        {
          "line": 296,
          "old_api": "getMongo",
          "new_api": null,
          "old_text": "s->execSetup( (string)\"tempcoll = db[\\\"\" + resultCollShort + \"\\\"]; db.getMongo().setSlaveOk();\" , \"tempcoll1\" )",
          "new_text": null,
          "old_line_content": "                    s->execSetup( (string)\"tempcoll = db[\\\"\" + resultCollShort + \"\\\"]; db.getMongo().setSlaveOk();\" , \"tempcoll1\" );",
          "new_line_content": "                    ",
          "content_same": false
        },
        {
          "line": 299,
          "old_api": "injectNative",
          "new_api": null,
          "old_text": "s->injectNative( \"get_num\" , get_num )",
          "new_text": null,
          "old_line_content": "                    s->injectNative( \"get_num\" , get_num );",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 302,
          "old_api": "ascode",
          "new_api": null,
          "old_text": "cmdObj[\"map\"].ascode().c_str()",
          "new_text": null,
          "old_line_content": "                    ScriptingFunction mapFunction = s->createFunction( cmdObj[\"map\"].ascode().c_str() );",
          "new_line_content": "                    ",
          "content_same": false
        },
        {
          "line": 306,
          "old_api": "get",
          "new_api": null,
          "old_text": "s.get()",
          "new_text": null,
          "old_line_content": "                    MRTL * mrtl = new MRTL( &db , resultColl , s.get() , reduceFunction );",
          "new_line_content": "                    ",
          "content_same": false
        },
        {
          "line": 311,
          "old_api": "type",
          "new_api": null,
          "old_text": "cmdObj[\"query\"].type()",
          "new_text": null,
          "old_line_content": "                    if ( cmdObj[\"query\"].type() == Object ){",
          "new_line_content": "                    BSONObj filter;",
          "content_same": false
        },
        {
          "line": 316,
          "old_api": "type",
          "new_api": null,
          "old_text": "cmdObj[\"sort\"].type()",
          "new_text": null,
          "old_line_content": "                    if ( cmdObj[\"sort\"].type() == Object )",
          "new_line_content": "                    ",
          "content_same": false
        },
        {
          "line": 319,
          "old_api": "count",
          "new_api": null,
          "old_text": "db.count( ns , filter )",
          "new_text": null,
          "old_line_content": "                    ProgressMeter pm( db.count( ns , filter ) );",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 323,
          "old_api": "more",
          "new_api": null,
          "old_text": "cursor->more()",
          "new_text": null,
          "old_line_content": "                    while ( cursor->more() ){",
          "new_line_content": "                    Timer mt;",
          "content_same": false
        },
        {
          "line": 326,
          "old_api": "reset",
          "new_api": null,
          "old_text": "mt.reset()",
          "new_text": null,
          "old_line_content": "                        if ( verboseOutput ) mt.reset();",
          "new_line_content": "                    ",
          "content_same": false
        },
        {
          "line": 328,
          "old_api": "setThis",
          "new_api": null,
          "old_text": "s->setThis( &o )",
          "new_text": null,
          "old_line_content": "                        s->setThis( &o );",
          "new_line_content": "                        ",
          "content_same": false
        },
        {
          "line": 332,
          "old_api": "micros",
          "new_api": null,
          "old_text": "mt.micros()",
          "new_text": null,
          "old_line_content": "                        if ( verboseOutput ) mapTime += mt.micros();",
          "new_line_content": "                        ",
          "content_same": false
        },
        {
          "line": 337,
          "old_api": "check",
          "new_api": null,
          "old_text": "s->exec( \"MR.check();\" , \"reduce-i\" , false , true , true )",
          "new_text": null,
          "old_line_content": "                            s->exec( \"MR.check();\" , \"reduce-i\" , false , true , true );",
          "new_line_content": "                            Timer t;",
          "content_same": false
        },
        {
          "line": 341,
          "old_api": "hit",
          "new_api": null,
          "old_text": "pm.hit()",
          "new_text": null,
          "old_line_content": "                        pm.hit();",
          "new_line_content": "                        }",
          "content_same": false
        },
        {
          "line": 345,
          "old_api": "append",
          "new_api": null,
          "old_text": "countsBuilder.append( \"input\" , num )",
          "new_text": null,
          "old_line_content": "                    countsBuilder.append( \"input\" , num );",
          "new_line_content": "                    ",
          "content_same": false
        },
        {
          "line": 349,
          "old_api": "append",
          "new_api": null,
          "old_text": "timingBuilder.append( \"mapTime\" , mapTime / 1000 )",
          "new_text": null,
          "old_line_content": "                    timingBuilder.append( \"mapTime\" , mapTime / 1000 );",
          "new_line_content": "                    ",
          "content_same": false
        },
        {
          "line": 354,
          "old_api": "reduceInMemory",
          "new_api": null,
          "old_text": "mrtl->reduceInMemory()",
          "new_text": null,
          "old_line_content": "                    mrtl->reduceInMemory();",
          "new_line_content": "                    ",
          "content_same": false
        },
        {
          "line": 359,
          "old_api": "doReduce",
          "new_api": null,
          "old_text": "s->exec( \"MR.doReduce(true)\" , \"reduce\" , false , true , true )",
          "new_text": null,
          "old_line_content": "                        s->exec( \"MR.doReduce(true)\" , \"reduce\" , false , true , true );",
          "new_line_content": "                        Timer t;",
          "content_same": false
        },
        {
          "line": 364,
          "old_api": "getNumber",
          "new_api": null,
          "old_text": "s->getNumber( \"$numReduces\" )",
          "new_text": null,
          "old_line_content": "                        countsBuilder.append( \"reduces\" , s->getNumber( \"$numReduces\" ) );",
          "new_line_content": "                    if ( verboseOutput ){",
          "content_same": false
        },
        {
          "line": 368,
          "old_api": "type",
          "new_api": null,
          "old_text": "cmdObj[\"finalize\"].type()",
          "new_text": null,
          "old_line_content": "                    if ( cmdObj[\"finalize\"].type() ){",
          "new_line_content": "                    ",
          "content_same": false
        },
        {
          "line": 373,
          "old_api": "cleanup",
          "new_api": null,
          "old_text": "s->execSetup( \"MR.cleanup()\" )",
          "new_text": null,
          "old_line_content": "                    s->execSetup( \"MR.cleanup()\" );",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 400,
          "old_api": "log",
          "new_api": null,
          "old_text": "log()",
          "new_text": null,
          "old_line_content": "                    log() << \"mr failed, removing collection\" << endl;",
          "new_line_content": "                catch ( ... ){",
          "content_same": false
        },
        {
          "line": 408,
          "old_api": "dropCollection",
          "new_api": null,
          "old_text": "db.dropCollection( finalOutput )",
          "new_text": null,
          "old_line_content": "                    db.dropCollection( finalOutput );",
          "new_line_content": "                    // need to do this with the full dblock, that's why its after the try/catch",
          "content_same": false
        },
        {
          "line": 410,
          "old_api": "BSON",
          "new_api": null,
          "old_text": "BSON( \"renameCollection\" << resultColl << \"to\" << finalOutput )",
          "new_text": null,
          "old_line_content": "                    uassert( \"rename failed\" , db.runCommand( \"admin\" , BSON( \"renameCollection\" << resultColl << \"to\" << finalOutput ) , info ) );",
          "new_line_content": "                    BSONObj info;",
          "content_same": false
        },
        {
          "line": 413,
          "old_api": "count",
          "new_api": null,
          "old_text": "db.count( finalOutput )",
          "new_text": null,
          "old_line_content": "                if ( db.count( finalOutput ) == 0 && numEmits > 0 ){",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 418,
          "old_api": "millis",
          "new_api": null,
          "old_text": "t.millis()",
          "new_text": null,
          "old_line_content": "                timingBuilder.append( \"total\" , t.millis() );",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 420,
          "old_api": "append",
          "new_api": null,
          "old_text": "result.append( \"result\" , finalOutputShort )",
          "new_text": null,
          "old_line_content": "                result.append( \"result\" , finalOutputShort );",
          "new_line_content": "                ",
          "content_same": false
        },
        {
          "line": 442,
          "old_api": "database",
          "new_api": null,
          "old_text": "cc().database()",
          "new_text": null,
          "old_line_content": "                string dbname = cc().database()->name;",
          "new_line_content": "                                    ",
          "content_same": false
        },
        {
          "line": 445,
          "old_api": "firstElement",
          "new_api": null,
          "old_text": "cmdObj.firstElement().embeddedObjectUserCheck()",
          "new_text": null,
          "old_line_content": "                BSONObj origCmd = cmdObj.firstElement().embeddedObjectUserCheck();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 452,
          "old_api": "embeddedObjectUserCheck",
          "new_api": null,
          "old_text": "cmdObj[\"shards\"].embeddedObjectUserCheck()",
          "new_text": null,
          "old_line_content": "                BSONObj shards = cmdObj[\"shards\"].embeddedObjectUserCheck();",
          "new_line_content": "                ",
          "content_same": false
        },
        {
          "line": 455,
          "old_api": "more",
          "new_api": null,
          "old_text": "i.more()",
          "new_text": null,
          "old_line_content": "                while ( i.more() ){",
          "new_line_content": "                BSONObjIterator i( shards );",
          "content_same": false
        },
        {
          "line": 459,
          "old_api": "embeddedObjectUserCheck",
          "new_api": null,
          "old_text": "e.embeddedObjectUserCheck()",
          "new_text": null,
          "old_line_content": "                    BSONObj res = e.embeddedObjectUserCheck();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 461,
          "old_api": "valuestrsafe",
          "new_api": null,
          "old_text": "res[\"result\"].valuestrsafe()",
          "new_text": null,
          "old_line_content": "                    uassert( \"something bad happened\" , shardedOutputCollection == res[\"result\"].valuestrsafe() );",
          "new_line_content": "                    ",
          "content_same": false
        },
        {
          "line": 465,
          "old_api": "embeddedObjectUserCheck",
          "new_api": null,
          "old_text": "res[\"counts\"].embeddedObjectUserCheck()",
          "new_text": null,
          "old_line_content": "                    BSONObjIterator j( res[\"counts\"].embeddedObjectUserCheck() );",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 473,
          "old_api": "BSON",
          "new_api": null,
          "old_text": "BSON( \"_id\" << 1 )",
          "new_text": null,
          "old_line_content": "                BSONObj sortKey = BSON( \"_id\" << 1 );",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 476,
          "old_api": "sort",
          "new_api": null,
          "old_text": "Query().sort( sortKey )",
          "new_text": null,
          "old_line_content": "                                                    Query().sort( sortKey ) );",
          "new_line_content": "                ParallelSortClusteredCursor cursor( servers , dbname + \".\" + shardedOutputCollection ,",
          "content_same": false
        },
        {
          "line": 479,
          "old_api": "getPooledScope",
          "new_api": null,
          "old_text": "globalScriptEngine->getPooledScope( ns )",
          "new_text": null,
          "old_line_content": "                auto_ptr<Scope> s = globalScriptEngine->getPooledScope( ns );",
          "new_line_content": "                ",
          "content_same": false
        },
        {
          "line": 484,
          "old_api": "valuestrsafe",
          "new_api": null,
          "old_text": "origCmd[\"out\"].valuestrsafe()",
          "new_text": null,
          "old_line_content": "                string output = origCmd[\"out\"].valuestrsafe();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 488,
          "old_api": "append",
          "new_api": null,
          "old_text": "result.append( \"result\" , output )",
          "new_text": null,
          "old_line_content": "                result.append( \"result\" , output );",
          "new_line_content": "                string fulloutput = dbname + \".\" + output;",
          "content_same": false
        },
        {
          "line": 492,
          "old_api": "more",
          "new_api": null,
          "old_text": "cursor.more()",
          "new_text": null,
          "old_line_content": "                while ( cursor.more() ){",
          "new_line_content": "                ",
          "content_same": false
        },
        {
          "line": 495,
          "old_api": "size",
          "new_api": null,
          "old_text": "values.size()",
          "new_text": null,
          "old_line_content": "                    if ( values.size() == 0 ){",
          "new_line_content": "                                        ",
          "content_same": false
        },
        {
          "line": 500,
          "old_api": "begin",
          "new_api": null,
          "old_text": "values.begin()",
          "new_text": null,
          "old_line_content": "                    if ( t.woSortOrder( *(values.begin()) , sortKey ) == 0 ){",
          "new_line_content": "                    ",
          "content_same": false
        },
        {
          "line": 505,
          "old_api": "get",
          "new_api": null,
          "old_text": "s.get()",
          "new_text": null,
          "old_line_content": "                    db.insert( fulloutput , reduceValues( values , s.get() , reduceFunction ) );",
          "new_line_content": "                    ",
          "content_same": false
        },
        {
          "line": 510,
          "old_api": "size",
          "new_api": null,
          "old_text": "values.size()",
          "new_text": null,
          "old_line_content": "                if ( values.size() )",
          "new_line_content": "                ",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 70,
      "total_additions": 95,
      "total_deletions": 94,
      "total_api_changes": 259
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 6,
        "api_related_lines": 259,
        "non_api_lines": 5,
        "non_api_line_numbers": [
          47,
          50,
          51,
          52,
          53
        ]
      }
    },
    "api_calls_before": 249,
    "api_calls_after": 253,
    "diff_info": {
      "added_lines": 4,
      "removed_lines": 3,
      "total_diff_lines": 22
    }
  }
}