{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mongo/modified_file/e20f638e8c888634722cbaa7fa5dcc3bf372edfb",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mongo/modified_file/e20f638e8c888634722cbaa7fa5dcc3bf372edfb/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mongo/modified_file/e20f638e8c888634722cbaa7fa5dcc3bf372edfb/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mongo/modified_file/e20f638e8c888634722cbaa7fa5dcc3bf372edfb/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 76,
          "old_api": "sethbmsg",
          "new_api": "haveCursor",
          "old_text": "sethbmsg(\"replSet initial sync error reading remote oplog\")",
          "new_text": "r.haveCursor()",
          "old_line_content": "                    sethbmsg(\"replSet initial sync error reading remote oplog\");",
          "new_line_content": "            assert( r.haveCursor() );",
          "content_same": false
        },
        {
          "line": 82,
          "old_api": "putBack",
          "new_api": "more",
          "old_text": "r.putBack(op)",
          "new_text": "r.more()",
          "old_line_content": "                r.putBack(op);",
          "new_line_content": "                if( !r.more() ) { ",
          "content_same": false
        },
        {
          "line": 84,
          "old_api": "string",
          "new_api": "log",
          "old_text": "string(\"$err\")",
          "new_text": "log()",
          "old_line_content": "                if( op.firstElement().fieldName() == string(\"$err\") ) { ",
          "new_line_content": "                    log() << \"replSet initial sync error remote oplog (\" << rsoplog << \") on host \" << hn << \" is empty?\" << rsLog;",
          "content_same": false
        },
        {
          "line": 89,
          "old_api": "isNull",
          "new_api": "putBack",
          "old_text": "t.isNull()",
          "new_text": "r.putBack(op)",
          "old_line_content": "                uassert( 13508 , str::stream() << \"no 'ts' in first op in oplog: \" << op , !t.isNull() );",
          "new_line_content": "                r.putBack(op);",
          "content_same": false
        },
        {
          "line": 91,
          "old_api": "str::stream()",
          "new_api": "string",
          "old_text": "str::stream()",
          "new_text": "string(\"$err\")",
          "old_line_content": "                    sethbmsg(str::stream() << \"error \" << hn << \" oplog wrapped during initial sync\");",
          "new_line_content": "                if( op.firstElement().fieldName() == string(\"$err\") ) { ",
          "content_same": false
        },
        {
          "line": 92,
          "old_api": "log",
          "new_api": "toString",
          "old_text": "log()",
          "new_text": "op.toString()",
          "old_line_content": "                    log() << \"replSet initial sync expected first optime of \" << applyGTE << rsLog;",
          "new_line_content": "                    log() << \"replSet initial sync error querying \" << rsoplog << \" on \" << hn << \" : \" << op.toString() << rsLog;",
          "content_same": false
        },
        {
          "line": 111,
          "old_api": "getPrimary",
          "new_api": "nextSafe",
          "old_text": "box.getPrimary()",
          "new_text": "r.nextSafe()",
          "old_line_content": "\t\t\t\t\tconst Member *p1 = box.getPrimary();",
          "new_line_content": "                BSONObj o = r.nextSafe(); /* note we might get \"not master\" at some point */",
          "content_same": false
        },
        {
          "line": 118,
          "old_api": "fullName",
          "new_api": "getPrimary",
          "old_text": "primary->fullName()",
          "new_text": "box.getPrimary()",
          "old_line_content": "                        log() << \"replSet primary was:\" << primary->fullName() << \" now:\" << ",
          "new_line_content": "\t\t\t\t\tconst Member *p1 = box.getPrimary();",
          "content_same": false
        },
        {
          "line": 125,
          "old_api": "syncApply",
          "new_api": "fullName",
          "old_text": "syncApply(o)",
          "new_text": "primary->fullName()",
          "old_line_content": "                        syncApply(o);",
          "new_line_content": "                        log() << \"replSet primary was:\" << primary->fullName() << \" now:\" << ",
          "content_same": false
        },
        {
          "line": 127,
          "old_api": "_logOpObjRS",
          "new_api": "DBException",
          "old_text": "_logOpObjRS(o)",
          "new_text": "DBException(\"primary changed\",0)",
          "old_line_content": "                    _logOpObjRS(o);   /* with repl sets we write the ops to our oplog too */",
          "new_line_content": "                        throw DBException(\"primary changed\",0);",
          "content_same": false
        },
        {
          "line": 138,
          "old_api": "toString",
          "new_api": "log",
          "old_text": "e.toString()",
          "new_text": "log()",
          "old_line_content": "                log() << \"replSet initial sync failing, error applying oplog \" << e.toString() << rsLog;",
          "new_line_content": "                    log() << \"replSet initialSyncOplogApplication \" << n << rsLog;",
          "content_same": false
        },
        {
          "line": 185,
          "old_api": "Query",
          "new_api": "toString",
          "old_text": "Query()",
          "new_text": "primary->h().toString()",
          "old_line_content": "            BSONObj remoteOldestOp = r.findOne(rsoplog, Query());",
          "new_line_content": "        if( !r.connect(primary->h().toString()) ) { ",
          "content_same": false
        },
        {
          "line": 186,
          "old_api": "_opTime",
          "new_api": "log",
          "old_text": "remoteOldestOp[\"ts\"]._opTime()",
          "new_text": "log(2)",
          "old_line_content": "            OpTime ts = remoteOldestOp[\"ts\"]._opTime();",
          "new_line_content": "            log(2) << \"replSet can't connect to \" << hn << \" to read operations\" << rsLog;",
          "content_same": false
        },
        {
          "line": 192,
          "old_api": "toString",
          "new_api": "Query",
          "old_text": "state().toString()",
          "new_text": "Query()",
          "old_line_content": "                log() << \"replSet our state: \" << state().toString() << rsLog;",
          "new_line_content": "            BSONObj remoteOldestOp = r.findOne(rsoplog, Query());",
          "content_same": false
        },
        {
          "line": 195,
          "old_api": "log",
          "new_api": "toStringLong",
          "old_text": "log()",
          "new_text": "ts.toStringLong()",
          "old_line_content": "                log() << \"replSet error RS102 too stale to catch up, at least from primary: \" << hn << rsLog;",
          "new_line_content": "            else log(3) << \"replSet remoteOldestOp: \" << ts.toStringLong() << rsLog;",
          "content_same": false
        },
        {
          "line": 198,
          "old_api": "log",
          "new_api": "toStringLong",
          "old_text": "log()",
          "new_text": "lastOpTimeWritten.toStringLong()",
          "old_line_content": "                log() << \"replSet See http://www.mongodb.org/display/DOCS/Resyncing+a+Very+Stale+Replica+Set+Member\" << rsLog;",
          "new_line_content": "                log() << \"replSet lastOpTimeWritten: \" << lastOpTimeWritten.toStringLong() << rsLog;",
          "content_same": false
        },
        {
          "line": 199,
          "old_api": "sethbmsg",
          "new_api": "toString",
          "old_text": "sethbmsg(\"error RS102 too stale to catch up\")",
          "new_text": "state().toString()",
          "old_line_content": "                sethbmsg(\"error RS102 too stale to catch up\");",
          "new_line_content": "                log() << \"replSet our state: \" << state().toString() << rsLog;",
          "content_same": false
        },
        {
          "line": 206,
          "old_api": "tailingQueryGTE",
          "new_api": "sethbmsg",
          "old_text": "r.tailingQueryGTE(rsoplog, lastOpTimeWritten)",
          "new_text": "sethbmsg(\"error RS102 too stale to catch up\")",
          "old_line_content": "        r.tailingQueryGTE(rsoplog, lastOpTimeWritten);",
          "new_line_content": "                sethbmsg(\"error RS102 too stale to catch up\");",
          "content_same": false
        },
        {
          "line": 207,
          "old_api": "haveCursor",
          "new_api": "changeState",
          "old_text": "r.haveCursor()",
          "new_text": "changeState(MemberState::RS_RECOVERING)",
          "old_line_content": "        assert( r.haveCursor() );",
          "new_line_content": "                changeState(MemberState::RS_RECOVERING);",
          "content_same": false
        },
        {
          "line": 208,
          "old_api": "awaitCapable",
          "new_api": "sleepsecs",
          "old_text": "r.awaitCapable()",
          "new_text": "sleepsecs(120)",
          "old_line_content": "        assert( r.awaitCapable() );",
          "new_line_content": "                sleepsecs(120);",
          "content_same": false
        },
        {
          "line": 214,
          "old_api": "getLastOp",
          "new_api": "haveCursor",
          "old_text": "r.getLastOp(rsoplog)",
          "new_text": "r.haveCursor()",
          "old_line_content": "                    bo theirLastOp = r.getLastOp(rsoplog);",
          "new_line_content": "        assert( r.haveCursor() );",
          "content_same": false
        },
        {
          "line": 215,
          "old_api": "isEmpty",
          "new_api": "awaitCapable",
          "old_text": "theirLastOp.isEmpty()",
          "new_text": "r.awaitCapable()",
          "old_line_content": "                    if( theirLastOp.isEmpty() ) {",
          "new_line_content": "        assert( r.awaitCapable() );",
          "content_same": false
        },
        {
          "line": 222,
          "old_api": "log",
          "new_api": "isEmpty",
          "old_text": "log()",
          "new_text": "theirLastOp.isEmpty()",
          "old_line_content": "                        log() << \"replSet we are ahead of the primary, will try to roll back\" << rsLog;",
          "new_line_content": "                    if( theirLastOp.isEmpty() ) {",
          "content_same": false
        },
        {
          "line": 223,
          "old_api": "syncRollback",
          "new_api": "log",
          "old_text": "syncRollback(r)",
          "new_text": "log()",
          "old_line_content": "                        syncRollback(r);",
          "new_line_content": "                        log() << \"replSet error empty query result from \" << hn << \" oplog\" << rsLog;",
          "content_same": false
        },
        {
          "line": 227,
          "old_api": "log",
          "new_api": "_opTime",
          "old_text": "log()",
          "new_text": "theirLastOp[\"ts\"]._opTime()",
          "old_line_content": "                    log() << \"replSet syncTail condition 1\" << rsLog;",
          "new_line_content": "                    OpTime theirTS = theirLastOp[\"ts\"]._opTime();",
          "content_same": false
        },
        {
          "line": 296,
          "old_api": "getSecs",
          "new_api": "nextSafe",
          "old_text": "ts.getSecs()",
          "new_text": "r.nextSafe()",
          "old_line_content": "                        long long a = ts.getSecs();",
          "new_line_content": "                    BSONObj o = r.nextSafe(); /* note we might get \"not master\" at some point */",
          "content_same": false
        },
        {
          "line": 301,
          "old_api": "uassert",
          "new_api": "getState",
          "old_text": "uassert(12000, \"rs slaveDelay differential too big check clocks and systems\", sleeptime < 0x40000000)",
          "new_text": "box.getState().secondary()",
          "old_line_content": "                            uassert(12000, \"rs slaveDelay differential too big check clocks and systems\", sleeptime < 0x40000000);",
          "new_line_content": "                    if( sd && box.getState().secondary() ) { ",
          "content_same": false
        },
        {
          "line": 302,
          "old_api": "log",
          "new_api": "_opTime",
          "old_text": "log()",
          "new_text": "o[\"ts\"]._opTime()",
          "old_line_content": "                            log() << \"replSet temp slavedelay sleep:\" << sleeptime << rsLog;",
          "new_line_content": "                        const OpTime ts = o[\"ts\"]._opTime();",
          "content_same": false
        },
        {
          "line": 304,
          "old_api": "sleepsecs",
          "new_api": "time",
          "old_text": "sleepsecs((int) sleeptime)",
          "new_text": "time(0)",
          "old_line_content": "                                sleepsecs((int) sleeptime);",
          "new_line_content": "                        long long b = time(0);",
          "content_same": false
        },
        {
          "line": 311,
          "old_api": "time",
          "new_api": "sleepsecs",
          "old_text": "time(0)",
          "new_text": "sleepsecs((int) sleeptime)",
          "old_line_content": "                                    if( time(0) >= waitUntil )",
          "new_line_content": "                                sleepsecs((int) sleeptime);",
          "content_same": false
        },
        {
          "line": 336,
          "old_api": "_logOpObjRS",
          "new_api": "getPrimary",
          "old_text": "_logOpObjRS(o)",
          "new_text": "box.getPrimary()",
          "old_line_content": "                        _logOpObjRS(o);   /* with repl sets we write the ops to our oplog too: */                   ",
          "new_line_content": "                        if( box.getPrimary() != primary ) {",
          "content_same": false
        },
        {
          "line": 342,
          "old_api": "log",
          "new_api": "syncApply",
          "old_text": "log(1)",
          "new_text": "syncApply(o)",
          "old_line_content": "                log(1) << \"replSet end syncTail pass with \" << hn << rsLog;",
          "new_line_content": "                        syncApply(o);",
          "content_same": false
        },
        {
          "line": 353,
          "old_api": "get",
          "new_api": "getPrimary",
          "old_text": "box.get()",
          "new_text": "box.getPrimary()",
          "old_line_content": "        StateBox::SP sp = box.get();",
          "new_line_content": "            if( box.getPrimary() != primary )",
          "content_same": false
        },
        {
          "line": 386,
          "old_api": "toString",
          "new_api": "myConfig",
          "old_text": "e.toString()",
          "new_text": "myConfig()",
          "old_line_content": "                sethbmsg(\"syncThread: \" + e.toString());",
          "new_line_content": "            if( myConfig().arbiterOnly )",
          "content_same": false
        },
        {
          "line": 390,
          "old_api": "sethbmsg",
          "new_api": "_syncThread",
          "old_text": "sethbmsg(\"unexpected exception in syncThread()\")",
          "new_text": "_syncThread()",
          "old_line_content": "                sethbmsg(\"unexpected exception in syncThread()\");",
          "new_line_content": "                _syncThread();",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 70,
          "old_api": null,
          "new_api": "asDate",
          "old_text": null,
          "new_text": "applyGTE.asDate()",
          "old_line_content": "",
          "new_line_content": "                q.appendDate(\"$gte\", applyGTE.asDate());",
          "content_same": false
        },
        {
          "line": 72,
          "old_api": null,
          "new_api": "done",
          "old_text": null,
          "new_text": "q.done()",
          "old_line_content": "            writelock lk(\"\");",
          "new_line_content": "                query.append(\"ts\", q.done());",
          "content_same": false
        },
        {
          "line": 73,
          "old_api": null,
          "new_api": "done",
          "old_text": null,
          "new_text": "query.done()",
          "old_line_content": "",
          "new_line_content": "                BSONObj queryObj = query.done();",
          "content_same": false
        },
        {
          "line": 74,
          "old_api": null,
          "new_api": "query",
          "old_text": null,
          "new_text": "r.query(rsoplog, queryObj)",
          "old_line_content": "            {",
          "new_line_content": "                r.query(rsoplog, queryObj);",
          "content_same": false
        },
        {
          "line": 83,
          "old_api": null,
          "new_api": "sethbmsg",
          "old_text": null,
          "new_text": "sethbmsg(\"replSet initial sync error reading remote oplog\")",
          "old_line_content": "",
          "new_line_content": "                    sethbmsg(\"replSet initial sync error reading remote oplog\");",
          "content_same": false
        },
        {
          "line": 87,
          "old_api": null,
          "new_api": "next",
          "old_text": null,
          "new_text": "r.next()",
          "old_line_content": "                }",
          "new_line_content": "                bo op = r.next();",
          "content_same": false
        },
        {
          "line": 88,
          "old_api": null,
          "new_api": "_opTime",
          "old_text": null,
          "new_text": "op[\"ts\"]._opTime()",
          "old_line_content": "",
          "new_line_content": "                OpTime t = op[\"ts\"]._opTime();",
          "content_same": false
        },
        {
          "line": 96,
          "old_api": null,
          "new_api": "isNull",
          "old_text": null,
          "new_text": "t.isNull()",
          "old_line_content": "            }",
          "new_line_content": "                uassert( 13508 , str::stream() << \"no 'ts' in first op in oplog: \" << op , !t.isNull() );",
          "content_same": false
        },
        {
          "line": 98,
          "old_api": null,
          "new_api": "str::stream()",
          "old_text": null,
          "new_text": "str::stream()",
          "old_line_content": "            // todo : use exhaust",
          "new_line_content": "                    sethbmsg(str::stream() << \"error \" << hn << \" oplog wrapped during initial sync\");",
          "content_same": false
        },
        {
          "line": 99,
          "old_api": null,
          "new_api": "log",
          "old_text": null,
          "new_text": "log()",
          "old_line_content": "            unsigned long long n = 0;",
          "new_line_content": "                    log() << \"replSet initial sync expected first optime of \" << applyGTE << rsLog;",
          "content_same": false
        },
        {
          "line": 100,
          "old_api": null,
          "new_api": "log",
          "old_text": null,
          "new_text": "log()",
          "old_line_content": "            while( 1 ) { ",
          "new_line_content": "                    log() << \"replSet initial sync but received a first optime of \" << t << \" from \" << hn << rsLog;",
          "content_same": false
        },
        {
          "line": 109,
          "old_api": null,
          "new_api": "more",
          "old_text": null,
          "new_text": "r.more()",
          "old_line_content": "                        anymore. assumePrimary is in the db lock so we are safe as long as ",
          "new_line_content": "                if( !r.more() )",
          "content_same": false
        },
        {
          "line": 113,
          "old_api": null,
          "new_api": "_opTime",
          "old_text": null,
          "new_text": "o[\"ts\"]._opTime()",
          "old_line_content": "                        int f = replSetForceInitialSyncFailure;",
          "new_line_content": "                    ts = o[\"ts\"]._opTime();",
          "content_same": false
        },
        {
          "line": 123,
          "old_api": null,
          "new_api": "log",
          "old_text": null,
          "new_text": "log()",
          "old_line_content": "                    if( ts >= applyGTE ) {",
          "new_line_content": "                            log() << \"replSet test code invoked, replSetForceInitialSyncFailure\" << rsLog;",
          "content_same": false
        },
        {
          "line": 126,
          "old_api": null,
          "new_api": "fullName",
          "old_text": null,
          "new_text": "p1->fullName()",
          "old_line_content": "                    }",
          "new_line_content": "                            (p1 != 0 ? p1->fullName() : \"none\") << rsLog;",
          "content_same": false
        },
        {
          "line": 132,
          "old_api": null,
          "new_api": "syncApply",
          "old_text": null,
          "new_text": "syncApply(o)",
          "old_line_content": "                }",
          "new_line_content": "                        syncApply(o);",
          "content_same": false
        },
        {
          "line": 134,
          "old_api": null,
          "new_api": "_logOpObjRS",
          "old_text": null,
          "new_text": "_logOpObjRS(o)",
          "old_line_content": "        }",
          "new_line_content": "                    _logOpObjRS(o);   /* with repl sets we write the ops to our oplog too */",
          "content_same": false
        },
        {
          "line": 145,
          "old_api": null,
          "new_api": "toString",
          "old_text": null,
          "new_text": "e.toString()",
          "old_line_content": "    /* should be in RECOVERING state on arrival here.  ",
          "new_line_content": "                log() << \"replSet initial sync failing, error applying oplog \" << e.toString() << rsLog;",
          "content_same": false
        },
        {
          "line": 161,
          "old_api": null,
          "new_api": "Helpers::getSingleton(\"local.replset.minvalid\", mv)",
          "old_text": null,
          "new_text": "Helpers::getSingleton(\"local.replset.minvalid\", mv)",
          "old_line_content": "                golive = true; /* must have been the original member */",
          "new_line_content": "            if( Helpers::getSingleton(\"local.replset.minvalid\", mv) ) { ",
          "content_same": false
        },
        {
          "line": 162,
          "old_api": null,
          "new_api": "_opTime",
          "old_text": null,
          "new_text": "mv[\"ts\"]._opTime()",
          "old_line_content": "        }",
          "new_line_content": "                minvalid = mv[\"ts\"]._opTime();",
          "content_same": false
        },
        {
          "line": 171,
          "old_api": null,
          "new_api": "sethbmsg",
          "old_text": null,
          "new_text": "sethbmsg(\"\")",
          "old_line_content": "    void ReplSetImpl::syncTail() { ",
          "new_line_content": "            sethbmsg(\"\");",
          "content_same": false
        },
        {
          "line": 172,
          "old_api": null,
          "new_api": "changeState",
          "old_text": null,
          "new_text": "changeState(MemberState::RS_SECONDARY)",
          "old_line_content": "        // todo : locking vis a vis the mgr...",
          "new_line_content": "            changeState(MemberState::RS_SECONDARY);",
          "content_same": false
        },
        {
          "line": 181,
          "old_api": null,
          "new_api": "getPrimary",
          "old_text": null,
          "new_text": "box.getPrimary()",
          "old_line_content": "        }",
          "new_line_content": "        const Member *primary = box.getPrimary();",
          "content_same": false
        },
        {
          "line": 183,
          "old_api": null,
          "new_api": "toString",
          "old_text": null,
          "new_text": "primary->h().toString()",
          "old_line_content": "        /* first make sure we are not hopelessly out of sync by being very stale. */",
          "new_line_content": "        string hn = primary->h().toString();",
          "content_same": false
        },
        {
          "line": 193,
          "old_api": null,
          "new_api": "_opTime",
          "old_text": null,
          "new_text": "remoteOldestOp[\"ts\"]._opTime()",
          "old_line_content": "            }",
          "new_line_content": "            OpTime ts = remoteOldestOp[\"ts\"]._opTime();",
          "content_same": false
        },
        {
          "line": 194,
          "old_api": null,
          "new_api": "toStringLong",
          "old_text": null,
          "new_text": "ts.toStringLong()",
          "old_line_content": "            if( lastOpTimeWritten < ts ) { ",
          "new_line_content": "            DEV log() << \"replSet remoteOldestOp:    \" << ts.toStringLong() << rsLog;",
          "content_same": false
        },
        {
          "line": 202,
          "old_api": null,
          "new_api": "log",
          "old_text": null,
          "new_text": "log()",
          "old_line_content": "                return;",
          "new_line_content": "                log() << \"replSet error RS102 too stale to catch up, at least from primary: \" << hn << rsLog;",
          "content_same": false
        },
        {
          "line": 203,
          "old_api": null,
          "new_api": "toStringLong",
          "old_text": null,
          "new_text": "lastOpTimeWritten.toStringLong()",
          "old_line_content": "            }",
          "new_line_content": "                log() << \"replSet our last optime : \" << lastOpTimeWritten.toStringLong() << rsLog;",
          "content_same": false
        },
        {
          "line": 204,
          "old_api": null,
          "new_api": "toStringLong",
          "old_text": null,
          "new_text": "ts.toStringLong()",
          "old_line_content": "        }",
          "new_line_content": "                log() << \"replSet oldest at \" << hn << \" : \" << ts.toStringLong() << rsLog;",
          "content_same": false
        },
        {
          "line": 205,
          "old_api": null,
          "new_api": "log",
          "old_text": null,
          "new_text": "log()",
          "old_line_content": "",
          "new_line_content": "                log() << \"replSet See http://www.mongodb.org/display/DOCS/Resyncing+a+Very+Stale+Replica+Set+Member\" << rsLog;",
          "content_same": false
        },
        {
          "line": 213,
          "old_api": null,
          "new_api": "tailingQueryGTE",
          "old_text": null,
          "new_text": "r.tailingQueryGTE(rsoplog, lastOpTimeWritten)",
          "old_line_content": "                try {",
          "new_line_content": "        r.tailingQueryGTE(rsoplog, lastOpTimeWritten);",
          "content_same": false
        },
        {
          "line": 218,
          "old_api": null,
          "new_api": "more",
          "old_text": null,
          "new_text": "r.more()",
          "old_line_content": "                        return;",
          "new_line_content": "            if( !r.more() ) {",
          "content_same": false
        },
        {
          "line": 221,
          "old_api": null,
          "new_api": "getLastOp",
          "old_text": null,
          "new_text": "r.getLastOp(rsoplog)",
          "old_line_content": "                    if( theirTS < lastOpTimeWritten ) { ",
          "new_line_content": "                    bo theirLastOp = r.getLastOp(rsoplog);",
          "content_same": false
        },
        {
          "line": 224,
          "old_api": null,
          "new_api": "sleepsecs",
          "old_text": null,
          "new_text": "sleepsecs(2)",
          "old_line_content": "                        return;",
          "new_line_content": "                        sleepsecs(2);",
          "content_same": false
        },
        {
          "line": 229,
          "old_api": null,
          "new_api": "log",
          "old_text": null,
          "new_text": "log()",
          "old_line_content": "                }",
          "new_line_content": "                        log() << \"replSet we are ahead of the primary, will try to roll back\" << rsLog;",
          "content_same": false
        },
        {
          "line": 230,
          "old_api": null,
          "new_api": "syncRollback",
          "old_text": null,
          "new_text": "syncRollback(r)",
          "old_line_content": "                catch(DBException& e) { ",
          "new_line_content": "                        syncRollback(r);",
          "content_same": false
        },
        {
          "line": 234,
          "old_api": null,
          "new_api": "log",
          "old_text": null,
          "new_text": "log()",
          "old_line_content": "                return;",
          "new_line_content": "                    log() << \"replSet syncTail condition 1\" << rsLog;",
          "content_same": false
        },
        {
          "line": 235,
          "old_api": null,
          "new_api": "sleepsecs",
          "old_text": null,
          "new_text": "sleepsecs(1)",
          "old_line_content": "                /*",
          "new_line_content": "                    sleepsecs(1);",
          "content_same": false
        },
        {
          "line": 238,
          "old_api": null,
          "new_api": "toString",
          "old_text": null,
          "new_text": "e.toString()",
          "old_line_content": "                    log() << \"replSet \" << hn << \" last op: \" << r.getLastOp(rsoplog).toString() << rsLog;",
          "new_line_content": "                    log() << \"replSet error querying \" << hn << ' ' << e.toString() << rsLog;",
          "content_same": false
        },
        {
          "line": 239,
          "old_api": null,
          "new_api": "sleepsecs",
          "old_text": null,
          "new_text": "sleepsecs(2)",
          "old_line_content": "                }",
          "new_line_content": "                    sleepsecs(2);",
          "content_same": false
        },
        {
          "line": 252,
          "old_api": null,
          "new_api": "nextSafe",
          "old_text": null,
          "new_text": "r.nextSafe()",
          "old_line_content": "                return;",
          "new_line_content": "            BSONObj o = r.nextSafe();",
          "content_same": false
        },
        {
          "line": 253,
          "old_api": null,
          "new_api": "_opTime",
          "old_text": null,
          "new_text": "o[\"ts\"]._opTime()",
          "old_line_content": "            }",
          "new_line_content": "            OpTime ts = o[\"ts\"]._opTime();",
          "content_same": false
        },
        {
          "line": 254,
          "old_api": null,
          "new_api": "numberLong",
          "old_text": null,
          "new_text": "o[\"h\"].numberLong()",
          "old_line_content": "        }",
          "new_line_content": "            long long h = o[\"h\"].numberLong();",
          "content_same": false
        },
        {
          "line": 256,
          "old_api": null,
          "new_api": "toStringPretty",
          "old_text": null,
          "new_text": "lastOpTimeWritten.toStringPretty()",
          "old_line_content": "        /* we have now checked if we need to rollback and we either don't have to or did it. */",
          "new_line_content": "                log() << \"replSet our last op time written: \" << lastOpTimeWritten.toStringPretty() << endl;",
          "content_same": false
        },
        {
          "line": 257,
          "old_api": null,
          "new_api": "toStringPretty",
          "old_text": null,
          "new_text": "ts.toStringPretty()",
          "old_line_content": "        {",
          "new_line_content": "                log() << \"replset primary's GTE: \" << ts.toStringPretty() << endl;",
          "content_same": false
        },
        {
          "line": 258,
          "old_api": null,
          "new_api": "syncRollback",
          "old_text": null,
          "new_text": "syncRollback(r)",
          "old_line_content": "            OpTime minvalid;",
          "new_line_content": "                syncRollback(r);",
          "content_same": false
        },
        {
          "line": 266,
          "old_api": null,
          "new_api": "tryToGoLiveAsASecondary",
          "old_text": null,
          "new_text": "tryToGoLiveAsASecondary(minvalid)",
          "old_line_content": "                       batches is probably a good time. */",
          "new_line_content": "            tryToGoLiveAsASecondary(minvalid);",
          "content_same": false
        },
        {
          "line": 271,
          "old_api": null,
          "new_api": "moreInCurrentBatch",
          "old_text": null,
          "new_text": "r.moreInCurrentBatch()",
          "old_line_content": "                        OpTime minvalid;",
          "new_line_content": "                if( !r.moreInCurrentBatch() ) { ",
          "content_same": false
        },
        {
          "line": 276,
          "old_api": null,
          "new_api": "recovering",
          "old_text": null,
          "new_text": "state().recovering()",
          "old_line_content": "                        else { ",
          "new_line_content": "                    if( state().recovering() ) { ",
          "content_same": false
        },
        {
          "line": 279,
          "old_api": null,
          "new_api": "ReplSetImpl::tryToGoLiveAsASecondary(minvalid)",
          "old_text": null,
          "new_text": "ReplSetImpl::tryToGoLiveAsASecondary(minvalid)",
          "old_line_content": "",
          "new_line_content": "                        bool golive = ReplSetImpl::tryToGoLiveAsASecondary(minvalid);",
          "content_same": false
        },
        {
          "line": 284,
          "old_api": null,
          "new_api": "toString",
          "old_text": null,
          "new_text": "minvalid.toString()",
          "old_line_content": "                        return;",
          "new_line_content": "                            sethbmsg(str::stream() << \"still syncing, not yet to minValid optime\" << minvalid.toString());",
          "content_same": false
        },
        {
          "line": 290,
          "old_api": null,
          "new_api": "getPrimary",
          "old_text": null,
          "new_text": "box.getPrimary()",
          "old_line_content": "",
          "new_line_content": "                    if( box.getPrimary() != primary ) ",
          "content_same": false
        },
        {
          "line": 293,
          "old_api": null,
          "new_api": "more",
          "old_text": null,
          "new_text": "r.more()",
          "old_line_content": "                    // it becomes secondary we can worry about it.",
          "new_line_content": "                if( !r.more() )",
          "content_same": false
        },
        {
          "line": 298,
          "old_api": null,
          "new_api": "myConfig",
          "old_text": null,
          "new_text": "myConfig()",
          "old_line_content": "                        long long lag = b - a;",
          "new_line_content": "                    int sd = myConfig().slaveDelay;",
          "content_same": false
        },
        {
          "line": 303,
          "old_api": null,
          "new_api": "getSecs",
          "old_text": null,
          "new_text": "ts.getSecs()",
          "old_line_content": "                            if( sleeptime < 60 ) {",
          "new_line_content": "                        long long a = ts.getSecs();",
          "content_same": false
        },
        {
          "line": 308,
          "old_api": null,
          "new_api": "uassert",
          "old_text": null,
          "new_text": "uassert(12000, \"rs slaveDelay differential too big check clocks and systems\", sleeptime < 0x40000000)",
          "old_line_content": "                                long long waitUntil = b + sleeptime;",
          "new_line_content": "                            uassert(12000, \"rs slaveDelay differential too big check clocks and systems\", sleeptime < 0x40000000);",
          "content_same": false
        },
        {
          "line": 309,
          "old_api": null,
          "new_api": "log",
          "old_text": null,
          "new_text": "log()",
          "old_line_content": "                                while( 1 ) {",
          "new_line_content": "                            log() << \"replSet temp slavedelay sleep:\" << sleeptime << rsLog;",
          "content_same": false
        },
        {
          "line": 317,
          "old_api": null,
          "new_api": "sleepsecs",
          "old_text": null,
          "new_text": "sleepsecs(6)",
          "old_line_content": "                                }",
          "new_line_content": "                                    sleepsecs(6);",
          "content_same": false
        },
        {
          "line": 318,
          "old_api": null,
          "new_api": "time",
          "old_text": null,
          "new_text": "time(0)",
          "old_line_content": "                            }",
          "new_line_content": "                                    if( time(0) >= waitUntil )",
          "content_same": false
        },
        {
          "line": 320,
          "old_api": null,
          "new_api": "getPrimary",
          "old_text": null,
          "new_text": "box.getPrimary()",
          "old_line_content": "                        ",
          "new_line_content": "                                    if( box.getPrimary() != primary )",
          "content_same": false
        },
        {
          "line": 322,
          "old_api": null,
          "new_api": "myConfig",
          "old_text": null,
          "new_text": "myConfig()",
          "old_line_content": "",
          "new_line_content": "                                    if( myConfig().slaveDelay != sd ) // reconf",
          "content_same": false
        },
        {
          "line": 337,
          "old_api": null,
          "new_api": "getState",
          "old_text": null,
          "new_text": "box.getState().primary()",
          "old_line_content": "                    }",
          "new_line_content": "                            if( box.getState().primary() )",
          "content_same": false
        },
        {
          "line": 338,
          "old_api": null,
          "new_api": "log",
          "old_text": null,
          "new_text": "log(0)",
          "old_line_content": "                }",
          "new_line_content": "                                log(0) << \"replSet stopping syncTail we are now primary\" << rsLog;",
          "content_same": false
        },
        {
          "line": 343,
          "old_api": null,
          "new_api": "_logOpObjRS",
          "old_text": null,
          "new_text": "_logOpObjRS(o)",
          "old_line_content": "                // TODO : reuse our connection to the primary.",
          "new_line_content": "                        _logOpObjRS(o);   /* with repl sets we write the ops to our oplog too: */                   ",
          "content_same": false
        },
        {
          "line": 347,
          "old_api": null,
          "new_api": "tailCheck",
          "old_text": null,
          "new_text": "r.tailCheck()",
          "old_line_content": "                return;",
          "new_line_content": "            r.tailCheck();",
          "content_same": false
        },
        {
          "line": 348,
          "old_api": null,
          "new_api": "haveCursor",
          "old_text": null,
          "new_text": "r.haveCursor()",
          "old_line_content": "            // looping back is ok because this is a tailable cursor",
          "new_line_content": "            if( !r.haveCursor() ) {",
          "content_same": false
        },
        {
          "line": 349,
          "old_api": null,
          "new_api": "log",
          "old_text": null,
          "new_text": "log(1)",
          "old_line_content": "        }",
          "new_line_content": "                log(1) << \"replSet end syncTail pass with \" << hn << rsLog;",
          "content_same": false
        },
        {
          "line": 360,
          "old_api": null,
          "new_api": "get",
          "old_text": null,
          "new_text": "box.get()",
          "old_line_content": "            return;",
          "new_line_content": "        StateBox::SP sp = box.get();",
          "content_same": false
        },
        {
          "line": 361,
          "old_api": null,
          "new_api": "primary",
          "old_text": null,
          "new_text": "sp.state.primary()",
          "old_line_content": "        }",
          "new_line_content": "        if( sp.state.primary() ) {",
          "content_same": false
        },
        {
          "line": 362,
          "old_api": null,
          "new_api": "sleepsecs",
          "old_text": null,
          "new_text": "sleepsecs(1)",
          "old_line_content": "",
          "new_line_content": "            sleepsecs(1);",
          "content_same": false
        },
        {
          "line": 365,
          "old_api": null,
          "new_api": "fatal",
          "old_text": null,
          "new_text": "sp.state.fatal()",
          "old_line_content": "            return;",
          "new_line_content": "        if( sp.state.fatal() ) { ",
          "content_same": false
        },
        {
          "line": 366,
          "old_api": null,
          "new_api": "sleepsecs",
          "old_text": null,
          "new_text": "sleepsecs(5)",
          "old_line_content": "",
          "new_line_content": "            sleepsecs(5);",
          "content_same": false
        },
        {
          "line": 375,
          "old_api": null,
          "new_api": "isNull",
          "old_text": null,
          "new_text": "lastOpTimeWritten.isNull()",
          "old_line_content": "    }",
          "new_line_content": "        if( lastOpTimeWritten.isNull() ) {",
          "content_same": false
        },
        {
          "line": 376,
          "old_api": null,
          "new_api": "syncDoInitialSync",
          "old_text": null,
          "new_text": "syncDoInitialSync()",
          "old_line_content": "",
          "new_line_content": "            syncDoInitialSync();",
          "content_same": false
        },
        {
          "line": 381,
          "old_api": null,
          "new_api": "syncTail",
          "old_text": null,
          "new_text": "syncTail()",
          "old_line_content": "            ",
          "new_line_content": "        syncTail();",
          "content_same": false
        },
        {
          "line": 393,
          "old_api": null,
          "new_api": "toString",
          "old_text": null,
          "new_text": "e.toString()",
          "old_line_content": "            }",
          "new_line_content": "                sethbmsg(\"syncThread: \" + e.toString());",
          "content_same": false
        },
        {
          "line": 397,
          "old_api": null,
          "new_api": "sethbmsg",
          "old_text": null,
          "new_text": "sethbmsg(\"unexpected exception in syncThread()\")",
          "old_line_content": "               are no heartbeat threads, so we do it here to be sure.  this is relevant if the singleton ",
          "new_line_content": "                sethbmsg(\"unexpected exception in syncThread()\");",
          "content_same": false
        },
        {
          "line": 399,
          "old_api": null,
          "new_api": "sleepsecs",
          "old_text": null,
          "new_text": "sleepsecs(60)",
          "old_line_content": "               */",
          "new_line_content": "                sleepsecs(60);",
          "content_same": false
        },
        {
          "line": 401,
          "old_api": null,
          "new_api": "sleepsecs",
          "old_text": null,
          "new_text": "sleepsecs(1)",
          "old_line_content": "        }",
          "new_line_content": "            sleepsecs(1);",
          "content_same": false
        },
        {
          "line": 413,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert( n == 0 )",
          "old_line_content": "    }",
          "new_line_content": "        assert( n == 0 );",
          "content_same": false
        },
        {
          "line": 416,
          "old_api": null,
          "new_api": "Client::initThread(\"rs_sync\")",
          "old_text": null,
          "new_text": "Client::initThread(\"rs_sync\")",
          "old_line_content": "",
          "new_line_content": "        Client::initThread(\"rs_sync\");",
          "content_same": false
        },
        {
          "line": 417,
          "old_api": null,
          "new_api": "iAmSyncThread",
          "old_text": null,
          "new_text": "cc().iAmSyncThread()",
          "old_line_content": "",
          "new_line_content": "        cc().iAmSyncThread();",
          "content_same": false
        },
        {
          "line": 418,
          "old_api": null,
          "new_api": "syncThread",
          "old_text": null,
          "new_text": "theReplSet->syncThread()",
          "old_line_content": "",
          "new_line_content": "        theReplSet->syncThread();",
          "content_same": false
        },
        {
          "line": 419,
          "old_api": null,
          "new_api": "shutdown",
          "old_text": null,
          "new_text": "cc().shutdown()",
          "old_line_content": "",
          "new_line_content": "        cc().shutdown();",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 68,
          "old_api": "bo",
          "new_api": null,
          "old_text": "bo()",
          "new_text": null,
          "old_line_content": "            r.query(rsoplog, bo());",
          "new_line_content": "            {",
          "content_same": false
        },
        {
          "line": 69,
          "old_api": "haveCursor",
          "new_api": null,
          "old_text": "r.haveCursor()",
          "new_text": null,
          "old_line_content": "            assert( r.haveCursor() );",
          "new_line_content": "                BSONObjBuilder q;",
          "content_same": false
        },
        {
          "line": 75,
          "old_api": "more",
          "new_api": null,
          "old_text": "r.more()",
          "new_text": null,
          "old_line_content": "                if( !r.more() ) { ",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 77,
          "old_api": "log",
          "new_api": null,
          "old_text": "log()",
          "new_text": null,
          "old_line_content": "                    log() << \"replSet initial sync error remote oplog (\" << rsoplog << \") on host \" << hn << \" is empty?\" << rsLog;",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 80,
          "old_api": "next",
          "new_api": null,
          "old_text": "r.next()",
          "new_text": null,
          "old_line_content": "                bo op = r.next();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 81,
          "old_api": "_opTime",
          "new_api": null,
          "old_text": "op[\"ts\"]._opTime()",
          "new_text": null,
          "old_line_content": "                OpTime t = op[\"ts\"]._opTime();",
          "new_line_content": "            {",
          "content_same": false
        },
        {
          "line": 85,
          "old_api": "toString",
          "new_api": null,
          "old_text": "op.toString()",
          "new_text": null,
          "old_line_content": "                    log() << \"replSet initial sync error querying \" << rsoplog << \" on \" << hn << \" : \" << op.toString() << rsLog;",
          "new_line_content": "                    return false;",
          "content_same": false
        },
        {
          "line": 93,
          "old_api": "log",
          "new_api": null,
          "old_text": "log()",
          "new_text": null,
          "old_line_content": "                    log() << \"replSet initial sync but received a first optime of \" << t << \" from \" << hn << rsLog;",
          "new_line_content": "                    return false;",
          "content_same": false
        },
        {
          "line": 102,
          "old_api": "more",
          "new_api": null,
          "old_text": "r.more()",
          "new_text": null,
          "old_line_content": "                if( !r.more() )",
          "new_line_content": "                }",
          "content_same": false
        },
        {
          "line": 104,
          "old_api": "nextSafe",
          "new_api": null,
          "old_text": "r.nextSafe()",
          "new_text": null,
          "old_line_content": "                BSONObj o = r.nextSafe(); /* note we might get \"not master\" at some point */",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 106,
          "old_api": "_opTime",
          "new_api": null,
          "old_text": "o[\"ts\"]._opTime()",
          "new_text": null,
          "old_line_content": "                    ts = o[\"ts\"]._opTime();",
          "new_line_content": "            unsigned long long n = 0;",
          "content_same": false
        },
        {
          "line": 116,
          "old_api": "log",
          "new_api": null,
          "old_text": "log()",
          "new_text": null,
          "old_line_content": "                            log() << \"replSet test code invoked, replSetForceInitialSyncFailure\" << rsLog;",
          "new_line_content": "                        anymore. assumePrimary is in the db lock so we are safe as long as ",
          "content_same": false
        },
        {
          "line": 119,
          "old_api": "fullName",
          "new_api": null,
          "old_text": "p1->fullName()",
          "new_text": null,
          "old_line_content": "                            (p1 != 0 ? p1->fullName() : \"none\") << rsLog;",
          "new_line_content": "                    if( p1 != primary || replSetForceInitialSyncFailure ) {",
          "content_same": false
        },
        {
          "line": 120,
          "old_api": "DBException",
          "new_api": null,
          "old_text": "DBException(\"primary changed\",0)",
          "new_text": null,
          "old_line_content": "                        throw DBException(\"primary changed\",0);",
          "new_line_content": "                        int f = replSetForceInitialSyncFailure;",
          "content_same": false
        },
        {
          "line": 131,
          "old_api": "log",
          "new_api": null,
          "old_text": "log()",
          "new_text": null,
          "old_line_content": "                    log() << \"replSet initialSyncOplogApplication \" << n << rsLog;",
          "new_line_content": "                        // optimes before we started copying need not be applied.",
          "content_same": false
        },
        {
          "line": 154,
          "old_api": "Helpers::getSingleton(\"local.replset.minvalid\", mv)",
          "new_api": null,
          "old_text": "Helpers::getSingleton(\"local.replset.minvalid\", mv)",
          "new_text": null,
          "old_line_content": "            if( Helpers::getSingleton(\"local.replset.minvalid\", mv) ) { ",
          "new_line_content": "       @return true if transitioned to SECONDARY",
          "content_same": false
        },
        {
          "line": 155,
          "old_api": "_opTime",
          "new_api": null,
          "old_text": "mv[\"ts\"]._opTime()",
          "new_text": null,
          "old_line_content": "                minvalid = mv[\"ts\"]._opTime();",
          "new_line_content": "    */",
          "content_same": false
        },
        {
          "line": 164,
          "old_api": "sethbmsg",
          "new_api": null,
          "old_text": "sethbmsg(\"\")",
          "new_text": null,
          "old_line_content": "            sethbmsg(\"\");",
          "new_line_content": "                    golive=true;",
          "content_same": false
        },
        {
          "line": 165,
          "old_api": "changeState",
          "new_api": null,
          "old_text": "changeState(MemberState::RS_SECONDARY)",
          "new_text": null,
          "old_line_content": "            changeState(MemberState::RS_SECONDARY);",
          "new_line_content": "                }",
          "content_same": false
        },
        {
          "line": 174,
          "old_api": "getPrimary",
          "new_api": null,
          "old_text": "box.getPrimary()",
          "new_text": null,
          "old_line_content": "        const Member *primary = box.getPrimary();",
          "new_line_content": "        return golive;",
          "content_same": false
        },
        {
          "line": 176,
          "old_api": "toString",
          "new_api": null,
          "old_text": "primary->h().toString()",
          "new_text": null,
          "old_line_content": "        string hn = primary->h().toString();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 178,
          "old_api": "toString",
          "new_api": null,
          "old_text": "primary->h().toString()",
          "new_text": null,
          "old_line_content": "        if( !r.connect(primary->h().toString()) ) { ",
          "new_line_content": "    void ReplSetImpl::syncTail() { ",
          "content_same": false
        },
        {
          "line": 179,
          "old_api": "log",
          "new_api": null,
          "old_text": "log(2)",
          "new_text": null,
          "old_line_content": "            log(2) << \"replSet can't connect to \" << hn << \" to read operations\" << rsLog;",
          "new_line_content": "        // todo : locking vis a vis the mgr...",
          "content_same": false
        },
        {
          "line": 187,
          "old_api": "toStringLong",
          "new_api": null,
          "old_text": "ts.toStringLong()",
          "new_text": null,
          "old_line_content": "            DEV log() << \"replSet remoteOldestOp:    \" << ts.toStringLong() << rsLog;",
          "new_line_content": "            return;",
          "content_same": false
        },
        {
          "line": 188,
          "old_api": "toStringLong",
          "new_api": null,
          "old_text": "ts.toStringLong()",
          "new_text": null,
          "old_line_content": "            else log(3) << \"replSet remoteOldestOp: \" << ts.toStringLong() << rsLog;",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 191,
          "old_api": "toStringLong",
          "new_api": null,
          "old_text": "lastOpTimeWritten.toStringLong()",
          "new_text": null,
          "old_line_content": "                log() << \"replSet lastOpTimeWritten: \" << lastOpTimeWritten.toStringLong() << rsLog;",
          "new_line_content": "        {",
          "content_same": false
        },
        {
          "line": 196,
          "old_api": "toStringLong",
          "new_api": null,
          "old_text": "lastOpTimeWritten.toStringLong()",
          "new_text": null,
          "old_line_content": "                log() << \"replSet our last optime : \" << lastOpTimeWritten.toStringLong() << rsLog;",
          "new_line_content": "            DEV { ",
          "content_same": false
        },
        {
          "line": 197,
          "old_api": "toStringLong",
          "new_api": null,
          "old_text": "ts.toStringLong()",
          "new_text": null,
          "old_line_content": "                log() << \"replSet oldest at \" << hn << \" : \" << ts.toStringLong() << rsLog;",
          "new_line_content": "                // debugging sync1.js...",
          "content_same": false
        },
        {
          "line": 200,
          "old_api": "changeState",
          "new_api": null,
          "old_text": "changeState(MemberState::RS_RECOVERING)",
          "new_text": null,
          "old_line_content": "                changeState(MemberState::RS_RECOVERING);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 201,
          "old_api": "sleepsecs",
          "new_api": null,
          "old_text": "sleepsecs(120)",
          "new_text": null,
          "old_line_content": "                sleepsecs(120);",
          "new_line_content": "            if( lastOpTimeWritten < ts ) { ",
          "content_same": false
        },
        {
          "line": 211,
          "old_api": "more",
          "new_api": null,
          "old_text": "r.more()",
          "new_text": null,
          "old_line_content": "            if( !r.more() ) {",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 216,
          "old_api": "log",
          "new_api": null,
          "old_text": "log()",
          "new_text": null,
          "old_line_content": "                        log() << \"replSet error empty query result from \" << hn << \" oplog\" << rsLog;",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 217,
          "old_api": "sleepsecs",
          "new_api": null,
          "old_text": "sleepsecs(2)",
          "new_text": null,
          "old_line_content": "                        sleepsecs(2);",
          "new_line_content": "        {",
          "content_same": false
        },
        {
          "line": 220,
          "old_api": "_opTime",
          "new_api": null,
          "old_text": "theirLastOp[\"ts\"]._opTime()",
          "new_text": null,
          "old_line_content": "                    OpTime theirTS = theirLastOp[\"ts\"]._opTime();",
          "new_line_content": "                try {",
          "content_same": false
        },
        {
          "line": 228,
          "old_api": "sleepsecs",
          "new_api": null,
          "old_text": "sleepsecs(1)",
          "new_text": null,
          "old_line_content": "                    sleepsecs(1);",
          "new_line_content": "                    if( theirTS < lastOpTimeWritten ) { ",
          "content_same": false
        },
        {
          "line": 231,
          "old_api": "toString",
          "new_api": null,
          "old_text": "e.toString()",
          "new_text": null,
          "old_line_content": "                    log() << \"replSet error querying \" << hn << ' ' << e.toString() << rsLog;",
          "new_line_content": "                        return;",
          "content_same": false
        },
        {
          "line": 232,
          "old_api": "sleepsecs",
          "new_api": null,
          "old_text": "sleepsecs(2)",
          "new_text": null,
          "old_line_content": "                    sleepsecs(2);",
          "new_line_content": "                    }",
          "content_same": false
        },
        {
          "line": 245,
          "old_api": "nextSafe",
          "new_api": null,
          "old_text": "r.nextSafe()",
          "new_text": null,
          "old_line_content": "            BSONObj o = r.nextSafe();",
          "new_line_content": "                    log() << \"replSet \" << hn << \" last op: \" << r.getLastOp(rsoplog).toString() << rsLog;",
          "content_same": false
        },
        {
          "line": 246,
          "old_api": "_opTime",
          "new_api": null,
          "old_text": "o[\"ts\"]._opTime()",
          "new_text": null,
          "old_line_content": "            OpTime ts = o[\"ts\"]._opTime();",
          "new_line_content": "                }",
          "content_same": false
        },
        {
          "line": 247,
          "old_api": "numberLong",
          "new_api": null,
          "old_text": "o[\"h\"].numberLong()",
          "new_text": null,
          "old_line_content": "            long long h = o[\"h\"].numberLong();",
          "new_line_content": "                catch(...) { }",
          "content_same": false
        },
        {
          "line": 249,
          "old_api": "toStringPretty",
          "new_api": null,
          "old_text": "lastOpTimeWritten.toStringPretty()",
          "new_text": null,
          "old_line_content": "                log() << \"replSet our last op time written: \" << lastOpTimeWritten.toStringPretty() << endl;",
          "new_line_content": "                return;*/",
          "content_same": false
        },
        {
          "line": 250,
          "old_api": "toStringPretty",
          "new_api": null,
          "old_text": "ts.toStringPretty()",
          "new_text": null,
          "old_line_content": "                log() << \"replset primary's GTE: \" << ts.toStringPretty() << endl;",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 251,
          "old_api": "syncRollback",
          "new_api": null,
          "old_text": "syncRollback(r)",
          "new_text": null,
          "old_line_content": "                syncRollback(r);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 259,
          "old_api": "tryToGoLiveAsASecondary",
          "new_api": null,
          "old_text": "tryToGoLiveAsASecondary(minvalid)",
          "new_text": null,
          "old_line_content": "            tryToGoLiveAsASecondary(minvalid);",
          "new_line_content": "                return;",
          "content_same": false
        },
        {
          "line": 264,
          "old_api": "moreInCurrentBatch",
          "new_api": null,
          "old_text": "r.moreInCurrentBatch()",
          "new_text": null,
          "old_line_content": "                if( !r.moreInCurrentBatch() ) { ",
          "new_line_content": "        {",
          "content_same": false
        },
        {
          "line": 269,
          "old_api": "recovering",
          "new_api": null,
          "old_text": "state().recovering()",
          "new_text": null,
          "old_line_content": "                    if( state().recovering() ) { ",
          "new_line_content": "        while( 1 ) {",
          "content_same": false
        },
        {
          "line": 272,
          "old_api": "ReplSetImpl::tryToGoLiveAsASecondary(minvalid)",
          "new_api": null,
          "old_text": "ReplSetImpl::tryToGoLiveAsASecondary(minvalid)",
          "new_text": null,
          "old_line_content": "                        bool golive = ReplSetImpl::tryToGoLiveAsASecondary(minvalid);",
          "new_line_content": "                    /* we need to occasionally check some things. between ",
          "content_same": false
        },
        {
          "line": 277,
          "old_api": "toString",
          "new_api": null,
          "old_text": "minvalid.toString()",
          "new_text": null,
          "old_line_content": "                            sethbmsg(str::stream() << \"still syncing, not yet to minValid optime\" << minvalid.toString());",
          "new_line_content": "                        /* can we go to RS_SECONDARY state?  we can if not too old and if minvalid achieved */",
          "content_same": false
        },
        {
          "line": 283,
          "old_api": "getPrimary",
          "new_api": null,
          "old_text": "box.getPrimary()",
          "new_text": null,
          "old_line_content": "                    if( box.getPrimary() != primary ) ",
          "new_line_content": "                        else { ",
          "content_same": false
        },
        {
          "line": 286,
          "old_api": "more",
          "new_api": null,
          "old_text": "r.more()",
          "new_text": null,
          "old_line_content": "                if( !r.more() )",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 289,
          "old_api": "nextSafe",
          "new_api": null,
          "old_text": "r.nextSafe()",
          "new_text": null,
          "old_line_content": "                    BSONObj o = r.nextSafe(); /* note we might get \"not master\" at some point */",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 291,
          "old_api": "myConfig",
          "new_api": null,
          "old_text": "myConfig()",
          "new_text": null,
          "old_line_content": "                    int sd = myConfig().slaveDelay;",
          "new_line_content": "                        return;",
          "content_same": false
        },
        {
          "line": 294,
          "old_api": "getState",
          "new_api": null,
          "old_text": "box.getState().secondary()",
          "new_text": null,
          "old_line_content": "                    if( sd && box.getState().secondary() ) { ",
          "new_line_content": "                    break;",
          "content_same": false
        },
        {
          "line": 295,
          "old_api": "_opTime",
          "new_api": null,
          "old_text": "o[\"ts\"]._opTime()",
          "new_text": null,
          "old_line_content": "                        const OpTime ts = o[\"ts\"]._opTime();",
          "new_line_content": "                { ",
          "content_same": false
        },
        {
          "line": 297,
          "old_api": "time",
          "new_api": null,
          "old_text": "time(0)",
          "new_text": null,
          "old_line_content": "                        long long b = time(0);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 310,
          "old_api": "sleepsecs",
          "new_api": null,
          "old_text": "sleepsecs(6)",
          "new_text": null,
          "old_line_content": "                                    sleepsecs(6);",
          "new_line_content": "                            if( sleeptime < 60 ) {",
          "content_same": false
        },
        {
          "line": 313,
          "old_api": "getPrimary",
          "new_api": null,
          "old_text": "box.getPrimary()",
          "new_text": null,
          "old_line_content": "                                    if( box.getPrimary() != primary )",
          "new_line_content": "                            else {",
          "content_same": false
        },
        {
          "line": 315,
          "old_api": "myConfig",
          "new_api": null,
          "old_text": "myConfig()",
          "new_text": null,
          "old_line_content": "                                    if( myConfig().slaveDelay != sd ) // reconf",
          "new_line_content": "                                long long waitUntil = b + sleeptime;",
          "content_same": false
        },
        {
          "line": 329,
          "old_api": "getPrimary",
          "new_api": null,
          "old_text": "box.getPrimary()",
          "new_text": null,
          "old_line_content": "                        if( box.getPrimary() != primary ) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 330,
          "old_api": "getState",
          "new_api": null,
          "old_text": "box.getState().primary()",
          "new_text": null,
          "old_line_content": "                            if( box.getState().primary() )",
          "new_line_content": "                    {",
          "content_same": false
        },
        {
          "line": 331,
          "old_api": "log",
          "new_api": null,
          "old_text": "log(0)",
          "new_text": null,
          "old_line_content": "                                log(0) << \"replSet stopping syncTail we are now primary\" << rsLog;",
          "new_line_content": "                        writelock lk(\"\");",
          "content_same": false
        },
        {
          "line": 335,
          "old_api": "syncApply",
          "new_api": null,
          "old_text": "syncApply(o)",
          "new_text": null,
          "old_line_content": "                        syncApply(o);",
          "new_line_content": "                           we check after we locked above. */",
          "content_same": false
        },
        {
          "line": 340,
          "old_api": "tailCheck",
          "new_api": null,
          "old_text": "r.tailCheck()",
          "new_text": null,
          "old_line_content": "            r.tailCheck();",
          "new_line_content": "                        }",
          "content_same": false
        },
        {
          "line": 341,
          "old_api": "haveCursor",
          "new_api": null,
          "old_text": "r.haveCursor()",
          "new_text": null,
          "old_line_content": "            if( !r.haveCursor() ) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 346,
          "old_api": "getPrimary",
          "new_api": null,
          "old_text": "box.getPrimary()",
          "new_text": null,
          "old_line_content": "            if( box.getPrimary() != primary )",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 354,
          "old_api": "primary",
          "new_api": null,
          "old_text": "sp.state.primary()",
          "new_text": null,
          "old_line_content": "        if( sp.state.primary() ) {",
          "new_line_content": "                return;",
          "content_same": false
        },
        {
          "line": 355,
          "old_api": "sleepsecs",
          "new_api": null,
          "old_text": "sleepsecs(1)",
          "new_text": null,
          "old_line_content": "            sleepsecs(1);",
          "new_line_content": "            // looping back is ok because this is a tailable cursor",
          "content_same": false
        },
        {
          "line": 358,
          "old_api": "fatal",
          "new_api": null,
          "old_text": "sp.state.fatal()",
          "new_text": null,
          "old_line_content": "        if( sp.state.fatal() ) { ",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 359,
          "old_api": "sleepsecs",
          "new_api": null,
          "old_text": "sleepsecs(5)",
          "new_text": null,
          "old_line_content": "            sleepsecs(5);",
          "new_line_content": "    void ReplSetImpl::_syncThread() {",
          "content_same": false
        },
        {
          "line": 368,
          "old_api": "isNull",
          "new_api": null,
          "old_text": "lastOpTimeWritten.isNull()",
          "new_text": null,
          "old_line_content": "        if( lastOpTimeWritten.isNull() ) {",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 369,
          "old_api": "syncDoInitialSync",
          "new_api": null,
          "old_text": "syncDoInitialSync()",
          "new_text": null,
          "old_line_content": "            syncDoInitialSync();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 374,
          "old_api": "syncTail",
          "new_api": null,
          "old_text": "syncTail()",
          "new_text": null,
          "old_line_content": "        syncTail();",
          "new_line_content": "        /* do we have anything at all? */",
          "content_same": false
        },
        {
          "line": 379,
          "old_api": "myConfig",
          "new_api": null,
          "old_text": "myConfig()",
          "new_text": null,
          "old_line_content": "            if( myConfig().arbiterOnly )",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 383,
          "old_api": "_syncThread",
          "new_api": null,
          "old_text": "_syncThread()",
          "new_text": null,
          "old_line_content": "                _syncThread();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 387,
          "old_api": "sleepsecs",
          "new_api": null,
          "old_text": "sleepsecs(10)",
          "new_text": null,
          "old_line_content": "                sleepsecs(10);",
          "new_line_content": "                return;",
          "content_same": false
        },
        {
          "line": 392,
          "old_api": "sleepsecs",
          "new_api": null,
          "old_text": "sleepsecs(60)",
          "new_text": null,
          "old_line_content": "                sleepsecs(60);",
          "new_line_content": "            catch(DBException& e) { ",
          "content_same": false
        },
        {
          "line": 406,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert( n == 0 )",
          "new_text": null,
          "old_line_content": "        assert( n == 0 );",
          "new_line_content": "               */",
          "content_same": false
        },
        {
          "line": 409,
          "old_api": "Client::initThread(\"rs_sync\")",
          "new_api": null,
          "old_text": "Client::initThread(\"rs_sync\")",
          "new_text": null,
          "old_line_content": "        Client::initThread(\"rs_sync\");",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 410,
          "old_api": "iAmSyncThread",
          "new_api": null,
          "old_text": "cc().iAmSyncThread()",
          "new_text": null,
          "old_line_content": "        cc().iAmSyncThread();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 411,
          "old_api": "syncThread",
          "new_api": null,
          "old_text": "theReplSet->syncThread()",
          "new_text": null,
          "old_line_content": "        theReplSet->syncThread();",
          "new_line_content": "    void startSyncThread() {",
          "content_same": false
        },
        {
          "line": 412,
          "old_api": "shutdown",
          "new_api": null,
          "old_text": "cc().shutdown()",
          "new_text": null,
          "old_line_content": "        cc().shutdown();",
          "new_line_content": "        static int n;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 35,
      "total_additions": 84,
      "total_deletions": 81,
      "total_api_changes": 200
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 8,
        "api_related_lines": 200,
        "non_api_lines": 1,
        "non_api_line_numbers": [
          71
        ]
      }
    },
    "api_calls_before": 160,
    "api_calls_after": 164,
    "diff_info": {
      "added_lines": 8,
      "removed_lines": 1,
      "total_diff_lines": 21
    }
  }
}