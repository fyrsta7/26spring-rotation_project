{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mongo/modified_file/9495380f77a88cb050024d1bc0e2b660d433b577",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mongo/modified_file/9495380f77a88cb050024d1bc0e2b660d433b577/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mongo/modified_file/9495380f77a88cb050024d1bc0e2b660d433b577/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mongo/modified_file/9495380f77a88cb050024d1bc0e2b660d433b577/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 74,
          "old_api": "assert",
          "new_api": "str",
          "old_text": "assert(addrs->ai_addrlen <= sizeof(sa))",
          "new_text": "ss.str().c_str()",
          "old_line_content": "                assert(addrs->ai_addrlen <= sizeof(sa));",
          "new_line_content": "                ret = getaddrinfo(iporhost, ss.str().c_str(), &hints, &addrs);",
          "content_same": false
        },
        {
          "line": 83,
          "old_api": "getType",
          "new_api": "memcpy",
          "old_text": "getType()",
          "new_text": "memcpy(&sa, addrs->ai_addr, addrs->ai_addrlen)",
          "old_line_content": "        switch (getType()){",
          "new_line_content": "                memcpy(&sa, addrs->ai_addr, addrs->ai_addrlen);",
          "content_same": false
        },
        {
          "line": 85,
          "old_api": "getAddr",
          "new_api": "freeaddrinfo",
          "old_text": "getAddr()",
          "new_text": "freeaddrinfo(addrs)",
          "old_line_content": "            case AF_INET6: return getAddr() == \"::1\";",
          "new_line_content": "                freeaddrinfo(addrs);",
          "content_same": false
        },
        {
          "line": 116,
          "old_api": "isLocalHost",
          "new_api": "closesocket",
          "old_text": "sa.isLocalHost()",
          "new_text": "closesocket(sock)",
          "old_line_content": "            return sa.isLocalHost() ? 16384 : 1480;",
          "new_line_content": "                closesocket(sock);",
          "content_same": false
        },
        {
          "line": 135,
          "old_api": "getType",
          "new_api": "rand",
          "old_text": "myAddr.getType()",
          "new_text": "rand()",
          "old_line_content": "        sock = socket(myAddr.getType(), SOCK_DGRAM, IPPROTO_UDP);",
          "new_line_content": "        if ( 0 && rand() < (RAND_MAX>>4) ) {",
          "content_same": false
        },
        {
          "line": 148,
          "old_api": "getsockopt",
          "new_api": "raw",
          "old_text": "getsockopt(sock,\n                       SOL_SOCKET,\n                       SO_RCVBUF,\n                       (char*)&rcvbuf,\n                       &optLen)",
          "new_text": "myAddr.raw()",
          "old_line_content": "        if (getsockopt(sock,",
          "new_line_content": "        if ( ::bind(sock, myAddr.raw(), myAddr.addressSize) != 0 ) {",
          "content_same": false
        },
        {
          "line": 175,
          "old_api": "init",
          "new_api": "out",
          "old_text": "c.init(me)",
          "new_text": "out()",
          "old_line_content": "        if ( c.init(me) ) {",
          "new_line_content": "        out() << \"end\\n\";",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 136,
          "old_api": null,
          "new_api": "out",
          "old_text": null,
          "new_text": "out()",
          "old_line_content": "        if ( sock == INVALID_SOCKET ) {",
          "new_line_content": "            out() << \" NOTSENT \";",
          "content_same": false
        },
        {
          "line": 139,
          "old_api": null,
          "new_api": "raw",
          "old_text": null,
          "new_text": "EndPoint.raw()",
          "old_line_content": "        }",
          "new_line_content": "        return ::sendto(sock, buf, len, 0, EndPoint.raw(), EndPoint.addressSize);",
          "content_same": false
        },
        {
          "line": 143,
          "old_api": null,
          "new_api": "getType",
          "old_text": null,
          "new_text": "myAddr.getType()",
          "old_line_content": "            sock = 0;",
          "new_line_content": "        sock = socket(myAddr.getType(), SOCK_DGRAM, IPPROTO_UDP);",
          "content_same": false
        },
        {
          "line": 145,
          "old_api": null,
          "new_api": "errnoWithDescription",
          "old_text": null,
          "new_text": "errnoWithDescription()",
          "old_line_content": "        }",
          "new_line_content": "            out() << \"invalid socket? \" << errnoWithDescription() << endl;",
          "content_same": false
        },
        {
          "line": 149,
          "old_api": null,
          "new_api": "out",
          "old_text": null,
          "new_text": "out()",
          "old_line_content": "                       SOL_SOCKET,",
          "new_line_content": "            out() << \"udp init failed\" << endl;",
          "content_same": false
        },
        {
          "line": 150,
          "old_api": null,
          "new_api": "closesocket",
          "old_text": null,
          "new_text": "closesocket(sock)",
          "old_line_content": "                       SO_RCVBUF,",
          "new_line_content": "            closesocket(sock);",
          "content_same": false
        },
        {
          "line": 156,
          "old_api": null,
          "new_api": "getsockopt",
          "old_text": null,
          "new_text": "getsockopt(sock,\n                       SOL_SOCKET,\n                       SO_RCVBUF,\n                       (char*)&rcvbuf,\n                       &optLen)",
          "old_line_content": "",
          "new_line_content": "        if (getsockopt(sock,",
          "content_same": false
        },
        {
          "line": 161,
          "old_api": null,
          "new_api": "out",
          "old_text": null,
          "new_text": "out()",
          "old_line_content": "        UDPConnection c;",
          "new_line_content": "            out() << \"SO_RCVBUF:\" << rcvbuf << endl;",
          "content_same": false
        },
        {
          "line": 166,
          "old_api": null,
          "new_api": "out",
          "old_text": null,
          "new_text": "out()",
          "old_line_content": "        }",
          "new_line_content": "        out() << \"sendtest\\n\";",
          "content_same": false
        },
        {
          "line": 170,
          "old_api": null,
          "new_api": "init",
          "old_text": null,
          "new_text": "c.init(me)",
          "old_line_content": "    void listentest() {",
          "new_line_content": "        if ( c.init(me) ) {",
          "content_same": false
        },
        {
          "line": 172,
          "old_api": null,
          "new_api": "out",
          "old_text": null,
          "new_text": "out()",
          "old_line_content": "        SockAddr me(27015);",
          "new_line_content": "            out() << \"sendto: \";",
          "content_same": false
        },
        {
          "line": 173,
          "old_api": null,
          "new_api": "errnoWithDescription",
          "old_text": null,
          "new_text": "errnoWithDescription()",
          "old_line_content": "        SockAddr sender;",
          "new_line_content": "            out() << c.sendto(buf, sizeof(buf), dest) << \" \" << errnoWithDescription() << endl;",
          "content_same": false
        },
        {
          "line": 179,
          "old_api": null,
          "new_api": "out",
          "old_text": null,
          "new_text": "out()",
          "old_line_content": "        }",
          "new_line_content": "        out() << \"listentest\\n\";",
          "content_same": false
        },
        {
          "line": 183,
          "old_api": null,
          "new_api": "init",
          "old_text": null,
          "new_text": "c.init(me)",
          "old_line_content": "    void xmain();",
          "new_line_content": "        if ( c.init(me) ) {",
          "content_same": false
        },
        {
          "line": 185,
          "old_api": null,
          "new_api": "out",
          "old_text": null,
          "new_text": "out()",
          "old_line_content": "#if defined(_WIN32)",
          "new_line_content": "            out() << \"recvfrom: \";",
          "content_same": false
        },
        {
          "line": 186,
          "old_api": null,
          "new_api": "errnoWithDescription",
          "old_text": null,
          "new_text": "errnoWithDescription()",
          "old_line_content": "    namespace {",
          "new_line_content": "            out() << c.recvfrom(buf, sizeof(buf), sender) << \" \" << errnoWithDescription() << endl;",
          "content_same": false
        },
        {
          "line": 188,
          "old_api": null,
          "new_api": "out",
          "old_text": null,
          "new_text": "out()",
          "old_line_content": "            WinsockInit() {",
          "new_line_content": "        out() << \"end listentest\\n\";",
          "content_same": false
        },
        {
          "line": 65,
          "old_api": null,
          "new_api": "IPv6Enabled",
          "old_text": null,
          "new_text": "IPv6Enabled()",
          "old_line_content": "",
          "new_line_content": "            hints.ai_family = (IPv6Enabled() ? AF_UNSPEC : AF_INET);",
          "content_same": false
        },
        {
          "line": 69,
          "old_api": null,
          "new_api": "str",
          "old_text": null,
          "new_text": "ss.str().c_str()",
          "old_line_content": "            if (ret){",
          "new_line_content": "            int ret = getaddrinfo(iporhost, ss.str().c_str(), &hints, &addrs);",
          "content_same": false
        },
        {
          "line": 198,
          "old_api": null,
          "new_api": "MAKEWORD",
          "old_text": null,
          "new_text": "MAKEWORD(2,2)",
          "old_line_content": "#endif",
          "new_line_content": "                if ( WSAStartup(MAKEWORD(2,2), &d) != 0 ) {",
          "content_same": false
        },
        {
          "line": 199,
          "old_api": null,
          "new_api": "errnoWithDescription",
          "old_text": null,
          "new_text": "errnoWithDescription()",
          "old_line_content": "",
          "new_line_content": "                    out() << \"ERROR: wsastartup failed \" << errnoWithDescription() << endl;",
          "content_same": false
        },
        {
          "line": 200,
          "old_api": null,
          "new_api": "errnoWithDescription",
          "old_text": null,
          "new_text": "errnoWithDescription()",
          "old_line_content": "    SockAddr unknownAddress( \"0.0.0.0\", 0 );",
          "new_line_content": "                    problem() << \"ERROR: wsastartup failed \" << errnoWithDescription() << endl;",
          "content_same": false
        },
        {
          "line": 201,
          "old_api": null,
          "new_api": "dbexit",
          "old_text": null,
          "new_text": "dbexit( EXIT_NTSERVICE_ERROR )",
          "old_line_content": "",
          "new_line_content": "                    dbexit( EXIT_NTSERVICE_ERROR );",
          "content_same": false
        },
        {
          "line": 78,
          "old_api": null,
          "new_api": "gai_strerror",
          "old_text": null,
          "new_text": "gai_strerror(ret)",
          "old_line_content": "            }",
          "new_line_content": "                log() << \"getaddrinfo(\\\"\" << iporhost << \"\\\") failed: \" << gai_strerror(ret) << endl;",
          "content_same": false
        },
        {
          "line": 79,
          "old_api": null,
          "new_api": "SockAddr",
          "old_text": null,
          "new_text": "SockAddr(port)",
          "old_line_content": "        }",
          "new_line_content": "                *this = SockAddr(port); ",
          "content_same": false
        },
        {
          "line": 82,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(addrs->ai_addrlen <= sizeof(sa))",
          "old_line_content": "    bool SockAddr::isLocalHost() const {",
          "new_line_content": "                assert(addrs->ai_addrlen <= sizeof(sa));",
          "content_same": false
        },
        {
          "line": 91,
          "old_api": null,
          "new_api": "getType",
          "old_text": null,
          "new_text": "getType()",
          "old_line_content": "    }",
          "new_line_content": "        switch (getType()){",
          "content_same": false
        },
        {
          "line": 92,
          "old_api": null,
          "new_api": "getAddr",
          "old_text": null,
          "new_text": "getAddr()",
          "old_line_content": "",
          "new_line_content": "            case AF_INET: return getAddr() == \"127.0.0.1\";",
          "content_same": false
        },
        {
          "line": 93,
          "old_api": null,
          "new_api": "getAddr",
          "old_text": null,
          "new_text": "getAddr()",
          "old_line_content": "    string hostbyname(const char *hostname) {",
          "new_line_content": "            case AF_INET6: return getAddr() == \"::1\";",
          "content_same": false
        },
        {
          "line": 219,
          "old_api": null,
          "new_api": "empty",
          "old_text": null,
          "new_text": "host.empty()",
          "old_line_content": "",
          "new_line_content": "        if ( host.empty() ){",
          "content_same": false
        },
        {
          "line": 220,
          "old_api": null,
          "new_api": "getHostName",
          "old_text": null,
          "new_text": "getHostName()",
          "old_line_content": "",
          "new_line_content": "            string s = getHostName();",
          "content_same": false
        },
        {
          "line": 97,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(false)",
          "old_line_content": "        else",
          "new_line_content": "        assert(false);",
          "content_same": false
        },
        {
          "line": 102,
          "old_api": null,
          "new_api": "getAddr",
          "old_text": null,
          "new_text": "SockAddr(hostname, 0).getAddr()",
          "old_line_content": "    public:",
          "new_line_content": "        string addr =  SockAddr(hostname, 0).getAddr();",
          "content_same": false
        },
        {
          "line": 124,
          "old_api": null,
          "new_api": "isLocalHost",
          "old_text": null,
          "new_text": "sa.isLocalHost()",
          "old_line_content": "    }",
          "new_line_content": "            return sa.isLocalHost() ? 16384 : 1480;",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 128,
          "old_api": "out",
          "new_api": null,
          "old_text": "out()",
          "new_text": null,
          "old_line_content": "            out() << \" NOTSENT \";",
          "new_line_content": "    };",
          "content_same": false
        },
        {
          "line": 137,
          "old_api": "errnoWithDescription",
          "new_api": null,
          "old_text": "errnoWithDescription()",
          "new_text": null,
          "old_line_content": "            out() << \"invalid socket? \" << errnoWithDescription() << endl;",
          "new_line_content": "            return 0;",
          "content_same": false
        },
        {
          "line": 140,
          "old_api": "raw",
          "new_api": null,
          "old_text": "myAddr.raw()",
          "new_text": null,
          "old_line_content": "        if ( ::bind(sock, myAddr.raw(), myAddr.addressSize) != 0 ) {",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 141,
          "old_api": "out",
          "new_api": null,
          "old_text": "out()",
          "new_text": null,
          "old_line_content": "            out() << \"udp init failed\" << endl;",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 142,
          "old_api": "closesocket",
          "new_api": null,
          "old_text": "closesocket(sock)",
          "new_text": null,
          "old_line_content": "            closesocket(sock);",
          "new_line_content": "    inline bool UDPConnection::init(const SockAddr& myAddr) {",
          "content_same": false
        },
        {
          "line": 153,
          "old_api": "out",
          "new_api": null,
          "old_text": "out()",
          "new_text": null,
          "old_line_content": "            out() << \"SO_RCVBUF:\" << rcvbuf << endl;",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 158,
          "old_api": "out",
          "new_api": null,
          "old_text": "out()",
          "new_text": null,
          "old_line_content": "        out() << \"sendtest\\n\";",
          "new_line_content": "                       SO_RCVBUF,",
          "content_same": false
        },
        {
          "line": 162,
          "old_api": "init",
          "new_api": null,
          "old_text": "c.init(me)",
          "new_text": null,
          "old_line_content": "        if ( c.init(me) ) {",
          "new_line_content": "        return true;",
          "content_same": false
        },
        {
          "line": 164,
          "old_api": "out",
          "new_api": null,
          "old_text": "out()",
          "new_text": null,
          "old_line_content": "            out() << \"sendto: \";",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 165,
          "old_api": "errnoWithDescription",
          "new_api": null,
          "old_text": "errnoWithDescription()",
          "new_text": null,
          "old_line_content": "            out() << c.sendto(buf, sizeof(buf), dest) << \" \" << errnoWithDescription() << endl;",
          "new_line_content": "    void sendtest() {",
          "content_same": false
        },
        {
          "line": 167,
          "old_api": "out",
          "new_api": null,
          "old_text": "out()",
          "new_text": null,
          "old_line_content": "        out() << \"end\\n\";",
          "new_line_content": "        SockAddr me(27016);",
          "content_same": false
        },
        {
          "line": 171,
          "old_api": "out",
          "new_api": null,
          "old_text": "out()",
          "new_text": null,
          "old_line_content": "        out() << \"listentest\\n\";",
          "new_line_content": "            char buf[256];",
          "content_same": false
        },
        {
          "line": 177,
          "old_api": "out",
          "new_api": null,
          "old_text": "out()",
          "new_text": null,
          "old_line_content": "            out() << \"recvfrom: \";",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 178,
          "old_api": "errnoWithDescription",
          "new_api": null,
          "old_text": "errnoWithDescription()",
          "new_text": null,
          "old_line_content": "            out() << c.recvfrom(buf, sizeof(buf), sender) << \" \" << errnoWithDescription() << endl;",
          "new_line_content": "    void listentest() {",
          "content_same": false
        },
        {
          "line": 180,
          "old_api": "out",
          "new_api": null,
          "old_text": "out()",
          "new_text": null,
          "old_line_content": "        out() << \"end listentest\\n\";",
          "new_line_content": "        SockAddr me(27015);",
          "content_same": false
        },
        {
          "line": 190,
          "old_api": "MAKEWORD",
          "new_api": null,
          "old_text": "MAKEWORD(2,2)",
          "new_text": null,
          "old_line_content": "                if ( WSAStartup(MAKEWORD(2,2), &d) != 0 ) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 191,
          "old_api": "errnoWithDescription",
          "new_api": null,
          "old_text": "errnoWithDescription()",
          "new_text": null,
          "old_line_content": "                    out() << \"ERROR: wsastartup failed \" << errnoWithDescription() << endl;",
          "new_line_content": "    void xmain();",
          "content_same": false
        },
        {
          "line": 64,
          "old_api": "IPv6Enabled",
          "new_api": null,
          "old_text": "IPv6Enabled()",
          "new_text": null,
          "old_line_content": "            hints.ai_family = (IPv6Enabled() ? AF_UNSPEC : AF_INET);",
          "new_line_content": "            hints.ai_flags |= AI_NUMERICHOST; // first pass tries w/o DNS lookup",
          "content_same": false
        },
        {
          "line": 192,
          "old_api": "errnoWithDescription",
          "new_api": null,
          "old_text": "errnoWithDescription()",
          "new_text": null,
          "old_line_content": "                    problem() << \"ERROR: wsastartup failed \" << errnoWithDescription() << endl;",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 193,
          "old_api": "dbexit",
          "new_api": null,
          "old_text": "dbexit( EXIT_NTSERVICE_ERROR )",
          "new_text": null,
          "old_line_content": "                    dbexit( EXIT_NTSERVICE_ERROR );",
          "new_line_content": "#if defined(_WIN32)",
          "content_same": false
        },
        {
          "line": 68,
          "old_api": "str",
          "new_api": null,
          "old_text": "ss.str().c_str()",
          "new_text": null,
          "old_line_content": "            int ret = getaddrinfo(iporhost, ss.str().c_str(), &hints, &addrs);",
          "new_line_content": "            ss << port;",
          "content_same": false
        },
        {
          "line": 70,
          "old_api": "gai_strerror",
          "new_api": null,
          "old_text": "gai_strerror(ret)",
          "new_text": null,
          "old_line_content": "                log() << \"getaddrinfo(\\\"\" << iporhost << \"\\\") failed: \" << gai_strerror(ret) << endl;",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 71,
          "old_api": "SockAddr",
          "new_api": null,
          "old_text": "SockAddr(port)",
          "new_text": null,
          "old_line_content": "                *this = SockAddr(port); ",
          "new_line_content": "            if (ret == EAI_NONAME ){ ",
          "content_same": false
        },
        {
          "line": 75,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(&sa, addrs->ai_addr, addrs->ai_addrlen)",
          "new_text": null,
          "old_line_content": "                memcpy(&sa, addrs->ai_addr, addrs->ai_addrlen);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 77,
          "old_api": "freeaddrinfo",
          "new_api": null,
          "old_text": "freeaddrinfo(addrs)",
          "new_text": null,
          "old_line_content": "                freeaddrinfo(addrs);",
          "new_line_content": "            if (ret){",
          "content_same": false
        },
        {
          "line": 211,
          "old_api": "empty",
          "new_api": null,
          "old_text": "host.empty()",
          "new_text": null,
          "old_line_content": "        if ( host.empty() ){",
          "new_line_content": "    ",
          "content_same": false
        },
        {
          "line": 84,
          "old_api": "getAddr",
          "new_api": null,
          "old_text": "getAddr()",
          "new_text": null,
          "old_line_content": "            case AF_INET: return getAddr() == \"127.0.0.1\";",
          "new_line_content": "                addressSize = addrs->ai_addrlen;",
          "content_same": false
        },
        {
          "line": 212,
          "old_api": "getHostName",
          "new_api": null,
          "old_text": "getHostName()",
          "new_text": null,
          "old_line_content": "            string s = getHostName();",
          "new_line_content": "    ListeningSockets* ListeningSockets::get(){",
          "content_same": false
        },
        {
          "line": 89,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(false)",
          "new_text": null,
          "old_line_content": "        assert(false);",
          "new_line_content": " ",
          "content_same": false
        },
        {
          "line": 94,
          "old_api": "getAddr",
          "new_api": null,
          "old_text": "SockAddr(hostname, 0).getAddr()",
          "new_text": null,
          "old_line_content": "        string addr =  SockAddr(hostname, 0).getAddr();",
          "new_line_content": "            case AF_UNIX: return true;",
          "content_same": false
        },
        {
          "line": 108,
          "old_api": "closesocket",
          "new_api": null,
          "old_text": "closesocket(sock)",
          "new_text": null,
          "old_line_content": "                closesocket(sock);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 123,
          "old_api": "raw",
          "new_api": null,
          "old_text": "sender.raw()",
          "new_text": null,
          "old_line_content": "        return ::recvfrom(sock, buf, len, 0, sender.raw(), &sender.addressSize);",
          "new_line_content": "        int mtu(const SockAddr& sa) {",
          "content_same": false
        },
        {
          "line": 127,
          "old_api": "rand",
          "new_api": null,
          "old_text": "rand()",
          "new_text": null,
          "old_line_content": "        if ( 0 && rand() < (RAND_MAX>>4) ) {",
          "new_line_content": "        SOCKET sock;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 7,
      "total_additions": 34,
      "total_deletions": 33,
      "total_api_changes": 74
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 8,
        "api_related_lines": 74,
        "non_api_lines": 3,
        "non_api_line_numbers": [
          72,
          73,
          76
        ]
      }
    },
    "api_calls_before": 77,
    "api_calls_after": 80,
    "diff_info": {
      "added_lines": 8,
      "removed_lines": 0,
      "total_diff_lines": 25
    }
  }
}