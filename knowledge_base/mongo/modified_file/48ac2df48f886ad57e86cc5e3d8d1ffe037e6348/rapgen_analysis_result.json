{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mongo/modified_file/48ac2df48f886ad57e86cc5e3d8d1ffe037e6348",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mongo/modified_file/48ac2df48f886ad57e86cc5e3d8d1ffe037e6348/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mongo/modified_file/48ac2df48f886ad57e86cc5e3d8d1ffe037e6348/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mongo/modified_file/48ac2df48f886ad57e86cc5e3d8d1ffe037e6348/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": true,
    "api_changes": {
      "replacements": [
        {
          "line": 49,
          "old_api": "boost::call_once( initModule, _init )",
          "new_api": "assert",
          "old_text": "boost::call_once( initModule, _init )",
          "new_text": "assert( _cachedProcessString )",
          "old_line_content": "            boost::call_once( initModule, _init );",
          "new_line_content": "        assert( _cachedProcessString );",
          "content_same": false
        },
        {
          "line": 55,
          "old_api": "get",
          "new_api": "empty",
          "old_text": "distLockIds.get()",
          "new_text": "s.empty()",
          "old_line_content": "        string s = distLockIds.get();",
          "new_line_content": "        if ( s.empty() ){",
          "content_same": false
        },
        {
          "line": 58,
          "old_api": "rand",
          "new_api": "str",
          "old_text": "rand()",
          "new_text": "ss.str()",
          "old_line_content": "            ss << getDistLockProcess() << \":\" << getThreadName() << \":\" << rand();",
          "new_line_content": "            s = ss.str();",
          "content_same": false
        },
        {
          "line": 59,
          "old_api": "str",
          "new_api": "set",
          "old_text": "ss.str()",
          "new_text": "distLockIds.set( s )",
          "old_line_content": "            s = ss.str();",
          "new_line_content": "            distLockIds.set( s );",
          "content_same": false
        },
        {
          "line": 71,
          "old_api": "getDistLockProcess",
          "new_api": "log",
          "old_text": "getDistLockProcess()",
          "new_text": "log(4)",
          "old_line_content": "            string process = getDistLockProcess();",
          "new_line_content": "            log(4) << \"dist_lock about to ping for: \" << process << endl;",
          "content_same": false
        },
        {
          "line": 78,
          "old_api": "update",
          "new_api": "BSON",
          "old_text": "conn->update( lockPingNS , \n                              BSON( \"_id\" << process ) , \n                              BSON( \"$set\" << BSON( \"ping\" << DATENOW ) ) ,\n                              true )",
          "new_text": "BSON( \"_id\" << process )",
          "old_line_content": "                conn->update( lockPingNS , ",
          "new_line_content": "                              BSON( \"_id\" << process ) , ",
          "content_same": false
        },
        {
          "line": 86,
          "old_api": "jsTime",
          "new_api": "obj",
          "old_text": "jsTime()",
          "new_text": "f.obj()",
          "old_line_content": "                f.appendDate( \"$lt\" , jsTime() - ( 4 * 86400 * 1000 ) );",
          "new_line_content": "                BSONObj r = BSON( \"ping\" << f.obj() );",
          "content_same": false
        },
        {
          "line": 87,
          "old_api": "obj",
          "new_api": "remove",
          "old_text": "f.obj()",
          "new_text": "conn->remove( lockPingNS , r )",
          "old_line_content": "                BSONObj r = BSON( \"ping\" << f.obj() );",
          "new_line_content": "                conn->remove( lockPingNS , r );",
          "content_same": false
        },
        {
          "line": 101,
          "old_api": "log",
          "new_api": "sleepsecs",
          "old_text": "log(4)",
          "new_text": "sleepsecs(30)",
          "old_line_content": "            log(4) << \"dist_lock pinged successfully for: \" << process << endl;",
          "new_line_content": "            sleepsecs(30);",
          "content_same": false
        },
        {
          "line": 118,
          "old_api": "boost::bind( &distLockPingThread , conn )",
          "new_api": "insert",
          "old_text": "boost::bind( &distLockPingThread , conn )",
          "new_text": "_seen.insert( s )",
          "old_line_content": "            boost::thread t( boost::bind( &distLockPingThread , conn ) );",
          "new_line_content": "            _seen.insert( s );",
          "content_same": false
        },
        {
          "line": 139,
          "old_api": "appendElements",
          "new_api": "append",
          "old_text": "queryBuilder.appendElements( _id )",
          "new_text": "queryBuilder.append( \"state\" , 0 )",
          "old_line_content": "        queryBuilder.appendElements( _id );",
          "new_line_content": "        queryBuilder.append( \"state\" , 0 );            ",
          "content_same": false
        },
        {
          "line": 143,
          "old_api": "findOne",
          "new_api": "isEmpty",
          "old_text": "conn->findOne( _ns , _id )",
          "new_text": "o.isEmpty()",
          "old_line_content": "            BSONObj o = conn->findOne( _ns , _id );",
          "new_line_content": "            if ( o.isEmpty() ){",
          "content_same": false
        },
        {
          "line": 146,
          "old_api": "log",
          "new_api": "BSON",
          "old_text": "log(4)",
          "new_text": "BSON( \"_id\" << _name << \"state\" << 0 << \"who\" << \"\" )",
          "old_line_content": "                    log(4) << \"dist_lock inserting initial doc in \" << _ns << \" for lock \" << _name << endl;",
          "new_line_content": "                    conn->insert( _ns , BSON( \"_id\" << _name << \"state\" << 0 << \"who\" << \"\" ) );",
          "content_same": false
        },
        {
          "line": 154,
          "old_api": "numberInt",
          "new_api": "wrap",
          "old_text": "o[\"state\"].numberInt()",
          "new_text": "o[\"process\"].wrap( \"_id\" )",
          "old_line_content": "            else if ( o[\"state\"].numberInt() > 0 ){",
          "new_line_content": "                BSONObj lastPing = conn->findOne( lockPingNS , o[\"process\"].wrap( \"_id\" ) );",
          "content_same": false
        },
        {
          "line": 155,
          "old_api": "wrap",
          "new_api": "isEmpty",
          "old_text": "o[\"process\"].wrap( \"_id\" )",
          "new_text": "lastPing.isEmpty()",
          "old_line_content": "                BSONObj lastPing = conn->findOne( lockPingNS , o[\"process\"].wrap( \"_id\" ) );",
          "new_line_content": "                if ( lastPing.isEmpty() ){",
          "content_same": false
        },
        {
          "line": 158,
          "old_api": "log",
          "new_api": "done",
          "old_text": "log()",
          "new_text": "conn.done()",
          "old_line_content": "                    log() << \"lastPing is empty! this could be bad: \" << o << endl;",
          "new_line_content": "                    conn.done();",
          "content_same": false
        },
        {
          "line": 167,
          "old_api": "log",
          "new_api": "done",
          "old_text": "log(1)",
          "new_text": "conn.done()",
          "old_line_content": "                    log(1) << \"dist_lock lock failed because taken by: \" << o << \" elapsed minutes: \" << elapsed << endl;",
          "new_line_content": "                    conn.done();",
          "content_same": false
        },
        {
          "line": 172,
          "old_api": "log",
          "new_api": "BSON",
          "old_text": "log()",
          "new_text": "BSON( \"state\" << 0 )",
          "old_line_content": "                log() << \"dist_lock forcefully taking over from: \" << o << \" elapsed minutes: \" << elapsed << endl;",
          "new_line_content": "                conn->update( _ns , _id , BSON( \"$set\" << BSON( \"state\" << 0 ) ) );",
          "content_same": false
        },
        {
          "line": 175,
          "old_api": "type",
          "new_api": "append",
          "old_text": "o[\"ts\"].type()",
          "new_text": "queryBuilder.append( o[\"ts\"] )",
          "old_line_content": "            else if ( o[\"ts\"].type() ){",
          "new_line_content": "                queryBuilder.append( o[\"ts\"] );",
          "content_same": false
        },
        {
          "line": 194,
          "old_api": "getLastErrorDetailed",
          "new_api": "findOne",
          "old_text": "conn->getLastErrorDetailed()",
          "new_text": "conn->findOne( _ns , _id )",
          "old_line_content": "            BSONObj o = conn->getLastErrorDetailed();",
          "new_line_content": "            now = conn->findOne( _ns , _id );",
          "content_same": false
        },
        {
          "line": 218,
          "old_api": "isEmpty",
          "new_api": "getOwned",
          "old_text": "now.isEmpty()",
          "new_text": "temp2.getOwned()",
          "old_line_content": "                if ( now.isEmpty() || now[\"ts\"] < temp2[\"ts\"] ){",
          "new_line_content": "                    now = temp2.getOwned();",
          "content_same": false
        },
        {
          "line": 225,
          "old_api": "OID",
          "new_api": "log",
          "old_text": "now[\"ts\"].OID()",
          "new_text": "log(4)",
          "old_line_content": "            if ( now[\"ts\"].OID() == ts ){",
          "new_line_content": "                log(4) << \"dist_lock completed lock propagation\" << endl;",
          "content_same": false
        },
        {
          "line": 250,
          "old_api": "BSON",
          "new_api": "findOne",
          "old_text": "BSON( \"state\" << 0 )",
          "new_text": "conn->findOne( _ns , _id )",
          "old_line_content": "                conn->update( _ns , _id, BSON( \"$set\" << BSON( \"state\" << 0 ) ) );",
          "new_line_content": "                log(1) << \"dist_lock unlock: \" << conn->findOne( _ns , _id ) << endl;",
          "content_same": false
        },
        {
          "line": 251,
          "old_api": "findOne",
          "new_api": "done",
          "old_text": "conn->findOne( _ns , _id )",
          "new_text": "conn.done()",
          "old_line_content": "                log(1) << \"dist_lock unlock: \" << conn->findOne( _ns , _id ) << endl;",
          "new_line_content": "                conn.done();",
          "content_same": false
        },
        {
          "line": 258,
          "old_api": "log",
          "new_api": "what",
          "old_text": "log( LL_WARNING )",
          "new_text": "e.what()",
          "old_line_content": "                log( LL_WARNING ) << \"dist_lock  \" << _name << \" failed to contact config server in unlock attempt \" ",
          "new_line_content": "                                  << attempted << \": \" << e.what() <<  endl;",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 128,
          "old_api": null,
          "new_api": "BSON",
          "old_text": null,
          "new_text": "BSON( \"_id\" << name )",
          "old_line_content": "        : _conn(conn),_name(name),_takeoverMinutes(takeoverMinutes){",
          "new_line_content": "        _id = BSON( \"_id\" << name );",
          "content_same": false
        },
        {
          "line": 257,
          "old_api": null,
          "new_api": "log",
          "old_text": null,
          "new_text": "log( LL_WARNING )",
          "old_line_content": "            } catch ( std::exception& e) {",
          "new_line_content": "                log( LL_WARNING ) << \"dist_lock  \" << _name << \" failed to contact config server in unlock attempt \" ",
          "content_same": false
        },
        {
          "line": 130,
          "old_api": null,
          "new_api": "got",
          "old_text": null,
          "new_text": "distLockPinger.got( conn )",
          "old_line_content": "        _ns = \"config.locks\";",
          "new_line_content": "        distLockPinger.got( conn );",
          "content_same": false
        },
        {
          "line": 260,
          "old_api": null,
          "new_api": "sleepsecs",
          "old_text": null,
          "new_text": "sleepsecs(1 << attempted)",
          "old_line_content": "",
          "new_line_content": "                sleepsecs(1 << attempted);",
          "content_same": false
        },
        {
          "line": 264,
          "old_api": null,
          "new_api": "log",
          "old_text": null,
          "new_text": "log( LL_WARNING )",
          "old_line_content": "",
          "new_line_content": "        log( LL_WARNING ) << \"dist_lock couldn't consumate unlock request. \" << \"Lock \" << _name ",
          "content_same": false
        },
        {
          "line": 138,
          "old_api": null,
          "new_api": "appendElements",
          "old_text": null,
          "new_text": "queryBuilder.appendElements( _id )",
          "old_line_content": "        BSONObjBuilder queryBuilder;",
          "new_line_content": "        queryBuilder.appendElements( _id );",
          "content_same": false
        },
        {
          "line": 142,
          "old_api": null,
          "new_api": "findOne",
          "old_text": null,
          "new_text": "conn->findOne( _ns , _id )",
          "old_line_content": "        { // make sure its there so we can use simple update logic below",
          "new_line_content": "            BSONObj o = conn->findOne( _ns , _id );",
          "content_same": false
        },
        {
          "line": 145,
          "old_api": null,
          "new_api": "log",
          "old_text": null,
          "new_text": "log(4)",
          "old_line_content": "                try {",
          "new_line_content": "                    log(4) << \"dist_lock inserting initial doc in \" << _ns << \" for lock \" << _name << endl;",
          "content_same": false
        },
        {
          "line": 149,
          "old_api": null,
          "new_api": "log",
          "old_text": null,
          "new_text": "log()",
          "old_line_content": "                catch ( UserException& e ){",
          "new_line_content": "                    log() << \"dist_lock could not insert initial doc: \" << e << endl;",
          "content_same": false
        },
        {
          "line": 153,
          "old_api": null,
          "new_api": "numberInt",
          "old_text": null,
          "new_text": "o[\"state\"].numberInt()",
          "old_line_content": "",
          "new_line_content": "            else if ( o[\"state\"].numberInt() > 0 ){",
          "content_same": false
        },
        {
          "line": 157,
          "old_api": null,
          "new_api": "log",
          "old_text": null,
          "new_text": "log()",
          "old_line_content": "                    // TODO: maybe this should clear, not sure yet",
          "new_line_content": "                    log() << \"lastPing is empty! this could be bad: \" << o << endl;",
          "content_same": false
        },
        {
          "line": 162,
          "old_api": null,
          "new_api": "Date",
          "old_text": null,
          "new_text": "lastPing[\"ping\"].Date()",
          "old_line_content": "",
          "new_line_content": "                unsigned long long elapsed = jsTime() - lastPing[\"ping\"].Date(); // in ms",
          "content_same": false
        },
        {
          "line": 166,
          "old_api": null,
          "new_api": "log",
          "old_text": null,
          "new_text": "log(1)",
          "old_line_content": "                if ( elapsed <= _takeoverMinutes ){",
          "new_line_content": "                    log(1) << \"dist_lock lock failed because taken by: \" << o << \" elapsed minutes: \" << elapsed << endl;",
          "content_same": false
        },
        {
          "line": 171,
          "old_api": null,
          "new_api": "log",
          "old_text": null,
          "new_text": "log()",
          "old_line_content": "                ",
          "new_line_content": "                log() << \"dist_lock forcefully taking over from: \" << o << \" elapsed minutes: \" << elapsed << endl;",
          "content_same": false
        },
        {
          "line": 174,
          "old_api": null,
          "new_api": "type",
          "old_text": null,
          "new_text": "o[\"ts\"].type()",
          "old_line_content": "            }",
          "new_line_content": "            else if ( o[\"ts\"].type() ){",
          "content_same": false
        },
        {
          "line": 48,
          "old_api": null,
          "new_api": "boost::call_once( initModule, _init )",
          "old_text": null,
          "new_text": "boost::call_once( initModule, _init )",
          "old_line_content": "        if ( _cachedProcessString == NULL )",
          "new_line_content": "        boost::call_once( initModule, _init );",
          "content_same": false
        },
        {
          "line": 180,
          "old_api": null,
          "new_api": "init",
          "old_text": null,
          "new_text": "ts.init()",
          "old_line_content": "        OID ts;",
          "new_line_content": "        ts.init();",
          "content_same": false
        },
        {
          "line": 54,
          "old_api": null,
          "new_api": "get",
          "old_text": null,
          "new_text": "distLockIds.get()",
          "old_line_content": "    string getDistLockId(){",
          "new_line_content": "        string s = distLockIds.get();",
          "content_same": false
        },
        {
          "line": 57,
          "old_api": null,
          "new_api": "rand",
          "old_text": null,
          "new_text": "rand()",
          "old_line_content": "            stringstream ss;",
          "new_line_content": "            ss << getDistLockProcess() << \":\" << getThreadName() << \":\" << rand();",
          "content_same": false
        },
        {
          "line": 185,
          "old_api": null,
          "new_api": "getDistLockProcess",
          "old_text": null,
          "new_text": "getDistLockProcess()",
          "old_line_content": "",
          "new_line_content": "        BSONObj lockDetails = BSON( \"state\" << 1 << \"who\" << getDistLockId() << \"process\" << getDistLockProcess() <<",
          "content_same": false
        },
        {
          "line": 187,
          "old_api": null,
          "new_api": "BSON",
          "old_text": null,
          "new_text": "BSON( \"$set\" << lockDetails )",
          "old_line_content": "                                    \"when\" << DATENOW << \"why\" << why << \"ts\" << ts );",
          "new_line_content": "        BSONObj whatIWant = BSON( \"$set\" << lockDetails );",
          "content_same": false
        },
        {
          "line": 189,
          "old_api": null,
          "new_api": "log",
          "old_text": null,
          "new_text": "log(4)",
          "old_line_content": "        try {",
          "new_line_content": "            log(4) << \"dist_lock about to aquire lock: \" << lockDetails << endl;",
          "content_same": false
        },
        {
          "line": 191,
          "old_api": null,
          "new_api": "obj",
          "old_text": null,
          "new_text": "queryBuilder.obj()",
          "old_line_content": "",
          "new_line_content": "            conn->update( _ns , queryBuilder.obj() , whatIWant );",
          "content_same": false
        },
        {
          "line": 65,
          "old_api": null,
          "new_api": "setThreadName",
          "old_text": null,
          "new_text": "setThreadName( \"LockPinger\" )",
          "old_line_content": "    void distLockPingThread( ConnectionString addr ){",
          "new_line_content": "        setThreadName( \"LockPinger\" );",
          "content_same": false
        },
        {
          "line": 193,
          "old_api": null,
          "new_api": "getLastErrorDetailed",
          "old_text": null,
          "new_text": "conn->getLastErrorDetailed()",
          "old_line_content": "                ",
          "new_line_content": "            BSONObj o = conn->getLastErrorDetailed();",
          "content_same": false
        },
        {
          "line": 68,
          "old_api": null,
          "new_api": "inShutdown",
          "old_text": null,
          "new_text": "inShutdown()",
          "old_line_content": "        static int loops = 0;",
          "new_line_content": "        while( ! inShutdown() ){",
          "content_same": false
        },
        {
          "line": 196,
          "old_api": null,
          "new_api": "numberInt",
          "old_text": null,
          "new_text": "o[\"n\"].numberInt()",
          "old_line_content": "                ",
          "new_line_content": "            if ( o[\"n\"].numberInt() == 0 ){",
          "content_same": false
        },
        {
          "line": 70,
          "old_api": null,
          "new_api": "getDistLockProcess",
          "old_text": null,
          "new_text": "getDistLockProcess()",
          "old_line_content": "",
          "new_line_content": "            string process = getDistLockProcess();",
          "content_same": false
        },
        {
          "line": 199,
          "old_api": null,
          "new_api": "getOwned",
          "old_text": null,
          "new_text": "other->getOwned()",
          "old_line_content": "                    *other = now;",
          "new_line_content": "                    other->getOwned();",
          "content_same": false
        },
        {
          "line": 201,
          "old_api": null,
          "new_api": "log",
          "old_text": null,
          "new_text": "log()",
          "old_line_content": "                }",
          "new_line_content": "                log() << \"dist_lock error trying to aquire lock: \" << lockDetails << \" error: \" << o << endl;",
          "content_same": false
        },
        {
          "line": 77,
          "old_api": null,
          "new_api": "update",
          "old_text": null,
          "new_text": "conn->update( lockPingNS , \n                              BSON( \"_id\" << process ) , \n                              BSON( \"$set\" << BSON( \"ping\" << DATENOW ) ) ,\n                              true )",
          "old_line_content": "                // do ping",
          "new_line_content": "                conn->update( lockPingNS , ",
          "content_same": false
        },
        {
          "line": 211,
          "old_api": null,
          "new_api": "log",
          "old_text": null,
          "new_text": "log(4)",
          "old_line_content": "            // this means our update got through on some, but not others",
          "new_line_content": "            log(4) << \"dist_lock lock did not propagate properly\" << endl;",
          "content_same": false
        },
        {
          "line": 85,
          "old_api": null,
          "new_api": "jsTime",
          "old_text": null,
          "new_text": "jsTime()",
          "old_line_content": "                BSONObjBuilder f;",
          "new_line_content": "                f.appendDate( \"$lt\" , jsTime() - ( 4 * 86400 * 1000 ) );",
          "content_same": false
        },
        {
          "line": 213,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "up.size()",
          "old_line_content": "",
          "new_line_content": "            for ( unsigned i=0; i<up.size(); i++ ){",
          "content_same": false
        },
        {
          "line": 215,
          "old_api": null,
          "new_api": "findOne",
          "old_text": null,
          "new_text": "temp->findOne( _ns , _id )",
          "old_line_content": "                ScopedDbConnection temp( up[i].first );",
          "new_line_content": "                BSONObj temp2 = temp->findOne( _ns , _id );",
          "content_same": false
        },
        {
          "line": 217,
          "old_api": null,
          "new_api": "isEmpty",
          "old_text": null,
          "new_text": "now.isEmpty()",
          "old_line_content": "",
          "new_line_content": "                if ( now.isEmpty() || now[\"ts\"] < temp2[\"ts\"] ){",
          "content_same": false
        },
        {
          "line": 91,
          "old_api": null,
          "new_api": "BSON",
          "old_text": null,
          "new_text": "BSON( \"ping\" << 1 )",
          "old_line_content": "                if ( loops++ == 0 ){",
          "new_line_content": "                    conn->ensureIndex( lockPingNS , BSON( \"ping\" << 1 ) );",
          "content_same": false
        },
        {
          "line": 221,
          "old_api": null,
          "new_api": "done",
          "old_text": null,
          "new_text": "temp.done()",
          "old_line_content": "",
          "new_line_content": "                temp.done();",
          "content_same": false
        },
        {
          "line": 94,
          "old_api": null,
          "new_api": "done",
          "old_text": null,
          "new_text": "conn.done()",
          "old_line_content": "                ",
          "new_line_content": "                conn.done();",
          "content_same": false
        },
        {
          "line": 224,
          "old_api": null,
          "new_api": "OID",
          "old_text": null,
          "new_text": "now[\"ts\"].OID()",
          "old_line_content": "",
          "new_line_content": "            if ( now[\"ts\"].OID() == ts ){",
          "content_same": false
        },
        {
          "line": 97,
          "old_api": null,
          "new_api": "what",
          "old_text": null,
          "new_text": "e.what()",
          "old_line_content": "            catch ( std::exception& e ){",
          "new_line_content": "                log( LL_WARNING ) << \"dist_lock couldn't ping: \" << e.what() << endl;",
          "content_same": false
        },
        {
          "line": 227,
          "old_api": null,
          "new_api": "update",
          "old_text": null,
          "new_text": "conn->update( _ns , _id , whatIWant )",
          "old_line_content": "                gotLock = true;",
          "new_line_content": "                conn->update( _ns , _id , whatIWant );",
          "content_same": false
        },
        {
          "line": 100,
          "old_api": null,
          "new_api": "log",
          "old_text": null,
          "new_text": "log(4)",
          "old_line_content": "",
          "new_line_content": "            log(4) << \"dist_lock pinged successfully for: \" << process << endl;",
          "content_same": false
        },
        {
          "line": 230,
          "old_api": null,
          "new_api": "log",
          "old_text": null,
          "new_text": "log()",
          "old_line_content": "            else {",
          "new_line_content": "                log() << \"dist_lock error trying to complete propagation\" << endl;",
          "content_same": false
        },
        {
          "line": 235,
          "old_api": null,
          "new_api": "done",
          "old_text": null,
          "new_text": "conn.done()",
          "old_line_content": "            ",
          "new_line_content": "        conn.done();",
          "content_same": false
        },
        {
          "line": 237,
          "old_api": null,
          "new_api": "log",
          "old_text": null,
          "new_text": "log(1)",
          "old_line_content": "            ",
          "new_line_content": "        log(1) << \"dist_lock lock gotLock: \" << gotLock << \" now: \" << now << endl;",
          "content_same": false
        },
        {
          "line": 113,
          "old_api": null,
          "new_api": "toString",
          "old_text": null,
          "new_text": "conn.toString()",
          "old_line_content": "        void got( const ConnectionString& conn ){",
          "new_line_content": "            string s = conn.toString();",
          "content_same": false
        },
        {
          "line": 115,
          "old_api": null,
          "new_api": "count",
          "old_text": null,
          "new_text": "_seen.count( s )",
          "old_line_content": "            scoped_lock lk( _mutex );",
          "new_line_content": "            if ( _seen.count( s ) > 0 )",
          "content_same": false
        },
        {
          "line": 117,
          "old_api": null,
          "new_api": "boost::bind( &distLockPingThread , conn )",
          "old_text": null,
          "new_text": "boost::bind( &distLockPingThread , conn )",
          "old_line_content": "                return;",
          "new_line_content": "            boost::thread t( boost::bind( &distLockPingThread , conn ) );",
          "content_same": false
        },
        {
          "line": 249,
          "old_api": null,
          "new_api": "BSON",
          "old_text": null,
          "new_text": "BSON( \"state\" << 0 )",
          "old_line_content": "                ScopedDbConnection conn( _conn );",
          "new_line_content": "                conn->update( _ns , _id, BSON( \"$set\" << BSON( \"state\" << 0 ) ) );",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 129,
          "old_api": "BSON",
          "new_api": null,
          "old_text": "BSON( \"_id\" << name )",
          "new_text": null,
          "old_line_content": "        _id = BSON( \"_id\" << name );",
          "new_line_content": "        _ns = \"config.locks\";",
          "content_same": false
        },
        {
          "line": 131,
          "old_api": "got",
          "new_api": null,
          "old_text": "distLockPinger.got( conn )",
          "new_text": null,
          "old_line_content": "        distLockPinger.got( conn );",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 259,
          "old_api": "what",
          "new_api": null,
          "old_text": "e.what()",
          "new_text": null,
          "old_line_content": "                                  << attempted << \": \" << e.what() <<  endl;",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 261,
          "old_api": "sleepsecs",
          "new_api": null,
          "old_text": "sleepsecs(1 << attempted)",
          "new_text": null,
          "old_line_content": "                sleepsecs(1 << attempted);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 265,
          "old_api": "log",
          "new_api": null,
          "old_text": "log( LL_WARNING )",
          "new_text": null,
          "old_line_content": "        log( LL_WARNING ) << \"dist_lock couldn't consumate unlock request. \" << \"Lock \" << _name ",
          "new_line_content": "                              << \" will be taken over after \" <<  _takeoverMinutes << \" minutes timeout\" << endl;",
          "content_same": false
        },
        {
          "line": 140,
          "old_api": "append",
          "new_api": null,
          "old_text": "queryBuilder.append( \"state\" , 0 )",
          "new_text": null,
          "old_line_content": "        queryBuilder.append( \"state\" , 0 );            ",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 144,
          "old_api": "isEmpty",
          "new_api": null,
          "old_text": "o.isEmpty()",
          "new_text": null,
          "old_line_content": "            if ( o.isEmpty() ){",
          "new_line_content": "                try {",
          "content_same": false
        },
        {
          "line": 147,
          "old_api": "BSON",
          "new_api": null,
          "old_text": "BSON( \"_id\" << _name << \"state\" << 0 << \"who\" << \"\" )",
          "new_text": null,
          "old_line_content": "                    conn->insert( _ns , BSON( \"_id\" << _name << \"state\" << 0 << \"who\" << \"\" ) );",
          "new_line_content": "                }",
          "content_same": false
        },
        {
          "line": 150,
          "old_api": "log",
          "new_api": null,
          "old_text": "log()",
          "new_text": null,
          "old_line_content": "                    log() << \"dist_lock could not insert initial doc: \" << e << endl;",
          "new_line_content": "                }",
          "content_same": false
        },
        {
          "line": 156,
          "old_api": "isEmpty",
          "new_api": null,
          "old_text": "lastPing.isEmpty()",
          "new_text": null,
          "old_line_content": "                if ( lastPing.isEmpty() ){",
          "new_line_content": "                    // TODO: maybe this should clear, not sure yet",
          "content_same": false
        },
        {
          "line": 159,
          "old_api": "done",
          "new_api": null,
          "old_text": "conn.done()",
          "new_text": null,
          "old_line_content": "                    conn.done();",
          "new_line_content": "                    return false;",
          "content_same": false
        },
        {
          "line": 163,
          "old_api": "Date",
          "new_api": null,
          "old_text": "lastPing[\"ping\"].Date()",
          "new_text": null,
          "old_line_content": "                unsigned long long elapsed = jsTime() - lastPing[\"ping\"].Date(); // in ms",
          "new_line_content": "                elapsed = elapsed / ( 1000 * 60 ); // convert to minutes",
          "content_same": false
        },
        {
          "line": 168,
          "old_api": "done",
          "new_api": null,
          "old_text": "conn.done()",
          "new_text": null,
          "old_line_content": "                    conn.done();",
          "new_line_content": "                    return false;",
          "content_same": false
        },
        {
          "line": 173,
          "old_api": "BSON",
          "new_api": null,
          "old_text": "BSON( \"state\" << 0 )",
          "new_text": null,
          "old_line_content": "                conn->update( _ns , _id , BSON( \"$set\" << BSON( \"state\" << 0 ) ) );",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 176,
          "old_api": "append",
          "new_api": null,
          "old_text": "queryBuilder.append( o[\"ts\"] )",
          "new_text": null,
          "old_line_content": "                queryBuilder.append( o[\"ts\"] );",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 50,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert( _cachedProcessString )",
          "new_text": null,
          "old_line_content": "        assert( _cachedProcessString );",
          "new_line_content": "        return *_cachedProcessString;",
          "content_same": false
        },
        {
          "line": 181,
          "old_api": "init",
          "new_api": null,
          "old_text": "ts.init()",
          "new_text": null,
          "old_line_content": "        ts.init();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 56,
          "old_api": "empty",
          "new_api": null,
          "old_text": "s.empty()",
          "new_text": null,
          "old_line_content": "        if ( s.empty() ){",
          "new_line_content": "            stringstream ss;",
          "content_same": false
        },
        {
          "line": 186,
          "old_api": "getDistLockProcess",
          "new_api": null,
          "old_text": "getDistLockProcess()",
          "new_text": null,
          "old_line_content": "        BSONObj lockDetails = BSON( \"state\" << 1 << \"who\" << getDistLockId() << \"process\" << getDistLockProcess() <<",
          "new_line_content": "                                    \"when\" << DATENOW << \"why\" << why << \"ts\" << ts );",
          "content_same": false
        },
        {
          "line": 60,
          "old_api": "set",
          "new_api": null,
          "old_text": "distLockIds.set( s )",
          "new_text": null,
          "old_line_content": "            distLockIds.set( s );",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 188,
          "old_api": "BSON",
          "new_api": null,
          "old_text": "BSON( \"$set\" << lockDetails )",
          "new_text": null,
          "old_line_content": "        BSONObj whatIWant = BSON( \"$set\" << lockDetails );",
          "new_line_content": "        try {",
          "content_same": false
        },
        {
          "line": 190,
          "old_api": "log",
          "new_api": null,
          "old_text": "log(4)",
          "new_text": null,
          "old_line_content": "            log(4) << \"dist_lock about to aquire lock: \" << lockDetails << endl;",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 192,
          "old_api": "obj",
          "new_api": null,
          "old_text": "queryBuilder.obj()",
          "new_text": null,
          "old_line_content": "            conn->update( _ns , queryBuilder.obj() , whatIWant );",
          "new_line_content": "                ",
          "content_same": false
        },
        {
          "line": 66,
          "old_api": "setThreadName",
          "new_api": null,
          "old_text": "setThreadName( \"LockPinger\" )",
          "new_text": null,
          "old_line_content": "        setThreadName( \"LockPinger\" );",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 195,
          "old_api": "findOne",
          "new_api": null,
          "old_text": "conn->findOne( _ns , _id )",
          "new_text": null,
          "old_line_content": "            now = conn->findOne( _ns , _id );",
          "new_line_content": "                ",
          "content_same": false
        },
        {
          "line": 69,
          "old_api": "inShutdown",
          "new_api": null,
          "old_text": "inShutdown()",
          "new_text": null,
          "old_line_content": "        while( ! inShutdown() ){",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 197,
          "old_api": "numberInt",
          "new_api": null,
          "old_text": "o[\"n\"].numberInt()",
          "new_text": null,
          "old_line_content": "            if ( o[\"n\"].numberInt() == 0 ){",
          "new_line_content": "                if ( other ){",
          "content_same": false
        },
        {
          "line": 72,
          "old_api": "log",
          "new_api": null,
          "old_text": "log(4)",
          "new_text": null,
          "old_line_content": "            log(4) << \"dist_lock about to ping for: \" << process << endl;",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 200,
          "old_api": "getOwned",
          "new_api": null,
          "old_text": "other->getOwned()",
          "new_text": null,
          "old_line_content": "                    other->getOwned();",
          "new_line_content": "                }",
          "content_same": false
        },
        {
          "line": 202,
          "old_api": "log",
          "new_api": null,
          "old_text": "log()",
          "new_text": null,
          "old_line_content": "                log() << \"dist_lock error trying to aquire lock: \" << lockDetails << \" error: \" << o << endl;",
          "new_line_content": "                gotLock = false;",
          "content_same": false
        },
        {
          "line": 80,
          "old_api": "BSON",
          "new_api": null,
          "old_text": "BSON( \"ping\" << DATENOW )",
          "new_text": null,
          "old_line_content": "                              BSON( \"$set\" << BSON( \"ping\" << DATENOW ) ) ,",
          "new_line_content": "                              true );",
          "content_same": false
        },
        {
          "line": 212,
          "old_api": "log",
          "new_api": null,
          "old_text": "log(4)",
          "new_text": null,
          "old_line_content": "            log(4) << \"dist_lock lock did not propagate properly\" << endl;",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 214,
          "old_api": "size",
          "new_api": null,
          "old_text": "up.size()",
          "new_text": null,
          "old_line_content": "            for ( unsigned i=0; i<up.size(); i++ ){",
          "new_line_content": "                ScopedDbConnection temp( up[i].first );",
          "content_same": false
        },
        {
          "line": 88,
          "old_api": "remove",
          "new_api": null,
          "old_text": "conn->remove( lockPingNS , r )",
          "new_text": null,
          "old_line_content": "                conn->remove( lockPingNS , r );",
          "new_line_content": "                ",
          "content_same": false
        },
        {
          "line": 216,
          "old_api": "findOne",
          "new_api": null,
          "old_text": "temp->findOne( _ns , _id )",
          "new_text": null,
          "old_line_content": "                BSONObj temp2 = temp->findOne( _ns , _id );",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 219,
          "old_api": "getOwned",
          "new_api": null,
          "old_text": "temp2.getOwned()",
          "new_text": null,
          "old_line_content": "                    now = temp2.getOwned();",
          "new_line_content": "                }",
          "content_same": false
        },
        {
          "line": 92,
          "old_api": "BSON",
          "new_api": null,
          "old_text": "BSON( \"ping\" << 1 )",
          "new_text": null,
          "old_line_content": "                    conn->ensureIndex( lockPingNS , BSON( \"ping\" << 1 ) );",
          "new_line_content": "                }",
          "content_same": false
        },
        {
          "line": 222,
          "old_api": "done",
          "new_api": null,
          "old_text": "temp.done()",
          "new_text": null,
          "old_line_content": "                temp.done();",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 95,
          "old_api": "done",
          "new_api": null,
          "old_text": "conn.done()",
          "new_text": null,
          "old_line_content": "                conn.done();",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 98,
          "old_api": "what",
          "new_api": null,
          "old_text": "e.what()",
          "new_text": null,
          "old_line_content": "                log( LL_WARNING ) << \"dist_lock couldn't ping: \" << e.what() << endl;",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 226,
          "old_api": "log",
          "new_api": null,
          "old_text": "log(4)",
          "new_text": null,
          "old_line_content": "                log(4) << \"dist_lock completed lock propagation\" << endl;",
          "new_line_content": "                gotLock = true;",
          "content_same": false
        },
        {
          "line": 228,
          "old_api": "update",
          "new_api": null,
          "old_text": "conn->update( _ns , _id , whatIWant )",
          "new_text": null,
          "old_line_content": "                conn->update( _ns , _id , whatIWant );",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 102,
          "old_api": "sleepsecs",
          "new_api": null,
          "old_text": "sleepsecs(30)",
          "new_text": null,
          "old_line_content": "            sleepsecs(30);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 231,
          "old_api": "log",
          "new_api": null,
          "old_text": "log()",
          "new_text": null,
          "old_line_content": "                log() << \"dist_lock error trying to complete propagation\" << endl;",
          "new_line_content": "                gotLock = false;",
          "content_same": false
        },
        {
          "line": 236,
          "old_api": "done",
          "new_api": null,
          "old_text": "conn.done()",
          "new_text": null,
          "old_line_content": "        conn.done();",
          "new_line_content": "            ",
          "content_same": false
        },
        {
          "line": 238,
          "old_api": "log",
          "new_api": null,
          "old_text": "log(1)",
          "new_text": null,
          "old_line_content": "        log(1) << \"dist_lock lock gotLock: \" << gotLock << \" now: \" << now << endl;",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 114,
          "old_api": "toString",
          "new_api": null,
          "old_text": "conn.toString()",
          "new_text": null,
          "old_line_content": "            string s = conn.toString();",
          "new_line_content": "            scoped_lock lk( _mutex );",
          "content_same": false
        },
        {
          "line": 116,
          "old_api": "count",
          "new_api": null,
          "old_text": "_seen.count( s )",
          "new_text": null,
          "old_line_content": "            if ( _seen.count( s ) > 0 )",
          "new_line_content": "                return;",
          "content_same": false
        },
        {
          "line": 119,
          "old_api": "insert",
          "new_api": null,
          "old_text": "_seen.insert( s )",
          "new_text": null,
          "old_line_content": "            _seen.insert( s );",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 252,
          "old_api": "done",
          "new_api": null,
          "old_text": "conn.done()",
          "new_text": null,
          "old_line_content": "                conn.done();",
          "new_line_content": "",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 25,
      "total_additions": 50,
      "total_deletions": 50,
      "total_api_changes": 125
    },
    "non_api_changes": {
      "has_non_api_changes": false,
      "evidence": {
        "total_diff_lines": 2,
        "api_related_lines": 125,
        "non_api_lines": 0,
        "non_api_line_numbers": []
      }
    },
    "api_calls_before": 98,
    "api_calls_after": 98,
    "diff_info": {
      "added_lines": 1,
      "removed_lines": 2,
      "total_diff_lines": 15
    }
  }
}