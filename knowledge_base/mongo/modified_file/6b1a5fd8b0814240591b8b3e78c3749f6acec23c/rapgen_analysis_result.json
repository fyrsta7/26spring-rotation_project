{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mongo/modified_file/6b1a5fd8b0814240591b8b3e78c3749f6acec23c",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mongo/modified_file/6b1a5fd8b0814240591b8b3e78c3749f6acec23c/before.h",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mongo/modified_file/6b1a5fd8b0814240591b8b3e78c3749f6acec23c/after.h",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mongo/modified_file/6b1a5fd8b0814240591b8b3e78c3749f6acec23c/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 334,
          "old_api": "isShared",
          "new_api": "MONGO_unlikely",
          "old_text": "_storage->isShared()",
          "new_text": "MONGO_unlikely( !_storage )",
          "old_line_content": "            if (MONGO_unlikely( _storage->isShared() ))",
          "new_line_content": "            if (MONGO_unlikely( !_storage ))",
          "content_same": false
        },
        {
          "line": 335,
          "old_api": "clonedStorage",
          "new_api": "newStorage",
          "old_text": "clonedStorage()",
          "new_text": "newStorage()",
          "old_line_content": "                return clonedStorage();",
          "new_line_content": "                return newStorage();",
          "content_same": false
        },
        {
          "line": 338,
          "old_api": "storagePtr",
          "new_api": "clonedStorage",
          "old_text": "storagePtr()",
          "new_text": "clonedStorage()",
          "old_line_content": "            return const_cast<DocumentStorage&>(*storagePtr());",
          "new_line_content": "                return clonedStorage();",
          "content_same": false
        },
        {
          "line": 341,
          "old_api": "reset",
          "new_api": "storagePtr",
          "old_text": "reset(new DocumentStorage)",
          "new_text": "storagePtr()",
          "old_line_content": "            reset(new DocumentStorage);",
          "new_line_content": "            return const_cast<DocumentStorage&>(*storagePtr());",
          "content_same": false
        },
        {
          "line": 345,
          "old_api": "get",
          "new_api": "storagePtr",
          "old_text": "storagePtr()->clone().get()",
          "new_text": "storagePtr()",
          "old_line_content": "            reset(storagePtr()->clone().get());",
          "new_line_content": "            return const_cast<DocumentStorage&>(*storagePtr());",
          "content_same": false
        },
        {
          "line": 381,
          "old_api": "advance",
          "new_api": "more",
          "old_text": "_it.advance()",
          "new_text": "more()",
          "old_line_content": "            _it.advance();",
          "new_line_content": "            verify(more());",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 384,
          "old_api": null,
          "new_api": "advance",
          "old_text": null,
          "new_text": "_it.advance()",
          "old_line_content": "",
          "new_line_content": "            _it.advance();",
          "content_same": false
        },
        {
          "line": 397,
          "old_api": null,
          "new_api": "swap",
          "old_text": null,
          "new_text": "lhs.swap(rhs)",
          "old_line_content": "/* ======================= INLINED IMPLEMENTATIONS ========================== */",
          "new_line_content": "    inline void swap(mongo::Document& lhs, mongo::Document& rhs) { lhs.swap(rhs); }",
          "content_same": false
        },
        {
          "line": 404,
          "old_api": null,
          "new_api": "FieldIterator",
          "old_text": null,
          "new_text": "FieldIterator(*this)",
          "old_line_content": "    inline MutableValue MutableValue::getField(Position pos) {",
          "new_line_content": "        return FieldIterator(*this);",
          "content_same": false
        },
        {
          "line": 411,
          "old_api": null,
          "new_api": "getField",
          "old_text": null,
          "new_text": "MutableDocument(*this).getField(key)",
          "old_line_content": "",
          "new_line_content": "        return MutableDocument(*this).getField(key);",
          "content_same": false
        },
        {
          "line": 304,
          "old_api": null,
          "new_api": "swap",
          "old_text": null,
          "new_text": "temp.swap(ret._storage)",
          "old_line_content": "        }",
          "new_line_content": "            temp.swap(ret._storage);",
          "content_same": false
        },
        {
          "line": 316,
          "old_api": null,
          "new_api": "storagePtr",
          "old_text": null,
          "new_text": "storagePtr()",
          "old_line_content": "    private:",
          "new_line_content": "            return Document(storagePtr());",
          "content_same": false
        },
        {
          "line": 321,
          "old_api": null,
          "new_api": "explicit",
          "old_text": null,
          "new_text": "explicit",
          "old_line_content": "        {}",
          "new_line_content": "        explicit MutableDocument(MutableValue mv)",
          "content_same": false
        },
        {
          "line": 323,
          "old_api": null,
          "new_api": "getDocPtr",
          "old_text": null,
          "new_text": "mv.getDocPtr()",
          "old_line_content": "        void reset(const DocumentStorage* ds) {",
          "new_line_content": "            , _storage(mv.getDocPtr())",
          "content_same": false
        },
        {
          "line": 327,
          "old_api": null,
          "new_api": "intrusive_ptr_release",
          "old_text": null,
          "new_text": "intrusive_ptr_release(_storage)",
          "old_line_content": "        }",
          "new_line_content": "            if (_storage) intrusive_ptr_release(_storage);",
          "content_same": false
        },
        {
          "line": 329,
          "old_api": null,
          "new_api": "intrusive_ptr_add_ref",
          "old_text": null,
          "new_text": "intrusive_ptr_add_ref(_storage)",
          "old_line_content": "        // This is split into 3 functions to speed up the fast-path",
          "new_line_content": "            if (_storage) intrusive_ptr_add_ref(_storage);",
          "content_same": false
        },
        {
          "line": 337,
          "old_api": null,
          "new_api": "isShared",
          "old_text": null,
          "new_text": "_storage->isShared()",
          "old_line_content": "            // This function exists to ensure this is safe",
          "new_line_content": "            if (MONGO_unlikely( _storage->isShared() ))",
          "content_same": false
        },
        {
          "line": 344,
          "old_api": null,
          "new_api": "reset",
          "old_text": null,
          "new_text": "reset(new DocumentStorage)",
          "old_line_content": "        DocumentStorage& clonedStorage() {",
          "new_line_content": "            reset(new DocumentStorage);",
          "content_same": false
        },
        {
          "line": 348,
          "old_api": null,
          "new_api": "get",
          "old_text": null,
          "new_text": "storagePtr()->clone().get()",
          "old_line_content": "",
          "new_line_content": "            reset(storagePtr()->clone().get());",
          "content_same": false
        },
        {
          "line": 349,
          "old_api": null,
          "new_api": "storagePtr",
          "old_text": null,
          "new_text": "storagePtr()",
          "old_line_content": "        MutableValue getNestedFieldHelper(MutableDocument& md,",
          "new_line_content": "            return const_cast<DocumentStorage&>(*storagePtr());",
          "content_same": false
        },
        {
          "line": 358,
          "old_api": null,
          "new_api": "typeid",
          "old_text": null,
          "new_text": "typeid(const DocumentStorage)",
          "old_line_content": "",
          "new_line_content": "            dassert(!_storage || typeid(*_storage) == typeid(const DocumentStorage));",
          "content_same": false
        },
        {
          "line": 359,
          "old_api": null,
          "new_api": "static_cast<const DocumentStorage*>(_storage)",
          "old_text": null,
          "new_text": "static_cast<const DocumentStorage*>(_storage)",
          "old_line_content": "        // These are both const to prevent modifications bypassing storage() method.",
          "new_line_content": "            return static_cast<const DocumentStorage*>(_storage);",
          "content_same": false
        },
        {
          "line": 371,
          "old_api": null,
          "new_api": "explicit",
          "old_text": null,
          "new_text": "explicit",
          "old_line_content": "        {}",
          "new_line_content": "        explicit FieldIterator(const Document& doc)",
          "content_same": false
        },
        {
          "line": 373,
          "old_api": null,
          "new_api": "storage",
          "old_text": null,
          "new_text": "_doc.storage().iterator()",
          "old_line_content": "        /// Ask if there are more fields to return.",
          "new_line_content": "            , _it(_doc.storage().iterator())",
          "content_same": false
        },
        {
          "line": 377,
          "old_api": null,
          "new_api": "atEnd",
          "old_text": null,
          "new_text": "_it.atEnd()",
          "old_line_content": "        Document::FieldPair next() {",
          "new_line_content": "        bool more() const { return !_it.atEnd(); }",
          "content_same": false
        },
        {
          "line": 383,
          "old_api": null,
          "new_api": "nameSD",
          "old_text": null,
          "new_text": "_it->nameSD()",
          "old_line_content": "        }",
          "new_line_content": "            Document::FieldPair fp (_it->nameSD(), _it->val);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 394,
          "old_api": "swap",
          "new_api": null,
          "old_text": "lhs.swap(rhs)",
          "new_text": null,
          "old_line_content": "    inline void swap(mongo::Document& lhs, mongo::Document& rhs) { lhs.swap(rhs); }",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 401,
          "old_api": "FieldIterator",
          "new_api": null,
          "old_text": "FieldIterator(*this)",
          "new_text": null,
          "old_line_content": "        return FieldIterator(*this);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 405,
          "old_api": "getField",
          "new_api": null,
          "old_text": "MutableDocument(*this).getField(pos)",
          "new_text": null,
          "old_line_content": "        return MutableDocument(*this).getField(pos);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 302,
          "old_api": "reset",
          "new_api": null,
          "old_text": "reset(NULL)",
          "new_text": null,
          "old_line_content": "            reset(NULL);",
          "new_line_content": "            Document ret;",
          "content_same": false
        },
        {
          "line": 313,
          "old_api": "storagePtr",
          "new_api": null,
          "old_text": "storagePtr()",
          "new_text": null,
          "old_line_content": "            return Document(storagePtr());",
          "new_line_content": "         *  future changes to this MutableDocument.",
          "content_same": false
        },
        {
          "line": 318,
          "old_api": "explicit",
          "new_api": null,
          "old_text": "explicit",
          "new_text": null,
          "old_line_content": "        explicit MutableDocument(MutableValue mv)",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 320,
          "old_api": "getDocPtr",
          "new_api": null,
          "old_text": "mv.getDocPtr()",
          "new_text": null,
          "old_line_content": "            , _storage(mv.getDocPtr())",
          "new_line_content": "        friend class MutableValue; // for access to next constructor",
          "content_same": false
        },
        {
          "line": 324,
          "old_api": "intrusive_ptr_release",
          "new_api": null,
          "old_text": "intrusive_ptr_release(_storage)",
          "new_text": null,
          "old_line_content": "            if (_storage) intrusive_ptr_release(_storage);",
          "new_line_content": "        {}",
          "content_same": false
        },
        {
          "line": 326,
          "old_api": "intrusive_ptr_add_ref",
          "new_api": null,
          "old_text": "intrusive_ptr_add_ref(_storage)",
          "new_text": null,
          "old_line_content": "            if (_storage) intrusive_ptr_add_ref(_storage);",
          "new_line_content": "        void reset(const DocumentStorage* ds) {",
          "content_same": false
        },
        {
          "line": 331,
          "old_api": "MONGO_unlikely",
          "new_api": null,
          "old_text": "MONGO_unlikely( !_storage )",
          "new_text": null,
          "old_line_content": "            if (MONGO_unlikely( !_storage ))",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 332,
          "old_api": "newStorage",
          "new_api": null,
          "old_text": "newStorage()",
          "new_text": null,
          "old_line_content": "                return newStorage();",
          "new_line_content": "        // This is split into 3 functions to speed up the fast-path",
          "content_same": false
        },
        {
          "line": 342,
          "old_api": "storagePtr",
          "new_api": null,
          "old_text": "storagePtr()",
          "new_text": null,
          "old_line_content": "            return const_cast<DocumentStorage&>(*storagePtr());",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 346,
          "old_api": "storagePtr",
          "new_api": null,
          "old_text": "storagePtr()",
          "new_text": null,
          "old_line_content": "            return const_cast<DocumentStorage&>(*storagePtr());",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 355,
          "old_api": "typeid",
          "new_api": null,
          "old_text": "typeid(const DocumentStorage)",
          "new_text": null,
          "old_line_content": "            dassert(!_storage || typeid(*_storage) == typeid(const DocumentStorage));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 356,
          "old_api": "static_cast<const DocumentStorage*>(_storage)",
          "new_api": null,
          "old_text": "static_cast<const DocumentStorage*>(_storage)",
          "new_text": null,
          "old_line_content": "            return static_cast<const DocumentStorage*>(_storage);",
          "new_line_content": "        // this should only be called by storage methods and peek/freeze",
          "content_same": false
        },
        {
          "line": 368,
          "old_api": "explicit",
          "new_api": null,
          "old_text": "explicit",
          "new_text": null,
          "old_line_content": "        explicit FieldIterator(const Document& doc)",
          "new_line_content": "    /// This is the public iterator over a document",
          "content_same": false
        },
        {
          "line": 370,
          "old_api": "storage",
          "new_api": null,
          "old_text": "_doc.storage().iterator()",
          "new_text": null,
          "old_line_content": "            , _it(_doc.storage().iterator())",
          "new_line_content": "    public:",
          "content_same": false
        },
        {
          "line": 374,
          "old_api": "atEnd",
          "new_api": null,
          "old_text": "_it.atEnd()",
          "new_text": null,
          "old_line_content": "        bool more() const { return !_it.atEnd(); }",
          "new_line_content": "        {}",
          "content_same": false
        },
        {
          "line": 378,
          "old_api": "more",
          "new_api": null,
          "old_text": "more()",
          "new_text": null,
          "old_line_content": "            verify(more());",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 380,
          "old_api": "nameSD",
          "new_api": null,
          "old_text": "_it->nameSD()",
          "new_text": null,
          "old_line_content": "            Document::FieldPair fp (_it->nameSD(), _it->val);",
          "new_line_content": "        Document::FieldPair next() {",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 6,
      "total_additions": 20,
      "total_deletions": 20,
      "total_api_changes": 46
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 5,
        "api_related_lines": 46,
        "non_api_lines": 3,
        "non_api_line_numbers": [
          305,
          301,
          303
        ]
      }
    },
    "api_calls_before": 96,
    "api_calls_after": 96,
    "diff_info": {
      "added_lines": 5,
      "removed_lines": 2,
      "total_diff_lines": 19
    }
  }
}