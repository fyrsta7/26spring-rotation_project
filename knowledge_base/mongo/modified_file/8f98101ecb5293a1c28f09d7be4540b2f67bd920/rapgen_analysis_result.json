{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mongo/modified_file/8f98101ecb5293a1c28f09d7be4540b2f67bd920",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mongo/modified_file/8f98101ecb5293a1c28f09d7be4540b2f67bd920/before.h",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mongo/modified_file/8f98101ecb5293a1c28f09d7be4540b2f67bd920/after.h",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mongo/modified_file/8f98101ecb5293a1c28f09d7be4540b2f67bd920/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 50,
          "old_api": "size",
          "new_api": "strstr",
          "old_text": "s.size()",
          "new_text": "strstr(buf, \"$extr\")",
          "old_line_content": "        massert( 10348 , \"$extra: ns name too long\", s.size() < MaxNsLen);",
          "new_line_content": "        const char *p = strstr(buf, \"$extr\");",
          "content_same": false
        },
        {
          "line": 84,
          "old_api": "MsgAssertionException",
          "new_api": "next",
          "old_text": "MsgAssertionException( 13283 , \"Missing Extra\" )",
          "new_text": "e->next(this)",
          "old_line_content": "                throw MsgAssertionException( 13283 , \"Missing Extra\" );",
          "new_line_content": "            e = e->next(this);",
          "content_same": false
        },
        {
          "line": 101,
          "old_api": "ii",
          "new_api": "massert",
          "old_text": "ii()",
          "new_text": "massert( 10349 , \"E12000 idxNo fails\", false)",
          "old_line_content": "        IndexIterator i = ii();",
          "new_line_content": "        massert( 10349 , \"E12000 idxNo fails\", false);",
          "content_same": false
        },
        {
          "line": 106,
          "old_api": "massert",
          "new_api": "ii",
          "old_text": "massert( 10349 , \"E12000 idxNo fails\", false)",
          "new_text": "ii()",
          "old_line_content": "        massert( 10349 , \"E12000 idxNo fails\", false);",
          "new_line_content": "        IndexIterator i = ii();",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 34,
          "old_api": null,
          "new_api": "strlen",
          "old_text": null,
          "new_text": "strlen(ns)",
          "old_line_content": "        int i = 0;",
          "new_line_content": "        unsigned len = strlen(ns);",
          "content_same": false
        },
        {
          "line": 35,
          "old_api": null,
          "new_api": "uassert",
          "old_text": null,
          "new_text": "uassert( 10080 , \"ns name too long, max size is 128\", len < MaxNsLen)",
          "old_line_content": "        while( ns[i] ) {",
          "new_line_content": "        uassert( 10080 , \"ns name too long, max size is 128\", len < MaxNsLen);",
          "content_same": false
        },
        {
          "line": 36,
          "old_api": null,
          "new_api": "memset",
          "old_text": null,
          "new_text": "memset(buf, 0, MaxNsLen)",
          "old_line_content": "            buf[i] = ns[i];",
          "new_line_content": "        memset(buf, 0, MaxNsLen);",
          "content_same": false
        },
        {
          "line": 37,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(buf, ns, len)",
          "old_line_content": "            if( ++i >= MaxNsLen-1 )",
          "new_line_content": "        memcpy(buf, ns, len);",
          "content_same": false
        },
        {
          "line": 44,
          "old_api": null,
          "new_api": "string",
          "old_text": null,
          "new_text": "string(buf)",
          "old_line_content": "    }",
          "new_line_content": "        string s = string(buf) + ex;",
          "content_same": false
        },
        {
          "line": 45,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "s.size()",
          "old_line_content": "",
          "new_line_content": "        massert( 10348 , \"$extra: ns name too long\", s.size() < MaxNsLen);",
          "content_same": false
        },
        {
          "line": 66,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert( local && local[0] != '.' )",
          "old_line_content": "        return (x & 0x7fffffff) | 0x8000000; // must be > 0",
          "new_line_content": "        assert( local && local[0] != '.' );",
          "content_same": false
        },
        {
          "line": 68,
          "old_api": null,
          "new_api": "find",
          "old_text": null,
          "new_text": "old.find( \".\" )",
          "old_line_content": "",
          "new_line_content": "        if ( old.find( \".\" ) != string::npos )",
          "content_same": false
        },
        {
          "line": 69,
          "old_api": null,
          "new_api": "find",
          "old_text": null,
          "new_text": "old.find( \".\" )",
          "old_line_content": "    /* future : this doesn't need to be an inline. */",
          "new_line_content": "            old = old.substr( 0 , old.find( \".\" ) );",
          "content_same": false
        },
        {
          "line": 76,
          "old_api": null,
          "new_api": "extra",
          "old_text": null,
          "new_text": "extra()",
          "old_line_content": "    }",
          "new_line_content": "        Extra *e = extra();",
          "content_same": false
        },
        {
          "line": 79,
          "old_api": null,
          "new_api": "MsgAssertionException",
          "old_text": null,
          "new_text": "MsgAssertionException( 13283 , \"Missing Extra\" )",
          "old_line_content": "        if( idxNo < NIndexesBase ) ",
          "new_line_content": "                throw MsgAssertionException( 13283 , \"Missing Extra\" );",
          "content_same": false
        },
        {
          "line": 80,
          "old_api": null,
          "new_api": "massert",
          "old_text": null,
          "new_text": "massert(13282, \"missing Extra\", e)",
          "old_line_content": "            return _indexes[idxNo];",
          "new_line_content": "            massert(13282, \"missing Extra\", e);",
          "content_same": false
        },
        {
          "line": 87,
          "old_api": null,
          "new_api": "MsgAssertionException",
          "old_text": null,
          "new_text": "MsgAssertionException( 13283 , \"missing extra\" )",
          "old_line_content": "        int i = idxNo - NIndexesBase;",
          "new_line_content": "                    throw MsgAssertionException( 13283 , \"missing extra\" );",
          "content_same": false
        },
        {
          "line": 88,
          "old_api": null,
          "new_api": "massert",
          "old_text": null,
          "new_text": "massert(13283, \"missing Extra\", e)",
          "old_line_content": "        if( i >= NIndexesExtra ) {",
          "new_line_content": "                massert(13283, \"missing Extra\", e);",
          "content_same": false
        },
        {
          "line": 96,
          "old_api": null,
          "new_api": "ii",
          "old_text": null,
          "new_text": "ii()",
          "old_line_content": "        }",
          "new_line_content": "        IndexIterator i = ii();",
          "content_same": false
        },
        {
          "line": 97,
          "old_api": null,
          "new_api": "more",
          "old_text": null,
          "new_text": "i.more()",
          "old_line_content": "        return e->details[i];",
          "new_line_content": "        while( i.more() ) {",
          "content_same": false
        },
        {
          "line": 98,
          "old_api": null,
          "new_api": "next",
          "old_text": null,
          "new_text": "i.next()",
          "old_line_content": "    }",
          "new_line_content": "            if( &i.next() == &idx )",
          "content_same": false
        },
        {
          "line": 99,
          "old_api": null,
          "new_api": "pos",
          "old_text": null,
          "new_text": "i.pos()",
          "old_line_content": "",
          "new_line_content": "                return i.pos()-1;",
          "content_same": false
        },
        {
          "line": 107,
          "old_api": null,
          "new_api": "more",
          "old_text": null,
          "new_text": "i.more()",
          "old_line_content": "        return -1;",
          "new_line_content": "        while( i.more() ) {",
          "content_same": false
        },
        {
          "line": 108,
          "old_api": null,
          "new_api": "next",
          "old_text": null,
          "new_text": "i.next().keyPattern()",
          "old_line_content": "    }",
          "new_line_content": "            if( i.next().keyPattern() == keyPattern ) ",
          "content_same": false
        },
        {
          "line": 109,
          "old_api": null,
          "new_api": "pos",
          "old_text": null,
          "new_text": "i.pos()",
          "old_line_content": "",
          "new_line_content": "                return i.pos()-1;",
          "content_same": false
        },
        {
          "line": 116,
          "old_api": null,
          "new_api": "ii",
          "old_text": null,
          "new_text": "ii()",
          "old_line_content": "        return -1;",
          "new_line_content": "        IndexIterator i = ii();",
          "content_same": false
        },
        {
          "line": 117,
          "old_api": null,
          "new_api": "more",
          "old_text": null,
          "new_text": "i.more()",
          "old_line_content": "    }",
          "new_line_content": "        while( i.more() ) {",
          "content_same": false
        },
        {
          "line": 118,
          "old_api": null,
          "new_api": "next",
          "old_text": null,
          "new_text": "i.next().info.obj().getStringField(\"name\")",
          "old_line_content": "",
          "new_line_content": "            if ( strcmp(i.next().info.obj().getStringField(\"name\"),name) == 0 )",
          "content_same": false
        },
        {
          "line": 119,
          "old_api": null,
          "new_api": "pos",
          "old_text": null,
          "new_text": "i.pos()",
          "old_line_content": "    // @return offset in indexes[]",
          "new_line_content": "                return i.pos()-1;",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 38,
          "old_api": "uasserted",
          "new_api": null,
          "old_text": "uasserted( 10080 , \"ns name too long, max size is 128\" )",
          "new_text": null,
          "old_line_content": "                uasserted( 10080 , \"ns name too long, max size is 128\" );",
          "new_line_content": "        return *this;",
          "content_same": false
        },
        {
          "line": 49,
          "old_api": "string",
          "new_api": null,
          "old_text": "string(buf)",
          "new_text": null,
          "old_line_content": "        string s = string(buf) + ex;",
          "new_line_content": "    inline bool Namespace::isExtra() const { ",
          "content_same": false
        },
        {
          "line": 55,
          "old_api": "strstr",
          "new_api": null,
          "old_text": "strstr(buf, \"$extr\")",
          "new_text": null,
          "old_line_content": "        const char *p = strstr(buf, \"$extr\");",
          "new_line_content": "        unsigned x = 0;",
          "content_same": false
        },
        {
          "line": 71,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert( local && local[0] != '.' )",
          "new_text": null,
          "old_line_content": "        assert( local && local[0] != '.' );",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 73,
          "old_api": "find",
          "new_api": null,
          "old_text": "old.find( \".\" )",
          "new_text": null,
          "old_line_content": "        if ( old.find( \".\" ) != string::npos )",
          "new_line_content": "    inline IndexDetails& NamespaceDetails::idx(int idxNo, bool missingExpected ) {",
          "content_same": false
        },
        {
          "line": 74,
          "old_api": "find",
          "new_api": null,
          "old_text": "old.find( \".\" )",
          "new_text": null,
          "old_line_content": "            old = old.substr( 0 , old.find( \".\" ) );",
          "new_line_content": "        if( idxNo < NIndexesBase ) ",
          "content_same": false
        },
        {
          "line": 81,
          "old_api": "extra",
          "new_api": null,
          "old_text": "extra()",
          "new_text": null,
          "old_line_content": "        Extra *e = extra();",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 85,
          "old_api": "massert",
          "new_api": null,
          "old_text": "massert(13282, \"missing Extra\", e)",
          "new_text": null,
          "old_line_content": "            massert(13282, \"missing Extra\", e);",
          "new_line_content": "            if ( ! e ){",
          "content_same": false
        },
        {
          "line": 89,
          "old_api": "next",
          "new_api": null,
          "old_text": "e->next(this)",
          "new_text": null,
          "old_line_content": "            e = e->next(this);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 92,
          "old_api": "MsgAssertionException",
          "new_api": null,
          "old_text": "MsgAssertionException( 13283 , \"missing extra\" )",
          "new_text": null,
          "old_line_content": "                    throw MsgAssertionException( 13283 , \"missing extra\" );",
          "new_line_content": "        return e->details[i];",
          "content_same": false
        },
        {
          "line": 93,
          "old_api": "massert",
          "new_api": null,
          "old_text": "massert(13283, \"missing Extra\", e)",
          "new_text": null,
          "old_line_content": "                massert(13283, \"missing Extra\", e);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 102,
          "old_api": "more",
          "new_api": null,
          "old_text": "i.more()",
          "new_text": null,
          "old_line_content": "        while( i.more() ) {",
          "new_line_content": "        return -1;",
          "content_same": false
        },
        {
          "line": 103,
          "old_api": "next",
          "new_api": null,
          "old_text": "i.next()",
          "new_text": null,
          "old_line_content": "            if( &i.next() == &idx )",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 104,
          "old_api": "pos",
          "new_api": null,
          "old_text": "i.pos()",
          "new_text": null,
          "old_line_content": "                return i.pos()-1;",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 111,
          "old_api": "ii",
          "new_api": null,
          "old_text": "ii()",
          "new_text": null,
          "old_line_content": "        IndexIterator i = ii();",
          "new_line_content": "        return -1;",
          "content_same": false
        },
        {
          "line": 112,
          "old_api": "more",
          "new_api": null,
          "old_text": "i.more()",
          "new_text": null,
          "old_line_content": "        while( i.more() ) {",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 113,
          "old_api": "next",
          "new_api": null,
          "old_text": "i.next().keyPattern()",
          "new_text": null,
          "old_line_content": "            if( i.next().keyPattern() == keyPattern ) ",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 114,
          "old_api": "pos",
          "new_api": null,
          "old_text": "i.pos()",
          "new_text": null,
          "old_line_content": "                return i.pos()-1;",
          "new_line_content": "    // @return offset in indexes[]",
          "content_same": false
        },
        {
          "line": 121,
          "old_api": "ii",
          "new_api": null,
          "old_text": "ii()",
          "new_text": null,
          "old_line_content": "        IndexIterator i = ii();",
          "new_line_content": "        return -1;",
          "content_same": false
        },
        {
          "line": 122,
          "old_api": "more",
          "new_api": null,
          "old_text": "i.more()",
          "new_text": null,
          "old_line_content": "        while( i.more() ) {",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 123,
          "old_api": "next",
          "new_api": null,
          "old_text": "i.next().info.obj().getStringField(\"name\")",
          "new_text": null,
          "old_line_content": "            if ( strcmp(i.next().info.obj().getStringField(\"name\"),name) == 0 )",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 124,
          "old_api": "pos",
          "new_api": null,
          "old_text": "i.pos()",
          "new_text": null,
          "old_line_content": "                return i.pos()-1;",
          "new_line_content": "    inline NamespaceDetails::IndexIterator::IndexIterator(NamespaceDetails *_d) { ",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 4,
      "total_additions": 25,
      "total_deletions": 22,
      "total_api_changes": 51
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 9,
        "api_related_lines": 51,
        "non_api_lines": 4,
        "non_api_line_numbers": [
          40,
          41,
          42,
          39
        ]
      }
    },
    "api_calls_before": 32,
    "api_calls_after": 35,
    "diff_info": {
      "added_lines": 4,
      "removed_lines": 9,
      "total_diff_lines": 25
    }
  }
}