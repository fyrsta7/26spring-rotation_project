{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mongo/modified_file/cb82efb115f2bca1cc5d7274d1f7e67b2326846e",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mongo/modified_file/cb82efb115f2bca1cc5d7274d1f7e67b2326846e/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mongo/modified_file/cb82efb115f2bca1cc5d7274d1f7e67b2326846e/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mongo/modified_file/cb82efb115f2bca1cc5d7274d1f7e67b2326846e/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 399,
          "old_api": "boost::hash_combine(idHash, hash)",
          "new_api": "MurmurHash3_x86_32",
          "old_text": "boost::hash_combine(idHash, hash)",
          "new_text": "MurmurHash3_x86_32(&idHash, sizeof(idHash), hash, &hash)",
          "old_line_content": "                boost::hash_combine(idHash, hash);",
          "new_line_content": "                MurmurHash3_x86_32(&idHash, sizeof(idHash), hash, &hash);",
          "content_same": false
        },
        {
          "line": 423,
          "old_api": "back",
          "new_api": "_opTime",
          "old_text": "ops.back()",
          "new_text": "currentOp[\"ts\"]._opTime()",
          "old_line_content": "                const BSONObj currentOp = ops.back();",
          "new_line_content": "                const OpTime currentOpTime = currentOp[\"ts\"]._opTime();",
          "content_same": false
        },
        {
          "line": 443,
          "old_api": "empty",
          "new_api": "severe",
          "old_text": "ops.empty()",
          "new_text": "severe()",
          "old_line_content": "            if (ops.empty()) {",
          "new_line_content": "                severe() << \"got no ops for batch...\";",
          "content_same": false
        },
        {
          "line": 444,
          "old_api": "severe",
          "new_api": "fassertFailedNoTrace",
          "old_text": "severe()",
          "new_text": "fassertFailedNoTrace(18692)",
          "old_line_content": "                severe() << \"got no ops for batch...\";",
          "new_line_content": "                fassertFailedNoTrace(18692);",
          "content_same": false
        },
        {
          "line": 451,
          "old_api": "getSize",
          "new_api": "getDeque",
          "old_text": "ops.getSize()",
          "new_text": "ops.getDeque().size()",
          "old_line_content": "            bytesApplied += ops.getSize();",
          "new_line_content": "            entriesApplied += ops.getDeque().size();",
          "content_same": false
        },
        {
          "line": 476,
          "old_api": "getCurrentMemberState",
          "new_api": "recovering",
          "old_text": "replCoord->getCurrentMemberState()",
          "new_text": "state.recovering()",
          "old_line_content": "        MemberState state(replCoord->getCurrentMemberState());",
          "new_line_content": "        if (!state.recovering()) {",
          "content_same": false
        },
        {
          "line": 481,
          "old_api": "getMinValid",
          "new_api": "getMyLastOptime",
          "old_text": "getMinValid(txn)",
          "new_text": "replCoord->getMyLastOptime()",
          "old_line_content": "        OpTime minvalid = getMinValid(txn);",
          "new_line_content": "        if (minvalid > replCoord->getMyLastOptime()) {",
          "content_same": false
        },
        {
          "line": 488,
          "old_api": "MemberState",
          "new_api": "getCurrentMemberState",
          "old_text": "MemberState(MemberState::RS_SECONDARY)",
          "new_text": "replCoord->getCurrentMemberState()",
          "old_line_content": "            warning() << \"Failed to transition into \" << MemberState(MemberState::RS_SECONDARY)",
          "new_line_content": "                      << \". Current state: \" << replCoord->getCurrentMemberState();",
          "content_same": false
        },
        {
          "line": 518,
          "old_api": "empty",
          "new_api": "BackgroundSync::get()",
          "old_text": "ops.empty()",
          "new_text": "BackgroundSync::get()",
          "old_line_content": "                if (ops.empty() || now > lastTimeChecked) {",
          "new_line_content": "                    BackgroundSync* bgsync = BackgroundSync::get();",
          "content_same": false
        },
        {
          "line": 519,
          "old_api": "BackgroundSync::get()",
          "new_api": "getInitialSyncRequestedFlag",
          "old_text": "BackgroundSync::get()",
          "new_text": "bgsync->getInitialSyncRequestedFlag()",
          "old_line_content": "                    BackgroundSync* bgsync = BackgroundSync::get();",
          "new_line_content": "                    if (bgsync->getInitialSyncRequestedFlag()) {",
          "content_same": false
        },
        {
          "line": 535,
          "old_api": "OpTime",
          "new_api": "stop",
          "old_text": "OpTime()",
          "new_text": "bgsync->stop()",
          "old_line_content": "                        replCoord->setMyLastOptime(&txn, OpTime());",
          "new_line_content": "                        bgsync->stop();",
          "content_same": false
        },
        {
          "line": 536,
          "old_api": "stop",
          "new_api": "clearSyncSourceBlacklist",
          "old_text": "bgsync->stop()",
          "new_text": "replCoord->clearSyncSourceBlacklist()",
          "old_line_content": "                        bgsync->stop();",
          "new_line_content": "                        replCoord->clearSyncSourceBlacklist();",
          "content_same": false
        },
        {
          "line": 556,
          "old_api": "size",
          "new_api": "potentiallyHot",
          "old_text": "theReplSet->config().members.size()",
          "new_text": "theReplSet->myConfig().potentiallyHot()",
          "old_line_content": "                            theReplSet->config().members.size() == 1 &&",
          "new_line_content": "                            theReplSet->myConfig().potentiallyHot()) {",
          "content_same": false
        },
        {
          "line": 562,
          "old_api": "stdx::bind(&Manager::msgCheckNewState, theReplSet->mgr)",
          "new_api": "sleepsecs",
          "old_text": "stdx::bind(&Manager::msgCheckNewState, theReplSet->mgr)",
          "new_text": "sleepsecs(1)",
          "old_line_content": "                            mgr->send(stdx::bind(&Manager::msgCheckNewState, theReplSet->mgr));",
          "new_line_content": "                            sleepsecs(1);",
          "content_same": false
        },
        {
          "line": 570,
          "old_api": "total_seconds",
          "new_api": "empty",
          "old_text": "replCoord->getSlaveDelaySecs().total_seconds()",
          "new_text": "ops.empty()",
          "old_line_content": "                const int slaveDelaySecs = replCoord->getSlaveDelaySecs().total_seconds();",
          "new_line_content": "                if (!ops.empty() && slaveDelaySecs > 0) {",
          "content_same": false
        },
        {
          "line": 571,
          "old_api": "empty",
          "new_api": "getDeque",
          "old_text": "ops.empty()",
          "new_text": "ops.getDeque().back()",
          "old_line_content": "                if (!ops.empty() && slaveDelaySecs > 0) {",
          "new_line_content": "                    const BSONObj& lastOp = ops.getDeque().back();",
          "content_same": false
        },
        {
          "line": 572,
          "old_api": "getDeque",
          "new_api": "_opTime",
          "old_text": "ops.getDeque().back()",
          "new_text": "lastOp[\"ts\"]._opTime().getSecs()",
          "old_line_content": "                    const BSONObj& lastOp = ops.getDeque().back();",
          "new_line_content": "                    const unsigned int opTimestampSecs = lastOp[\"ts\"]._opTime().getSecs();",
          "content_same": false
        },
        {
          "line": 586,
          "old_api": "getSize",
          "new_api": "inShutdown",
          "old_text": "ops.getSize()",
          "new_text": "inShutdown()",
          "old_line_content": "                   (ops.getSize() < replBatchLimitBytes) &&",
          "new_line_content": "                   !inShutdown());",
          "content_same": false
        },
        {
          "line": 590,
          "old_api": "MONGO_FAIL_POINT",
          "new_api": "sleepmillis",
          "old_text": "MONGO_FAIL_POINT(rsSyncApplyStop)",
          "new_text": "sleepmillis(0)",
          "old_line_content": "            while (MONGO_FAIL_POINT(rsSyncApplyStop)) {",
          "new_line_content": "                sleepmillis(0);",
          "content_same": false
        },
        {
          "line": 598,
          "old_api": "getDeque",
          "new_api": "handleSlaveDelay",
          "old_text": "ops.getDeque().back()",
          "new_text": "handleSlaveDelay(lastOp)",
          "old_line_content": "            const BSONObj& lastOp = ops.getDeque().back();",
          "new_line_content": "            handleSlaveDelay(lastOp);",
          "content_same": false
        },
        {
          "line": 604,
          "old_api": "_opTime",
          "new_api": "setMinValid",
          "old_text": "lastOp[\"ts\"]._opTime()",
          "new_text": "setMinValid(&txn, minValid)",
          "old_line_content": "            OpTime minValid = lastOp[\"ts\"]._opTime();",
          "new_line_content": "            setMinValid(&txn, minValid);",
          "content_same": false
        },
        {
          "line": 635,
          "old_api": "empty",
          "new_api": "signalDrainComplete",
          "old_text": "ops->empty()",
          "new_text": "replCoord->signalDrainComplete()",
          "old_line_content": "            if (ops->empty()) {",
          "new_line_content": "                replCoord->signalDrainComplete();",
          "content_same": false
        },
        {
          "line": 656,
          "old_api": "push_back",
          "new_api": "consume",
          "old_text": "ops->push_back(op)",
          "new_text": "_networkQueue->consume()",
          "old_line_content": "                ops->push_back(op);",
          "new_line_content": "                _networkQueue->consume();",
          "content_same": false
        },
        {
          "line": 680,
          "old_api": "push_back",
          "new_api": "consume",
          "old_text": "ops->push_back(op)",
          "new_text": "_networkQueue->consume()",
          "old_line_content": "        ops->push_back(op);",
          "new_line_content": "        _networkQueue->consume();",
          "content_same": false
        },
        {
          "line": 694,
          "old_api": "empty",
          "new_api": "front",
          "old_text": "ops->empty()",
          "new_text": "ops->front()",
          "old_line_content": "            while (!ops->empty()) {",
          "new_line_content": "                const BSONObj& op = ops->front();",
          "content_same": false
        },
        {
          "line": 697,
          "old_api": "_logOpObjRS",
          "new_api": "pop_front",
          "old_text": "_logOpObjRS(&txn, op)",
          "new_text": "ops->pop_front()",
          "old_line_content": "                lastOpTime = _logOpObjRS(&txn, op);",
          "new_line_content": "                ops->pop_front();",
          "content_same": false
        },
        {
          "line": 709,
          "old_api": "getGlobalReplicationCoordinator",
          "new_api": "total_seconds",
          "old_text": "getGlobalReplicationCoordinator()",
          "new_text": "replCoord->getSlaveDelaySecs().total_seconds()",
          "old_line_content": "        ReplicationCoordinator* replCoord = getGlobalReplicationCoordinator();",
          "new_line_content": "        int slaveDelaySecs = replCoord->getSlaveDelaySecs().total_seconds();",
          "content_same": false
        },
        {
          "line": 714,
          "old_api": "secondary",
          "new_api": "_opTime",
          "old_text": "replCoord->getCurrentMemberState().secondary()",
          "new_text": "lastOp[\"ts\"]._opTime()",
          "old_line_content": "        if( slaveDelaySecs > 0 && replCoord->getCurrentMemberState().secondary() ) {",
          "new_line_content": "            const OpTime ts = lastOp[\"ts\"]._opTime();",
          "content_same": false
        },
        {
          "line": 715,
          "old_api": "_opTime",
          "new_api": "getSecs",
          "old_text": "lastOp[\"ts\"]._opTime()",
          "new_text": "ts.getSecs()",
          "old_line_content": "            const OpTime ts = lastOp[\"ts\"]._opTime();",
          "new_line_content": "            long long a = ts.getSecs();",
          "content_same": false
        },
        {
          "line": 716,
          "old_api": "getSecs",
          "new_api": "time",
          "old_text": "ts.getSecs()",
          "new_text": "time(0)",
          "old_line_content": "            long long a = ts.getSecs();",
          "new_line_content": "            long long b = time(0);",
          "content_same": false
        },
        {
          "line": 731,
          "old_api": "time",
          "new_api": "sleepsecs",
          "old_text": "time(0)",
          "new_text": "sleepsecs(6)",
          "old_line_content": "                    while(time(0) < waitUntil) {",
          "new_line_content": "                        sleepsecs(6);",
          "content_same": false
        },
        {
          "line": 747,
          "old_api": "ClientBasic::getCurrent()",
          "new_api": "Client::initThreadIfNotAlready()",
          "old_text": "ClientBasic::getCurrent()",
          "new_text": "Client::initThreadIfNotAlready()",
          "old_line_content": "        if (!ClientBasic::getCurrent()) {",
          "new_line_content": "            Client::initThreadIfNotAlready();",
          "content_same": false
        },
        {
          "line": 748,
          "old_api": "Client::initThreadIfNotAlready()",
          "new_api": "replLocalAuth",
          "old_text": "Client::initThreadIfNotAlready()",
          "new_text": "replLocalAuth()",
          "old_line_content": "            Client::initThreadIfNotAlready();",
          "new_line_content": "            replLocalAuth();",
          "content_same": false
        },
        {
          "line": 764,
          "old_api": "begin",
          "new_api": "end",
          "old_text": "ops.begin()",
          "new_text": "ops.end()",
          "old_line_content": "        for (std::vector<BSONObj>::const_iterator it = ops.begin();",
          "new_line_content": "             it != ops.end();",
          "content_same": false
        },
        {
          "line": 768,
          "old_api": "syncApply",
          "new_api": "fassertFailedNoTrace",
          "old_text": "st->syncApply(&txn, *it, convertUpdatesToUpserts)",
          "new_text": "fassertFailedNoTrace(16359)",
          "old_line_content": "                if (!st->syncApply(&txn, *it, convertUpdatesToUpserts)) {",
          "new_line_content": "                    fassertFailedNoTrace(16359);",
          "content_same": false
        },
        {
          "line": 772,
          "old_api": "causedBy",
          "new_api": "toString",
          "old_text": "causedBy(e)",
          "new_text": "it->toString()",
          "old_line_content": "                error() << \"writer worker caught exception: \" << causedBy(e)",
          "new_line_content": "                        << \" on: \" << it->toString() << endl;",
          "content_same": false
        },
        {
          "line": 773,
          "old_api": "toString",
          "new_api": "fassertFailedNoTrace",
          "old_text": "it->toString()",
          "new_text": "fassertFailedNoTrace(16360)",
          "old_line_content": "                        << \" on: \" << it->toString() << endl;",
          "new_line_content": "                fassertFailedNoTrace(16360);",
          "content_same": false
        },
        {
          "line": 788,
          "old_api": "begin",
          "new_api": "end",
          "old_text": "ops.begin()",
          "new_text": "ops.end()",
          "old_line_content": "        for (std::vector<BSONObj>::const_iterator it = ops.begin();",
          "new_line_content": "             it != ops.end();",
          "content_same": false
        },
        {
          "line": 795,
          "old_api": "lockState",
          "new_api": "shouldRetry",
          "old_text": "txn.lockState()",
          "new_text": "st->shouldRetry(&txn, *it)",
          "old_line_content": "                        Lock::GlobalWrite lk(txn.lockState());",
          "new_line_content": "                        status = st->shouldRetry(&txn, *it);",
          "content_same": false
        },
        {
          "line": 801,
          "old_api": "syncApply",
          "new_api": "fassertFailedNoTrace",
          "old_text": "st->syncApply(&txn, *it)",
          "new_text": "fassertFailedNoTrace(15915)",
          "old_line_content": "                        if (!st->syncApply(&txn, *it)) {",
          "new_line_content": "                            fassertFailedNoTrace(15915);",
          "content_same": false
        },
        {
          "line": 811,
          "old_api": "toString",
          "new_api": "fassertFailedNoTrace",
          "old_text": "it->toString()",
          "new_text": "fassertFailedNoTrace(16361)",
          "old_line_content": "                error() << \"exception: \" << causedBy(e) << \" on: \" << it->toString() << endl;",
          "new_line_content": "                fassertFailedNoTrace(16361);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 517,
          "old_api": null,
          "new_api": "empty",
          "old_text": null,
          "new_text": "ops.empty()",
          "old_line_content": "                // ops is empty)",
          "new_line_content": "                if (ops.empty() || now > lastTimeChecked) {",
          "content_same": false
        },
        {
          "line": 521,
          "old_api": null,
          "new_api": "lockState",
          "old_text": null,
          "new_text": "txn.lockState()",
          "old_line_content": "                        // got a resync command",
          "new_line_content": "                        Lock::DBLock lk(txn.lockState(), \"local\", MODE_X);",
          "content_same": false
        },
        {
          "line": 525,
          "old_api": null,
          "new_api": "db",
          "old_text": null,
          "new_text": "ctx.db()->dropCollection(&txn, \"local.oplog.rs\")",
          "old_line_content": "",
          "new_line_content": "                        ctx.db()->dropCollection(&txn, \"local.oplog.rs\");",
          "content_same": false
        },
        {
          "line": 534,
          "old_api": null,
          "new_api": "OpTime",
          "old_text": null,
          "new_text": "OpTime()",
          "old_line_content": "                        // because the bgsync thread, while running, may update the blacklist.",
          "new_line_content": "                        replCoord->setMyLastOptime(&txn, OpTime());",
          "content_same": false
        },
        {
          "line": 538,
          "old_api": null,
          "new_api": "commit",
          "old_text": null,
          "new_text": "wunit.commit()",
          "old_line_content": "",
          "new_line_content": "                        wunit.commit();",
          "content_same": false
        },
        {
          "line": 546,
          "old_api": null,
          "new_api": "tryToGoLiveAsASecondary",
          "old_text": null,
          "new_text": "tryToGoLiveAsASecondary(&txn, replCoord)",
          "old_line_content": "                    // become primary",
          "new_line_content": "                    tryToGoLiveAsASecondary(&txn, replCoord);",
          "content_same": false
        },
        {
          "line": 555,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "theReplSet->config().members.size()",
          "old_line_content": "                    if (theReplSet &&",
          "new_line_content": "                            theReplSet->config().members.size() == 1 &&",
          "content_same": false
        },
        {
          "line": 561,
          "old_api": null,
          "new_api": "stdx::bind(&Manager::msgCheckNewState, theReplSet->mgr)",
          "old_text": null,
          "new_text": "stdx::bind(&Manager::msgCheckNewState, theReplSet->mgr)",
          "old_line_content": "                        if (mgr) { ",
          "new_line_content": "                            mgr->send(stdx::bind(&Manager::msgCheckNewState, theReplSet->mgr));",
          "content_same": false
        },
        {
          "line": 569,
          "old_api": null,
          "new_api": "total_seconds",
          "old_text": null,
          "new_text": "replCoord->getSlaveDelaySecs().total_seconds()",
          "old_line_content": "",
          "new_line_content": "                const int slaveDelaySecs = replCoord->getSlaveDelaySecs().total_seconds();",
          "content_same": false
        },
        {
          "line": 578,
          "old_api": null,
          "new_api": "time",
          "old_text": null,
          "new_text": "time(0)",
          "old_line_content": "                    // and apply ops much sooner than we like.",
          "new_line_content": "                    if (opTimestampSecs > static_cast<unsigned int>(time(0) - slaveDelaySecs)) {",
          "content_same": false
        },
        {
          "line": 583,
          "old_api": null,
          "new_api": "tryPopAndWaitForMore",
          "old_text": null,
          "new_text": "tryPopAndWaitForMore(&ops, replCoord)",
          "old_line_content": "                // keep fetching more ops as long as we haven't filled up a full batch yet",
          "new_line_content": "            } while (!tryPopAndWaitForMore(&ops, replCoord) && // tryPopAndWaitForMore returns true ",
          "content_same": false
        },
        {
          "line": 585,
          "old_api": null,
          "new_api": "getSize",
          "old_text": null,
          "new_text": "ops.getSize()",
          "old_line_content": "                                                               // when we need to end a batch early",
          "new_line_content": "                   (ops.getSize() < replBatchLimitBytes) &&",
          "content_same": false
        },
        {
          "line": 589,
          "old_api": null,
          "new_api": "MONGO_FAIL_POINT",
          "old_text": null,
          "new_text": "MONGO_FAIL_POINT(rsSyncApplyStop)",
          "old_line_content": "            // For pausing replication in tests",
          "new_line_content": "            while (MONGO_FAIL_POINT(rsSyncApplyStop)) {",
          "content_same": false
        },
        {
          "line": 593,
          "old_api": null,
          "new_api": "empty",
          "old_text": null,
          "new_text": "ops.empty()",
          "old_line_content": "",
          "new_line_content": "            if (ops.empty()) {",
          "content_same": false
        },
        {
          "line": 597,
          "old_api": null,
          "new_api": "getDeque",
          "old_text": null,
          "new_text": "ops.getDeque().back()",
          "old_line_content": "",
          "new_line_content": "            const BSONObj& lastOp = ops.getDeque().back();",
          "content_same": false
        },
        {
          "line": 603,
          "old_api": null,
          "new_api": "_opTime",
          "old_text": null,
          "new_text": "lastOp[\"ts\"]._opTime()",
          "old_line_content": "            // if we should crash and restart before updating the oplog",
          "new_line_content": "            OpTime minValid = lastOp[\"ts\"]._opTime();",
          "content_same": false
        },
        {
          "line": 606,
          "old_api": null,
          "new_api": "getDeque",
          "old_text": null,
          "new_text": "ops.getDeque()",
          "old_line_content": "",
          "new_line_content": "            multiApply(ops.getDeque());",
          "content_same": false
        },
        {
          "line": 613,
          "old_api": null,
          "new_api": "peek",
          "old_text": null,
          "new_text": "peek(&op)",
          "old_line_content": "                BSONObj op;",
          "new_line_content": "                if (!peek(&op)) {",
          "content_same": false
        },
        {
          "line": 630,
          "old_api": null,
          "new_api": "peek",
          "old_text": null,
          "new_text": "peek(&op)",
          "old_line_content": "        // Check to see if there are ops waiting in the bgsync queue",
          "new_line_content": "        bool peek_success = peek(&op);",
          "content_same": false
        },
        {
          "line": 634,
          "old_api": null,
          "new_api": "empty",
          "old_text": null,
          "new_text": "ops->empty()",
          "old_line_content": "            // if we don't have anything in the queue, wait a bit for something to appear",
          "new_line_content": "            if (ops->empty()) {",
          "content_same": false
        },
        {
          "line": 637,
          "old_api": null,
          "new_api": "waitForMore",
          "old_text": null,
          "new_text": "_networkQueue->waitForMore()",
          "old_line_content": "                // block up to 1 second",
          "new_line_content": "                _networkQueue->waitForMore();",
          "content_same": false
        },
        {
          "line": 645,
          "old_api": null,
          "new_api": "valuestrsafe",
          "old_text": null,
          "new_text": "op[\"ns\"].valuestrsafe()",
          "old_line_content": "",
          "new_line_content": "        const char* ns = op[\"ns\"].valuestrsafe();",
          "content_same": false
        },
        {
          "line": 648,
          "old_api": null,
          "new_api": "valuestrsafe",
          "old_text": null,
          "new_text": "op[\"op\"].valuestrsafe()",
          "old_line_content": "        // check for commands",
          "new_line_content": "        if ((op[\"op\"].valuestrsafe()[0] == 'c') ||",
          "content_same": false
        },
        {
          "line": 651,
          "old_api": null,
          "new_api": "nsToCollectionSubstring",
          "old_text": null,
          "new_text": "nsToCollectionSubstring(ns)",
          "old_line_content": "            // The following line is the same as what the insert code uses to detect an index build.",
          "new_line_content": "            ( *ns != '\\0' && nsToCollectionSubstring(ns) == \"system.indexes\" )) {",
          "content_same": false
        },
        {
          "line": 653,
          "old_api": null,
          "new_api": "empty",
          "old_text": null,
          "new_text": "ops->empty()",
          "old_line_content": "",
          "new_line_content": "            if (ops->empty()) {",
          "content_same": false
        },
        {
          "line": 655,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "ops->push_back(op)",
          "old_line_content": "                // apply commands one-at-a-time",
          "new_line_content": "                ops->push_back(op);",
          "content_same": false
        },
        {
          "line": 666,
          "old_api": null,
          "new_api": "eoo",
          "old_text": null,
          "new_text": "elemVersion.eoo()",
          "old_line_content": "        int curVersion = 0;",
          "new_line_content": "        if (elemVersion.eoo())",
          "content_same": false
        },
        {
          "line": 670,
          "old_api": null,
          "new_api": "Int",
          "old_text": null,
          "new_text": "elemVersion.Int()",
          "old_line_content": "        else",
          "new_line_content": "            curVersion = elemVersion.Int();",
          "content_same": false
        },
        {
          "line": 673,
          "old_api": null,
          "new_api": "severe",
          "old_text": null,
          "new_text": "severe()",
          "old_line_content": "        if (curVersion != OPLOG_VERSION) {",
          "new_line_content": "            severe() << \"expected oplog version \" << OPLOG_VERSION << \" but found version \" ",
          "content_same": false
        },
        {
          "line": 675,
          "old_api": null,
          "new_api": "fassertFailedNoTrace",
          "old_text": null,
          "new_text": "fassertFailedNoTrace(18820)",
          "old_line_content": "                     << curVersion << \" in oplog entry: \" << op;",
          "new_line_content": "            fassertFailedNoTrace(18820);",
          "content_same": false
        },
        {
          "line": 679,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "ops->push_back(op)",
          "old_line_content": "        // Copy the op to the deque and remove it from the bgsync queue.",
          "new_line_content": "        ops->push_back(op);",
          "content_same": false
        },
        {
          "line": 690,
          "old_api": null,
          "new_api": "lockState",
          "old_text": null,
          "new_text": "txn.lockState()",
          "old_line_content": "            OperationContextImpl txn; // XXX?",
          "new_line_content": "            Lock::DBLock lk(txn.lockState(), \"local\", MODE_X);",
          "content_same": false
        },
        {
          "line": 693,
          "old_api": null,
          "new_api": "empty",
          "old_text": null,
          "new_text": "ops->empty()",
          "old_line_content": "",
          "new_line_content": "            while (!ops->empty()) {",
          "content_same": false
        },
        {
          "line": 696,
          "old_api": null,
          "new_api": "_logOpObjRS",
          "old_text": null,
          "new_text": "_logOpObjRS(&txn, op)",
          "old_line_content": "                // this updates lastOpTimeApplied",
          "new_line_content": "                lastOpTime = _logOpObjRS(&txn, op);",
          "content_same": false
        },
        {
          "line": 699,
          "old_api": null,
          "new_api": "commit",
          "old_text": null,
          "new_text": "wunit.commit()",
          "old_line_content": "             }",
          "new_line_content": "            wunit.commit();",
          "content_same": false
        },
        {
          "line": 703,
          "old_api": null,
          "new_api": "notify",
          "old_text": null,
          "new_text": "BackgroundSync::get()->notify()",
          "old_line_content": "        // Update write concern on primary",
          "new_line_content": "        BackgroundSync::get()->notify();",
          "content_same": false
        },
        {
          "line": 708,
          "old_api": null,
          "new_api": "getGlobalReplicationCoordinator",
          "old_text": null,
          "new_text": "getGlobalReplicationCoordinator()",
          "old_line_content": "    void SyncTail::handleSlaveDelay(const BSONObj& lastOp) {",
          "new_line_content": "        ReplicationCoordinator* replCoord = getGlobalReplicationCoordinator();",
          "content_same": false
        },
        {
          "line": 713,
          "old_api": null,
          "new_api": "secondary",
          "old_text": null,
          "new_text": "replCoord->getCurrentMemberState().secondary()",
          "old_line_content": "        // it becomes secondary we can worry about it.",
          "new_line_content": "        if( slaveDelaySecs > 0 && replCoord->getCurrentMemberState().secondary() ) {",
          "content_same": false
        },
        {
          "line": 720,
          "old_api": null,
          "new_api": "uassert",
          "old_text": null,
          "new_text": "uassert(12000, \"rs slaveDelay differential too big check clocks and systems\",\n                        sleeptime < 0x40000000)",
          "old_line_content": "            if( sleeptime > 0 ) {",
          "new_line_content": "                uassert(12000, \"rs slaveDelay differential too big check clocks and systems\",",
          "content_same": false
        },
        {
          "line": 723,
          "old_api": null,
          "new_api": "sleepsecs",
          "old_text": null,
          "new_text": "sleepsecs((int) sleeptime)",
          "old_line_content": "                if( sleeptime < 60 ) {",
          "new_line_content": "                    sleepsecs((int) sleeptime);",
          "content_same": false
        },
        {
          "line": 726,
          "old_api": null,
          "new_api": "warning",
          "old_text": null,
          "new_text": "warning()",
          "old_line_content": "                else {",
          "new_line_content": "                    warning() << \"replSet slavedelay causing a long sleep of \" << sleeptime",
          "content_same": false
        },
        {
          "line": 730,
          "old_api": null,
          "new_api": "time",
          "old_text": null,
          "new_text": "time(0)",
          "old_line_content": "                    long long waitUntil = b + sleeptime;",
          "new_line_content": "                    while(time(0) < waitUntil) {",
          "content_same": false
        },
        {
          "line": 734,
          "old_api": null,
          "new_api": "total_seconds",
          "old_text": null,
          "new_text": "replCoord->getSlaveDelaySecs().total_seconds()",
          "old_line_content": "                        // Handle reconfigs that changed the slave delay",
          "new_line_content": "                        if (replCoord->getSlaveDelaySecs().total_seconds() != slaveDelaySecs)",
          "content_same": false
        },
        {
          "line": 746,
          "old_api": null,
          "new_api": "ClientBasic::getCurrent()",
          "old_text": null,
          "new_text": "ClientBasic::getCurrent()",
          "old_line_content": "        // Only do this once per thread",
          "new_line_content": "        if (!ClientBasic::getCurrent()) {",
          "content_same": false
        },
        {
          "line": 754,
          "old_api": null,
          "new_api": "initializeWriterThread",
          "old_text": null,
          "new_text": "initializeWriterThread()",
          "old_line_content": "    void multiSyncApply(const std::vector<BSONObj>& ops, SyncTail* st) {",
          "new_line_content": "        initializeWriterThread();",
          "content_same": false
        },
        {
          "line": 759,
          "old_api": null,
          "new_api": "lockState",
          "old_text": null,
          "new_text": "txn.lockState()",
          "old_line_content": "        // allow us to get through the magic barrier",
          "new_line_content": "        Lock::ParallelBatchWriterMode::iAmABatchParticipant(txn.lockState());",
          "content_same": false
        },
        {
          "line": 763,
          "old_api": null,
          "new_api": "begin",
          "old_text": null,
          "new_text": "ops.begin()",
          "old_line_content": "",
          "new_line_content": "        for (std::vector<BSONObj>::const_iterator it = ops.begin();",
          "content_same": false
        },
        {
          "line": 767,
          "old_api": null,
          "new_api": "syncApply",
          "old_text": null,
          "new_text": "st->syncApply(&txn, *it, convertUpdatesToUpserts)",
          "old_line_content": "            try {",
          "new_line_content": "                if (!st->syncApply(&txn, *it, convertUpdatesToUpserts)) {",
          "content_same": false
        },
        {
          "line": 771,
          "old_api": null,
          "new_api": "causedBy",
          "old_text": null,
          "new_text": "causedBy(e)",
          "old_line_content": "            } catch (const DBException& e) {",
          "new_line_content": "                error() << \"writer worker caught exception: \" << causedBy(e)",
          "content_same": false
        },
        {
          "line": 780,
          "old_api": null,
          "new_api": "initializeWriterThread",
          "old_text": null,
          "new_text": "initializeWriterThread()",
          "old_line_content": "    void multiInitialSyncApply(const std::vector<BSONObj>& ops, SyncTail* st) {",
          "new_line_content": "        initializeWriterThread();",
          "content_same": false
        },
        {
          "line": 785,
          "old_api": null,
          "new_api": "lockState",
          "old_text": null,
          "new_text": "txn.lockState()",
          "old_line_content": "        // allow us to get through the magic barrier",
          "new_line_content": "        Lock::ParallelBatchWriterMode::iAmABatchParticipant(txn.lockState());",
          "content_same": false
        },
        {
          "line": 787,
          "old_api": null,
          "new_api": "begin",
          "old_text": null,
          "new_text": "ops.begin()",
          "old_line_content": "",
          "new_line_content": "        for (std::vector<BSONObj>::const_iterator it = ops.begin();",
          "content_same": false
        },
        {
          "line": 791,
          "old_api": null,
          "new_api": "syncApply",
          "old_text": null,
          "new_text": "st->syncApply(&txn, *it)",
          "old_line_content": "            try {",
          "new_line_content": "                if (!st->syncApply(&txn, *it)) {",
          "content_same": false
        },
        {
          "line": 794,
          "old_api": null,
          "new_api": "lockState",
          "old_text": null,
          "new_text": "txn.lockState()",
          "old_line_content": "                    {",
          "new_line_content": "                        Lock::GlobalWrite lk(txn.lockState());",
          "content_same": false
        },
        {
          "line": 800,
          "old_api": null,
          "new_api": "syncApply",
          "old_text": null,
          "new_text": "st->syncApply(&txn, *it)",
          "old_line_content": "                        // retry",
          "new_line_content": "                        if (!st->syncApply(&txn, *it)) {",
          "content_same": false
        },
        {
          "line": 810,
          "old_api": null,
          "new_api": "toString",
          "old_text": null,
          "new_text": "it->toString()",
          "old_line_content": "            catch (const DBException& e) {",
          "new_line_content": "                error() << \"exception: \" << causedBy(e) << \" on: \" << it->toString() << endl;",
          "content_same": false
        },
        {
          "line": 402,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "writerVectors->size()",
          "old_line_content": "",
          "new_line_content": "            (*writerVectors)[hash % writerVectors->size()].push_back(*it);",
          "content_same": false
        },
        {
          "line": 406,
          "old_api": null,
          "new_api": "_applyOplogUntil",
          "old_text": null,
          "new_text": "_applyOplogUntil(txn, endOpTime)",
          "old_line_content": "    void SyncTail::oplogApplication(OperationContext* txn, const OpTime& endOpTime) {",
          "new_line_content": "        _applyOplogUntil(txn, endOpTime);",
          "content_same": false
        },
        {
          "line": 417,
          "old_api": null,
          "new_api": "getGlobalReplicationCoordinator",
          "old_text": null,
          "new_text": "getGlobalReplicationCoordinator()",
          "old_line_content": "",
          "new_line_content": "            while (!tryPopAndWaitForMore(&ops, getGlobalReplicationCoordinator())) {",
          "content_same": false
        },
        {
          "line": 419,
          "old_api": null,
          "new_api": "empty",
          "old_text": null,
          "new_text": "ops.empty()",
          "old_line_content": "                // nothing came back last time, so go again",
          "new_line_content": "                if (ops.empty()) continue;",
          "content_same": false
        },
        {
          "line": 422,
          "old_api": null,
          "new_api": "back",
          "old_text": null,
          "new_text": "ops.back()",
          "old_line_content": "                // Check if we reached the end",
          "new_line_content": "                const BSONObj currentOp = ops.back();",
          "content_same": false
        },
        {
          "line": 430,
          "old_api": null,
          "new_api": "severe",
          "old_text": null,
          "new_text": "severe()",
          "old_line_content": "                else if (currentOpTime > endOpTime) {",
          "new_line_content": "                    severe() << \"Applied past expected end \" << endOpTime << \" to \" << currentOpTime",
          "content_same": false
        },
        {
          "line": 432,
          "old_api": null,
          "new_api": "fassertFailedNoTrace",
          "old_text": null,
          "new_text": "fassertFailedNoTrace(18693)",
          "old_line_content": "                            << \" without seeing it. Rollback?\" << rsLog;",
          "new_line_content": "                    fassertFailedNoTrace(18693);",
          "content_same": false
        },
        {
          "line": 436,
          "old_api": null,
          "new_api": "getSize",
          "old_text": null,
          "new_text": "ops.getSize()",
          "old_line_content": "                // apply replication batch limits",
          "new_line_content": "                if (ops.getSize() > replBatchLimitBytes)",
          "content_same": false
        },
        {
          "line": 438,
          "old_api": null,
          "new_api": "getDeque",
          "old_text": null,
          "new_text": "ops.getDeque().size()",
          "old_line_content": "                    break;",
          "new_line_content": "                if (ops.getDeque().size() > replBatchLimitOperations)",
          "content_same": false
        },
        {
          "line": 442,
          "old_api": null,
          "new_api": "empty",
          "old_text": null,
          "new_text": "ops.empty()",
          "old_line_content": "",
          "new_line_content": "            if (ops.empty()) {",
          "content_same": false
        },
        {
          "line": 447,
          "old_api": null,
          "new_api": "back",
          "old_text": null,
          "new_text": "ops.back().getOwned()",
          "old_line_content": "",
          "new_line_content": "            const BSONObj lastOp = ops.back().getOwned();",
          "content_same": false
        },
        {
          "line": 450,
          "old_api": null,
          "new_api": "getSize",
          "old_text": null,
          "new_text": "ops.getSize()",
          "old_line_content": "            // Tally operation information",
          "new_line_content": "            bytesApplied += ops.getSize();",
          "content_same": false
        },
        {
          "line": 453,
          "old_api": null,
          "new_api": "getDeque",
          "old_text": null,
          "new_text": "ops.getDeque()",
          "old_line_content": "",
          "new_line_content": "            const OpTime lastOpTime = multiApply(ops.getDeque());",
          "content_same": false
        },
        {
          "line": 457,
          "old_api": null,
          "new_api": "LOG",
          "old_text": null,
          "new_text": "LOG(1)",
          "old_line_content": "            if (lastOpTime == endOpTime) {",
          "new_line_content": "                LOG(1) << \"SyncTail applied \" << entriesApplied",
          "content_same": false
        },
        {
          "line": 459,
          "old_api": null,
          "new_api": "toStringPretty",
          "old_text": null,
          "new_text": "endOpTime.toStringPretty()",
          "old_line_content": "                       << \" entries (\" << bytesApplied << \" bytes)\"",
          "new_line_content": "                       << \" and finished at opTime \" << endOpTime.toStringPretty();",
          "content_same": false
        },
        {
          "line": 467,
          "old_api": null,
          "new_api": "lockState",
          "old_text": null,
          "new_text": "txn->lockState()",
          "old_line_content": "    void tryToGoLiveAsASecondary(OperationContext* txn, ReplicationCoordinator* replCoord) {",
          "new_line_content": "        Lock::GlobalRead readLock(txn->lockState());",
          "content_same": false
        },
        {
          "line": 469,
          "old_api": null,
          "new_api": "getMaintenanceMode",
          "old_text": null,
          "new_text": "replCoord->getMaintenanceMode()",
          "old_line_content": "",
          "new_line_content": "        if (replCoord->getMaintenanceMode()) {",
          "content_same": false
        },
        {
          "line": 475,
          "old_api": null,
          "new_api": "getCurrentMemberState",
          "old_text": null,
          "new_text": "replCoord->getCurrentMemberState()",
          "old_line_content": "        // Only state RECOVERING can transition to SECONDARY.",
          "new_line_content": "        MemberState state(replCoord->getCurrentMemberState());",
          "content_same": false
        },
        {
          "line": 480,
          "old_api": null,
          "new_api": "getMinValid",
          "old_text": null,
          "new_text": "getMinValid(txn)",
          "old_line_content": "",
          "new_line_content": "        OpTime minvalid = getMinValid(txn);",
          "content_same": false
        },
        {
          "line": 485,
          "old_api": null,
          "new_api": "setFollowerMode",
          "old_text": null,
          "new_text": "replCoord->setFollowerMode(MemberState::RS_SECONDARY)",
          "old_line_content": "",
          "new_line_content": "        bool worked = replCoord->setFollowerMode(MemberState::RS_SECONDARY);",
          "content_same": false
        },
        {
          "line": 487,
          "old_api": null,
          "new_api": "MemberState",
          "old_text": null,
          "new_text": "MemberState(MemberState::RS_SECONDARY)",
          "old_line_content": "        if (!worked) {",
          "new_line_content": "            warning() << \"Failed to transition into \" << MemberState(MemberState::RS_SECONDARY)",
          "content_same": false
        },
        {
          "line": 495,
          "old_api": null,
          "new_api": "getGlobalReplicationCoordinator",
          "old_text": null,
          "new_text": "getGlobalReplicationCoordinator()",
          "old_line_content": "    void SyncTail::oplogApplication() {",
          "new_line_content": "        ReplicationCoordinator* replCoord = getGlobalReplicationCoordinator();",
          "content_same": false
        },
        {
          "line": 497,
          "old_api": null,
          "new_api": "inShutdown",
          "old_text": null,
          "new_text": "inShutdown()",
          "old_line_content": "",
          "new_line_content": "        while(!inShutdown()) {",
          "content_same": false
        },
        {
          "line": 505,
          "old_api": null,
          "new_api": "seconds",
          "old_text": null,
          "new_text": "batchTimer.seconds()",
          "old_line_content": "            do {",
          "new_line_content": "                int now = batchTimer.seconds();",
          "content_same": false
        },
        {
          "line": 508,
          "old_api": null,
          "new_api": "empty",
          "old_text": null,
          "new_text": "ops.empty()",
          "old_line_content": "                // apply replication batch limits",
          "new_line_content": "                if (!ops.empty()) {",
          "content_same": false
        },
        {
          "line": 511,
          "old_api": null,
          "new_api": "getDeque",
          "old_text": null,
          "new_text": "ops.getDeque().size()",
          "old_line_content": "                        break;",
          "new_line_content": "                    if (ops.getDeque().size() > replBatchLimitOperations)",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 512,
          "old_api": "getDeque",
          "new_api": null,
          "old_text": "ops.getDeque().size()",
          "new_text": null,
          "old_line_content": "                    if (ops.getDeque().size() > replBatchLimitOperations)",
          "new_line_content": "                        break;",
          "content_same": false
        },
        {
          "line": 520,
          "old_api": "getInitialSyncRequestedFlag",
          "new_api": null,
          "old_text": "bgsync->getInitialSyncRequestedFlag()",
          "new_text": null,
          "old_line_content": "                    if (bgsync->getInitialSyncRequestedFlag()) {",
          "new_line_content": "                        // got a resync command",
          "content_same": false
        },
        {
          "line": 522,
          "old_api": "lockState",
          "new_api": null,
          "old_text": "txn.lockState()",
          "new_text": null,
          "old_line_content": "                        Lock::DBLock lk(txn.lockState(), \"local\", MODE_X);",
          "new_line_content": "                        WriteUnitOfWork wunit(&txn);",
          "content_same": false
        },
        {
          "line": 526,
          "old_api": "db",
          "new_api": null,
          "old_text": "ctx.db()->dropCollection(&txn, \"local.oplog.rs\")",
          "new_text": null,
          "old_line_content": "                        ctx.db()->dropCollection(&txn, \"local.oplog.rs\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 537,
          "old_api": "clearSyncSourceBlacklist",
          "new_api": null,
          "old_text": "replCoord->clearSyncSourceBlacklist()",
          "new_text": null,
          "old_line_content": "                        replCoord->clearSyncSourceBlacklist();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 539,
          "old_api": "commit",
          "new_api": null,
          "old_text": "wunit.commit()",
          "new_text": null,
          "old_line_content": "                        wunit.commit();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 547,
          "old_api": "tryToGoLiveAsASecondary",
          "new_api": null,
          "old_text": "tryToGoLiveAsASecondary(&txn, replCoord)",
          "new_text": null,
          "old_line_content": "                    tryToGoLiveAsASecondary(&txn, replCoord);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 557,
          "old_api": "potentiallyHot",
          "new_api": null,
          "old_text": "theReplSet->myConfig().potentiallyHot()",
          "new_text": null,
          "old_line_content": "                            theReplSet->myConfig().potentiallyHot()) {",
          "new_line_content": "                        Manager* mgr = theReplSet->mgr;",
          "content_same": false
        },
        {
          "line": 563,
          "old_api": "sleepsecs",
          "new_api": null,
          "old_text": "sleepsecs(1)",
          "new_text": null,
          "old_line_content": "                            sleepsecs(1);",
          "new_line_content": "                            // There should never be ops to sync in a 1-member set, anyway",
          "content_same": false
        },
        {
          "line": 573,
          "old_api": "_opTime",
          "new_api": null,
          "old_text": "lastOp[\"ts\"]._opTime().getSecs()",
          "new_text": null,
          "old_line_content": "                    const unsigned int opTimestampSecs = lastOp[\"ts\"]._opTime().getSecs();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 579,
          "old_api": "time",
          "new_api": null,
          "old_text": "time(0)",
          "new_text": null,
          "old_line_content": "                    if (opTimestampSecs > static_cast<unsigned int>(time(0) - slaveDelaySecs)) {",
          "new_line_content": "                        break;",
          "content_same": false
        },
        {
          "line": 584,
          "old_api": "tryPopAndWaitForMore",
          "new_api": null,
          "old_text": "tryPopAndWaitForMore(&ops, replCoord)",
          "new_text": null,
          "old_line_content": "            } while (!tryPopAndWaitForMore(&ops, replCoord) && // tryPopAndWaitForMore returns true ",
          "new_line_content": "                                                               // when we need to end a batch early",
          "content_same": false
        },
        {
          "line": 587,
          "old_api": "inShutdown",
          "new_api": null,
          "old_text": "inShutdown()",
          "new_text": null,
          "old_line_content": "                   !inShutdown());",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 591,
          "old_api": "sleepmillis",
          "new_api": null,
          "old_text": "sleepmillis(0)",
          "new_text": null,
          "old_line_content": "                sleepmillis(0);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 594,
          "old_api": "empty",
          "new_api": null,
          "old_text": "ops.empty()",
          "new_text": null,
          "old_line_content": "            if (ops.empty()) {",
          "new_line_content": "                continue;",
          "content_same": false
        },
        {
          "line": 599,
          "old_api": "handleSlaveDelay",
          "new_api": null,
          "old_text": "handleSlaveDelay(lastOp)",
          "new_text": null,
          "old_line_content": "            handleSlaveDelay(lastOp);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 605,
          "old_api": "setMinValid",
          "new_api": null,
          "old_text": "setMinValid(&txn, minValid)",
          "new_text": null,
          "old_line_content": "            setMinValid(&txn, minValid);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 607,
          "old_api": "getDeque",
          "new_api": null,
          "old_text": "ops.getDeque()",
          "new_text": null,
          "old_line_content": "            multiApply(ops.getDeque());",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 614,
          "old_api": "peek",
          "new_api": null,
          "old_text": "peek(&op)",
          "new_text": null,
          "old_line_content": "                if (!peek(&op)) {",
          "new_line_content": "                    return;",
          "content_same": false
        },
        {
          "line": 631,
          "old_api": "peek",
          "new_api": null,
          "old_text": "peek(&op)",
          "new_text": null,
          "old_line_content": "        bool peek_success = peek(&op);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 636,
          "old_api": "signalDrainComplete",
          "new_api": null,
          "old_text": "replCoord->signalDrainComplete()",
          "new_text": null,
          "old_line_content": "                replCoord->signalDrainComplete();",
          "new_line_content": "                // block up to 1 second",
          "content_same": false
        },
        {
          "line": 638,
          "old_api": "waitForMore",
          "new_api": null,
          "old_text": "_networkQueue->waitForMore()",
          "new_text": null,
          "old_line_content": "                _networkQueue->waitForMore();",
          "new_line_content": "                return false;",
          "content_same": false
        },
        {
          "line": 646,
          "old_api": "valuestrsafe",
          "new_api": null,
          "old_text": "op[\"ns\"].valuestrsafe()",
          "new_text": null,
          "old_line_content": "        const char* ns = op[\"ns\"].valuestrsafe();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 649,
          "old_api": "valuestrsafe",
          "new_api": null,
          "old_text": "op[\"op\"].valuestrsafe()",
          "new_text": null,
          "old_line_content": "        if ((op[\"op\"].valuestrsafe()[0] == 'c') ||",
          "new_line_content": "            // Index builds are acheived through the use of an insert op, not a command op.",
          "content_same": false
        },
        {
          "line": 652,
          "old_api": "nsToCollectionSubstring",
          "new_api": null,
          "old_text": "nsToCollectionSubstring(ns)",
          "new_text": null,
          "old_line_content": "            ( *ns != '\\0' && nsToCollectionSubstring(ns) == \"system.indexes\" )) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 654,
          "old_api": "empty",
          "new_api": null,
          "old_text": "ops->empty()",
          "new_text": null,
          "old_line_content": "            if (ops->empty()) {",
          "new_line_content": "                // apply commands one-at-a-time",
          "content_same": false
        },
        {
          "line": 657,
          "old_api": "consume",
          "new_api": null,
          "old_text": "_networkQueue->consume()",
          "new_text": null,
          "old_line_content": "                _networkQueue->consume();",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 667,
          "old_api": "eoo",
          "new_api": null,
          "old_text": "elemVersion.eoo()",
          "new_text": null,
          "old_line_content": "        if (elemVersion.eoo())",
          "new_line_content": "            // missing version means version 1",
          "content_same": false
        },
        {
          "line": 671,
          "old_api": "Int",
          "new_api": null,
          "old_text": "elemVersion.Int()",
          "new_text": null,
          "old_line_content": "            curVersion = elemVersion.Int();",
          "new_line_content": "        ",
          "content_same": false
        },
        {
          "line": 674,
          "old_api": "severe",
          "new_api": null,
          "old_text": "severe()",
          "new_text": null,
          "old_line_content": "            severe() << \"expected oplog version \" << OPLOG_VERSION << \" but found version \" ",
          "new_line_content": "                     << curVersion << \" in oplog entry: \" << op;",
          "content_same": false
        },
        {
          "line": 676,
          "old_api": "fassertFailedNoTrace",
          "new_api": null,
          "old_text": "fassertFailedNoTrace(18820)",
          "new_text": null,
          "old_line_content": "            fassertFailedNoTrace(18820);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 681,
          "old_api": "consume",
          "new_api": null,
          "old_text": "_networkQueue->consume()",
          "new_text": null,
          "old_line_content": "        _networkQueue->consume();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 691,
          "old_api": "lockState",
          "new_api": null,
          "old_text": "txn.lockState()",
          "new_text": null,
          "old_line_content": "            Lock::DBLock lk(txn.lockState(), \"local\", MODE_X);",
          "new_line_content": "            WriteUnitOfWork wunit(&txn);",
          "content_same": false
        },
        {
          "line": 695,
          "old_api": "front",
          "new_api": null,
          "old_text": "ops->front()",
          "new_text": null,
          "old_line_content": "                const BSONObj& op = ops->front();",
          "new_line_content": "                // this updates lastOpTimeApplied",
          "content_same": false
        },
        {
          "line": 698,
          "old_api": "pop_front",
          "new_api": null,
          "old_text": "ops->pop_front()",
          "new_text": null,
          "old_line_content": "                ops->pop_front();",
          "new_line_content": "             }",
          "content_same": false
        },
        {
          "line": 700,
          "old_api": "commit",
          "new_api": null,
          "old_text": "wunit.commit()",
          "new_text": null,
          "old_line_content": "            wunit.commit();",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 704,
          "old_api": "notify",
          "new_api": null,
          "old_text": "BackgroundSync::get()->notify()",
          "new_text": null,
          "old_line_content": "        BackgroundSync::get()->notify();",
          "new_line_content": "        return lastOpTime;",
          "content_same": false
        },
        {
          "line": 710,
          "old_api": "total_seconds",
          "new_api": null,
          "old_text": "replCoord->getSlaveDelaySecs().total_seconds()",
          "new_text": null,
          "old_line_content": "        int slaveDelaySecs = replCoord->getSlaveDelaySecs().total_seconds();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 717,
          "old_api": "time",
          "new_api": null,
          "old_text": "time(0)",
          "new_text": null,
          "old_line_content": "            long long b = time(0);",
          "new_line_content": "            long long lag = b - a;",
          "content_same": false
        },
        {
          "line": 721,
          "old_api": "uassert",
          "new_api": null,
          "old_text": "uassert(12000, \"rs slaveDelay differential too big check clocks and systems\",\n                        sleeptime < 0x40000000)",
          "new_text": null,
          "old_line_content": "                uassert(12000, \"rs slaveDelay differential too big check clocks and systems\",",
          "new_line_content": "                        sleeptime < 0x40000000);",
          "content_same": false
        },
        {
          "line": 724,
          "old_api": "sleepsecs",
          "new_api": null,
          "old_text": "sleepsecs((int) sleeptime)",
          "new_text": null,
          "old_line_content": "                    sleepsecs((int) sleeptime);",
          "new_line_content": "                }",
          "content_same": false
        },
        {
          "line": 727,
          "old_api": "warning",
          "new_api": null,
          "old_text": "warning()",
          "new_text": null,
          "old_line_content": "                    warning() << \"replSet slavedelay causing a long sleep of \" << sleeptime",
          "new_line_content": "                              << \" seconds\" << rsLog;",
          "content_same": false
        },
        {
          "line": 732,
          "old_api": "sleepsecs",
          "new_api": null,
          "old_text": "sleepsecs(6)",
          "new_text": null,
          "old_line_content": "                        sleepsecs(6);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 735,
          "old_api": "total_seconds",
          "new_api": null,
          "old_text": "replCoord->getSlaveDelaySecs().total_seconds()",
          "new_text": null,
          "old_line_content": "                        if (replCoord->getSlaveDelaySecs().total_seconds() != slaveDelaySecs)",
          "new_line_content": "                            break;",
          "content_same": false
        },
        {
          "line": 749,
          "old_api": "replLocalAuth",
          "new_api": null,
          "old_text": "replLocalAuth()",
          "new_text": null,
          "old_line_content": "            replLocalAuth();",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 755,
          "old_api": "initializeWriterThread",
          "new_api": null,
          "old_text": "initializeWriterThread()",
          "new_text": null,
          "old_line_content": "        initializeWriterThread();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 760,
          "old_api": "lockState",
          "new_api": null,
          "old_text": "txn.lockState()",
          "new_text": null,
          "old_line_content": "        Lock::ParallelBatchWriterMode::iAmABatchParticipant(txn.lockState());",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 765,
          "old_api": "end",
          "new_api": null,
          "old_text": "ops.end()",
          "new_text": null,
          "old_line_content": "             it != ops.end();",
          "new_line_content": "             ++it) {",
          "content_same": false
        },
        {
          "line": 769,
          "old_api": "fassertFailedNoTrace",
          "new_api": null,
          "old_text": "fassertFailedNoTrace(16359)",
          "new_text": null,
          "old_line_content": "                    fassertFailedNoTrace(16359);",
          "new_line_content": "                }",
          "content_same": false
        },
        {
          "line": 774,
          "old_api": "fassertFailedNoTrace",
          "new_api": null,
          "old_text": "fassertFailedNoTrace(16360)",
          "new_text": null,
          "old_line_content": "                fassertFailedNoTrace(16360);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 781,
          "old_api": "initializeWriterThread",
          "new_api": null,
          "old_text": "initializeWriterThread()",
          "new_text": null,
          "old_line_content": "        initializeWriterThread();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 786,
          "old_api": "lockState",
          "new_api": null,
          "old_text": "txn.lockState()",
          "new_text": null,
          "old_line_content": "        Lock::ParallelBatchWriterMode::iAmABatchParticipant(txn.lockState());",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 789,
          "old_api": "end",
          "new_api": null,
          "old_text": "ops.end()",
          "new_text": null,
          "old_line_content": "             it != ops.end();",
          "new_line_content": "             ++it) {",
          "content_same": false
        },
        {
          "line": 792,
          "old_api": "syncApply",
          "new_api": null,
          "old_text": "st->syncApply(&txn, *it)",
          "new_text": null,
          "old_line_content": "                if (!st->syncApply(&txn, *it)) {",
          "new_line_content": "                    bool status;",
          "content_same": false
        },
        {
          "line": 796,
          "old_api": "shouldRetry",
          "new_api": null,
          "old_text": "st->shouldRetry(&txn, *it)",
          "new_text": null,
          "old_line_content": "                        status = st->shouldRetry(&txn, *it);",
          "new_line_content": "                    }",
          "content_same": false
        },
        {
          "line": 802,
          "old_api": "fassertFailedNoTrace",
          "new_api": null,
          "old_text": "fassertFailedNoTrace(15915)",
          "new_text": null,
          "old_line_content": "                            fassertFailedNoTrace(15915);",
          "new_line_content": "                        }",
          "content_same": false
        },
        {
          "line": 812,
          "old_api": "fassertFailedNoTrace",
          "new_api": null,
          "old_text": "fassertFailedNoTrace(16361)",
          "new_text": null,
          "old_line_content": "                fassertFailedNoTrace(16361);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 403,
          "old_api": "size",
          "new_api": null,
          "old_text": "writerVectors->size()",
          "new_text": null,
          "old_line_content": "            (*writerVectors)[hash % writerVectors->size()].push_back(*it);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 407,
          "old_api": "_applyOplogUntil",
          "new_api": null,
          "old_text": "_applyOplogUntil(txn, endOpTime)",
          "new_text": null,
          "old_line_content": "        _applyOplogUntil(txn, endOpTime);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 418,
          "old_api": "getGlobalReplicationCoordinator",
          "new_api": null,
          "old_text": "getGlobalReplicationCoordinator()",
          "new_text": null,
          "old_line_content": "            while (!tryPopAndWaitForMore(&ops, getGlobalReplicationCoordinator())) {",
          "new_line_content": "                // nothing came back last time, so go again",
          "content_same": false
        },
        {
          "line": 420,
          "old_api": "empty",
          "new_api": null,
          "old_text": "ops.empty()",
          "new_text": null,
          "old_line_content": "                if (ops.empty()) continue;",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 424,
          "old_api": "_opTime",
          "new_api": null,
          "old_text": "currentOp[\"ts\"]._opTime()",
          "new_text": null,
          "old_line_content": "                const OpTime currentOpTime = currentOp[\"ts\"]._opTime();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 431,
          "old_api": "severe",
          "new_api": null,
          "old_text": "severe()",
          "new_text": null,
          "old_line_content": "                    severe() << \"Applied past expected end \" << endOpTime << \" to \" << currentOpTime",
          "new_line_content": "                            << \" without seeing it. Rollback?\" << rsLog;",
          "content_same": false
        },
        {
          "line": 433,
          "old_api": "fassertFailedNoTrace",
          "new_api": null,
          "old_text": "fassertFailedNoTrace(18693)",
          "new_text": null,
          "old_line_content": "                    fassertFailedNoTrace(18693);",
          "new_line_content": "                }",
          "content_same": false
        },
        {
          "line": 437,
          "old_api": "getSize",
          "new_api": null,
          "old_text": "ops.getSize()",
          "new_text": null,
          "old_line_content": "                if (ops.getSize() > replBatchLimitBytes)",
          "new_line_content": "                    break;",
          "content_same": false
        },
        {
          "line": 439,
          "old_api": "getDeque",
          "new_api": null,
          "old_text": "ops.getDeque().size()",
          "new_text": null,
          "old_line_content": "                if (ops.getDeque().size() > replBatchLimitOperations)",
          "new_line_content": "                    break;",
          "content_same": false
        },
        {
          "line": 445,
          "old_api": "fassertFailedNoTrace",
          "new_api": null,
          "old_text": "fassertFailedNoTrace(18692)",
          "new_text": null,
          "old_line_content": "                fassertFailedNoTrace(18692);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 448,
          "old_api": "back",
          "new_api": null,
          "old_text": "ops.back().getOwned()",
          "new_text": null,
          "old_line_content": "            const BSONObj lastOp = ops.back().getOwned();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 452,
          "old_api": "getDeque",
          "new_api": null,
          "old_text": "ops.getDeque().size()",
          "new_text": null,
          "old_line_content": "            entriesApplied += ops.getDeque().size();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 454,
          "old_api": "getDeque",
          "new_api": null,
          "old_text": "ops.getDeque()",
          "new_text": null,
          "old_line_content": "            const OpTime lastOpTime = multiApply(ops.getDeque());",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 458,
          "old_api": "LOG",
          "new_api": null,
          "old_text": "LOG(1)",
          "new_text": null,
          "old_line_content": "                LOG(1) << \"SyncTail applied \" << entriesApplied",
          "new_line_content": "                       << \" entries (\" << bytesApplied << \" bytes)\"",
          "content_same": false
        },
        {
          "line": 460,
          "old_api": "toStringPretty",
          "new_api": null,
          "old_text": "endOpTime.toStringPretty()",
          "new_text": null,
          "old_line_content": "                       << \" and finished at opTime \" << endOpTime.toStringPretty();",
          "new_line_content": "                return;",
          "content_same": false
        },
        {
          "line": 468,
          "old_api": "lockState",
          "new_api": null,
          "old_text": "txn->lockState()",
          "new_text": null,
          "old_line_content": "        Lock::GlobalRead readLock(txn->lockState());",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 470,
          "old_api": "getMaintenanceMode",
          "new_api": null,
          "old_text": "replCoord->getMaintenanceMode()",
          "new_text": null,
          "old_line_content": "        if (replCoord->getMaintenanceMode()) {",
          "new_line_content": "            // we're not actually going live",
          "content_same": false
        },
        {
          "line": 477,
          "old_api": "recovering",
          "new_api": null,
          "old_text": "state.recovering()",
          "new_text": null,
          "old_line_content": "        if (!state.recovering()) {",
          "new_line_content": "            return;",
          "content_same": false
        },
        {
          "line": 482,
          "old_api": "getMyLastOptime",
          "new_api": null,
          "old_text": "replCoord->getMyLastOptime()",
          "new_text": null,
          "old_line_content": "        if (minvalid > replCoord->getMyLastOptime()) {",
          "new_line_content": "            return;",
          "content_same": false
        },
        {
          "line": 486,
          "old_api": "setFollowerMode",
          "new_api": null,
          "old_text": "replCoord->setFollowerMode(MemberState::RS_SECONDARY)",
          "new_text": null,
          "old_line_content": "        bool worked = replCoord->setFollowerMode(MemberState::RS_SECONDARY);",
          "new_line_content": "        if (!worked) {",
          "content_same": false
        },
        {
          "line": 489,
          "old_api": "getCurrentMemberState",
          "new_api": null,
          "old_text": "replCoord->getCurrentMemberState()",
          "new_text": null,
          "old_line_content": "                      << \". Current state: \" << replCoord->getCurrentMemberState();",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 496,
          "old_api": "getGlobalReplicationCoordinator",
          "new_api": null,
          "old_text": "getGlobalReplicationCoordinator()",
          "new_text": null,
          "old_line_content": "        ReplicationCoordinator* replCoord = getGlobalReplicationCoordinator();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 498,
          "old_api": "inShutdown",
          "new_api": null,
          "old_text": "inShutdown()",
          "new_text": null,
          "old_line_content": "        while(!inShutdown()) {",
          "new_line_content": "            OpQueue ops;",
          "content_same": false
        },
        {
          "line": 506,
          "old_api": "seconds",
          "new_api": null,
          "old_text": "batchTimer.seconds()",
          "new_text": null,
          "old_line_content": "                int now = batchTimer.seconds();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 509,
          "old_api": "empty",
          "new_api": null,
          "old_text": "ops.empty()",
          "new_text": null,
          "old_line_content": "                if (!ops.empty()) {",
          "new_line_content": "                    if (now > replBatchLimitSeconds)",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 41,
      "total_additions": 82,
      "total_deletions": 82,
      "total_api_changes": 205
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 3,
        "api_related_lines": 205,
        "non_api_lines": 2,
        "non_api_line_numbers": [
          400,
          398
        ]
      }
    },
    "api_calls_before": 295,
    "api_calls_after": 295,
    "diff_info": {
      "added_lines": 2,
      "removed_lines": 3,
      "total_diff_lines": 17
    }
  }
}