{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mongo/modified_file/59629331f9aa96e6610ddbe6163777a039d197f0",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mongo/modified_file/59629331f9aa96e6610ddbe6163777a039d197f0/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mongo/modified_file/59629331f9aa96e6610ddbe6163777a039d197f0/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mongo/modified_file/59629331f9aa96e6610ddbe6163777a039d197f0/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 82,
          "old_api": "getPrimary",
          "new_api": "_opTime",
          "old_text": "box.getPrimary()",
          "new_text": "o[\"ts\"]._opTime()",
          "old_line_content": "                    if( box.getPrimary() != primary ) {",
          "new_line_content": "                    ts = o[\"ts\"]._opTime();",
          "content_same": false
        },
        {
          "line": 88,
          "old_api": "syncApply",
          "new_api": "DBException",
          "old_text": "syncApply(o)",
          "new_text": "DBException(\"primary changed\",0)",
          "old_line_content": "                        syncApply(o);",
          "new_line_content": "                        throw DBException(\"primary changed\",0);",
          "content_same": false
        },
        {
          "line": 112,
          "old_api": "log",
          "new_api": "getPrimary",
          "old_text": "log(2)",
          "new_text": "box.getPrimary()",
          "old_line_content": "            log(2) << \"replSet can't connect to \" << hn << \" to read operations\" << rsLog;",
          "new_line_content": "        const Member *primary = box.getPrimary();",
          "content_same": false
        },
        {
          "line": 123,
          "old_api": "log",
          "new_api": "Query",
          "old_text": "log()",
          "new_text": "Query()",
          "old_line_content": "                log() << \"replSet error too stale to catch up, at least from primary \" << hn << rsLog;",
          "new_line_content": "            BSONObj remoteOldestOp = r.findOne(rsoplog, Query());",
          "content_same": false
        },
        {
          "line": 124,
          "old_api": "toStringPretty",
          "new_api": "_opTime",
          "old_text": "lastOpTimeWritten.toStringPretty()",
          "new_text": "remoteOldestOp[\"ts\"]._opTime()",
          "old_line_content": "                log() << \"replSet our last optime : \" << lastOpTimeWritten.toStringPretty() << rsLog;",
          "new_line_content": "            OpTime ts = remoteOldestOp[\"ts\"]._opTime();",
          "content_same": false
        },
        {
          "line": 126,
          "old_api": "log",
          "new_api": "toStringPretty",
          "old_text": "log()",
          "new_text": "ts.toStringPretty()",
          "old_line_content": "                log() << \"replSet See http://www.mongodb.org/display/DOCS/Resyncing+a+Very+Stale+Replica+Set+Member\" << rsLog;",
          "new_line_content": "            else log(3) << \"remoteOldestOp: \" << ts.toStringPretty() << endl;",
          "content_same": false
        },
        {
          "line": 128,
          "old_api": "sleepsecs",
          "new_api": "log",
          "old_text": "sleepsecs(120)",
          "new_text": "log()",
          "old_line_content": "                sleepsecs(120);",
          "new_line_content": "                log() << \"replSet error too stale to catch up, at least from primary \" << hn << rsLog;",
          "content_same": false
        },
        {
          "line": 133,
          "old_api": "tailingQueryGTE",
          "new_api": "sleepsecs",
          "old_text": "r.tailingQueryGTE(rsoplog, lastOpTimeWritten)",
          "new_text": "sleepsecs(120)",
          "old_line_content": "        r.tailingQueryGTE(rsoplog, lastOpTimeWritten);",
          "new_line_content": "                sleepsecs(120);",
          "content_same": false
        },
        {
          "line": 138,
          "old_api": "more",
          "new_api": "tailingQueryGTE",
          "old_text": "r.more()",
          "new_text": "r.tailingQueryGTE(rsoplog, lastOpTimeWritten)",
          "old_line_content": "            if( !r.more() ) {",
          "new_line_content": "        r.tailingQueryGTE(rsoplog, lastOpTimeWritten);",
          "content_same": false
        },
        {
          "line": 143,
          "old_api": "log",
          "new_api": "more",
          "old_text": "log()",
          "new_text": "r.more()",
          "old_line_content": "                        log() << \"replSet error empty query result from \" << hn << \" oplog\" << rsLog;",
          "new_line_content": "            if( !r.more() ) {",
          "content_same": false
        },
        {
          "line": 147,
          "old_api": "_opTime",
          "new_api": "isEmpty",
          "old_text": "theirLastOp[\"ts\"]._opTime()",
          "new_text": "theirLastOp.isEmpty()",
          "old_line_content": "                    OpTime theirTS = theirLastOp[\"ts\"]._opTime();",
          "new_line_content": "                    if( theirLastOp.isEmpty() ) {",
          "content_same": false
        },
        {
          "line": 149,
          "old_api": "log",
          "new_api": "sleepsecs",
          "old_text": "log()",
          "new_text": "sleepsecs(2)",
          "old_line_content": "                        log() << \"replSet we are ahead of the primary, will try to roll back\" << rsLog;",
          "new_line_content": "                        sleepsecs(2);",
          "content_same": false
        },
        {
          "line": 155,
          "old_api": "sleepsecs",
          "new_api": "syncRollback",
          "old_text": "sleepsecs(1)",
          "new_text": "syncRollback(r)",
          "old_line_content": "                    sleepsecs(1);",
          "new_line_content": "                        syncRollback(r);",
          "content_same": false
        },
        {
          "line": 159,
          "old_api": "sleepsecs",
          "new_api": "log",
          "old_text": "sleepsecs(2)",
          "new_text": "log()",
          "old_line_content": "                    sleepsecs(2);",
          "new_line_content": "                    log() << \"replSet syncTail condition 1\" << rsLog;",
          "content_same": false
        },
        {
          "line": 177,
          "old_api": "toStringPretty",
          "new_api": "nextSafe",
          "old_text": "ts.toStringPretty()",
          "new_text": "r.nextSafe()",
          "old_line_content": "                log() << \"TEMP primary's GTE: \" << ts.toStringPretty() << endl;",
          "new_line_content": "            BSONObj o = r.nextSafe();",
          "content_same": false
        },
        {
          "line": 181,
          "old_api": "syncRollback",
          "new_api": "toStringPretty",
          "old_text": "syncRollback(r)",
          "new_text": "lastOpTimeWritten.toStringPretty()",
          "old_line_content": "                syncRollback(r);",
          "new_line_content": "                log() << \"TEMP our last op time written: \" << lastOpTimeWritten.toStringPretty() << endl;",
          "content_same": false
        },
        {
          "line": 193,
          "old_api": "recovering",
          "new_api": "moreInCurrentBatch",
          "old_text": "state().recovering()",
          "new_text": "r.moreInCurrentBatch()",
          "old_line_content": "                    if( state().recovering() ) { ",
          "new_line_content": "                if( !r.moreInCurrentBatch() ) { ",
          "content_same": false
        },
        {
          "line": 215,
          "old_api": "toString",
          "new_api": "sethbmsg",
          "old_text": "minvalid.toString()",
          "new_text": "sethbmsg(\"\")",
          "old_line_content": "                            sethbmsg(str::stream() << \"still syncing, not yet to minValid optime \" << minvalid.toString());",
          "new_line_content": "                            sethbmsg(\"\");",
          "content_same": false
        },
        {
          "line": 241,
          "old_api": "syncApply",
          "new_api": "getState",
          "old_text": "syncApply(o)",
          "new_text": "box.getState().primary()",
          "old_line_content": "                        syncApply(o);",
          "new_line_content": "                            if( box.getState().primary() )",
          "content_same": false
        },
        {
          "line": 242,
          "old_api": "_logOpObjRS",
          "new_api": "log",
          "old_text": "_logOpObjRS(o)",
          "new_text": "log(0)",
          "old_line_content": "                        _logOpObjRS(o);   /* with repl sets we write the ops to our oplog too: */                   ",
          "new_line_content": "                                log(0) << \"replSet stopping syncTail we are now primary\" << rsLog;",
          "content_same": false
        },
        {
          "line": 246,
          "old_api": "tailCheck",
          "new_api": "syncApply",
          "old_text": "r.tailCheck()",
          "new_text": "syncApply(o)",
          "old_line_content": "            r.tailCheck();",
          "new_line_content": "                        syncApply(o);",
          "content_same": false
        },
        {
          "line": 247,
          "old_api": "haveCursor",
          "new_api": "_logOpObjRS",
          "old_text": "r.haveCursor()",
          "new_text": "_logOpObjRS(o)",
          "old_line_content": "            if( !r.haveCursor() ) {",
          "new_line_content": "                        _logOpObjRS(o);   /* with repl sets we write the ops to our oplog too: */                   ",
          "content_same": false
        },
        {
          "line": 252,
          "old_api": "getPrimary",
          "new_api": "haveCursor",
          "old_text": "box.getPrimary()",
          "new_text": "r.haveCursor()",
          "old_line_content": "            if( box.getPrimary() != primary )",
          "new_line_content": "            if( !r.haveCursor() ) {",
          "content_same": false
        },
        {
          "line": 276,
          "old_api": "syncTail",
          "new_api": "syncDoInitialSync",
          "old_text": "syncTail()",
          "new_text": "syncDoInitialSync()",
          "old_line_content": "        syncTail();",
          "new_line_content": "            syncDoInitialSync();",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 129,
          "old_api": null,
          "new_api": "toStringPretty",
          "old_text": null,
          "new_text": "lastOpTimeWritten.toStringPretty()",
          "old_line_content": "                return;",
          "new_line_content": "                log() << \"replSet our last optime : \" << lastOpTimeWritten.toStringPretty() << rsLog;",
          "content_same": false
        },
        {
          "line": 130,
          "old_api": null,
          "new_api": "toStringPretty",
          "old_text": null,
          "new_text": "ts.toStringPretty()",
          "old_line_content": "            }",
          "new_line_content": "                log() << \"replSet oldest at \" << hn << \" : \" << ts.toStringPretty() << rsLog;",
          "content_same": false
        },
        {
          "line": 131,
          "old_api": null,
          "new_api": "log",
          "old_text": null,
          "new_text": "log()",
          "old_line_content": "        }",
          "new_line_content": "                log() << \"replSet See http://www.mongodb.org/display/DOCS/Resyncing+a+Very+Stale+Replica+Set+Member\" << rsLog;",
          "content_same": false
        },
        {
          "line": 132,
          "old_api": null,
          "new_api": "sethbmsg",
          "old_text": null,
          "new_text": "sethbmsg(\"error too stale to catch up\")",
          "old_line_content": "",
          "new_line_content": "                sethbmsg(\"error too stale to catch up\");",
          "content_same": false
        },
        {
          "line": 257,
          "old_api": null,
          "new_api": "getPrimary",
          "old_text": null,
          "new_text": "box.getPrimary()",
          "old_line_content": "",
          "new_line_content": "            if( box.getPrimary() != primary )",
          "content_same": false
        },
        {
          "line": 264,
          "old_api": null,
          "new_api": "get",
          "old_text": null,
          "new_text": "box.get()",
          "old_line_content": "",
          "new_line_content": "        StateBox::SP sp = box.get();",
          "content_same": false
        },
        {
          "line": 265,
          "old_api": null,
          "new_api": "primary",
          "old_text": null,
          "new_text": "sp.state.primary()",
          "old_line_content": "        /* later, we can sync from up secondaries if we want. tbd. */",
          "new_line_content": "        if( sp.state.primary() ) {",
          "content_same": false
        },
        {
          "line": 266,
          "old_api": null,
          "new_api": "sleepsecs",
          "old_text": null,
          "new_text": "sleepsecs(1)",
          "old_line_content": "        if( sp.primary == 0 )",
          "new_line_content": "            sleepsecs(1);",
          "content_same": false
        },
        {
          "line": 139,
          "old_api": null,
          "new_api": "haveCursor",
          "old_text": null,
          "new_text": "r.haveCursor()",
          "old_line_content": "                /* maybe we are ahead and need to roll back? */",
          "new_line_content": "        assert( r.haveCursor() );",
          "content_same": false
        },
        {
          "line": 140,
          "old_api": null,
          "new_api": "awaitCapable",
          "old_text": null,
          "new_text": "r.awaitCapable()",
          "old_line_content": "                try {",
          "new_line_content": "        assert( r.awaitCapable() );",
          "content_same": false
        },
        {
          "line": 146,
          "old_api": null,
          "new_api": "getLastOp",
          "old_text": null,
          "new_text": "r.getLastOp(rsoplog)",
          "old_line_content": "                    }",
          "new_line_content": "                    bo theirLastOp = r.getLastOp(rsoplog);",
          "content_same": false
        },
        {
          "line": 275,
          "old_api": null,
          "new_api": "isNull",
          "old_text": null,
          "new_text": "lastOpTimeWritten.isNull()",
          "old_line_content": "        /* we have some data.  continue tailing. */",
          "new_line_content": "        if( lastOpTimeWritten.isNull() ) {",
          "content_same": false
        },
        {
          "line": 148,
          "old_api": null,
          "new_api": "log",
          "old_text": null,
          "new_text": "log()",
          "old_line_content": "                    if( theirTS < lastOpTimeWritten ) { ",
          "new_line_content": "                        log() << \"replSet error empty query result from \" << hn << \" oplog\" << rsLog;",
          "content_same": false
        },
        {
          "line": 152,
          "old_api": null,
          "new_api": "_opTime",
          "old_text": null,
          "new_text": "theirLastOp[\"ts\"]._opTime()",
          "old_line_content": "                    }",
          "new_line_content": "                    OpTime theirTS = theirLastOp[\"ts\"]._opTime();",
          "content_same": false
        },
        {
          "line": 281,
          "old_api": null,
          "new_api": "syncTail",
          "old_text": null,
          "new_text": "syncTail()",
          "old_line_content": "            return;",
          "new_line_content": "        syncTail();",
          "content_same": false
        },
        {
          "line": 285,
          "old_api": null,
          "new_api": "myConfig",
          "old_text": null,
          "new_text": "myConfig()",
          "old_line_content": "            }",
          "new_line_content": "        if( myConfig().arbiterOnly )",
          "content_same": false
        },
        {
          "line": 160,
          "old_api": null,
          "new_api": "sleepsecs",
          "old_text": null,
          "new_text": "sleepsecs(1)",
          "old_line_content": "                }",
          "new_line_content": "                    sleepsecs(1);",
          "content_same": false
        },
        {
          "line": 289,
          "old_api": null,
          "new_api": "_syncThread",
          "old_text": null,
          "new_text": "_syncThread()",
          "old_line_content": "            }",
          "new_line_content": "                _syncThread();",
          "content_same": false
        },
        {
          "line": 163,
          "old_api": null,
          "new_api": "toString",
          "old_text": null,
          "new_text": "e.toString()",
          "old_line_content": "                log() << \"replSet syncTail error querying oplog >= \" << lastOpTimeWritten.toString() << \" from \" << hn << rsLog;",
          "new_line_content": "                    log() << \"replSet error querying \" << hn << ' ' << e.toString() << rsLog;",
          "content_same": false
        },
        {
          "line": 164,
          "old_api": null,
          "new_api": "sleepsecs",
          "old_text": null,
          "new_text": "sleepsecs(2)",
          "old_line_content": "                try {",
          "new_line_content": "                    sleepsecs(2);",
          "content_same": false
        },
        {
          "line": 292,
          "old_api": null,
          "new_api": "toString",
          "old_text": null,
          "new_text": "e.toString()",
          "old_line_content": "                // TODO : SET NOT SECONDARY here.",
          "new_line_content": "                sethbmsg(\"syncThread: \" + e.toString());",
          "content_same": false
        },
        {
          "line": 296,
          "old_api": null,
          "new_api": "sethbmsg",
          "old_text": null,
          "new_text": "sethbmsg(\"unexpected exception in syncThread()\")",
          "old_line_content": "        }",
          "new_line_content": "                sethbmsg(\"unexpected exception in syncThread()\");",
          "content_same": false
        },
        {
          "line": 298,
          "old_api": null,
          "new_api": "sleepsecs",
          "old_text": null,
          "new_text": "sleepsecs(60)",
          "old_line_content": "",
          "new_line_content": "                sleepsecs(60);",
          "content_same": false
        },
        {
          "line": 300,
          "old_api": null,
          "new_api": "sleepsecs",
          "old_text": null,
          "new_text": "sleepsecs(1)",
          "old_line_content": "",
          "new_line_content": "            sleepsecs(1);",
          "content_same": false
        },
        {
          "line": 178,
          "old_api": null,
          "new_api": "_opTime",
          "old_text": null,
          "new_text": "o[\"ts\"]._opTime()",
          "old_line_content": "                /*",
          "new_line_content": "            OpTime ts = o[\"ts\"]._opTime();",
          "content_same": false
        },
        {
          "line": 179,
          "old_api": null,
          "new_api": "numberLong",
          "old_text": null,
          "new_text": "o[\"h\"].numberLong()",
          "old_line_content": "                }*/",
          "new_line_content": "            long long h = o[\"h\"].numberLong();",
          "content_same": false
        },
        {
          "line": 182,
          "old_api": null,
          "new_api": "toStringPretty",
          "old_text": null,
          "new_text": "ts.toStringPretty()",
          "old_line_content": "                return;",
          "new_line_content": "                log() << \"TEMP primary's GTE: \" << ts.toStringPretty() << endl;",
          "content_same": false
        },
        {
          "line": 186,
          "old_api": null,
          "new_api": "syncRollback",
          "old_text": null,
          "new_text": "syncRollback(r)",
          "old_line_content": "        while( 1 ) { ",
          "new_line_content": "                syncRollback(r);",
          "content_same": false
        },
        {
          "line": 198,
          "old_api": null,
          "new_api": "recovering",
          "old_text": null,
          "new_text": "state().recovering()",
          "old_line_content": "                            readlock lk(\"local.replset.minvalid\");",
          "new_line_content": "                    if( state().recovering() ) { ",
          "content_same": false
        },
        {
          "line": 76,
          "old_api": null,
          "new_api": "more",
          "old_text": null,
          "new_text": "r.more()",
          "old_line_content": "",
          "new_line_content": "                if( !r.more() )",
          "content_same": false
        },
        {
          "line": 205,
          "old_api": null,
          "new_api": "Helpers::getSingleton(\"local.replset.minvalid\", mv)",
          "old_text": null,
          "new_text": "Helpers::getSingleton(\"local.replset.minvalid\", mv)",
          "old_line_content": "                            }",
          "new_line_content": "                            if( Helpers::getSingleton(\"local.replset.minvalid\", mv) ) { ",
          "content_same": false
        },
        {
          "line": 78,
          "old_api": null,
          "new_api": "nextSafe",
          "old_text": null,
          "new_text": "r.nextSafe()",
          "old_line_content": "",
          "new_line_content": "                BSONObj o = r.nextSafe(); /* note we might get \"not master\" at some point */",
          "content_same": false
        },
        {
          "line": 206,
          "old_api": null,
          "new_api": "_opTime",
          "old_text": null,
          "new_text": "mv[\"ts\"]._opTime()",
          "old_line_content": "                            else ",
          "new_line_content": "                                minvalid = mv[\"ts\"]._opTime();",
          "content_same": false
        },
        {
          "line": 87,
          "old_api": null,
          "new_api": "getPrimary",
          "old_text": null,
          "new_text": "box.getPrimary()",
          "old_line_content": "                        // optimes before we started copying need not be applied.",
          "new_line_content": "                    if( box.getPrimary() != primary ) {",
          "content_same": false
        },
        {
          "line": 216,
          "old_api": null,
          "new_api": "log",
          "old_text": null,
          "new_text": "log()",
          "old_line_content": "                            //log() << \"TEMP \" << lastOpTimeWritten.toString() << rsLog;",
          "new_line_content": "                            log() << \"replSet SECONDARY\" << rsLog;",
          "content_same": false
        },
        {
          "line": 217,
          "old_api": null,
          "new_api": "changeState",
          "old_text": null,
          "new_text": "changeState(MemberState::RS_SECONDARY)",
          "old_line_content": "                        }",
          "new_line_content": "                            changeState(MemberState::RS_SECONDARY);",
          "content_same": false
        },
        {
          "line": 220,
          "old_api": null,
          "new_api": "toString",
          "old_text": null,
          "new_text": "minvalid.toString()",
          "old_line_content": "                    }",
          "new_line_content": "                            sethbmsg(str::stream() << \"still syncing, not yet to minValid optime \" << minvalid.toString());",
          "content_same": false
        },
        {
          "line": 93,
          "old_api": null,
          "new_api": "syncApply",
          "old_text": null,
          "new_text": "syncApply(o)",
          "old_line_content": "        }",
          "new_line_content": "                        syncApply(o);",
          "content_same": false
        },
        {
          "line": 95,
          "old_api": null,
          "new_api": "_logOpObjRS",
          "old_text": null,
          "new_text": "_logOpObjRS(o)",
          "old_line_content": "            if( ts <= minValid ) {",
          "new_line_content": "                    _logOpObjRS(o);   /* with repl sets we write the ops to our oplog too */",
          "content_same": false
        },
        {
          "line": 227,
          "old_api": null,
          "new_api": "getPrimary",
          "old_text": null,
          "new_text": "box.getPrimary()",
          "old_line_content": "                { ",
          "new_line_content": "                    if( box.getPrimary() != primary ) ",
          "content_same": false
        },
        {
          "line": 102,
          "old_api": null,
          "new_api": "toString",
          "old_text": null,
          "new_text": "e.toString()",
          "old_line_content": "    }",
          "new_line_content": "                log() << \"replSet initial sync failing, error applying oplog \" << e.toString() << rsLog;",
          "content_same": false
        },
        {
          "line": 230,
          "old_api": null,
          "new_api": "more",
          "old_text": null,
          "new_text": "r.more()",
          "old_line_content": "                        writelock lk(\"\");",
          "new_line_content": "                if( !r.more() )",
          "content_same": false
        },
        {
          "line": 233,
          "old_api": null,
          "new_api": "nextSafe",
          "old_text": null,
          "new_text": "r.nextSafe()",
          "old_line_content": "                           anymore. assumePrimary is in the db lock so we are safe as long as ",
          "new_line_content": "                    BSONObj o = r.nextSafe(); /* note we might get \"not master\" at some point */",
          "content_same": false
        },
        {
          "line": 240,
          "old_api": null,
          "new_api": "getPrimary",
          "old_text": null,
          "new_text": "box.getPrimary()",
          "old_line_content": "",
          "new_line_content": "                        if( box.getPrimary() != primary ) {",
          "content_same": false
        },
        {
          "line": 114,
          "old_api": null,
          "new_api": "toString",
          "old_text": null,
          "new_text": "primary->h().toString()",
          "old_line_content": "        }",
          "new_line_content": "        string hn = primary->h().toString();",
          "content_same": false
        },
        {
          "line": 116,
          "old_api": null,
          "new_api": "toString",
          "old_text": null,
          "new_text": "primary->h().toString()",
          "old_line_content": "        /* first make sure we are not hopelessly out of sync by being very stale. */",
          "new_line_content": "        if( !r.connect(primary->h().toString()) ) { ",
          "content_same": false
        },
        {
          "line": 117,
          "old_api": null,
          "new_api": "log",
          "old_text": null,
          "new_text": "log(2)",
          "old_line_content": "        {",
          "new_line_content": "            log(2) << \"replSet can't connect to \" << hn << \" to read operations\" << rsLog;",
          "content_same": false
        },
        {
          "line": 251,
          "old_api": null,
          "new_api": "tailCheck",
          "old_text": null,
          "new_text": "r.tailCheck()",
          "old_line_content": "            }",
          "new_line_content": "            r.tailCheck();",
          "content_same": false
        },
        {
          "line": 253,
          "old_api": null,
          "new_api": "log",
          "old_text": null,
          "new_text": "log()",
          "old_line_content": "                return;",
          "new_line_content": "                log() << \"replSet TEMP end syncTail pass with \" << hn << rsLog;",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 259,
          "old_api": "get",
          "new_api": null,
          "old_text": "box.get()",
          "new_text": null,
          "old_line_content": "        StateBox::SP sp = box.get();",
          "new_line_content": "            // looping back is ok because this is a tailable cursor",
          "content_same": false
        },
        {
          "line": 260,
          "old_api": "primary",
          "new_api": null,
          "old_text": "sp.state.primary()",
          "new_text": null,
          "old_line_content": "        if( sp.state.primary() ) {",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 261,
          "old_api": "sleepsecs",
          "new_api": null,
          "old_text": "sleepsecs(1)",
          "new_text": null,
          "old_line_content": "            sleepsecs(1);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 134,
          "old_api": "haveCursor",
          "new_api": null,
          "old_text": "r.haveCursor()",
          "new_text": null,
          "old_line_content": "        assert( r.haveCursor() );",
          "new_line_content": "                return;",
          "content_same": false
        },
        {
          "line": 135,
          "old_api": "awaitCapable",
          "new_api": null,
          "old_text": "r.awaitCapable()",
          "new_text": null,
          "old_line_content": "        assert( r.awaitCapable() );",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 141,
          "old_api": "getLastOp",
          "new_api": null,
          "old_text": "r.getLastOp(rsoplog)",
          "new_text": null,
          "old_line_content": "                    bo theirLastOp = r.getLastOp(rsoplog);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 142,
          "old_api": "isEmpty",
          "new_api": null,
          "old_text": "theirLastOp.isEmpty()",
          "new_text": null,
          "old_line_content": "                    if( theirLastOp.isEmpty() ) {",
          "new_line_content": "        {",
          "content_same": false
        },
        {
          "line": 270,
          "old_api": "isNull",
          "new_api": null,
          "old_text": "lastOpTimeWritten.isNull()",
          "new_text": null,
          "old_line_content": "        if( lastOpTimeWritten.isNull() ) {",
          "new_line_content": "        /* later, we can sync from up secondaries if we want. tbd. */",
          "content_same": false
        },
        {
          "line": 144,
          "old_api": "sleepsecs",
          "new_api": null,
          "old_text": "sleepsecs(2)",
          "new_text": null,
          "old_line_content": "                        sleepsecs(2);",
          "new_line_content": "                /* maybe we are ahead and need to roll back? */",
          "content_same": false
        },
        {
          "line": 271,
          "old_api": "syncDoInitialSync",
          "new_api": null,
          "old_text": "syncDoInitialSync()",
          "new_text": null,
          "old_line_content": "            syncDoInitialSync();",
          "new_line_content": "        if( sp.primary == 0 )",
          "content_same": false
        },
        {
          "line": 150,
          "old_api": "syncRollback",
          "new_api": null,
          "old_text": "syncRollback(r)",
          "new_text": null,
          "old_line_content": "                        syncRollback(r);",
          "new_line_content": "                        return;",
          "content_same": false
        },
        {
          "line": 280,
          "old_api": "myConfig",
          "new_api": null,
          "old_text": "myConfig()",
          "new_text": null,
          "old_line_content": "        if( myConfig().arbiterOnly )",
          "new_line_content": "        /* we have some data.  continue tailing. */",
          "content_same": false
        },
        {
          "line": 284,
          "old_api": "_syncThread",
          "new_api": null,
          "old_text": "_syncThread()",
          "new_text": null,
          "old_line_content": "                _syncThread();",
          "new_line_content": "    void ReplSetImpl::syncThread() {",
          "content_same": false
        },
        {
          "line": 158,
          "old_api": "toString",
          "new_api": null,
          "old_text": "e.toString()",
          "new_text": null,
          "old_line_content": "                    log() << \"replSet error querying \" << hn << ' ' << e.toString() << rsLog;",
          "new_line_content": "                    /* we're not ahead?  maybe our new query got fresher data.  best to come back and try again */",
          "content_same": false
        },
        {
          "line": 287,
          "old_api": "toString",
          "new_api": null,
          "old_text": "e.toString()",
          "new_text": null,
          "old_line_content": "                sethbmsg(\"syncThread: \" + e.toString());",
          "new_line_content": "        while( 1 ) { ",
          "content_same": false
        },
        {
          "line": 288,
          "old_api": "sleepsecs",
          "new_api": null,
          "old_text": "sleepsecs(10)",
          "new_text": null,
          "old_line_content": "                sleepsecs(10);",
          "new_line_content": "            try {",
          "content_same": false
        },
        {
          "line": 291,
          "old_api": "sethbmsg",
          "new_api": null,
          "old_text": "sethbmsg(\"unexpected exception in syncThread()\")",
          "new_text": null,
          "old_line_content": "                sethbmsg(\"unexpected exception in syncThread()\");",
          "new_line_content": "            catch(DBException& e) { ",
          "content_same": false
        },
        {
          "line": 295,
          "old_api": "sleepsecs",
          "new_api": null,
          "old_text": "sleepsecs(1)",
          "new_text": null,
          "old_line_content": "            sleepsecs(1);",
          "new_line_content": "            catch(...) { ",
          "content_same": false
        },
        {
          "line": 172,
          "old_api": "nextSafe",
          "new_api": null,
          "old_text": "r.nextSafe()",
          "new_text": null,
          "old_line_content": "            BSONObj o = r.nextSafe();",
          "new_line_content": "                catch(...) { }",
          "content_same": false
        },
        {
          "line": 173,
          "old_api": "_opTime",
          "new_api": null,
          "old_text": "o[\"ts\"]._opTime()",
          "new_text": null,
          "old_line_content": "            OpTime ts = o[\"ts\"]._opTime();",
          "new_line_content": "                sleepsecs(1);",
          "content_same": false
        },
        {
          "line": 174,
          "old_api": "numberLong",
          "new_api": null,
          "old_text": "o[\"h\"].numberLong()",
          "new_text": null,
          "old_line_content": "            long long h = o[\"h\"].numberLong();",
          "new_line_content": "                return;*/",
          "content_same": false
        },
        {
          "line": 176,
          "old_api": "toStringPretty",
          "new_api": null,
          "old_text": "lastOpTimeWritten.toStringPretty()",
          "new_text": null,
          "old_line_content": "                log() << \"TEMP our last op time written: \" << lastOpTimeWritten.toStringPretty() << endl;",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 188,
          "old_api": "moreInCurrentBatch",
          "new_api": null,
          "old_text": "r.moreInCurrentBatch()",
          "new_text": null,
          "old_line_content": "                if( !r.moreInCurrentBatch() ) { ",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 71,
          "old_api": "more",
          "new_api": null,
          "old_text": "r.more()",
          "new_text": null,
          "old_line_content": "                if( !r.more() )",
          "new_line_content": "            writelock lk(\"\");",
          "content_same": false
        },
        {
          "line": 200,
          "old_api": "Helpers::getSingleton(\"local.replset.minvalid\", mv)",
          "new_api": null,
          "old_text": "Helpers::getSingleton(\"local.replset.minvalid\", mv)",
          "new_text": null,
          "old_line_content": "                            if( Helpers::getSingleton(\"local.replset.minvalid\", mv) ) { ",
          "new_line_content": "                        bool golive = false;\t\t\t",
          "content_same": false
        },
        {
          "line": 73,
          "old_api": "nextSafe",
          "new_api": null,
          "old_text": "r.nextSafe()",
          "new_text": null,
          "old_line_content": "                BSONObj o = r.nextSafe(); /* note we might get \"not master\" at some point */",
          "new_line_content": "            // todo add status updates...",
          "content_same": false
        },
        {
          "line": 201,
          "old_api": "_opTime",
          "new_api": null,
          "old_text": "mv[\"ts\"]._opTime()",
          "new_text": null,
          "old_line_content": "                                minvalid = mv[\"ts\"]._opTime();",
          "new_line_content": "                        OpTime minvalid;",
          "content_same": false
        },
        {
          "line": 77,
          "old_api": "_opTime",
          "new_api": null,
          "old_text": "o[\"ts\"]._opTime()",
          "new_text": null,
          "old_line_content": "                    ts = o[\"ts\"]._opTime();",
          "new_line_content": "                    break;",
          "content_same": false
        },
        {
          "line": 210,
          "old_api": "sethbmsg",
          "new_api": null,
          "old_text": "sethbmsg(\"\")",
          "new_text": null,
          "old_line_content": "                            sethbmsg(\"\");",
          "new_line_content": "                            }",
          "content_same": false
        },
        {
          "line": 83,
          "old_api": "DBException",
          "new_api": null,
          "old_text": "DBException(\"primary changed\",0)",
          "new_text": null,
          "old_line_content": "                        throw DBException(\"primary changed\",0);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 211,
          "old_api": "log",
          "new_api": null,
          "old_text": "log()",
          "new_text": null,
          "old_line_content": "                            log() << \"replSet SECONDARY\" << rsLog;",
          "new_line_content": "                            else ",
          "content_same": false
        },
        {
          "line": 212,
          "old_api": "changeState",
          "new_api": null,
          "old_text": "changeState(MemberState::RS_SECONDARY)",
          "new_text": null,
          "old_line_content": "                            changeState(MemberState::RS_SECONDARY);",
          "new_line_content": "                                golive = true; /* must have been the original member */",
          "content_same": false
        },
        {
          "line": 90,
          "old_api": "_logOpObjRS",
          "new_api": null,
          "old_text": "_logOpObjRS(o)",
          "new_text": null,
          "old_line_content": "                    _logOpObjRS(o);   /* with repl sets we write the ops to our oplog too */",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 222,
          "old_api": "getPrimary",
          "new_api": null,
          "old_text": "box.getPrimary()",
          "new_text": null,
          "old_line_content": "                    if( box.getPrimary() != primary ) ",
          "new_line_content": "                        }",
          "content_same": false
        },
        {
          "line": 248,
          "old_api": "log",
          "new_api": null,
          "old_text": "log()",
          "new_text": null,
          "old_line_content": "                log() << \"replSet TEMP end syncTail pass with \" << hn << rsLog;",
          "new_line_content": "                    }",
          "content_same": false
        },
        {
          "line": 97,
          "old_api": "toString",
          "new_api": null,
          "old_text": "e.toString()",
          "new_text": null,
          "old_line_content": "                log() << \"replSet initial sync failing, error applying oplog \" << e.toString() << rsLog;",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 225,
          "old_api": "more",
          "new_api": null,
          "old_text": "r.more()",
          "new_text": null,
          "old_line_content": "                if( !r.more() )",
          "new_line_content": "                    }",
          "content_same": false
        },
        {
          "line": 228,
          "old_api": "nextSafe",
          "new_api": null,
          "old_text": "r.nextSafe()",
          "new_text": null,
          "old_line_content": "                    BSONObj o = r.nextSafe(); /* note we might get \"not master\" at some point */",
          "new_line_content": "                        return;",
          "content_same": false
        },
        {
          "line": 107,
          "old_api": "getPrimary",
          "new_api": null,
          "old_text": "box.getPrimary()",
          "new_text": null,
          "old_line_content": "        const Member *primary = box.getPrimary();",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 235,
          "old_api": "getPrimary",
          "new_api": null,
          "old_text": "box.getPrimary()",
          "new_text": null,
          "old_line_content": "                        if( box.getPrimary() != primary ) {",
          "new_line_content": "                        writelock lk(\"\");",
          "content_same": false
        },
        {
          "line": 109,
          "old_api": "toString",
          "new_api": null,
          "old_text": "primary->h().toString()",
          "new_text": null,
          "old_line_content": "        string hn = primary->h().toString();",
          "new_line_content": "    void ReplSetImpl::syncTail() { ",
          "content_same": false
        },
        {
          "line": 236,
          "old_api": "getState",
          "new_api": null,
          "old_text": "box.getState().primary()",
          "new_text": null,
          "old_line_content": "                            if( box.getState().primary() )",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 111,
          "old_api": "toString",
          "new_api": null,
          "old_text": "primary->h().toString()",
          "new_text": null,
          "old_line_content": "        if( !r.connect(primary->h().toString()) ) { ",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 237,
          "old_api": "log",
          "new_api": null,
          "old_text": "log(0)",
          "new_text": null,
          "old_line_content": "                                log(0) << \"replSet stopping syncTail we are now primary\" << rsLog;",
          "new_line_content": "                        /* if we have become primary, we dont' want to apply things from elsewhere",
          "content_same": false
        },
        {
          "line": 118,
          "old_api": "Query",
          "new_api": null,
          "old_text": "Query()",
          "new_text": null,
          "old_line_content": "            BSONObj remoteOldestOp = r.findOne(rsoplog, Query());",
          "new_line_content": "            return;",
          "content_same": false
        },
        {
          "line": 119,
          "old_api": "_opTime",
          "new_api": null,
          "old_text": "remoteOldestOp[\"ts\"]._opTime()",
          "new_text": null,
          "old_line_content": "            OpTime ts = remoteOldestOp[\"ts\"]._opTime();",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 120,
          "old_api": "toStringPretty",
          "new_api": null,
          "old_text": "ts.toStringPretty()",
          "new_text": null,
          "old_line_content": "            DEV log() << \"remoteOldestOp: \" << ts.toStringPretty() << endl;",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 121,
          "old_api": "toStringPretty",
          "new_api": null,
          "old_text": "ts.toStringPretty()",
          "new_text": null,
          "old_line_content": "            else log(3) << \"remoteOldestOp: \" << ts.toStringPretty() << endl;",
          "new_line_content": "        /* first make sure we are not hopelessly out of sync by being very stale. */",
          "content_same": false
        },
        {
          "line": 127,
          "old_api": "sethbmsg",
          "new_api": null,
          "old_text": "sethbmsg(\"error too stale to catch up\")",
          "new_text": null,
          "old_line_content": "                sethbmsg(\"error too stale to catch up\");",
          "new_line_content": "            if( lastOpTimeWritten < ts ) { ",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 24,
      "total_additions": 49,
      "total_deletions": 49,
      "total_api_changes": 122
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 7,
        "api_related_lines": 122,
        "non_api_lines": 5,
        "non_api_line_numbers": [
          70,
          72,
          74,
          75,
          80
        ]
      }
    },
    "api_calls_before": 111,
    "api_calls_after": 111,
    "diff_info": {
      "added_lines": 6,
      "removed_lines": 1,
      "total_diff_lines": 24
    }
  }
}