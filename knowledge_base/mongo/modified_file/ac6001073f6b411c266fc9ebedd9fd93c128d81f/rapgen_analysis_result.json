{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mongo/modified_file/ac6001073f6b411c266fc9ebedd9fd93c128d81f",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mongo/modified_file/ac6001073f6b411c266fc9ebedd9fd93c128d81f/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mongo/modified_file/ac6001073f6b411c266fc9ebedd9fd93c128d81f/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mongo/modified_file/ac6001073f6b411c266fc9ebedd9fd93c128d81f/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 738,
          "old_api": "getShard",
          "new_api": "end",
          "old_text": "c->getShard()",
          "new_text": "_chunkMap.end()",
          "old_line_content": "            seen.insert( c->getShard() );",
          "new_line_content": "        for ( ChunkMap::const_iterator i=_chunkMap.begin(); i!=_chunkMap.end(); ++i ){",
          "content_same": false
        },
        {
          "line": 750,
          "old_api": "got",
          "new_api": "BSONObj",
          "old_text": "dlk.got()",
          "new_text": "BSONObj()",
          "old_line_content": "        uassert( 13331 ,  \"locking namespace failed\" , dlk.got() );",
          "new_line_content": "        configServer.logChange( \"dropCollection.start\" , _ns , BSONObj() );",
          "content_same": false
        },
        {
          "line": 752,
          "old_api": "allUp",
          "new_api": "getns",
          "old_text": "configServer.allUp()",
          "new_text": "getns()",
          "old_line_content": "        uassert( 10174 ,  \"config servers not all up\" , configServer.allUp() );",
          "new_line_content": "        DistributedLock lockSetup( ConnectionString( configServer.modelServer() , ConnectionString::SYNC ) , getns() );",
          "content_same": false
        },
        {
          "line": 756,
          "old_api": "log",
          "new_api": "allUp",
          "old_text": "log(1)",
          "new_text": "configServer.allUp()",
          "old_line_content": "        log(1) << \"ChunkManager::drop : \" << _ns << endl;",
          "new_line_content": "        uassert( 10174 ,  \"config servers not all up\" , configServer.allUp() );",
          "content_same": false
        },
        {
          "line": 768,
          "old_api": "clear",
          "new_api": "log",
          "old_text": "_chunkRanges.clear()",
          "new_text": "log(1)",
          "old_line_content": "        _chunkRanges.clear();",
          "new_line_content": "        log(1) << \"ChunkManager::drop : \" << _ns << \"\\t all locked\" << endl;        ",
          "content_same": false
        },
        {
          "line": 773,
          "old_api": "end",
          "new_api": "clear",
          "old_text": "seen.end()",
          "new_text": "_shards.clear()",
          "old_line_content": "        for ( set<Shard>::iterator i=seen.begin(); i!=seen.end(); i++ ){",
          "new_line_content": "        _shards.clear();",
          "content_same": false
        },
        {
          "line": 779,
          "old_api": "log",
          "new_api": "dropCollection",
          "old_text": "log(1)",
          "new_text": "conn->dropCollection( _ns )",
          "old_line_content": "        log(1) << \"ChunkManager::drop : \" << _ns << \"\\t removed shard data\" << endl;        ",
          "new_line_content": "            conn->dropCollection( _ns );",
          "content_same": false
        },
        {
          "line": 783,
          "old_api": "save",
          "new_api": "log",
          "old_text": "_config->save()",
          "new_text": "log(1)",
          "old_line_content": "        _config->save();",
          "new_line_content": "        log(1) << \"ChunkManager::drop : \" << _ns << \"\\t removed shard data\" << endl;        ",
          "content_same": false
        },
        {
          "line": 793,
          "old_api": "end",
          "new_api": "BSON",
          "old_text": "seen.end()",
          "new_text": "BSON( \"ns\" << _ns )",
          "old_line_content": "        for ( set<Shard>::iterator i=seen.begin(); i!=seen.end(); i++ ){",
          "new_line_content": "        conn->remove( temp.getNS() , BSON( \"ns\" << _ns ) );",
          "content_same": false
        },
        {
          "line": 797,
          "old_api": "toString",
          "new_api": "end",
          "old_text": "res.toString()",
          "new_text": "seen.end()",
          "old_line_content": "                throw UserException( 8071 , (string)\"OH KNOW, cleaning up after drop failed: \" + res.toString() );",
          "new_line_content": "        for ( set<Shard>::iterator i=seen.begin(); i!=seen.end(); i++ ){",
          "content_same": false
        },
        {
          "line": 802,
          "old_api": "log",
          "new_api": "done",
          "old_text": "log(1)",
          "new_text": "conn.done()",
          "old_line_content": "        log(1) << \"ChunkManager::drop : \" << _ns << \"\\t DONE\" << endl;        ",
          "new_line_content": "            conn.done();",
          "content_same": false
        },
        {
          "line": 824,
          "old_api": "end",
          "new_api": "subarrayStart",
          "old_text": "_chunkMap.end()",
          "new_text": "cmdBuilder.subarrayStart( \"applyOps\" )",
          "old_line_content": "        for ( ChunkMap::const_iterator i=_chunkMap.begin(); i!=_chunkMap.end(); ++i ){",
          "new_line_content": "        BSONArrayBuilder updates( cmdBuilder.subarrayStart( \"applyOps\" ) );",
          "content_same": false
        },
        {
          "line": 838,
          "old_api": "append",
          "new_api": "push_back",
          "old_text": "op.append( \"op\" , \"u\" )",
          "new_text": "toFix.push_back( c )",
          "old_line_content": "            op.append( \"op\" , \"u\" );",
          "new_line_content": "            toFix.push_back( c );",
          "content_same": false
        },
        {
          "line": 839,
          "old_api": "appendBool",
          "new_api": "push_back",
          "old_text": "op.appendBool( \"b\" , true )",
          "new_text": "newVersions.push_back( myVersion )",
          "old_line_content": "            op.appendBool( \"b\" , true );",
          "new_line_content": "            newVersions.push_back( myVersion );",
          "content_same": false
        },
        {
          "line": 842,
          "old_api": "subobjStart",
          "new_api": "append",
          "old_text": "op.subobjStart( \"o\" )",
          "new_text": "op.append( \"op\" , \"u\" )",
          "old_line_content": "            BSONObjBuilder n( op.subobjStart( \"o\" ) );",
          "new_line_content": "            op.append( \"op\" , \"u\" );",
          "content_same": false
        },
        {
          "line": 843,
          "old_api": "serialize",
          "new_api": "appendBool",
          "old_text": "c->serialize( n , myVersion )",
          "new_text": "op.appendBool( \"b\" , true )",
          "old_line_content": "            c->serialize( n , myVersion );",
          "new_line_content": "            op.appendBool( \"b\" , true );",
          "content_same": false
        },
        {
          "line": 844,
          "old_api": "done",
          "new_api": "append",
          "old_text": "n.done()",
          "new_text": "op.append( \"ns\" , ShardNS::chunk )",
          "old_line_content": "            n.done();",
          "new_line_content": "            op.append( \"ns\" , ShardNS::chunk );",
          "content_same": false
        },
        {
          "line": 847,
          "old_api": "genID",
          "new_api": "serialize",
          "old_text": "c->genID()",
          "new_text": "c->serialize( n , myVersion )",
          "old_line_content": "            q.append( \"_id\" , c->genID() );",
          "new_line_content": "            c->serialize( n , myVersion );",
          "content_same": false
        },
        {
          "line": 850,
          "old_api": "obj",
          "new_api": "subobjStart",
          "old_text": "op.obj()",
          "new_text": "op.subobjStart( \"o2\" )",
          "old_line_content": "            updates.append( op.obj() );",
          "new_line_content": "            BSONObjBuilder q( op.subobjStart( \"o2\" ) );",
          "content_same": false
        },
        {
          "line": 862,
          "old_api": "BSON",
          "new_api": "size",
          "old_text": "BSON( \"lastmod\" << -1 )",
          "new_text": "_chunkMap.size()",
          "old_line_content": "            b.append( \"q\" , BSON( \"query\" << BSON( \"ns\" << _ns ) << \"orderby\" << BSON( \"lastmod\" << -1 ) ) );",
          "new_line_content": "        if ( a > 0 || _chunkMap.size() > 1 ){",
          "content_same": false
        },
        {
          "line": 865,
          "old_api": "appendTimestamp",
          "new_api": "append",
          "old_text": "bb.appendTimestamp( \"lastmod\" , a )",
          "new_text": "b.append( \"ns\" , ShardNS::chunk )",
          "old_line_content": "                bb.appendTimestamp( \"lastmod\" , a );",
          "new_line_content": "            b.append( \"ns\" , ShardNS::chunk );",
          "content_same": false
        },
        {
          "line": 866,
          "old_api": "done",
          "new_api": "BSON",
          "old_text": "bb.done()",
          "new_text": "BSON( \"lastmod\" << -1 )",
          "old_line_content": "                bb.done();",
          "new_line_content": "            b.append( \"q\" , BSON( \"query\" << BSON( \"ns\" << _ns ) << \"orderby\" << BSON( \"lastmod\" << -1 ) ) );",
          "content_same": false
        },
        {
          "line": 868,
          "old_api": "obj",
          "new_api": "subobjStart",
          "old_text": "b.obj()",
          "new_text": "b.subobjStart( \"res\" )",
          "old_line_content": "            temp.append( b.obj() );",
          "new_line_content": "                BSONObjBuilder bb( b.subobjStart( \"res\" ) );",
          "content_same": false
        },
        {
          "line": 869,
          "old_api": "done",
          "new_api": "appendTimestamp",
          "old_text": "temp.done()",
          "new_text": "bb.appendTimestamp( \"lastmod\" , a )",
          "old_line_content": "            temp.done();",
          "new_line_content": "                bb.appendTimestamp( \"lastmod\" , a );",
          "content_same": false
        },
        {
          "line": 876,
          "old_api": "modelServer",
          "new_api": "obj",
          "old_text": "Chunk(0).modelServer()",
          "new_text": "cmdBuilder.obj()",
          "old_line_content": "        ScopedDbConnection conn( Chunk(0).modelServer() );",
          "new_line_content": "        BSONObj cmd = cmdBuilder.obj();",
          "content_same": false
        },
        {
          "line": 878,
          "old_api": "runCommand",
          "new_api": "log",
          "old_text": "conn->runCommand( \"config\" , cmd , res )",
          "new_text": "log(7)",
          "old_line_content": "        bool ok = conn->runCommand( \"config\" , cmd , res );",
          "new_line_content": "        log(7) << \"ChunkManager::save update: \" << cmd << endl;",
          "content_same": false
        },
        {
          "line": 888,
          "old_api": "size",
          "new_api": "str",
          "old_text": "toFix.size()",
          "new_text": "ss.str()",
          "old_line_content": "        for ( unsigned i=0; i<toFix.size(); i++ ){",
          "new_line_content": "            log( LL_ERROR ) << ss.str() << endl;",
          "content_same": false
        },
        {
          "line": 892,
          "old_api": "getVersion_inlock",
          "new_api": "size",
          "old_text": "getVersion_inlock()",
          "new_text": "toFix.size()",
          "old_line_content": "        massert( 10417 ,  \"how did version get smalled\" , getVersion_inlock() >= a );",
          "new_line_content": "        for ( unsigned i=0; i<toFix.size(); i++ ){",
          "content_same": false
        },
        {
          "line": 898,
          "old_api": "size",
          "new_api": "ensureIndex_inlock",
          "old_text": "_chunkMap.size()",
          "new_text": "ensureIndex_inlock()",
          "old_line_content": "        uassert( 13346 , \"can't pre-split already splitted collection\" , (_chunkMap.size() == 1) );",
          "new_line_content": "        ensureIndex_inlock(); // TODO: this is too aggressive - but not really sooo bad",
          "content_same": false
        },
        {
          "line": 902,
          "old_api": "pickSplitVector",
          "new_api": "size",
          "old_text": "soleChunk->pickSplitVector( &splitPoints )",
          "new_text": "_chunkMap.size()",
          "old_line_content": "        soleChunk->pickSplitVector( &splitPoints );",
          "new_line_content": "        uassert( 13346 , \"can't pre-split already splitted collection\" , (_chunkMap.size() == 1) );",
          "content_same": false
        },
        {
          "line": 904,
          "old_api": "getns",
          "new_api": "begin",
          "old_text": "getns()",
          "new_text": "_chunkMap.begin()",
          "old_line_content": "            log(1) << \"not enough data to warrant chunking \" << getns() << endl;",
          "new_line_content": "        ChunkPtr soleChunk = _chunkMap.begin()->second;",
          "content_same": false
        },
        {
          "line": 908,
          "old_api": "multiSplit",
          "new_api": "getns",
          "old_text": "soleChunk->multiSplit( splitPoints )",
          "new_text": "getns()",
          "old_line_content": "        soleChunk->multiSplit( splitPoints );",
          "new_line_content": "            log(1) << \"not enough data to warrant chunking \" << getns() << endl;",
          "content_same": false
        },
        {
          "line": 954,
          "old_api": "str",
          "new_api": "end",
          "old_text": "ss.str()",
          "new_text": "_chunkMap.end()",
          "old_line_content": "        return ss.str();",
          "new_line_content": "        for ( ChunkMap::const_iterator i=_chunkMap.begin(); i!=_chunkMap.end(); ++i ){",
          "content_same": false
        },
        {
          "line": 958,
          "old_api": "getMax",
          "new_api": "str",
          "old_text": "c->getMax()",
          "new_text": "ss.str()",
          "old_line_content": "        _chunkRanges.reloadRange(_chunkMap, c->getMin(), c->getMax());",
          "new_line_content": "        return ss.str();",
          "content_same": false
        },
        {
          "line": 974,
          "old_api": "begin",
          "new_api": "assert",
          "old_text": "_ranges.begin()->second->getMin()",
          "new_text": "assert(it->second)",
          "old_line_content": "            assert(allOfType(MinKey, _ranges.begin()->second->getMin()));",
          "new_line_content": "                assert(it->second);",
          "content_same": false
        },
        {
          "line": 978,
          "old_api": "end",
          "new_api": "begin",
          "old_text": "_ranges.end()",
          "new_text": "_ranges.begin()->second->getMin()",
          "old_line_content": "            for (ChunkRangeMap::const_iterator it=boost::next(_ranges.begin()), end=_ranges.end(); it != end; ++it){",
          "new_line_content": "            assert(allOfType(MinKey, _ranges.begin()->second->getMin()));",
          "content_same": false
        },
        {
          "line": 979,
          "old_api": "prior",
          "new_api": "end",
          "old_text": "prior(it)",
          "new_text": "_ranges.end()",
          "old_line_content": "                ChunkRangeMap::const_iterator last = prior(it);",
          "new_line_content": "            assert(allOfType(MaxKey, prior(_ranges.end())->second->getMax()));",
          "content_same": false
        },
        {
          "line": 984,
          "old_api": "end",
          "new_api": "getMax",
          "old_text": "_ranges.end()",
          "new_text": "last->second->getMax()",
          "old_line_content": "            for (ChunkRangeMap::const_iterator it=_ranges.begin(), end=_ranges.end(); it != end; ++it){",
          "new_line_content": "                assert(it->second->getMin() == last->second->getMax());",
          "content_same": false
        },
        {
          "line": 989,
          "old_api": "begin",
          "new_api": "getMax",
          "old_text": "_ranges.begin()->second->getManager()",
          "new_text": "it->second->getMax()",
          "old_line_content": "            const ChunkMap chunks = _ranges.begin()->second->getManager()->_chunkMap;",
          "new_line_content": "                assert(it->first == it->second->getMax());",
          "content_same": false
        },
        {
          "line": 993,
          "old_api": "getMin",
          "new_api": "begin",
          "old_text": "chunk->getMin()",
          "new_text": "_ranges.begin()->second->getManager()",
          "old_line_content": "                ChunkRangeMap::const_iterator min = _ranges.upper_bound(chunk->getMin());",
          "new_line_content": "            const ChunkMap chunks = _ranges.begin()->second->getManager()->_chunkMap;",
          "content_same": false
        },
        {
          "line": 994,
          "old_api": "getMax",
          "new_api": "end",
          "old_text": "chunk->getMax()",
          "new_text": "chunks.end()",
          "old_line_content": "                ChunkRangeMap::const_iterator max = _ranges.lower_bound(chunk->getMax());",
          "new_line_content": "            for ( ChunkMap::const_iterator i=chunks.begin(); i!=chunks.end(); ++i ){",
          "content_same": false
        },
        {
          "line": 997,
          "old_api": "end",
          "new_api": "getMin",
          "old_text": "_ranges.end()",
          "new_text": "chunk->getMin()",
          "old_line_content": "                assert(max != _ranges.end());",
          "new_line_content": "                ChunkRangeMap::const_iterator min = _ranges.upper_bound(chunk->getMin());",
          "content_same": false
        },
        {
          "line": 998,
          "old_api": "assert",
          "new_api": "getMax",
          "old_text": "assert(min == max)",
          "new_text": "chunk->getMax()",
          "old_line_content": "                assert(min == max);",
          "new_line_content": "                ChunkRangeMap::const_iterator max = _ranges.lower_bound(chunk->getMax());",
          "content_same": false
        },
        {
          "line": 1000,
          "old_api": "getMin",
          "new_api": "end",
          "old_text": "chunk->getMin()",
          "new_text": "_ranges.end()",
          "old_line_content": "                assert(min->second->contains( chunk->getMin() ));",
          "new_line_content": "                assert(min != _ranges.end());",
          "content_same": false
        },
        {
          "line": 1001,
          "old_api": "getMax",
          "new_api": "end",
          "old_text": "chunk->getMax()",
          "new_text": "_ranges.end()",
          "old_line_content": "                assert(min->second->contains( chunk->getMax() ) || (min->second->getMax() == chunk->getMax()));",
          "new_line_content": "                assert(max != _ranges.end());",
          "content_same": false
        },
        {
          "line": 1005,
          "old_api": "log",
          "new_api": "getMax",
          "old_text": "log( LL_ERROR )",
          "new_text": "chunk->getMax()",
          "old_line_content": "            log( LL_ERROR ) << \"\\t invalid ChunkRangeMap! printing ranges:\" << endl;",
          "new_line_content": "                assert(min->second->contains( chunk->getMax() ) || (min->second->getMax() == chunk->getMax()));",
          "content_same": false
        },
        {
          "line": 1020,
          "old_api": "upper_bound",
          "new_api": "reloadAll",
          "old_text": "_ranges.upper_bound(min)",
          "new_text": "reloadAll(chunks)",
          "old_line_content": "        ChunkRangeMap::iterator low  = _ranges.upper_bound(min);",
          "new_line_content": "            reloadAll(chunks);",
          "content_same": false
        },
        {
          "line": 1024,
          "old_api": "end",
          "new_api": "upper_bound",
          "old_text": "_ranges.end()",
          "new_text": "_ranges.upper_bound(min)",
          "old_line_content": "        assert(high != _ranges.end());",
          "new_line_content": "        ChunkRangeMap::iterator low  = _ranges.upper_bound(min);",
          "content_same": false
        },
        {
          "line": 1025,
          "old_api": "assert",
          "new_api": "lower_bound",
          "old_text": "assert(low->second)",
          "new_text": "_ranges.lower_bound(max)",
          "old_line_content": "        assert(low->second);",
          "new_line_content": "        ChunkRangeMap::iterator high = _ranges.lower_bound(max);",
          "content_same": false
        },
        {
          "line": 1028,
          "old_api": "getMin",
          "new_api": "end",
          "old_text": "low->second->getMin()",
          "new_text": "_ranges.end()",
          "old_line_content": "        ChunkMap::const_iterator begin = chunks.upper_bound(low->second->getMin());",
          "new_line_content": "        assert(high != _ranges.end());",
          "content_same": false
        },
        {
          "line": 1029,
          "old_api": "getMax",
          "new_api": "assert",
          "old_text": "high->second->getMax()",
          "new_text": "assert(low->second)",
          "old_line_content": "        ChunkMap::const_iterator end   = chunks.lower_bound(high->second->getMax());",
          "new_line_content": "        assert(low->second);",
          "content_same": false
        },
        {
          "line": 1032,
          "old_api": "end",
          "new_api": "getMin",
          "old_text": "chunks.end()",
          "new_text": "low->second->getMin()",
          "old_line_content": "        assert(end != chunks.end());",
          "new_line_content": "        ChunkMap::const_iterator begin = chunks.upper_bound(low->second->getMin());",
          "content_same": false
        },
        {
          "line": 1046,
          "old_api": "upper_bound",
          "new_api": "empty",
          "old_text": "_ranges.upper_bound(min)",
          "new_text": "_ranges.empty()",
          "old_line_content": "        low = _ranges.upper_bound(min);",
          "new_line_content": "        assert(!_ranges.empty());",
          "content_same": false
        },
        {
          "line": 1051,
          "old_api": "getShard",
          "new_api": "end",
          "old_text": "b->getShard()",
          "new_text": "_ranges.end()",
          "old_line_content": "            if (a->getShard() == b->getShard()){",
          "new_line_content": "        assert(low != _ranges.end());",
          "content_same": false
        },
        {
          "line": 1055,
          "old_api": "getMax",
          "new_api": "getShard",
          "old_text": "cr->getMax()",
          "new_text": "b->getShard()",
          "old_line_content": "                _ranges[cr->getMax()] = cr;",
          "new_line_content": "            if (a->getShard() == b->getShard()){",
          "content_same": false
        },
        {
          "line": 1066,
          "old_api": "getShard",
          "new_api": "lower_bound",
          "old_text": "b->getShard()",
          "new_text": "_ranges.lower_bound(max)",
          "old_line_content": "            if (a->getShard() == b->getShard()){",
          "new_line_content": "        high = _ranges.lower_bound(max);",
          "content_same": false
        },
        {
          "line": 1069,
          "old_api": "erase",
          "new_api": "boost::next(high)",
          "old_text": "_ranges.erase(high)",
          "new_text": "boost::next(high)",
          "old_line_content": "                _ranges.erase(high); //invalidates high",
          "new_line_content": "            shared_ptr<ChunkRange> b = boost::next(high)->second;",
          "content_same": false
        },
        {
          "line": 1070,
          "old_api": "getMax",
          "new_api": "getShard",
          "old_text": "cr->getMax()",
          "new_text": "b->getShard()",
          "old_line_content": "                _ranges[cr->getMax()] = cr;",
          "new_line_content": "            if (a->getShard() == b->getShard()){",
          "content_same": false
        },
        {
          "line": 1092,
          "old_api": "getMax",
          "new_api": "getShard",
          "old_text": "cr->getMax()",
          "new_text": "begin->second->getShard()",
          "old_line_content": "            _ranges[cr->getMax()] = cr;",
          "new_line_content": "            while (begin != end && (begin->second->getShard() == shard))",
          "content_same": false
        },
        {
          "line": 1112,
          "old_api": "size",
          "new_api": "ShardChunkVersion",
          "old_text": "all.size()",
          "new_text": "ShardChunkVersion(1,2)",
          "old_line_content": "            for ( unsigned i=0; i<all.size(); i++ ){",
          "new_line_content": "            all.push_back( ShardChunkVersion(1,2) );",
          "content_same": false
        },
        {
          "line": 1113,
          "old_api": "size",
          "new_api": "ShardChunkVersion",
          "old_text": "all.size()",
          "new_text": "ShardChunkVersion(2,1)",
          "old_line_content": "                for ( unsigned j=i+1; j<all.size(); j++ ){",
          "new_line_content": "            all.push_back( ShardChunkVersion(2,1) );",
          "content_same": false
        },
        {
          "line": 1114,
          "old_api": "assert",
          "new_api": "ShardChunkVersion",
          "old_text": "assert( all[i] < all[j] )",
          "new_text": "ShardChunkVersion(2,2)",
          "old_line_content": "                    assert( all[i] < all[j] );",
          "new_line_content": "            all.push_back( ShardChunkVersion(2,2) );",
          "content_same": false
        },
        {
          "line": 1137,
          "old_api": "appendBool",
          "new_api": "modelServer",
          "old_text": "cmdBuilder.appendBool( \"authoritative\" , 1 )",
          "new_text": "configServer.modelServer()",
          "old_line_content": "            cmdBuilder.appendBool( \"authoritative\" , 1 );",
          "new_line_content": "        cmdBuilder.append( \"configdb\" , configServer.modelServer() );",
          "content_same": false
        },
        {
          "line": 1139,
          "old_api": "getServerAddress",
          "new_api": "appendOID",
          "old_text": "conn.getServerAddress()",
          "new_text": "cmdBuilder.appendOID( \"serverID\" , &serverID )",
          "old_line_content": "        Shard s = Shard::make( conn.getServerAddress() );",
          "new_line_content": "        cmdBuilder.appendOID( \"serverID\" , &serverID );",
          "content_same": false
        },
        {
          "line": 1141,
          "old_api": "getConnString",
          "new_api": "appendBool",
          "old_text": "s.getConnString()",
          "new_text": "cmdBuilder.appendBool( \"authoritative\" , 1 )",
          "old_line_content": "        cmdBuilder.append( \"shardHost\" , s.getConnString() );",
          "new_line_content": "            cmdBuilder.appendBool( \"authoritative\" , 1 );",
          "content_same": false
        },
        {
          "line": 1144,
          "old_api": "getServerAddress",
          "new_api": "getName",
          "old_text": "conn.getServerAddress()",
          "new_text": "s.getName()",
          "old_line_content": "        log(1) << \"    setShardVersion  \" << s.getName() << \" \" << conn.getServerAddress() << \"  \" << ns << \"  \" << cmd << \" \" << &conn << endl;",
          "new_line_content": "        cmdBuilder.append( \"shard\" , s.getName() );",
          "content_same": false
        },
        {
          "line": 1146,
          "old_api": "runCommand",
          "new_api": "obj",
          "old_text": "conn.runCommand( \"admin\" , cmd , result )",
          "new_text": "cmdBuilder.obj()",
          "old_line_content": "        return conn.runCommand( \"admin\" , cmd , result );",
          "new_line_content": "        BSONObj cmd = cmdBuilder.obj();",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 1027,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "_ranges.end()",
          "old_line_content": "",
          "new_line_content": "        assert(low != _ranges.end());",
          "content_same": false
        },
        {
          "line": 1030,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(high->second)",
          "old_line_content": "",
          "new_line_content": "        assert(high->second);",
          "content_same": false
        },
        {
          "line": 1033,
          "old_api": null,
          "new_api": "getMax",
          "old_text": null,
          "new_text": "high->second->getMax()",
          "old_line_content": "",
          "new_line_content": "        ChunkMap::const_iterator end   = chunks.lower_bound(high->second->getMax());",
          "content_same": false
        },
        {
          "line": 1035,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "chunks.end()",
          "old_line_content": "        ++high;",
          "new_line_content": "        assert(begin != chunks.end());",
          "content_same": false
        },
        {
          "line": 1036,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "chunks.end()",
          "old_line_content": "        ++end;",
          "new_line_content": "        assert(end != chunks.end());",
          "content_same": false
        },
        {
          "line": 1043,
          "old_api": null,
          "new_api": "erase",
          "old_text": null,
          "new_text": "_ranges.erase(low, high)",
          "old_line_content": "        DEV assertValid();",
          "new_line_content": "        _ranges.erase(low, high); // invalidates low",
          "content_same": false
        },
        {
          "line": 1044,
          "old_api": null,
          "new_api": "_insertRange",
          "old_text": null,
          "new_text": "_insertRange(begin, end)",
          "old_line_content": "",
          "new_line_content": "        _insertRange(begin, end);",
          "content_same": false
        },
        {
          "line": 1050,
          "old_api": null,
          "new_api": "upper_bound",
          "old_text": null,
          "new_text": "_ranges.upper_bound(min)",
          "old_line_content": "            shared_ptr<ChunkRange> b = low->second;",
          "new_line_content": "        low = _ranges.upper_bound(min);",
          "content_same": false
        },
        {
          "line": 1052,
          "old_api": null,
          "new_api": "begin",
          "old_text": null,
          "new_text": "_ranges.begin()",
          "old_line_content": "                shared_ptr<ChunkRange> cr (new ChunkRange(*a, *b));",
          "new_line_content": "        if (low != _ranges.begin()){",
          "content_same": false
        },
        {
          "line": 1057,
          "old_api": null,
          "new_api": "prior",
          "old_text": null,
          "new_text": "prior(low)",
          "old_line_content": "        }",
          "new_line_content": "                _ranges.erase(prior(low));",
          "content_same": false
        },
        {
          "line": 1058,
          "old_api": null,
          "new_api": "erase",
          "old_text": null,
          "new_text": "_ranges.erase(low)",
          "old_line_content": "",
          "new_line_content": "                _ranges.erase(low); // invalidates low",
          "content_same": false
        },
        {
          "line": 1059,
          "old_api": null,
          "new_api": "getMax",
          "old_text": null,
          "new_text": "cr->getMax()",
          "old_line_content": "        DEV assertValid();",
          "new_line_content": "                _ranges[cr->getMax()] = cr;",
          "content_same": false
        },
        {
          "line": 1067,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "_ranges.end()",
          "old_line_content": "                shared_ptr<ChunkRange> cr (new ChunkRange(*a, *b));",
          "new_line_content": "        if (high != prior(_ranges.end())){",
          "content_same": false
        },
        {
          "line": 1072,
          "old_api": null,
          "new_api": "boost::next(high)",
          "old_text": null,
          "new_text": "boost::next(high)",
          "old_line_content": "        }",
          "new_line_content": "                _ranges.erase(boost::next(high));",
          "content_same": false
        },
        {
          "line": 1073,
          "old_api": null,
          "new_api": "erase",
          "old_text": null,
          "new_text": "_ranges.erase(high)",
          "old_line_content": "",
          "new_line_content": "                _ranges.erase(high); //invalidates high",
          "content_same": false
        },
        {
          "line": 1074,
          "old_api": null,
          "new_api": "getMax",
          "old_text": null,
          "new_text": "cr->getMax()",
          "old_line_content": "        DEV assertValid();",
          "new_line_content": "                _ranges[cr->getMax()] = cr;",
          "content_same": false
        },
        {
          "line": 1082,
          "old_api": null,
          "new_api": "clear",
          "old_text": null,
          "new_text": "_ranges.clear()",
          "old_line_content": "    }",
          "new_line_content": "        _ranges.clear();",
          "content_same": false
        },
        {
          "line": 1083,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "chunks.end()",
          "old_line_content": "",
          "new_line_content": "        _insertRange(chunks.begin(), chunks.end());",
          "content_same": false
        },
        {
          "line": 1091,
          "old_api": null,
          "new_api": "getShard",
          "old_text": null,
          "new_text": "first->second->getShard()",
          "old_line_content": "            shared_ptr<ChunkRange> cr (new ChunkRange(first, begin));",
          "new_line_content": "            Shard shard = first->second->getShard();",
          "content_same": false
        },
        {
          "line": 1096,
          "old_api": null,
          "new_api": "getMax",
          "old_text": null,
          "new_text": "cr->getMax()",
          "old_line_content": "    class ChunkObjUnitTest : public UnitTest {",
          "new_line_content": "            _ranges[cr->getMax()] = cr;",
          "content_same": false
        },
        {
          "line": 1104,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert( ! c )",
          "old_line_content": "        ",
          "new_line_content": "            assert( ! c );",
          "content_same": false
        },
        {
          "line": 1105,
          "old_api": null,
          "new_api": "reset",
          "old_text": null,
          "new_text": "c.reset( new Chunk( 0 ) )",
          "old_line_content": "        void runShardChunkVersion(){",
          "new_line_content": "            c.reset( new Chunk( 0 ) );",
          "content_same": false
        },
        {
          "line": 1106,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert( c )",
          "old_line_content": "            vector<ShardChunkVersion> all;",
          "new_line_content": "            assert( c );",
          "content_same": false
        },
        {
          "line": 1111,
          "old_api": null,
          "new_api": "ShardChunkVersion",
          "old_text": null,
          "new_text": "ShardChunkVersion(1,1)",
          "old_line_content": "            ",
          "new_line_content": "            all.push_back( ShardChunkVersion(1,1) );",
          "content_same": false
        },
        {
          "line": 1116,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "all.size()",
          "old_line_content": "            }",
          "new_line_content": "            for ( unsigned i=0; i<all.size(); i++ ){",
          "content_same": false
        },
        {
          "line": 1117,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "all.size()",
          "old_line_content": "",
          "new_line_content": "                for ( unsigned j=i+1; j<all.size(); j++ ){",
          "content_same": false
        },
        {
          "line": 1118,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert( all[i] < all[j] )",
          "old_line_content": "        }",
          "new_line_content": "                    assert( all[i] < all[j] );",
          "content_same": false
        },
        {
          "line": 1125,
          "old_api": null,
          "new_api": "runShard",
          "old_text": null,
          "new_text": "runShard()",
          "old_line_content": "    } shardObjTest;",
          "new_line_content": "            runShard();",
          "content_same": false
        },
        {
          "line": 1126,
          "old_api": null,
          "new_api": "runShardChunkVersion",
          "old_text": null,
          "new_text": "runShardChunkVersion()",
          "old_line_content": "",
          "new_line_content": "            runShardChunkVersion();",
          "content_same": false
        },
        {
          "line": 1127,
          "old_api": null,
          "new_api": "log",
          "old_text": null,
          "new_text": "log(1)",
          "old_line_content": "",
          "new_line_content": "            log(1) << \"shardObjTest passed\" << endl;",
          "content_same": false
        },
        {
          "line": 1136,
          "old_api": null,
          "new_api": "c_str",
          "old_text": null,
          "new_text": "ns.c_str()",
          "old_line_content": "        if ( authoritative )",
          "new_line_content": "        cmdBuilder.append( \"setShardVersion\" , ns.c_str() );",
          "content_same": false
        },
        {
          "line": 1138,
          "old_api": null,
          "new_api": "toLong",
          "old_text": null,
          "new_text": "version.toLong()",
          "old_line_content": "",
          "new_line_content": "        cmdBuilder.appendTimestamp( \"version\" , version.toLong() );",
          "content_same": false
        },
        {
          "line": 1143,
          "old_api": null,
          "new_api": "getServerAddress",
          "old_text": null,
          "new_text": "conn.getServerAddress()",
          "old_line_content": "        ",
          "new_line_content": "        Shard s = Shard::make( conn.getServerAddress() );",
          "content_same": false
        },
        {
          "line": 1145,
          "old_api": null,
          "new_api": "getConnString",
          "old_text": null,
          "new_text": "s.getConnString()",
          "old_line_content": "        ",
          "new_line_content": "        cmdBuilder.append( \"shardHost\" , s.getConnString() );",
          "content_same": false
        },
        {
          "line": 1148,
          "old_api": null,
          "new_api": "getServerAddress",
          "old_text": null,
          "new_text": "conn.getServerAddress()",
          "old_line_content": "",
          "new_line_content": "        log(1) << \"    setShardVersion  \" << s.getName() << \" \" << conn.getServerAddress() << \"  \" << ns << \"  \" << cmd << \" \" << &conn << endl;",
          "content_same": false
        },
        {
          "line": 1150,
          "old_api": null,
          "new_api": "runCommand",
          "old_text": null,
          "new_text": "conn.runCommand( \"admin\" , cmd , result )",
          "old_line_content": "} // namespace mongo",
          "new_line_content": "        return conn.runCommand( \"admin\" , cmd , result );",
          "content_same": false
        },
        {
          "line": 720,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "_shards.size()",
          "old_line_content": "",
          "new_line_content": "            if (shards.size() == _shards.size())",
          "content_same": false
        },
        {
          "line": 732,
          "old_api": null,
          "new_api": "ensureIndex_inlock",
          "old_text": null,
          "new_text": "ensureIndex_inlock()",
          "old_line_content": "        set<Shard> seen;",
          "new_line_content": "        ensureIndex_inlock();",
          "content_same": false
        },
        {
          "line": 740,
          "old_api": null,
          "new_api": "getShard",
          "old_text": null,
          "new_text": "c->getShard()",
          "old_line_content": "        }",
          "new_line_content": "            if ( seen.count( c->getShard() ) )",
          "content_same": false
        },
        {
          "line": 742,
          "old_api": null,
          "new_api": "getShard",
          "old_text": null,
          "new_text": "c->getShard()",
          "old_line_content": "    ",
          "new_line_content": "            seen.insert( c->getShard() );",
          "content_same": false
        },
        {
          "line": 743,
          "old_api": null,
          "new_api": "ensureIndex",
          "old_text": null,
          "new_text": "c->ensureIndex()",
          "old_line_content": "    void ChunkManager::drop( ChunkManagerPtr me ){",
          "new_line_content": "            c->ensureIndex();",
          "content_same": false
        },
        {
          "line": 754,
          "old_api": null,
          "new_api": "got",
          "old_text": null,
          "new_text": "dlk.got()",
          "old_line_content": "        set<Shard> seen;",
          "new_line_content": "        uassert( 13331 ,  \"locking namespace failed\" , dlk.got() );",
          "content_same": false
        },
        {
          "line": 760,
          "old_api": null,
          "new_api": "log",
          "old_text": null,
          "new_text": "log(1)",
          "old_line_content": "            ChunkPtr c = i->second;",
          "new_line_content": "        log(1) << \"ChunkManager::drop : \" << _ns << endl;",
          "content_same": false
        },
        {
          "line": 763,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "_chunkMap.end()",
          "old_line_content": "        ",
          "new_line_content": "        for ( ChunkMap::const_iterator i=_chunkMap.begin(); i!=_chunkMap.end(); ++i ){",
          "content_same": false
        },
        {
          "line": 765,
          "old_api": null,
          "new_api": "getShard",
          "old_text": null,
          "new_text": "c->getShard()",
          "old_line_content": "",
          "new_line_content": "            seen.insert( c->getShard() );",
          "content_same": false
        },
        {
          "line": 771,
          "old_api": null,
          "new_api": "clear",
          "old_text": null,
          "new_text": "_chunkMap.clear()",
          "old_line_content": "        ",
          "new_line_content": "        _chunkMap.clear();",
          "content_same": false
        },
        {
          "line": 772,
          "old_api": null,
          "new_api": "clear",
          "old_text": null,
          "new_text": "_chunkRanges.clear()",
          "old_line_content": "        // delete data from mongod",
          "new_line_content": "        _chunkRanges.clear();",
          "content_same": false
        },
        {
          "line": 777,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "seen.end()",
          "old_line_content": "        }",
          "new_line_content": "        for ( set<Shard>::iterator i=seen.begin(); i!=seen.end(); i++ ){",
          "content_same": false
        },
        {
          "line": 780,
          "old_api": null,
          "new_api": "done",
          "old_text": null,
          "new_text": "conn.done()",
          "old_line_content": "",
          "new_line_content": "            conn.done();",
          "content_same": false
        },
        {
          "line": 786,
          "old_api": null,
          "new_api": "removeSharding",
          "old_text": null,
          "new_text": "_config->removeSharding( _ns )",
          "old_line_content": "        // remove chunk data",
          "new_line_content": "        uassert( 10176 ,  \"no sharding data?\" , _config->removeSharding( _ns ) );",
          "content_same": false
        },
        {
          "line": 787,
          "old_api": null,
          "new_api": "save",
          "old_text": null,
          "new_text": "_config->save()",
          "old_line_content": "        static Chunk temp(0);",
          "new_line_content": "        _config->save();",
          "content_same": false
        },
        {
          "line": 792,
          "old_api": null,
          "new_api": "modelServer",
          "old_text": null,
          "new_text": "temp.modelServer()",
          "old_line_content": "        ",
          "new_line_content": "        ScopedDbConnection conn( temp.modelServer() );",
          "content_same": false
        },
        {
          "line": 794,
          "old_api": null,
          "new_api": "done",
          "old_text": null,
          "new_text": "conn.done()",
          "old_line_content": "            ScopedDbConnection conn( *i );",
          "new_line_content": "        conn.done();",
          "content_same": false
        },
        {
          "line": 795,
          "old_api": null,
          "new_api": "log",
          "old_text": null,
          "new_text": "log(1)",
          "old_line_content": "            BSONObj res;",
          "new_line_content": "        log(1) << \"ChunkManager::drop : \" << _ns << \"\\t removed chunk data\" << endl;                ",
          "content_same": false
        },
        {
          "line": 800,
          "old_api": null,
          "new_api": "conn",
          "old_text": null,
          "new_text": "conn.conn()",
          "old_line_content": "",
          "new_line_content": "            if ( ! setShardVersion( conn.conn() , _ns , 0 , true , res ) )",
          "content_same": false
        },
        {
          "line": 801,
          "old_api": null,
          "new_api": "toString",
          "old_text": null,
          "new_text": "res.toString()",
          "old_line_content": "",
          "new_line_content": "                throw UserException( 8071 , (string)\"OH KNOW, cleaning up after drop failed: \" + res.toString() );",
          "content_same": false
        },
        {
          "line": 806,
          "old_api": null,
          "new_api": "log",
          "old_text": null,
          "new_text": "log(1)",
          "old_line_content": "    void ChunkManager::save(){",
          "new_line_content": "        log(1) << \"ChunkManager::drop : \" << _ns << \"\\t DONE\" << endl;        ",
          "content_same": false
        },
        {
          "line": 807,
          "old_api": null,
          "new_api": "BSONObj",
          "old_text": null,
          "new_text": "BSONObj()",
          "old_line_content": "        rwlock lk( _lock , true ); ",
          "new_line_content": "        configServer.logChange( \"dropCollection\" , _ns , BSONObj() );",
          "content_same": false
        },
        {
          "line": 812,
          "old_api": null,
          "new_api": "save_inlock",
          "old_text": null,
          "new_text": "save_inlock()",
          "old_line_content": "        ",
          "new_line_content": "        save_inlock();",
          "content_same": false
        },
        {
          "line": 817,
          "old_api": null,
          "new_api": "getVersion_inlock",
          "old_text": null,
          "new_text": "getVersion_inlock()",
          "old_line_content": "        vector<ShardChunkVersion> newVersions;",
          "new_line_content": "        ShardChunkVersion a = getVersion_inlock();",
          "content_same": false
        },
        {
          "line": 818,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "_chunkMap.size()",
          "old_line_content": "        ",
          "new_line_content": "        assert( a > 0 || _chunkMap.size() <= 1 );",
          "content_same": false
        },
        {
          "line": 819,
          "old_api": null,
          "new_api": "incMajor",
          "old_text": null,
          "new_text": "a.incMajor()",
          "old_line_content": "        BSONObjBuilder cmdBuilder;",
          "new_line_content": "        ShardChunkVersion nextChunkVersion = a.incMajor();",
          "content_same": false
        },
        {
          "line": 828,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "_chunkMap.end()",
          "old_line_content": "",
          "new_line_content": "        for ( ChunkMap::const_iterator i=_chunkMap.begin(); i!=_chunkMap.end(); ++i ){",
          "content_same": false
        },
        {
          "line": 851,
          "old_api": null,
          "new_api": "genID",
          "old_text": null,
          "new_text": "c->genID()",
          "old_line_content": "        }",
          "new_line_content": "            q.append( \"_id\" , c->genID() );",
          "content_same": false
        },
        {
          "line": 852,
          "old_api": null,
          "new_api": "done",
          "old_text": null,
          "new_text": "q.done()",
          "old_line_content": "        ",
          "new_line_content": "            q.done();",
          "content_same": false
        },
        {
          "line": 854,
          "old_api": null,
          "new_api": "obj",
          "old_text": null,
          "new_text": "op.obj()",
          "old_line_content": "            return;",
          "new_line_content": "            updates.append( op.obj() );",
          "content_same": false
        },
        {
          "line": 860,
          "old_api": null,
          "new_api": "done",
          "old_text": null,
          "new_text": "updates.done()",
          "old_line_content": "            BSONObjBuilder b;",
          "new_line_content": "        updates.done();",
          "content_same": false
        },
        {
          "line": 863,
          "old_api": null,
          "new_api": "subarrayStart",
          "old_text": null,
          "new_text": "cmdBuilder.subarrayStart( \"preCondition\" )",
          "old_line_content": "            {",
          "new_line_content": "            BSONArrayBuilder temp( cmdBuilder.subarrayStart( \"preCondition\" ) );",
          "content_same": false
        },
        {
          "line": 870,
          "old_api": null,
          "new_api": "done",
          "old_text": null,
          "new_text": "bb.done()",
          "old_line_content": "        }",
          "new_line_content": "                bb.done();",
          "content_same": false
        },
        {
          "line": 873,
          "old_api": null,
          "new_api": "done",
          "old_text": null,
          "new_text": "temp.done()",
          "old_line_content": "        ",
          "new_line_content": "            temp.done();",
          "content_same": false
        },
        {
          "line": 880,
          "old_api": null,
          "new_api": "modelServer",
          "old_text": null,
          "new_text": "Chunk(0).modelServer()",
          "old_line_content": "",
          "new_line_content": "        ScopedDbConnection conn( Chunk(0).modelServer() );",
          "content_same": false
        },
        {
          "line": 882,
          "old_api": null,
          "new_api": "runCommand",
          "old_text": null,
          "new_text": "conn->runCommand( \"config\" , cmd , res )",
          "old_line_content": "            stringstream ss;",
          "new_line_content": "        bool ok = conn->runCommand( \"config\" , cmd , res );",
          "content_same": false
        },
        {
          "line": 883,
          "old_api": null,
          "new_api": "done",
          "old_text": null,
          "new_text": "conn.done()",
          "old_line_content": "            ss << \"saving chunks failed.  cmd: \" << cmd << \" result: \" << res;",
          "new_line_content": "        conn.done();",
          "content_same": false
        },
        {
          "line": 889,
          "old_api": null,
          "new_api": "str",
          "old_text": null,
          "new_text": "ss.str()",
          "old_line_content": "            toFix[i]->_lastmod = newVersions[i];",
          "new_line_content": "            msgasserted( 13327 , ss.str() );",
          "content_same": false
        },
        {
          "line": 896,
          "old_api": null,
          "new_api": "getVersion_inlock",
          "old_text": null,
          "new_text": "getVersion_inlock()",
          "old_line_content": "    ",
          "new_line_content": "        massert( 10417 ,  \"how did version get smalled\" , getVersion_inlock() >= a );",
          "content_same": false
        },
        {
          "line": 906,
          "old_api": null,
          "new_api": "pickSplitVector",
          "old_text": null,
          "new_text": "soleChunk->pickSplitVector( &splitPoints )",
          "old_line_content": "        }",
          "new_line_content": "        soleChunk->pickSplitVector( &splitPoints );",
          "content_same": false
        },
        {
          "line": 907,
          "old_api": null,
          "new_api": "empty",
          "old_text": null,
          "new_text": "splitPoints.empty()",
          "old_line_content": "",
          "new_line_content": "        if ( splitPoints.empty() ){",
          "content_same": false
        },
        {
          "line": 912,
          "old_api": null,
          "new_api": "multiSplit",
          "old_text": null,
          "new_text": "soleChunk->multiSplit( splitPoints )",
          "old_line_content": "        rwlock lk( _lock , false ); ",
          "new_line_content": "        soleChunk->multiSplit( splitPoints );",
          "content_same": false
        },
        {
          "line": 921,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "_chunkMap.end()",
          "old_line_content": "                continue;",
          "new_line_content": "        for ( ChunkMap::const_iterator i=_chunkMap.begin(); i!=_chunkMap.end(); ++i ){",
          "content_same": false
        },
        {
          "line": 924,
          "old_api": null,
          "new_api": "getShard",
          "old_text": null,
          "new_text": "c->getShard()",
          "old_line_content": "        }        ",
          "new_line_content": "            if ( c->getShard() != shard )",
          "content_same": false
        },
        {
          "line": 934,
          "old_api": null,
          "new_api": "getVersion_inlock",
          "old_text": null,
          "new_text": "getVersion_inlock()",
          "old_line_content": "        ShardChunkVersion max = 0;",
          "new_line_content": "        return getVersion_inlock();",
          "content_same": false
        },
        {
          "line": 940,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "_chunkMap.end()",
          "old_line_content": "        }        ",
          "new_line_content": "        for ( ChunkMap::const_iterator i=_chunkMap.begin(); i!=_chunkMap.end(); ++i ){",
          "content_same": false
        },
        {
          "line": 953,
          "old_api": null,
          "new_api": "toString",
          "old_text": null,
          "new_text": "_key.toString()",
          "old_line_content": "        }",
          "new_line_content": "        ss << \"ChunkManager: \" << _ns << \" key:\" << _key.toString() << '\\n';",
          "content_same": false
        },
        {
          "line": 956,
          "old_api": null,
          "new_api": "toString",
          "old_text": null,
          "new_text": "c->toString()",
          "old_line_content": "",
          "new_line_content": "            ss << \"\\t\" << c->toString() << '\\n';",
          "content_same": false
        },
        {
          "line": 962,
          "old_api": null,
          "new_api": "getMax",
          "old_text": null,
          "new_text": "c->getMax()",
          "old_line_content": "    ",
          "new_line_content": "        _chunkRanges.reloadRange(_chunkMap, c->getMin(), c->getMax());",
          "content_same": false
        },
        {
          "line": 963,
          "old_api": null,
          "new_api": "getShard",
          "old_text": null,
          "new_text": "c->getShard()",
          "old_line_content": "    void ChunkRangeManager::assertValid() const{",
          "new_line_content": "        _shards.insert(c->getShard());",
          "content_same": false
        },
        {
          "line": 968,
          "old_api": null,
          "new_api": "empty",
          "old_text": null,
          "new_text": "_ranges.empty()",
          "old_line_content": "            // No Nulls",
          "new_line_content": "        if (_ranges.empty())",
          "content_same": false
        },
        {
          "line": 973,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "_ranges.end()",
          "old_line_content": "            // Check endpoints",
          "new_line_content": "            for (ChunkRangeMap::const_iterator it=_ranges.begin(), end=_ranges.end(); it != end; ++it){",
          "content_same": false
        },
        {
          "line": 982,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "_ranges.end()",
          "old_line_content": "",
          "new_line_content": "            for (ChunkRangeMap::const_iterator it=boost::next(_ranges.begin()), end=_ranges.end(); it != end; ++it){",
          "content_same": false
        },
        {
          "line": 983,
          "old_api": null,
          "new_api": "prior",
          "old_text": null,
          "new_text": "prior(it)",
          "old_line_content": "            // Check Map keys",
          "new_line_content": "                ChunkRangeMap::const_iterator last = prior(it);",
          "content_same": false
        },
        {
          "line": 988,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "_ranges.end()",
          "old_line_content": "            // Make sure we match the original chunks",
          "new_line_content": "            for (ChunkRangeMap::const_iterator it=_ranges.begin(), end=_ranges.end(); it != end; ++it){",
          "content_same": false
        },
        {
          "line": 1002,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(min == max)",
          "old_line_content": "            }",
          "new_line_content": "                assert(min == max);",
          "content_same": false
        },
        {
          "line": 1003,
          "old_api": null,
          "new_api": "getShard",
          "old_text": null,
          "new_text": "chunk->getShard()",
          "old_line_content": "            ",
          "new_line_content": "                assert(min->second->getShard() == chunk->getShard());",
          "content_same": false
        },
        {
          "line": 1004,
          "old_api": null,
          "new_api": "getMin",
          "old_text": null,
          "new_text": "chunk->getMin()",
          "old_line_content": "        } catch (...) {",
          "new_line_content": "                assert(min->second->contains( chunk->getMin() ));",
          "content_same": false
        },
        {
          "line": 1009,
          "old_api": null,
          "new_api": "log",
          "old_text": null,
          "new_text": "log( LL_ERROR )",
          "old_line_content": "",
          "new_line_content": "            log( LL_ERROR ) << \"\\t invalid ChunkRangeMap! printing ranges:\" << endl;",
          "content_same": false
        },
        {
          "line": 1011,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "_ranges.end()",
          "old_line_content": "        }",
          "new_line_content": "            for (ChunkRangeMap::const_iterator it=_ranges.begin(), end=_ranges.end(); it != end; ++it)",
          "content_same": false
        },
        {
          "line": 1019,
          "old_api": null,
          "new_api": "empty",
          "old_text": null,
          "new_text": "_ranges.empty()",
          "old_line_content": "        ",
          "new_line_content": "        if (_ranges.empty()){",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 1026,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(high->second)",
          "new_text": null,
          "old_line_content": "        assert(high->second);",
          "new_line_content": "        ",
          "content_same": false
        },
        {
          "line": 1031,
          "old_api": "end",
          "new_api": null,
          "old_text": "chunks.end()",
          "new_text": null,
          "old_line_content": "        assert(begin != chunks.end());",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1039,
          "old_api": "erase",
          "new_api": null,
          "old_text": "_ranges.erase(low, high)",
          "new_text": null,
          "old_line_content": "        _ranges.erase(low, high); // invalidates low",
          "new_line_content": "        ++high;",
          "content_same": false
        },
        {
          "line": 1040,
          "old_api": "_insertRange",
          "new_api": null,
          "old_text": "_insertRange(begin, end)",
          "new_text": null,
          "old_line_content": "        _insertRange(begin, end);",
          "new_line_content": "        ++end;",
          "content_same": false
        },
        {
          "line": 1042,
          "old_api": "empty",
          "new_api": null,
          "old_text": "_ranges.empty()",
          "new_text": null,
          "old_line_content": "        assert(!_ranges.empty());",
          "new_line_content": "        // update ranges",
          "content_same": false
        },
        {
          "line": 1047,
          "old_api": "end",
          "new_api": null,
          "old_text": "_ranges.end()",
          "new_text": null,
          "old_line_content": "        assert(low != _ranges.end());",
          "new_line_content": "        DEV assertValid();",
          "content_same": false
        },
        {
          "line": 1048,
          "old_api": "begin",
          "new_api": null,
          "old_text": "_ranges.begin()",
          "new_text": null,
          "old_line_content": "        if (low != _ranges.begin()){",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1049,
          "old_api": "prior",
          "new_api": null,
          "old_text": "prior(low)",
          "new_text": null,
          "old_line_content": "            shared_ptr<ChunkRange> a = prior(low)->second;",
          "new_line_content": "        // merge low-end if possible",
          "content_same": false
        },
        {
          "line": 1054,
          "old_api": "erase",
          "new_api": null,
          "old_text": "_ranges.erase(low)",
          "new_text": null,
          "old_line_content": "                _ranges.erase(low); // invalidates low",
          "new_line_content": "            shared_ptr<ChunkRange> b = low->second;",
          "content_same": false
        },
        {
          "line": 1062,
          "old_api": "lower_bound",
          "new_api": null,
          "old_text": "_ranges.lower_bound(max)",
          "new_text": null,
          "old_line_content": "        high = _ranges.lower_bound(max);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1063,
          "old_api": "end",
          "new_api": null,
          "old_text": "_ranges.end()",
          "new_text": null,
          "old_line_content": "        if (high != prior(_ranges.end())){",
          "new_line_content": "        DEV assertValid();",
          "content_same": false
        },
        {
          "line": 1065,
          "old_api": "boost::next(high)",
          "new_api": null,
          "old_text": "boost::next(high)",
          "new_text": null,
          "old_line_content": "            shared_ptr<ChunkRange> b = boost::next(high)->second;",
          "new_line_content": "        // merge high-end if possible",
          "content_same": false
        },
        {
          "line": 1068,
          "old_api": "boost::next(high)",
          "new_api": null,
          "old_text": "boost::next(high)",
          "new_text": null,
          "old_line_content": "                _ranges.erase(boost::next(high));",
          "new_line_content": "            shared_ptr<ChunkRange> a = high->second;",
          "content_same": false
        },
        {
          "line": 1078,
          "old_api": "clear",
          "new_api": null,
          "old_text": "_ranges.clear()",
          "new_text": null,
          "old_line_content": "        _ranges.clear();",
          "new_line_content": "        DEV assertValid();",
          "content_same": false
        },
        {
          "line": 1079,
          "old_api": "end",
          "new_api": null,
          "old_text": "chunks.end()",
          "new_text": null,
          "old_line_content": "        _insertRange(chunks.begin(), chunks.end());",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1087,
          "old_api": "getShard",
          "new_api": null,
          "old_text": "first->second->getShard()",
          "new_text": null,
          "old_line_content": "            Shard shard = first->second->getShard();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1088,
          "old_api": "getShard",
          "new_api": null,
          "old_text": "begin->second->getShard()",
          "new_text": null,
          "old_line_content": "            while (begin != end && (begin->second->getShard() == shard))",
          "new_line_content": "    void ChunkRangeManager::_insertRange(ChunkMap::const_iterator begin, const ChunkMap::const_iterator end){",
          "content_same": false
        },
        {
          "line": 1100,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert( ! c )",
          "new_text": null,
          "old_line_content": "            assert( ! c );",
          "new_line_content": "    class ChunkObjUnitTest : public UnitTest {",
          "content_same": false
        },
        {
          "line": 1101,
          "old_api": "reset",
          "new_api": null,
          "old_text": "c.reset( new Chunk( 0 ) )",
          "new_text": null,
          "old_line_content": "            c.reset( new Chunk( 0 ) );",
          "new_line_content": "    public:",
          "content_same": false
        },
        {
          "line": 1102,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert( c )",
          "new_text": null,
          "old_line_content": "            assert( c );",
          "new_line_content": "        void runShard(){",
          "content_same": false
        },
        {
          "line": 1107,
          "old_api": "ShardChunkVersion",
          "new_api": null,
          "old_text": "ShardChunkVersion(1,1)",
          "new_text": null,
          "old_line_content": "            all.push_back( ShardChunkVersion(1,1) );",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 1108,
          "old_api": "ShardChunkVersion",
          "new_api": null,
          "old_text": "ShardChunkVersion(1,2)",
          "new_text": null,
          "old_line_content": "            all.push_back( ShardChunkVersion(1,2) );",
          "new_line_content": "        ",
          "content_same": false
        },
        {
          "line": 1109,
          "old_api": "ShardChunkVersion",
          "new_api": null,
          "old_text": "ShardChunkVersion(2,1)",
          "new_text": null,
          "old_line_content": "            all.push_back( ShardChunkVersion(2,1) );",
          "new_line_content": "        void runShardChunkVersion(){",
          "content_same": false
        },
        {
          "line": 1110,
          "old_api": "ShardChunkVersion",
          "new_api": null,
          "old_text": "ShardChunkVersion(2,2)",
          "new_text": null,
          "old_line_content": "            all.push_back( ShardChunkVersion(2,2) );",
          "new_line_content": "            vector<ShardChunkVersion> all;",
          "content_same": false
        },
        {
          "line": 1121,
          "old_api": "runShard",
          "new_api": null,
          "old_text": "runShard()",
          "new_text": null,
          "old_line_content": "            runShard();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1122,
          "old_api": "runShardChunkVersion",
          "new_api": null,
          "old_text": "runShardChunkVersion()",
          "new_text": null,
          "old_line_content": "            runShardChunkVersion();",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 1123,
          "old_api": "log",
          "new_api": null,
          "old_text": "log(1)",
          "new_text": null,
          "old_line_content": "            log(1) << \"shardObjTest passed\" << endl;",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1132,
          "old_api": "c_str",
          "new_api": null,
          "old_text": "ns.c_str()",
          "new_text": null,
          "old_line_content": "        cmdBuilder.append( \"setShardVersion\" , ns.c_str() );",
          "new_line_content": "    // ----- to be removed ---",
          "content_same": false
        },
        {
          "line": 1133,
          "old_api": "modelServer",
          "new_api": null,
          "old_text": "configServer.modelServer()",
          "new_text": null,
          "old_line_content": "        cmdBuilder.append( \"configdb\" , configServer.modelServer() );",
          "new_line_content": "    extern OID serverID;",
          "content_same": false
        },
        {
          "line": 1134,
          "old_api": "toLong",
          "new_api": null,
          "old_text": "version.toLong()",
          "new_text": null,
          "old_line_content": "        cmdBuilder.appendTimestamp( \"version\" , version.toLong() );",
          "new_line_content": "    bool setShardVersion( DBClientBase & conn , const string& ns , ShardChunkVersion version , bool authoritative , BSONObj& result ){",
          "content_same": false
        },
        {
          "line": 1135,
          "old_api": "appendOID",
          "new_api": null,
          "old_text": "cmdBuilder.appendOID( \"serverID\" , &serverID )",
          "new_text": null,
          "old_line_content": "        cmdBuilder.appendOID( \"serverID\" , &serverID );",
          "new_line_content": "        BSONObjBuilder cmdBuilder;",
          "content_same": false
        },
        {
          "line": 1140,
          "old_api": "getName",
          "new_api": null,
          "old_text": "s.getName()",
          "new_text": null,
          "old_line_content": "        cmdBuilder.append( \"shard\" , s.getName() );",
          "new_line_content": "        if ( authoritative )",
          "content_same": false
        },
        {
          "line": 1142,
          "old_api": "obj",
          "new_api": null,
          "old_text": "cmdBuilder.obj()",
          "new_text": null,
          "old_line_content": "        BSONObj cmd = cmdBuilder.obj();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 728,
          "old_api": "ensureIndex_inlock",
          "new_api": null,
          "old_text": "ensureIndex_inlock()",
          "new_text": null,
          "old_line_content": "        ensureIndex_inlock();",
          "new_line_content": "        all = _shards;",
          "content_same": false
        },
        {
          "line": 734,
          "old_api": "end",
          "new_api": null,
          "old_text": "_chunkMap.end()",
          "new_text": null,
          "old_line_content": "        for ( ChunkMap::const_iterator i=_chunkMap.begin(); i!=_chunkMap.end(); ++i ){",
          "new_line_content": "    ",
          "content_same": false
        },
        {
          "line": 736,
          "old_api": "getShard",
          "new_api": null,
          "old_text": "c->getShard()",
          "new_text": null,
          "old_line_content": "            if ( seen.count( c->getShard() ) )",
          "new_line_content": "        set<Shard> seen;",
          "content_same": false
        },
        {
          "line": 739,
          "old_api": "ensureIndex",
          "new_api": null,
          "old_text": "c->ensureIndex()",
          "new_text": null,
          "old_line_content": "            c->ensureIndex();",
          "new_line_content": "            ChunkPtr c = i->second;",
          "content_same": false
        },
        {
          "line": 746,
          "old_api": "BSONObj",
          "new_api": null,
          "old_text": "BSONObj()",
          "new_text": null,
          "old_line_content": "        configServer.logChange( \"dropCollection.start\" , _ns , BSONObj() );",
          "new_line_content": "    ",
          "content_same": false
        },
        {
          "line": 748,
          "old_api": "getns",
          "new_api": null,
          "old_text": "getns()",
          "new_text": null,
          "old_line_content": "        DistributedLock lockSetup( ConnectionString( configServer.modelServer() , ConnectionString::SYNC ) , getns() );",
          "new_line_content": "        rwlock lk( _lock , true ); ",
          "content_same": false
        },
        {
          "line": 759,
          "old_api": "end",
          "new_api": null,
          "old_text": "_chunkMap.end()",
          "new_text": null,
          "old_line_content": "        for ( ChunkMap::const_iterator i=_chunkMap.begin(); i!=_chunkMap.end(); ++i ){",
          "new_line_content": "        ",
          "content_same": false
        },
        {
          "line": 761,
          "old_api": "getShard",
          "new_api": null,
          "old_text": "c->getShard()",
          "new_text": null,
          "old_line_content": "            seen.insert( c->getShard() );",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 764,
          "old_api": "log",
          "new_api": null,
          "old_text": "log(1)",
          "new_text": null,
          "old_line_content": "        log(1) << \"ChunkManager::drop : \" << _ns << \"\\t all locked\" << endl;        ",
          "new_line_content": "            ChunkPtr c = i->second;",
          "content_same": false
        },
        {
          "line": 767,
          "old_api": "clear",
          "new_api": null,
          "old_text": "_chunkMap.clear()",
          "new_text": null,
          "old_line_content": "        _chunkMap.clear();",
          "new_line_content": "        ",
          "content_same": false
        },
        {
          "line": 769,
          "old_api": "clear",
          "new_api": null,
          "old_text": "_shards.clear()",
          "new_text": null,
          "old_line_content": "        _shards.clear();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 775,
          "old_api": "dropCollection",
          "new_api": null,
          "old_text": "conn->dropCollection( _ns )",
          "new_text": null,
          "old_line_content": "            conn->dropCollection( _ns );",
          "new_line_content": "        ",
          "content_same": false
        },
        {
          "line": 776,
          "old_api": "done",
          "new_api": null,
          "old_text": "conn.done()",
          "new_text": null,
          "old_line_content": "            conn.done();",
          "new_line_content": "        // delete data from mongod",
          "content_same": false
        },
        {
          "line": 782,
          "old_api": "removeSharding",
          "new_api": null,
          "old_text": "_config->removeSharding( _ns )",
          "new_text": null,
          "old_line_content": "        uassert( 10176 ,  \"no sharding data?\" , _config->removeSharding( _ns ) );",
          "new_line_content": "        ",
          "content_same": false
        },
        {
          "line": 788,
          "old_api": "modelServer",
          "new_api": null,
          "old_text": "temp.modelServer()",
          "new_text": null,
          "old_line_content": "        ScopedDbConnection conn( temp.modelServer() );",
          "new_line_content": "        ",
          "content_same": false
        },
        {
          "line": 789,
          "old_api": "BSON",
          "new_api": null,
          "old_text": "BSON( \"ns\" << _ns )",
          "new_text": null,
          "old_line_content": "        conn->remove( temp.getNS() , BSON( \"ns\" << _ns ) );",
          "new_line_content": "        ",
          "content_same": false
        },
        {
          "line": 790,
          "old_api": "done",
          "new_api": null,
          "old_text": "conn.done()",
          "new_text": null,
          "old_line_content": "        conn.done();",
          "new_line_content": "        // remove chunk data",
          "content_same": false
        },
        {
          "line": 791,
          "old_api": "log",
          "new_api": null,
          "old_text": "log(1)",
          "new_text": null,
          "old_line_content": "        log(1) << \"ChunkManager::drop : \" << _ns << \"\\t removed chunk data\" << endl;                ",
          "new_line_content": "        static Chunk temp(0);",
          "content_same": false
        },
        {
          "line": 796,
          "old_api": "conn",
          "new_api": null,
          "old_text": "conn.conn()",
          "new_text": null,
          "old_line_content": "            if ( ! setShardVersion( conn.conn() , _ns , 0 , true , res ) )",
          "new_line_content": "        ",
          "content_same": false
        },
        {
          "line": 798,
          "old_api": "done",
          "new_api": null,
          "old_text": "conn.done()",
          "new_text": null,
          "old_line_content": "            conn.done();",
          "new_line_content": "            ScopedDbConnection conn( *i );",
          "content_same": false
        },
        {
          "line": 803,
          "old_api": "BSONObj",
          "new_api": null,
          "old_text": "BSONObj()",
          "new_text": null,
          "old_line_content": "        configServer.logChange( \"dropCollection\" , _ns , BSONObj() );",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 808,
          "old_api": "save_inlock",
          "new_api": null,
          "old_text": "save_inlock()",
          "new_text": null,
          "old_line_content": "        save_inlock();",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 813,
          "old_api": "getVersion_inlock",
          "new_api": null,
          "old_text": "getVersion_inlock()",
          "new_text": null,
          "old_line_content": "        ShardChunkVersion a = getVersion_inlock();",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 814,
          "old_api": "size",
          "new_api": null,
          "old_text": "_chunkMap.size()",
          "new_text": null,
          "old_line_content": "        assert( a > 0 || _chunkMap.size() <= 1 );",
          "new_line_content": "    ",
          "content_same": false
        },
        {
          "line": 815,
          "old_api": "incMajor",
          "new_api": null,
          "old_text": "a.incMajor()",
          "new_text": null,
          "old_line_content": "        ShardChunkVersion nextChunkVersion = a.incMajor();",
          "new_line_content": "    void ChunkManager::save_inlock(){",
          "content_same": false
        },
        {
          "line": 820,
          "old_api": "subarrayStart",
          "new_api": null,
          "old_text": "cmdBuilder.subarrayStart( \"applyOps\" )",
          "new_text": null,
          "old_line_content": "        BSONArrayBuilder updates( cmdBuilder.subarrayStart( \"applyOps\" ) );",
          "new_line_content": "        vector<ChunkPtr> toFix;",
          "content_same": false
        },
        {
          "line": 834,
          "old_api": "push_back",
          "new_api": null,
          "old_text": "toFix.push_back( c )",
          "new_text": null,
          "old_line_content": "            toFix.push_back( c );",
          "new_line_content": "            _sequenceNumber = ++NextSequenceNumber;",
          "content_same": false
        },
        {
          "line": 835,
          "old_api": "push_back",
          "new_api": null,
          "old_text": "newVersions.push_back( myVersion )",
          "new_text": null,
          "old_line_content": "            newVersions.push_back( myVersion );",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 840,
          "old_api": "append",
          "new_api": null,
          "old_text": "op.append( \"ns\" , ShardNS::chunk )",
          "new_text": null,
          "old_line_content": "            op.append( \"ns\" , ShardNS::chunk );",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 856,
          "old_api": "done",
          "new_api": null,
          "old_text": "updates.done()",
          "new_text": null,
          "old_line_content": "        updates.done();",
          "new_line_content": "        ",
          "content_same": false
        },
        {
          "line": 858,
          "old_api": "size",
          "new_api": null,
          "old_text": "_chunkMap.size()",
          "new_text": null,
          "old_line_content": "        if ( a > 0 || _chunkMap.size() > 1 ){",
          "new_line_content": "            return;",
          "content_same": false
        },
        {
          "line": 859,
          "old_api": "subarrayStart",
          "new_api": null,
          "old_text": "cmdBuilder.subarrayStart( \"preCondition\" )",
          "new_text": null,
          "old_line_content": "            BSONArrayBuilder temp( cmdBuilder.subarrayStart( \"preCondition\" ) );",
          "new_line_content": "        ",
          "content_same": false
        },
        {
          "line": 861,
          "old_api": "append",
          "new_api": null,
          "old_text": "b.append( \"ns\" , ShardNS::chunk )",
          "new_text": null,
          "old_line_content": "            b.append( \"ns\" , ShardNS::chunk );",
          "new_line_content": "        ",
          "content_same": false
        },
        {
          "line": 864,
          "old_api": "subobjStart",
          "new_api": null,
          "old_text": "b.subobjStart( \"res\" )",
          "new_text": null,
          "old_line_content": "                BSONObjBuilder bb( b.subobjStart( \"res\" ) );",
          "new_line_content": "            BSONObjBuilder b;",
          "content_same": false
        },
        {
          "line": 874,
          "old_api": "log",
          "new_api": null,
          "old_text": "log(7)",
          "new_text": null,
          "old_line_content": "        log(7) << \"ChunkManager::save update: \" << cmd << endl;",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 879,
          "old_api": "done",
          "new_api": null,
          "old_text": "conn.done()",
          "new_text": null,
          "old_line_content": "        conn.done();",
          "new_line_content": "        ",
          "content_same": false
        },
        {
          "line": 884,
          "old_api": "str",
          "new_api": null,
          "old_text": "ss.str()",
          "new_text": null,
          "old_line_content": "            log( LL_ERROR ) << ss.str() << endl;",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 885,
          "old_api": "str",
          "new_api": null,
          "old_text": "ss.str()",
          "new_text": null,
          "old_line_content": "            msgasserted( 13327 , ss.str() );",
          "new_line_content": "        if ( ! ok ){",
          "content_same": false
        },
        {
          "line": 894,
          "old_api": "ensureIndex_inlock",
          "new_api": null,
          "old_text": "ensureIndex_inlock()",
          "new_text": null,
          "old_line_content": "        ensureIndex_inlock(); // TODO: this is too aggressive - but not really sooo bad",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 900,
          "old_api": "begin",
          "new_api": null,
          "old_text": "_chunkMap.begin()",
          "new_text": null,
          "old_line_content": "        ChunkPtr soleChunk = _chunkMap.begin()->second;",
          "new_line_content": "    ",
          "content_same": false
        },
        {
          "line": 903,
          "old_api": "empty",
          "new_api": null,
          "old_text": "splitPoints.empty()",
          "new_text": null,
          "old_line_content": "        if ( splitPoints.empty() ){",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 917,
          "old_api": "end",
          "new_api": null,
          "old_text": "_chunkMap.end()",
          "new_text": null,
          "old_line_content": "        for ( ChunkMap::const_iterator i=_chunkMap.begin(); i!=_chunkMap.end(); ++i ){",
          "new_line_content": "        // TODO: cache or something?",
          "content_same": false
        },
        {
          "line": 920,
          "old_api": "getShard",
          "new_api": null,
          "old_text": "c->getShard()",
          "new_text": null,
          "old_line_content": "            if ( c->getShard() != shard )",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 930,
          "old_api": "getVersion_inlock",
          "new_api": null,
          "old_text": "getVersion_inlock()",
          "new_text": null,
          "old_line_content": "        return getVersion_inlock();",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 936,
          "old_api": "end",
          "new_api": null,
          "old_text": "_chunkMap.end()",
          "new_text": null,
          "old_line_content": "        for ( ChunkMap::const_iterator i=_chunkMap.begin(); i!=_chunkMap.end(); ++i ){",
          "new_line_content": "    ",
          "content_same": false
        },
        {
          "line": 949,
          "old_api": "toString",
          "new_api": null,
          "old_text": "_key.toString()",
          "new_text": null,
          "old_line_content": "        ss << \"ChunkManager: \" << _ns << \" key:\" << _key.toString() << '\\n';",
          "new_line_content": "    string ChunkManager::toString() const {",
          "content_same": false
        },
        {
          "line": 950,
          "old_api": "end",
          "new_api": null,
          "old_text": "_chunkMap.end()",
          "new_text": null,
          "old_line_content": "        for ( ChunkMap::const_iterator i=_chunkMap.begin(); i!=_chunkMap.end(); ++i ){",
          "new_line_content": "        rwlock lk( _lock , false );         ",
          "content_same": false
        },
        {
          "line": 952,
          "old_api": "toString",
          "new_api": null,
          "old_text": "c->toString()",
          "new_text": null,
          "old_line_content": "            ss << \"\\t\" << c->toString() << '\\n';",
          "new_line_content": "        stringstream ss;",
          "content_same": false
        },
        {
          "line": 959,
          "old_api": "getShard",
          "new_api": null,
          "old_text": "c->getShard()",
          "new_text": null,
          "old_line_content": "        _shards.insert(c->getShard());",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 964,
          "old_api": "empty",
          "new_api": null,
          "old_text": "_ranges.empty()",
          "new_text": null,
          "old_line_content": "        if (_ranges.empty())",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 969,
          "old_api": "end",
          "new_api": null,
          "old_text": "_ranges.end()",
          "new_text": null,
          "old_line_content": "            for (ChunkRangeMap::const_iterator it=_ranges.begin(), end=_ranges.end(); it != end; ++it){",
          "new_line_content": "            return;",
          "content_same": false
        },
        {
          "line": 970,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(it->second)",
          "new_text": null,
          "old_line_content": "                assert(it->second);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 975,
          "old_api": "end",
          "new_api": null,
          "old_text": "_ranges.end()",
          "new_text": null,
          "old_line_content": "            assert(allOfType(MaxKey, prior(_ranges.end())->second->getMax()));",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 980,
          "old_api": "getMax",
          "new_api": null,
          "old_text": "last->second->getMax()",
          "new_text": null,
          "old_line_content": "                assert(it->second->getMin() == last->second->getMax());",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 985,
          "old_api": "getMax",
          "new_api": null,
          "old_text": "it->second->getMax()",
          "new_text": null,
          "old_line_content": "                assert(it->first == it->second->getMax());",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 990,
          "old_api": "end",
          "new_api": null,
          "old_text": "chunks.end()",
          "new_text": null,
          "old_line_content": "            for ( ChunkMap::const_iterator i=chunks.begin(); i!=chunks.end(); ++i ){",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 996,
          "old_api": "end",
          "new_api": null,
          "old_text": "_ranges.end()",
          "new_text": null,
          "old_line_content": "                assert(min != _ranges.end());",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 999,
          "old_api": "getShard",
          "new_api": null,
          "old_text": "chunk->getShard()",
          "new_text": null,
          "old_line_content": "                assert(min->second->getShard() == chunk->getShard());",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1007,
          "old_api": "end",
          "new_api": null,
          "old_text": "_ranges.end()",
          "new_text": null,
          "old_line_content": "            for (ChunkRangeMap::const_iterator it=_ranges.begin(), end=_ranges.end(); it != end; ++it)",
          "new_line_content": "            ",
          "content_same": false
        },
        {
          "line": 1015,
          "old_api": "empty",
          "new_api": null,
          "old_text": "_ranges.empty()",
          "new_text": null,
          "old_line_content": "        if (_ranges.empty()){",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 1016,
          "old_api": "reloadAll",
          "new_api": null,
          "old_text": "reloadAll(chunks)",
          "new_text": null,
          "old_line_content": "            reloadAll(chunks);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1021,
          "old_api": "lower_bound",
          "new_api": null,
          "old_text": "_ranges.lower_bound(max)",
          "new_text": null,
          "old_line_content": "        ChunkRangeMap::iterator high = _ranges.lower_bound(max);",
          "new_line_content": "            return;",
          "content_same": false
        },
        {
          "line": 1023,
          "old_api": "end",
          "new_api": null,
          "old_text": "_ranges.end()",
          "new_text": null,
          "old_line_content": "        assert(low != _ranges.end());",
          "new_line_content": "        ",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 67,
      "total_additions": 97,
      "total_deletions": 96,
      "total_api_changes": 260
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 4,
        "api_related_lines": 260,
        "non_api_lines": 3,
        "non_api_line_numbers": [
          721,
          718,
          719
        ]
      }
    },
    "api_calls_before": 672,
    "api_calls_after": 674,
    "diff_info": {
      "added_lines": 4,
      "removed_lines": 0,
      "total_diff_lines": 16
    }
  }
}