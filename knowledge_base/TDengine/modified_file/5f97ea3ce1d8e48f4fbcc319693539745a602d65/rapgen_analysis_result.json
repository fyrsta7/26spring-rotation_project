{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/TDengine/modified_file/5f97ea3ce1d8e48f4fbcc319693539745a602d65",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/TDengine/modified_file/5f97ea3ce1d8e48f4fbcc319693539745a602d65/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/TDengine/modified_file/5f97ea3ce1d8e48f4fbcc319693539745a602d65/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/TDengine/modified_file/5f97ea3ce1d8e48f4fbcc319693539745a602d65/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 479,
          "old_api": "tsdbMemSkipListRandLevel",
          "new_api": "ASSERT",
          "old_text": "tsdbMemSkipListRandLevel(&pTbData->sl)",
          "new_text": "ASSERT(pPool != NULL)",
          "old_line_content": "  level = tsdbMemSkipListRandLevel(&pTbData->sl);",
          "new_line_content": "  ASSERT(pPool != NULL);",
          "content_same": false
        },
        {
          "line": 480,
          "old_api": "ASSERT",
          "new_api": "tPutTSDBRow",
          "old_text": "ASSERT(pPool != NULL)",
          "new_text": "tPutTSDBRow(NULL, pRow)",
          "old_line_content": "  ASSERT(pPool != NULL);",
          "new_line_content": "  pNode = (SMemSkipListNode *)vnodeBufPoolMalloc(pPool, SL_NODE_SIZE(level) + tPutTSDBRow(NULL, pRow));",
          "content_same": false
        },
        {
          "line": 496,
          "old_api": "SL_NODE_BACKWARD",
          "new_api": "SL_NODE_FORWARD",
          "old_text": "SL_NODE_BACKWARD(pNode, iLevel)",
          "new_text": "SL_NODE_FORWARD(pNode, iLevel)",
          "old_line_content": "      SL_NODE_BACKWARD(pNode, iLevel) = pn;",
          "new_line_content": "      SL_NODE_FORWARD(pNode, iLevel) = px;",
          "content_same": false
        },
        {
          "line": 501,
          "old_api": "SL_NODE_BACKWARD",
          "new_api": "SL_NODE_FORWARD",
          "old_text": "SL_NODE_BACKWARD(pNode, iLevel)",
          "new_text": "SL_NODE_FORWARD(pNode, iLevel)",
          "old_line_content": "      SL_NODE_BACKWARD(pNode, iLevel) = px;",
          "new_line_content": "      SL_NODE_FORWARD(pNode, iLevel) = pn;",
          "content_same": false
        },
        {
          "line": 513,
          "old_api": "SL_NODE_FORWARD",
          "new_api": "SL_NODE_BACKWARD",
          "old_text": "SL_NODE_FORWARD(pn, iLevel)",
          "new_text": "SL_NODE_BACKWARD(px, iLevel)",
          "old_line_content": "      SL_NODE_FORWARD(pn, iLevel) = pNode;",
          "new_line_content": "      SL_NODE_BACKWARD(px, iLevel) = pNode;",
          "content_same": false
        },
        {
          "line": 518,
          "old_api": "SL_NODE_FORWARD",
          "new_api": "SL_NODE_BACKWARD",
          "old_text": "SL_NODE_FORWARD(px, iLevel)",
          "new_text": "SL_NODE_BACKWARD(pn, iLevel)",
          "old_line_content": "      SL_NODE_FORWARD(px, iLevel) = pNode;",
          "new_line_content": "      SL_NODE_BACKWARD(pn, iLevel) = pNode;",
          "content_same": false
        },
        {
          "line": 552,
          "old_api": "tbDataMovePosTo",
          "new_api": "tbDataDoPut",
          "old_text": "tbDataMovePosTo(pTbData, pos, &key, SL_MOVE_BACKWARD)",
          "new_text": "tbDataDoPut(pMemTable, pTbData, pos, &row, 0)",
          "old_line_content": "  tbDataMovePosTo(pTbData, pos, &key, SL_MOVE_BACKWARD);",
          "new_line_content": "  code = tbDataDoPut(pMemTable, pTbData, pos, &row, 0);",
          "content_same": false
        },
        {
          "line": 571,
          "old_api": "SL_NODE_FORWARD",
          "new_api": "tbDataMovePosTo",
          "old_text": "SL_NODE_FORWARD(pos[0], 0)",
          "new_text": "tbDataMovePosTo(pTbData, pos, &key, SL_MOVE_FROM_POS)",
          "old_line_content": "      if (SL_NODE_FORWARD(pos[0], 0) != pTbData->sl.pTail) {",
          "new_line_content": "        tbDataMovePosTo(pTbData, pos, &key, SL_MOVE_FROM_POS);",
          "content_same": false
        },
        {
          "line": 590,
          "old_api": "TSDB_CACHE_LAST_ROW",
          "new_api": "tsdbCacheInsertLastrow",
          "old_text": "TSDB_CACHE_LAST_ROW(pMemTable->pTsdb->pVnode->config)",
          "new_text": "tsdbCacheInsertLastrow(pMemTable->pTsdb->lruCache, pMemTable->pTsdb, pTbData->uid, pLastRow, true)",
          "old_line_content": "    if (TSDB_CACHE_LAST_ROW(pMemTable->pTsdb->pVnode->config) && pLastRow != NULL) {",
          "new_line_content": "      tsdbCacheInsertLastrow(pMemTable->pTsdb->lruCache, pMemTable->pTsdb, pTbData->uid, pLastRow, true);",
          "content_same": false
        },
        {
          "line": 595,
          "old_api": "TSDB_CACHE_LAST",
          "new_api": "tsdbCacheInsertLast",
          "old_text": "TSDB_CACHE_LAST(pMemTable->pTsdb->pVnode->config)",
          "new_text": "tsdbCacheInsertLast(pMemTable->pTsdb->lruCache, pTbData->uid, pLastRow, pMemTable->pTsdb)",
          "old_line_content": "  if (TSDB_CACHE_LAST(pMemTable->pTsdb->pVnode->config)) {",
          "new_line_content": "    tsdbCacheInsertLast(pMemTable->pTsdb->lruCache, pTbData->uid, pLastRow, pMemTable->pTsdb);",
          "content_same": false
        },
        {
          "line": 600,
          "old_api": "TMIN",
          "new_api": "TMAX",
          "old_text": "TMIN(pMemTable->minKey, pTbData->minKey)",
          "new_text": "TMAX(pMemTable->maxKey, pTbData->maxKey)",
          "old_line_content": "  pMemTable->minKey = TMIN(pMemTable->minKey, pTbData->minKey);",
          "new_line_content": "  pMemTable->maxKey = TMAX(pMemTable->maxKey, pTbData->maxKey);",
          "content_same": false
        },
        {
          "line": 616,
          "old_api": "atomic_fetch_add_32",
          "new_api": "ASSERT",
          "old_text": "atomic_fetch_add_32(&pMemTable->nRef, 1)",
          "new_text": "ASSERT(nRef > 0)",
          "old_line_content": "  int32_t nRef = atomic_fetch_add_32(&pMemTable->nRef, 1);",
          "new_line_content": "  ASSERT(nRef > 0);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 512,
          "old_api": null,
          "new_api": "SL_NODE_FORWARD",
          "old_text": null,
          "new_text": "SL_NODE_FORWARD(pn, iLevel)",
          "old_line_content": "",
          "new_line_content": "      SL_NODE_FORWARD(pn, iLevel) = pNode;",
          "content_same": false
        },
        {
          "line": 515,
          "old_api": null,
          "new_api": "SL_NODE_BACKWARD",
          "old_text": null,
          "new_text": "SL_NODE_BACKWARD(pn, iLevel)",
          "old_line_content": "    } else {",
          "new_line_content": "      px = SL_NODE_BACKWARD(pn, iLevel);",
          "content_same": false
        },
        {
          "line": 517,
          "old_api": null,
          "new_api": "SL_NODE_FORWARD",
          "old_text": null,
          "new_text": "SL_NODE_FORWARD(px, iLevel)",
          "old_line_content": "",
          "new_line_content": "      SL_NODE_FORWARD(px, iLevel) = pNode;",
          "content_same": false
        },
        {
          "line": 646,
          "old_api": null,
          "new_api": "taosArrayInit",
          "old_text": null,
          "new_text": "taosArrayInit(pMemTable->nTbData, sizeof(STbData *))",
          "old_line_content": "SArray *tsdbMemTableGetTbDataArray(SMemTable *pMemTable) {",
          "new_line_content": "  SArray *aTbDataP = taosArrayInit(pMemTable->nTbData, sizeof(STbData *));",
          "content_same": false
        },
        {
          "line": 653,
          "old_api": null,
          "new_api": "taosArrayPush",
          "old_text": null,
          "new_text": "taosArrayPush(aTbDataP, &pTbData)",
          "old_line_content": "    while (pTbData) {",
          "new_line_content": "      taosArrayPush(aTbDataP, &pTbData);",
          "content_same": false
        },
        {
          "line": 658,
          "old_api": null,
          "new_api": "taosArraySort",
          "old_text": null,
          "new_text": "taosArraySort(aTbDataP, tbDataPCmprFn)",
          "old_line_content": "",
          "new_line_content": "  taosArraySort(aTbDataP, tbDataPCmprFn);",
          "content_same": false
        },
        {
          "line": 539,
          "old_api": null,
          "new_api": "tsdbRowFromTSRow",
          "old_text": null,
          "new_text": "tsdbRowFromTSRow(version, NULL)",
          "old_line_content": "  SMemSkipListNode *pos[SL_MAX_LEVEL];",
          "new_line_content": "  TSDBROW           row = tsdbRowFromTSRow(version, NULL);",
          "content_same": false
        },
        {
          "line": 543,
          "old_api": null,
          "new_api": "tInitSubmitBlkIter",
          "old_text": null,
          "new_text": "tInitSubmitBlkIter(pMsgIter, pBlock, &blkIter)",
          "old_line_content": "",
          "new_line_content": "  tInitSubmitBlkIter(pMsgIter, pBlock, &blkIter);",
          "content_same": false
        },
        {
          "line": 546,
          "old_api": null,
          "new_api": "tGetSubmitBlkNext",
          "old_text": null,
          "new_text": "tGetSubmitBlkNext(&blkIter)",
          "old_line_content": "  // backward put first data",
          "new_line_content": "  row.pTSRow = tGetSubmitBlkNext(&blkIter);",
          "content_same": false
        },
        {
          "line": 551,
          "old_api": null,
          "new_api": "tbDataMovePosTo",
          "old_text": null,
          "new_text": "tbDataMovePosTo(pTbData, pos, &key, SL_MOVE_BACKWARD)",
          "old_line_content": "  nRow++;",
          "new_line_content": "  tbDataMovePosTo(pTbData, pos, &key, SL_MOVE_BACKWARD);",
          "content_same": false
        },
        {
          "line": 557,
          "old_api": null,
          "new_api": "TMIN",
          "old_text": null,
          "new_text": "TMIN(pTbData->minKey, key.ts)",
          "old_line_content": "",
          "new_line_content": "  pTbData->minKey = TMIN(pTbData->minKey, key.ts);",
          "content_same": false
        },
        {
          "line": 562,
          "old_api": null,
          "new_api": "tGetSubmitBlkNext",
          "old_text": null,
          "new_text": "tGetSubmitBlkNext(&blkIter)",
          "old_line_content": "  // forward put rest data",
          "new_line_content": "  row.pTSRow = tGetSubmitBlkNext(&blkIter);",
          "content_same": false
        },
        {
          "line": 565,
          "old_api": null,
          "new_api": "SL_NODE_BACKWARD",
          "old_text": null,
          "new_text": "SL_NODE_BACKWARD(pos[iLevel], iLevel)",
          "old_line_content": "    for (int8_t iLevel = pos[0]->level; iLevel < pTbData->sl.maxLevel; iLevel++) {",
          "new_line_content": "      pos[iLevel] = SL_NODE_BACKWARD(pos[iLevel], iLevel);",
          "content_same": false
        },
        {
          "line": 570,
          "old_api": null,
          "new_api": "SL_NODE_FORWARD",
          "old_text": null,
          "new_text": "SL_NODE_FORWARD(pos[0], 0)",
          "old_line_content": "      nRow++;",
          "new_line_content": "      if (SL_NODE_FORWARD(pos[0], 0) != pTbData->sl.pTail) {",
          "content_same": false
        },
        {
          "line": 573,
          "old_api": null,
          "new_api": "tbDataDoPut",
          "old_text": null,
          "new_text": "tbDataDoPut(pMemTable, pTbData, pos, &row, 1)",
          "old_line_content": "      }",
          "new_line_content": "      code = tbDataDoPut(pMemTable, pTbData, pos, &row, 1);",
          "content_same": false
        },
        {
          "line": 580,
          "old_api": null,
          "new_api": "tGetSubmitBlkNext",
          "old_text": null,
          "new_text": "tGetSubmitBlkNext(&blkIter)",
          "old_line_content": "",
          "new_line_content": "      row.pTSRow = tGetSubmitBlkNext(&blkIter);",
          "content_same": false
        },
        {
          "line": 589,
          "old_api": null,
          "new_api": "TSDB_CACHE_LAST_ROW",
          "old_text": null,
          "new_text": "TSDB_CACHE_LAST_ROW(pMemTable->pTsdb->pVnode->config)",
          "old_line_content": "",
          "new_line_content": "    if (TSDB_CACHE_LAST_ROW(pMemTable->pTsdb->pVnode->config) && pLastRow != NULL) {",
          "content_same": false
        },
        {
          "line": 464,
          "old_api": null,
          "new_api": "taosRandR",
          "old_text": null,
          "new_text": "taosRandR(&pSl->seed)",
          "old_line_content": "",
          "new_line_content": "  while ((taosRandR(&pSl->seed) & 0x3) == 0 && level < tlevel) {",
          "content_same": false
        },
        {
          "line": 594,
          "old_api": null,
          "new_api": "TSDB_CACHE_LAST",
          "old_text": null,
          "new_text": "TSDB_CACHE_LAST(pMemTable->pTsdb->pVnode->config)",
          "old_line_content": "",
          "new_line_content": "  if (TSDB_CACHE_LAST(pMemTable->pTsdb->pVnode->config)) {",
          "content_same": false
        },
        {
          "line": 599,
          "old_api": null,
          "new_api": "TMIN",
          "old_text": null,
          "new_text": "TMIN(pMemTable->minKey, pTbData->minKey)",
          "old_line_content": "  // SMemTable",
          "new_line_content": "  pMemTable->minKey = TMIN(pMemTable->minKey, pTbData->minKey);",
          "content_same": false
        },
        {
          "line": 478,
          "old_api": null,
          "new_api": "tsdbMemSkipListRandLevel",
          "old_text": null,
          "new_text": "tsdbMemSkipListRandLevel(&pTbData->sl)",
          "old_line_content": "  // node",
          "new_line_content": "  level = tsdbMemSkipListRandLevel(&pTbData->sl);",
          "content_same": false
        },
        {
          "line": 486,
          "old_api": null,
          "new_api": "SL_NODE_DATA",
          "old_text": null,
          "new_text": "SL_NODE_DATA(pNode)",
          "old_line_content": "  pNode->level = level;",
          "new_line_content": "  tPutTSDBRow((uint8_t *)SL_NODE_DATA(pNode), pRow);",
          "content_same": false
        },
        {
          "line": 615,
          "old_api": null,
          "new_api": "atomic_fetch_add_32",
          "old_text": null,
          "new_text": "atomic_fetch_add_32(&pMemTable->nRef, 1)",
          "old_line_content": "void tsdbRefMemTable(SMemTable *pMemTable) {",
          "new_line_content": "  int32_t nRef = atomic_fetch_add_32(&pMemTable->nRef, 1);",
          "content_same": false
        },
        {
          "line": 620,
          "old_api": null,
          "new_api": "atomic_sub_fetch_32",
          "old_text": null,
          "new_text": "atomic_sub_fetch_32(&pMemTable->nRef, 1)",
          "old_line_content": "void tsdbUnrefMemTable(SMemTable *pMemTable) {",
          "new_line_content": "  int32_t nRef = atomic_sub_fetch_32(&pMemTable->nRef, 1);",
          "content_same": false
        },
        {
          "line": 493,
          "old_api": null,
          "new_api": "SL_NODE_FORWARD",
          "old_text": null,
          "new_text": "SL_NODE_FORWARD(pn, iLevel)",
          "old_line_content": "    if (forward) {",
          "new_line_content": "      px = SL_NODE_FORWARD(pn, iLevel);",
          "content_same": false
        },
        {
          "line": 622,
          "old_api": null,
          "new_api": "tsdbMemTableDestroy",
          "old_text": null,
          "new_text": "tsdbMemTableDestroy(pMemTable)",
          "old_line_content": "  if (nRef == 0) {",
          "new_line_content": "    tsdbMemTableDestroy(pMemTable);",
          "content_same": false
        },
        {
          "line": 495,
          "old_api": null,
          "new_api": "SL_NODE_BACKWARD",
          "old_text": null,
          "new_text": "SL_NODE_BACKWARD(pNode, iLevel)",
          "old_line_content": "",
          "new_line_content": "      SL_NODE_BACKWARD(pNode, iLevel) = pn;",
          "content_same": false
        },
        {
          "line": 498,
          "old_api": null,
          "new_api": "SL_NODE_BACKWARD",
          "old_text": null,
          "new_text": "SL_NODE_BACKWARD(pn, iLevel)",
          "old_line_content": "    } else {",
          "new_line_content": "      px = SL_NODE_BACKWARD(pn, iLevel);",
          "content_same": false
        },
        {
          "line": 500,
          "old_api": null,
          "new_api": "SL_NODE_BACKWARD",
          "old_text": null,
          "new_text": "SL_NODE_BACKWARD(pNode, iLevel)",
          "old_line_content": "",
          "new_line_content": "      SL_NODE_BACKWARD(pNode, iLevel) = px;",
          "content_same": false
        },
        {
          "line": 510,
          "old_api": null,
          "new_api": "SL_NODE_FORWARD",
          "old_text": null,
          "new_text": "SL_NODE_FORWARD(pn, iLevel)",
          "old_line_content": "    if (forward) {",
          "new_line_content": "      px = SL_NODE_FORWARD(pn, iLevel);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 514,
          "old_api": "SL_NODE_BACKWARD",
          "new_api": null,
          "old_text": "SL_NODE_BACKWARD(px, iLevel)",
          "new_text": null,
          "old_line_content": "      SL_NODE_BACKWARD(px, iLevel) = pNode;",
          "new_line_content": "    } else {",
          "content_same": false
        },
        {
          "line": 516,
          "old_api": "SL_NODE_BACKWARD",
          "new_api": null,
          "old_text": "SL_NODE_BACKWARD(pn, iLevel)",
          "new_text": null,
          "old_line_content": "      px = SL_NODE_BACKWARD(pn, iLevel);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 519,
          "old_api": "SL_NODE_BACKWARD",
          "new_api": null,
          "old_text": "SL_NODE_BACKWARD(pn, iLevel)",
          "new_text": null,
          "old_line_content": "      SL_NODE_BACKWARD(pn, iLevel) = pNode;",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 647,
          "old_api": "taosArrayInit",
          "new_api": null,
          "old_text": "taosArrayInit(pMemTable->nTbData, sizeof(STbData *))",
          "new_text": null,
          "old_line_content": "  SArray *aTbDataP = taosArrayInit(pMemTable->nTbData, sizeof(STbData *));",
          "new_line_content": "  if (aTbDataP == NULL) goto _exit;",
          "content_same": false
        },
        {
          "line": 654,
          "old_api": "taosArrayPush",
          "new_api": null,
          "old_text": "taosArrayPush(aTbDataP, &pTbData)",
          "new_text": null,
          "old_line_content": "      taosArrayPush(aTbDataP, &pTbData);",
          "new_line_content": "      pTbData = pTbData->next;",
          "content_same": false
        },
        {
          "line": 659,
          "old_api": "taosArraySort",
          "new_api": null,
          "old_text": "taosArraySort(aTbDataP, tbDataPCmprFn)",
          "new_text": null,
          "old_line_content": "  taosArraySort(aTbDataP, tbDataPCmprFn);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 540,
          "old_api": "tsdbRowFromTSRow",
          "new_api": null,
          "old_text": "tsdbRowFromTSRow(version, NULL)",
          "new_text": null,
          "old_line_content": "  TSDBROW           row = tsdbRowFromTSRow(version, NULL);",
          "new_line_content": "  int32_t           nRow = 0;",
          "content_same": false
        },
        {
          "line": 544,
          "old_api": "tInitSubmitBlkIter",
          "new_api": null,
          "old_text": "tInitSubmitBlkIter(pMsgIter, pBlock, &blkIter)",
          "new_text": null,
          "old_line_content": "  tInitSubmitBlkIter(pMsgIter, pBlock, &blkIter);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 547,
          "old_api": "tGetSubmitBlkNext",
          "new_api": null,
          "old_text": "tGetSubmitBlkNext(&blkIter)",
          "new_text": null,
          "old_line_content": "  row.pTSRow = tGetSubmitBlkNext(&blkIter);",
          "new_line_content": "  if (row.pTSRow == NULL) return code;",
          "content_same": false
        },
        {
          "line": 553,
          "old_api": "tbDataDoPut",
          "new_api": null,
          "old_text": "tbDataDoPut(pMemTable, pTbData, pos, &row, 0)",
          "new_text": null,
          "old_line_content": "  code = tbDataDoPut(pMemTable, pTbData, pos, &row, 0);",
          "new_line_content": "  if (code) {",
          "content_same": false
        },
        {
          "line": 558,
          "old_api": "TMIN",
          "new_api": null,
          "old_text": "TMIN(pTbData->minKey, key.ts)",
          "new_text": null,
          "old_line_content": "  pTbData->minKey = TMIN(pTbData->minKey, key.ts);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 563,
          "old_api": "tGetSubmitBlkNext",
          "new_api": null,
          "old_text": "tGetSubmitBlkNext(&blkIter)",
          "new_text": null,
          "old_line_content": "  row.pTSRow = tGetSubmitBlkNext(&blkIter);",
          "new_line_content": "  if (row.pTSRow) {",
          "content_same": false
        },
        {
          "line": 566,
          "old_api": "SL_NODE_BACKWARD",
          "new_api": null,
          "old_text": "SL_NODE_BACKWARD(pos[iLevel], iLevel)",
          "new_text": null,
          "old_line_content": "      pos[iLevel] = SL_NODE_BACKWARD(pos[iLevel], iLevel);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 572,
          "old_api": "tbDataMovePosTo",
          "new_api": null,
          "old_text": "tbDataMovePosTo(pTbData, pos, &key, SL_MOVE_FROM_POS)",
          "new_text": null,
          "old_line_content": "        tbDataMovePosTo(pTbData, pos, &key, SL_MOVE_FROM_POS);",
          "new_line_content": "      }",
          "content_same": false
        },
        {
          "line": 574,
          "old_api": "tbDataDoPut",
          "new_api": null,
          "old_text": "tbDataDoPut(pMemTable, pTbData, pos, &row, 1)",
          "new_text": null,
          "old_line_content": "      code = tbDataDoPut(pMemTable, pTbData, pos, &row, 1);",
          "new_line_content": "      if (code) {",
          "content_same": false
        },
        {
          "line": 581,
          "old_api": "tGetSubmitBlkNext",
          "new_api": null,
          "old_text": "tGetSubmitBlkNext(&blkIter)",
          "new_text": null,
          "old_line_content": "      row.pTSRow = tGetSubmitBlkNext(&blkIter);",
          "new_line_content": "    } while (row.pTSRow);",
          "content_same": false
        },
        {
          "line": 591,
          "old_api": "tsdbCacheInsertLastrow",
          "new_api": null,
          "old_text": "tsdbCacheInsertLastrow(pMemTable->pTsdb->lruCache, pMemTable->pTsdb, pTbData->uid, pLastRow, true)",
          "new_text": null,
          "old_line_content": "      tsdbCacheInsertLastrow(pMemTable->pTsdb->lruCache, pMemTable->pTsdb, pTbData->uid, pLastRow, true);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 465,
          "old_api": "taosRandR",
          "new_api": null,
          "old_text": "taosRandR(&pSl->seed)",
          "new_text": null,
          "old_line_content": "  while ((taosRandR(&pSl->seed) % factor) == 0 && level < tlevel) {",
          "new_line_content": "    level++;",
          "content_same": false
        },
        {
          "line": 596,
          "old_api": "tsdbCacheInsertLast",
          "new_api": null,
          "old_text": "tsdbCacheInsertLast(pMemTable->pTsdb->lruCache, pTbData->uid, pLastRow, pMemTable->pTsdb)",
          "new_text": null,
          "old_line_content": "    tsdbCacheInsertLast(pMemTable->pTsdb->lruCache, pTbData->uid, pLastRow, pMemTable->pTsdb);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 601,
          "old_api": "TMAX",
          "new_api": null,
          "old_text": "TMAX(pMemTable->maxKey, pTbData->maxKey)",
          "new_text": null,
          "old_line_content": "  pMemTable->maxKey = TMAX(pMemTable->maxKey, pTbData->maxKey);",
          "new_line_content": "  pMemTable->nRow += nRow;",
          "content_same": false
        },
        {
          "line": 481,
          "old_api": "tPutTSDBRow",
          "new_api": null,
          "old_text": "tPutTSDBRow(NULL, pRow)",
          "new_text": null,
          "old_line_content": "  pNode = (SMemSkipListNode *)vnodeBufPoolMalloc(pPool, SL_NODE_SIZE(level) + tPutTSDBRow(NULL, pRow));",
          "new_line_content": "  if (pNode == NULL) {",
          "content_same": false
        },
        {
          "line": 487,
          "old_api": "SL_NODE_DATA",
          "new_api": null,
          "old_text": "SL_NODE_DATA(pNode)",
          "new_text": null,
          "old_line_content": "  tPutTSDBRow((uint8_t *)SL_NODE_DATA(pNode), pRow);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 617,
          "old_api": "ASSERT",
          "new_api": null,
          "old_text": "ASSERT(nRef > 0)",
          "new_text": null,
          "old_line_content": "  ASSERT(nRef > 0);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 621,
          "old_api": "atomic_sub_fetch_32",
          "new_api": null,
          "old_text": "atomic_sub_fetch_32(&pMemTable->nRef, 1)",
          "new_text": null,
          "old_line_content": "  int32_t nRef = atomic_sub_fetch_32(&pMemTable->nRef, 1);",
          "new_line_content": "  if (nRef == 0) {",
          "content_same": false
        },
        {
          "line": 494,
          "old_api": "SL_NODE_FORWARD",
          "new_api": null,
          "old_text": "SL_NODE_FORWARD(pn, iLevel)",
          "new_text": null,
          "old_line_content": "      px = SL_NODE_FORWARD(pn, iLevel);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 623,
          "old_api": "tsdbMemTableDestroy",
          "new_api": null,
          "old_text": "tsdbMemTableDestroy(pMemTable)",
          "new_text": null,
          "old_line_content": "    tsdbMemTableDestroy(pMemTable);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 497,
          "old_api": "SL_NODE_FORWARD",
          "new_api": null,
          "old_text": "SL_NODE_FORWARD(pNode, iLevel)",
          "new_text": null,
          "old_line_content": "      SL_NODE_FORWARD(pNode, iLevel) = px;",
          "new_line_content": "    } else {",
          "content_same": false
        },
        {
          "line": 499,
          "old_api": "SL_NODE_BACKWARD",
          "new_api": null,
          "old_text": "SL_NODE_BACKWARD(pn, iLevel)",
          "new_text": null,
          "old_line_content": "      px = SL_NODE_BACKWARD(pn, iLevel);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 502,
          "old_api": "SL_NODE_FORWARD",
          "new_api": null,
          "old_text": "SL_NODE_FORWARD(pNode, iLevel)",
          "new_text": null,
          "old_line_content": "      SL_NODE_FORWARD(pNode, iLevel) = pn;",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 511,
          "old_api": "SL_NODE_FORWARD",
          "new_api": null,
          "old_text": "SL_NODE_FORWARD(pn, iLevel)",
          "new_text": null,
          "old_line_content": "      px = SL_NODE_FORWARD(pn, iLevel);",
          "new_line_content": "",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 12,
      "total_additions": 30,
      "total_deletions": 30,
      "total_api_changes": 72
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 5,
        "api_related_lines": 72,
        "non_api_lines": 3,
        "non_api_line_numbers": [
          461,
          462,
          463
        ]
      }
    },
    "api_calls_before": 120,
    "api_calls_after": 120,
    "diff_info": {
      "added_lines": 3,
      "removed_lines": 4,
      "total_diff_lines": 20
    }
  }
}