{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/TDengine/modified_file/d2dcecda649e8cb11e018c8f5c6c2246d7c9d9f2",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/TDengine/modified_file/d2dcecda649e8cb11e018c8f5c6c2246d7c9d9f2/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/TDengine/modified_file/d2dcecda649e8cb11e018c8f5c6c2246d7c9d9f2/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/TDengine/modified_file/d2dcecda649e8cb11e018c8f5c6c2246d7c9d9f2/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 485,
          "old_api": "TSDB_TICK_PER_SECOND",
          "new_api": "localtime_r",
          "old_text": "TSDB_TICK_PER_SECOND(precision)",
          "new_text": "localtime_r(&tt, &tm)",
          "old_line_content": "  return (int64_t)(mktime(&tm) * TSDB_TICK_PER_SECOND(precision));",
          "new_line_content": "  localtime_r(&tt, &tm);",
          "content_same": false
        },
        {
          "line": 503,
          "old_api": "localtime_r",
          "new_api": "TSDB_TICK_PER_SECOND",
          "old_text": "localtime_r(&t, &tm)",
          "new_text": "TSDB_TICK_PER_SECOND(precision)",
          "old_line_content": "  localtime_r(&t, &tm);",
          "new_line_content": "  skey /= (int64_t)(TSDB_TICK_PER_SECOND(precision));",
          "content_same": false
        },
        {
          "line": 616,
          "old_api": "time_t)(ts / 1000)",
          "new_api": "localtime_r",
          "old_text": "time_t)(ts / 1000)",
          "new_text": "localtime_r(&t, &tm)",
          "old_line_content": "    time_t t = (time_t)(ts / 1000);",
          "new_line_content": "    localtime_r(&t, &tm);",
          "content_same": false
        },
        {
          "line": 617,
          "old_api": "localtime_r",
          "new_api": "strftime",
          "old_text": "localtime_r(&t, &tm)",
          "new_text": "strftime(buf + pos, sizeof(buf), \"s=%Y-%m-%d %H:%M:%S\", &tm)",
          "old_line_content": "    localtime_r(&t, &tm);",
          "new_line_content": "    pos += strftime(buf + pos, sizeof(buf), \"s=%Y-%m-%d %H:%M:%S\", &tm);",
          "content_same": false
        },
        {
          "line": 628,
          "old_api": "time_t)(ts / 1000000)",
          "new_api": "strftime",
          "old_text": "time_t)(ts / 1000000)",
          "new_text": "strftime(buf + pos, sizeof(buf), \"ms=%Y-%m-%d %H:%M:%S\", &tm)",
          "old_line_content": "    time_t t = (time_t)(ts / 1000000);",
          "new_line_content": "    pos += strftime(buf + pos, sizeof(buf), \"ms=%Y-%m-%d %H:%M:%S\", &tm);",
          "content_same": false
        },
        {
          "line": 629,
          "old_api": "localtime_r",
          "new_api": "sprintf",
          "old_text": "localtime_r(&t, &tm)",
          "new_text": "sprintf(buf + pos, \".%03d\", (int)(ts % 1000))",
          "old_line_content": "    localtime_r(&t, &tm);",
          "new_line_content": "    pos += sprintf(buf + pos, \".%03d\", (int)(ts % 1000));",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 512,
          "old_api": null,
          "new_api": "localtime_r",
          "old_text": null,
          "new_text": "localtime_r(&t, &tm)",
          "old_line_content": "  }",
          "new_line_content": "  localtime_r(&t, &tm);",
          "content_same": false
        },
        {
          "line": 641,
          "old_api": null,
          "new_api": "sprintf",
          "old_text": null,
          "new_text": "sprintf(buf + pos, \".%06d\", (int)(ts % 1000000))",
          "old_line_content": "",
          "new_line_content": "    pos += sprintf(buf + pos, \".%06d\", (int)(ts % 1000000));",
          "content_same": false
        },
        {
          "line": 640,
          "old_api": null,
          "new_api": "strftime",
          "old_text": null,
          "new_text": "strftime(buf + pos, sizeof(buf), \"us=%Y-%m-%d %H:%M:%S\", &tm)",
          "old_line_content": "}",
          "new_line_content": "    pos += strftime(buf + pos, sizeof(buf), \"us=%Y-%m-%d %H:%M:%S\", &tm);",
          "content_same": false
        },
        {
          "line": 393,
          "old_api": null,
          "new_api": "convertTimePrecision",
          "old_text": null,
          "new_text": "convertTimePrecision(val * MILLISECOND_PER_SECOND, TSDB_TIME_PRECISION_MILLI, timePrecision)",
          "old_line_content": "    case 'h':",
          "new_line_content": "      (*result) = convertTimePrecision(val * MILLISECOND_PER_SECOND, TSDB_TIME_PRECISION_MILLI, timePrecision);",
          "content_same": false
        },
        {
          "line": 265,
          "old_api": null,
          "new_api": "user_mktime64",
          "old_text": null,
          "new_text": "user_mktime64(tm.tm_year+1900, tm.tm_mon+1, tm.tm_mday, tm.tm_hour, tm.tm_min, tm.tm_sec, 0)",
          "old_line_content": "",
          "new_line_content": "  int64_t seconds = user_mktime64(tm.tm_year+1900, tm.tm_mon+1, tm.tm_mday, tm.tm_hour, tm.tm_min, tm.tm_sec, 0);",
          "content_same": false
        },
        {
          "line": 268,
          "old_api": null,
          "new_api": "timegm",
          "old_text": null,
          "new_text": "timegm(&tm)",
          "old_line_content": "",
          "new_line_content": "  int64_t seconds = timegm(&tm);",
          "content_same": false
        },
        {
          "line": 396,
          "old_api": null,
          "new_api": "convertTimePrecision",
          "old_text": null,
          "new_text": "convertTimePrecision(val * MILLISECOND_PER_MINUTE, TSDB_TIME_PRECISION_MILLI, timePrecision)",
          "old_line_content": "    case 'd':",
          "new_line_content": "      (*result) = convertTimePrecision(val * MILLISECOND_PER_MINUTE, TSDB_TIME_PRECISION_MILLI, timePrecision);",
          "content_same": false
        },
        {
          "line": 524,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(pInterval->interval == 0)",
          "old_line_content": "  if (pInterval->slidingUnit == 'n' || pInterval->slidingUnit == 'y') {",
          "new_line_content": "    assert(pInterval->interval == 0);",
          "content_same": false
        },
        {
          "line": 399,
          "old_api": null,
          "new_api": "convertTimePrecision",
          "old_text": null,
          "new_text": "convertTimePrecision(val * MILLISECOND_PER_HOUR, TSDB_TIME_PRECISION_MILLI, timePrecision)",
          "old_line_content": "    case 'w':",
          "new_line_content": "      (*result) = convertTimePrecision(val * MILLISECOND_PER_HOUR, TSDB_TIME_PRECISION_MILLI, timePrecision);",
          "content_same": false
        },
        {
          "line": 272,
          "old_api": null,
          "new_api": "forwardToTimeStringEnd",
          "old_text": null,
          "new_text": "forwardToTimeStringEnd(timestr)",
          "old_line_content": "  } else if (str[0] == '.') {",
          "new_line_content": "  str = forwardToTimeStringEnd(timestr);",
          "content_same": false
        },
        {
          "line": 402,
          "old_api": null,
          "new_api": "convertTimePrecision",
          "old_text": null,
          "new_text": "convertTimePrecision(val * MILLISECOND_PER_DAY, TSDB_TIME_PRECISION_MILLI, timePrecision)",
          "old_line_content": "    case 'a':",
          "new_line_content": "      (*result) = convertTimePrecision(val * MILLISECOND_PER_DAY, TSDB_TIME_PRECISION_MILLI, timePrecision);",
          "content_same": false
        },
        {
          "line": 530,
          "old_api": null,
          "new_api": "TSDB_TICK_PER_SECOND",
          "old_text": null,
          "new_text": "TSDB_TICK_PER_SECOND(precision)",
          "old_line_content": "    tm.tm_min = 0;",
          "new_line_content": "    start /= (int64_t)(TSDB_TICK_PER_SECOND(precision));",
          "content_same": false
        },
        {
          "line": 405,
          "old_api": null,
          "new_api": "convertTimePrecision",
          "old_text": null,
          "new_text": "convertTimePrecision(val * MILLISECOND_PER_WEEK, TSDB_TIME_PRECISION_MILLI, timePrecision)",
          "old_line_content": "    case 'u':",
          "new_line_content": "      (*result) = convertTimePrecision(val * MILLISECOND_PER_WEEK, TSDB_TIME_PRECISION_MILLI, timePrecision);",
          "content_same": false
        },
        {
          "line": 533,
          "old_api": null,
          "new_api": "localtime_r",
          "old_text": null,
          "new_text": "localtime_r(&tt, &tm)",
          "old_line_content": "",
          "new_line_content": "    localtime_r(&tt, &tm);",
          "content_same": false
        },
        {
          "line": 279,
          "old_api": null,
          "new_api": "parseFraction",
          "old_text": null,
          "new_text": "parseFraction(str, &str, timePrec)",
          "old_line_content": "",
          "new_line_content": "    if ((fraction = parseFraction(str, &str, timePrec)) < 0) {",
          "content_same": false
        },
        {
          "line": 408,
          "old_api": null,
          "new_api": "convertTimePrecision",
          "old_text": null,
          "new_text": "convertTimePrecision(val, TSDB_TIME_PRECISION_MILLI, timePrecision)",
          "old_line_content": "    case 'b':",
          "new_line_content": "      (*result) = convertTimePrecision(val, TSDB_TIME_PRECISION_MILLI, timePrecision);",
          "content_same": false
        },
        {
          "line": 411,
          "old_api": null,
          "new_api": "convertTimePrecision",
          "old_text": null,
          "new_text": "convertTimePrecision(val, TSDB_TIME_PRECISION_MICRO, timePrecision)",
          "old_line_content": "    default: {",
          "new_line_content": "      (*result) = convertTimePrecision(val, TSDB_TIME_PRECISION_MICRO, timePrecision);",
          "content_same": false
        },
        {
          "line": 414,
          "old_api": null,
          "new_api": "convertTimePrecision",
          "old_text": null,
          "new_text": "convertTimePrecision(val, TSDB_TIME_PRECISION_NANO, timePrecision)",
          "old_line_content": "  }",
          "new_line_content": "      (*result) = convertTimePrecision(val, TSDB_TIME_PRECISION_NANO, timePrecision);",
          "content_same": false
        },
        {
          "line": 292,
          "old_api": null,
          "new_api": "parseTimezone",
          "old_text": null,
          "new_text": "parseTimezone(str, &tzOffset)",
          "old_line_content": "    }",
          "new_line_content": "      if (parseTimezone(str, &tzOffset) == -1) {",
          "content_same": false
        },
        {
          "line": 549,
          "old_api": null,
          "new_api": "TSDB_TICK_PER_SECOND",
          "old_text": null,
          "new_text": "TSDB_TICK_PER_SECOND(precision)",
          "old_line_content": "    start = (delta / pInterval->sliding + factor) * pInterval->sliding;",
          "new_line_content": "    start = (int64_t)(mktime(&tm) * TSDB_TICK_PER_SECOND(precision));",
          "content_same": false
        },
        {
          "line": 175,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(timePrec == TSDB_TIME_PRECISION_NANO)",
          "old_line_content": "  }",
          "new_line_content": "    assert(timePrec == TSDB_TIME_PRECISION_NANO);",
          "content_same": false
        },
        {
          "line": 303,
          "old_api": null,
          "new_api": "parseTimezone",
          "old_text": null,
          "new_text": "parseTimezone(str, &tzOffset)",
          "old_line_content": "  } else {",
          "new_line_content": "    if (parseTimezone(str, &tzOffset) == -1) {",
          "content_same": false
        },
        {
          "line": 182,
          "old_api": null,
          "new_api": "strnatoi",
          "old_text": null,
          "new_text": "strnatoi(str, i)",
          "old_line_content": "",
          "new_line_content": "  fraction = strnatoi(str, i) * factor[times];",
          "content_same": false
        },
        {
          "line": 569,
          "old_api": null,
          "new_api": "TSDB_TICK_PER_SECOND",
          "old_text": null,
          "new_text": "TSDB_TICK_PER_SECOND(precision)",
          "old_line_content": "    // not enough time range",
          "new_line_content": "      start += (int64_t)(timezone * TSDB_TICK_PER_SECOND(precision));",
          "content_same": false
        },
        {
          "line": 442,
          "old_api": null,
          "new_api": "strtoll",
          "old_text": null,
          "new_text": "strtoll(token, &endPtr, 10)",
          "old_line_content": "  /* natual month/year are not allowed in absolute duration */",
          "new_line_content": "  int64_t timestamp = strtoll(token, &endPtr, 10);",
          "content_same": false
        },
        {
          "line": 319,
          "old_api": null,
          "new_api": "strptime",
          "old_text": null,
          "new_text": "strptime(timestr, \"%Y-%m-%d %H:%M:%S\", &tm)",
          "old_line_content": "#ifdef _MSC_VER",
          "new_line_content": "  char* str = strptime(timestr, \"%Y-%m-%d %H:%M:%S\", &tm);",
          "content_same": false
        },
        {
          "line": 453,
          "old_api": null,
          "new_api": "getDuration",
          "old_text": null,
          "new_text": "getDuration(timestamp, unit, duration, timePrecision)",
          "old_line_content": "",
          "new_line_content": "  return getDuration(timestamp, unit, duration, timePrecision);",
          "content_same": false
        },
        {
          "line": 198,
          "old_api": null,
          "new_api": "strchr",
          "old_text": null,
          "new_text": "strchr(&str[i], ':')",
          "old_line_content": "    i += len + 1;",
          "new_line_content": "  char* sep = strchr(&str[i], ':');",
          "content_same": false
        },
        {
          "line": 202,
          "old_api": null,
          "new_api": "strnatoi",
          "old_text": null,
          "new_text": "strnatoi(&str[i], len)",
          "old_line_content": "  }",
          "new_line_content": "    hour = strnatoi(&str[i], len);",
          "content_same": false
        },
        {
          "line": 330,
          "old_api": null,
          "new_api": "user_mktime64",
          "old_text": null,
          "new_text": "user_mktime64(tm.tm_year+1900, tm.tm_mon+1, tm.tm_mday, tm.tm_hour, tm.tm_min, tm.tm_sec, timezone)",
          "old_line_content": "    /* parse the second fraction part */",
          "new_line_content": "  int64_t seconds = user_mktime64(tm.tm_year+1900, tm.tm_mon+1, tm.tm_mday, tm.tm_hour, tm.tm_min, tm.tm_sec, timezone);",
          "content_same": false
        },
        {
          "line": 460,
          "old_api": null,
          "new_api": "strtoll",
          "old_text": null,
          "new_text": "strtoll(token, NULL, 10)",
          "old_line_content": "  *unit = token[tokenLen - 1];",
          "new_line_content": "  *duration = strtoll(token, NULL, 10);",
          "content_same": false
        },
        {
          "line": 205,
          "old_api": null,
          "new_api": "strnatoi",
          "old_text": null,
          "new_text": "strnatoi(&str[i], 2)",
          "old_line_content": "  char *minStr = &str[i];",
          "new_line_content": "    hour = strnatoi(&str[i], 2);",
          "content_same": false
        },
        {
          "line": 336,
          "old_api": null,
          "new_api": "parseFraction",
          "old_text": null,
          "new_text": "parseFraction(str + 1, &str, timePrec)",
          "old_line_content": "  int64_t factor = (timePrec == TSDB_TIME_PRECISION_MILLI) ? 1000 :",
          "new_line_content": "    if ((fraction = parseFraction(str + 1, &str, timePrec)) < 0) {",
          "content_same": false
        },
        {
          "line": 594,
          "old_api": null,
          "new_api": "taosTimeAdd",
          "old_text": null,
          "new_text": "taosTimeAdd(start, pInterval->offset, pInterval->offsetUnit, precision)",
          "old_line_content": "  return start;",
          "new_line_content": "    start = taosTimeAdd(start, pInterval->offset, pInterval->offsetUnit, precision);",
          "content_same": false
        },
        {
          "line": 596,
          "old_api": null,
          "new_api": "taosTimeAdd",
          "old_text": null,
          "new_text": "taosTimeAdd(start, -pInterval->interval, pInterval->intervalUnit, precision)",
          "old_line_content": "",
          "new_line_content": "      start = taosTimeAdd(start, -pInterval->interval, pInterval->intervalUnit, precision);",
          "content_same": false
        },
        {
          "line": 470,
          "old_api": null,
          "new_api": "getDuration",
          "old_text": null,
          "new_text": "getDuration(*duration, *unit, duration, timePrecision)",
          "old_line_content": "    return t;",
          "new_line_content": "  return getDuration(*duration, *unit, duration, timePrecision);",
          "content_same": false
        },
        {
          "line": 216,
          "old_api": null,
          "new_api": "strnatoi",
          "old_text": null,
          "new_text": "strnatoi(&str[i], 2)",
          "old_line_content": "  if (str[0] == '+') {",
          "new_line_content": "  int64_t minute = strnatoi(&str[i], 2);",
          "content_same": false
        },
        {
          "line": 380,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(toPrecision == TSDB_TIME_PRECISION_MILLI ||\n         toPrecision == TSDB_TIME_PRECISION_MICRO ||\n         toPrecision == TSDB_TIME_PRECISION_NANO)",
          "old_line_content": "                                  {1.0 / 1000000, 1.0 / 1000,       1.} };",
          "new_line_content": "  assert(toPrecision == TSDB_TIME_PRECISION_MILLI ||",
          "content_same": false
        },
        {
          "line": 353,
          "old_api": null,
          "new_api": "strptime",
          "old_text": null,
          "new_text": "strptime(timestr, \"%Y-%m-%d %H:%M:%S\", &tm)",
          "old_line_content": "  /* mktime will be affected by TZ, set by using taos_options */",
          "new_line_content": "  char* str = strptime(timestr, \"%Y-%m-%d %H:%M:%S\", &tm);",
          "content_same": false
        },
        {
          "line": 484,
          "old_api": null,
          "new_api": "TSDB_TICK_PER_SECOND",
          "old_text": null,
          "new_text": "TSDB_TICK_PER_SECOND(precision)",
          "old_line_content": "",
          "new_line_content": "  time_t tt = (time_t)(t / TSDB_TICK_PER_SECOND(precision));",
          "content_same": false
        },
        {
          "line": 359,
          "old_api": null,
          "new_api": "mktime",
          "old_text": null,
          "new_text": "mktime(&tm)",
          "old_line_content": "    /* parse the second fraction part */",
          "new_line_content": "  int64_t seconds = mktime(&tm);",
          "content_same": false
        },
        {
          "line": 490,
          "old_api": null,
          "new_api": "TSDB_TICK_PER_SECOND",
          "old_text": null,
          "new_text": "TSDB_TICK_PER_SECOND(precision)",
          "old_line_content": "    int64_t tmp = ekey;",
          "new_line_content": "  return (int64_t)(mktime(&tm) * TSDB_TICK_PER_SECOND(precision));",
          "content_same": false
        },
        {
          "line": 365,
          "old_api": null,
          "new_api": "parseFraction",
          "old_text": null,
          "new_text": "parseFraction(str + 1, &str, timePrec)",
          "old_line_content": "  int64_t factor = (timePrec == TSDB_TIME_PRECISION_MILLI) ? 1000 :",
          "new_line_content": "    if ((fraction = parseFraction(str + 1, &str, timePrec)) < 0) {",
          "content_same": false
        },
        {
          "line": 621,
          "old_api": null,
          "new_api": "time_t)(ts / 1000)",
          "old_text": null,
          "new_text": "time_t)(ts / 1000)",
          "old_line_content": "      buf[pos++] = ' ';",
          "new_line_content": "    time_t t = (time_t)(ts / 1000);",
          "content_same": false
        },
        {
          "line": 622,
          "old_api": null,
          "new_api": "localtime_r",
          "old_text": null,
          "new_text": "localtime_r(&t, &tm)",
          "old_line_content": "    }",
          "new_line_content": "    localtime_r(&t, &tm);",
          "content_same": false
        },
        {
          "line": 633,
          "old_api": null,
          "new_api": "time_t)(ts / 1000000)",
          "old_text": null,
          "new_text": "time_t)(ts / 1000000)",
          "old_line_content": "      buf[pos++] = ' ';",
          "new_line_content": "    time_t t = (time_t)(ts / 1000000);",
          "content_same": false
        },
        {
          "line": 252,
          "old_api": null,
          "new_api": "strptime",
          "old_text": null,
          "new_text": "strptime(timestr, \"%Y-%m-%dT%H:%M:%S\", &tm)",
          "old_line_content": "  }",
          "new_line_content": "    str = strptime(timestr, \"%Y-%m-%dT%H:%M:%S\", &tm);",
          "content_same": false
        },
        {
          "line": 504,
          "old_api": null,
          "new_api": "TSDB_TICK_PER_SECOND",
          "old_text": null,
          "new_text": "TSDB_TICK_PER_SECOND(precision)",
          "old_line_content": "  int smon = tm.tm_year * 12 + tm.tm_mon;",
          "new_line_content": "  ekey /= (int64_t)(TSDB_TICK_PER_SECOND(precision));",
          "content_same": false
        },
        {
          "line": 377,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(fromPrecision == TSDB_TIME_PRECISION_MILLI ||\n         fromPrecision == TSDB_TIME_PRECISION_MICRO ||\n         fromPrecision == TSDB_TIME_PRECISION_NANO)",
          "old_line_content": "         toPrecision == TSDB_TIME_PRECISION_NANO);",
          "new_line_content": "  assert(fromPrecision == TSDB_TIME_PRECISION_MILLI ||",
          "content_same": false
        },
        {
          "line": 634,
          "old_api": null,
          "new_api": "localtime_r",
          "old_text": null,
          "new_text": "localtime_r(&t, &tm)",
          "old_line_content": "    }",
          "new_line_content": "    localtime_r(&t, &tm);",
          "content_same": false
        },
        {
          "line": 508,
          "old_api": null,
          "new_api": "localtime_r",
          "old_text": null,
          "new_text": "localtime_r(&t, &tm)",
          "old_line_content": "  int emon = tm.tm_year * 12 + tm.tm_mon;",
          "new_line_content": "  localtime_r(&t, &tm);",
          "content_same": false
        },
        {
          "line": 254,
          "old_api": null,
          "new_api": "strptime",
          "old_text": null,
          "new_text": "strptime(timestr, \"%Y-%m-%d %H:%M:%S\", &tm)",
          "old_line_content": "  if (str == NULL) {",
          "new_line_content": "    str = strptime(timestr, \"%Y-%m-%d %H:%M:%S\", &tm);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 388,
          "old_api": "convertTimePrecision",
          "new_api": null,
          "old_text": "convertTimePrecision(val * MILLISECOND_PER_SECOND, TSDB_TIME_PRECISION_MILLI, timePrecision)",
          "new_text": null,
          "old_line_content": "      (*result) = convertTimePrecision(val * MILLISECOND_PER_SECOND, TSDB_TIME_PRECISION_MILLI, timePrecision);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 260,
          "old_api": "user_mktime64",
          "new_api": null,
          "old_text": "user_mktime64(tm.tm_year+1900, tm.tm_mon+1, tm.tm_mday, tm.tm_hour, tm.tm_min, tm.tm_sec, 0)",
          "new_text": null,
          "old_line_content": "  int64_t seconds = user_mktime64(tm.tm_year+1900, tm.tm_mon+1, tm.tm_mday, tm.tm_hour, tm.tm_min, tm.tm_sec, 0);",
          "new_line_content": "    return -1;",
          "content_same": false
        },
        {
          "line": 391,
          "old_api": "convertTimePrecision",
          "new_api": null,
          "old_text": "convertTimePrecision(val * MILLISECOND_PER_MINUTE, TSDB_TIME_PRECISION_MILLI, timePrecision)",
          "new_text": null,
          "old_line_content": "      (*result) = convertTimePrecision(val * MILLISECOND_PER_MINUTE, TSDB_TIME_PRECISION_MILLI, timePrecision);",
          "new_line_content": "  switch (unit) {",
          "content_same": false
        },
        {
          "line": 263,
          "old_api": "timegm",
          "new_api": null,
          "old_text": "timegm(&tm)",
          "new_text": null,
          "old_line_content": "  int64_t seconds = timegm(&tm);",
          "new_line_content": "/* mktime will be affected by TZ, set by using taos_options */",
          "content_same": false
        },
        {
          "line": 519,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(pInterval->interval == 0)",
          "new_text": null,
          "old_line_content": "    assert(pInterval->interval == 0);",
          "new_line_content": "  return (emon - smon) / (int32_t)interval;",
          "content_same": false
        },
        {
          "line": 394,
          "old_api": "convertTimePrecision",
          "new_api": null,
          "old_text": "convertTimePrecision(val * MILLISECOND_PER_HOUR, TSDB_TIME_PRECISION_MILLI, timePrecision)",
          "new_text": null,
          "old_line_content": "      (*result) = convertTimePrecision(val * MILLISECOND_PER_HOUR, TSDB_TIME_PRECISION_MILLI, timePrecision);",
          "new_line_content": "      break;",
          "content_same": false
        },
        {
          "line": 267,
          "old_api": "forwardToTimeStringEnd",
          "new_api": null,
          "old_text": "forwardToTimeStringEnd(timestr)",
          "new_text": null,
          "old_line_content": "  str = forwardToTimeStringEnd(timestr);",
          "new_line_content": "#else",
          "content_same": false
        },
        {
          "line": 397,
          "old_api": "convertTimePrecision",
          "new_api": null,
          "old_text": "convertTimePrecision(val * MILLISECOND_PER_DAY, TSDB_TIME_PRECISION_MILLI, timePrecision)",
          "new_text": null,
          "old_line_content": "      (*result) = convertTimePrecision(val * MILLISECOND_PER_DAY, TSDB_TIME_PRECISION_MILLI, timePrecision);",
          "new_line_content": "      break;",
          "content_same": false
        },
        {
          "line": 525,
          "old_api": "TSDB_TICK_PER_SECOND",
          "new_api": null,
          "old_text": "TSDB_TICK_PER_SECOND(precision)",
          "new_text": null,
          "old_line_content": "    start /= (int64_t)(TSDB_TICK_PER_SECOND(precision));",
          "new_line_content": "    return t;",
          "content_same": false
        },
        {
          "line": 400,
          "old_api": "convertTimePrecision",
          "new_api": null,
          "old_text": "convertTimePrecision(val * MILLISECOND_PER_WEEK, TSDB_TIME_PRECISION_MILLI, timePrecision)",
          "new_text": null,
          "old_line_content": "      (*result) = convertTimePrecision(val * MILLISECOND_PER_WEEK, TSDB_TIME_PRECISION_MILLI, timePrecision);",
          "new_line_content": "      break;",
          "content_same": false
        },
        {
          "line": 528,
          "old_api": "localtime_r",
          "new_api": null,
          "old_text": "localtime_r(&tt, &tm)",
          "new_text": null,
          "old_line_content": "    localtime_r(&tt, &tm);",
          "new_line_content": "  int64_t start = t;",
          "content_same": false
        },
        {
          "line": 274,
          "old_api": "parseFraction",
          "new_api": null,
          "old_text": "parseFraction(str, &str, timePrec)",
          "new_text": null,
          "old_line_content": "    if ((fraction = parseFraction(str, &str, timePrec)) < 0) {",
          "new_line_content": "  if ((str[0] == 'Z' || str[0] == 'z') && str[1] == '\\0') {",
          "content_same": false
        },
        {
          "line": 403,
          "old_api": "convertTimePrecision",
          "new_api": null,
          "old_text": "convertTimePrecision(val, TSDB_TIME_PRECISION_MILLI, timePrecision)",
          "new_text": null,
          "old_line_content": "      (*result) = convertTimePrecision(val, TSDB_TIME_PRECISION_MILLI, timePrecision);",
          "new_line_content": "      break;",
          "content_same": false
        },
        {
          "line": 406,
          "old_api": "convertTimePrecision",
          "new_api": null,
          "old_text": "convertTimePrecision(val, TSDB_TIME_PRECISION_MICRO, timePrecision)",
          "new_text": null,
          "old_line_content": "      (*result) = convertTimePrecision(val, TSDB_TIME_PRECISION_MICRO, timePrecision);",
          "new_line_content": "      break;",
          "content_same": false
        },
        {
          "line": 409,
          "old_api": "convertTimePrecision",
          "new_api": null,
          "old_text": "convertTimePrecision(val, TSDB_TIME_PRECISION_NANO, timePrecision)",
          "new_text": null,
          "old_line_content": "      (*result) = convertTimePrecision(val, TSDB_TIME_PRECISION_NANO, timePrecision);",
          "new_line_content": "      break;",
          "content_same": false
        },
        {
          "line": 287,
          "old_api": "parseTimezone",
          "new_api": null,
          "old_text": "parseTimezone(str, &tzOffset)",
          "new_text": null,
          "old_line_content": "      if (parseTimezone(str, &tzOffset) == -1) {",
          "new_line_content": "      return -1;",
          "content_same": false
        },
        {
          "line": 544,
          "old_api": "TSDB_TICK_PER_SECOND",
          "new_api": null,
          "old_text": "TSDB_TICK_PER_SECOND(precision)",
          "new_text": null,
          "old_line_content": "    start = (int64_t)(mktime(&tm) * TSDB_TICK_PER_SECOND(precision));",
          "new_line_content": "      mon = (int)(mon / pInterval->sliding * pInterval->sliding);",
          "content_same": false
        },
        {
          "line": 170,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(timePrec == TSDB_TIME_PRECISION_NANO)",
          "new_text": null,
          "old_line_content": "    assert(timePrec == TSDB_TIME_PRECISION_NANO);",
          "new_line_content": "    if (i >= MICRO_SEC_FRACTION_LEN) {",
          "content_same": false
        },
        {
          "line": 298,
          "old_api": "parseTimezone",
          "new_api": null,
          "old_text": "parseTimezone(str, &tzOffset)",
          "new_text": null,
          "old_line_content": "    if (parseTimezone(str, &tzOffset) == -1) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 177,
          "old_api": "strnatoi",
          "new_api": null,
          "old_text": "strnatoi(str, i)",
          "new_text": null,
          "old_line_content": "  fraction = strnatoi(str, i) * factor[times];",
          "new_line_content": "      i = NANO_SEC_FRACTION_LEN;",
          "content_same": false
        },
        {
          "line": 564,
          "old_api": "TSDB_TICK_PER_SECOND",
          "new_api": null,
          "old_text": "TSDB_TICK_PER_SECOND(precision)",
          "new_text": null,
          "old_line_content": "      start += (int64_t)(timezone * TSDB_TICK_PER_SECOND(precision));",
          "new_line_content": "      int64_t timezone = _timezone;",
          "content_same": false
        },
        {
          "line": 437,
          "old_api": "strtoll",
          "new_api": null,
          "old_text": "strtoll(token, &endPtr, 10)",
          "new_text": null,
          "old_line_content": "  int64_t timestamp = strtoll(token, &endPtr, 10);",
          "new_line_content": "int32_t parseAbsoluteDuration(char* token, int32_t tokenlen, int64_t* duration, int32_t timePrecision) {",
          "content_same": false
        },
        {
          "line": 314,
          "old_api": "strptime",
          "new_api": null,
          "old_text": "strptime(timestr, \"%Y-%m-%d %H:%M:%S\", &tm)",
          "new_text": null,
          "old_line_content": "  char* str = strptime(timestr, \"%Y-%m-%d %H:%M:%S\", &tm);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 448,
          "old_api": "getDuration",
          "new_api": null,
          "old_text": "getDuration(timestamp, unit, duration, timePrecision)",
          "new_text": null,
          "old_line_content": "  return getDuration(timestamp, unit, duration, timePrecision);",
          "new_line_content": "  char unit = token[tokenlen - 1];",
          "content_same": false
        },
        {
          "line": 193,
          "old_api": "strchr",
          "new_api": null,
          "old_text": "strchr(&str[i], ':')",
          "new_text": null,
          "old_line_content": "  char* sep = strchr(&str[i], ':');",
          "new_line_content": "    return -1;",
          "content_same": false
        },
        {
          "line": 197,
          "old_api": "strnatoi",
          "new_api": null,
          "old_text": "strnatoi(&str[i], len)",
          "new_text": null,
          "old_line_content": "    hour = strnatoi(&str[i], len);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 325,
          "old_api": "user_mktime64",
          "new_api": null,
          "old_text": "user_mktime64(tm.tm_year+1900, tm.tm_mon+1, tm.tm_mday, tm.tm_hour, tm.tm_min, tm.tm_sec, timezone)",
          "new_text": null,
          "old_line_content": "  int64_t seconds = user_mktime64(tm.tm_year+1900, tm.tm_mon+1, tm.tm_mday, tm.tm_hour, tm.tm_min, tm.tm_sec, timezone);",
          "new_line_content": "#if _MSC_VER >= 1900",
          "content_same": false
        },
        {
          "line": 455,
          "old_api": "strtoll",
          "new_api": null,
          "old_text": "strtoll(token, NULL, 10)",
          "new_text": null,
          "old_line_content": "  *duration = strtoll(token, NULL, 10);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 200,
          "old_api": "strnatoi",
          "new_api": null,
          "old_text": "strnatoi(&str[i], 2)",
          "new_text": null,
          "old_line_content": "    hour = strnatoi(&str[i], 2);",
          "new_line_content": "    int32_t len = (int32_t)(sep - &str[i]);",
          "content_same": false
        },
        {
          "line": 331,
          "old_api": "parseFraction",
          "new_api": null,
          "old_text": "parseFraction(str + 1, &str, timePrec)",
          "new_text": null,
          "old_line_content": "    if ((fraction = parseFraction(str + 1, &str, timePrec)) < 0) {",
          "new_line_content": "  ",
          "content_same": false
        },
        {
          "line": 589,
          "old_api": "taosTimeAdd",
          "new_api": null,
          "old_text": "taosTimeAdd(start, pInterval->offset, pInterval->offsetUnit, precision)",
          "new_text": null,
          "old_line_content": "    start = taosTimeAdd(start, pInterval->offset, pInterval->offsetUnit, precision);",
          "new_line_content": "      end = INT64_MAX;",
          "content_same": false
        },
        {
          "line": 591,
          "old_api": "taosTimeAdd",
          "new_api": null,
          "old_text": "taosTimeAdd(start, -pInterval->interval, pInterval->intervalUnit, precision)",
          "new_text": null,
          "old_line_content": "      start = taosTimeAdd(start, -pInterval->interval, pInterval->intervalUnit, precision);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 465,
          "old_api": "getDuration",
          "new_api": null,
          "old_text": "getDuration(*duration, *unit, duration, timePrecision)",
          "new_text": null,
          "old_line_content": "  return getDuration(*duration, *unit, duration, timePrecision);",
          "new_line_content": "  *unit = token[tokenLen - 1];",
          "content_same": false
        },
        {
          "line": 211,
          "old_api": "strnatoi",
          "new_api": null,
          "old_text": "strnatoi(&str[i], 2)",
          "new_text": null,
          "old_line_content": "  int64_t minute = strnatoi(&str[i], 2);",
          "new_line_content": "  if (minStr[1] != '\\0' && minStr[2] != '\\0') {",
          "content_same": false
        },
        {
          "line": 507,
          "old_api": "localtime_r",
          "new_api": null,
          "old_text": "localtime_r(&t, &tm)",
          "new_text": null,
          "old_line_content": "  localtime_r(&t, &tm);",
          "new_line_content": "  time_t t = (time_t)skey;",
          "content_same": false
        },
        {
          "line": 247,
          "old_api": "strptime",
          "new_api": null,
          "old_text": "strptime(timestr, \"%Y-%m-%dT%H:%M:%S\", &tm)",
          "new_text": null,
          "old_line_content": "    str = strptime(timestr, \"%Y-%m-%dT%H:%M:%S\", &tm);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 348,
          "old_api": "strptime",
          "new_api": null,
          "old_text": "strptime(timestr, \"%Y-%m-%d %H:%M:%S\", &tm)",
          "new_text": null,
          "old_line_content": "  char* str = strptime(timestr, \"%Y-%m-%d %H:%M:%S\", &tm);",
          "new_line_content": "int32_t parseLocaltimeWithDst(char* timestr, int64_t* time, int32_t timePrec) {",
          "content_same": false
        },
        {
          "line": 479,
          "old_api": "TSDB_TICK_PER_SECOND",
          "new_api": null,
          "old_text": "TSDB_TICK_PER_SECOND(precision)",
          "new_text": null,
          "old_line_content": "  time_t tt = (time_t)(t / TSDB_TICK_PER_SECOND(precision));",
          "new_line_content": "  } else if (unit != 'n') {",
          "content_same": false
        },
        {
          "line": 480,
          "old_api": "localtime_r",
          "new_api": null,
          "old_text": "localtime_r(&tt, &tm)",
          "new_text": null,
          "old_line_content": "  localtime_r(&tt, &tm);",
          "new_line_content": "    return t + duration;",
          "content_same": false
        },
        {
          "line": 354,
          "old_api": "mktime",
          "new_api": null,
          "old_text": "mktime(&tm)",
          "new_text": null,
          "old_line_content": "  int64_t seconds = mktime(&tm);",
          "new_line_content": "  if (str == NULL) {",
          "content_same": false
        },
        {
          "line": 611,
          "old_api": "localtime_r",
          "new_api": null,
          "old_text": "localtime_r(&t, &tm)",
          "new_text": null,
          "old_line_content": "    localtime_r(&t, &tm);",
          "new_line_content": "  size_t pos = 0;",
          "content_same": false
        },
        {
          "line": 612,
          "old_api": "strftime",
          "new_api": null,
          "old_text": "strftime(buf + pos, sizeof(buf), \"s=%Y-%m-%d %H:%M:%S\", &tm)",
          "new_text": null,
          "old_line_content": "    pos += strftime(buf + pos, sizeof(buf), \"s=%Y-%m-%d %H:%M:%S\", &tm);",
          "new_line_content": "  struct tm tm;",
          "content_same": false
        },
        {
          "line": 360,
          "old_api": "parseFraction",
          "new_api": null,
          "old_text": "parseFraction(str + 1, &str, timePrec)",
          "new_text": null,
          "old_line_content": "    if ((fraction = parseFraction(str + 1, &str, timePrec)) < 0) {",
          "new_line_content": "  ",
          "content_same": false
        },
        {
          "line": 623,
          "old_api": "strftime",
          "new_api": null,
          "old_text": "strftime(buf + pos, sizeof(buf), \"ms=%Y-%m-%d %H:%M:%S\", &tm)",
          "new_text": null,
          "old_line_content": "    pos += strftime(buf + pos, sizeof(buf), \"ms=%Y-%m-%d %H:%M:%S\", &tm);",
          "new_line_content": "    if (pos > 0) {",
          "content_same": false
        },
        {
          "line": 624,
          "old_api": "sprintf",
          "new_api": null,
          "old_text": "sprintf(buf + pos, \".%03d\", (int)(ts % 1000))",
          "new_text": null,
          "old_line_content": "    pos += sprintf(buf + pos, \".%03d\", (int)(ts % 1000));",
          "new_line_content": "      buf[pos++] = ' ';",
          "content_same": false
        },
        {
          "line": 113,
          "old_api": "strnchr",
          "new_api": null,
          "old_text": "strnchr(seg, 'Z', seg_len, false)",
          "new_text": null,
          "old_line_content": "  return (strnchr(seg, 'Z', seg_len, false) != NULL ||",
          "new_line_content": "  char *c = &seg[seg_len - 1];",
          "content_same": false
        },
        {
          "line": 114,
          "old_api": "strnchr",
          "new_api": null,
          "old_text": "strnchr(seg, 'z', seg_len, false)",
          "new_text": null,
          "old_line_content": "          strnchr(seg, 'z', seg_len, false) != NULL ||",
          "new_line_content": "  for (int i = 0; i < seg_len; ++i) {",
          "content_same": false
        },
        {
          "line": 115,
          "old_api": "strnchr",
          "new_api": null,
          "old_text": "strnchr(seg, '+', seg_len, false)",
          "new_text": null,
          "old_line_content": "          strnchr(seg, '+', seg_len, false) != NULL ||",
          "new_line_content": "    if (*c == 'Z' || *c  == 'z' || *c == '+' || *c == '-') {",
          "content_same": false
        },
        {
          "line": 116,
          "old_api": "strnchr",
          "new_api": null,
          "old_text": "strnchr(seg, '-', seg_len, false)",
          "new_text": null,
          "old_line_content": "          strnchr(seg, '-', seg_len, false) != NULL);",
          "new_line_content": "      return true;",
          "content_same": false
        },
        {
          "line": 372,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(fromPrecision == TSDB_TIME_PRECISION_MILLI ||\n         fromPrecision == TSDB_TIME_PRECISION_MICRO ||\n         fromPrecision == TSDB_TIME_PRECISION_NANO)",
          "new_text": null,
          "old_line_content": "  assert(fromPrecision == TSDB_TIME_PRECISION_MILLI ||",
          "new_line_content": "  *time = factor * seconds + fraction;",
          "content_same": false
        },
        {
          "line": 498,
          "old_api": "TSDB_TICK_PER_SECOND",
          "new_api": null,
          "old_text": "TSDB_TICK_PER_SECOND(precision)",
          "new_text": null,
          "old_line_content": "  skey /= (int64_t)(TSDB_TICK_PER_SECOND(precision));",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 375,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(toPrecision == TSDB_TIME_PRECISION_MILLI ||\n         toPrecision == TSDB_TIME_PRECISION_MICRO ||\n         toPrecision == TSDB_TIME_PRECISION_NANO)",
          "new_text": null,
          "old_line_content": "  assert(toPrecision == TSDB_TIME_PRECISION_MILLI ||",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 499,
          "old_api": "TSDB_TICK_PER_SECOND",
          "new_api": null,
          "old_text": "TSDB_TICK_PER_SECOND(precision)",
          "new_text": null,
          "old_line_content": "  ekey /= (int64_t)(TSDB_TICK_PER_SECOND(precision));",
          "new_line_content": "  if (unit != 'n' && unit != 'y') {",
          "content_same": false
        },
        {
          "line": 249,
          "old_api": "strptime",
          "new_api": null,
          "old_text": "strptime(timestr, \"%Y-%m-%d %H:%M:%S\", &tm)",
          "new_text": null,
          "old_line_content": "    str = strptime(timestr, \"%Y-%m-%d %H:%M:%S\", &tm);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 635,
          "old_api": "strftime",
          "new_api": null,
          "old_text": "strftime(buf + pos, sizeof(buf), \"us=%Y-%m-%d %H:%M:%S\", &tm)",
          "new_text": null,
          "old_line_content": "    pos += strftime(buf + pos, sizeof(buf), \"us=%Y-%m-%d %H:%M:%S\", &tm);",
          "new_line_content": "    if (pos > 0) {",
          "content_same": false
        },
        {
          "line": 636,
          "old_api": "sprintf",
          "new_api": null,
          "old_text": "sprintf(buf + pos, \".%06d\", (int)(ts % 1000000))",
          "new_text": null,
          "old_line_content": "    pos += sprintf(buf + pos, \".%06d\", (int)(ts % 1000000));",
          "new_line_content": "      buf[pos++] = ' ';",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 6,
      "total_additions": 52,
      "total_deletions": 56,
      "total_api_changes": 114
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 9,
        "api_related_lines": 114,
        "non_api_lines": 5,
        "non_api_line_numbers": [
          117,
          118,
          119,
          120,
          121
        ]
      }
    },
    "api_calls_before": 74,
    "api_calls_after": 70,
    "diff_info": {
      "added_lines": 9,
      "removed_lines": 4,
      "total_diff_lines": 25
    }
  }
}