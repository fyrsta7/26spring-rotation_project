{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/TDengine/modified_file/c3f83154adcc66e51faef252684415e7ed876dde",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/TDengine/modified_file/c3f83154adcc66e51faef252684415e7ed876dde/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/TDengine/modified_file/c3f83154adcc66e51faef252684415e7ed876dde/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/TDengine/modified_file/c3f83154adcc66e51faef252684415e7ed876dde/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 445,
          "old_api": "*pSet->fp)(pNode->p)",
          "new_api": "uTrace",
          "old_text": "*pSet->fp)(pNode->p)",
          "new_text": "uTrace(\"rsetId:%d p:%p rid:%\" PRId64 \" is released\", rsetId, pNode->p, rid)",
          "old_line_content": "    (*pSet->fp)(pNode->p);",
          "new_line_content": "       uTrace(\"rsetId:%d p:%p rid:%\" PRId64 \" is released\", rsetId, pNode->p, rid);",
          "content_same": false
        },
        {
          "line": 448,
          "old_api": "taosDecRsetCount",
          "new_api": "uTrace",
          "old_text": "taosDecRsetCount(pSet)",
          "new_text": "uTrace(\"rsetId:%d rid:%\" PRId64 \" is not there, failed to release/remove\", rsetId, rid)",
          "old_line_content": "    taosDecRsetCount(pSet);",
          "new_line_content": "    uTrace(\"rsetId:%d rid:%\" PRId64 \" is not there, failed to release/remove\", rsetId, rid);",
          "content_same": false
        },
        {
          "line": 457,
          "old_api": "atomic_val_compare_exchange_64",
          "new_api": "*pSet->fp)(pNode->p)",
          "old_text": "atomic_val_compare_exchange_64(lockedBy, 0, tid)",
          "new_text": "*pSet->fp)(pNode->p)",
          "old_line_content": "  while (atomic_val_compare_exchange_64(lockedBy, 0, tid) != 0) {",
          "new_line_content": "    (*pSet->fp)(pNode->p);",
          "content_same": false
        },
        {
          "line": 467,
          "old_api": "assert",
          "new_api": "taosGetSelfPthreadId",
          "old_text": "assert(false)",
          "new_text": "taosGetSelfPthreadId()",
          "old_line_content": "    assert(false);",
          "new_line_content": "  int64_t tid = taosGetSelfPthreadId();",
          "content_same": false
        },
        {
          "line": 493,
          "old_api": "tfree",
          "new_api": "atomic_sub_fetch_32",
          "old_text": "tfree(pSet->nodeList)",
          "new_text": "atomic_sub_fetch_32(&pSet->count, 1)",
          "old_line_content": "    tfree(pSet->nodeList);",
          "new_line_content": "  int32_t count = atomic_sub_fetch_32(&pSet->count, 1);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 512,
          "old_api": null,
          "new_api": "pthread_mutex_unlock",
          "old_text": null,
          "new_text": "pthread_mutex_unlock(&tsRefMutex)",
          "old_line_content": "",
          "new_line_content": "  pthread_mutex_unlock(&tsRefMutex);",
          "content_same": false
        },
        {
          "line": 387,
          "old_api": null,
          "new_api": "pthread_mutex_unlock",
          "old_text": null,
          "new_text": "pthread_mutex_unlock(&tsRefMutex)",
          "old_line_content": "  if (rsetId < 0 || rsetId >= TSDB_REF_OBJECTS) {",
          "new_line_content": "  pthread_mutex_unlock(&tsRefMutex);",
          "content_same": false
        },
        {
          "line": 400,
          "old_api": null,
          "new_api": "uTrace",
          "old_text": null,
          "new_text": "uTrace(\"rsetId:%d rid:%\" PRId64 \" failed to remove, rsetId not valid\", rsetId, rid)",
          "old_line_content": "  if (pSet->state == TSDB_REF_STATE_EMPTY) {",
          "new_line_content": "    uTrace(\"rsetId:%d rid:%\" PRId64 \" failed to remove, rsetId not valid\", rsetId, rid);",
          "content_same": false
        },
        {
          "line": 406,
          "old_api": null,
          "new_api": "uTrace",
          "old_text": null,
          "new_text": "uTrace(\"rsetId:%d rid:%\" PRId64 \" failed to remove, rid not valid\", rsetId, rid)",
          "old_line_content": "  hash = rid % pSet->max;",
          "new_line_content": "    uTrace(\"rsetId:%d rid:%\" PRId64 \" failed to remove, rid not valid\", rsetId, rid);",
          "content_same": false
        },
        {
          "line": 413,
          "old_api": null,
          "new_api": "uTrace",
          "old_text": null,
          "new_text": "uTrace(\"rsetId:%d rid:%\" PRId64 \" failed to remove, cleaned\", rsetId, rid)",
          "old_line_content": "",
          "new_line_content": "    uTrace(\"rsetId:%d rid:%\" PRId64 \" failed to remove, cleaned\", rsetId, rid);",
          "content_same": false
        },
        {
          "line": 419,
          "old_api": null,
          "new_api": "taosLockList",
          "old_text": null,
          "new_text": "taosLockList(pSet->lockedBy+hash)",
          "old_line_content": "    if (remove) pNode->removed = 1;",
          "new_line_content": "  taosLockList(pSet->lockedBy+hash);",
          "content_same": false
        },
        {
          "line": 322,
          "old_api": null,
          "new_api": "taosUnlockList",
          "old_text": null,
          "new_text": "taosUnlockList(pSet->lockedBy+hash)",
          "old_line_content": "    if (pNode == NULL) {",
          "new_line_content": "        taosUnlockList(pSet->lockedBy+hash);",
          "content_same": false
        },
        {
          "line": 453,
          "old_api": null,
          "new_api": "taosUnlockList",
          "old_text": null,
          "new_text": "taosUnlockList(pSet->lockedBy+hash)",
          "old_line_content": "",
          "new_line_content": "  taosUnlockList(pSet->lockedBy+hash);",
          "content_same": false
        },
        {
          "line": 456,
          "old_api": null,
          "new_api": "uTrace",
          "old_text": null,
          "new_text": "uTrace(\"rsetId:%d p:%p rid:%\" PRId64 \" is removed, count:%d, free mem: %p\", rsetId, pNode->p, rid, pSet->count, pNode)",
          "old_line_content": "  int     i = 0;",
          "new_line_content": "    uTrace(\"rsetId:%d p:%p rid:%\" PRId64 \" is removed, count:%d, free mem: %p\", rsetId, pNode->p, rid, pSet->count, pNode);",
          "content_same": false
        },
        {
          "line": 329,
          "old_api": null,
          "new_api": "taosLockList",
          "old_text": null,
          "new_text": "taosLockList(pSet->lockedBy+hash)",
          "old_line_content": "    }",
          "new_line_content": "        taosLockList(pSet->lockedBy+hash);",
          "content_same": false
        },
        {
          "line": 458,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free(pNode)",
          "old_line_content": "    if (++i % 100 == 0) {",
          "new_line_content": "    free(pNode);",
          "content_same": false
        },
        {
          "line": 460,
          "old_api": null,
          "new_api": "taosDecRsetCount",
          "old_text": null,
          "new_text": "taosDecRsetCount(pSet)",
          "old_line_content": "    }",
          "new_line_content": "    taosDecRsetCount(pSet);",
          "content_same": false
        },
        {
          "line": 339,
          "old_api": null,
          "new_api": "taosUnlockList",
          "old_text": null,
          "new_text": "taosUnlockList(pSet->lockedBy+hash)",
          "old_line_content": "",
          "new_line_content": "        taosUnlockList(pSet->lockedBy+hash);",
          "content_same": false
        },
        {
          "line": 469,
          "old_api": null,
          "new_api": "atomic_val_compare_exchange_64",
          "old_text": null,
          "new_text": "atomic_val_compare_exchange_64(lockedBy, 0, tid)",
          "old_line_content": "}",
          "new_line_content": "  while (atomic_val_compare_exchange_64(lockedBy, 0, tid) != 0) {",
          "content_same": false
        },
        {
          "line": 471,
          "old_api": null,
          "new_api": "sched_yield",
          "old_text": null,
          "new_text": "sched_yield()",
          "old_line_content": "static void taosInitRefModule(void) {",
          "new_line_content": "      sched_yield();",
          "content_same": false
        },
        {
          "line": 346,
          "old_api": null,
          "new_api": "taosUnlockList",
          "old_text": null,
          "new_text": "taosUnlockList(pSet->lockedBy+hash)",
          "old_line_content": "  return newP;",
          "new_line_content": "      taosUnlockList(pSet->lockedBy+hash);",
          "content_same": false
        },
        {
          "line": 347,
          "old_api": null,
          "new_api": "uTrace",
          "old_text": null,
          "new_text": "uTrace(\"rsetId:%d p:%p rid:%\" PRId64 \" is returned\", rsetId, newP, rid)",
          "old_line_content": "}",
          "new_line_content": "      uTrace(\"rsetId:%d p:%p rid:%\" PRId64 \" is returned\", rsetId, newP, rid);",
          "content_same": false
        },
        {
          "line": 349,
          "old_api": null,
          "new_api": "uTrace",
          "old_text": null,
          "new_text": "uTrace(\"rsetId:%d the list is over\", rsetId)",
          "old_line_content": "int taosListRef() {",
          "new_line_content": "      uTrace(\"rsetId:%d the list is over\", rsetId);",
          "content_same": false
        },
        {
          "line": 477,
          "old_api": null,
          "new_api": "taosGetSelfPthreadId",
          "old_text": null,
          "new_text": "taosGetSelfPthreadId()",
          "old_line_content": "  // uTrace(\"rsetId:%d inc count:%d\", pSet->rsetId, count);",
          "new_line_content": "  int64_t tid = taosGetSelfPthreadId();",
          "content_same": false
        },
        {
          "line": 478,
          "old_api": null,
          "new_api": "atomic_val_compare_exchange_64",
          "old_text": null,
          "new_text": "atomic_val_compare_exchange_64(lockedBy, tid, 0)",
          "old_line_content": "}",
          "new_line_content": "  if (atomic_val_compare_exchange_64(lockedBy, tid, 0) != tid) {",
          "content_same": false
        },
        {
          "line": 352,
          "old_api": null,
          "new_api": "taosReleaseRef",
          "old_text": null,
          "new_text": "taosReleaseRef(rsetId, rid)",
          "old_line_content": "  int       num = 0;",
          "new_line_content": "    if (rid > 0) taosReleaseRef(rsetId, rid);  // release the current one",
          "content_same": false
        },
        {
          "line": 479,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(false)",
          "old_line_content": "",
          "new_line_content": "    assert(false);",
          "content_same": false
        },
        {
          "line": 356,
          "old_api": null,
          "new_api": "taosDecRsetCount",
          "old_text": null,
          "new_text": "taosDecRsetCount(pSet)",
          "old_line_content": "  for (int i = 0; i < TSDB_REF_OBJECTS; ++i) {",
          "new_line_content": "  taosDecRsetCount(pSet);",
          "content_same": false
        },
        {
          "line": 484,
          "old_api": null,
          "new_api": "pthread_mutex_init",
          "old_text": null,
          "new_text": "pthread_mutex_init(&tsRefMutex, NULL)",
          "old_line_content": "  if (count > 0) return;",
          "new_line_content": "  pthread_mutex_init(&tsRefMutex, NULL);",
          "content_same": false
        },
        {
          "line": 488,
          "old_api": null,
          "new_api": "atomic_add_fetch_32",
          "old_text": null,
          "new_text": "atomic_add_fetch_32(&pSet->count, 1)",
          "old_line_content": "  if (pSet->state != TSDB_REF_STATE_EMPTY) {",
          "new_line_content": "  atomic_add_fetch_32(&pSet->count, 1);",
          "content_same": false
        },
        {
          "line": 366,
          "old_api": null,
          "new_api": "pthread_mutex_lock",
          "old_text": null,
          "new_text": "pthread_mutex_lock(&tsRefMutex)",
          "old_line_content": "",
          "new_line_content": "  pthread_mutex_lock(&tsRefMutex);",
          "content_same": false
        },
        {
          "line": 498,
          "old_api": null,
          "new_api": "pthread_mutex_lock",
          "old_text": null,
          "new_text": "pthread_mutex_lock(&tsRefMutex)",
          "old_line_content": "  }",
          "new_line_content": "  pthread_mutex_lock(&tsRefMutex);",
          "content_same": false
        },
        {
          "line": 374,
          "old_api": null,
          "new_api": "uInfo",
          "old_text": null,
          "new_text": "uInfo(\"rsetId:%d state:%d count::%d\", i, pSet->state, pSet->count)",
          "old_line_content": "",
          "new_line_content": "    uInfo(\"rsetId:%d state:%d count::%d\", i, pSet->state, pSet->count);",
          "content_same": false
        },
        {
          "line": 505,
          "old_api": null,
          "new_api": "tfree",
          "old_text": null,
          "new_text": "tfree(pSet->nodeList)",
          "old_line_content": "",
          "new_line_content": "    tfree(pSet->nodeList);",
          "content_same": false
        },
        {
          "line": 506,
          "old_api": null,
          "new_api": "tfree",
          "old_text": null,
          "new_text": "tfree(pSet->lockedBy)",
          "old_line_content": "",
          "new_line_content": "    tfree(pSet->lockedBy);",
          "content_same": false
        },
        {
          "line": 380,
          "old_api": null,
          "new_api": "uInfo",
          "old_text": null,
          "new_text": "uInfo(\"rsetId:%d p:%p rid:%\" PRId64 \"count:%d\", i, pNode->p, pNode->rid, pNode->count)",
          "old_line_content": "static int taosDecRefCount(int rsetId, int64_t rid, int remove) {",
          "new_line_content": "        uInfo(\"rsetId:%d p:%p rid:%\" PRId64 \"count:%d\", i, pNode->p, pNode->rid, pNode->count);",
          "content_same": false
        },
        {
          "line": 509,
          "old_api": null,
          "new_api": "uTrace",
          "old_text": null,
          "new_text": "uTrace(\"rsetId:%d is cleaned, refSetNum:%d count:%d\", pSet->rsetId, tsRefSetNum, pSet->count)",
          "old_line_content": "",
          "new_line_content": "    uTrace(\"rsetId:%d is cleaned, refSetNum:%d count:%d\", pSet->rsetId, tsRefSetNum, pSet->count);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 388,
          "old_api": "uTrace",
          "new_api": null,
          "old_text": "uTrace(\"rsetId:%d rid:%\" PRId64 \" failed to remove, rsetId not valid\", rsetId, rid)",
          "new_text": null,
          "old_line_content": "    uTrace(\"rsetId:%d rid:%\" PRId64 \" failed to remove, rsetId not valid\", rsetId, rid);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 394,
          "old_api": "uTrace",
          "new_api": null,
          "old_text": "uTrace(\"rsetId:%d rid:%\" PRId64 \" failed to remove, rid not valid\", rsetId, rid)",
          "new_text": null,
          "old_line_content": "    uTrace(\"rsetId:%d rid:%\" PRId64 \" failed to remove, rid not valid\", rsetId, rid);",
          "new_line_content": "  SRefSet  *pSet;",
          "content_same": false
        },
        {
          "line": 401,
          "old_api": "uTrace",
          "new_api": null,
          "old_text": "uTrace(\"rsetId:%d rid:%\" PRId64 \" failed to remove, cleaned\", rsetId, rid)",
          "new_text": null,
          "old_line_content": "    uTrace(\"rsetId:%d rid:%\" PRId64 \" failed to remove, cleaned\", rsetId, rid);",
          "new_line_content": "    terrno = TSDB_CODE_REF_INVALID_ID;",
          "content_same": false
        },
        {
          "line": 407,
          "old_api": "taosLockList",
          "new_api": null,
          "old_text": "taosLockList(pSet->lockedBy+hash)",
          "new_text": null,
          "old_line_content": "  taosLockList(pSet->lockedBy+hash);",
          "new_line_content": "    terrno = TSDB_CODE_REF_NOT_EXIST;",
          "content_same": false
        },
        {
          "line": 433,
          "old_api": "uTrace",
          "new_api": null,
          "old_text": "uTrace(\"rsetId:%d p:%p rid:%\" PRId64 \" is released\", rsetId, pNode->p, rid)",
          "new_text": null,
          "old_line_content": "       uTrace(\"rsetId:%d p:%p rid:%\" PRId64 \" is released\", rsetId, pNode->p, rid);",
          "new_line_content": "    if (pNode->count <= 0) {",
          "content_same": false
        },
        {
          "line": 436,
          "old_api": "uTrace",
          "new_api": null,
          "old_text": "uTrace(\"rsetId:%d rid:%\" PRId64 \" is not there, failed to release/remove\", rsetId, rid)",
          "new_text": null,
          "old_line_content": "    uTrace(\"rsetId:%d rid:%\" PRId64 \" is not there, failed to release/remove\", rsetId, rid);",
          "new_line_content": "      } else {",
          "content_same": false
        },
        {
          "line": 441,
          "old_api": "taosUnlockList",
          "new_api": null,
          "old_text": "taosUnlockList(pSet->lockedBy+hash)",
          "new_text": null,
          "old_line_content": "  taosUnlockList(pSet->lockedBy+hash);",
          "new_line_content": "        pNode->next->prev = pNode->prev;",
          "content_same": false
        },
        {
          "line": 444,
          "old_api": "uTrace",
          "new_api": null,
          "old_text": "uTrace(\"rsetId:%d p:%p rid:%\" PRId64 \" is removed, count:%d, free mem: %p\", rsetId, pNode->p, rid, pSet->count, pNode)",
          "new_text": null,
          "old_line_content": "    uTrace(\"rsetId:%d p:%p rid:%\" PRId64 \" is removed, count:%d, free mem: %p\", rsetId, pNode->p, rid, pSet->count, pNode);",
          "new_line_content": "    } else {",
          "content_same": false
        },
        {
          "line": 317,
          "old_api": "taosUnlockList",
          "new_api": null,
          "old_text": "taosUnlockList(pSet->lockedBy+hash)",
          "new_text": null,
          "old_line_content": "        taosUnlockList(pSet->lockedBy+hash);",
          "new_line_content": "      while (pNode) {",
          "content_same": false
        },
        {
          "line": 446,
          "old_api": "free",
          "new_api": null,
          "old_text": "free(pNode)",
          "new_text": null,
          "old_line_content": "    free(pNode);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 324,
          "old_api": "taosLockList",
          "new_api": null,
          "old_text": "taosLockList(pSet->lockedBy+hash)",
          "new_text": null,
          "old_line_content": "        taosLockList(pSet->lockedBy+hash);",
          "new_line_content": "      }",
          "content_same": false
        },
        {
          "line": 327,
          "old_api": "taosUnlockList",
          "new_api": null,
          "old_text": "taosUnlockList(pSet->lockedBy+hash)",
          "new_text": null,
          "old_line_content": "        taosUnlockList(pSet->lockedBy+hash);",
          "new_line_content": "    if (pNode == NULL) {",
          "content_same": false
        },
        {
          "line": 455,
          "old_api": "taosGetSelfPthreadId",
          "new_api": null,
          "old_text": "taosGetSelfPthreadId()",
          "new_text": null,
          "old_line_content": "  int64_t tid = taosGetSelfPthreadId();",
          "new_line_content": "  if (released) {",
          "content_same": false
        },
        {
          "line": 459,
          "old_api": "sched_yield",
          "new_api": null,
          "old_text": "sched_yield()",
          "new_text": null,
          "old_line_content": "      sched_yield();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 334,
          "old_api": "taosUnlockList",
          "new_api": null,
          "old_text": "taosUnlockList(pSet->lockedBy+hash)",
          "new_text": null,
          "old_line_content": "      taosUnlockList(pSet->lockedBy+hash);",
          "new_line_content": "            if (!pNode->removed) break;",
          "content_same": false
        },
        {
          "line": 335,
          "old_api": "uTrace",
          "new_api": null,
          "old_text": "uTrace(\"rsetId:%d p:%p rid:%\" PRId64 \" is returned\", rsetId, newP, rid)",
          "new_text": null,
          "old_line_content": "      uTrace(\"rsetId:%d p:%p rid:%\" PRId64 \" is returned\", rsetId, newP, rid);",
          "new_line_content": "            pNode = pNode->next;",
          "content_same": false
        },
        {
          "line": 337,
          "old_api": "uTrace",
          "new_api": null,
          "old_text": "uTrace(\"rsetId:%d the list is over\", rsetId)",
          "new_text": null,
          "old_line_content": "      uTrace(\"rsetId:%d the list is over\", rsetId);",
          "new_line_content": "          if (pNode) break;",
          "content_same": false
        },
        {
          "line": 465,
          "old_api": "taosGetSelfPthreadId",
          "new_api": null,
          "old_text": "taosGetSelfPthreadId()",
          "new_text": null,
          "old_line_content": "  int64_t tid = taosGetSelfPthreadId();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 466,
          "old_api": "atomic_val_compare_exchange_64",
          "new_api": null,
          "old_text": "atomic_val_compare_exchange_64(lockedBy, tid, 0)",
          "new_text": null,
          "old_line_content": "  if (atomic_val_compare_exchange_64(lockedBy, tid, 0) != tid) {",
          "new_line_content": "static void taosLockList(int64_t *lockedBy) {",
          "content_same": false
        },
        {
          "line": 340,
          "old_api": "taosReleaseRef",
          "new_api": null,
          "old_text": "taosReleaseRef(rsetId, rid)",
          "new_text": null,
          "old_line_content": "    if (rid > 0) taosReleaseRef(rsetId, rid);  // release the current one",
          "new_line_content": "      }",
          "content_same": false
        },
        {
          "line": 344,
          "old_api": "taosDecRsetCount",
          "new_api": null,
          "old_text": "taosDecRsetCount(pSet)",
          "new_text": null,
          "old_line_content": "  taosDecRsetCount(pSet);",
          "new_line_content": "      pNode->count++;  // acquire it",
          "content_same": false
        },
        {
          "line": 472,
          "old_api": "pthread_mutex_init",
          "new_api": null,
          "old_text": "pthread_mutex_init(&tsRefMutex, NULL)",
          "new_text": null,
          "old_line_content": "  pthread_mutex_init(&tsRefMutex, NULL);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 476,
          "old_api": "atomic_add_fetch_32",
          "new_api": null,
          "old_text": "atomic_add_fetch_32(&pSet->count, 1)",
          "new_text": null,
          "old_line_content": "  atomic_add_fetch_32(&pSet->count, 1);",
          "new_line_content": "static void taosUnlockList(int64_t *lockedBy) {",
          "content_same": false
        },
        {
          "line": 481,
          "old_api": "atomic_sub_fetch_32",
          "new_api": null,
          "old_text": "atomic_sub_fetch_32(&pSet->count, 1)",
          "new_text": null,
          "old_line_content": "  int32_t count = atomic_sub_fetch_32(&pSet->count, 1);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 354,
          "old_api": "pthread_mutex_lock",
          "new_api": null,
          "old_text": "pthread_mutex_lock(&tsRefMutex)",
          "new_text": null,
          "old_line_content": "  pthread_mutex_lock(&tsRefMutex);",
          "new_line_content": "  } while (newP && pNode->removed);",
          "content_same": false
        },
        {
          "line": 486,
          "old_api": "pthread_mutex_lock",
          "new_api": null,
          "old_text": "pthread_mutex_lock(&tsRefMutex)",
          "new_text": null,
          "old_line_content": "  pthread_mutex_lock(&tsRefMutex);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 362,
          "old_api": "uInfo",
          "new_api": null,
          "old_text": "uInfo(\"rsetId:%d state:%d count::%d\", i, pSet->state, pSet->count)",
          "new_text": null,
          "old_line_content": "    uInfo(\"rsetId:%d state:%d count::%d\", i, pSet->state, pSet->count);",
          "new_line_content": "  SRefSet  *pSet;",
          "content_same": false
        },
        {
          "line": 494,
          "old_api": "tfree",
          "new_api": null,
          "old_text": "tfree(pSet->lockedBy)",
          "new_text": null,
          "old_line_content": "    tfree(pSet->lockedBy);",
          "new_line_content": "  // uTrace(\"rsetId:%d dec count:%d\", pSet->rsetId, count);",
          "content_same": false
        },
        {
          "line": 368,
          "old_api": "uInfo",
          "new_api": null,
          "old_text": "uInfo(\"rsetId:%d p:%p rid:%\" PRId64 \"count:%d\", i, pNode->p, pNode->rid, pNode->count)",
          "new_text": null,
          "old_line_content": "        uInfo(\"rsetId:%d p:%p rid:%\" PRId64 \"count:%d\", i, pNode->p, pNode->rid, pNode->count);",
          "new_line_content": "  for (int i = 0; i < TSDB_REF_OBJECTS; ++i) {",
          "content_same": false
        },
        {
          "line": 497,
          "old_api": "uTrace",
          "new_api": null,
          "old_text": "uTrace(\"rsetId:%d is cleaned, refSetNum:%d count:%d\", pSet->rsetId, tsRefSetNum, pSet->count)",
          "new_text": null,
          "old_line_content": "    uTrace(\"rsetId:%d is cleaned, refSetNum:%d count:%d\", pSet->rsetId, tsRefSetNum, pSet->count);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 500,
          "old_api": "pthread_mutex_unlock",
          "new_api": null,
          "old_text": "pthread_mutex_unlock(&tsRefMutex)",
          "new_text": null,
          "old_line_content": "  pthread_mutex_unlock(&tsRefMutex);",
          "new_line_content": "  if (pSet->state != TSDB_REF_STATE_EMPTY) {",
          "content_same": false
        },
        {
          "line": 375,
          "old_api": "pthread_mutex_unlock",
          "new_api": null,
          "old_text": "pthread_mutex_unlock(&tsRefMutex)",
          "new_text": null,
          "old_line_content": "  pthread_mutex_unlock(&tsRefMutex);",
          "new_line_content": "",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 5,
      "total_additions": 32,
      "total_deletions": 32,
      "total_api_changes": 69
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 14,
        "api_related_lines": 69,
        "non_api_lines": 10,
        "non_api_line_numbers": [
          320,
          326,
          331,
          332,
          333,
          336,
          338,
          316,
          318,
          319
        ]
      }
    },
    "api_calls_before": 85,
    "api_calls_after": 85,
    "diff_info": {
      "added_lines": 13,
      "removed_lines": 1,
      "total_diff_lines": 33
    }
  }
}