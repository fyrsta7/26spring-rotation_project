{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/TDengine/modified_file/a2d75a327cb68a4f59c76c6d2b9a2150880b6eee",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/TDengine/modified_file/a2d75a327cb68a4f59c76c6d2b9a2150880b6eee/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/TDengine/modified_file/a2d75a327cb68a4f59c76c6d2b9a2150880b6eee/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/TDengine/modified_file/a2d75a327cb68a4f59c76c6d2b9a2150880b6eee/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": true,
    "api_changes": {
      "replacements": [
        {
          "line": 694,
          "old_api": "freeUdfDataDataBlock",
          "new_api": "convertDataBlockToUdfDataBlock",
          "old_text": "freeUdfDataDataBlock(&input)",
          "new_text": "convertDataBlockToUdfDataBlock(&call->block, &input)",
          "old_line_content": "      freeUdfDataDataBlock(&input);",
          "new_line_content": "      convertDataBlockToUdfDataBlock(&call->block, &input);",
          "content_same": false
        },
        {
          "line": 695,
          "old_api": "convertUdfColumnToDataBlock",
          "new_api": "udfScalarProcFunc",
          "old_text": "convertUdfColumnToDataBlock(&output, &response.callRsp.resultData)",
          "new_text": "udf->scriptPlugin->udfScalarProcFunc(&input, &output, udf->scriptUdfCtx)",
          "old_line_content": "      convertUdfColumnToDataBlock(&output, &response.callRsp.resultData);",
          "new_line_content": "      code = udf->scriptPlugin->udfScalarProcFunc(&input, &output, udf->scriptUdfCtx);",
          "content_same": false
        },
        {
          "line": 696,
          "old_api": "freeUdfColumn",
          "new_api": "freeUdfDataDataBlock",
          "old_text": "freeUdfColumn(&output)",
          "new_text": "freeUdfDataDataBlock(&input)",
          "old_line_content": "      freeUdfColumn(&output);",
          "new_line_content": "      freeUdfDataDataBlock(&input);",
          "content_same": false
        },
        {
          "line": 709,
          "old_api": "udfAggProcFunc",
          "new_api": "convertDataBlockToUdfDataBlock",
          "old_text": "udf->scriptPlugin->udfAggProcFunc(&input, &call->interBuf, &outBuf, udf->scriptUdfCtx)",
          "new_text": "convertDataBlockToUdfDataBlock(&call->block, &input)",
          "old_line_content": "      code = udf->scriptPlugin->udfAggProcFunc(&input, &call->interBuf, &outBuf, udf->scriptUdfCtx);",
          "new_line_content": "      convertDataBlockToUdfDataBlock(&call->block, &input);",
          "content_same": false
        },
        {
          "line": 710,
          "old_api": "freeUdfInterBuf",
          "new_api": "taosMemoryMalloc",
          "old_text": "freeUdfInterBuf(&call->interBuf)",
          "new_text": "taosMemoryMalloc(udf->bufSize)",
          "old_line_content": "      freeUdfInterBuf(&call->interBuf);",
          "new_line_content": "      SUdfInterBuf outBuf = {.buf = taosMemoryMalloc(udf->bufSize), .bufLen = udf->bufSize, .numOfResult = 0};",
          "content_same": false
        },
        {
          "line": 711,
          "old_api": "freeUdfDataDataBlock",
          "new_api": "udfAggProcFunc",
          "old_text": "freeUdfDataDataBlock(&input)",
          "new_text": "udf->scriptPlugin->udfAggProcFunc(&input, &call->interBuf, &outBuf, udf->scriptUdfCtx)",
          "old_line_content": "      freeUdfDataDataBlock(&input);",
          "new_line_content": "      code = udf->scriptPlugin->udfAggProcFunc(&input, &call->interBuf, &outBuf, udf->scriptUdfCtx);",
          "content_same": false
        },
        {
          "line": 719,
          "old_api": "freeUdfInterBuf",
          "new_api": "taosMemoryMalloc",
          "old_text": "freeUdfInterBuf(&call->interBuf)",
          "new_text": "taosMemoryMalloc(udf->bufSize)",
          "old_line_content": "      freeUdfInterBuf(&call->interBuf);",
          "new_line_content": "      SUdfInterBuf outBuf = {.buf = taosMemoryMalloc(udf->bufSize), .bufLen = udf->bufSize, .numOfResult = 0};",
          "content_same": false
        },
        {
          "line": 720,
          "old_api": "freeUdfInterBuf",
          "new_api": "udfAggMergeFunc",
          "old_text": "freeUdfInterBuf(&call->interBuf2)",
          "new_text": "udf->scriptPlugin->udfAggMergeFunc(&call->interBuf, &call->interBuf2, &outBuf, udf->scriptUdfCtx)",
          "old_line_content": "      freeUdfInterBuf(&call->interBuf2);",
          "new_line_content": "      code = udf->scriptPlugin->udfAggMergeFunc(&call->interBuf, &call->interBuf2, &outBuf, udf->scriptUdfCtx);",
          "content_same": false
        },
        {
          "line": 728,
          "old_api": "freeUdfInterBuf",
          "new_api": "taosMemoryMalloc",
          "old_text": "freeUdfInterBuf(&call->interBuf)",
          "new_text": "taosMemoryMalloc(udf->bufSize)",
          "old_line_content": "      freeUdfInterBuf(&call->interBuf);",
          "new_line_content": "      SUdfInterBuf outBuf = {.buf = taosMemoryMalloc(udf->bufSize), .bufLen = udf->bufSize, .numOfResult = 0};",
          "content_same": false
        },
        {
          "line": 743,
          "old_api": "taosMemoryMalloc",
          "new_api": "encodeUdfResponse",
          "old_text": "taosMemoryMalloc(len)",
          "new_text": "encodeUdfResponse(NULL, rsp)",
          "old_line_content": "  void *bufBegin = taosMemoryMalloc(len);",
          "new_line_content": "  int32_t len = encodeUdfResponse(NULL, rsp);",
          "content_same": false
        },
        {
          "line": 745,
          "old_api": "encodeUdfResponse",
          "new_api": "taosMemoryMalloc",
          "old_text": "encodeUdfResponse(&buf, rsp)",
          "new_text": "taosMemoryMalloc(len)",
          "old_line_content": "  encodeUdfResponse(&buf, rsp);",
          "new_line_content": "  void *bufBegin = taosMemoryMalloc(len);",
          "content_same": false
        },
        {
          "line": 793,
          "old_api": "uv_mutex_unlock",
          "new_api": "strlen",
          "old_text": "uv_mutex_unlock(&global.udfsMutex)",
          "new_text": "strlen(udf->name)",
          "old_line_content": "  uv_mutex_unlock(&global.udfsMutex);",
          "new_line_content": "    taosHashRemove(global.udfsHash, udf->name, strlen(udf->name));",
          "content_same": false
        },
        {
          "line": 795,
          "old_api": "fnInfo",
          "new_api": "uv_mutex_unlock",
          "old_text": "fnInfo(\"udf teardown. udf name: %s type %d: context %p\", udf->name, udf->scriptType, (void *)(udf->scriptUdfCtx))",
          "new_text": "uv_mutex_unlock(&global.udfsMutex)",
          "old_line_content": "    fnInfo(\"udf teardown. udf name: %s type %d: context %p\", udf->name, udf->scriptType, (void *)(udf->scriptUdfCtx));",
          "new_line_content": "  uv_mutex_unlock(&global.udfsMutex);",
          "content_same": false
        },
        {
          "line": 797,
          "old_api": "uv_mutex_destroy",
          "new_api": "fnInfo",
          "old_text": "uv_mutex_destroy(&udf->lock)",
          "new_text": "fnInfo(\"udf teardown. udf name: %s type %d: context %p\", udf->name, udf->scriptType, (void *)(udf->scriptUdfCtx))",
          "old_line_content": "    uv_mutex_destroy(&udf->lock);",
          "new_line_content": "    fnInfo(\"udf teardown. udf name: %s type %d: context %p\", udf->name, udf->scriptType, (void *)(udf->scriptUdfCtx));",
          "content_same": false
        },
        {
          "line": 798,
          "old_api": "udfDestroyFunc",
          "new_api": "uv_cond_destroy",
          "old_text": "udf->scriptPlugin->udfDestroyFunc(udf->scriptUdfCtx)",
          "new_text": "uv_cond_destroy(&udf->condReady)",
          "old_line_content": "    code = udf->scriptPlugin->udfDestroyFunc(udf->scriptUdfCtx);",
          "new_line_content": "    uv_cond_destroy(&udf->condReady);",
          "content_same": false
        },
        {
          "line": 799,
          "old_api": "fnDebug",
          "new_api": "uv_mutex_destroy",
          "old_text": "fnDebug(\"udfd destroy function returns %d\", code)",
          "new_text": "uv_mutex_destroy(&udf->lock)",
          "old_line_content": "    fnDebug(\"udfd destroy function returns %d\", code);",
          "new_line_content": "    uv_mutex_destroy(&udf->lock);",
          "content_same": false
        },
        {
          "line": 800,
          "old_api": "taosMemoryFree",
          "new_api": "udfDestroyFunc",
          "old_text": "taosMemoryFree(udf)",
          "new_text": "udf->scriptPlugin->udfDestroyFunc(udf->scriptUdfCtx)",
          "old_line_content": "    taosMemoryFree(udf);",
          "new_line_content": "    code = udf->scriptPlugin->udfDestroyFunc(udf->scriptUdfCtx);",
          "content_same": false
        },
        {
          "line": 811,
          "old_api": "taosMemoryMalloc",
          "new_api": "encodeUdfResponse",
          "old_text": "taosMemoryMalloc(len)",
          "new_text": "encodeUdfResponse(NULL, rsp)",
          "old_line_content": "  void *bufBegin = taosMemoryMalloc(len);",
          "new_line_content": "  int32_t len = encodeUdfResponse(NULL, rsp);",
          "content_same": false
        },
        {
          "line": 813,
          "old_api": "encodeUdfResponse",
          "new_api": "taosMemoryMalloc",
          "old_text": "encodeUdfResponse(&buf, rsp)",
          "new_text": "taosMemoryMalloc(len)",
          "old_line_content": "  encodeUdfResponse(&buf, rsp);",
          "new_line_content": "  void *bufBegin = taosMemoryMalloc(len);",
          "content_same": false
        },
        {
          "line": 816,
          "old_api": "taosMemoryFree",
          "new_api": "uv_buf_init",
          "old_text": "taosMemoryFree(uvUdf->input.base)",
          "new_text": "uv_buf_init(bufBegin, len)",
          "old_line_content": "  taosMemoryFree(uvUdf->input.base);",
          "new_line_content": "  uvUdf->output = uv_buf_init(bufBegin, len);",
          "content_same": false
        },
        {
          "line": 846,
          "old_api": "terrstr",
          "new_api": "osDataSpaceAvailable",
          "old_text": "terrstr(terrno)",
          "new_text": "osDataSpaceAvailable()",
          "old_line_content": "    fnError(\"udfd create shared library failed since %s\", terrstr(terrno));",
          "new_line_content": "  if (!osDataSpaceAvailable()) {",
          "content_same": false
        },
        {
          "line": 854,
          "old_api": "strncpy",
          "new_api": "taosStatFile",
          "old_text": "strncpy(udf->path, path, PATH_MAX)",
          "new_text": "taosStatFile(path, NULL, NULL)",
          "old_line_content": "    strncpy(udf->path, path, PATH_MAX);",
          "new_line_content": "  bool fileExist = !(taosStatFile(path, NULL, NULL) < 0);",
          "content_same": false
        },
        {
          "line": 861,
          "old_api": "strerror",
          "new_api": "taosOpenFile",
          "old_text": "strerror(errno)",
          "new_text": "taosOpenFile(path, TD_FILE_CREATE | TD_FILE_WRITE | TD_FILE_READ | TD_FILE_TRUNC)",
          "old_line_content": "    fnError(\"udfd write udf shared library: %s failed, error: %d %s\", path, errno, strerror(errno));",
          "new_line_content": "  TdFilePtr file = taosOpenFile(path, TD_FILE_CREATE | TD_FILE_WRITE | TD_FILE_READ | TD_FILE_TRUNC);",
          "content_same": false
        },
        {
          "line": 866,
          "old_api": "fnError",
          "new_api": "taosWriteFile",
          "old_text": "fnError(\"udfd write udf shared library failed\")",
          "new_text": "taosWriteFile(file, pFuncInfo->pCode, pFuncInfo->codeSize)",
          "old_line_content": "    fnError(\"udfd write udf shared library failed\");",
          "new_line_content": "  int64_t count = taosWriteFile(file, pFuncInfo->pCode, pFuncInfo->codeSize);",
          "content_same": false
        },
        {
          "line": 871,
          "old_api": "strncpy",
          "new_api": "taosCloseFile",
          "old_text": "strncpy(udf->path, path, PATH_MAX)",
          "new_text": "taosCloseFile(&file)",
          "old_line_content": "  strncpy(udf->path, path, PATH_MAX);",
          "new_line_content": "  taosCloseFile(&file);",
          "content_same": false
        },
        {
          "line": 894,
          "old_api": "taosGetTimestampSec",
          "new_api": "tDeserializeSConnectRsp",
          "old_text": "taosGetTimestampSec()",
          "new_text": "tDeserializeSConnectRsp(pMsg->pCont, pMsg->contLen, &connectRsp)",
          "old_line_content": "    int32_t now = taosGetTimestampSec();",
          "new_line_content": "    tDeserializeSConnectRsp(pMsg->pCont, pMsg->contLen, &connectRsp);",
          "content_same": false
        },
        {
          "line": 914,
          "old_api": "taosArrayGet",
          "new_api": "tDeserializeSRetrieveFuncRsp",
          "old_text": "taosArrayGet(retrieveRsp.pFuncInfos, 0)",
          "new_text": "tDeserializeSRetrieveFuncRsp(pMsg->pCont, pMsg->contLen, &retrieveRsp)",
          "old_line_content": "    SFuncInfo *pFuncInfo = (SFuncInfo *)taosArrayGet(retrieveRsp.pFuncInfos, 0);",
          "new_line_content": "    tDeserializeSRetrieveFuncRsp(pMsg->pCont, pMsg->contLen, &retrieveRsp);",
          "content_same": false
        },
        {
          "line": 931,
          "old_api": "taosArrayDestroy",
          "new_api": "tFreeSFuncInfo",
          "old_text": "taosArrayDestroy(retrieveRsp.pFuncExtraInfos)",
          "new_text": "tFreeSFuncInfo(pFuncInfo)",
          "old_line_content": "    taosArrayDestroy(retrieveRsp.pFuncExtraInfos);",
          "new_line_content": "    tFreeSFuncInfo(pFuncInfo);",
          "content_same": false
        },
        {
          "line": 946,
          "old_api": "tSerializeSRetrieveFuncReq",
          "new_api": "taosArrayPush",
          "old_text": "tSerializeSRetrieveFuncReq(NULL, 0, &retrieveReq)",
          "new_text": "taosArrayPush(retrieveReq.pFuncNames, udfName)",
          "old_line_content": "  int32_t contLen = tSerializeSRetrieveFuncReq(NULL, 0, &retrieveReq);",
          "new_line_content": "  taosArrayPush(retrieveReq.pFuncNames, udfName);",
          "content_same": false
        },
        {
          "line": 949,
          "old_api": "taosArrayDestroy",
          "new_api": "rpcMallocCont",
          "old_text": "taosArrayDestroy(retrieveReq.pFuncNames)",
          "new_text": "rpcMallocCont(contLen)",
          "old_line_content": "  taosArrayDestroy(retrieveReq.pFuncNames);",
          "new_line_content": "  void   *pReq = rpcMallocCont(contLen);",
          "content_same": false
        },
        {
          "line": 951,
          "old_api": "taosMemoryCalloc",
          "new_api": "taosArrayDestroy",
          "old_text": "taosMemoryCalloc(1, sizeof(SUdfdRpcSendRecvInfo))",
          "new_text": "taosArrayDestroy(retrieveReq.pFuncNames)",
          "old_line_content": "  SUdfdRpcSendRecvInfo *msgInfo = taosMemoryCalloc(1, sizeof(SUdfdRpcSendRecvInfo));",
          "new_line_content": "  taosArrayDestroy(retrieveReq.pFuncNames);",
          "content_same": false
        },
        {
          "line": 963,
          "old_api": "uv_sem_wait",
          "new_api": "rpcSendRequest",
          "old_text": "uv_sem_wait(&msgInfo->resultSem)",
          "new_text": "rpcSendRequest(clientRpc, &global.mgmtEp.epSet, &rpcMsg, NULL)",
          "old_line_content": "  uv_sem_wait(&msgInfo->resultSem);",
          "new_line_content": "  rpcSendRequest(clientRpc, &global.mgmtEp.epSet, &rpcMsg, NULL);",
          "content_same": false
        },
        {
          "line": 966,
          "old_api": "taosMemoryFree",
          "new_api": "uv_sem_destroy",
          "old_text": "taosMemoryFree(msgInfo)",
          "new_text": "uv_sem_destroy(&msgInfo->resultSem)",
          "old_line_content": "  taosMemoryFree(msgInfo);",
          "new_line_content": "  uv_sem_destroy(&msgInfo->resultSem);",
          "content_same": false
        },
        {
          "line": 976,
          "old_api": "strlen",
          "new_api": "tstrncpy",
          "old_text": "strlen(TSDB_DEFAULT_PASS)",
          "new_text": "tstrncpy(connReq.user, TSDB_DEFAULT_USER, sizeof(connReq.user))",
          "old_line_content": "  taosEncryptPass_c((uint8_t *)(TSDB_DEFAULT_PASS), strlen(TSDB_DEFAULT_PASS), pass);",
          "new_line_content": "  tstrncpy(connReq.user, TSDB_DEFAULT_USER, sizeof(connReq.user));",
          "content_same": false
        },
        {
          "line": 978,
          "old_api": "taosGetPId",
          "new_api": "strlen",
          "old_text": "taosGetPId()",
          "new_text": "strlen(TSDB_DEFAULT_PASS)",
          "old_line_content": "  connReq.pid = taosGetPId();",
          "new_line_content": "  taosEncryptPass_c((uint8_t *)(TSDB_DEFAULT_PASS), strlen(TSDB_DEFAULT_PASS), pass);",
          "content_same": false
        },
        {
          "line": 979,
          "old_api": "taosGetTimestampMs",
          "new_api": "tstrncpy",
          "old_text": "taosGetTimestampMs()",
          "new_text": "tstrncpy(connReq.passwd, pass, sizeof(connReq.passwd))",
          "old_line_content": "  connReq.startTime = taosGetTimestampMs();",
          "new_line_content": "  tstrncpy(connReq.passwd, pass, sizeof(connReq.passwd));",
          "content_same": false
        },
        {
          "line": 980,
          "old_api": "strcpy",
          "new_api": "taosGetPId",
          "old_text": "strcpy(connReq.sVer, version)",
          "new_text": "taosGetPId()",
          "old_line_content": "  strcpy(connReq.sVer, version);",
          "new_line_content": "  connReq.pid = taosGetPId();",
          "content_same": false
        },
        {
          "line": 982,
          "old_api": "tSerializeSConnectReq",
          "new_api": "strcpy",
          "old_text": "tSerializeSConnectReq(NULL, 0, &connReq)",
          "new_text": "strcpy(connReq.sVer, version)",
          "old_line_content": "  int32_t contLen = tSerializeSConnectReq(NULL, 0, &connReq);",
          "new_line_content": "  strcpy(connReq.sVer, version);",
          "content_same": false
        },
        {
          "line": 986,
          "old_api": "taosMemoryCalloc",
          "new_api": "tSerializeSConnectReq",
          "old_text": "taosMemoryCalloc(1, sizeof(SUdfdRpcSendRecvInfo))",
          "new_text": "tSerializeSConnectReq(pReq, contLen, &connReq)",
          "old_line_content": "  SUdfdRpcSendRecvInfo *msgInfo = taosMemoryCalloc(1, sizeof(SUdfdRpcSendRecvInfo));",
          "new_line_content": "  tSerializeSConnectReq(pReq, contLen, &connReq);",
          "content_same": false
        },
        {
          "line": 988,
          "old_api": "uv_sem_init",
          "new_api": "taosMemoryCalloc",
          "old_text": "uv_sem_init(&msgInfo->resultSem, 0)",
          "new_text": "taosMemoryCalloc(1, sizeof(SUdfdRpcSendRecvInfo))",
          "old_line_content": "  uv_sem_init(&msgInfo->resultSem, 0);",
          "new_line_content": "  SUdfdRpcSendRecvInfo *msgInfo = taosMemoryCalloc(1, sizeof(SUdfdRpcSendRecvInfo));",
          "content_same": false
        },
        {
          "line": 997,
          "old_api": "uv_sem_wait",
          "new_api": "rpcSendRequest",
          "old_text": "uv_sem_wait(&msgInfo->resultSem)",
          "new_text": "rpcSendRequest(global.clientRpc, &global.mgmtEp.epSet, &rpcMsg, NULL)",
          "old_line_content": "  uv_sem_wait(&msgInfo->resultSem);",
          "new_line_content": "  rpcSendRequest(global.clientRpc, &global.mgmtEp.epSet, &rpcMsg, NULL);",
          "content_same": false
        },
        {
          "line": 999,
          "old_api": "uv_sem_destroy",
          "new_api": "uv_sem_wait",
          "old_text": "uv_sem_destroy(&msgInfo->resultSem)",
          "new_text": "uv_sem_wait(&msgInfo->resultSem)",
          "old_line_content": "  uv_sem_destroy(&msgInfo->resultSem);",
          "new_line_content": "  uv_sem_wait(&msgInfo->resultSem);",
          "content_same": false
        },
        {
          "line": 1080,
          "old_api": "fnError",
          "new_api": "rpcOpen",
          "old_text": "fnError(\"failed to init dnode rpc client\")",
          "new_text": "rpcOpen(&rpcInit)",
          "old_line_content": "    fnError(\"failed to init dnode rpc client\");",
          "new_line_content": "  global.clientRpc = rpcOpen(&rpcInit);",
          "content_same": false
        },
        {
          "line": 1120,
          "old_api": "uv_write",
          "new_api": "taosMemoryMalloc",
          "old_text": "uv_write(write_req, udfWork->conn->client, &udfWork->output, 1, udfdOnWrite)",
          "new_text": "taosMemoryMalloc(sizeof(uv_write_t))",
          "old_line_content": "    uv_write(write_req, udfWork->conn->client, &udfWork->output, 1, udfdOnWrite);",
          "new_line_content": "    uv_write_t *write_req = taosMemoryMalloc(sizeof(uv_write_t));",
          "content_same": false
        },
        {
          "line": 1122,
          "old_api": "taosMemoryFree",
          "new_api": "uv_write",
          "old_text": "taosMemoryFree(work)",
          "new_text": "uv_write(write_req, udfWork->conn->client, &udfWork->output, 1, udfdOnWrite)",
          "old_line_content": "  taosMemoryFree(work);",
          "new_line_content": "    uv_write(write_req, udfWork->conn->client, &udfWork->output, 1, udfdOnWrite);",
          "content_same": false
        },
        {
          "line": 1220,
          "old_api": "uv_err_name",
          "new_api": "fnInfo",
          "old_text": "uv_err_name(nread)",
          "new_text": "fnInfo(\"udfd pipe read EOF\")",
          "old_line_content": "      fnError(\"Receive error %s\", uv_err_name(nread));",
          "new_line_content": "      fnInfo(\"udfd pipe read EOF\");",
          "content_same": false
        },
        {
          "line": 1222,
          "old_api": "udfdUvHandleError",
          "new_api": "uv_err_name",
          "old_text": "udfdUvHandleError(conn)",
          "new_text": "uv_err_name(nread)",
          "old_line_content": "    udfdUvHandleError(conn);",
          "new_line_content": "      fnError(\"Receive error %s\", uv_err_name(nread));",
          "content_same": false
        },
        {
          "line": 1234,
          "old_api": "uv_accept",
          "new_api": "taosMemoryMalloc",
          "old_text": "uv_accept(server, (uv_stream_t *)client)",
          "new_text": "taosMemoryMalloc(sizeof(uv_pipe_t))",
          "old_line_content": "  if (uv_accept(server, (uv_stream_t *)client) == 0) {",
          "new_line_content": "  uv_pipe_t *client = (uv_pipe_t *)taosMemoryMalloc(sizeof(uv_pipe_t));",
          "content_same": false
        },
        {
          "line": 1235,
          "old_api": "taosMemoryMalloc",
          "new_api": "uv_pipe_init",
          "old_text": "taosMemoryMalloc(sizeof(SUdfdUvConn))",
          "new_text": "uv_pipe_init(global.loop, client, 0)",
          "old_line_content": "    SUdfdUvConn *ctx = taosMemoryMalloc(sizeof(SUdfdUvConn));",
          "new_line_content": "  uv_pipe_init(global.loop, client, 0);",
          "content_same": false
        },
        {
          "line": 1245,
          "old_api": "uv_close",
          "new_api": "uv_read_start",
          "old_text": "uv_close((uv_handle_t *)client, NULL)",
          "new_text": "uv_read_start((uv_stream_t *)client, udfdAllocBuffer, udfdPipeRead)",
          "old_line_content": "    uv_close((uv_handle_t *)client, NULL);",
          "new_line_content": "    uv_read_start((uv_stream_t *)client, udfdAllocBuffer, udfdPipeRead);",
          "content_same": false
        },
        {
          "line": 1252,
          "old_api": "uv_fs_unlink",
          "new_api": "fnInfo",
          "old_text": "uv_fs_unlink(global.loop, &req, global.listenPipeName, NULL)",
          "new_text": "fnInfo(\"udfd signal received: %d\\n\", signum)",
          "old_line_content": "  uv_fs_unlink(global.loop, &req, global.listenPipeName, NULL);",
          "new_line_content": "  fnInfo(\"udfd signal received: %d\\n\", signum);",
          "content_same": false
        },
        {
          "line": 1254,
          "old_api": "uv_stop",
          "new_api": "uv_fs_unlink",
          "old_text": "uv_stop(global.loop)",
          "new_text": "uv_fs_unlink(global.loop, &req, global.listenPipeName, NULL)",
          "old_line_content": "  uv_stop(global.loop);",
          "new_line_content": "  uv_fs_unlink(global.loop, &req, global.listenPipeName, NULL);",
          "content_same": false
        },
        {
          "line": 1261,
          "old_api": "strlen",
          "new_api": "strcmp",
          "old_text": "strlen(argv[++i])",
          "new_text": "strcmp(argv[i], \"-c\")",
          "old_line_content": "        if (strlen(argv[++i]) >= PATH_MAX) {",
          "new_line_content": "    if (strcmp(argv[i], \"-c\") == 0) {",
          "content_same": false
        },
        {
          "line": 1267,
          "old_api": "printf",
          "new_api": "tstrncpy",
          "old_text": "printf(\"'-c' requires a parameter, default is %s\\n\", configDir)",
          "new_text": "tstrncpy(configDir, argv[i], PATH_MAX)",
          "old_line_content": "        printf(\"'-c' requires a parameter, default is %s\\n\", configDir);",
          "new_line_content": "        tstrncpy(configDir, argv[i], PATH_MAX);",
          "content_same": false
        },
        {
          "line": 1305,
          "old_api": "uv_close",
          "new_api": "uv_err_name",
          "old_text": "uv_close((uv_handle_t *)q, NULL)",
          "new_text": "uv_err_name(nread)",
          "old_line_content": "    uv_close((uv_handle_t *)q, NULL);",
          "new_line_content": "    fnError(\"udfd ctrl pipe read error. %s\", uv_err_name(nread));",
          "content_same": false
        },
        {
          "line": 1306,
          "old_api": "uv_stop",
          "new_api": "taosMemoryFree",
          "old_text": "uv_stop(global.loop)",
          "new_text": "taosMemoryFree(buf->base)",
          "old_line_content": "    uv_stop(global.loop);",
          "new_line_content": "    taosMemoryFree(buf->base);",
          "content_same": false
        },
        {
          "line": 1323,
          "old_api": "uv_loop_init",
          "new_api": "taosMemoryMalloc",
          "old_text": "uv_loop_init(loop)",
          "new_text": "taosMemoryMalloc(sizeof(uv_loop_t))",
          "old_line_content": "    uv_loop_init(loop);",
          "new_line_content": "  uv_loop_t *loop = taosMemoryMalloc(sizeof(uv_loop_t));",
          "content_same": false
        },
        {
          "line": 1332,
          "old_api": "uv_read_start",
          "new_api": "uv_pipe_init",
          "old_text": "uv_read_start((uv_stream_t *)&global.ctrlPipe, udfdCtrlAllocBufCb, udfdCtrlReadCb)",
          "new_text": "uv_pipe_init(global.loop, &global.ctrlPipe, 1)",
          "old_line_content": "    uv_read_start((uv_stream_t *)&global.ctrlPipe, udfdCtrlAllocBufCb, udfdCtrlReadCb);",
          "new_line_content": "    uv_pipe_init(global.loop, &global.ctrlPipe, 1);",
          "content_same": false
        },
        {
          "line": 1334,
          "old_api": "getUdfdPipeName",
          "new_api": "uv_read_start",
          "old_text": "getUdfdPipeName(global.listenPipeName, sizeof(global.listenPipeName))",
          "new_text": "uv_read_start((uv_stream_t *)&global.ctrlPipe, udfdCtrlAllocBufCb, udfdCtrlReadCb)",
          "old_line_content": "  getUdfdPipeName(global.listenPipeName, sizeof(global.listenPipeName));",
          "new_line_content": "    uv_read_start((uv_stream_t *)&global.ctrlPipe, udfdCtrlAllocBufCb, udfdCtrlReadCb);",
          "content_same": false
        },
        {
          "line": 1336,
          "old_api": "removeListeningPipe",
          "new_api": "getUdfdPipeName",
          "old_text": "removeListeningPipe()",
          "new_text": "getUdfdPipeName(global.listenPipeName, sizeof(global.listenPipeName))",
          "old_line_content": "  removeListeningPipe();",
          "new_line_content": "  getUdfdPipeName(global.listenPipeName, sizeof(global.listenPipeName));",
          "content_same": false
        },
        {
          "line": 1338,
          "old_api": "uv_pipe_init",
          "new_api": "removeListeningPipe",
          "old_text": "uv_pipe_init(global.loop, &global.listeningPipe, 0)",
          "new_text": "removeListeningPipe()",
          "old_line_content": "  uv_pipe_init(global.loop, &global.listeningPipe, 0);",
          "new_line_content": "  removeListeningPipe();",
          "content_same": false
        },
        {
          "line": 1340,
          "old_api": "uv_signal_init",
          "new_api": "uv_pipe_init",
          "old_text": "uv_signal_init(global.loop, &global.intrSignal)",
          "new_text": "uv_pipe_init(global.loop, &global.listeningPipe, 0)",
          "old_line_content": "  uv_signal_init(global.loop, &global.intrSignal);",
          "new_line_content": "  uv_pipe_init(global.loop, &global.listeningPipe, 0);",
          "content_same": false
        },
        {
          "line": 1346,
          "old_api": "uv_err_name",
          "new_api": "fnInfo",
          "old_text": "uv_err_name(r)",
          "new_text": "fnInfo(\"bind to pipe %s\", global.listenPipeName)",
          "old_line_content": "    fnError(\"Bind error %s\", uv_err_name(r));",
          "new_line_content": "  fnInfo(\"bind to pipe %s\", global.listenPipeName);",
          "content_same": false
        },
        {
          "line": 1347,
          "old_api": "removeListeningPipe",
          "new_api": "uv_pipe_bind",
          "old_text": "removeListeningPipe()",
          "new_text": "uv_pipe_bind(&global.listeningPipe, global.listenPipeName)",
          "old_line_content": "    removeListeningPipe();",
          "new_line_content": "  if ((r = uv_pipe_bind(&global.listeningPipe, global.listenPipeName))) {",
          "content_same": false
        },
        {
          "line": 1352,
          "old_api": "removeListeningPipe",
          "new_api": "uv_listen",
          "old_text": "removeListeningPipe()",
          "new_text": "uv_listen((uv_stream_t *)&global.listeningPipe, 128, udfdOnNewConnection)",
          "old_line_content": "    removeListeningPipe();",
          "new_line_content": "  if ((r = uv_listen((uv_stream_t *)&global.listeningPipe, 128, udfdOnNewConnection))) {",
          "content_same": false
        },
        {
          "line": 1367,
          "old_api": "taosGetDefaultHashFunction",
          "new_api": "uv_mutex_init",
          "old_text": "taosGetDefaultHashFunction(TSDB_DATA_TYPE_BINARY)",
          "new_text": "uv_mutex_init(&global.scriptPluginsMutex)",
          "old_line_content": "  global.udfsHash = taosHashInit(64, taosGetDefaultHashFunction(TSDB_DATA_TYPE_BINARY), true, HASH_NO_LOCK);",
          "new_line_content": "  uv_mutex_init(&global.scriptPluginsMutex);",
          "content_same": false
        },
        {
          "line": 1370,
          "old_api": "fnInfo",
          "new_api": "uv_mutex_init",
          "old_text": "fnInfo(\"start udfd event loop\")",
          "new_text": "uv_mutex_init(&global.udfsMutex)",
          "old_line_content": "  fnInfo(\"start udfd event loop\");",
          "new_line_content": "  uv_mutex_init(&global.udfsMutex);",
          "content_same": false
        },
        {
          "line": 1374,
          "old_api": "uv_loop_close",
          "new_api": "fnInfo",
          "old_text": "uv_loop_close(global.loop)",
          "new_text": "fnInfo(\"udfd event loop stopped.\")",
          "old_line_content": "  uv_loop_close(global.loop);",
          "new_line_content": "  fnInfo(\"udfd event loop stopped.\");",
          "content_same": false
        },
        {
          "line": 1376,
          "old_api": "uv_walk",
          "new_api": "uv_loop_close",
          "old_text": "uv_walk(global.loop, udfdCloseWalkCb, NULL)",
          "new_text": "uv_loop_close(global.loop)",
          "old_line_content": "  uv_walk(global.loop, udfdCloseWalkCb, NULL);",
          "new_line_content": "  uv_loop_close(global.loop);",
          "content_same": false
        },
        {
          "line": 1378,
          "old_api": "uv_loop_close",
          "new_api": "uv_walk",
          "old_text": "uv_loop_close(global.loop)",
          "new_text": "uv_walk(global.loop, udfdCloseWalkCb, NULL)",
          "old_line_content": "  uv_loop_close(global.loop);",
          "new_line_content": "  uv_walk(global.loop, udfdCloseWalkCb, NULL);",
          "content_same": false
        },
        {
          "line": 1410,
          "old_api": "strncpy",
          "new_api": "strtok_r",
          "old_text": "strncpy(func, token, TSDB_FUNC_NAME_LEN)",
          "new_text": "strtok_r(pSave, \",\", &pSave)",
          "old_line_content": "    strncpy(func, token, TSDB_FUNC_NAME_LEN);",
          "new_line_content": "  while ((token = strtok_r(pSave, \",\", &pSave)) != NULL) {",
          "content_same": false
        },
        {
          "line": 1412,
          "old_api": "taosArrayPush",
          "new_api": "strncpy",
          "old_text": "taosArrayPush(global.residentFuncs, func)",
          "new_text": "strncpy(func, token, TSDB_FUNC_NAME_LEN)",
          "old_line_content": "    taosArrayPush(global.residentFuncs, func);",
          "new_line_content": "    strncpy(func, token, TSDB_FUNC_NAME_LEN);",
          "content_same": false
        },
        {
          "line": 1421,
          "old_api": "strlen",
          "new_api": "taosArrayGetSize",
          "old_text": "strlen(funcName)",
          "new_text": "taosArrayGetSize(global.residentFuncs)",
          "old_line_content": "    SUdf **udfInHash = taosHashGet(global.udfsHash, funcName, strlen(funcName));",
          "new_line_content": "  for (int32_t i = 0; i < taosArrayGetSize(global.residentFuncs); ++i) {",
          "content_same": false
        },
        {
          "line": 1426,
          "old_api": "strlen",
          "new_api": "udfDestroyFunc",
          "old_text": "strlen(funcName)",
          "new_text": "udf->scriptPlugin->udfDestroyFunc(udf->scriptUdfCtx)",
          "old_line_content": "      taosHashRemove(global.udfsHash, funcName, strlen(funcName));",
          "new_line_content": "      int32_t code = udf->scriptPlugin->udfDestroyFunc(udf->scriptUdfCtx);",
          "content_same": false
        },
        {
          "line": 1427,
          "old_api": "taosMemoryFree",
          "new_api": "fnDebug",
          "old_text": "taosMemoryFree(udf)",
          "new_text": "fnDebug(\"udfd destroy function returns %d\", code)",
          "old_line_content": "      taosMemoryFree(udf);",
          "new_line_content": "      fnDebug(\"udfd destroy function returns %d\", code);",
          "content_same": false
        },
        {
          "line": 1444,
          "old_api": "snprintf",
          "new_api": "taosMkDir",
          "old_text": "snprintf(global.udfDataDir, PATH_MAX, \"%s/.udf\", tsTempDir)",
          "new_text": "taosMkDir(global.udfDataDir)",
          "old_line_content": "    snprintf(global.udfDataDir, PATH_MAX, \"%s/.udf\", tsTempDir);",
          "new_line_content": "  int32_t code = taosMkDir(global.udfDataDir);",
          "content_same": false
        },
        {
          "line": 1447,
          "old_api": "tstrerror",
          "new_api": "taosMkDir",
          "old_text": "tstrerror(code)",
          "new_text": "taosMkDir(global.udfDataDir)",
          "old_line_content": "  fnInfo(\"udfd create udf source directory %s. result: %s\", global.udfDataDir, tstrerror(code));",
          "new_line_content": "    code = taosMkDir(global.udfDataDir);",
          "content_same": false
        },
        {
          "line": 1476,
          "old_api": "printf",
          "new_api": "udfdInitLog",
          "old_text": "printf(\"failed to start since init log error\\n\")",
          "new_text": "udfdInitLog()",
          "old_line_content": "    printf(\"failed to start since init log error\\n\");",
          "new_line_content": "  if (udfdInitLog() != 0) {",
          "content_same": false
        },
        {
          "line": 1486,
          "old_api": "fnError",
          "new_api": "initEpSetFromCfg",
          "old_text": "fnError(\"open rpc connection to mnode failed\")",
          "new_text": "initEpSetFromCfg(tsFirst, tsSecond, &global.mgmtEp)",
          "old_line_content": "    fnError(\"open rpc connection to mnode failed\");",
          "new_line_content": "  initEpSetFromCfg(tsFirst, tsSecond, &global.mgmtEp);",
          "content_same": false
        },
        {
          "line": 1505,
          "old_api": "udfdRun",
          "new_api": "uv_thread_create",
          "old_text": "udfdRun()",
          "new_text": "uv_thread_create(&mnodeConnectThread, udfdConnectMnodeThreadFunc, NULL)",
          "old_line_content": "  udfdRun();",
          "new_line_content": "  uv_thread_create(&mnodeConnectThread, udfdConnectMnodeThreadFunc, NULL);",
          "content_same": false
        },
        {
          "line": 1507,
          "old_api": "removeListeningPipe",
          "new_api": "udfdRun",
          "old_text": "removeListeningPipe()",
          "new_text": "udfdRun()",
          "old_line_content": "  removeListeningPipe();",
          "new_line_content": "  udfdRun();",
          "content_same": false
        },
        {
          "line": 1509,
          "old_api": "udfdCloseClientRpc",
          "new_api": "removeListeningPipe",
          "old_text": "udfdCloseClientRpc()",
          "new_text": "removeListeningPipe()",
          "old_line_content": "  udfdCloseClientRpc();",
          "new_line_content": "  removeListeningPipe();",
          "content_same": false
        },
        {
          "line": 1511,
          "old_api": "udfdDeinitResidentFuncs",
          "new_api": "udfdCloseClientRpc",
          "old_text": "udfdDeinitResidentFuncs()",
          "new_text": "udfdCloseClientRpc()",
          "old_line_content": "  udfdDeinitResidentFuncs();",
          "new_line_content": "  udfdCloseClientRpc();",
          "content_same": false
        },
        {
          "line": 1513,
          "old_api": "udfdDeinitScriptPlugins",
          "new_api": "udfdDeinitResidentFuncs",
          "old_text": "udfdDeinitScriptPlugins()",
          "new_text": "udfdDeinitResidentFuncs()",
          "old_line_content": "  udfdDeinitScriptPlugins();",
          "new_line_content": "  udfdDeinitResidentFuncs();",
          "content_same": false
        },
        {
          "line": 1515,
          "old_api": "udfdCleanup",
          "new_api": "udfdDeinitScriptPlugins",
          "old_text": "udfdCleanup()",
          "new_text": "udfdDeinitScriptPlugins()",
          "old_line_content": "  udfdCleanup();",
          "new_line_content": "  udfdDeinitScriptPlugins();",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 1029,
          "old_api": null,
          "new_api": "strlen",
          "old_text": null,
          "new_text": "strlen(firstEp)",
          "old_line_content": "      return -1;",
          "new_line_content": "    if (strlen(firstEp) >= TSDB_EP_LEN) {",
          "content_same": false
        },
        {
          "line": 1034,
          "old_api": null,
          "new_api": "taosGetFqdnPortFromEp",
          "old_text": null,
          "new_text": "taosGetFqdnPortFromEp(firstEp, &mgmtEpSet->eps[0])",
          "old_line_content": "      terrno = TSDB_CODE_TSC_INVALID_FQDN;",
          "new_line_content": "    int32_t code = taosGetFqdnPortFromEp(firstEp, &mgmtEpSet->eps[0]);",
          "content_same": false
        },
        {
          "line": 1044,
          "old_api": null,
          "new_api": "strlen",
          "old_text": null,
          "new_text": "strlen(secondEp)",
          "old_line_content": "      return -1;",
          "new_line_content": "    if (strlen(secondEp) >= TSDB_EP_LEN) {",
          "content_same": false
        },
        {
          "line": 1049,
          "old_api": null,
          "new_api": "taosGetFqdnPortFromEp",
          "old_text": null,
          "new_text": "taosGetFqdnPortFromEp(secondEp, &mgmtEpSet->eps[mgmtEpSet->numOfEps])",
          "old_line_content": "  }",
          "new_line_content": "    taosGetFqdnPortFromEp(secondEp, &mgmtEpSet->eps[mgmtEpSet->numOfEps]);",
          "content_same": false
        },
        {
          "line": 1075,
          "old_api": null,
          "new_api": "TMAX",
          "old_text": null,
          "new_text": "TMAX(connLimitNum, 10)",
          "old_line_content": "  rpcInit.connLimitNum = connLimitNum;",
          "new_line_content": "  connLimitNum = TMAX(connLimitNum, 10);",
          "content_same": false
        },
        {
          "line": 1076,
          "old_api": null,
          "new_api": "TMIN",
          "old_text": null,
          "new_text": "TMIN(connLimitNum, 500)",
          "old_line_content": "  rpcInit.timeToGetConn = tsTimeToGetAvailableConn;",
          "new_line_content": "  connLimitNum = TMIN(connLimitNum, 500);",
          "content_same": false
        },
        {
          "line": 1082,
          "old_api": null,
          "new_api": "fnError",
          "old_text": null,
          "new_text": "fnError(\"failed to init dnode rpc client\")",
          "old_line_content": "  }",
          "new_line_content": "    fnError(\"failed to init dnode rpc client\");",
          "content_same": false
        },
        {
          "line": 1090,
          "old_api": null,
          "new_api": "rpcClose",
          "old_text": null,
          "new_text": "rpcClose(global.clientRpc)",
          "old_line_content": "  return 0;",
          "new_line_content": "  rpcClose(global.clientRpc);",
          "content_same": false
        },
        {
          "line": 1091,
          "old_api": null,
          "new_api": "fnInfo",
          "old_text": null,
          "new_text": "fnInfo(\"udfd finish closing rpc\")",
          "old_line_content": "}",
          "new_line_content": "  fnInfo(\"udfd finish closing rpc\");",
          "content_same": false
        },
        {
          "line": 1098,
          "old_api": null,
          "new_api": "uv_err_name",
          "old_text": null,
          "new_text": "uv_err_name(status)",
          "old_line_content": "  // remove work from the connection work list",
          "new_line_content": "    fnError(\"udfd send response error, length: %zu code: %s\", work->output.len, uv_err_name(status));",
          "content_same": false
        },
        {
          "line": 1108,
          "old_api": null,
          "new_api": "fnError",
          "old_text": null,
          "new_text": "fnError(\"work not in conn any more\")",
          "old_line_content": "  }",
          "new_line_content": "      fnError(\"work not in conn any more\");",
          "content_same": false
        },
        {
          "line": 1112,
          "old_api": null,
          "new_api": "taosMemoryFree",
          "old_text": null,
          "new_text": "taosMemoryFree(work)",
          "old_line_content": "}",
          "new_line_content": "  taosMemoryFree(work);",
          "content_same": false
        },
        {
          "line": 1113,
          "old_api": null,
          "new_api": "taosMemoryFree",
          "old_text": null,
          "new_text": "taosMemoryFree(req)",
          "old_line_content": "",
          "new_line_content": "  taosMemoryFree(req);",
          "content_same": false
        },
        {
          "line": 1124,
          "old_api": null,
          "new_api": "taosMemoryFree",
          "old_text": null,
          "new_text": "taosMemoryFree(work)",
          "old_line_content": "",
          "new_line_content": "  taosMemoryFree(work);",
          "content_same": false
        },
        {
          "line": 1131,
          "old_api": null,
          "new_api": "taosMemoryMalloc",
          "old_text": null,
          "new_text": "taosMemoryMalloc(msgHeadSize)",
          "old_line_content": "      ctx->inputLen = 0;",
          "new_line_content": "    ctx->inputBuf = taosMemoryMalloc(msgHeadSize);",
          "content_same": false
        },
        {
          "line": 1140,
          "old_api": null,
          "new_api": "fnError",
          "old_text": null,
          "new_text": "fnError(\"udfd can not allocate enough memory\")",
          "old_line_content": "    }",
          "new_line_content": "      fnError(\"udfd can not allocate enough memory\") buf->base = NULL;",
          "content_same": false
        },
        {
          "line": 1148,
          "old_api": null,
          "new_api": "taosMemoryRealloc",
          "old_text": null,
          "new_text": "taosMemoryRealloc(ctx->inputBuf, ctx->inputCap)",
          "old_line_content": "      ctx->inputBuf = inputBuf;",
          "new_line_content": "    void *inputBuf = taosMemoryRealloc(ctx->inputBuf, ctx->inputCap);",
          "content_same": false
        },
        {
          "line": 1154,
          "old_api": null,
          "new_api": "fnError",
          "old_text": null,
          "new_text": "fnError(\"udfd can not allocate enough memory\")",
          "old_line_content": "    }",
          "new_line_content": "      fnError(\"udfd can not allocate enough memory\") buf->base = NULL;",
          "content_same": false
        },
        {
          "line": 1165,
          "old_api": null,
          "new_api": "fnDebug",
          "old_text": null,
          "new_text": "fnDebug(\"receive request complete. length %d\", pipe->inputLen)",
          "old_line_content": "  }",
          "new_line_content": "    fnDebug(\"receive request complete. length %d\", pipe->inputLen);",
          "content_same": false
        },
        {
          "line": 1175,
          "old_api": null,
          "new_api": "taosMemoryMalloc",
          "old_text": null,
          "new_text": "taosMemoryMalloc(sizeof(uv_work_t))",
          "old_line_content": "  udfWork->conn = conn;",
          "new_line_content": "  uv_work_t  *work = taosMemoryMalloc(sizeof(uv_work_t));",
          "content_same": false
        },
        {
          "line": 1176,
          "old_api": null,
          "new_api": "taosMemoryMalloc",
          "old_text": null,
          "new_text": "taosMemoryMalloc(sizeof(SUvUdfWork))",
          "old_line_content": "  udfWork->pWorkNext = conn->pWorkList;",
          "new_line_content": "  SUvUdfWork *udfWork = taosMemoryMalloc(sizeof(SUvUdfWork));",
          "content_same": false
        },
        {
          "line": 1180,
          "old_api": null,
          "new_api": "uv_buf_init",
          "old_text": null,
          "new_text": "uv_buf_init(inputBuf, inputLen)",
          "old_line_content": "  conn->inputLen = 0;",
          "new_line_content": "  udfWork->input = uv_buf_init(inputBuf, inputLen);",
          "content_same": false
        },
        {
          "line": 1186,
          "old_api": null,
          "new_api": "uv_queue_work",
          "old_text": null,
          "new_text": "uv_queue_work(global.loop, work, udfdProcessRequest, udfdSendResponse)",
          "old_line_content": "",
          "new_line_content": "  uv_queue_work(global.loop, work, udfdProcessRequest, udfdSendResponse);",
          "content_same": false
        },
        {
          "line": 1198,
          "old_api": null,
          "new_api": "taosMemoryFree",
          "old_text": null,
          "new_text": "taosMemoryFree(conn->inputBuf)",
          "old_line_content": "}",
          "new_line_content": "  taosMemoryFree(conn->inputBuf);",
          "content_same": false
        },
        {
          "line": 1199,
          "old_api": null,
          "new_api": "taosMemoryFree",
          "old_text": null,
          "new_text": "taosMemoryFree(conn)",
          "old_line_content": "",
          "new_line_content": "  taosMemoryFree(conn);",
          "content_same": false
        },
        {
          "line": 691,
          "old_api": null,
          "new_api": "udfColEnsureCapacity",
          "old_text": null,
          "new_text": "udfColEnsureCapacity(&output, call->block.info.rows)",
          "old_line_content": "      SUdfDataBlock input = {0};",
          "new_line_content": "      udfColEnsureCapacity(&output, call->block.info.rows);",
          "content_same": false
        },
        {
          "line": 1203,
          "old_api": null,
          "new_api": "fnDebug",
          "old_text": null,
          "new_text": "fnDebug(\"udfd read %zd bytes from client\", nread)",
          "old_line_content": "",
          "new_line_content": "  fnDebug(\"udfd read %zd bytes from client\", nread);",
          "content_same": false
        },
        {
          "line": 697,
          "old_api": null,
          "new_api": "convertUdfColumnToDataBlock",
          "old_text": null,
          "new_text": "convertUdfColumnToDataBlock(&output, &response.callRsp.resultData)",
          "old_line_content": "      break;",
          "new_line_content": "      convertUdfColumnToDataBlock(&output, &response.callRsp.resultData);",
          "content_same": false
        },
        {
          "line": 698,
          "old_api": null,
          "new_api": "freeUdfColumn",
          "old_text": null,
          "new_text": "freeUdfColumn(&output)",
          "old_line_content": "    }",
          "new_line_content": "      freeUdfColumn(&output);",
          "content_same": false
        },
        {
          "line": 1210,
          "old_api": null,
          "new_api": "isUdfdUvMsgComplete",
          "old_text": null,
          "new_text": "isUdfdUvMsgComplete(conn)",
          "old_line_content": "    } else {",
          "new_line_content": "    if (isUdfdUvMsgComplete(conn)) {",
          "content_same": false
        },
        {
          "line": 1211,
          "old_api": null,
          "new_api": "udfdHandleRequest",
          "old_text": null,
          "new_text": "udfdHandleRequest(conn)",
          "old_line_content": "      // log error or continue;",
          "new_line_content": "      udfdHandleRequest(conn);",
          "content_same": false
        },
        {
          "line": 702,
          "old_api": null,
          "new_api": "taosMemoryMalloc",
          "old_text": null,
          "new_text": "taosMemoryMalloc(udf->bufSize)",
          "old_line_content": "      subRsp->resultBuf = outBuf;",
          "new_line_content": "      SUdfInterBuf outBuf = {.buf = taosMemoryMalloc(udf->bufSize), .bufLen = udf->bufSize, .numOfResult = 0};",
          "content_same": false
        },
        {
          "line": 703,
          "old_api": null,
          "new_api": "udfAggStartFunc",
          "old_text": null,
          "new_text": "udf->scriptPlugin->udfAggStartFunc(&outBuf, udf->scriptUdfCtx)",
          "old_line_content": "      break;",
          "new_line_content": "      code = udf->scriptPlugin->udfAggStartFunc(&outBuf, udf->scriptUdfCtx);",
          "content_same": false
        },
        {
          "line": 712,
          "old_api": null,
          "new_api": "freeUdfInterBuf",
          "old_text": null,
          "new_text": "freeUdfInterBuf(&call->interBuf)",
          "old_line_content": "      subRsp->resultBuf = outBuf;",
          "new_line_content": "      freeUdfInterBuf(&call->interBuf);",
          "content_same": false
        },
        {
          "line": 713,
          "old_api": null,
          "new_api": "freeUdfDataDataBlock",
          "old_text": null,
          "new_text": "freeUdfDataDataBlock(&input)",
          "old_line_content": "",
          "new_line_content": "      freeUdfDataDataBlock(&input);",
          "content_same": false
        },
        {
          "line": 1224,
          "old_api": null,
          "new_api": "udfdUvHandleError",
          "old_text": null,
          "new_text": "udfdUvHandleError(conn)",
          "old_line_content": "}",
          "new_line_content": "    udfdUvHandleError(conn);",
          "content_same": false
        },
        {
          "line": 1230,
          "old_api": null,
          "new_api": "uv_strerror",
          "old_text": null,
          "new_text": "uv_strerror(status)",
          "old_line_content": "  }",
          "new_line_content": "    fnError(\"udfd new connection error. code: %s\", uv_strerror(status));",
          "content_same": false
        },
        {
          "line": 721,
          "old_api": null,
          "new_api": "freeUdfInterBuf",
          "old_text": null,
          "new_text": "freeUdfInterBuf(&call->interBuf)",
          "old_line_content": "      subRsp->resultBuf = outBuf;",
          "new_line_content": "      freeUdfInterBuf(&call->interBuf);",
          "content_same": false
        },
        {
          "line": 722,
          "old_api": null,
          "new_api": "freeUdfInterBuf",
          "old_text": null,
          "new_text": "freeUdfInterBuf(&call->interBuf2)",
          "old_line_content": "",
          "new_line_content": "      freeUdfInterBuf(&call->interBuf2);",
          "content_same": false
        },
        {
          "line": 1236,
          "old_api": null,
          "new_api": "uv_accept",
          "old_text": null,
          "new_text": "uv_accept(server, (uv_stream_t *)client)",
          "old_line_content": "    ctx->pWorkList = NULL;",
          "new_line_content": "  if (uv_accept(server, (uv_stream_t *)client) == 0) {",
          "content_same": false
        },
        {
          "line": 1237,
          "old_api": null,
          "new_api": "taosMemoryMalloc",
          "old_text": null,
          "new_text": "taosMemoryMalloc(sizeof(SUdfdUvConn))",
          "old_line_content": "    ctx->client = (uv_stream_t *)client;",
          "new_line_content": "    SUdfdUvConn *ctx = taosMemoryMalloc(sizeof(SUdfdUvConn));",
          "content_same": false
        },
        {
          "line": 729,
          "old_api": null,
          "new_api": "udfAggFinishFunc",
          "old_text": null,
          "new_text": "udf->scriptPlugin->udfAggFinishFunc(&call->interBuf, &outBuf, udf->scriptUdfCtx)",
          "old_line_content": "      subRsp->resultBuf = outBuf;",
          "new_line_content": "      code = udf->scriptPlugin->udfAggFinishFunc(&call->interBuf, &outBuf, udf->scriptUdfCtx);",
          "content_same": false
        },
        {
          "line": 730,
          "old_api": null,
          "new_api": "freeUdfInterBuf",
          "old_text": null,
          "new_text": "freeUdfInterBuf(&call->interBuf)",
          "old_line_content": "      break;",
          "new_line_content": "      freeUdfInterBuf(&call->interBuf);",
          "content_same": false
        },
        {
          "line": 1247,
          "old_api": null,
          "new_api": "uv_close",
          "old_text": null,
          "new_text": "uv_close((uv_handle_t *)client, NULL)",
          "old_line_content": "}",
          "new_line_content": "    uv_close((uv_handle_t *)client, NULL);",
          "content_same": false
        },
        {
          "line": 1255,
          "old_api": null,
          "new_api": "uv_signal_stop",
          "old_text": null,
          "new_text": "uv_signal_stop(handle)",
          "old_line_content": "}",
          "new_line_content": "  uv_signal_stop(handle);",
          "content_same": false
        },
        {
          "line": 1256,
          "old_api": null,
          "new_api": "uv_stop",
          "old_text": null,
          "new_text": "uv_stop(global.loop)",
          "old_line_content": "",
          "new_line_content": "  uv_stop(global.loop);",
          "content_same": false
        },
        {
          "line": 747,
          "old_api": null,
          "new_api": "encodeUdfResponse",
          "old_text": null,
          "new_text": "encodeUdfResponse(&buf, rsp)",
          "old_line_content": "",
          "new_line_content": "  encodeUdfResponse(&buf, rsp);",
          "content_same": false
        },
        {
          "line": 748,
          "old_api": null,
          "new_api": "uv_buf_init",
          "old_text": null,
          "new_text": "uv_buf_init(bufBegin, len)",
          "old_line_content": "  switch (call->callType) {",
          "new_line_content": "  uvUdf->output = uv_buf_init(bufBegin, len);",
          "content_same": false
        },
        {
          "line": 1263,
          "old_api": null,
          "new_api": "strlen",
          "old_text": null,
          "new_text": "strlen(argv[++i])",
          "old_line_content": "          return -1;",
          "new_line_content": "        if (strlen(argv[++i]) >= PATH_MAX) {",
          "content_same": false
        },
        {
          "line": 752,
          "old_api": null,
          "new_api": "blockDataFreeRes",
          "old_text": null,
          "new_text": "blockDataFreeRes(&call->block)",
          "old_line_content": "      break;",
          "new_line_content": "      blockDataFreeRes(&call->block);",
          "content_same": false
        },
        {
          "line": 753,
          "old_api": null,
          "new_api": "blockDataFreeRes",
          "old_text": null,
          "new_text": "blockDataFreeRes(&subRsp->resultData)",
          "old_line_content": "    }",
          "new_line_content": "      blockDataFreeRes(&subRsp->resultData);",
          "content_same": false
        },
        {
          "line": 1264,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\"config file path overflow\")",
          "old_line_content": "        }",
          "new_line_content": "          printf(\"config file path overflow\");",
          "content_same": false
        },
        {
          "line": 757,
          "old_api": null,
          "new_api": "freeUdfInterBuf",
          "old_text": null,
          "new_text": "freeUdfInterBuf(&subRsp->resultBuf)",
          "old_line_content": "    }",
          "new_line_content": "      freeUdfInterBuf(&subRsp->resultBuf);",
          "content_same": false
        },
        {
          "line": 1269,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\"'-c' requires a parameter, default is %s\\n\", configDir)",
          "old_line_content": "      }",
          "new_line_content": "        printf(\"'-c' requires a parameter, default is %s\\n\", configDir);",
          "content_same": false
        },
        {
          "line": 1272,
          "old_api": null,
          "new_api": "strcmp",
          "old_text": null,
          "new_text": "strcmp(argv[i], \"-V\")",
          "old_line_content": "    } else {",
          "new_line_content": "    } else if (strcmp(argv[i], \"-V\") == 0) {",
          "content_same": false
        },
        {
          "line": 761,
          "old_api": null,
          "new_api": "blockDataFreeRes",
          "old_text": null,
          "new_text": "blockDataFreeRes(&call->block)",
          "old_line_content": "      break;",
          "new_line_content": "      blockDataFreeRes(&call->block);",
          "content_same": false
        },
        {
          "line": 762,
          "old_api": null,
          "new_api": "freeUdfInterBuf",
          "old_text": null,
          "new_text": "freeUdfInterBuf(&subRsp->resultBuf)",
          "old_line_content": "    }",
          "new_line_content": "      freeUdfInterBuf(&subRsp->resultBuf);",
          "content_same": false
        },
        {
          "line": 766,
          "old_api": null,
          "new_api": "freeUdfInterBuf",
          "old_text": null,
          "new_text": "freeUdfInterBuf(&subRsp->resultBuf)",
          "old_line_content": "    }",
          "new_line_content": "      freeUdfInterBuf(&subRsp->resultBuf);",
          "content_same": false
        },
        {
          "line": 770,
          "old_api": null,
          "new_api": "freeUdfInterBuf",
          "old_text": null,
          "new_text": "freeUdfInterBuf(&subRsp->resultBuf)",
          "old_line_content": "    }",
          "new_line_content": "      freeUdfInterBuf(&subRsp->resultBuf);",
          "content_same": false
        },
        {
          "line": 1288,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\"gitinfo: %s\\n\", gitinfo)",
          "old_line_content": "}",
          "new_line_content": "  printf(\"gitinfo: %s\\n\", gitinfo);",
          "content_same": false
        },
        {
          "line": 777,
          "old_api": null,
          "new_api": "taosMemoryFree",
          "old_text": null,
          "new_text": "taosMemoryFree(uvUdf->input.base)",
          "old_line_content": "}",
          "new_line_content": "  taosMemoryFree(uvUdf->input.base);",
          "content_same": false
        },
        {
          "line": 1289,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\"buildInfo: %s\\n\", buildinfo)",
          "old_line_content": "",
          "new_line_content": "  printf(\"buildInfo: %s\\n\", buildinfo);",
          "content_same": false
        },
        {
          "line": 1294,
          "old_api": null,
          "new_api": "snprintf",
          "old_text": null,
          "new_text": "snprintf(logName, sizeof(logName), \"%slog\", \"udfd\")",
          "old_line_content": "}",
          "new_line_content": "  snprintf(logName, sizeof(logName), \"%slog\", \"udfd\");",
          "content_same": false
        },
        {
          "line": 783,
          "old_api": null,
          "new_api": "fnInfo",
          "old_text": null,
          "new_text": "fnInfo(\"teardown. seq number: %\" PRId64 \", handle:%\" PRIx64, request->seqNum, teardown->udfHandle)",
          "old_line_content": "  SUdf            *udf = handle->udf;",
          "new_line_content": "  fnInfo(\"teardown. seq number: %\" PRId64 \", handle:%\" PRIx64, request->seqNum, teardown->udfHandle);",
          "content_same": false
        },
        {
          "line": 1295,
          "old_api": null,
          "new_api": "taosCreateLog",
          "old_text": null,
          "new_text": "taosCreateLog(logName, 1, configDir, NULL, NULL, NULL, NULL, 0)",
          "old_line_content": "",
          "new_line_content": "  return taosCreateLog(logName, 1, configDir, NULL, NULL, NULL, NULL, 0);",
          "content_same": false
        },
        {
          "line": 1299,
          "old_api": null,
          "new_api": "taosMemoryMalloc",
          "old_text": null,
          "new_text": "taosMemoryMalloc(suggested_size)",
          "old_line_content": "}",
          "new_line_content": "  buf->base = taosMemoryMalloc(suggested_size);",
          "content_same": false
        },
        {
          "line": 789,
          "old_api": null,
          "new_api": "uv_mutex_lock",
          "old_text": null,
          "new_text": "uv_mutex_lock(&global.udfsMutex)",
          "old_line_content": "  if (udf->refCount == 0 && (!udf->resident || udf->expired)) {",
          "new_line_content": "  uv_mutex_lock(&global.udfsMutex);",
          "content_same": false
        },
        {
          "line": 1307,
          "old_api": null,
          "new_api": "uv_close",
          "old_text": null,
          "new_text": "uv_close((uv_handle_t *)q, NULL)",
          "old_line_content": "    return;",
          "new_line_content": "    uv_close((uv_handle_t *)q, NULL);",
          "content_same": false
        },
        {
          "line": 1308,
          "old_api": null,
          "new_api": "uv_stop",
          "old_text": null,
          "new_text": "uv_stop(global.loop)",
          "old_line_content": "  }",
          "new_line_content": "    uv_stop(global.loop);",
          "content_same": false
        },
        {
          "line": 1311,
          "old_api": null,
          "new_api": "fnError",
          "old_text": null,
          "new_text": "fnError(\"udfd ctrl pipe read %zu bytes\", nread)",
          "old_line_content": "}",
          "new_line_content": "  fnError(\"udfd ctrl pipe read %zu bytes\", nread);",
          "content_same": false
        },
        {
          "line": 1312,
          "old_api": null,
          "new_api": "taosMemoryFree",
          "old_text": null,
          "new_text": "taosMemoryFree(buf->base)",
          "old_line_content": "",
          "new_line_content": "  taosMemoryFree(buf->base);",
          "content_same": false
        },
        {
          "line": 801,
          "old_api": null,
          "new_api": "fnDebug",
          "old_text": null,
          "new_text": "fnDebug(\"udfd destroy function returns %d\", code)",
          "old_line_content": "  }",
          "new_line_content": "    fnDebug(\"udfd destroy function returns %d\", code);",
          "content_same": false
        },
        {
          "line": 804,
          "old_api": null,
          "new_api": "taosMemoryFree",
          "old_text": null,
          "new_text": "taosMemoryFree(handle)",
          "old_line_content": "  SUdfResponse  response = {0};",
          "new_line_content": "  taosMemoryFree(handle);",
          "content_same": false
        },
        {
          "line": 1317,
          "old_api": null,
          "new_api": "uv_fs_unlink",
          "old_text": null,
          "new_text": "uv_fs_unlink(global.loop, &req, global.listenPipeName, NULL)",
          "old_line_content": "  return err;",
          "new_line_content": "  int     err = uv_fs_unlink(global.loop, &req, global.listenPipeName, NULL);",
          "content_same": false
        },
        {
          "line": 1318,
          "old_api": null,
          "new_api": "uv_fs_req_cleanup",
          "old_text": null,
          "new_text": "uv_fs_req_cleanup(&req)",
          "old_line_content": "}",
          "new_line_content": "  uv_fs_req_cleanup(&req);",
          "content_same": false
        },
        {
          "line": 1325,
          "old_api": null,
          "new_api": "uv_loop_init",
          "old_text": null,
          "new_text": "uv_loop_init(loop)",
          "old_line_content": "    return -1;",
          "new_line_content": "    uv_loop_init(loop);",
          "content_same": false
        },
        {
          "line": 815,
          "old_api": null,
          "new_api": "encodeUdfResponse",
          "old_text": null,
          "new_text": "encodeUdfResponse(&buf, rsp)",
          "old_line_content": "",
          "new_line_content": "  encodeUdfResponse(&buf, rsp);",
          "content_same": false
        },
        {
          "line": 818,
          "old_api": null,
          "new_api": "taosMemoryFree",
          "old_text": null,
          "new_text": "taosMemoryFree(uvUdf->input.base)",
          "old_line_content": "}",
          "new_line_content": "  taosMemoryFree(uvUdf->input.base);",
          "content_same": false
        },
        {
          "line": 1333,
          "old_api": null,
          "new_api": "uv_pipe_open",
          "old_text": null,
          "new_text": "uv_pipe_open(&global.ctrlPipe, 0)",
          "old_line_content": "  }",
          "new_line_content": "    uv_pipe_open(&global.ctrlPipe, 0);",
          "content_same": false
        },
        {
          "line": 827,
          "old_api": null,
          "new_api": "snprintf",
          "old_text": null,
          "new_text": "snprintf(path, PATH_MAX, \"%s/lib%s_%d_%\" PRIx64 \".so\", global.udfDataDir, udf->name, udf->version,\n             udf->createdTime)",
          "old_line_content": "#endif",
          "new_line_content": "    snprintf(path, PATH_MAX, \"%s/lib%s_%d_%\" PRIx64 \".so\", global.udfDataDir, udf->name, udf->version,",
          "content_same": false
        },
        {
          "line": 1342,
          "old_api": null,
          "new_api": "uv_signal_init",
          "old_text": null,
          "new_text": "uv_signal_init(global.loop, &global.intrSignal)",
          "old_line_content": "",
          "new_line_content": "  uv_signal_init(global.loop, &global.intrSignal);",
          "content_same": false
        },
        {
          "line": 1343,
          "old_api": null,
          "new_api": "uv_signal_start",
          "old_text": null,
          "new_text": "uv_signal_start(&global.intrSignal, udfdIntrSignalHandler, SIGINT)",
          "old_line_content": "  int r;",
          "new_line_content": "  uv_signal_start(&global.intrSignal, udfdIntrSignalHandler, SIGINT);",
          "content_same": false
        },
        {
          "line": 834,
          "old_api": null,
          "new_api": "snprintf",
          "old_text": null,
          "new_text": "snprintf(path, PATH_MAX, \"%s/%s_%d_%\" PRIx64 \".py\", global.udfDataDir, udf->name, udf->version, udf->createdTime)",
          "old_line_content": "  } else {",
          "new_line_content": "    snprintf(path, PATH_MAX, \"%s/%s_%d_%\" PRIx64 \".py\", global.udfDataDir, udf->name, udf->version, udf->createdTime);",
          "content_same": false
        },
        {
          "line": 1348,
          "old_api": null,
          "new_api": "uv_err_name",
          "old_text": null,
          "new_text": "uv_err_name(r)",
          "old_line_content": "    return -2;",
          "new_line_content": "    fnError(\"Bind error %s\", uv_err_name(r));",
          "content_same": false
        },
        {
          "line": 1349,
          "old_api": null,
          "new_api": "removeListeningPipe",
          "old_text": null,
          "new_text": "removeListeningPipe()",
          "old_line_content": "  }",
          "new_line_content": "    removeListeningPipe();",
          "content_same": false
        },
        {
          "line": 840,
          "old_api": null,
          "new_api": "snprintf",
          "old_text": null,
          "new_text": "snprintf(path, PATH_MAX, \"%s/lib%s_%d_%\" PRIx64, global.udfDataDir, udf->name, udf->version, udf->createdTime)",
          "old_line_content": "  }",
          "new_line_content": "    snprintf(path, PATH_MAX, \"%s/lib%s_%d_%\" PRIx64, global.udfDataDir, udf->name, udf->version, udf->createdTime);",
          "content_same": false
        },
        {
          "line": 1353,
          "old_api": null,
          "new_api": "uv_err_name",
          "old_text": null,
          "new_text": "uv_err_name(r)",
          "old_line_content": "    return -3;",
          "new_line_content": "    fnError(\"Listen error %s\", uv_err_name(r));",
          "content_same": false
        },
        {
          "line": 1354,
          "old_api": null,
          "new_api": "removeListeningPipe",
          "old_text": null,
          "new_text": "removeListeningPipe()",
          "old_line_content": "  }",
          "new_line_content": "    removeListeningPipe();",
          "content_same": false
        },
        {
          "line": 848,
          "old_api": null,
          "new_api": "terrstr",
          "old_text": null,
          "new_text": "terrstr(terrno)",
          "old_line_content": "  }",
          "new_line_content": "    fnError(\"udfd create shared library failed since %s\", terrstr(terrno));",
          "content_same": false
        },
        {
          "line": 1361,
          "old_api": null,
          "new_api": "uv_is_closing",
          "old_text": null,
          "new_text": "uv_is_closing(handle)",
          "old_line_content": "  }",
          "new_line_content": "  if (!uv_is_closing(handle)) {",
          "content_same": false
        },
        {
          "line": 1362,
          "old_api": null,
          "new_api": "uv_close",
          "old_text": null,
          "new_text": "uv_close(handle, NULL)",
          "old_line_content": "}",
          "new_line_content": "    uv_close(handle, NULL);",
          "content_same": false
        },
        {
          "line": 853,
          "old_api": null,
          "new_api": "udfdGetFuncBodyPath",
          "old_text": null,
          "new_text": "udfdGetFuncBodyPath(udf, path)",
          "old_line_content": "  if (fileExist) {",
          "new_line_content": "  udfdGetFuncBodyPath(udf, path);",
          "content_same": false
        },
        {
          "line": 856,
          "old_api": null,
          "new_api": "strncpy",
          "old_text": null,
          "new_text": "strncpy(udf->path, path, PATH_MAX)",
          "old_line_content": "    return TSDB_CODE_SUCCESS;",
          "new_line_content": "    strncpy(udf->path, path, PATH_MAX);",
          "content_same": false
        },
        {
          "line": 857,
          "old_api": null,
          "new_api": "fnInfo",
          "old_text": null,
          "new_text": "fnInfo(\"udfd func body file. reuse existing file %s\", path)",
          "old_line_content": "  }",
          "new_line_content": "    fnInfo(\"udfd func body file. reuse existing file %s\", path);",
          "content_same": false
        },
        {
          "line": 1369,
          "old_api": null,
          "new_api": "taosGetDefaultHashFunction",
          "old_text": null,
          "new_text": "taosGetDefaultHashFunction(TSDB_DATA_TYPE_BINARY)",
          "old_line_content": "",
          "new_line_content": "  global.udfsHash = taosHashInit(64, taosGetDefaultHashFunction(TSDB_DATA_TYPE_BINARY), true, HASH_NO_LOCK);",
          "content_same": false
        },
        {
          "line": 1373,
          "old_api": null,
          "new_api": "uv_run",
          "old_text": null,
          "new_text": "uv_run(global.loop, UV_RUN_DEFAULT)",
          "old_line_content": "",
          "new_line_content": "  uv_run(global.loop, UV_RUN_DEFAULT);",
          "content_same": false
        },
        {
          "line": 863,
          "old_api": null,
          "new_api": "strerror",
          "old_text": null,
          "new_text": "strerror(errno)",
          "old_line_content": "  }",
          "new_line_content": "    fnError(\"udfd write udf shared library: %s failed, error: %d %s\", path, errno, strerror(errno));",
          "content_same": false
        },
        {
          "line": 1379,
          "old_api": null,
          "new_api": "uv_run",
          "old_text": null,
          "new_text": "uv_run(global.loop, UV_RUN_DEFAULT)",
          "old_line_content": "",
          "new_line_content": "  uv_run(global.loop, UV_RUN_DEFAULT);",
          "content_same": false
        },
        {
          "line": 868,
          "old_api": null,
          "new_api": "fnError",
          "old_text": null,
          "new_text": "fnError(\"udfd write udf shared library failed\")",
          "old_line_content": "  }",
          "new_line_content": "    fnError(\"udfd write udf shared library failed\");",
          "content_same": false
        },
        {
          "line": 1380,
          "old_api": null,
          "new_api": "uv_loop_close",
          "old_text": null,
          "new_text": "uv_loop_close(global.loop)",
          "old_line_content": "  return 0;",
          "new_line_content": "  uv_loop_close(global.loop);",
          "content_same": false
        },
        {
          "line": 873,
          "old_api": null,
          "new_api": "strncpy",
          "old_text": null,
          "new_text": "strncpy(udf->path, path, PATH_MAX)",
          "old_line_content": "}",
          "new_line_content": "  strncpy(udf->path, path, PATH_MAX);",
          "content_same": false
        },
        {
          "line": 1389,
          "old_api": null,
          "new_api": "uv_sleep",
          "old_text": null,
          "new_text": "uv_sleep(100 * (1 << retryMnodeTimes))",
          "old_line_content": "    if (code == 0) {",
          "new_line_content": "    uv_sleep(100 * (1 << retryMnodeTimes));",
          "content_same": false
        },
        {
          "line": 1390,
          "old_api": null,
          "new_api": "udfdConnectToMnode",
          "old_text": null,
          "new_text": "udfdConnectToMnode()",
          "old_line_content": "      break;",
          "new_line_content": "    code = udfdConnectToMnode();",
          "content_same": false
        },
        {
          "line": 881,
          "old_api": null,
          "new_api": "isEpsetEqual",
          "old_text": null,
          "new_text": "isEpsetEqual(&global.mgmtEp.epSet, pEpSet)",
          "old_line_content": "    }",
          "new_line_content": "    if (!isEpsetEqual(&global.mgmtEp.epSet, pEpSet)) {",
          "content_same": false
        },
        {
          "line": 882,
          "old_api": null,
          "new_api": "updateEpSet_s",
          "old_text": null,
          "new_text": "updateEpSet_s(&global.mgmtEp, pEpSet)",
          "old_line_content": "  }",
          "new_line_content": "      updateEpSet_s(&global.mgmtEp, pEpSet);",
          "content_same": false
        },
        {
          "line": 1394,
          "old_api": null,
          "new_api": "tstrerror",
          "old_text": null,
          "new_text": "tstrerror(code)",
          "old_line_content": "",
          "new_line_content": "    fnError(\"udfd can not connect to mnode, code: %s. retry\", tstrerror(code));",
          "content_same": false
        },
        {
          "line": 1398,
          "old_api": null,
          "new_api": "fnError",
          "old_text": null,
          "new_text": "fnError(\"udfd can not connect to mnode\")",
          "old_line_content": "}",
          "new_line_content": "    fnError(\"udfd can not connect to mnode\");",
          "content_same": false
        },
        {
          "line": 887,
          "old_api": null,
          "new_api": "tstrerror",
          "old_text": null,
          "new_text": "tstrerror(pMsg->code)",
          "old_line_content": "    goto _return;",
          "new_line_content": "    fnError(\"udfd rpc error. code: %s\", tstrerror(pMsg->code));",
          "content_same": false
        },
        {
          "line": 1403,
          "old_api": null,
          "new_api": "strlen",
          "old_text": null,
          "new_text": "strlen(tsUdfdResFuncs)",
          "old_line_content": "  }",
          "new_line_content": "  if (strlen(tsUdfdResFuncs) == 0) {",
          "content_same": false
        },
        {
          "line": 1407,
          "old_api": null,
          "new_api": "taosArrayInit",
          "old_text": null,
          "new_text": "taosArrayInit(2, TSDB_FUNC_NAME_LEN)",
          "old_line_content": "  char *token;",
          "new_line_content": "  global.residentFuncs = taosArrayInit(2, TSDB_FUNC_NAME_LEN);",
          "content_same": false
        },
        {
          "line": 896,
          "old_api": null,
          "new_api": "taosGetTimestampSec",
          "old_text": null,
          "new_text": "taosGetTimestampSec()",
          "old_line_content": "    if (delta > 900) {",
          "new_line_content": "    int32_t now = taosGetTimestampSec();",
          "content_same": false
        },
        {
          "line": 897,
          "old_api": null,
          "new_api": "abs",
          "old_text": null,
          "new_text": "abs(now - connectRsp.svrTimestamp)",
          "old_line_content": "      msgInfo->code = TSDB_CODE_TIME_UNSYNCED;",
          "new_line_content": "    int32_t delta = abs(now - connectRsp.svrTimestamp);",
          "content_same": false
        },
        {
          "line": 1413,
          "old_api": null,
          "new_api": "fnInfo",
          "old_text": null,
          "new_text": "fnInfo(\"udfd add resident function %s\", func)",
          "old_line_content": "  }",
          "new_line_content": "    fnInfo(\"udfd add resident function %s\", func);",
          "content_same": false
        },
        {
          "line": 1414,
          "old_api": null,
          "new_api": "taosArrayPush",
          "old_text": null,
          "new_text": "taosArrayPush(global.residentFuncs, func)",
          "old_line_content": "",
          "new_line_content": "    taosArrayPush(global.residentFuncs, func);",
          "content_same": false
        },
        {
          "line": 908,
          "old_api": null,
          "new_api": "isEpsetEqual",
          "old_text": null,
          "new_text": "isEpsetEqual(&global.mgmtEp.epSet, &connectRsp.epSet)",
          "old_line_content": "    }",
          "new_line_content": "    if (connectRsp.dnodeNum > 1 && !isEpsetEqual(&global.mgmtEp.epSet, &connectRsp.epSet)) {",
          "content_same": false
        },
        {
          "line": 909,
          "old_api": null,
          "new_api": "updateEpSet_s",
          "old_text": null,
          "new_text": "updateEpSet_s(&global.mgmtEp, &connectRsp.epSet)",
          "old_line_content": "    msgInfo->code = 0;",
          "new_line_content": "      updateEpSet_s(&global.mgmtEp, &connectRsp.epSet);",
          "content_same": false
        },
        {
          "line": 1422,
          "old_api": null,
          "new_api": "taosArrayGet",
          "old_text": null,
          "new_text": "taosArrayGet(global.residentFuncs, i)",
          "old_line_content": "    if (udfInHash) {",
          "new_line_content": "    char  *funcName = taosArrayGet(global.residentFuncs, i);",
          "content_same": false
        },
        {
          "line": 1423,
          "old_api": null,
          "new_api": "strlen",
          "old_text": null,
          "new_text": "strlen(funcName)",
          "old_line_content": "      SUdf   *udf = *udfInHash;",
          "new_line_content": "    SUdf **udfInHash = taosHashGet(global.udfsHash, funcName, strlen(funcName));",
          "content_same": false
        },
        {
          "line": 916,
          "old_api": null,
          "new_api": "taosArrayGet",
          "old_text": null,
          "new_text": "taosArrayGet(retrieveRsp.pFuncInfos, 0)",
          "old_line_content": "    udf->funcType = pFuncInfo->funcType;",
          "new_line_content": "    SFuncInfo *pFuncInfo = (SFuncInfo *)taosArrayGet(retrieveRsp.pFuncInfos, 0);",
          "content_same": false
        },
        {
          "line": 1428,
          "old_api": null,
          "new_api": "strlen",
          "old_text": null,
          "new_text": "strlen(funcName)",
          "old_line_content": "    }",
          "new_line_content": "      taosHashRemove(global.udfsHash, funcName, strlen(funcName));",
          "content_same": false
        },
        {
          "line": 1429,
          "old_api": null,
          "new_api": "taosMemoryFree",
          "old_text": null,
          "new_text": "taosMemoryFree(udf)",
          "old_line_content": "  }",
          "new_line_content": "      taosMemoryFree(udf);",
          "content_same": false
        },
        {
          "line": 1432,
          "old_api": null,
          "new_api": "taosArrayDestroy",
          "old_text": null,
          "new_text": "taosArrayDestroy(global.residentFuncs)",
          "old_line_content": "}",
          "new_line_content": "  taosArrayDestroy(global.residentFuncs);",
          "content_same": false
        },
        {
          "line": 924,
          "old_api": null,
          "new_api": "taosArrayGet",
          "old_text": null,
          "new_text": "taosArrayGet(retrieveRsp.pFuncExtraInfos, 0)",
          "old_line_content": "    udf->createdTime = pFuncExtraInfo->funcCreatedTime;",
          "new_line_content": "    SFuncExtraInfo *pFuncExtraInfo = (SFuncExtraInfo *)taosArrayGet(retrieveRsp.pFuncExtraInfos, 0);",
          "content_same": false
        },
        {
          "line": 1437,
          "old_api": null,
          "new_api": "uv_mutex_destroy",
          "old_text": null,
          "new_text": "uv_mutex_destroy(&global.udfsMutex)",
          "old_line_content": "  return 0;",
          "new_line_content": "  uv_mutex_destroy(&global.udfsMutex);",
          "content_same": false
        },
        {
          "line": 1438,
          "old_api": null,
          "new_api": "taosHashCleanup",
          "old_text": null,
          "new_text": "taosHashCleanup(global.udfsHash)",
          "old_line_content": "}",
          "new_line_content": "  taosHashCleanup(global.udfsHash);",
          "content_same": false
        },
        {
          "line": 927,
          "old_api": null,
          "new_api": "udfdSaveFuncBodyToFile",
          "old_text": null,
          "new_text": "udfdSaveFuncBodyToFile(pFuncInfo, udf)",
          "old_line_content": "      udf->lastFetchTime = 0;",
          "new_line_content": "    msgInfo->code = udfdSaveFuncBodyToFile(pFuncInfo, udf);",
          "content_same": false
        },
        {
          "line": 1443,
          "old_api": null,
          "new_api": "snprintf",
          "old_text": null,
          "new_text": "snprintf(global.udfDataDir, PATH_MAX, \"%s/.udf\", tsDataDir)",
          "old_line_content": "  if (code != TSDB_CODE_SUCCESS) {",
          "new_line_content": "  snprintf(global.udfDataDir, PATH_MAX, \"%s/.udf\", tsDataDir);",
          "content_same": false
        },
        {
          "line": 932,
          "old_api": null,
          "new_api": "taosArrayDestroy",
          "old_text": null,
          "new_text": "taosArrayDestroy(retrieveRsp.pFuncInfos)",
          "old_line_content": "  }",
          "new_line_content": "    taosArrayDestroy(retrieveRsp.pFuncInfos);",
          "content_same": false
        },
        {
          "line": 933,
          "old_api": null,
          "new_api": "taosArrayDestroy",
          "old_text": null,
          "new_text": "taosArrayDestroy(retrieveRsp.pFuncExtraInfos)",
          "old_line_content": "",
          "new_line_content": "    taosArrayDestroy(retrieveRsp.pFuncExtraInfos);",
          "content_same": false
        },
        {
          "line": 1446,
          "old_api": null,
          "new_api": "snprintf",
          "old_text": null,
          "new_text": "snprintf(global.udfDataDir, PATH_MAX, \"%s/.udf\", tsTempDir)",
          "old_line_content": "  }",
          "new_line_content": "    snprintf(global.udfDataDir, PATH_MAX, \"%s/.udf\", tsTempDir);",
          "content_same": false
        },
        {
          "line": 937,
          "old_api": null,
          "new_api": "rpcFreeCont",
          "old_text": null,
          "new_text": "rpcFreeCont(pMsg->pCont)",
          "old_line_content": "  return;",
          "new_line_content": "  rpcFreeCont(pMsg->pCont);",
          "content_same": false
        },
        {
          "line": 938,
          "old_api": null,
          "new_api": "uv_sem_post",
          "old_text": null,
          "new_text": "uv_sem_post(&msgInfo->resultSem)",
          "old_line_content": "}",
          "new_line_content": "  uv_sem_post(&msgInfo->resultSem);",
          "content_same": false
        },
        {
          "line": 1449,
          "old_api": null,
          "new_api": "tstrerror",
          "old_text": null,
          "new_text": "tstrerror(code)",
          "old_line_content": "  return code;",
          "new_line_content": "  fnInfo(\"udfd create udf source directory %s. result: %s\", global.udfDataDir, tstrerror(code));",
          "content_same": false
        },
        {
          "line": 1455,
          "old_api": null,
          "new_api": "fnInfo",
          "old_text": null,
          "new_text": "fnInfo(\"destory udf source directory %s\", global.udfDataDir)",
          "old_line_content": "  return 0;",
          "new_line_content": "  fnInfo(\"destory udf source directory %s\", global.udfDataDir);",
          "content_same": false
        },
        {
          "line": 1456,
          "old_api": null,
          "new_api": "taosRemoveDir",
          "old_text": null,
          "new_text": "taosRemoveDir(global.udfDataDir)",
          "old_line_content": "}",
          "new_line_content": "  taosRemoveDir(global.udfDataDir);",
          "content_same": false
        },
        {
          "line": 945,
          "old_api": null,
          "new_api": "taosArrayInit",
          "old_text": null,
          "new_text": "taosArrayInit(1, TSDB_FUNC_NAME_LEN)",
          "old_line_content": "",
          "new_line_content": "  retrieveReq.pFuncNames = taosArrayInit(1, TSDB_FUNC_NAME_LEN);",
          "content_same": false
        },
        {
          "line": 1461,
          "old_api": null,
          "new_api": "taosCheckSystemIsLittleEnd",
          "old_text": null,
          "new_text": "taosCheckSystemIsLittleEnd()",
          "old_line_content": "    return -1;",
          "new_line_content": "  if (!taosCheckSystemIsLittleEnd()) {",
          "content_same": false
        },
        {
          "line": 950,
          "old_api": null,
          "new_api": "tSerializeSRetrieveFuncReq",
          "old_text": null,
          "new_text": "tSerializeSRetrieveFuncReq(pReq, contLen, &retrieveReq)",
          "old_line_content": "",
          "new_line_content": "  tSerializeSRetrieveFuncReq(pReq, contLen, &retrieveReq);",
          "content_same": false
        },
        {
          "line": 1462,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\"failed to start since on non-little-end machines\\n\")",
          "old_line_content": "  }",
          "new_line_content": "    printf(\"failed to start since on non-little-end machines\\n\");",
          "content_same": false
        },
        {
          "line": 953,
          "old_api": null,
          "new_api": "taosMemoryCalloc",
          "old_text": null,
          "new_text": "taosMemoryCalloc(1, sizeof(SUdfdRpcSendRecvInfo))",
          "old_line_content": "  msgInfo->param = udf;",
          "new_line_content": "  SUdfdRpcSendRecvInfo *msgInfo = taosMemoryCalloc(1, sizeof(SUdfdRpcSendRecvInfo));",
          "content_same": false
        },
        {
          "line": 1466,
          "old_api": null,
          "new_api": "udfdParseArgs",
          "old_text": null,
          "new_text": "udfdParseArgs(argc, argv)",
          "old_line_content": "    return -1;",
          "new_line_content": "  if (udfdParseArgs(argc, argv) != 0) {",
          "content_same": false
        },
        {
          "line": 1467,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\"failed to start since parse args error\\n\")",
          "old_line_content": "  }",
          "new_line_content": "    printf(\"failed to start since parse args error\\n\");",
          "content_same": false
        },
        {
          "line": 956,
          "old_api": null,
          "new_api": "uv_sem_init",
          "old_text": null,
          "new_text": "uv_sem_init(&msgInfo->resultSem, 0)",
          "old_line_content": "  SRpcMsg rpcMsg = {0};",
          "new_line_content": "  uv_sem_init(&msgInfo->resultSem, 0);",
          "content_same": false
        },
        {
          "line": 1472,
          "old_api": null,
          "new_api": "udfdPrintVersion",
          "old_text": null,
          "new_text": "udfdPrintVersion()",
          "old_line_content": "  }",
          "new_line_content": "    udfdPrintVersion();",
          "content_same": false
        },
        {
          "line": 965,
          "old_api": null,
          "new_api": "uv_sem_wait",
          "old_text": null,
          "new_text": "uv_sem_wait(&msgInfo->resultSem)",
          "old_line_content": "  int32_t code = msgInfo->code;",
          "new_line_content": "  uv_sem_wait(&msgInfo->resultSem);",
          "content_same": false
        },
        {
          "line": 1478,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\"failed to start since init log error\\n\")",
          "old_line_content": "",
          "new_line_content": "    printf(\"failed to start since init log error\\n\");",
          "content_same": false
        },
        {
          "line": 968,
          "old_api": null,
          "new_api": "taosMemoryFree",
          "old_text": null,
          "new_text": "taosMemoryFree(msgInfo)",
          "old_line_content": "}",
          "new_line_content": "  taosMemoryFree(msgInfo);",
          "content_same": false
        },
        {
          "line": 1481,
          "old_api": null,
          "new_api": "taosInitCfg",
          "old_text": null,
          "new_text": "taosInitCfg(configDir, NULL, NULL, NULL, NULL, 0)",
          "old_line_content": "    return -2;",
          "new_line_content": "  if (taosInitCfg(configDir, NULL, NULL, NULL, NULL, 0) != 0) {",
          "content_same": false
        },
        {
          "line": 1482,
          "old_api": null,
          "new_api": "fnError",
          "old_text": null,
          "new_text": "fnError(\"failed to start since read config error\")",
          "old_line_content": "  }",
          "new_line_content": "    fnError(\"failed to start since read config error\");",
          "content_same": false
        },
        {
          "line": 975,
          "old_api": null,
          "new_api": "tstrncpy",
          "old_text": null,
          "new_text": "tstrncpy(connReq.app, \"udfd\", sizeof(connReq.app))",
          "old_line_content": "  char pass[TSDB_PASSWORD_LEN + 1] = {0};",
          "new_line_content": "  tstrncpy(connReq.app, \"udfd\", sizeof(connReq.app));",
          "content_same": false
        },
        {
          "line": 1487,
          "old_api": null,
          "new_api": "udfdOpenClientRpc",
          "old_text": null,
          "new_text": "udfdOpenClientRpc()",
          "old_line_content": "    return -3;",
          "new_line_content": "  if (udfdOpenClientRpc() != 0) {",
          "content_same": false
        },
        {
          "line": 1488,
          "old_api": null,
          "new_api": "fnError",
          "old_text": null,
          "new_text": "fnError(\"open rpc connection to mnode failed\")",
          "old_line_content": "  }",
          "new_line_content": "    fnError(\"open rpc connection to mnode failed\");",
          "content_same": false
        },
        {
          "line": 1492,
          "old_api": null,
          "new_api": "udfdCreateUdfSourceDir",
          "old_text": null,
          "new_text": "udfdCreateUdfSourceDir()",
          "old_line_content": "    return -4;",
          "new_line_content": "  if (udfdCreateUdfSourceDir() != 0) {",
          "content_same": false
        },
        {
          "line": 981,
          "old_api": null,
          "new_api": "taosGetTimestampMs",
          "old_text": null,
          "new_text": "taosGetTimestampMs()",
          "old_line_content": "",
          "new_line_content": "  connReq.startTime = taosGetTimestampMs();",
          "content_same": false
        },
        {
          "line": 1493,
          "old_api": null,
          "new_api": "fnError",
          "old_text": null,
          "new_text": "fnError(\"create udf source directory failed\")",
          "old_line_content": "  }",
          "new_line_content": "    fnError(\"create udf source directory failed\");",
          "content_same": false
        },
        {
          "line": 985,
          "old_api": null,
          "new_api": "rpcMallocCont",
          "old_text": null,
          "new_text": "rpcMallocCont(contLen)",
          "old_line_content": "",
          "new_line_content": "  void   *pReq = rpcMallocCont(contLen);",
          "content_same": false
        },
        {
          "line": 1497,
          "old_api": null,
          "new_api": "udfdUvInit",
          "old_text": null,
          "new_text": "udfdUvInit()",
          "old_line_content": "    return -5;",
          "new_line_content": "  if (udfdUvInit() != 0) {",
          "content_same": false
        },
        {
          "line": 1498,
          "old_api": null,
          "new_api": "fnError",
          "old_text": null,
          "new_text": "fnError(\"uv init failure\")",
          "old_line_content": "  }",
          "new_line_content": "    fnError(\"uv init failure\");",
          "content_same": false
        },
        {
          "line": 990,
          "old_api": null,
          "new_api": "uv_sem_init",
          "old_text": null,
          "new_text": "uv_sem_init(&msgInfo->resultSem, 0)",
          "old_line_content": "  SRpcMsg rpcMsg = {0};",
          "new_line_content": "  uv_sem_init(&msgInfo->resultSem, 0);",
          "content_same": false
        },
        {
          "line": 1502,
          "old_api": null,
          "new_api": "udfdInitResidentFuncs",
          "old_text": null,
          "new_text": "udfdInitResidentFuncs()",
          "old_line_content": "  uv_thread_t mnodeConnectThread;",
          "new_line_content": "  udfdInitResidentFuncs();",
          "content_same": false
        },
        {
          "line": 1510,
          "old_api": null,
          "new_api": "udfdDestroyUdfSourceDir",
          "old_text": null,
          "new_text": "udfdDestroyUdfSourceDir()",
          "old_line_content": "",
          "new_line_content": "  udfdDestroyUdfSourceDir();",
          "content_same": false
        },
        {
          "line": 1001,
          "old_api": null,
          "new_api": "uv_sem_destroy",
          "old_text": null,
          "new_text": "uv_sem_destroy(&msgInfo->resultSem)",
          "old_line_content": "  return code;",
          "new_line_content": "  uv_sem_destroy(&msgInfo->resultSem);",
          "content_same": false
        },
        {
          "line": 1002,
          "old_api": null,
          "new_api": "taosMemoryFree",
          "old_text": null,
          "new_text": "taosMemoryFree(msgInfo)",
          "old_line_content": "}",
          "new_line_content": "  taosMemoryFree(msgInfo);",
          "content_same": false
        },
        {
          "line": 1517,
          "old_api": null,
          "new_api": "udfdCleanup",
          "old_text": null,
          "new_text": "udfdCleanup()",
          "old_line_content": "}",
          "new_line_content": "  udfdCleanup();",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 1027,
          "old_api": "strlen",
          "new_api": null,
          "old_text": "strlen(firstEp)",
          "new_text": null,
          "old_line_content": "    if (strlen(firstEp) >= TSDB_EP_LEN) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1032,
          "old_api": "taosGetFqdnPortFromEp",
          "new_api": null,
          "old_text": "taosGetFqdnPortFromEp(firstEp, &mgmtEpSet->eps[0])",
          "new_text": null,
          "old_line_content": "    int32_t code = taosGetFqdnPortFromEp(firstEp, &mgmtEpSet->eps[0]);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1042,
          "old_api": "strlen",
          "new_api": null,
          "old_text": "strlen(secondEp)",
          "new_text": null,
          "old_line_content": "    if (strlen(secondEp) >= TSDB_EP_LEN) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1047,
          "old_api": "taosGetFqdnPortFromEp",
          "new_api": null,
          "old_text": "taosGetFqdnPortFromEp(secondEp, &mgmtEpSet->eps[mgmtEpSet->numOfEps])",
          "new_text": null,
          "old_line_content": "    taosGetFqdnPortFromEp(secondEp, &mgmtEpSet->eps[mgmtEpSet->numOfEps]);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1073,
          "old_api": "TMAX",
          "new_api": null,
          "old_text": "TMAX(connLimitNum, 10)",
          "new_text": null,
          "old_line_content": "  connLimitNum = TMAX(connLimitNum, 10);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1074,
          "old_api": "TMIN",
          "new_api": null,
          "old_text": "TMIN(connLimitNum, 500)",
          "new_text": null,
          "old_line_content": "  connLimitNum = TMIN(connLimitNum, 500);",
          "new_line_content": "  int32_t connLimitNum = tsNumOfRpcSessions / (tsNumOfRpcThreads * 3);",
          "content_same": false
        },
        {
          "line": 1078,
          "old_api": "rpcOpen",
          "new_api": null,
          "old_text": "rpcOpen(&rpcInit)",
          "new_text": null,
          "old_line_content": "  global.clientRpc = rpcOpen(&rpcInit);",
          "new_line_content": "  rpcInit.timeToGetConn = tsTimeToGetAvailableConn;",
          "content_same": false
        },
        {
          "line": 1087,
          "old_api": "fnInfo",
          "new_api": null,
          "old_text": "fnInfo(\"udfd begin closing rpc\")",
          "new_text": null,
          "old_line_content": "  fnInfo(\"udfd begin closing rpc\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1088,
          "old_api": "rpcClose",
          "new_api": null,
          "old_text": "rpcClose(global.clientRpc)",
          "new_text": null,
          "old_line_content": "  rpcClose(global.clientRpc);",
          "new_line_content": "int32_t udfdCloseClientRpc() {",
          "content_same": false
        },
        {
          "line": 1096,
          "old_api": "uv_err_name",
          "new_api": null,
          "old_text": "uv_err_name(status)",
          "new_text": null,
          "old_line_content": "    fnError(\"udfd send response error, length: %zu code: %s\", work->output.len, uv_err_name(status));",
          "new_line_content": "  SUvUdfWork *work = (SUvUdfWork *)req->data;",
          "content_same": false
        },
        {
          "line": 1106,
          "old_api": "fnError",
          "new_api": null,
          "old_text": "fnError(\"work not in conn any more\")",
          "new_text": null,
          "old_line_content": "      fnError(\"work not in conn any more\");",
          "new_line_content": "      *ppWork = work->pWorkNext;",
          "content_same": false
        },
        {
          "line": 1109,
          "old_api": "taosMemoryFree",
          "new_api": null,
          "old_text": "taosMemoryFree(work->output.base)",
          "new_text": null,
          "old_line_content": "  taosMemoryFree(work->output.base);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1110,
          "old_api": "taosMemoryFree",
          "new_api": null,
          "old_text": "taosMemoryFree(work)",
          "new_text": null,
          "old_line_content": "  taosMemoryFree(work);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 1118,
          "old_api": "taosMemoryMalloc",
          "new_api": null,
          "old_text": "taosMemoryMalloc(sizeof(uv_write_t))",
          "new_text": null,
          "old_line_content": "    uv_write_t *write_req = taosMemoryMalloc(sizeof(uv_write_t));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1129,
          "old_api": "taosMemoryMalloc",
          "new_api": null,
          "old_text": "taosMemoryMalloc(msgHeadSize)",
          "new_text": null,
          "old_line_content": "    ctx->inputBuf = taosMemoryMalloc(msgHeadSize);",
          "new_line_content": "  int32_t      msgHeadSize = sizeof(int32_t) + sizeof(int64_t);",
          "content_same": false
        },
        {
          "line": 1138,
          "old_api": "fnError",
          "new_api": null,
          "old_text": "fnError(\"udfd can not allocate enough memory\")",
          "new_text": null,
          "old_line_content": "      fnError(\"udfd can not allocate enough memory\") buf->base = NULL;",
          "new_line_content": "      buf->len = ctx->inputCap;",
          "content_same": false
        },
        {
          "line": 1146,
          "old_api": "taosMemoryRealloc",
          "new_api": null,
          "old_text": "taosMemoryRealloc(ctx->inputBuf, ctx->inputCap)",
          "new_text": null,
          "old_line_content": "    void *inputBuf = taosMemoryRealloc(ctx->inputBuf, ctx->inputCap);",
          "new_line_content": "  } else {",
          "content_same": false
        },
        {
          "line": 1152,
          "old_api": "fnError",
          "new_api": null,
          "old_text": "fnError(\"udfd can not allocate enough memory\")",
          "new_text": null,
          "old_line_content": "      fnError(\"udfd can not allocate enough memory\") buf->base = NULL;",
          "new_line_content": "      buf->len = ctx->inputCap - ctx->inputLen;",
          "content_same": false
        },
        {
          "line": 1163,
          "old_api": "fnDebug",
          "new_api": null,
          "old_text": "fnDebug(\"receive request complete. length %d\", pipe->inputLen)",
          "new_text": null,
          "old_line_content": "    fnDebug(\"receive request complete. length %d\", pipe->inputLen);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 1173,
          "old_api": "taosMemoryMalloc",
          "new_api": null,
          "old_text": "taosMemoryMalloc(sizeof(uv_work_t))",
          "new_text": null,
          "old_line_content": "  uv_work_t  *work = taosMemoryMalloc(sizeof(uv_work_t));",
          "new_line_content": "  int32_t inputLen = conn->inputLen;",
          "content_same": false
        },
        {
          "line": 1174,
          "old_api": "taosMemoryMalloc",
          "new_api": null,
          "old_text": "taosMemoryMalloc(sizeof(SUvUdfWork))",
          "new_text": null,
          "old_line_content": "  SUvUdfWork *udfWork = taosMemoryMalloc(sizeof(SUvUdfWork));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1178,
          "old_api": "uv_buf_init",
          "new_api": null,
          "old_text": "uv_buf_init(inputBuf, inputLen)",
          "new_text": null,
          "old_line_content": "  udfWork->input = uv_buf_init(inputBuf, inputLen);",
          "new_line_content": "  udfWork->pWorkNext = conn->pWorkList;",
          "content_same": false
        },
        {
          "line": 1184,
          "old_api": "uv_queue_work",
          "new_api": null,
          "old_text": "uv_queue_work(global.loop, work, udfdProcessRequest, udfdSendResponse)",
          "new_text": null,
          "old_line_content": "  uv_queue_work(global.loop, work, udfdProcessRequest, udfdSendResponse);",
          "new_line_content": "  conn->inputTotal = -1;",
          "content_same": false
        },
        {
          "line": 1195,
          "old_api": "taosMemoryFree",
          "new_api": null,
          "old_text": "taosMemoryFree(conn->client)",
          "new_text": null,
          "old_line_content": "  taosMemoryFree(conn->client);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 1196,
          "old_api": "taosMemoryFree",
          "new_api": null,
          "old_text": "taosMemoryFree(conn->inputBuf)",
          "new_text": null,
          "old_line_content": "  taosMemoryFree(conn->inputBuf);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1201,
          "old_api": "fnDebug",
          "new_api": null,
          "old_text": "fnDebug(\"udfd read %zd bytes from client\", nread)",
          "new_text": null,
          "old_line_content": "  fnDebug(\"udfd read %zd bytes from client\", nread);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 692,
          "old_api": "convertDataBlockToUdfDataBlock",
          "new_api": null,
          "old_text": "convertDataBlockToUdfDataBlock(&call->block, &input)",
          "new_text": null,
          "old_line_content": "      convertDataBlockToUdfDataBlock(&call->block, &input);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 693,
          "old_api": "udfScalarProcFunc",
          "new_api": null,
          "old_text": "udf->scriptPlugin->udfScalarProcFunc(&input, &output, udf->scriptUdfCtx)",
          "new_text": null,
          "old_line_content": "      code = udf->scriptPlugin->udfScalarProcFunc(&input, &output, udf->scriptUdfCtx);",
          "new_line_content": "      SUdfDataBlock input = {0};",
          "content_same": false
        },
        {
          "line": 1208,
          "old_api": "isUdfdUvMsgComplete",
          "new_api": null,
          "old_text": "isUdfdUvMsgComplete(conn)",
          "new_text": null,
          "old_line_content": "    if (isUdfdUvMsgComplete(conn)) {",
          "new_line_content": "  if (nread > 0) {",
          "content_same": false
        },
        {
          "line": 1209,
          "old_api": "udfdHandleRequest",
          "new_api": null,
          "old_text": "udfdHandleRequest(conn)",
          "new_text": null,
          "old_line_content": "      udfdHandleRequest(conn);",
          "new_line_content": "    conn->inputLen += nread;",
          "content_same": false
        },
        {
          "line": 700,
          "old_api": "taosMemoryMalloc",
          "new_api": null,
          "old_text": "taosMemoryMalloc(udf->bufSize)",
          "new_text": null,
          "old_line_content": "      SUdfInterBuf outBuf = {.buf = taosMemoryMalloc(udf->bufSize), .bufLen = udf->bufSize, .numOfResult = 0};",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 701,
          "old_api": "udfAggStartFunc",
          "new_api": null,
          "old_text": "udf->scriptPlugin->udfAggStartFunc(&outBuf, udf->scriptUdfCtx)",
          "new_text": null,
          "old_line_content": "      code = udf->scriptPlugin->udfAggStartFunc(&outBuf, udf->scriptUdfCtx);",
          "new_line_content": "    case TSDB_UDF_CALL_AGG_INIT: {",
          "content_same": false
        },
        {
          "line": 1218,
          "old_api": "fnInfo",
          "new_api": null,
          "old_text": "fnInfo(\"udfd pipe read EOF\")",
          "new_text": null,
          "old_line_content": "      fnInfo(\"udfd pipe read EOF\");",
          "new_line_content": "  if (nread < 0) {",
          "content_same": false
        },
        {
          "line": 707,
          "old_api": "convertDataBlockToUdfDataBlock",
          "new_api": null,
          "old_text": "convertDataBlockToUdfDataBlock(&call->block, &input)",
          "new_text": null,
          "old_line_content": "      convertDataBlockToUdfDataBlock(&call->block, &input);",
          "new_line_content": "    case TSDB_UDF_CALL_AGG_PROC: {",
          "content_same": false
        },
        {
          "line": 708,
          "old_api": "taosMemoryMalloc",
          "new_api": null,
          "old_text": "taosMemoryMalloc(udf->bufSize)",
          "new_text": null,
          "old_line_content": "      SUdfInterBuf outBuf = {.buf = taosMemoryMalloc(udf->bufSize), .bufLen = udf->bufSize, .numOfResult = 0};",
          "new_line_content": "      SUdfDataBlock input = {0};",
          "content_same": false
        },
        {
          "line": 1228,
          "old_api": "uv_strerror",
          "new_api": null,
          "old_text": "uv_strerror(status)",
          "new_text": null,
          "old_line_content": "    fnError(\"udfd new connection error. code: %s\", uv_strerror(status));",
          "new_line_content": "void udfdOnNewConnection(uv_stream_t *server, int status) {",
          "content_same": false
        },
        {
          "line": 717,
          "old_api": "taosMemoryMalloc",
          "new_api": null,
          "old_text": "taosMemoryMalloc(udf->bufSize)",
          "new_text": null,
          "old_line_content": "      SUdfInterBuf outBuf = {.buf = taosMemoryMalloc(udf->bufSize), .bufLen = udf->bufSize, .numOfResult = 0};",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 718,
          "old_api": "udfAggMergeFunc",
          "new_api": null,
          "old_text": "udf->scriptPlugin->udfAggMergeFunc(&call->interBuf, &call->interBuf2, &outBuf, udf->scriptUdfCtx)",
          "new_text": null,
          "old_line_content": "      code = udf->scriptPlugin->udfAggMergeFunc(&call->interBuf, &call->interBuf2, &outBuf, udf->scriptUdfCtx);",
          "new_line_content": "    case TSDB_UDF_CALL_AGG_MERGE: {",
          "content_same": false
        },
        {
          "line": 1232,
          "old_api": "taosMemoryMalloc",
          "new_api": null,
          "old_text": "taosMemoryMalloc(sizeof(uv_pipe_t))",
          "new_text": null,
          "old_line_content": "  uv_pipe_t *client = (uv_pipe_t *)taosMemoryMalloc(sizeof(uv_pipe_t));",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 1233,
          "old_api": "uv_pipe_init",
          "new_api": null,
          "old_text": "uv_pipe_init(global.loop, client, 0)",
          "new_text": null,
          "old_line_content": "  uv_pipe_init(global.loop, client, 0);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 726,
          "old_api": "taosMemoryMalloc",
          "new_api": null,
          "old_text": "taosMemoryMalloc(udf->bufSize)",
          "new_text": null,
          "old_line_content": "      SUdfInterBuf outBuf = {.buf = taosMemoryMalloc(udf->bufSize), .bufLen = udf->bufSize, .numOfResult = 0};",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 727,
          "old_api": "udfAggFinishFunc",
          "new_api": null,
          "old_text": "udf->scriptPlugin->udfAggFinishFunc(&call->interBuf, &outBuf, udf->scriptUdfCtx)",
          "new_text": null,
          "old_line_content": "      code = udf->scriptPlugin->udfAggFinishFunc(&call->interBuf, &outBuf, udf->scriptUdfCtx);",
          "new_line_content": "    case TSDB_UDF_CALL_AGG_FIN: {",
          "content_same": false
        },
        {
          "line": 1243,
          "old_api": "uv_read_start",
          "new_api": null,
          "old_text": "uv_read_start((uv_stream_t *)client, udfdAllocBuffer, udfdPipeRead)",
          "new_text": null,
          "old_line_content": "    uv_read_start((uv_stream_t *)client, udfdAllocBuffer, udfdPipeRead);",
          "new_line_content": "    client->data = ctx;",
          "content_same": false
        },
        {
          "line": 1250,
          "old_api": "fnInfo",
          "new_api": null,
          "old_text": "fnInfo(\"udfd signal received: %d\\n\", signum)",
          "new_text": null,
          "old_line_content": "  fnInfo(\"udfd signal received: %d\\n\", signum);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 741,
          "old_api": "encodeUdfResponse",
          "new_api": null,
          "old_text": "encodeUdfResponse(NULL, rsp)",
          "new_text": null,
          "old_line_content": "  int32_t len = encodeUdfResponse(NULL, rsp);",
          "new_line_content": "  subRsp->callType = call->callType;",
          "content_same": false
        },
        {
          "line": 1253,
          "old_api": "uv_signal_stop",
          "new_api": null,
          "old_text": "uv_signal_stop(handle)",
          "new_text": null,
          "old_line_content": "  uv_signal_stop(handle);",
          "new_line_content": "  uv_fs_t req;",
          "content_same": false
        },
        {
          "line": 746,
          "old_api": "uv_buf_init",
          "new_api": null,
          "old_text": "uv_buf_init(bufBegin, len)",
          "new_text": null,
          "old_line_content": "  uvUdf->output = uv_buf_init(bufBegin, len);",
          "new_line_content": "  void *buf = bufBegin;",
          "content_same": false
        },
        {
          "line": 1259,
          "old_api": "strcmp",
          "new_api": null,
          "old_text": "strcmp(argv[i], \"-c\")",
          "new_text": null,
          "old_line_content": "    if (strcmp(argv[i], \"-c\") == 0) {",
          "new_line_content": "static int32_t udfdParseArgs(int32_t argc, char *argv[]) {",
          "content_same": false
        },
        {
          "line": 750,
          "old_api": "blockDataFreeRes",
          "new_api": null,
          "old_text": "blockDataFreeRes(&call->block)",
          "new_text": null,
          "old_line_content": "      blockDataFreeRes(&call->block);",
          "new_line_content": "  switch (call->callType) {",
          "content_same": false
        },
        {
          "line": 751,
          "old_api": "blockDataFreeRes",
          "new_api": null,
          "old_text": "blockDataFreeRes(&subRsp->resultData)",
          "new_text": null,
          "old_line_content": "      blockDataFreeRes(&subRsp->resultData);",
          "new_line_content": "    case TSDB_UDF_CALL_SCALA_PROC: {",
          "content_same": false
        },
        {
          "line": 1262,
          "old_api": "printf",
          "new_api": null,
          "old_text": "printf(\"config file path overflow\")",
          "new_text": null,
          "old_line_content": "          printf(\"config file path overflow\");",
          "new_line_content": "      if (i < argc - 1) {",
          "content_same": false
        },
        {
          "line": 1265,
          "old_api": "tstrncpy",
          "new_api": null,
          "old_text": "tstrncpy(configDir, argv[i], PATH_MAX)",
          "new_text": null,
          "old_line_content": "        tstrncpy(configDir, argv[i], PATH_MAX);",
          "new_line_content": "          return -1;",
          "content_same": false
        },
        {
          "line": 755,
          "old_api": "freeUdfInterBuf",
          "new_api": null,
          "old_text": "freeUdfInterBuf(&subRsp->resultBuf)",
          "new_text": null,
          "old_line_content": "      freeUdfInterBuf(&subRsp->resultBuf);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1270,
          "old_api": "strcmp",
          "new_api": null,
          "old_text": "strcmp(argv[i], \"-V\")",
          "new_text": null,
          "old_line_content": "    } else if (strcmp(argv[i], \"-V\") == 0) {",
          "new_line_content": "        return -1;",
          "content_same": false
        },
        {
          "line": 759,
          "old_api": "blockDataFreeRes",
          "new_api": null,
          "old_text": "blockDataFreeRes(&call->block)",
          "new_text": null,
          "old_line_content": "      blockDataFreeRes(&call->block);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 760,
          "old_api": "freeUdfInterBuf",
          "new_api": null,
          "old_text": "freeUdfInterBuf(&subRsp->resultBuf)",
          "new_text": null,
          "old_line_content": "      freeUdfInterBuf(&subRsp->resultBuf);",
          "new_line_content": "    case TSDB_UDF_CALL_AGG_PROC: {",
          "content_same": false
        },
        {
          "line": 764,
          "old_api": "freeUdfInterBuf",
          "new_api": null,
          "old_text": "freeUdfInterBuf(&subRsp->resultBuf)",
          "new_text": null,
          "old_line_content": "      freeUdfInterBuf(&subRsp->resultBuf);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 768,
          "old_api": "freeUdfInterBuf",
          "new_api": null,
          "old_text": "freeUdfInterBuf(&subRsp->resultBuf)",
          "new_text": null,
          "old_line_content": "      freeUdfInterBuf(&subRsp->resultBuf);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1285,
          "old_api": "printf",
          "new_api": null,
          "old_text": "printf(\"%s version: %s compatible_version: %s\\n\", releaseName, version, compatible_version)",
          "new_text": null,
          "old_line_content": "  printf(\"%s version: %s compatible_version: %s\\n\", releaseName, version, compatible_version);",
          "new_line_content": "  char *releaseName = \"community\";",
          "content_same": false
        },
        {
          "line": 1286,
          "old_api": "printf",
          "new_api": null,
          "old_text": "printf(\"gitinfo: %s\\n\", gitinfo)",
          "new_text": null,
          "old_line_content": "  printf(\"gitinfo: %s\\n\", gitinfo);",
          "new_line_content": "#endif",
          "content_same": false
        },
        {
          "line": 775,
          "old_api": "taosMemoryFree",
          "new_api": null,
          "old_text": "taosMemoryFree(uvUdf->input.base)",
          "new_text": null,
          "old_line_content": "  taosMemoryFree(uvUdf->input.base);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 1292,
          "old_api": "snprintf",
          "new_api": null,
          "old_text": "snprintf(logName, sizeof(logName), \"%slog\", \"udfd\")",
          "new_text": null,
          "old_line_content": "  snprintf(logName, sizeof(logName), \"%slog\", \"udfd\");",
          "new_line_content": "static int32_t udfdInitLog() {",
          "content_same": false
        },
        {
          "line": 781,
          "old_api": "fnInfo",
          "new_api": null,
          "old_text": "fnInfo(\"teardown. seq number: %\" PRId64 \", handle:%\" PRIx64, request->seqNum, teardown->udfHandle)",
          "new_text": null,
          "old_line_content": "  fnInfo(\"teardown. seq number: %\" PRId64 \", handle:%\" PRIx64, request->seqNum, teardown->udfHandle);",
          "new_line_content": "void udfdProcessTeardownRequest(SUvUdfWork *uvUdf, SUdfRequest *request) {",
          "content_same": false
        },
        {
          "line": 1293,
          "old_api": "taosCreateLog",
          "new_api": null,
          "old_text": "taosCreateLog(logName, 1, configDir, NULL, NULL, NULL, NULL, 0)",
          "new_text": null,
          "old_line_content": "  return taosCreateLog(logName, 1, configDir, NULL, NULL, NULL, NULL, 0);",
          "new_line_content": "  char logName[12] = {0};",
          "content_same": false
        },
        {
          "line": 1297,
          "old_api": "taosMemoryMalloc",
          "new_api": null,
          "old_text": "taosMemoryMalloc(suggested_size)",
          "new_text": null,
          "old_line_content": "  buf->base = taosMemoryMalloc(suggested_size);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 787,
          "old_api": "uv_mutex_lock",
          "new_api": null,
          "old_text": "uv_mutex_lock(&global.udfsMutex)",
          "new_text": null,
          "old_line_content": "  uv_mutex_lock(&global.udfsMutex);",
          "new_line_content": "  int32_t          code = TSDB_CODE_SUCCESS;",
          "content_same": false
        },
        {
          "line": 791,
          "old_api": "strlen",
          "new_api": null,
          "old_text": "strlen(udf->name)",
          "new_text": null,
          "old_line_content": "    taosHashRemove(global.udfsHash, udf->name, strlen(udf->name));",
          "new_line_content": "  if (udf->refCount == 0 && (!udf->resident || udf->expired)) {",
          "content_same": false
        },
        {
          "line": 1303,
          "old_api": "uv_err_name",
          "new_api": null,
          "old_text": "uv_err_name(nread)",
          "new_text": null,
          "old_line_content": "    fnError(\"udfd ctrl pipe read error. %s\", uv_err_name(nread));",
          "new_line_content": "void udfdCtrlReadCb(uv_stream_t *q, ssize_t nread, const uv_buf_t *buf) {",
          "content_same": false
        },
        {
          "line": 1304,
          "old_api": "taosMemoryFree",
          "new_api": null,
          "old_text": "taosMemoryFree(buf->base)",
          "new_text": null,
          "old_line_content": "    taosMemoryFree(buf->base);",
          "new_line_content": "  if (nread < 0) {",
          "content_same": false
        },
        {
          "line": 796,
          "old_api": "uv_cond_destroy",
          "new_api": null,
          "old_text": "uv_cond_destroy(&udf->condReady)",
          "new_text": null,
          "old_line_content": "    uv_cond_destroy(&udf->condReady);",
          "new_line_content": "  if (unloadUdf) {",
          "content_same": false
        },
        {
          "line": 1309,
          "old_api": "fnError",
          "new_api": null,
          "old_text": "fnError(\"udfd ctrl pipe read %zu bytes\", nread)",
          "new_text": null,
          "old_line_content": "  fnError(\"udfd ctrl pipe read %zu bytes\", nread);",
          "new_line_content": "    return;",
          "content_same": false
        },
        {
          "line": 1310,
          "old_api": "taosMemoryFree",
          "new_api": null,
          "old_text": "taosMemoryFree(buf->base)",
          "new_text": null,
          "old_line_content": "  taosMemoryFree(buf->base);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 1315,
          "old_api": "uv_fs_unlink",
          "new_api": null,
          "old_text": "uv_fs_unlink(global.loop, &req, global.listenPipeName, NULL)",
          "new_text": null,
          "old_line_content": "  int     err = uv_fs_unlink(global.loop, &req, global.listenPipeName, NULL);",
          "new_line_content": "static int32_t removeListeningPipe() {",
          "content_same": false
        },
        {
          "line": 1316,
          "old_api": "uv_fs_req_cleanup",
          "new_api": null,
          "old_text": "uv_fs_req_cleanup(&req)",
          "new_text": null,
          "old_line_content": "  uv_fs_req_cleanup(&req);",
          "new_line_content": "  uv_fs_t req;",
          "content_same": false
        },
        {
          "line": 809,
          "old_api": "encodeUdfResponse",
          "new_api": null,
          "old_text": "encodeUdfResponse(NULL, rsp)",
          "new_text": null,
          "old_line_content": "  int32_t len = encodeUdfResponse(NULL, rsp);",
          "new_line_content": "  rsp->type = request->type;",
          "content_same": false
        },
        {
          "line": 1321,
          "old_api": "taosMemoryMalloc",
          "new_api": null,
          "old_text": "taosMemoryMalloc(sizeof(uv_loop_t))",
          "new_text": null,
          "old_line_content": "  uv_loop_t *loop = taosMemoryMalloc(sizeof(uv_loop_t));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 814,
          "old_api": "uv_buf_init",
          "new_api": null,
          "old_text": "uv_buf_init(bufBegin, len)",
          "new_text": null,
          "old_line_content": "  uvUdf->output = uv_buf_init(bufBegin, len);",
          "new_line_content": "  void *buf = bufBegin;",
          "content_same": false
        },
        {
          "line": 1330,
          "old_api": "uv_pipe_init",
          "new_api": null,
          "old_text": "uv_pipe_init(global.loop, &global.ctrlPipe, 1)",
          "new_text": null,
          "old_line_content": "    uv_pipe_init(global.loop, &global.ctrlPipe, 1);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1331,
          "old_api": "uv_pipe_open",
          "new_api": null,
          "old_text": "uv_pipe_open(&global.ctrlPipe, 0)",
          "new_text": null,
          "old_line_content": "    uv_pipe_open(&global.ctrlPipe, 0);",
          "new_line_content": "  if (tsStartUdfd) {  // udfd is started by taosd, which shall exit when taosd exit",
          "content_same": false
        },
        {
          "line": 823,
          "old_api": "snprintf",
          "new_api": null,
          "old_text": "snprintf(path, PATH_MAX, \"%s%s_%d_%\" PRIx64 \".dll\", global.udfDataDir, udf->name, udf->version, udf->createdTime)",
          "new_text": null,
          "old_line_content": "    snprintf(path, PATH_MAX, \"%s%s_%d_%\" PRIx64 \".dll\", global.udfDataDir, udf->name, udf->version, udf->createdTime);",
          "new_line_content": "  if (udf->scriptType == TSDB_FUNC_SCRIPT_BIN_LIB) {",
          "content_same": false
        },
        {
          "line": 1341,
          "old_api": "uv_signal_start",
          "new_api": null,
          "old_text": "uv_signal_start(&global.intrSignal, udfdIntrSignalHandler, SIGINT)",
          "new_text": null,
          "old_line_content": "  uv_signal_start(&global.intrSignal, udfdIntrSignalHandler, SIGINT);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 830,
          "old_api": "snprintf",
          "new_api": null,
          "old_text": "snprintf(path, PATH_MAX, \"%s%s_%d_%\" PRIx64 \".py\", global.udfDataDir, udf->name, udf->version, udf->createdTime)",
          "new_text": null,
          "old_line_content": "    snprintf(path, PATH_MAX, \"%s%s_%d_%\" PRIx64 \".py\", global.udfDataDir, udf->name, udf->version, udf->createdTime);",
          "new_line_content": "  } else if (udf->scriptType == TSDB_FUNC_SCRIPT_PYTHON) {",
          "content_same": false
        },
        {
          "line": 1344,
          "old_api": "fnInfo",
          "new_api": null,
          "old_text": "fnInfo(\"bind to pipe %s\", global.listenPipeName)",
          "new_text": null,
          "old_line_content": "  fnInfo(\"bind to pipe %s\", global.listenPipeName);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1345,
          "old_api": "uv_pipe_bind",
          "new_api": null,
          "old_text": "uv_pipe_bind(&global.listeningPipe, global.listenPipeName)",
          "new_text": null,
          "old_line_content": "  if ((r = uv_pipe_bind(&global.listeningPipe, global.listenPipeName))) {",
          "new_line_content": "  int r;",
          "content_same": false
        },
        {
          "line": 836,
          "old_api": "snprintf",
          "new_api": null,
          "old_text": "snprintf(path, PATH_MAX, \"%s%s_%d_%\" PRIx64, global.udfDataDir, udf->name, udf->version, udf->createdTime)",
          "new_text": null,
          "old_line_content": "    snprintf(path, PATH_MAX, \"%s%s_%d_%\" PRIx64, global.udfDataDir, udf->name, udf->version, udf->createdTime);",
          "new_line_content": "  } else {",
          "content_same": false
        },
        {
          "line": 1350,
          "old_api": "uv_listen",
          "new_api": null,
          "old_text": "uv_listen((uv_stream_t *)&global.listeningPipe, 128, udfdOnNewConnection)",
          "new_text": null,
          "old_line_content": "  if ((r = uv_listen((uv_stream_t *)&global.listeningPipe, 128, udfdOnNewConnection))) {",
          "new_line_content": "    return -2;",
          "content_same": false
        },
        {
          "line": 1351,
          "old_api": "uv_err_name",
          "new_api": null,
          "old_text": "uv_err_name(r)",
          "new_text": null,
          "old_line_content": "    fnError(\"Listen error %s\", uv_err_name(r));",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 844,
          "old_api": "osDataSpaceAvailable",
          "new_api": null,
          "old_text": "osDataSpaceAvailable()",
          "new_text": null,
          "old_line_content": "  if (!osDataSpaceAvailable()) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1359,
          "old_api": "uv_is_closing",
          "new_api": null,
          "old_text": "uv_is_closing(handle)",
          "new_text": null,
          "old_line_content": "  if (!uv_is_closing(handle)) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1360,
          "old_api": "uv_close",
          "new_api": null,
          "old_text": "uv_close(handle, NULL)",
          "new_text": null,
          "old_line_content": "    uv_close(handle, NULL);",
          "new_line_content": "static void udfdCloseWalkCb(uv_handle_t *handle, void *arg) {",
          "content_same": false
        },
        {
          "line": 851,
          "old_api": "udfdGetFuncBodyPath",
          "new_api": null,
          "old_text": "udfdGetFuncBodyPath(udf, path)",
          "new_text": null,
          "old_line_content": "  udfdGetFuncBodyPath(udf, path);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 852,
          "old_api": "taosStatFile",
          "new_api": null,
          "old_text": "taosStatFile(path, NULL, NULL)",
          "new_text": null,
          "old_line_content": "  bool fileExist = !(taosStatFile(path, NULL, NULL) < 0);",
          "new_line_content": "  char path[PATH_MAX] = {0};",
          "content_same": false
        },
        {
          "line": 1365,
          "old_api": "uv_mutex_init",
          "new_api": null,
          "old_text": "uv_mutex_init(&global.scriptPluginsMutex)",
          "new_text": null,
          "old_line_content": "  uv_mutex_init(&global.scriptPluginsMutex);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 855,
          "old_api": "fnInfo",
          "new_api": null,
          "old_text": "fnInfo(\"udfd func body file. reuse existing file %s\", path)",
          "new_text": null,
          "old_line_content": "    fnInfo(\"udfd func body file. reuse existing file %s\", path);",
          "new_line_content": "  if (fileExist) {",
          "content_same": false
        },
        {
          "line": 1368,
          "old_api": "uv_mutex_init",
          "new_api": null,
          "old_text": "uv_mutex_init(&global.udfsMutex)",
          "new_text": null,
          "old_line_content": "  uv_mutex_init(&global.udfsMutex);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 859,
          "old_api": "taosOpenFile",
          "new_api": null,
          "old_text": "taosOpenFile(path, TD_FILE_CREATE | TD_FILE_WRITE | TD_FILE_READ | TD_FILE_TRUNC)",
          "new_text": null,
          "old_line_content": "  TdFilePtr file = taosOpenFile(path, TD_FILE_CREATE | TD_FILE_WRITE | TD_FILE_READ | TD_FILE_TRUNC);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 1371,
          "old_api": "uv_run",
          "new_api": null,
          "old_text": "uv_run(global.loop, UV_RUN_DEFAULT)",
          "new_text": null,
          "old_line_content": "  uv_run(global.loop, UV_RUN_DEFAULT);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 864,
          "old_api": "taosWriteFile",
          "new_api": null,
          "old_text": "taosWriteFile(file, pFuncInfo->pCode, pFuncInfo->codeSize)",
          "new_text": null,
          "old_line_content": "  int64_t count = taosWriteFile(file, pFuncInfo->pCode, pFuncInfo->codeSize);",
          "new_line_content": "    return TSDB_CODE_FILE_CORRUPTED;",
          "content_same": false
        },
        {
          "line": 1377,
          "old_api": "uv_run",
          "new_api": null,
          "old_text": "uv_run(global.loop, UV_RUN_DEFAULT)",
          "new_text": null,
          "old_line_content": "  uv_run(global.loop, UV_RUN_DEFAULT);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 869,
          "old_api": "taosCloseFile",
          "new_api": null,
          "old_text": "taosCloseFile(&file)",
          "new_text": null,
          "old_line_content": "  taosCloseFile(&file);",
          "new_line_content": "    return TSDB_CODE_FILE_CORRUPTED;",
          "content_same": false
        },
        {
          "line": 1387,
          "old_api": "uv_sleep",
          "new_api": null,
          "old_text": "uv_sleep(100 * (1 << retryMnodeTimes))",
          "new_text": null,
          "old_line_content": "    uv_sleep(100 * (1 << retryMnodeTimes));",
          "new_line_content": "  int32_t code = 0;",
          "content_same": false
        },
        {
          "line": 1388,
          "old_api": "udfdConnectToMnode",
          "new_api": null,
          "old_text": "udfdConnectToMnode()",
          "new_text": null,
          "old_line_content": "    code = udfdConnectToMnode();",
          "new_line_content": "  while (retryMnodeTimes++ <= TSDB_MAX_REPLICA) {",
          "content_same": false
        },
        {
          "line": 879,
          "old_api": "isEpsetEqual",
          "new_api": null,
          "old_text": "isEpsetEqual(&global.mgmtEp.epSet, pEpSet)",
          "new_text": null,
          "old_line_content": "    if (!isEpsetEqual(&global.mgmtEp.epSet, pEpSet)) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 880,
          "old_api": "updateEpSet_s",
          "new_api": null,
          "old_text": "updateEpSet_s(&global.mgmtEp, pEpSet)",
          "new_text": null,
          "old_line_content": "      updateEpSet_s(&global.mgmtEp, pEpSet);",
          "new_line_content": "  if (pEpSet) {",
          "content_same": false
        },
        {
          "line": 1392,
          "old_api": "tstrerror",
          "new_api": null,
          "old_text": "tstrerror(code)",
          "new_text": null,
          "old_line_content": "    fnError(\"udfd can not connect to mnode, code: %s. retry\", tstrerror(code));",
          "new_line_content": "      break;",
          "content_same": false
        },
        {
          "line": 1396,
          "old_api": "fnError",
          "new_api": null,
          "old_text": "fnError(\"udfd can not connect to mnode\")",
          "new_text": null,
          "old_line_content": "    fnError(\"udfd can not connect to mnode\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 885,
          "old_api": "tstrerror",
          "new_api": null,
          "old_text": "tstrerror(pMsg->code)",
          "new_text": null,
          "old_line_content": "    fnError(\"udfd rpc error. code: %s\", tstrerror(pMsg->code));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1401,
          "old_api": "strlen",
          "new_api": null,
          "old_text": "strlen(tsUdfdResFuncs)",
          "new_text": null,
          "old_line_content": "  if (strlen(tsUdfdResFuncs) == 0) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 892,
          "old_api": "tDeserializeSConnectRsp",
          "new_api": null,
          "old_text": "tDeserializeSConnectRsp(pMsg->pCont, pMsg->contLen, &connectRsp)",
          "new_text": null,
          "old_line_content": "    tDeserializeSConnectRsp(pMsg->pCont, pMsg->contLen, &connectRsp);",
          "new_line_content": "  if (msgInfo->rpcType == UDFD_RPC_MNODE_CONNECT) {",
          "content_same": false
        },
        {
          "line": 1405,
          "old_api": "taosArrayInit",
          "new_api": null,
          "old_text": "taosArrayInit(2, TSDB_FUNC_NAME_LEN)",
          "new_text": null,
          "old_line_content": "  global.residentFuncs = taosArrayInit(2, TSDB_FUNC_NAME_LEN);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 895,
          "old_api": "abs",
          "new_api": null,
          "old_text": "abs(now - connectRsp.svrTimestamp)",
          "new_text": null,
          "old_line_content": "    int32_t delta = abs(now - connectRsp.svrTimestamp);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1408,
          "old_api": "strtok_r",
          "new_api": null,
          "old_text": "strtok_r(pSave, \",\", &pSave)",
          "new_text": null,
          "old_line_content": "  while ((token = strtok_r(pSave, \",\", &pSave)) != NULL) {",
          "new_line_content": "  char *pSave = tsUdfdResFuncs;",
          "content_same": false
        },
        {
          "line": 1411,
          "old_api": "fnInfo",
          "new_api": null,
          "old_text": "fnInfo(\"udfd add resident function %s\", func)",
          "new_text": null,
          "old_line_content": "    fnInfo(\"udfd add resident function %s\", func);",
          "new_line_content": "    char func[TSDB_FUNC_NAME_LEN + 1] = {0};",
          "content_same": false
        },
        {
          "line": 906,
          "old_api": "isEpsetEqual",
          "new_api": null,
          "old_text": "isEpsetEqual(&global.mgmtEp.epSet, &connectRsp.epSet)",
          "new_text": null,
          "old_line_content": "    if (connectRsp.dnodeNum > 1 && !isEpsetEqual(&global.mgmtEp.epSet, &connectRsp.epSet)) {",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 907,
          "old_api": "updateEpSet_s",
          "new_api": null,
          "old_text": "updateEpSet_s(&global.mgmtEp, &connectRsp.epSet)",
          "new_text": null,
          "old_line_content": "      updateEpSet_s(&global.mgmtEp, &connectRsp.epSet);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1419,
          "old_api": "taosArrayGetSize",
          "new_api": null,
          "old_text": "taosArrayGetSize(global.residentFuncs)",
          "new_text": null,
          "old_line_content": "  for (int32_t i = 0; i < taosArrayGetSize(global.residentFuncs); ++i) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1420,
          "old_api": "taosArrayGet",
          "new_api": null,
          "old_text": "taosArrayGet(global.residentFuncs, i)",
          "new_text": null,
          "old_line_content": "    char  *funcName = taosArrayGet(global.residentFuncs, i);",
          "new_line_content": "int32_t udfdDeinitResidentFuncs() {",
          "content_same": false
        },
        {
          "line": 912,
          "old_api": "tDeserializeSRetrieveFuncRsp",
          "new_api": null,
          "old_text": "tDeserializeSRetrieveFuncRsp(pMsg->pCont, pMsg->contLen, &retrieveRsp)",
          "new_text": null,
          "old_line_content": "    tDeserializeSRetrieveFuncRsp(pMsg->pCont, pMsg->contLen, &retrieveRsp);",
          "new_line_content": "  } else if (msgInfo->rpcType == UDFD_RPC_RETRIVE_FUNC) {",
          "content_same": false
        },
        {
          "line": 1424,
          "old_api": "udfDestroyFunc",
          "new_api": null,
          "old_text": "udf->scriptPlugin->udfDestroyFunc(udf->scriptUdfCtx)",
          "new_text": null,
          "old_line_content": "      int32_t code = udf->scriptPlugin->udfDestroyFunc(udf->scriptUdfCtx);",
          "new_line_content": "    if (udfInHash) {",
          "content_same": false
        },
        {
          "line": 1425,
          "old_api": "fnDebug",
          "new_api": null,
          "old_text": "fnDebug(\"udfd destroy function returns %d\", code)",
          "new_text": null,
          "old_line_content": "      fnDebug(\"udfd destroy function returns %d\", code);",
          "new_line_content": "      SUdf   *udf = *udfInHash;",
          "content_same": false
        },
        {
          "line": 1430,
          "old_api": "taosArrayDestroy",
          "new_api": null,
          "old_text": "taosArrayDestroy(global.residentFuncs)",
          "new_text": null,
          "old_line_content": "  taosArrayDestroy(global.residentFuncs);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 922,
          "old_api": "taosArrayGet",
          "new_api": null,
          "old_text": "taosArrayGet(retrieveRsp.pFuncExtraInfos, 0)",
          "new_text": null,
          "old_line_content": "    SFuncExtraInfo *pFuncExtraInfo = (SFuncExtraInfo *)taosArrayGet(retrieveRsp.pFuncExtraInfos, 0);",
          "new_line_content": "    udf->bufSize = pFuncInfo->bufSize;",
          "content_same": false
        },
        {
          "line": 1435,
          "old_api": "uv_mutex_destroy",
          "new_api": null,
          "old_text": "uv_mutex_destroy(&global.udfsMutex)",
          "new_text": null,
          "old_line_content": "  uv_mutex_destroy(&global.udfsMutex);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1436,
          "old_api": "taosHashCleanup",
          "new_api": null,
          "old_text": "taosHashCleanup(global.udfsHash)",
          "new_text": null,
          "old_line_content": "  taosHashCleanup(global.udfsHash);",
          "new_line_content": "int32_t udfdCleanup() {",
          "content_same": false
        },
        {
          "line": 925,
          "old_api": "udfdSaveFuncBodyToFile",
          "new_api": null,
          "old_text": "udfdSaveFuncBodyToFile(pFuncInfo, udf)",
          "new_text": null,
          "old_line_content": "    msgInfo->code = udfdSaveFuncBodyToFile(pFuncInfo, udf);",
          "new_line_content": "    udf->version = pFuncExtraInfo->funcVersion;",
          "content_same": false
        },
        {
          "line": 929,
          "old_api": "tFreeSFuncInfo",
          "new_api": null,
          "old_text": "tFreeSFuncInfo(pFuncInfo)",
          "new_text": null,
          "old_line_content": "    tFreeSFuncInfo(pFuncInfo);",
          "new_line_content": "      udf->lastFetchTime = 0;",
          "content_same": false
        },
        {
          "line": 930,
          "old_api": "taosArrayDestroy",
          "new_api": null,
          "old_text": "taosArrayDestroy(retrieveRsp.pFuncInfos)",
          "new_text": null,
          "old_line_content": "    taosArrayDestroy(retrieveRsp.pFuncInfos);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1441,
          "old_api": "snprintf",
          "new_api": null,
          "old_text": "snprintf(global.udfDataDir, PATH_MAX, \"%s/.udf\", tsDataDir)",
          "new_text": null,
          "old_line_content": "  snprintf(global.udfDataDir, PATH_MAX, \"%s/.udf\", tsDataDir);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1442,
          "old_api": "taosMkDir",
          "new_api": null,
          "old_text": "taosMkDir(global.udfDataDir)",
          "new_text": null,
          "old_line_content": "  int32_t code = taosMkDir(global.udfDataDir);",
          "new_line_content": "int32_t udfdCreateUdfSourceDir() {",
          "content_same": false
        },
        {
          "line": 1445,
          "old_api": "taosMkDir",
          "new_api": null,
          "old_text": "taosMkDir(global.udfDataDir)",
          "new_text": null,
          "old_line_content": "    code = taosMkDir(global.udfDataDir);",
          "new_line_content": "  if (code != TSDB_CODE_SUCCESS) {",
          "content_same": false
        },
        {
          "line": 935,
          "old_api": "rpcFreeCont",
          "new_api": null,
          "old_text": "rpcFreeCont(pMsg->pCont)",
          "new_text": null,
          "old_line_content": "  rpcFreeCont(pMsg->pCont);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 936,
          "old_api": "uv_sem_post",
          "new_api": null,
          "old_text": "uv_sem_post(&msgInfo->resultSem)",
          "new_text": null,
          "old_line_content": "  uv_sem_post(&msgInfo->resultSem);",
          "new_line_content": "_return:",
          "content_same": false
        },
        {
          "line": 1453,
          "old_api": "fnInfo",
          "new_api": null,
          "old_text": "fnInfo(\"destory udf source directory %s\", global.udfDataDir)",
          "new_text": null,
          "old_line_content": "  fnInfo(\"destory udf source directory %s\", global.udfDataDir);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1454,
          "old_api": "taosRemoveDir",
          "new_api": null,
          "old_text": "taosRemoveDir(global.udfDataDir)",
          "new_text": null,
          "old_line_content": "  taosRemoveDir(global.udfDataDir);",
          "new_line_content": "int32_t udfdDestroyUdfSourceDir() {",
          "content_same": false
        },
        {
          "line": 943,
          "old_api": "taosArrayInit",
          "new_api": null,
          "old_text": "taosArrayInit(1, TSDB_FUNC_NAME_LEN)",
          "new_text": null,
          "old_line_content": "  retrieveReq.pFuncNames = taosArrayInit(1, TSDB_FUNC_NAME_LEN);",
          "new_line_content": "  SRetrieveFuncReq retrieveReq = {0};",
          "content_same": false
        },
        {
          "line": 944,
          "old_api": "taosArrayPush",
          "new_api": null,
          "old_text": "taosArrayPush(retrieveReq.pFuncNames, udfName)",
          "new_text": null,
          "old_line_content": "  taosArrayPush(retrieveReq.pFuncNames, udfName);",
          "new_line_content": "  retrieveReq.numOfFuncs = 1;",
          "content_same": false
        },
        {
          "line": 947,
          "old_api": "rpcMallocCont",
          "new_api": null,
          "old_text": "rpcMallocCont(contLen)",
          "new_text": null,
          "old_line_content": "  void   *pReq = rpcMallocCont(contLen);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1459,
          "old_api": "taosCheckSystemIsLittleEnd",
          "new_api": null,
          "old_text": "taosCheckSystemIsLittleEnd()",
          "new_text": null,
          "old_line_content": "  if (!taosCheckSystemIsLittleEnd()) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1460,
          "old_api": "printf",
          "new_api": null,
          "old_text": "printf(\"failed to start since on non-little-end machines\\n\")",
          "new_text": null,
          "old_line_content": "    printf(\"failed to start since on non-little-end machines\\n\");",
          "new_line_content": "int main(int argc, char *argv[]) {",
          "content_same": false
        },
        {
          "line": 1464,
          "old_api": "udfdParseArgs",
          "new_api": null,
          "old_text": "udfdParseArgs(argc, argv)",
          "new_text": null,
          "old_line_content": "  if (udfdParseArgs(argc, argv) != 0) {",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 1465,
          "old_api": "printf",
          "new_api": null,
          "old_text": "printf(\"failed to start since parse args error\\n\")",
          "new_text": null,
          "old_line_content": "    printf(\"failed to start since parse args error\\n\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 954,
          "old_api": "uv_sem_init",
          "new_api": null,
          "old_text": "uv_sem_init(&msgInfo->resultSem, 0)",
          "new_text": null,
          "old_line_content": "  uv_sem_init(&msgInfo->resultSem, 0);",
          "new_line_content": "  msgInfo->rpcType = UDFD_RPC_RETRIVE_FUNC;",
          "content_same": false
        },
        {
          "line": 1470,
          "old_api": "udfdPrintVersion",
          "new_api": null,
          "old_text": "udfdPrintVersion()",
          "new_text": null,
          "old_line_content": "    udfdPrintVersion();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 961,
          "old_api": "rpcSendRequest",
          "new_api": null,
          "old_text": "rpcSendRequest(clientRpc, &global.mgmtEp.epSet, &rpcMsg, NULL)",
          "new_text": null,
          "old_line_content": "  rpcSendRequest(clientRpc, &global.mgmtEp.epSet, &rpcMsg, NULL);",
          "new_line_content": "  rpcMsg.msgType = TDMT_MND_RETRIEVE_FUNC;",
          "content_same": false
        },
        {
          "line": 1474,
          "old_api": "udfdInitLog",
          "new_api": null,
          "old_text": "udfdInitLog()",
          "new_text": null,
          "old_line_content": "  if (udfdInitLog() != 0) {",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 964,
          "old_api": "uv_sem_destroy",
          "new_api": null,
          "old_text": "uv_sem_destroy(&msgInfo->resultSem)",
          "new_text": null,
          "old_line_content": "  uv_sem_destroy(&msgInfo->resultSem);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1479,
          "old_api": "taosInitCfg",
          "new_api": null,
          "old_text": "taosInitCfg(configDir, NULL, NULL, NULL, NULL, 0)",
          "new_text": null,
          "old_line_content": "  if (taosInitCfg(configDir, NULL, NULL, NULL, NULL, 0) != 0) {",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 1480,
          "old_api": "fnError",
          "new_api": null,
          "old_text": "fnError(\"failed to start since read config error\")",
          "new_text": null,
          "old_line_content": "    fnError(\"failed to start since read config error\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1484,
          "old_api": "initEpSetFromCfg",
          "new_api": null,
          "old_text": "initEpSetFromCfg(tsFirst, tsSecond, &global.mgmtEp)",
          "new_text": null,
          "old_line_content": "  initEpSetFromCfg(tsFirst, tsSecond, &global.mgmtEp);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 973,
          "old_api": "tstrncpy",
          "new_api": null,
          "old_text": "tstrncpy(connReq.app, \"udfd\", sizeof(connReq.app))",
          "new_text": null,
          "old_line_content": "  tstrncpy(connReq.app, \"udfd\", sizeof(connReq.app));",
          "new_line_content": "  SConnectReq connReq = {0};",
          "content_same": false
        },
        {
          "line": 974,
          "old_api": "tstrncpy",
          "new_api": null,
          "old_text": "tstrncpy(connReq.user, TSDB_DEFAULT_USER, sizeof(connReq.user))",
          "new_text": null,
          "old_line_content": "  tstrncpy(connReq.user, TSDB_DEFAULT_USER, sizeof(connReq.user));",
          "new_line_content": "  connReq.connType = CONN_TYPE__UDFD;",
          "content_same": false
        },
        {
          "line": 1485,
          "old_api": "udfdOpenClientRpc",
          "new_api": null,
          "old_text": "udfdOpenClientRpc()",
          "new_text": null,
          "old_line_content": "  if (udfdOpenClientRpc() != 0) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 977,
          "old_api": "tstrncpy",
          "new_api": null,
          "old_text": "tstrncpy(connReq.passwd, pass, sizeof(connReq.passwd))",
          "new_text": null,
          "old_line_content": "  tstrncpy(connReq.passwd, pass, sizeof(connReq.passwd));",
          "new_line_content": "  char pass[TSDB_PASSWORD_LEN + 1] = {0};",
          "content_same": false
        },
        {
          "line": 1490,
          "old_api": "udfdCreateUdfSourceDir",
          "new_api": null,
          "old_text": "udfdCreateUdfSourceDir()",
          "new_text": null,
          "old_line_content": "  if (udfdCreateUdfSourceDir() != 0) {",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 1491,
          "old_api": "fnError",
          "new_api": null,
          "old_text": "fnError(\"create udf source directory failed\")",
          "new_text": null,
          "old_line_content": "    fnError(\"create udf source directory failed\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 983,
          "old_api": "rpcMallocCont",
          "new_api": null,
          "old_text": "rpcMallocCont(contLen)",
          "new_text": null,
          "old_line_content": "  void   *pReq = rpcMallocCont(contLen);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1495,
          "old_api": "udfdUvInit",
          "new_api": null,
          "old_text": "udfdUvInit()",
          "new_text": null,
          "old_line_content": "  if (udfdUvInit() != 0) {",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 1496,
          "old_api": "fnError",
          "new_api": null,
          "old_text": "fnError(\"uv init failure\")",
          "new_text": null,
          "old_line_content": "    fnError(\"uv init failure\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1500,
          "old_api": "udfdInitResidentFuncs",
          "new_api": null,
          "old_text": "udfdInitResidentFuncs()",
          "new_text": null,
          "old_line_content": "  udfdInitResidentFuncs();",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 1503,
          "old_api": "uv_thread_create",
          "new_api": null,
          "old_text": "uv_thread_create(&mnodeConnectThread, udfdConnectMnodeThreadFunc, NULL)",
          "new_text": null,
          "old_line_content": "  uv_thread_create(&mnodeConnectThread, udfdConnectMnodeThreadFunc, NULL);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 995,
          "old_api": "rpcSendRequest",
          "new_api": null,
          "old_text": "rpcSendRequest(global.clientRpc, &global.mgmtEp.epSet, &rpcMsg, NULL)",
          "new_text": null,
          "old_line_content": "  rpcSendRequest(global.clientRpc, &global.mgmtEp.epSet, &rpcMsg, NULL);",
          "new_line_content": "  rpcMsg.contLen = contLen;",
          "content_same": false
        },
        {
          "line": 1508,
          "old_api": "udfdDestroyUdfSourceDir",
          "new_api": null,
          "old_text": "udfdDestroyUdfSourceDir()",
          "new_text": null,
          "old_line_content": "  udfdDestroyUdfSourceDir();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1000,
          "old_api": "taosMemoryFree",
          "new_api": null,
          "old_text": "taosMemoryFree(msgInfo)",
          "new_text": null,
          "old_line_content": "  taosMemoryFree(msgInfo);",
          "new_line_content": "  int32_t code = msgInfo->code;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 85,
      "total_additions": 164,
      "total_deletions": 163,
      "total_api_changes": 412
    },
    "non_api_changes": {
      "has_non_api_changes": false,
      "evidence": {
        "total_diff_lines": 2,
        "api_related_lines": 412,
        "non_api_lines": 0,
        "non_api_line_numbers": []
      }
    },
    "api_calls_before": 404,
    "api_calls_after": 405,
    "diff_info": {
      "added_lines": 2,
      "removed_lines": 0,
      "total_diff_lines": 14
    }
  }
}