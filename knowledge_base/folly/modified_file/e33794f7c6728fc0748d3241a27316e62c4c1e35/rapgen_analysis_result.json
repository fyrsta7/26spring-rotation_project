{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/folly/modified_file/e33794f7c6728fc0748d3241a27316e62c4c1e35",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/folly/modified_file/e33794f7c6728fc0748d3241a27316e62c4c1e35/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/folly/modified_file/e33794f7c6728fc0748d3241a27316e62c4c1e35/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/folly/modified_file/e33794f7c6728fc0748d3241a27316e62c4c1e35/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": true,
    "api_changes": {
      "replacements": [
        {
          "line": 696,
          "old_api": "size",
          "new_api": "push_back",
          "old_text": "input.size()",
          "new_text": "out.push_back('\\\"')",
          "old_line_content": "  out.reserve(out.size() + input.size() + 2);",
          "new_line_content": "  out.push_back('\\\"');",
          "content_same": false
        },
        {
          "line": 700,
          "old_api": "begin",
          "new_api": "end",
          "old_text": "input.begin()",
          "new_text": "input.end()",
          "old_line_content": "  auto* q = reinterpret_cast<const unsigned char*>(input.begin());",
          "new_line_content": "  auto* e = reinterpret_cast<const unsigned char*>(input.end());",
          "content_same": false
        },
        {
          "line": 730,
          "old_api": "decodeUtf8",
          "new_api": "append",
          "old_text": "decodeUtf8(p, e, opts.skip_invalid_utf8)",
          "new_text": "out.append(\"\\\\u\")",
          "old_line_content": "      char32_t v = decodeUtf8(p, e, opts.skip_invalid_utf8);",
          "new_line_content": "      out.append(\"\\\\u\");",
          "content_same": false
        },
        {
          "line": 731,
          "old_api": "append",
          "new_api": "hexDigit",
          "old_text": "out.append(\"\\\\u\")",
          "new_text": "hexDigit(v >> 12)",
          "old_line_content": "      out.append(\"\\\\u\");",
          "new_line_content": "      out.push_back(hexDigit(v >> 12));",
          "content_same": false
        },
        {
          "line": 749,
          "old_api": "append",
          "new_api": "hexDigit",
          "old_text": "out.append(\"\\\\u00\")",
          "new_text": "hexDigit((*p & 0xf0) >> 4)",
          "old_line_content": "          out.append(\"\\\\u00\");",
          "new_line_content": "          out.push_back(hexDigit((*p & 0xf0) >> 4));",
          "content_same": false
        },
        {
          "line": 771,
          "old_api": "size",
          "new_api": "subpiece",
          "old_text": "jsonC.size()",
          "new_text": "jsonC.subpiece(i)",
          "old_line_content": "  for (size_t i = 0; i < jsonC.size(); ++i) {",
          "new_line_content": "    auto s = jsonC.subpiece(i);",
          "content_same": false
        },
        {
          "line": 790,
          "old_api": "size",
          "new_api": "std::logic_error(\"Invalid JSONC: string is not terminated\")",
          "old_text": "s.size()",
          "new_text": "std::logic_error(\"Invalid JSONC: string is not terminated\")",
          "old_line_content": "          if (UNLIKELY(s.size() == 1)) {",
          "new_line_content": "            throw std::logic_error(\"Invalid JSONC: string is not terminated\");",
          "content_same": false
        },
        {
          "line": 835,
          "old_api": "parseValue",
          "new_api": "skipWhitespace",
          "old_text": "parseValue(in)",
          "new_text": "in.skipWhitespace()",
          "old_line_content": "  auto ret = parseValue(in);",
          "new_line_content": "  in.skipWhitespace();",
          "content_same": false
        },
        {
          "line": 836,
          "old_api": "skipWhitespace",
          "new_api": "size",
          "old_text": "in.skipWhitespace()",
          "new_text": "in.size()",
          "old_line_content": "  in.skipWhitespace();",
          "new_line_content": "  if (in.size() && *in != '\\0') {",
          "content_same": false
        },
        {
          "line": 837,
          "old_api": "size",
          "new_api": "error",
          "old_text": "in.size()",
          "new_text": "in.error(\"parsing didn't consume all input\")",
          "old_line_content": "  if (in.size() && *in != '\\0') {",
          "new_line_content": "    in.error(\"parsing didn't consume all input\");",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 770,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "jsonC.size()",
          "old_line_content": "",
          "new_line_content": "  for (size_t i = 0; i < jsonC.size(); ++i) {",
          "content_same": false
        },
        {
          "line": 774,
          "old_api": null,
          "new_api": "startsWith",
          "old_text": null,
          "new_text": "s.startsWith(\"/*\")",
          "old_line_content": "      case State::None:",
          "new_line_content": "        if (s.startsWith(\"/*\")) {",
          "content_same": false
        },
        {
          "line": 778,
          "old_api": null,
          "new_api": "startsWith",
          "old_text": null,
          "new_text": "s.startsWith(\"//\")",
          "old_line_content": "          continue;",
          "new_line_content": "        } else if (s.startsWith(\"//\")) {",
          "content_same": false
        },
        {
          "line": 785,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "result.push_back(s[0])",
          "old_line_content": "        }",
          "new_line_content": "        result.push_back(s[0]);",
          "content_same": false
        },
        {
          "line": 789,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "s.size()",
          "old_line_content": "        if (s[0] == '\\\\') {",
          "new_line_content": "          if (UNLIKELY(s.size() == 1)) {",
          "content_same": false
        },
        {
          "line": 792,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "result.push_back(s[0])",
          "old_line_content": "          }",
          "new_line_content": "          result.push_back(s[0]);",
          "content_same": false
        },
        {
          "line": 799,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "result.push_back(s[0])",
          "old_line_content": "        }",
          "new_line_content": "        result.push_back(s[0]);",
          "content_same": false
        },
        {
          "line": 802,
          "old_api": null,
          "new_api": "startsWith",
          "old_text": null,
          "new_text": "s.startsWith(\"*/\")",
          "old_line_content": "      case State::InlineComment:",
          "new_line_content": "        if (s.startsWith(\"*/\")) {",
          "content_same": false
        },
        {
          "line": 814,
          "old_api": null,
          "new_api": "std::logic_error(\"Unknown comment state\")",
          "old_text": null,
          "new_text": "std::logic_error(\"Unknown comment state\")",
          "old_line_content": "      default:",
          "new_line_content": "        throw std::logic_error(\"Unknown comment state\");",
          "content_same": false
        },
        {
          "line": 825,
          "old_api": null,
          "new_api": "json::serialization_opts()",
          "old_text": null,
          "new_text": "json::serialization_opts()",
          "old_line_content": "dynamic parseJson(StringPiece range) {",
          "new_line_content": "  return parseJson(range, json::serialization_opts());",
          "content_same": false
        },
        {
          "line": 698,
          "old_api": null,
          "new_api": "begin",
          "old_text": null,
          "new_text": "input.begin()",
          "old_line_content": "",
          "new_line_content": "  auto* p = reinterpret_cast<const unsigned char*>(input.begin());",
          "content_same": false
        },
        {
          "line": 834,
          "old_api": null,
          "new_api": "parseValue",
          "old_text": null,
          "new_text": "parseValue(in)",
          "old_line_content": "",
          "new_line_content": "  auto ret = parseValue(in);",
          "content_same": false
        },
        {
          "line": 712,
          "old_api": null,
          "new_api": "CHECK",
          "old_text": null,
          "new_text": "CHECK(q >= p)",
          "old_line_content": "      // as the encoding progresses, q will stay at or ahead of p",
          "new_line_content": "      CHECK(q >= p);",
          "content_same": false
        },
        {
          "line": 843,
          "old_api": null,
          "new_api": "json::serialization_opts()",
          "old_text": null,
          "new_text": "json::serialization_opts()",
          "old_line_content": "std::string toJson(dynamic const& dyn) {",
          "new_line_content": "  return json::serialize(dyn, json::serialization_opts());",
          "content_same": false
        },
        {
          "line": 718,
          "old_api": null,
          "new_api": "decodeUtf8",
          "old_text": null,
          "new_text": "decodeUtf8(q, e, opts.skip_invalid_utf8)",
          "old_line_content": "        // checking that utf8 encodings are valid",
          "new_line_content": "        char32_t v = decodeUtf8(q, e, opts.skip_invalid_utf8);",
          "content_same": false
        },
        {
          "line": 720,
          "old_api": null,
          "new_api": "append",
          "old_text": null,
          "new_text": "out.append(u8\"\\ufffd\")",
          "old_line_content": "        if (opts.skip_invalid_utf8 && v == U'\\ufffd') {",
          "new_line_content": "          out.append(u8\"\\ufffd\");",
          "content_same": false
        },
        {
          "line": 849,
          "old_api": null,
          "new_api": "json::serialize(dyn, opts)",
          "old_text": null,
          "new_text": "json::serialize(dyn, opts)",
          "old_line_content": "  opts.pretty_formatting = true;",
          "new_line_content": "  return json::serialize(dyn, opts);",
          "content_same": false
        },
        {
          "line": 729,
          "old_api": null,
          "new_api": "decodeUtf8",
          "old_text": null,
          "new_text": "decodeUtf8(p, e, opts.skip_invalid_utf8)",
          "old_line_content": "      // with value > 127, so size > 1 byte",
          "new_line_content": "      char32_t v = decodeUtf8(p, e, opts.skip_invalid_utf8);",
          "content_same": false
        },
        {
          "line": 861,
          "old_api": null,
          "new_api": "json::serialize(*this, opts)",
          "old_text": null,
          "new_text": "json::serialize(*this, opts)",
          "old_line_content": "  opts.allow_nan_inf = true;",
          "new_line_content": "  out << json::serialize(*this, opts);",
          "content_same": false
        },
        {
          "line": 736,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "out.push_back('\\\\')",
          "old_line_content": "    } else if (*p == '\\\\' || *p == '\\\"') {",
          "new_line_content": "      out.push_back('\\\\');",
          "content_same": false
        },
        {
          "line": 740,
          "old_api": null,
          "new_api": "append",
          "old_text": null,
          "new_text": "out.append(\"\\\\b\")",
          "old_line_content": "      switch (*p) {",
          "new_line_content": "        case '\\b': out.append(\"\\\\b\"); p++; break;",
          "content_same": false
        },
        {
          "line": 870,
          "old_api": null,
          "new_api": "json::serialize(dyn, opts)",
          "old_text": null,
          "new_text": "json::serialize(dyn, opts)",
          "old_line_content": "  opts.sort_keys = true;",
          "new_line_content": "  *os << json::serialize(dyn, opts);",
          "content_same": false
        },
        {
          "line": 748,
          "old_api": null,
          "new_api": "append",
          "old_text": null,
          "new_text": "out.append(\"\\\\u00\")",
          "old_line_content": "          // with value < 32, so size = 1 byte (e.g control chars).",
          "new_line_content": "          out.append(\"\\\\u00\");",
          "content_same": false
        },
        {
          "line": 754,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "out.push_back(*p++)",
          "old_line_content": "    } else {",
          "new_line_content": "      out.push_back(*p++);",
          "content_same": false
        },
        {
          "line": 758,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "out.push_back('\\\"')",
          "old_line_content": "",
          "new_line_content": "  out.push_back('\\\"');",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 772,
          "old_api": "subpiece",
          "new_api": null,
          "old_text": "jsonC.subpiece(i)",
          "new_text": null,
          "old_line_content": "    auto s = jsonC.subpiece(i);",
          "new_line_content": "    switch (state) {",
          "content_same": false
        },
        {
          "line": 775,
          "old_api": "startsWith",
          "new_api": null,
          "old_text": "s.startsWith(\"/*\")",
          "new_text": null,
          "old_line_content": "        if (s.startsWith(\"/*\")) {",
          "new_line_content": "          state = State::InlineComment;",
          "content_same": false
        },
        {
          "line": 779,
          "old_api": "startsWith",
          "new_api": null,
          "old_text": "s.startsWith(\"//\")",
          "new_text": null,
          "old_line_content": "        } else if (s.startsWith(\"//\")) {",
          "new_line_content": "          state = State::LineComment;",
          "content_same": false
        },
        {
          "line": 786,
          "old_api": "push_back",
          "new_api": null,
          "old_text": "result.push_back(s[0])",
          "new_text": null,
          "old_line_content": "        result.push_back(s[0]);",
          "new_line_content": "        break;",
          "content_same": false
        },
        {
          "line": 791,
          "old_api": "std::logic_error(\"Invalid JSONC: string is not terminated\")",
          "new_api": null,
          "old_text": "std::logic_error(\"Invalid JSONC: string is not terminated\")",
          "new_text": null,
          "old_line_content": "            throw std::logic_error(\"Invalid JSONC: string is not terminated\");",
          "new_line_content": "          }",
          "content_same": false
        },
        {
          "line": 794,
          "old_api": "push_back",
          "new_api": null,
          "old_text": "result.push_back(s[1])",
          "new_text": null,
          "old_line_content": "          result.push_back(s[1]);",
          "new_line_content": "          ++i;",
          "content_same": false
        },
        {
          "line": 800,
          "old_api": "push_back",
          "new_api": null,
          "old_text": "result.push_back(s[0])",
          "new_text": null,
          "old_line_content": "        result.push_back(s[0]);",
          "new_line_content": "        break;",
          "content_same": false
        },
        {
          "line": 803,
          "old_api": "startsWith",
          "new_api": null,
          "old_text": "s.startsWith(\"*/\")",
          "new_text": null,
          "old_line_content": "        if (s.startsWith(\"*/\")) {",
          "new_line_content": "          state = State::None;",
          "content_same": false
        },
        {
          "line": 815,
          "old_api": "std::logic_error(\"Unknown comment state\")",
          "new_api": null,
          "old_text": "std::logic_error(\"Unknown comment state\")",
          "new_text": null,
          "old_line_content": "        throw std::logic_error(\"Unknown comment state\");",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 697,
          "old_api": "push_back",
          "new_api": null,
          "old_text": "out.push_back('\\\"')",
          "new_text": null,
          "old_line_content": "  out.push_back('\\\"');",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 826,
          "old_api": "json::serialization_opts()",
          "new_api": null,
          "old_text": "json::serialization_opts()",
          "new_text": null,
          "old_line_content": "  return parseJson(range, json::serialization_opts());",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 701,
          "old_api": "end",
          "new_api": null,
          "old_text": "input.end()",
          "new_text": null,
          "old_line_content": "  auto* e = reinterpret_cast<const unsigned char*>(input.end());",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 838,
          "old_api": "error",
          "new_api": null,
          "old_text": "in.error(\"parsing didn't consume all input\")",
          "new_text": null,
          "old_line_content": "    in.error(\"parsing didn't consume all input\");",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 713,
          "old_api": "CHECK",
          "new_api": null,
          "old_text": "CHECK(q >= p)",
          "new_text": null,
          "old_line_content": "      CHECK(q >= p);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 844,
          "old_api": "json::serialization_opts()",
          "new_api": null,
          "old_text": "json::serialization_opts()",
          "new_text": null,
          "old_line_content": "  return json::serialize(dyn, json::serialization_opts());",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 719,
          "old_api": "decodeUtf8",
          "new_api": null,
          "old_text": "decodeUtf8(q, e, opts.skip_invalid_utf8)",
          "new_text": null,
          "old_line_content": "        char32_t v = decodeUtf8(q, e, opts.skip_invalid_utf8);",
          "new_line_content": "        if (opts.skip_invalid_utf8 && v == U'\\ufffd') {",
          "content_same": false
        },
        {
          "line": 721,
          "old_api": "append",
          "new_api": null,
          "old_text": "out.append(u8\"\\ufffd\")",
          "new_text": null,
          "old_line_content": "          out.append(u8\"\\ufffd\");",
          "new_line_content": "          p = q;",
          "content_same": false
        },
        {
          "line": 850,
          "old_api": "json::serialize(dyn, opts)",
          "new_api": null,
          "old_text": "json::serialize(dyn, opts)",
          "new_text": null,
          "old_line_content": "  return json::serialize(dyn, opts);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 862,
          "old_api": "json::serialize(*this, opts)",
          "new_api": null,
          "old_text": "json::serialize(*this, opts)",
          "new_text": null,
          "old_line_content": "  out << json::serialize(*this, opts);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 735,
          "old_api": "hexDigit",
          "new_api": null,
          "old_text": "hexDigit(v & 0x0f)",
          "new_text": null,
          "old_line_content": "      out.push_back(hexDigit(v & 0x0f));",
          "new_line_content": "    } else if (*p == '\\\\' || *p == '\\\"') {",
          "content_same": false
        },
        {
          "line": 738,
          "old_api": "push_back",
          "new_api": null,
          "old_text": "out.push_back(*p++)",
          "new_text": null,
          "old_line_content": "      out.push_back(*p++);",
          "new_line_content": "    } else if (*p <= 0x1f) {",
          "content_same": false
        },
        {
          "line": 871,
          "old_api": "json::serialize(dyn, opts)",
          "new_api": null,
          "old_text": "json::serialize(dyn, opts)",
          "new_text": null,
          "old_line_content": "  *os << json::serialize(dyn, opts);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 745,
          "old_api": "append",
          "new_api": null,
          "old_text": "out.append(\"\\\\t\")",
          "new_text": null,
          "old_line_content": "        case '\\t': out.append(\"\\\\t\"); p++; break;",
          "new_line_content": "        default:",
          "content_same": false
        },
        {
          "line": 751,
          "old_api": "hexDigit",
          "new_api": null,
          "old_text": "hexDigit(*p & 0xf)",
          "new_text": null,
          "old_line_content": "          out.push_back(hexDigit(*p & 0xf));",
          "new_line_content": "          p++;",
          "content_same": false
        },
        {
          "line": 755,
          "old_api": "push_back",
          "new_api": null,
          "old_text": "out.push_back(*p++)",
          "new_text": null,
          "old_line_content": "      out.push_back(*p++);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 759,
          "old_api": "push_back",
          "new_api": null,
          "old_text": "out.push_back('\\\"')",
          "new_text": null,
          "old_line_content": "  out.push_back('\\\"');",
          "new_line_content": "}",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 10,
      "total_additions": 25,
      "total_deletions": 26,
      "total_api_changes": 61
    },
    "non_api_changes": {
      "has_non_api_changes": false,
      "evidence": {
        "total_diff_lines": 1,
        "api_related_lines": 61,
        "non_api_lines": 0,
        "non_api_line_numbers": []
      }
    },
    "api_calls_before": 291,
    "api_calls_after": 288,
    "diff_info": {
      "added_lines": 0,
      "removed_lines": 1,
      "total_diff_lines": 13
    }
  }
}