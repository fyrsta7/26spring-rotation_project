{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/openssl/modified_file/ea5817854cf67b89c874101f209f06ae016fd333",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/openssl/modified_file/ea5817854cf67b89c874101f209f06ae016fd333/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/openssl/modified_file/ea5817854cf67b89c874101f209f06ae016fd333/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/openssl/modified_file/ea5817854cf67b89c874101f209f06ae016fd333/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 362,
          "old_api": "sigdelset",
          "new_api": "sigfillset",
          "old_text": "sigdelset(&all_masked, SIGILL)",
          "new_text": "sigfillset(&all_masked)",
          "old_line_content": "    sigdelset(&all_masked, SIGILL);",
          "new_line_content": "    sigfillset(&all_masked);",
          "content_same": false
        },
        {
          "line": 373,
          "old_api": "sigaction",
          "new_api": "sigprocmask",
          "old_text": "sigaction(SIGILL, &ill_act, &ill_oact)",
          "new_text": "sigprocmask(SIG_SETMASK, &ill_act.sa_mask, &oset)",
          "old_line_content": "    sigaction(SIGILL, &ill_act, &ill_oact);",
          "new_line_content": "    sigprocmask(SIG_SETMASK, &ill_act.sa_mask, &oset);",
          "content_same": false
        },
        {
          "line": 407,
          "old_api": "sigprocmask",
          "new_api": "sigaction",
          "old_text": "sigprocmask(SIG_SETMASK, &oset, NULL)",
          "new_text": "sigaction(SIGILL, &ill_oact, NULL)",
          "old_line_content": "    sigprocmask(SIG_SETMASK, &oset, NULL);",
          "new_line_content": "    sigaction(SIGILL, &ill_oact, NULL);",
          "content_same": false
        },
        {
          "line": 424,
          "old_api": "MIDR_IMPLEMENTER",
          "new_api": "MIDR_IS_CPU_MODEL",
          "old_text": "MIDR_IMPLEMENTER(OPENSSL_arm_midr)",
          "new_text": "MIDR_IS_CPU_MODEL(OPENSSL_arm_midr, ARM_CPU_IMP_ARM, ARM_CPU_PART_V2)",
          "old_line_content": "         MIDR_IMPLEMENTER(OPENSSL_arm_midr) == ARM_CPU_IMP_AMPERE) &&",
          "new_line_content": "         MIDR_IS_CPU_MODEL(OPENSSL_arm_midr, ARM_CPU_IMP_ARM, ARM_CPU_PART_V2) ||",
          "content_same": false
        },
        {
          "line": 429,
          "old_api": "MIDR_IMPLEMENTER",
          "new_api": "MIDR_IS_CPU_MODEL",
          "old_text": "MIDR_IMPLEMENTER(OPENSSL_arm_midr)",
          "new_text": "MIDR_IS_CPU_MODEL(OPENSSL_arm_midr, ARM_CPU_IMP_ARM, ARM_CPU_PART_V2)",
          "old_line_content": "         MIDR_IMPLEMENTER(OPENSSL_arm_midr) == ARM_CPU_IMP_AMPERE) &&",
          "new_line_content": "         MIDR_IS_CPU_MODEL(OPENSSL_arm_midr, ARM_CPU_IMP_ARM, ARM_CPU_PART_V2) ||",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 386,
          "old_api": null,
          "new_api": "arm_probe_for",
          "old_text": null,
          "new_text": "arm_probe_for(_armv8_sha256_probe, ARMV8_SHA256)",
          "old_line_content": "",
          "new_line_content": "        OPENSSL_armcap_P |= arm_probe_for(_armv8_sha256_probe, ARMV8_SHA256);",
          "content_same": false
        },
        {
          "line": 392,
          "old_api": null,
          "new_api": "arm_probe_for",
          "old_text": null,
          "new_text": "arm_probe_for(_armv8_eor3_probe, ARMV8_SHA3)",
          "old_line_content": "#  endif",
          "new_line_content": "        OPENSSL_armcap_P |= arm_probe_for(_armv8_eor3_probe, ARMV8_SHA3);",
          "content_same": false
        },
        {
          "line": 398,
          "old_api": null,
          "new_api": "arm_probe_for",
          "old_text": null,
          "new_text": "arm_probe_for(_armv8_rng_probe, ARMV8_RNG)",
          "old_line_content": "#  endif",
          "new_line_content": "    OPENSSL_armcap_P |= arm_probe_for(_armv8_rng_probe, ARMV8_RNG);",
          "content_same": false
        },
        {
          "line": 408,
          "old_api": null,
          "new_api": "sigprocmask",
          "old_text": null,
          "new_text": "sigprocmask(SIG_SETMASK, &oset, NULL)",
          "old_line_content": "",
          "new_line_content": "    sigprocmask(SIG_SETMASK, &oset, NULL);",
          "content_same": false
        },
        {
          "line": 414,
          "old_api": null,
          "new_api": "_armv8_cpuid_probe",
          "old_text": null,
          "new_text": "_armv8_cpuid_probe()",
          "old_line_content": "",
          "new_line_content": "        OPENSSL_arm_midr = _armv8_cpuid_probe();",
          "content_same": false
        },
        {
          "line": 417,
          "old_api": null,
          "new_api": "MIDR_IS_CPU_MODEL",
          "old_text": null,
          "new_text": "MIDR_IS_CPU_MODEL(OPENSSL_arm_midr, ARM_CPU_IMP_ARM, ARM_CPU_PART_N1)",
          "old_line_content": "        (OPENSSL_armcap_P & ARMV7_NEON)) {",
          "new_line_content": "         MIDR_IS_CPU_MODEL(OPENSSL_arm_midr, ARM_CPU_IMP_ARM, ARM_CPU_PART_N1)) &&",
          "content_same": false
        },
        {
          "line": 425,
          "old_api": null,
          "new_api": "MIDR_IMPLEMENTER",
          "old_text": null,
          "new_text": "MIDR_IMPLEMENTER(OPENSSL_arm_midr)",
          "old_line_content": "        (OPENSSL_armcap_P & ARMV8_SHA3))",
          "new_line_content": "         MIDR_IMPLEMENTER(OPENSSL_arm_midr) == ARM_CPU_IMP_AMPERE) &&",
          "content_same": false
        },
        {
          "line": 430,
          "old_api": null,
          "new_api": "MIDR_IMPLEMENTER",
          "old_text": null,
          "new_text": "MIDR_IMPLEMENTER(OPENSSL_arm_midr)",
          "old_line_content": "        (OPENSSL_armcap_P & ARMV8_SHA3))",
          "new_line_content": "         MIDR_IMPLEMENTER(OPENSSL_arm_midr) == ARM_CPU_IMP_AMPERE) &&",
          "content_same": false
        },
        {
          "line": 304,
          "old_api": null,
          "new_api": "strncmp",
          "old_text": null,
          "new_text": "strncmp(uarch, \"Apple M4\", 8)",
          "old_line_content": "                OPENSSL_armcap_P |= ARMV8_UNROLL8_EOR3;",
          "new_line_content": "                (strncmp(uarch, \"Apple M4\", 8) == 0))) {",
          "content_same": false
        },
        {
          "line": 315,
          "old_api": null,
          "new_api": "getauxval",
          "old_text": null,
          "new_text": "getauxval(OSSL_HWCAP_CE)",
          "old_line_content": "",
          "new_line_content": "        unsigned long hwcap = getauxval(OSSL_HWCAP_CE);",
          "content_same": false
        },
        {
          "line": 444,
          "old_api": null,
          "new_api": "MIDR_IS_CPU_MODEL",
          "old_text": null,
          "new_text": "MIDR_IS_CPU_MODEL(OPENSSL_arm_midr, ARM_CPU_IMP_APPLE, APPLE_CPU_PART_M2_BLIZZARD_MAX)",
          "old_line_content": "        (OPENSSL_armcap_P & ARMV8_SHA3))",
          "new_line_content": "         MIDR_IS_CPU_MODEL(OPENSSL_arm_midr, ARM_CPU_IMP_APPLE, APPLE_CPU_PART_M2_BLIZZARD_MAX)) &&",
          "content_same": false
        },
        {
          "line": 348,
          "old_api": null,
          "new_api": "getauxval",
          "old_text": null,
          "new_text": "getauxval(OSSL_HWCAP)",
          "old_line_content": "            OPENSSL_armcap_P |= ARMV8_SVE;",
          "new_line_content": "        if (getauxval(OSSL_HWCAP) & OSSL_HWCAP_SVE)",
          "content_same": false
        },
        {
          "line": 351,
          "old_api": null,
          "new_api": "getauxval",
          "old_text": null,
          "new_text": "getauxval(OSSL_HWCAP2)",
          "old_line_content": "            OPENSSL_armcap_P |= ARMV8_SVE2;",
          "new_line_content": "        if (getauxval(OSSL_HWCAP2) & OSSL_HWCAP2_SVE2)",
          "content_same": false
        },
        {
          "line": 354,
          "old_api": null,
          "new_api": "getauxval",
          "old_text": null,
          "new_text": "getauxval(OSSL_HWCAP2)",
          "old_line_content": "            OPENSSL_armcap_P |= ARMV8_RNG;",
          "new_line_content": "        if (getauxval(OSSL_HWCAP2) & OSSL_HWCAP2_RNG)",
          "content_same": false
        },
        {
          "line": 367,
          "old_api": null,
          "new_api": "sigdelset",
          "old_text": null,
          "new_text": "sigdelset(&all_masked, SIGSEGV)",
          "old_line_content": "",
          "new_line_content": "    sigdelset(&all_masked, SIGSEGV);",
          "content_same": false
        },
        {
          "line": 369,
          "old_api": null,
          "new_api": "memset",
          "old_text": null,
          "new_text": "memset(&ill_act, 0, sizeof(ill_act))",
          "old_line_content": "    ill_act.sa_handler = ill_handler;",
          "new_line_content": "    memset(&ill_act, 0, sizeof(ill_act));",
          "content_same": false
        },
        {
          "line": 374,
          "old_api": null,
          "new_api": "sigaction",
          "old_text": null,
          "new_text": "sigaction(SIGILL, &ill_act, &ill_oact)",
          "old_line_content": "",
          "new_line_content": "    sigaction(SIGILL, &ill_act, &ill_oact);",
          "content_same": false
        },
        {
          "line": 376,
          "old_api": null,
          "new_api": "arm_probe_for",
          "old_text": null,
          "new_text": "arm_probe_for(_armv7_neon_probe, ARMV7_NEON)",
          "old_line_content": "",
          "new_line_content": "    OPENSSL_armcap_P |= arm_probe_for(_armv7_neon_probe, ARMV7_NEON);",
          "content_same": false
        },
        {
          "line": 380,
          "old_api": null,
          "new_api": "arm_probe_for",
          "old_text": null,
          "new_text": "arm_probe_for(_armv8_pmull_probe, ARMV8_PMULL | ARMV8_AES)",
          "old_line_content": "        if (!(OPENSSL_armcap_P & ARMV8_AES)) {",
          "new_line_content": "        OPENSSL_armcap_P |= arm_probe_for(_armv8_pmull_probe, ARMV8_PMULL | ARMV8_AES);",
          "content_same": false
        },
        {
          "line": 382,
          "old_api": null,
          "new_api": "arm_probe_for",
          "old_text": null,
          "new_text": "arm_probe_for(_armv8_aes_probe, ARMV8_AES)",
          "old_line_content": "        }",
          "new_line_content": "            OPENSSL_armcap_P |= arm_probe_for(_armv8_aes_probe, ARMV8_AES);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 384,
          "old_api": "arm_probe_for",
          "new_api": null,
          "old_text": "arm_probe_for(_armv8_sha1_probe, ARMV8_SHA1)",
          "new_text": null,
          "old_line_content": "        OPENSSL_armcap_P |= arm_probe_for(_armv8_sha1_probe, ARMV8_SHA1);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 388,
          "old_api": "arm_probe_for",
          "new_api": null,
          "old_text": "arm_probe_for(_armv8_sm3_probe, ARMV8_SM3)",
          "new_text": null,
          "old_line_content": "        OPENSSL_armcap_P |= arm_probe_for(_armv8_sm3_probe, ARMV8_SM3);",
          "new_line_content": "#  if defined(__aarch64__)",
          "content_same": false
        },
        {
          "line": 395,
          "old_api": "arm_probe_for",
          "new_api": null,
          "old_text": "arm_probe_for(_armv8_sve_probe, ARMV8_SVE)",
          "new_text": null,
          "old_line_content": "    OPENSSL_armcap_P |= arm_probe_for(_armv8_sve_probe, ARMV8_SVE);",
          "new_line_content": "#  ifdef __aarch64__",
          "content_same": false
        },
        {
          "line": 406,
          "old_api": "sigaction",
          "new_api": null,
          "old_text": "sigaction(SIGILL, &ill_oact, NULL)",
          "new_text": null,
          "old_line_content": "    sigaction(SIGILL, &ill_oact, NULL);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 413,
          "old_api": "_armv8_cpuid_probe",
          "new_api": null,
          "old_text": "_armv8_cpuid_probe()",
          "new_text": null,
          "old_line_content": "        OPENSSL_arm_midr = _armv8_cpuid_probe();",
          "new_line_content": "    if (OPENSSL_armcap_P & ARMV8_CPUID)",
          "content_same": false
        },
        {
          "line": 415,
          "old_api": "MIDR_IS_CPU_MODEL",
          "new_api": null,
          "old_text": "MIDR_IS_CPU_MODEL(OPENSSL_arm_midr, ARM_CPU_IMP_ARM, ARM_CPU_PART_CORTEX_A72)",
          "new_text": null,
          "old_line_content": "    if ((MIDR_IS_CPU_MODEL(OPENSSL_arm_midr, ARM_CPU_IMP_ARM, ARM_CPU_PART_CORTEX_A72) ||",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 420,
          "old_api": "MIDR_IS_CPU_MODEL",
          "new_api": null,
          "old_text": "MIDR_IS_CPU_MODEL(OPENSSL_arm_midr, ARM_CPU_IMP_ARM, ARM_CPU_PART_V1)",
          "new_text": null,
          "old_line_content": "    if ((MIDR_IS_CPU_MODEL(OPENSSL_arm_midr, ARM_CPU_IMP_ARM, ARM_CPU_PART_V1) ||",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 427,
          "old_api": "MIDR_IS_CPU_MODEL",
          "new_api": null,
          "old_text": "MIDR_IS_CPU_MODEL(OPENSSL_arm_midr, ARM_CPU_IMP_ARM, ARM_CPU_PART_V1)",
          "new_text": null,
          "old_line_content": "    if ((MIDR_IS_CPU_MODEL(OPENSSL_arm_midr, ARM_CPU_IMP_ARM, ARM_CPU_PART_V1) ||",
          "new_line_content": "        OPENSSL_armcap_P |= ARMV8_UNROLL8_EOR3;",
          "content_same": false
        },
        {
          "line": 432,
          "old_api": "MIDR_IS_CPU_MODEL",
          "new_api": null,
          "old_text": "MIDR_IS_CPU_MODEL(OPENSSL_arm_midr, ARM_CPU_IMP_APPLE, APPLE_CPU_PART_M1_FIRESTORM)",
          "new_text": null,
          "old_line_content": "    if ((MIDR_IS_CPU_MODEL(OPENSSL_arm_midr, ARM_CPU_IMP_APPLE, APPLE_CPU_PART_M1_FIRESTORM)     ||",
          "new_line_content": "        OPENSSL_armcap_P |= ARMV8_UNROLL12_EOR3;",
          "content_same": false
        },
        {
          "line": 313,
          "old_api": "getauxval",
          "new_api": null,
          "old_text": "getauxval(OSSL_HWCAP)",
          "new_text": null,
          "old_line_content": "    if (getauxval(OSSL_HWCAP) & OSSL_HWCAP_NEON) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 347,
          "old_api": "getauxval",
          "new_api": null,
          "old_text": "getauxval(OSSL_HWCAP)",
          "new_text": null,
          "old_line_content": "        if (getauxval(OSSL_HWCAP) & OSSL_HWCAP_SVE)",
          "new_line_content": "#  ifdef __aarch64__",
          "content_same": false
        },
        {
          "line": 350,
          "old_api": "getauxval",
          "new_api": null,
          "old_text": "getauxval(OSSL_HWCAP2)",
          "new_text": null,
          "old_line_content": "        if (getauxval(OSSL_HWCAP2) & OSSL_HWCAP2_SVE2)",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 353,
          "old_api": "getauxval",
          "new_api": null,
          "old_text": "getauxval(OSSL_HWCAP2)",
          "new_text": null,
          "old_line_content": "        if (getauxval(OSSL_HWCAP2) & OSSL_HWCAP2_RNG)",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 361,
          "old_api": "sigfillset",
          "new_api": null,
          "old_text": "sigfillset(&all_masked)",
          "new_text": null,
          "old_line_content": "    sigfillset(&all_masked);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 368,
          "old_api": "memset",
          "new_api": null,
          "old_text": "memset(&ill_act, 0, sizeof(ill_act))",
          "new_text": null,
          "old_line_content": "    memset(&ill_act, 0, sizeof(ill_act));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 372,
          "old_api": "sigprocmask",
          "new_api": null,
          "old_text": "sigprocmask(SIG_SETMASK, &ill_act.sa_mask, &oset)",
          "new_text": null,
          "old_line_content": "    sigprocmask(SIG_SETMASK, &ill_act.sa_mask, &oset);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 375,
          "old_api": "arm_probe_for",
          "new_api": null,
          "old_text": "arm_probe_for(_armv7_neon_probe, ARMV7_NEON)",
          "new_text": null,
          "old_line_content": "    OPENSSL_armcap_P |= arm_probe_for(_armv7_neon_probe, ARMV7_NEON);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 379,
          "old_api": "arm_probe_for",
          "new_api": null,
          "old_text": "arm_probe_for(_armv8_pmull_probe, ARMV8_PMULL | ARMV8_AES)",
          "new_text": null,
          "old_line_content": "        OPENSSL_armcap_P |= arm_probe_for(_armv8_pmull_probe, ARMV8_PMULL | ARMV8_AES);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 381,
          "old_api": "arm_probe_for",
          "new_api": null,
          "old_text": "arm_probe_for(_armv8_aes_probe, ARMV8_AES)",
          "new_text": null,
          "old_line_content": "            OPENSSL_armcap_P |= arm_probe_for(_armv8_aes_probe, ARMV8_AES);",
          "new_line_content": "        if (!(OPENSSL_armcap_P & ARMV8_AES)) {",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 5,
      "total_additions": 20,
      "total_deletions": 19,
      "total_api_changes": 44
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 2,
        "api_related_lines": 44,
        "non_api_lines": 1,
        "non_api_line_numbers": [
          303
        ]
      }
    },
    "api_calls_before": 70,
    "api_calls_after": 71,
    "diff_info": {
      "added_lines": 2,
      "removed_lines": 1,
      "total_diff_lines": 15
    }
  }
}