{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/openssl/modified_file/d5d007abe357ce4bea5390bf3a872dc85497da38",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/openssl/modified_file/d5d007abe357ce4bea5390bf3a872dc85497da38/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/openssl/modified_file/d5d007abe357ce4bea5390bf3a872dc85497da38/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/openssl/modified_file/d5d007abe357ce4bea5390bf3a872dc85497da38/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 466,
          "old_api": "sprintf",
          "new_api": "strlen",
          "old_text": "sprintf(tbuf,\"%d.%lu\",i,l)",
          "new_text": "strlen(tbuf)",
          "old_line_content": "\t\tsprintf(tbuf,\"%d.%lu\",i,l);",
          "new_line_content": "\t\ti=strlen(tbuf);",
          "content_same": false
        },
        {
          "line": 467,
          "old_api": "strlen",
          "new_api": "strncpy",
          "old_text": "strlen(tbuf)",
          "new_text": "strncpy(buf,tbuf,buf_len)",
          "old_line_content": "\t\ti=strlen(tbuf);",
          "new_line_content": "\t\tstrncpy(buf,tbuf,buf_len);",
          "content_same": false
        },
        {
          "line": 477,
          "old_api": "sprintf",
          "new_api": "strlen",
          "old_text": "sprintf(tbuf,\".%lu\",l)",
          "new_text": "strlen(tbuf)",
          "old_line_content": "\t\t\t\tsprintf(tbuf,\".%lu\",l);",
          "new_line_content": "\t\t\t\ti=strlen(tbuf);",
          "content_same": false
        },
        {
          "line": 491,
          "old_api": "OBJ_nid2sn",
          "new_api": "strncpy",
          "old_text": "OBJ_nid2sn(nid)",
          "new_text": "strncpy(buf,s,buf_len)",
          "old_line_content": "\t\t\ts=OBJ_nid2sn(nid);",
          "new_line_content": "\t\tstrncpy(buf,s,buf_len);",
          "content_same": false
        },
        {
          "line": 492,
          "old_api": "strncpy",
          "new_api": "strlen",
          "old_text": "strncpy(buf,s,buf_len)",
          "new_text": "strlen(s)",
          "old_line_content": "\t\tstrncpy(buf,s,buf_len);",
          "new_line_content": "\t\tn=strlen(s);",
          "content_same": false
        },
        {
          "line": 503,
          "old_api": "OBJ_txt2obj",
          "new_api": "OBJ_obj2nid",
          "old_text": "OBJ_txt2obj(s, 0)",
          "new_text": "OBJ_obj2nid(obj)",
          "old_line_content": "\tobj = OBJ_txt2obj(s, 0);",
          "new_line_content": "\tnid = OBJ_obj2nid(obj);",
          "content_same": false
        },
        {
          "line": 504,
          "old_api": "OBJ_obj2nid",
          "new_api": "ASN1_OBJECT_free",
          "old_text": "OBJ_obj2nid(obj)",
          "new_text": "ASN1_OBJECT_free(obj)",
          "old_line_content": "\tnid = OBJ_obj2nid(obj);",
          "new_line_content": "\tASN1_OBJECT_free(obj);",
          "content_same": false
        },
        {
          "line": 664,
          "old_api": "ASN1_OBJECT_free",
          "new_api": "OPENSSL_free",
          "old_text": "ASN1_OBJECT_free(op)",
          "new_text": "OPENSSL_free(buf)",
          "old_line_content": "\tASN1_OBJECT_free(op);",
          "new_line_content": "\tOPENSSL_free(buf);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 518,
          "old_api": null,
          "new_api": "lh_retrieve",
          "old_text": null,
          "new_text": "lh_retrieve(added,&ad)",
          "old_line_content": "\t\tad.obj= &o;",
          "new_line_content": "\t\tadp=(ADDED_OBJ *)lh_retrieve(added,&ad);",
          "content_same": false
        },
        {
          "line": 647,
          "old_api": null,
          "new_api": "a2d_ASN1_OBJECT",
          "old_text": null,
          "new_text": "a2d_ASN1_OBJECT(NULL,0,oid,-1)",
          "old_line_content": "",
          "new_line_content": "\ti=a2d_ASN1_OBJECT(NULL,0,oid,-1);",
          "content_same": false
        },
        {
          "line": 521,
          "old_api": null,
          "new_api": "OBJ_bsearch",
          "old_text": null,
          "new_text": "OBJ_bsearch((char *)&oo,(char *)ln_objs,NUM_LN,\n\t\tsizeof(ASN1_OBJECT *),ln_cmp)",
          "old_line_content": "\t\t}",
          "new_line_content": "\top=(ASN1_OBJECT **)OBJ_bsearch((char *)&oo,(char *)ln_objs,NUM_LN,",
          "content_same": false
        },
        {
          "line": 650,
          "old_api": null,
          "new_api": "OPENSSL_malloc",
          "old_text": null,
          "new_text": "OPENSSL_malloc(i)",
          "old_line_content": "",
          "new_line_content": "\tif ((buf=(unsigned char *)OPENSSL_malloc(i)) == NULL)",
          "content_same": false
        },
        {
          "line": 652,
          "old_api": null,
          "new_api": "OBJerr",
          "old_text": null,
          "new_text": "OBJerr(OBJ_F_OBJ_CREATE,OBJ_R_MALLOC_FAILURE)",
          "old_line_content": "\t\t{",
          "new_line_content": "\t\tOBJerr(OBJ_F_OBJ_CREATE,OBJ_R_MALLOC_FAILURE);",
          "content_same": false
        },
        {
          "line": 655,
          "old_api": null,
          "new_api": "a2d_ASN1_OBJECT",
          "old_text": null,
          "new_text": "a2d_ASN1_OBJECT(buf,i,oid,-1)",
          "old_line_content": "\t\t}",
          "new_line_content": "\ti=a2d_ASN1_OBJECT(buf,i,oid,-1);",
          "content_same": false
        },
        {
          "line": 658,
          "old_api": null,
          "new_api": "OBJ_new_nid",
          "old_text": null,
          "new_text": "OBJ_new_nid(1)",
          "old_line_content": "\t\tgoto err;",
          "new_line_content": "\top=(ASN1_OBJECT *)ASN1_OBJECT_create(OBJ_new_nid(1),buf,i,sn,ln);",
          "content_same": false
        },
        {
          "line": 661,
          "old_api": null,
          "new_api": "OBJ_add_object",
          "old_text": null,
          "new_text": "OBJ_add_object(op)",
          "old_line_content": "\t\tgoto err;",
          "new_line_content": "\tok=OBJ_add_object(op);",
          "content_same": false
        },
        {
          "line": 663,
          "old_api": null,
          "new_api": "ASN1_OBJECT_free",
          "old_text": null,
          "new_text": "ASN1_OBJECT_free(op)",
          "old_line_content": "err:",
          "new_line_content": "\tASN1_OBJECT_free(op);",
          "content_same": false
        },
        {
          "line": 537,
          "old_api": null,
          "new_api": "lh_retrieve",
          "old_text": null,
          "new_text": "lh_retrieve(added,&ad)",
          "old_line_content": "\t\tad.obj= &o;",
          "new_line_content": "\t\tadp=(ADDED_OBJ *)lh_retrieve(added,&ad);",
          "content_same": false
        },
        {
          "line": 540,
          "old_api": null,
          "new_api": "OBJ_bsearch",
          "old_text": null,
          "new_text": "OBJ_bsearch((char *)&oo,(char *)sn_objs,NUM_SN,\n\t\tsizeof(ASN1_OBJECT *),sn_cmp)",
          "old_line_content": "\t\t}",
          "new_line_content": "\top=(ASN1_OBJECT **)OBJ_bsearch((char *)&oo,(char *)sn_objs,NUM_SN,",
          "content_same": false
        },
        {
          "line": 554,
          "old_api": null,
          "new_api": "memcmp",
          "old_text": null,
          "new_text": "memcmp(a->data,b->data,a->length)",
          "old_line_content": "        if (j) return(j);",
          "new_line_content": "\treturn(memcmp(a->data,b->data,a->length));",
          "content_same": false
        },
        {
          "line": 570,
          "old_api": null,
          "new_api": "*cmp)(key,p)",
          "old_text": null,
          "new_text": "*cmp)(key,p)",
          "old_line_content": "\t\tp= &(base[i*size]);",
          "new_line_content": "\t\tc=(*cmp)(key,p);",
          "content_same": false
        },
        {
          "line": 585,
          "old_api": null,
          "new_api": "*cmp)(key,p)",
          "old_text": null,
          "new_text": "*cmp)(key,p)",
          "old_line_content": "\t\tp= &(base[i*size]);",
          "new_line_content": "\t\tif ((*cmp)(key,p) == 0)",
          "content_same": false
        },
        {
          "line": 465,
          "old_api": null,
          "new_api": "sprintf",
          "old_text": null,
          "new_text": "sprintf(tbuf,\"%d.%lu\",i,l)",
          "old_line_content": "",
          "new_line_content": "\t\tsprintf(tbuf,\"%d.%lu\",i,l);",
          "content_same": false
        },
        {
          "line": 601,
          "old_api": null,
          "new_api": "BIO_gets",
          "old_text": null,
          "new_text": "BIO_gets(in,buf,512)",
          "old_line_content": "\t\ts=o=NULL;",
          "new_line_content": "\t\ti=BIO_gets(in,buf,512);",
          "content_same": false
        },
        {
          "line": 604,
          "old_api": null,
          "new_api": "isalnum",
          "old_text": null,
          "new_text": "isalnum((unsigned char)buf[0])",
          "old_line_content": "\t\tbuf[i-1]='\\0';",
          "new_line_content": "\t\tif (!isalnum((unsigned char)buf[0])) return(num);",
          "content_same": false
        },
        {
          "line": 476,
          "old_api": null,
          "new_api": "sprintf",
          "old_text": null,
          "new_text": "sprintf(tbuf,\".%lu\",l)",
          "old_line_content": "\t\t\tif (!(p[idx] & 0x80)) {",
          "new_line_content": "\t\t\t\tsprintf(tbuf,\".%lu\",l);",
          "content_same": false
        },
        {
          "line": 606,
          "old_api": null,
          "new_api": "isdigit",
          "old_text": null,
          "new_text": "isdigit((unsigned char)*s)",
          "old_line_content": "\t\to=s=buf;",
          "new_line_content": "\t\twhile (isdigit((unsigned char)*s) || (*s == '.'))",
          "content_same": false
        },
        {
          "line": 479,
          "old_api": null,
          "new_api": "strncpy",
          "old_text": null,
          "new_text": "strncpy(buf,tbuf,buf_len)",
          "old_line_content": "\t\t\t\tif (buf_len > 0)",
          "new_line_content": "\t\t\t\t\tstrncpy(buf,tbuf,buf_len);",
          "content_same": false
        },
        {
          "line": 611,
          "old_api": null,
          "new_api": "isspace",
          "old_text": null,
          "new_text": "isspace((unsigned char)*s)",
          "old_line_content": "\t\t\t*(s++)='\\0';",
          "new_line_content": "\t\t\twhile (isspace((unsigned char)*s))",
          "content_same": false
        },
        {
          "line": 488,
          "old_api": null,
          "new_api": "OBJ_nid2ln",
          "old_text": null,
          "new_text": "OBJ_nid2ln(nid)",
          "old_line_content": "\t} else {",
          "new_line_content": "\t\ts=OBJ_nid2ln(nid);",
          "content_same": false
        },
        {
          "line": 618,
          "old_api": null,
          "new_api": "isspace",
          "old_text": null,
          "new_text": "isspace((unsigned char)*l)",
          "old_line_content": "\t\t\t\tl=s;",
          "new_line_content": "\t\t\t\twhile ((*l != '\\0') && !isspace((unsigned char)*l))",
          "content_same": false
        },
        {
          "line": 490,
          "old_api": null,
          "new_api": "OBJ_nid2sn",
          "old_text": null,
          "new_text": "OBJ_nid2sn(nid)",
          "old_line_content": "\t\tif (s == NULL)",
          "new_line_content": "\t\t\ts=OBJ_nid2sn(nid);",
          "content_same": false
        },
        {
          "line": 623,
          "old_api": null,
          "new_api": "isspace",
          "old_text": null,
          "new_text": "isspace((unsigned char)*l)",
          "old_line_content": "\t\t\t\t\t*(l++)='\\0';",
          "new_line_content": "\t\t\t\t\twhile (isspace((unsigned char)*l))",
          "content_same": false
        },
        {
          "line": 502,
          "old_api": null,
          "new_api": "OBJ_txt2obj",
          "old_text": null,
          "new_text": "OBJ_txt2obj(s, 0)",
          "old_line_content": "\tint nid;",
          "new_line_content": "\tobj = OBJ_txt2obj(s, 0);",
          "content_same": false
        },
        {
          "line": 634,
          "old_api": null,
          "new_api": "OBJ_create",
          "old_text": null,
          "new_text": "OBJ_create(o,s,l)",
          "old_line_content": "\t\tif ((o == NULL) || (*o == '\\0')) return(num);",
          "new_line_content": "\t\tif (!OBJ_create(o,s,l)) return(num);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 519,
          "old_api": "lh_retrieve",
          "new_api": null,
          "old_text": "lh_retrieve(added,&ad)",
          "new_text": null,
          "old_line_content": "\t\tadp=(ADDED_OBJ *)lh_retrieve(added,&ad);",
          "new_line_content": "\t\tif (adp != NULL) return (adp->obj->nid);",
          "content_same": false
        },
        {
          "line": 648,
          "old_api": "a2d_ASN1_OBJECT",
          "new_api": null,
          "old_text": "a2d_ASN1_OBJECT(NULL,0,oid,-1)",
          "new_text": null,
          "old_line_content": "\ti=a2d_ASN1_OBJECT(NULL,0,oid,-1);",
          "new_line_content": "\tif (i <= 0) return(0);",
          "content_same": false
        },
        {
          "line": 522,
          "old_api": "OBJ_bsearch",
          "new_api": null,
          "old_text": "OBJ_bsearch((char *)&oo,(char *)ln_objs,NUM_LN,\n\t\tsizeof(ASN1_OBJECT *),ln_cmp)",
          "new_text": null,
          "old_line_content": "\top=(ASN1_OBJECT **)OBJ_bsearch((char *)&oo,(char *)ln_objs,NUM_LN,",
          "new_line_content": "\t\tsizeof(ASN1_OBJECT *),ln_cmp);",
          "content_same": false
        },
        {
          "line": 651,
          "old_api": "OPENSSL_malloc",
          "new_api": null,
          "old_text": "OPENSSL_malloc(i)",
          "new_text": null,
          "old_line_content": "\tif ((buf=(unsigned char *)OPENSSL_malloc(i)) == NULL)",
          "new_line_content": "\t\t{",
          "content_same": false
        },
        {
          "line": 653,
          "old_api": "OBJerr",
          "new_api": null,
          "old_text": "OBJerr(OBJ_F_OBJ_CREATE,OBJ_R_MALLOC_FAILURE)",
          "new_text": null,
          "old_line_content": "\t\tOBJerr(OBJ_F_OBJ_CREATE,OBJ_R_MALLOC_FAILURE);",
          "new_line_content": "\t\treturn(0);",
          "content_same": false
        },
        {
          "line": 656,
          "old_api": "a2d_ASN1_OBJECT",
          "new_api": null,
          "old_text": "a2d_ASN1_OBJECT(buf,i,oid,-1)",
          "new_text": null,
          "old_line_content": "\ti=a2d_ASN1_OBJECT(buf,i,oid,-1);",
          "new_line_content": "\tif (i == 0)",
          "content_same": false
        },
        {
          "line": 659,
          "old_api": "OBJ_new_nid",
          "new_api": null,
          "old_text": "OBJ_new_nid(1)",
          "new_text": null,
          "old_line_content": "\top=(ASN1_OBJECT *)ASN1_OBJECT_create(OBJ_new_nid(1),buf,i,sn,ln);",
          "new_line_content": "\tif (op == NULL) ",
          "content_same": false
        },
        {
          "line": 662,
          "old_api": "OBJ_add_object",
          "new_api": null,
          "old_text": "OBJ_add_object(op)",
          "new_text": null,
          "old_line_content": "\tok=OBJ_add_object(op);",
          "new_line_content": "err:",
          "content_same": false
        },
        {
          "line": 665,
          "old_api": "OPENSSL_free",
          "new_api": null,
          "old_text": "OPENSSL_free(buf)",
          "new_text": null,
          "old_line_content": "\tOPENSSL_free(buf);",
          "new_line_content": "\treturn(ok);",
          "content_same": false
        },
        {
          "line": 538,
          "old_api": "lh_retrieve",
          "new_api": null,
          "old_text": "lh_retrieve(added,&ad)",
          "new_text": null,
          "old_line_content": "\t\tadp=(ADDED_OBJ *)lh_retrieve(added,&ad);",
          "new_line_content": "\t\tif (adp != NULL) return (adp->obj->nid);",
          "content_same": false
        },
        {
          "line": 541,
          "old_api": "OBJ_bsearch",
          "new_api": null,
          "old_text": "OBJ_bsearch((char *)&oo,(char *)sn_objs,NUM_SN,\n\t\tsizeof(ASN1_OBJECT *),sn_cmp)",
          "new_text": null,
          "old_line_content": "\top=(ASN1_OBJECT **)OBJ_bsearch((char *)&oo,(char *)sn_objs,NUM_SN,",
          "new_line_content": "\t\tsizeof(ASN1_OBJECT *),sn_cmp);",
          "content_same": false
        },
        {
          "line": 555,
          "old_api": "memcmp",
          "new_api": null,
          "old_text": "memcmp(a->data,b->data,a->length)",
          "new_text": null,
          "old_line_content": "\treturn(memcmp(a->data,b->data,a->length));",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 571,
          "old_api": "*cmp)(key,p)",
          "new_api": null,
          "old_text": "*cmp)(key,p)",
          "new_text": null,
          "old_line_content": "\t\tc=(*cmp)(key,p);",
          "new_line_content": "\t\tif (c < 0)",
          "content_same": false
        },
        {
          "line": 586,
          "old_api": "*cmp)(key,p)",
          "new_api": null,
          "old_text": "*cmp)(key,p)",
          "new_text": null,
          "old_line_content": "\t\tif ((*cmp)(key,p) == 0)",
          "new_line_content": "\t\t\treturn p;",
          "content_same": false
        },
        {
          "line": 468,
          "old_api": "strncpy",
          "new_api": null,
          "old_text": "strncpy(buf,tbuf,buf_len)",
          "new_text": null,
          "old_line_content": "\t\tstrncpy(buf,tbuf,buf_len);",
          "new_line_content": "\t\tbuf_len-=i;",
          "content_same": false
        },
        {
          "line": 602,
          "old_api": "BIO_gets",
          "new_api": null,
          "old_text": "BIO_gets(in,buf,512)",
          "new_text": null,
          "old_line_content": "\t\ti=BIO_gets(in,buf,512);",
          "new_line_content": "\t\tif (i <= 0) return(num);",
          "content_same": false
        },
        {
          "line": 605,
          "old_api": "isalnum",
          "new_api": null,
          "old_text": "isalnum((unsigned char)buf[0])",
          "new_text": null,
          "old_line_content": "\t\tif (!isalnum((unsigned char)buf[0])) return(num);",
          "new_line_content": "\t\to=s=buf;",
          "content_same": false
        },
        {
          "line": 478,
          "old_api": "strlen",
          "new_api": null,
          "old_text": "strlen(tbuf)",
          "new_text": null,
          "old_line_content": "\t\t\t\ti=strlen(tbuf);",
          "new_line_content": "\t\t\t\tif (buf_len > 0)",
          "content_same": false
        },
        {
          "line": 607,
          "old_api": "isdigit",
          "new_api": null,
          "old_text": "isdigit((unsigned char)*s)",
          "new_text": null,
          "old_line_content": "\t\twhile (isdigit((unsigned char)*s) || (*s == '.'))",
          "new_line_content": "\t\t\ts++;",
          "content_same": false
        },
        {
          "line": 480,
          "old_api": "strncpy",
          "new_api": null,
          "old_text": "strncpy(buf,tbuf,buf_len)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\tstrncpy(buf,tbuf,buf_len);",
          "new_line_content": "\t\t\t\tbuf_len-=i;",
          "content_same": false
        },
        {
          "line": 612,
          "old_api": "isspace",
          "new_api": null,
          "old_text": "isspace((unsigned char)*s)",
          "new_text": null,
          "old_line_content": "\t\t\twhile (isspace((unsigned char)*s))",
          "new_line_content": "\t\t\t\ts++;",
          "content_same": false
        },
        {
          "line": 489,
          "old_api": "OBJ_nid2ln",
          "new_api": null,
          "old_text": "OBJ_nid2ln(nid)",
          "new_text": null,
          "old_line_content": "\t\ts=OBJ_nid2ln(nid);",
          "new_line_content": "\t\tif (s == NULL)",
          "content_same": false
        },
        {
          "line": 619,
          "old_api": "isspace",
          "new_api": null,
          "old_text": "isspace((unsigned char)*l)",
          "new_text": null,
          "old_line_content": "\t\t\t\twhile ((*l != '\\0') && !isspace((unsigned char)*l))",
          "new_line_content": "\t\t\t\t\tl++;",
          "content_same": false
        },
        {
          "line": 493,
          "old_api": "strlen",
          "new_api": null,
          "old_text": "strlen(s)",
          "new_text": null,
          "old_line_content": "\t\tn=strlen(s);",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 624,
          "old_api": "isspace",
          "new_api": null,
          "old_text": "isspace((unsigned char)*l)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\twhile (isspace((unsigned char)*l))",
          "new_line_content": "\t\t\t\t\t\tl++;",
          "content_same": false
        },
        {
          "line": 505,
          "old_api": "ASN1_OBJECT_free",
          "new_api": null,
          "old_text": "ASN1_OBJECT_free(obj)",
          "new_text": null,
          "old_line_content": "\tASN1_OBJECT_free(obj);",
          "new_line_content": "\treturn nid;",
          "content_same": false
        },
        {
          "line": 635,
          "old_api": "OBJ_create",
          "new_api": null,
          "old_text": "OBJ_create(o,s,l)",
          "new_text": null,
          "old_line_content": "\t\tif (!OBJ_create(o,s,l)) return(num);",
          "new_line_content": "\t\tnum++;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 8,
      "total_additions": 27,
      "total_deletions": 27,
      "total_api_changes": 62
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 2,
        "api_related_lines": 62,
        "non_api_lines": 2,
        "non_api_line_numbers": [
          448,
          449
        ]
      }
    },
    "api_calls_before": 86,
    "api_calls_after": 86,
    "diff_info": {
      "added_lines": 1,
      "removed_lines": 2,
      "total_diff_lines": 15
    }
  }
}