{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/cd460f4da04c05d6ba93ccbbe294e948768f0937",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/cd460f4da04c05d6ba93ccbbe294e948768f0937/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/cd460f4da04c05d6ba93ccbbe294e948768f0937/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/cd460f4da04c05d6ba93ccbbe294e948768f0937/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 157,
          "old_api": "bytestream2_peek_byte",
          "new_api": "bytestream2_init",
          "old_text": "bytestream2_peek_byte(&gb)",
          "new_text": "bytestream2_init(&gb, src, size)",
          "old_line_content": "        count = bytestream2_peek_byte(&gb) & 0x1F;",
          "new_line_content": "    bytestream2_init(&gb, src, size);",
          "content_same": false
        },
        {
          "line": 159,
          "old_api": "bytestream2_get_byte",
          "new_api": "bytestream2_tell",
          "old_text": "bytestream2_get_byte(&gb)",
          "new_text": "bytestream2_tell(&gb)",
          "old_line_content": "            tag = bytestream2_get_byte(&gb) & 0xE0;",
          "new_line_content": "    while (bytestream2_tell(&gb) < size) {",
          "content_same": false
        },
        {
          "line": 167,
          "old_api": "bytestream2_get_byte",
          "new_api": "av_log",
          "old_text": "bytestream2_get_byte(&gb)",
          "new_text": "av_log(avctx, AV_LOG_ERROR, \"writeoffset out of bounds\\n\")",
          "old_line_content": "                hnm->current[writeoffset++] = bytestream2_get_byte(&gb);",
          "new_line_content": "                    av_log(avctx, AV_LOG_ERROR, \"writeoffset out of bounds\\n\");",
          "content_same": false
        },
        {
          "line": 185,
          "old_api": "bytestream2_skip",
          "new_api": "bytestream2_peek_byte",
          "old_text": "bytestream2_skip(&gb, 1)",
          "new_text": "bytestream2_peek_byte(&gb)",
          "old_line_content": "                bytestream2_skip(&gb, 1);",
          "new_line_content": "                    hnm->current[writeoffset++] = bytestream2_peek_byte(&gb);",
          "content_same": false
        },
        {
          "line": 197,
          "old_api": "bytestream2_skip",
          "new_api": "bytestream2_peek_byte",
          "old_text": "bytestream2_skip(&gb, 1)",
          "new_text": "bytestream2_peek_byte(&gb)",
          "old_line_content": "            bytestream2_skip(&gb, 1);",
          "new_line_content": "            previous = bytestream2_peek_byte(&gb) & 0x20;",
          "content_same": false
        },
        {
          "line": 199,
          "old_api": "bytestream2_get_le16",
          "new_api": "bytestream2_peek_byte",
          "old_text": "bytestream2_get_le16(&gb)",
          "new_text": "bytestream2_peek_byte(&gb)",
          "old_line_content": "            offset = bytestream2_get_le16(&gb);",
          "new_line_content": "            backward = bytestream2_peek_byte(&gb) & 0x80;",
          "content_same": false
        },
        {
          "line": 286,
          "old_api": "bytestream2_peek_byte",
          "new_api": "bytestream2_init",
          "old_text": "bytestream2_peek_byte(&gb)",
          "new_text": "bytestream2_init(&gb, src, size)",
          "old_line_content": "        count = bytestream2_peek_byte(&gb) & 0x3F;",
          "new_line_content": "    bytestream2_init(&gb, src, size);",
          "content_same": false
        },
        {
          "line": 288,
          "old_api": "bytestream2_get_byte",
          "new_api": "bytestream2_tell",
          "old_text": "bytestream2_get_byte(&gb)",
          "new_text": "bytestream2_tell(&gb)",
          "old_line_content": "            tag = bytestream2_get_byte(&gb) & 0xC0;",
          "new_line_content": "    while (bytestream2_tell(&gb) < size) {",
          "content_same": false
        },
        {
          "line": 294,
          "old_api": "av_log",
          "new_api": "bytestream2_get_byte",
          "old_text": "av_log(avctx, AV_LOG_ERROR, \"writeoffset out of bounds\\n\")",
          "new_text": "bytestream2_get_byte(&gb)",
          "old_line_content": "                    av_log(avctx, AV_LOG_ERROR, \"writeoffset out of bounds\\n\");",
          "new_line_content": "                writeoffset += bytestream2_get_byte(&gb);",
          "content_same": false
        },
        {
          "line": 297,
          "old_api": "bytestream2_get_byte",
          "new_api": "av_log",
          "old_text": "bytestream2_get_byte(&gb)",
          "new_text": "av_log(avctx, AV_LOG_ERROR, \"writeoffset out of bounds\\n\")",
          "old_line_content": "                hnm->current[writeoffset]              = bytestream2_get_byte(&gb);",
          "new_line_content": "                    av_log(avctx, AV_LOG_ERROR, \"writeoffset out of bounds\\n\");",
          "content_same": false
        },
        {
          "line": 315,
          "old_api": "bytestream2_get_le16",
          "new_api": "bytestream2_skip",
          "old_text": "bytestream2_get_le16(&gb)",
          "new_text": "bytestream2_skip(&gb, 1)",
          "old_line_content": "            offset += bytestream2_get_le16(&gb);",
          "new_line_content": "            bytestream2_skip(&gb, 1);",
          "content_same": false
        },
        {
          "line": 369,
          "old_api": "bytestream2_get_byte",
          "new_api": "bytestream2_init",
          "old_text": "bytestream2_get_byte(&gb)",
          "new_text": "bytestream2_init(&gb, src + 8, size - 8)",
          "old_line_content": "        start = bytestream2_get_byte(&gb);",
          "new_line_content": "    bytestream2_init(&gb, src + 8, size - 8);",
          "content_same": false
        },
        {
          "line": 412,
          "old_api": "hnm_update_palette",
          "new_api": "AV_RL16",
          "old_text": "hnm_update_palette(avctx, avpkt->data, avpkt->size)",
          "new_text": "AV_RL16(avpkt->data + 4)",
          "old_line_content": "        hnm_update_palette(avctx, avpkt->data, avpkt->size);",
          "new_line_content": "    chunk_id = AV_RL16(avpkt->data + 4);",
          "content_same": false
        },
        {
          "line": 415,
          "old_api": "av_log",
          "new_api": "hnm_update_palette",
          "old_text": "av_log(avctx, AV_LOG_ERROR, \"packet too small\\n\")",
          "new_text": "hnm_update_palette(avctx, avpkt->data, avpkt->size)",
          "old_line_content": "            av_log(avctx, AV_LOG_ERROR, \"packet too small\\n\");",
          "new_line_content": "        hnm_update_palette(avctx, avpkt->data, avpkt->size);",
          "content_same": false
        },
        {
          "line": 418,
          "old_api": "ff_get_buffer",
          "new_api": "av_log",
          "old_text": "ff_get_buffer(avctx, frame, 0)",
          "new_text": "av_log(avctx, AV_LOG_ERROR, \"packet too small\\n\")",
          "old_line_content": "        if ((ret = ff_get_buffer(avctx, frame, 0)) < 0)",
          "new_line_content": "            av_log(avctx, AV_LOG_ERROR, \"packet too small\\n\");",
          "content_same": false
        },
        {
          "line": 421,
          "old_api": "unpack_intraframe",
          "new_api": "ff_get_buffer",
          "old_text": "unpack_intraframe(avctx, avpkt->data + 12, avpkt->size - 12)",
          "new_text": "ff_get_buffer(avctx, frame, 0)",
          "old_line_content": "        unpack_intraframe(avctx, avpkt->data + 12, avpkt->size - 12);",
          "new_line_content": "        if ((ret = ff_get_buffer(avctx, frame, 0)) < 0)",
          "content_same": false
        },
        {
          "line": 424,
          "old_api": "memcpy",
          "new_api": "unpack_intraframe",
          "old_text": "memcpy(hnm->processed, hnm->current, hnm->width * hnm->height)",
          "new_text": "unpack_intraframe(avctx, avpkt->data + 12, avpkt->size - 12)",
          "old_line_content": "            memcpy(hnm->processed, hnm->current, hnm->width * hnm->height);",
          "new_line_content": "        unpack_intraframe(avctx, avpkt->data + 12, avpkt->size - 12);",
          "content_same": false
        },
        {
          "line": 427,
          "old_api": "copy_processed_frame",
          "new_api": "memcpy",
          "old_text": "copy_processed_frame(avctx, frame)",
          "new_text": "memcpy(hnm->processed, hnm->current, hnm->width * hnm->height)",
          "old_line_content": "        copy_processed_frame(avctx, frame);",
          "new_line_content": "            memcpy(hnm->processed, hnm->current, hnm->width * hnm->height);",
          "content_same": false
        },
        {
          "line": 430,
          "old_api": "memcpy",
          "new_api": "copy_processed_frame",
          "old_text": "memcpy(frame->data[1], hnm->palette, 256 * 4)",
          "new_text": "copy_processed_frame(avctx, frame)",
          "old_line_content": "        memcpy(frame->data[1], hnm->palette, 256 * 4);",
          "new_line_content": "        copy_processed_frame(avctx, frame);",
          "content_same": false
        },
        {
          "line": 433,
          "old_api": "ff_get_buffer",
          "new_api": "memcpy",
          "old_text": "ff_get_buffer(avctx, frame, 0)",
          "new_text": "memcpy(frame->data[1], hnm->palette, 256 * 4)",
          "old_line_content": "        if ((ret = ff_get_buffer(avctx, frame, 0)) < 0)",
          "new_line_content": "        memcpy(frame->data[1], hnm->palette, 256 * 4);",
          "content_same": false
        },
        {
          "line": 440,
          "old_api": "decode_interframe_v4",
          "new_api": "decode_interframe_v4a",
          "old_text": "decode_interframe_v4(avctx, avpkt->data + 8, avpkt->size - 8)",
          "new_text": "decode_interframe_v4a(avctx, avpkt->data + 8, avpkt->size - 8)",
          "old_line_content": "            int ret = decode_interframe_v4(avctx, avpkt->data + 8, avpkt->size - 8);",
          "new_line_content": "            decode_interframe_v4a(avctx, avpkt->data + 8, avpkt->size - 8);",
          "content_same": false
        },
        {
          "line": 443,
          "old_api": "postprocess_current_frame",
          "new_api": "decode_interframe_v4",
          "old_text": "postprocess_current_frame(avctx)",
          "new_text": "decode_interframe_v4(avctx, avpkt->data + 8, avpkt->size - 8)",
          "old_line_content": "            postprocess_current_frame(avctx);",
          "new_line_content": "            int ret = decode_interframe_v4(avctx, avpkt->data + 8, avpkt->size - 8);",
          "content_same": false
        },
        {
          "line": 448,
          "old_api": "memcpy",
          "new_api": "copy_processed_frame",
          "old_text": "memcpy(frame->data[1], hnm->palette, 256 * 4)",
          "new_text": "copy_processed_frame(avctx, frame)",
          "old_line_content": "        memcpy(frame->data[1], hnm->palette, 256 * 4);",
          "new_line_content": "        copy_processed_frame(avctx, frame);",
          "content_same": false
        },
        {
          "line": 488,
          "old_api": "av_freep",
          "new_api": "av_log",
          "old_text": "av_freep(&hnm->processed)",
          "new_text": "av_log(avctx, AV_LOG_ERROR, \"av_mallocz() failed\\n\")",
          "old_line_content": "        av_freep(&hnm->processed);",
          "new_line_content": "        av_log(avctx, AV_LOG_ERROR, \"av_mallocz() failed\\n\");",
          "content_same": false
        },
        {
          "line": 489,
          "old_api": "AVERROR",
          "new_api": "av_freep",
          "old_text": "AVERROR(ENOMEM)",
          "new_text": "av_freep(&hnm->buffer1)",
          "old_line_content": "        return AVERROR(ENOMEM);",
          "new_line_content": "        av_freep(&hnm->buffer1);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 514,
          "old_api": null,
          "new_api": "NULL_IF_CONFIG_SMALL",
          "old_text": null,
          "new_text": "NULL_IF_CONFIG_SMALL(\"HNM 4 video\")",
          "old_line_content": "    .priv_data_size = sizeof(Hnm4VideoContext),",
          "new_line_content": "    .long_name      = NULL_IF_CONFIG_SMALL(\"HNM 4 video\"),",
          "content_same": false
        },
        {
          "line": 143,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(dst, src, hnm->width)",
          "old_line_content": "    }",
          "new_line_content": "        memcpy(dst, src, hnm->width);",
          "content_same": false
        },
        {
          "line": 408,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(avctx, AV_LOG_ERROR, \"packet too small\\n\")",
          "old_line_content": "",
          "new_line_content": "        av_log(avctx, AV_LOG_ERROR, \"packet too small\\n\");",
          "content_same": false
        },
        {
          "line": 160,
          "old_api": null,
          "new_api": "bytestream2_peek_byte",
          "old_text": null,
          "new_text": "bytestream2_peek_byte(&gb)",
          "old_line_content": "            tag = tag >> 5;",
          "new_line_content": "        count = bytestream2_peek_byte(&gb) & 0x1F;",
          "content_same": false
        },
        {
          "line": 289,
          "old_api": null,
          "new_api": "bytestream2_peek_byte",
          "old_text": null,
          "new_text": "bytestream2_peek_byte(&gb)",
          "old_line_content": "            tag = tag >> 6;",
          "new_line_content": "        count = bytestream2_peek_byte(&gb) & 0x3F;",
          "content_same": false
        },
        {
          "line": 162,
          "old_api": null,
          "new_api": "bytestream2_get_byte",
          "old_text": null,
          "new_text": "bytestream2_get_byte(&gb)",
          "old_line_content": "            if (tag == 0) {",
          "new_line_content": "            tag = bytestream2_get_byte(&gb) & 0xE0;",
          "content_same": false
        },
        {
          "line": 425,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(hnm->previous, hnm->current, hnm->width * hnm->height)",
          "old_line_content": "        else",
          "new_line_content": "        memcpy(hnm->previous, hnm->current, hnm->width * hnm->height);",
          "content_same": false
        },
        {
          "line": 171,
          "old_api": null,
          "new_api": "bytestream2_get_byte",
          "old_text": null,
          "new_text": "bytestream2_get_byte(&gb)",
          "old_line_content": "            } else if (tag == 2) {",
          "new_line_content": "                hnm->current[writeoffset++] = bytestream2_get_byte(&gb);",
          "content_same": false
        },
        {
          "line": 300,
          "old_api": null,
          "new_api": "bytestream2_get_byte",
          "old_text": null,
          "new_text": "bytestream2_get_byte(&gb)",
          "old_line_content": "            } else if (tag == 2) {",
          "new_line_content": "                hnm->current[writeoffset]              = bytestream2_get_byte(&gb);",
          "content_same": false
        },
        {
          "line": 173,
          "old_api": null,
          "new_api": "bytestream2_get_byte",
          "old_text": null,
          "new_text": "bytestream2_get_byte(&gb)",
          "old_line_content": "                count *= 2;",
          "new_line_content": "                writeoffset += bytestream2_get_byte(&gb) * 2;",
          "content_same": false
        },
        {
          "line": 301,
          "old_api": null,
          "new_api": "bytestream2_get_byte",
          "old_text": null,
          "new_text": "bytestream2_get_byte(&gb)",
          "old_line_content": "                writeoffset += hnm->width;",
          "new_line_content": "                hnm->current[writeoffset + hnm->width] = bytestream2_get_byte(&gb);",
          "content_same": false
        },
        {
          "line": 175,
          "old_api": null,
          "new_api": "bytestream2_get_le16",
          "old_text": null,
          "new_text": "bytestream2_get_le16(&gb)",
          "old_line_content": "            } else if (tag == 3) {",
          "new_line_content": "                count = bytestream2_get_le16(&gb);",
          "content_same": false
        },
        {
          "line": 429,
          "old_api": null,
          "new_api": "postprocess_current_frame",
          "old_text": null,
          "new_text": "postprocess_current_frame(avctx)",
          "old_line_content": "        frame->key_frame = 1;",
          "new_line_content": "            postprocess_current_frame(avctx);",
          "content_same": false
        },
        {
          "line": 179,
          "old_api": null,
          "new_api": "bytestream2_get_byte",
          "old_text": null,
          "new_text": "bytestream2_get_byte(&gb)",
          "old_line_content": "                    return AVERROR_INVALIDDATA;",
          "new_line_content": "                count = bytestream2_get_byte(&gb) * 2;",
          "content_same": false
        },
        {
          "line": 436,
          "old_api": null,
          "new_api": "ff_get_buffer",
          "old_text": null,
          "new_text": "ff_get_buffer(avctx, frame, 0)",
          "old_line_content": "        if (hnm->version == 0x4a) {",
          "new_line_content": "        if ((ret = ff_get_buffer(avctx, frame, 0)) < 0)",
          "content_same": false
        },
        {
          "line": 181,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(avctx, AV_LOG_ERROR, \"writeoffset out of bounds\\n\")",
          "old_line_content": "                while (count > 0) {",
          "new_line_content": "                    av_log(avctx, AV_LOG_ERROR, \"writeoffset out of bounds\\n\");",
          "content_same": false
        },
        {
          "line": 309,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(avctx, AV_LOG_ERROR, \"writeoffset out of bounds\\n\")",
          "old_line_content": "        } else {",
          "new_line_content": "                av_log(avctx, AV_LOG_ERROR, \"writeoffset out of bounds\\n\");",
          "content_same": false
        },
        {
          "line": 313,
          "old_api": null,
          "new_api": "bytestream2_peek_byte",
          "old_text": null,
          "new_text": "bytestream2_peek_byte(&gb)",
          "old_line_content": "",
          "new_line_content": "            delta    = bytestream2_peek_byte(&gb) & 0x80;",
          "content_same": false
        },
        {
          "line": 314,
          "old_api": null,
          "new_api": "bytestream2_peek_byte",
          "old_text": null,
          "new_text": "bytestream2_peek_byte(&gb)",
          "old_line_content": "            offset  = writeoffset;",
          "new_line_content": "            previous = bytestream2_peek_byte(&gb) & 0x40;",
          "content_same": false
        },
        {
          "line": 441,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(hnm->processed, hnm->current, hnm->width * hnm->height)",
          "old_line_content": "            if (ret < 0)",
          "new_line_content": "            memcpy(hnm->processed, hnm->current, hnm->width * hnm->height);",
          "content_same": false
        },
        {
          "line": 188,
          "old_api": null,
          "new_api": "bytestream2_skip",
          "old_text": null,
          "new_text": "bytestream2_skip(&gb, 1)",
          "old_line_content": "            }",
          "new_line_content": "                bytestream2_skip(&gb, 1);",
          "content_same": false
        },
        {
          "line": 318,
          "old_api": null,
          "new_api": "bytestream2_get_le16",
          "old_text": null,
          "new_text": "bytestream2_get_le16(&gb)",
          "old_line_content": "                if (offset < 0x10000) {",
          "new_line_content": "            offset += bytestream2_get_le16(&gb);",
          "content_same": false
        },
        {
          "line": 446,
          "old_api": null,
          "new_api": "postprocess_current_frame",
          "old_text": null,
          "new_text": "postprocess_current_frame(avctx)",
          "old_line_content": "        frame->pict_type = AV_PICTURE_TYPE_P;",
          "new_line_content": "            postprocess_current_frame(avctx);",
          "content_same": false
        },
        {
          "line": 193,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(avctx, AV_LOG_ERROR, \"writeoffset out of bounds\\n\")",
          "old_line_content": "        } else {",
          "new_line_content": "                av_log(avctx, AV_LOG_ERROR, \"writeoffset out of bounds\\n\");",
          "content_same": false
        },
        {
          "line": 322,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(avctx, AV_LOG_ERROR, \"Attempting to read out of bounds\\n\")",
          "old_line_content": "                offset -= 0x10000;",
          "new_line_content": "                    av_log(avctx, AV_LOG_ERROR, \"Attempting to read out of bounds\\n\");",
          "content_same": false
        },
        {
          "line": 451,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(frame->data[1], hnm->palette, 256 * 4)",
          "old_line_content": "    } else {",
          "new_line_content": "        memcpy(frame->data[1], hnm->palette, 256 * 4);",
          "content_same": false
        },
        {
          "line": 453,
          "old_api": null,
          "new_api": "hnm_flip_buffers",
          "old_text": null,
          "new_text": "hnm_flip_buffers(hnm)",
          "old_line_content": "        return AVERROR_INVALIDDATA;",
          "new_line_content": "        hnm_flip_buffers(hnm);",
          "content_same": false
        },
        {
          "line": 455,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(avctx, AV_LOG_ERROR, \"invalid chunk id: %d\\n\", chunk_id)",
          "old_line_content": "",
          "new_line_content": "        av_log(avctx, AV_LOG_ERROR, \"invalid chunk id: %d\\n\", chunk_id);",
          "content_same": false
        },
        {
          "line": 200,
          "old_api": null,
          "new_api": "bytestream2_skip",
          "old_text": null,
          "new_text": "bytestream2_skip(&gb, 1)",
          "old_line_content": "            offset = (offset >> 1) & 0x7FFF;",
          "new_line_content": "            bytestream2_skip(&gb, 1);",
          "content_same": false
        },
        {
          "line": 201,
          "old_api": null,
          "new_api": "bytestream2_peek_byte",
          "old_text": null,
          "new_text": "bytestream2_peek_byte(&gb)",
          "old_line_content": "            offset = writeoffset + (offset * 2) - 0x8000;",
          "new_line_content": "            swap   = bytestream2_peek_byte(&gb) & 0x01;",
          "content_same": false
        },
        {
          "line": 202,
          "old_api": null,
          "new_api": "bytestream2_get_le16",
          "old_text": null,
          "new_text": "bytestream2_get_le16(&gb)",
          "old_line_content": "",
          "new_line_content": "            offset = bytestream2_get_le16(&gb);",
          "content_same": false
        },
        {
          "line": 332,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(avctx, AV_LOG_ERROR, \"Attempting to write out of bounds\\n\")",
          "old_line_content": "",
          "new_line_content": "                av_log(avctx, AV_LOG_ERROR, \"Attempting to write out of bounds\\n\");",
          "content_same": false
        },
        {
          "line": 468,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(avctx, AV_LOG_ERROR,\n               \"Extradata missing, decoder requires version number\\n\")",
          "old_line_content": "    }",
          "new_line_content": "        av_log(avctx, AV_LOG_ERROR,",
          "content_same": false
        },
        {
          "line": 215,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(avctx, AV_LOG_ERROR,\n                       \"Attempting to write out of bounds\\n\")",
          "old_line_content": "",
          "new_line_content": "                av_log(avctx, AV_LOG_ERROR,",
          "content_same": false
        },
        {
          "line": 473,
          "old_api": null,
          "new_api": "av_image_check_size",
          "old_text": null,
          "new_text": "av_image_check_size(avctx->width, avctx->height, 0, avctx)",
          "old_line_content": "",
          "new_line_content": "    ret = av_image_check_size(avctx->width, avctx->height, 0, avctx);",
          "content_same": false
        },
        {
          "line": 222,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(avctx, AV_LOG_ERROR, \"Attempting to read out of bounds\\n\")",
          "old_line_content": "            } else {",
          "new_line_content": "                    av_log(avctx, AV_LOG_ERROR, \"Attempting to read out of bounds\\n\");",
          "content_same": false
        },
        {
          "line": 481,
          "old_api": null,
          "new_api": "av_mallocz",
          "old_text": null,
          "new_text": "av_mallocz(avctx->width * avctx->height)",
          "old_line_content": "",
          "new_line_content": "    hnm->buffer1   = av_mallocz(avctx->width * avctx->height);",
          "content_same": false
        },
        {
          "line": 482,
          "old_api": null,
          "new_api": "av_mallocz",
          "old_text": null,
          "new_text": "av_mallocz(avctx->width * avctx->height)",
          "old_line_content": "    if (   !hnm->buffer1 || !hnm->buffer2 || !hnm->processed",
          "new_line_content": "    hnm->buffer2   = av_mallocz(avctx->width * avctx->height);",
          "content_same": false
        },
        {
          "line": 227,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(avctx, AV_LOG_ERROR, \"Attempting to read out of bounds\\n\")",
          "old_line_content": "            }",
          "new_line_content": "                    av_log(avctx, AV_LOG_ERROR, \"Attempting to read out of bounds\\n\");",
          "content_same": false
        },
        {
          "line": 483,
          "old_api": null,
          "new_api": "av_mallocz",
          "old_text": null,
          "new_text": "av_mallocz(avctx->width * avctx->height)",
          "old_line_content": "        || avctx->width * avctx->height == 0",
          "new_line_content": "    hnm->processed = av_mallocz(avctx->width * avctx->height);",
          "content_same": false
        },
        {
          "line": 490,
          "old_api": null,
          "new_api": "av_freep",
          "old_text": null,
          "new_text": "av_freep(&hnm->buffer2)",
          "old_line_content": "    }",
          "new_line_content": "        av_freep(&hnm->buffer2);",
          "content_same": false
        },
        {
          "line": 491,
          "old_api": null,
          "new_api": "av_freep",
          "old_text": null,
          "new_text": "av_freep(&hnm->processed)",
          "old_line_content": "",
          "new_line_content": "        av_freep(&hnm->processed);",
          "content_same": false
        },
        {
          "line": 492,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(ENOMEM)",
          "old_line_content": "    hnm->current  = hnm->buffer1;",
          "new_line_content": "        return AVERROR(ENOMEM);",
          "content_same": false
        },
        {
          "line": 371,
          "old_api": null,
          "new_api": "bytestream2_tell",
          "old_text": null,
          "new_text": "bytestream2_tell(&gb)",
          "old_line_content": "        if (start == 255 && count == 255)",
          "new_line_content": "    while (bytestream2_tell(&gb) < size - 8) {",
          "content_same": false
        },
        {
          "line": 372,
          "old_api": null,
          "new_api": "bytestream2_get_byte",
          "old_text": null,
          "new_text": "bytestream2_get_byte(&gb)",
          "old_line_content": "            break;",
          "new_line_content": "        start = bytestream2_get_byte(&gb);",
          "content_same": false
        },
        {
          "line": 373,
          "old_api": null,
          "new_api": "bytestream2_get_byte",
          "old_text": null,
          "new_text": "bytestream2_get_byte(&gb)",
          "old_line_content": "        if (count == 0)",
          "new_line_content": "        count = bytestream2_get_byte(&gb);",
          "content_same": false
        },
        {
          "line": 505,
          "old_api": null,
          "new_api": "av_freep",
          "old_text": null,
          "new_text": "av_freep(&hnm->buffer1)",
          "old_line_content": "",
          "new_line_content": "    av_freep(&hnm->buffer1);",
          "content_same": false
        },
        {
          "line": 506,
          "old_api": null,
          "new_api": "av_freep",
          "old_text": null,
          "new_text": "av_freep(&hnm->buffer2)",
          "old_line_content": "    return 0;",
          "new_line_content": "    av_freep(&hnm->buffer2);",
          "content_same": false
        },
        {
          "line": 507,
          "old_api": null,
          "new_api": "av_freep",
          "old_text": null,
          "new_text": "av_freep(&hnm->processed)",
          "old_line_content": "}",
          "new_line_content": "    av_freep(&hnm->processed);",
          "content_same": false
        },
        {
          "line": 380,
          "old_api": null,
          "new_api": "bytestream2_get_be24",
          "old_text": null,
          "new_text": "bytestream2_get_be24(&gb)",
          "old_line_content": "            hnm->palette[writeoffset] |= (0xFFU << 24);",
          "new_line_content": "            hnm->palette[writeoffset] = bytestream2_get_be24(&gb);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 140,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(dst, src, hnm->width)",
          "new_text": null,
          "old_line_content": "        memcpy(dst, src, hnm->width);",
          "new_line_content": "    int y;",
          "content_same": false
        },
        {
          "line": 405,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(avctx, AV_LOG_ERROR, \"packet too small\\n\")",
          "new_text": null,
          "old_line_content": "        av_log(avctx, AV_LOG_ERROR, \"packet too small\\n\");",
          "new_line_content": "    uint16_t chunk_id;",
          "content_same": false
        },
        {
          "line": 409,
          "old_api": "AV_RL16",
          "new_api": null,
          "old_text": "AV_RL16(avpkt->data + 4)",
          "new_text": null,
          "old_line_content": "    chunk_id = AV_RL16(avpkt->data + 4);",
          "new_line_content": "        return AVERROR_INVALIDDATA;",
          "content_same": false
        },
        {
          "line": 154,
          "old_api": "bytestream2_init",
          "new_api": null,
          "old_text": "bytestream2_init(&gb, src, size)",
          "new_text": null,
          "old_line_content": "    bytestream2_init(&gb, src, size);",
          "new_line_content": "    int count, left, offset;",
          "content_same": false
        },
        {
          "line": 283,
          "old_api": "bytestream2_init",
          "new_api": null,
          "old_text": "bytestream2_init(&gb, src, size)",
          "new_text": null,
          "old_line_content": "    bytestream2_init(&gb, src, size);",
          "new_line_content": "    uint32_t writeoffset = 0, offset;",
          "content_same": false
        },
        {
          "line": 156,
          "old_api": "bytestream2_tell",
          "new_api": null,
          "old_text": "bytestream2_tell(&gb)",
          "new_text": null,
          "old_line_content": "    while (bytestream2_tell(&gb) < size) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 285,
          "old_api": "bytestream2_tell",
          "new_api": null,
          "old_text": "bytestream2_tell(&gb)",
          "new_text": null,
          "old_line_content": "    while (bytestream2_tell(&gb) < size) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 164,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(avctx, AV_LOG_ERROR, \"writeoffset out of bounds\\n\")",
          "new_text": null,
          "old_line_content": "                    av_log(avctx, AV_LOG_ERROR, \"writeoffset out of bounds\\n\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 422,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(hnm->previous, hnm->current, hnm->width * hnm->height)",
          "new_text": null,
          "old_line_content": "        memcpy(hnm->previous, hnm->current, hnm->width * hnm->height);",
          "new_line_content": "            return ret;",
          "content_same": false
        },
        {
          "line": 168,
          "old_api": "bytestream2_get_byte",
          "new_api": null,
          "old_text": "bytestream2_get_byte(&gb)",
          "new_text": null,
          "old_line_content": "                hnm->current[writeoffset++] = bytestream2_get_byte(&gb);",
          "new_line_content": "                    return AVERROR_INVALIDDATA;",
          "content_same": false
        },
        {
          "line": 298,
          "old_api": "bytestream2_get_byte",
          "new_api": null,
          "old_text": "bytestream2_get_byte(&gb)",
          "new_text": null,
          "old_line_content": "                hnm->current[writeoffset + hnm->width] = bytestream2_get_byte(&gb);",
          "new_line_content": "                    break;",
          "content_same": false
        },
        {
          "line": 426,
          "old_api": "postprocess_current_frame",
          "new_api": null,
          "old_text": "postprocess_current_frame(avctx)",
          "new_text": null,
          "old_line_content": "            postprocess_current_frame(avctx);",
          "new_line_content": "        if (hnm->version == 0x4a)",
          "content_same": false
        },
        {
          "line": 172,
          "old_api": "bytestream2_get_le16",
          "new_api": null,
          "old_text": "bytestream2_get_le16(&gb)",
          "new_text": null,
          "old_line_content": "                count = bytestream2_get_le16(&gb);",
          "new_line_content": "            } else if (tag == 1) {",
          "content_same": false
        },
        {
          "line": 176,
          "old_api": "bytestream2_get_byte",
          "new_api": null,
          "old_text": "bytestream2_get_byte(&gb)",
          "new_text": null,
          "old_line_content": "                count = bytestream2_get_byte(&gb) * 2;",
          "new_line_content": "                count *= 2;",
          "content_same": false
        },
        {
          "line": 178,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(avctx, AV_LOG_ERROR, \"writeoffset out of bounds\\n\")",
          "new_text": null,
          "old_line_content": "                    av_log(avctx, AV_LOG_ERROR, \"writeoffset out of bounds\\n\");",
          "new_line_content": "            } else if (tag == 3) {",
          "content_same": false
        },
        {
          "line": 306,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(avctx, AV_LOG_ERROR, \"writeoffset out of bounds\\n\")",
          "new_text": null,
          "old_line_content": "                av_log(avctx, AV_LOG_ERROR, \"writeoffset out of bounds\\n\");",
          "new_line_content": "                break;",
          "content_same": false
        },
        {
          "line": 437,
          "old_api": "decode_interframe_v4a",
          "new_api": null,
          "old_text": "decode_interframe_v4a(avctx, avpkt->data + 8, avpkt->size - 8)",
          "new_text": null,
          "old_line_content": "            decode_interframe_v4a(avctx, avpkt->data + 8, avpkt->size - 8);",
          "new_line_content": "            return ret;",
          "content_same": false
        },
        {
          "line": 182,
          "old_api": "bytestream2_peek_byte",
          "new_api": null,
          "old_text": "bytestream2_peek_byte(&gb)",
          "new_text": null,
          "old_line_content": "                    hnm->current[writeoffset++] = bytestream2_peek_byte(&gb);",
          "new_line_content": "                    return AVERROR_INVALIDDATA;",
          "content_same": false
        },
        {
          "line": 310,
          "old_api": "bytestream2_peek_byte",
          "new_api": null,
          "old_text": "bytestream2_peek_byte(&gb)",
          "new_text": null,
          "old_line_content": "            delta    = bytestream2_peek_byte(&gb) & 0x80;",
          "new_line_content": "                break;",
          "content_same": false
        },
        {
          "line": 311,
          "old_api": "bytestream2_peek_byte",
          "new_api": null,
          "old_text": "bytestream2_peek_byte(&gb)",
          "new_text": null,
          "old_line_content": "            previous = bytestream2_peek_byte(&gb) & 0x40;",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 312,
          "old_api": "bytestream2_skip",
          "new_api": null,
          "old_text": "bytestream2_skip(&gb, 1)",
          "new_text": null,
          "old_line_content": "            bytestream2_skip(&gb, 1);",
          "new_line_content": "        } else {",
          "content_same": false
        },
        {
          "line": 438,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(hnm->processed, hnm->current, hnm->width * hnm->height)",
          "new_text": null,
          "old_line_content": "            memcpy(hnm->processed, hnm->current, hnm->width * hnm->height);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 445,
          "old_api": "copy_processed_frame",
          "new_api": null,
          "old_text": "copy_processed_frame(avctx, frame)",
          "new_text": null,
          "old_line_content": "        copy_processed_frame(avctx, frame);",
          "new_line_content": "                return ret;",
          "content_same": false
        },
        {
          "line": 190,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(avctx, AV_LOG_ERROR, \"writeoffset out of bounds\\n\")",
          "new_text": null,
          "old_line_content": "                av_log(avctx, AV_LOG_ERROR, \"writeoffset out of bounds\\n\");",
          "new_line_content": "                break;",
          "content_same": false
        },
        {
          "line": 319,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(avctx, AV_LOG_ERROR, \"Attempting to read out of bounds\\n\")",
          "new_text": null,
          "old_line_content": "                    av_log(avctx, AV_LOG_ERROR, \"Attempting to read out of bounds\\n\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 194,
          "old_api": "bytestream2_peek_byte",
          "new_api": null,
          "old_text": "bytestream2_peek_byte(&gb)",
          "new_text": null,
          "old_line_content": "            previous = bytestream2_peek_byte(&gb) & 0x20;",
          "new_line_content": "                return AVERROR_INVALIDDATA;",
          "content_same": false
        },
        {
          "line": 195,
          "old_api": "bytestream2_peek_byte",
          "new_api": null,
          "old_text": "bytestream2_peek_byte(&gb)",
          "new_text": null,
          "old_line_content": "            backline = bytestream2_peek_byte(&gb) & 0x40;",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 196,
          "old_api": "bytestream2_peek_byte",
          "new_api": null,
          "old_text": "bytestream2_peek_byte(&gb)",
          "new_text": null,
          "old_line_content": "            backward = bytestream2_peek_byte(&gb) & 0x80;",
          "new_line_content": "        } else {",
          "content_same": false
        },
        {
          "line": 450,
          "old_api": "hnm_flip_buffers",
          "new_api": null,
          "old_text": "hnm_flip_buffers(hnm)",
          "new_text": null,
          "old_line_content": "        hnm_flip_buffers(hnm);",
          "new_line_content": "        frame->key_frame = 0;",
          "content_same": false
        },
        {
          "line": 326,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(avctx, AV_LOG_ERROR, \"Attempting to read out of bounds\\n\")",
          "new_text": null,
          "old_line_content": "                av_log(avctx, AV_LOG_ERROR, \"Attempting to read out of bounds\\n\");",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 452,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(avctx, AV_LOG_ERROR, \"invalid chunk id: %d\\n\", chunk_id)",
          "new_text": null,
          "old_line_content": "        av_log(avctx, AV_LOG_ERROR, \"invalid chunk id: %d\\n\", chunk_id);",
          "new_line_content": "        *got_frame = 1;",
          "content_same": false
        },
        {
          "line": 206,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(avctx, AV_LOG_ERROR, \"Attempting to read out of bounds\\n\")",
          "new_text": null,
          "old_line_content": "                av_log(avctx, AV_LOG_ERROR, \"Attempting to read out of bounds\\n\");",
          "new_line_content": "            left = count;",
          "content_same": false
        },
        {
          "line": 465,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(avctx, AV_LOG_ERROR,\n               \"Extradata missing, decoder requires version number\\n\")",
          "new_text": null,
          "old_line_content": "        av_log(avctx, AV_LOG_ERROR,",
          "new_line_content": "    int ret;",
          "content_same": false
        },
        {
          "line": 470,
          "old_api": "av_image_check_size",
          "new_api": null,
          "old_text": "av_image_check_size(avctx->width, avctx->height, 0, avctx)",
          "new_text": null,
          "old_line_content": "    ret = av_image_check_size(avctx->width, avctx->height, 0, avctx);",
          "new_line_content": "        return AVERROR_INVALIDDATA;",
          "content_same": false
        },
        {
          "line": 219,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(avctx, AV_LOG_ERROR, \"Attempting to read out of bounds\\n\")",
          "new_text": null,
          "old_line_content": "                    av_log(avctx, AV_LOG_ERROR, \"Attempting to read out of bounds\\n\");",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 478,
          "old_api": "av_mallocz",
          "new_api": null,
          "old_text": "av_mallocz(avctx->width * avctx->height)",
          "new_text": null,
          "old_line_content": "    hnm->buffer1   = av_mallocz(avctx->width * avctx->height);",
          "new_line_content": "    avctx->pix_fmt = AV_PIX_FMT_PAL8;",
          "content_same": false
        },
        {
          "line": 479,
          "old_api": "av_mallocz",
          "new_api": null,
          "old_text": "av_mallocz(avctx->width * avctx->height)",
          "new_text": null,
          "old_line_content": "    hnm->buffer2   = av_mallocz(avctx->width * avctx->height);",
          "new_line_content": "    hnm->width     = avctx->width;",
          "content_same": false
        },
        {
          "line": 224,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(avctx, AV_LOG_ERROR, \"Attempting to read out of bounds\\n\")",
          "new_text": null,
          "old_line_content": "                    av_log(avctx, AV_LOG_ERROR, \"Attempting to read out of bounds\\n\");",
          "new_line_content": "                }",
          "content_same": false
        },
        {
          "line": 480,
          "old_api": "av_mallocz",
          "new_api": null,
          "old_text": "av_mallocz(avctx->width * avctx->height)",
          "new_text": null,
          "old_line_content": "    hnm->processed = av_mallocz(avctx->width * avctx->height);",
          "new_line_content": "    hnm->height    = avctx->height;",
          "content_same": false
        },
        {
          "line": 485,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(avctx, AV_LOG_ERROR, \"av_mallocz() failed\\n\")",
          "new_text": null,
          "old_line_content": "        av_log(avctx, AV_LOG_ERROR, \"av_mallocz() failed\\n\");",
          "new_line_content": "    if (   !hnm->buffer1 || !hnm->buffer2 || !hnm->processed",
          "content_same": false
        },
        {
          "line": 486,
          "old_api": "av_freep",
          "new_api": null,
          "old_text": "av_freep(&hnm->buffer1)",
          "new_text": null,
          "old_line_content": "        av_freep(&hnm->buffer1);",
          "new_line_content": "        || avctx->width * avctx->height == 0",
          "content_same": false
        },
        {
          "line": 487,
          "old_api": "av_freep",
          "new_api": null,
          "old_text": "av_freep(&hnm->buffer2)",
          "new_text": null,
          "old_line_content": "        av_freep(&hnm->buffer2);",
          "new_line_content": "        || avctx->height % 2) {",
          "content_same": false
        },
        {
          "line": 366,
          "old_api": "bytestream2_init",
          "new_api": null,
          "old_text": "bytestream2_init(&gb, src + 8, size - 8)",
          "new_text": null,
          "old_line_content": "    bytestream2_init(&gb, src + 8, size - 8);",
          "new_line_content": "    eight_bit_colors = src[7] & 0x80 && hnm->version == 0x4a;",
          "content_same": false
        },
        {
          "line": 368,
          "old_api": "bytestream2_tell",
          "new_api": null,
          "old_text": "bytestream2_tell(&gb)",
          "new_text": null,
          "old_line_content": "    while (bytestream2_tell(&gb) < size - 8) {",
          "new_line_content": "    // skip first 8 bytes",
          "content_same": false
        },
        {
          "line": 370,
          "old_api": "bytestream2_get_byte",
          "new_api": null,
          "old_text": "bytestream2_get_byte(&gb)",
          "new_text": null,
          "old_line_content": "        count = bytestream2_get_byte(&gb);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 502,
          "old_api": "av_freep",
          "new_api": null,
          "old_text": "av_freep(&hnm->buffer1)",
          "new_text": null,
          "old_line_content": "    av_freep(&hnm->buffer1);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 503,
          "old_api": "av_freep",
          "new_api": null,
          "old_text": "av_freep(&hnm->buffer2)",
          "new_text": null,
          "old_line_content": "    av_freep(&hnm->buffer2);",
          "new_line_content": "    Hnm4VideoContext *hnm = avctx->priv_data;",
          "content_same": false
        },
        {
          "line": 504,
          "old_api": "av_freep",
          "new_api": null,
          "old_text": "av_freep(&hnm->processed)",
          "new_text": null,
          "old_line_content": "    av_freep(&hnm->processed);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 377,
          "old_api": "bytestream2_get_be24",
          "new_api": null,
          "old_text": "bytestream2_get_be24(&gb)",
          "new_text": null,
          "old_line_content": "            hnm->palette[writeoffset] = bytestream2_get_be24(&gb);",
          "new_line_content": "            count = 256;",
          "content_same": false
        },
        {
          "line": 511,
          "old_api": "NULL_IF_CONFIG_SMALL",
          "new_api": null,
          "old_text": "NULL_IF_CONFIG_SMALL(\"HNM 4 video\")",
          "new_text": null,
          "old_line_content": "    .long_name      = NULL_IF_CONFIG_SMALL(\"HNM 4 video\"),",
          "new_line_content": "",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 25,
      "total_additions": 50,
      "total_deletions": 50,
      "total_api_changes": 125
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 9,
        "api_related_lines": 125,
        "non_api_lines": 9,
        "non_api_line_numbers": [
          128,
          129,
          130,
          120,
          121,
          124,
          125,
          126,
          127
        ]
      }
    },
    "api_calls_before": 95,
    "api_calls_after": 95,
    "diff_info": {
      "added_lines": 8,
      "removed_lines": 5,
      "total_diff_lines": 28
    }
  }
}