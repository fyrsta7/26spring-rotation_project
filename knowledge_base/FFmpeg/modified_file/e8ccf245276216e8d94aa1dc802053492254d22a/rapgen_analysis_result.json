{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/e8ccf245276216e8d94aa1dc802053492254d22a",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/e8ccf245276216e8d94aa1dc802053492254d22a/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/e8ccf245276216e8d94aa1dc802053492254d22a/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/e8ccf245276216e8d94aa1dc802053492254d22a/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 947,
          "old_api": "bytestream_get_be24",
          "new_api": "bytestream_get_byte",
          "old_text": "bytestream_get_be24(&buf_temp)",
          "new_text": "bytestream_get_byte(&buf_temp)",
          "old_line_content": "            pktsize = bytestream_get_be24(&buf_temp);",
          "new_line_content": "            pkttype = bytestream_get_byte(&buf_temp);",
          "content_same": false
        },
        {
          "line": 949,
          "old_api": "bytestream_get_byte",
          "new_api": "bytestream_get_be24",
          "old_text": "bytestream_get_byte(&buf_temp)",
          "new_text": "bytestream_get_be24(&buf_temp)",
          "old_line_content": "            ts |= bytestream_get_byte(&buf_temp) << 24;",
          "new_line_content": "            ts = bytestream_get_be24(&buf_temp);",
          "content_same": false
        },
        {
          "line": 950,
          "old_api": "bytestream_get_be24",
          "new_api": "bytestream_get_byte",
          "old_text": "bytestream_get_be24(&buf_temp)",
          "new_text": "bytestream_get_byte(&buf_temp)",
          "old_line_content": "            bytestream_get_be24(&buf_temp);",
          "new_line_content": "            ts |= bytestream_get_byte(&buf_temp) << 24;",
          "content_same": false
        },
        {
          "line": 983,
          "old_api": "ff_rtmp_packet_destroy",
          "new_api": "ff_rtmp_packet_write",
          "old_text": "ff_rtmp_packet_destroy(&rt->out_pkt)",
          "new_text": "ff_rtmp_packet_write(rt->stream, &rt->out_pkt, rt->chunk_size, rt->prev_pkt[1])",
          "old_line_content": "            ff_rtmp_packet_destroy(&rt->out_pkt);",
          "new_line_content": "            ff_rtmp_packet_write(rt->stream, &rt->out_pkt, rt->chunk_size, rt->prev_pkt[1]);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 964,
          "old_api": null,
          "new_api": "ff_rtmp_packet_create",
          "old_text": null,
          "new_text": "ff_rtmp_packet_create(&rt->out_pkt, RTMP_SOURCE_CHANNEL, pkttype, ts, pktsize)",
          "old_line_content": "            rt->out_pkt.extra = rt->main_channel_id;",
          "new_line_content": "            ff_rtmp_packet_create(&rt->out_pkt, RTMP_SOURCE_CHANNEL, pkttype, ts, pktsize);",
          "content_same": false
        },
        {
          "line": 935,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(LOG_CONTEXT, AV_LOG_DEBUG, \"FLV packet too small %d\\n\", size)",
          "old_line_content": "        return 0;",
          "new_line_content": "        av_log(LOG_CONTEXT, AV_LOG_DEBUG, \"FLV packet too small %d\\n\", size);",
          "content_same": false
        },
        {
          "line": 969,
          "old_api": null,
          "new_api": "ff_amf_write_string",
          "old_text": null,
          "new_text": "ff_amf_write_string(&rt->flv_data, \"@setDataFrame\")",
          "old_line_content": "        }",
          "new_line_content": "                ff_amf_write_string(&rt->flv_data, \"@setDataFrame\");",
          "content_same": false
        },
        {
          "line": 973,
          "old_api": null,
          "new_api": "bytestream_get_buffer",
          "old_text": null,
          "new_text": "bytestream_get_buffer(&buf_temp, rt->flv_data + rt->flv_off, size_temp)",
          "old_line_content": "            rt->flv_off += size_temp;",
          "new_line_content": "            bytestream_get_buffer(&buf_temp, rt->flv_data + rt->flv_off, size_temp);",
          "content_same": false
        },
        {
          "line": 976,
          "old_api": null,
          "new_api": "bytestream_get_buffer",
          "old_text": null,
          "new_text": "bytestream_get_buffer(&buf_temp, rt->flv_data + rt->flv_off, rt->flv_size - rt->flv_off)",
          "old_line_content": "            rt->flv_off += rt->flv_size - rt->flv_off;",
          "new_line_content": "            bytestream_get_buffer(&buf_temp, rt->flv_data + rt->flv_off, rt->flv_size - rt->flv_off);",
          "content_same": false
        },
        {
          "line": 984,
          "old_api": null,
          "new_api": "ff_rtmp_packet_destroy",
          "old_text": null,
          "new_text": "ff_rtmp_packet_destroy(&rt->out_pkt)",
          "old_line_content": "            rt->flv_size = 0;",
          "new_line_content": "            ff_rtmp_packet_destroy(&rt->out_pkt);",
          "content_same": false
        },
        {
          "line": 981,
          "old_api": null,
          "new_api": "bytestream_get_be32",
          "old_text": null,
          "new_text": "bytestream_get_be32(&buf_temp)",
          "old_line_content": "",
          "new_line_content": "            bytestream_get_be32(&buf_temp);",
          "content_same": false
        },
        {
          "line": 951,
          "old_api": null,
          "new_api": "bytestream_get_be24",
          "old_text": null,
          "new_text": "bytestream_get_be24(&buf_temp)",
          "old_line_content": "            size_temp -= 11;",
          "new_line_content": "            bytestream_get_be24(&buf_temp);",
          "content_same": false
        },
        {
          "line": 920,
          "old_api": null,
          "new_api": "get_packet",
          "old_text": null,
          "new_text": "get_packet(s, 0)",
          "old_line_content": "           return ret;",
          "new_line_content": "        if ((ret = get_packet(s, 0)) < 0)",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 963,
          "old_api": "ff_rtmp_packet_create",
          "new_api": null,
          "old_text": "ff_rtmp_packet_create(&rt->out_pkt, RTMP_SOURCE_CHANNEL, pkttype, ts, pktsize)",
          "new_text": null,
          "old_line_content": "            ff_rtmp_packet_create(&rt->out_pkt, RTMP_SOURCE_CHANNEL, pkttype, ts, pktsize);",
          "new_line_content": "            //this can be a big packet, it's better to send it right here",
          "content_same": false
        },
        {
          "line": 934,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(LOG_CONTEXT, AV_LOG_DEBUG, \"FLV packet too small %d\\n\", size)",
          "new_text": null,
          "old_line_content": "        av_log(LOG_CONTEXT, AV_LOG_DEBUG, \"FLV packet too small %d\\n\", size);",
          "new_line_content": "    if (size < 11) {",
          "content_same": false
        },
        {
          "line": 968,
          "old_api": "ff_amf_write_string",
          "new_api": null,
          "old_text": "ff_amf_write_string(&rt->flv_data, \"@setDataFrame\")",
          "new_text": null,
          "old_line_content": "                ff_amf_write_string(&rt->flv_data, \"@setDataFrame\");",
          "new_line_content": "            if (pkttype == RTMP_PT_NOTIFY)",
          "content_same": false
        },
        {
          "line": 972,
          "old_api": "bytestream_get_buffer",
          "new_api": null,
          "old_text": "bytestream_get_buffer(&buf_temp, rt->flv_data + rt->flv_off, size_temp)",
          "new_text": null,
          "old_line_content": "            bytestream_get_buffer(&buf_temp, rt->flv_data + rt->flv_off, size_temp);",
          "new_line_content": "        if (rt->flv_size - rt->flv_off > size_temp) {",
          "content_same": false
        },
        {
          "line": 975,
          "old_api": "bytestream_get_buffer",
          "new_api": null,
          "old_text": "bytestream_get_buffer(&buf_temp, rt->flv_data + rt->flv_off, rt->flv_size - rt->flv_off)",
          "new_text": null,
          "old_line_content": "            bytestream_get_buffer(&buf_temp, rt->flv_data + rt->flv_off, rt->flv_size - rt->flv_off);",
          "new_line_content": "        } else {",
          "content_same": false
        },
        {
          "line": 946,
          "old_api": "bytestream_get_byte",
          "new_api": null,
          "old_text": "bytestream_get_byte(&buf_temp)",
          "new_text": null,
          "old_line_content": "            pkttype = bytestream_get_byte(&buf_temp);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 980,
          "old_api": "bytestream_get_be32",
          "new_api": null,
          "old_text": "bytestream_get_be32(&buf_temp)",
          "new_text": null,
          "old_line_content": "            bytestream_get_be32(&buf_temp);",
          "new_line_content": "        if (rt->flv_off == rt->flv_size) {",
          "content_same": false
        },
        {
          "line": 982,
          "old_api": "ff_rtmp_packet_write",
          "new_api": null,
          "old_text": "ff_rtmp_packet_write(rt->stream, &rt->out_pkt, rt->chunk_size, rt->prev_pkt[1])",
          "new_text": null,
          "old_line_content": "            ff_rtmp_packet_write(rt->stream, &rt->out_pkt, rt->chunk_size, rt->prev_pkt[1]);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 919,
          "old_api": "get_packet",
          "new_api": null,
          "old_text": "get_packet(s, 0)",
          "new_text": null,
          "old_line_content": "        if ((ret = get_packet(s, 0)) < 0)",
          "new_line_content": "        }",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 4,
      "total_additions": 9,
      "total_deletions": 9,
      "total_api_changes": 22
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 1,
        "api_related_lines": 22,
        "non_api_lines": 1,
        "non_api_line_numbers": [
          918
        ]
      }
    },
    "api_calls_before": 262,
    "api_calls_after": 262,
    "diff_info": {
      "added_lines": 1,
      "removed_lines": 0,
      "total_diff_lines": 13
    }
  }
}