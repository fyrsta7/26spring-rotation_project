{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/17e6d7b4008fa499892716cd095a364a42a3fba8",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/17e6d7b4008fa499892716cd095a364a42a3fba8/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/17e6d7b4008fa499892716cd095a364a42a3fba8/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/17e6d7b4008fa499892716cd095a364a42a3fba8/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [],
      "additions": [
        {
          "line": 160,
          "old_api": null,
          "new_api": "ff_fill_rgba_map",
          "old_text": null,
          "new_text": "ff_fill_rgba_map(rgba_map, inlink->format)",
          "old_line_content": "        for (i = 0; i < 4; i++)",
          "new_line_content": "        ff_fill_rgba_map(rgba_map, inlink->format);",
          "content_same": false
        },
        {
          "line": 289,
          "old_api": null,
          "new_api": "av_freep",
          "old_text": null,
          "new_text": "av_freep(&ctx->output_pads[i].name)",
          "old_line_content": "}",
          "new_line_content": "        av_freep(&ctx->output_pads[i].name);",
          "content_same": false
        },
        {
          "line": 225,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(ENOMEM)",
          "old_line_content": "            break;",
          "new_line_content": "            ret = AVERROR(ENOMEM);",
          "content_same": false
        },
        {
          "line": 323,
          "old_api": null,
          "new_api": "init",
          "old_text": null,
          "new_text": "init(ctx)",
          "old_line_content": "}",
          "new_line_content": "    return init(ctx);",
          "content_same": false
        },
        {
          "line": 228,
          "old_api": null,
          "new_api": "av_frame_copy_props",
          "old_text": null,
          "new_text": "av_frame_copy_props(out, frame)",
          "old_line_content": "",
          "new_line_content": "        av_frame_copy_props(out, frame);",
          "content_same": false
        },
        {
          "line": 231,
          "old_api": null,
          "new_api": "extract_from_packed",
          "old_text": null,
          "new_text": "extract_from_packed(out->data[0], out->linesize[0],\n                                frame->data[0], frame->linesize[0],\n                                outlink->w, outlink->h,\n                                s->depth,\n                                s->step, idx)",
          "old_line_content": "                                frame->data[0], frame->linesize[0],",
          "new_line_content": "            extract_from_packed(out->data[0], out->linesize[0],",
          "content_same": false
        },
        {
          "line": 328,
          "old_api": null,
          "new_api": "NULL_IF_CONFIG_SMALL",
          "old_text": null,
          "new_text": "NULL_IF_CONFIG_SMALL(\"Extract an alpha channel as a \"\n                      \"grayscale image component.\")",
          "old_line_content": "                      \"grayscale image component.\"),",
          "new_line_content": "    .description    = NULL_IF_CONFIG_SMALL(\"Extract an alpha channel as a \"",
          "content_same": false
        },
        {
          "line": 173,
          "old_api": null,
          "new_api": "av_pix_fmt_desc_get",
          "old_text": null,
          "new_text": "av_pix_fmt_desc_get(inlink->format)",
          "old_line_content": "    const int output = outlink->srcpad - ctx->output_pads;",
          "new_line_content": "    const AVPixFmtDescriptor *desc = av_pix_fmt_desc_get(inlink->format);",
          "content_same": false
        },
        {
          "line": 270,
          "old_api": null,
          "new_api": "av_asprintf",
          "old_text": null,
          "new_text": "av_asprintf(\"out%d\", ctx->nb_outputs)",
          "old_line_content": "        if (!name)",
          "new_line_content": "        name = av_asprintf(\"out%d\", ctx->nb_outputs);",
          "content_same": false
        },
        {
          "line": 237,
          "old_api": null,
          "new_api": "av_image_copy_plane",
          "old_text": null,
          "new_text": "av_image_copy_plane(out->data[0], out->linesize[0],\n                                frame->data[idx], frame->linesize[idx],\n                                s->linesize[idx], outlink->h)",
          "old_line_content": "                                frame->data[idx], frame->linesize[idx],",
          "new_line_content": "            av_image_copy_plane(out->data[0], out->linesize[0],",
          "content_same": false
        },
        {
          "line": 272,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(ENOMEM)",
          "old_line_content": "        s->map[ctx->nb_outputs] = i;",
          "new_line_content": "            return AVERROR(ENOMEM);",
          "content_same": false
        },
        {
          "line": 304,
          "old_api": null,
          "new_api": "NULL_IF_CONFIG_SMALL",
          "old_text": null,
          "new_text": "NULL_IF_CONFIG_SMALL(\"Extract planes as grayscale frames.\")",
          "old_line_content": "    .priv_size     = sizeof(ExtractPlanesContext),",
          "new_line_content": "    .description   = NULL_IF_CONFIG_SMALL(\"Extract planes as grayscale frames.\"),",
          "content_same": false
        },
        {
          "line": 178,
          "old_api": null,
          "new_api": "FF_CEIL_RSHIFT",
          "old_text": null,
          "new_text": "FF_CEIL_RSHIFT(inlink->w, desc->log2_chroma_w)",
          "old_line_content": "    }",
          "new_line_content": "        outlink->w = FF_CEIL_RSHIFT(inlink->w, desc->log2_chroma_w);",
          "content_same": false
        },
        {
          "line": 242,
          "old_api": null,
          "new_api": "ff_filter_frame",
          "old_text": null,
          "new_text": "ff_filter_frame(outlink, out)",
          "old_line_content": "        if (ret == AVERROR_EOF)",
          "new_line_content": "        ret = ff_filter_frame(outlink, out);",
          "content_same": false
        },
        {
          "line": 278,
          "old_api": null,
          "new_api": "ff_insert_outpad",
          "old_text": null,
          "new_text": "ff_insert_outpad(ctx, ctx->nb_outputs, &pad)",
          "old_line_content": "    }",
          "new_line_content": "        ff_insert_outpad(ctx, ctx->nb_outputs, &pad);",
          "content_same": false
        },
        {
          "line": 248,
          "old_api": null,
          "new_api": "av_frame_free",
          "old_text": null,
          "new_text": "av_frame_free(&frame)",
          "old_line_content": "",
          "new_line_content": "    av_frame_free(&frame);",
          "content_same": false
        },
        {
          "line": 223,
          "old_api": null,
          "new_api": "ff_get_video_buffer",
          "old_text": null,
          "new_text": "ff_get_video_buffer(outlink, outlink->w, outlink->h)",
          "old_line_content": "        if (!out) {",
          "new_line_content": "        out = ff_get_video_buffer(outlink, outlink->w, outlink->h);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 288,
          "old_api": "av_freep",
          "new_api": null,
          "old_text": "av_freep(&ctx->output_pads[i].name)",
          "new_text": null,
          "old_line_content": "        av_freep(&ctx->output_pads[i].name);",
          "new_line_content": "    for (i = 0; i < ctx->nb_outputs; i++)",
          "content_same": false
        },
        {
          "line": 224,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(ENOMEM)",
          "new_text": null,
          "old_line_content": "            ret = AVERROR(ENOMEM);",
          "new_line_content": "        if (!out) {",
          "content_same": false
        },
        {
          "line": 322,
          "old_api": "init",
          "new_api": null,
          "old_text": "init(ctx)",
          "new_text": null,
          "old_line_content": "    return init(ctx);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 227,
          "old_api": "av_frame_copy_props",
          "new_api": null,
          "old_text": "av_frame_copy_props(out, frame)",
          "new_text": null,
          "old_line_content": "        av_frame_copy_props(out, frame);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 230,
          "old_api": "extract_from_packed",
          "new_api": null,
          "old_text": "extract_from_packed(out->data[0], out->linesize[0],\n                                frame->data[0], frame->linesize[0],\n                                outlink->w, outlink->h,\n                                s->depth,\n                                s->step, idx)",
          "new_text": null,
          "old_line_content": "            extract_from_packed(out->data[0], out->linesize[0],",
          "new_line_content": "        if (s->is_packed) {",
          "content_same": false
        },
        {
          "line": 327,
          "old_api": "NULL_IF_CONFIG_SMALL",
          "new_api": null,
          "old_text": "NULL_IF_CONFIG_SMALL(\"Extract an alpha channel as a \"\n                      \"grayscale image component.\")",
          "new_text": null,
          "old_line_content": "    .description    = NULL_IF_CONFIG_SMALL(\"Extract an alpha channel as a \"",
          "new_line_content": "    .name           = \"alphaextract\",",
          "content_same": false
        },
        {
          "line": 172,
          "old_api": "av_pix_fmt_desc_get",
          "new_api": null,
          "old_text": "av_pix_fmt_desc_get(inlink->format)",
          "new_text": null,
          "old_line_content": "    const AVPixFmtDescriptor *desc = av_pix_fmt_desc_get(inlink->format);",
          "new_line_content": "    ExtractPlanesContext *s = ctx->priv;",
          "content_same": false
        },
        {
          "line": 269,
          "old_api": "av_asprintf",
          "new_api": null,
          "old_text": "av_asprintf(\"out%d\", ctx->nb_outputs)",
          "new_text": null,
          "old_line_content": "        name = av_asprintf(\"out%d\", ctx->nb_outputs);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 236,
          "old_api": "av_image_copy_plane",
          "new_api": null,
          "old_text": "av_image_copy_plane(out->data[0], out->linesize[0],\n                                frame->data[idx], frame->linesize[idx],\n                                s->linesize[idx], outlink->h)",
          "new_text": null,
          "old_line_content": "            av_image_copy_plane(out->data[0], out->linesize[0],",
          "new_line_content": "        } else {",
          "content_same": false
        },
        {
          "line": 271,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(ENOMEM)",
          "new_text": null,
          "old_line_content": "            return AVERROR(ENOMEM);",
          "new_line_content": "        if (!name)",
          "content_same": false
        },
        {
          "line": 303,
          "old_api": "NULL_IF_CONFIG_SMALL",
          "new_api": null,
          "old_text": "NULL_IF_CONFIG_SMALL(\"Extract planes as grayscale frames.\")",
          "new_text": null,
          "old_line_content": "    .description   = NULL_IF_CONFIG_SMALL(\"Extract planes as grayscale frames.\"),",
          "new_line_content": "    .name          = \"extractplanes\",",
          "content_same": false
        },
        {
          "line": 176,
          "old_api": "FF_CEIL_RSHIFT",
          "new_api": null,
          "old_text": "FF_CEIL_RSHIFT(inlink->h, desc->log2_chroma_h)",
          "new_text": null,
          "old_line_content": "        outlink->h = FF_CEIL_RSHIFT(inlink->h, desc->log2_chroma_h);",
          "new_line_content": "    if (s->map[output] == 1 || s->map[output] == 2) {",
          "content_same": false
        },
        {
          "line": 241,
          "old_api": "ff_filter_frame",
          "new_api": null,
          "old_text": "ff_filter_frame(outlink, out)",
          "new_text": null,
          "old_line_content": "        ret = ff_filter_frame(outlink, out);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 277,
          "old_api": "ff_insert_outpad",
          "new_api": null,
          "old_text": "ff_insert_outpad(ctx, ctx->nb_outputs, &pad)",
          "new_text": null,
          "old_line_content": "        ff_insert_outpad(ctx, ctx->nb_outputs, &pad);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 247,
          "old_api": "av_frame_free",
          "new_api": null,
          "old_text": "av_frame_free(&frame)",
          "new_text": null,
          "old_line_content": "    av_frame_free(&frame);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 222,
          "old_api": "ff_get_video_buffer",
          "new_api": null,
          "old_text": "ff_get_video_buffer(outlink, outlink->w, outlink->h)",
          "new_text": null,
          "old_line_content": "        out = ff_get_video_buffer(outlink, outlink->w, outlink->h);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 159,
          "old_api": "ff_fill_rgba_map",
          "new_api": null,
          "old_text": "ff_fill_rgba_map(rgba_map, inlink->format)",
          "new_text": null,
          "old_line_content": "        ff_fill_rgba_map(rgba_map, inlink->format);",
          "new_line_content": "    if (desc->flags & AV_PIX_FMT_FLAG_RGB) {",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 0,
      "total_additions": 17,
      "total_deletions": 17,
      "total_api_changes": 34
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 2,
        "api_related_lines": 34,
        "non_api_lines": 2,
        "non_api_line_numbers": [
          157,
          158
        ]
      }
    },
    "api_calls_before": 33,
    "api_calls_after": 33,
    "diff_info": {
      "added_lines": 2,
      "removed_lines": 1,
      "total_diff_lines": 15
    }
  }
}