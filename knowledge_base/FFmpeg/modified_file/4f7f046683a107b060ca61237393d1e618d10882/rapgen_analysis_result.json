{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/4f7f046683a107b060ca61237393d1e618d10882",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/4f7f046683a107b060ca61237393d1e618d10882/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/4f7f046683a107b060ca61237393d1e618d10882/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/4f7f046683a107b060ca61237393d1e618d10882/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 198,
          "old_api": "ff_all_samplerates",
          "new_api": "ff_make_format_list",
          "old_text": "ff_all_samplerates()",
          "new_text": "ff_make_format_list(sample_fmts)",
          "old_line_content": "    formats = ff_all_samplerates();",
          "new_line_content": "    formats = ff_make_format_list(sample_fmts);",
          "content_same": false
        },
        {
          "line": 199,
          "old_api": "ff_formats_ref",
          "new_api": "ff_formats_ref         (formats, &inlink->outcfg.formats        )",
          "old_text": "ff_formats_ref(formats, &inlink->outcfg.samplerates)",
          "new_text": "ff_formats_ref         (formats, &inlink->outcfg.formats        )",
          "old_line_content": "    if ((ret = ff_formats_ref(formats, &inlink->outcfg.samplerates)) < 0)",
          "new_line_content": "    if ((ret = ff_formats_ref         (formats, &inlink->outcfg.formats        )) < 0 ||",
          "content_same": false
        },
        {
          "line": 258,
          "old_api": "memset",
          "new_api": "av_frame_free",
          "old_text": "memset(s->outpicref->data[0] + i * s->outpicref->linesize[0], 0, outlink->w * 4)",
          "new_text": "av_frame_free(&insamples)",
          "old_line_content": "            memset(s->outpicref->data[0] + i * s->outpicref->linesize[0], 0, outlink->w * 4);",
          "new_line_content": "            av_frame_free(&insamples);",
          "content_same": false
        },
        {
          "line": 314,
          "old_api": "FFABS",
          "new_api": "av_assert2",
          "old_text": "FFABS(src[1])",
          "new_text": "av_assert2(0)",
          "old_line_content": "            src[1] = FFSIGN(src[1]) * sqrtf(FFABS(src[1]));",
          "new_line_content": "            av_assert2(0);",
          "content_same": false
        },
        {
          "line": 353,
          "old_api": "draw_dot",
          "new_api": "sqrtf",
          "old_text": "draw_dot(s, x, y)",
          "new_text": "sqrtf(1 - 0.5 * sx * sx)",
          "old_line_content": "            draw_dot(s, x, y);",
          "new_line_content": "            cy = sy * sqrtf(1 - 0.5 * sx * sx);",
          "content_same": false
        },
        {
          "line": 355,
          "old_api": "draw_line",
          "new_api": "fabsf",
          "old_text": "draw_line(s, x, y, prev_x, prev_y)",
          "new_text": "fabsf(cx + cy)",
          "old_line_content": "            draw_line(s, x, y, prev_x, prev_y);",
          "new_line_content": "            y = s->h - s->h * fabsf(cx + cy) * .7;",
          "content_same": false
        },
        {
          "line": 368,
          "old_api": "ff_filter_frame",
          "new_api": "av_frame_free",
          "old_text": "ff_filter_frame(outlink, clone)",
          "new_text": "av_frame_free(&insamples)",
          "old_line_content": "    return ff_filter_frame(outlink, clone);",
          "new_line_content": "    av_frame_free(&insamples);",
          "content_same": false
        },
        {
          "line": 385,
          "old_api": "filter_frame",
          "new_api": "FF_FILTER_FORWARD_STATUS_BACK",
          "old_text": "filter_frame(inlink, in)",
          "new_text": "FF_FILTER_FORWARD_STATUS_BACK(outlink, inlink)",
          "old_line_content": "        return filter_frame(inlink, in);",
          "new_line_content": "    FF_FILTER_FORWARD_STATUS_BACK(outlink, inlink);",
          "content_same": false
        },
        {
          "line": 387,
          "old_api": "FF_FILTER_FORWARD_STATUS",
          "new_api": "ff_inlink_consume_samples",
          "old_text": "FF_FILTER_FORWARD_STATUS(inlink, outlink)",
          "new_text": "ff_inlink_consume_samples(inlink, s->nb_samples, s->nb_samples, &in)",
          "old_line_content": "    FF_FILTER_FORWARD_STATUS(inlink, outlink);",
          "new_line_content": "    ret = ff_inlink_consume_samples(inlink, s->nb_samples, s->nb_samples, &in);",
          "content_same": false
        },
        {
          "line": 424,
          "old_api": "FILTER_OUTPUTS",
          "new_api": "NULL_IF_CONFIG_SMALL",
          "old_text": "FILTER_OUTPUTS(audiovectorscope_outputs)",
          "new_text": "NULL_IF_CONFIG_SMALL(\"Convert input audio to vectorscope video output.\")",
          "old_line_content": "    FILTER_OUTPUTS(audiovectorscope_outputs),",
          "new_line_content": "    .description   = NULL_IF_CONFIG_SMALL(\"Convert input audio to vectorscope video output.\"),",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 256,
          "old_api": null,
          "new_api": "ff_get_video_buffer",
          "old_text": null,
          "new_text": "ff_get_video_buffer(outlink, outlink->w, outlink->h)",
          "old_line_content": "        s->outpicref->sample_aspect_ratio = (AVRational){1,1};",
          "new_line_content": "        s->outpicref = ff_get_video_buffer(outlink, outlink->w, outlink->h);",
          "content_same": false
        },
        {
          "line": 259,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(ENOMEM)",
          "old_line_content": "    }",
          "new_line_content": "            return AVERROR(ENOMEM);",
          "content_same": false
        },
        {
          "line": 391,
          "old_api": null,
          "new_api": "filter_frame",
          "old_text": null,
          "new_text": "filter_frame(inlink, in)",
          "old_line_content": "}",
          "new_line_content": "        return filter_frame(inlink, in);",
          "content_same": false
        },
        {
          "line": 264,
          "old_api": null,
          "new_api": "memset",
          "old_text": null,
          "new_text": "memset(s->outpicref->data[0] + i * s->outpicref->linesize[0], 0, outlink->w * 4)",
          "old_line_content": "    if (zoom < 1) {",
          "new_line_content": "            memset(s->outpicref->data[0] + i * s->outpicref->linesize[0], 0, outlink->w * 4);",
          "content_same": false
        },
        {
          "line": 393,
          "old_api": null,
          "new_api": "FF_FILTER_FORWARD_STATUS",
          "old_text": null,
          "new_text": "FF_FILTER_FORWARD_STATUS(inlink, outlink)",
          "old_line_content": "static av_cold void uninit(AVFilterContext *ctx)",
          "new_line_content": "    FF_FILTER_FORWARD_STATUS(inlink, outlink);",
          "content_same": false
        },
        {
          "line": 394,
          "old_api": null,
          "new_api": "FF_FILTER_FORWARD_WANTED",
          "old_text": null,
          "new_text": "FF_FILTER_FORWARD_WANTED(outlink, inlink)",
          "old_line_content": "{",
          "new_line_content": "    FF_FILTER_FORWARD_WANTED(outlink, inlink);",
          "content_same": false
        },
        {
          "line": 268,
          "old_api": null,
          "new_api": "fade",
          "old_text": null,
          "new_text": "fade(s)",
          "old_line_content": "        case AV_SAMPLE_FMT_S16: {",
          "new_line_content": "    fade(s);",
          "content_same": false
        },
        {
          "line": 403,
          "old_api": null,
          "new_api": "av_frame_free",
          "old_text": null,
          "new_text": "av_frame_free(&s->outpicref)",
          "old_line_content": "        .type         = AVMEDIA_TYPE_AUDIO,",
          "new_line_content": "    av_frame_free(&s->outpicref);",
          "content_same": false
        },
        {
          "line": 279,
          "old_api": null,
          "new_api": "FFABS",
          "old_text": null,
          "new_text": "FFABS(sample)",
          "old_line_content": "            float *samples = (float *)insamples->data[0];",
          "new_line_content": "                max = FFMAX(FFABS(sample), max);",
          "content_same": false
        },
        {
          "line": 288,
          "old_api": null,
          "new_api": "FFABS",
          "old_text": null,
          "new_text": "FFABS(samples[i])",
          "old_line_content": "        }",
          "new_line_content": "                max = FFMAX(FFABS(samples[i]), max);",
          "content_same": false
        },
        {
          "line": 293,
          "old_api": null,
          "new_api": "av_assert2",
          "old_text": null,
          "new_text": "av_assert2(0)",
          "old_line_content": "    for (i = 0; i < insamples->nb_samples; i++) {",
          "new_line_content": "            av_assert2(0);",
          "content_same": false
        },
        {
          "line": 170,
          "old_api": null,
          "new_api": "memset",
          "old_text": null,
          "new_text": "memset(s->outpicref->data[0] + i * s->outpicref->linesize[0], 0, s->outpicref->width * 4)",
          "old_line_content": "        for (i = 0; i < s->h; i++) {",
          "new_line_content": "            memset(s->outpicref->data[0] + i * s->outpicref->linesize[0], 0, s->outpicref->width * 4);",
          "content_same": false
        },
        {
          "line": 429,
          "old_api": null,
          "new_api": "FILTER_INPUTS",
          "old_text": null,
          "new_text": "FILTER_INPUTS(audiovectorscope_inputs)",
          "old_line_content": "",
          "new_line_content": "    FILTER_INPUTS(audiovectorscope_inputs),",
          "content_same": false
        },
        {
          "line": 430,
          "old_api": null,
          "new_api": "FILTER_OUTPUTS",
          "old_text": null,
          "new_text": "FILTER_OUTPUTS(audiovectorscope_outputs)",
          "old_line_content": "",
          "new_line_content": "    FILTER_OUTPUTS(audiovectorscope_outputs),",
          "content_same": false
        },
        {
          "line": 178,
          "old_api": null,
          "new_api": "FFMAX",
          "old_text": null,
          "new_text": "FFMAX(d[j+0] - s->fade[0], 0)",
          "old_line_content": "        }",
          "new_line_content": "                d[j+0] = FFMAX(d[j+0] - s->fade[0], 0);",
          "content_same": false
        },
        {
          "line": 179,
          "old_api": null,
          "new_api": "FFMAX",
          "old_text": null,
          "new_text": "FFMAX(d[j+1] - s->fade[1], 0)",
          "old_line_content": "    }",
          "new_line_content": "                d[j+1] = FFMAX(d[j+1] - s->fade[1], 0);",
          "content_same": false
        },
        {
          "line": 180,
          "old_api": null,
          "new_api": "FFMAX",
          "old_text": null,
          "new_text": "FFMAX(d[j+2] - s->fade[2], 0)",
          "old_line_content": "}",
          "new_line_content": "                d[j+2] = FFMAX(d[j+2] - s->fade[2], 0);",
          "content_same": false
        },
        {
          "line": 181,
          "old_api": null,
          "new_api": "FFMAX",
          "old_text": null,
          "new_text": "FFMAX(d[j+3] - s->fade[3], 0)",
          "old_line_content": "",
          "new_line_content": "                d[j+3] = FFMAX(d[j+3] - s->fade[3], 0);",
          "content_same": false
        },
        {
          "line": 319,
          "old_api": null,
          "new_api": "FFABS",
          "old_text": null,
          "new_text": "FFABS(src[0])",
          "old_line_content": "            break;",
          "new_line_content": "            src[0] = FFSIGN(src[0]) * sqrtf(FFABS(src[0]));",
          "content_same": false
        },
        {
          "line": 320,
          "old_api": null,
          "new_api": "FFABS",
          "old_text": null,
          "new_text": "FFABS(src[1])",
          "old_line_content": "        case LOG:",
          "new_line_content": "            src[1] = FFSIGN(src[1]) * sqrtf(FFABS(src[1]));",
          "content_same": false
        },
        {
          "line": 323,
          "old_api": null,
          "new_api": "FFABS",
          "old_text": null,
          "new_text": "FFABS(src[0])",
          "old_line_content": "            break;",
          "new_line_content": "            src[0] = FFSIGN(src[0]) * cbrtf(FFABS(src[0]));",
          "content_same": false
        },
        {
          "line": 324,
          "old_api": null,
          "new_api": "FFABS",
          "old_text": null,
          "new_text": "FFABS(src[1])",
          "old_line_content": "        }",
          "new_line_content": "            src[1] = FFSIGN(src[1]) * cbrtf(FFABS(src[1]));",
          "content_same": false
        },
        {
          "line": 327,
          "old_api": null,
          "new_api": "logf",
          "old_text": null,
          "new_text": "logf(2)",
          "old_line_content": "            src[0] = -src[0];",
          "new_line_content": "            src[0] = FFSIGN(src[0]) * logf(1 + FFABS(src[0])) / logf(2);",
          "content_same": false
        },
        {
          "line": 200,
          "old_api": null,
          "new_api": "ff_add_channel_layout  (&layout, AV_CH_LAYOUT_STEREO         )",
          "old_text": null,
          "new_text": "ff_add_channel_layout  (&layout, AV_CH_LAYOUT_STEREO         )",
          "old_line_content": "        return ret;",
          "new_line_content": "        (ret = ff_add_channel_layout  (&layout, AV_CH_LAYOUT_STEREO         )) < 0 ||",
          "content_same": false
        },
        {
          "line": 201,
          "old_api": null,
          "new_api": "ff_channel_layouts_ref (layout , &inlink->outcfg.channel_layouts)",
          "old_text": null,
          "new_text": "ff_channel_layouts_ref (layout , &inlink->outcfg.channel_layouts)",
          "old_line_content": "",
          "new_line_content": "        (ret = ff_channel_layouts_ref (layout , &inlink->outcfg.channel_layouts)) < 0)",
          "content_same": false
        },
        {
          "line": 328,
          "old_api": null,
          "new_api": "logf",
          "old_text": null,
          "new_text": "logf(2)",
          "old_line_content": "",
          "new_line_content": "            src[1] = FFSIGN(src[1]) * logf(1 + FFABS(src[1])) / logf(2);",
          "content_same": false
        },
        {
          "line": 204,
          "old_api": null,
          "new_api": "ff_all_samplerates",
          "old_text": null,
          "new_text": "ff_all_samplerates()",
          "old_line_content": "        return ret;",
          "new_line_content": "    formats = ff_all_samplerates();",
          "content_same": false
        },
        {
          "line": 205,
          "old_api": null,
          "new_api": "ff_formats_ref",
          "old_text": null,
          "new_text": "ff_formats_ref(formats, &inlink->outcfg.samplerates)",
          "old_line_content": "",
          "new_line_content": "    if ((ret = ff_formats_ref(formats, &inlink->outcfg.samplerates)) < 0)",
          "content_same": false
        },
        {
          "line": 208,
          "old_api": null,
          "new_api": "ff_make_format_list",
          "old_text": null,
          "new_text": "ff_make_format_list(pix_fmts)",
          "old_line_content": "",
          "new_line_content": "    formats = ff_make_format_list(pix_fmts);",
          "content_same": false
        },
        {
          "line": 209,
          "old_api": null,
          "new_api": "ff_formats_ref",
          "old_text": null,
          "new_text": "ff_formats_ref(formats, &outlink->incfg.formats)",
          "old_line_content": "static int config_input(AVFilterLink *inlink)",
          "new_line_content": "    if ((ret = ff_formats_ref(formats, &outlink->incfg.formats)) < 0)",
          "content_same": false
        },
        {
          "line": 339,
          "old_api": null,
          "new_api": "FFSWAP",
          "old_text": null,
          "new_text": "FFSWAP(float, src[0], src[1])",
          "old_line_content": "            x = (src[1] * zoom + 1) * hw;",
          "new_line_content": "            FFSWAP(float, src[0], src[1]);",
          "content_same": false
        },
        {
          "line": 220,
          "old_api": null,
          "new_api": "av_rescale",
          "old_text": null,
          "new_text": "av_rescale(inlink->sample_rate, s->frame_rate.den, s->frame_rate.num)",
          "old_line_content": "{",
          "new_line_content": "    s->nb_samples = FFMAX(1, av_rescale(inlink->sample_rate, s->frame_rate.den, s->frame_rate.num));",
          "content_same": false
        },
        {
          "line": 352,
          "old_api": null,
          "new_api": "sqrtf",
          "old_text": null,
          "new_text": "sqrtf(1 - 0.5 * sy * sy)",
          "old_line_content": "        if (s->draw == DOT) {",
          "new_line_content": "            cx = sx * sqrtf(1 - 0.5 * sy * sy);",
          "content_same": false
        },
        {
          "line": 354,
          "old_api": null,
          "new_api": "FFSIGN",
          "old_text": null,
          "new_text": "FFSIGN(cx + cy)",
          "old_line_content": "        } else {",
          "new_line_content": "            x = hw + hw * FFSIGN(cx + cy) * (cx - cy) * .7;",
          "content_same": false
        },
        {
          "line": 359,
          "old_api": null,
          "new_api": "draw_dot",
          "old_text": null,
          "new_text": "draw_dot(s, x, y)",
          "old_line_content": "    }",
          "new_line_content": "            draw_dot(s, x, y);",
          "content_same": false
        },
        {
          "line": 361,
          "old_api": null,
          "new_api": "draw_line",
          "old_text": null,
          "new_text": "draw_line(s, x, y, prev_x, prev_y)",
          "old_line_content": "    s->prev_x = x, s->prev_y = y;",
          "new_line_content": "            draw_line(s, x, y, prev_x, prev_y);",
          "content_same": false
        },
        {
          "line": 370,
          "old_api": null,
          "new_api": "av_frame_clone",
          "old_text": null,
          "new_text": "av_frame_clone(s->outpicref)",
          "old_line_content": "",
          "new_line_content": "    clone = av_frame_clone(s->outpicref);",
          "content_same": false
        },
        {
          "line": 372,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(ENOMEM)",
          "old_line_content": "{",
          "new_line_content": "        return AVERROR(ENOMEM);",
          "content_same": false
        },
        {
          "line": 374,
          "old_api": null,
          "new_api": "ff_filter_frame",
          "old_text": null,
          "new_text": "ff_filter_frame(outlink, clone)",
          "old_line_content": "    AVFilterLink *outlink = ctx->outputs[0];",
          "new_line_content": "    return ff_filter_frame(outlink, clone);",
          "content_same": false
        },
        {
          "line": 255,
          "old_api": null,
          "new_api": "av_frame_free",
          "old_text": null,
          "new_text": "av_frame_free(&s->outpicref)",
          "old_line_content": "",
          "new_line_content": "        av_frame_free(&s->outpicref);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 388,
          "old_api": "FF_FILTER_FORWARD_WANTED",
          "new_api": null,
          "old_text": "FF_FILTER_FORWARD_WANTED(outlink, inlink)",
          "new_text": null,
          "old_line_content": "    FF_FILTER_FORWARD_WANTED(outlink, inlink);",
          "new_line_content": "    if (ret < 0)",
          "content_same": false
        },
        {
          "line": 262,
          "old_api": "fade",
          "new_api": null,
          "old_text": "fade(s)",
          "new_text": null,
          "old_line_content": "    fade(s);",
          "new_line_content": "        s->outpicref->sample_aspect_ratio = (AVRational){1,1};",
          "content_same": false
        },
        {
          "line": 397,
          "old_api": "av_frame_free",
          "new_api": null,
          "old_text": "av_frame_free(&s->outpicref)",
          "new_text": null,
          "old_line_content": "    av_frame_free(&s->outpicref);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 273,
          "old_api": "FFABS",
          "new_api": null,
          "old_text": "FFABS(sample)",
          "new_text": null,
          "old_line_content": "                max = FFMAX(FFABS(sample), max);",
          "new_line_content": "        switch (insamples->format) {",
          "content_same": false
        },
        {
          "line": 282,
          "old_api": "FFABS",
          "new_api": null,
          "old_text": "FFABS(samples[i])",
          "new_text": null,
          "old_line_content": "                max = FFMAX(FFABS(samples[i]), max);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 287,
          "old_api": "av_assert2",
          "new_api": null,
          "old_text": "av_assert2(0)",
          "new_text": null,
          "old_line_content": "            av_assert2(0);",
          "new_line_content": "            for (i = 0; i < insamples->nb_samples * 2; i++) {",
          "content_same": false
        },
        {
          "line": 418,
          "old_api": "NULL_IF_CONFIG_SMALL",
          "new_api": null,
          "old_text": "NULL_IF_CONFIG_SMALL(\"Convert input audio to vectorscope video output.\")",
          "new_text": null,
          "old_line_content": "    .description   = NULL_IF_CONFIG_SMALL(\"Convert input audio to vectorscope video output.\"),",
          "new_line_content": "        .config_props = config_output,",
          "content_same": false
        },
        {
          "line": 423,
          "old_api": "FILTER_INPUTS",
          "new_api": null,
          "old_text": "FILTER_INPUTS(audiovectorscope_inputs)",
          "new_text": null,
          "old_line_content": "    FILTER_INPUTS(audiovectorscope_inputs),",
          "new_line_content": "    .name          = \"avectorscope\",",
          "content_same": false
        },
        {
          "line": 172,
          "old_api": "FFMAX",
          "new_api": null,
          "old_text": "FFMAX(d[j+0] - s->fade[0], 0)",
          "new_text": null,
          "old_line_content": "                d[j+0] = FFMAX(d[j+0] - s->fade[0], 0);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 173,
          "old_api": "FFMAX",
          "new_api": null,
          "old_text": "FFMAX(d[j+1] - s->fade[1], 0)",
          "new_text": null,
          "old_line_content": "                d[j+1] = FFMAX(d[j+1] - s->fade[1], 0);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 174,
          "old_api": "FFMAX",
          "new_api": null,
          "old_text": "FFMAX(d[j+2] - s->fade[2], 0)",
          "new_text": null,
          "old_line_content": "                d[j+2] = FFMAX(d[j+2] - s->fade[2], 0);",
          "new_line_content": "    if (s->fade[0] || s->fade[1] || s->fade[2]) {",
          "content_same": false
        },
        {
          "line": 175,
          "old_api": "FFMAX",
          "new_api": null,
          "old_text": "FFMAX(d[j+3] - s->fade[3], 0)",
          "new_text": null,
          "old_line_content": "                d[j+3] = FFMAX(d[j+3] - s->fade[3], 0);",
          "new_line_content": "        uint8_t *d = s->outpicref->data[0];",
          "content_same": false
        },
        {
          "line": 308,
          "old_api": "av_assert2",
          "new_api": null,
          "old_text": "av_assert2(0)",
          "new_text": null,
          "old_line_content": "            av_assert2(0);",
          "new_line_content": "            break;",
          "content_same": false
        },
        {
          "line": 313,
          "old_api": "FFABS",
          "new_api": null,
          "old_text": "FFABS(src[0])",
          "new_text": null,
          "old_line_content": "            src[0] = FFSIGN(src[0]) * sqrtf(FFABS(src[0]));",
          "new_line_content": "        default:",
          "content_same": false
        },
        {
          "line": 317,
          "old_api": "FFABS",
          "new_api": null,
          "old_text": "FFABS(src[0])",
          "new_text": null,
          "old_line_content": "            src[0] = FFSIGN(src[0]) * cbrtf(FFABS(src[0]));",
          "new_line_content": "        switch (s->scale) {",
          "content_same": false
        },
        {
          "line": 318,
          "old_api": "FFABS",
          "new_api": null,
          "old_text": "FFABS(src[1])",
          "new_text": null,
          "old_line_content": "            src[1] = FFSIGN(src[1]) * cbrtf(FFABS(src[1]));",
          "new_line_content": "        case SQRT:",
          "content_same": false
        },
        {
          "line": 192,
          "old_api": "ff_make_format_list",
          "new_api": null,
          "old_text": "ff_make_format_list(sample_fmts)",
          "new_text": null,
          "old_line_content": "    formats = ff_make_format_list(sample_fmts);",
          "new_line_content": "    AVFilterLink *inlink = ctx->inputs[0];",
          "content_same": false
        },
        {
          "line": 193,
          "old_api": "ff_formats_ref         (formats, &inlink->outcfg.formats        )",
          "new_api": null,
          "old_text": "ff_formats_ref         (formats, &inlink->outcfg.formats        )",
          "new_text": null,
          "old_line_content": "    if ((ret = ff_formats_ref         (formats, &inlink->outcfg.formats        )) < 0 ||",
          "new_line_content": "    AVFilterLink *outlink = ctx->outputs[0];",
          "content_same": false
        },
        {
          "line": 194,
          "old_api": "ff_add_channel_layout  (&layout, AV_CH_LAYOUT_STEREO         )",
          "new_api": null,
          "old_text": "ff_add_channel_layout  (&layout, AV_CH_LAYOUT_STEREO         )",
          "new_text": null,
          "old_line_content": "        (ret = ff_add_channel_layout  (&layout, AV_CH_LAYOUT_STEREO         )) < 0 ||",
          "new_line_content": "    static const enum AVSampleFormat sample_fmts[] = { AV_SAMPLE_FMT_S16, AV_SAMPLE_FMT_FLT, AV_SAMPLE_FMT_NONE };",
          "content_same": false
        },
        {
          "line": 195,
          "old_api": "ff_channel_layouts_ref (layout , &inlink->outcfg.channel_layouts)",
          "new_api": null,
          "old_text": "ff_channel_layouts_ref (layout , &inlink->outcfg.channel_layouts)",
          "new_text": null,
          "old_line_content": "        (ret = ff_channel_layouts_ref (layout , &inlink->outcfg.channel_layouts)) < 0)",
          "new_line_content": "    static const enum AVPixelFormat pix_fmts[] = { AV_PIX_FMT_RGBA, AV_PIX_FMT_NONE };",
          "content_same": false
        },
        {
          "line": 321,
          "old_api": "logf",
          "new_api": null,
          "old_text": "logf(2)",
          "new_text": null,
          "old_line_content": "            src[0] = FFSIGN(src[0]) * logf(1 + FFABS(src[0])) / logf(2);",
          "new_line_content": "            break;",
          "content_same": false
        },
        {
          "line": 322,
          "old_api": "logf",
          "new_api": null,
          "old_text": "logf(2)",
          "new_text": null,
          "old_line_content": "            src[1] = FFSIGN(src[1]) * logf(1 + FFABS(src[1])) / logf(2);",
          "new_line_content": "        case CBRT:",
          "content_same": false
        },
        {
          "line": 202,
          "old_api": "ff_make_format_list",
          "new_api": null,
          "old_text": "ff_make_format_list(pix_fmts)",
          "new_text": null,
          "old_line_content": "    formats = ff_make_format_list(pix_fmts);",
          "new_line_content": "        return ret;",
          "content_same": false
        },
        {
          "line": 203,
          "old_api": "ff_formats_ref",
          "new_api": null,
          "old_text": "ff_formats_ref(formats, &outlink->incfg.formats)",
          "new_text": null,
          "old_line_content": "    if ((ret = ff_formats_ref(formats, &outlink->incfg.formats)) < 0)",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 333,
          "old_api": "FFSWAP",
          "new_api": null,
          "old_text": "FFSWAP(float, src[0], src[1])",
          "new_text": null,
          "old_line_content": "            FFSWAP(float, src[0], src[1]);",
          "new_line_content": "            src[0] = -src[0];",
          "content_same": false
        },
        {
          "line": 214,
          "old_api": "av_rescale",
          "new_api": null,
          "old_text": "av_rescale(inlink->sample_rate, s->frame_rate.den, s->frame_rate.num)",
          "new_text": null,
          "old_line_content": "    s->nb_samples = FFMAX(1, av_rescale(inlink->sample_rate, s->frame_rate.den, s->frame_rate.num));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 346,
          "old_api": "sqrtf",
          "new_api": null,
          "old_text": "sqrtf(1 - 0.5 * sy * sy)",
          "new_text": null,
          "old_line_content": "            cx = sx * sqrtf(1 - 0.5 * sy * sy);",
          "new_line_content": "            y = (src[0] * zoom + 1) * hh;",
          "content_same": false
        },
        {
          "line": 347,
          "old_api": "sqrtf",
          "new_api": null,
          "old_text": "sqrtf(1 - 0.5 * sx * sx)",
          "new_text": null,
          "old_line_content": "            cy = sy * sqrtf(1 - 0.5 * sx * sx);",
          "new_line_content": "        } else {",
          "content_same": false
        },
        {
          "line": 348,
          "old_api": "FFSIGN",
          "new_api": null,
          "old_text": "FFSIGN(cx + cy)",
          "new_text": null,
          "old_line_content": "            x = hw + hw * FFSIGN(cx + cy) * (cx - cy) * .7;",
          "new_line_content": "            float sx, sy, cx, cy;",
          "content_same": false
        },
        {
          "line": 349,
          "old_api": "fabsf",
          "new_api": null,
          "old_text": "fabsf(cx + cy)",
          "new_text": null,
          "old_line_content": "            y = s->h - s->h * fabsf(cx + cy) * .7;",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 362,
          "old_api": "av_frame_free",
          "new_api": null,
          "old_text": "av_frame_free(&insamples)",
          "new_text": null,
          "old_line_content": "    av_frame_free(&insamples);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 364,
          "old_api": "av_frame_clone",
          "new_api": null,
          "old_text": "av_frame_clone(s->outpicref)",
          "new_text": null,
          "old_line_content": "    clone = av_frame_clone(s->outpicref);",
          "new_line_content": "        prev_y = y;",
          "content_same": false
        },
        {
          "line": 366,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(ENOMEM)",
          "new_text": null,
          "old_line_content": "        return AVERROR(ENOMEM);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 381,
          "old_api": "ff_inlink_consume_samples",
          "new_api": null,
          "old_text": "ff_inlink_consume_samples(inlink, s->nb_samples, s->nb_samples, &in)",
          "new_text": null,
          "old_line_content": "    ret = ff_inlink_consume_samples(inlink, s->nb_samples, s->nb_samples, &in);",
          "new_line_content": "    AudioVectorScopeContext *s = ctx->priv;",
          "content_same": false
        },
        {
          "line": 249,
          "old_api": "av_frame_free",
          "new_api": null,
          "old_text": "av_frame_free(&s->outpicref)",
          "new_text": null,
          "old_line_content": "        av_frame_free(&s->outpicref);",
          "new_line_content": "    unsigned prev_x = s->prev_x, prev_y = s->prev_y;",
          "content_same": false
        },
        {
          "line": 250,
          "old_api": "ff_get_video_buffer",
          "new_api": null,
          "old_text": "ff_get_video_buffer(outlink, outlink->w, outlink->h)",
          "new_text": null,
          "old_line_content": "        s->outpicref = ff_get_video_buffer(outlink, outlink->w, outlink->h);",
          "new_line_content": "    double zoom = s->zoom;",
          "content_same": false
        },
        {
          "line": 379,
          "old_api": "FF_FILTER_FORWARD_STATUS_BACK",
          "new_api": null,
          "old_text": "FF_FILTER_FORWARD_STATUS_BACK(outlink, inlink)",
          "new_text": null,
          "old_line_content": "    FF_FILTER_FORWARD_STATUS_BACK(outlink, inlink);",
          "new_line_content": "    AVFilterLink *inlink = ctx->inputs[0];",
          "content_same": false
        },
        {
          "line": 252,
          "old_api": "av_frame_free",
          "new_api": null,
          "old_text": "av_frame_free(&insamples)",
          "new_text": null,
          "old_line_content": "            av_frame_free(&insamples);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 253,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(ENOMEM)",
          "new_text": null,
          "old_line_content": "            return AVERROR(ENOMEM);",
          "new_line_content": "    if (!s->outpicref || s->outpicref->width  != outlink->w ||",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 10,
      "total_additions": 40,
      "total_deletions": 39,
      "total_api_changes": 89
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 6,
        "api_related_lines": 89,
        "non_api_lines": 3,
        "non_api_line_numbers": [
          168,
          169,
          171
        ]
      }
    },
    "api_calls_before": 95,
    "api_calls_after": 96,
    "diff_info": {
      "added_lines": 6,
      "removed_lines": 0,
      "total_diff_lines": 18
    }
  }
}