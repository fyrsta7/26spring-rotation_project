{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/e7b95918fca1c3d057d35f77ba58ee2d00d03151",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/e7b95918fca1c3d057d35f77ba58ee2d00d03151/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/e7b95918fca1c3d057d35f77ba58ee2d00d03151/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/e7b95918fca1c3d057d35f77ba58ee2d00d03151/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": true,
    "api_changes": {
      "replacements": [
        {
          "line": 181,
          "old_api": "av_lzo1x_decode",
          "new_api": "av_log",
          "old_text": "av_lzo1x_decode(c->decomp_buf, &outlen, buf, &inlen)",
          "new_text": "av_log(avctx, AV_LOG_ERROR, \"error during lzo decompression\\n\")",
          "old_line_content": "        if (av_lzo1x_decode(c->decomp_buf, &outlen, buf, &inlen))",
          "new_line_content": "            av_log(avctx, AV_LOG_ERROR, \"error during lzo decompression\\n\");",
          "content_same": false
        },
        {
          "line": 261,
          "old_api": "get_quant",
          "new_api": "dsputil_init",
          "old_text": "get_quant(avctx, c, avctx->extradata, avctx->extradata_size)",
          "new_text": "dsputil_init(&c->dsp, avctx)",
          "old_line_content": "        get_quant(avctx, c, avctx->extradata, avctx->extradata_size);",
          "new_line_content": "    dsputil_init(&c->dsp, avctx);",
          "content_same": false
        },
        {
          "line": 262,
          "old_api": "dsputil_init",
          "new_api": "codec_reinit",
          "old_text": "dsputil_init(&c->dsp, avctx)",
          "new_text": "codec_reinit(avctx, avctx->width, avctx->height, -1)",
          "old_line_content": "    dsputil_init(&c->dsp, avctx);",
          "new_line_content": "    if (!codec_reinit(avctx, avctx->width, avctx->height, -1))",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 258,
          "old_api": null,
          "new_api": "MKTAG",
          "old_text": null,
          "new_text": "MKTAG('R', 'J', 'P', 'G')",
          "old_line_content": "    c->height = 0;",
          "new_line_content": "    c->codec_frameheader = avctx->codec_tag == MKTAG('R', 'J', 'P', 'G');",
          "content_same": false
        },
        {
          "line": 260,
          "old_api": null,
          "new_api": "get_quant",
          "old_text": null,
          "new_text": "get_quant(avctx, c, avctx->extradata, avctx->extradata_size)",
          "old_line_content": "    if (avctx->extradata_size)",
          "new_line_content": "        get_quant(avctx, c, avctx->extradata, avctx->extradata_size);",
          "content_same": false
        },
        {
          "line": 269,
          "old_api": null,
          "new_api": "av_freep",
          "old_text": null,
          "new_text": "av_freep(&c->decomp_buf)",
          "old_line_content": "    NuvContext *c = avctx->priv_data;",
          "new_line_content": "    av_freep(&c->decomp_buf);",
          "content_same": false
        },
        {
          "line": 271,
          "old_api": null,
          "new_api": "release_buffer",
          "old_text": null,
          "new_text": "avctx->release_buffer(avctx, &c->pic)",
          "old_line_content": "    if (c->pic.data[0])",
          "new_line_content": "        avctx->release_buffer(avctx, &c->pic);",
          "content_same": false
        },
        {
          "line": 144,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(avctx, AV_LOG_ERROR, \"coded frame too small\\n\")",
          "old_line_content": "    if (buf_size < 12) {",
          "new_line_content": "        av_log(avctx, AV_LOG_ERROR, \"coded frame too small\\n\");",
          "content_same": false
        },
        {
          "line": 154,
          "old_api": null,
          "new_api": "get_quant",
          "old_text": null,
          "new_text": "get_quant(avctx, c, buf, buf_size)",
          "old_line_content": "        buf_size -= 12;",
          "new_line_content": "        ret = get_quant(avctx, c, buf, buf_size);",
          "content_same": false
        },
        {
          "line": 285,
          "old_api": null,
          "new_api": "NULL_IF_CONFIG_SMALL",
          "old_text": null,
          "new_text": "NULL_IF_CONFIG_SMALL(\"NuppelVideo/RTJPEG\")",
          "old_line_content": "    CODEC_CAP_DR1,",
          "new_line_content": "    .long_name = NULL_IF_CONFIG_SMALL(\"NuppelVideo/RTJPEG\"),",
          "content_same": false
        },
        {
          "line": 157,
          "old_api": null,
          "new_api": "rtjpeg_decode_init",
          "old_text": null,
          "new_text": "rtjpeg_decode_init(&c->rtj, &c->dsp, c->width, c->height, c->lq, c->cq)",
          "old_line_content": "            return ret;",
          "new_line_content": "        rtjpeg_decode_init(&c->rtj, &c->dsp, c->width, c->height, c->lq, c->cq);",
          "content_same": false
        },
        {
          "line": 162,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(avctx, AV_LOG_ERROR, \"not a nuv video frame\\n\")",
          "old_line_content": "    if (buf[0] != 'V' || buf_size < 12) {",
          "new_line_content": "        av_log(avctx, AV_LOG_ERROR, \"not a nuv video frame\\n\");",
          "content_same": false
        },
        {
          "line": 180,
          "old_api": null,
          "new_api": "av_lzo1x_decode",
          "old_text": null,
          "new_text": "av_lzo1x_decode(c->decomp_buf, &outlen, buf, &inlen)",
          "old_line_content": "        int outlen = c->decomp_size, inlen = buf_size;",
          "new_line_content": "        if (av_lzo1x_decode(c->decomp_buf, &outlen, buf, &inlen))",
          "content_same": false
        },
        {
          "line": 188,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(avctx, AV_LOG_ERROR, \"invalid nuv video frame\\n\")",
          "old_line_content": "        if (buf_size < 12) {",
          "new_line_content": "            av_log(avctx, AV_LOG_ERROR, \"invalid nuv video frame\\n\");",
          "content_same": false
        },
        {
          "line": 191,
          "old_api": null,
          "new_api": "AV_RL16",
          "old_text": null,
          "new_text": "AV_RL16(&buf[6])",
          "old_line_content": "        }",
          "new_line_content": "        w = AV_RL16(&buf[6]);",
          "content_same": false
        },
        {
          "line": 194,
          "old_api": null,
          "new_api": "codec_reinit",
          "old_text": null,
          "new_text": "codec_reinit(avctx, w, h, q)",
          "old_line_content": "        q = buf[10];",
          "new_line_content": "        if (!codec_reinit(avctx, w, h, q))",
          "content_same": false
        },
        {
          "line": 201,
          "old_api": null,
          "new_api": "release_buffer",
          "old_text": null,
          "new_text": "avctx->release_buffer(avctx, &c->pic)",
          "old_line_content": "    if (keyframe && c->pic.data[0])",
          "new_line_content": "        avctx->release_buffer(avctx, &c->pic);",
          "content_same": false
        },
        {
          "line": 205,
          "old_api": null,
          "new_api": "reget_buffer",
          "old_text": null,
          "new_text": "avctx->reget_buffer(avctx, &c->pic)",
          "old_line_content": "                          FF_BUFFER_HINTS_PRESERVE | FF_BUFFER_HINTS_REUSABLE;",
          "new_line_content": "    result = avctx->reget_buffer(avctx, &c->pic);",
          "content_same": false
        },
        {
          "line": 207,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(avctx, AV_LOG_ERROR, \"get_buffer() failed\\n\")",
          "old_line_content": "    if (result < 0) {",
          "new_line_content": "        av_log(avctx, AV_LOG_ERROR, \"get_buffer() failed\\n\");",
          "content_same": false
        },
        {
          "line": 219,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(avctx, AV_LOG_ERROR, \"uncompressed frame too short\\n\")",
          "old_line_content": "            if (buf_size < c->width * height * 3 / 2) {",
          "new_line_content": "                av_log(avctx, AV_LOG_ERROR, \"uncompressed frame too short\\n\");",
          "content_same": false
        },
        {
          "line": 222,
          "old_api": null,
          "new_api": "copy_frame",
          "old_text": null,
          "new_text": "copy_frame(&c->pic, buf, c->width, height)",
          "old_line_content": "            }",
          "new_line_content": "            copy_frame(&c->pic, buf, c->width, height);",
          "content_same": false
        },
        {
          "line": 227,
          "old_api": null,
          "new_api": "rtjpeg_decode_frame_yuv420",
          "old_text": null,
          "new_text": "rtjpeg_decode_frame_yuv420(&c->rtj, &c->pic, buf, buf_size)",
          "old_line_content": "        case NUV_RTJPEG: {",
          "new_line_content": "            rtjpeg_decode_frame_yuv420(&c->rtj, &c->pic, buf, buf_size);",
          "content_same": false
        },
        {
          "line": 231,
          "old_api": null,
          "new_api": "memset",
          "old_text": null,
          "new_text": "memset(c->pic.data[0], 0, c->width * c->height)",
          "old_line_content": "        case NUV_BLACK: {",
          "new_line_content": "            memset(c->pic.data[0], 0, c->width * c->height);",
          "content_same": false
        },
        {
          "line": 241,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(avctx, AV_LOG_ERROR, \"unknown compression\\n\")",
          "old_line_content": "        default:",
          "new_line_content": "            av_log(avctx, AV_LOG_ERROR, \"unknown compression\\n\");",
          "content_same": false
        },
        {
          "line": 119,
          "old_api": null,
          "new_api": "av_fast_malloc",
          "old_text": null,
          "new_text": "av_fast_malloc(&c->decomp_buf, &c->decomp_size, c->height * c->width * 3 / 2)",
          "old_line_content": "        c->decomp_size = c->height * c->width * 3 / 2;",
          "new_line_content": "        av_fast_malloc(&c->decomp_buf, &c->decomp_size, c->height * c->width * 3 / 2);",
          "content_same": false
        },
        {
          "line": 121,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(avctx, AV_LOG_ERROR, \"Can't allocate decompression buffer.\\n\")",
          "old_line_content": "        if (!c->decomp_buf) {",
          "new_line_content": "            av_log(avctx, AV_LOG_ERROR, \"Can't allocate decompression buffer.\\n\");",
          "content_same": false
        },
        {
          "line": 124,
          "old_api": null,
          "new_api": "rtjpeg_decode_init",
          "old_text": null,
          "new_text": "rtjpeg_decode_init(&c->rtj, &c->dsp, c->width, c->height, c->lq, c->cq)",
          "old_line_content": "        }",
          "new_line_content": "        rtjpeg_decode_init(&c->rtj, &c->dsp, c->width, c->height, c->lq, c->cq);",
          "content_same": false
        },
        {
          "line": 126,
          "old_api": null,
          "new_api": "rtjpeg_decode_init",
          "old_text": null,
          "new_text": "rtjpeg_decode_init(&c->rtj, &c->dsp, c->width, c->height, c->lq, c->cq)",
          "old_line_content": "    } else if (quality != c->quality)",
          "new_line_content": "        rtjpeg_decode_init(&c->rtj, &c->dsp, c->width, c->height, c->lq, c->cq);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 259,
          "old_api": "MKTAG",
          "new_api": null,
          "old_text": "MKTAG('R', 'J', 'P', 'G')",
          "new_text": null,
          "old_line_content": "    c->codec_frameheader = avctx->codec_tag == MKTAG('R', 'J', 'P', 'G');",
          "new_line_content": "    if (avctx->extradata_size)",
          "content_same": false
        },
        {
          "line": 263,
          "old_api": "codec_reinit",
          "new_api": null,
          "old_text": "codec_reinit(avctx, avctx->width, avctx->height, -1)",
          "new_text": null,
          "old_line_content": "    if (!codec_reinit(avctx, avctx->width, avctx->height, -1))",
          "new_line_content": "        return 1;",
          "content_same": false
        },
        {
          "line": 270,
          "old_api": "av_freep",
          "new_api": null,
          "old_text": "av_freep(&c->decomp_buf)",
          "new_text": null,
          "old_line_content": "    av_freep(&c->decomp_buf);",
          "new_line_content": "    if (c->pic.data[0])",
          "content_same": false
        },
        {
          "line": 272,
          "old_api": "release_buffer",
          "new_api": null,
          "old_text": "avctx->release_buffer(avctx, &c->pic)",
          "new_text": null,
          "old_line_content": "        avctx->release_buffer(avctx, &c->pic);",
          "new_line_content": "    return 0;",
          "content_same": false
        },
        {
          "line": 145,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(avctx, AV_LOG_ERROR, \"coded frame too small\\n\")",
          "new_text": null,
          "old_line_content": "        av_log(avctx, AV_LOG_ERROR, \"coded frame too small\\n\");",
          "new_line_content": "        return -1;",
          "content_same": false
        },
        {
          "line": 155,
          "old_api": "get_quant",
          "new_api": null,
          "old_text": "get_quant(avctx, c, buf, buf_size)",
          "new_text": null,
          "old_line_content": "        ret = get_quant(avctx, c, buf, buf_size);",
          "new_line_content": "        if (ret < 0)",
          "content_same": false
        },
        {
          "line": 158,
          "old_api": "rtjpeg_decode_init",
          "new_api": null,
          "old_text": "rtjpeg_decode_init(&c->rtj, &c->dsp, c->width, c->height, c->lq, c->cq)",
          "new_text": null,
          "old_line_content": "        rtjpeg_decode_init(&c->rtj, &c->dsp, c->width, c->height, c->lq, c->cq);",
          "new_line_content": "        return orig_size;",
          "content_same": false
        },
        {
          "line": 286,
          "old_api": "NULL_IF_CONFIG_SMALL",
          "new_api": null,
          "old_text": "NULL_IF_CONFIG_SMALL(\"NuppelVideo/RTJPEG\")",
          "new_text": null,
          "old_line_content": "    .long_name = NULL_IF_CONFIG_SMALL(\"NuppelVideo/RTJPEG\"),",
          "new_line_content": "};",
          "content_same": false
        },
        {
          "line": 163,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(avctx, AV_LOG_ERROR, \"not a nuv video frame\\n\")",
          "new_text": null,
          "old_line_content": "        av_log(avctx, AV_LOG_ERROR, \"not a nuv video frame\\n\");",
          "new_line_content": "        return -1;",
          "content_same": false
        },
        {
          "line": 182,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(avctx, AV_LOG_ERROR, \"error during lzo decompression\\n\")",
          "new_text": null,
          "old_line_content": "            av_log(avctx, AV_LOG_ERROR, \"error during lzo decompression\\n\");",
          "new_line_content": "        buf = c->decomp_buf;",
          "content_same": false
        },
        {
          "line": 189,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(avctx, AV_LOG_ERROR, \"invalid nuv video frame\\n\")",
          "new_text": null,
          "old_line_content": "            av_log(avctx, AV_LOG_ERROR, \"invalid nuv video frame\\n\");",
          "new_line_content": "            return -1;",
          "content_same": false
        },
        {
          "line": 193,
          "old_api": "AV_RL16",
          "new_api": null,
          "old_text": "AV_RL16(&buf[8])",
          "new_text": null,
          "old_line_content": "        h = AV_RL16(&buf[8]);",
          "new_line_content": "        q = buf[10];",
          "content_same": false
        },
        {
          "line": 195,
          "old_api": "codec_reinit",
          "new_api": null,
          "old_text": "codec_reinit(avctx, w, h, q)",
          "new_text": null,
          "old_line_content": "        if (!codec_reinit(avctx, w, h, q))",
          "new_line_content": "            return -1;",
          "content_same": false
        },
        {
          "line": 202,
          "old_api": "release_buffer",
          "new_api": null,
          "old_text": "avctx->release_buffer(avctx, &c->pic)",
          "new_text": null,
          "old_line_content": "        avctx->release_buffer(avctx, &c->pic);",
          "new_line_content": "    c->pic.reference = 3;",
          "content_same": false
        },
        {
          "line": 206,
          "old_api": "reget_buffer",
          "new_api": null,
          "old_text": "avctx->reget_buffer(avctx, &c->pic)",
          "new_text": null,
          "old_line_content": "    result = avctx->reget_buffer(avctx, &c->pic);",
          "new_line_content": "    if (result < 0) {",
          "content_same": false
        },
        {
          "line": 208,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(avctx, AV_LOG_ERROR, \"get_buffer() failed\\n\")",
          "new_text": null,
          "old_line_content": "        av_log(avctx, AV_LOG_ERROR, \"get_buffer() failed\\n\");",
          "new_line_content": "        return -1;",
          "content_same": false
        },
        {
          "line": 220,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(avctx, AV_LOG_ERROR, \"uncompressed frame too short\\n\")",
          "new_text": null,
          "old_line_content": "                av_log(avctx, AV_LOG_ERROR, \"uncompressed frame too short\\n\");",
          "new_line_content": "                height = buf_size / c->width / 3 * 2;",
          "content_same": false
        },
        {
          "line": 223,
          "old_api": "copy_frame",
          "new_api": null,
          "old_text": "copy_frame(&c->pic, buf, c->width, height)",
          "new_text": null,
          "old_line_content": "            copy_frame(&c->pic, buf, c->width, height);",
          "new_line_content": "            break;",
          "content_same": false
        },
        {
          "line": 228,
          "old_api": "rtjpeg_decode_frame_yuv420",
          "new_api": null,
          "old_text": "rtjpeg_decode_frame_yuv420(&c->rtj, &c->pic, buf, buf_size)",
          "new_text": null,
          "old_line_content": "            rtjpeg_decode_frame_yuv420(&c->rtj, &c->pic, buf, buf_size);",
          "new_line_content": "            break;",
          "content_same": false
        },
        {
          "line": 234,
          "old_api": "memset",
          "new_api": null,
          "old_text": "memset(c->pic.data[2], 128, c->width * c->height / 4)",
          "new_text": null,
          "old_line_content": "            memset(c->pic.data[2], 128, c->width * c->height / 4);",
          "new_line_content": "            break;",
          "content_same": false
        },
        {
          "line": 242,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(avctx, AV_LOG_ERROR, \"unknown compression\\n\")",
          "new_text": null,
          "old_line_content": "            av_log(avctx, AV_LOG_ERROR, \"unknown compression\\n\");",
          "new_line_content": "            return -1;",
          "content_same": false
        },
        {
          "line": 120,
          "old_api": "av_realloc",
          "new_api": null,
          "old_text": "av_realloc(c->decomp_buf, c->decomp_size + AV_LZO_OUTPUT_PADDING)",
          "new_text": null,
          "old_line_content": "        c->decomp_buf = av_realloc(c->decomp_buf, c->decomp_size + AV_LZO_OUTPUT_PADDING);",
          "new_line_content": "        if (!c->decomp_buf) {",
          "content_same": false
        },
        {
          "line": 122,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(avctx, AV_LOG_ERROR, \"Can't allocate decompression buffer.\\n\")",
          "new_text": null,
          "old_line_content": "            av_log(avctx, AV_LOG_ERROR, \"Can't allocate decompression buffer.\\n\");",
          "new_line_content": "            return 0;",
          "content_same": false
        },
        {
          "line": 125,
          "old_api": "rtjpeg_decode_init",
          "new_api": null,
          "old_text": "rtjpeg_decode_init(&c->rtj, &c->dsp, c->width, c->height, c->lq, c->cq)",
          "new_text": null,
          "old_line_content": "        rtjpeg_decode_init(&c->rtj, &c->dsp, c->width, c->height, c->lq, c->cq);",
          "new_line_content": "    } else if (quality != c->quality)",
          "content_same": false
        },
        {
          "line": 127,
          "old_api": "rtjpeg_decode_init",
          "new_api": null,
          "old_text": "rtjpeg_decode_init(&c->rtj, &c->dsp, c->width, c->height, c->lq, c->cq)",
          "new_text": null,
          "old_line_content": "        rtjpeg_decode_init(&c->rtj, &c->dsp, c->width, c->height, c->lq, c->cq);",
          "new_line_content": "    return 1;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 3,
      "total_additions": 25,
      "total_deletions": 25,
      "total_api_changes": 53
    },
    "non_api_changes": {
      "has_non_api_changes": false,
      "evidence": {
        "total_diff_lines": 2,
        "api_related_lines": 53,
        "non_api_lines": 0,
        "non_api_line_numbers": []
      }
    },
    "api_calls_before": 39,
    "api_calls_after": 39,
    "diff_info": {
      "added_lines": 1,
      "removed_lines": 2,
      "total_diff_lines": 15
    }
  }
}