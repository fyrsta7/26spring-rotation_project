{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/ff800903747325f15056444c11053279e391d60b",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/ff800903747325f15056444c11053279e391d60b/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/ff800903747325f15056444c11053279e391d60b/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/ff800903747325f15056444c11053279e391d60b/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 48,
          "old_api": "av_assert0",
          "new_api": "av_sat_dadd32",
          "old_text": "av_assert0(HAVE_MMX2 == HAVE_MMXEXT)",
          "new_text": "av_sat_dadd32(1, 2)",
          "old_line_content": "    av_assert0(HAVE_MMX2 == HAVE_MMXEXT);",
          "new_line_content": "    if (av_sat_dadd32(1, 2) != 5) {",
          "content_same": false
        },
        {
          "line": 50,
          "old_api": "av_assert0",
          "new_api": "abort",
          "old_text": "av_assert0(((size_t)-1) > 0)",
          "new_text": "abort()",
          "old_line_content": "    av_assert0(((size_t)-1) > 0); // C guarantees this but if false on a platform we care about revert at least b284e1ffe343d6697fb950d1ee517bafda8a9844",
          "new_line_content": "        abort();",
          "content_same": false
        },
        {
          "line": 53,
          "old_api": "av_log",
          "new_api": "llrint",
          "old_text": "av_log(NULL, AV_LOG_FATAL, \"Libavutil has been built with a broken binutils, please upgrade binutils and rebuild\\n\")",
          "new_text": "llrint(1LL<<60)",
          "old_line_content": "        av_log(NULL, AV_LOG_FATAL, \"Libavutil has been built with a broken binutils, please upgrade binutils and rebuild\\n\");",
          "new_line_content": "    if (llrint(1LL<<60) != 1LL<<60) {",
          "content_same": false
        },
        {
          "line": 54,
          "old_api": "abort",
          "new_api": "av_log",
          "old_text": "abort()",
          "new_text": "av_log(NULL, AV_LOG_ERROR, \"Libavutil has been linked to a broken llrint()\\n\")",
          "old_line_content": "        abort();",
          "new_line_content": "        av_log(NULL, AV_LOG_ERROR, \"Libavutil has been linked to a broken llrint()\\n\");",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 128,
          "old_api": null,
          "new_api": "snprintf",
          "old_text": null,
          "new_text": "snprintf(buf, buf_size, print_chr ? \"%c\" : \"[%d]\", c)",
          "old_line_content": "        const int c = fourcc & 0xff;",
          "new_line_content": "        const int len = snprintf(buf, buf_size, print_chr ? \"%c\" : \"[%d]\", c);",
          "content_same": false
        },
        {
          "line": 40,
          "old_api": null,
          "new_api": "av_assert0",
          "old_text": null,
          "new_text": "av_assert0(AV_SAMPLE_FMT_DBLP == 9)",
          "old_line_content": "    static int checks_done;",
          "new_line_content": "    av_assert0(AV_SAMPLE_FMT_DBLP == 9);",
          "content_same": false
        },
        {
          "line": 41,
          "old_api": null,
          "new_api": "av_assert0",
          "old_text": null,
          "new_text": "av_assert0(AVMEDIA_TYPE_ATTACHMENT == 4)",
          "old_line_content": "    if (checks_done)",
          "new_line_content": "    av_assert0(AVMEDIA_TYPE_ATTACHMENT == 4);",
          "content_same": false
        },
        {
          "line": 42,
          "old_api": null,
          "new_api": "av_assert0",
          "old_text": null,
          "new_text": "av_assert0(AV_PICTURE_TYPE_BI == 7)",
          "old_line_content": "        return LIBAVUTIL_VERSION_INT;",
          "new_line_content": "    av_assert0(AV_PICTURE_TYPE_BI == 7);",
          "content_same": false
        },
        {
          "line": 43,
          "old_api": null,
          "new_api": "av_assert0",
          "old_text": null,
          "new_text": "av_assert0(LIBAVUTIL_VERSION_MICRO >= 100)",
          "old_line_content": "",
          "new_line_content": "    av_assert0(LIBAVUTIL_VERSION_MICRO >= 100);",
          "content_same": false
        },
        {
          "line": 111,
          "old_api": null,
          "new_api": "av_assert0",
          "old_text": null,
          "new_text": "av_assert0(!\"valid element size\")",
          "old_line_content": "    switch (elsize) {",
          "new_line_content": "    default: av_assert0(!\"valid element size\");",
          "content_same": false
        },
        {
          "line": 49,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(NULL, AV_LOG_FATAL, \"Libavutil has been built with a broken binutils, please upgrade binutils and rebuild\\n\")",
          "old_line_content": "",
          "new_line_content": "        av_log(NULL, AV_LOG_FATAL, \"Libavutil has been built with a broken binutils, please upgrade binutils and rebuild\\n\");",
          "content_same": false
        },
        {
          "line": 153,
          "old_api": null,
          "new_api": "av_assert0",
          "old_text": null,
          "new_text": "av_assert0((state[4] & 3) == 3)",
          "old_line_content": "        \"fstenv %0 \\n\\t\"",
          "new_line_content": "    av_assert0((state[4] & 3) == 3);",
          "content_same": false
        },
        {
          "line": 127,
          "old_api": null,
          "new_api": "strchr",
          "old_text": null,
          "new_text": "strchr(\". -_\", c)",
          "old_line_content": "    for (i = 0; i < 4; i++) {",
          "new_line_content": "                              (c && strchr(\". -_\", c));",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 132,
          "old_api": "strchr",
          "new_api": null,
          "old_text": "strchr(\". -_\", c)",
          "new_text": null,
          "old_line_content": "                              (c && strchr(\". -_\", c));",
          "new_line_content": "        buf_size = buf_size > len ? buf_size - len : 0;",
          "content_same": false
        },
        {
          "line": 133,
          "old_api": "snprintf",
          "new_api": null,
          "old_text": "snprintf(buf, buf_size, print_chr ? \"%c\" : \"[%d]\", c)",
          "new_text": null,
          "old_line_content": "        const int len = snprintf(buf, buf_size, print_chr ? \"%c\" : \"[%d]\", c);",
          "new_line_content": "        fourcc >>= 8;",
          "content_same": false
        },
        {
          "line": 45,
          "old_api": "av_assert0",
          "new_api": null,
          "old_text": "av_assert0(AVMEDIA_TYPE_ATTACHMENT == 4)",
          "new_text": null,
          "old_line_content": "    av_assert0(AVMEDIA_TYPE_ATTACHMENT == 4);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 47,
          "old_api": "av_assert0",
          "new_api": null,
          "old_text": "av_assert0(LIBAVUTIL_VERSION_MICRO >= 100)",
          "new_text": null,
          "old_line_content": "    av_assert0(LIBAVUTIL_VERSION_MICRO >= 100);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 52,
          "old_api": "av_sat_dadd32",
          "new_api": null,
          "old_text": "av_sat_dadd32(1, 2)",
          "new_text": null,
          "old_line_content": "    if (av_sat_dadd32(1, 2) != 5) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 116,
          "old_api": "av_assert0",
          "new_api": null,
          "old_text": "av_assert0(!\"valid element size\")",
          "new_text": null,
          "old_line_content": "    default: av_assert0(!\"valid element size\");",
          "new_line_content": "char *av_fourcc_make_string(char *buf, uint32_t fourcc)",
          "content_same": false
        },
        {
          "line": 57,
          "old_api": "llrint",
          "new_api": null,
          "old_text": "llrint(1LL<<60)",
          "new_text": null,
          "old_line_content": "    if (llrint(1LL<<60) != 1LL<<60) {",
          "new_line_content": "    return LIBAVUTIL_VERSION_INT;",
          "content_same": false
        },
        {
          "line": 58,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(NULL, AV_LOG_ERROR, \"Libavutil has been linked to a broken llrint()\\n\")",
          "new_text": null,
          "old_line_content": "        av_log(NULL, AV_LOG_ERROR, \"Libavutil has been linked to a broken llrint()\\n\");",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 158,
          "old_api": "av_assert0",
          "new_api": null,
          "old_text": "av_assert0((state[4] & 3) == 3)",
          "new_text": null,
          "old_line_content": "    av_assert0((state[4] & 3) == 3);",
          "new_line_content": "",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 4,
      "total_additions": 9,
      "total_deletions": 9,
      "total_api_changes": 22
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 5,
        "api_related_lines": 22,
        "non_api_lines": 1,
        "non_api_line_numbers": [
          61
        ]
      }
    },
    "api_calls_before": 15,
    "api_calls_after": 15,
    "diff_info": {
      "added_lines": 0,
      "removed_lines": 5,
      "total_diff_lines": 24
    }
  }
}