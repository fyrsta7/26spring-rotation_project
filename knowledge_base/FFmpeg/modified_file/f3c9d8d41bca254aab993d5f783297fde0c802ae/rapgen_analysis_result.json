{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/f3c9d8d41bca254aab993d5f783297fde0c802ae",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/f3c9d8d41bca254aab993d5f783297fde0c802ae/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/f3c9d8d41bca254aab993d5f783297fde0c802ae/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/f3c9d8d41bca254aab993d5f783297fde0c802ae/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 660,
          "old_api": "swri_audio_convert",
          "new_api": "mix_2_1_simd",
          "old_text": "swri_audio_convert(s->out_convert, out, preout, out_count)",
          "new_text": "s->mix_2_1_simd(preout->ch[ch], preout->ch[ch], s->dither.ch[ch] + s->dither.bps * s->dither_pos, s->native_one, 0, 0, len1)",
          "old_line_content": "        swri_audio_convert(s->out_convert, out, preout, out_count);",
          "new_line_content": "                        s->mix_2_1_simd(preout->ch[ch], preout->ch[ch], s->dither.ch[ch] + s->dither.bps * s->dither_pos, s->native_one, 0, 0, len1);",
          "content_same": false
        },
        {
          "line": 715,
          "old_api": "FFMIN",
          "new_api": "fill_audiodata",
          "old_text": "FFMIN(out_count, s->in_buffer_count)",
          "new_text": "fill_audiodata(out, out_arg)",
          "old_line_content": "        size = FFMIN(out_count, s->in_buffer_count);",
          "new_line_content": "    fill_audiodata(out, out_arg);",
          "content_same": false
        },
        {
          "line": 796,
          "old_api": "av_freep",
          "new_api": "swri_realloc_audio",
          "old_text": "av_freep(&silence.data)",
          "new_text": "swri_realloc_audio(&silence, count)",
          "old_line_content": "    av_freep(&silence.data);",
          "new_line_content": "    if((ret=swri_realloc_audio(&silence, count))<0)",
          "content_same": false
        },
        {
          "line": 802,
          "old_api": "get_delay",
          "new_api": "memset",
          "old_text": "s->resampler->get_delay(s, base)",
          "new_text": "memset(silence.ch[0], silence.bps==1 ? 0x80 : 0, count*silence.bps*silence.ch_count)",
          "old_line_content": "        return s->resampler->get_delay(s, base);",
          "new_line_content": "        memset(silence.ch[0], silence.bps==1 ? 0x80 : 0, count*silence.bps*silence.ch_count);",
          "content_same": false
        },
        {
          "line": 843,
          "old_api": "av_log",
          "new_api": "swr_get_delay",
          "old_text": "av_log(s, AV_LOG_ERROR, \"Failed to compensate for timestamp delta of %f\\n\", fdelta)",
          "new_text": "swr_get_delay(s, s->in_sample_rate * (int64_t)s->out_sample_rate)",
          "old_line_content": "                    av_log(s, AV_LOG_ERROR, \"Failed to compensate for timestamp delta of %f\\n\", fdelta);",
          "new_line_content": "        return (s->outpts = pts - swr_get_delay(s, s->in_sample_rate * (int64_t)s->out_sample_rate));",
          "content_same": false
        },
        {
          "line": 848,
          "old_api": "av_clipf",
          "new_api": "fabs",
          "old_text": "av_clipf(fdelta, -max_soft_compensation, max_soft_compensation)",
          "new_text": "fabs(fdelta)",
          "old_line_content": "                int comp = av_clipf(fdelta, -max_soft_compensation, max_soft_compensation) * duration ;",
          "new_line_content": "        if(fabs(fdelta) > s->min_compensation) {",
          "content_same": false
        },
        {
          "line": 849,
          "old_api": "av_log",
          "new_api": "fabs",
          "old_text": "av_log(s, AV_LOG_VERBOSE, \"compensating audio timestamp drift:%f compensation:%d in:%d\\n\", fdelta, comp, duration)",
          "new_text": "fabs(fdelta)",
          "old_line_content": "                av_log(s, AV_LOG_VERBOSE, \"compensating audio timestamp drift:%f compensation:%d in:%d\\n\", fdelta, comp, duration);",
          "new_line_content": "            if(!s->outpts || fabs(fdelta) > s->min_hard_compensation){",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 782,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(s, AV_LOG_VERBOSE, \"discarding %d audio samples\\n\", count)",
          "old_line_content": "",
          "new_line_content": "    av_log(s, AV_LOG_VERBOSE, \"discarding %d audio samples\\n\", count);",
          "content_same": false
        },
        {
          "line": 783,
          "old_api": null,
          "new_api": "swr_convert",
          "old_text": null,
          "new_text": "swr_convert(s, NULL, s->drop_output, NULL, 0)",
          "old_line_content": "    silence.count = 0;",
          "new_line_content": "    return swr_convert(s, NULL, s->drop_output, NULL, 0);",
          "content_same": false
        },
        {
          "line": 663,
          "old_api": null,
          "new_api": "mix_2_1_f",
          "old_text": null,
          "new_text": "s->mix_2_1_f(preout->ch[ch] + off, preout->ch[ch] + off, s->dither.ch[ch] + s->dither.bps * s->dither_pos + off + len1, s->native_one, 0, 0, out_count - len1)",
          "old_line_content": "}",
          "new_line_content": "                        s->mix_2_1_f(preout->ch[ch] + off, preout->ch[ch] + off, s->dither.ch[ch] + s->dither.bps * s->dither_pos + off + len1, s->native_one, 0, 0, out_count - len1);",
          "content_same": false
        },
        {
          "line": 666,
          "old_api": null,
          "new_api": "mix_2_1_f",
          "old_text": null,
          "new_text": "s->mix_2_1_f(preout->ch[ch], preout->ch[ch], s->dither.ch[ch] + s->dither.bps * s->dither_pos, s->native_one, 0, 0, out_count)",
          "old_line_content": "                                const uint8_t *in_arg [SWR_CH_MAX], int  in_count){",
          "new_line_content": "                    s->mix_2_1_f(preout->ch[ch], preout->ch[ch], s->dither.ch[ch] + s->dither.bps * s->dither_pos, s->native_one, 0, 0, out_count);",
          "content_same": false
        },
        {
          "line": 671,
          "old_api": null,
          "new_api": "swri_audio_convert",
          "old_text": null,
          "new_text": "swri_audio_convert(s->out_convert, out, preout, out_count)",
          "old_line_content": "        int ret;",
          "new_line_content": "        swri_audio_convert(s->out_convert, out, preout, out_count);",
          "content_same": false
        },
        {
          "line": 800,
          "old_api": null,
          "new_api": "memset",
          "old_text": null,
          "new_text": "memset(silence.ch[i], silence.bps==1 ? 0x80 : 0, count*silence.bps)",
          "old_line_content": "int64_t swr_get_delay(struct SwrContext *s, int64_t base){",
          "new_line_content": "        memset(silence.ch[i], silence.bps==1 ? 0x80 : 0, count*silence.bps);",
          "content_same": false
        },
        {
          "line": 804,
          "old_api": null,
          "new_api": "reversefill_audiodata",
          "old_text": null,
          "new_text": "reversefill_audiodata(&silence, tmp_arg)",
          "old_line_content": "        return (s->in_buffer_count*base + (s->in_sample_rate>>1))/ s->in_sample_rate;",
          "new_line_content": "    reversefill_audiodata(&silence, tmp_arg);",
          "content_same": false
        },
        {
          "line": 805,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(s, AV_LOG_VERBOSE, \"adding %d audio samples of silence\\n\", count)",
          "old_line_content": "    }",
          "new_line_content": "    av_log(s, AV_LOG_VERBOSE, \"adding %d audio samples of silence\\n\", count);",
          "content_same": false
        },
        {
          "line": 806,
          "old_api": null,
          "new_api": "swr_convert",
          "old_text": null,
          "new_text": "swr_convert(s, NULL, 0, (const uint8_t**)tmp_arg, count)",
          "old_line_content": "}",
          "new_line_content": "    ret = swr_convert(s, NULL, 0, (const uint8_t**)tmp_arg, count);",
          "content_same": false
        },
        {
          "line": 807,
          "old_api": null,
          "new_api": "av_freep",
          "old_text": null,
          "new_text": "av_freep(&silence.data)",
          "old_line_content": "",
          "new_line_content": "    av_freep(&silence.data);",
          "content_same": false
        },
        {
          "line": 813,
          "old_api": null,
          "new_api": "get_delay",
          "old_text": null,
          "new_text": "s->resampler->get_delay(s, base)",
          "old_line_content": "    if (!compensation_distance && sample_delta)",
          "new_line_content": "        return s->resampler->get_delay(s, base);",
          "content_same": false
        },
        {
          "line": 687,
          "old_api": null,
          "new_api": "swri_realloc_audio",
          "old_text": null,
          "new_text": "swri_realloc_audio(&tmp, s->drop_output)",
          "old_line_content": "        if(s->drop_output || !out_arg)",
          "new_line_content": "        if((ret=swri_realloc_audio(&tmp, s->drop_output))<0)",
          "content_same": false
        },
        {
          "line": 690,
          "old_api": null,
          "new_api": "reversefill_audiodata",
          "old_text": null,
          "new_text": "reversefill_audiodata(&tmp, tmp_arg)",
          "old_line_content": "    }",
          "new_line_content": "        reversefill_audiodata(&tmp, tmp_arg);",
          "content_same": false
        },
        {
          "line": 692,
          "old_api": null,
          "new_api": "swr_convert",
          "old_text": null,
          "new_text": "swr_convert(s, tmp_arg, -s->drop_output, in_arg, in_count)",
          "old_line_content": "    if(!in_arg){",
          "new_line_content": "        ret = swr_convert(s, tmp_arg, -s->drop_output, in_arg, in_count); //FIXME optimize but this is as good as never called so maybe it doesnt matter",
          "content_same": false
        },
        {
          "line": 823,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(EINVAL)",
          "old_line_content": "    }else{",
          "new_line_content": "        return AVERROR(EINVAL);",
          "content_same": false
        },
        {
          "line": 697,
          "old_api": null,
          "new_api": "av_freep",
          "old_text": null,
          "new_text": "av_freep(&tmp.data)",
          "old_line_content": "            s->flushed = 1;",
          "new_line_content": "        av_freep(&tmp.data);",
          "content_same": false
        },
        {
          "line": 825,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(EINVAL)",
          "old_line_content": "    }",
          "new_line_content": "        return AVERROR(EINVAL);",
          "content_same": false
        },
        {
          "line": 828,
          "old_api": null,
          "new_api": "swr_init",
          "old_text": null,
          "new_text": "swr_init(s)",
          "old_line_content": "int64_t swr_next_pts(struct SwrContext *s, int64_t pts){",
          "new_line_content": "        ret = swr_init(s);",
          "content_same": false
        },
        {
          "line": 833,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(EINVAL)",
          "old_line_content": "    } else {",
          "new_line_content": "        return AVERROR(EINVAL);",
          "content_same": false
        },
        {
          "line": 706,
          "old_api": null,
          "new_api": "flush",
          "old_text": null,
          "new_text": "s->resampler->flush(s)",
          "old_line_content": "    if(s->resample){",
          "new_line_content": "                s->resampler->flush(s);",
          "content_same": false
        },
        {
          "line": 835,
          "old_api": null,
          "new_api": "set_compensation",
          "old_text": null,
          "new_text": "s->resampler->set_compensation(s->resample, sample_delta, compensation_distance)",
          "old_line_content": "        double fdelta = delta /(double)(s->in_sample_rate * (int64_t)s->out_sample_rate);",
          "new_line_content": "        return s->resampler->set_compensation(s->resample, sample_delta, compensation_distance);",
          "content_same": false
        },
        {
          "line": 713,
          "old_api": null,
          "new_api": "fill_audiodata",
          "old_text": null,
          "new_text": "fill_audiodata(in ,  (void*)in_arg)",
          "old_line_content": "        int ret2=0;",
          "new_line_content": "        fill_audiodata(in ,  (void*)in_arg);",
          "content_same": false
        },
        {
          "line": 845,
          "old_api": null,
          "new_api": "swr_get_delay",
          "old_text": null,
          "new_text": "swr_get_delay(s, s->in_sample_rate * (int64_t)s->out_sample_rate)",
          "old_line_content": "            } else if(s->soft_compensation_duration && s->max_soft_compensation) {",
          "new_line_content": "        int64_t delta = pts - swr_get_delay(s, s->in_sample_rate * (int64_t)s->out_sample_rate) - s->outpts;",
          "content_same": false
        },
        {
          "line": 851,
          "old_api": null,
          "new_api": "swr_inject_silence",
          "old_text": null,
          "new_text": "swr_inject_silence(s,  delta / s->out_sample_rate)",
          "old_line_content": "            }",
          "new_line_content": "                if(delta > 0) ret = swr_inject_silence(s,  delta / s->out_sample_rate);",
          "content_same": false
        },
        {
          "line": 852,
          "old_api": null,
          "new_api": "swr_drop_output   (s, -delta / s-> in_sample_rate)",
          "old_text": null,
          "new_text": "swr_drop_output   (s, -delta / s-> in_sample_rate)",
          "old_line_content": "        }",
          "new_line_content": "                else          ret = swr_drop_output   (s, -delta / s-> in_sample_rate);",
          "content_same": false
        },
        {
          "line": 726,
          "old_api": null,
          "new_api": "FFMIN",
          "old_text": null,
          "new_text": "FFMIN(out_count, s->in_buffer_count)",
          "old_line_content": "            if(!s->in_buffer_count)",
          "new_line_content": "        size = FFMIN(out_count, s->in_buffer_count);",
          "content_same": false
        },
        {
          "line": 854,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(s, AV_LOG_ERROR, \"Failed to compensate for timestamp delta of %f\\n\", fdelta)",
          "old_line_content": "        return s->outpts;",
          "new_line_content": "                    av_log(s, AV_LOG_ERROR, \"Failed to compensate for timestamp delta of %f\\n\", fdelta);",
          "content_same": false
        },
        {
          "line": 728,
          "old_api": null,
          "new_api": "buf_set",
          "old_text": null,
          "new_text": "buf_set(&tmp, &s->in_buffer, s->in_buffer_index)",
          "old_line_content": "        }",
          "new_line_content": "            buf_set(&tmp, &s->in_buffer, s->in_buffer_index);",
          "content_same": false
        },
        {
          "line": 729,
          "old_api": null,
          "new_api": "swr_convert_internal",
          "old_text": null,
          "new_text": "swr_convert_internal(s, out, size, &tmp, size)",
          "old_line_content": "",
          "new_line_content": "            ret= swr_convert_internal(s, out, size, &tmp, size);",
          "content_same": false
        },
        {
          "line": 859,
          "old_api": null,
          "new_api": "av_clipf",
          "old_text": null,
          "new_text": "av_clipf(fdelta, -max_soft_compensation, max_soft_compensation)",
          "old_line_content": "",
          "new_line_content": "                int comp = av_clipf(fdelta, -max_soft_compensation, max_soft_compensation) * duration ;",
          "content_same": false
        },
        {
          "line": 860,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(s, AV_LOG_VERBOSE, \"compensating audio timestamp drift:%f compensation:%d in:%d\\n\", fdelta, comp, duration)",
          "old_line_content": "",
          "new_line_content": "                av_log(s, AV_LOG_VERBOSE, \"compensating audio timestamp drift:%f compensation:%d in:%d\\n\", fdelta, comp, duration);",
          "content_same": false
        },
        {
          "line": 861,
          "old_api": null,
          "new_api": "swr_set_compensation",
          "old_text": null,
          "new_text": "swr_set_compensation(s, comp, duration)",
          "old_line_content": "",
          "new_line_content": "                swr_set_compensation(s, comp, duration);",
          "content_same": false
        },
        {
          "line": 735,
          "old_api": null,
          "new_api": "buf_set",
          "old_text": null,
          "new_text": "buf_set(out, out, ret)",
          "old_line_content": "                && s->in_buffer_count + in_count - out_count <= s->in_buffer_index){",
          "new_line_content": "            buf_set(out, out, ret);",
          "content_same": false
        },
        {
          "line": 747,
          "old_api": null,
          "new_api": "buf_set",
          "old_text": null,
          "new_text": "buf_set(&tmp, &s->in_buffer, s->in_buffer_index)",
          "old_line_content": "                if(ret<0)",
          "new_line_content": "                    buf_set(&tmp, &s->in_buffer, s->in_buffer_index);",
          "content_same": false
        },
        {
          "line": 748,
          "old_api": null,
          "new_api": "copy",
          "old_text": null,
          "new_text": "copy(&s->in_buffer, &tmp, s->in_buffer_count)",
          "old_line_content": "                    return ret;",
          "new_line_content": "                    copy(&s->in_buffer, &tmp, s->in_buffer_count);",
          "content_same": false
        },
        {
          "line": 751,
          "old_api": null,
          "new_api": "swri_realloc_audio",
          "old_text": null,
          "new_text": "swri_realloc_audio(&s->in_buffer, size)",
          "old_line_content": "                ret2 += ret;",
          "new_line_content": "                    if((ret=swri_realloc_audio(&s->in_buffer, size)) < 0)",
          "content_same": false
        },
        {
          "line": 756,
          "old_api": null,
          "new_api": "FFMIN",
          "old_text": null,
          "new_text": "FFMIN(in_count, out_count)",
          "old_line_content": "                s->in_buffer_count += in_count;",
          "new_line_content": "                size = FFMIN(in_count, out_count);",
          "content_same": false
        },
        {
          "line": 757,
          "old_api": null,
          "new_api": "swr_convert_internal",
          "old_text": null,
          "new_text": "swr_convert_internal(s, out, size, in, size)",
          "old_line_content": "            }",
          "new_line_content": "                ret= swr_convert_internal(s, out, size, in, size);",
          "content_same": false
        },
        {
          "line": 760,
          "old_api": null,
          "new_api": "buf_set",
          "old_text": null,
          "new_text": "buf_set(in, in, ret)",
          "old_line_content": "            s->outpts += ret2 * (int64_t)s->in_sample_rate;",
          "new_line_content": "                buf_set(in, in, ret);",
          "content_same": false
        },
        {
          "line": 765,
          "old_api": null,
          "new_api": "buf_set",
          "old_text": null,
          "new_text": "buf_set(&tmp, &s->in_buffer, s->in_buffer_index + s->in_buffer_count)",
          "old_line_content": "int swr_drop_output(struct SwrContext *s, int count){",
          "new_line_content": "                buf_set(&tmp, &s->in_buffer, s->in_buffer_index + s->in_buffer_count);",
          "content_same": false
        },
        {
          "line": 766,
          "old_api": null,
          "new_api": "copy",
          "old_text": null,
          "new_text": "copy(&tmp, in, in_count)",
          "old_line_content": "    s->drop_output += count;",
          "new_line_content": "                copy(&tmp, in, in_count);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 771,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(s, AV_LOG_VERBOSE, \"discarding %d audio samples\\n\", count)",
          "new_text": null,
          "old_line_content": "    av_log(s, AV_LOG_VERBOSE, \"discarding %d audio samples\\n\", count);",
          "new_line_content": "            s->outpts += ret2 * (int64_t)s->in_sample_rate;",
          "content_same": false
        },
        {
          "line": 772,
          "old_api": "swr_convert",
          "new_api": null,
          "old_text": "swr_convert(s, NULL, s->drop_output, NULL, 0)",
          "new_text": null,
          "old_line_content": "    return swr_convert(s, NULL, s->drop_output, NULL, 0);",
          "new_line_content": "        return ret2;",
          "content_same": false
        },
        {
          "line": 655,
          "old_api": "mix_2_1_f",
          "new_api": null,
          "old_text": "s->mix_2_1_f(preout->ch[ch], preout->ch[ch], s->dither.ch[ch] + s->dither.bps * s->dither_pos, s->native_one, 0, 0, out_count)",
          "new_text": null,
          "old_line_content": "                s->mix_2_1_f(preout->ch[ch], preout->ch[ch], s->dither.ch[ch] + s->dither.bps * s->dither_pos, s->native_one, 0, 0, out_count);",
          "new_line_content": "                int len1= out_count&~15;",
          "content_same": false
        },
        {
          "line": 785,
          "old_api": "swri_realloc_audio",
          "new_api": null,
          "old_text": "swri_realloc_audio(&silence, count)",
          "new_text": null,
          "old_line_content": "    if((ret=swri_realloc_audio(&silence, count))<0)",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 789,
          "old_api": "memset",
          "new_api": null,
          "old_text": "memset(silence.ch[i], silence.bps==1 ? 0x80 : 0, count*silence.bps)",
          "new_text": null,
          "old_line_content": "        memset(silence.ch[i], silence.bps==1 ? 0x80 : 0, count*silence.bps);",
          "new_line_content": "    uint8_t *tmp_arg[SWR_CH_MAX];",
          "content_same": false
        },
        {
          "line": 791,
          "old_api": "memset",
          "new_api": null,
          "old_text": "memset(silence.ch[0], silence.bps==1 ? 0x80 : 0, count*silence.bps*silence.ch_count)",
          "new_text": null,
          "old_line_content": "        memset(silence.ch[0], silence.bps==1 ? 0x80 : 0, count*silence.bps*silence.ch_count);",
          "new_line_content": "    if(count <= 0)",
          "content_same": false
        },
        {
          "line": 793,
          "old_api": "reversefill_audiodata",
          "new_api": null,
          "old_text": "reversefill_audiodata(&silence, tmp_arg)",
          "new_text": null,
          "old_line_content": "    reversefill_audiodata(&silence, tmp_arg);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 794,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(s, AV_LOG_VERBOSE, \"adding %d audio samples of silence\\n\", count)",
          "new_text": null,
          "old_line_content": "    av_log(s, AV_LOG_VERBOSE, \"adding %d audio samples of silence\\n\", count);",
          "new_line_content": "    silence.count = 0;",
          "content_same": false
        },
        {
          "line": 795,
          "old_api": "swr_convert",
          "new_api": null,
          "old_text": "swr_convert(s, NULL, 0, (const uint8_t**)tmp_arg, count)",
          "new_text": null,
          "old_line_content": "    ret = swr_convert(s, NULL, 0, (const uint8_t**)tmp_arg, count);",
          "new_line_content": "    silence.data  = NULL;",
          "content_same": false
        },
        {
          "line": 676,
          "old_api": "swri_realloc_audio",
          "new_api": null,
          "old_text": "swri_realloc_audio(&tmp, s->drop_output)",
          "new_text": null,
          "old_line_content": "        if((ret=swri_realloc_audio(&tmp, s->drop_output))<0)",
          "new_line_content": "int swr_convert(struct SwrContext *s, uint8_t *out_arg[SWR_CH_MAX], int out_count,",
          "content_same": false
        },
        {
          "line": 679,
          "old_api": "reversefill_audiodata",
          "new_api": null,
          "old_text": "reversefill_audiodata(&tmp, tmp_arg)",
          "new_text": null,
          "old_line_content": "        reversefill_audiodata(&tmp, tmp_arg);",
          "new_line_content": "    AudioData *out= &s->out;",
          "content_same": false
        },
        {
          "line": 681,
          "old_api": "swr_convert",
          "new_api": null,
          "old_text": "swr_convert(s, tmp_arg, -s->drop_output, in_arg, in_count)",
          "new_text": null,
          "old_line_content": "        ret = swr_convert(s, tmp_arg, -s->drop_output, in_arg, in_count); //FIXME optimize but this is as good as never called so maybe it doesnt matter",
          "new_line_content": "    if(s->drop_output > 0){",
          "content_same": false
        },
        {
          "line": 812,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(EINVAL)",
          "new_text": null,
          "old_line_content": "        return AVERROR(EINVAL);",
          "new_line_content": "    if (s->resampler && s->resample){",
          "content_same": false
        },
        {
          "line": 686,
          "old_api": "av_freep",
          "new_api": null,
          "old_text": "av_freep(&tmp.data)",
          "new_text": null,
          "old_line_content": "        av_freep(&tmp.data);",
          "new_line_content": "        tmp.data  = NULL;",
          "content_same": false
        },
        {
          "line": 814,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(EINVAL)",
          "new_text": null,
          "old_line_content": "        return AVERROR(EINVAL);",
          "new_line_content": "    }else{",
          "content_same": false
        },
        {
          "line": 817,
          "old_api": "swr_init",
          "new_api": null,
          "old_text": "swr_init(s)",
          "new_text": null,
          "old_line_content": "        ret = swr_init(s);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 822,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(EINVAL)",
          "new_text": null,
          "old_line_content": "        return AVERROR(EINVAL);",
          "new_line_content": "    if (!s || compensation_distance < 0)",
          "content_same": false
        },
        {
          "line": 695,
          "old_api": "flush",
          "new_api": null,
          "old_text": "s->resampler->flush(s)",
          "new_text": null,
          "old_line_content": "                s->resampler->flush(s);",
          "new_line_content": "            s->drop_output -= ret;",
          "content_same": false
        },
        {
          "line": 824,
          "old_api": "set_compensation",
          "new_api": null,
          "old_text": "s->resampler->set_compensation(s->resample, sample_delta, compensation_distance)",
          "new_text": null,
          "old_line_content": "        return s->resampler->set_compensation(s->resample, sample_delta, compensation_distance);",
          "new_line_content": "    if (!compensation_distance && sample_delta)",
          "content_same": false
        },
        {
          "line": 702,
          "old_api": "fill_audiodata",
          "new_api": null,
          "old_text": "fill_audiodata(in ,  (void*)in_arg)",
          "new_text": null,
          "old_line_content": "        fill_audiodata(in ,  (void*)in_arg);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 704,
          "old_api": "fill_audiodata",
          "new_api": null,
          "old_text": "fill_audiodata(out, out_arg)",
          "new_text": null,
          "old_line_content": "    fill_audiodata(out, out_arg);",
          "new_line_content": "        if(s->resample){",
          "content_same": false
        },
        {
          "line": 832,
          "old_api": "swr_get_delay",
          "new_api": null,
          "old_text": "swr_get_delay(s, s->in_sample_rate * (int64_t)s->out_sample_rate)",
          "new_text": null,
          "old_line_content": "        return (s->outpts = pts - swr_get_delay(s, s->in_sample_rate * (int64_t)s->out_sample_rate));",
          "new_line_content": "    if (!s->resampler->set_compensation){",
          "content_same": false
        },
        {
          "line": 834,
          "old_api": "swr_get_delay",
          "new_api": null,
          "old_text": "swr_get_delay(s, s->in_sample_rate * (int64_t)s->out_sample_rate)",
          "new_text": null,
          "old_line_content": "        int64_t delta = pts - swr_get_delay(s, s->in_sample_rate * (int64_t)s->out_sample_rate) - s->outpts;",
          "new_line_content": "    }else{",
          "content_same": false
        },
        {
          "line": 707,
          "old_api": "swr_convert_internal",
          "new_api": null,
          "old_text": "swr_convert_internal(s, out, out_count, in, in_count)",
          "new_text": null,
          "old_line_content": "        int ret = swr_convert_internal(s, out, out_count, in, in_count);",
          "new_line_content": "            s->resample_in_constraint = 0;",
          "content_same": false
        },
        {
          "line": 837,
          "old_api": "fabs",
          "new_api": null,
          "old_text": "fabs(fdelta)",
          "new_text": null,
          "old_line_content": "        if(fabs(fdelta) > s->min_compensation) {",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 838,
          "old_api": "fabs",
          "new_api": null,
          "old_text": "fabs(fdelta)",
          "new_text": null,
          "old_line_content": "            if(!s->outpts || fabs(fdelta) > s->min_hard_compensation){",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 840,
          "old_api": "swr_inject_silence",
          "new_api": null,
          "old_text": "swr_inject_silence(s,  delta / s->out_sample_rate)",
          "new_text": null,
          "old_line_content": "                if(delta > 0) ret = swr_inject_silence(s,  delta / s->out_sample_rate);",
          "new_line_content": "    if(pts == INT64_MIN)",
          "content_same": false
        },
        {
          "line": 841,
          "old_api": "swr_drop_output   (s, -delta / s-> in_sample_rate)",
          "new_api": null,
          "old_text": "swr_drop_output   (s, -delta / s-> in_sample_rate)",
          "new_text": null,
          "old_line_content": "                else          ret = swr_drop_output   (s, -delta / s-> in_sample_rate);",
          "new_line_content": "        return s->outpts;",
          "content_same": false
        },
        {
          "line": 717,
          "old_api": "buf_set",
          "new_api": null,
          "old_text": "buf_set(&tmp, &s->in_buffer, s->in_buffer_index)",
          "new_text": null,
          "old_line_content": "            buf_set(&tmp, &s->in_buffer, s->in_buffer_index);",
          "new_line_content": "    if(s->resample){",
          "content_same": false
        },
        {
          "line": 850,
          "old_api": "swr_set_compensation",
          "new_api": null,
          "old_text": "swr_set_compensation(s, comp, duration)",
          "new_text": null,
          "old_line_content": "                swr_set_compensation(s, comp, duration);",
          "new_line_content": "                int ret;",
          "content_same": false
        },
        {
          "line": 724,
          "old_api": "buf_set",
          "new_api": null,
          "old_text": "buf_set(out, out, ret)",
          "new_text": null,
          "old_line_content": "            buf_set(out, out, ret);",
          "new_line_content": "        int ret2=0;",
          "content_same": false
        },
        {
          "line": 736,
          "old_api": "buf_set",
          "new_api": null,
          "old_text": "buf_set(&tmp, &s->in_buffer, s->in_buffer_index)",
          "new_text": null,
          "old_line_content": "                    buf_set(&tmp, &s->in_buffer, s->in_buffer_index);",
          "new_line_content": "            out_count -= ret;",
          "content_same": false
        },
        {
          "line": 737,
          "old_api": "copy",
          "new_api": null,
          "old_text": "copy(&s->in_buffer, &tmp, s->in_buffer_count)",
          "new_text": null,
          "old_line_content": "                    copy(&s->in_buffer, &tmp, s->in_buffer_count);",
          "new_line_content": "            if(!s->in_buffer_count)",
          "content_same": false
        },
        {
          "line": 740,
          "old_api": "swri_realloc_audio",
          "new_api": null,
          "old_text": "swri_realloc_audio(&s->in_buffer, size)",
          "new_text": null,
          "old_line_content": "                    if((ret=swri_realloc_audio(&s->in_buffer, size)) < 0)",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 745,
          "old_api": "FFMIN",
          "new_api": null,
          "old_text": "FFMIN(in_count, out_count)",
          "new_text": null,
          "old_line_content": "                size = FFMIN(in_count, out_count);",
          "new_line_content": "                if(   size > s->in_buffer.count",
          "content_same": false
        },
        {
          "line": 746,
          "old_api": "swr_convert_internal",
          "new_api": null,
          "old_text": "swr_convert_internal(s, out, size, in, size)",
          "new_text": null,
          "old_line_content": "                ret= swr_convert_internal(s, out, size, in, size);",
          "new_line_content": "                && s->in_buffer_count + in_count - out_count <= s->in_buffer_index){",
          "content_same": false
        },
        {
          "line": 749,
          "old_api": "buf_set",
          "new_api": null,
          "old_text": "buf_set(in, in, ret)",
          "new_text": null,
          "old_line_content": "                buf_set(in, in, ret);",
          "new_line_content": "                    s->in_buffer_index=0;",
          "content_same": false
        },
        {
          "line": 754,
          "old_api": "buf_set",
          "new_api": null,
          "old_text": "buf_set(&tmp, &s->in_buffer, s->in_buffer_index + s->in_buffer_count)",
          "new_text": null,
          "old_line_content": "                buf_set(&tmp, &s->in_buffer, s->in_buffer_index + s->in_buffer_count);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 755,
          "old_api": "copy",
          "new_api": null,
          "old_text": "copy(&tmp, in, in_count)",
          "new_text": null,
          "old_line_content": "                copy(&tmp, in, in_count);",
          "new_line_content": "            if(out_count){",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 7,
      "total_additions": 41,
      "total_deletions": 39,
      "total_api_changes": 87
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 14,
        "api_related_lines": 87,
        "non_api_lines": 10,
        "non_api_line_numbers": [
          654,
          656,
          657,
          658,
          659,
          661,
          662,
          664,
          665,
          667
        ]
      }
    },
    "api_calls_before": 229,
    "api_calls_after": 231,
    "diff_info": {
      "added_lines": 14,
      "removed_lines": 3,
      "total_diff_lines": 29
    }
  }
}