{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/e470ef7641a41b6acd0765b7031ad03c041ec186",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/e470ef7641a41b6acd0765b7031ad03c041ec186/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/e470ef7641a41b6acd0765b7031ad03c041ec186/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/e470ef7641a41b6acd0765b7031ad03c041ec186/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 667,
          "old_api": "tprintf",
          "new_api": "get_chroma_qp",
          "old_text": "tprintf(s->avctx, \"filter mb:%d/%d MBAFF, QPy:%d/%d, QPb:%d/%d QPr:%d/%d ls:%d uvls:%d\", mb_x, mb_y, qp[0], qp[1], bqp[0], bqp[1], rqp[0], rqp[1], linesize, uvlinesize)",
          "new_text": "get_chroma_qp( h, 0, mbn0_qp )",
          "old_line_content": "        tprintf(s->avctx, \"filter mb:%d/%d MBAFF, QPy:%d/%d, QPb:%d/%d QPr:%d/%d ls:%d uvls:%d\", mb_x, mb_y, qp[0], qp[1], bqp[0], bqp[1], rqp[0], rqp[1], linesize, uvlinesize);",
          "new_line_content": "                   get_chroma_qp( h, 0, mbn0_qp ) + 1 ) >> 1;",
          "content_same": false
        },
        {
          "line": 668,
          "old_api": "tprintf",
          "new_api": "get_chroma_qp",
          "old_text": "tprintf(s->avctx, \"\\n\")",
          "new_text": "get_chroma_qp( h, 1, mb_qp )",
          "old_line_content": "        { int i; for (i = 0; i < 8; i++) tprintf(s->avctx, \" bS[%d]:%d\", i, bS[i]); tprintf(s->avctx, \"\\n\"); }",
          "new_line_content": "        rqp[0] = ( get_chroma_qp( h, 1, mb_qp ) +",
          "content_same": false
        },
        {
          "line": 671,
          "old_api": "filter_mb_mbaff_edgev ( h, img_y  + 8*  linesize,   linesize, bS+4, 1, qp [1] )",
          "new_api": "get_chroma_qp",
          "old_text": "filter_mb_mbaff_edgev ( h, img_y  + 8*  linesize,   linesize, bS+4, 1, qp [1] )",
          "new_text": "get_chroma_qp( h, 0, mb_qp )",
          "old_line_content": "            filter_mb_mbaff_edgev ( h, img_y  + 8*  linesize,   linesize, bS+4, 1, qp [1] );",
          "new_line_content": "        bqp[1] = ( get_chroma_qp( h, 0, mb_qp ) +",
          "content_same": false
        },
        {
          "line": 672,
          "old_api": "filter_mb_mbaff_edgecv",
          "new_api": "get_chroma_qp",
          "old_text": "filter_mb_mbaff_edgecv( h, img_cb,                uvlinesize, bS  , 1, bqp[0] )",
          "new_text": "get_chroma_qp( h, 0, mbn1_qp )",
          "old_line_content": "            filter_mb_mbaff_edgecv( h, img_cb,                uvlinesize, bS  , 1, bqp[0] );",
          "new_line_content": "                   get_chroma_qp( h, 0, mbn1_qp ) + 1 ) >> 1;",
          "content_same": false
        },
        {
          "line": 673,
          "old_api": "filter_mb_mbaff_edgecv",
          "new_api": "get_chroma_qp",
          "old_text": "filter_mb_mbaff_edgecv( h, img_cb + 4*uvlinesize, uvlinesize, bS+4, 1, bqp[1] )",
          "new_text": "get_chroma_qp( h, 1, mb_qp )",
          "old_line_content": "            filter_mb_mbaff_edgecv( h, img_cb + 4*uvlinesize, uvlinesize, bS+4, 1, bqp[1] );",
          "new_line_content": "        rqp[1] = ( get_chroma_qp( h, 1, mb_qp ) +",
          "content_same": false
        },
        {
          "line": 674,
          "old_api": "filter_mb_mbaff_edgecv",
          "new_api": "get_chroma_qp",
          "old_text": "filter_mb_mbaff_edgecv( h, img_cr,                uvlinesize, bS  , 1, rqp[0] )",
          "new_text": "get_chroma_qp( h, 1, mbn1_qp )",
          "old_line_content": "            filter_mb_mbaff_edgecv( h, img_cr,                uvlinesize, bS  , 1, rqp[0] );",
          "new_line_content": "                   get_chroma_qp( h, 1, mbn1_qp ) + 1 ) >> 1;",
          "content_same": false
        },
        {
          "line": 677,
          "old_api": "filter_mb_mbaff_edgev ( h, img_y              , 2*  linesize, bS  , 2, qp [0] )",
          "new_api": "tprintf",
          "old_text": "filter_mb_mbaff_edgev ( h, img_y              , 2*  linesize, bS  , 2, qp [0] )",
          "new_text": "tprintf(s->avctx, \"filter mb:%d/%d MBAFF, QPy:%d/%d, QPb:%d/%d QPr:%d/%d ls:%d uvls:%d\", mb_x, mb_y, qp[0], qp[1], bqp[0], bqp[1], rqp[0], rqp[1], linesize, uvlinesize)",
          "old_line_content": "            filter_mb_mbaff_edgev ( h, img_y              , 2*  linesize, bS  , 2, qp [0] );",
          "new_line_content": "        tprintf(s->avctx, \"filter mb:%d/%d MBAFF, QPy:%d/%d, QPb:%d/%d QPr:%d/%d ls:%d uvls:%d\", mb_x, mb_y, qp[0], qp[1], bqp[0], bqp[1], rqp[0], rqp[1], linesize, uvlinesize);",
          "content_same": false
        },
        {
          "line": 678,
          "old_api": "filter_mb_mbaff_edgev ( h, img_y  +   linesize, 2*  linesize, bS+1, 2, qp [1] )",
          "new_api": "tprintf",
          "old_text": "filter_mb_mbaff_edgev ( h, img_y  +   linesize, 2*  linesize, bS+1, 2, qp [1] )",
          "new_text": "tprintf(s->avctx, \"\\n\")",
          "old_line_content": "            filter_mb_mbaff_edgev ( h, img_y  +   linesize, 2*  linesize, bS+1, 2, qp [1] );",
          "new_line_content": "        { int i; for (i = 0; i < 8; i++) tprintf(s->avctx, \" bS[%d]:%d\", i, bS[i]); tprintf(s->avctx, \"\\n\"); }",
          "content_same": false
        },
        {
          "line": 680,
          "old_api": "filter_mb_mbaff_edgecv",
          "new_api": "filter_mb_mbaff_edgev ( h, img_y                ,   linesize, bS  , 1, qp [0] )",
          "old_text": "filter_mb_mbaff_edgecv( h, img_cb + uvlinesize, 2*uvlinesize, bS+1, 2, bqp[1] )",
          "new_text": "filter_mb_mbaff_edgev ( h, img_y                ,   linesize, bS  , 1, qp [0] )",
          "old_line_content": "            filter_mb_mbaff_edgecv( h, img_cb + uvlinesize, 2*uvlinesize, bS+1, 2, bqp[1] );",
          "new_line_content": "            filter_mb_mbaff_edgev ( h, img_y                ,   linesize, bS  , 1, qp [0] );",
          "content_same": false
        },
        {
          "line": 681,
          "old_api": "filter_mb_mbaff_edgecv",
          "new_api": "filter_mb_mbaff_edgev ( h, img_y  + 8*  linesize,   linesize, bS+4, 1, qp [1] )",
          "old_text": "filter_mb_mbaff_edgecv( h, img_cr,              2*uvlinesize, bS  , 2, rqp[0] )",
          "new_text": "filter_mb_mbaff_edgev ( h, img_y  + 8*  linesize,   linesize, bS+4, 1, qp [1] )",
          "old_line_content": "            filter_mb_mbaff_edgecv( h, img_cr,              2*uvlinesize, bS  , 2, rqp[0] );",
          "new_line_content": "            filter_mb_mbaff_edgev ( h, img_y  + 8*  linesize,   linesize, bS+4, 1, qp [1] );",
          "content_same": false
        },
        {
          "line": 688,
          "old_api": "filter_mb_dir",
          "new_api": "filter_mb_mbaff_edgev ( h, img_y  +   linesize, 2*  linesize, bS+1, 2, qp [1] )",
          "old_text": "filter_mb_dir(h, mb_x, mb_y, img_y, img_cb, img_cr, linesize, uvlinesize, mb_xy, mb_type, mvy_limit, dir ? 0 : first_vertical_edge_done, dir)",
          "new_text": "filter_mb_mbaff_edgev ( h, img_y  +   linesize, 2*  linesize, bS+1, 2, qp [1] )",
          "old_line_content": "        filter_mb_dir(h, mb_x, mb_y, img_y, img_cb, img_cr, linesize, uvlinesize, mb_xy, mb_type, mvy_limit, dir ? 0 : first_vertical_edge_done, dir);",
          "new_line_content": "            filter_mb_mbaff_edgev ( h, img_y  +   linesize, 2*  linesize, bS+1, 2, qp [1] );",
          "content_same": false
        },
        {
          "line": 690,
          "old_api": "filter_mb_dir",
          "new_api": "filter_mb_mbaff_edgecv",
          "old_text": "filter_mb_dir(h, mb_x, mb_y, img_y, img_cb, img_cr, linesize, uvlinesize, mb_xy, mb_type, mvy_limit, first_vertical_edge_done, 0)",
          "new_text": "filter_mb_mbaff_edgecv( h, img_cb + uvlinesize, 2*uvlinesize, bS+1, 2, bqp[1] )",
          "old_line_content": "    filter_mb_dir(h, mb_x, mb_y, img_y, img_cb, img_cr, linesize, uvlinesize, mb_xy, mb_type, mvy_limit, first_vertical_edge_done, 0);",
          "new_line_content": "            filter_mb_mbaff_edgecv( h, img_cb + uvlinesize, 2*uvlinesize, bS+1, 2, bqp[1] );",
          "content_same": false
        },
        {
          "line": 691,
          "old_api": "filter_mb_dir",
          "new_api": "filter_mb_mbaff_edgecv",
          "old_text": "filter_mb_dir(h, mb_x, mb_y, img_y, img_cb, img_cr, linesize, uvlinesize, mb_xy, mb_type, mvy_limit, 0, 1)",
          "new_text": "filter_mb_mbaff_edgecv( h, img_cr,              2*uvlinesize, bS  , 2, rqp[0] )",
          "old_line_content": "    filter_mb_dir(h, mb_x, mb_y, img_y, img_cb, img_cr, linesize, uvlinesize, mb_xy, mb_type, mvy_limit, 0, 1);",
          "new_line_content": "            filter_mb_mbaff_edgecv( h, img_cr,              2*uvlinesize, bS  , 2, rqp[0] );",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 701,
          "old_api": null,
          "new_api": "filter_mb_dir",
          "old_text": null,
          "new_text": "filter_mb_dir(h, mb_x, mb_y, img_y, img_cb, img_cr, linesize, uvlinesize, mb_xy, mb_type, mvy_limit, 0, 1)",
          "old_line_content": "",
          "new_line_content": "    filter_mb_dir(h, mb_x, mb_y, img_y, img_cb, img_cr, linesize, uvlinesize, mb_xy, mb_type, mvy_limit, 0, 1);",
          "content_same": false
        },
        {
          "line": 650,
          "old_api": null,
          "new_api": "IS_INTRA",
          "old_text": null,
          "new_text": "IS_INTRA( mbn_type )",
          "old_line_content": "        }",
          "new_line_content": "                if( IS_INTRA( mbn_type ) )",
          "content_same": false
        },
        {
          "line": 683,
          "old_api": null,
          "new_api": "filter_mb_mbaff_edgecv",
          "old_text": null,
          "new_text": "filter_mb_mbaff_edgecv( h, img_cb + 4*uvlinesize, uvlinesize, bS+4, 1, bqp[1] )",
          "old_line_content": "        }",
          "new_line_content": "            filter_mb_mbaff_edgecv( h, img_cb + 4*uvlinesize, uvlinesize, bS+4, 1, bqp[1] );",
          "content_same": false
        },
        {
          "line": 684,
          "old_api": null,
          "new_api": "filter_mb_mbaff_edgecv",
          "old_text": null,
          "new_text": "filter_mb_mbaff_edgecv( h, img_cr,                uvlinesize, bS  , 1, rqp[0] )",
          "old_line_content": "    }",
          "new_line_content": "            filter_mb_mbaff_edgecv( h, img_cr,                uvlinesize, bS  , 1, rqp[0] );",
          "content_same": false
        },
        {
          "line": 685,
          "old_api": null,
          "new_api": "filter_mb_mbaff_edgecv",
          "old_text": null,
          "new_text": "filter_mb_mbaff_edgecv( h, img_cr + 4*uvlinesize, uvlinesize, bS+4, 1, rqp[1] )",
          "old_line_content": "",
          "new_line_content": "            filter_mb_mbaff_edgecv( h, img_cr + 4*uvlinesize, uvlinesize, bS+4, 1, rqp[1] );",
          "content_same": false
        },
        {
          "line": 654,
          "old_api": null,
          "new_api": "IS_8x8DCT",
          "old_text": null,
          "new_text": "IS_8x8DCT(mbn_type)",
          "old_line_content": "        mbn1_qp = s->current_picture.qscale_table[h->left_mb_xy[1]];",
          "new_line_content": "                         ((!h->pps.cabac && IS_8x8DCT(mbn_type)) ?",
          "content_same": false
        },
        {
          "line": 687,
          "old_api": null,
          "new_api": "filter_mb_mbaff_edgev ( h, img_y              , 2*  linesize, bS  , 2, qp [0] )",
          "old_text": null,
          "new_text": "filter_mb_mbaff_edgev ( h, img_y              , 2*  linesize, bS  , 2, qp [0] )",
          "old_line_content": "    for( dir = 0; dir < 2; dir++ )",
          "new_line_content": "            filter_mb_mbaff_edgev ( h, img_y              , 2*  linesize, bS  , 2, qp [0] );",
          "content_same": false
        },
        {
          "line": 689,
          "old_api": null,
          "new_api": "filter_mb_mbaff_edgecv",
          "old_text": null,
          "new_text": "filter_mb_mbaff_edgecv( h, img_cb,              2*uvlinesize, bS  , 2, bqp[0] )",
          "old_line_content": "#else",
          "new_line_content": "            filter_mb_mbaff_edgecv( h, img_cb,              2*uvlinesize, bS  , 2, bqp[0] );",
          "content_same": false
        },
        {
          "line": 692,
          "old_api": null,
          "new_api": "filter_mb_mbaff_edgecv",
          "old_text": null,
          "new_text": "filter_mb_mbaff_edgecv( h, img_cr + uvlinesize, 2*uvlinesize, bS+1, 2, rqp[1] )",
          "old_line_content": "#endif",
          "new_line_content": "            filter_mb_mbaff_edgecv( h, img_cr + uvlinesize, 2*uvlinesize, bS+1, 2, rqp[1] );",
          "content_same": false
        },
        {
          "line": 698,
          "old_api": null,
          "new_api": "filter_mb_dir",
          "old_text": null,
          "new_text": "filter_mb_dir(h, mb_x, mb_y, img_y, img_cb, img_cr, linesize, uvlinesize, mb_xy, mb_type, mvy_limit, dir ? 0 : first_vertical_edge_done, dir)",
          "old_line_content": "",
          "new_line_content": "        filter_mb_dir(h, mb_x, mb_y, img_y, img_cb, img_cr, linesize, uvlinesize, mb_xy, mb_type, mvy_limit, dir ? 0 : first_vertical_edge_done, dir);",
          "content_same": false
        },
        {
          "line": 666,
          "old_api": null,
          "new_api": "get_chroma_qp",
          "old_text": null,
          "new_text": "get_chroma_qp( h, 0, mb_qp )",
          "old_line_content": "        /* Filter edge */",
          "new_line_content": "        bqp[0] = ( get_chroma_qp( h, 0, mb_qp ) +",
          "content_same": false
        },
        {
          "line": 700,
          "old_api": null,
          "new_api": "filter_mb_dir",
          "old_text": null,
          "new_text": "filter_mb_dir(h, mb_x, mb_y, img_y, img_cb, img_cr, linesize, uvlinesize, mb_xy, mb_type, mvy_limit, first_vertical_edge_done, 0)",
          "old_line_content": "",
          "new_line_content": "    filter_mb_dir(h, mb_x, mb_y, img_y, img_cb, img_cr, linesize, uvlinesize, mb_xy, mb_type, mvy_limit, first_vertical_edge_done, 0);",
          "content_same": false
        },
        {
          "line": 669,
          "old_api": null,
          "new_api": "get_chroma_qp",
          "old_text": null,
          "new_text": "get_chroma_qp( h, 1, mbn0_qp )",
          "old_line_content": "        if(MB_FIELD){",
          "new_line_content": "                   get_chroma_qp( h, 1, mbn0_qp ) + 1 ) >> 1;",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 640,
          "old_api": "IS_INTRA",
          "new_api": null,
          "old_text": "IS_INTRA( mbn_type )",
          "new_text": null,
          "old_line_content": "                if( IS_INTRA( mbn_type ) )",
          "new_line_content": "                    {7+8*0, 7+8*1, 7+8*2, 7+8*3, 7+8*0, 7+8*1, 7+8*2, 7+8*3},",
          "content_same": false
        },
        {
          "line": 675,
          "old_api": "filter_mb_mbaff_edgecv",
          "new_api": null,
          "old_text": "filter_mb_mbaff_edgecv( h, img_cr + 4*uvlinesize, uvlinesize, bS+4, 1, rqp[1] )",
          "new_text": null,
          "old_line_content": "            filter_mb_mbaff_edgecv( h, img_cr + 4*uvlinesize, uvlinesize, bS+4, 1, rqp[1] );",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 644,
          "old_api": "IS_8x8DCT",
          "new_api": null,
          "old_text": "IS_8x8DCT(mbn_type)",
          "new_text": null,
          "old_line_content": "                         ((!h->pps.cabac && IS_8x8DCT(mbn_type)) ?",
          "new_line_content": "            const uint8_t *off= offset[MB_FIELD][mb_y&1];",
          "content_same": false
        },
        {
          "line": 679,
          "old_api": "filter_mb_mbaff_edgecv",
          "new_api": null,
          "old_text": "filter_mb_mbaff_edgecv( h, img_cb,              2*uvlinesize, bS  , 2, bqp[0] )",
          "new_text": null,
          "old_line_content": "            filter_mb_mbaff_edgecv( h, img_cb,              2*uvlinesize, bS  , 2, bqp[0] );",
          "new_line_content": "        if(MB_FIELD){",
          "content_same": false
        },
        {
          "line": 656,
          "old_api": "get_chroma_qp",
          "new_api": null,
          "old_text": "get_chroma_qp( h, 0, mb_qp )",
          "new_text": null,
          "old_line_content": "        bqp[0] = ( get_chroma_qp( h, 0, mb_qp ) +",
          "new_line_content": "                                                                       :",
          "content_same": false
        },
        {
          "line": 657,
          "old_api": "get_chroma_qp",
          "new_api": null,
          "old_text": "get_chroma_qp( h, 0, mbn0_qp )",
          "new_text": null,
          "old_line_content": "                   get_chroma_qp( h, 0, mbn0_qp ) + 1 ) >> 1;",
          "new_line_content": "                            h->non_zero_count[mbn_xy][ off[i] ]));",
          "content_same": false
        },
        {
          "line": 658,
          "old_api": "get_chroma_qp",
          "new_api": null,
          "old_text": "get_chroma_qp( h, 1, mb_qp )",
          "new_text": null,
          "old_line_content": "        rqp[0] = ( get_chroma_qp( h, 1, mb_qp ) +",
          "new_line_content": "                }",
          "content_same": false
        },
        {
          "line": 659,
          "old_api": "get_chroma_qp",
          "new_api": null,
          "old_text": "get_chroma_qp( h, 1, mbn0_qp )",
          "new_text": null,
          "old_line_content": "                   get_chroma_qp( h, 1, mbn0_qp ) + 1 ) >> 1;",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 661,
          "old_api": "get_chroma_qp",
          "new_api": null,
          "old_text": "get_chroma_qp( h, 0, mb_qp )",
          "new_text": null,
          "old_line_content": "        bqp[1] = ( get_chroma_qp( h, 0, mb_qp ) +",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 662,
          "old_api": "get_chroma_qp",
          "new_api": null,
          "old_text": "get_chroma_qp( h, 0, mbn1_qp )",
          "new_text": null,
          "old_line_content": "                   get_chroma_qp( h, 0, mbn1_qp ) + 1 ) >> 1;",
          "new_line_content": "        mb_qp = s->current_picture.qscale_table[mb_xy];",
          "content_same": false
        },
        {
          "line": 663,
          "old_api": "get_chroma_qp",
          "new_api": null,
          "old_text": "get_chroma_qp( h, 1, mb_qp )",
          "new_text": null,
          "old_line_content": "        rqp[1] = ( get_chroma_qp( h, 1, mb_qp ) +",
          "new_line_content": "        mbn0_qp = s->current_picture.qscale_table[h->left_mb_xy[0]];",
          "content_same": false
        },
        {
          "line": 664,
          "old_api": "get_chroma_qp",
          "new_api": null,
          "old_text": "get_chroma_qp( h, 1, mbn1_qp )",
          "new_text": null,
          "old_line_content": "                   get_chroma_qp( h, 1, mbn1_qp ) + 1 ) >> 1;",
          "new_line_content": "        mbn1_qp = s->current_picture.qscale_table[h->left_mb_xy[1]];",
          "content_same": false
        },
        {
          "line": 670,
          "old_api": "filter_mb_mbaff_edgev ( h, img_y                ,   linesize, bS  , 1, qp [0] )",
          "new_api": null,
          "old_text": "filter_mb_mbaff_edgev ( h, img_y                ,   linesize, bS  , 1, qp [0] )",
          "new_text": null,
          "old_line_content": "            filter_mb_mbaff_edgev ( h, img_y                ,   linesize, bS  , 1, qp [0] );",
          "new_line_content": "        qp[1] = ( mb_qp + mbn1_qp + 1 ) >> 1;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 13,
      "total_additions": 13,
      "total_deletions": 13,
      "total_api_changes": 39
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 12,
        "api_related_lines": 39,
        "non_api_lines": 9,
        "non_api_line_numbers": [
          641,
          642,
          643,
          647,
          635,
          636,
          637,
          638,
          639
        ]
      }
    },
    "api_calls_before": 144,
    "api_calls_after": 144,
    "diff_info": {
      "added_lines": 11,
      "removed_lines": 1,
      "total_diff_lines": 31
    }
  }
}