{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/58d9b5caf3d332c6495f9af437158bf45531a05e",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/58d9b5caf3d332c6495f9af437158bf45531a05e/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/58d9b5caf3d332c6495f9af437158bf45531a05e/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/58d9b5caf3d332c6495f9af437158bf45531a05e/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 424,
          "old_api": "av_log",
          "new_api": "AV_WN16",
          "old_text": "av_log(logctx, AV_LOG_DEBUG, \"Joint: %d/%d/%d/%d/%d codes min=%ubits max=%u\\n\",\n           count[0], count[1], count[2], count[3], count[4], minbits, max)",
          "new_text": "AV_WN16(table[j].val, single->table[j].sym)",
          "old_line_content": "    av_log(logctx, AV_LOG_DEBUG, \"Joint: %d/%d/%d/%d/%d codes min=%ubits max=%u\\n\",",
          "new_line_content": "        AV_WN16(table[j].val, single->table[j].sym);",
          "content_same": false
        },
        {
          "line": 443,
          "old_api": "av_malloc",
          "new_api": "FFMIN",
          "old_text": "av_malloc(sizeof(*multi->table) << nb_bits)",
          "new_text": "FFMIN(32, 3 * nb_bits)",
          "old_line_content": "    multi->table = av_malloc(sizeof(*multi->table) << nb_bits);",
          "new_line_content": "    int ret, j, len_max = FFMIN(32, 3 * nb_bits);",
          "content_same": false
        },
        {
          "line": 445,
          "old_api": "AVERROR",
          "new_api": "vlc_common_init",
          "old_text": "AVERROR(ENOMEM)",
          "new_text": "vlc_common_init(vlc, nb_bits, nb_codes, &buf, flags)",
          "old_line_content": "        return AVERROR(ENOMEM);",
          "new_line_content": "    ret = vlc_common_init(vlc, nb_bits, nb_codes, &buf, flags);",
          "content_same": false
        },
        {
          "line": 483,
          "old_api": "av_free",
          "new_api": "vlc_multi_gen",
          "old_text": "av_free(buf)",
          "new_text": "vlc_multi_gen(multi->table, vlc, nb_elems, j, nb_bits, buf, logctx)",
          "old_line_content": "        av_free(buf);",
          "new_line_content": "    ret = vlc_multi_gen(multi->table, vlc, nb_elems, j, nb_bits, buf, logctx);",
          "content_same": false
        },
        {
          "line": 490,
          "old_api": "av_freep",
          "new_api": "ff_vlc_free_multi",
          "old_text": "av_freep(&vlc->table)",
          "new_text": "ff_vlc_free_multi(multi)",
          "old_line_content": "    av_freep(&vlc->table);",
          "new_line_content": "    ff_vlc_free_multi(multi);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 480,
          "old_api": null,
          "new_api": "vlc_common_end",
          "old_text": null,
          "new_text": "vlc_common_end(vlc, nb_bits, j, buf, flags, buf)",
          "old_line_content": "    return ret;",
          "new_line_content": "    ret = vlc_common_end(vlc, nb_bits, j, buf, flags, buf);",
          "content_same": false
        },
        {
          "line": 449,
          "old_api": null,
          "new_api": "av_malloc",
          "old_text": null,
          "new_text": "av_malloc(sizeof(*multi->table) << nb_bits)",
          "old_line_content": "        int len = *lens;",
          "new_line_content": "    multi->table = av_malloc(sizeof(*multi->table) << nb_bits);",
          "content_same": false
        },
        {
          "line": 451,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(ENOMEM)",
          "old_line_content": "            unsigned sym;",
          "new_line_content": "        return AVERROR(ENOMEM);",
          "content_same": false
        },
        {
          "line": 485,
          "old_api": null,
          "new_api": "av_free",
          "old_text": null,
          "new_text": "av_free(buf)",
          "old_line_content": "    return AVERROR_INVALIDDATA;",
          "new_line_content": "        av_free(buf);",
          "content_same": false
        },
        {
          "line": 489,
          "old_api": null,
          "new_api": "av_free",
          "old_text": null,
          "new_text": "av_free(buf)",
          "old_line_content": "{",
          "new_line_content": "        av_free(buf);",
          "content_same": false
        },
        {
          "line": 427,
          "old_api": null,
          "new_api": "add_level",
          "old_text": null,
          "new_text": "add_level(table, nb_elems, nb_codes, numbits, buf,\n              0, 0, FFMIN(maxbits, numbits), 0, minbits, max, count, &info)",
          "old_line_content": "    return 0;",
          "new_line_content": "    add_level(table, nb_elems, nb_codes, numbits, buf,",
          "content_same": false
        },
        {
          "line": 428,
          "old_api": null,
          "new_api": "FFMIN",
          "old_text": null,
          "new_text": "FFMIN(maxbits, numbits)",
          "old_line_content": "}",
          "new_line_content": "              0, 0, FFMIN(maxbits, numbits), 0, minbits, max, count, &info);",
          "content_same": false
        },
        {
          "line": 461,
          "old_api": null,
          "new_api": "GET_DATA",
          "old_text": null,
          "new_text": "GET_DATA(sym, symbols, i, symbols_wrap, symbols_size)",
          "old_line_content": "            len = -len;",
          "new_line_content": "                GET_DATA(sym, symbols, i, symbols_wrap, symbols_size)",
          "content_same": false
        },
        {
          "line": 430,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(logctx, AV_LOG_DEBUG, \"Joint: %d/%d/%d/%d/%d codes min=%ubits max=%u\\n\",\n           count[0], count[1], count[2], count[3], count[4], minbits, max)",
          "old_line_content": "int ff_vlc_init_multi_from_lengths(VLC *vlc, VLC_MULTI *multi, int nb_bits, int nb_elems,",
          "new_line_content": "    av_log(logctx, AV_LOG_DEBUG, \"Joint: %d/%d/%d/%d/%d codes min=%ubits max=%u\\n\",",
          "content_same": false
        },
        {
          "line": 496,
          "old_api": null,
          "new_api": "av_freep",
          "old_text": null,
          "new_text": "av_freep(&vlc->table)",
          "old_line_content": "}",
          "new_line_content": "    av_freep(&vlc->table);",
          "content_same": false
        },
        {
          "line": 501,
          "old_api": null,
          "new_api": "av_freep",
          "old_text": null,
          "new_text": "av_freep(&vlc->table)",
          "old_line_content": "",
          "new_line_content": "    av_freep(&vlc->table);",
          "content_same": false
        },
        {
          "line": 471,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(logctx, AV_LOG_ERROR, \"Invalid VLC (length %u)\\n\", len)",
          "old_line_content": "            goto fail;",
          "new_line_content": "            av_log(logctx, AV_LOG_ERROR, \"Invalid VLC (length %u)\\n\", len);",
          "content_same": false
        },
        {
          "line": 410,
          "old_api": null,
          "new_api": "FFMIN",
          "old_text": null,
          "new_text": "FFMIN(minbits, buf[n].bits)",
          "old_line_content": "        if (buf[max].bits+minbits > maxbits)",
          "new_line_content": "        minbits = FFMIN(minbits, buf[n].bits);",
          "content_same": false
        },
        {
          "line": 411,
          "old_api": null,
          "new_api": "FFMAX",
          "old_text": null,
          "new_text": "FFMAX(maxbits, buf[n].bits)",
          "old_line_content": "            break;",
          "new_line_content": "        maxbits = FFMAX(maxbits, buf[n].bits);",
          "content_same": false
        },
        {
          "line": 476,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(logctx, AV_LOG_ERROR, \"Overdetermined VLC tree\\n\")",
          "old_line_content": "        goto fail;",
          "new_line_content": "            av_log(logctx, AV_LOG_ERROR, \"Overdetermined VLC tree\\n\");",
          "content_same": false
        },
        {
          "line": 413,
          "old_api": null,
          "new_api": "FFMIN",
          "old_text": null,
          "new_text": "FFMIN(maxbits, numbits)",
          "old_line_content": "    }",
          "new_line_content": "    maxbits = FFMIN(maxbits, numbits);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 439,
          "old_api": "vlc_common_init",
          "new_api": null,
          "old_text": "vlc_common_init(vlc, nb_bits, nb_codes, &buf, flags)",
          "new_text": null,
          "old_line_content": "    ret = vlc_common_init(vlc, nb_bits, nb_codes, &buf, flags);",
          "new_line_content": "                                   int offset, int flags, void *logctx)",
          "content_same": false
        },
        {
          "line": 418,
          "old_api": "AV_WN16",
          "new_api": null,
          "old_text": "AV_WN16(table[j].val, single->table[j].sym)",
          "new_text": null,
          "old_line_content": "        AV_WN16(table[j].val, single->table[j].sym);",
          "new_line_content": "        max--;",
          "content_same": false
        },
        {
          "line": 484,
          "old_api": "ff_vlc_free_multi",
          "new_api": null,
          "old_text": "ff_vlc_free_multi(multi)",
          "new_text": null,
          "old_line_content": "    ff_vlc_free_multi(multi);",
          "new_line_content": "    if (buf != localbuf)",
          "content_same": false
        },
        {
          "line": 421,
          "old_api": "add_level",
          "new_api": null,
          "old_text": "add_level(table, nb_elems, nb_codes, numbits, buf,\n              0, 0, FFMIN(maxbits, numbits), 0, minbits, max, count, &info)",
          "new_text": null,
          "old_line_content": "    add_level(table, nb_elems, nb_codes, numbits, buf,",
          "new_line_content": "    for (int j = 0; j < 1<<numbits; j++) {",
          "content_same": false
        },
        {
          "line": 422,
          "old_api": "FFMIN",
          "new_api": null,
          "old_text": "FFMIN(maxbits, numbits)",
          "new_text": null,
          "old_line_content": "              0, 0, FFMIN(maxbits, numbits), 0, minbits, max, count, &info);",
          "new_line_content": "        table[j].len = single->table[j].len;",
          "content_same": false
        },
        {
          "line": 455,
          "old_api": "GET_DATA",
          "new_api": null,
          "old_text": "GET_DATA(sym, symbols, i, symbols_wrap, symbols_size)",
          "new_text": null,
          "old_line_content": "                GET_DATA(sym, symbols, i, symbols_wrap, symbols_size)",
          "new_line_content": "        int len = *lens;",
          "content_same": false
        },
        {
          "line": 495,
          "old_api": "av_freep",
          "new_api": null,
          "old_text": "av_freep(&vlc->table)",
          "new_text": null,
          "old_line_content": "    av_freep(&vlc->table);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 465,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(logctx, AV_LOG_ERROR, \"Invalid VLC (length %u)\\n\", len)",
          "new_text": null,
          "old_line_content": "            av_log(logctx, AV_LOG_ERROR, \"Invalid VLC (length %u)\\n\", len);",
          "new_line_content": "            buf[j++].code = code;",
          "content_same": false
        },
        {
          "line": 437,
          "old_api": "FFMIN",
          "new_api": null,
          "old_text": "FFMIN(32, 3 * nb_bits)",
          "new_text": null,
          "old_line_content": "    int ret, j, len_max = FFMIN(32, 3 * nb_bits);",
          "new_line_content": "                                   int nb_codes, const int8_t *lens, int lens_wrap,",
          "content_same": false
        },
        {
          "line": 470,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(logctx, AV_LOG_ERROR, \"Overdetermined VLC tree\\n\")",
          "new_text": null,
          "old_line_content": "            av_log(logctx, AV_LOG_ERROR, \"Overdetermined VLC tree\\n\");",
          "new_line_content": "        if (len > len_max || code & ((1U << (32 - len)) - 1)) {",
          "content_same": false
        },
        {
          "line": 407,
          "old_api": "FFMIN",
          "new_api": null,
          "old_text": "FFMIN(buf[0].bits, numbits)",
          "new_text": null,
          "old_line_content": "    maxbits = FFMIN(buf[0].bits, numbits);",
          "new_line_content": "    maxbits = buf[0].bits;",
          "content_same": false
        },
        {
          "line": 474,
          "old_api": "vlc_common_end",
          "new_api": null,
          "old_text": "vlc_common_end(vlc, nb_bits, j, buf, flags, buf)",
          "new_text": null,
          "old_line_content": "    ret = vlc_common_end(vlc, nb_bits, j, buf, flags, buf);",
          "new_line_content": "        code += 1U << (32 - len);",
          "content_same": false
        },
        {
          "line": 477,
          "old_api": "vlc_multi_gen",
          "new_api": null,
          "old_text": "vlc_multi_gen(multi->table, vlc, nb_elems, j, nb_bits, buf, logctx)",
          "new_text": null,
          "old_line_content": "    ret = vlc_multi_gen(multi->table, vlc, nb_elems, j, nb_bits, buf, logctx);",
          "new_line_content": "            goto fail;",
          "content_same": false
        },
        {
          "line": 479,
          "old_api": "av_free",
          "new_api": null,
          "old_text": "av_free(buf)",
          "new_text": null,
          "old_line_content": "        av_free(buf);",
          "new_line_content": "    }",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 5,
      "total_additions": 16,
      "total_deletions": 14,
      "total_api_changes": 35
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 8,
        "api_related_lines": 35,
        "non_api_lines": 4,
        "non_api_line_numbers": [
          408,
          409,
          412,
          406
        ]
      }
    },
    "api_calls_before": 59,
    "api_calls_after": 61,
    "diff_info": {
      "added_lines": 8,
      "removed_lines": 2,
      "total_diff_lines": 22
    }
  }
}