{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/996b099a0f63dcd5faba5201487c0788a252dc85",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/996b099a0f63dcd5faba5201487c0788a252dc85/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/996b099a0f63dcd5faba5201487c0788a252dc85/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/996b099a0f63dcd5faba5201487c0788a252dc85/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 944,
          "old_api": "get_chroma_qp",
          "new_api": "IS_INTRA16x16",
          "old_text": "get_chroma_qp(h, 0, s->qscale)",
          "new_text": "IS_INTRA16x16(mb_type)",
          "old_line_content": "        h->chroma_qp[0]= get_chroma_qp(h, 0, s->qscale);",
          "new_line_content": "        if(IS_INTRA16x16(mb_type)){",
          "content_same": false
        },
        {
          "line": 945,
          "old_api": "get_chroma_qp",
          "new_api": "decode_residual",
          "old_text": "get_chroma_qp(h, 1, s->qscale)",
          "new_text": "decode_residual(h, h->intra_gb_ptr, h->mb, LUMA_DC_BLOCK_INDEX, dc_scan, h->dequant4_coeff[0][s->qscale], 16)",
          "old_line_content": "        h->chroma_qp[1]= get_chroma_qp(h, 1, s->qscale);",
          "new_line_content": "            if( decode_residual(h, h->intra_gb_ptr, h->mb, LUMA_DC_BLOCK_INDEX, dc_scan, h->dequant4_coeff[0][s->qscale], 16) < 0){",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 913,
          "old_api": null,
          "new_api": "IS_INTRA16x16",
          "old_text": null,
          "new_text": "IS_INTRA16x16(mb_type)",
          "old_line_content": "    s->current_picture.mb_type[mb_xy]= mb_type;",
          "new_line_content": "    if(cbp || IS_INTRA16x16(mb_type)){",
          "content_same": false
        },
        {
          "line": 916,
          "old_api": null,
          "new_api": "IS_INTRA",
          "old_text": null,
          "new_text": "IS_INTRA(mb_type)",
          "old_line_content": "        int i8x8, i4x4, chroma_idx;",
          "new_line_content": "        GetBitContext *gb= IS_INTRA(mb_type) ? h->intra_gb_ptr : h->inter_gb_ptr;",
          "content_same": false
        },
        {
          "line": 919,
          "old_api": null,
          "new_api": "IS_INTERLACED",
          "old_text": null,
          "new_text": "IS_INTERLACED(mb_type)",
          "old_line_content": "        const uint8_t *scan, *scan8x8, *dc_scan;",
          "new_line_content": "        if(IS_INTERLACED(mb_type)){",
          "content_same": false
        },
        {
          "line": 929,
          "old_api": null,
          "new_api": "get_se_golomb",
          "old_text": null,
          "new_text": "get_se_golomb(&s->gb)",
          "old_line_content": "        }",
          "new_line_content": "        dquant= get_se_golomb(&s->gb);",
          "content_same": false
        },
        {
          "line": 937,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(h->s.avctx, AV_LOG_ERROR, \"dquant out of range (%d) at %d %d\\n\", dquant, s->mb_x, s->mb_y)",
          "old_line_content": "            else            s->qscale-= 52;",
          "new_line_content": "                av_log(h->s.avctx, AV_LOG_ERROR, \"dquant out of range (%d) at %d %d\\n\", dquant, s->mb_x, s->mb_y);",
          "content_same": false
        },
        {
          "line": 942,
          "old_api": null,
          "new_api": "get_chroma_qp",
          "old_text": null,
          "new_text": "get_chroma_qp(h, 0, s->qscale)",
          "old_line_content": "        }",
          "new_line_content": "        h->chroma_qp[0]= get_chroma_qp(h, 0, s->qscale);",
          "content_same": false
        },
        {
          "line": 943,
          "old_api": null,
          "new_api": "get_chroma_qp",
          "old_text": null,
          "new_text": "get_chroma_qp(h, 1, s->qscale)",
          "old_line_content": "",
          "new_line_content": "        h->chroma_qp[1]= get_chroma_qp(h, 1, s->qscale);",
          "content_same": false
        },
        {
          "line": 949,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert((cbp&15) == 0 || (cbp&15) == 15)",
          "old_line_content": "            }",
          "new_line_content": "            assert((cbp&15) == 0 || (cbp&15) == 15);",
          "content_same": false
        },
        {
          "line": 955,
          "old_api": null,
          "new_api": "decode_residual",
          "old_text": null,
          "new_text": "decode_residual(h, h->intra_gb_ptr, h->mb + 16*index, index, scan + 1, h->dequant4_coeff[0][s->qscale], 15)",
          "old_line_content": "                    for(i4x4=0; i4x4<4; i4x4++){",
          "new_line_content": "                        if( decode_residual(h, h->intra_gb_ptr, h->mb + 16*index, index, scan + 1, h->dequant4_coeff[0][s->qscale], 15) < 0 ){",
          "content_same": false
        },
        {
          "line": 961,
          "old_api": null,
          "new_api": "fill_rectangle",
          "old_text": null,
          "new_text": "fill_rectangle(&h->non_zero_count_cache[scan8[0]], 4, 4, 8, 0, 1)",
          "old_line_content": "                }",
          "new_line_content": "                fill_rectangle(&h->non_zero_count_cache[scan8[0]], 4, 4, 8, 0, 1);",
          "content_same": false
        },
        {
          "line": 966,
          "old_api": null,
          "new_api": "IS_8x8DCT",
          "old_text": null,
          "new_text": "IS_8x8DCT(mb_type)",
          "old_line_content": "            for(i8x8=0; i8x8<4; i8x8++){",
          "new_line_content": "                    if(IS_8x8DCT(mb_type)){",
          "content_same": false
        },
        {
          "line": 970,
          "old_api": null,
          "new_api": "decode_residual",
          "old_text": null,
          "new_text": "decode_residual(h, gb, buf, i4x4+4*i8x8, scan8x8+16*i4x4,\n                                                h->dequant8_coeff[IS_INTRA( mb_type ) ? 0:1][s->qscale], 16)",
          "old_line_content": "                        uint8_t *nnz;",
          "new_line_content": "                            if( decode_residual(h, gb, buf, i4x4+4*i8x8, scan8x8+16*i4x4,",
          "content_same": false
        },
        {
          "line": 971,
          "old_api": null,
          "new_api": "IS_INTRA",
          "old_text": null,
          "new_text": "IS_INTRA( mb_type )",
          "old_line_content": "                        for(i4x4=0; i4x4<4; i4x4++){",
          "new_line_content": "                                                h->dequant8_coeff[IS_INTRA( mb_type ) ? 0:1][s->qscale], 16) <0 )",
          "content_same": false
        },
        {
          "line": 980,
          "old_api": null,
          "new_api": "IS_INTRA",
          "old_text": null,
          "new_text": "IS_INTRA( mb_type )",
          "old_line_content": "                            const int index= i4x4 + 4*i8x8;",
          "new_line_content": "                            if( decode_residual(h, gb, h->mb + 16*index, index, scan, h->dequant4_coeff[IS_INTRA( mb_type ) ? 0:3][s->qscale], 16) <0 ){",
          "content_same": false
        },
        {
          "line": 994,
          "old_api": null,
          "new_api": "decode_residual",
          "old_text": null,
          "new_text": "decode_residual(h, gb, h->mb + 256 + 16*4*chroma_idx, CHROMA_DC_BLOCK_INDEX, chroma_dc_scan, NULL, 4)",
          "old_line_content": "        if(cbp&0x30){",
          "new_line_content": "                if( decode_residual(h, gb, h->mb + 256 + 16*4*chroma_idx, CHROMA_DC_BLOCK_INDEX, chroma_dc_scan, NULL, 4) < 0){",
          "content_same": false
        },
        {
          "line": 1001,
          "old_api": null,
          "new_api": "IS_INTRA",
          "old_text": null,
          "new_text": "IS_INTRA( mb_type )",
          "old_line_content": "        if(cbp&0x20){",
          "new_line_content": "                const uint32_t *qmul = h->dequant4_coeff[chroma_idx+1+(IS_INTRA( mb_type ) ? 0:3)][h->chroma_qp[chroma_idx]];",
          "content_same": false
        },
        {
          "line": 1004,
          "old_api": null,
          "new_api": "decode_residual",
          "old_text": null,
          "new_text": "decode_residual(h, gb, h->mb + 16*index, index, scan + 1, qmul, 15)",
          "old_line_content": "                for(i4x4=0; i4x4<4; i4x4++){",
          "new_line_content": "                    if( decode_residual(h, gb, h->mb + 16*index, index, scan + 1, qmul, 15) < 0){",
          "content_same": false
        },
        {
          "line": 1016,
          "old_api": null,
          "new_api": "fill_rectangle",
          "old_text": null,
          "new_text": "fill_rectangle(&nnz[scan8[0]], 4, 4, 8, 0, 1)",
          "old_line_content": "    }else{",
          "new_line_content": "        fill_rectangle(&nnz[scan8[0]], 4, 4, 8, 0, 1);",
          "content_same": false
        },
        {
          "line": 1021,
          "old_api": null,
          "new_api": "write_back_non_zero_count",
          "old_text": null,
          "new_text": "write_back_non_zero_count(h)",
          "old_line_content": "    }",
          "new_line_content": "    write_back_non_zero_count(h);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 915,
          "old_api": "IS_INTRA16x16",
          "new_api": null,
          "old_text": "IS_INTRA16x16(mb_type)",
          "new_text": null,
          "old_line_content": "    if(cbp || IS_INTRA16x16(mb_type)){",
          "new_line_content": "        int dquant;",
          "content_same": false
        },
        {
          "line": 918,
          "old_api": "IS_INTRA",
          "new_api": null,
          "old_text": "IS_INTRA(mb_type)",
          "new_text": null,
          "old_line_content": "        GetBitContext *gb= IS_INTRA(mb_type) ? h->intra_gb_ptr : h->inter_gb_ptr;",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 921,
          "old_api": "IS_INTERLACED",
          "new_api": null,
          "old_text": "IS_INTERLACED(mb_type)",
          "new_text": null,
          "old_line_content": "        if(IS_INTERLACED(mb_type)){",
          "new_line_content": "            scan= s->qscale ? h->field_scan : h->field_scan_q0;",
          "content_same": false
        },
        {
          "line": 931,
          "old_api": "get_se_golomb",
          "new_api": null,
          "old_text": "get_se_golomb(&s->gb)",
          "new_text": null,
          "old_line_content": "        dquant= get_se_golomb(&s->gb);",
          "new_line_content": "        s->qscale += dquant;",
          "content_same": false
        },
        {
          "line": 939,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(h->s.avctx, AV_LOG_ERROR, \"dquant out of range (%d) at %d %d\\n\", dquant, s->mb_x, s->mb_y)",
          "new_text": null,
          "old_line_content": "                av_log(h->s.avctx, AV_LOG_ERROR, \"dquant out of range (%d) at %d %d\\n\", dquant, s->mb_x, s->mb_y);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 946,
          "old_api": "IS_INTRA16x16",
          "new_api": null,
          "old_text": "IS_INTRA16x16(mb_type)",
          "new_text": null,
          "old_line_content": "        if(IS_INTRA16x16(mb_type)){",
          "new_line_content": "                return -1; //FIXME continue if partitioned and other return -1 too",
          "content_same": false
        },
        {
          "line": 947,
          "old_api": "decode_residual",
          "new_api": null,
          "old_text": "decode_residual(h, h->intra_gb_ptr, h->mb, LUMA_DC_BLOCK_INDEX, dc_scan, h->dequant4_coeff[0][s->qscale], 16)",
          "new_text": null,
          "old_line_content": "            if( decode_residual(h, h->intra_gb_ptr, h->mb, LUMA_DC_BLOCK_INDEX, dc_scan, h->dequant4_coeff[0][s->qscale], 16) < 0){",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 951,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert((cbp&15) == 0 || (cbp&15) == 15)",
          "new_text": null,
          "old_line_content": "            assert((cbp&15) == 0 || (cbp&15) == 15);",
          "new_line_content": "            if(cbp&15){",
          "content_same": false
        },
        {
          "line": 957,
          "old_api": "decode_residual",
          "new_api": null,
          "old_text": "decode_residual(h, h->intra_gb_ptr, h->mb + 16*index, index, scan + 1, h->dequant4_coeff[0][s->qscale], 15)",
          "new_text": null,
          "old_line_content": "                        if( decode_residual(h, h->intra_gb_ptr, h->mb + 16*index, index, scan + 1, h->dequant4_coeff[0][s->qscale], 15) < 0 ){",
          "new_line_content": "                        }",
          "content_same": false
        },
        {
          "line": 963,
          "old_api": "fill_rectangle",
          "new_api": null,
          "old_text": "fill_rectangle(&h->non_zero_count_cache[scan8[0]], 4, 4, 8, 0, 1)",
          "new_text": null,
          "old_line_content": "                fill_rectangle(&h->non_zero_count_cache[scan8[0]], 4, 4, 8, 0, 1);",
          "new_line_content": "        }else{",
          "content_same": false
        },
        {
          "line": 968,
          "old_api": "IS_8x8DCT",
          "new_api": null,
          "old_text": "IS_8x8DCT(mb_type)",
          "new_text": null,
          "old_line_content": "                    if(IS_8x8DCT(mb_type)){",
          "new_line_content": "                        uint8_t *nnz;",
          "content_same": false
        },
        {
          "line": 972,
          "old_api": "decode_residual",
          "new_api": null,
          "old_text": "decode_residual(h, gb, buf, i4x4+4*i8x8, scan8x8+16*i4x4,\n                                                h->dequant8_coeff[IS_INTRA( mb_type ) ? 0:1][s->qscale], 16)",
          "new_text": null,
          "old_line_content": "                            if( decode_residual(h, gb, buf, i4x4+4*i8x8, scan8x8+16*i4x4,",
          "new_line_content": "                                return -1;",
          "content_same": false
        },
        {
          "line": 973,
          "old_api": "IS_INTRA",
          "new_api": null,
          "old_text": "IS_INTRA( mb_type )",
          "new_text": null,
          "old_line_content": "                                                h->dequant8_coeff[IS_INTRA( mb_type ) ? 0:1][s->qscale], 16) <0 )",
          "new_line_content": "                        }",
          "content_same": false
        },
        {
          "line": 982,
          "old_api": "IS_INTRA",
          "new_api": null,
          "old_text": "IS_INTRA( mb_type )",
          "new_text": null,
          "old_line_content": "                            if( decode_residual(h, gb, h->mb + 16*index, index, scan, h->dequant4_coeff[IS_INTRA( mb_type ) ? 0:3][s->qscale], 16) <0 ){",
          "new_line_content": "                            }",
          "content_same": false
        },
        {
          "line": 996,
          "old_api": "decode_residual",
          "new_api": null,
          "old_text": "decode_residual(h, gb, h->mb + 256 + 16*4*chroma_idx, CHROMA_DC_BLOCK_INDEX, chroma_dc_scan, NULL, 4)",
          "new_text": null,
          "old_line_content": "                if( decode_residual(h, gb, h->mb + 256 + 16*4*chroma_idx, CHROMA_DC_BLOCK_INDEX, chroma_dc_scan, NULL, 4) < 0){",
          "new_line_content": "                }",
          "content_same": false
        },
        {
          "line": 1003,
          "old_api": "IS_INTRA",
          "new_api": null,
          "old_text": "IS_INTRA( mb_type )",
          "new_text": null,
          "old_line_content": "                const uint32_t *qmul = h->dequant4_coeff[chroma_idx+1+(IS_INTRA( mb_type ) ? 0:3)][h->chroma_qp[chroma_idx]];",
          "new_line_content": "                    const int index= 16 + 4*chroma_idx + i4x4;",
          "content_same": false
        },
        {
          "line": 1006,
          "old_api": "decode_residual",
          "new_api": null,
          "old_text": "decode_residual(h, gb, h->mb + 16*index, index, scan + 1, qmul, 15)",
          "new_text": null,
          "old_line_content": "                    if( decode_residual(h, gb, h->mb + 16*index, index, scan + 1, qmul, 15) < 0){",
          "new_line_content": "                    }",
          "content_same": false
        },
        {
          "line": 1018,
          "old_api": "fill_rectangle",
          "new_api": null,
          "old_text": "fill_rectangle(&nnz[scan8[0]], 4, 4, 8, 0, 1)",
          "new_text": null,
          "old_line_content": "        fill_rectangle(&nnz[scan8[0]], 4, 4, 8, 0, 1);",
          "new_line_content": "        nnz[ scan8[20]+0 ] = nnz[ scan8[20]+1 ] =nnz[ scan8[20]+8 ] =nnz[ scan8[20]+9 ] = 0;",
          "content_same": false
        },
        {
          "line": 1023,
          "old_api": "write_back_non_zero_count",
          "new_api": null,
          "old_text": "write_back_non_zero_count(h)",
          "new_text": null,
          "old_line_content": "    write_back_non_zero_count(h);",
          "new_line_content": "    if(MB_MBAFF){",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 2,
      "total_additions": 19,
      "total_deletions": 19,
      "total_api_changes": 40
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 3,
        "api_related_lines": 40,
        "non_api_lines": 3,
        "non_api_line_numbers": [
          907,
          908,
          909
        ]
      }
    },
    "api_calls_before": 172,
    "api_calls_after": 172,
    "diff_info": {
      "added_lines": 1,
      "removed_lines": 3,
      "total_diff_lines": 16
    }
  }
}