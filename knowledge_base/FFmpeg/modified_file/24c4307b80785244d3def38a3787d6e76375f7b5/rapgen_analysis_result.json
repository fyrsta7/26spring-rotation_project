{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/24c4307b80785244d3def38a3787d6e76375f7b5",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/24c4307b80785244d3def38a3787d6e76375f7b5/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/24c4307b80785244d3def38a3787d6e76375f7b5/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/24c4307b80785244d3def38a3787d6e76375f7b5/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 1182,
          "old_api": "ff_vk_ret2str",
          "new_api": "av_log",
          "old_text": "ff_vk_ret2str(ret)",
          "new_text": "av_log(avctx, AV_LOG_ERROR, \"Unable to create empty Vulkan video session parameters: %s!\\n\",\n               ff_vk_ret2str(ret))",
          "old_line_content": "               ff_vk_ret2str(ret));",
          "new_line_content": "        av_log(avctx, AV_LOG_ERROR, \"Unable to create empty Vulkan video session parameters: %s!\\n\",",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 1121,
          "old_api": null,
          "new_api": "av_chroma_location_enum_to_pos",
          "old_text": null,
          "new_text": "av_chroma_location_enum_to_pos(&cxpos, &cypos, avctx->chroma_sample_location)",
          "old_line_content": "    yuv_sampler_info.xChromaOffset = cxpos >> 7;",
          "new_line_content": "    av_chroma_location_enum_to_pos(&cxpos, &cypos, avctx->chroma_sample_location);",
          "content_same": false
        },
        {
          "line": 1187,
          "old_api": null,
          "new_api": "ff_vk_decode_flush",
          "old_text": null,
          "new_text": "ff_vk_decode_flush(avctx)",
          "old_line_content": "",
          "new_line_content": "    ff_vk_decode_flush(avctx);",
          "content_same": false
        },
        {
          "line": 1125,
          "old_api": null,
          "new_api": "CreateSamplerYcbcrConversion",
          "old_text": null,
          "new_text": "vk->CreateSamplerYcbcrConversion(s->hwctx->act_dev, &yuv_sampler_info,\n                                           s->hwctx->alloc, &ctx->yuv_sampler)",
          "old_line_content": "                                           s->hwctx->alloc, &ctx->yuv_sampler);",
          "new_line_content": "    ret = vk->CreateSamplerYcbcrConversion(s->hwctx->act_dev, &yuv_sampler_info,",
          "content_same": false
        },
        {
          "line": 1189,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(avctx, AV_LOG_VERBOSE, \"Vulkan decoder initialization sucessful\\n\")",
          "old_line_content": "",
          "new_line_content": "    av_log(avctx, AV_LOG_VERBOSE, \"Vulkan decoder initialization sucessful\\n\");",
          "content_same": false
        },
        {
          "line": 1159,
          "old_api": null,
          "new_api": "av_hwframe_ctx_init",
          "old_text": null,
          "new_text": "av_hwframe_ctx_init(ctx->dpb_hwfc_ref)",
          "old_line_content": "        if (err < 0)",
          "new_line_content": "        err = av_hwframe_ctx_init(ctx->dpb_hwfc_ref);",
          "content_same": false
        },
        {
          "line": 1194,
          "old_api": null,
          "new_api": "ff_vk_decode_uninit",
          "old_text": null,
          "new_text": "ff_vk_decode_uninit(avctx)",
          "old_line_content": "",
          "new_line_content": "    ff_vk_decode_uninit(avctx);",
          "content_same": false
        },
        {
          "line": 1164,
          "old_api": null,
          "new_api": "vk_get_dpb_pool",
          "old_text": null,
          "new_text": "vk_get_dpb_pool(ctx)",
          "old_line_content": "            if (!ctx->layered_frame) {",
          "new_line_content": "            ctx->layered_frame = vk_get_dpb_pool(ctx);",
          "content_same": false
        },
        {
          "line": 1166,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(ENOMEM)",
          "old_line_content": "                goto fail;",
          "new_line_content": "                err = AVERROR(ENOMEM);",
          "content_same": false
        },
        {
          "line": 1137,
          "old_api": null,
          "new_api": "av_hwframe_ctx_alloc",
          "old_text": null,
          "new_text": "av_hwframe_ctx_alloc(s->frames->device_ref)",
          "old_line_content": "        if (!ctx->dpb_hwfc_ref) {",
          "new_line_content": "        ctx->dpb_hwfc_ref = av_hwframe_ctx_alloc(s->frames->device_ref);",
          "content_same": false
        },
        {
          "line": 1170,
          "old_api": null,
          "new_api": "vk_decode_create_view",
          "old_text": null,
          "new_text": "vk_decode_create_view(ctx, &ctx->layered_view, &ctx->layered_aspect,\n                                        (AVVkFrame *)ctx->layered_frame->data[0],\n                                        s->hwfc->format[0])",
          "old_line_content": "                                        (AVVkFrame *)ctx->layered_frame->data[0],",
          "new_line_content": "            err = vk_decode_create_view(ctx, &ctx->layered_view, &ctx->layered_aspect,",
          "content_same": false
        },
        {
          "line": 1139,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(ENOMEM)",
          "old_line_content": "            goto fail;",
          "new_line_content": "            err = AVERROR(ENOMEM);",
          "content_same": false
        },
        {
          "line": 1110,
          "old_api": null,
          "new_api": "ff_vk_exec_pool_init",
          "old_text": null,
          "new_text": "ff_vk_exec_pool_init(s, &qf_dec, &ctx->exec_pool, 2*avctx->thread_count,\n                               nb_q, VK_QUERY_TYPE_RESULT_STATUS_ONLY_KHR, 0,\n                               session_create.pVideoProfile)",
          "old_line_content": "                               nb_q, VK_QUERY_TYPE_RESULT_STATUS_ONLY_KHR, 0,",
          "new_line_content": "    err = ff_vk_exec_pool_init(s, &qf_dec, &ctx->exec_pool, 2*avctx->thread_count,",
          "content_same": false
        },
        {
          "line": 1179,
          "old_api": null,
          "new_api": "CreateVideoSessionParametersKHR",
          "old_text": null,
          "new_text": "vk->CreateVideoSessionParametersKHR(s->hwctx->act_dev, &session_params_create,\n                                              s->hwctx->alloc, &ctx->empty_session_params)",
          "old_line_content": "                                              s->hwctx->alloc, &ctx->empty_session_params);",
          "new_line_content": "    ret = vk->CreateVideoSessionParametersKHR(s->hwctx->act_dev, &session_params_create,",
          "content_same": false
        },
        {
          "line": 1116,
          "old_api": null,
          "new_api": "ff_vk_video_common_init",
          "old_text": null,
          "new_text": "ff_vk_video_common_init(avctx, s, &ctx->common, &session_create)",
          "old_line_content": "    if (err < 0)",
          "new_line_content": "    err = ff_vk_video_common_init(avctx, s, &ctx->common, &session_create);",
          "content_same": false
        },
        {
          "line": 1183,
          "old_api": null,
          "new_api": "ff_vk_ret2str",
          "old_text": null,
          "new_text": "ff_vk_ret2str(ret)",
          "old_line_content": "        return AVERROR_EXTERNAL;",
          "new_line_content": "               ff_vk_ret2str(ret));",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 1120,
          "old_api": "av_chroma_location_enum_to_pos",
          "new_api": null,
          "old_text": "av_chroma_location_enum_to_pos(&cxpos, &cypos, avctx->chroma_sample_location)",
          "new_text": null,
          "old_line_content": "    av_chroma_location_enum_to_pos(&cxpos, &cypos, avctx->chroma_sample_location);",
          "new_line_content": "    /* Get sampler */",
          "content_same": false
        },
        {
          "line": 1186,
          "old_api": "ff_vk_decode_flush",
          "new_api": null,
          "old_text": "ff_vk_decode_flush(avctx)",
          "new_text": null,
          "old_line_content": "    ff_vk_decode_flush(avctx);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1124,
          "old_api": "CreateSamplerYcbcrConversion",
          "new_api": null,
          "old_text": "vk->CreateSamplerYcbcrConversion(s->hwctx->act_dev, &yuv_sampler_info,\n                                           s->hwctx->alloc, &ctx->yuv_sampler)",
          "new_text": null,
          "old_line_content": "    ret = vk->CreateSamplerYcbcrConversion(s->hwctx->act_dev, &yuv_sampler_info,",
          "new_line_content": "    yuv_sampler_info.format = s->hwfc->format[0];",
          "content_same": false
        },
        {
          "line": 1188,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(avctx, AV_LOG_VERBOSE, \"Vulkan decoder initialization sucessful\\n\")",
          "new_text": null,
          "old_line_content": "    av_log(avctx, AV_LOG_VERBOSE, \"Vulkan decoder initialization sucessful\\n\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1158,
          "old_api": "av_hwframe_ctx_init",
          "new_api": null,
          "old_text": "av_hwframe_ctx_init(ctx->dpb_hwfc_ref)",
          "new_text": null,
          "old_line_content": "        err = av_hwframe_ctx_init(ctx->dpb_hwfc_ref);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1193,
          "old_api": "ff_vk_decode_uninit",
          "new_api": null,
          "old_text": "ff_vk_decode_uninit(avctx)",
          "new_text": null,
          "old_line_content": "    ff_vk_decode_uninit(avctx);",
          "new_line_content": "fail:",
          "content_same": false
        },
        {
          "line": 1163,
          "old_api": "vk_get_dpb_pool",
          "new_api": null,
          "old_text": "vk_get_dpb_pool(ctx)",
          "new_text": null,
          "old_line_content": "            ctx->layered_frame = vk_get_dpb_pool(ctx);",
          "new_line_content": "        if (dec->layered_dpb) {",
          "content_same": false
        },
        {
          "line": 1165,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(ENOMEM)",
          "new_text": null,
          "old_line_content": "                err = AVERROR(ENOMEM);",
          "new_line_content": "            if (!ctx->layered_frame) {",
          "content_same": false
        },
        {
          "line": 1136,
          "old_api": "av_hwframe_ctx_alloc",
          "new_api": null,
          "old_text": "av_hwframe_ctx_alloc(s->frames->device_ref)",
          "new_text": null,
          "old_line_content": "        ctx->dpb_hwfc_ref = av_hwframe_ctx_alloc(s->frames->device_ref);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1169,
          "old_api": "vk_decode_create_view",
          "new_api": null,
          "old_text": "vk_decode_create_view(ctx, &ctx->layered_view, &ctx->layered_aspect,\n                                        (AVVkFrame *)ctx->layered_frame->data[0],\n                                        s->hwfc->format[0])",
          "new_text": null,
          "old_line_content": "            err = vk_decode_create_view(ctx, &ctx->layered_view, &ctx->layered_aspect,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1138,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(ENOMEM)",
          "new_text": null,
          "old_line_content": "            err = AVERROR(ENOMEM);",
          "new_line_content": "        if (!ctx->dpb_hwfc_ref) {",
          "content_same": false
        },
        {
          "line": 1109,
          "old_api": "ff_vk_exec_pool_init",
          "new_api": null,
          "old_text": "ff_vk_exec_pool_init(s, &qf_dec, &ctx->exec_pool, 4*avctx->thread_count,\n                               nb_q, VK_QUERY_TYPE_RESULT_STATUS_ONLY_KHR, 0,\n                               session_create.pVideoProfile)",
          "new_text": null,
          "old_line_content": "    err = ff_vk_exec_pool_init(s, &qf_dec, &ctx->exec_pool, 4*avctx->thread_count,",
          "new_line_content": "     * for a majority of streams. */",
          "content_same": false
        },
        {
          "line": 1178,
          "old_api": "CreateVideoSessionParametersKHR",
          "new_api": null,
          "old_text": "vk->CreateVideoSessionParametersKHR(s->hwctx->act_dev, &session_params_create,\n                                              s->hwctx->alloc, &ctx->empty_session_params)",
          "new_text": null,
          "old_line_content": "    ret = vk->CreateVideoSessionParametersKHR(s->hwctx->act_dev, &session_params_create,",
          "new_line_content": "    session_params_create.videoSession = ctx->common.session;",
          "content_same": false
        },
        {
          "line": 1115,
          "old_api": "ff_vk_video_common_init",
          "new_api": null,
          "old_text": "ff_vk_video_common_init(avctx, s, &ctx->common, &session_create)",
          "new_text": null,
          "old_line_content": "    err = ff_vk_video_common_init(avctx, s, &ctx->common, &session_create);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1181,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(avctx, AV_LOG_ERROR, \"Unable to create empty Vulkan video session parameters: %s!\\n\",\n               ff_vk_ret2str(ret))",
          "new_text": null,
          "old_line_content": "        av_log(avctx, AV_LOG_ERROR, \"Unable to create empty Vulkan video session parameters: %s!\\n\",",
          "new_line_content": "    if (ret != VK_SUCCESS) {",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 1,
      "total_additions": 15,
      "total_deletions": 15,
      "total_api_changes": 31
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 3,
        "api_related_lines": 31,
        "non_api_lines": 1,
        "non_api_line_numbers": [
          1108
        ]
      }
    },
    "api_calls_before": 182,
    "api_calls_after": 182,
    "diff_info": {
      "added_lines": 3,
      "removed_lines": 2,
      "total_diff_lines": 17
    }
  }
}