{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/07a8fbaa553205b496b68a62cb7bf7a968d0281b",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/07a8fbaa553205b496b68a62cb7bf7a968d0281b/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/07a8fbaa553205b496b68a62cb7bf7a968d0281b/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/07a8fbaa553205b496b68a62cb7bf7a968d0281b/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 196,
          "old_api": "encode_end",
          "new_api": "av_malloc",
          "old_text": "encode_end(avctx)",
          "new_text": "av_malloc(NELLY_BANDS * OPT_SIZE * sizeof(float  ))",
          "old_line_content": "    encode_end(avctx);",
          "new_line_content": "        s->opt  = av_malloc(NELLY_BANDS * OPT_SIZE * sizeof(float  ));",
          "content_same": false
        },
        {
          "line": 254,
          "old_api": "FFMAX",
          "new_api": "distance",
          "old_text": "FFMAX(0, cand[band] - q)",
          "new_text": "distance(cand[0], ff_nelly_init_table[i], 0)",
          "old_line_content": "            idx_min = FFMAX(0, cand[band] - q);",
          "new_line_content": "        opt[0][ff_nelly_init_table[i]] = distance(cand[0], ff_nelly_init_table[i], 0);",
          "content_same": false
        },
        {
          "line": 264,
          "old_api": "distance",
          "new_api": "FFMAX",
          "old_text": "distance(idx, power_candidate, band)",
          "new_text": "FFMAX(0, cand[band] - q)",
          "old_line_content": "                        tmp = opt[band - 1][i] + distance(idx, power_candidate, band);",
          "new_line_content": "            idx_min = FFMAX(0, cand[band] - q);",
          "content_same": false
        },
        {
          "line": 274,
          "old_api": "av_assert1",
          "new_api": "distance",
          "old_text": "av_assert1(c)",
          "new_text": "distance(idx, power_candidate, band)",
          "old_line_content": "        av_assert1(c); //FIXME",
          "new_line_content": "                        tmp = opt[band - 1][i] + distance(idx, power_candidate, band);",
          "content_same": false
        },
        {
          "line": 321,
          "old_api": "FFMAX",
          "new_api": "init_put_bits",
          "old_text": "FFMAX(1.0, coeff_sum / (ff_nelly_band_sizes_table[band] << 7))",
          "new_text": "init_put_bits(&pb, output, output_size)",
          "old_line_content": "            log2(FFMAX(1.0, coeff_sum / (ff_nelly_band_sizes_table[band] << 7))) * 1024.0;",
          "new_line_content": "    init_put_bits(&pb, output, output_size);",
          "content_same": false
        },
        {
          "line": 337,
          "old_api": "put_bits",
          "new_api": "get_exponent_greedy",
          "old_text": "put_bits(&pb, 6, idx_table[0])",
          "new_text": "get_exponent_greedy(s, cand, idx_table)",
          "old_line_content": "            put_bits(&pb, 6, idx_table[0]);",
          "new_line_content": "        get_exponent_greedy(s, cand, idx_table);",
          "content_same": false
        },
        {
          "line": 347,
          "old_api": "ff_nelly_get_sample_bits",
          "new_api": "put_bits",
          "old_text": "ff_nelly_get_sample_bits(pows, bits)",
          "new_text": "put_bits(&pb, 6, idx_table[0])",
          "old_line_content": "    ff_nelly_get_sample_bits(pows, bits);",
          "new_line_content": "            put_bits(&pb, 6, idx_table[0]);",
          "content_same": false
        },
        {
          "line": 370,
          "old_api": "flush_put_bits",
          "new_api": "fabs",
          "old_text": "flush_put_bits(&pb)",
          "new_text": "fabs(coeff - table[best_idx + 1])",
          "old_line_content": "    flush_put_bits(&pb);",
          "new_line_content": "                if (fabs(coeff - table[best_idx]) > fabs(coeff - table[best_idx + 1]))",
          "content_same": false
        },
        {
          "line": 393,
          "old_api": "ff_af_queue_add",
          "new_api": "memcpy",
          "old_text": "ff_af_queue_add(&s->afq, frame)",
          "new_text": "memcpy(s->buf, s->buf + NELLY_SAMPLES, NELLY_BUF_LEN * sizeof(*s->buf))",
          "old_line_content": "        if ((ret = ff_af_queue_add(&s->afq, frame)) < 0)",
          "new_line_content": "    memcpy(s->buf, s->buf + NELLY_SAMPLES, NELLY_BUF_LEN * sizeof(*s->buf));",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 265,
          "old_api": null,
          "new_api": "FFMIN",
          "old_text": null,
          "new_text": "FFMIN(OPT_SIZE, cand[band - 1] + q)",
          "old_line_content": "                        if (opt[band][idx] > tmp) {",
          "new_line_content": "            idx_max = FFMIN(OPT_SIZE, cand[band - 1] + q);",
          "content_same": false
        },
        {
          "line": 266,
          "old_api": null,
          "new_api": "FFMIN",
          "old_text": null,
          "new_text": "FFMIN(OPT_SIZE, cand[band - 1] + q)",
          "old_line_content": "                            opt[band][idx] = tmp;",
          "new_line_content": "            for (i = FFMAX(0, cand[band - 1] - q); i < FFMIN(OPT_SIZE, cand[band - 1] + q); i++) {",
          "content_same": false
        },
        {
          "line": 267,
          "old_api": null,
          "new_api": "isinf",
          "old_text": null,
          "new_text": "isinf(opt[band - 1][i])",
          "old_line_content": "                            path[band][idx] = j;",
          "new_line_content": "                if ( isinf(opt[band - 1][i]) )",
          "content_same": false
        },
        {
          "line": 395,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(s->buf + NELLY_BUF_LEN, frame->data[0],\n               frame->nb_samples * sizeof(*s->buf))",
          "old_line_content": "    } else {",
          "new_line_content": "        memcpy(s->buf + NELLY_BUF_LEN, frame->data[0],",
          "content_same": false
        },
        {
          "line": 398,
          "old_api": null,
          "new_api": "memset",
          "old_text": null,
          "new_text": "memset(s->buf + NELLY_BUF_LEN + frame->nb_samples, 0,\n                   (NELLY_SAMPLES - frame->nb_samples) * sizeof(*s->buf))",
          "old_line_content": "    }",
          "new_line_content": "            memset(s->buf + NELLY_BUF_LEN + frame->nb_samples, 0,",
          "content_same": false
        },
        {
          "line": 403,
          "old_api": null,
          "new_api": "ff_af_queue_add",
          "old_text": null,
          "new_text": "ff_af_queue_add(&s->afq, frame)",
          "old_line_content": "",
          "new_line_content": "        if ((ret = ff_af_queue_add(&s->afq, frame)) < 0)",
          "content_same": false
        },
        {
          "line": 406,
          "old_api": null,
          "new_api": "memset",
          "old_text": null,
          "new_text": "memset(s->buf + NELLY_BUF_LEN, 0, NELLY_SAMPLES * sizeof(*s->buf))",
          "old_line_content": "                       &avpkt->duration);",
          "new_line_content": "        memset(s->buf + NELLY_BUF_LEN, 0, NELLY_SAMPLES * sizeof(*s->buf));",
          "content_same": false
        },
        {
          "line": 410,
          "old_api": null,
          "new_api": "ff_alloc_packet2",
          "old_text": null,
          "new_text": "ff_alloc_packet2(avctx, avpkt, NELLY_BLOCK_LEN, 0)",
          "old_line_content": "}",
          "new_line_content": "    if ((ret = ff_alloc_packet2(avctx, avpkt, NELLY_BLOCK_LEN, 0)) < 0)",
          "content_same": false
        },
        {
          "line": 412,
          "old_api": null,
          "new_api": "encode_block",
          "old_text": null,
          "new_text": "encode_block(s, avpkt->data, avpkt->size)",
          "old_line_content": "AVCodec ff_nellymoser_encoder = {",
          "new_line_content": "    encode_block(s, avpkt->data, avpkt->size);",
          "content_same": false
        },
        {
          "line": 284,
          "old_api": null,
          "new_api": "av_assert1",
          "old_text": null,
          "new_text": "av_assert1(c)",
          "old_line_content": "        }",
          "new_line_content": "        av_assert1(c); //FIXME",
          "content_same": false
        },
        {
          "line": 415,
          "old_api": null,
          "new_api": "ff_af_queue_remove",
          "old_text": null,
          "new_text": "ff_af_queue_remove(&s->afq, avctx->frame_size, &avpkt->pts,\n                       &avpkt->duration)",
          "old_line_content": "    .type           = AVMEDIA_TYPE_AUDIO,",
          "new_line_content": "    ff_af_queue_remove(&s->afq, avctx->frame_size, &avpkt->pts,",
          "content_same": false
        },
        {
          "line": 424,
          "old_api": null,
          "new_api": "NULL_IF_CONFIG_SMALL",
          "old_text": null,
          "new_text": "NULL_IF_CONFIG_SMALL(\"Nellymoser Asao\")",
          "old_line_content": "};",
          "new_line_content": "    .long_name      = NULL_IF_CONFIG_SMALL(\"Nellymoser Asao\"),",
          "content_same": false
        },
        {
          "line": 188,
          "old_api": null,
          "new_api": "exp2",
          "old_text": null,
          "new_text": "exp2(-i / 2048.0)",
          "old_line_content": "        if (!s->opt || !s->path) {",
          "new_line_content": "        double tmp = exp2(-i / 2048.0);",
          "content_same": false
        },
        {
          "line": 319,
          "old_api": null,
          "new_api": "apply_mdct",
          "old_text": null,
          "new_text": "apply_mdct(s)",
          "old_line_content": "        }",
          "new_line_content": "    apply_mdct(s);",
          "content_same": false
        },
        {
          "line": 197,
          "old_api": null,
          "new_api": "av_malloc",
          "old_text": null,
          "new_text": "av_malloc(NELLY_BANDS * OPT_SIZE * sizeof(uint8_t))",
          "old_line_content": "    return ret;",
          "new_line_content": "        s->path = av_malloc(NELLY_BANDS * OPT_SIZE * sizeof(uint8_t));",
          "content_same": false
        },
        {
          "line": 199,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(ENOMEM)",
          "old_line_content": "",
          "new_line_content": "            ret = AVERROR(ENOMEM);",
          "content_same": false
        },
        {
          "line": 331,
          "old_api": null,
          "new_api": "FFMAX",
          "old_text": null,
          "new_text": "FFMAX(1.0, coeff_sum / (ff_nelly_band_sizes_table[band] << 7))",
          "old_line_content": "    for (band = 0; band < NELLY_BANDS; band++) {",
          "new_line_content": "            log2(FFMAX(1.0, coeff_sum / (ff_nelly_band_sizes_table[band] << 7))) * 1024.0;",
          "content_same": false
        },
        {
          "line": 206,
          "old_api": null,
          "new_api": "encode_end",
          "old_text": null,
          "new_text": "encode_end(avctx)",
          "old_line_content": "static void get_exponent_greedy(NellyMoserEncodeContext *s, float *cand, int *idx_table)",
          "new_line_content": "    encode_end(avctx);",
          "content_same": false
        },
        {
          "line": 335,
          "old_api": null,
          "new_api": "get_exponent_dynamic",
          "old_text": null,
          "new_text": "get_exponent_dynamic(s, cand, idx_table)",
          "old_line_content": "        } else {",
          "new_line_content": "        get_exponent_dynamic(s, cand, idx_table);",
          "content_same": false
        },
        {
          "line": 344,
          "old_api": null,
          "new_api": "put_bits",
          "old_text": null,
          "new_text": "put_bits(&pb, 5, idx_table[band])",
          "old_line_content": "        }",
          "new_line_content": "            put_bits(&pb, 5, idx_table[band]);",
          "content_same": false
        },
        {
          "line": 222,
          "old_api": null,
          "new_api": "find_best",
          "old_text": null,
          "new_text": "find_best(cand[0], ff_nelly_init_table, sf_lut, -20, 96)",
          "old_line_content": "}",
          "new_line_content": "    find_best(cand[0], ff_nelly_init_table, sf_lut, -20, 96);",
          "content_same": false
        },
        {
          "line": 228,
          "old_api": null,
          "new_api": "find_best",
          "old_text": null,
          "new_text": "find_best(power_candidate, ff_nelly_delta_table, sf_delta_lut, 37, 78)",
          "old_line_content": "    return tmp * tmp;",
          "new_line_content": "        find_best(power_candidate, ff_nelly_delta_table, sf_delta_lut, 37, 78);",
          "content_same": false
        },
        {
          "line": 357,
          "old_api": null,
          "new_api": "ff_nelly_get_sample_bits",
          "old_text": null,
          "new_text": "ff_nelly_get_sample_bits(pows, bits)",
          "old_line_content": "                            quant_lut_offset[bits[i]],",
          "new_line_content": "    ff_nelly_get_sample_bits(pows, bits);",
          "content_same": false
        },
        {
          "line": 365,
          "old_api": null,
          "new_api": "av_clip (\n                            coeff * quant_lut_mul[bits[i]] + quant_lut_add[bits[i]],\n                            quant_lut_offset[bits[i]],\n                            quant_lut_offset[bits[i]+1] - 1\n                            )",
          "old_text": null,
          "new_text": "av_clip (\n                            coeff * quant_lut_mul[bits[i]] + quant_lut_add[bits[i]],\n                            quant_lut_offset[bits[i]],\n                            quant_lut_offset[bits[i]+1] - 1\n                            )",
          "old_line_content": "        }",
          "new_line_content": "                    quant_lut[av_clip (",
          "content_same": false
        },
        {
          "line": 373,
          "old_api": null,
          "new_api": "put_bits",
          "old_text": null,
          "new_text": "put_bits(&pb, bits[i], best_idx)",
          "old_line_content": "",
          "new_line_content": "                put_bits(&pb, bits[i], best_idx);",
          "content_same": false
        },
        {
          "line": 377,
          "old_api": null,
          "new_api": "put_bits_count",
          "old_text": null,
          "new_text": "put_bits_count(&pb)",
          "old_line_content": "    NellyMoserEncodeContext *s = avctx->priv_data;",
          "new_line_content": "            put_bits(&pb, NELLY_HEADER_BITS + NELLY_DETAIL_BITS - put_bits_count(&pb), 0);",
          "content_same": false
        },
        {
          "line": 380,
          "old_api": null,
          "new_api": "flush_put_bits",
          "old_text": null,
          "new_text": "flush_put_bits(&pb)",
          "old_line_content": "    if (s->last_frame)",
          "new_line_content": "    flush_put_bits(&pb);",
          "content_same": false
        },
        {
          "line": 381,
          "old_api": null,
          "new_api": "put_bits_ptr",
          "old_text": null,
          "new_text": "put_bits_ptr(&pb)",
          "old_line_content": "        return 0;",
          "new_line_content": "    memset(put_bits_ptr(&pb), 0, output + output_size - put_bits_ptr(&pb));",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 256,
          "old_api": "FFMIN",
          "new_api": null,
          "old_text": "FFMIN(OPT_SIZE, cand[band - 1] + q)",
          "new_text": null,
          "old_line_content": "            for (i = FFMAX(0, cand[band - 1] - q); i < FFMIN(OPT_SIZE, cand[band - 1] + q); i++) {",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 257,
          "old_api": "isinf",
          "new_api": null,
          "old_text": "isinf(opt[band - 1][i])",
          "new_text": null,
          "old_line_content": "                if ( isinf(opt[band - 1][i]) )",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 385,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(s->buf + NELLY_BUF_LEN, frame->data[0],\n               frame->nb_samples * sizeof(*s->buf))",
          "new_text": null,
          "old_line_content": "        memcpy(s->buf + NELLY_BUF_LEN, frame->data[0],",
          "new_line_content": "                        const AVFrame *frame, int *got_packet_ptr)",
          "content_same": false
        },
        {
          "line": 388,
          "old_api": "memset",
          "new_api": null,
          "old_text": "memset(s->buf + NELLY_BUF_LEN + frame->nb_samples, 0,\n                   (NELLY_SAMPLES - frame->nb_samples) * sizeof(*s->buf))",
          "new_text": null,
          "old_line_content": "            memset(s->buf + NELLY_BUF_LEN + frame->nb_samples, 0,",
          "new_line_content": "    int ret;",
          "content_same": false
        },
        {
          "line": 383,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(s->buf, s->buf + NELLY_SAMPLES, NELLY_BUF_LEN * sizeof(*s->buf))",
          "new_text": null,
          "old_line_content": "    memcpy(s->buf, s->buf + NELLY_SAMPLES, NELLY_BUF_LEN * sizeof(*s->buf));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 396,
          "old_api": "memset",
          "new_api": null,
          "old_text": "memset(s->buf + NELLY_BUF_LEN, 0, NELLY_SAMPLES * sizeof(*s->buf))",
          "new_text": null,
          "old_line_content": "        memset(s->buf + NELLY_BUF_LEN, 0, NELLY_SAMPLES * sizeof(*s->buf));",
          "new_line_content": "               frame->nb_samples * sizeof(*s->buf));",
          "content_same": false
        },
        {
          "line": 400,
          "old_api": "ff_alloc_packet2",
          "new_api": null,
          "old_text": "ff_alloc_packet2(avctx, avpkt, NELLY_BLOCK_LEN, 0)",
          "new_text": null,
          "old_line_content": "    if ((ret = ff_alloc_packet2(avctx, avpkt, NELLY_BLOCK_LEN, 0)) < 0)",
          "new_line_content": "            if (frame->nb_samples >= NELLY_BUF_LEN)",
          "content_same": false
        },
        {
          "line": 402,
          "old_api": "encode_block",
          "new_api": null,
          "old_text": "encode_block(s, avpkt->data, avpkt->size)",
          "new_text": null,
          "old_line_content": "    encode_block(s, avpkt->data, avpkt->size);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 405,
          "old_api": "ff_af_queue_remove",
          "new_api": null,
          "old_text": "ff_af_queue_remove(&s->afq, avctx->frame_size, &avpkt->pts,\n                       &avpkt->duration)",
          "new_text": null,
          "old_line_content": "    ff_af_queue_remove(&s->afq, avctx->frame_size, &avpkt->pts,",
          "new_line_content": "    } else {",
          "content_same": false
        },
        {
          "line": 414,
          "old_api": "NULL_IF_CONFIG_SMALL",
          "new_api": null,
          "old_text": "NULL_IF_CONFIG_SMALL(\"Nellymoser Asao\")",
          "new_text": null,
          "old_line_content": "    .long_name      = NULL_IF_CONFIG_SMALL(\"Nellymoser Asao\"),",
          "new_line_content": "    /* Get the next frame pts/duration */",
          "content_same": false
        },
        {
          "line": 309,
          "old_api": "apply_mdct",
          "new_api": null,
          "old_text": "apply_mdct(s)",
          "new_text": null,
          "old_line_content": "    apply_mdct(s);",
          "new_line_content": " */",
          "content_same": false
        },
        {
          "line": 183,
          "old_api": "pow",
          "new_api": null,
          "old_text": "pow(2, -i / 2048.0 - 3.0 + POW_TABLE_OFFSET)",
          "new_text": null,
          "old_line_content": "        pow_table[i] = pow(2, -i / 2048.0 - 3.0 + POW_TABLE_OFFSET);",
          "new_line_content": "    for (i = 0; i < POW_TABLE_SIZE; i++)",
          "content_same": false
        },
        {
          "line": 311,
          "old_api": "init_put_bits",
          "new_api": null,
          "old_text": "init_put_bits(&pb, output, output_size)",
          "new_text": null,
          "old_line_content": "    init_put_bits(&pb, output, output_size);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 186,
          "old_api": "av_malloc",
          "new_api": null,
          "old_text": "av_malloc(NELLY_BANDS * OPT_SIZE * sizeof(float  ))",
          "new_text": null,
          "old_line_content": "        s->opt  = av_malloc(NELLY_BANDS * OPT_SIZE * sizeof(float  ));",
          "new_line_content": "    pow_table[1024] = M_SQRT1_2;",
          "content_same": false
        },
        {
          "line": 187,
          "old_api": "av_malloc",
          "new_api": null,
          "old_text": "av_malloc(NELLY_BANDS * OPT_SIZE * sizeof(uint8_t))",
          "new_text": null,
          "old_line_content": "        s->path = av_malloc(NELLY_BANDS * OPT_SIZE * sizeof(uint8_t));",
          "new_line_content": "    for (i = 1; i < 513; i++) {",
          "content_same": false
        },
        {
          "line": 189,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(ENOMEM)",
          "new_text": null,
          "old_line_content": "            ret = AVERROR(ENOMEM);",
          "new_line_content": "        pow_table[i] = tmp;",
          "content_same": false
        },
        {
          "line": 325,
          "old_api": "get_exponent_dynamic",
          "new_api": null,
          "old_text": "get_exponent_dynamic(s, cand, idx_table)",
          "new_text": null,
          "old_line_content": "        get_exponent_dynamic(s, cand, idx_table);",
          "new_line_content": "        coeff_sum = 0;",
          "content_same": false
        },
        {
          "line": 327,
          "old_api": "get_exponent_greedy",
          "new_api": null,
          "old_text": "get_exponent_greedy(s, cand, idx_table)",
          "new_text": null,
          "old_line_content": "        get_exponent_greedy(s, cand, idx_table);",
          "new_line_content": "            coeff_sum += s->mdct_out[i                ] * s->mdct_out[i                ]",
          "content_same": false
        },
        {
          "line": 334,
          "old_api": "put_bits",
          "new_api": null,
          "old_text": "put_bits(&pb, 5, idx_table[band])",
          "new_text": null,
          "old_line_content": "            put_bits(&pb, 5, idx_table[band]);",
          "new_line_content": "    if (s->avctx->trellis) {",
          "content_same": false
        },
        {
          "line": 212,
          "old_api": "find_best",
          "new_api": null,
          "old_text": "find_best(cand[0], ff_nelly_init_table, sf_lut, -20, 96)",
          "new_text": null,
          "old_line_content": "    find_best(cand[0], ff_nelly_init_table, sf_lut, -20, 96);",
          "new_line_content": "        LUT[av_clip ((lrintf(val) >> 8) + LUT_add, 0, LUT_size - 1)]; \\",
          "content_same": false
        },
        {
          "line": 218,
          "old_api": "find_best",
          "new_api": null,
          "old_text": "find_best(power_candidate, ff_nelly_delta_table, sf_delta_lut, 37, 78)",
          "new_text": null,
          "old_line_content": "        find_best(power_candidate, ff_nelly_delta_table, sf_delta_lut, 37, 78);",
          "new_line_content": "    int band, best_idx, power_idx = 0;",
          "content_same": false
        },
        {
          "line": 355,
          "old_api": "av_clip (\n                            coeff * quant_lut_mul[bits[i]] + quant_lut_add[bits[i]],\n                            quant_lut_offset[bits[i]],\n                            quant_lut_offset[bits[i]+1] - 1\n                            )",
          "new_api": null,
          "old_text": "av_clip (\n                            coeff * quant_lut_mul[bits[i]] + quant_lut_add[bits[i]],\n                            quant_lut_offset[bits[i]],\n                            quant_lut_offset[bits[i]+1] - 1\n                            )",
          "new_text": null,
          "old_line_content": "                    quant_lut[av_clip (",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 360,
          "old_api": "fabs",
          "new_api": null,
          "old_text": "fabs(coeff - table[best_idx + 1])",
          "new_text": null,
          "old_line_content": "                if (fabs(coeff - table[best_idx]) > fabs(coeff - table[best_idx + 1]))",
          "new_line_content": "        for (i = 0; i < NELLY_FILL_LEN; i++) {",
          "content_same": false
        },
        {
          "line": 363,
          "old_api": "put_bits",
          "new_api": null,
          "old_text": "put_bits(&pb, bits[i], best_idx)",
          "new_text": null,
          "old_line_content": "                put_bits(&pb, bits[i], best_idx);",
          "new_line_content": "                coeff = s->mdct_out[block * NELLY_BUF_LEN + i];",
          "content_same": false
        },
        {
          "line": 367,
          "old_api": "put_bits_count",
          "new_api": null,
          "old_text": "put_bits_count(&pb)",
          "new_text": null,
          "old_line_content": "            put_bits(&pb, NELLY_HEADER_BITS + NELLY_DETAIL_BITS - put_bits_count(&pb), 0);",
          "new_line_content": "                            quant_lut_offset[bits[i]],",
          "content_same": false
        },
        {
          "line": 371,
          "old_api": "put_bits_ptr",
          "new_api": null,
          "old_text": "put_bits_ptr(&pb)",
          "new_text": null,
          "old_line_content": "    memset(put_bits_ptr(&pb), 0, output + output_size - put_bits_ptr(&pb));",
          "new_line_content": "                    best_idx++;",
          "content_same": false
        },
        {
          "line": 244,
          "old_api": "distance",
          "new_api": null,
          "old_text": "distance(cand[0], ff_nelly_init_table[i], 0)",
          "new_text": null,
          "old_line_content": "        opt[0][ff_nelly_init_table[i]] = distance(cand[0], ff_nelly_init_table[i], 0);",
          "new_line_content": "    float power_candidate, best_val;",
          "content_same": false
        },
        {
          "line": 255,
          "old_api": "FFMIN",
          "new_api": null,
          "old_text": "FFMIN(OPT_SIZE, cand[band - 1] + q)",
          "new_text": null,
          "old_line_content": "            idx_max = FFMIN(OPT_SIZE, cand[band - 1] + q);",
          "new_line_content": "        path[0][ff_nelly_init_table[i]] = i;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 9,
      "total_additions": 28,
      "total_deletions": 28,
      "total_api_changes": 65
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 12,
        "api_related_lines": 65,
        "non_api_lines": 7,
        "non_api_line_numbers": [
          192,
          193,
          182,
          184,
          185,
          190,
          191
        ]
      }
    },
    "api_calls_before": 63,
    "api_calls_after": 63,
    "diff_info": {
      "added_lines": 11,
      "removed_lines": 1,
      "total_diff_lines": 25
    }
  }
}