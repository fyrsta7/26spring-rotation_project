{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/8ad802e610771e1e63d6f105739b78b4aa6980d8",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/8ad802e610771e1e63d6f105739b78b4aa6980d8/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/8ad802e610771e1e63d6f105739b78b4aa6980d8/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/8ad802e610771e1e63d6f105739b78b4aa6980d8/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [],
      "additions": [
        {
          "line": 161,
          "old_api": null,
          "new_api": "av_free",
          "old_text": null,
          "new_text": "av_free(formats)",
          "old_line_content": "    }",
          "new_line_content": "        av_free(formats);",
          "content_same": false
        },
        {
          "line": 167,
          "old_api": null,
          "new_api": "avfilter_all_colorspaces",
          "old_text": null,
          "new_text": "avfilter_all_colorspaces()",
          "old_line_content": "    return 0;",
          "new_line_content": "    avfilter_set_common_formats(ctx, avfilter_all_colorspaces());",
          "content_same": false
        },
        {
          "line": 104,
          "old_api": null,
          "new_api": "avfilter_unref_pic",
          "old_text": null,
          "new_text": "avfilter_unref_pic(link->cur_pic)",
          "old_line_content": "    link->cur_pic = NULL;",
          "new_line_content": "    avfilter_unref_pic(link->cur_pic);",
          "content_same": false
        },
        {
          "line": 76,
          "old_api": null,
          "new_api": "avfilter_get_video_buffer",
          "old_text": null,
          "new_text": "avfilter_get_video_buffer(out, AV_PERM_WRITE, out->w, out->h)",
          "old_line_content": "        out->outpic->pts = picref->pts;",
          "new_line_content": "        out->outpic      = avfilter_get_video_buffer(out, AV_PERM_WRITE, out->w, out->h);",
          "content_same": false
        },
        {
          "line": 173,
          "old_api": null,
          "new_api": "avfilter_start_frame",
          "old_text": null,
          "new_text": "avfilter_start_frame(link->dst->outputs[0], picref)",
          "old_line_content": "}",
          "new_line_content": "    avfilter_start_frame(link->dst->outputs[0], picref);",
          "content_same": false
        },
        {
          "line": 109,
          "old_api": null,
          "new_api": "avfilter_unref_pic",
          "old_text": null,
          "new_text": "avfilter_unref_pic(out->outpic)",
          "old_line_content": "            out->outpic = NULL;",
          "new_line_content": "            avfilter_unref_pic(out->outpic);",
          "content_same": false
        },
        {
          "line": 112,
          "old_api": null,
          "new_api": "avfilter_end_frame",
          "old_text": null,
          "new_text": "avfilter_end_frame(out)",
          "old_line_content": "    }",
          "new_line_content": "        avfilter_end_frame(out);",
          "content_same": false
        },
        {
          "line": 178,
          "old_api": null,
          "new_api": "avfilter_draw_slice",
          "old_text": null,
          "new_text": "avfilter_draw_slice(link->dst->outputs[0], y, h, slice_dir)",
          "old_line_content": "}",
          "new_line_content": "    avfilter_draw_slice(link->dst->outputs[0], y, h, slice_dir);",
          "content_same": false
        },
        {
          "line": 147,
          "old_api": null,
          "new_api": "avfilter_formats_ref",
          "old_text": null,
          "new_text": "avfilter_formats_ref(formats, &ctx->inputs[i]->out_formats)",
          "old_line_content": "            count ++;",
          "new_line_content": "            avfilter_formats_ref(formats, &ctx->inputs[i]->out_formats);",
          "content_same": false
        },
        {
          "line": 188,
          "old_api": null,
          "new_api": "avfilter_get_video_buffer",
          "old_text": null,
          "new_text": "avfilter_get_video_buffer(link->dst->outputs[0], perms, w, h)",
          "old_line_content": "}",
          "new_line_content": "    return avfilter_get_video_buffer(link->dst->outputs[0], perms, w, h);",
          "content_same": false
        },
        {
          "line": 82,
          "old_api": null,
          "new_api": "avfilter_ref_pic",
          "old_text": null,
          "new_text": "avfilter_ref_pic(out->outpic, ~0)",
          "old_line_content": "    }",
          "new_line_content": "        avfilter_start_frame(out, avfilter_ref_pic(out->outpic, ~0));",
          "content_same": false
        },
        {
          "line": 183,
          "old_api": null,
          "new_api": "avfilter_end_frame",
          "old_text": null,
          "new_text": "avfilter_end_frame(link->dst->outputs[0])",
          "old_line_content": "}",
          "new_line_content": "    avfilter_end_frame(link->dst->outputs[0]);",
          "content_same": false
        },
        {
          "line": 153,
          "old_api": null,
          "new_api": "avfilter_formats_ref",
          "old_text": null,
          "new_text": "avfilter_formats_ref(formats, &ctx->outputs[i]->in_formats)",
          "old_line_content": "            count ++;",
          "new_line_content": "            avfilter_formats_ref(formats, &ctx->outputs[i]->in_formats);",
          "content_same": false
        },
        {
          "line": 60,
          "old_api": null,
          "new_api": "ff_fill_pointer",
          "old_text": null,
          "new_text": "ff_fill_pointer((AVPicture *)pic, buf, pic->format, ref->h)",
          "old_line_content": "",
          "new_line_content": "    ff_fill_pointer((AVPicture *)pic, buf, pic->format, ref->h);",
          "content_same": false
        },
        {
          "line": 94,
          "old_api": null,
          "new_api": "avfilter_draw_slice",
          "old_text": null,
          "new_text": "avfilter_draw_slice(out, y, h, slice_dir)",
          "old_line_content": "}",
          "new_line_content": "        avfilter_draw_slice(out, y, h, slice_dir);",
          "content_same": false
        },
        {
          "line": 63,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(ref->linesize, pic->linesize, sizeof(pic->linesize))",
          "old_line_content": "",
          "new_line_content": "    memcpy(ref->linesize, pic->linesize, sizeof(pic->linesize));",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 166,
          "old_api": "avfilter_all_colorspaces",
          "new_api": null,
          "old_text": "avfilter_all_colorspaces()",
          "new_text": null,
          "old_line_content": "    avfilter_set_common_formats(ctx, avfilter_all_colorspaces());",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 103,
          "old_api": "avfilter_unref_pic",
          "new_api": null,
          "old_text": "avfilter_unref_pic(link->cur_pic)",
          "new_text": null,
          "old_line_content": "    avfilter_unref_pic(link->cur_pic);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 75,
          "old_api": "avfilter_get_video_buffer",
          "new_api": null,
          "old_text": "avfilter_get_video_buffer(out, AV_PERM_WRITE, out->w, out->h)",
          "new_text": null,
          "old_line_content": "        out->outpic      = avfilter_get_video_buffer(out, AV_PERM_WRITE, out->w, out->h);",
          "new_line_content": "    if(out) {",
          "content_same": false
        },
        {
          "line": 172,
          "old_api": "avfilter_start_frame",
          "new_api": null,
          "old_text": "avfilter_start_frame(link->dst->outputs[0], picref)",
          "new_text": null,
          "old_line_content": "    avfilter_start_frame(link->dst->outputs[0], picref);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 187,
          "old_api": "avfilter_get_video_buffer",
          "new_api": null,
          "old_text": "avfilter_get_video_buffer(link->dst->outputs[0], perms, w, h)",
          "new_text": null,
          "old_line_content": "    return avfilter_get_video_buffer(link->dst->outputs[0], perms, w, h);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 108,
          "old_api": "avfilter_unref_pic",
          "new_api": null,
          "old_text": "avfilter_unref_pic(out->outpic)",
          "new_text": null,
          "old_line_content": "            avfilter_unref_pic(out->outpic);",
          "new_line_content": "        if(out->outpic) {",
          "content_same": false
        },
        {
          "line": 111,
          "old_api": "avfilter_end_frame",
          "new_api": null,
          "old_text": "avfilter_end_frame(out)",
          "new_text": null,
          "old_line_content": "        avfilter_end_frame(out);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 177,
          "old_api": "avfilter_draw_slice",
          "new_api": null,
          "old_text": "avfilter_draw_slice(link->dst->outputs[0], y, h, slice_dir)",
          "new_text": null,
          "old_line_content": "    avfilter_draw_slice(link->dst->outputs[0], y, h, slice_dir);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 146,
          "old_api": "avfilter_formats_ref",
          "new_api": null,
          "old_text": "avfilter_formats_ref(formats, &ctx->inputs[i]->out_formats)",
          "new_text": null,
          "old_line_content": "            avfilter_formats_ref(formats, &ctx->inputs[i]->out_formats);",
          "new_line_content": "        if(ctx->inputs[i]) {",
          "content_same": false
        },
        {
          "line": 81,
          "old_api": "avfilter_ref_pic",
          "new_api": null,
          "old_text": "avfilter_ref_pic(out->outpic, ~0)",
          "new_text": null,
          "old_line_content": "        avfilter_start_frame(out, avfilter_ref_pic(out->outpic, ~0));",
          "new_line_content": "        out->outpic->top_field_first = picref->top_field_first;",
          "content_same": false
        },
        {
          "line": 93,
          "old_api": "avfilter_draw_slice",
          "new_api": null,
          "old_text": "avfilter_draw_slice(out, y, h, slice_dir)",
          "new_text": null,
          "old_line_content": "        avfilter_draw_slice(out, y, h, slice_dir);",
          "new_line_content": "    if(out)",
          "content_same": false
        },
        {
          "line": 182,
          "old_api": "avfilter_end_frame",
          "new_api": null,
          "old_text": "avfilter_end_frame(link->dst->outputs[0])",
          "new_text": null,
          "old_line_content": "    avfilter_end_frame(link->dst->outputs[0]);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 152,
          "old_api": "avfilter_formats_ref",
          "new_api": null,
          "old_text": "avfilter_formats_ref(formats, &ctx->outputs[i]->in_formats)",
          "new_text": null,
          "old_line_content": "            avfilter_formats_ref(formats, &ctx->outputs[i]->in_formats);",
          "new_line_content": "        if(ctx->outputs[i]) {",
          "content_same": false
        },
        {
          "line": 59,
          "old_api": "ff_fill_pointer",
          "new_api": null,
          "old_text": "ff_fill_pointer((AVPicture *)pic, buf, pic->format, ref->h)",
          "new_text": null,
          "old_line_content": "    ff_fill_pointer((AVPicture *)pic, buf, pic->format, ref->h);",
          "new_line_content": "                                    // SIMD-friendly",
          "content_same": false
        },
        {
          "line": 61,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(ref->data,     pic->data,     sizeof(pic->data))",
          "new_text": null,
          "old_line_content": "    memcpy(ref->data,     pic->data,     sizeof(pic->data));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 158,
          "old_api": "av_free",
          "new_api": null,
          "old_text": "av_free(formats->formats)",
          "new_text": null,
          "old_line_content": "        av_free(formats->formats);",
          "new_line_content": "    if(!count) {",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 0,
      "total_additions": 16,
      "total_deletions": 16,
      "total_api_changes": 32
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 2,
        "api_related_lines": 32,
        "non_api_lines": 1,
        "non_api_line_numbers": [
          58
        ]
      }
    },
    "api_calls_before": 29,
    "api_calls_after": 29,
    "diff_info": {
      "added_lines": 2,
      "removed_lines": 1,
      "total_diff_lines": 15
    }
  }
}