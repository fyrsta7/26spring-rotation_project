{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/4fced11df73fb1921f60660b5b0f319bb4e723ec",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/4fced11df73fb1921f60660b5b0f319bb4e723ec/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/4fced11df73fb1921f60660b5b0f319bb4e723ec/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/4fced11df73fb1921f60660b5b0f319bb4e723ec/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 460,
          "old_api": "ut_bits_count",
          "new_api": "ut_bits",
          "old_text": "ut_bits_count(&pb) ",
          "new_text": "ut_bits(&pb, 32 - count, 0);",
          "old_line_content": "    count = put_bits_count(&pb) & 0x1F;",
          "new_line_content": "        put_bits(&pb, 32 - count, 0);",
          "content_same": false
        },
        {
          "line": 463,
          "old_api": "ut_bits",
          "new_api": "ut_bits_count",
          "old_text": "ut_bits(&pb, 32 - count, 0);",
          "new_text": "ut_bits_count(&pb);",
          "old_line_content": "        put_bits(&pb, 32 - count, 0);",
          "new_line_content": "    count = put_bits_count(&pb);",
          "content_same": false
        },
        {
          "line": 466,
          "old_api": "ut_bits_count",
          "new_api": "lush_put_bits",
          "old_text": "ut_bits_count(&pb);",
          "new_text": "lush_put_bits(&pb);",
          "old_line_content": "    count = put_bits_count(&pb);",
          "new_line_content": "    flush_put_bits(&pb);",
          "content_same": false
        },
        {
          "line": 590,
          "old_api": "ytestream2_put_le32",
          "new_api": "ytestream2_seek_p",
          "old_text": "ytestream2_put_le32(pb, offset);",
          "new_text": "ytestream2_seek_p(pb, 4 * (c->slices - i - 1) +\n                           offset - slice_len, SEEK_CUR);",
          "old_line_content": "        bytestream2_put_le32(pb, offset);",
          "new_line_content": "        bytestream2_seek_p(pb, 4 * (c->slices - i - 1) +",
          "content_same": false
        },
        {
          "line": 597,
          "old_api": "ytestream2_put_buffer",
          "new_api": "ytestream2_seek_p",
          "old_text": "ytestream2_put_buffer(pb, c->slice_bits, slice_len);",
          "new_text": "ytestream2_seek_p(pb, -4 * (c->slices - i - 1) - offset,\n                           SEEK_CUR);",
          "old_line_content": "        bytestream2_put_buffer(pb, c->slice_bits, slice_len);",
          "new_line_content": "        bytestream2_seek_p(pb, -4 * (c->slices - i - 1) - offset,",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 512,
          "old_api": null,
          "new_api": "v_log",
          "old_text": null,
          "new_text": "v_log(avctx, AV_LOG_ERROR, \"Unknown prediction mode: %d\\n\",\n               c->frame_pred);",
          "old_line_content": "        }",
          "new_line_content": "        av_log(avctx, AV_LOG_ERROR, \"Unknown prediction mode: %d\\n\",",
          "content_same": false
        },
        {
          "line": 385,
          "old_api": null,
          "new_api": "own_heap",
          "old_text": null,
          "new_text": "own_heap(nr_heap, heap, weights);",
          "old_line_content": "        node1   = heap[1];",
          "new_line_content": "        down_heap(nr_heap, heap, weights);",
          "content_same": false
        },
        {
          "line": 643,
          "old_api": null,
          "new_api": "angle_rgb_planes",
          "old_text": null,
          "new_text": "angle_rgb_planes(pic->data[0], c->planes, pic->linesize[0], width,\n                          height);",
          "old_line_content": "",
          "new_line_content": "        mangle_rgb_planes(pic->data[0], c->planes, pic->linesize[0], width,",
          "content_same": false
        },
        {
          "line": 518,
          "old_api": null,
          "new_api": "ount_usage",
          "old_text": null,
          "new_text": "ount_usage(dst, width, height, counts);",
          "old_line_content": "    }",
          "new_line_content": "    count_usage(dst, width, height, counts);",
          "content_same": false
        },
        {
          "line": 390,
          "old_api": null,
          "new_api": "own_heap",
          "old_text": null,
          "new_text": "own_heap(nr_heap, heap, weights);",
          "old_line_content": "        node2   = heap[1];",
          "new_line_content": "        down_heap(nr_heap, heap, weights);",
          "content_same": false
        },
        {
          "line": 651,
          "old_api": null,
          "new_api": "ncode_plane",
          "old_text": null,
          "new_text": "ncode_plane(avctx, pic->data[0] + ff_ut_rgb_order[i],\n                               c->slice_buffer, c->planes, pic->linesize[0],\n                               width, height, &pb);",
          "old_line_content": "    case PIX_FMT_RGB24:",
          "new_line_content": "            ret = encode_plane(avctx, pic->data[0] + ff_ut_rgb_order[i],",
          "content_same": false
        },
        {
          "line": 395,
          "old_api": null,
          "new_api": "dd_weights",
          "old_text": null,
          "new_text": "dd_weights(weights[node1], weights[node2]);",
          "old_line_content": "        nr_nodes++;",
          "new_line_content": "        weights[nr_nodes] = add_weights(weights[node1], weights[node2]);",
          "content_same": false
        },
        {
          "line": 271,
          "old_api": null,
          "new_api": "id_pred",
          "old_text": null,
          "new_text": "id_pred(A, B, (A + B - C) & 0xFF);",
          "old_line_content": "    A      = src[0];",
          "new_line_content": "        *dst++  = src[i] - mid_pred(A, B, (A + B - C) & 0xFF);",
          "content_same": false
        },
        {
          "line": 656,
          "old_api": null,
          "new_api": "v_log",
          "old_text": null,
          "new_text": "v_log(avctx, AV_LOG_ERROR, \"Error encoding plane %d.\\n\", i);",
          "old_line_content": "                               width, height, &pb);",
          "new_line_content": "                av_log(avctx, AV_LOG_ERROR, \"Error encoding plane %d.\\n\", i);",
          "content_same": false
        },
        {
          "line": 400,
          "old_api": null,
          "new_api": "p_heap",
          "old_text": null,
          "new_text": "p_heap(nr_heap, heap, weights);",
          "old_line_content": "",
          "new_line_content": "        up_heap(nr_heap, heap, weights);",
          "content_same": false
        },
        {
          "line": 532,
          "old_api": null,
          "new_api": "ytestream2_put_byte",
          "old_text": null,
          "new_text": "ytestream2_put_byte(pb, 0);",
          "old_line_content": "                 */",
          "new_line_content": "                        bytestream2_put_byte(pb, 0);",
          "content_same": false
        },
        {
          "line": 534,
          "old_api": null,
          "new_api": "ytestream2_put_byte",
          "old_text": null,
          "new_text": "ytestream2_put_byte(pb, 0xFF);",
          "old_line_content": "                    if (i == symbol)",
          "new_line_content": "                        bytestream2_put_byte(pb, 0xFF);",
          "content_same": false
        },
        {
          "line": 663,
          "old_api": null,
          "new_api": "ncode_plane",
          "old_text": null,
          "new_text": "ncode_plane(avctx, pic->data[i], c->slice_buffer, 1,\n                               pic->linesize[i], width >> !!i, height, &pb);",
          "old_line_content": "        break;",
          "new_line_content": "            ret = encode_plane(avctx, pic->data[i], c->slice_buffer, 1,",
          "content_same": false
        },
        {
          "line": 282,
          "old_api": null,
          "new_api": "id_pred",
          "old_text": null,
          "new_text": "id_pred(A, B, (A + B - C) & 0xFF);",
          "old_line_content": "    for (j = 2; j < height; j++) {",
          "new_line_content": "            *dst++  = src[i] - mid_pred(A, B, (A + B - C) & 0xFF);",
          "content_same": false
        },
        {
          "line": 539,
          "old_api": null,
          "new_api": "ytestream2_put_le32",
          "old_text": null,
          "new_text": "ytestream2_put_le32(pb, 0);",
          "old_line_content": "",
          "new_line_content": "                    bytestream2_put_le32(pb, 0);",
          "content_same": false
        },
        {
          "line": 667,
          "old_api": null,
          "new_api": "v_log",
          "old_text": null,
          "new_text": "v_log(avctx, AV_LOG_ERROR, \"Error encoding plane %d.\\n\", i);",
          "old_line_content": "                               pic->linesize[i], width >> !!i, height, &pb);",
          "new_line_content": "                av_log(avctx, AV_LOG_ERROR, \"Error encoding plane %d.\\n\", i);",
          "content_same": false
        },
        {
          "line": 674,
          "old_api": null,
          "new_api": "ncode_plane",
          "old_text": null,
          "new_text": "ncode_plane(avctx, pic->data[i], c->slice_buffer, 1,\n                               pic->linesize[i], width >> !!i, height >> !!i,\n                               &pb);",
          "old_line_content": "        break;",
          "new_line_content": "            ret = encode_plane(avctx, pic->data[i], c->slice_buffer, 1,",
          "content_same": false
        },
        {
          "line": 549,
          "old_api": null,
          "new_api": "alculate_code_lengths",
          "old_text": null,
          "new_text": "alculate_code_lengths(lengths, counts);",
          "old_line_content": "    }",
          "new_line_content": "    calculate_code_lengths(lengths, counts);",
          "content_same": false
        },
        {
          "line": 679,
          "old_api": null,
          "new_api": "v_log",
          "old_text": null,
          "new_text": "v_log(avctx, AV_LOG_ERROR, \"Error encoding plane %d.\\n\", i);",
          "old_line_content": "                               &pb);",
          "new_line_content": "                av_log(avctx, AV_LOG_ERROR, \"Error encoding plane %d.\\n\", i);",
          "content_same": false
        },
        {
          "line": 423,
          "old_api": null,
          "new_api": "sort",
          "old_text": null,
          "new_text": "sort(he, 256, sizeof(*he), ff_ut_huff_cmp_len);",
          "old_line_content": "    int last, i;",
          "new_line_content": "    qsort(he, 256, sizeof(*he), ff_ut_huff_cmp_len);",
          "content_same": false
        },
        {
          "line": 557,
          "old_api": null,
          "new_api": "ytestream2_put_byte",
          "old_text": null,
          "new_text": "ytestream2_put_byte(pb, lengths[i]);",
          "old_line_content": "     * - slice end offsets (gotten from the slice lengths)",
          "new_line_content": "        bytestream2_put_byte(pb, lengths[i]);",
          "content_same": false
        },
        {
          "line": 685,
          "old_api": null,
          "new_api": "v_log",
          "old_text": null,
          "new_text": "v_log(avctx, AV_LOG_ERROR, \"Unknown pixel format: %d\\n\",\n               avctx->pix_fmt);",
          "old_line_content": "        }",
          "new_line_content": "        av_log(avctx, AV_LOG_ERROR, \"Unknown pixel format: %d\\n\",",
          "content_same": false
        },
        {
          "line": 435,
          "old_api": null,
          "new_api": "sort",
          "old_text": null,
          "new_text": "sort(he, 256, sizeof(*he), huff_cmp_sym);",
          "old_line_content": "        code       += 0x80000000u >> (he[i].len - 1);",
          "new_line_content": "    qsort(he, 256, sizeof(*he), huff_cmp_sym);",
          "content_same": false
        },
        {
          "line": 564,
          "old_api": null,
          "new_api": "alculate_codes",
          "old_text": null,
          "new_text": "alculate_codes(he);",
          "old_line_content": "    }",
          "new_line_content": "    calculate_codes(he);",
          "content_same": false
        },
        {
          "line": 696,
          "old_api": null,
          "new_api": "ytestream2_put_le32",
          "old_text": null,
          "new_text": "ytestream2_put_le32(&pb, frame_info);",
          "old_line_content": "     * Contains the prediction method.",
          "new_line_content": "    bytestream2_put_le32(&pb, frame_info);",
          "content_same": false
        },
        {
          "line": 446,
          "old_api": null,
          "new_api": "nit_put_bits",
          "old_text": null,
          "new_text": "nit_put_bits(&pb, dst, dst_size);",
          "old_line_content": "    int i, j;",
          "new_line_content": "    init_put_bits(&pb, dst, dst_size);",
          "content_same": false
        },
        {
          "line": 575,
          "old_api": null,
          "new_api": "rite_huff_codes",
          "old_text": null,
          "new_text": "rite_huff_codes(dst + sstart * width, c->slice_bits,\n                                   width * (send - sstart), width,\n                                   send - sstart, he) ",
          "old_line_content": "         * Write the huffman codes to a buffer,",
          "new_line_content": "        offset += write_huff_codes(dst + sstart * width, c->slice_bits,",
          "content_same": false
        },
        {
          "line": 706,
          "old_api": null,
          "new_api": "ytestream2_tell_p",
          "old_text": null,
          "new_text": "ytestream2_tell_p(&pb);",
          "old_line_content": "    avctx->coded_frame->key_frame = 1;",
          "new_line_content": "    pkt->size   = bytestream2_tell_p(&pb);",
          "content_same": false
        },
        {
          "line": 451,
          "old_api": null,
          "new_api": "ut_bits",
          "old_text": null,
          "new_text": "ut_bits(&pb, he[src[i]].len, he[src[i]].code);",
          "old_line_content": "    /* Write the codes */",
          "new_line_content": "            put_bits(&pb, he[src[i]].len, he[src[i]].code);",
          "content_same": false
        },
        {
          "line": 582,
          "old_api": null,
          "new_api": "bswap_buf",
          "old_text": null,
          "new_text": "->dsp.bswap_buf((uint32_t *) c->slice_bits,\n                         (uint32_t *) c->slice_bits,\n                         slice_len >> 2);",
          "old_line_content": "        slice_len = offset - slice_len;",
          "new_line_content": "        c->dsp.bswap_buf((uint32_t *) c->slice_bits,",
          "content_same": false
        },
        {
          "line": 457,
          "old_api": null,
          "new_api": "ut_bits_count",
          "old_text": null,
          "new_text": "ut_bits_count(&pb) ",
          "old_line_content": "    }",
          "new_line_content": "    count = put_bits_count(&pb) & 0x1F;",
          "content_same": false
        },
        {
          "line": 587,
          "old_api": null,
          "new_api": "ytestream2_put_le32",
          "old_text": null,
          "new_text": "ytestream2_put_le32(pb, offset);",
          "old_line_content": "                         slice_len >> 2);",
          "new_line_content": "        bytestream2_put_le32(pb, offset);",
          "content_same": false
        },
        {
          "line": 594,
          "old_api": null,
          "new_api": "ytestream2_put_buffer",
          "old_text": null,
          "new_text": "ytestream2_put_buffer(pb, c->slice_bits, slice_len);",
          "old_line_content": "                           offset - slice_len, SEEK_CUR);",
          "new_line_content": "        bytestream2_put_buffer(pb, c->slice_bits, slice_len);",
          "content_same": false
        },
        {
          "line": 727,
          "old_api": null,
          "new_api": "ULL_IF_CONFIG_SMALL",
          "old_text": null,
          "new_text": "ULL_IF_CONFIG_SMALL(\"Ut Video\"),",
          "old_line_content": "                          PIX_FMT_RGB24, PIX_FMT_RGBA, PIX_FMT_YUV422P,",
          "new_line_content": "    .long_name      = NULL_IF_CONFIG_SMALL(\"Ut Video\"),",
          "content_same": false
        },
        {
          "line": 604,
          "old_api": null,
          "new_api": "ytestream2_seek_p",
          "old_text": null,
          "new_text": "ytestream2_seek_p(pb, offset, SEEK_CUR);",
          "old_line_content": "    }",
          "new_line_content": "    bytestream2_seek_p(pb, offset, SEEK_CUR);",
          "content_same": false
        },
        {
          "line": 377,
          "old_api": null,
          "new_api": "p_heap",
          "old_text": null,
          "new_text": "p_heap(nr_heap, heap, weights);",
          "old_line_content": "        parents[i] = -1;",
          "new_line_content": "        up_heap(nr_heap, heap, weights);",
          "content_same": false
        },
        {
          "line": 491,
          "old_api": null,
          "new_api": "rite_plane",
          "old_text": null,
          "new_text": "rite_plane(src + sstart * stride, dst + sstart * width,\n                        step, stride, width, send - sstart);",
          "old_line_content": "        for (i = 0; i < c->slices; i++) {",
          "new_line_content": "            write_plane(src + sstart * stride, dst + sstart * width,",
          "content_same": false
        },
        {
          "line": 623,
          "old_api": null,
          "new_api": "f_alloc_packet2",
          "old_text": null,
          "new_text": "f_alloc_packet2(avctx, pkt, (256 + 4 * c->slices + width * height) *\n                           c->planes + 4);",
          "old_line_content": "    int i, ret = 0;",
          "new_line_content": "    ret = ff_alloc_packet2(avctx, pkt, (256 + 4 * c->slices + width * height) *",
          "content_same": false
        },
        {
          "line": 499,
          "old_api": null,
          "new_api": "eft_predict",
          "old_text": null,
          "new_text": "eft_predict(src + sstart * stride, dst + sstart * width,\n                         step, stride, width, send - sstart);",
          "old_line_content": "        for (i = 0; i < c->slices; i++) {",
          "new_line_content": "            left_predict(src + sstart * stride, dst + sstart * width,",
          "content_same": false
        },
        {
          "line": 631,
          "old_api": null,
          "new_api": "ytestream2_init_writer",
          "old_text": null,
          "new_text": "ytestream2_init_writer(&pb, dst, pkt->size);",
          "old_line_content": "",
          "new_line_content": "    bytestream2_init_writer(&pb, dst, pkt->size);",
          "content_same": false
        },
        {
          "line": 633,
          "old_api": null,
          "new_api": "v_fast_malloc",
          "old_text": null,
          "new_text": "v_fast_malloc(&c->slice_bits, &c->slice_bits_size,\n                   width * height + FF_INPUT_BUFFER_PADDING_SIZE);",
          "old_line_content": "",
          "new_line_content": "    av_fast_malloc(&c->slice_bits, &c->slice_bits_size,",
          "content_same": false
        },
        {
          "line": 507,
          "old_api": null,
          "new_api": "edian_predict",
          "old_text": null,
          "new_text": "edian_predict(src + sstart * stride, dst + sstart * width,\n                           step, stride, width, send - sstart);",
          "old_line_content": "        for (i = 0; i < c->slices; i++) {",
          "new_line_content": "            median_predict(src + sstart * stride, dst + sstart * width,",
          "content_same": false
        },
        {
          "line": 637,
          "old_api": null,
          "new_api": "v_log",
          "old_text": null,
          "new_text": "v_log(avctx, AV_LOG_ERROR, \"Cannot allocate temporary buffer 2.\\n\");",
          "old_line_content": "                   width * height + FF_INPUT_BUFFER_PADDING_SIZE);",
          "new_line_content": "        av_log(avctx, AV_LOG_ERROR, \"Cannot allocate temporary buffer 2.\\n\");",
          "content_same": false
        },
        {
          "line": 638,
          "old_api": null,
          "new_api": "VERROR",
          "old_text": null,
          "new_text": "VERROR(ENOMEM);",
          "old_line_content": "",
          "new_line_content": "        return AVERROR(ENOMEM);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 640,
          "old_api": "v_log",
          "new_api": null,
          "old_text": "v_log(avctx, AV_LOG_ERROR, \"Cannot allocate temporary buffer 2.\\n\");",
          "new_text": null,
          "old_line_content": "        av_log(avctx, AV_LOG_ERROR, \"Cannot allocate temporary buffer 2.\\n\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 641,
          "old_api": "VERROR",
          "new_api": null,
          "old_text": "VERROR(ENOMEM);",
          "new_text": null,
          "old_line_content": "        return AVERROR(ENOMEM);",
          "new_line_content": "    /* In case of RGB, mangle the planes to Ut Video's format */",
          "content_same": false
        },
        {
          "line": 515,
          "old_api": "v_log",
          "new_api": null,
          "old_text": "v_log(avctx, AV_LOG_ERROR, \"Unknown prediction mode: %d\\n\",\n               c->frame_pred);",
          "new_text": null,
          "old_line_content": "        av_log(avctx, AV_LOG_ERROR, \"Unknown prediction mode: %d\\n\",",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 388,
          "old_api": "own_heap",
          "new_api": null,
          "old_text": "own_heap(nr_heap, heap, weights);",
          "new_text": null,
          "old_line_content": "        down_heap(nr_heap, heap, weights);",
          "new_line_content": "        heap[1] = heap[nr_heap--];",
          "content_same": false
        },
        {
          "line": 646,
          "old_api": "angle_rgb_planes",
          "new_api": null,
          "old_text": "angle_rgb_planes(pic->data[0], c->planes, pic->linesize[0], width,\n                          height);",
          "new_text": null,
          "old_line_content": "        mangle_rgb_planes(pic->data[0], c->planes, pic->linesize[0], width,",
          "new_line_content": "    /* Deal with the planes */",
          "content_same": false
        },
        {
          "line": 521,
          "old_api": "ount_usage",
          "new_api": null,
          "old_text": "ount_usage(dst, width, height, counts);",
          "new_text": null,
          "old_line_content": "    count_usage(dst, width, height, counts);",
          "new_line_content": "    for (symbol = 0; symbol < 256; symbol++) {",
          "content_same": false
        },
        {
          "line": 393,
          "old_api": "own_heap",
          "new_api": null,
          "old_text": "own_heap(nr_heap, heap, weights);",
          "new_text": null,
          "old_line_content": "        down_heap(nr_heap, heap, weights);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 654,
          "old_api": "ncode_plane",
          "new_api": null,
          "old_text": "ncode_plane(avctx, pic->data[0] + ff_ut_rgb_order[i],\n                               c->slice_buffer, c->planes, pic->linesize[0],\n                               width, height, &pb);",
          "new_text": null,
          "old_line_content": "            ret = encode_plane(avctx, pic->data[0] + ff_ut_rgb_order[i],",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 398,
          "old_api": "dd_weights",
          "new_api": null,
          "old_text": "dd_weights(weights[node1], weights[node2]);",
          "new_text": null,
          "old_line_content": "        weights[nr_nodes] = add_weights(weights[node1], weights[node2]);",
          "new_line_content": "        heap[++nr_heap] = nr_nodes;",
          "content_same": false
        },
        {
          "line": 274,
          "old_api": "id_pred",
          "new_api": null,
          "old_text": "id_pred(A, B, (A + B - C) & 0xFF);",
          "new_text": null,
          "old_line_content": "        *dst++  = src[i] - mid_pred(A, B, (A + B - C) & 0xFF);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 659,
          "old_api": "v_log",
          "new_api": null,
          "old_text": "v_log(avctx, AV_LOG_ERROR, \"Error encoding plane %d.\\n\", i);",
          "new_text": null,
          "old_line_content": "                av_log(avctx, AV_LOG_ERROR, \"Error encoding plane %d.\\n\", i);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 403,
          "old_api": "p_heap",
          "new_api": null,
          "old_text": "p_heap(nr_heap, heap, weights);",
          "new_text": null,
          "old_line_content": "        up_heap(nr_heap, heap, weights);",
          "new_line_content": "    /* Generate lengths */",
          "content_same": false
        },
        {
          "line": 535,
          "old_api": "ytestream2_put_byte",
          "new_api": null,
          "old_text": "ytestream2_put_byte(pb, 0);",
          "new_text": null,
          "old_line_content": "                        bytestream2_put_byte(pb, 0);",
          "new_line_content": "                }",
          "content_same": false
        },
        {
          "line": 537,
          "old_api": "ytestream2_put_byte",
          "new_api": null,
          "old_text": "ytestream2_put_byte(pb, 0xFF);",
          "new_text": null,
          "old_line_content": "                        bytestream2_put_byte(pb, 0xFF);",
          "new_line_content": "                /* Write zeroes for lengths */",
          "content_same": false
        },
        {
          "line": 666,
          "old_api": "ncode_plane",
          "new_api": null,
          "old_text": "ncode_plane(avctx, pic->data[i], c->slice_buffer, 1,\n                               pic->linesize[i], width >> !!i, height, &pb);",
          "new_text": null,
          "old_line_content": "            ret = encode_plane(avctx, pic->data[i], c->slice_buffer, 1,",
          "new_line_content": "            if (ret) {",
          "content_same": false
        },
        {
          "line": 285,
          "old_api": "id_pred",
          "new_api": null,
          "old_text": "id_pred(A, B, (A + B - C) & 0xFF);",
          "new_text": null,
          "old_line_content": "            *dst++  = src[i] - mid_pred(A, B, (A + B - C) & 0xFF);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 542,
          "old_api": "ytestream2_put_le32",
          "new_api": null,
          "old_text": "ytestream2_put_le32(pb, 0);",
          "new_text": null,
          "old_line_content": "                    bytestream2_put_le32(pb, 0);",
          "new_line_content": "                return 0;",
          "content_same": false
        },
        {
          "line": 670,
          "old_api": "v_log",
          "new_api": null,
          "old_text": "v_log(avctx, AV_LOG_ERROR, \"Error encoding plane %d.\\n\", i);",
          "new_text": null,
          "old_line_content": "                av_log(avctx, AV_LOG_ERROR, \"Error encoding plane %d.\\n\", i);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 677,
          "old_api": "ncode_plane",
          "new_api": null,
          "old_text": "ncode_plane(avctx, pic->data[i], c->slice_buffer, 1,\n                               pic->linesize[i], width >> !!i, height >> !!i,\n                               &pb);",
          "new_text": null,
          "old_line_content": "            ret = encode_plane(avctx, pic->data[i], c->slice_buffer, 1,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 552,
          "old_api": "alculate_code_lengths",
          "new_api": null,
          "old_text": "alculate_code_lengths(lengths, counts);",
          "new_text": null,
          "old_line_content": "    calculate_code_lengths(lengths, counts);",
          "new_line_content": "     * Write the plane's header into the output packet:",
          "content_same": false
        },
        {
          "line": 682,
          "old_api": "v_log",
          "new_api": null,
          "old_text": "v_log(avctx, AV_LOG_ERROR, \"Error encoding plane %d.\\n\", i);",
          "new_text": null,
          "old_line_content": "                av_log(avctx, AV_LOG_ERROR, \"Error encoding plane %d.\\n\", i);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 426,
          "old_api": "sort",
          "new_api": null,
          "old_text": "sort(he, 256, sizeof(*he), ff_ut_huff_cmp_len);",
          "new_text": null,
          "old_line_content": "    qsort(he, 256, sizeof(*he), ff_ut_huff_cmp_len);",
          "new_line_content": "    while (he[last].len == 255 && last)",
          "content_same": false
        },
        {
          "line": 560,
          "old_api": "ytestream2_put_byte",
          "new_api": null,
          "old_text": "ytestream2_put_byte(pb, lengths[i]);",
          "new_text": null,
          "old_line_content": "        bytestream2_put_byte(pb, lengths[i]);",
          "new_line_content": "        he[i].sym = i;",
          "content_same": false
        },
        {
          "line": 688,
          "old_api": "v_log",
          "new_api": null,
          "old_text": "v_log(avctx, AV_LOG_ERROR, \"Unknown pixel format: %d\\n\",\n               avctx->pix_fmt);",
          "new_text": null,
          "old_line_content": "        av_log(avctx, AV_LOG_ERROR, \"Unknown pixel format: %d\\n\",",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 438,
          "old_api": "sort",
          "new_api": null,
          "old_text": "sort(he, 256, sizeof(*he), huff_cmp_sym);",
          "new_text": null,
          "old_line_content": "    qsort(he, 256, sizeof(*he), huff_cmp_sym);",
          "new_line_content": "/* Write huffman bit codes to a memory block */",
          "content_same": false
        },
        {
          "line": 567,
          "old_api": "alculate_codes",
          "new_api": null,
          "old_text": "alculate_codes(he);",
          "new_text": null,
          "old_line_content": "    calculate_codes(he);",
          "new_line_content": "    for (i = 0; i < c->slices; i++) {",
          "content_same": false
        },
        {
          "line": 699,
          "old_api": "ytestream2_put_le32",
          "new_api": null,
          "old_text": "ytestream2_put_le32(&pb, frame_info);",
          "new_text": null,
          "old_line_content": "    bytestream2_put_le32(&pb, frame_info);",
          "new_line_content": "     * At least currently Ut Video is IDR only.",
          "content_same": false
        },
        {
          "line": 449,
          "old_api": "nit_put_bits",
          "new_api": null,
          "old_text": "nit_put_bits(&pb, dst, dst_size);",
          "new_text": null,
          "old_line_content": "    init_put_bits(&pb, dst, dst_size);",
          "new_line_content": "    for (j = 0; j < height; j++) {",
          "content_same": false
        },
        {
          "line": 578,
          "old_api": "rite_huff_codes",
          "new_api": null,
          "old_text": "rite_huff_codes(dst + sstart * width, c->slice_bits,\n                                   width * (send - sstart), width,\n                                   send - sstart, he) ",
          "new_text": null,
          "old_line_content": "        offset += write_huff_codes(dst + sstart * width, c->slice_bits,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 709,
          "old_api": "ytestream2_tell_p",
          "new_api": null,
          "old_text": "ytestream2_tell_p(&pb);",
          "new_text": null,
          "old_line_content": "    pkt->size   = bytestream2_tell_p(&pb);",
          "new_line_content": "    /* Packet should be done */",
          "content_same": false
        },
        {
          "line": 454,
          "old_api": "ut_bits",
          "new_api": null,
          "old_text": "ut_bits(&pb, he[src[i]].len, he[src[i]].code);",
          "new_text": null,
          "old_line_content": "            put_bits(&pb, he[src[i]].len, he[src[i]].code);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 585,
          "old_api": "bswap_buf",
          "new_api": null,
          "old_text": "->dsp.bswap_buf((uint32_t *) c->slice_bits,\n                         (uint32_t *) c->slice_bits,\n                         slice_len >> 2);",
          "new_text": null,
          "old_line_content": "        c->dsp.bswap_buf((uint32_t *) c->slice_bits,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 593,
          "old_api": "ytestream2_seek_p",
          "new_api": null,
          "old_text": "ytestream2_seek_p(pb, 4 * (c->slices - i - 1) +\n                           offset - slice_len, SEEK_CUR);",
          "new_text": null,
          "old_line_content": "        bytestream2_seek_p(pb, 4 * (c->slices - i - 1) +",
          "new_line_content": "        /* Write the slices' data into the output packet */",
          "content_same": false
        },
        {
          "line": 469,
          "old_api": "lush_put_bits",
          "new_api": null,
          "old_text": "lush_put_bits(&pb);",
          "new_text": null,
          "old_line_content": "    flush_put_bits(&pb);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 600,
          "old_api": "ytestream2_seek_p",
          "new_api": null,
          "old_text": "ytestream2_seek_p(pb, -4 * (c->slices - i - 1) - offset,\n                           SEEK_CUR);",
          "new_text": null,
          "old_line_content": "        bytestream2_seek_p(pb, -4 * (c->slices - i - 1) - offset,",
          "new_line_content": "        slice_len = offset;",
          "content_same": false
        },
        {
          "line": 730,
          "old_api": "ULL_IF_CONFIG_SMALL",
          "new_api": null,
          "old_text": "ULL_IF_CONFIG_SMALL(\"Ut Video\"),",
          "new_text": null,
          "old_line_content": "    .long_name      = NULL_IF_CONFIG_SMALL(\"Ut Video\"),",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 607,
          "old_api": "ytestream2_seek_p",
          "new_api": null,
          "old_text": "ytestream2_seek_p(pb, offset, SEEK_CUR);",
          "new_text": null,
          "old_line_content": "    bytestream2_seek_p(pb, offset, SEEK_CUR);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 494,
          "old_api": "rite_plane",
          "new_api": null,
          "old_text": "rite_plane(src + sstart * stride, dst + sstart * width,\n                        step, stride, width, send - sstart);",
          "new_text": null,
          "old_line_content": "            write_plane(src + sstart * stride, dst + sstart * width,",
          "new_line_content": "        break;",
          "content_same": false
        },
        {
          "line": 626,
          "old_api": "f_alloc_packet2",
          "new_api": null,
          "old_text": "f_alloc_packet2(avctx, pkt, (256 + 4 * c->slices + width * height) *\n                           c->planes + 4);",
          "new_text": null,
          "old_line_content": "    ret = ff_alloc_packet2(avctx, pkt, (256 + 4 * c->slices + width * height) *",
          "new_line_content": "    if (ret < 0)",
          "content_same": false
        },
        {
          "line": 502,
          "old_api": "eft_predict",
          "new_api": null,
          "old_text": "eft_predict(src + sstart * stride, dst + sstart * width,\n                         step, stride, width, send - sstart);",
          "new_text": null,
          "old_line_content": "            left_predict(src + sstart * stride, dst + sstart * width,",
          "new_line_content": "        break;",
          "content_same": false
        },
        {
          "line": 380,
          "old_api": "p_heap",
          "new_api": null,
          "old_text": "p_heap(nr_heap, heap, weights);",
          "new_text": null,
          "old_line_content": "        up_heap(nr_heap, heap, weights);",
          "new_line_content": "    /* Build the tree */",
          "content_same": false
        },
        {
          "line": 634,
          "old_api": "ytestream2_init_writer",
          "new_api": null,
          "old_text": "ytestream2_init_writer(&pb, dst, pkt->size);",
          "new_text": null,
          "old_line_content": "    bytestream2_init_writer(&pb, dst, pkt->size);",
          "new_line_content": "                   width * height + FF_INPUT_BUFFER_PADDING_SIZE);",
          "content_same": false
        },
        {
          "line": 636,
          "old_api": "v_fast_malloc",
          "new_api": null,
          "old_text": "v_fast_malloc(&c->slice_bits, &c->slice_bits_size,\n                   width * height + FF_INPUT_BUFFER_PADDING_SIZE);",
          "new_text": null,
          "old_line_content": "    av_fast_malloc(&c->slice_bits, &c->slice_bits_size,",
          "new_line_content": "    if (!c->slice_bits) {",
          "content_same": false
        },
        {
          "line": 510,
          "old_api": "edian_predict",
          "new_api": null,
          "old_text": "edian_predict(src + sstart * stride, dst + sstart * width,\n                           step, stride, width, send - sstart);",
          "new_text": null,
          "old_line_content": "            median_predict(src + sstart * stride, dst + sstart * width,",
          "new_line_content": "        break;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 5,
      "total_additions": 44,
      "total_deletions": 44,
      "total_api_changes": 93
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 7,
        "api_related_lines": 93,
        "non_api_lines": 7,
        "non_api_line_numbers": [
          199,
          203,
          204,
          205,
          206,
          207,
          208
        ]
      }
    },
    "api_calls_before": 80,
    "api_calls_after": 80,
    "diff_info": {
      "added_lines": 4,
      "removed_lines": 7,
      "total_diff_lines": 26
    }
  }
}