{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/e62b3dd210f19c337fc541758079fceeadabc208",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/e62b3dd210f19c337fc541758079fceeadabc208/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/e62b3dd210f19c337fc541758079fceeadabc208/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/e62b3dd210f19c337fc541758079fceeadabc208/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 1003,
          "old_api": "av_clip",
          "new_api": "assert",
          "old_text": "av_clip(mean, -256, 255)",
          "new_text": "assert(mean >-300 && mean<300)",
          "old_line_content": "                else      mean= av_clip(mean, -256, 255);",
          "new_line_content": "                    assert(mean >-300 && mean<300);",
          "content_same": false
        },
        {
          "line": 1070,
          "old_api": "assert",
          "new_api": "put_bits",
          "old_text": "assert(best_vector[i]>=0 && best_vector[i]<16)",
          "new_text": "put_bits(&s->reorder_pb[level], 4, best_vector[i])",
          "old_line_content": "            assert(best_vector[i]>=0 && best_vector[i]<16);",
          "new_line_content": "            put_bits(&s->reorder_pb[level], 4, best_vector[i]);",
          "content_same": false
        },
        {
          "line": 1166,
          "old_api": "ff_init_block_index",
          "new_api": "ff_update_block_index",
          "old_text": "ff_init_block_index(&s->m)",
          "new_text": "ff_update_block_index(&s->m)",
          "old_line_content": "                ff_init_block_index(&s->m);",
          "new_line_content": "                ff_update_block_index(&s->m);",
          "content_same": false
        },
        {
          "line": 1174,
          "old_api": "ff_fix_long_p_mvs",
          "new_api": "ff_fix_long_mvs",
          "old_text": "ff_fix_long_p_mvs(&s->m)",
          "new_text": "ff_fix_long_mvs(&s->m, NULL, 0, s->m.p_mv_table, s->m.f_code, CANDIDATE_MB_TYPE_INTER, 0)",
          "old_line_content": "        ff_fix_long_p_mvs(&s->m);",
          "new_line_content": "        ff_fix_long_mvs(&s->m, NULL, 0, s->m.p_mv_table, s->m.f_code, CANDIDATE_MB_TYPE_INTER, 0);",
          "content_same": false
        },
        {
          "line": 1200,
          "old_api": "put_bits_count",
          "new_api": "av_log",
          "old_text": "put_bits_count(&s->pb)",
          "new_text": "av_log(s->avctx, AV_LOG_ERROR, \"encoded frame too large\\n\")",
          "old_line_content": "            if(s->pb.buf_end - s->pb.buf - (put_bits_count(&s->pb)>>3) < 3000){ //FIXME check size",
          "new_line_content": "                av_log(s->avctx, AV_LOG_ERROR, \"encoded frame too large\\n\");",
          "content_same": false
        },
        {
          "line": 1206,
          "old_api": "ff_init_block_index",
          "new_api": "ff_update_block_index",
          "old_text": "ff_init_block_index(&s->m)",
          "new_text": "ff_update_block_index(&s->m)",
          "old_line_content": "            ff_init_block_index(&s->m);",
          "new_line_content": "            ff_update_block_index(&s->m);",
          "content_same": false
        },
        {
          "line": 1220,
          "old_api": "put_bits_count",
          "new_api": "flush_put_bits",
          "old_text": "put_bits_count(&s->reorder_pb[i])",
          "new_text": "flush_put_bits(&s->reorder_pb[i])",
          "old_line_content": "                    count[0][i]= put_bits_count(&s->reorder_pb[i]);",
          "new_line_content": "                    flush_put_bits(&s->reorder_pb[i]);",
          "content_same": false
        },
        {
          "line": 1246,
          "old_api": "assert",
          "new_api": "ff_h263_encode_motion",
          "old_text": "assert(pred_y>=-32 && pred_y<=31)",
          "new_text": "ff_h263_encode_motion(&s->m, mx - pred_x, 1)",
          "old_line_content": "                    assert(pred_y>=-32 && pred_y<=31);",
          "new_line_content": "                    ff_h263_encode_motion(&s->m, mx - pred_x, 1);",
          "content_same": false
        },
        {
          "line": 1274,
          "old_api": "put_bits_count",
          "new_api": "flush_put_bits",
          "old_text": "put_bits_count(&s->reorder_pb[i])",
          "new_text": "flush_put_bits(&s->reorder_pb[i])",
          "old_line_content": "                        count[1][i]= put_bits_count(&s->reorder_pb[i]);",
          "new_line_content": "                        flush_put_bits(&s->reorder_pb[i]);",
          "content_same": false
        },
        {
          "line": 1321,
          "old_api": "av_mallocz",
          "new_api": "h263_encode_init",
          "old_text": "av_mallocz((s->y_block_width+1)*s->y_block_height*sizeof(int32_t))",
          "new_text": "h263_encode_init(&s->m)",
          "old_line_content": "    s->dummy          = av_mallocz((s->y_block_width+1)*s->y_block_height*sizeof(int32_t));",
          "new_line_content": "    h263_encode_init(&s->m); //mv_penalty",
          "content_same": false
        },
        {
          "line": 1366,
          "old_api": "put_bits_count",
          "new_api": "put_bits",
          "old_text": "put_bits_count(&s->pb)",
          "new_text": "put_bits(&s->pb, 1, 0)",
          "old_line_content": "    while(put_bits_count(&s->pb) & 31)",
          "new_line_content": "        put_bits(&s->pb, 1, 0);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 1156,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(&src[i*stride], &src_plane[(i+16*y)*src_stride], width)",
          "old_line_content": "            for(i=0; i<16 && i + 16*y<height; i++){",
          "new_line_content": "                memcpy(&src[i*stride], &src_plane[(i+16*y)*src_stride], width);",
          "content_same": false
        },
        {
          "line": 1273,
          "old_api": null,
          "new_api": "put_bits_count",
          "old_text": null,
          "new_text": "put_bits_count(&s->reorder_pb[i])",
          "old_line_content": "                    for(i=0; i<6; i++){",
          "new_line_content": "                        count[1][i]= put_bits_count(&s->reorder_pb[i]);",
          "content_same": false
        },
        {
          "line": 1287,
          "old_api": null,
          "new_api": "ff_copy_bits",
          "old_text": null,
          "new_text": "ff_copy_bits(&s->pb, reorder_buffer[best][i], count[best][i])",
          "old_line_content": "            for(i=5; i>=0; i--){",
          "new_line_content": "                ff_copy_bits(&s->pb, reorder_buffer[best][i], count[best][i]);",
          "content_same": false
        },
        {
          "line": 1161,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(&src[i*stride], &src[(i-1)*stride], 16*block_width)",
          "old_line_content": "            for(; i<16 && i + 16*y<16*block_height; i++)",
          "new_line_content": "                memcpy(&src[i*stride], &src[(i-1)*stride], 16*block_width);",
          "content_same": false
        },
        {
          "line": 1290,
          "old_api": null,
          "new_api": "s->dsp.put_pixels_tab[0][0](decoded, temp, stride, 16)",
          "old_text": null,
          "new_text": "s->dsp.put_pixels_tab[0][0](decoded, temp, stride, 16)",
          "old_line_content": "            if(best==0){",
          "new_line_content": "                s->dsp.put_pixels_tab[0][0](decoded, temp, stride, 16);",
          "content_same": false
        },
        {
          "line": 1165,
          "old_api": null,
          "new_api": "ff_init_block_index",
          "old_text": null,
          "new_text": "ff_init_block_index(&s->m)",
          "old_line_content": "                s->m.mb_x= x;",
          "new_line_content": "                ff_init_block_index(&s->m);",
          "content_same": false
        },
        {
          "line": 1039,
          "old_api": null,
          "new_api": "encode_block",
          "old_text": null,
          "new_text": "encode_block(s, src         , ref         , decoded         , stride, level-1, threshold>>1, lambda, intra)",
          "old_line_content": "        }",
          "new_line_content": "        score += encode_block(s, src         , ref         , decoded         , stride, level-1, threshold>>1, lambda, intra);",
          "content_same": false
        },
        {
          "line": 1168,
          "old_api": null,
          "new_api": "ff_estimate_p_frame_motion",
          "old_text": null,
          "new_text": "ff_estimate_p_frame_motion(&s->m, x, y)",
          "old_line_content": "",
          "new_line_content": "                ff_estimate_p_frame_motion(&s->m, x, y);",
          "content_same": false
        },
        {
          "line": 1173,
          "old_api": null,
          "new_api": "ff_fix_long_p_mvs",
          "old_text": null,
          "new_text": "ff_fix_long_p_mvs(&s->m)",
          "old_line_content": "",
          "new_line_content": "        ff_fix_long_p_mvs(&s->m);",
          "content_same": false
        },
        {
          "line": 1302,
          "old_api": null,
          "new_api": "dsputil_init",
          "old_text": null,
          "new_text": "dsputil_init(&s->dsp, avctx)",
          "old_line_content": "",
          "new_line_content": "    dsputil_init(&s->dsp, avctx);",
          "content_same": false
        },
        {
          "line": 1053,
          "old_api": null,
          "new_api": "put_bits",
          "old_text": null,
          "new_text": "put_bits(&s->reorder_pb[level], 1, split)",
          "old_line_content": "    if (level > 0)",
          "new_line_content": "        put_bits(&s->reorder_pb[level], 1, split);",
          "content_same": false
        },
        {
          "line": 1182,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(&src[i*stride], &src_plane[(i+16*y)*src_stride], width)",
          "old_line_content": "        for(i=0; i<16 && i + 16*y<height; i++){",
          "new_line_content": "            memcpy(&src[i*stride], &src_plane[(i+16*y)*src_stride], width);",
          "content_same": false
        },
        {
          "line": 1056,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert((best_mean >= 0 && best_mean<256) || !intra)",
          "old_line_content": "    if(!split){",
          "new_line_content": "        assert((best_mean >= 0 && best_mean<256) || !intra);",
          "content_same": false
        },
        {
          "line": 1187,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(&src[i*stride], &src[(i-1)*stride], 16*block_width)",
          "old_line_content": "        for(; i<16 && i + 16*y<16*block_height; i++)",
          "new_line_content": "            memcpy(&src[i*stride], &src[(i-1)*stride], 16*block_width);",
          "content_same": false
        },
        {
          "line": 1316,
          "old_api": null,
          "new_api": "av_mallocz",
          "old_text": null,
          "new_text": "av_mallocz((avctx->width+64)*2*16*2*sizeof(uint8_t))",
          "old_line_content": "    s->m.avctx= avctx;",
          "new_line_content": "    s->m.me.scratchpad= av_mallocz((avctx->width+64)*2*16*2*sizeof(uint8_t));",
          "content_same": false
        },
        {
          "line": 1062,
          "old_api": null,
          "new_api": "put_bits",
          "old_text": null,
          "new_text": "put_bits(&s->reorder_pb[level],\n            multistage_vlc[1 + best_count][1],\n            multistage_vlc[1 + best_count][0])",
          "old_line_content": "        /* output the encoding */",
          "new_line_content": "        put_bits(&s->reorder_pb[level],",
          "content_same": false
        },
        {
          "line": 1065,
          "old_api": null,
          "new_api": "put_bits",
          "old_text": null,
          "new_text": "put_bits(&s->reorder_pb[level], mean_vlc[best_mean][1],\n            mean_vlc[best_mean][0])",
          "old_line_content": "            multistage_vlc[1 + best_count][0]);",
          "new_line_content": "        put_bits(&s->reorder_pb[level], mean_vlc[best_mean][1],",
          "content_same": false
        },
        {
          "line": 1069,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(best_vector[i]>=0 && best_vector[i]<16)",
          "old_line_content": "        for (i = 0; i < best_count; i++){",
          "new_line_content": "            assert(best_vector[i]>=0 && best_vector[i]<16);",
          "content_same": false
        },
        {
          "line": 1199,
          "old_api": null,
          "new_api": "put_bits_count",
          "old_text": null,
          "new_text": "put_bits_count(&s->pb)",
          "old_line_content": "",
          "new_line_content": "            if(s->pb.buf_end - s->pb.buf - (put_bits_count(&s->pb)>>3) < 3000){ //FIXME check size",
          "content_same": false
        },
        {
          "line": 1205,
          "old_api": null,
          "new_api": "ff_init_block_index",
          "old_text": null,
          "new_text": "ff_init_block_index(&s->m)",
          "old_line_content": "            s->m.mb_x= x;",
          "new_line_content": "            ff_init_block_index(&s->m);",
          "content_same": false
        },
        {
          "line": 1336,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(avctx, AV_LOG_ERROR, \"unsupported pixel format\\n\")",
          "old_line_content": "    if(avctx->pix_fmt != PIX_FMT_YUV410P){",
          "new_line_content": "        av_log(avctx, AV_LOG_ERROR, \"unsupported pixel format\\n\");",
          "content_same": false
        },
        {
          "line": 1210,
          "old_api": null,
          "new_api": "init_put_bits",
          "old_text": null,
          "new_text": "init_put_bits(&s->reorder_pb[i], reorder_buffer[0][i], 7*32)",
          "old_line_content": "                for(i=0; i<6; i++){",
          "new_line_content": "                    init_put_bits(&s->reorder_pb[i], reorder_buffer[0][i], 7*32);",
          "content_same": false
        },
        {
          "line": 1341,
          "old_api": null,
          "new_api": "get_buffer",
          "old_text": null,
          "new_text": "avctx->get_buffer(avctx, &s->current_picture)",
          "old_line_content": "    if(!s->current_picture.data[0]){",
          "new_line_content": "        avctx->get_buffer(avctx, &s->current_picture);",
          "content_same": false
        },
        {
          "line": 1214,
          "old_api": null,
          "new_api": "put_bits",
          "old_text": null,
          "new_text": "put_bits(&s->reorder_pb[5], vlc[1], vlc[0])",
          "old_line_content": "                    const uint8_t *vlc= svq1_block_type_vlc[SVQ1_BLOCK_INTRA];",
          "new_line_content": "                    put_bits(&s->reorder_pb[5], vlc[1], vlc[0]);",
          "content_same": false
        },
        {
          "line": 1217,
          "old_api": null,
          "new_api": "encode_block",
          "old_text": null,
          "new_text": "encode_block(s, src+16*x, NULL, temp, stride, 5, 64, lambda, 1)",
          "old_line_content": "                }",
          "new_line_content": "                score[0]+= encode_block(s, src+16*x, NULL, temp, stride, 5, 64, lambda, 1);",
          "content_same": false
        },
        {
          "line": 1219,
          "old_api": null,
          "new_api": "put_bits_count",
          "old_text": null,
          "new_text": "put_bits_count(&s->reorder_pb[i])",
          "old_line_content": "                for(i=0; i<6; i++){",
          "new_line_content": "                    count[0][i]= put_bits_count(&s->reorder_pb[i]);",
          "content_same": false
        },
        {
          "line": 1349,
          "old_api": null,
          "new_api": "init_put_bits",
          "old_text": null,
          "new_text": "init_put_bits(&s->pb, buf, buf_size)",
          "old_line_content": "",
          "new_line_content": "    init_put_bits(&s->pb, buf, buf_size);",
          "content_same": false
        },
        {
          "line": 1355,
          "old_api": null,
          "new_api": "svq1_write_header",
          "old_text": null,
          "new_text": "svq1_write_header(s, p->pict_type)",
          "old_line_content": "",
          "new_line_content": "    svq1_write_header(s, p->pict_type);",
          "content_same": false
        },
        {
          "line": 1357,
          "old_api": null,
          "new_api": "svq1_encode_plane",
          "old_text": null,
          "new_text": "svq1_encode_plane(s, i,\n            s->picture.data[i], s->last_picture.data[i], s->current_picture.data[i],\n            s->frame_width / (i?4:1), s->frame_height / (i?4:1),\n            s->picture.linesize[i], s->current_picture.linesize[i])",
          "old_line_content": "    for(i=0; i<3; i++){",
          "new_line_content": "        if(svq1_encode_plane(s, i,",
          "content_same": false
        },
        {
          "line": 1232,
          "old_api": null,
          "new_api": "h263_pred_motion",
          "old_text": null,
          "new_text": "h263_pred_motion(&s->m, 0, 0, &pred_x, &pred_y)",
          "old_line_content": "",
          "new_line_content": "                motion_ptr= h263_pred_motion(&s->m, 0, 0, &pred_x, &pred_y);",
          "content_same": false
        },
        {
          "line": 1235,
          "old_api": null,
          "new_api": "init_put_bits",
          "old_text": null,
          "new_text": "init_put_bits(&s->reorder_pb[i], reorder_buffer[1][i], 7*32)",
          "old_line_content": "                    for(i=0; i<6; i++)",
          "new_line_content": "                        init_put_bits(&s->reorder_pb[i], reorder_buffer[1][i], 7*32);",
          "content_same": false
        },
        {
          "line": 1237,
          "old_api": null,
          "new_api": "put_bits",
          "old_text": null,
          "new_text": "put_bits(&s->reorder_pb[5], vlc[1], vlc[0])",
          "old_line_content": "",
          "new_line_content": "                    put_bits(&s->reorder_pb[5], vlc[1], vlc[0]);",
          "content_same": false
        },
        {
          "line": 1365,
          "old_api": null,
          "new_api": "put_bits_count",
          "old_text": null,
          "new_text": "put_bits_count(&s->pb)",
          "old_line_content": "//    align_put_bits(&s->pb);",
          "new_line_content": "    while(put_bits_count(&s->pb) & 31)",
          "content_same": false
        },
        {
          "line": 1368,
          "old_api": null,
          "new_api": "flush_put_bits",
          "old_text": null,
          "new_text": "flush_put_bits(&s->pb)",
          "old_line_content": "",
          "new_line_content": "    flush_put_bits(&s->pb);",
          "content_same": false
        },
        {
          "line": 1242,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(mx>=-32 && mx<=31)",
          "old_line_content": "                    my= motion_ptr[1];",
          "new_line_content": "                    assert(mx>=-32 && mx<=31);",
          "content_same": false
        },
        {
          "line": 1370,
          "old_api": null,
          "new_api": "put_bits_count",
          "old_text": null,
          "new_text": "put_bits_count(&s->pb)",
          "old_line_content": "",
          "new_line_content": "    return (put_bits_count(&s->pb) / 8);",
          "content_same": false
        },
        {
          "line": 1249,
          "old_api": null,
          "new_api": "put_bits_count",
          "old_text": null,
          "new_text": "put_bits_count(&s->reorder_pb[5])",
          "old_line_content": "                    s->reorder_pb[5]= s->m.pb;",
          "new_line_content": "                    score[1] += lambda*put_bits_count(&s->reorder_pb[5]);",
          "content_same": false
        },
        {
          "line": 1378,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(avctx, AV_LOG_DEBUG, \"RD: %f\\n\", s->rd_total/(double)(avctx->width*avctx->height*avctx->frame_number))",
          "old_line_content": "",
          "new_line_content": "    av_log(avctx, AV_LOG_DEBUG, \"RD: %f\\n\", s->rd_total/(double)(avctx->width*avctx->height*avctx->frame_number));",
          "content_same": false
        },
        {
          "line": 1380,
          "old_api": null,
          "new_api": "av_freep",
          "old_text": null,
          "new_text": "av_freep(&s->m.me.scratchpad)",
          "old_line_content": "",
          "new_line_content": "    av_freep(&s->m.me.scratchpad);",
          "content_same": false
        },
        {
          "line": 1253,
          "old_api": null,
          "new_api": "s->dsp.put_pixels_tab[0][dxy](temp+16, ref + (mx>>1) + stride*(my>>1), stride, 16)",
          "old_text": null,
          "new_text": "s->dsp.put_pixels_tab[0][dxy](temp+16, ref + (mx>>1) + stride*(my>>1), stride, 16)",
          "old_line_content": "",
          "new_line_content": "                    s->dsp.put_pixels_tab[0][dxy](temp+16, ref + (mx>>1) + stride*(my>>1), stride, 16);",
          "content_same": false
        },
        {
          "line": 1255,
          "old_api": null,
          "new_api": "encode_block",
          "old_text": null,
          "new_text": "encode_block(s, src+16*x, temp+16, decoded, stride, 5, 64, lambda, 0)",
          "old_line_content": "",
          "new_line_content": "                    score[1]+= encode_block(s, src+16*x, temp+16, decoded, stride, 5, 64, lambda, 0);",
          "content_same": false
        },
        {
          "line": 1130,
          "old_api": null,
          "new_api": "av_mallocz",
          "old_text": null,
          "new_text": "av_mallocz((s->m.b8_stride*block_height*2 + 2)*2*sizeof(int16_t))",
          "old_line_content": "        if(!s->motion_val8[plane]){",
          "new_line_content": "            s->motion_val8 [plane]= av_mallocz((s->m.b8_stride*block_height*2 + 2)*2*sizeof(int16_t));",
          "content_same": false
        },
        {
          "line": 1259,
          "old_api": null,
          "new_api": "s->dsp.sse[0](NULL, src+16*x, ref, stride, 16)",
          "old_text": null,
          "new_text": "s->dsp.sse[0](NULL, src+16*x, ref, stride, 16)",
          "old_line_content": "                    vlc= svq1_block_type_vlc[SVQ1_BLOCK_SKIP];",
          "new_line_content": "                    score[2]= s->dsp.sse[0](NULL, src+16*x, ref, stride, 16);",
          "content_same": false
        },
        {
          "line": 1387,
          "old_api": null,
          "new_api": "av_freep",
          "old_text": null,
          "new_text": "av_freep(&s->motion_val8[i])",
          "old_line_content": "    for(i=0; i<3; i++){",
          "new_line_content": "        av_freep(&s->motion_val8[i]);",
          "content_same": false
        },
        {
          "line": 1004,
          "old_api": null,
          "new_api": "av_clip",
          "old_text": null,
          "new_text": "av_clip(mean, intra?0:-256, 255)",
          "old_line_content": "                score= sqr - ((diff*(int64_t)diff)>>(level+3)); //FIXME 64bit slooow",
          "new_line_content": "                    mean= av_clip(mean, intra?0:-256, 255);",
          "content_same": false
        },
        {
          "line": 1263,
          "old_api": null,
          "new_api": "s->dsp.put_pixels_tab[0][0](decoded, ref, stride, 16)",
          "old_text": null,
          "new_text": "s->dsp.put_pixels_tab[0][0](decoded, ref, stride, 16)",
          "old_line_content": "                        best=2;",
          "new_line_content": "                        s->dsp.put_pixels_tab[0][0](decoded, ref, stride, 16);",
          "content_same": false
        },
        {
          "line": 1267,
          "old_api": null,
          "new_api": "put_bits",
          "old_text": null,
          "new_text": "put_bits(&s->pb, vlc[1], vlc[0])",
          "old_line_content": "                        }",
          "new_line_content": "                        put_bits(&s->pb, vlc[1], vlc[0]);",
          "content_same": false
        },
        {
          "line": 1011,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(best_vector_mean != -999)",
          "old_line_content": "            }",
          "new_line_content": "            assert(best_vector_mean != -999);",
          "content_same": false
        },
        {
          "line": 1145,
          "old_api": null,
          "new_api": "ff_init_me",
          "old_text": null,
          "new_text": "ff_init_me(&s->m)",
          "old_line_content": "        s->m.dsp= s->dsp; //move",
          "new_line_content": "        ff_init_me(&s->m);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 1157,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(&src[i*stride], &src_plane[(i+16*y)*src_stride], width)",
          "new_text": null,
          "old_line_content": "                memcpy(&src[i*stride], &src_plane[(i+16*y)*src_stride], width);",
          "new_line_content": "                for(x=width; x<16*block_width; x++)",
          "content_same": false
        },
        {
          "line": 1288,
          "old_api": "ff_copy_bits",
          "new_api": null,
          "old_text": "ff_copy_bits(&s->pb, reorder_buffer[best][i], count[best][i])",
          "new_text": null,
          "old_line_content": "                ff_copy_bits(&s->pb, reorder_buffer[best][i], count[best][i]);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 1162,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(&src[i*stride], &src[(i-1)*stride], 16*block_width)",
          "new_text": null,
          "old_line_content": "                memcpy(&src[i*stride], &src[(i-1)*stride], 16*block_width);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1291,
          "old_api": "s->dsp.put_pixels_tab[0][0](decoded, temp, stride, 16)",
          "new_api": null,
          "old_text": "s->dsp.put_pixels_tab[0][0](decoded, temp, stride, 16)",
          "new_text": null,
          "old_line_content": "                s->dsp.put_pixels_tab[0][0](decoded, temp, stride, 16);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 1167,
          "old_api": "ff_update_block_index",
          "new_api": null,
          "old_text": "ff_update_block_index(&s->m)",
          "new_text": null,
          "old_line_content": "                ff_update_block_index(&s->m);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1041,
          "old_api": "encode_block",
          "new_api": null,
          "old_text": "encode_block(s, src + offset, ref + offset, decoded + offset, stride, level-1, threshold>>1, lambda, intra)",
          "new_text": null,
          "old_line_content": "        score += encode_block(s, src + offset, ref + offset, decoded + offset, stride, level-1, threshold>>1, lambda, intra);",
          "new_line_content": "        score += lambda;",
          "content_same": false
        },
        {
          "line": 1169,
          "old_api": "ff_estimate_p_frame_motion",
          "new_api": null,
          "old_text": "ff_estimate_p_frame_motion(&s->m, x, y)",
          "new_text": null,
          "old_line_content": "                ff_estimate_p_frame_motion(&s->m, x, y);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 1175,
          "old_api": "ff_fix_long_mvs",
          "new_api": null,
          "old_text": "ff_fix_long_mvs(&s->m, NULL, 0, s->m.p_mv_table, s->m.f_code, CANDIDATE_MB_TYPE_INTER, 0)",
          "new_text": null,
          "old_line_content": "        ff_fix_long_mvs(&s->m, NULL, 0, s->m.p_mv_table, s->m.f_code, CANDIDATE_MB_TYPE_INTER, 0);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1303,
          "old_api": "dsputil_init",
          "new_api": null,
          "old_text": "dsputil_init(&s->dsp, avctx)",
          "new_text": null,
          "old_line_content": "    dsputil_init(&s->dsp, avctx);",
          "new_line_content": "    avctx->coded_frame= (AVFrame*)&s->picture;",
          "content_same": false
        },
        {
          "line": 1054,
          "old_api": "put_bits",
          "new_api": null,
          "old_text": "put_bits(&s->reorder_pb[level], 1, split)",
          "new_text": null,
          "old_line_content": "        put_bits(&s->reorder_pb[level], 1, split);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1183,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(&src[i*stride], &src_plane[(i+16*y)*src_stride], width)",
          "new_text": null,
          "old_line_content": "            memcpy(&src[i*stride], &src_plane[(i+16*y)*src_stride], width);",
          "new_line_content": "            for(x=width; x<16*block_width; x++)",
          "content_same": false
        },
        {
          "line": 1060,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(level<4 || best_count==0)",
          "new_text": null,
          "old_line_content": "        assert(level<4 || best_count==0);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1188,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(&src[i*stride], &src[(i-1)*stride], 16*block_width)",
          "new_text": null,
          "old_line_content": "            memcpy(&src[i*stride], &src[(i-1)*stride], 16*block_width);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1063,
          "old_api": "put_bits",
          "new_api": null,
          "old_text": "put_bits(&s->reorder_pb[level],\n            multistage_vlc[1 + best_count][1],\n            multistage_vlc[1 + best_count][0])",
          "new_text": null,
          "old_line_content": "        put_bits(&s->reorder_pb[level],",
          "new_line_content": "            multistage_vlc[1 + best_count][1],",
          "content_same": false
        },
        {
          "line": 1066,
          "old_api": "put_bits",
          "new_api": null,
          "old_text": "put_bits(&s->reorder_pb[level], mean_vlc[best_mean][1],\n            mean_vlc[best_mean][0])",
          "new_text": null,
          "old_line_content": "        put_bits(&s->reorder_pb[level], mean_vlc[best_mean][1],",
          "new_line_content": "            mean_vlc[best_mean][0]);",
          "content_same": false
        },
        {
          "line": 1322,
          "old_api": "h263_encode_init",
          "new_api": null,
          "old_text": "h263_encode_init(&s->m)",
          "new_text": null,
          "old_line_content": "    h263_encode_init(&s->m); //mv_penalty",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1071,
          "old_api": "put_bits",
          "new_api": null,
          "old_text": "put_bits(&s->reorder_pb[level], 4, best_vector[i])",
          "new_text": null,
          "old_line_content": "            put_bits(&s->reorder_pb[level], 4, best_vector[i]);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 1201,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(s->avctx, AV_LOG_ERROR, \"encoded frame too large\\n\")",
          "new_text": null,
          "old_line_content": "                av_log(s->avctx, AV_LOG_ERROR, \"encoded frame too large\\n\");",
          "new_line_content": "                return -1;",
          "content_same": false
        },
        {
          "line": 1207,
          "old_api": "ff_update_block_index",
          "new_api": null,
          "old_text": "ff_update_block_index(&s->m)",
          "new_text": null,
          "old_line_content": "            ff_update_block_index(&s->m);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1337,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(avctx, AV_LOG_ERROR, \"unsupported pixel format\\n\")",
          "new_text": null,
          "old_line_content": "        av_log(avctx, AV_LOG_ERROR, \"unsupported pixel format\\n\");",
          "new_line_content": "        return -1;",
          "content_same": false
        },
        {
          "line": 1211,
          "old_api": "init_put_bits",
          "new_api": null,
          "old_text": "init_put_bits(&s->reorder_pb[i], reorder_buffer[0][i], 7*32)",
          "new_text": null,
          "old_line_content": "                    init_put_bits(&s->reorder_pb[i], reorder_buffer[0][i], 7*32);",
          "new_line_content": "                }",
          "content_same": false
        },
        {
          "line": 1215,
          "old_api": "put_bits",
          "new_api": null,
          "old_text": "put_bits(&s->reorder_pb[5], vlc[1], vlc[0])",
          "new_text": null,
          "old_line_content": "                    put_bits(&s->reorder_pb[5], vlc[1], vlc[0]);",
          "new_line_content": "                    score[0]= vlc[1]*lambda;",
          "content_same": false
        },
        {
          "line": 1343,
          "old_api": "get_buffer",
          "new_api": null,
          "old_text": "avctx->get_buffer(avctx, &s->last_picture)",
          "new_text": null,
          "old_line_content": "        avctx->get_buffer(avctx, &s->last_picture);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1218,
          "old_api": "encode_block",
          "new_api": null,
          "old_text": "encode_block(s, src+16*x, NULL, temp, stride, 5, 64, lambda, 1)",
          "new_text": null,
          "old_line_content": "                score[0]+= encode_block(s, src+16*x, NULL, temp, stride, 5, 64, lambda, 1);",
          "new_line_content": "                for(i=0; i<6; i++){",
          "content_same": false
        },
        {
          "line": 1221,
          "old_api": "flush_put_bits",
          "new_api": null,
          "old_text": "flush_put_bits(&s->reorder_pb[i])",
          "new_text": null,
          "old_line_content": "                    flush_put_bits(&s->reorder_pb[i]);",
          "new_line_content": "                }",
          "content_same": false
        },
        {
          "line": 1350,
          "old_api": "init_put_bits",
          "new_api": null,
          "old_text": "init_put_bits(&s->pb, buf, buf_size)",
          "new_text": null,
          "old_line_content": "    init_put_bits(&s->pb, buf, buf_size);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1356,
          "old_api": "svq1_write_header",
          "new_api": null,
          "old_text": "svq1_write_header(s, p->pict_type)",
          "new_text": null,
          "old_line_content": "    svq1_write_header(s, p->pict_type);",
          "new_line_content": "    for(i=0; i<3; i++){",
          "content_same": false
        },
        {
          "line": 1358,
          "old_api": "svq1_encode_plane",
          "new_api": null,
          "old_text": "svq1_encode_plane(s, i,\n            s->picture.data[i], s->last_picture.data[i], s->current_picture.data[i],\n            s->frame_width / (i?4:1), s->frame_height / (i?4:1),\n            s->picture.linesize[i], s->current_picture.linesize[i])",
          "new_text": null,
          "old_line_content": "        if(svq1_encode_plane(s, i,",
          "new_line_content": "            s->picture.data[i], s->last_picture.data[i], s->current_picture.data[i],",
          "content_same": false
        },
        {
          "line": 1233,
          "old_api": "h263_pred_motion",
          "new_api": null,
          "old_text": "h263_pred_motion(&s->m, 0, 0, &pred_x, &pred_y)",
          "new_text": null,
          "old_line_content": "                motion_ptr= h263_pred_motion(&s->m, 0, 0, &pred_x, &pred_y);",
          "new_line_content": "                if(s->m.mb_type[x + y*s->m.mb_stride]&CANDIDATE_MB_TYPE_INTER){",
          "content_same": false
        },
        {
          "line": 1236,
          "old_api": "init_put_bits",
          "new_api": null,
          "old_text": "init_put_bits(&s->reorder_pb[i], reorder_buffer[1][i], 7*32)",
          "new_text": null,
          "old_line_content": "                        init_put_bits(&s->reorder_pb[i], reorder_buffer[1][i], 7*32);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1238,
          "old_api": "put_bits",
          "new_api": null,
          "old_text": "put_bits(&s->reorder_pb[5], vlc[1], vlc[0])",
          "new_text": null,
          "old_line_content": "                    put_bits(&s->reorder_pb[5], vlc[1], vlc[0]);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1367,
          "old_api": "put_bits",
          "new_api": null,
          "old_text": "put_bits(&s->pb, 1, 0)",
          "new_text": null,
          "old_line_content": "        put_bits(&s->pb, 1, 0);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1369,
          "old_api": "flush_put_bits",
          "new_api": null,
          "old_text": "flush_put_bits(&s->pb)",
          "new_text": null,
          "old_line_content": "    flush_put_bits(&s->pb);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1371,
          "old_api": "put_bits_count",
          "new_api": null,
          "old_text": "put_bits_count(&s->pb)",
          "new_text": null,
          "old_line_content": "    return (put_bits_count(&s->pb) / 8);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 1248,
          "old_api": "ff_h263_encode_motion",
          "new_api": null,
          "old_text": "ff_h263_encode_motion(&s->m, my - pred_y, 1)",
          "new_text": null,
          "old_line_content": "                    ff_h263_encode_motion(&s->m, my - pred_y, 1);",
          "new_line_content": "                    s->reorder_pb[5]= s->m.pb;",
          "content_same": false
        },
        {
          "line": 1250,
          "old_api": "put_bits_count",
          "new_api": null,
          "old_text": "put_bits_count(&s->reorder_pb[5])",
          "new_text": null,
          "old_line_content": "                    score[1] += lambda*put_bits_count(&s->reorder_pb[5]);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1379,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(avctx, AV_LOG_DEBUG, \"RD: %f\\n\", s->rd_total/(double)(avctx->width*avctx->height*avctx->frame_number))",
          "new_text": null,
          "old_line_content": "    av_log(avctx, AV_LOG_DEBUG, \"RD: %f\\n\", s->rd_total/(double)(avctx->width*avctx->height*avctx->frame_number));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1254,
          "old_api": "s->dsp.put_pixels_tab[0][dxy](temp+16, ref + (mx>>1) + stride*(my>>1), stride, 16)",
          "new_api": null,
          "old_text": "s->dsp.put_pixels_tab[0][dxy](temp+16, ref + (mx>>1) + stride*(my>>1), stride, 16)",
          "new_text": null,
          "old_line_content": "                    s->dsp.put_pixels_tab[0][dxy](temp+16, ref + (mx>>1) + stride*(my>>1), stride, 16);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1256,
          "old_api": "encode_block",
          "new_api": null,
          "old_text": "encode_block(s, src+16*x, temp+16, decoded, stride, 5, 64, lambda, 0)",
          "new_text": null,
          "old_line_content": "                    score[1]+= encode_block(s, src+16*x, temp+16, decoded, stride, 5, 64, lambda, 0);",
          "new_line_content": "                    best= score[1] <= score[0];",
          "content_same": false
        },
        {
          "line": 1385,
          "old_api": "av_freep",
          "new_api": null,
          "old_text": "av_freep(&s->dummy)",
          "new_text": null,
          "old_line_content": "    av_freep(&s->dummy);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1001,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(mean >-300 && mean<300)",
          "new_text": null,
          "old_line_content": "                assert(mean >-300 && mean<300);",
          "new_line_content": "                if(score < best_vector_score){",
          "content_same": false
        },
        {
          "line": 1002,
          "old_api": "av_clip",
          "new_api": null,
          "old_text": "av_clip(mean, 0, 255)",
          "new_text": null,
          "old_line_content": "                if(intra) mean= av_clip(mean, 0, 255);",
          "new_line_content": "                    int mean= (diff + (size>>1)) >> (level+3);",
          "content_same": false
        },
        {
          "line": 1132,
          "old_api": "av_mallocz",
          "new_api": null,
          "old_text": "av_mallocz((s->m.mb_stride*(block_height + 2) + 1)*2*sizeof(int16_t))",
          "new_text": null,
          "old_line_content": "            s->motion_val16[plane]= av_mallocz((s->m.mb_stride*(block_height + 2) + 1)*2*sizeof(int16_t));",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 1260,
          "old_api": "s->dsp.sse[0](NULL, src+16*x, ref, stride, 16)",
          "new_api": null,
          "old_text": "s->dsp.sse[0](NULL, src+16*x, ref, stride, 16)",
          "new_text": null,
          "old_line_content": "                    score[2]= s->dsp.sse[0](NULL, src+16*x, ref, stride, 16);",
          "new_line_content": "                    score[2]+= vlc[1]*lambda;",
          "content_same": false
        },
        {
          "line": 1389,
          "old_api": "av_freep",
          "new_api": null,
          "old_text": "av_freep(&s->motion_val16[i])",
          "new_text": null,
          "old_line_content": "        av_freep(&s->motion_val16[i]);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1264,
          "old_api": "s->dsp.put_pixels_tab[0][0](decoded, ref, stride, 16)",
          "new_api": null,
          "old_text": "s->dsp.put_pixels_tab[0][0](decoded, ref, stride, 16)",
          "new_text": null,
          "old_line_content": "                        s->dsp.put_pixels_tab[0][0](decoded, ref, stride, 16);",
          "new_line_content": "                        for(i=0; i<6; i++){",
          "content_same": false
        },
        {
          "line": 1268,
          "old_api": "put_bits",
          "new_api": null,
          "old_text": "put_bits(&s->pb, vlc[1], vlc[0])",
          "new_text": null,
          "old_line_content": "                        put_bits(&s->pb, vlc[1], vlc[0]);",
          "new_line_content": "                    }",
          "content_same": false
        },
        {
          "line": 1012,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(best_vector_mean != -999)",
          "new_text": null,
          "old_line_content": "            assert(best_vector_mean != -999);",
          "new_line_content": "            vector= codebook + stage*size*16 + best_vector[stage]*size;",
          "content_same": false
        },
        {
          "line": 1146,
          "old_api": "ff_init_me",
          "new_api": null,
          "old_text": "ff_init_me(&s->m)",
          "new_text": null,
          "old_line_content": "        ff_init_me(&s->m);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1275,
          "old_api": "flush_put_bits",
          "new_api": null,
          "old_text": "flush_put_bits(&s->reorder_pb[i])",
          "new_text": null,
          "old_line_content": "                        flush_put_bits(&s->reorder_pb[i]);",
          "new_line_content": "                    }",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 11,
      "total_additions": 49,
      "total_deletions": 50,
      "total_api_changes": 110
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 6,
        "api_related_lines": 110,
        "non_api_lines": 2,
        "non_api_line_numbers": [
          1000,
          995
        ]
      }
    },
    "api_calls_before": 174,
    "api_calls_after": 173,
    "diff_info": {
      "added_lines": 4,
      "removed_lines": 5,
      "total_diff_lines": 27
    }
  }
}