{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/32e8763103f52ae7240910cd54e588300541cde7",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/32e8763103f52ae7240910cd54e588300541cde7/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/32e8763103f52ae7240910cd54e588300541cde7/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/32e8763103f52ae7240910cd54e588300541cde7/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 1679,
          "old_api": "init_get_bits",
          "new_api": "AV_DEBUG",
          "old_text": "init_get_bits(gb, buf, buf_size*8)",
          "new_text": "AV_DEBUG(\"packet length %d \\n\", buf_size)",
          "old_line_content": "    init_get_bits(gb, buf, buf_size*8);",
          "new_line_content": "    AV_DEBUG(\"packet length %d \\n\", buf_size);",
          "content_same": false
        },
        {
          "line": 1681,
          "old_api": "vorbis_parse_audio_packet",
          "new_api": "init_get_bits",
          "old_text": "vorbis_parse_audio_packet(vc)",
          "new_text": "init_get_bits(gb, buf, buf_size*8)",
          "old_line_content": "    len=vorbis_parse_audio_packet(vc);",
          "new_line_content": "    init_get_bits(gb, buf, buf_size*8);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 1412,
          "old_api": null,
          "new_api": "get_vlc2",
          "old_text": null,
          "new_text": "get_vlc2(gb, codebook.vlc.table, codebook.nb_bits, 3)",
          "old_line_content": "                                        vec[voffs     ]+=codebook.codevectors[coffs+l  ];  // FPMATH",
          "new_line_content": "                                    coffs=get_vlc2(gb, codebook.vlc.table, codebook.nb_bits, 3) * codebook.dimensions;",
          "content_same": false
        },
        {
          "line": 1400,
          "old_api": null,
          "new_api": "get_vlc2",
          "old_text": null,
          "new_text": "get_vlc2(gb, codebook.vlc.table, codebook.nb_bits, 3)",
          "old_line_content": "                                        vec[voffs]+=codebook.codevectors[coffs+l];  // FPMATH",
          "new_line_content": "                                    coffs=get_vlc2(gb, codebook.vlc.table, codebook.nb_bits, 3) * codebook.dimensions;",
          "content_same": false
        },
        {
          "line": 1417,
          "old_api": null,
          "new_api": "AV_DEBUG",
          "old_text": null,
          "new_text": "AV_DEBUG(\" pass %d offs: %d curr: %f change: %f cv offs.: %d+%d  \\n\", pass, voffset/ch+(voffs%ch)*vlen, vec[voffset/ch+(voffs%ch)*vlen], codebook.codevectors[coffs+l], coffs, l)",
          "old_line_content": "                                }",
          "new_line_content": "                                        AV_DEBUG(\" pass %d offs: %d curr: %f change: %f cv offs.: %d+%d  \\n\", pass, voffset/ch+(voffs%ch)*vlen, vec[voffset/ch+(voffs%ch)*vlen], codebook.codevectors[coffs+l], coffs, l);",
          "content_same": false
        },
        {
          "line": 1426,
          "old_api": null,
          "new_api": "get_vlc2",
          "old_text": null,
          "new_text": "get_vlc2(gb, codebook.vlc.table, codebook.nb_bits, 3)",
          "old_line_content": "                                        vec[voffs/ch+(voffs%ch)*vlen]+=codebook.codevectors[coffs+l];  // FPMATH FIXME use if and counter instead of / and %",
          "new_line_content": "                                    coffs=get_vlc2(gb, codebook.vlc.table, codebook.nb_bits, 3) * codebook.dimensions;",
          "content_same": false
        },
        {
          "line": 1683,
          "old_api": null,
          "new_api": "vorbis_parse_audio_packet",
          "old_text": null,
          "new_text": "vorbis_parse_audio_packet(vc)",
          "old_line_content": "    if (len<=0) {",
          "new_line_content": "    len=vorbis_parse_audio_packet(vc);",
          "content_same": false
        },
        {
          "line": 1430,
          "old_api": null,
          "new_api": "AV_DEBUG",
          "old_text": null,
          "new_text": "AV_DEBUG(\" pass %d offs: %d curr: %f change: %f cv offs.: %d+%d  \\n\", pass, voffset/ch+(voffs%ch)*vlen, vec[voffset/ch+(voffs%ch)*vlen], codebook.codevectors[coffs+l], coffs, l)",
          "old_line_content": "                                }",
          "new_line_content": "                                        AV_DEBUG(\" pass %d offs: %d curr: %f change: %f cv offs.: %d+%d  \\n\", pass, voffset/ch+(voffs%ch)*vlen, vec[voffset/ch+(voffs%ch)*vlen], codebook.codevectors[coffs+l], coffs, l);",
          "content_same": false
        },
        {
          "line": 1560,
          "old_api": null,
          "new_api": "vorbis_residue_decode",
          "old_text": null,
          "new_text": "vorbis_residue_decode(vc, residue, ch, do_not_decode, ch_res_ptr, blocksize/2)",
          "old_line_content": "        ch_res_ptr+=ch*blocksize/2;",
          "new_line_content": "        vorbis_residue_decode(vc, residue, ch, do_not_decode, ch_res_ptr, blocksize/2);",
          "content_same": false
        },
        {
          "line": 1434,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(vc->avccontext, AV_LOG_ERROR, \" Invalid residue type while residue decode?! \\n\")",
          "old_line_content": "                            }",
          "new_line_content": "                                av_log(vc->avccontext, AV_LOG_ERROR, \" Invalid residue type while residue decode?! \\n\");",
          "content_same": false
        },
        {
          "line": 1696,
          "old_api": null,
          "new_api": "get_bits_count",
          "old_text": null,
          "new_text": "get_bits_count(gb)",
          "old_line_content": "    for(i=0;i<len;++i) {",
          "new_line_content": "    AV_DEBUG(\"parsed %d bytes %d bits, returned %d samples (*ch*bits) \\n\", get_bits_count(gb)/8, get_bits_count(gb)%8, len);",
          "content_same": false
        },
        {
          "line": 1572,
          "old_api": null,
          "new_api": "vorbis_inverse_coupling",
          "old_text": null,
          "new_text": "vc->dsp.vorbis_inverse_coupling(mag, ang, blocksize/2)",
          "old_line_content": "",
          "new_line_content": "        vc->dsp.vorbis_inverse_coupling(mag, ang, blocksize/2);",
          "content_same": false
        },
        {
          "line": 1718,
          "old_api": null,
          "new_api": "vorbis_free",
          "old_text": null,
          "new_text": "vorbis_free(vc)",
          "old_line_content": "    return 0 ;",
          "new_line_content": "    vorbis_free(vc);",
          "content_same": false
        },
        {
          "line": 1601,
          "old_api": null,
          "new_api": "ff_imdct_calc",
          "old_text": null,
          "new_text": "ff_imdct_calc(vc->modes[mode_number].blockflag ? &vc->mdct1 : &vc->mdct0, buf, ch_floor_ptr, buf_tmp)",
          "old_line_content": "        if (vc->modes[mode_number].blockflag) {",
          "new_line_content": "        ff_imdct_calc(vc->modes[mode_number].blockflag ? &vc->mdct1 : &vc->mdct0, buf, ch_floor_ptr, buf_tmp);",
          "content_same": false
        },
        {
          "line": 1494,
          "old_api": null,
          "new_api": "get_bits1",
          "old_text": null,
          "new_text": "get_bits1(gb)",
          "old_line_content": "        return -1; // packet type not audio",
          "new_line_content": "    if (get_bits1(gb)) {",
          "content_same": false
        },
        {
          "line": 1495,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(vc->avccontext, AV_LOG_ERROR, \"Not a Vorbis I audio packet.\\n\")",
          "old_line_content": "    }",
          "new_line_content": "        av_log(vc->avccontext, AV_LOG_ERROR, \"Not a Vorbis I audio packet.\\n\");",
          "content_same": false
        },
        {
          "line": 1502,
          "old_api": null,
          "new_api": "ilog",
          "old_text": null,
          "new_text": "ilog(vc->mode_count-1)",
          "old_line_content": "    vc->mode_number=mode_number;",
          "new_line_content": "        mode_number=get_bits(gb, ilog(vc->mode_count-1));",
          "content_same": false
        },
        {
          "line": 1507,
          "old_api": null,
          "new_api": "AV_DEBUG",
          "old_text": null,
          "new_text": "AV_DEBUG(\" Mode number: %d , mapping: %d , blocktype %d \\n\", mode_number, vc->modes[mode_number].mapping, vc->modes[mode_number].blockflag)",
          "old_line_content": "    if (vc->modes[mode_number].blockflag) {",
          "new_line_content": "    AV_DEBUG(\" Mode number: %d , mapping: %d , blocktype %d \\n\", mode_number, vc->modes[mode_number].mapping, vc->modes[mode_number].blockflag);",
          "content_same": false
        },
        {
          "line": 1510,
          "old_api": null,
          "new_api": "get_bits1",
          "old_text": null,
          "new_text": "get_bits1(gb)",
          "old_line_content": "    }",
          "new_line_content": "        previous_window=get_bits1(gb);",
          "content_same": false
        },
        {
          "line": 1511,
          "old_api": null,
          "new_api": "get_bits1",
          "old_text": null,
          "new_text": "get_bits1(gb)",
          "old_line_content": "",
          "new_line_content": "        next_window=get_bits1(gb);",
          "content_same": false
        },
        {
          "line": 1384,
          "old_api": null,
          "new_api": "FASTDIV",
          "old_text": null,
          "new_text": "FASTDIV(vr->partition_size, dim)",
          "old_line_content": "",
          "new_line_content": "                                              : FASTDIV(vr->partition_size, dim);",
          "content_same": false
        },
        {
          "line": 1515,
          "old_api": null,
          "new_api": "memset",
          "old_text": null,
          "new_text": "memset(ch_res_ptr, 0, sizeof(float)*vc->audio_channels*blocksize/2)",
          "old_line_content": "",
          "new_line_content": "    memset(ch_res_ptr, 0, sizeof(float)*vc->audio_channels*blocksize/2); //FIXME can this be removed ?",
          "content_same": false
        },
        {
          "line": 1516,
          "old_api": null,
          "new_api": "memset",
          "old_text": null,
          "new_text": "memset(ch_floor_ptr, 0, sizeof(float)*vc->audio_channels*blocksize/2)",
          "old_line_content": "// Decode floor",
          "new_line_content": "    memset(ch_floor_ptr, 0, sizeof(float)*vc->audio_channels*blocksize/2); //FIXME can this be removed ?",
          "content_same": false
        },
        {
          "line": 1391,
          "old_api": null,
          "new_api": "get_vlc2",
          "old_text": null,
          "new_text": "get_vlc2(gb, codebook.vlc.table, codebook.nb_bits, 3)",
          "old_line_content": "                                        vec[voffs+k+l*step]+=codebook.codevectors[coffs+l];  // FPMATH",
          "new_line_content": "                                    coffs=get_vlc2(gb, codebook.vlc.table, codebook.nb_bits, 3) * codebook.dimensions;",
          "content_same": false
        },
        {
          "line": 1528,
          "old_api": null,
          "new_api": "decode",
          "old_text": null,
          "new_text": "floor->decode(vc, &floor->data, ch_floor_ptr)",
          "old_line_content": "    }",
          "new_line_content": "        no_residue[i]=floor->decode(vc, &floor->data, ch_floor_ptr);",
          "content_same": false
        },
        {
          "line": 1404,
          "old_api": null,
          "new_api": "AV_DEBUG",
          "old_text": null,
          "new_text": "AV_DEBUG(\" pass %d offs: %d curr: %f change: %f cv offs.: %d  \\n\", pass, voffs, vec[voffs], codebook.codevectors[coffs+l], coffs)",
          "old_line_content": "                                }",
          "new_line_content": "                                        AV_DEBUG(\" pass %d offs: %d curr: %f change: %f cv offs.: %d  \\n\", pass, voffs, vec[voffs], codebook.codevectors[coffs+l], coffs);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 1410,
          "old_api": "get_vlc2",
          "new_api": null,
          "old_text": "get_vlc2(gb, codebook.vlc.table, codebook.nb_bits, 3)",
          "new_text": null,
          "old_line_content": "                                    coffs=get_vlc2(gb, codebook.vlc.table, codebook.nb_bits, 3) * codebook.dimensions;",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1415,
          "old_api": "AV_DEBUG",
          "new_api": null,
          "old_text": "AV_DEBUG(\" pass %d offs: %d curr: %f change: %f cv offs.: %d+%d  \\n\", pass, voffset/ch+(voffs%ch)*vlen, vec[voffset/ch+(voffs%ch)*vlen], codebook.codevectors[coffs+l], coffs, l)",
          "new_text": null,
          "old_line_content": "                                        AV_DEBUG(\" pass %d offs: %d curr: %f change: %f cv offs.: %d+%d  \\n\", pass, voffset/ch+(voffs%ch)*vlen, vec[voffset/ch+(voffs%ch)*vlen], codebook.codevectors[coffs+l], coffs, l);",
          "new_line_content": "                                        vec[voffs+vlen]+=codebook.codevectors[coffs+l+1];  // FPMATH",
          "content_same": false
        },
        {
          "line": 1677,
          "old_api": "AV_DEBUG",
          "new_api": null,
          "old_text": "AV_DEBUG(\"packet length %d \\n\", buf_size)",
          "new_text": null,
          "old_line_content": "    AV_DEBUG(\"packet length %d \\n\", buf_size);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1424,
          "old_api": "get_vlc2",
          "new_api": null,
          "old_text": "get_vlc2(gb, codebook.vlc.table, codebook.nb_bits, 3)",
          "new_text": null,
          "old_line_content": "                                    coffs=get_vlc2(gb, codebook.vlc.table, codebook.nb_bits, 3) * codebook.dimensions;",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1428,
          "old_api": "AV_DEBUG",
          "new_api": null,
          "old_text": "AV_DEBUG(\" pass %d offs: %d curr: %f change: %f cv offs.: %d+%d  \\n\", pass, voffset/ch+(voffs%ch)*vlen, vec[voffset/ch+(voffs%ch)*vlen], codebook.codevectors[coffs+l], coffs, l)",
          "new_text": null,
          "old_line_content": "                                        AV_DEBUG(\" pass %d offs: %d curr: %f change: %f cv offs.: %d+%d  \\n\", pass, voffset/ch+(voffs%ch)*vlen, vec[voffset/ch+(voffs%ch)*vlen], codebook.codevectors[coffs+l], coffs, l);",
          "new_line_content": "                                        vec[voffs/ch+(voffs%ch)*vlen]+=codebook.codevectors[coffs+l];  // FPMATH FIXME use if and counter instead of / and %",
          "content_same": false
        },
        {
          "line": 1558,
          "old_api": "vorbis_residue_decode",
          "new_api": null,
          "old_text": "vorbis_residue_decode(vc, residue, ch, do_not_decode, ch_res_ptr, blocksize/2)",
          "new_text": null,
          "old_line_content": "        vorbis_residue_decode(vc, residue, ch, do_not_decode, ch_res_ptr, blocksize/2);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 1432,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(vc->avccontext, AV_LOG_ERROR, \" Invalid residue type while residue decode?! \\n\")",
          "new_text": null,
          "old_line_content": "                                av_log(vc->avccontext, AV_LOG_ERROR, \" Invalid residue type while residue decode?! \\n\");",
          "new_line_content": "                                }",
          "content_same": false
        },
        {
          "line": 1694,
          "old_api": "get_bits_count",
          "new_api": null,
          "old_text": "get_bits_count(gb)",
          "new_text": null,
          "old_line_content": "    AV_DEBUG(\"parsed %d bytes %d bits, returned %d samples (*ch*bits) \\n\", get_bits_count(gb)/8, get_bits_count(gb)%8, len);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1570,
          "old_api": "vorbis_inverse_coupling",
          "new_api": null,
          "old_text": "vc->dsp.vorbis_inverse_coupling(mag, ang, blocksize/2)",
          "new_text": null,
          "old_line_content": "        vc->dsp.vorbis_inverse_coupling(mag, ang, blocksize/2);",
          "new_line_content": "        mag=vc->channel_residues+res_chan[mapping->magnitude[i]]*blocksize/2;",
          "content_same": false
        },
        {
          "line": 1716,
          "old_api": "vorbis_free",
          "new_api": null,
          "old_text": "vorbis_free(vc)",
          "new_text": null,
          "old_line_content": "    vorbis_free(vc);",
          "new_line_content": "    vorbis_context *vc = avccontext->priv_data;",
          "content_same": false
        },
        {
          "line": 1599,
          "old_api": "ff_imdct_calc",
          "new_api": null,
          "old_text": "ff_imdct_calc(vc->modes[mode_number].blockflag ? &vc->mdct1 : &vc->mdct0, buf, ch_floor_ptr, buf_tmp)",
          "new_text": null,
          "old_line_content": "        ff_imdct_calc(vc->modes[mode_number].blockflag ? &vc->mdct1 : &vc->mdct0, buf, ch_floor_ptr, buf_tmp);",
          "new_line_content": "        saved_start=vc->saved_start;",
          "content_same": false
        },
        {
          "line": 1492,
          "old_api": "get_bits1",
          "new_api": null,
          "old_text": "get_bits1(gb)",
          "new_text": null,
          "old_line_content": "    if (get_bits1(gb)) {",
          "new_line_content": "    uint_fast16_t saved_start=0;",
          "content_same": false
        },
        {
          "line": 1493,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(vc->avccontext, AV_LOG_ERROR, \"Not a Vorbis I audio packet.\\n\")",
          "new_text": null,
          "old_line_content": "        av_log(vc->avccontext, AV_LOG_ERROR, \"Not a Vorbis I audio packet.\\n\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1500,
          "old_api": "ilog",
          "new_api": null,
          "old_text": "ilog(vc->mode_count-1)",
          "new_text": null,
          "old_line_content": "        mode_number=get_bits(gb, ilog(vc->mode_count-1));",
          "new_line_content": "        mode_number=0;",
          "content_same": false
        },
        {
          "line": 1505,
          "old_api": "AV_DEBUG",
          "new_api": null,
          "old_text": "AV_DEBUG(\" Mode number: %d , mapping: %d , blocktype %d \\n\", mode_number, vc->modes[mode_number].mapping, vc->modes[mode_number].blockflag)",
          "new_text": null,
          "old_line_content": "    AV_DEBUG(\" Mode number: %d , mapping: %d , blocktype %d \\n\", mode_number, vc->modes[mode_number].mapping, vc->modes[mode_number].blockflag);",
          "new_line_content": "    mapping=&vc->mappings[vc->modes[mode_number].mapping];",
          "content_same": false
        },
        {
          "line": 1508,
          "old_api": "get_bits1",
          "new_api": null,
          "old_text": "get_bits1(gb)",
          "new_text": null,
          "old_line_content": "        previous_window=get_bits1(gb);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1509,
          "old_api": "get_bits1",
          "new_api": null,
          "old_text": "get_bits1(gb)",
          "new_text": null,
          "old_line_content": "        next_window=get_bits1(gb);",
          "new_line_content": "    if (vc->modes[mode_number].blockflag) {",
          "content_same": false
        },
        {
          "line": 1513,
          "old_api": "memset",
          "new_api": null,
          "old_text": "memset(ch_res_ptr, 0, sizeof(float)*vc->audio_channels*blocksize/2)",
          "new_text": null,
          "old_line_content": "    memset(ch_res_ptr, 0, sizeof(float)*vc->audio_channels*blocksize/2); //FIXME can this be removed ?",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1514,
          "old_api": "memset",
          "new_api": null,
          "old_text": "memset(ch_floor_ptr, 0, sizeof(float)*vc->audio_channels*blocksize/2)",
          "new_text": null,
          "old_line_content": "    memset(ch_floor_ptr, 0, sizeof(float)*vc->audio_channels*blocksize/2); //FIXME can this be removed ?",
          "new_line_content": "    blocksize=vc->modes[mode_number].blockflag ? vc->blocksize_1 : vc->blocksize_0;",
          "content_same": false
        },
        {
          "line": 1389,
          "old_api": "get_vlc2",
          "new_api": null,
          "old_text": "get_vlc2(gb, codebook.vlc.table, codebook.nb_bits, 3)",
          "new_text": null,
          "old_line_content": "                                    coffs=get_vlc2(gb, codebook.vlc.table, codebook.nb_bits, 3) * codebook.dimensions;",
          "new_line_content": "                                voffs=voffset+j*vlen;",
          "content_same": false
        },
        {
          "line": 1398,
          "old_api": "get_vlc2",
          "new_api": null,
          "old_text": "get_vlc2(gb, codebook.vlc.table, codebook.nb_bits, 3)",
          "new_text": null,
          "old_line_content": "                                    coffs=get_vlc2(gb, codebook.vlc.table, codebook.nb_bits, 3) * codebook.dimensions;",
          "new_line_content": "                                voffs=voffset+j*vlen;",
          "content_same": false
        },
        {
          "line": 1526,
          "old_api": "decode",
          "new_api": null,
          "old_text": "floor->decode(vc, &floor->data, ch_floor_ptr)",
          "new_text": null,
          "old_line_content": "        no_residue[i]=floor->decode(vc, &floor->data, ch_floor_ptr);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 1402,
          "old_api": "AV_DEBUG",
          "new_api": null,
          "old_text": "AV_DEBUG(\" pass %d offs: %d curr: %f change: %f cv offs.: %d  \\n\", pass, voffs, vec[voffs], codebook.codevectors[coffs+l], coffs)",
          "new_text": null,
          "old_line_content": "                                        AV_DEBUG(\" pass %d offs: %d curr: %f change: %f cv offs.: %d  \\n\", pass, voffs, vec[voffs], codebook.codevectors[coffs+l], coffs);",
          "new_line_content": "                                        vec[voffs]+=codebook.codevectors[coffs+l];  // FPMATH",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 2,
      "total_additions": 24,
      "total_deletions": 23,
      "total_api_changes": 49
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 3,
        "api_related_lines": 49,
        "non_api_lines": 2,
        "non_api_line_numbers": [
          1382,
          1383
        ]
      }
    },
    "api_calls_before": 333,
    "api_calls_after": 334,
    "diff_info": {
      "added_lines": 3,
      "removed_lines": 1,
      "total_diff_lines": 16
    }
  }
}