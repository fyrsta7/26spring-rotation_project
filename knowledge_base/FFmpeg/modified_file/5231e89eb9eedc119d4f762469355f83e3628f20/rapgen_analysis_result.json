{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/5231e89eb9eedc119d4f762469355f83e3628f20",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/5231e89eb9eedc119d4f762469355f83e3628f20/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/5231e89eb9eedc119d4f762469355f83e3628f20/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/5231e89eb9eedc119d4f762469355f83e3628f20/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 134,
          "old_api": "avpriv_request_sample",
          "new_api": "bytestream2_get_bytes_left",
          "old_text": "avpriv_request_sample(avctx, \"Unsupported bit depth\")",
          "new_text": "bytestream2_get_bytes_left(&s->g)",
          "old_line_content": "        avpriv_request_sample(avctx, \"Unsupported bit depth\");",
          "new_line_content": "    if (bytestream2_get_bytes_left(&s->g) < 11)",
          "content_same": false
        },
        {
          "line": 140,
          "old_api": "bytestream2_get_le16",
          "new_api": "bytestream2_get_le16u",
          "old_text": "bytestream2_get_le16(&s->g)",
          "new_text": "bytestream2_get_le16u(&s->g)",
          "old_line_content": "        etype = bytestream2_get_le16(&s->g);",
          "new_line_content": "    s->width       = bytestream2_get_le16u(&s->g);",
          "content_same": false
        },
        {
          "line": 141,
          "old_api": "bytestream2_get_le16",
          "new_api": "bytestream2_get_le16u",
          "old_text": "bytestream2_get_le16(&s->g)",
          "new_text": "bytestream2_get_le16u(&s->g)",
          "old_line_content": "        esize = bytestream2_get_le16(&s->g);",
          "new_line_content": "    s->height      = bytestream2_get_le16u(&s->g);",
          "content_same": false
        },
        {
          "line": 142,
          "old_api": "bytestream2_get_bytes_left",
          "new_api": "bytestream2_skip",
          "old_text": "bytestream2_get_bytes_left(&s->g)",
          "new_text": "bytestream2_skip(&s->g, 4)",
          "old_line_content": "        if (bytestream2_get_bytes_left(&s->g) < esize)",
          "new_line_content": "    bytestream2_skip(&s->g, 4);",
          "content_same": false
        },
        {
          "line": 154,
          "old_api": "ff_set_dimensions",
          "new_api": "bytestream2_get_le16",
          "old_text": "ff_set_dimensions(avctx, s->width, s->height)",
          "new_text": "bytestream2_get_le16(&s->g)",
          "old_line_content": "        ret = ff_set_dimensions(avctx, s->width, s->height);",
          "new_line_content": "        etype = bytestream2_get_le16(&s->g);",
          "content_same": false
        },
        {
          "line": 165,
          "old_api": "bytestream2_tell",
          "new_api": "av_image_check_size",
          "old_text": "bytestream2_tell(&s->g)",
          "new_text": "av_image_check_size(s->width, s->height, 0, avctx)",
          "old_line_content": "    pos_after_pal = bytestream2_tell(&s->g) + esize;",
          "new_line_content": "    if (av_image_check_size(s->width, s->height, 0, avctx) < 0)",
          "content_same": false
        },
        {
          "line": 168,
          "old_api": "bytestream2_get_byte",
          "new_api": "ff_set_dimensions",
          "old_text": "bytestream2_get_byte(&s->g)",
          "new_text": "ff_set_dimensions(avctx, s->width, s->height)",
          "old_line_content": "        int idx = bytestream2_get_byte(&s->g);",
          "new_line_content": "        ret = ff_set_dimensions(avctx, s->width, s->height);",
          "content_same": false
        },
        {
          "line": 173,
          "old_api": "FFMIN",
          "new_api": "ff_get_buffer",
          "old_text": "FFMIN(esize, 16)",
          "new_text": "ff_get_buffer(avctx, frame, 0)",
          "old_line_content": "        npal = FFMIN(esize, 16);",
          "new_line_content": "    if ((ret = ff_get_buffer(avctx, frame, 0)) < 0)",
          "content_same": false
        },
        {
          "line": 175,
          "old_api": "bytestream2_get_byte",
          "new_api": "memset",
          "old_text": "bytestream2_get_byte(&s->g)",
          "new_text": "memset(frame->data[0], 0, s->height * frame->linesize[0])",
          "old_line_content": "            int pal_idx = bytestream2_get_byte(&s->g);",
          "new_line_content": "    memset(frame->data[0], 0, s->height * frame->linesize[0]);",
          "content_same": false
        },
        {
          "line": 179,
          "old_api": "FFMIN",
          "new_api": "bytestream2_tell",
          "old_text": "FFMIN(esize, 16)",
          "new_text": "bytestream2_tell(&s->g)",
          "old_line_content": "        npal = FFMIN(esize, 16);",
          "new_line_content": "    pos_after_pal = bytestream2_tell(&s->g) + esize;",
          "content_same": false
        },
        {
          "line": 181,
          "old_api": "bytestream2_get_byte",
          "new_api": "bytestream2_peek_byte",
          "old_text": "bytestream2_get_byte(&s->g)",
          "new_text": "bytestream2_peek_byte(&s->g)",
          "old_line_content": "            int pal_idx = bytestream2_get_byte(&s->g);",
          "new_line_content": "    if (etype == 1 && esize > 1 && bytestream2_peek_byte(&s->g) < 6) {",
          "content_same": false
        },
        {
          "line": 182,
          "old_api": "FFMIN",
          "new_api": "bytestream2_get_byte",
          "old_text": "FFMIN(pal_idx, 63)",
          "new_text": "bytestream2_get_byte(&s->g)",
          "old_line_content": "            palette[i]  = ff_ega_palette[FFMIN(pal_idx, 63)];",
          "new_line_content": "        int idx = bytestream2_get_byte(&s->g);",
          "content_same": false
        },
        {
          "line": 187,
          "old_api": "bytestream2_get_be24",
          "new_api": "FFMIN",
          "old_text": "bytestream2_get_be24(&s->g)",
          "new_text": "FFMIN(esize, 16)",
          "old_line_content": "            palette[i] = bytestream2_get_be24(&s->g) << 2;",
          "new_line_content": "        npal = FFMIN(esize, 16);",
          "content_same": false
        },
        {
          "line": 201,
          "old_api": "memcpy",
          "new_api": "bytestream2_get_be24",
          "old_text": "memcpy(palette, ff_cga_palette, npal * 4)",
          "new_text": "bytestream2_get_be24(&s->g)",
          "old_line_content": "            memcpy(palette, ff_cga_palette, npal * 4);",
          "new_line_content": "            palette[i] = bytestream2_get_be24(&s->g) << 2;",
          "content_same": false
        },
        {
          "line": 219,
          "old_api": "FFMIN",
          "new_api": "memset",
          "old_text": "FFMIN(t1, t2)",
          "new_text": "memset(palette + npal, 0, AVPALETTE_SIZE - npal * 4)",
          "old_line_content": "            stop_size = t1 - FFMIN(t1, t2);",
          "new_line_content": "    memset(palette + npal, 0, AVPALETTE_SIZE - npal * 4);",
          "content_same": false
        },
        {
          "line": 221,
          "old_api": "bytestream2_skip",
          "new_api": "bytestream2_seek",
          "old_text": "bytestream2_skip(&s->g, 2)",
          "new_text": "bytestream2_seek(&s->g, pos_after_pal, SEEK_SET)",
          "old_line_content": "            bytestream2_skip(&s->g, 2);",
          "new_line_content": "    bytestream2_seek(&s->g, pos_after_pal, SEEK_SET);",
          "content_same": false
        },
        {
          "line": 225,
          "old_api": "bytestream2_get_bytes_left",
          "new_api": "bytestream2_get_le16",
          "old_text": "bytestream2_get_bytes_left(&s->g)",
          "new_text": "bytestream2_get_le16(&s->g)",
          "old_line_content": "                   bytestream2_get_bytes_left(&s->g) > stop_size) {",
          "new_line_content": "    if (bytestream2_get_le16(&s->g)) {",
          "content_same": false
        },
        {
          "line": 231,
          "old_api": "bytestream2_get_le16",
          "new_api": "bytestream2_get_bytes_left",
          "old_text": "bytestream2_get_le16(&s->g)",
          "new_text": "bytestream2_get_bytes_left(&s->g)",
          "old_line_content": "                        run = bytestream2_get_le16(&s->g);",
          "new_line_content": "            t1        = bytestream2_get_bytes_left(&s->g);",
          "content_same": false
        },
        {
          "line": 232,
          "old_api": "bytestream2_get_byte",
          "new_api": "bytestream2_get_le16",
          "old_text": "bytestream2_get_byte(&s->g)",
          "new_text": "bytestream2_get_le16(&s->g)",
          "old_line_content": "                    val = bytestream2_get_byte(&s->g);",
          "new_line_content": "            t2        = bytestream2_get_le16(&s->g);",
          "content_same": false
        },
        {
          "line": 272,
          "old_api": "NULL_IF_CONFIG_SMALL",
          "new_api": "bytestream2_get_bytes_left",
          "old_text": "NULL_IF_CONFIG_SMALL(\"Pictor/PC Paint\")",
          "new_text": "bytestream2_get_bytes_left(&s->g)",
          "old_line_content": "    .long_name      = NULL_IF_CONFIG_SMALL(\"Pictor/PC Paint\"),",
          "new_line_content": "        while (y >= 0 && bytestream2_get_bytes_left(&s->g) > 0) {",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 256,
          "old_api": null,
          "new_api": "picmemset",
          "old_text": null,
          "new_text": "picmemset(s, frame, val, run, &x, &y, &plane, bits_per_plane)",
          "old_line_content": "        }",
          "new_line_content": "                    picmemset(s, frame, val, run, &x, &y, &plane, bits_per_plane);",
          "content_same": false
        },
        {
          "line": 132,
          "old_api": null,
          "new_api": "bytestream2_init",
          "old_text": null,
          "new_text": "bytestream2_init(&s->g, avpkt->data, avpkt->size)",
          "old_line_content": "    bpp            = bits_per_plane * s->nb_planes;",
          "new_line_content": "    bytestream2_init(&s->g, avpkt->data, avpkt->size);",
          "content_same": false
        },
        {
          "line": 137,
          "old_api": null,
          "new_api": "bytestream2_get_le16u",
          "old_text": null,
          "new_text": "bytestream2_get_le16u(&s->g)",
          "old_line_content": "",
          "new_line_content": "    if (bytestream2_get_le16u(&s->g) != 0x1234)",
          "content_same": false
        },
        {
          "line": 267,
          "old_api": null,
          "new_api": "picmemset_8bpp",
          "old_text": null,
          "new_text": "picmemset_8bpp(s, frame, val, run, &x, &y)",
          "old_line_content": "    return avpkt->size;",
          "new_line_content": "                picmemset_8bpp(s, frame, val, run, &x, &y);",
          "content_same": false
        },
        {
          "line": 269,
          "old_api": null,
          "new_api": "picmemset",
          "old_text": null,
          "new_text": "picmemset(s, frame, val, run / (8 / bits_per_plane), &x, &y, &plane, bits_per_plane)",
          "old_line_content": "",
          "new_line_content": "                picmemset(s, frame, val, run / (8 / bits_per_plane), &x, &y, &plane, bits_per_plane);",
          "content_same": false
        },
        {
          "line": 143,
          "old_api": null,
          "new_api": "bytestream2_get_byteu",
          "old_text": null,
          "new_text": "bytestream2_get_byteu(&s->g)",
          "old_line_content": "            return AVERROR_INVALIDDATA;",
          "new_line_content": "    tmp            = bytestream2_get_byteu(&s->g);",
          "content_same": false
        },
        {
          "line": 273,
          "old_api": null,
          "new_api": "bytestream2_get_bytes_left",
          "old_text": null,
          "new_text": "bytestream2_get_bytes_left(&s->g)",
          "old_line_content": "    .type           = AVMEDIA_TYPE_VIDEO,",
          "new_line_content": "            memcpy(frame->data[0] + y * frame->linesize[0], s->g.buffer, FFMIN(avctx->width, bytestream2_get_bytes_left(&s->g)));",
          "content_same": false
        },
        {
          "line": 274,
          "old_api": null,
          "new_api": "bytestream2_skip",
          "old_text": null,
          "new_text": "bytestream2_skip(&s->g, avctx->width)",
          "old_line_content": "    .id             = AV_CODEC_ID_PICTOR,",
          "new_line_content": "            bytestream2_skip(&s->g, avctx->width);",
          "content_same": false
        },
        {
          "line": 148,
          "old_api": null,
          "new_api": "avpriv_request_sample",
          "old_text": null,
          "new_text": "avpriv_request_sample(avctx, \"Unsupported bit depth\")",
          "old_line_content": "",
          "new_line_content": "        avpriv_request_sample(avctx, \"Unsupported bit depth\");",
          "content_same": false
        },
        {
          "line": 152,
          "old_api": null,
          "new_api": "bytestream2_peek_byte",
          "old_text": null,
          "new_text": "bytestream2_peek_byte(&s->g)",
          "old_line_content": "        return -1;",
          "new_line_content": "    if (bytestream2_peek_byte(&s->g) == 0xFF || bpp == 1 || bpp == 4 || bpp == 8) {",
          "content_same": false
        },
        {
          "line": 153,
          "old_api": null,
          "new_api": "bytestream2_skip",
          "old_text": null,
          "new_text": "bytestream2_skip(&s->g, 2)",
          "old_line_content": "    if (s->width != avctx->width || s->height != avctx->height) {",
          "new_line_content": "        bytestream2_skip(&s->g, 2);",
          "content_same": false
        },
        {
          "line": 155,
          "old_api": null,
          "new_api": "bytestream2_get_le16",
          "old_text": null,
          "new_text": "bytestream2_get_le16(&s->g)",
          "old_line_content": "        if (ret < 0)",
          "new_line_content": "        esize = bytestream2_get_le16(&s->g);",
          "content_same": false
        },
        {
          "line": 156,
          "old_api": null,
          "new_api": "bytestream2_get_bytes_left",
          "old_text": null,
          "new_text": "bytestream2_get_bytes_left(&s->g)",
          "old_line_content": "            return ret;",
          "new_line_content": "        if (bytestream2_get_bytes_left(&s->g) < esize)",
          "content_same": false
        },
        {
          "line": 286,
          "old_api": null,
          "new_api": "NULL_IF_CONFIG_SMALL",
          "old_text": null,
          "new_text": "NULL_IF_CONFIG_SMALL(\"Pictor/PC Paint\")",
          "old_line_content": "",
          "new_line_content": "    .long_name      = NULL_IF_CONFIG_SMALL(\"Pictor/PC Paint\"),",
          "content_same": false
        },
        {
          "line": 189,
          "old_api": null,
          "new_api": "bytestream2_get_byte",
          "old_text": null,
          "new_text": "bytestream2_get_byte(&s->g)",
          "old_line_content": "        }",
          "new_line_content": "            int pal_idx = bytestream2_get_byte(&s->g);",
          "content_same": false
        },
        {
          "line": 190,
          "old_api": null,
          "new_api": "FFMIN",
          "old_text": null,
          "new_text": "FFMIN(pal_idx, 15)",
          "old_line_content": "    } else {",
          "new_line_content": "            palette[i]  = ff_cga_palette[FFMIN(pal_idx, 15)];",
          "content_same": false
        },
        {
          "line": 193,
          "old_api": null,
          "new_api": "FFMIN",
          "old_text": null,
          "new_text": "FFMIN(esize, 16)",
          "old_line_content": "            palette[0] = 0xFF000000;",
          "new_line_content": "        npal = FFMIN(esize, 16);",
          "content_same": false
        },
        {
          "line": 195,
          "old_api": null,
          "new_api": "bytestream2_get_byte",
          "old_text": null,
          "new_text": "bytestream2_get_byte(&s->g)",
          "old_line_content": "        } else if (bpp == 2) {",
          "new_line_content": "            int pal_idx = bytestream2_get_byte(&s->g);",
          "content_same": false
        },
        {
          "line": 196,
          "old_api": null,
          "new_api": "FFMIN",
          "old_text": null,
          "new_text": "FFMIN(pal_idx, 63)",
          "old_line_content": "            npal = 4;",
          "new_line_content": "            palette[i]  = ff_ega_palette[FFMIN(pal_idx, 63)];",
          "content_same": false
        },
        {
          "line": 199,
          "old_api": null,
          "new_api": "FFMIN",
          "old_text": null,
          "new_text": "FFMIN(esize / 3, 256)",
          "old_line_content": "        } else {",
          "new_line_content": "        npal = FFMIN(esize / 3, 256);",
          "content_same": false
        },
        {
          "line": 215,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(palette, ff_cga_palette, npal * 4)",
          "old_line_content": "            int stop_size, marker, t1, t2;",
          "new_line_content": "            memcpy(palette, ff_cga_palette, npal * 4);",
          "content_same": false
        },
        {
          "line": 99,
          "old_api": null,
          "new_api": "av_memcpy_backptr",
          "old_text": null,
          "new_text": "av_memcpy_backptr(d+xl, pixels_per_value, s->width - xl)",
          "old_line_content": "static const uint8_t cga_mode45_index[6][4] = {",
          "new_line_content": "                    av_memcpy_backptr(d+xl, pixels_per_value, s->width - xl);",
          "content_same": false
        },
        {
          "line": 228,
          "old_api": null,
          "new_api": "bytestream2_get_bytes_left",
          "old_text": null,
          "new_text": "bytestream2_get_bytes_left(&s->g)",
          "old_line_content": "                if (val == marker) {",
          "new_line_content": "        while (bytestream2_get_bytes_left(&s->g) >= 6) {",
          "content_same": false
        },
        {
          "line": 233,
          "old_api": null,
          "new_api": "FFMIN",
          "old_text": null,
          "new_text": "FFMIN(t1, t2)",
          "old_line_content": "                }",
          "new_line_content": "            stop_size = t1 - FFMIN(t1, t2);",
          "content_same": false
        },
        {
          "line": 235,
          "old_api": null,
          "new_api": "bytestream2_skip",
          "old_text": null,
          "new_text": "bytestream2_skip(&s->g, 2)",
          "old_line_content": "                    break;",
          "new_line_content": "            bytestream2_skip(&s->g, 2);",
          "content_same": false
        },
        {
          "line": 236,
          "old_api": null,
          "new_api": "bytestream2_get_byte",
          "old_text": null,
          "new_text": "bytestream2_get_byte(&s->g)",
          "old_line_content": "",
          "new_line_content": "            marker    = bytestream2_get_byte(&s->g);",
          "content_same": false
        },
        {
          "line": 239,
          "old_api": null,
          "new_api": "bytestream2_get_bytes_left",
          "old_text": null,
          "new_text": "bytestream2_get_bytes_left(&s->g)",
          "old_line_content": "                    if (y < 0)",
          "new_line_content": "                   bytestream2_get_bytes_left(&s->g) > stop_size) {",
          "content_same": false
        },
        {
          "line": 241,
          "old_api": null,
          "new_api": "bytestream2_get_byte",
          "old_text": null,
          "new_text": "bytestream2_get_byte(&s->g)",
          "old_line_content": "                } else {",
          "new_line_content": "                val = bytestream2_get_byte(&s->g);",
          "content_same": false
        },
        {
          "line": 243,
          "old_api": null,
          "new_api": "bytestream2_get_byte",
          "old_text": null,
          "new_text": "bytestream2_get_byte(&s->g)",
          "old_line_content": "                }",
          "new_line_content": "                    run = bytestream2_get_byte(&s->g);",
          "content_same": false
        },
        {
          "line": 245,
          "old_api": null,
          "new_api": "bytestream2_get_le16",
          "old_text": null,
          "new_text": "bytestream2_get_le16(&s->g)",
          "old_line_content": "        }",
          "new_line_content": "                        run = bytestream2_get_le16(&s->g);",
          "content_same": false
        },
        {
          "line": 246,
          "old_api": null,
          "new_api": "bytestream2_get_byte",
          "old_text": null,
          "new_text": "bytestream2_get_byte(&s->g)",
          "old_line_content": "",
          "new_line_content": "                    val = bytestream2_get_byte(&s->g);",
          "content_same": false
        },
        {
          "line": 248,
          "old_api": null,
          "new_api": "bytestream2_get_bytes_left",
          "old_text": null,
          "new_text": "bytestream2_get_bytes_left(&s->g)",
          "old_line_content": "            return AVERROR_INVALIDDATA;",
          "new_line_content": "                if (!bytestream2_get_bytes_left(&s->g))",
          "content_same": false
        },
        {
          "line": 252,
          "old_api": null,
          "new_api": "picmemset_8bpp",
          "old_text": null,
          "new_text": "picmemset_8bpp(s, frame, val, run, &x, &y)",
          "old_line_content": "            if (bits_per_plane == 8)",
          "new_line_content": "                    picmemset_8bpp(s, frame, val, run, &x, &y);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 128,
          "old_api": "bytestream2_skip",
          "new_api": null,
          "old_text": "bytestream2_skip(&s->g, 4)",
          "new_text": null,
          "old_line_content": "    bytestream2_skip(&s->g, 4);",
          "new_line_content": "    uint32_t *palette;",
          "content_same": false
        },
        {
          "line": 129,
          "old_api": "bytestream2_get_byteu",
          "new_api": null,
          "old_text": "bytestream2_get_byteu(&s->g)",
          "new_text": null,
          "old_line_content": "    tmp            = bytestream2_get_byteu(&s->g);",
          "new_line_content": "    int bits_per_plane, bpp, etype, esize, npal, pos_after_pal;",
          "content_same": false
        },
        {
          "line": 258,
          "old_api": "bytestream2_get_bytes_left",
          "new_api": null,
          "old_text": "bytestream2_get_bytes_left(&s->g)",
          "new_text": null,
          "old_line_content": "        while (y >= 0 && bytestream2_get_bytes_left(&s->g) > 0) {",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 259,
          "old_api": "bytestream2_get_bytes_left",
          "new_api": null,
          "old_text": "bytestream2_get_bytes_left(&s->g)",
          "new_text": null,
          "old_line_content": "            memcpy(frame->data[0] + y * frame->linesize[0], s->g.buffer, FFMIN(avctx->width, bytestream2_get_bytes_left(&s->g)));",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 260,
          "old_api": "bytestream2_skip",
          "new_api": null,
          "old_text": "bytestream2_skip(&s->g, avctx->width)",
          "new_text": null,
          "old_line_content": "            bytestream2_skip(&s->g, avctx->width);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 138,
          "old_api": "bytestream2_peek_byte",
          "new_api": null,
          "old_text": "bytestream2_peek_byte(&s->g)",
          "new_text": null,
          "old_line_content": "    if (bytestream2_peek_byte(&s->g) == 0xFF || bpp == 1 || bpp == 4 || bpp == 8) {",
          "new_line_content": "        return AVERROR_INVALIDDATA;",
          "content_same": false
        },
        {
          "line": 139,
          "old_api": "bytestream2_skip",
          "new_api": null,
          "old_text": "bytestream2_skip(&s->g, 2)",
          "new_text": null,
          "old_line_content": "        bytestream2_skip(&s->g, 2);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 151,
          "old_api": "av_image_check_size",
          "new_api": null,
          "old_text": "av_image_check_size(s->width, s->height, 0, avctx)",
          "new_text": null,
          "old_line_content": "    if (av_image_check_size(s->width, s->height, 0, avctx) < 0)",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 159,
          "old_api": "ff_get_buffer",
          "new_api": null,
          "old_text": "ff_get_buffer(avctx, frame, 0)",
          "new_text": null,
          "old_line_content": "    if ((ret = ff_get_buffer(avctx, frame, 0)) < 0)",
          "new_line_content": "        etype = -1;",
          "content_same": false
        },
        {
          "line": 161,
          "old_api": "memset",
          "new_api": null,
          "old_text": "memset(frame->data[0], 0, s->height * frame->linesize[0])",
          "new_text": null,
          "old_line_content": "    memset(frame->data[0], 0, s->height * frame->linesize[0]);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 167,
          "old_api": "bytestream2_peek_byte",
          "new_api": null,
          "old_text": "bytestream2_peek_byte(&s->g)",
          "new_text": null,
          "old_line_content": "    if (etype == 1 && esize > 1 && bytestream2_peek_byte(&s->g) < 6) {",
          "new_line_content": "    if (s->width != avctx->width || s->height != avctx->height) {",
          "content_same": false
        },
        {
          "line": 176,
          "old_api": "FFMIN",
          "new_api": null,
          "old_text": "FFMIN(pal_idx, 15)",
          "new_text": null,
          "old_line_content": "            palette[i]  = ff_cga_palette[FFMIN(pal_idx, 15)];",
          "new_line_content": "    frame->pict_type           = AV_PICTURE_TYPE_I;",
          "content_same": false
        },
        {
          "line": 185,
          "old_api": "FFMIN",
          "new_api": null,
          "old_text": "FFMIN(esize / 3, 256)",
          "new_text": null,
          "old_line_content": "        npal = FFMIN(esize / 3, 256);",
          "new_line_content": "            palette[i] = ff_cga_palette[ cga_mode45_index[idx][i] ];",
          "content_same": false
        },
        {
          "line": 205,
          "old_api": "memset",
          "new_api": null,
          "old_text": "memset(palette + npal, 0, AVPALETTE_SIZE - npal * 4)",
          "new_text": null,
          "old_line_content": "    memset(palette + npal, 0, AVPALETTE_SIZE - npal * 4);",
          "new_line_content": "        if (bpp == 1) {",
          "content_same": false
        },
        {
          "line": 207,
          "old_api": "bytestream2_seek",
          "new_api": null,
          "old_text": "bytestream2_seek(&s->g, pos_after_pal, SEEK_SET)",
          "new_text": null,
          "old_line_content": "    bytestream2_seek(&s->g, pos_after_pal, SEEK_SET);",
          "new_line_content": "            palette[0] = 0xFF000000;",
          "content_same": false
        },
        {
          "line": 211,
          "old_api": "bytestream2_get_le16",
          "new_api": null,
          "old_text": "bytestream2_get_le16(&s->g)",
          "new_text": null,
          "old_line_content": "    if (bytestream2_get_le16(&s->g)) {",
          "new_line_content": "            for (i = 0; i < npal; i++)",
          "content_same": false
        },
        {
          "line": 214,
          "old_api": "bytestream2_get_bytes_left",
          "new_api": null,
          "old_text": "bytestream2_get_bytes_left(&s->g)",
          "new_text": null,
          "old_line_content": "        while (bytestream2_get_bytes_left(&s->g) >= 6) {",
          "new_line_content": "            npal = 16;",
          "content_same": false
        },
        {
          "line": 217,
          "old_api": "bytestream2_get_bytes_left",
          "new_api": null,
          "old_text": "bytestream2_get_bytes_left(&s->g)",
          "new_text": null,
          "old_line_content": "            t1        = bytestream2_get_bytes_left(&s->g);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 218,
          "old_api": "bytestream2_get_le16",
          "new_api": null,
          "old_text": "bytestream2_get_le16(&s->g)",
          "new_text": null,
          "old_line_content": "            t2        = bytestream2_get_le16(&s->g);",
          "new_line_content": "    // fill remaining palette entries",
          "content_same": false
        },
        {
          "line": 222,
          "old_api": "bytestream2_get_byte",
          "new_api": null,
          "old_text": "bytestream2_get_byte(&s->g)",
          "new_text": null,
          "old_line_content": "            marker    = bytestream2_get_byte(&s->g);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 227,
          "old_api": "bytestream2_get_byte",
          "new_api": null,
          "old_text": "bytestream2_get_byte(&s->g)",
          "new_text": null,
          "old_line_content": "                val = bytestream2_get_byte(&s->g);",
          "new_line_content": "        plane = 0;",
          "content_same": false
        },
        {
          "line": 229,
          "old_api": "bytestream2_get_byte",
          "new_api": null,
          "old_text": "bytestream2_get_byte(&s->g)",
          "new_text": null,
          "old_line_content": "                    run = bytestream2_get_byte(&s->g);",
          "new_line_content": "            int stop_size, marker, t1, t2;",
          "content_same": false
        },
        {
          "line": 234,
          "old_api": "bytestream2_get_bytes_left",
          "new_api": null,
          "old_text": "bytestream2_get_bytes_left(&s->g)",
          "new_text": null,
          "old_line_content": "                if (!bytestream2_get_bytes_left(&s->g))",
          "new_line_content": "            // ignore uncompressed block size",
          "content_same": false
        },
        {
          "line": 238,
          "old_api": "picmemset_8bpp",
          "new_api": null,
          "old_text": "picmemset_8bpp(s, frame, val, run, &x, &y)",
          "new_text": null,
          "old_line_content": "                    picmemset_8bpp(s, frame, val, run, &x, &y);",
          "new_line_content": "            while (plane < s->nb_planes &&",
          "content_same": false
        },
        {
          "line": 242,
          "old_api": "picmemset",
          "new_api": null,
          "old_text": "picmemset(s, frame, val, run, &x, &y, &plane, bits_per_plane)",
          "new_text": null,
          "old_line_content": "                    picmemset(s, frame, val, run, &x, &y, &plane, bits_per_plane);",
          "new_line_content": "                if (val == marker) {",
          "content_same": false
        },
        {
          "line": 118,
          "old_api": "bytestream2_init",
          "new_api": null,
          "old_text": "bytestream2_init(&s->g, avpkt->data, avpkt->size)",
          "new_text": null,
          "old_line_content": "    bytestream2_init(&s->g, avpkt->data, avpkt->size);",
          "new_line_content": "    [4] = { 0, 10, 12, 14 }, // mode4, palette#2, high intensity",
          "content_same": false
        },
        {
          "line": 120,
          "old_api": "bytestream2_get_bytes_left",
          "new_api": null,
          "old_text": "bytestream2_get_bytes_left(&s->g)",
          "new_text": null,
          "old_line_content": "    if (bytestream2_get_bytes_left(&s->g) < 11)",
          "new_line_content": "};",
          "content_same": false
        },
        {
          "line": 123,
          "old_api": "bytestream2_get_le16u",
          "new_api": null,
          "old_text": "bytestream2_get_le16u(&s->g)",
          "new_text": null,
          "old_line_content": "    if (bytestream2_get_le16u(&s->g) != 0x1234)",
          "new_line_content": "                        void *data, int *got_frame,",
          "content_same": false
        },
        {
          "line": 127,
          "old_api": "bytestream2_get_le16u",
          "new_api": null,
          "old_text": "bytestream2_get_le16u(&s->g)",
          "new_text": null,
          "old_line_content": "    s->height      = bytestream2_get_le16u(&s->g);",
          "new_line_content": "    AVFrame *frame = data;",
          "content_same": false
        },
        {
          "line": 253,
          "old_api": "picmemset_8bpp",
          "new_api": null,
          "old_text": "picmemset_8bpp(s, frame, val, run, &x, &y)",
          "new_text": null,
          "old_line_content": "                picmemset_8bpp(s, frame, val, run, &x, &y);",
          "new_line_content": "                    if (y < 0)",
          "content_same": false
        },
        {
          "line": 126,
          "old_api": "bytestream2_get_le16u",
          "new_api": null,
          "old_text": "bytestream2_get_le16u(&s->g)",
          "new_text": null,
          "old_line_content": "    s->width       = bytestream2_get_le16u(&s->g);",
          "new_line_content": "    PicContext *s = avctx->priv_data;",
          "content_same": false
        },
        {
          "line": 255,
          "old_api": "picmemset",
          "new_api": null,
          "old_text": "picmemset(s, frame, val, run / (8 / bits_per_plane), &x, &y, &plane, bits_per_plane)",
          "new_text": null,
          "old_line_content": "                picmemset(s, frame, val, run / (8 / bits_per_plane), &x, &y, &plane, bits_per_plane);",
          "new_line_content": "                } else {",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 20,
      "total_additions": 33,
      "total_deletions": 32,
      "total_api_changes": 85
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 16,
        "api_related_lines": 85,
        "non_api_lines": 15,
        "non_api_line_numbers": [
          96,
          97,
          98,
          100,
          69,
          101,
          102,
          77,
          78,
          90,
          91,
          92,
          93,
          94,
          95
        ]
      }
    },
    "api_calls_before": 56,
    "api_calls_after": 57,
    "diff_info": {
      "added_lines": 15,
      "removed_lines": 1,
      "total_diff_lines": 42
    }
  }
}