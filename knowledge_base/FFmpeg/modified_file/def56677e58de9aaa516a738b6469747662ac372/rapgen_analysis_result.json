{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/def56677e58de9aaa516a738b6469747662ac372",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/def56677e58de9aaa516a738b6469747662ac372/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/def56677e58de9aaa516a738b6469747662ac372/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/def56677e58de9aaa516a738b6469747662ac372/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [],
      "additions": [
        {
          "line": 1120,
          "old_api": null,
          "new_api": "wtvfile_close",
          "old_text": null,
          "new_text": "wtvfile_close(wtv->pb)",
          "old_line_content": "}",
          "new_line_content": "    wtvfile_close(wtv->pb);",
          "content_same": false
        },
        {
          "line": 1094,
          "old_api": null,
          "new_api": "ff_index_search_timestamp",
          "old_text": null,
          "new_text": "ff_index_search_timestamp(wtv->index_entries, wtv->nb_index_entries, ts_relative, flags)",
          "old_line_content": "        if (wtv->last_valid_pts == AV_NOPTS_VALUE || ts < wtv->last_valid_pts) {",
          "new_line_content": "    i = ff_index_search_timestamp(wtv->index_entries, wtv->nb_index_entries, ts_relative, flags);",
          "content_same": false
        },
        {
          "line": 1063,
          "old_api": null,
          "new_api": "parse_chunks",
          "old_text": null,
          "new_text": "parse_chunks(s, SEEK_TO_DATA, 0, &len)",
          "old_line_content": "        return stream_index;",
          "new_line_content": "    stream_index = parse_chunks(s, SEEK_TO_DATA, 0, &len);",
          "content_same": false
        },
        {
          "line": 1126,
          "old_api": null,
          "new_api": "NULL_IF_CONFIG_SMALL",
          "old_text": null,
          "new_text": "NULL_IF_CONFIG_SMALL(\"Windows Television (WTV)\")",
          "old_line_content": "    .read_probe     = read_probe,",
          "new_line_content": "    .long_name      = NULL_IF_CONFIG_SMALL(\"Windows Television (WTV)\"),",
          "content_same": false
        },
        {
          "line": 1097,
          "old_api": null,
          "new_api": "avio_seek",
          "old_text": null,
          "new_text": "avio_seek(pb, 0, SEEK_SET)",
          "old_line_content": "        } else if (st->duration != AV_NOPTS_VALUE && ts_relative > st->duration && wtv->nb_index_entries) {",
          "new_line_content": "            if (avio_seek(pb, 0, SEEK_SET) < 0)",
          "content_same": false
        },
        {
          "line": 1035,
          "old_api": null,
          "new_api": "avio_rl64",
          "old_text": null,
          "new_text": "avio_rl64(pb)",
          "old_line_content": "                            break;",
          "new_line_content": "                        uint64_t frame_nb = avio_rl64(pb);",
          "content_same": false
        },
        {
          "line": 1036,
          "old_api": null,
          "new_api": "avio_rl64",
          "old_text": null,
          "new_text": "avio_rl64(pb)",
          "old_line_content": "                        for (i = wtv->nb_index_entries - 1; i >= 0; i--) {",
          "new_line_content": "                        uint64_t position = avio_rl64(pb);",
          "content_same": false
        },
        {
          "line": 1067,
          "old_api": null,
          "new_api": "av_get_packet",
          "old_text": null,
          "new_text": "av_get_packet(pb, pkt, len - 32)",
          "old_line_content": "        return ret;",
          "new_line_content": "    ret = av_get_packet(pb, pkt, len - 32);",
          "content_same": false
        },
        {
          "line": 1100,
          "old_api": null,
          "new_api": "avio_seek",
          "old_text": null,
          "new_text": "avio_seek(pb, wtv->index_entries[wtv->nb_index_entries - 1].pos, SEEK_SET)",
          "old_line_content": "        }",
          "new_line_content": "            if (avio_seek(pb, wtv->index_entries[wtv->nb_index_entries - 1].pos, SEEK_SET) < 0)",
          "content_same": false
        },
        {
          "line": 1103,
          "old_api": null,
          "new_api": "parse_chunks",
          "old_text": null,
          "new_text": "parse_chunks(s, SEEK_TO_PTS, ts, 0)",
          "old_line_content": "        return 0;",
          "new_line_content": "        if (parse_chunks(s, SEEK_TO_PTS, ts, 0) < 0)",
          "content_same": false
        },
        {
          "line": 1072,
          "old_api": null,
          "new_api": "WTV_PAD8",
          "old_text": null,
          "new_text": "WTV_PAD8(len)",
          "old_line_content": "}",
          "new_line_content": "    avio_skip(pb, WTV_PAD8(len) - len);",
          "content_same": false
        },
        {
          "line": 1041,
          "old_api": null,
          "new_api": "avio_feof",
          "old_text": null,
          "new_text": "avio_feof(pb)",
          "old_line_content": "                                e->pos = position;",
          "new_line_content": "                        if (avio_feof(pb))",
          "content_same": false
        },
        {
          "line": 1104,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(ERANGE)",
          "old_line_content": "    }",
          "new_line_content": "            return AVERROR(ERANGE);",
          "content_same": false
        },
        {
          "line": 1107,
          "old_api": null,
          "new_api": "avio_seek",
          "old_text": null,
          "new_text": "avio_seek(pb, wtv->index_entries[i].pos, SEEK_SET)",
          "old_line_content": "    wtv->pts = wtv->index_entries[i].timestamp;",
          "new_line_content": "    if (avio_seek(pb, wtv->index_entries[i].pos, SEEK_SET) < 0)",
          "content_same": false
        },
        {
          "line": 1046,
          "old_api": null,
          "new_api": "wtvfile_close",
          "old_text": null,
          "new_text": "wtvfile_close(pb)",
          "old_line_content": "                }",
          "new_line_content": "                    wtvfile_close(pb);",
          "content_same": false
        },
        {
          "line": 1053,
          "old_api": null,
          "new_api": "avio_seek",
          "old_text": null,
          "new_text": "avio_seek(s->pb, timeline_pos, SEEK_SET)",
          "old_line_content": "}",
          "new_line_content": "    avio_seek(s->pb, timeline_pos, SEEK_SET);",
          "content_same": false
        },
        {
          "line": 1086,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(ENOSYS)",
          "old_line_content": "    /* timestamp adjustment is required because wtv->pts values are absolute,",
          "new_line_content": "        return AVERROR(ENOSYS);",
          "content_same": false
        },
        {
          "line": 1119,
          "old_api": null,
          "new_api": "av_freep",
          "old_text": null,
          "new_text": "av_freep(&wtv->index_entries)",
          "old_line_content": "    return 0;",
          "new_line_content": "    av_freep(&wtv->index_entries);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 1092,
          "old_api": "ff_index_search_timestamp",
          "new_api": null,
          "old_text": "ff_index_search_timestamp(wtv->index_entries, wtv->nb_index_entries, ts_relative, flags)",
          "new_text": null,
          "old_line_content": "    i = ff_index_search_timestamp(wtv->index_entries, wtv->nb_index_entries, ts_relative, flags);",
          "new_line_content": "        ts_relative -= wtv->epoch;",
          "content_same": false
        },
        {
          "line": 1061,
          "old_api": "parse_chunks",
          "new_api": null,
          "old_text": "parse_chunks(s, SEEK_TO_DATA, 0, &len)",
          "new_text": null,
          "old_line_content": "    stream_index = parse_chunks(s, SEEK_TO_DATA, 0, &len);",
          "new_line_content": "    int stream_index, len, ret;",
          "content_same": false
        },
        {
          "line": 1124,
          "old_api": "NULL_IF_CONFIG_SMALL",
          "new_api": null,
          "old_text": "NULL_IF_CONFIG_SMALL(\"Windows Television (WTV)\")",
          "new_text": null,
          "old_line_content": "    .long_name      = NULL_IF_CONFIG_SMALL(\"Windows Television (WTV)\"),",
          "new_line_content": "AVInputFormat ff_wtv_demuxer = {",
          "content_same": false
        },
        {
          "line": 1095,
          "old_api": "avio_seek",
          "new_api": null,
          "old_text": "avio_seek(pb, 0, SEEK_SET)",
          "new_text": null,
          "old_line_content": "            if (avio_seek(pb, 0, SEEK_SET) < 0)",
          "new_line_content": "    if (i < 0) {",
          "content_same": false
        },
        {
          "line": 1032,
          "old_api": "avio_rl64",
          "new_api": null,
          "old_text": "avio_rl64(pb)",
          "new_text": null,
          "old_line_content": "                        uint64_t frame_nb = avio_rl64(pb);",
          "new_line_content": "                    AVIndexEntry *e_end = wtv->index_entries + wtv->nb_index_entries - 1;",
          "content_same": false
        },
        {
          "line": 1033,
          "old_api": "avio_rl64",
          "new_api": null,
          "old_text": "avio_rl64(pb)",
          "new_text": null,
          "old_line_content": "                        uint64_t position = avio_rl64(pb);",
          "new_line_content": "                    uint64_t last_position = 0;",
          "content_same": false
        },
        {
          "line": 1034,
          "old_api": "avio_feof",
          "new_api": null,
          "old_text": "avio_feof(pb)",
          "new_text": null,
          "old_line_content": "                        if (avio_feof(pb))",
          "new_line_content": "                    while (1) {",
          "content_same": false
        },
        {
          "line": 1065,
          "old_api": "av_get_packet",
          "new_api": null,
          "old_text": "av_get_packet(pb, pkt, len - 32)",
          "new_text": null,
          "old_line_content": "    ret = av_get_packet(pb, pkt, len - 32);",
          "new_line_content": "        return stream_index;",
          "content_same": false
        },
        {
          "line": 1098,
          "old_api": "avio_seek",
          "new_api": null,
          "old_text": "avio_seek(pb, wtv->index_entries[wtv->nb_index_entries - 1].pos, SEEK_SET)",
          "new_text": null,
          "old_line_content": "            if (avio_seek(pb, wtv->index_entries[wtv->nb_index_entries - 1].pos, SEEK_SET) < 0)",
          "new_line_content": "                return -1;",
          "content_same": false
        },
        {
          "line": 1101,
          "old_api": "parse_chunks",
          "new_api": null,
          "old_text": "parse_chunks(s, SEEK_TO_PTS, ts, 0)",
          "new_text": null,
          "old_line_content": "        if (parse_chunks(s, SEEK_TO_PTS, ts, 0) < 0)",
          "new_line_content": "                return -1;",
          "content_same": false
        },
        {
          "line": 1070,
          "old_api": "WTV_PAD8",
          "new_api": null,
          "old_text": "WTV_PAD8(len)",
          "new_text": null,
          "old_line_content": "    avio_skip(pb, WTV_PAD8(len) - len);",
          "new_line_content": "    pkt->stream_index = stream_index;",
          "content_same": false
        },
        {
          "line": 1102,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(ERANGE)",
          "new_text": null,
          "old_line_content": "            return AVERROR(ERANGE);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 1105,
          "old_api": "avio_seek",
          "new_api": null,
          "old_text": "avio_seek(pb, wtv->index_entries[i].pos, SEEK_SET)",
          "new_text": null,
          "old_line_content": "    if (avio_seek(pb, wtv->index_entries[i].pos, SEEK_SET) < 0)",
          "new_line_content": "        return 0;",
          "content_same": false
        },
        {
          "line": 1044,
          "old_api": "wtvfile_close",
          "new_api": null,
          "old_text": "wtvfile_close(pb)",
          "new_text": null,
          "old_line_content": "                    wtvfile_close(pb);",
          "new_line_content": "                    }",
          "content_same": false
        },
        {
          "line": 1051,
          "old_api": "avio_seek",
          "new_api": null,
          "old_text": "avio_seek(s->pb, timeline_pos, SEEK_SET)",
          "new_text": null,
          "old_line_content": "    avio_seek(s->pb, timeline_pos, SEEK_SET);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1084,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(ENOSYS)",
          "new_text": null,
          "old_line_content": "        return AVERROR(ENOSYS);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1117,
          "old_api": "av_freep",
          "new_api": null,
          "old_text": "av_freep(&wtv->index_entries)",
          "new_text": null,
          "old_line_content": "    av_freep(&wtv->index_entries);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 1118,
          "old_api": "wtvfile_close",
          "new_api": null,
          "old_text": "wtvfile_close(wtv->pb)",
          "new_text": null,
          "old_line_content": "    wtvfile_close(wtv->pb);",
          "new_line_content": "    WtvContext *wtv = s->priv_data;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 0,
      "total_additions": 18,
      "total_deletions": 18,
      "total_api_changes": 36
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 13,
        "api_related_lines": 36,
        "non_api_lines": 9,
        "non_api_line_numbers": [
          1031,
          1037,
          1038,
          1039,
          1040,
          1042,
          1043,
          1045,
          1047
        ]
      }
    },
    "api_calls_before": 341,
    "api_calls_after": 341,
    "diff_info": {
      "added_lines": 10,
      "removed_lines": 8,
      "total_diff_lines": 37
    }
  }
}