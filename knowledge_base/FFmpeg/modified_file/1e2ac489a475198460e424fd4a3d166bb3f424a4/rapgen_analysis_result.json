{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/1e2ac489a475198460e424fd4a3d166bb3f424a4",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/1e2ac489a475198460e424fd4a3d166bb3f424a4/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/1e2ac489a475198460e424fd4a3d166bb3f424a4/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/1e2ac489a475198460e424fd4a3d166bb3f424a4/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 827,
          "old_api": "vaapi_get_image_format",
          "new_api": "AVERROR",
          "old_text": "vaapi_get_image_format(hwfc->device_ctx, dst->format, &image_format)",
          "new_text": "AVERROR(EINVAL)",
          "old_line_content": "    err = vaapi_get_image_format(hwfc->device_ctx, dst->format, &image_format);",
          "new_line_content": "        return AVERROR(EINVAL);",
          "content_same": false
        },
        {
          "line": 842,
          "old_api": "vaErrorStr",
          "new_api": "vaSyncSurface",
          "old_text": "vaErrorStr(vas)",
          "new_text": "vaSyncSurface(hwctx->display, surface_id)",
          "old_line_content": "               \"%#x: %d (%s).\\n\", surface_id, vas, vaErrorStr(vas));",
          "new_line_content": "    vas = vaSyncSurface(hwctx->display, surface_id);",
          "content_same": false
        },
        {
          "line": 861,
          "old_api": "AVERROR",
          "new_api": "av_log",
          "old_text": "AVERROR(EIO)",
          "new_text": "av_log(hwfc, AV_LOG_ERROR, \"Failed to derive image from \"\n                   \"surface %#x: %d (%s).\\n\",\n                   surface_id, vas, vaErrorStr(vas))",
          "old_line_content": "            err = AVERROR(EIO);",
          "new_line_content": "            av_log(hwfc, AV_LOG_ERROR, \"Failed to derive image from \"",
          "content_same": false
        },
        {
          "line": 868,
          "old_api": "AVERROR",
          "new_api": "av_log",
          "old_text": "AVERROR(EIO)",
          "new_text": "av_log(hwfc, AV_LOG_ERROR, \"Derive image of surface %#x \"\n                   \"is in wrong format: expected %#08x, got %#08x.\\n\",\n                   surface_id, image_format->fourcc, map->image.format.fourcc)",
          "old_line_content": "            err = AVERROR(EIO);",
          "new_line_content": "            av_log(hwfc, AV_LOG_ERROR, \"Derive image of surface %#x \"",
          "content_same": false
        },
        {
          "line": 876,
          "old_api": "av_log",
          "new_api": "vaCreateImage",
          "old_text": "av_log(hwfc, AV_LOG_ERROR, \"Failed to create image for \"\n                   \"surface %#x: %d (%s).\\n\",\n                   surface_id, vas, vaErrorStr(vas))",
          "new_text": "vaCreateImage(hwctx->display, image_format,\n                            hwfc->width, hwfc->height, &map->image)",
          "old_line_content": "            av_log(hwfc, AV_LOG_ERROR, \"Failed to create image for \"",
          "new_line_content": "        vas = vaCreateImage(hwctx->display, image_format,",
          "content_same": false
        },
        {
          "line": 879,
          "old_api": "AVERROR",
          "new_api": "av_log",
          "old_text": "AVERROR(EIO)",
          "new_text": "av_log(hwfc, AV_LOG_ERROR, \"Failed to create image for \"\n                   \"surface %#x: %d (%s).\\n\",\n                   surface_id, vas, vaErrorStr(vas))",
          "old_line_content": "            err = AVERROR(EIO);",
          "new_line_content": "            av_log(hwfc, AV_LOG_ERROR, \"Failed to create image for \"",
          "content_same": false
        },
        {
          "line": 886,
          "old_api": "av_log",
          "new_api": "vaGetImage",
          "old_text": "av_log(hwfc, AV_LOG_ERROR, \"Failed to read image from \"\n                       \"surface %#x: %d (%s).\\n\",\n                       surface_id, vas, vaErrorStr(vas))",
          "new_text": "vaGetImage(hwctx->display, surface_id, 0, 0,\n                             hwfc->width, hwfc->height, map->image.image_id)",
          "old_line_content": "                av_log(hwfc, AV_LOG_ERROR, \"Failed to read image from \"",
          "new_line_content": "            vas = vaGetImage(hwctx->display, surface_id, 0, 0,",
          "content_same": false
        },
        {
          "line": 889,
          "old_api": "AVERROR",
          "new_api": "av_log",
          "old_text": "AVERROR(EIO)",
          "new_text": "av_log(hwfc, AV_LOG_ERROR, \"Failed to read image from \"\n                       \"surface %#x: %d (%s).\\n\",\n                       surface_id, vas, vaErrorStr(vas))",
          "old_line_content": "                err = AVERROR(EIO);",
          "new_line_content": "                av_log(hwfc, AV_LOG_ERROR, \"Failed to read image from \"",
          "content_same": false
        },
        {
          "line": 942,
          "old_api": "AVERROR",
          "new_api": "av_free",
          "old_text": "AVERROR(EINVAL)",
          "new_text": "av_free(map)",
          "old_line_content": "        return AVERROR(EINVAL);",
          "new_line_content": "        av_free(map);",
          "content_same": false
        },
        {
          "line": 956,
          "old_api": "av_frame_copy",
          "new_api": "av_frame_alloc",
          "old_text": "av_frame_copy(dst, map)",
          "new_text": "av_frame_alloc()",
          "old_line_content": "    err = av_frame_copy(dst, map);",
          "new_line_content": "    map = av_frame_alloc();",
          "content_same": false
        },
        {
          "line": 987,
          "old_api": "av_frame_copy",
          "new_api": "av_frame_alloc",
          "old_text": "av_frame_copy(map, src)",
          "new_text": "av_frame_alloc()",
          "old_line_content": "    err = av_frame_copy(map, src);",
          "new_line_content": "    map = av_frame_alloc();",
          "content_same": false
        },
        {
          "line": 1074,
          "old_api": "av_log",
          "new_api": "DRM_MAP",
          "old_text": "av_log(dst_fc, AV_LOG_DEBUG, \"Destroy surface %#x.\\n\", surface_id)",
          "new_text": "DRM_MAP(X2R10G10B10, 1, DRM_FORMAT_XRGB2101010)",
          "old_line_content": "    av_log(dst_fc, AV_LOG_DEBUG, \"Destroy surface %#x.\\n\", surface_id);",
          "new_line_content": "    DRM_MAP(X2R10G10B10, 1, DRM_FORMAT_XRGB2101010),",
          "content_same": false
        },
        {
          "line": 1301,
          "old_api": "ff_hwframe_map_create",
          "new_api": "vaCreateSurfaces",
          "old_text": "ff_hwframe_map_create(dst->hw_frames_ctx, dst, src,\n                                &vaapi_unmap_from_drm,\n                                (void*)(uintptr_t)surface_id)",
          "new_text": "vaCreateSurfaces(dst_dev->display, format_desc->rt_format,\n                           src->width, src->height,\n                           &surface_id, 1,\n                           attrs, FF_ARRAY_ELEMS(attrs))",
          "old_line_content": "    err = ff_hwframe_map_create(dst->hw_frames_ctx, dst, src,",
          "new_line_content": "    vas = vaCreateSurfaces(dst_dev->display, format_desc->rt_format,",
          "content_same": false
        },
        {
          "line": 1451,
          "old_api": "vaErrorStr",
          "new_api": "vaReleaseBufferHandle",
          "old_text": "vaErrorStr(vas)",
          "new_text": "vaReleaseBufferHandle(hwctx->display, mapping->image.buf)",
          "old_line_content": "               surface_id, vas, vaErrorStr(vas));",
          "new_line_content": "    vas = vaReleaseBufferHandle(hwctx->display, mapping->image.buf);",
          "content_same": false
        },
        {
          "line": 1479,
          "old_api": "vaErrorStr",
          "new_api": "av_log",
          "old_text": "vaErrorStr(vas)",
          "new_text": "av_log(hwfc, AV_LOG_DEBUG, \"Map VAAPI surface %#x to DRM.\\n\",\n           surface_id)",
          "old_line_content": "               surface_id, vas, vaErrorStr(vas));",
          "new_line_content": "    av_log(hwfc, AV_LOG_DEBUG, \"Map VAAPI surface %#x to DRM.\\n\",",
          "content_same": false
        },
        {
          "line": 1484,
          "old_api": "FF_ARRAY_ELEMS",
          "new_api": "AVERROR",
          "old_text": "FF_ARRAY_ELEMS(vaapi_drm_format_map)",
          "new_text": "AVERROR(ENOMEM)",
          "old_line_content": "    for (i = 0; i < FF_ARRAY_ELEMS(vaapi_drm_format_map); i++) {",
          "new_line_content": "        return AVERROR(ENOMEM);",
          "content_same": false
        },
        {
          "line": 1489,
          "old_api": "FF_ARRAY_ELEMS",
          "new_api": "av_log",
          "old_text": "FF_ARRAY_ELEMS(vaapi_drm_format_map)",
          "new_text": "av_log(hwfc, AV_LOG_ERROR, \"Failed to derive image from \"\n               \"surface %#x: %d (%s).\\n\",\n               surface_id, vas, vaErrorStr(vas))",
          "old_line_content": "    if (i >= FF_ARRAY_ELEMS(vaapi_drm_format_map)) {",
          "new_line_content": "        av_log(hwfc, AV_LOG_ERROR, \"Failed to derive image from \"",
          "content_same": false
        },
        {
          "line": 1583,
          "old_api": "vaapi_map_to_drm_esh",
          "new_api": "vaDestroyImage",
          "old_text": "vaapi_map_to_drm_esh(hwfc, dst, src, flags)",
          "new_text": "vaDestroyImage(hwctx->display, mapping->image.image_id)",
          "old_line_content": "    err = vaapi_map_to_drm_esh(hwfc, dst, src, flags);",
          "new_line_content": "    vaDestroyImage(hwctx->display, mapping->image.image_id);",
          "content_same": false
        },
        {
          "line": 1664,
          "old_api": "vaSetErrorCallback",
          "new_api": "av_log",
          "old_text": "vaSetErrorCallback(display, &vaapi_device_log_error, ctx)",
          "new_text": "av_log(ctx, AV_LOG_VERBOSE, \"libva: %s\", message)",
          "old_line_content": "    vaSetErrorCallback(display, &vaapi_device_log_error, ctx);",
          "new_line_content": "    av_log(ctx, AV_LOG_VERBOSE, \"libva: %s\", message);",
          "content_same": false
        },
        {
          "line": 1676,
          "old_api": "av_log",
          "new_api": "vaSetErrorCallback",
          "old_text": "av_log(ctx, AV_LOG_VERBOSE, \"Initialised VAAPI connection: \"\n           \"version %d.%d\\n\", major, minor)",
          "new_text": "vaSetErrorCallback(display, &vaapi_device_log_error, ctx)",
          "old_line_content": "    av_log(ctx, AV_LOG_VERBOSE, \"Initialised VAAPI connection: \"",
          "new_line_content": "    vaSetErrorCallback(display, &vaapi_device_log_error, ctx);",
          "content_same": false
        },
        {
          "line": 1702,
          "old_api": "strcmp",
          "new_api": "av_mallocz",
          "old_text": "strcmp(ent->value, \"drm\")",
          "new_text": "av_mallocz(sizeof(*priv))",
          "old_line_content": "        if (!strcmp(ent->value, \"drm\")) {",
          "new_line_content": "    priv = av_mallocz(sizeof(*priv));",
          "content_same": false
        },
        {
          "line": 1704,
          "old_api": "strcmp",
          "new_api": "AVERROR",
          "old_text": "strcmp(ent->value, \"x11\")",
          "new_text": "AVERROR(ENOMEM)",
          "old_line_content": "        } else if (!strcmp(ent->value, \"x11\")) {",
          "new_line_content": "        return AVERROR(ENOMEM);",
          "content_same": false
        },
        {
          "line": 1711,
          "old_api": "AVERROR",
          "new_api": "av_dict_get",
          "old_text": "AVERROR(EINVAL)",
          "new_text": "av_dict_get(opts, \"connection_type\", NULL, 0)",
          "old_line_content": "            return AVERROR(EINVAL);",
          "new_line_content": "    ent = av_dict_get(opts, \"connection_type\", NULL, 0);",
          "content_same": false
        },
        {
          "line": 1739,
          "old_api": "av_dict_get",
          "new_api": "open",
          "old_text": "av_dict_get(opts, \"kernel_driver\", NULL, 0)",
          "new_text": "open(device, O_RDWR)",
          "old_line_content": "            kernel_driver = av_dict_get(opts, \"kernel_driver\", NULL, 0);",
          "new_line_content": "            priv->drm_fd = open(device, O_RDWR);",
          "content_same": false
        },
        {
          "line": 1754,
          "old_api": "av_log",
          "new_api": "snprintf",
          "old_text": "av_log(ctx, AV_LOG_VERBOSE, \"No available render device \"\n                               \"for DRM render node.\\n\")",
          "new_text": "snprintf(path, sizeof(path),\n                         \"/dev/dri/renderD%d\", 128 + n)",
          "old_line_content": "                        av_log(ctx, AV_LOG_VERBOSE, \"No available render device \"",
          "new_line_content": "                snprintf(path, sizeof(path),",
          "content_same": false
        },
        {
          "line": 1766,
          "old_api": "close",
          "new_api": "av_log",
          "old_text": "close(priv->drm_fd)",
          "new_text": "av_log(ctx, AV_LOG_VERBOSE, \"No available render device \"\n                               \"for DRM render node.\\n\")",
          "old_line_content": "                    close(priv->drm_fd);",
          "new_line_content": "                        av_log(ctx, AV_LOG_VERBOSE, \"No available render device \"",
          "content_same": false
        },
        {
          "line": 1776,
          "old_api": "close",
          "new_api": "av_log",
          "old_text": "close(priv->drm_fd)",
          "new_text": "av_log(ctx, AV_LOG_VERBOSE,\n                           \"Failed to get DRM version for device %d.\\n\", n)",
          "old_line_content": "                        close(priv->drm_fd);",
          "new_line_content": "                    av_log(ctx, AV_LOG_VERBOSE,",
          "content_same": false
        },
        {
          "line": 1784,
          "old_api": "drmFreeVersion",
          "new_api": "av_log",
          "old_text": "drmFreeVersion(info)",
          "new_text": "av_log(ctx, AV_LOG_VERBOSE, \"Ignoring device %d \"\n                               \"with non-matching kernel driver (%s).\\n\",\n                               n, info->name)",
          "old_line_content": "                    drmFreeVersion(info);",
          "new_line_content": "                        av_log(ctx, AV_LOG_VERBOSE, \"Ignoring device %d \"",
          "content_same": false
        },
        {
          "line": 1787,
          "old_api": "strcmp",
          "new_api": "drmFreeVersion",
          "old_text": "strcmp(info->name, \"vgem\")",
          "new_text": "drmFreeVersion(info)",
          "old_line_content": "                } else if (!strcmp(info->name, \"vgem\")) {",
          "new_line_content": "                        drmFreeVersion(info);",
          "content_same": false
        },
        {
          "line": 1788,
          "old_api": "av_log",
          "new_api": "close",
          "old_text": "av_log(ctx, AV_LOG_VERBOSE,\n                           \"Skipping vgem node for device %d.\\n\", n)",
          "new_text": "close(priv->drm_fd)",
          "old_line_content": "                    av_log(ctx, AV_LOG_VERBOSE,",
          "new_line_content": "                        close(priv->drm_fd);",
          "content_same": false
        },
        {
          "line": 1807,
          "old_api": "av_log",
          "new_api": "drmFreeVersion",
          "old_text": "av_log(ctx, AV_LOG_VERBOSE, \"Cannot open a VA display \"\n                   \"from DRM device %s.\\n\", device)",
          "new_text": "drmFreeVersion(info)",
          "old_line_content": "            av_log(ctx, AV_LOG_VERBOSE, \"Cannot open a VA display \"",
          "new_line_content": "                drmFreeVersion(info);",
          "content_same": false
        },
        {
          "line": 1830,
          "old_api": "av_log",
          "new_api": "XOpenDisplay",
          "old_text": "av_log(ctx, AV_LOG_VERBOSE, \"Opened VA display via \"\n                   \"X11 display %s.\\n\", XDisplayName(device))",
          "new_text": "XOpenDisplay(device)",
          "old_line_content": "            av_log(ctx, AV_LOG_VERBOSE, \"Opened VA display via \"",
          "new_line_content": "        priv->x11_display = XOpenDisplay(device);",
          "content_same": false
        },
        {
          "line": 1863,
          "old_api": "pfnCreateDXGIFactory",
          "new_api": "dlsym",
          "old_text": "pfnCreateDXGIFactory(&IID_IDXGIFactory2,\n                                              (void **)&pDXGIFactory)",
          "new_text": "dlsym(dxgi, \"CreateDXGIFactory\")",
          "old_line_content": "            if (SUCCEEDED(pfnCreateDXGIFactory(&IID_IDXGIFactory2,",
          "new_line_content": "                (PFN_CREATE_DXGI_FACTORY)dlsym(dxgi, \"CreateDXGIFactory\");",
          "content_same": false
        },
        {
          "line": 1865,
          "old_api": "atoi",
          "new_api": "av_log",
          "old_text": "atoi(device)",
          "new_text": "av_log(ctx, AV_LOG_ERROR, \"CreateDXGIFactory load failed\\n\")",
          "old_line_content": "                int adapter = atoi(device);",
          "new_line_content": "                av_log(ctx, AV_LOG_ERROR, \"CreateDXGIFactory load failed\\n\");",
          "content_same": false
        },
        {
          "line": 1866,
          "old_api": "IDXGIFactory2_EnumAdapters",
          "new_api": "dlclose",
          "old_text": "IDXGIFactory2_EnumAdapters(pDXGIFactory,\n                                                         adapter,\n                                                         &pAdapter)",
          "new_text": "dlclose(dxgi)",
          "old_line_content": "                if (SUCCEEDED(IDXGIFactory2_EnumAdapters(pDXGIFactory,",
          "new_line_content": "                dlclose(dxgi);",
          "content_same": false
        },
        {
          "line": 1878,
          "old_api": "IDXGIAdapter_Release",
          "new_api": "IDXGIFactory2_EnumAdapters",
          "old_text": "IDXGIAdapter_Release(pAdapter)",
          "new_text": "IDXGIFactory2_EnumAdapters(pDXGIFactory,\n                                                         adapter,\n                                                         &pAdapter)",
          "old_line_content": "                    IDXGIAdapter_Release(pAdapter);",
          "new_line_content": "                if (SUCCEEDED(IDXGIFactory2_EnumAdapters(pDXGIFactory,",
          "content_same": false
        },
        {
          "line": 1883,
          "old_api": "dlclose",
          "new_api": "av_log",
          "old_text": "dlclose(dxgi)",
          "new_text": "av_log(ctx, AV_LOG_INFO,\n                              \"Using device %04x:%04x (%ls) - LUID %lu %ld.\\n\",\n                              desc.VendorId, desc.DeviceId, desc.Description,\n                              desc.AdapterLuid.LowPart,\n                              desc.AdapterLuid.HighPart)",
          "old_line_content": "            dlclose(dxgi);",
          "new_line_content": "                        av_log(ctx, AV_LOG_INFO,",
          "content_same": false
        },
        {
          "line": 1888,
          "old_api": "av_log",
          "new_api": "vaGetDisplayWin32",
          "old_text": "av_log(ctx, AV_LOG_ERROR, \"Cannot open a VA display \"\n                    \"from Win32 display.\\n\")",
          "new_text": "vaGetDisplayWin32(&desc.AdapterLuid)",
          "old_line_content": "            av_log(ctx, AV_LOG_ERROR, \"Cannot open a VA display \"",
          "new_line_content": "                        display = vaGetDisplayWin32(&desc.AdapterLuid);",
          "content_same": false
        },
        {
          "line": 1905,
          "old_api": "AVERROR",
          "new_api": "av_log",
          "old_text": "AVERROR(EINVAL)",
          "new_text": "av_log(ctx, AV_LOG_VERBOSE, \"Opened VA display via \"\n                \"Win32 display.\\n\")",
          "old_line_content": "        return AVERROR(EINVAL);",
          "new_line_content": "        av_log(ctx, AV_LOG_VERBOSE, \"Opened VA display via \"",
          "content_same": false
        },
        {
          "line": 1912,
          "old_api": "vaSetDriverName",
          "new_api": "av_log",
          "old_text": "vaSetDriverName(display, ent->value)",
          "new_text": "av_log(ctx, AV_LOG_ERROR, \"No VA display found for \"\n                   \"device %s.\\n\", device)",
          "old_line_content": "        vas = vaSetDriverName(display, ent->value);",
          "new_line_content": "            av_log(ctx, AV_LOG_ERROR, \"No VA display found for \"",
          "content_same": false
        },
        {
          "line": 1915,
          "old_api": "vaErrorStr",
          "new_api": "av_log",
          "old_text": "vaErrorStr(vas)",
          "new_text": "av_log(ctx, AV_LOG_ERROR, \"No VA display found for \"\n                   \"any default device.\\n\")",
          "old_line_content": "                   \"%s: %d (%s).\\n\", ent->value, vas, vaErrorStr(vas));",
          "new_line_content": "            av_log(ctx, AV_LOG_ERROR, \"No VA display found for \"",
          "content_same": false
        },
        {
          "line": 1920,
          "old_api": "av_log",
          "new_api": "av_dict_get",
          "old_text": "av_log(ctx, AV_LOG_WARNING, \"Driver name setting is not \"\n               \"supported with this VAAPI version.\\n\")",
          "new_text": "av_dict_get(opts, \"driver\", NULL, 0)",
          "old_line_content": "        av_log(ctx, AV_LOG_WARNING, \"Driver name setting is not \"",
          "new_line_content": "    ent = av_dict_get(opts, \"driver\", NULL, 0);",
          "content_same": false
        },
        {
          "line": 1952,
          "old_api": "AVERROR",
          "new_api": "av_log",
          "old_text": "AVERROR(EINVAL)",
          "new_text": "av_log(ctx, AV_LOG_ERROR, \"DRM instance requires an associated \"\n                   \"device to derive a VA display from.\\n\")",
          "old_line_content": "                return AVERROR(EINVAL);",
          "new_line_content": "            av_log(ctx, AV_LOG_ERROR, \"DRM instance requires an associated \"",
          "content_same": false
        },
        {
          "line": 1959,
          "old_api": "av_log",
          "new_api": "drmGetNodeTypeFromFd",
          "old_text": "av_log(ctx, AV_LOG_VERBOSE, \"Using non-render node \"\n                           \"because the device does not have an \"\n                           \"associated render node.\\n\")",
          "new_text": "drmGetNodeTypeFromFd(src_hwctx->fd)",
          "old_line_content": "                    av_log(ctx, AV_LOG_VERBOSE, \"Using non-render node \"",
          "new_line_content": "            int node_type = drmGetNodeTypeFromFd(src_hwctx->fd);",
          "content_same": false
        },
        {
          "line": 1964,
          "old_api": "open",
          "new_api": "AVERROR",
          "old_text": "open(render_node, O_RDWR)",
          "new_text": "AVERROR(EINVAL)",
          "old_line_content": "                    fd = open(render_node, O_RDWR);",
          "new_line_content": "                return AVERROR(EINVAL);",
          "content_same": false
        },
        {
          "line": 1983,
          "old_api": "av_mallocz",
          "new_api": "av_log",
          "old_text": "av_mallocz(sizeof(*priv))",
          "new_text": "av_log(ctx, AV_LOG_VERBOSE, \"Using render node %s \"\n                               \"in place of non-render DRM device.\\n\",\n                               render_node)",
          "old_line_content": "        priv = av_mallocz(sizeof(*priv));",
          "new_line_content": "                        av_log(ctx, AV_LOG_VERBOSE, \"Using render node %s \"",
          "content_same": false
        },
        {
          "line": 1987,
          "old_api": "close",
          "new_api": "free",
          "old_text": "close(fd)",
          "new_text": "free(render_node)",
          "old_line_content": "                close(fd);",
          "new_line_content": "                    free(render_node);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 1024,
          "old_api": null,
          "new_api": "av_frame_copy_props",
          "old_text": null,
          "new_text": "av_frame_copy_props(dst, src)",
          "old_line_content": "        { __VA_ARGS__ } \\",
          "new_line_content": "    err = av_frame_copy_props(dst, src);",
          "content_same": false
        },
        {
          "line": 1546,
          "old_api": null,
          "new_api": "vaAcquireBufferHandle",
          "old_text": null,
          "new_text": "vaAcquireBufferHandle(hwctx->display, mapping->image.buf,\n                                &mapping->buffer_info)",
          "old_line_content": "           mapping->buffer_info.handle);",
          "new_line_content": "    vas = vaAcquireBufferHandle(hwctx->display, mapping->image.buf,",
          "content_same": false
        },
        {
          "line": 1549,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(hwfc, AV_LOG_ERROR, \"Failed to get buffer \"\n               \"handle from image %#x (derived from surface %#x): \"\n               \"%d (%s).\\n\", mapping->image.buf, surface_id,\n               vas, vaErrorStr(vas))",
          "old_line_content": "    mapping->drm_desc.objects[0] = (AVDRMObjectDescriptor) {",
          "new_line_content": "        av_log(hwfc, AV_LOG_ERROR, \"Failed to get buffer \"",
          "content_same": false
        },
        {
          "line": 1552,
          "old_api": null,
          "new_api": "vaErrorStr",
          "old_text": null,
          "new_text": "vaErrorStr(vas)",
          "old_line_content": "        // There is no way to get the format modifier with this API.",
          "new_line_content": "               vas, vaErrorStr(vas));",
          "content_same": false
        },
        {
          "line": 1553,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(EIO)",
          "old_line_content": "        .format_modifier = DRM_FORMAT_MOD_INVALID,",
          "new_line_content": "        err = AVERROR(EIO);",
          "content_same": false
        },
        {
          "line": 1557,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(hwfc, AV_LOG_DEBUG, \"DRM PRIME fd is %\"PRIdPTR\".\\n\",\n           mapping->buffer_info.handle)",
          "old_line_content": "                                dst, src, &vaapi_unmap_to_drm_abh,",
          "new_line_content": "    av_log(hwfc, AV_LOG_DEBUG, \"DRM PRIME fd is %\"PRIdPTR\".\\n\",",
          "content_same": false
        },
        {
          "line": 1049,
          "old_api": null,
          "new_api": "DRM_MAP",
          "old_text": null,
          "new_text": "DRM_MAP(P010, 2, DRM_FORMAT_R16, DRM_FORMAT_RG1616)",
          "old_line_content": "#endif",
          "new_line_content": "    DRM_MAP(P010, 2, DRM_FORMAT_R16, DRM_FORMAT_RG1616),",
          "content_same": false
        },
        {
          "line": 1052,
          "old_api": null,
          "new_api": "DRM_MAP",
          "old_text": null,
          "new_text": "DRM_MAP(P012, 2, DRM_FORMAT_R16, DRM_FORMAT_RG1616)",
          "old_line_content": "#if defined(VA_FOURCC_XYUV) && defined(DRM_FORMAT_XYUV8888)",
          "new_line_content": "    DRM_MAP(P012, 2, DRM_FORMAT_R16, DRM_FORMAT_RG1616),",
          "content_same": false
        },
        {
          "line": 1054,
          "old_api": null,
          "new_api": "DRM_MAP",
          "old_text": null,
          "new_text": "DRM_MAP(BGRA, 1, DRM_FORMAT_ARGB8888)",
          "old_line_content": "#endif",
          "new_line_content": "    DRM_MAP(BGRA, 1, DRM_FORMAT_ARGB8888),",
          "content_same": false
        },
        {
          "line": 1055,
          "old_api": null,
          "new_api": "DRM_MAP",
          "old_text": null,
          "new_text": "DRM_MAP(BGRX, 1, DRM_FORMAT_XRGB8888)",
          "old_line_content": "#if defined(VA_FOURCC_Y412) && defined(DRM_FORMAT_XVYU2101010)",
          "new_line_content": "    DRM_MAP(BGRX, 1, DRM_FORMAT_XRGB8888),",
          "content_same": false
        },
        {
          "line": 1568,
          "old_api": null,
          "new_api": "ff_hwframe_map_create",
          "old_text": null,
          "new_text": "ff_hwframe_map_create(src->hw_frames_ctx,\n                                dst, src, &vaapi_unmap_to_drm_abh,\n                                mapping)",
          "old_line_content": "fail_mapped:",
          "new_line_content": "    err = ff_hwframe_map_create(src->hw_frames_ctx,",
          "content_same": false
        },
        {
          "line": 1057,
          "old_api": null,
          "new_api": "DRM_MAP",
          "old_text": null,
          "new_text": "DRM_MAP(RGBX, 1, DRM_FORMAT_XBGR8888)",
          "old_line_content": "#endif",
          "new_line_content": "    DRM_MAP(RGBX, 1, DRM_FORMAT_XBGR8888),",
          "content_same": false
        },
        {
          "line": 1060,
          "old_api": null,
          "new_api": "DRM_MAP",
          "old_text": null,
          "new_text": "DRM_MAP(XBGR, 1, DRM_FORMAT_RGBX8888)",
          "old_line_content": "#endif",
          "new_line_content": "    DRM_MAP(XBGR, 1, DRM_FORMAT_RGBX8888),",
          "content_same": false
        },
        {
          "line": 1063,
          "old_api": null,
          "new_api": "DRM_MAP",
          "old_text": null,
          "new_text": "DRM_MAP(XRGB, 1, DRM_FORMAT_BGRX8888)",
          "old_line_content": "#endif",
          "new_line_content": "    DRM_MAP(XRGB, 1, DRM_FORMAT_BGRX8888),",
          "content_same": false
        },
        {
          "line": 1065,
          "old_api": null,
          "new_api": "DRM_MAP",
          "old_text": null,
          "new_text": "DRM_MAP(XYUV, 1, DRM_FORMAT_XYUV8888)",
          "old_line_content": "#undef DRM_MAP",
          "new_line_content": "    DRM_MAP(XYUV, 1, DRM_FORMAT_XYUV8888),",
          "content_same": false
        },
        {
          "line": 1068,
          "old_api": null,
          "new_api": "DRM_MAP",
          "old_text": null,
          "new_text": "DRM_MAP(Y410, 1, DRM_FORMAT_XVYU2101010)",
          "old_line_content": "                                 HWMapDescriptor *hwmap)",
          "new_line_content": "    DRM_MAP(Y410, 1, DRM_FORMAT_XVYU2101010),",
          "content_same": false
        },
        {
          "line": 1581,
          "old_api": null,
          "new_api": "vaReleaseBufferHandle",
          "old_text": null,
          "new_text": "vaReleaseBufferHandle(hwctx->display, mapping->image.buf)",
          "old_line_content": "#if VA_CHECK_VERSION(1, 1, 0)",
          "new_line_content": "    vaReleaseBufferHandle(hwctx->display, mapping->image.buf);",
          "content_same": false
        },
        {
          "line": 1071,
          "old_api": null,
          "new_api": "DRM_MAP",
          "old_text": null,
          "new_text": "DRM_MAP(Y412, 1, DRM_FORMAT_XVYU12_16161616)",
          "old_line_content": "",
          "new_line_content": "    DRM_MAP(Y412, 1, DRM_FORMAT_XVYU12_16161616),",
          "content_same": false
        },
        {
          "line": 1585,
          "old_api": null,
          "new_api": "av_freep",
          "old_text": null,
          "new_text": "av_freep(&mapping)",
          "old_line_content": "        return err;",
          "new_line_content": "    av_freep(&mapping);",
          "content_same": false
        },
        {
          "line": 1595,
          "old_api": null,
          "new_api": "vaapi_map_to_drm_esh",
          "old_text": null,
          "new_text": "vaapi_map_to_drm_esh(hwfc, dst, src, flags)",
          "old_line_content": "static int vaapi_map_to(AVHWFramesContext *hwfc, AVFrame *dst,",
          "new_line_content": "    err = vaapi_map_to_drm_esh(hwfc, dst, src, flags);",
          "content_same": false
        },
        {
          "line": 1596,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(ENOSYS)",
          "old_line_content": "                        const AVFrame *src, int flags)",
          "new_line_content": "    if (err != AVERROR(ENOSYS))",
          "content_same": false
        },
        {
          "line": 1086,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(dst_fc, AV_LOG_DEBUG, \"Destroy surface %#x.\\n\", surface_id)",
          "old_line_content": "    int k;",
          "new_line_content": "    av_log(dst_fc, AV_LOG_DEBUG, \"Destroy surface %#x.\\n\", surface_id);",
          "content_same": false
        },
        {
          "line": 1088,
          "old_api": null,
          "new_api": "vaDestroySurfaces",
          "old_text": null,
          "new_text": "vaDestroySurfaces(dst_dev->display, &surface_id, 1)",
          "old_line_content": "    AVHWFramesContext      *dst_fc =",
          "new_line_content": "    vaDestroySurfaces(dst_dev->display, &surface_id, 1);",
          "content_same": false
        },
        {
          "line": 1600,
          "old_api": null,
          "new_api": "vaapi_map_to_drm_abh",
          "old_text": null,
          "new_text": "vaapi_map_to_drm_abh(hwfc, dst, src, flags)",
          "old_line_content": "    case AV_PIX_FMT_DRM_PRIME:",
          "new_line_content": "    return vaapi_map_to_drm_abh(hwfc, dst, src, flags);",
          "content_same": false
        },
        {
          "line": 1602,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(ENOSYS)",
          "old_line_content": "#endif",
          "new_line_content": "    return AVERROR(ENOSYS);",
          "content_same": false
        },
        {
          "line": 1613,
          "old_api": null,
          "new_api": "vaapi_map_from_drm",
          "old_text": null,
          "new_text": "vaapi_map_from_drm(hwfc, dst, src, flags)",
          "old_line_content": "    case AV_PIX_FMT_DRM_PRIME:",
          "new_line_content": "        return vaapi_map_from_drm(hwfc, dst, src, flags);",
          "content_same": false
        },
        {
          "line": 1616,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(ENOSYS)",
          "old_line_content": "    default:",
          "new_line_content": "        return AVERROR(ENOSYS);",
          "content_same": false
        },
        {
          "line": 1626,
          "old_api": null,
          "new_api": "vaapi_map_to_drm",
          "old_text": null,
          "new_text": "vaapi_map_to_drm(hwfc, dst, src, flags)",
          "old_line_content": "    if (hwctx->display)",
          "new_line_content": "        return vaapi_map_to_drm(hwfc, dst, src, flags);",
          "content_same": false
        },
        {
          "line": 1629,
          "old_api": null,
          "new_api": "vaapi_map_to_memory",
          "old_text": null,
          "new_text": "vaapi_map_to_memory(hwfc, dst, src, flags)",
          "old_line_content": "#if HAVE_VAAPI_X11",
          "new_line_content": "        return vaapi_map_to_memory(hwfc, dst, src, flags);",
          "content_same": false
        },
        {
          "line": 1639,
          "old_api": null,
          "new_api": "vaTerminate",
          "old_text": null,
          "new_text": "vaTerminate(hwctx->display)",
          "old_line_content": "",
          "new_line_content": "        vaTerminate(hwctx->display);",
          "content_same": false
        },
        {
          "line": 1643,
          "old_api": null,
          "new_api": "XCloseDisplay",
          "old_text": null,
          "new_text": "XCloseDisplay(priv->x11_display)",
          "old_line_content": "    AVHWDeviceContext *ctx = context;",
          "new_line_content": "        XCloseDisplay(priv->x11_display);",
          "content_same": false
        },
        {
          "line": 1132,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(dst_fc, AV_LOG_ERROR, \"VAAPI can only map frames \"\n               \"made from a single DRM object.\\n\")",
          "old_line_content": "                break;",
          "new_line_content": "        av_log(dst_fc, AV_LOG_ERROR, \"VAAPI can only map frames \"",
          "content_same": false
        },
        {
          "line": 1134,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(EINVAL)",
          "old_line_content": "        if (j != desc->nb_layers)",
          "new_line_content": "        return AVERROR(EINVAL);",
          "content_same": false
        },
        {
          "line": 1647,
          "old_api": null,
          "new_api": "close",
          "old_text": null,
          "new_text": "close(priv->drm_fd)",
          "old_line_content": "",
          "new_line_content": "        close(priv->drm_fd);",
          "content_same": false
        },
        {
          "line": 1649,
          "old_api": null,
          "new_api": "av_freep",
          "old_text": null,
          "new_text": "av_freep(&priv)",
          "old_line_content": "{",
          "new_line_content": "    av_freep(&priv);",
          "content_same": false
        },
        {
          "line": 1138,
          "old_api": null,
          "new_api": "FF_ARRAY_ELEMS",
          "old_text": null,
          "new_text": "FF_ARRAY_ELEMS(vaapi_drm_format_map)",
          "old_line_content": "    }",
          "new_line_content": "    for (i = 0; i < FF_ARRAY_ELEMS(vaapi_drm_format_map); i++) {",
          "content_same": false
        },
        {
          "line": 1657,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(ctx, AV_LOG_ERROR, \"libva: %s\", message)",
          "old_line_content": "                                VADisplay display)",
          "new_line_content": "    av_log(ctx, AV_LOG_ERROR, \"libva: %s\", message);",
          "content_same": false
        },
        {
          "line": 1152,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(dst_fc, AV_LOG_ERROR, \"DRM format not supported \"\n               \"by VAAPI.\\n\")",
          "old_line_content": "    use_prime2 = !src_vafc->prime_2_import_unsupported &&",
          "new_line_content": "        av_log(dst_fc, AV_LOG_ERROR, \"DRM format not supported \"",
          "content_same": false
        },
        {
          "line": 1154,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(EINVAL)",
          "old_line_content": "    if (use_prime2) {",
          "new_line_content": "        return AVERROR(EINVAL);",
          "content_same": false
        },
        {
          "line": 1157,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(dst_fc, AV_LOG_DEBUG, \"Map DRM object %d to VAAPI as \"\n           \"%08x.\\n\", desc->objects[0].fd, va_fourcc)",
          "old_line_content": "            {",
          "new_line_content": "    av_log(dst_fc, AV_LOG_DEBUG, \"Map DRM object %d to VAAPI as \"",
          "content_same": false
        },
        {
          "line": 1160,
          "old_api": null,
          "new_api": "vaapi_format_from_fourcc",
          "old_text": null,
          "new_text": "vaapi_format_from_fourcc(va_fourcc)",
          "old_line_content": "                .value.type    = VAGenericValueTypeInteger,",
          "new_line_content": "    format_desc = vaapi_format_from_fourcc(va_fourcc);",
          "content_same": false
        },
        {
          "line": 1161,
          "old_api": null,
          "new_api": "av_assert0",
          "old_text": null,
          "new_text": "av_assert0(format_desc)",
          "old_line_content": "                .value.value.i = VA_SURFACE_ATTRIB_MEM_TYPE_DRM_PRIME_2,",
          "new_line_content": "    av_assert0(format_desc);",
          "content_same": false
        },
        {
          "line": 1677,
          "old_api": null,
          "new_api": "vaSetInfoCallback (display, &vaapi_device_log_info,  ctx)",
          "old_text": null,
          "new_text": "vaSetInfoCallback (display, &vaapi_device_log_info,  ctx)",
          "old_line_content": "           \"version %d.%d\\n\", major, minor);",
          "new_line_content": "    vaSetInfoCallback (display, &vaapi_device_log_info,  ctx);",
          "content_same": false
        },
        {
          "line": 1682,
          "old_api": null,
          "new_api": "vaInitialize",
          "old_text": null,
          "new_text": "vaInitialize(display, &major, &minor)",
          "old_line_content": "static int vaapi_device_create(AVHWDeviceContext *ctx, const char *device,",
          "new_line_content": "    vas = vaInitialize(display, &major, &minor);",
          "content_same": false
        },
        {
          "line": 1684,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(ctx, AV_LOG_ERROR, \"Failed to initialise VAAPI \"\n               \"connection: %d (%s).\\n\", vas, vaErrorStr(vas))",
          "old_line_content": "{",
          "new_line_content": "        av_log(ctx, AV_LOG_ERROR, \"Failed to initialise VAAPI \"",
          "content_same": false
        },
        {
          "line": 1685,
          "old_api": null,
          "new_api": "vaErrorStr",
          "old_text": null,
          "new_text": "vaErrorStr(vas)",
          "old_line_content": "    VAAPIDevicePriv *priv;",
          "new_line_content": "               \"connection: %d (%s).\\n\", vas, vaErrorStr(vas));",
          "content_same": false
        },
        {
          "line": 1686,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(EIO)",
          "old_line_content": "    VADisplay display = NULL;",
          "new_line_content": "        return AVERROR(EIO);",
          "content_same": false
        },
        {
          "line": 1688,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(ctx, AV_LOG_VERBOSE, \"Initialised VAAPI connection: \"\n           \"version %d.%d\\n\", major, minor)",
          "old_line_content": "    int try_drm, try_x11, try_win32, try_all;",
          "new_line_content": "    av_log(ctx, AV_LOG_VERBOSE, \"Initialised VAAPI connection: \"",
          "content_same": false
        },
        {
          "line": 1714,
          "old_api": null,
          "new_api": "strcmp",
          "old_text": null,
          "new_text": "strcmp(ent->value, \"drm\")",
          "old_line_content": "        try_all = 1;",
          "new_line_content": "        if (!strcmp(ent->value, \"drm\")) {",
          "content_same": false
        },
        {
          "line": 1716,
          "old_api": null,
          "new_api": "strcmp",
          "old_text": null,
          "new_text": "strcmp(ent->value, \"x11\")",
          "old_line_content": "        try_x11 = HAVE_VAAPI_X11;",
          "new_line_content": "        } else if (!strcmp(ent->value, \"x11\")) {",
          "content_same": false
        },
        {
          "line": 1718,
          "old_api": null,
          "new_api": "strcmp",
          "old_text": null,
          "new_text": "strcmp(ent->value, \"win32\")",
          "old_line_content": "    }",
          "new_line_content": "        } else if (!strcmp(ent->value, \"win32\")) {",
          "content_same": false
        },
        {
          "line": 1721,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(ctx, AV_LOG_ERROR, \"Invalid connection type %s.\\n\",\n                   ent->value)",
          "old_line_content": "    while (!display && try_drm) {",
          "new_line_content": "            av_log(ctx, AV_LOG_ERROR, \"Invalid connection type %s.\\n\",",
          "content_same": false
        },
        {
          "line": 1723,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(EINVAL)",
          "old_line_content": "        // If not, look for a usable render node, possibly restricted to those",
          "new_line_content": "            return AVERROR(EINVAL);",
          "content_same": false
        },
        {
          "line": 1219,
          "old_api": null,
          "new_api": "vaCreateSurfaces",
          "old_text": null,
          "new_text": "vaCreateSurfaces(dst_dev->display, format_desc->rt_format,\n                               src->width, src->height, &surface_id, 1,\n                               prime_attrs, FF_ARRAY_ELEMS(prime_attrs))",
          "old_line_content": "            {",
          "new_line_content": "        vas = vaCreateSurfaces(dst_dev->display, format_desc->rt_format,",
          "content_same": false
        },
        {
          "line": 1221,
          "old_api": null,
          "new_api": "FF_ARRAY_ELEMS",
          "old_text": null,
          "new_text": "FF_ARRAY_ELEMS(prime_attrs)",
          "old_line_content": "                .flags = VA_SURFACE_ATTRIB_SETTABLE,",
          "new_line_content": "                               prime_attrs, FF_ARRAY_ELEMS(prime_attrs));",
          "content_same": false
        },
        {
          "line": 1741,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(ctx, loglevel, \"Failed to open %s as \"\n                       \"DRM device node.\\n\", device)",
          "old_line_content": "            for (n = 0; n < max_devices; n++) {",
          "new_line_content": "                av_log(ctx, loglevel, \"Failed to open %s as \"",
          "content_same": false
        },
        {
          "line": 1751,
          "old_api": null,
          "new_api": "av_dict_get",
          "old_text": null,
          "new_text": "av_dict_get(opts, \"kernel_driver\", NULL, 0)",
          "old_line_content": "                            continue;",
          "new_line_content": "            kernel_driver = av_dict_get(opts, \"kernel_driver\", NULL, 0);",
          "content_same": false
        },
        {
          "line": 1756,
          "old_api": null,
          "new_api": "open",
          "old_text": null,
          "new_text": "open(path, O_RDWR)",
          "old_line_content": "                    } else",
          "new_line_content": "                priv->drm_fd = open(path, O_RDWR);",
          "content_same": false
        },
        {
          "line": 1760,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(ctx, AV_LOG_VERBOSE,\n                                   \"No render device %s, try next device for \"\n                                   \"DRM render node.\\n\", path)",
          "old_line_content": "                }",
          "new_line_content": "                            av_log(ctx, AV_LOG_VERBOSE,",
          "content_same": false
        },
        {
          "line": 1769,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(ctx, AV_LOG_VERBOSE, \"Cannot open \"\n                               \"DRM render node for device %d.\\n\", n)",
          "old_line_content": "                }",
          "new_line_content": "                        av_log(ctx, AV_LOG_VERBOSE, \"Cannot open \"",
          "content_same": false
        },
        {
          "line": 1774,
          "old_api": null,
          "new_api": "drmGetVersion",
          "old_text": null,
          "new_text": "drmGetVersion(priv->drm_fd)",
          "old_line_content": "                               n, info->name);",
          "new_line_content": "                info = drmGetVersion(priv->drm_fd);",
          "content_same": false
        },
        {
          "line": 1778,
          "old_api": null,
          "new_api": "close",
          "old_text": null,
          "new_text": "close(priv->drm_fd)",
          "old_line_content": "                        continue;",
          "new_line_content": "                    close(priv->drm_fd);",
          "content_same": false
        },
        {
          "line": 1270,
          "old_api": null,
          "new_api": "vaCreateSurfaces",
          "old_text": null,
          "new_text": "vaCreateSurfaces(dst_dev->display, format_desc->rt_format,\n                               src->width, src->height,\n                               &surface_id, 1,\n                               buffer_attrs, FF_ARRAY_ELEMS(buffer_attrs))",
          "old_line_content": "    buffer_desc.num_buffers  = 1;",
          "new_line_content": "        vas = vaCreateSurfaces(dst_dev->display, format_desc->rt_format,",
          "content_same": false
        },
        {
          "line": 1783,
          "old_api": null,
          "new_api": "strcmp",
          "old_text": null,
          "new_text": "strcmp(kernel_driver->value, info->name)",
          "old_line_content": "                           n, info->name);",
          "new_line_content": "                    if (strcmp(kernel_driver->value, info->name)) {",
          "content_same": false
        },
        {
          "line": 1273,
          "old_api": null,
          "new_api": "FF_ARRAY_ELEMS",
          "old_text": null,
          "new_text": "FF_ARRAY_ELEMS(buffer_attrs)",
          "old_line_content": "    k = 0;",
          "new_line_content": "                               buffer_attrs, FF_ARRAY_ELEMS(buffer_attrs));",
          "content_same": false
        },
        {
          "line": 1792,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(ctx, AV_LOG_VERBOSE, \"Trying to use \"\n                           \"DRM render node for device %d, \"\n                           \"with matching kernel driver (%s).\\n\",\n                           n, info->name)",
          "old_line_content": "                    priv->drm_fd = -1;",
          "new_line_content": "                    av_log(ctx, AV_LOG_VERBOSE, \"Trying to use \"",
          "content_same": false
        },
        {
          "line": 1796,
          "old_api": null,
          "new_api": "drmFreeVersion",
          "old_text": null,
          "new_text": "drmFreeVersion(info)",
          "old_line_content": "#endif",
          "new_line_content": "                    drmFreeVersion(info);",
          "content_same": false
        },
        {
          "line": 1799,
          "old_api": null,
          "new_api": "strcmp",
          "old_text": null,
          "new_text": "strcmp(info->name, \"vgem\")",
          "old_line_content": "                break;",
          "new_line_content": "                } else if (!strcmp(info->name, \"vgem\")) {",
          "content_same": false
        },
        {
          "line": 1800,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(ctx, AV_LOG_VERBOSE,\n                           \"Skipping vgem node for device %d.\\n\", n)",
          "old_line_content": "            }",
          "new_line_content": "                    av_log(ctx, AV_LOG_VERBOSE,",
          "content_same": false
        },
        {
          "line": 1802,
          "old_api": null,
          "new_api": "drmFreeVersion",
          "old_text": null,
          "new_text": "drmFreeVersion(info)",
          "old_line_content": "                break;",
          "new_line_content": "                    drmFreeVersion(info);",
          "content_same": false
        },
        {
          "line": 1803,
          "old_api": null,
          "new_api": "close",
          "old_text": null,
          "new_text": "close(priv->drm_fd)",
          "old_line_content": "        }",
          "new_line_content": "                    close(priv->drm_fd);",
          "content_same": false
        },
        {
          "line": 1809,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(ctx, AV_LOG_VERBOSE, \"Trying to use \"\n                       \"DRM render node for device %d.\\n\", n)",
          "old_line_content": "            return AVERROR_EXTERNAL;",
          "new_line_content": "                av_log(ctx, AV_LOG_VERBOSE, \"Trying to use \"",
          "content_same": false
        },
        {
          "line": 1304,
          "old_api": null,
          "new_api": "FF_ARRAY_ELEMS",
          "old_text": null,
          "new_text": "FF_ARRAY_ELEMS(attrs)",
          "old_line_content": "    if (err < 0)",
          "new_line_content": "                           attrs, FF_ARRAY_ELEMS(attrs));",
          "content_same": false
        },
        {
          "line": 1817,
          "old_api": null,
          "new_api": "vaGetDisplayDRM",
          "old_text": null,
          "new_text": "vaGetDisplayDRM(priv->drm_fd)",
          "old_line_content": "        // Try to open the device as an X11 display.",
          "new_line_content": "        display = vaGetDisplayDRM(priv->drm_fd);",
          "content_same": false
        },
        {
          "line": 1307,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(dst_fc, AV_LOG_ERROR, \"Failed to create surface from DRM \"\n               \"object: %d (%s).\\n\", vas, vaErrorStr(vas))",
          "old_line_content": "    dst->width   = src->width;",
          "new_line_content": "        av_log(dst_fc, AV_LOG_ERROR, \"Failed to create surface from DRM \"",
          "content_same": false
        },
        {
          "line": 1308,
          "old_api": null,
          "new_api": "vaErrorStr",
          "old_text": null,
          "new_text": "vaErrorStr(vas)",
          "old_line_content": "    dst->height  = src->height;",
          "new_line_content": "               \"object: %d (%s).\\n\", vas, vaErrorStr(vas));",
          "content_same": false
        },
        {
          "line": 1309,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(EIO)",
          "old_line_content": "    dst->data[3] = (uint8_t*)(uintptr_t)surface_id;",
          "new_line_content": "        return AVERROR(EIO);",
          "content_same": false
        },
        {
          "line": 1819,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(ctx, AV_LOG_VERBOSE, \"Cannot open a VA display \"\n                   \"from DRM device %s.\\n\", device)",
          "old_line_content": "        if (!priv->x11_display) {",
          "new_line_content": "            av_log(ctx, AV_LOG_VERBOSE, \"Cannot open a VA display \"",
          "content_same": false
        },
        {
          "line": 1313,
          "old_api": null,
          "new_api": "ff_hwframe_map_create",
          "old_text": null,
          "new_text": "ff_hwframe_map_create(dst->hw_frames_ctx, dst, src,\n                                &vaapi_unmap_from_drm,\n                                (void*)(uintptr_t)surface_id)",
          "old_line_content": "",
          "new_line_content": "    err = ff_hwframe_map_create(dst->hw_frames_ctx, dst, src,",
          "content_same": false
        },
        {
          "line": 1832,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(ctx, AV_LOG_VERBOSE, \"Cannot open X11 display \"\n                   \"%s.\\n\", XDisplayName(device))",
          "old_line_content": "        }",
          "new_line_content": "            av_log(ctx, AV_LOG_VERBOSE, \"Cannot open X11 display \"",
          "content_same": false
        },
        {
          "line": 1833,
          "old_api": null,
          "new_api": "XDisplayName",
          "old_text": null,
          "new_text": "XDisplayName(device)",
          "old_line_content": "    }",
          "new_line_content": "                   \"%s.\\n\", XDisplayName(device));",
          "content_same": false
        },
        {
          "line": 1323,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(dst_fc, AV_LOG_DEBUG, \"Mapped DRM object %d to \"\n           \"surface %#x.\\n\", desc->objects[0].fd, surface_id)",
          "old_line_content": "",
          "new_line_content": "    av_log(dst_fc, AV_LOG_DEBUG, \"Mapped DRM object %d to \"",
          "content_same": false
        },
        {
          "line": 1835,
          "old_api": null,
          "new_api": "vaGetDisplay",
          "old_text": null,
          "new_text": "vaGetDisplay(priv->x11_display)",
          "old_line_content": "",
          "new_line_content": "            display = vaGetDisplay(priv->x11_display);",
          "content_same": false
        },
        {
          "line": 1837,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(ctx, AV_LOG_ERROR, \"Cannot open a VA display \"\n                       \"from X11 display %s.\\n\", XDisplayName(device))",
          "old_line_content": "    if (!display && try_win32) {",
          "new_line_content": "                av_log(ctx, AV_LOG_ERROR, \"Cannot open a VA display \"",
          "content_same": false
        },
        {
          "line": 1838,
          "old_api": null,
          "new_api": "XDisplayName",
          "old_text": null,
          "new_text": "XDisplayName(device)",
          "old_line_content": "        // Try to create a display from the specified device, if any.",
          "new_line_content": "                       \"from X11 display %s.\\n\", XDisplayName(device));",
          "content_same": false
        },
        {
          "line": 817,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(hwfc, AV_LOG_DEBUG, \"Map surface %#x.\\n\", surface_id)",
          "old_line_content": "        // Requested direct mapping but it is not possible.",
          "new_line_content": "    av_log(hwfc, AV_LOG_DEBUG, \"Map surface %#x.\\n\", surface_id);",
          "content_same": false
        },
        {
          "line": 1842,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(ctx, AV_LOG_VERBOSE, \"Opened VA display via \"\n                   \"X11 display %s.\\n\", XDisplayName(device))",
          "old_line_content": "            IDXGIFactory2 *pDXGIFactory = NULL;",
          "new_line_content": "            av_log(ctx, AV_LOG_VERBOSE, \"Opened VA display via \"",
          "content_same": false
        },
        {
          "line": 1843,
          "old_api": null,
          "new_api": "XDisplayName",
          "old_text": null,
          "new_text": "XDisplayName(device)",
          "old_line_content": "            IDXGIAdapter *pAdapter = NULL;",
          "new_line_content": "                   \"X11 display %s.\\n\", XDisplayName(device));",
          "content_same": false
        },
        {
          "line": 821,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(EINVAL)",
          "old_line_content": "        dst->format = hwfc->sw_format;",
          "new_line_content": "        return AVERROR(EINVAL);",
          "content_same": false
        },
        {
          "line": 1337,
          "old_api": null,
          "new_api": "close",
          "old_text": null,
          "new_text": "close(drm_desc->objects[i].fd)",
          "old_line_content": "    AVDRMFrameDescriptor *drm_desc = NULL;",
          "new_line_content": "        close(drm_desc->objects[i].fd);",
          "content_same": false
        },
        {
          "line": 1339,
          "old_api": null,
          "new_api": "av_freep",
          "old_text": null,
          "new_text": "av_freep(&drm_desc)",
          "old_line_content": "    int err, i, j;",
          "new_line_content": "    av_freep(&drm_desc);",
          "content_same": false
        },
        {
          "line": 1852,
          "old_api": null,
          "new_api": "vaGetDisplayWin32",
          "old_text": null,
          "new_text": "vaGetDisplayWin32(NULL)",
          "old_line_content": "            if (!pfnCreateDXGIFactory) {",
          "new_line_content": "            display = vaGetDisplayWin32(NULL);",
          "content_same": false
        },
        {
          "line": 830,
          "old_api": null,
          "new_api": "vaapi_get_image_format",
          "old_text": null,
          "new_text": "vaapi_get_image_format(hwfc->device_ctx, dst->format, &image_format)",
          "old_line_content": "        return err;",
          "new_line_content": "    err = vaapi_get_image_format(hwfc->device_ctx, dst->format, &image_format);",
          "content_same": false
        },
        {
          "line": 1857,
          "old_api": null,
          "new_api": "dlopen",
          "old_text": null,
          "new_text": "dlopen(\"dxgi.dll\", 0)",
          "old_line_content": "#else",
          "new_line_content": "            HANDLE dxgi = dlopen(\"dxgi.dll\", 0);",
          "content_same": false
        },
        {
          "line": 1859,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(ctx, AV_LOG_ERROR, \"Failed to load dxgi.dll\\n\")",
          "old_line_content": "            // available, only CreateDXGIFactory1",
          "new_line_content": "                av_log(ctx, AV_LOG_ERROR, \"Failed to load dxgi.dll\\n\");",
          "content_same": false
        },
        {
          "line": 836,
          "old_api": null,
          "new_api": "av_malloc",
          "old_text": null,
          "new_text": "av_malloc(sizeof(*map))",
          "old_line_content": "    map->flags = flags;",
          "new_line_content": "    map = av_malloc(sizeof(*map));",
          "content_same": false
        },
        {
          "line": 838,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(ENOMEM)",
          "old_line_content": "",
          "new_line_content": "        return AVERROR(ENOMEM);",
          "content_same": false
        },
        {
          "line": 844,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(hwfc, AV_LOG_ERROR, \"Failed to sync surface \"\n               \"%#x: %d (%s).\\n\", surface_id, vas, vaErrorStr(vas))",
          "old_line_content": "        goto fail;",
          "new_line_content": "        av_log(hwfc, AV_LOG_ERROR, \"Failed to sync surface \"",
          "content_same": false
        },
        {
          "line": 845,
          "old_api": null,
          "new_api": "vaErrorStr",
          "old_text": null,
          "new_text": "vaErrorStr(vas)",
          "old_line_content": "    }",
          "new_line_content": "               \"%#x: %d (%s).\\n\", surface_id, vas, vaErrorStr(vas));",
          "content_same": false
        },
        {
          "line": 846,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(EIO)",
          "old_line_content": "",
          "new_line_content": "        err = AVERROR(EIO);",
          "content_same": false
        },
        {
          "line": 1359,
          "old_api": null,
          "new_api": "vaSyncSurface",
          "old_text": null,
          "new_text": "vaSyncSurface(hwctx->display, surface_id)",
          "old_line_content": "                                VA_SURFACE_ATTRIB_MEM_TYPE_DRM_PRIME_2,",
          "new_line_content": "        vas = vaSyncSurface(hwctx->display, surface_id);",
          "content_same": false
        },
        {
          "line": 1361,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(hwfc, AV_LOG_ERROR, \"Failed to sync surface \"\n                   \"%#x: %d (%s).\\n\", surface_id, vas, vaErrorStr(vas))",
          "old_line_content": "    if (vas != VA_STATUS_SUCCESS) {",
          "new_line_content": "            av_log(hwfc, AV_LOG_ERROR, \"Failed to sync surface \"",
          "content_same": false
        },
        {
          "line": 1362,
          "old_api": null,
          "new_api": "vaErrorStr",
          "old_text": null,
          "new_text": "vaErrorStr(vas)",
          "old_line_content": "        if (vas == VA_STATUS_ERROR_UNIMPLEMENTED)",
          "new_line_content": "                   \"%#x: %d (%s).\\n\", surface_id, vas, vaErrorStr(vas));",
          "content_same": false
        },
        {
          "line": 1875,
          "old_api": null,
          "new_api": "pfnCreateDXGIFactory",
          "old_text": null,
          "new_text": "pfnCreateDXGIFactory(&IID_IDXGIFactory2,\n                                              (void **)&pDXGIFactory)",
          "old_line_content": "                              desc.AdapterLuid.HighPart);",
          "new_line_content": "            if (SUCCEEDED(pfnCreateDXGIFactory(&IID_IDXGIFactory2,",
          "content_same": false
        },
        {
          "line": 1877,
          "old_api": null,
          "new_api": "atoi",
          "old_text": null,
          "new_text": "atoi(device)",
          "old_line_content": "                    }",
          "new_line_content": "                int adapter = atoi(device);",
          "content_same": false
        },
        {
          "line": 1370,
          "old_api": null,
          "new_api": "vaExportSurfaceHandle",
          "old_text": null,
          "new_text": "vaExportSurfaceHandle(hwctx->display, surface_id,\n                                VA_SURFACE_ATTRIB_MEM_TYPE_DRM_PRIME_2,\n                                export_flags, &va_desc)",
          "old_line_content": "    if (!drm_desc) {",
          "new_line_content": "    vas = vaExportSurfaceHandle(hwctx->display, surface_id,",
          "content_same": false
        },
        {
          "line": 859,
          "old_api": null,
          "new_api": "vaDeriveImage",
          "old_text": null,
          "new_text": "vaDeriveImage(hwctx->display, surface_id, &map->image)",
          "old_line_content": "                   \"surface %#x: %d (%s).\\n\",",
          "new_line_content": "        vas = vaDeriveImage(hwctx->display, surface_id, &map->image);",
          "content_same": false
        },
        {
          "line": 1882,
          "old_api": null,
          "new_api": "IDXGIAdapter2_GetDesc",
          "old_text": null,
          "new_text": "IDXGIAdapter2_GetDesc(pAdapter, &desc)",
          "old_line_content": "#if !HAVE_UWP",
          "new_line_content": "                    if (SUCCEEDED(IDXGIAdapter2_GetDesc(pAdapter, &desc))) {",
          "content_same": false
        },
        {
          "line": 863,
          "old_api": null,
          "new_api": "vaErrorStr",
          "old_text": null,
          "new_text": "vaErrorStr(vas)",
          "old_line_content": "        }",
          "new_line_content": "                   surface_id, vas, vaErrorStr(vas));",
          "content_same": false
        },
        {
          "line": 864,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(EIO)",
          "old_line_content": "        if (map->image.format.fourcc != image_format->fourcc) {",
          "new_line_content": "            err = AVERROR(EIO);",
          "content_same": false
        },
        {
          "line": 1375,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(ENOSYS)",
          "old_line_content": "    // By some bizarre coincidence, these structures are very similar...",
          "new_line_content": "            return AVERROR(ENOSYS);",
          "content_same": false
        },
        {
          "line": 1376,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(hwfc, AV_LOG_ERROR, \"Failed to export surface %#x: \"\n               \"%d (%s).\\n\", surface_id, vas, vaErrorStr(vas))",
          "old_line_content": "    drm_desc->nb_objects = va_desc.num_objects;",
          "new_line_content": "        av_log(hwfc, AV_LOG_ERROR, \"Failed to export surface %#x: \"",
          "content_same": false
        },
        {
          "line": 1377,
          "old_api": null,
          "new_api": "vaErrorStr",
          "old_text": null,
          "new_text": "vaErrorStr(vas)",
          "old_line_content": "    for (i = 0; i < va_desc.num_objects; i++) {",
          "new_line_content": "               \"%d (%s).\\n\", surface_id, vas, vaErrorStr(vas));",
          "content_same": false
        },
        {
          "line": 1378,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(EIO)",
          "old_line_content": "        drm_desc->objects[i].fd   = va_desc.objects[i].fd;",
          "new_line_content": "        return AVERROR(EIO);",
          "content_same": false
        },
        {
          "line": 1381,
          "old_api": null,
          "new_api": "av_mallocz",
          "old_text": null,
          "new_text": "av_mallocz(sizeof(*drm_desc))",
          "old_line_content": "            va_desc.objects[i].drm_format_modifier;",
          "new_line_content": "    drm_desc = av_mallocz(sizeof(*drm_desc));",
          "content_same": false
        },
        {
          "line": 1890,
          "old_api": null,
          "new_api": "IDXGIAdapter_Release",
          "old_text": null,
          "new_text": "IDXGIAdapter_Release(pAdapter)",
          "old_line_content": "            return AVERROR_UNKNOWN;",
          "new_line_content": "                    IDXGIAdapter_Release(pAdapter);",
          "content_same": false
        },
        {
          "line": 871,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(EIO)",
          "old_line_content": "        map->flags |= AV_HWFRAME_MAP_DIRECT;",
          "new_line_content": "            err = AVERROR(EIO);",
          "content_same": false
        },
        {
          "line": 1383,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(ENOMEM)",
          "old_line_content": "    drm_desc->nb_layers = va_desc.num_layers;",
          "new_line_content": "        err = AVERROR(ENOMEM);",
          "content_same": false
        },
        {
          "line": 1892,
          "old_api": null,
          "new_api": "IDXGIFactory2_Release",
          "old_text": null,
          "new_text": "IDXGIFactory2_Release(pDXGIFactory)",
          "old_line_content": "",
          "new_line_content": "                IDXGIFactory2_Release(pDXGIFactory);",
          "content_same": false
        },
        {
          "line": 1895,
          "old_api": null,
          "new_api": "dlclose",
          "old_text": null,
          "new_text": "dlclose(dxgi)",
          "old_line_content": "    }",
          "new_line_content": "            dlclose(dxgi);",
          "content_same": false
        },
        {
          "line": 881,
          "old_api": null,
          "new_api": "vaErrorStr",
          "old_text": null,
          "new_text": "vaErrorStr(vas)",
          "old_line_content": "        }",
          "new_line_content": "                   surface_id, vas, vaErrorStr(vas));",
          "content_same": false
        },
        {
          "line": 882,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(EIO)",
          "old_line_content": "        if (!(flags & AV_HWFRAME_MAP_OVERWRITE)) {",
          "new_line_content": "            err = AVERROR(EIO);",
          "content_same": false
        },
        {
          "line": 891,
          "old_api": null,
          "new_api": "vaErrorStr",
          "old_text": null,
          "new_text": "vaErrorStr(vas)",
          "old_line_content": "            }",
          "new_line_content": "                       surface_id, vas, vaErrorStr(vas));",
          "content_same": false
        },
        {
          "line": 892,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(EIO)",
          "old_line_content": "        }",
          "new_line_content": "                err = AVERROR(EIO);",
          "content_same": false
        },
        {
          "line": 1917,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(EINVAL)",
          "old_line_content": "            return AVERROR_EXTERNAL;",
          "new_line_content": "        return AVERROR(EINVAL);",
          "content_same": false
        },
        {
          "line": 1409,
          "old_api": null,
          "new_api": "ff_hwframe_map_create",
          "old_text": null,
          "new_text": "ff_hwframe_map_create(src->hw_frames_ctx, dst, src,\n                                &vaapi_unmap_to_drm_esh, drm_desc)",
          "old_line_content": "    for (i = 0; i < va_desc.num_objects; i++)",
          "new_line_content": "    err = ff_hwframe_map_create(src->hw_frames_ctx, dst, src,",
          "content_same": false
        },
        {
          "line": 1924,
          "old_api": null,
          "new_api": "vaSetDriverName",
          "old_text": null,
          "new_text": "vaSetDriverName(display, ent->value)",
          "old_line_content": "",
          "new_line_content": "        vas = vaSetDriverName(display, ent->value);",
          "content_same": false
        },
        {
          "line": 1926,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(ctx, AV_LOG_ERROR, \"Failed to set driver name to \"\n                   \"%s: %d (%s).\\n\", ent->value, vas, vaErrorStr(vas))",
          "old_line_content": "}",
          "new_line_content": "            av_log(ctx, AV_LOG_ERROR, \"Failed to set driver name to \"",
          "content_same": false
        },
        {
          "line": 1927,
          "old_api": null,
          "new_api": "vaErrorStr",
          "old_text": null,
          "new_text": "vaErrorStr(vas)",
          "old_line_content": "",
          "new_line_content": "                   \"%s: %d (%s).\\n\", ent->value, vas, vaErrorStr(vas));",
          "content_same": false
        },
        {
          "line": 904,
          "old_api": null,
          "new_api": "vaMapBuffer2",
          "old_text": null,
          "new_text": "vaMapBuffer2(hwctx->display, map->image.buf, &address, vaflags)",
          "old_line_content": "                                dst, src, &vaapi_unmap_frame, map);",
          "new_line_content": "    vas = vaMapBuffer2(hwctx->display, map->image.buf, &address, vaflags);",
          "content_same": false
        },
        {
          "line": 1928,
          "old_api": null,
          "new_api": "vaTerminate",
          "old_text": null,
          "new_text": "vaTerminate(display)",
          "old_line_content": "static int vaapi_device_derive(AVHWDeviceContext *ctx,",
          "new_line_content": "            vaTerminate(display);",
          "content_same": false
        },
        {
          "line": 906,
          "old_api": null,
          "new_api": "vaMapBuffer",
          "old_text": null,
          "new_text": "vaMapBuffer(hwctx->display, map->image.buf, &address)",
          "old_line_content": "        goto fail;",
          "new_line_content": "    vas = vaMapBuffer(hwctx->display, map->image.buf, &address);",
          "content_same": false
        },
        {
          "line": 1932,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(ctx, AV_LOG_WARNING, \"Driver name setting is not \"\n               \"supported with this VAAPI version.\\n\")",
          "old_line_content": "#if HAVE_VAAPI_DRM",
          "new_line_content": "        av_log(ctx, AV_LOG_WARNING, \"Driver name setting is not \"",
          "content_same": false
        },
        {
          "line": 909,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(hwfc, AV_LOG_ERROR, \"Failed to map image from surface \"\n               \"%#x: %d (%s).\\n\", surface_id, vas, vaErrorStr(vas))",
          "old_line_content": "    dst->height = src->height;",
          "new_line_content": "        av_log(hwfc, AV_LOG_ERROR, \"Failed to map image from surface \"",
          "content_same": false
        },
        {
          "line": 910,
          "old_api": null,
          "new_api": "vaErrorStr",
          "old_text": null,
          "new_text": "vaErrorStr(vas)",
          "old_line_content": "",
          "new_line_content": "               \"%#x: %d (%s).\\n\", surface_id, vas, vaErrorStr(vas));",
          "content_same": false
        },
        {
          "line": 911,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(EIO)",
          "old_line_content": "    for (i = 0; i < map->image.num_planes; i++) {",
          "new_line_content": "        err = AVERROR(EIO);",
          "content_same": false
        },
        {
          "line": 1422,
          "old_api": null,
          "new_api": "close",
          "old_text": null,
          "new_text": "close(va_desc.objects[i].fd)",
          "old_line_content": "} VAAPIDRMImageBufferMapping;",
          "new_line_content": "        close(va_desc.objects[i].fd);",
          "content_same": false
        },
        {
          "line": 1423,
          "old_api": null,
          "new_api": "av_freep",
          "old_text": null,
          "new_text": "av_freep(&drm_desc)",
          "old_line_content": "",
          "new_line_content": "    av_freep(&drm_desc);",
          "content_same": false
        },
        {
          "line": 1937,
          "old_api": null,
          "new_api": "vaapi_device_connect",
          "old_text": null,
          "new_text": "vaapi_device_connect(ctx, display)",
          "old_line_content": "        int fd;",
          "new_line_content": "    return vaapi_device_connect(ctx, display);",
          "content_same": false
        },
        {
          "line": 915,
          "old_api": null,
          "new_api": "ff_hwframe_map_create",
          "old_text": null,
          "new_text": "ff_hwframe_map_create(src->hw_frames_ctx,\n                                dst, src, &vaapi_unmap_frame, map)",
          "old_line_content": "",
          "new_line_content": "    err = ff_hwframe_map_create(src->hw_frames_ctx,",
          "content_same": false
        },
        {
          "line": 928,
          "old_api": null,
          "new_api": "vaapi_format_from_fourcc",
          "old_text": null,
          "new_text": "vaapi_format_from_fourcc(map->image.format.fourcc)",
          "old_line_content": "        if (map->image.image_id != VA_INVALID_ID)",
          "new_line_content": "    desc = vaapi_format_from_fourcc(map->image.format.fourcc);",
          "content_same": false
        },
        {
          "line": 1954,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(EINVAL)",
          "old_line_content": "            if (node_type == DRM_NODE_RENDER) {",
          "new_line_content": "            return AVERROR(EINVAL);",
          "content_same": false
        },
        {
          "line": 1445,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(hwfc, AV_LOG_DEBUG, \"Unmap VAAPI surface %#x from DRM.\\n\",\n           surface_id)",
          "old_line_content": "    }",
          "new_line_content": "    av_log(hwfc, AV_LOG_DEBUG, \"Unmap VAAPI surface %#x from DRM.\\n\",",
          "content_same": false
        },
        {
          "line": 1962,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(ctx, AV_LOG_ERROR, \"DRM instance fd does not appear \"\n                       \"to refer to a DRM device.\\n\")",
          "old_line_content": "                    fd = src_hwctx->fd;",
          "new_line_content": "                av_log(ctx, AV_LOG_ERROR, \"DRM instance fd does not appear \"",
          "content_same": false
        },
        {
          "line": 939,
          "old_api": null,
          "new_api": "vaUnmapBuffer",
          "old_text": null,
          "new_text": "vaUnmapBuffer(hwctx->display, map->image.buf)",
          "old_line_content": "    int err;",
          "new_line_content": "            vaUnmapBuffer(hwctx->display, map->image.buf);",
          "content_same": false
        },
        {
          "line": 941,
          "old_api": null,
          "new_api": "vaDestroyImage",
          "old_text": null,
          "new_text": "vaDestroyImage(hwctx->display, map->image.image_id)",
          "old_line_content": "    if (dst->width > hwfc->width || dst->height > hwfc->height)",
          "new_line_content": "            vaDestroyImage(hwctx->display, map->image.image_id);",
          "content_same": false
        },
        {
          "line": 1453,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(hwfc, AV_LOG_ERROR, \"Failed to release buffer \"\n               \"handle of image %#x (derived from surface %#x): \"\n               \"%d (%s).\\n\", mapping->image.buf, surface_id,\n               vas, vaErrorStr(vas))",
          "old_line_content": "",
          "new_line_content": "        av_log(hwfc, AV_LOG_ERROR, \"Failed to release buffer \"",
          "content_same": false
        },
        {
          "line": 1456,
          "old_api": null,
          "new_api": "vaErrorStr",
          "old_text": null,
          "new_text": "vaErrorStr(vas)",
          "old_line_content": "",
          "new_line_content": "               vas, vaErrorStr(vas));",
          "content_same": false
        },
        {
          "line": 1969,
          "old_api": null,
          "new_api": "drmGetRenderDeviceNameFromFd",
          "old_text": null,
          "new_text": "drmGetRenderDeviceNameFromFd(src_hwctx->fd)",
          "old_line_content": "                        fd = src_hwctx->fd;",
          "new_line_content": "                render_node = drmGetRenderDeviceNameFromFd(src_hwctx->fd);",
          "content_same": false
        },
        {
          "line": 1459,
          "old_api": null,
          "new_api": "vaDestroyImage",
          "old_text": null,
          "new_text": "vaDestroyImage(hwctx->display, mapping->image.image_id)",
          "old_line_content": "{",
          "new_line_content": "    vas = vaDestroyImage(hwctx->display, mapping->image.image_id);",
          "content_same": false
        },
        {
          "line": 1461,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(hwfc, AV_LOG_ERROR, \"Failed to destroy image \"\n               \"derived from surface %#x: %d (%s).\\n\",\n               surface_id, vas, vaErrorStr(vas))",
          "old_line_content": "    VAAPIDRMImageBufferMapping *mapping = NULL;",
          "new_line_content": "        av_log(hwfc, AV_LOG_ERROR, \"Failed to destroy image \"",
          "content_same": false
        },
        {
          "line": 1463,
          "old_api": null,
          "new_api": "vaErrorStr",
          "old_text": null,
          "new_text": "vaErrorStr(vas)",
          "old_line_content": "    VAStatus vas;",
          "new_line_content": "               surface_id, vas, vaErrorStr(vas));",
          "content_same": false
        },
        {
          "line": 1976,
          "old_api": null,
          "new_api": "open",
          "old_text": null,
          "new_text": "open(render_node, O_RDWR)",
          "old_line_content": "                }",
          "new_line_content": "                    fd = open(render_node, O_RDWR);",
          "content_same": false
        },
        {
          "line": 954,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(EINVAL)",
          "old_line_content": "    map->height = dst->height;",
          "new_line_content": "        return AVERROR(EINVAL);",
          "content_same": false
        },
        {
          "line": 1466,
          "old_api": null,
          "new_api": "av_free",
          "old_text": null,
          "new_text": "av_free(mapping)",
          "old_line_content": "    surface_id = (VASurfaceID)(uintptr_t)src->data[3];",
          "new_line_content": "    av_free(mapping);",
          "content_same": false
        },
        {
          "line": 1978,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(ctx, AV_LOG_VERBOSE, \"Using non-render node \"\n                               \"because the associated render node \"\n                               \"could not be opened.\\n\")",
          "old_line_content": "        }",
          "new_line_content": "                        av_log(ctx, AV_LOG_VERBOSE, \"Using non-render node \"",
          "content_same": false
        },
        {
          "line": 958,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(ENOMEM)",
          "old_line_content": "        goto fail;",
          "new_line_content": "        return AVERROR(ENOMEM);",
          "content_same": false
        },
        {
          "line": 961,
          "old_api": null,
          "new_api": "vaapi_map_frame",
          "old_text": null,
          "new_text": "vaapi_map_frame(hwfc, map, src, AV_HWFRAME_MAP_READ)",
          "old_line_content": "fail:",
          "new_line_content": "    err = vaapi_map_frame(hwfc, map, src, AV_HWFRAME_MAP_READ);",
          "content_same": false
        },
        {
          "line": 968,
          "old_api": null,
          "new_api": "av_frame_copy",
          "old_text": null,
          "new_text": "av_frame_copy(dst, map)",
          "old_line_content": "{",
          "new_line_content": "    err = av_frame_copy(dst, map);",
          "content_same": false
        },
        {
          "line": 1482,
          "old_api": null,
          "new_api": "av_mallocz",
          "old_text": null,
          "new_text": "av_mallocz(sizeof(*mapping))",
          "old_line_content": "    }",
          "new_line_content": "    mapping = av_mallocz(sizeof(*mapping));",
          "content_same": false
        },
        {
          "line": 1995,
          "old_api": null,
          "new_api": "av_mallocz",
          "old_text": null,
          "new_text": "av_mallocz(sizeof(*priv))",
          "old_line_content": "            priv->drm_fd = -1;",
          "new_line_content": "        priv = av_mallocz(sizeof(*priv));",
          "content_same": false
        },
        {
          "line": 974,
          "old_api": null,
          "new_api": "av_frame_free",
          "old_text": null,
          "new_text": "av_frame_free(&map)",
          "old_line_content": "",
          "new_line_content": "    av_frame_free(&map);",
          "content_same": false
        },
        {
          "line": 1486,
          "old_api": null,
          "new_api": "vaDeriveImage",
          "old_text": null,
          "new_text": "vaDeriveImage(hwctx->display, surface_id,\n                        &mapping->image)",
          "old_line_content": "            mapping->image.format.fourcc)",
          "new_line_content": "    vas = vaDeriveImage(hwctx->display, surface_id,",
          "content_same": false
        },
        {
          "line": 1999,
          "old_api": null,
          "new_api": "close",
          "old_text": null,
          "new_text": "close(fd)",
          "old_line_content": "",
          "new_line_content": "                close(fd);",
          "content_same": false
        },
        {
          "line": 2001,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(ENOMEM)",
          "old_line_content": "        ctx->free        = &vaapi_device_free;",
          "new_line_content": "            return AVERROR(ENOMEM);",
          "content_same": false
        },
        {
          "line": 1491,
          "old_api": null,
          "new_api": "vaErrorStr",
          "old_text": null,
          "new_text": "vaErrorStr(vas)",
          "old_line_content": "               \"VAAPI format %#x.\\n\", mapping->image.format.fourcc);",
          "new_line_content": "               surface_id, vas, vaErrorStr(vas));",
          "content_same": false
        },
        {
          "line": 1496,
          "old_api": null,
          "new_api": "FF_ARRAY_ELEMS",
          "old_text": null,
          "new_text": "FF_ARRAY_ELEMS(vaapi_drm_format_map)",
          "old_line_content": "    mapping->buffer_info.mem_type =",
          "new_line_content": "    for (i = 0; i < FF_ARRAY_ELEMS(vaapi_drm_format_map); i++) {",
          "content_same": false
        },
        {
          "line": 985,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(EINVAL)",
          "old_line_content": "    map->height = src->height;",
          "new_line_content": "        return AVERROR(EINVAL);",
          "content_same": false
        },
        {
          "line": 989,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(ENOMEM)",
          "old_line_content": "        goto fail;",
          "new_line_content": "        return AVERROR(ENOMEM);",
          "content_same": false
        },
        {
          "line": 1501,
          "old_api": null,
          "new_api": "FF_ARRAY_ELEMS",
          "old_text": null,
          "new_text": "FF_ARRAY_ELEMS(vaapi_drm_format_map)",
          "old_line_content": "    if (mapping->drm_desc.nb_layers > 1) {",
          "new_line_content": "    if (i >= FF_ARRAY_ELEMS(vaapi_drm_format_map)) {",
          "content_same": false
        },
        {
          "line": 1502,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(hwfc, AV_LOG_ERROR, \"No matching DRM format for \"\n               \"VAAPI format %#x.\\n\", mapping->image.format.fourcc)",
          "old_line_content": "        if (mapping->drm_desc.nb_layers != mapping->image.num_planes) {",
          "new_line_content": "        av_log(hwfc, AV_LOG_ERROR, \"No matching DRM format for \"",
          "content_same": false
        },
        {
          "line": 992,
          "old_api": null,
          "new_api": "vaapi_map_frame",
          "old_text": null,
          "new_text": "vaapi_map_frame(hwfc, map, dst, AV_HWFRAME_MAP_WRITE | AV_HWFRAME_MAP_OVERWRITE)",
          "old_line_content": "fail:",
          "new_line_content": "    err = vaapi_map_frame(hwfc, map, dst, AV_HWFRAME_MAP_WRITE | AV_HWFRAME_MAP_OVERWRITE);",
          "content_same": false
        },
        {
          "line": 1504,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(EINVAL)",
          "old_line_content": "                   \"expected format: got %d planes, but expected %d.\\n\",",
          "new_line_content": "        err = AVERROR(EINVAL);",
          "content_same": false
        },
        {
          "line": 2015,
          "old_api": null,
          "new_api": "vaGetDisplayDRM",
          "old_text": null,
          "new_text": "vaGetDisplayDRM(fd)",
          "old_line_content": "",
          "new_line_content": "        display = vaGetDisplayDRM(fd);",
          "content_same": false
        },
        {
          "line": 2017,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(ctx, AV_LOG_ERROR, \"Failed to open a VA display from \"\n                   \"DRM device.\\n\")",
          "old_line_content": "    .type                   = AV_HWDEVICE_TYPE_VAAPI,",
          "new_line_content": "            av_log(ctx, AV_LOG_ERROR, \"Failed to open a VA display from \"",
          "content_same": false
        },
        {
          "line": 2019,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(EIO)",
          "old_line_content": "",
          "new_line_content": "            return AVERROR(EIO);",
          "content_same": false
        },
        {
          "line": 2022,
          "old_api": null,
          "new_api": "vaapi_device_connect",
          "old_text": null,
          "new_text": "vaapi_device_connect(ctx, display)",
          "old_line_content": "    .frames_hwctx_size      = sizeof(VAAPIFramesContext),",
          "new_line_content": "        return vaapi_device_connect(ctx, display);",
          "content_same": false
        },
        {
          "line": 999,
          "old_api": null,
          "new_api": "av_frame_copy",
          "old_text": null,
          "new_text": "av_frame_copy(map, src)",
          "old_line_content": "{",
          "new_line_content": "    err = av_frame_copy(map, src);",
          "content_same": false
        },
        {
          "line": 2025,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(ENOSYS)",
          "old_line_content": "    .device_derive          = &vaapi_device_derive,",
          "new_line_content": "    return AVERROR(ENOSYS);",
          "content_same": false
        },
        {
          "line": 1515,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(hwfc, AV_LOG_ERROR, \"Image properties do not match \"\n                   \"expected format: got %d planes, but expected %d.\\n\",\n                   mapping->image.num_planes, mapping->drm_desc.nb_layers)",
          "old_line_content": "                    .object_index = 0,",
          "new_line_content": "            av_log(hwfc, AV_LOG_ERROR, \"Image properties do not match \"",
          "content_same": false
        },
        {
          "line": 1005,
          "old_api": null,
          "new_api": "av_frame_free",
          "old_text": null,
          "new_text": "av_frame_free(&map)",
          "old_line_content": "            return err;",
          "new_line_content": "    av_frame_free(&map);",
          "content_same": false
        },
        {
          "line": 1518,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(EINVAL)",
          "old_line_content": "                },",
          "new_line_content": "            err = AVERROR(EINVAL);",
          "content_same": false
        },
        {
          "line": 1015,
          "old_api": null,
          "new_api": "vaapi_get_image_format",
          "old_text": null,
          "new_text": "vaapi_get_image_format(hwfc->device_ctx, dst->format, NULL)",
          "old_line_content": "",
          "new_line_content": "        err = vaapi_get_image_format(hwfc->device_ctx, dst->format, NULL);",
          "content_same": false
        },
        {
          "line": 1020,
          "old_api": null,
          "new_api": "vaapi_map_frame",
          "old_text": null,
          "new_text": "vaapi_map_frame(hwfc, dst, src, flags)",
          "old_line_content": "",
          "new_line_content": "    err = vaapi_map_frame(hwfc, dst, src, flags);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 1537,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(hwfc, AV_LOG_ERROR, \"Failed to get buffer \"\n               \"handle from image %#x (derived from surface %#x): \"\n               \"%d (%s).\\n\", mapping->image.buf, surface_id,\n               vas, vaErrorStr(vas))",
          "new_text": null,
          "old_line_content": "        av_log(hwfc, AV_LOG_ERROR, \"Failed to get buffer \"",
          "new_line_content": "        for (p = 0; p < mapping->image.num_planes; p++) {",
          "content_same": false
        },
        {
          "line": 1540,
          "old_api": "vaErrorStr",
          "new_api": null,
          "old_text": "vaErrorStr(vas)",
          "new_text": null,
          "old_line_content": "               vas, vaErrorStr(vas));",
          "new_line_content": "                .offset       = mapping->image.offsets[p],",
          "content_same": false
        },
        {
          "line": 1541,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(EIO)",
          "new_text": null,
          "old_line_content": "        err = AVERROR(EIO);",
          "new_line_content": "                .pitch        = mapping->image.pitches[p],",
          "content_same": false
        },
        {
          "line": 1032,
          "old_api": "DRM_MAP",
          "new_api": null,
          "old_text": "DRM_MAP(NV12, 2, DRM_FORMAT_R8,  DRM_FORMAT_RG88)",
          "new_text": null,
          "old_line_content": "    DRM_MAP(NV12, 2, DRM_FORMAT_R8,  DRM_FORMAT_RG88),",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1033,
          "old_api": "DRM_MAP",
          "new_api": null,
          "old_text": "DRM_MAP(NV12, 2, DRM_FORMAT_R8,  DRM_FORMAT_GR88)",
          "new_text": null,
          "old_line_content": "    DRM_MAP(NV12, 2, DRM_FORMAT_R8,  DRM_FORMAT_GR88),",
          "new_line_content": "#define DRM_MAP(va, layers, ...) { \\",
          "content_same": false
        },
        {
          "line": 1545,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(hwfc, AV_LOG_DEBUG, \"DRM PRIME fd is %\"PRIdPTR\".\\n\",\n           mapping->buffer_info.handle)",
          "new_text": null,
          "old_line_content": "    av_log(hwfc, AV_LOG_DEBUG, \"DRM PRIME fd is %\"PRIdPTR\".\\n\",",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1035,
          "old_api": "DRM_MAP",
          "new_api": null,
          "old_text": "DRM_MAP(NV12, 1, DRM_FORMAT_NV12)",
          "new_text": null,
          "old_line_content": "    DRM_MAP(NV12, 1, DRM_FORMAT_NV12),",
          "new_line_content": "        layers, \\",
          "content_same": false
        },
        {
          "line": 1037,
          "old_api": "DRM_MAP",
          "new_api": null,
          "old_text": "DRM_MAP(P010, 2, DRM_FORMAT_R16, DRM_FORMAT_RG1616)",
          "new_text": null,
          "old_line_content": "    DRM_MAP(P010, 2, DRM_FORMAT_R16, DRM_FORMAT_RG1616),",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1040,
          "old_api": "DRM_MAP",
          "new_api": null,
          "old_text": "DRM_MAP(P012, 2, DRM_FORMAT_R16, DRM_FORMAT_RG1616)",
          "new_text": null,
          "old_line_content": "    DRM_MAP(P012, 2, DRM_FORMAT_R16, DRM_FORMAT_RG1616),",
          "new_line_content": "    int   nb_layer_formats;",
          "content_same": false
        },
        {
          "line": 1042,
          "old_api": "DRM_MAP",
          "new_api": null,
          "old_text": "DRM_MAP(BGRA, 1, DRM_FORMAT_ARGB8888)",
          "new_text": null,
          "old_line_content": "    DRM_MAP(BGRA, 1, DRM_FORMAT_ARGB8888),",
          "new_line_content": "} vaapi_drm_format_map[] = {",
          "content_same": false
        },
        {
          "line": 1043,
          "old_api": "DRM_MAP",
          "new_api": null,
          "old_text": "DRM_MAP(BGRX, 1, DRM_FORMAT_XRGB8888)",
          "new_text": null,
          "old_line_content": "    DRM_MAP(BGRX, 1, DRM_FORMAT_XRGB8888),",
          "new_line_content": "#ifdef DRM_FORMAT_R8",
          "content_same": false
        },
        {
          "line": 1556,
          "old_api": "ff_hwframe_map_create",
          "new_api": null,
          "old_text": "ff_hwframe_map_create(src->hw_frames_ctx,\n                                dst, src, &vaapi_unmap_to_drm_abh,\n                                mapping)",
          "new_text": null,
          "old_line_content": "    err = ff_hwframe_map_create(src->hw_frames_ctx,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1048,
          "old_api": "DRM_MAP",
          "new_api": null,
          "old_text": "DRM_MAP(XBGR, 1, DRM_FORMAT_RGBX8888)",
          "new_text": null,
          "old_line_content": "    DRM_MAP(XBGR, 1, DRM_FORMAT_RGBX8888),",
          "new_line_content": "#if defined(VA_FOURCC_P010) && defined(DRM_FORMAT_R16)",
          "content_same": false
        },
        {
          "line": 1050,
          "old_api": "DRM_MAP",
          "new_api": null,
          "old_text": "DRM_MAP(ARGB, 1, DRM_FORMAT_BGRA8888)",
          "new_text": null,
          "old_line_content": "    DRM_MAP(ARGB, 1, DRM_FORMAT_BGRA8888),",
          "new_line_content": "#endif",
          "content_same": false
        },
        {
          "line": 1051,
          "old_api": "DRM_MAP",
          "new_api": null,
          "old_text": "DRM_MAP(XRGB, 1, DRM_FORMAT_BGRX8888)",
          "new_text": null,
          "old_line_content": "    DRM_MAP(XRGB, 1, DRM_FORMAT_BGRX8888),",
          "new_line_content": "#if defined(VA_FOURCC_P012) && defined(DRM_FORMAT_R16)",
          "content_same": false
        },
        {
          "line": 1053,
          "old_api": "DRM_MAP",
          "new_api": null,
          "old_text": "DRM_MAP(XYUV, 1, DRM_FORMAT_XYUV8888)",
          "new_text": null,
          "old_line_content": "    DRM_MAP(XYUV, 1, DRM_FORMAT_XYUV8888),",
          "new_line_content": "#endif",
          "content_same": false
        },
        {
          "line": 1569,
          "old_api": "vaReleaseBufferHandle",
          "new_api": null,
          "old_text": "vaReleaseBufferHandle(hwctx->display, mapping->image.buf)",
          "new_text": null,
          "old_line_content": "    vaReleaseBufferHandle(hwctx->display, mapping->image.buf);",
          "new_line_content": "                                dst, src, &vaapi_unmap_to_drm_abh,",
          "content_same": false
        },
        {
          "line": 1571,
          "old_api": "vaDestroyImage",
          "new_api": null,
          "old_text": "vaDestroyImage(hwctx->display, mapping->image.image_id)",
          "new_text": null,
          "old_line_content": "    vaDestroyImage(hwctx->display, mapping->image.image_id);",
          "new_line_content": "    if (err < 0)",
          "content_same": false
        },
        {
          "line": 1573,
          "old_api": "av_freep",
          "new_api": null,
          "old_text": "av_freep(&mapping)",
          "new_text": null,
          "old_line_content": "    av_freep(&mapping);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1584,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(ENOSYS)",
          "new_text": null,
          "old_line_content": "    if (err != AVERROR(ENOSYS))",
          "new_line_content": "fail:",
          "content_same": false
        },
        {
          "line": 1076,
          "old_api": "vaDestroySurfaces",
          "new_api": null,
          "old_text": "vaDestroySurfaces(dst_dev->display, &surface_id, 1)",
          "new_text": null,
          "old_line_content": "    vaDestroySurfaces(dst_dev->display, &surface_id, 1);",
          "new_line_content": "};",
          "content_same": false
        },
        {
          "line": 1588,
          "old_api": "vaapi_map_to_drm_abh",
          "new_api": null,
          "old_text": "vaapi_map_to_drm_abh(hwfc, dst, src, flags)",
          "new_text": null,
          "old_line_content": "    return vaapi_map_to_drm_abh(hwfc, dst, src, flags);",
          "new_line_content": "#endif",
          "content_same": false
        },
        {
          "line": 1590,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(ENOSYS)",
          "new_text": null,
          "old_line_content": "    return AVERROR(ENOSYS);",
          "new_line_content": "static int vaapi_map_to_drm(AVHWFramesContext *hwfc, AVFrame *dst,",
          "content_same": false
        },
        {
          "line": 1601,
          "old_api": "vaapi_map_from_drm",
          "new_api": null,
          "old_text": "vaapi_map_from_drm(hwfc, dst, src, flags)",
          "new_text": null,
          "old_line_content": "        return vaapi_map_from_drm(hwfc, dst, src, flags);",
          "new_line_content": "#endif",
          "content_same": false
        },
        {
          "line": 1604,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(ENOSYS)",
          "new_text": null,
          "old_line_content": "        return AVERROR(ENOSYS);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1614,
          "old_api": "vaapi_map_to_drm",
          "new_api": null,
          "old_text": "vaapi_map_to_drm(hwfc, dst, src, flags)",
          "new_text": null,
          "old_line_content": "        return vaapi_map_to_drm(hwfc, dst, src, flags);",
          "new_line_content": "#endif",
          "content_same": false
        },
        {
          "line": 1617,
          "old_api": "vaapi_map_to_memory",
          "new_api": null,
          "old_text": "vaapi_map_to_memory(hwfc, dst, src, flags)",
          "new_text": null,
          "old_line_content": "        return vaapi_map_to_memory(hwfc, dst, src, flags);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1627,
          "old_api": "vaTerminate",
          "new_api": null,
          "old_text": "vaTerminate(hwctx->display)",
          "new_text": null,
          "old_line_content": "        vaTerminate(hwctx->display);",
          "new_line_content": "#endif",
          "content_same": false
        },
        {
          "line": 1631,
          "old_api": "XCloseDisplay",
          "new_api": null,
          "old_text": "XCloseDisplay(priv->x11_display)",
          "new_text": null,
          "old_line_content": "        XCloseDisplay(priv->x11_display);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 1120,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(dst_fc, AV_LOG_ERROR, \"VAAPI can only map frames \"\n               \"made from a single DRM object.\\n\")",
          "new_text": null,
          "old_line_content": "        av_log(dst_fc, AV_LOG_ERROR, \"VAAPI can only map frames \"",
          "new_line_content": "        {",
          "content_same": false
        },
        {
          "line": 1122,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(EINVAL)",
          "new_text": null,
          "old_line_content": "        return AVERROR(EINVAL);",
          "new_line_content": "            .flags = VA_SURFACE_ATTRIB_SETTABLE,",
          "content_same": false
        },
        {
          "line": 1635,
          "old_api": "close",
          "new_api": null,
          "old_text": "close(priv->drm_fd)",
          "new_text": null,
          "old_line_content": "        close(priv->drm_fd);",
          "new_line_content": "    AVVAAPIDeviceContext *hwctx = ctx->hwctx;",
          "content_same": false
        },
        {
          "line": 1637,
          "old_api": "av_freep",
          "new_api": null,
          "old_text": "av_freep(&priv)",
          "new_text": null,
          "old_line_content": "    av_freep(&priv);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1126,
          "old_api": "FF_ARRAY_ELEMS",
          "new_api": null,
          "old_text": "FF_ARRAY_ELEMS(vaapi_drm_format_map)",
          "new_text": null,
          "old_line_content": "    for (i = 0; i < FF_ARRAY_ELEMS(vaapi_drm_format_map); i++) {",
          "new_line_content": "    };",
          "content_same": false
        },
        {
          "line": 1645,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(ctx, AV_LOG_ERROR, \"libva: %s\", message)",
          "new_text": null,
          "old_line_content": "    av_log(ctx, AV_LOG_ERROR, \"libva: %s\", message);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1140,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(dst_fc, AV_LOG_ERROR, \"DRM format not supported \"\n               \"by VAAPI.\\n\")",
          "new_text": null,
          "old_line_content": "        av_log(dst_fc, AV_LOG_ERROR, \"DRM format not supported \"",
          "new_line_content": "            continue;",
          "content_same": false
        },
        {
          "line": 1652,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(ctx, AV_LOG_VERBOSE, \"libva: %s\", message)",
          "new_text": null,
          "old_line_content": "    av_log(ctx, AV_LOG_VERBOSE, \"libva: %s\", message);",
          "new_line_content": "#if CONFIG_VAAPI_1",
          "content_same": false
        },
        {
          "line": 1142,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(EINVAL)",
          "new_text": null,
          "old_line_content": "        return AVERROR(EINVAL);",
          "new_line_content": "            if (desc->layers[j].format !=",
          "content_same": false
        },
        {
          "line": 1145,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(dst_fc, AV_LOG_DEBUG, \"Map DRM object %d to VAAPI as \"\n           \"%08x.\\n\", desc->objects[0].fd, va_fourcc)",
          "new_text": null,
          "old_line_content": "    av_log(dst_fc, AV_LOG_DEBUG, \"Map DRM object %d to VAAPI as \"",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 1148,
          "old_api": "vaapi_format_from_fourcc",
          "new_api": null,
          "old_text": "vaapi_format_from_fourcc(va_fourcc)",
          "new_text": null,
          "old_line_content": "    format_desc = vaapi_format_from_fourcc(va_fourcc);",
          "new_line_content": "        va_fourcc = vaapi_drm_format_map[i].va_fourcc;",
          "content_same": false
        },
        {
          "line": 1149,
          "old_api": "av_assert0",
          "new_api": null,
          "old_text": "av_assert0(format_desc)",
          "new_text": null,
          "old_line_content": "    av_assert0(format_desc);",
          "new_line_content": "        break;",
          "content_same": false
        },
        {
          "line": 1665,
          "old_api": "vaSetInfoCallback (display, &vaapi_device_log_info,  ctx)",
          "new_api": null,
          "old_text": "vaSetInfoCallback (display, &vaapi_device_log_info,  ctx)",
          "new_text": null,
          "old_line_content": "    vaSetInfoCallback (display, &vaapi_device_log_info,  ctx);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 1670,
          "old_api": "vaInitialize",
          "new_api": null,
          "old_text": "vaInitialize(display, &major, &minor)",
          "new_text": null,
          "old_line_content": "    vas = vaInitialize(display, &major, &minor);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 1672,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(ctx, AV_LOG_ERROR, \"Failed to initialise VAAPI \"\n               \"connection: %d (%s).\\n\", vas, vaErrorStr(vas))",
          "new_text": null,
          "old_line_content": "        av_log(ctx, AV_LOG_ERROR, \"Failed to initialise VAAPI \"",
          "new_line_content": "    int major, minor;",
          "content_same": false
        },
        {
          "line": 1673,
          "old_api": "vaErrorStr",
          "new_api": null,
          "old_text": "vaErrorStr(vas)",
          "new_text": null,
          "old_line_content": "               \"connection: %d (%s).\\n\", vas, vaErrorStr(vas));",
          "new_line_content": "    VAStatus vas;",
          "content_same": false
        },
        {
          "line": 1674,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(EIO)",
          "new_text": null,
          "old_line_content": "        return AVERROR(EIO);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1690,
          "old_api": "av_mallocz",
          "new_api": null,
          "old_text": "av_mallocz(sizeof(*priv))",
          "new_text": null,
          "old_line_content": "    priv = av_mallocz(sizeof(*priv));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1692,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(ENOMEM)",
          "new_text": null,
          "old_line_content": "        return AVERROR(ENOMEM);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 1699,
          "old_api": "av_dict_get",
          "new_api": null,
          "old_text": "av_dict_get(opts, \"connection_type\", NULL, 0)",
          "new_text": null,
          "old_line_content": "    ent = av_dict_get(opts, \"connection_type\", NULL, 0);",
          "new_line_content": "    const AVDictionaryEntry *ent;",
          "content_same": false
        },
        {
          "line": 1706,
          "old_api": "strcmp",
          "new_api": null,
          "old_text": "strcmp(ent->value, \"win32\")",
          "new_text": null,
          "old_line_content": "        } else if (!strcmp(ent->value, \"win32\")) {",
          "new_line_content": "    priv->drm_fd = -1;",
          "content_same": false
        },
        {
          "line": 1709,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(ctx, AV_LOG_ERROR, \"Invalid connection type %s.\\n\",\n                   ent->value)",
          "new_text": null,
          "old_line_content": "            av_log(ctx, AV_LOG_ERROR, \"Invalid connection type %s.\\n\",",
          "new_line_content": "    ctx->free        = vaapi_device_free;",
          "content_same": false
        },
        {
          "line": 1207,
          "old_api": "vaCreateSurfaces",
          "new_api": null,
          "old_text": "vaCreateSurfaces(dst_dev->display, format_desc->rt_format,\n                               src->width, src->height, &surface_id, 1,\n                               prime_attrs, FF_ARRAY_ELEMS(prime_attrs))",
          "new_text": null,
          "old_line_content": "        vas = vaCreateSurfaces(dst_dev->display, format_desc->rt_format,",
          "new_line_content": "                    prime_desc.layers[i].pitch[2]);",
          "content_same": false
        },
        {
          "line": 1209,
          "old_api": "FF_ARRAY_ELEMS",
          "new_api": null,
          "old_text": "FF_ARRAY_ELEMS(prime_attrs)",
          "new_text": null,
          "old_line_content": "                               prime_attrs, FF_ARRAY_ELEMS(prime_attrs));",
          "new_line_content": "                    prime_desc.layers[i].offset[2]);",
          "content_same": false
        },
        {
          "line": 1727,
          "old_api": "open",
          "new_api": null,
          "old_text": "open(device, O_RDWR)",
          "new_text": null,
          "old_line_content": "            priv->drm_fd = open(device, O_RDWR);",
          "new_line_content": "        try_drm = HAVE_VAAPI_DRM;",
          "content_same": false
        },
        {
          "line": 1729,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(ctx, loglevel, \"Failed to open %s as \"\n                       \"DRM device node.\\n\", device)",
          "new_text": null,
          "old_line_content": "                av_log(ctx, loglevel, \"Failed to open %s as \"",
          "new_line_content": "        try_win32 = HAVE_VAAPI_WIN32;",
          "content_same": false
        },
        {
          "line": 1742,
          "old_api": "snprintf",
          "new_api": null,
          "old_text": "snprintf(path, sizeof(path),\n                         \"/dev/dri/renderD%d\", 128 + n)",
          "new_text": null,
          "old_line_content": "                snprintf(path, sizeof(path),",
          "new_line_content": "                       \"DRM device node.\\n\", device);",
          "content_same": false
        },
        {
          "line": 1744,
          "old_api": "open",
          "new_api": null,
          "old_text": "open(path, O_RDWR)",
          "new_text": null,
          "old_line_content": "                priv->drm_fd = open(path, O_RDWR);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 1748,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(ctx, AV_LOG_VERBOSE,\n                                   \"No render device %s, try next device for \"\n                                   \"DRM render node.\\n\", path)",
          "new_text": null,
          "old_line_content": "                            av_log(ctx, AV_LOG_VERBOSE,",
          "new_line_content": "#if CONFIG_LIBDRM",
          "content_same": false
        },
        {
          "line": 1757,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(ctx, AV_LOG_VERBOSE, \"Cannot open \"\n                               \"DRM render node for device %d.\\n\", n)",
          "new_text": null,
          "old_line_content": "                        av_log(ctx, AV_LOG_VERBOSE, \"Cannot open \"",
          "new_line_content": "                if (priv->drm_fd < 0) {",
          "content_same": false
        },
        {
          "line": 1762,
          "old_api": "drmGetVersion",
          "new_api": null,
          "old_text": "drmGetVersion(priv->drm_fd)",
          "new_text": null,
          "old_line_content": "                info = drmGetVersion(priv->drm_fd);",
          "new_line_content": "                                   \"DRM render node.\\n\", path);",
          "content_same": false
        },
        {
          "line": 1764,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(ctx, AV_LOG_VERBOSE,\n                           \"Failed to get DRM version for device %d.\\n\", n)",
          "new_text": null,
          "old_line_content": "                    av_log(ctx, AV_LOG_VERBOSE,",
          "new_line_content": "                        }",
          "content_same": false
        },
        {
          "line": 1258,
          "old_api": "vaCreateSurfaces",
          "new_api": null,
          "old_text": "vaCreateSurfaces(dst_dev->display, format_desc->rt_format,\n                               src->width, src->height,\n                               &surface_id, 1,\n                               buffer_attrs, FF_ARRAY_ELEMS(buffer_attrs))",
          "new_text": null,
          "old_line_content": "        vas = vaCreateSurfaces(dst_dev->display, format_desc->rt_format,",
          "new_line_content": "                buffer_desc.offsets[k] = desc->layers[i].planes[j].offset;",
          "content_same": false
        },
        {
          "line": 1771,
          "old_api": "strcmp",
          "new_api": null,
          "old_text": "strcmp(kernel_driver->value, info->name)",
          "new_text": null,
          "old_line_content": "                    if (strcmp(kernel_driver->value, info->name)) {",
          "new_line_content": "                    break;",
          "content_same": false
        },
        {
          "line": 1772,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(ctx, AV_LOG_VERBOSE, \"Ignoring device %d \"\n                               \"with non-matching kernel driver (%s).\\n\",\n                               n, info->name)",
          "new_text": null,
          "old_line_content": "                        av_log(ctx, AV_LOG_VERBOSE, \"Ignoring device %d \"",
          "new_line_content": "                }",
          "content_same": false
        },
        {
          "line": 1261,
          "old_api": "FF_ARRAY_ELEMS",
          "new_api": null,
          "old_text": "FF_ARRAY_ELEMS(buffer_attrs)",
          "new_text": null,
          "old_line_content": "                               buffer_attrs, FF_ARRAY_ELEMS(buffer_attrs));",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 1775,
          "old_api": "drmFreeVersion",
          "new_api": null,
          "old_text": "drmFreeVersion(info)",
          "new_text": null,
          "old_line_content": "                        drmFreeVersion(info);",
          "new_line_content": "                if (!info) {",
          "content_same": false
        },
        {
          "line": 1780,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(ctx, AV_LOG_VERBOSE, \"Trying to use \"\n                           \"DRM render node for device %d, \"\n                           \"with matching kernel driver (%s).\\n\",\n                           n, info->name)",
          "new_text": null,
          "old_line_content": "                    av_log(ctx, AV_LOG_VERBOSE, \"Trying to use \"",
          "new_line_content": "                    continue;",
          "content_same": false
        },
        {
          "line": 1790,
          "old_api": "drmFreeVersion",
          "new_api": null,
          "old_text": "drmFreeVersion(info)",
          "new_text": null,
          "old_line_content": "                    drmFreeVersion(info);",
          "new_line_content": "                        continue;",
          "content_same": false
        },
        {
          "line": 1791,
          "old_api": "close",
          "new_api": null,
          "old_text": "close(priv->drm_fd)",
          "new_text": null,
          "old_line_content": "                    close(priv->drm_fd);",
          "new_line_content": "                    }",
          "content_same": false
        },
        {
          "line": 1795,
          "old_api": "drmFreeVersion",
          "new_api": null,
          "old_text": "drmFreeVersion(info)",
          "new_text": null,
          "old_line_content": "                drmFreeVersion(info);",
          "new_line_content": "                           n, info->name);",
          "content_same": false
        },
        {
          "line": 1797,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(ctx, AV_LOG_VERBOSE, \"Trying to use \"\n                       \"DRM render node for device %d.\\n\", n)",
          "new_text": null,
          "old_line_content": "                av_log(ctx, AV_LOG_VERBOSE, \"Trying to use \"",
          "new_line_content": "                    break;",
          "content_same": false
        },
        {
          "line": 1289,
          "old_api": "vaCreateSurfaces",
          "new_api": null,
          "old_text": "vaCreateSurfaces(dst_dev->display, format_desc->rt_format,\n                           src->width, src->height,\n                           &surface_id, 1,\n                           attrs, FF_ARRAY_ELEMS(attrs))",
          "new_text": null,
          "old_line_content": "    vas = vaCreateSurfaces(dst_dev->display, format_desc->rt_format,",
          "new_line_content": "            buffer_desc.offsets[k] = desc->layers[i].planes[j].offset;",
          "content_same": false
        },
        {
          "line": 1292,
          "old_api": "FF_ARRAY_ELEMS",
          "new_api": null,
          "old_text": "FF_ARRAY_ELEMS(attrs)",
          "new_text": null,
          "old_line_content": "                           attrs, FF_ARRAY_ELEMS(attrs));",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1805,
          "old_api": "vaGetDisplayDRM",
          "new_api": null,
          "old_text": "vaGetDisplayDRM(priv->drm_fd)",
          "new_text": null,
          "old_line_content": "        display = vaGetDisplayDRM(priv->drm_fd);",
          "new_line_content": "                    continue;",
          "content_same": false
        },
        {
          "line": 1295,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(dst_fc, AV_LOG_ERROR, \"Failed to create surface from DRM \"\n               \"object: %d (%s).\\n\", vas, vaErrorStr(vas))",
          "new_text": null,
          "old_line_content": "        av_log(dst_fc, AV_LOG_ERROR, \"Failed to create surface from DRM \"",
          "new_line_content": "    if (format_desc->chroma_planes_swapped &&",
          "content_same": false
        },
        {
          "line": 1296,
          "old_api": "vaErrorStr",
          "new_api": null,
          "old_text": "vaErrorStr(vas)",
          "new_text": null,
          "old_line_content": "               \"object: %d (%s).\\n\", vas, vaErrorStr(vas));",
          "new_line_content": "        buffer_desc.num_planes == 3) {",
          "content_same": false
        },
        {
          "line": 1297,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(EIO)",
          "new_text": null,
          "old_line_content": "        return AVERROR(EIO);",
          "new_line_content": "        FFSWAP(uint32_t, buffer_desc.pitches[1], buffer_desc.pitches[2]);",
          "content_same": false
        },
        {
          "line": 1299,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(dst_fc, AV_LOG_DEBUG, \"Create surface %#x.\\n\", surface_id)",
          "new_text": null,
          "old_line_content": "    av_log(dst_fc, AV_LOG_DEBUG, \"Create surface %#x.\\n\", surface_id);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1818,
          "old_api": "XOpenDisplay",
          "new_api": null,
          "old_text": "XOpenDisplay(device)",
          "new_text": null,
          "old_line_content": "        priv->x11_display = XOpenDisplay(device);",
          "new_line_content": "        if (!display) {",
          "content_same": false
        },
        {
          "line": 1820,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(ctx, AV_LOG_VERBOSE, \"Cannot open X11 display \"\n                   \"%s.\\n\", XDisplayName(device))",
          "new_text": null,
          "old_line_content": "            av_log(ctx, AV_LOG_VERBOSE, \"Cannot open X11 display \"",
          "new_line_content": "                   \"from DRM device %s.\\n\", device);",
          "content_same": false
        },
        {
          "line": 1821,
          "old_api": "XDisplayName",
          "new_api": null,
          "old_text": "XDisplayName(device)",
          "new_text": null,
          "old_line_content": "                   \"%s.\\n\", XDisplayName(device));",
          "new_line_content": "            return AVERROR_EXTERNAL;",
          "content_same": false
        },
        {
          "line": 1823,
          "old_api": "vaGetDisplay",
          "new_api": null,
          "old_text": "vaGetDisplay(priv->x11_display)",
          "new_text": null,
          "old_line_content": "            display = vaGetDisplay(priv->x11_display);",
          "new_line_content": "        break;",
          "content_same": false
        },
        {
          "line": 1825,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(ctx, AV_LOG_ERROR, \"Cannot open a VA display \"\n                       \"from X11 display %s.\\n\", XDisplayName(device))",
          "new_text": null,
          "old_line_content": "                av_log(ctx, AV_LOG_ERROR, \"Cannot open a VA display \"",
          "new_line_content": "#endif",
          "content_same": false
        },
        {
          "line": 1826,
          "old_api": "XDisplayName",
          "new_api": null,
          "old_text": "XDisplayName(device)",
          "new_text": null,
          "old_line_content": "                       \"from X11 display %s.\\n\", XDisplayName(device));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1831,
          "old_api": "XDisplayName",
          "new_api": null,
          "old_text": "XDisplayName(device)",
          "new_text": null,
          "old_line_content": "                   \"X11 display %s.\\n\", XDisplayName(device));",
          "new_line_content": "        if (!priv->x11_display) {",
          "content_same": false
        },
        {
          "line": 1325,
          "old_api": "close",
          "new_api": null,
          "old_text": "close(drm_desc->objects[i].fd)",
          "new_text": null,
          "old_line_content": "        close(drm_desc->objects[i].fd);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 814,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(hwfc, AV_LOG_DEBUG, \"Map surface %#x.\\n\", surface_id)",
          "new_text": null,
          "old_line_content": "    av_log(hwfc, AV_LOG_DEBUG, \"Map surface %#x.\\n\", surface_id);",
          "new_line_content": "#endif",
          "content_same": false
        },
        {
          "line": 1327,
          "old_api": "av_freep",
          "new_api": null,
          "old_text": "av_freep(&drm_desc)",
          "new_text": null,
          "old_line_content": "    av_freep(&drm_desc);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 1840,
          "old_api": "vaGetDisplayWin32",
          "new_api": null,
          "old_text": "vaGetDisplayWin32(NULL)",
          "new_text": null,
          "old_line_content": "            display = vaGetDisplayWin32(NULL);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 818,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(EINVAL)",
          "new_text": null,
          "old_line_content": "        return AVERROR(EINVAL);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1845,
          "old_api": "dlopen",
          "new_api": null,
          "old_text": "dlopen(\"dxgi.dll\", 0)",
          "new_text": null,
          "old_line_content": "            HANDLE dxgi = dlopen(\"dxgi.dll\", 0);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1847,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(ctx, AV_LOG_ERROR, \"Failed to load dxgi.dll\\n\")",
          "new_text": null,
          "old_line_content": "                av_log(ctx, AV_LOG_ERROR, \"Failed to load dxgi.dll\\n\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 824,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(EINVAL)",
          "new_text": null,
          "old_line_content": "        return AVERROR(EINVAL);",
          "new_line_content": "        dst->format = hwfc->sw_format;",
          "content_same": false
        },
        {
          "line": 1851,
          "old_api": "dlsym",
          "new_api": null,
          "old_text": "dlsym(dxgi, \"CreateDXGIFactory\")",
          "new_text": null,
          "old_line_content": "                (PFN_CREATE_DXGI_FACTORY)dlsym(dxgi, \"CreateDXGIFactory\");",
          "new_line_content": "        if (!device) {",
          "content_same": false
        },
        {
          "line": 1853,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(ctx, AV_LOG_ERROR, \"CreateDXGIFactory load failed\\n\")",
          "new_text": null,
          "old_line_content": "                av_log(ctx, AV_LOG_ERROR, \"CreateDXGIFactory load failed\\n\");",
          "new_line_content": "        } else {",
          "content_same": false
        },
        {
          "line": 1854,
          "old_api": "dlclose",
          "new_api": null,
          "old_text": "dlclose(dxgi)",
          "new_text": null,
          "old_line_content": "                dlclose(dxgi);",
          "new_line_content": "            IDXGIFactory2 *pDXGIFactory = NULL;",
          "content_same": false
        },
        {
          "line": 833,
          "old_api": "av_malloc",
          "new_api": null,
          "old_text": "av_malloc(sizeof(*map))",
          "new_text": null,
          "old_line_content": "    map = av_malloc(sizeof(*map));",
          "new_line_content": "        return err;",
          "content_same": false
        },
        {
          "line": 835,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(ENOMEM)",
          "new_text": null,
          "old_line_content": "        return AVERROR(ENOMEM);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1347,
          "old_api": "vaSyncSurface",
          "new_api": null,
          "old_text": "vaSyncSurface(hwctx->display, surface_id)",
          "new_text": null,
          "old_line_content": "        vas = vaSyncSurface(hwctx->display, surface_id);",
          "new_line_content": "    VAStatus vas;",
          "content_same": false
        },
        {
          "line": 1349,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(hwfc, AV_LOG_ERROR, \"Failed to sync surface \"\n                   \"%#x: %d (%s).\\n\", surface_id, vas, vaErrorStr(vas))",
          "new_text": null,
          "old_line_content": "            av_log(hwfc, AV_LOG_ERROR, \"Failed to sync surface \"",
          "new_line_content": "    AVDRMFrameDescriptor *drm_desc = NULL;",
          "content_same": false
        },
        {
          "line": 1350,
          "old_api": "vaErrorStr",
          "new_api": null,
          "old_text": "vaErrorStr(vas)",
          "new_text": null,
          "old_line_content": "                   \"%#x: %d (%s).\\n\", surface_id, vas, vaErrorStr(vas));",
          "new_line_content": "    uint32_t export_flags;",
          "content_same": false
        },
        {
          "line": 839,
          "old_api": "vaSyncSurface",
          "new_api": null,
          "old_text": "vaSyncSurface(hwctx->display, surface_id)",
          "new_text": null,
          "old_line_content": "    vas = vaSyncSurface(hwctx->display, surface_id);",
          "new_line_content": "    map->flags = flags;",
          "content_same": false
        },
        {
          "line": 1351,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(EIO)",
          "new_text": null,
          "old_line_content": "            return AVERROR(EIO);",
          "new_line_content": "    int err, i, j;",
          "content_same": false
        },
        {
          "line": 841,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(hwfc, AV_LOG_ERROR, \"Failed to sync surface \"\n               \"%#x: %d (%s).\\n\", surface_id, vas, vaErrorStr(vas))",
          "new_text": null,
          "old_line_content": "        av_log(hwfc, AV_LOG_ERROR, \"Failed to sync surface \"",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 843,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(EIO)",
          "new_text": null,
          "old_line_content": "        err = AVERROR(EIO);",
          "new_line_content": "    if (vas != VA_STATUS_SUCCESS) {",
          "content_same": false
        },
        {
          "line": 1358,
          "old_api": "vaExportSurfaceHandle",
          "new_api": null,
          "old_text": "vaExportSurfaceHandle(hwctx->display, surface_id,\n                                VA_SURFACE_ATTRIB_MEM_TYPE_DRM_PRIME_2,\n                                export_flags, &va_desc)",
          "new_text": null,
          "old_line_content": "    vas = vaExportSurfaceHandle(hwctx->display, surface_id,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1870,
          "old_api": "IDXGIAdapter2_GetDesc",
          "new_api": null,
          "old_text": "IDXGIAdapter2_GetDesc(pAdapter, &desc)",
          "new_text": null,
          "old_line_content": "                    if (SUCCEEDED(IDXGIAdapter2_GetDesc(pAdapter, &desc))) {",
          "new_line_content": "            // In UWP (which lacks LoadLibrary), CreateDXGIFactory isn't",
          "content_same": false
        },
        {
          "line": 1871,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(ctx, AV_LOG_INFO,\n                              \"Using device %04x:%04x (%ls) - LUID %lu %ld.\\n\",\n                              desc.VendorId, desc.DeviceId, desc.Description,\n                              desc.AdapterLuid.LowPart,\n                              desc.AdapterLuid.HighPart)",
          "new_text": null,
          "old_line_content": "                        av_log(ctx, AV_LOG_INFO,",
          "new_line_content": "            // available, only CreateDXGIFactory1",
          "content_same": false
        },
        {
          "line": 1364,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(hwfc, AV_LOG_ERROR, \"Failed to export surface %#x: \"\n               \"%d (%s).\\n\", surface_id, vas, vaErrorStr(vas))",
          "new_text": null,
          "old_line_content": "        av_log(hwfc, AV_LOG_ERROR, \"Failed to export surface %#x: \"",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 1365,
          "old_api": "vaErrorStr",
          "new_api": null,
          "old_text": "vaErrorStr(vas)",
          "new_text": null,
          "old_line_content": "               \"%d (%s).\\n\", surface_id, vas, vaErrorStr(vas));",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1366,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(EIO)",
          "new_text": null,
          "old_line_content": "        return AVERROR(EIO);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1876,
          "old_api": "vaGetDisplayWin32",
          "new_api": null,
          "old_text": "vaGetDisplayWin32(&desc.AdapterLuid)",
          "new_text": null,
          "old_line_content": "                        display = vaGetDisplayWin32(&desc.AdapterLuid);",
          "new_line_content": "                                              (void **)&pDXGIFactory))) {",
          "content_same": false
        },
        {
          "line": 856,
          "old_api": "vaDeriveImage",
          "new_api": null,
          "old_text": "vaDeriveImage(hwctx->display, surface_id, &map->image)",
          "new_text": null,
          "old_line_content": "        vas = vaDeriveImage(hwctx->display, surface_id, &map->image);",
          "new_line_content": "    // prefer not to be given direct-mapped memory if they request read access.",
          "content_same": false
        },
        {
          "line": 1369,
          "old_api": "av_mallocz",
          "new_api": null,
          "old_text": "av_mallocz(sizeof(*drm_desc))",
          "new_text": null,
          "old_line_content": "    drm_desc = av_mallocz(sizeof(*drm_desc));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 858,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(hwfc, AV_LOG_ERROR, \"Failed to derive image from \"\n                   \"surface %#x: %d (%s).\\n\",\n                   surface_id, vas, vaErrorStr(vas))",
          "new_text": null,
          "old_line_content": "            av_log(hwfc, AV_LOG_ERROR, \"Failed to derive image from \"",
          "new_line_content": "        ((flags & AV_HWFRAME_MAP_DIRECT) || !(flags & AV_HWFRAME_MAP_READ))) {",
          "content_same": false
        },
        {
          "line": 1371,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(ENOMEM)",
          "new_text": null,
          "old_line_content": "        err = AVERROR(ENOMEM);",
          "new_line_content": "                                VA_SURFACE_ATTRIB_MEM_TYPE_DRM_PRIME_2,",
          "content_same": false
        },
        {
          "line": 860,
          "old_api": "vaErrorStr",
          "new_api": null,
          "old_text": "vaErrorStr(vas)",
          "new_text": null,
          "old_line_content": "                   surface_id, vas, vaErrorStr(vas));",
          "new_line_content": "        if (vas != VA_STATUS_SUCCESS) {",
          "content_same": false
        },
        {
          "line": 1880,
          "old_api": "IDXGIFactory2_Release",
          "new_api": null,
          "old_text": "IDXGIFactory2_Release(pDXGIFactory)",
          "new_text": null,
          "old_line_content": "                IDXGIFactory2_Release(pDXGIFactory);",
          "new_line_content": "                                                         &pAdapter))) {",
          "content_same": false
        },
        {
          "line": 865,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(hwfc, AV_LOG_ERROR, \"Derive image of surface %#x \"\n                   \"is in wrong format: expected %#08x, got %#08x.\\n\",\n                   surface_id, image_format->fourcc, map->image.format.fourcc)",
          "new_text": null,
          "old_line_content": "            av_log(hwfc, AV_LOG_ERROR, \"Derive image of surface %#x \"",
          "new_line_content": "            goto fail;",
          "content_same": false
        },
        {
          "line": 1893,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(ctx, AV_LOG_VERBOSE, \"Opened VA display via \"\n                \"Win32 display.\\n\")",
          "new_text": null,
          "old_line_content": "        av_log(ctx, AV_LOG_VERBOSE, \"Opened VA display via \"",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 873,
          "old_api": "vaCreateImage",
          "new_api": null,
          "old_text": "vaCreateImage(hwctx->display, image_format,\n                            hwfc->width, hwfc->height, &map->image)",
          "new_text": null,
          "old_line_content": "        vas = vaCreateImage(hwctx->display, image_format,",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 878,
          "old_api": "vaErrorStr",
          "new_api": null,
          "old_text": "vaErrorStr(vas)",
          "new_text": null,
          "old_line_content": "                   surface_id, vas, vaErrorStr(vas));",
          "new_line_content": "        if (vas != VA_STATUS_SUCCESS) {",
          "content_same": false
        },
        {
          "line": 1903,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(ctx, AV_LOG_ERROR, \"No VA display found for \"\n                   \"any default device.\\n\")",
          "new_text": null,
          "old_line_content": "            av_log(ctx, AV_LOG_ERROR, \"No VA display found for \"",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 883,
          "old_api": "vaGetImage",
          "new_api": null,
          "old_text": "vaGetImage(hwctx->display, surface_id, 0, 0,\n                             hwfc->width, hwfc->height, map->image.image_id)",
          "new_text": null,
          "old_line_content": "            vas = vaGetImage(hwctx->display, surface_id, 0, 0,",
          "new_line_content": "            goto fail;",
          "content_same": false
        },
        {
          "line": 1908,
          "old_api": "av_dict_get",
          "new_api": null,
          "old_text": "av_dict_get(opts, \"driver\", NULL, 0)",
          "new_text": null,
          "old_line_content": "    ent = av_dict_get(opts, \"driver\", NULL, 0);",
          "new_line_content": "#endif",
          "content_same": false
        },
        {
          "line": 1397,
          "old_api": "ff_hwframe_map_create",
          "new_api": null,
          "old_text": "ff_hwframe_map_create(src->hw_frames_ctx, dst, src,\n                                &vaapi_unmap_to_drm_esh, drm_desc)",
          "new_text": null,
          "old_line_content": "    err = ff_hwframe_map_create(src->hw_frames_ctx, dst, src,",
          "new_line_content": "        drm_desc->layers[i].format    = va_desc.layers[i].drm_format;",
          "content_same": false
        },
        {
          "line": 888,
          "old_api": "vaErrorStr",
          "new_api": null,
          "old_text": "vaErrorStr(vas)",
          "new_text": null,
          "old_line_content": "                       surface_id, vas, vaErrorStr(vas));",
          "new_line_content": "            if (vas != VA_STATUS_SUCCESS) {",
          "content_same": false
        },
        {
          "line": 1914,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(ctx, AV_LOG_ERROR, \"Failed to set driver name to \"\n                   \"%s: %d (%s).\\n\", ent->value, vas, vaErrorStr(vas))",
          "new_text": null,
          "old_line_content": "            av_log(ctx, AV_LOG_ERROR, \"Failed to set driver name to \"",
          "new_line_content": "        else",
          "content_same": false
        },
        {
          "line": 1916,
          "old_api": "vaTerminate",
          "new_api": null,
          "old_text": "vaTerminate(display)",
          "new_text": null,
          "old_line_content": "            vaTerminate(display);",
          "new_line_content": "                   \"any default device.\\n\");",
          "content_same": false
        },
        {
          "line": 895,
          "old_api": "vaMapBuffer",
          "new_api": null,
          "old_text": "vaMapBuffer(hwctx->display, map->image.buf, &address)",
          "new_text": null,
          "old_line_content": "    vas = vaMapBuffer(hwctx->display, map->image.buf, &address);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 897,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(hwfc, AV_LOG_ERROR, \"Failed to map image from surface \"\n               \"%#x: %d (%s).\\n\", surface_id, vas, vaErrorStr(vas))",
          "new_text": null,
          "old_line_content": "        av_log(hwfc, AV_LOG_ERROR, \"Failed to map image from surface \"",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 898,
          "old_api": "vaErrorStr",
          "new_api": null,
          "old_text": "vaErrorStr(vas)",
          "new_text": null,
          "old_line_content": "               \"%#x: %d (%s).\\n\", surface_id, vas, vaErrorStr(vas));",
          "new_line_content": "#if VA_CHECK_VERSION(1, 21, 0)",
          "content_same": false
        },
        {
          "line": 899,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(EIO)",
          "new_text": null,
          "old_line_content": "        err = AVERROR(EIO);",
          "new_line_content": "    if (flags & AV_HWFRAME_MAP_READ)",
          "content_same": false
        },
        {
          "line": 1410,
          "old_api": "close",
          "new_api": null,
          "old_text": "close(va_desc.objects[i].fd)",
          "new_text": null,
          "old_line_content": "        close(va_desc.objects[i].fd);",
          "new_line_content": "                                &vaapi_unmap_to_drm_esh, drm_desc);",
          "content_same": false
        },
        {
          "line": 1411,
          "old_api": "av_freep",
          "new_api": null,
          "old_text": "av_freep(&drm_desc)",
          "new_text": null,
          "old_line_content": "    av_freep(&drm_desc);",
          "new_line_content": "    if (err < 0)",
          "content_same": false
        },
        {
          "line": 1925,
          "old_api": "vaapi_device_connect",
          "new_api": null,
          "old_text": "vaapi_device_connect(ctx, display)",
          "new_text": null,
          "old_line_content": "    return vaapi_device_connect(ctx, display);",
          "new_line_content": "        if (vas != VA_STATUS_SUCCESS) {",
          "content_same": false
        },
        {
          "line": 903,
          "old_api": "ff_hwframe_map_create",
          "new_api": null,
          "old_text": "ff_hwframe_map_create(src->hw_frames_ctx,\n                                dst, src, &vaapi_unmap_frame, map)",
          "new_text": null,
          "old_line_content": "    err = ff_hwframe_map_create(src->hw_frames_ctx,",
          "new_line_content": "    // On drivers not implementing vaMapBuffer2 libva calls vaMapBuffer instead.",
          "content_same": false
        },
        {
          "line": 916,
          "old_api": "vaapi_format_from_fourcc",
          "new_api": null,
          "old_text": "vaapi_format_from_fourcc(map->image.format.fourcc)",
          "new_text": null,
          "old_line_content": "    desc = vaapi_format_from_fourcc(map->image.format.fourcc);",
          "new_line_content": "                                dst, src, &vaapi_unmap_frame, map);",
          "content_same": false
        },
        {
          "line": 1940,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(ctx, AV_LOG_ERROR, \"DRM instance requires an associated \"\n                   \"device to derive a VA display from.\\n\")",
          "new_text": null,
          "old_line_content": "            av_log(ctx, AV_LOG_ERROR, \"DRM instance requires an associated \"",
          "new_line_content": "static int vaapi_device_derive(AVHWDeviceContext *ctx,",
          "content_same": false
        },
        {
          "line": 1942,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(EINVAL)",
          "new_text": null,
          "old_line_content": "            return AVERROR(EINVAL);",
          "new_line_content": "                               AVDictionary *opts, int flags)",
          "content_same": false
        },
        {
          "line": 1433,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(hwfc, AV_LOG_DEBUG, \"Unmap VAAPI surface %#x from DRM.\\n\",\n           surface_id)",
          "new_text": null,
          "old_line_content": "    av_log(hwfc, AV_LOG_DEBUG, \"Unmap VAAPI surface %#x from DRM.\\n\",",
          "new_line_content": "    AVDRMFrameDescriptor drm_desc;",
          "content_same": false
        },
        {
          "line": 1947,
          "old_api": "drmGetNodeTypeFromFd",
          "new_api": null,
          "old_text": "drmGetNodeTypeFromFd(src_hwctx->fd)",
          "new_text": null,
          "old_line_content": "            int node_type = drmGetNodeTypeFromFd(src_hwctx->fd);",
          "new_line_content": "        VADisplay *display;",
          "content_same": false
        },
        {
          "line": 1950,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(ctx, AV_LOG_ERROR, \"DRM instance fd does not appear \"\n                       \"to refer to a DRM device.\\n\")",
          "new_text": null,
          "old_line_content": "                av_log(ctx, AV_LOG_ERROR, \"DRM instance fd does not appear \"",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 927,
          "old_api": "vaUnmapBuffer",
          "new_api": null,
          "old_text": "vaUnmapBuffer(hwctx->display, map->image.buf)",
          "new_text": null,
          "old_line_content": "            vaUnmapBuffer(hwctx->display, map->image.buf);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1439,
          "old_api": "vaReleaseBufferHandle",
          "new_api": null,
          "old_text": "vaReleaseBufferHandle(hwctx->display, mapping->image.buf)",
          "new_text": null,
          "old_line_content": "    vas = vaReleaseBufferHandle(hwctx->display, mapping->image.buf);",
          "new_line_content": "    AVVAAPIDeviceContext *hwctx = hwfc->device_ctx->hwctx;",
          "content_same": false
        },
        {
          "line": 929,
          "old_api": "vaDestroyImage",
          "new_api": null,
          "old_text": "vaDestroyImage(hwctx->display, map->image.image_id)",
          "new_text": null,
          "old_line_content": "            vaDestroyImage(hwctx->display, map->image.image_id);",
          "new_line_content": "    if (desc && desc->chroma_planes_swapped) {",
          "content_same": false
        },
        {
          "line": 930,
          "old_api": "av_free",
          "new_api": null,
          "old_text": "av_free(map)",
          "new_text": null,
          "old_line_content": "        av_free(map);",
          "new_line_content": "        // Chroma planes are YVU rather than YUV, so swap them.",
          "content_same": false
        },
        {
          "line": 1441,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(hwfc, AV_LOG_ERROR, \"Failed to release buffer \"\n               \"handle of image %#x (derived from surface %#x): \"\n               \"%d (%s).\\n\", mapping->image.buf, surface_id,\n               vas, vaErrorStr(vas))",
          "new_text": null,
          "old_line_content": "        av_log(hwfc, AV_LOG_ERROR, \"Failed to release buffer \"",
          "new_line_content": "    VASurfaceID surface_id;",
          "content_same": false
        },
        {
          "line": 1444,
          "old_api": "vaErrorStr",
          "new_api": null,
          "old_text": "vaErrorStr(vas)",
          "new_text": null,
          "old_line_content": "               vas, vaErrorStr(vas));",
          "new_line_content": "    surface_id = (VASurfaceID)(uintptr_t)hwmap->source->data[3];",
          "content_same": false
        },
        {
          "line": 1957,
          "old_api": "drmGetRenderDeviceNameFromFd",
          "new_api": null,
          "old_text": "drmGetRenderDeviceNameFromFd(src_hwctx->fd)",
          "new_text": null,
          "old_line_content": "                render_node = drmGetRenderDeviceNameFromFd(src_hwctx->fd);",
          "new_line_content": "#if CONFIG_LIBDRM",
          "content_same": false
        },
        {
          "line": 1447,
          "old_api": "vaDestroyImage",
          "new_api": null,
          "old_text": "vaDestroyImage(hwctx->display, mapping->image.image_id)",
          "new_text": null,
          "old_line_content": "    vas = vaDestroyImage(hwctx->display, mapping->image.image_id);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1449,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(hwfc, AV_LOG_ERROR, \"Failed to destroy image \"\n               \"derived from surface %#x: %d (%s).\\n\",\n               surface_id, vas, vaErrorStr(vas))",
          "new_text": null,
          "old_line_content": "        av_log(hwfc, AV_LOG_ERROR, \"Failed to destroy image \"",
          "new_line_content": "    // so we shouldn't close them separately.",
          "content_same": false
        },
        {
          "line": 1454,
          "old_api": "av_free",
          "new_api": null,
          "old_text": "av_free(mapping)",
          "new_text": null,
          "old_line_content": "    av_free(mapping);",
          "new_line_content": "               \"handle of image %#x (derived from surface %#x): \"",
          "content_same": false
        },
        {
          "line": 1966,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(ctx, AV_LOG_VERBOSE, \"Using non-render node \"\n                               \"because the associated render node \"\n                               \"could not be opened.\\n\")",
          "new_text": null,
          "old_line_content": "                        av_log(ctx, AV_LOG_VERBOSE, \"Using non-render node \"",
          "new_line_content": "            if (node_type == DRM_NODE_RENDER) {",
          "content_same": false
        },
        {
          "line": 944,
          "old_api": "av_frame_alloc",
          "new_api": null,
          "old_text": "av_frame_alloc()",
          "new_text": null,
          "old_line_content": "    map = av_frame_alloc();",
          "new_line_content": "    return err;",
          "content_same": false
        },
        {
          "line": 946,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(ENOMEM)",
          "new_text": null,
          "old_line_content": "        return AVERROR(ENOMEM);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 949,
          "old_api": "vaapi_map_frame",
          "new_api": null,
          "old_text": "vaapi_map_frame(hwfc, map, src, AV_HWFRAME_MAP_READ)",
          "new_text": null,
          "old_line_content": "    err = vaapi_map_frame(hwfc, map, src, AV_HWFRAME_MAP_READ);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 1975,
          "old_api": "free",
          "new_api": null,
          "old_text": "free(render_node)",
          "new_text": null,
          "old_line_content": "                    free(render_node);",
          "new_line_content": "                } else {",
          "content_same": false
        },
        {
          "line": 1467,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(hwfc, AV_LOG_DEBUG, \"Map VAAPI surface %#x to DRM.\\n\",\n           surface_id)",
          "new_text": null,
          "old_line_content": "    av_log(hwfc, AV_LOG_DEBUG, \"Map VAAPI surface %#x to DRM.\\n\",",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 1470,
          "old_api": "av_mallocz",
          "new_api": null,
          "old_text": "av_mallocz(sizeof(*mapping))",
          "new_text": null,
          "old_line_content": "    mapping = av_mallocz(sizeof(*mapping));",
          "new_line_content": "                                const AVFrame *src, int flags)",
          "content_same": false
        },
        {
          "line": 1472,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(ENOMEM)",
          "new_text": null,
          "old_line_content": "        return AVERROR(ENOMEM);",
          "new_line_content": "    AVVAAPIDeviceContext *hwctx = hwfc->device_ctx->hwctx;",
          "content_same": false
        },
        {
          "line": 962,
          "old_api": "av_frame_free",
          "new_api": null,
          "old_text": "av_frame_free(&map)",
          "new_text": null,
          "old_line_content": "    av_frame_free(&map);",
          "new_line_content": "    if (err)",
          "content_same": false
        },
        {
          "line": 1474,
          "old_api": "vaDeriveImage",
          "new_api": null,
          "old_text": "vaDeriveImage(hwctx->display, surface_id,\n                        &mapping->image)",
          "new_text": null,
          "old_line_content": "    vas = vaDeriveImage(hwctx->display, surface_id,",
          "new_line_content": "    VASurfaceID surface_id;",
          "content_same": false
        },
        {
          "line": 1477,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(hwfc, AV_LOG_ERROR, \"Failed to derive image from \"\n               \"surface %#x: %d (%s).\\n\",\n               surface_id, vas, vaErrorStr(vas))",
          "new_text": null,
          "old_line_content": "        av_log(hwfc, AV_LOG_ERROR, \"Failed to derive image from \"",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1989,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(ENOMEM)",
          "new_text": null,
          "old_line_content": "            return AVERROR(ENOMEM);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 1480,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(EIO)",
          "new_text": null,
          "old_line_content": "        err = AVERROR(EIO);",
          "new_line_content": "           surface_id);",
          "content_same": false
        },
        {
          "line": 973,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(EINVAL)",
          "new_text": null,
          "old_line_content": "        return AVERROR(EINVAL);",
          "new_line_content": "fail:",
          "content_same": false
        },
        {
          "line": 975,
          "old_api": "av_frame_alloc",
          "new_api": null,
          "old_text": "av_frame_alloc()",
          "new_text": null,
          "old_line_content": "    map = av_frame_alloc();",
          "new_line_content": "    return err;",
          "content_same": false
        },
        {
          "line": 977,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(ENOMEM)",
          "new_text": null,
          "old_line_content": "        return AVERROR(ENOMEM);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1490,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(hwfc, AV_LOG_ERROR, \"No matching DRM format for \"\n               \"VAAPI format %#x.\\n\", mapping->image.format.fourcc)",
          "new_text": null,
          "old_line_content": "        av_log(hwfc, AV_LOG_ERROR, \"No matching DRM format for \"",
          "new_line_content": "               \"surface %#x: %d (%s).\\n\",",
          "content_same": false
        },
        {
          "line": 2003,
          "old_api": "vaGetDisplayDRM",
          "new_api": null,
          "old_text": "vaGetDisplayDRM(fd)",
          "new_text": null,
          "old_line_content": "        display = vaGetDisplayDRM(fd);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 980,
          "old_api": "vaapi_map_frame",
          "new_api": null,
          "old_text": "vaapi_map_frame(hwfc, map, dst, AV_HWFRAME_MAP_WRITE | AV_HWFRAME_MAP_OVERWRITE)",
          "new_text": null,
          "old_line_content": "    err = vaapi_map_frame(hwfc, map, dst, AV_HWFRAME_MAP_WRITE | AV_HWFRAME_MAP_OVERWRITE);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 2005,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(ctx, AV_LOG_ERROR, \"Failed to open a VA display from \"\n                   \"DRM device.\\n\")",
          "new_text": null,
          "old_line_content": "            av_log(ctx, AV_LOG_ERROR, \"Failed to open a VA display from \"",
          "new_line_content": "            // The fd is inherited from the source context and we are holding",
          "content_same": false
        },
        {
          "line": 2007,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(EIO)",
          "new_text": null,
          "old_line_content": "            return AVERROR(EIO);",
          "new_line_content": "            priv->drm_fd = -1;",
          "content_same": false
        },
        {
          "line": 2010,
          "old_api": "vaapi_device_connect",
          "new_api": null,
          "old_text": "vaapi_device_connect(ctx, display)",
          "new_text": null,
          "old_line_content": "        return vaapi_device_connect(ctx, display);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 2013,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(ENOSYS)",
          "new_text": null,
          "old_line_content": "    return AVERROR(ENOSYS);",
          "new_line_content": "        ctx->free        = &vaapi_device_free;",
          "content_same": false
        },
        {
          "line": 1503,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(hwfc, AV_LOG_ERROR, \"Image properties do not match \"\n                   \"expected format: got %d planes, but expected %d.\\n\",\n                   mapping->image.num_planes, mapping->drm_desc.nb_layers)",
          "new_text": null,
          "old_line_content": "            av_log(hwfc, AV_LOG_ERROR, \"Image properties do not match \"",
          "new_line_content": "               \"VAAPI format %#x.\\n\", mapping->image.format.fourcc);",
          "content_same": false
        },
        {
          "line": 993,
          "old_api": "av_frame_free",
          "new_api": null,
          "old_text": "av_frame_free(&map)",
          "new_text": null,
          "old_line_content": "    av_frame_free(&map);",
          "new_line_content": "    if (err)",
          "content_same": false
        },
        {
          "line": 1506,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(EINVAL)",
          "new_text": null,
          "old_line_content": "            err = AVERROR(EINVAL);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1003,
          "old_api": "vaapi_get_image_format",
          "new_api": null,
          "old_text": "vaapi_get_image_format(hwfc->device_ctx, dst->format, NULL)",
          "new_text": null,
          "old_line_content": "        err = vaapi_get_image_format(hwfc->device_ctx, dst->format, NULL);",
          "new_line_content": "    err = 0;",
          "content_same": false
        },
        {
          "line": 1008,
          "old_api": "vaapi_map_frame",
          "new_api": null,
          "old_text": "vaapi_map_frame(hwfc, dst, src, flags)",
          "new_text": null,
          "old_line_content": "    err = vaapi_map_frame(hwfc, dst, src, flags);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1012,
          "old_api": "av_frame_copy_props",
          "new_api": null,
          "old_text": "av_frame_copy_props(dst, src)",
          "new_text": null,
          "old_line_content": "    err = av_frame_copy_props(dst, src);",
          "new_line_content": "    int err;",
          "content_same": false
        },
        {
          "line": 1534,
          "old_api": "vaAcquireBufferHandle",
          "new_api": null,
          "old_text": "vaAcquireBufferHandle(hwctx->display, mapping->image.buf,\n                                &mapping->buffer_info)",
          "new_text": null,
          "old_line_content": "    vas = vaAcquireBufferHandle(hwctx->display, mapping->image.buf,",
          "new_line_content": "        mapping->drm_desc.layers[0].format =",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 47,
      "total_additions": 184,
      "total_deletions": 183,
      "total_api_changes": 414
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 12,
        "api_related_lines": 414,
        "non_api_lines": 7,
        "non_api_line_numbers": [
          900,
          901,
          902,
          905,
          907,
          812,
          813
        ]
      }
    },
    "api_calls_before": 381,
    "api_calls_after": 382,
    "diff_info": {
      "added_lines": 12,
      "removed_lines": 0,
      "total_diff_lines": 32
    }
  }
}