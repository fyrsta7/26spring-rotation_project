{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/950a21e83c742714d6afbecd3e3fd1887e80fa40",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/950a21e83c742714d6afbecd3e3fd1887e80fa40/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/950a21e83c742714d6afbecd3e3fd1887e80fa40/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/950a21e83c742714d6afbecd3e3fd1887e80fa40/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 661,
          "old_api": "av_freep",
          "new_api": "av_frame_free",
          "old_text": "av_freep(&s->blocks)",
          "new_text": "av_frame_free(&s->last_frame)",
          "old_line_content": "    av_freep(&s->blocks);",
          "new_line_content": "    av_frame_free(&s->last_frame);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 577,
          "old_api": null,
          "new_api": "bytestream2_get_bytes_left",
          "old_text": null,
          "new_text": "bytestream2_get_bytes_left(gb)",
          "old_line_content": "",
          "new_line_content": "    if (bytestream2_get_bytes_left(gb) > 5)",
          "content_same": false
        },
        {
          "line": 644,
          "old_api": null,
          "new_api": "av_malloc_array",
          "old_text": null,
          "new_text": "av_malloc_array(s->nbcount, sizeof(*s->blocks))",
          "old_line_content": "    s->nbcount = s->nbx * s->nby;",
          "new_line_content": "    s->blocks = av_malloc_array(s->nbcount, sizeof(*s->blocks));",
          "content_same": false
        },
        {
          "line": 581,
          "old_api": null,
          "new_api": "av_frame_ref",
          "old_text": null,
          "new_text": "av_frame_ref(data, s->current_frame)",
          "old_line_content": "    if (avctx->bits_per_coded_sample != 16) {",
          "new_line_content": "        ret = av_frame_ref(data, s->current_frame);",
          "content_same": false
        },
        {
          "line": 646,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(ENOMEM)",
          "old_line_content": "    if (!s->blocks)",
          "new_line_content": "        return AVERROR(ENOMEM);",
          "content_same": false
        },
        {
          "line": 648,
          "old_api": null,
          "new_api": "av_frame_alloc",
          "old_text": null,
          "new_text": "av_frame_alloc()",
          "old_line_content": "",
          "new_line_content": "    s->last_frame = av_frame_alloc();",
          "content_same": false
        },
        {
          "line": 552,
          "old_api": null,
          "new_api": "av_memcpy_backptr",
          "old_text": null,
          "new_text": "av_memcpy_backptr((uint8_t*)(dst+1), 4, 4*avctx->width - 4)",
          "old_line_content": "                dst[x] = clr;",
          "new_line_content": "            av_memcpy_backptr((uint8_t*)(dst+1), 4, 4*avctx->width - 4);",
          "content_same": false
        },
        {
          "line": 651,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(ENOMEM)",
          "old_line_content": "    if (!s->last_frame || !s->current_frame)",
          "new_line_content": "        return AVERROR(ENOMEM);",
          "content_same": false
        },
        {
          "line": 588,
          "old_api": null,
          "new_api": "av_frame_copy",
          "old_text": null,
          "new_text": "av_frame_copy(frame, s->current_frame)",
          "old_line_content": "",
          "new_line_content": "        ret = av_frame_copy(frame, s->current_frame);",
          "content_same": false
        },
        {
          "line": 559,
          "old_api": null,
          "new_api": "decompress_p",
          "old_text": null,
          "new_text": "decompress_p(avctx, (uint32_t *)s->current_frame->data[0],\n                               s->current_frame->linesize[0] / 4,\n                               (uint32_t *)s->last_frame->data[0],\n                               s->last_frame->linesize[0] / 4)",
          "old_line_content": "        if (s->version == 1 || s->version == 2)",
          "new_line_content": "            ret = decompress_p(avctx, (uint32_t *)s->current_frame->data[0],",
          "content_same": false
        },
        {
          "line": 660,
          "old_api": null,
          "new_api": "av_freep",
          "old_text": null,
          "new_text": "av_freep(&s->blocks)",
          "old_line_content": "",
          "new_line_content": "    av_freep(&s->blocks);",
          "content_same": false
        },
        {
          "line": 564,
          "old_api": null,
          "new_api": "decompress_p3",
          "old_text": null,
          "new_text": "decompress_p3(avctx, (uint32_t *)s->current_frame->data[0],\n                                s->current_frame->linesize[0] / 4,\n                                (uint32_t *)s->last_frame->data[0],\n                                s->last_frame->linesize[0] / 4)",
          "old_line_content": "        else",
          "new_line_content": "            ret = decompress_p3(avctx, (uint32_t *)s->current_frame->data[0],",
          "content_same": false
        },
        {
          "line": 632,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(avctx, AV_LOG_ERROR, \"Unsupported bitdepth %i\\n\", avctx->bits_per_coded_sample)",
          "old_line_content": "    default:",
          "new_line_content": "        av_log(avctx, AV_LOG_ERROR, \"Unsupported bitdepth %i\\n\", avctx->bits_per_coded_sample);",
          "content_same": false
        },
        {
          "line": 669,
          "old_api": null,
          "new_api": "NULL_IF_CONFIG_SMALL",
          "old_text": null,
          "new_text": "NULL_IF_CONFIG_SMALL(\"ScreenPressor\")",
          "old_line_content": "    .name             = \"scpr\",",
          "new_line_content": "    .long_name        = NULL_IF_CONFIG_SMALL(\"ScreenPressor\"),",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 578,
          "old_api": "bytestream2_get_bytes_left",
          "new_api": null,
          "old_text": "bytestream2_get_bytes_left(gb)",
          "new_text": null,
          "old_line_content": "    if (bytestream2_get_bytes_left(gb) > 5)",
          "new_line_content": "        return AVERROR_INVALIDDATA;",
          "content_same": false
        },
        {
          "line": 645,
          "old_api": "av_malloc_array",
          "new_api": null,
          "old_text": "av_malloc_array(s->nbcount, sizeof(*s->blocks))",
          "new_text": null,
          "old_line_content": "    s->blocks = av_malloc_array(s->nbcount, sizeof(*s->blocks));",
          "new_line_content": "    if (!s->blocks)",
          "content_same": false
        },
        {
          "line": 582,
          "old_api": "av_frame_ref",
          "new_api": null,
          "old_text": "av_frame_ref(data, s->current_frame)",
          "new_text": null,
          "old_line_content": "        ret = av_frame_ref(data, s->current_frame);",
          "new_line_content": "        if (ret < 0)",
          "content_same": false
        },
        {
          "line": 647,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(ENOMEM)",
          "new_text": null,
          "old_line_content": "        return AVERROR(ENOMEM);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 650,
          "old_api": "av_frame_alloc",
          "new_api": null,
          "old_text": "av_frame_alloc()",
          "new_text": null,
          "old_line_content": "    s->current_frame = av_frame_alloc();",
          "new_line_content": "    if (!s->last_frame || !s->current_frame)",
          "content_same": false
        },
        {
          "line": 652,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(ENOMEM)",
          "new_text": null,
          "old_line_content": "        return AVERROR(ENOMEM);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 589,
          "old_api": "av_frame_copy",
          "new_api": null,
          "old_text": "av_frame_copy(frame, s->current_frame)",
          "new_text": null,
          "old_line_content": "        ret = av_frame_copy(frame, s->current_frame);",
          "new_line_content": "        if (ret < 0)",
          "content_same": false
        },
        {
          "line": 560,
          "old_api": "decompress_p",
          "new_api": null,
          "old_text": "decompress_p(avctx, (uint32_t *)s->current_frame->data[0],\n                               s->current_frame->linesize[0] / 4,\n                               (uint32_t *)s->last_frame->data[0],\n                               s->last_frame->linesize[0] / 4)",
          "new_text": null,
          "old_line_content": "            ret = decompress_p(avctx, (uint32_t *)s->current_frame->data[0],",
          "new_line_content": "                               s->current_frame->linesize[0] / 4,",
          "content_same": false
        },
        {
          "line": 565,
          "old_api": "decompress_p3",
          "new_api": null,
          "old_text": "decompress_p3(avctx, (uint32_t *)s->current_frame->data[0],\n                                s->current_frame->linesize[0] / 4,\n                                (uint32_t *)s->last_frame->data[0],\n                                s->last_frame->linesize[0] / 4)",
          "new_text": null,
          "old_line_content": "            ret = decompress_p3(avctx, (uint32_t *)s->current_frame->data[0],",
          "new_line_content": "                                s->current_frame->linesize[0] / 4,",
          "content_same": false
        },
        {
          "line": 663,
          "old_api": "av_frame_free",
          "new_api": null,
          "old_text": "av_frame_free(&s->current_frame)",
          "new_text": null,
          "old_line_content": "    av_frame_free(&s->current_frame);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 633,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(avctx, AV_LOG_ERROR, \"Unsupported bitdepth %i\\n\", avctx->bits_per_coded_sample)",
          "new_text": null,
          "old_line_content": "        av_log(avctx, AV_LOG_ERROR, \"Unsupported bitdepth %i\\n\", avctx->bits_per_coded_sample);",
          "new_line_content": "        return AVERROR_INVALIDDATA;",
          "content_same": false
        },
        {
          "line": 670,
          "old_api": "NULL_IF_CONFIG_SMALL",
          "new_api": null,
          "old_text": "NULL_IF_CONFIG_SMALL(\"ScreenPressor\")",
          "new_text": null,
          "old_line_content": "    .long_name        = NULL_IF_CONFIG_SMALL(\"ScreenPressor\"),",
          "new_line_content": "    .type             = AVMEDIA_TYPE_VIDEO,",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 1,
      "total_additions": 13,
      "total_deletions": 12,
      "total_api_changes": 26
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 4,
        "api_related_lines": 26,
        "non_api_lines": 3,
        "non_api_line_numbers": [
          553,
          535,
          551
        ]
      }
    },
    "api_calls_before": 67,
    "api_calls_after": 68,
    "diff_info": {
      "added_lines": 3,
      "removed_lines": 4,
      "total_diff_lines": 26
    }
  }
}