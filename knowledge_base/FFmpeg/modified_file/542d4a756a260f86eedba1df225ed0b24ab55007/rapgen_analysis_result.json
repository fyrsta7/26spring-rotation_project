{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/542d4a756a260f86eedba1df225ed0b24ab55007",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/542d4a756a260f86eedba1df225ed0b24ab55007/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/542d4a756a260f86eedba1df225ed0b24ab55007/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/542d4a756a260f86eedba1df225ed0b24ab55007/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 375,
          "old_api": "IS_INTERLACED",
          "new_api": "assert",
          "old_text": "IS_INTERLACED(*mb_type)",
          "new_text": "assert(h->sps.direct_8x8_inference_flag)",
          "old_line_content": "            int y_shift  = 2*!IS_INTERLACED(*mb_type);",
          "new_line_content": "            assert(h->sps.direct_8x8_inference_flag);",
          "content_same": false
        },
        {
          "line": 388,
          "old_api": "fill_rectangle",
          "new_api": "IS_INTRA",
          "old_text": "fill_rectangle(&h->ref_cache[1][scan8[i8*4]], 2, 2, 8, 0, 1)",
          "new_text": "IS_INTRA(mb_type_col[y8])",
          "old_line_content": "                fill_rectangle(&h->ref_cache[1][scan8[i8*4]], 2, 2, 8, 0, 1);",
          "new_line_content": "                if(IS_INTRA(mb_type_col[y8])){",
          "content_same": false
        },
        {
          "line": 389,
          "old_api": "IS_INTRA",
          "new_api": "fill_rectangle",
          "old_text": "IS_INTRA(mb_type_col[y8])",
          "new_text": "fill_rectangle(&h->ref_cache[0][scan8[i8*4]], 2, 2, 8, 0, 1)",
          "old_line_content": "                if(IS_INTRA(mb_type_col[y8])){",
          "new_line_content": "                    fill_rectangle(&h->ref_cache[0][scan8[i8*4]], 2, 2, 8, 0, 1);",
          "content_same": false
        },
        {
          "line": 423,
          "old_api": "fill_rectangle",
          "new_api": "IS_INTRA",
          "old_text": "fill_rectangle(&h->ref_cache[1][scan8[0]], 4, 4, 8, 0, 1)",
          "new_text": "IS_INTRA(mb_type_col[0])",
          "old_line_content": "            fill_rectangle(&h->ref_cache[1][scan8[0]], 4, 4, 8, 0, 1);",
          "new_line_content": "            if(IS_INTRA(mb_type_col[0])){",
          "content_same": false
        },
        {
          "line": 451,
          "old_api": "fill_rectangle",
          "new_api": "IS_INTRA",
          "old_text": "fill_rectangle(&h->ref_cache[1][scan8[i8*4]], 2, 2, 8, 0, 1)",
          "new_text": "IS_INTRA(mb_type_col[0])",
          "old_line_content": "                fill_rectangle(&h->ref_cache[1][scan8[i8*4]], 2, 2, 8, 0, 1);",
          "new_line_content": "                if(IS_INTRA(mb_type_col[0])){",
          "content_same": false
        },
        {
          "line": 452,
          "old_api": "IS_INTRA",
          "new_api": "fill_rectangle",
          "old_text": "IS_INTRA(mb_type_col[0])",
          "new_text": "fill_rectangle(&h->ref_cache[0][scan8[i8*4]], 2, 2, 8, 0, 1)",
          "old_line_content": "                if(IS_INTRA(mb_type_col[0])){",
          "new_line_content": "                    fill_rectangle(&h->ref_cache[0][scan8[i8*4]], 2, 2, 8, 0, 1);",
          "content_same": false
        },
        {
          "line": 468,
          "old_api": "fill_rectangle",
          "new_api": "IS_SUB_8X8",
          "old_text": "fill_rectangle(&h->ref_cache[0][scan8[i8*4]], 2, 2, 8, ref0, 1)",
          "new_text": "IS_SUB_8X8(sub_mb_type)",
          "old_line_content": "                fill_rectangle(&h->ref_cache[0][scan8[i8*4]], 2, 2, 8, ref0, 1);",
          "new_line_content": "                if(IS_SUB_8X8(sub_mb_type)){",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 481,
          "old_api": null,
          "new_api": "pack16to32",
          "old_text": null,
          "new_text": "pack16to32(mv_l0[0]-mv_col[0],mv_l0[1]-mv_col[1])",
          "old_line_content": "                    *(uint32_t*)h->mv_cache[1][scan8[i8*4+i4]] =",
          "new_line_content": "                        pack16to32(mv_l0[0]-mv_col[0],mv_l0[1]-mv_col[1]);",
          "content_same": false
        },
        {
          "line": 450,
          "old_api": null,
          "new_api": "fill_rectangle",
          "old_text": null,
          "new_text": "fill_rectangle(&h->ref_cache[1][scan8[i8*4]], 2, 2, 8, 0, 1)",
          "old_line_content": "                h->sub_mb_type[i8] = sub_mb_type;",
          "new_line_content": "                fill_rectangle(&h->ref_cache[1][scan8[i8*4]], 2, 2, 8, 0, 1);",
          "content_same": false
        },
        {
          "line": 387,
          "old_api": null,
          "new_api": "fill_rectangle",
          "old_text": null,
          "new_text": "fill_rectangle(&h->ref_cache[1][scan8[i8*4]], 2, 2, 8, 0, 1)",
          "old_line_content": "",
          "new_line_content": "                fill_rectangle(&h->ref_cache[1][scan8[i8*4]], 2, 2, 8, 0, 1);",
          "content_same": false
        },
        {
          "line": 419,
          "old_api": null,
          "new_api": "IS_16X16",
          "old_text": null,
          "new_text": "IS_16X16(*mb_type)",
          "old_line_content": "",
          "new_line_content": "        if(IS_16X16(*mb_type)){",
          "content_same": false
        },
        {
          "line": 422,
          "old_api": null,
          "new_api": "fill_rectangle",
          "old_text": null,
          "new_text": "fill_rectangle(&h->ref_cache[1][scan8[0]], 4, 4, 8, 0, 1)",
          "old_line_content": "",
          "new_line_content": "            fill_rectangle(&h->ref_cache[1][scan8[0]], 4, 4, 8, 0, 1);",
          "content_same": false
        },
        {
          "line": 447,
          "old_api": null,
          "new_api": "IS_DIRECT",
          "old_text": null,
          "new_text": "IS_DIRECT(h->sub_mb_type[i8])",
          "old_line_content": "",
          "new_line_content": "                if(is_b8x8 && !IS_DIRECT(h->sub_mb_type[i8]))",
          "content_same": false
        },
        {
          "line": 434,
          "old_api": null,
          "new_api": "pack16to32",
          "old_text": null,
          "new_text": "pack16to32(mv_l0[0],mv_l0[1])",
          "old_line_content": "                ref= ref0;",
          "new_line_content": "                mv0= pack16to32(mv_l0[0],mv_l0[1]);",
          "content_same": false
        },
        {
          "line": 403,
          "old_api": null,
          "new_api": "fill_rectangle",
          "old_text": null,
          "new_text": "fill_rectangle(&h->ref_cache[0][scan8[i8*4]], 2, 2, 8, ref0, 1)",
          "old_line_content": "                scale = dist_scale_factor[ref0];",
          "new_line_content": "                fill_rectangle(&h->ref_cache[0][scan8[i8*4]], 2, 2, 8, ref0, 1);",
          "content_same": false
        },
        {
          "line": 467,
          "old_api": null,
          "new_api": "fill_rectangle",
          "old_text": null,
          "new_text": "fill_rectangle(&h->ref_cache[0][scan8[i8*4]], 2, 2, 8, ref0, 1)",
          "old_line_content": "",
          "new_line_content": "                fill_rectangle(&h->ref_cache[0][scan8[i8*4]], 2, 2, 8, ref0, 1);",
          "content_same": false
        },
        {
          "line": 373,
          "old_api": null,
          "new_api": "IS_INTERLACED",
          "old_text": null,
          "new_text": "IS_INTERLACED(mb_type_col[0])",
          "old_line_content": "",
          "new_line_content": "        if(IS_INTERLACED(*mb_type) != IS_INTERLACED(mb_type_col[0])){",
          "content_same": false
        },
        {
          "line": 437,
          "old_api": null,
          "new_api": "fill_rectangle",
          "old_text": null,
          "new_text": "fill_rectangle(&h->ref_cache[0][scan8[0]], 4, 4, 8, ref, 1)",
          "old_line_content": "            }",
          "new_line_content": "            fill_rectangle(&h->ref_cache[0][scan8[0]], 4, 4, 8, ref, 1);",
          "content_same": false
        },
        {
          "line": 472,
          "old_api": null,
          "new_api": "pack16to32",
          "old_text": null,
          "new_text": "pack16to32(mx,my)",
          "old_line_content": "                    int my = (scale * mv_col[1] + 128) >> 8;",
          "new_line_content": "                    fill_rectangle(&h->mv_cache[0][scan8[i8*4]], 2, 2, 8, pack16to32(mx,my), 4);",
          "content_same": false
        },
        {
          "line": 410,
          "old_api": null,
          "new_api": "pack16to32",
          "old_text": null,
          "new_text": "pack16to32(mx,my)",
          "old_line_content": "                    int my = (scale * my_col + 128) >> 8;",
          "new_line_content": "                    fill_rectangle(&h->mv_cache[0][scan8[i8*4]], 2, 2, 8, pack16to32(mx,my), 4);",
          "content_same": false
        },
        {
          "line": 383,
          "old_api": null,
          "new_api": "IS_DIRECT",
          "old_text": null,
          "new_text": "IS_DIRECT(h->sub_mb_type[i8])",
          "old_line_content": "",
          "new_line_content": "                if(is_b8x8 && !IS_DIRECT(h->sub_mb_type[i8]))",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 384,
          "old_api": "IS_DIRECT",
          "new_api": null,
          "old_text": "IS_DIRECT(h->sub_mb_type[i8])",
          "new_text": null,
          "old_line_content": "                if(is_b8x8 && !IS_DIRECT(h->sub_mb_type[i8]))",
          "new_line_content": "                    continue;",
          "content_same": false
        },
        {
          "line": 448,
          "old_api": "IS_DIRECT",
          "new_api": null,
          "old_text": "IS_DIRECT(h->sub_mb_type[i8])",
          "new_text": null,
          "old_line_content": "                if(is_b8x8 && !IS_DIRECT(h->sub_mb_type[i8]))",
          "new_line_content": "                    continue;",
          "content_same": false
        },
        {
          "line": 482,
          "old_api": "pack16to32",
          "new_api": null,
          "old_text": "pack16to32(mv_l0[0]-mv_col[0],mv_l0[1]-mv_col[1])",
          "new_text": null,
          "old_line_content": "                        pack16to32(mv_l0[0]-mv_col[0],mv_l0[1]-mv_col[1]);",
          "new_line_content": "                }",
          "content_same": false
        },
        {
          "line": 420,
          "old_api": "IS_16X16",
          "new_api": null,
          "old_text": "IS_16X16(*mb_type)",
          "new_text": null,
          "old_line_content": "        if(IS_16X16(*mb_type)){",
          "new_line_content": "            int ref, mv0, mv1;",
          "content_same": false
        },
        {
          "line": 440,
          "old_api": "fill_rectangle",
          "new_api": null,
          "old_text": "fill_rectangle(&h-> mv_cache[1][scan8[0]], 4, 4, 8, mv1, 4)",
          "new_text": null,
          "old_line_content": "            fill_rectangle(&h-> mv_cache[1][scan8[0]], 4, 4, 8, mv1, 4);",
          "new_line_content": "        }else{",
          "content_same": false
        },
        {
          "line": 455,
          "old_api": "fill_rectangle",
          "new_api": null,
          "old_text": "fill_rectangle(&h-> mv_cache[1][scan8[i8*4]], 2, 2, 8, 0, 4)",
          "new_text": null,
          "old_line_content": "                    fill_rectangle(&h-> mv_cache[1][scan8[i8*4]], 2, 2, 8, 0, 4);",
          "new_line_content": "                    continue;",
          "content_same": false
        },
        {
          "line": 392,
          "old_api": "fill_rectangle",
          "new_api": null,
          "old_text": "fill_rectangle(&h-> mv_cache[1][scan8[i8*4]], 2, 2, 8, 0, 4)",
          "new_text": null,
          "old_line_content": "                    fill_rectangle(&h-> mv_cache[1][scan8[i8*4]], 2, 2, 8, 0, 4);",
          "new_line_content": "                    continue;",
          "content_same": false
        },
        {
          "line": 424,
          "old_api": "IS_INTRA",
          "new_api": null,
          "old_text": "IS_INTRA(mb_type_col[0])",
          "new_text": null,
          "old_line_content": "            if(IS_INTRA(mb_type_col[0])){",
          "new_line_content": "                ref=mv0=mv1=0;",
          "content_same": false
        },
        {
          "line": 371,
          "old_api": "IS_INTERLACED",
          "new_api": null,
          "old_text": "IS_INTERLACED(mb_type_col[0])",
          "new_text": null,
          "old_line_content": "        if(h->ref_list[1][0].mbaff && IS_INTERLACED(mb_type_col[0]))",
          "new_line_content": "        ref_offset = (h->ref_list[1][0].mbaff<<4) & (mb_type_col[0]>>3); //if(h->ref_list[1][0].mbaff && IS_INTERLACED(mb_type_col[0])) ref_offset=16 else 0",
          "content_same": false
        },
        {
          "line": 404,
          "old_api": "fill_rectangle",
          "new_api": null,
          "old_text": "fill_rectangle(&h->ref_cache[0][scan8[i8*4]], 2, 2, 8, ref0, 1)",
          "new_text": null,
          "old_line_content": "                fill_rectangle(&h->ref_cache[0][scan8[i8*4]], 2, 2, 8, ref0, 1);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 436,
          "old_api": "pack16to32",
          "new_api": null,
          "old_text": "pack16to32(mv_l0[0]-mv_col[0],mv_l0[1]-mv_col[1])",
          "new_text": null,
          "old_line_content": "                mv1= pack16to32(mv_l0[0]-mv_col[0],mv_l0[1]-mv_col[1]);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 469,
          "old_api": "IS_SUB_8X8",
          "new_api": null,
          "old_text": "IS_SUB_8X8(sub_mb_type)",
          "new_text": null,
          "old_line_content": "                if(IS_SUB_8X8(sub_mb_type)){",
          "new_line_content": "                    const int16_t *mv_col = l1mv[x8*3 + y8*3*b4_stride];",
          "content_same": false
        },
        {
          "line": 376,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(h->sps.direct_8x8_inference_flag)",
          "new_text": null,
          "old_line_content": "            assert(h->sps.direct_8x8_inference_flag);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 474,
          "old_api": "pack16to32",
          "new_api": null,
          "old_text": "pack16to32(mx-mv_col[0],my-mv_col[1])",
          "new_text": null,
          "old_line_content": "                    fill_rectangle(&h->mv_cache[1][scan8[i8*4]], 2, 2, 8, pack16to32(mx-mv_col[0],my-mv_col[1]), 4);",
          "new_line_content": "                }else",
          "content_same": false
        },
        {
          "line": 412,
          "old_api": "pack16to32",
          "new_api": null,
          "old_text": "pack16to32(mx-mv_col[0],my-my_col)",
          "new_text": null,
          "old_line_content": "                    fill_rectangle(&h->mv_cache[1][scan8[i8*4]], 2, 2, 8, pack16to32(mx-mv_col[0],my-my_col), 4);",
          "new_line_content": "                }",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 7,
      "total_additions": 14,
      "total_deletions": 15,
      "total_api_changes": 36
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 3,
        "api_related_lines": 36,
        "non_api_lines": 2,
        "non_api_line_numbers": [
          364,
          372
        ]
      }
    },
    "api_calls_before": 106,
    "api_calls_after": 105,
    "diff_info": {
      "added_lines": 2,
      "removed_lines": 3,
      "total_diff_lines": 23
    }
  }
}