{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/53d5d89c1b7534205e5f825918701dda56d18896",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/53d5d89c1b7534205e5f825918701dda56d18896/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/53d5d89c1b7534205e5f825918701dda56d18896/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/53d5d89c1b7534205e5f825918701dda56d18896/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 1230,
          "old_api": "av_freep",
          "new_api": "ff_jpeg2000_cleanup",
          "old_text": "av_freep(&s->tile)",
          "new_text": "ff_jpeg2000_cleanup(comp, codsty)",
          "old_line_content": "    av_freep(&s->tile);",
          "new_line_content": "            ff_jpeg2000_cleanup(comp, codsty);",
          "content_same": false
        },
        {
          "line": 1249,
          "old_api": "bytestream2_get_be16u",
          "new_api": "av_log",
          "old_text": "bytestream2_get_be16u(&s->g)",
          "new_text": "av_log(s->avctx, AV_LOG_ERROR, \"Missing EOC\\n\")",
          "old_line_content": "        marker = bytestream2_get_be16u(&s->g);",
          "new_line_content": "            av_log(s->avctx, AV_LOG_ERROR, \"Missing EOC\\n\");",
          "content_same": false
        },
        {
          "line": 1304,
          "old_api": "get_tlm",
          "new_api": "bytestream2_skip",
          "old_text": "get_tlm(s, len)",
          "new_text": "bytestream2_skip(&s->g, len - 2)",
          "old_line_content": "            ret = get_tlm(s, len);",
          "new_line_content": "            bytestream2_skip(&s->g, len - 2);",
          "content_same": false
        },
        {
          "line": 1314,
          "old_api": "av_log",
          "new_api": "bytestream2_skip",
          "old_text": "av_log(s->avctx, AV_LOG_ERROR,\n                   \"error during processing marker segment %.4x\\n\", marker)",
          "new_text": "bytestream2_skip(&s->g, len - 2)",
          "old_line_content": "            av_log(s->avctx, AV_LOG_ERROR,",
          "new_line_content": "            bytestream2_skip(&s->g, len - 2);",
          "content_same": false
        },
        {
          "line": 1349,
          "old_api": "bytestream2_get_bytes_left",
          "new_api": "bytestream2_get_be32u",
          "old_text": "bytestream2_get_bytes_left(&s->g)",
          "new_text": "bytestream2_get_be32u(&s->g)",
          "old_line_content": "            if (bytestream2_get_bytes_left(&s->g) < atom_size - 8)",
          "new_line_content": "        atom      = bytestream2_get_be32u(&s->g);",
          "content_same": false
        },
        {
          "line": 1383,
          "old_api": "jp2_find_codestream",
          "new_api": "bytestream2_get_bytes_left",
          "old_text": "jp2_find_codestream(s)",
          "new_text": "bytestream2_get_bytes_left(&s->g)",
          "old_line_content": "        if (!jp2_find_codestream(s)) {",
          "new_line_content": "    if (bytestream2_get_bytes_left(&s->g) >= 12 &&",
          "content_same": false
        },
        {
          "line": 1384,
          "old_api": "av_log",
          "new_api": "bytestream2_get_be32u",
          "old_text": "av_log(avctx, AV_LOG_ERROR,\n                   \"Could not find Jpeg2000 codestream atom.\\n\")",
          "new_text": "bytestream2_get_be32u(&s->g)",
          "old_line_content": "            av_log(avctx, AV_LOG_ERROR,",
          "new_line_content": "       (bytestream2_get_be32u(&s->g) == 12) &&",
          "content_same": false
        },
        {
          "line": 1394,
          "old_api": "av_log",
          "new_api": "bytestream2_seek",
          "old_text": "av_log(avctx, AV_LOG_ERROR, \"SOC marker not present\\n\")",
          "new_text": "bytestream2_seek(&s->g, 0, SEEK_SET)",
          "old_line_content": "        av_log(avctx, AV_LOG_ERROR, \"SOC marker not present\\n\");",
          "new_line_content": "        bytestream2_seek(&s->g, 0, SEEK_SET);",
          "content_same": false
        },
        {
          "line": 1398,
          "old_api": "jpeg2000_read_main_headers",
          "new_api": "av_log",
          "old_text": "jpeg2000_read_main_headers(s)",
          "new_text": "av_log(avctx, AV_LOG_ERROR, \"SOC marker not present\\n\")",
          "old_line_content": "    if (ret = jpeg2000_read_main_headers(s))",
          "new_line_content": "        av_log(avctx, AV_LOG_ERROR, \"SOC marker not present\\n\");",
          "content_same": false
        },
        {
          "line": 1402,
          "old_api": "ff_thread_get_buffer",
          "new_api": "jpeg2000_read_main_headers",
          "old_text": "ff_thread_get_buffer(avctx, &frame, 0)",
          "new_text": "jpeg2000_read_main_headers(s)",
          "old_line_content": "    if ((ret = ff_thread_get_buffer(avctx, &frame, 0)) < 0) {",
          "new_line_content": "    if (ret = jpeg2000_read_main_headers(s))",
          "content_same": false
        },
        {
          "line": 1419,
          "old_api": "bytestream2_tell",
          "new_api": "jpeg2000_dec_cleanup",
          "old_text": "bytestream2_tell(&s->g)",
          "new_text": "jpeg2000_dec_cleanup(s)",
          "old_line_content": "    return bytestream2_tell(&s->g);",
          "new_line_content": "    jpeg2000_dec_cleanup(s);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 1152,
          "old_api": null,
          "new_api": "ff_dwt_decode",
          "old_text": null,
          "new_text": "ff_dwt_decode(&comp->dwt, codsty->transform == FF_DWT97 ? (void*)comp->f_data : (void*)comp->i_data)",
          "old_line_content": "    if (tile->codsty[0].mct)",
          "new_line_content": "        ff_dwt_decode(&comp->dwt, codsty->transform == FF_DWT97 ? (void*)comp->f_data : (void*)comp->i_data);",
          "content_same": false
        },
        {
          "line": 1281,
          "old_api": null,
          "new_api": "get_siz",
          "old_text": null,
          "new_text": "get_siz(s)",
          "old_line_content": "            break;",
          "new_line_content": "            ret = get_siz(s);",
          "content_same": false
        },
        {
          "line": 1284,
          "old_api": null,
          "new_api": "get_coc",
          "old_text": null,
          "new_text": "get_coc(s, codsty, properties)",
          "old_line_content": "            break;",
          "new_line_content": "            ret = get_coc(s, codsty, properties);",
          "content_same": false
        },
        {
          "line": 1157,
          "old_api": null,
          "new_api": "mct_decode",
          "old_text": null,
          "new_text": "mct_decode(s, tile)",
          "old_line_content": "            Jpeg2000Component *comp = tile->comp + compno;",
          "new_line_content": "        mct_decode(s, tile);",
          "content_same": false
        },
        {
          "line": 1413,
          "old_api": null,
          "new_api": "jpeg2000_read_bitstream_packets",
          "old_text": null,
          "new_text": "jpeg2000_read_bitstream_packets(s)",
          "old_line_content": "            goto end;",
          "new_line_content": "    if (ret = jpeg2000_read_bitstream_packets(s))",
          "content_same": false
        },
        {
          "line": 1287,
          "old_api": null,
          "new_api": "get_cod",
          "old_text": null,
          "new_text": "get_cod(s, codsty, properties)",
          "old_line_content": "            break;",
          "new_line_content": "            ret = get_cod(s, codsty, properties);",
          "content_same": false
        },
        {
          "line": 1416,
          "old_api": null,
          "new_api": "jpeg2000_decode_tile",
          "old_text": null,
          "new_text": "jpeg2000_decode_tile(s, s->tile + tileno, picture)",
          "old_line_content": "",
          "new_line_content": "        if (ret = jpeg2000_decode_tile(s, s->tile + tileno, picture))",
          "content_same": false
        },
        {
          "line": 1290,
          "old_api": null,
          "new_api": "get_qcc",
          "old_text": null,
          "new_text": "get_qcc(s, len, qntsty, properties)",
          "old_line_content": "            break;",
          "new_line_content": "            ret = get_qcc(s, len, qntsty, properties);",
          "content_same": false
        },
        {
          "line": 1293,
          "old_api": null,
          "new_api": "get_qcd",
          "old_text": null,
          "new_text": "get_qcd(s, len, qntsty, properties)",
          "old_line_content": "                codsty = s->tile[s->curtileno].codsty;",
          "new_line_content": "            ret = get_qcd(s, len, qntsty, properties);",
          "content_same": false
        },
        {
          "line": 1423,
          "old_api": null,
          "new_api": "bytestream2_tell",
          "old_text": null,
          "new_text": "bytestream2_tell(&s->g)",
          "old_line_content": "    return ret;",
          "new_line_content": "    return bytestream2_tell(&s->g);",
          "content_same": false
        },
        {
          "line": 1296,
          "old_api": null,
          "new_api": "get_sot",
          "old_text": null,
          "new_text": "get_sot(s, len)",
          "old_line_content": "            }",
          "new_line_content": "            if (!(ret = get_sot(s, len))) {",
          "content_same": false
        },
        {
          "line": 1426,
          "old_api": null,
          "new_api": "jpeg2000_dec_cleanup",
          "old_text": null,
          "new_text": "jpeg2000_dec_cleanup(s)",
          "old_line_content": "static void jpeg2000_init_static_data(AVCodec *codec)",
          "new_line_content": "    jpeg2000_dec_cleanup(s);",
          "content_same": false
        },
        {
          "line": 1176,
          "old_api": null,
          "new_api": "lrintf",
          "old_text": null,
          "new_text": "lrintf(*datap)",
          "old_line_content": "                    *dst = val << (8 - s->cbps[compno]);",
          "new_line_content": "                        val = lrintf(*datap) + (1 << (s->cbps[compno] - 1));",
          "content_same": false
        },
        {
          "line": 1432,
          "old_api": null,
          "new_api": "ff_jpeg2000_init_tier1_luts",
          "old_text": null,
          "new_text": "ff_jpeg2000_init_tier1_luts()",
          "old_line_content": "#define VD AV_OPT_FLAG_VIDEO_PARAM | AV_OPT_FLAG_DECODING_PARAM",
          "new_line_content": "    ff_jpeg2000_init_tier1_luts();",
          "content_same": false
        },
        {
          "line": 1179,
          "old_api": null,
          "new_api": "av_clip",
          "old_text": null,
          "new_text": "av_clip(val, 0, (1 << s->cbps[compno]) - 1)",
          "old_line_content": "                    dst += s->ncomponents;",
          "new_line_content": "                    val = av_clip(val, 0, (1 << s->cbps[compno]) - 1);",
          "content_same": false
        },
        {
          "line": 1308,
          "old_api": null,
          "new_api": "get_tlm",
          "old_text": null,
          "new_text": "get_tlm(s, len)",
          "old_line_content": "                   \"unsupported marker 0x%.4X at pos 0x%X\\n\",",
          "new_line_content": "            ret = get_tlm(s, len);",
          "content_same": false
        },
        {
          "line": 1311,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(s->avctx, AV_LOG_ERROR,\n                   \"unsupported marker 0x%.4X at pos 0x%X\\n\",\n                   marker, bytestream2_tell(&s->g) - 4)",
          "old_line_content": "            break;",
          "new_line_content": "            av_log(s->avctx, AV_LOG_ERROR,",
          "content_same": false
        },
        {
          "line": 1440,
          "old_api": null,
          "new_api": "OFFSET",
          "old_text": null,
          "new_text": "OFFSET(reduction_factor)",
          "old_line_content": "static const AVProfile profiles[] = {",
          "new_line_content": "        OFFSET(reduction_factor), AV_OPT_TYPE_INT, { .i64 = 0 }, 0, JPEG2000_MAX_RESLEVELS - 1, VD },",
          "content_same": false
        },
        {
          "line": 1317,
          "old_api": null,
          "new_api": "bytestream2_tell",
          "old_text": null,
          "new_text": "bytestream2_tell(&s->g)",
          "old_line_content": "        }",
          "new_line_content": "        if (bytestream2_tell(&s->g) - oldpos != len || ret) {",
          "content_same": false
        },
        {
          "line": 1318,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(s->avctx, AV_LOG_ERROR,\n                   \"error during processing marker segment %.4x\\n\", marker)",
          "old_line_content": "    }",
          "new_line_content": "            av_log(s->avctx, AV_LOG_ERROR,",
          "content_same": false
        },
        {
          "line": 1332,
          "old_api": null,
          "new_api": "init_tile",
          "old_text": null,
          "new_text": "init_tile(s, s->curtileno)",
          "old_line_content": "",
          "new_line_content": "    if (ret = init_tile(s, s->curtileno))",
          "content_same": false
        },
        {
          "line": 1205,
          "old_api": null,
          "new_api": "lrintf",
          "old_text": null,
          "new_text": "lrintf(*datap)",
          "old_line_content": "                    /* align 12 bit values in little-endian mode */",
          "new_line_content": "                        val = lrintf(*datap) + (1 << (s->cbps[compno] - 1));",
          "content_same": false
        },
        {
          "line": 1334,
          "old_api": null,
          "new_api": "jpeg2000_decode_packets",
          "old_text": null,
          "new_text": "jpeg2000_decode_packets(s, tile)",
          "old_line_content": "}",
          "new_line_content": "    if (ret = jpeg2000_decode_packets(s, tile))",
          "content_same": false
        },
        {
          "line": 1462,
          "old_api": null,
          "new_api": "NULL_IF_CONFIG_SMALL",
          "old_text": null,
          "new_text": "NULL_IF_CONFIG_SMALL(\"JPEG 2000\")",
          "old_line_content": "    .priv_data_size   = sizeof(Jpeg2000DecoderContext),",
          "new_line_content": "    .long_name        = NULL_IF_CONFIG_SMALL(\"JPEG 2000\"),",
          "content_same": false
        },
        {
          "line": 1208,
          "old_api": null,
          "new_api": "av_clip",
          "old_text": null,
          "new_text": "av_clip(val, 0, (1 << s->cbps[compno]) - 1)",
          "old_line_content": "                    i_datap++;",
          "new_line_content": "                    val = av_clip(val, 0, (1 << s->cbps[compno]) - 1);",
          "content_same": false
        },
        {
          "line": 1470,
          "old_api": null,
          "new_api": "NULL_IF_CONFIG_SMALL",
          "old_text": null,
          "new_text": "NULL_IF_CONFIG_SMALL(profiles)",
          "old_line_content": "",
          "new_line_content": "    .profiles         = NULL_IF_CONFIG_SMALL(profiles)",
          "content_same": false
        },
        {
          "line": 1347,
          "old_api": null,
          "new_api": "bytestream2_get_bytes_left",
          "old_text": null,
          "new_text": "bytestream2_get_bytes_left(&s->g)",
          "old_line_content": "            found_codestream = 1;",
          "new_line_content": "          bytestream2_get_bytes_left(&s->g) >= 8) {",
          "content_same": false
        },
        {
          "line": 1348,
          "old_api": null,
          "new_api": "bytestream2_get_be32u",
          "old_text": null,
          "new_text": "bytestream2_get_be32u(&s->g)",
          "old_line_content": "        } else {",
          "new_line_content": "        atom_size = bytestream2_get_be32u(&s->g);",
          "content_same": false
        },
        {
          "line": 1353,
          "old_api": null,
          "new_api": "bytestream2_get_bytes_left",
          "old_text": null,
          "new_text": "bytestream2_get_bytes_left(&s->g)",
          "old_line_content": "        }",
          "new_line_content": "            if (bytestream2_get_bytes_left(&s->g) < atom_size - 8)",
          "content_same": false
        },
        {
          "line": 1355,
          "old_api": null,
          "new_api": "bytestream2_skipu",
          "old_text": null,
          "new_text": "bytestream2_skipu(&s->g, atom_size - 8)",
          "old_line_content": "",
          "new_line_content": "            bytestream2_skipu(&s->g, atom_size - 8);",
          "content_same": false
        },
        {
          "line": 1232,
          "old_api": null,
          "new_api": "av_freep",
          "old_text": null,
          "new_text": "av_freep(&s->tile[tileno].comp)",
          "old_line_content": "",
          "new_line_content": "        av_freep(&s->tile[tileno].comp);",
          "content_same": false
        },
        {
          "line": 1234,
          "old_api": null,
          "new_api": "av_freep",
          "old_text": null,
          "new_text": "av_freep(&s->tile)",
          "old_line_content": "{",
          "new_line_content": "    av_freep(&s->tile);",
          "content_same": false
        },
        {
          "line": 1374,
          "old_api": null,
          "new_api": "bytestream2_init",
          "old_text": null,
          "new_text": "bytestream2_init(&s->g, avpkt->data, avpkt->size)",
          "old_line_content": "        ret = AVERROR_INVALIDDATA;",
          "new_line_content": "    bytestream2_init(&s->g, avpkt->data, avpkt->size);",
          "content_same": false
        },
        {
          "line": 1248,
          "old_api": null,
          "new_api": "bytestream2_get_bytes_left",
          "old_text": null,
          "new_text": "bytestream2_get_bytes_left(&s->g)",
          "old_line_content": "",
          "new_line_content": "        if (bytestream2_get_bytes_left(&s->g) < 2) {",
          "content_same": false
        },
        {
          "line": 1377,
          "old_api": null,
          "new_api": "bytestream2_get_bytes_left",
          "old_text": null,
          "new_text": "bytestream2_get_bytes_left(&s->g)",
          "old_line_content": "",
          "new_line_content": "    if (bytestream2_get_bytes_left(&s->g) < 2) {",
          "content_same": false
        },
        {
          "line": 1253,
          "old_api": null,
          "new_api": "bytestream2_get_be16u",
          "old_text": null,
          "new_text": "bytestream2_get_be16u(&s->g)",
          "old_line_content": "            Jpeg2000Tile *tile;",
          "new_line_content": "        marker = bytestream2_get_be16u(&s->g);",
          "content_same": false
        },
        {
          "line": 1254,
          "old_api": null,
          "new_api": "bytestream2_tell",
          "old_text": null,
          "new_text": "bytestream2_tell(&s->g)",
          "old_line_content": "            Jpeg2000TilePart *tp;",
          "new_line_content": "        oldpos = bytestream2_tell(&s->g);",
          "content_same": false
        },
        {
          "line": 1385,
          "old_api": null,
          "new_api": "bytestream2_get_be32u",
          "old_text": null,
          "new_text": "bytestream2_get_be32u(&s->g)",
          "old_line_content": "                   \"Could not find Jpeg2000 codestream atom.\\n\");",
          "new_line_content": "       (bytestream2_get_be32u(&s->g) == JP2_SIG_TYPE) &&",
          "content_same": false
        },
        {
          "line": 1386,
          "old_api": null,
          "new_api": "bytestream2_get_be32u",
          "old_text": null,
          "new_text": "bytestream2_get_be32u(&s->g)",
          "old_line_content": "            ret = AVERROR_INVALIDDATA;",
          "new_line_content": "       (bytestream2_get_be32u(&s->g) == JP2_SIG_VALUE)) {",
          "content_same": false
        },
        {
          "line": 1387,
          "old_api": null,
          "new_api": "jp2_find_codestream",
          "old_text": null,
          "new_text": "jp2_find_codestream(s)",
          "old_line_content": "            goto end;",
          "new_line_content": "        if (!jp2_find_codestream(s)) {",
          "content_same": false
        },
        {
          "line": 1388,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(avctx, AV_LOG_ERROR,\n                   \"Could not find Jpeg2000 codestream atom.\\n\")",
          "old_line_content": "        }",
          "new_line_content": "            av_log(avctx, AV_LOG_ERROR,",
          "content_same": false
        },
        {
          "line": 1261,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(s->avctx, AV_LOG_ERROR, \"Missing SOT\\n\")",
          "old_line_content": "            tile = s->tile + s->curtileno;",
          "new_line_content": "                av_log(s->avctx, AV_LOG_ERROR, \"Missing SOT\\n\");",
          "content_same": false
        },
        {
          "line": 1134,
          "old_api": null,
          "new_api": "decode_cblk",
          "old_text": null,
          "new_text": "decode_cblk(s, codsty, &t1, cblk,\n                                    cblk->coord[0][1] - cblk->coord[0][0],\n                                    cblk->coord[1][1] - cblk->coord[1][0],\n                                    bandpos)",
          "old_line_content": "",
          "new_line_content": "                        decode_cblk(s, codsty, &t1, cblk,",
          "content_same": false
        },
        {
          "line": 1267,
          "old_api": null,
          "new_api": "bytestream2_init",
          "old_text": null,
          "new_text": "bytestream2_init(&tp->tpg, s->g.buffer, tp->tp_end - s->g.buffer)",
          "old_line_content": "        }",
          "new_line_content": "            bytestream2_init(&tp->tpg, s->g.buffer, tp->tp_end - s->g.buffer);",
          "content_same": false
        },
        {
          "line": 1268,
          "old_api": null,
          "new_api": "bytestream2_skip",
          "old_text": null,
          "new_text": "bytestream2_skip(&s->g, tp->tp_end - s->g.buffer)",
          "old_line_content": "        if (marker == JPEG2000_EOC)",
          "new_line_content": "            bytestream2_skip(&s->g, tp->tp_end - s->g.buffer);",
          "content_same": false
        },
        {
          "line": 1397,
          "old_api": null,
          "new_api": "bytestream2_get_be16u",
          "old_text": null,
          "new_text": "bytestream2_get_be16u(&s->g)",
          "old_line_content": "    }",
          "new_line_content": "    if (bytestream2_get_be16u(&s->g) != JPEG2000_SOC) {",
          "content_same": false
        },
        {
          "line": 1143,
          "old_api": null,
          "new_api": "dequantization_float",
          "old_text": null,
          "new_text": "dequantization_float(x, y, cblk, comp, &t1, band)",
          "old_line_content": "                } /*end prec */",
          "new_line_content": "                            dequantization_float(x, y, cblk, comp, &t1, band);",
          "content_same": false
        },
        {
          "line": 1145,
          "old_api": null,
          "new_api": "dequantization_int",
          "old_text": null,
          "new_text": "dequantization_int(x, y, cblk, comp, &t1, band)",
          "old_line_content": "        } /* end reslevel */",
          "new_line_content": "                            dequantization_int(x, y, cblk, comp, &t1, band);",
          "content_same": false
        },
        {
          "line": 1275,
          "old_api": null,
          "new_api": "bytestream2_get_be16u",
          "old_text": null,
          "new_text": "bytestream2_get_be16u(&s->g)",
          "old_line_content": "        switch (marker) {",
          "new_line_content": "        len = bytestream2_get_be16u(&s->g);",
          "content_same": false
        },
        {
          "line": 1276,
          "old_api": null,
          "new_api": "bytestream2_get_bytes_left",
          "old_text": null,
          "new_text": "bytestream2_get_bytes_left(&s->g)",
          "old_line_content": "        case JPEG2000_SIZ:",
          "new_line_content": "        if (len < 2 || bytestream2_get_bytes_left(&s->g) < len - 2)",
          "content_same": false
        },
        {
          "line": 1406,
          "old_api": null,
          "new_api": "ff_thread_get_buffer",
          "old_text": null,
          "new_text": "ff_thread_get_buffer(avctx, &frame, 0)",
          "old_line_content": "    picture->pict_type = AV_PICTURE_TYPE_I;",
          "new_line_content": "    if ((ret = ff_thread_get_buffer(avctx, &frame, 0)) < 0) {",
          "content_same": false
        },
        {
          "line": 1407,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(avctx, AV_LOG_ERROR, \"ff_thread_get_buffer() failed.\\n\")",
          "old_line_content": "    picture->key_frame = 1;",
          "new_line_content": "        av_log(avctx, AV_LOG_ERROR, \"ff_thread_get_buffer() failed.\\n\");",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 1280,
          "old_api": "get_coc",
          "new_api": null,
          "old_text": "get_coc(s, codsty, properties)",
          "new_text": null,
          "old_line_content": "            ret = get_coc(s, codsty, properties);",
          "new_line_content": "        case JPEG2000_SIZ:",
          "content_same": false
        },
        {
          "line": 1153,
          "old_api": "mct_decode",
          "new_api": null,
          "old_text": "mct_decode(s, tile)",
          "new_text": null,
          "old_line_content": "        mct_decode(s, tile);",
          "new_line_content": "    } /*end comp */",
          "content_same": false
        },
        {
          "line": 1409,
          "old_api": "jpeg2000_read_bitstream_packets",
          "new_api": null,
          "old_text": "jpeg2000_read_bitstream_packets(s)",
          "new_text": null,
          "old_line_content": "    if (ret = jpeg2000_read_bitstream_packets(s))",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1283,
          "old_api": "get_cod",
          "new_api": null,
          "old_text": "get_cod(s, codsty, properties)",
          "new_text": null,
          "old_line_content": "            ret = get_cod(s, codsty, properties);",
          "new_line_content": "        case JPEG2000_COC:",
          "content_same": false
        },
        {
          "line": 1412,
          "old_api": "jpeg2000_decode_tile",
          "new_api": null,
          "old_text": "jpeg2000_decode_tile(s, s->tile + tileno, picture)",
          "new_text": null,
          "old_line_content": "        if (ret = jpeg2000_decode_tile(s, s->tile + tileno, picture))",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1286,
          "old_api": "get_qcc",
          "new_api": null,
          "old_text": "get_qcc(s, len, qntsty, properties)",
          "new_text": null,
          "old_line_content": "            ret = get_qcc(s, len, qntsty, properties);",
          "new_line_content": "        case JPEG2000_COD:",
          "content_same": false
        },
        {
          "line": 1415,
          "old_api": "jpeg2000_dec_cleanup",
          "new_api": null,
          "old_text": "jpeg2000_dec_cleanup(s)",
          "new_text": null,
          "old_line_content": "    jpeg2000_dec_cleanup(s);",
          "new_line_content": "    for (tileno = 0; tileno < s->numXtiles * s->numYtiles; tileno++)",
          "content_same": false
        },
        {
          "line": 1289,
          "old_api": "get_qcd",
          "new_api": null,
          "old_text": "get_qcd(s, len, qntsty, properties)",
          "new_text": null,
          "old_line_content": "            ret = get_qcd(s, len, qntsty, properties);",
          "new_line_content": "        case JPEG2000_QCC:",
          "content_same": false
        },
        {
          "line": 1292,
          "old_api": "get_sot",
          "new_api": null,
          "old_text": "get_sot(s, len)",
          "new_text": null,
          "old_line_content": "            if (!(ret = get_sot(s, len))) {",
          "new_line_content": "        case JPEG2000_QCD:",
          "content_same": false
        },
        {
          "line": 1422,
          "old_api": "jpeg2000_dec_cleanup",
          "new_api": null,
          "old_text": "jpeg2000_dec_cleanup(s)",
          "new_text": null,
          "old_line_content": "    jpeg2000_dec_cleanup(s);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1172,
          "old_api": "lrintf",
          "new_api": null,
          "old_text": "lrintf(*datap)",
          "new_text": null,
          "old_line_content": "                        val = lrintf(*datap) + (1 << (s->cbps[compno] - 1));",
          "new_line_content": "                for (; x < tile->comp[compno].coord[0][1] - s->image_offset_x; x += s->cdx[compno]) {",
          "content_same": false
        },
        {
          "line": 1300,
          "old_api": "bytestream2_skip",
          "new_api": null,
          "old_text": "bytestream2_skip(&s->g, len - 2)",
          "new_text": null,
          "old_line_content": "            bytestream2_skip(&s->g, len - 2);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 1428,
          "old_api": "ff_jpeg2000_init_tier1_luts",
          "new_api": null,
          "old_text": "ff_jpeg2000_init_tier1_luts()",
          "new_text": null,
          "old_line_content": "    ff_jpeg2000_init_tier1_luts();",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 1175,
          "old_api": "av_clip",
          "new_api": null,
          "old_text": "av_clip(val, 0, (1 << s->cbps[compno]) - 1)",
          "new_text": null,
          "old_line_content": "                    val = av_clip(val, 0, (1 << s->cbps[compno]) - 1);",
          "new_line_content": "                    if (tile->codsty->transform == FF_DWT97)",
          "content_same": false
        },
        {
          "line": 1307,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(s->avctx, AV_LOG_ERROR,\n                   \"unsupported marker 0x%.4X at pos 0x%X\\n\",\n                   marker, bytestream2_tell(&s->g) - 4)",
          "new_text": null,
          "old_line_content": "            av_log(s->avctx, AV_LOG_ERROR,",
          "new_line_content": "            // Tile-part lengths",
          "content_same": false
        },
        {
          "line": 1436,
          "old_api": "OFFSET",
          "new_api": null,
          "old_text": "OFFSET(reduction_factor)",
          "new_text": null,
          "old_line_content": "        OFFSET(reduction_factor), AV_OPT_TYPE_INT, { .i64 = 0 }, 0, JPEG2000_MAX_RESLEVELS - 1, VD },",
          "new_line_content": "#define VD AV_OPT_FLAG_VIDEO_PARAM | AV_OPT_FLAG_DECODING_PARAM",
          "content_same": false
        },
        {
          "line": 1309,
          "old_api": "bytestream2_tell",
          "new_api": null,
          "old_text": "bytestream2_tell(&s->g)",
          "new_text": null,
          "old_line_content": "                   marker, bytestream2_tell(&s->g) - 4);",
          "new_line_content": "            break;",
          "content_same": false
        },
        {
          "line": 1310,
          "old_api": "bytestream2_skip",
          "new_api": null,
          "old_text": "bytestream2_skip(&s->g, len - 2)",
          "new_text": null,
          "old_line_content": "            bytestream2_skip(&s->g, len - 2);",
          "new_line_content": "        default:",
          "content_same": false
        },
        {
          "line": 1328,
          "old_api": "init_tile",
          "new_api": null,
          "old_text": "init_tile(s, s->curtileno)",
          "new_text": null,
          "old_line_content": "    if (ret = init_tile(s, s->curtileno))",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 1201,
          "old_api": "lrintf",
          "new_api": null,
          "old_text": "lrintf(*datap)",
          "new_text": null,
          "old_line_content": "                        val = lrintf(*datap) + (1 << (s->cbps[compno] - 1));",
          "new_line_content": "                for (; x < tile->comp[compno].coord[0][1] - s->image_offset_x; x += s-> cdx[compno]) {",
          "content_same": false
        },
        {
          "line": 1330,
          "old_api": "jpeg2000_decode_packets",
          "new_api": null,
          "old_text": "jpeg2000_decode_packets(s, tile)",
          "new_text": null,
          "old_line_content": "    if (ret = jpeg2000_decode_packets(s, tile))",
          "new_line_content": "    Jpeg2000Tile *tile = s->tile + s->curtileno;",
          "content_same": false
        },
        {
          "line": 1458,
          "old_api": "NULL_IF_CONFIG_SMALL",
          "new_api": null,
          "old_text": "NULL_IF_CONFIG_SMALL(\"JPEG 2000\")",
          "new_text": null,
          "old_line_content": "    .long_name        = NULL_IF_CONFIG_SMALL(\"JPEG 2000\"),",
          "new_line_content": "};",
          "content_same": false
        },
        {
          "line": 1204,
          "old_api": "av_clip",
          "new_api": null,
          "old_text": "av_clip(val, 0, (1 << s->cbps[compno]) - 1)",
          "new_text": null,
          "old_line_content": "                    val = av_clip(val, 0, (1 << s->cbps[compno]) - 1);",
          "new_line_content": "                    if (tile->codsty->transform == FF_DWT97)",
          "content_same": false
        },
        {
          "line": 1466,
          "old_api": "NULL_IF_CONFIG_SMALL",
          "new_api": null,
          "old_text": "NULL_IF_CONFIG_SMALL(profiles)",
          "new_text": null,
          "old_line_content": "    .profiles         = NULL_IF_CONFIG_SMALL(profiles)",
          "new_line_content": "    .priv_data_size   = sizeof(Jpeg2000DecoderContext),",
          "content_same": false
        },
        {
          "line": 1343,
          "old_api": "bytestream2_get_bytes_left",
          "new_api": null,
          "old_text": "bytestream2_get_bytes_left(&s->g)",
          "new_text": null,
          "old_line_content": "          bytestream2_get_bytes_left(&s->g) >= 8) {",
          "new_line_content": "    int found_codestream = 0, search_range = 10;",
          "content_same": false
        },
        {
          "line": 1344,
          "old_api": "bytestream2_get_be32u",
          "new_api": null,
          "old_text": "bytestream2_get_be32u(&s->g)",
          "new_text": null,
          "old_line_content": "        atom_size = bytestream2_get_be32u(&s->g);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1345,
          "old_api": "bytestream2_get_be32u",
          "new_api": null,
          "old_text": "bytestream2_get_be32u(&s->g)",
          "new_text": null,
          "old_line_content": "        atom      = bytestream2_get_be32u(&s->g);",
          "new_line_content": "    while(!found_codestream && search_range",
          "content_same": false
        },
        {
          "line": 1351,
          "old_api": "bytestream2_skipu",
          "new_api": null,
          "old_text": "bytestream2_skipu(&s->g, atom_size - 8)",
          "new_text": null,
          "old_line_content": "            bytestream2_skipu(&s->g, atom_size - 8);",
          "new_line_content": "            found_codestream = 1;",
          "content_same": false
        },
        {
          "line": 1226,
          "old_api": "ff_jpeg2000_cleanup",
          "new_api": null,
          "old_text": "ff_jpeg2000_cleanup(comp, codsty)",
          "new_text": null,
          "old_line_content": "            ff_jpeg2000_cleanup(comp, codsty);",
          "new_line_content": "        for (compno = 0; compno < s->ncomponents; compno++) {",
          "content_same": false
        },
        {
          "line": 1228,
          "old_api": "av_freep",
          "new_api": null,
          "old_text": "av_freep(&s->tile[tileno].comp)",
          "new_text": null,
          "old_line_content": "        av_freep(&s->tile[tileno].comp);",
          "new_line_content": "            Jpeg2000CodingStyle *codsty = s->tile[tileno].codsty + compno;",
          "content_same": false
        },
        {
          "line": 1370,
          "old_api": "bytestream2_init",
          "new_api": null,
          "old_text": "bytestream2_init(&s->g, avpkt->data, avpkt->size)",
          "new_text": null,
          "old_line_content": "    bytestream2_init(&s->g, avpkt->data, avpkt->size);",
          "new_line_content": "    AVFrame *picture = data;",
          "content_same": false
        },
        {
          "line": 1244,
          "old_api": "bytestream2_get_bytes_left",
          "new_api": null,
          "old_text": "bytestream2_get_bytes_left(&s->g)",
          "new_text": null,
          "old_line_content": "        if (bytestream2_get_bytes_left(&s->g) < 2) {",
          "new_line_content": "        int len, ret = 0;",
          "content_same": false
        },
        {
          "line": 1245,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(s->avctx, AV_LOG_ERROR, \"Missing EOC\\n\")",
          "new_text": null,
          "old_line_content": "            av_log(s->avctx, AV_LOG_ERROR, \"Missing EOC\\n\");",
          "new_line_content": "        uint16_t marker;",
          "content_same": false
        },
        {
          "line": 1373,
          "old_api": "bytestream2_get_bytes_left",
          "new_api": null,
          "old_text": "bytestream2_get_bytes_left(&s->g)",
          "new_text": null,
          "old_line_content": "    if (bytestream2_get_bytes_left(&s->g) < 2) {",
          "new_line_content": "    s->avctx     = avctx;",
          "content_same": false
        },
        {
          "line": 1250,
          "old_api": "bytestream2_tell",
          "new_api": null,
          "old_text": "bytestream2_tell(&s->g)",
          "new_text": null,
          "old_line_content": "        oldpos = bytestream2_tell(&s->g);",
          "new_line_content": "            break;",
          "content_same": false
        },
        {
          "line": 1379,
          "old_api": "bytestream2_get_bytes_left",
          "new_api": null,
          "old_text": "bytestream2_get_bytes_left(&s->g)",
          "new_text": null,
          "old_line_content": "    if (bytestream2_get_bytes_left(&s->g) >= 12 &&",
          "new_line_content": "        goto end;",
          "content_same": false
        },
        {
          "line": 1380,
          "old_api": "bytestream2_get_be32u",
          "new_api": null,
          "old_text": "bytestream2_get_be32u(&s->g)",
          "new_text": null,
          "old_line_content": "       (bytestream2_get_be32u(&s->g) == 12) &&",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1381,
          "old_api": "bytestream2_get_be32u",
          "new_api": null,
          "old_text": "bytestream2_get_be32u(&s->g)",
          "new_text": null,
          "old_line_content": "       (bytestream2_get_be32u(&s->g) == JP2_SIG_TYPE) &&",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1382,
          "old_api": "bytestream2_get_be32u",
          "new_api": null,
          "old_text": "bytestream2_get_be32u(&s->g)",
          "new_text": null,
          "old_line_content": "       (bytestream2_get_be32u(&s->g) == JP2_SIG_VALUE)) {",
          "new_line_content": "    // check if the image is in jp2 format",
          "content_same": false
        },
        {
          "line": 1257,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(s->avctx, AV_LOG_ERROR, \"Missing SOT\\n\")",
          "new_text": null,
          "old_line_content": "                av_log(s->avctx, AV_LOG_ERROR, \"Missing SOT\\n\");",
          "new_line_content": "            Jpeg2000Tile *tile;",
          "content_same": false
        },
        {
          "line": 1130,
          "old_api": "decode_cblk",
          "new_api": null,
          "old_text": "decode_cblk(s, codsty, &t1, cblk,\n                                    cblk->coord[0][1] - cblk->coord[0][0],\n                                    cblk->coord[1][1] - cblk->coord[1][0],\n                                    bandpos)",
          "new_text": null,
          "old_line_content": "                        decode_cblk(s, codsty, &t1, cblk,",
          "new_line_content": "                    /* Loop on codeblocks */",
          "content_same": false
        },
        {
          "line": 1390,
          "old_api": "bytestream2_seek",
          "new_api": null,
          "old_text": "bytestream2_seek(&s->g, 0, SEEK_SET)",
          "new_text": null,
          "old_line_content": "        bytestream2_seek(&s->g, 0, SEEK_SET);",
          "new_line_content": "            ret = AVERROR_INVALIDDATA;",
          "content_same": false
        },
        {
          "line": 1263,
          "old_api": "bytestream2_init",
          "new_api": null,
          "old_text": "bytestream2_init(&tp->tpg, s->g.buffer, tp->tp_end - s->g.buffer)",
          "new_text": null,
          "old_line_content": "            bytestream2_init(&tp->tpg, s->g.buffer, tp->tp_end - s->g.buffer);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 1264,
          "old_api": "bytestream2_skip",
          "new_api": null,
          "old_text": "bytestream2_skip(&s->g, tp->tp_end - s->g.buffer)",
          "new_text": null,
          "old_line_content": "            bytestream2_skip(&s->g, tp->tp_end - s->g.buffer);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1393,
          "old_api": "bytestream2_get_be16u",
          "new_api": null,
          "old_text": "bytestream2_get_be16u(&s->g)",
          "new_text": null,
          "old_line_content": "    if (bytestream2_get_be16u(&s->g) != JPEG2000_SOC) {",
          "new_line_content": "    } else {",
          "content_same": false
        },
        {
          "line": 1139,
          "old_api": "dequantization_float",
          "new_api": null,
          "old_text": "dequantization_float(x, y, cblk, comp, &t1, band)",
          "new_text": null,
          "old_line_content": "                            dequantization_float(x, y, cblk, comp, &t1, band);",
          "new_line_content": "                        x = cblk->coord[0][0];",
          "content_same": false
        },
        {
          "line": 1141,
          "old_api": "dequantization_int",
          "new_api": null,
          "old_text": "dequantization_int(x, y, cblk, comp, &t1, band)",
          "new_text": null,
          "old_line_content": "                            dequantization_int(x, y, cblk, comp, &t1, band);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1271,
          "old_api": "bytestream2_get_be16u",
          "new_api": null,
          "old_text": "bytestream2_get_be16u(&s->g)",
          "new_text": null,
          "old_line_content": "        len = bytestream2_get_be16u(&s->g);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 1272,
          "old_api": "bytestream2_get_bytes_left",
          "new_api": null,
          "old_text": "bytestream2_get_bytes_left(&s->g)",
          "new_text": null,
          "old_line_content": "        if (len < 2 || bytestream2_get_bytes_left(&s->g) < len - 2)",
          "new_line_content": "        if (marker == JPEG2000_EOC)",
          "content_same": false
        },
        {
          "line": 1403,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(avctx, AV_LOG_ERROR, \"ff_thread_get_buffer() failed.\\n\")",
          "new_text": null,
          "old_line_content": "        av_log(avctx, AV_LOG_ERROR, \"ff_thread_get_buffer() failed.\\n\");",
          "new_line_content": "        goto end;",
          "content_same": false
        },
        {
          "line": 1148,
          "old_api": "ff_dwt_decode",
          "new_api": null,
          "old_text": "ff_dwt_decode(&comp->dwt, codsty->transform == FF_DWT97 ? (void*)comp->f_data : (void*)comp->i_data)",
          "new_text": null,
          "old_line_content": "        ff_dwt_decode(&comp->dwt, codsty->transform == FF_DWT97 ? (void*)comp->f_data : (void*)comp->i_data);",
          "new_line_content": "            } /* end band */",
          "content_same": false
        },
        {
          "line": 1277,
          "old_api": "get_siz",
          "new_api": null,
          "old_text": "get_siz(s)",
          "new_text": null,
          "old_line_content": "            ret = get_siz(s);",
          "new_line_content": "            return AVERROR_INVALIDDATA;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 11,
      "total_additions": 52,
      "total_deletions": 52,
      "total_api_changes": 115
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 4,
        "api_related_lines": 115,
        "non_api_lines": 4,
        "non_api_line_numbers": [
          1121,
          1122,
          1123,
          1124
        ]
      }
    },
    "api_calls_before": 225,
    "api_calls_after": 225,
    "diff_info": {
      "added_lines": 4,
      "removed_lines": 0,
      "total_diff_lines": 16
    }
  }
}