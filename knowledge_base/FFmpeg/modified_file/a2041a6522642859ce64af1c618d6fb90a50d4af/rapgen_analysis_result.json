{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/a2041a6522642859ce64af1c618d6fb90a50d4af",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/a2041a6522642859ce64af1c618d6fb90a50d4af/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/a2041a6522642859ce64af1c618d6fb90a50d4af/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/a2041a6522642859ce64af1c618d6fb90a50d4af/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 1059,
          "old_api": "av_frame_alloc",
          "new_api": "av_mallocz",
          "old_text": "av_frame_alloc()",
          "new_text": "av_mallocz(sizeof(*frame))",
          "old_line_content": "    frame->frame = av_frame_alloc();",
          "new_line_content": "    frame = av_mallocz(sizeof(*frame));",
          "content_same": false
        },
        {
          "line": 1061,
          "old_api": "av_freep",
          "new_api": "AVERROR",
          "old_text": "av_freep(&frame)",
          "new_text": "AVERROR(ENOMEM)",
          "old_line_content": "        av_freep(&frame);",
          "new_line_content": "        return AVERROR(ENOMEM);",
          "content_same": false
        },
        {
          "line": 1062,
          "old_api": "AVERROR",
          "new_api": "av_frame_alloc",
          "old_text": "AVERROR(ENOMEM)",
          "new_text": "av_frame_alloc()",
          "old_line_content": "        return AVERROR(ENOMEM);",
          "new_line_content": "    frame->frame = av_frame_alloc();",
          "content_same": false
        },
        {
          "line": 1190,
          "old_api": "AVERROR",
          "new_api": "av_mallocz",
          "old_text": "AVERROR(ENOMEM)",
          "new_text": "av_mallocz(sizeof(*bs))",
          "old_line_content": "        return AVERROR(ENOMEM);",
          "new_line_content": "    bs = av_mallocz(sizeof(*bs));",
          "content_same": false
        },
        {
          "line": 1198,
          "old_api": "av_packet_unref",
          "new_api": "av_mallocz",
          "old_text": "av_packet_unref(&new_pkt)",
          "new_text": "av_mallocz(sizeof(*sync))",
          "old_line_content": "        av_packet_unref(&new_pkt);",
          "new_line_content": "    sync = av_mallocz(sizeof(*sync));",
          "content_same": false
        },
        {
          "line": 1212,
          "old_api": "av_packet_unref",
          "new_api": "ff_qsv_print_warning",
          "old_text": "av_packet_unref(&new_pkt)",
          "new_text": "ff_qsv_print_warning(avctx, ret, \"Warning during encoding\")",
          "old_line_content": "        av_packet_unref(&new_pkt);",
          "new_line_content": "        ff_qsv_print_warning(avctx, ret, \"Warning during encoding\");",
          "content_same": false
        },
        {
          "line": 1216,
          "old_api": "ff_qsv_print_error",
          "new_api": "av_freep",
          "old_text": "ff_qsv_print_error(avctx, ret, \"Error during encoding\")",
          "new_text": "av_freep(&bs)",
          "old_line_content": "               0 : ff_qsv_print_error(avctx, ret, \"Error during encoding\");",
          "new_line_content": "        av_freep(&bs);",
          "content_same": false
        },
        {
          "line": 1223,
          "old_api": "av_fifo_generic_write",
          "new_api": "print_interlace_msg",
          "old_text": "av_fifo_generic_write(q->async_fifo, &new_pkt, sizeof(new_pkt), NULL)",
          "new_text": "print_interlace_msg(avctx, q)",
          "old_line_content": "        av_fifo_generic_write(q->async_fifo, &new_pkt, sizeof(new_pkt), NULL);",
          "new_line_content": "        print_interlace_msg(avctx, q);",
          "content_same": false
        },
        {
          "line": 1227,
          "old_api": "av_freep",
          "new_api": "av_fifo_generic_write",
          "old_text": "av_freep(&sync)",
          "new_text": "av_fifo_generic_write(q->async_fifo, &sync,    sizeof(sync),    NULL)",
          "old_line_content": "        av_freep(&sync);",
          "new_line_content": "        av_fifo_generic_write(q->async_fifo, &sync,    sizeof(sync),    NULL);",
          "content_same": false
        },
        {
          "line": 1228,
          "old_api": "av_packet_unref",
          "new_api": "av_fifo_generic_write",
          "old_text": "av_packet_unref(&new_pkt)",
          "new_text": "av_fifo_generic_write(q->async_fifo, &bs,      sizeof(bs),    NULL)",
          "old_line_content": "        av_packet_unref(&new_pkt);",
          "new_line_content": "        av_fifo_generic_write(q->async_fifo, &bs,      sizeof(bs),    NULL);",
          "content_same": false
        },
        {
          "line": 1255,
          "old_api": "MFXVideoCORE_SyncOperation",
          "new_api": "av_fifo_generic_read",
          "old_text": "MFXVideoCORE_SyncOperation(q->session, *sync, 1000)",
          "new_text": "av_fifo_generic_read(q->async_fifo, &bs,      sizeof(bs),      NULL)",
          "old_line_content": "            ret = MFXVideoCORE_SyncOperation(q->session, *sync, 1000);",
          "new_line_content": "        av_fifo_generic_read(q->async_fifo, &bs,      sizeof(bs),      NULL);",
          "content_same": false
        },
        {
          "line": 1258,
          "old_api": "av_rescale_q",
          "new_api": "MFXVideoCORE_SyncOperation",
          "old_text": "av_rescale_q(bs->DecodeTimeStamp, (AVRational){1, 90000}, avctx->time_base)",
          "new_text": "MFXVideoCORE_SyncOperation(q->session, *sync, 1000)",
          "old_line_content": "        new_pkt.dts  = av_rescale_q(bs->DecodeTimeStamp, (AVRational){1, 90000}, avctx->time_base);",
          "new_line_content": "            ret = MFXVideoCORE_SyncOperation(q->session, *sync, 1000);",
          "content_same": false
        },
        {
          "line": 1285,
          "old_api": "AVERROR",
          "new_api": "av_log",
          "old_text": "AVERROR(EINVAL)",
          "new_text": "av_log(avctx, AV_LOG_ERROR, \"Submitted buffer not large enough: %d < %d\\n\",\n                       pkt->size, new_pkt.size)",
          "old_line_content": "                return AVERROR(EINVAL);",
          "new_line_content": "                av_log(avctx, AV_LOG_ERROR, \"Submitted buffer not large enough: %d < %d\\n\",",
          "content_same": false
        },
        {
          "line": 1288,
          "old_api": "memcpy",
          "new_api": "AVERROR",
          "old_text": "memcpy(pkt->data, new_pkt.data, new_pkt.size)",
          "new_text": "AVERROR(EINVAL)",
          "old_line_content": "            memcpy(pkt->data, new_pkt.data, new_pkt.size);",
          "new_line_content": "                return AVERROR(EINVAL);",
          "content_same": false
        },
        {
          "line": 1291,
          "old_api": "av_packet_copy_props",
          "new_api": "memcpy",
          "old_text": "av_packet_copy_props(pkt, &new_pkt)",
          "new_text": "memcpy(pkt->data, new_pkt.data, new_pkt.size)",
          "old_line_content": "            ret = av_packet_copy_props(pkt, &new_pkt);",
          "new_line_content": "            memcpy(pkt->data, new_pkt.data, new_pkt.size);",
          "content_same": false
        },
        {
          "line": 1335,
          "old_api": "av_freep",
          "new_api": "av_fifo_generic_read",
          "old_text": "av_freep(&sync)",
          "new_text": "av_fifo_generic_read(q->async_fifo, &sync, sizeof(sync), NULL)",
          "old_line_content": "        av_freep(&sync);",
          "new_line_content": "        av_fifo_generic_read(q->async_fifo, &sync, sizeof(sync), NULL);",
          "content_same": false
        },
        {
          "line": 1336,
          "old_api": "av_freep",
          "new_api": "av_fifo_generic_read",
          "old_text": "av_freep(&bs)",
          "new_text": "av_fifo_generic_read(q->async_fifo, &bs,   sizeof(bs),   NULL)",
          "old_line_content": "        av_freep(&bs);",
          "new_line_content": "        av_fifo_generic_read(q->async_fifo, &bs,   sizeof(bs),   NULL);",
          "content_same": false
        },
        {
          "line": 1339,
          "old_api": "av_fifo_free",
          "new_api": "av_freep",
          "old_text": "av_fifo_free(q->async_fifo)",
          "new_text": "av_freep(&bs)",
          "old_line_content": "    av_fifo_free(q->async_fifo);",
          "new_line_content": "        av_freep(&bs);",
          "content_same": false
        },
        {
          "line": 1342,
          "old_api": "av_freep",
          "new_api": "av_fifo_free",
          "old_text": "av_freep(&q->opaque_surfaces)",
          "new_text": "av_fifo_free(q->async_fifo)",
          "old_line_content": "    av_freep(&q->opaque_surfaces);",
          "new_line_content": "    av_fifo_free(q->async_fifo);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 1281,
          "old_api": null,
          "new_api": "av_freep",
          "old_text": null,
          "new_text": "av_freep(&sync)",
          "old_line_content": "            if (pkt->size < new_pkt.size) {",
          "new_line_content": "        av_freep(&sync);",
          "content_same": false
        },
        {
          "line": 1287,
          "old_api": null,
          "new_api": "av_packet_unref",
          "old_text": null,
          "new_text": "av_packet_unref(&new_pkt)",
          "old_line_content": "",
          "new_line_content": "                av_packet_unref(&new_pkt);",
          "content_same": false
        },
        {
          "line": 1032,
          "old_api": null,
          "new_api": "av_frame_unref",
          "old_text": null,
          "new_text": "av_frame_unref(cur->frame)",
          "old_line_content": "        }",
          "new_line_content": "                av_frame_unref(cur->frame);",
          "content_same": false
        },
        {
          "line": 1160,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(avctx, AV_LOG_WARNING,\n                   \"Interlaced coding is supported\"\n                   \" at Main/High Profile Level 2.2-4.0\\n\")",
          "old_line_content": "    }",
          "new_line_content": "            av_log(avctx, AV_LOG_WARNING,",
          "content_same": false
        },
        {
          "line": 1294,
          "old_api": null,
          "new_api": "av_packet_copy_props",
          "old_text": null,
          "new_text": "av_packet_copy_props(pkt, &new_pkt)",
          "old_line_content": "                return ret;",
          "new_line_content": "            ret = av_packet_copy_props(pkt, &new_pkt);",
          "content_same": false
        },
        {
          "line": 1295,
          "old_api": null,
          "new_api": "av_packet_unref",
          "old_text": null,
          "new_text": "av_packet_unref(&new_pkt)",
          "old_line_content": "        } else",
          "new_line_content": "            av_packet_unref(&new_pkt);",
          "content_same": false
        },
        {
          "line": 1044,
          "old_api": null,
          "new_api": "clear_unused_frames",
          "old_text": null,
          "new_text": "clear_unused_frames(q)",
          "old_line_content": "    last  = &q->work_frames;",
          "new_line_content": "    clear_unused_frames(q);",
          "content_same": false
        },
        {
          "line": 1177,
          "old_api": null,
          "new_api": "submit_frame",
          "old_text": null,
          "new_text": "submit_frame(q, frame, &surf)",
          "old_line_content": "            return ret;",
          "new_line_content": "        ret = submit_frame(q, frame, &surf);",
          "content_same": false
        },
        {
          "line": 1179,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(avctx, AV_LOG_ERROR, \"Error submitting the frame for encoding.\\n\")",
          "old_line_content": "    }",
          "new_line_content": "            av_log(avctx, AV_LOG_ERROR, \"Error submitting the frame for encoding.\\n\");",
          "content_same": false
        },
        {
          "line": 1184,
          "old_api": null,
          "new_api": "av_new_packet",
          "old_text": null,
          "new_text": "av_new_packet(&new_pkt, q->packet_size)",
          "old_line_content": "        return ret;",
          "new_line_content": "    ret = av_new_packet(&new_pkt, q->packet_size);",
          "content_same": false
        },
        {
          "line": 1312,
          "old_api": null,
          "new_api": "MFXVideoENCODE_Close",
          "old_text": null,
          "new_text": "MFXVideoENCODE_Close(q->session)",
          "old_line_content": "    q->session          = NULL;",
          "new_line_content": "        MFXVideoENCODE_Close(q->session);",
          "content_same": false
        },
        {
          "line": 1186,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(avctx, AV_LOG_ERROR, \"Error allocating the output packet\\n\")",
          "old_line_content": "",
          "new_line_content": "        av_log(avctx, AV_LOG_ERROR, \"Error allocating the output packet\\n\");",
          "content_same": false
        },
        {
          "line": 1314,
          "old_api": null,
          "new_api": "MFXClose",
          "old_text": null,
          "new_text": "MFXClose(q->internal_session)",
          "old_line_content": "",
          "new_line_content": "        MFXClose(q->internal_session);",
          "content_same": false
        },
        {
          "line": 1318,
          "old_api": null,
          "new_api": "av_buffer_unref",
          "old_text": null,
          "new_text": "av_buffer_unref(&q->frames_ctx.hw_frames_ctx)",
          "old_line_content": "    cur = q->work_frames;",
          "new_line_content": "    av_buffer_unref(&q->frames_ctx.hw_frames_ctx);",
          "content_same": false
        },
        {
          "line": 1319,
          "old_api": null,
          "new_api": "av_buffer_unref",
          "old_text": null,
          "new_text": "av_buffer_unref(&q->frames_ctx.mids_buf)",
          "old_line_content": "    while (cur) {",
          "new_line_content": "    av_buffer_unref(&q->frames_ctx.mids_buf);",
          "content_same": false
        },
        {
          "line": 1064,
          "old_api": null,
          "new_api": "av_freep",
          "old_text": null,
          "new_text": "av_freep(&frame)",
          "old_line_content": "    *last = frame;",
          "new_line_content": "        av_freep(&frame);",
          "content_same": false
        },
        {
          "line": 1065,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(ENOMEM)",
          "old_line_content": "",
          "new_line_content": "        return AVERROR(ENOMEM);",
          "content_same": false
        },
        {
          "line": 1192,
          "old_api": null,
          "new_api": "av_packet_unref",
          "old_text": null,
          "new_text": "av_packet_unref(&new_pkt)",
          "old_line_content": "    bs->Data      = new_pkt.data;",
          "new_line_content": "        av_packet_unref(&new_pkt);",
          "content_same": false
        },
        {
          "line": 1193,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(ENOMEM)",
          "old_line_content": "    bs->MaxLength = new_pkt.size;",
          "new_line_content": "        return AVERROR(ENOMEM);",
          "content_same": false
        },
        {
          "line": 1324,
          "old_api": null,
          "new_api": "av_frame_free",
          "old_text": null,
          "new_text": "av_frame_free(&cur->frame)",
          "old_line_content": "    }",
          "new_line_content": "        av_frame_free(&cur->frame);",
          "content_same": false
        },
        {
          "line": 1325,
          "old_api": null,
          "new_api": "av_freep",
          "old_text": null,
          "new_text": "av_freep(&cur)",
          "old_line_content": "",
          "new_line_content": "        av_freep(&cur);",
          "content_same": false
        },
        {
          "line": 1200,
          "old_api": null,
          "new_api": "av_freep",
          "old_text": null,
          "new_text": "av_freep(&bs)",
          "old_line_content": "    }",
          "new_line_content": "        av_freep(&bs);",
          "content_same": false
        },
        {
          "line": 1201,
          "old_api": null,
          "new_api": "av_packet_unref",
          "old_text": null,
          "new_text": "av_packet_unref(&new_pkt)",
          "old_line_content": "",
          "new_line_content": "        av_packet_unref(&new_pkt);",
          "content_same": false
        },
        {
          "line": 1202,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(ENOMEM)",
          "old_line_content": "    do {",
          "new_line_content": "        return AVERROR(ENOMEM);",
          "content_same": false
        },
        {
          "line": 1329,
          "old_api": null,
          "new_api": "av_fifo_size",
          "old_text": null,
          "new_text": "av_fifo_size(q->async_fifo)",
          "old_line_content": "        mfxBitstream *bs;",
          "new_line_content": "    while (q->async_fifo && av_fifo_size(q->async_fifo)) {",
          "content_same": false
        },
        {
          "line": 1206,
          "old_api": null,
          "new_api": "MFXVideoENCODE_EncodeFrameAsync",
          "old_text": null,
          "new_text": "MFXVideoENCODE_EncodeFrameAsync(q->session, NULL, surf, bs, sync)",
          "old_line_content": "    } while (ret == MFX_WRN_DEVICE_BUSY || ret == MFX_WRN_IN_EXECUTION);",
          "new_line_content": "        ret = MFXVideoENCODE_EncodeFrameAsync(q->session, NULL, surf, bs, sync);",
          "content_same": false
        },
        {
          "line": 1334,
          "old_api": null,
          "new_api": "av_fifo_generic_read",
          "old_text": null,
          "new_text": "av_fifo_generic_read(q->async_fifo, &pkt,  sizeof(pkt),  NULL)",
          "old_line_content": "",
          "new_line_content": "        av_fifo_generic_read(q->async_fifo, &pkt,  sizeof(pkt),  NULL);",
          "content_same": false
        },
        {
          "line": 1208,
          "old_api": null,
          "new_api": "av_usleep",
          "old_text": null,
          "new_text": "av_usleep(1)",
          "old_line_content": "    if (ret > 0)",
          "new_line_content": "            av_usleep(1);",
          "content_same": false
        },
        {
          "line": 1081,
          "old_api": null,
          "new_api": "get_free_frame",
          "old_text": null,
          "new_text": "get_free_frame(q, &qf)",
          "old_line_content": "",
          "new_line_content": "    ret = get_free_frame(q, &qf);",
          "content_same": false
        },
        {
          "line": 1338,
          "old_api": null,
          "new_api": "av_freep",
          "old_text": null,
          "new_text": "av_freep(&sync)",
          "old_line_content": "    }",
          "new_line_content": "        av_freep(&sync);",
          "content_same": false
        },
        {
          "line": 1340,
          "old_api": null,
          "new_api": "av_packet_unref",
          "old_text": null,
          "new_text": "av_packet_unref(&pkt)",
          "old_line_content": "    q->async_fifo = NULL;",
          "new_line_content": "        av_packet_unref(&pkt);",
          "content_same": false
        },
        {
          "line": 1086,
          "old_api": null,
          "new_api": "av_frame_ref",
          "old_text": null,
          "new_text": "av_frame_ref(qf->frame, frame)",
          "old_line_content": "",
          "new_line_content": "        ret = av_frame_ref(qf->frame, frame);",
          "content_same": false
        },
        {
          "line": 1215,
          "old_api": null,
          "new_api": "av_packet_unref",
          "old_text": null,
          "new_text": "av_packet_unref(&new_pkt)",
          "old_line_content": "        return (ret == MFX_ERR_MORE_DATA) ?",
          "new_line_content": "        av_packet_unref(&new_pkt);",
          "content_same": false
        },
        {
          "line": 1217,
          "old_api": null,
          "new_api": "av_freep",
          "old_text": null,
          "new_text": "av_freep(&sync)",
          "old_line_content": "    }",
          "new_line_content": "        av_freep(&sync);",
          "content_same": false
        },
        {
          "line": 1346,
          "old_api": null,
          "new_api": "av_buffer_unref",
          "old_text": null,
          "new_text": "av_buffer_unref(&q->opaque_alloc_buf)",
          "old_line_content": "",
          "new_line_content": "    av_buffer_unref(&q->opaque_alloc_buf);",
          "content_same": false
        },
        {
          "line": 1219,
          "old_api": null,
          "new_api": "ff_qsv_print_error",
          "old_text": null,
          "new_text": "ff_qsv_print_error(avctx, ret, \"Error during encoding\")",
          "old_line_content": "    if (ret == MFX_WRN_INCOMPATIBLE_VIDEO_PARAM && frame->interlaced_frame)",
          "new_line_content": "               0 : ff_qsv_print_error(avctx, ret, \"Error during encoding\");",
          "content_same": false
        },
        {
          "line": 1348,
          "old_api": null,
          "new_api": "av_freep",
          "old_text": null,
          "new_text": "av_freep(&q->extparam)",
          "old_line_content": "}",
          "new_line_content": "    av_freep(&q->extparam);",
          "content_same": false
        },
        {
          "line": 1093,
          "old_api": null,
          "new_api": "ff_qsv_find_surface_idx",
          "old_text": null,
          "new_text": "ff_qsv_find_surface_idx(&q->frames_ctx, qf)",
          "old_line_content": "",
          "new_line_content": "            ret = ff_qsv_find_surface_idx(&q->frames_ctx, qf);",
          "content_same": false
        },
        {
          "line": 1226,
          "old_api": null,
          "new_api": "av_fifo_generic_write",
          "old_text": null,
          "new_text": "av_fifo_generic_write(q->async_fifo, &new_pkt, sizeof(new_pkt), NULL)",
          "old_line_content": "    } else {",
          "new_line_content": "        av_fifo_generic_write(q->async_fifo, &new_pkt, sizeof(new_pkt), NULL);",
          "content_same": false
        },
        {
          "line": 1230,
          "old_api": null,
          "new_api": "av_freep",
          "old_text": null,
          "new_text": "av_freep(&sync)",
          "old_line_content": "    }",
          "new_line_content": "        av_freep(&sync);",
          "content_same": false
        },
        {
          "line": 1103,
          "old_api": null,
          "new_api": "FFALIGN",
          "old_text": null,
          "new_text": "FFALIGN(qf->frame->height, q->height_align)",
          "old_line_content": "",
          "new_line_content": "            (frame->data[1] - frame->data[0] != frame->linesize[0] * FFALIGN(qf->frame->height, q->height_align))) {",
          "content_same": false
        },
        {
          "line": 1104,
          "old_api": null,
          "new_api": "FFALIGN",
          "old_text": null,
          "new_text": "FFALIGN(frame->height, q->height_align)",
          "old_line_content": "            qf->frame->format = frame->format;",
          "new_line_content": "            qf->frame->height = FFALIGN(frame->height, q->height_align);",
          "content_same": false
        },
        {
          "line": 1105,
          "old_api": null,
          "new_api": "FFALIGN",
          "old_text": null,
          "new_text": "FFALIGN(frame->width, q->width_align)",
          "old_line_content": "",
          "new_line_content": "            qf->frame->width  = FFALIGN(frame->width, q->width_align);",
          "content_same": false
        },
        {
          "line": 1231,
          "old_api": null,
          "new_api": "av_packet_unref",
          "old_text": null,
          "new_text": "av_packet_unref(&new_pkt)",
          "old_line_content": "",
          "new_line_content": "        av_packet_unref(&new_pkt);",
          "content_same": false
        },
        {
          "line": 1232,
          "old_api": null,
          "new_api": "av_freep",
          "old_text": null,
          "new_text": "av_freep(&bs)",
          "old_line_content": "    return 0;",
          "new_line_content": "        av_freep(&bs);",
          "content_same": false
        },
        {
          "line": 1110,
          "old_api": null,
          "new_api": "av_frame_get_buffer",
          "old_text": null,
          "new_text": "av_frame_get_buffer(qf->frame, q->width_align)",
          "old_line_content": "            }",
          "new_line_content": "                ret = av_frame_get_buffer(qf->frame, q->width_align);",
          "content_same": false
        },
        {
          "line": 1243,
          "old_api": null,
          "new_api": "encode_frame",
          "old_text": null,
          "new_text": "encode_frame(avctx, q, frame)",
          "old_line_content": "",
          "new_line_content": "    ret = encode_frame(avctx, q, frame);",
          "content_same": false
        },
        {
          "line": 1118,
          "old_api": null,
          "new_api": "av_frame_copy",
          "old_text": null,
          "new_text": "av_frame_copy(qf->frame, frame)",
          "old_line_content": "                return ret;",
          "new_line_content": "            ret = av_frame_copy(qf->frame, frame);",
          "content_same": false
        },
        {
          "line": 1247,
          "old_api": null,
          "new_api": "qsv_fifo_size",
          "old_text": null,
          "new_text": "qsv_fifo_size(q->async_fifo)",
          "old_line_content": "        mfxBitstream *bs;",
          "new_line_content": "    if ((qsv_fifo_size(q->async_fifo) >= q->async_depth) ||",
          "content_same": false
        },
        {
          "line": 1120,
          "old_api": null,
          "new_api": "av_frame_unref",
          "old_text": null,
          "new_text": "av_frame_unref(qf->frame)",
          "old_line_content": "        } else {",
          "new_line_content": "                av_frame_unref(qf->frame);",
          "content_same": false
        },
        {
          "line": 1248,
          "old_api": null,
          "new_api": "av_fifo_size",
          "old_text": null,
          "new_text": "av_fifo_size(q->async_fifo)",
          "old_line_content": "        mfxSyncPoint *sync;",
          "new_line_content": "        (!frame && av_fifo_size(q->async_fifo))) {",
          "content_same": false
        },
        {
          "line": 1124,
          "old_api": null,
          "new_api": "av_frame_ref",
          "old_text": null,
          "new_text": "av_frame_ref(qf->frame, frame)",
          "old_line_content": "        }",
          "new_line_content": "            ret = av_frame_ref(qf->frame, frame);",
          "content_same": false
        },
        {
          "line": 1253,
          "old_api": null,
          "new_api": "av_fifo_generic_read",
          "old_text": null,
          "new_text": "av_fifo_generic_read(q->async_fifo, &new_pkt, sizeof(new_pkt), NULL)",
          "old_line_content": "",
          "new_line_content": "        av_fifo_generic_read(q->async_fifo, &new_pkt, sizeof(new_pkt), NULL);",
          "content_same": false
        },
        {
          "line": 1254,
          "old_api": null,
          "new_api": "av_fifo_generic_read",
          "old_text": null,
          "new_text": "av_fifo_generic_read(q->async_fifo, &sync,    sizeof(sync),    NULL)",
          "old_line_content": "        do {",
          "new_line_content": "        av_fifo_generic_read(q->async_fifo, &sync,    sizeof(sync),    NULL);",
          "content_same": false
        },
        {
          "line": 1261,
          "old_api": null,
          "new_api": "av_rescale_q",
          "old_text": null,
          "new_text": "av_rescale_q(bs->DecodeTimeStamp, (AVRational){1, 90000}, avctx->time_base)",
          "old_line_content": "",
          "new_line_content": "        new_pkt.dts  = av_rescale_q(bs->DecodeTimeStamp, (AVRational){1, 90000}, avctx->time_base);",
          "content_same": false
        },
        {
          "line": 1262,
          "old_api": null,
          "new_api": "av_rescale_q",
          "old_text": null,
          "new_text": "av_rescale_q(bs->TimeStamp,       (AVRational){1, 90000}, avctx->time_base)",
          "old_line_content": "        if (bs->FrameType & MFX_FRAMETYPE_IDR ||",
          "new_line_content": "        new_pkt.pts  = av_rescale_q(bs->TimeStamp,       (AVRational){1, 90000}, avctx->time_base);",
          "content_same": false
        },
        {
          "line": 1147,
          "old_api": null,
          "new_api": "av_rescale_q",
          "old_text": null,
          "new_text": "av_rescale_q(frame->pts, q->avctx->time_base, (AVRational){1, 90000})",
          "old_line_content": "",
          "new_line_content": "    qf->surface.Data.TimeStamp = av_rescale_q(frame->pts, q->avctx->time_base, (AVRational){1, 90000});",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 1282,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(avctx, AV_LOG_ERROR, \"Submitted buffer not large enough: %d < %d\\n\",\n                       pkt->size, new_pkt.size)",
          "new_text": null,
          "old_line_content": "                av_log(avctx, AV_LOG_ERROR, \"Submitted buffer not large enough: %d < %d\\n\",",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1284,
          "old_api": "av_packet_unref",
          "new_api": null,
          "old_text": "av_packet_unref(&new_pkt)",
          "new_text": null,
          "old_line_content": "                av_packet_unref(&new_pkt);",
          "new_line_content": "            if (pkt->size < new_pkt.size) {",
          "content_same": false
        },
        {
          "line": 1157,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(avctx, AV_LOG_WARNING,\n                   \"Interlaced coding is supported\"\n                   \" at Main/High Profile Level 2.2-4.0\\n\")",
          "new_text": null,
          "old_line_content": "            av_log(avctx, AV_LOG_WARNING,",
          "new_line_content": "        if (q->param.mfx.CodecProfile == MFX_PROFILE_AVC_BASELINE ||",
          "content_same": false
        },
        {
          "line": 1292,
          "old_api": "av_packet_unref",
          "new_api": null,
          "old_text": "av_packet_unref(&new_pkt)",
          "new_text": null,
          "old_line_content": "            av_packet_unref(&new_pkt);",
          "new_line_content": "            pkt->size = new_pkt.size;",
          "content_same": false
        },
        {
          "line": 1041,
          "old_api": "clear_unused_frames",
          "new_api": null,
          "old_text": "clear_unused_frames(q)",
          "new_text": null,
          "old_line_content": "    clear_unused_frames(q);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 1174,
          "old_api": "submit_frame",
          "new_api": null,
          "old_text": "submit_frame(q, frame, &surf)",
          "new_text": null,
          "old_line_content": "        ret = submit_frame(q, frame, &surf);",
          "new_line_content": "    int ret;",
          "content_same": false
        },
        {
          "line": 1176,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(avctx, AV_LOG_ERROR, \"Error submitting the frame for encoding.\\n\")",
          "new_text": null,
          "old_line_content": "            av_log(avctx, AV_LOG_ERROR, \"Error submitting the frame for encoding.\\n\");",
          "new_line_content": "    if (frame) {",
          "content_same": false
        },
        {
          "line": 1181,
          "old_api": "av_new_packet",
          "new_api": null,
          "old_text": "av_new_packet(&new_pkt, q->packet_size)",
          "new_text": null,
          "old_line_content": "    ret = av_new_packet(&new_pkt, q->packet_size);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 1309,
          "old_api": "MFXVideoENCODE_Close",
          "new_api": null,
          "old_text": "MFXVideoENCODE_Close(q->session)",
          "new_text": null,
          "old_line_content": "        MFXVideoENCODE_Close(q->session);",
          "new_line_content": "    QSVFrame *cur;",
          "content_same": false
        },
        {
          "line": 1183,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(avctx, AV_LOG_ERROR, \"Error allocating the output packet\\n\")",
          "new_text": null,
          "old_line_content": "        av_log(avctx, AV_LOG_ERROR, \"Error allocating the output packet\\n\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1056,
          "old_api": "av_mallocz",
          "new_api": null,
          "old_text": "av_mallocz(sizeof(*frame))",
          "new_text": null,
          "old_line_content": "    frame = av_mallocz(sizeof(*frame));",
          "new_line_content": "        frame = frame->next;",
          "content_same": false
        },
        {
          "line": 1311,
          "old_api": "MFXClose",
          "new_api": null,
          "old_text": "MFXClose(q->internal_session)",
          "new_text": null,
          "old_line_content": "        MFXClose(q->internal_session);",
          "new_line_content": "    if (q->session)",
          "content_same": false
        },
        {
          "line": 1058,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(ENOMEM)",
          "new_text": null,
          "old_line_content": "        return AVERROR(ENOMEM);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1187,
          "old_api": "av_mallocz",
          "new_api": null,
          "old_text": "av_mallocz(sizeof(*bs))",
          "new_text": null,
          "old_line_content": "    bs = av_mallocz(sizeof(*bs));",
          "new_line_content": "        return ret;",
          "content_same": false
        },
        {
          "line": 1315,
          "old_api": "av_buffer_unref",
          "new_api": null,
          "old_text": "av_buffer_unref(&q->frames_ctx.hw_frames_ctx)",
          "new_text": null,
          "old_line_content": "    av_buffer_unref(&q->frames_ctx.hw_frames_ctx);",
          "new_line_content": "    q->session          = NULL;",
          "content_same": false
        },
        {
          "line": 1189,
          "old_api": "av_packet_unref",
          "new_api": null,
          "old_text": "av_packet_unref(&new_pkt)",
          "new_text": null,
          "old_line_content": "        av_packet_unref(&new_pkt);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1316,
          "old_api": "av_buffer_unref",
          "new_api": null,
          "old_text": "av_buffer_unref(&q->frames_ctx.mids_buf)",
          "new_text": null,
          "old_line_content": "    av_buffer_unref(&q->frames_ctx.mids_buf);",
          "new_line_content": "    q->internal_session = NULL;",
          "content_same": false
        },
        {
          "line": 1321,
          "old_api": "av_frame_free",
          "new_api": null,
          "old_text": "av_frame_free(&cur->frame)",
          "new_text": null,
          "old_line_content": "        av_frame_free(&cur->frame);",
          "new_line_content": "    cur = q->work_frames;",
          "content_same": false
        },
        {
          "line": 1322,
          "old_api": "av_freep",
          "new_api": null,
          "old_text": "av_freep(&cur)",
          "new_text": null,
          "old_line_content": "        av_freep(&cur);",
          "new_line_content": "    while (cur) {",
          "content_same": false
        },
        {
          "line": 1195,
          "old_api": "av_mallocz",
          "new_api": null,
          "old_text": "av_mallocz(sizeof(*sync))",
          "new_text": null,
          "old_line_content": "    sync = av_mallocz(sizeof(*sync));",
          "new_line_content": "    bs->Data      = new_pkt.data;",
          "content_same": false
        },
        {
          "line": 1197,
          "old_api": "av_freep",
          "new_api": null,
          "old_text": "av_freep(&bs)",
          "new_text": null,
          "old_line_content": "        av_freep(&bs);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1326,
          "old_api": "av_fifo_size",
          "new_api": null,
          "old_text": "av_fifo_size(q->async_fifo)",
          "new_text": null,
          "old_line_content": "    while (q->async_fifo && av_fifo_size(q->async_fifo)) {",
          "new_line_content": "        cur = q->work_frames;",
          "content_same": false
        },
        {
          "line": 1199,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(ENOMEM)",
          "new_text": null,
          "old_line_content": "        return AVERROR(ENOMEM);",
          "new_line_content": "    if (!sync) {",
          "content_same": false
        },
        {
          "line": 1203,
          "old_api": "MFXVideoENCODE_EncodeFrameAsync",
          "new_api": null,
          "old_text": "MFXVideoENCODE_EncodeFrameAsync(q->session, NULL, surf, bs, sync)",
          "new_text": null,
          "old_line_content": "        ret = MFXVideoENCODE_EncodeFrameAsync(q->session, NULL, surf, bs, sync);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1331,
          "old_api": "av_fifo_generic_read",
          "new_api": null,
          "old_text": "av_fifo_generic_read(q->async_fifo, &pkt,  sizeof(pkt),  NULL)",
          "new_text": null,
          "old_line_content": "        av_fifo_generic_read(q->async_fifo, &pkt,  sizeof(pkt),  NULL);",
          "new_line_content": "        mfxSyncPoint *sync;",
          "content_same": false
        },
        {
          "line": 1205,
          "old_api": "av_usleep",
          "new_api": null,
          "old_text": "av_usleep(1)",
          "new_text": null,
          "old_line_content": "            av_usleep(1);",
          "new_line_content": "    do {",
          "content_same": false
        },
        {
          "line": 1078,
          "old_api": "get_free_frame",
          "new_api": null,
          "old_text": "get_free_frame(q, &qf)",
          "new_text": null,
          "old_line_content": "    ret = get_free_frame(q, &qf);",
          "new_line_content": "    QSVFrame *qf;",
          "content_same": false
        },
        {
          "line": 1332,
          "old_api": "av_fifo_generic_read",
          "new_api": null,
          "old_text": "av_fifo_generic_read(q->async_fifo, &sync, sizeof(sync), NULL)",
          "new_text": null,
          "old_line_content": "        av_fifo_generic_read(q->async_fifo, &sync, sizeof(sync), NULL);",
          "new_line_content": "        mfxBitstream *bs;",
          "content_same": false
        },
        {
          "line": 1333,
          "old_api": "av_fifo_generic_read",
          "new_api": null,
          "old_text": "av_fifo_generic_read(q->async_fifo, &bs,   sizeof(bs),   NULL)",
          "new_text": null,
          "old_line_content": "        av_fifo_generic_read(q->async_fifo, &bs,   sizeof(bs),   NULL);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1209,
          "old_api": "ff_qsv_print_warning",
          "new_api": null,
          "old_text": "ff_qsv_print_warning(avctx, ret, \"Warning during encoding\")",
          "new_text": null,
          "old_line_content": "        ff_qsv_print_warning(avctx, ret, \"Warning during encoding\");",
          "new_line_content": "    } while (ret == MFX_WRN_DEVICE_BUSY || ret == MFX_WRN_IN_EXECUTION);",
          "content_same": false
        },
        {
          "line": 1337,
          "old_api": "av_packet_unref",
          "new_api": null,
          "old_text": "av_packet_unref(&pkt)",
          "new_text": null,
          "old_line_content": "        av_packet_unref(&pkt);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1083,
          "old_api": "av_frame_ref",
          "new_api": null,
          "old_text": "av_frame_ref(qf->frame, frame)",
          "new_text": null,
          "old_line_content": "        ret = av_frame_ref(qf->frame, frame);",
          "new_line_content": "        return ret;",
          "content_same": false
        },
        {
          "line": 1213,
          "old_api": "av_freep",
          "new_api": null,
          "old_text": "av_freep(&bs)",
          "new_text": null,
          "old_line_content": "        av_freep(&bs);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1214,
          "old_api": "av_freep",
          "new_api": null,
          "old_text": "av_freep(&sync)",
          "new_text": null,
          "old_line_content": "        av_freep(&sync);",
          "new_line_content": "    if (ret < 0) {",
          "content_same": false
        },
        {
          "line": 1343,
          "old_api": "av_buffer_unref",
          "new_api": null,
          "old_text": "av_buffer_unref(&q->opaque_alloc_buf)",
          "new_text": null,
          "old_line_content": "    av_buffer_unref(&q->opaque_alloc_buf);",
          "new_line_content": "    q->async_fifo = NULL;",
          "content_same": false
        },
        {
          "line": 1090,
          "old_api": "ff_qsv_find_surface_idx",
          "new_api": null,
          "old_text": "ff_qsv_find_surface_idx(&q->frames_ctx, qf)",
          "new_text": null,
          "old_line_content": "            ret = ff_qsv_find_surface_idx(&q->frames_ctx, qf);",
          "new_line_content": "        qf->surface = *(mfxFrameSurface1*)qf->frame->data[3];",
          "content_same": false
        },
        {
          "line": 1220,
          "old_api": "print_interlace_msg",
          "new_api": null,
          "old_text": "print_interlace_msg(avctx, q)",
          "new_text": null,
          "old_line_content": "        print_interlace_msg(avctx, q);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1224,
          "old_api": "av_fifo_generic_write",
          "new_api": null,
          "old_text": "av_fifo_generic_write(q->async_fifo, &sync,    sizeof(sync),    NULL)",
          "new_text": null,
          "old_line_content": "        av_fifo_generic_write(q->async_fifo, &sync,    sizeof(sync),    NULL);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1225,
          "old_api": "av_fifo_generic_write",
          "new_api": null,
          "old_text": "av_fifo_generic_write(q->async_fifo, &bs,      sizeof(bs),    NULL)",
          "new_text": null,
          "old_line_content": "        av_fifo_generic_write(q->async_fifo, &bs,      sizeof(bs),    NULL);",
          "new_line_content": "    if (*sync) {",
          "content_same": false
        },
        {
          "line": 1100,
          "old_api": "FFALIGN",
          "new_api": null,
          "old_text": "FFALIGN(qf->frame->height, q->height_align)",
          "new_text": null,
          "old_line_content": "            (frame->data[1] - frame->data[0] != frame->linesize[0] * FFALIGN(qf->frame->height, q->height_align))) {",
          "new_line_content": "        /* make a copy if the input is not padded as libmfx requires */",
          "content_same": false
        },
        {
          "line": 1101,
          "old_api": "FFALIGN",
          "new_api": null,
          "old_text": "FFALIGN(frame->height, q->height_align)",
          "new_text": null,
          "old_line_content": "            qf->frame->height = FFALIGN(frame->height, q->height_align);",
          "new_line_content": "        /* and to make allocation continious for data[0]/data[1] */",
          "content_same": false
        },
        {
          "line": 1102,
          "old_api": "FFALIGN",
          "new_api": null,
          "old_text": "FFALIGN(frame->width, q->width_align)",
          "new_text": null,
          "old_line_content": "            qf->frame->width  = FFALIGN(frame->width, q->width_align);",
          "new_line_content": "         if ((frame->height & 31 || frame->linesize[0] & (q->width_align - 1)) ||",
          "content_same": false
        },
        {
          "line": 1229,
          "old_api": "av_freep",
          "new_api": null,
          "old_text": "av_freep(&bs)",
          "new_text": null,
          "old_line_content": "        av_freep(&bs);",
          "new_line_content": "    } else {",
          "content_same": false
        },
        {
          "line": 1107,
          "old_api": "av_frame_get_buffer",
          "new_api": null,
          "old_text": "av_frame_get_buffer(qf->frame, q->width_align)",
          "new_text": null,
          "old_line_content": "                ret = av_frame_get_buffer(qf->frame, q->width_align);",
          "new_line_content": "            qf->frame->format = frame->format;",
          "content_same": false
        },
        {
          "line": 1240,
          "old_api": "encode_frame",
          "new_api": null,
          "old_text": "encode_frame(avctx, q, frame)",
          "new_text": null,
          "old_line_content": "    ret = encode_frame(avctx, q, frame);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 1115,
          "old_api": "av_frame_copy",
          "new_api": null,
          "old_text": "av_frame_copy(qf->frame, frame)",
          "new_text": null,
          "old_line_content": "            ret = av_frame_copy(qf->frame, frame);",
          "new_line_content": "            qf->frame->height = frame->height;",
          "content_same": false
        },
        {
          "line": 1244,
          "old_api": "qsv_fifo_size",
          "new_api": null,
          "old_text": "qsv_fifo_size(q->async_fifo)",
          "new_text": null,
          "old_line_content": "    if ((qsv_fifo_size(q->async_fifo) >= q->async_depth) ||",
          "new_line_content": "    if (ret < 0)",
          "content_same": false
        },
        {
          "line": 1117,
          "old_api": "av_frame_unref",
          "new_api": null,
          "old_text": "av_frame_unref(qf->frame)",
          "new_text": null,
          "old_line_content": "                av_frame_unref(qf->frame);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1245,
          "old_api": "av_fifo_size",
          "new_api": null,
          "old_text": "av_fifo_size(q->async_fifo)",
          "new_text": null,
          "old_line_content": "        (!frame && av_fifo_size(q->async_fifo))) {",
          "new_line_content": "        return ret;",
          "content_same": false
        },
        {
          "line": 1121,
          "old_api": "av_frame_ref",
          "new_api": null,
          "old_text": "av_frame_ref(qf->frame, frame)",
          "new_text": null,
          "old_line_content": "            ret = av_frame_ref(qf->frame, frame);",
          "new_line_content": "                return ret;",
          "content_same": false
        },
        {
          "line": 1250,
          "old_api": "av_fifo_generic_read",
          "new_api": null,
          "old_text": "av_fifo_generic_read(q->async_fifo, &new_pkt, sizeof(new_pkt), NULL)",
          "new_text": null,
          "old_line_content": "        av_fifo_generic_read(q->async_fifo, &new_pkt, sizeof(new_pkt), NULL);",
          "new_line_content": "        mfxBitstream *bs;",
          "content_same": false
        },
        {
          "line": 1251,
          "old_api": "av_fifo_generic_read",
          "new_api": null,
          "old_text": "av_fifo_generic_read(q->async_fifo, &sync,    sizeof(sync),    NULL)",
          "new_text": null,
          "old_line_content": "        av_fifo_generic_read(q->async_fifo, &sync,    sizeof(sync),    NULL);",
          "new_line_content": "        mfxSyncPoint *sync;",
          "content_same": false
        },
        {
          "line": 1252,
          "old_api": "av_fifo_generic_read",
          "new_api": null,
          "old_text": "av_fifo_generic_read(q->async_fifo, &bs,      sizeof(bs),      NULL)",
          "new_text": null,
          "old_line_content": "        av_fifo_generic_read(q->async_fifo, &bs,      sizeof(bs),      NULL);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1259,
          "old_api": "av_rescale_q",
          "new_api": null,
          "old_text": "av_rescale_q(bs->TimeStamp,       (AVRational){1, 90000}, avctx->time_base)",
          "new_text": null,
          "old_line_content": "        new_pkt.pts  = av_rescale_q(bs->TimeStamp,       (AVRational){1, 90000}, avctx->time_base);",
          "new_line_content": "        } while (ret == MFX_WRN_IN_EXECUTION);",
          "content_same": false
        },
        {
          "line": 1144,
          "old_api": "av_rescale_q",
          "new_api": null,
          "old_text": "av_rescale_q(frame->pts, q->avctx->time_base, (AVRational){1, 90000})",
          "new_text": null,
          "old_line_content": "    qf->surface.Data.TimeStamp = av_rescale_q(frame->pts, q->avctx->time_base, (AVRational){1, 90000});",
          "new_line_content": "        qf->surface.Data.UV        = qf->frame->data[1];",
          "content_same": false
        },
        {
          "line": 1278,
          "old_api": "av_freep",
          "new_api": null,
          "old_text": "av_freep(&sync)",
          "new_text": null,
          "old_line_content": "        av_freep(&sync);",
          "new_line_content": "#endif",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 19,
      "total_additions": 57,
      "total_deletions": 56,
      "total_api_changes": 132
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 3,
        "api_related_lines": 132,
        "non_api_lines": 2,
        "non_api_line_numbers": [
          1033,
          1031
        ]
      }
    },
    "api_calls_before": 228,
    "api_calls_after": 229,
    "diff_info": {
      "added_lines": 3,
      "removed_lines": 0,
      "total_diff_lines": 15
    }
  }
}