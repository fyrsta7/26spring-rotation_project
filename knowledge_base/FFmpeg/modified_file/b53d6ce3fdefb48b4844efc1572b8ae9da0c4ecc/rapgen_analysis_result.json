{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/b53d6ce3fdefb48b4844efc1572b8ae9da0c4ecc",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/b53d6ce3fdefb48b4844efc1572b8ae9da0c4ecc/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/b53d6ce3fdefb48b4844efc1572b8ae9da0c4ecc/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/b53d6ce3fdefb48b4844efc1572b8ae9da0c4ecc/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 114,
          "old_api": "av_new_packet",
          "new_api": "AVERROR",
          "old_text": "av_new_packet(pkt, pd->frame_size)",
          "new_text": "AVERROR(ENOMEM)",
          "old_line_content": "    if (av_new_packet(pkt, pd->frame_size) < 0) {",
          "new_line_content": "        return AVERROR(ENOMEM);",
          "content_same": false
        },
        {
          "line": 118,
          "old_api": "pa_simple_read",
          "new_api": "av_log",
          "old_text": "pa_simple_read(pd->s, pkt->data, pkt->size, &res)",
          "new_text": "av_log(s, AV_LOG_ERROR, \"pa_simple_read failed: %s\\n\",\n               pa_strerror(res))",
          "old_line_content": "    if ((pa_simple_read(pd->s, pkt->data, pkt->size, &res)) < 0) {",
          "new_line_content": "        av_log(s, AV_LOG_ERROR, \"pa_simple_read failed: %s\\n\",",
          "content_same": false
        },
        {
          "line": 119,
          "old_api": "av_log",
          "new_api": "pa_strerror",
          "old_text": "av_log(s, AV_LOG_ERROR, \"pa_simple_read failed: %s\\n\",\n               pa_strerror(res))",
          "new_text": "pa_strerror(res)",
          "old_line_content": "        av_log(s, AV_LOG_ERROR, \"pa_simple_read failed: %s\\n\",",
          "new_line_content": "               pa_strerror(res));",
          "content_same": false
        },
        {
          "line": 120,
          "old_api": "pa_strerror",
          "new_api": "av_free_packet",
          "old_text": "pa_strerror(res)",
          "new_text": "av_free_packet(pkt)",
          "old_line_content": "               pa_strerror(res));",
          "new_line_content": "        av_free_packet(pkt);",
          "content_same": false
        },
        {
          "line": 121,
          "old_api": "av_free_packet",
          "new_api": "AVERROR",
          "old_text": "av_free_packet(pkt)",
          "new_text": "AVERROR(EIO)",
          "old_line_content": "        av_free_packet(pkt);",
          "new_line_content": "        return AVERROR(EIO);",
          "content_same": false
        },
        {
          "line": 127,
          "old_api": "pa_strerror",
          "new_api": "pa_simple_get_latency",
          "old_text": "pa_strerror(res)",
          "new_text": "pa_simple_get_latency(pd->s, &res)",
          "old_line_content": "               pa_strerror(res));",
          "new_line_content": "        if ((latency = pa_simple_get_latency(pd->s, &res)) == (pa_usec_t) -1) {",
          "content_same": false
        },
        {
          "line": 128,
          "old_api": "AVERROR",
          "new_api": "av_log",
          "old_text": "AVERROR(EIO)",
          "new_text": "av_log(s, AV_LOG_ERROR, \"pa_simple_get_latency() failed: %s\\n\",\n                   pa_strerror(res))",
          "old_line_content": "        return AVERROR(EIO);",
          "new_line_content": "            av_log(s, AV_LOG_ERROR, \"pa_simple_get_latency() failed: %s\\n\",",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 160,
          "old_api": null,
          "new_api": "OFFSET",
          "old_text": null,
          "new_text": "OFFSET(fragment_size)",
          "old_line_content": "    { NULL },",
          "new_line_content": "    { \"fragment_size\", \"set buffering size, affects latency and cpu usage\", OFFSET(fragment_size), AV_OPT_TYPE_INT,    {.i64 = -1},      -1, INT_MAX, D },",
          "content_same": false
        },
        {
          "line": 129,
          "old_api": null,
          "new_api": "pa_strerror",
          "old_text": null,
          "new_text": "pa_strerror(res)",
          "old_line_content": "    }",
          "new_line_content": "                   pa_strerror(res));",
          "content_same": false
        },
        {
          "line": 130,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(EIO)",
          "old_line_content": "",
          "new_line_content": "            return AVERROR(EIO);",
          "content_same": false
        },
        {
          "line": 173,
          "old_api": null,
          "new_api": "NULL_IF_CONFIG_SMALL",
          "old_text": null,
          "new_text": "NULL_IF_CONFIG_SMALL(\"Pulse audio input\")",
          "old_line_content": "    .priv_data_size = sizeof(PulseData),",
          "new_line_content": "    .long_name      = NULL_IF_CONFIG_SMALL(\"Pulse audio input\"),",
          "content_same": false
        },
        {
          "line": 113,
          "old_api": null,
          "new_api": "av_new_packet",
          "old_text": null,
          "new_text": "av_new_packet(pkt, pd->frame_size)",
          "old_line_content": "",
          "new_line_content": "    if (av_new_packet(pkt, pd->frame_size) < 0) {",
          "content_same": false
        },
        {
          "line": 146,
          "old_api": null,
          "new_api": "pa_simple_free",
          "old_text": null,
          "new_text": "pa_simple_free(pd->s)",
          "old_line_content": "    return 0;",
          "new_line_content": "    pa_simple_free(pd->s);",
          "content_same": false
        },
        {
          "line": 117,
          "old_api": null,
          "new_api": "pa_simple_read",
          "old_text": null,
          "new_text": "pa_simple_read(pd->s, pkt->data, pkt->size, &res)",
          "old_line_content": "",
          "new_line_content": "    if ((pa_simple_read(pd->s, pkt->data, pkt->size, &res)) < 0) {",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 172,
          "old_api": "NULL_IF_CONFIG_SMALL",
          "new_api": null,
          "old_text": "NULL_IF_CONFIG_SMALL(\"Pulse audio input\")",
          "new_text": null,
          "old_line_content": "    .long_name      = NULL_IF_CONFIG_SMALL(\"Pulse audio input\"),",
          "new_line_content": "    .name           = \"pulse\",",
          "content_same": false
        },
        {
          "line": 145,
          "old_api": "pa_simple_free",
          "new_api": null,
          "old_text": "pa_simple_free(pd->s)",
          "new_text": null,
          "old_line_content": "    pa_simple_free(pd->s);",
          "new_line_content": "    PulseData *pd = s->priv_data;",
          "content_same": false
        },
        {
          "line": 115,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(ENOMEM)",
          "new_text": null,
          "old_line_content": "        return AVERROR(ENOMEM);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 153,
          "old_api": "OFFSET",
          "new_api": null,
          "old_text": "OFFSET(server)",
          "new_text": null,
          "old_line_content": "    { \"server\",        \"set PulseAudio server\",                             OFFSET(server),        AV_OPT_TYPE_STRING, {.str = NULL},     0, 0, D },",
          "new_line_content": "static const AVOption options[] = {",
          "content_same": false
        },
        {
          "line": 122,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(EIO)",
          "new_text": null,
          "old_line_content": "        return AVERROR(EIO);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 125,
          "old_api": "pa_simple_get_latency",
          "new_api": null,
          "old_text": "pa_simple_get_latency(pd->s, &res)",
          "new_text": null,
          "old_line_content": "    if ((latency = pa_simple_get_latency(pd->s, &res)) == (pa_usec_t) -1) {",
          "new_line_content": "        pa_usec_t latency;",
          "content_same": false
        },
        {
          "line": 126,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(s, AV_LOG_ERROR, \"pa_simple_get_latency() failed: %s\\n\",\n               pa_strerror(res))",
          "new_text": null,
          "old_line_content": "        av_log(s, AV_LOG_ERROR, \"pa_simple_get_latency() failed: %s\\n\",",
          "new_line_content": "",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 7,
      "total_additions": 7,
      "total_deletions": 7,
      "total_api_changes": 21
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 9,
        "api_related_lines": 21,
        "non_api_lines": 3,
        "non_api_line_numbers": [
          112,
          131,
          132
        ]
      }
    },
    "api_calls_before": 32,
    "api_calls_after": 32,
    "diff_info": {
      "added_lines": 8,
      "removed_lines": 7,
      "total_diff_lines": 35
    }
  }
}