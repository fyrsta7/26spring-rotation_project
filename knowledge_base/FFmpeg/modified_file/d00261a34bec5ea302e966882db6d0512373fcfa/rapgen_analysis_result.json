{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/d00261a34bec5ea302e966882db6d0512373fcfa",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/d00261a34bec5ea302e966882db6d0512373fcfa/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/d00261a34bec5ea302e966882db6d0512373fcfa/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/d00261a34bec5ea302e966882db6d0512373fcfa/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 858,
          "old_api": "get_bits)(&s->gb, 8)",
          "new_api": "get_bits",
          "old_text": "get_bits)(&s->gb, 8)",
          "new_text": "get_bits(&s->gb, s->byte_offset_bits + 3)",
          "old_line_content": "                *q++ = (get_bits)(&s->gb, 8);",
          "new_line_content": "        bit_offset = get_bits(&s->gb, s->byte_offset_bits + 3);",
          "content_same": false
        },
        {
          "line": 869,
          "old_api": "skip_bits",
          "new_api": "get_bits)(&s->gb, 8)",
          "old_text": "skip_bits(&s->gb, s->last_bitoffset)",
          "new_text": "get_bits)(&s->gb, 8)",
          "old_line_content": "                skip_bits(&s->gb, s->last_bitoffset);",
          "new_line_content": "                *q++ = (get_bits)(&s->gb, 8);",
          "content_same": false
        },
        {
          "line": 897,
          "old_api": "av_log",
          "new_api": "wma_decode_frame",
          "old_text": "av_log(s->avctx, AV_LOG_ERROR, \"len %d invalid\\n\", len)",
          "new_text": "wma_decode_frame(s, samples)",
          "old_line_content": "            av_log(s->avctx, AV_LOG_ERROR, \"len %d invalid\\n\", len);",
          "new_line_content": "            if (wma_decode_frame(s, samples) < 0)",
          "content_same": false
        },
        {
          "line": 908,
          "old_api": "wma_decode_frame",
          "new_api": "av_log",
          "old_text": "wma_decode_frame(s, samples)",
          "new_text": "av_log(s->avctx, AV_LOG_ERROR, \"len %d invalid\\n\", len)",
          "old_line_content": "        if (wma_decode_frame(s, samples) < 0)",
          "new_line_content": "            av_log(s->avctx, AV_LOG_ERROR, \"len %d invalid\\n\", len);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 903,
          "old_api": null,
          "new_api": "get_bits_count",
          "old_text": null,
          "new_text": "get_bits_count(&s->gb)",
          "old_line_content": "        if(s->nb_channels * s->frame_len * sizeof(int16_t) > *data_size){",
          "new_line_content": "        pos = get_bits_count(&s->gb) + ((bit_offset + 4 + 4 + s->byte_offset_bits + 3) & ~7);",
          "content_same": false
        },
        {
          "line": 912,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(s->last_superframe, buf + pos, len)",
          "old_line_content": "",
          "new_line_content": "        memcpy(s->last_superframe, buf + pos, len);",
          "content_same": false
        },
        {
          "line": 915,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(s->avctx, AV_LOG_ERROR, \"Insufficient output space\\n\")",
          "old_line_content": "    *data_size = (int8_t *)samples - (int8_t *)data;",
          "new_line_content": "            av_log(s->avctx, AV_LOG_ERROR, \"Insufficient output space\\n\");",
          "content_same": false
        },
        {
          "line": 919,
          "old_api": null,
          "new_api": "wma_decode_frame",
          "old_text": null,
          "new_text": "wma_decode_frame(s, samples)",
          "old_line_content": "    s->last_superframe_len = 0;",
          "new_line_content": "        if (wma_decode_frame(s, samples) < 0)",
          "content_same": false
        },
        {
          "line": 799,
          "old_api": null,
          "new_api": "lrintf",
          "old_text": null,
          "new_text": "lrintf(*iptr++)",
          "old_line_content": "            ptr += incr;",
          "new_line_content": "            *ptr = av_clip_int16(lrintf(*iptr++));",
          "content_same": false
        },
        {
          "line": 803,
          "old_api": null,
          "new_api": "memmove",
          "old_text": null,
          "new_text": "memmove(&s->frame_out[ch][0], &s->frame_out[ch][s->frame_len],\n                s->frame_len * sizeof(float))",
          "old_line_content": "                s->frame_len * sizeof(float));",
          "new_line_content": "        memmove(&s->frame_out[ch][0], &s->frame_out[ch][s->frame_len],",
          "content_same": false
        },
        {
          "line": 810,
          "old_api": null,
          "new_api": "float_to_int16_interleave",
          "old_text": null,
          "new_text": "s->dsp.float_to_int16_interleave(samples, (const float **)output, n, incr)",
          "old_line_content": "}",
          "new_line_content": "        s->dsp.float_to_int16_interleave(samples, (const float **)output, n, incr);",
          "content_same": false
        },
        {
          "line": 813,
          "old_api": null,
          "new_api": "memmove",
          "old_text": null,
          "new_text": "memmove(&s->frame_out[ch][0], &s->frame_out[ch][n], n * sizeof(float))",
          "old_line_content": "                                 void *data, int *data_size,",
          "new_line_content": "            memmove(&s->frame_out[ch][0], &s->frame_out[ch][n], n * sizeof(float));",
          "content_same": false
        },
        {
          "line": 818,
          "old_api": null,
          "new_api": "dump_shorts",
          "old_text": null,
          "new_text": "dump_shorts(s, \"samples\", samples, n * s->nb_channels)",
          "old_line_content": "    WMACodecContext *s = avctx->priv_data;",
          "new_line_content": "    dump_shorts(s, \"samples\", samples, n * s->nb_channels);",
          "content_same": false
        },
        {
          "line": 953,
          "old_api": null,
          "new_api": "NULL_IF_CONFIG_SMALL",
          "old_text": null,
          "new_text": "NULL_IF_CONFIG_SMALL(\"Windows Media Audio 1\")",
          "old_line_content": "    ff_wma_end,",
          "new_line_content": "    .long_name = NULL_IF_CONFIG_SMALL(\"Windows Media Audio 1\"),",
          "content_same": false
        },
        {
          "line": 834,
          "old_api": null,
          "new_api": "tprintf",
          "old_text": null,
          "new_text": "tprintf(avctx, \"***decode_superframe:\\n\")",
          "old_line_content": "",
          "new_line_content": "    tprintf(avctx, \"***decode_superframe:\\n\");",
          "content_same": false
        },
        {
          "line": 967,
          "old_api": null,
          "new_api": "NULL_IF_CONFIG_SMALL",
          "old_text": null,
          "new_text": "NULL_IF_CONFIG_SMALL(\"Windows Media Audio 2\")",
          "old_line_content": "",
          "new_line_content": "    .long_name = NULL_IF_CONFIG_SMALL(\"Windows Media Audio 2\"),",
          "content_same": false
        },
        {
          "line": 846,
          "old_api": null,
          "new_api": "init_get_bits",
          "old_text": null,
          "new_text": "init_get_bits(&s->gb, buf, buf_size*8)",
          "old_line_content": "",
          "new_line_content": "    init_get_bits(&s->gb, buf, buf_size*8);",
          "content_same": false
        },
        {
          "line": 850,
          "old_api": null,
          "new_api": "skip_bits",
          "old_text": null,
          "new_text": "skip_bits(&s->gb, 4)",
          "old_line_content": "            //        printf(\"skip=%d\\n\", s->last_bitoffset);",
          "new_line_content": "        skip_bits(&s->gb, 4); /* super frame index */",
          "content_same": false
        },
        {
          "line": 851,
          "old_api": null,
          "new_api": "get_bits",
          "old_text": null,
          "new_text": "get_bits(&s->gb, 4)",
          "old_line_content": "            /* add bit_offset bits to last frame */",
          "new_line_content": "        nb_frames = get_bits(&s->gb, 4) - 1;",
          "content_same": false
        },
        {
          "line": 854,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(s->avctx, AV_LOG_ERROR, \"Insufficient output space\\n\")",
          "old_line_content": "                goto fail;",
          "new_line_content": "            av_log(s->avctx, AV_LOG_ERROR, \"Insufficient output space\\n\");",
          "content_same": false
        },
        {
          "line": 873,
          "old_api": null,
          "new_api": "get_bits)(&s->gb, len)",
          "old_text": null,
          "new_text": "get_bits)(&s->gb, len)",
          "old_line_content": "                goto fail;",
          "new_line_content": "                *q++ = (get_bits)(&s->gb, len) << (8 - len);",
          "content_same": false
        },
        {
          "line": 877,
          "old_api": null,
          "new_api": "init_get_bits",
          "old_text": null,
          "new_text": "init_get_bits(&s->gb, s->last_superframe, MAX_CODED_SUPERFRAME_SIZE*8)",
          "old_line_content": "        /* read each frame starting from bit_offset */",
          "new_line_content": "            init_get_bits(&s->gb, s->last_superframe, MAX_CODED_SUPERFRAME_SIZE*8);",
          "content_same": false
        },
        {
          "line": 880,
          "old_api": null,
          "new_api": "skip_bits",
          "old_text": null,
          "new_text": "skip_bits(&s->gb, s->last_bitoffset)",
          "old_line_content": "        len = pos & 7;",
          "new_line_content": "                skip_bits(&s->gb, s->last_bitoffset);",
          "content_same": false
        },
        {
          "line": 883,
          "old_api": null,
          "new_api": "wma_decode_frame",
          "old_text": null,
          "new_text": "wma_decode_frame(s, samples)",
          "old_line_content": "",
          "new_line_content": "            if (wma_decode_frame(s, samples) < 0)",
          "content_same": false
        },
        {
          "line": 890,
          "old_api": null,
          "new_api": "init_get_bits",
          "old_text": null,
          "new_text": "init_get_bits(&s->gb, buf + (pos >> 3), (MAX_CODED_SUPERFRAME_SIZE - (pos >> 3))*8)",
          "old_line_content": "",
          "new_line_content": "        init_get_bits(&s->gb, buf + (pos >> 3), (MAX_CODED_SUPERFRAME_SIZE - (pos >> 3))*8);",
          "content_same": false
        },
        {
          "line": 893,
          "old_api": null,
          "new_api": "skip_bits",
          "old_text": null,
          "new_text": "skip_bits(&s->gb, len)",
          "old_line_content": "        s->last_bitoffset = pos & 7;",
          "new_line_content": "            skip_bits(&s->gb, len);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 901,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(s->last_superframe, buf + pos, len)",
          "new_text": null,
          "old_line_content": "        memcpy(s->last_superframe, buf + pos, len);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 904,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(s->avctx, AV_LOG_ERROR, \"Insufficient output space\\n\")",
          "new_text": null,
          "old_line_content": "            av_log(s->avctx, AV_LOG_ERROR, \"Insufficient output space\\n\");",
          "new_line_content": "        s->last_bitoffset = pos & 7;",
          "content_same": false
        },
        {
          "line": 798,
          "old_api": "lrintf",
          "new_api": null,
          "old_text": "lrintf(*iptr++)",
          "new_text": null,
          "old_line_content": "            *ptr = av_clip_int16(lrintf(*iptr++));",
          "new_line_content": "        for(i=0;i<n;i++) {",
          "content_same": false
        },
        {
          "line": 802,
          "old_api": "memmove",
          "new_api": null,
          "old_text": "memmove(&s->frame_out[ch][0], &s->frame_out[ch][s->frame_len],\n                s->frame_len * sizeof(float))",
          "new_text": null,
          "old_line_content": "        memmove(&s->frame_out[ch][0], &s->frame_out[ch][s->frame_len],",
          "new_line_content": "        /* prepare for next block */",
          "content_same": false
        },
        {
          "line": 807,
          "old_api": "dump_shorts",
          "new_api": null,
          "old_text": "dump_shorts(s, \"samples\", samples, n * s->nb_channels)",
          "new_text": null,
          "old_line_content": "    dump_shorts(s, \"samples\", samples, n * s->nb_channels);",
          "new_line_content": "        float *output[MAX_CHANNELS];",
          "content_same": false
        },
        {
          "line": 942,
          "old_api": "NULL_IF_CONFIG_SMALL",
          "new_api": null,
          "old_text": "NULL_IF_CONFIG_SMALL(\"Windows Media Audio 1\")",
          "new_text": null,
          "old_line_content": "    .long_name = NULL_IF_CONFIG_SMALL(\"Windows Media Audio 1\"),",
          "new_line_content": "AVCodec wmav1_decoder =",
          "content_same": false
        },
        {
          "line": 823,
          "old_api": "tprintf",
          "new_api": null,
          "old_text": "tprintf(avctx, \"***decode_superframe:\\n\")",
          "new_text": null,
          "old_line_content": "    tprintf(avctx, \"***decode_superframe:\\n\");",
          "new_line_content": "static int wma_decode_superframe(AVCodecContext *avctx,",
          "content_same": false
        },
        {
          "line": 956,
          "old_api": "NULL_IF_CONFIG_SMALL",
          "new_api": null,
          "old_text": "NULL_IF_CONFIG_SMALL(\"Windows Media Audio 2\")",
          "new_text": null,
          "old_line_content": "    .long_name = NULL_IF_CONFIG_SMALL(\"Windows Media Audio 2\"),",
          "new_line_content": "AVCodec wmav2_decoder =",
          "content_same": false
        },
        {
          "line": 835,
          "old_api": "init_get_bits",
          "new_api": null,
          "old_text": "init_get_bits(&s->gb, buf, buf_size*8)",
          "new_text": null,
          "old_line_content": "    init_get_bits(&s->gb, buf, buf_size*8);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 839,
          "old_api": "skip_bits",
          "new_api": null,
          "old_text": "skip_bits(&s->gb, 4)",
          "new_text": null,
          "old_line_content": "        skip_bits(&s->gb, 4); /* super frame index */",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 840,
          "old_api": "get_bits",
          "new_api": null,
          "old_text": "get_bits(&s->gb, 4)",
          "new_text": null,
          "old_line_content": "        nb_frames = get_bits(&s->gb, 4) - 1;",
          "new_line_content": "    if (buf_size < s->block_align)",
          "content_same": false
        },
        {
          "line": 843,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(s->avctx, AV_LOG_ERROR, \"Insufficient output space\\n\")",
          "new_text": null,
          "old_line_content": "            av_log(s->avctx, AV_LOG_ERROR, \"Insufficient output space\\n\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 847,
          "old_api": "get_bits",
          "new_api": null,
          "old_text": "get_bits(&s->gb, s->byte_offset_bits + 3)",
          "new_text": null,
          "old_line_content": "        bit_offset = get_bits(&s->gb, s->byte_offset_bits + 3);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 862,
          "old_api": "get_bits)(&s->gb, len)",
          "new_api": null,
          "old_text": "get_bits)(&s->gb, len)",
          "new_text": null,
          "old_line_content": "                *q++ = (get_bits)(&s->gb, len) << (8 - len);",
          "new_line_content": "            /* add bit_offset bits to last frame */",
          "content_same": false
        },
        {
          "line": 866,
          "old_api": "init_get_bits",
          "new_api": null,
          "old_text": "init_get_bits(&s->gb, s->last_superframe, MAX_CODED_SUPERFRAME_SIZE*8)",
          "new_text": null,
          "old_line_content": "            init_get_bits(&s->gb, s->last_superframe, MAX_CODED_SUPERFRAME_SIZE*8);",
          "new_line_content": "            q = s->last_superframe + s->last_superframe_len;",
          "content_same": false
        },
        {
          "line": 872,
          "old_api": "wma_decode_frame",
          "new_api": null,
          "old_text": "wma_decode_frame(s, samples)",
          "new_text": null,
          "old_line_content": "            if (wma_decode_frame(s, samples) < 0)",
          "new_line_content": "            if (len > 0) {",
          "content_same": false
        },
        {
          "line": 879,
          "old_api": "init_get_bits",
          "new_api": null,
          "old_text": "init_get_bits(&s->gb, buf + (pos >> 3), (MAX_CODED_SUPERFRAME_SIZE - (pos >> 3))*8)",
          "new_text": null,
          "old_line_content": "        init_get_bits(&s->gb, buf + (pos >> 3), (MAX_CODED_SUPERFRAME_SIZE - (pos >> 3))*8);",
          "new_line_content": "            if (s->last_bitoffset > 0)",
          "content_same": false
        },
        {
          "line": 882,
          "old_api": "skip_bits",
          "new_api": null,
          "old_text": "skip_bits(&s->gb, len)",
          "new_text": null,
          "old_line_content": "            skip_bits(&s->gb, len);",
          "new_line_content": "               current one */",
          "content_same": false
        },
        {
          "line": 886,
          "old_api": "wma_decode_frame",
          "new_api": null,
          "old_text": "wma_decode_frame(s, samples)",
          "new_text": null,
          "old_line_content": "            if (wma_decode_frame(s, samples) < 0)",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 892,
          "old_api": "get_bits_count",
          "new_api": null,
          "old_text": "get_bits_count(&s->gb)",
          "new_text": null,
          "old_line_content": "        pos = get_bits_count(&s->gb) + ((bit_offset + 4 + 4 + s->byte_offset_bits + 3) & ~7);",
          "new_line_content": "        if (len > 0)",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 4,
      "total_additions": 22,
      "total_deletions": 20,
      "total_api_changes": 46
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 11,
        "api_related_lines": 46,
        "non_api_lines": 8,
        "non_api_line_numbers": [
          806,
          808,
          809,
          811,
          812,
          814,
          815,
          793
        ]
      }
    },
    "api_calls_before": 101,
    "api_calls_after": 103,
    "diff_info": {
      "added_lines": 11,
      "removed_lines": 0,
      "total_diff_lines": 30
    }
  }
}