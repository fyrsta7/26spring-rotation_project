{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/6af4c9814adb9fd87d2de723473c76e53e2c2b37",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/6af4c9814adb9fd87d2de723473c76e53e2c2b37/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/6af4c9814adb9fd87d2de723473c76e53e2c2b37/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/6af4c9814adb9fd87d2de723473c76e53e2c2b37/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 120,
          "old_api": "printf",
          "new_api": "av_base64_encode",
          "old_text": "printf(\"Failed: cannot encode the input data\\n\")",
          "new_text": "av_base64_encode(encoded, MAX_ENCODED_SIZE, data, data_size)",
          "old_line_content": "        printf(\"Failed: cannot encode the input data\\n\");",
          "new_line_content": "    if (!av_base64_encode(encoded, MAX_ENCODED_SIZE, data, data_size)) {",
          "content_same": false
        },
        {
          "line": 124,
          "old_api": "printf",
          "new_api": "strcmp",
          "old_text": "printf(\"Failed: encoded string differs from reference\\n\"\n               \"Encoded:\\n%s\\nReference:\\n%s\\n\", encoded, encoded_ref)",
          "new_text": "strcmp(encoded, encoded_ref)",
          "old_line_content": "        printf(\"Failed: encoded string differs from reference\\n\"",
          "new_line_content": "    if (encoded_ref && strcmp(encoded, encoded_ref)) {",
          "content_same": false
        },
        {
          "line": 130,
          "old_api": "printf",
          "new_api": "av_base64_decode",
          "old_text": "printf(\"Failed: cannot decode the encoded string\\n\"\n               \"Encoded:\\n%s\\n\", encoded)",
          "new_text": "av_base64_decode(data2, encoded, max_data2_size)",
          "old_line_content": "        printf(\"Failed: cannot decode the encoded string\\n\"",
          "new_line_content": "    if ((data2_size = av_base64_decode(data2, encoded, max_data2_size)) < 0) {",
          "content_same": false
        },
        {
          "line": 135,
          "old_api": "printf",
          "new_api": "memcmp",
          "old_text": "printf(\"Failed: encoded/decoded data differs from original data\\n\")",
          "new_text": "memcmp(data2, data, data_size)",
          "old_line_content": "        printf(\"Failed: encoded/decoded data differs from original data\\n\");",
          "new_line_content": "    if (memcmp(data2, data, data_size)) {",
          "content_same": false
        },
        {
          "line": 161,
          "old_api": "FF_ARRAY_ELEMS",
          "new_api": "printf",
          "old_text": "FF_ARRAY_ELEMS(tests)",
          "new_text": "printf(\"Encoding/decoding tests\\n\")",
          "old_line_content": "    for (i = 0; i < FF_ARRAY_ELEMS(tests); i++)",
          "new_line_content": "    printf(\"Encoding/decoding tests\\n\");",
          "content_same": false
        },
        {
          "line": 162,
          "old_api": "strlen",
          "new_api": "FF_ARRAY_ELEMS",
          "old_text": "strlen(tests[i].data)",
          "new_text": "FF_ARRAY_ELEMS(tests)",
          "old_line_content": "        error_count += test_encode_decode(tests[i].data, strlen(tests[i].data), tests[i].encoded_ref);",
          "new_line_content": "    for (i = 0; i < FF_ARRAY_ELEMS(tests); i++)",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 65,
          "old_api": null,
          "new_api": "av_assert1",
          "old_text": null,
          "new_text": "av_assert1(0)",
          "old_line_content": "    return 0;",
          "new_line_content": "    av_assert1(0);",
          "content_same": false
        },
        {
          "line": 131,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\"Failed: cannot decode the encoded string\\n\"\n               \"Encoded:\\n%s\\n\", encoded)",
          "old_line_content": "               \"Encoded:\\n%s\\n\", encoded);",
          "new_line_content": "        printf(\"Failed: cannot decode the encoded string\\n\"",
          "content_same": false
        },
        {
          "line": 163,
          "old_api": null,
          "new_api": "strlen",
          "old_text": null,
          "new_text": "strlen(tests[i].data)",
          "old_line_content": "",
          "new_line_content": "        error_count += test_encode_decode(tests[i].data, strlen(tests[i].data), tests[i].encoded_ref);",
          "content_same": false
        },
        {
          "line": 136,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\"Failed: encoded/decoded data differs from original data\\n\")",
          "old_line_content": "        return 1;",
          "new_line_content": "        printf(\"Failed: encoded/decoded data differs from original data\\n\");",
          "content_same": false
        },
        {
          "line": 140,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\"Passed!\\n\")",
          "old_line_content": "    return 0;",
          "new_line_content": "    printf(\"Passed!\\n\");",
          "content_same": false
        },
        {
          "line": 85,
          "old_api": null,
          "new_api": "AV_BASE64_SIZE",
          "old_text": null,
          "new_text": "AV_BASE64_SIZE(in_size)",
          "old_line_content": "        return NULL;",
          "new_line_content": "        out_size < AV_BASE64_SIZE(in_size))",
          "content_same": false
        },
        {
          "line": 55,
          "old_api": null,
          "new_api": "FF_ARRAY_ELEMS",
          "old_text": null,
          "new_text": "FF_ARRAY_ELEMS(map2)",
          "old_line_content": "            return in[i] && in[i] != '=' ? -1 : dst - out;",
          "new_line_content": "        if (index>=FF_ARRAY_ELEMS(map2) || map2[index] == 0xff)",
          "content_same": false
        },
        {
          "line": 121,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\"Failed: cannot encode the input data\\n\")",
          "old_line_content": "        return 1;",
          "new_line_content": "        printf(\"Failed: cannot encode the input data\\n\");",
          "content_same": false
        },
        {
          "line": 125,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\"Failed: encoded string differs from reference\\n\"\n               \"Encoded:\\n%s\\nReference:\\n%s\\n\", encoded, encoded_ref)",
          "old_line_content": "               \"Encoded:\\n%s\\nReference:\\n%s\\n\", encoded, encoded_ref);",
          "new_line_content": "        printf(\"Failed: encoded string differs from reference\\n\"",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 64,
          "old_api": "av_assert1",
          "new_api": null,
          "old_text": "av_assert1(0)",
          "new_text": null,
          "old_line_content": "    av_assert1(0);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 129,
          "old_api": "av_base64_decode",
          "new_api": null,
          "old_text": "av_base64_decode(data2, encoded, max_data2_size)",
          "new_text": null,
          "old_line_content": "    if ((data2_size = av_base64_decode(data2, encoded, max_data2_size)) < 0) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 160,
          "old_api": "printf",
          "new_api": null,
          "old_text": "printf(\"Encoding/decoding tests\\n\")",
          "new_text": null,
          "old_line_content": "    printf(\"Encoding/decoding tests\\n\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 134,
          "old_api": "memcmp",
          "new_api": null,
          "old_text": "memcmp(data2, data, data_size)",
          "new_text": null,
          "old_line_content": "    if (memcmp(data2, data, data_size)) {",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 139,
          "old_api": "printf",
          "new_api": null,
          "old_text": "printf(\"Passed!\\n\")",
          "new_text": null,
          "old_line_content": "    printf(\"Passed!\\n\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 84,
          "old_api": "AV_BASE64_SIZE",
          "new_api": null,
          "old_text": "AV_BASE64_SIZE(in_size)",
          "new_text": null,
          "old_line_content": "        out_size < AV_BASE64_SIZE(in_size))",
          "new_line_content": "    if (in_size >= UINT_MAX / 4 ||",
          "content_same": false
        },
        {
          "line": 54,
          "old_api": "FF_ARRAY_ELEMS",
          "new_api": null,
          "old_text": "FF_ARRAY_ELEMS(map2)",
          "new_text": null,
          "old_line_content": "        if (index>=FF_ARRAY_ELEMS(map2) || map2[index] == 0xff)",
          "new_line_content": "        unsigned int index= in[i]-43;",
          "content_same": false
        },
        {
          "line": 119,
          "old_api": "av_base64_encode",
          "new_api": null,
          "old_text": "av_base64_encode(encoded, MAX_ENCODED_SIZE, data, data_size)",
          "new_text": null,
          "old_line_content": "    if (!av_base64_encode(encoded, MAX_ENCODED_SIZE, data, data_size)) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 123,
          "old_api": "strcmp",
          "new_api": null,
          "old_text": "strcmp(encoded, encoded_ref)",
          "new_text": null,
          "old_line_content": "    if (encoded_ref && strcmp(encoded, encoded_ref)) {",
          "new_line_content": "    }",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 6,
      "total_additions": 9,
      "total_deletions": 9,
      "total_api_changes": 24
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 3,
        "api_related_lines": 24,
        "non_api_lines": 3,
        "non_api_line_numbers": [
          50,
          59,
          58
        ]
      }
    },
    "api_calls_before": 16,
    "api_calls_after": 16,
    "diff_info": {
      "added_lines": 2,
      "removed_lines": 1,
      "total_diff_lines": 22
    }
  }
}