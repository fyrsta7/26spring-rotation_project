{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/e301736862f18a449c317a47d0d60d3484e41667",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/e301736862f18a449c317a47d0d60d3484e41667/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/e301736862f18a449c317a47d0d60d3484e41667/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/e301736862f18a449c317a47d0d60d3484e41667/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 1083,
          "old_api": "flic_decode_frame_8BPP",
          "new_api": "flic_decode_frame_24BPP",
          "old_text": "flic_decode_frame_8BPP(avctx, data, got_frame,\n                                      buf, buf_size)",
          "new_text": "flic_decode_frame_24BPP(avctx, data, got_frame,\n                                       buf, buf_size)",
          "old_line_content": "        return flic_decode_frame_8BPP(avctx, data, got_frame,",
          "new_line_content": "        return flic_decode_frame_24BPP(avctx, data, got_frame,",
          "content_same": false
        },
        {
          "line": 1107,
          "old_api": "av_frame_free",
          "new_api": "NULL_IF_CONFIG_SMALL",
          "old_text": "av_frame_free(&s->frame)",
          "new_text": "NULL_IF_CONFIG_SMALL(\"Autodesk Animator Flic video\")",
          "old_line_content": "    av_frame_free(&s->frame);",
          "new_line_content": "    .long_name      = NULL_IF_CONFIG_SMALL(\"Autodesk Animator Flic video\"),",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 1057,
          "old_api": null,
          "new_api": "bytestream2_get_bytes_left",
          "old_text": null,
          "new_text": "bytestream2_get_bytes_left(&g2)",
          "old_line_content": "",
          "new_line_content": "    if ((bytestream2_get_bytes_left(&g2) != 0) && (bytestream2_get_bytes_left(&g2) != 1))",
          "content_same": false
        },
        {
          "line": 1058,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(avctx, AV_LOG_ERROR, \"Processed FLI chunk where chunk size = %d \" \\\n               \"and final chunk ptr = %d\\n\", buf_size, bytestream2_tell(&g2))",
          "old_line_content": "        frame_size -= chunk_size;",
          "new_line_content": "        av_log(avctx, AV_LOG_ERROR, \"Processed FLI chunk where chunk size = %d \" \\",
          "content_same": false
        },
        {
          "line": 1027,
          "old_api": null,
          "new_api": "bytestream2_get_buffer",
          "old_text": null,
          "new_text": "bytestream2_get_buffer(&g2, pixels + y_ptr, 3*s->avctx->width)",
          "old_line_content": "                    pixel_countdown = s->avctx->width;",
          "new_line_content": "                    bytestream2_get_buffer(&g2, pixels + y_ptr, 3*s->avctx->width);",
          "content_same": false
        },
        {
          "line": 1059,
          "old_api": null,
          "new_api": "bytestream2_tell",
          "old_text": null,
          "new_text": "bytestream2_tell(&g2)",
          "old_line_content": "        num_chunks--;",
          "new_line_content": "               \"and final chunk ptr = %d\\n\", buf_size, bytestream2_tell(&g2));",
          "content_same": false
        },
        {
          "line": 1029,
          "old_api": null,
          "new_api": "bytestream2_skip",
          "old_text": null,
          "new_text": "bytestream2_skip(&g2, 3)",
          "old_line_content": "                    while (pixel_countdown > 0) {",
          "new_line_content": "                        bytestream2_skip(&g2, 3);",
          "content_same": false
        },
        {
          "line": 1061,
          "old_api": null,
          "new_api": "av_frame_ref",
          "old_text": null,
          "new_text": "av_frame_ref(data, s->frame)",
          "old_line_content": "",
          "new_line_content": "    if ((ret = av_frame_ref(data, s->frame)) < 0)",
          "content_same": false
        },
        {
          "line": 1091,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(avctx, AV_LOG_ERROR, \"Unknown FLC format, my science cannot explain how this happened.\\n\")",
          "old_line_content": "                                       buf, buf_size);",
          "new_line_content": "    av_log(avctx, AV_LOG_ERROR, \"Unknown FLC format, my science cannot explain how this happened.\\n\");",
          "content_same": false
        },
        {
          "line": 1100,
          "old_api": null,
          "new_api": "av_frame_free",
          "old_text": null,
          "new_text": "av_frame_free(&s->frame)",
          "old_line_content": "}",
          "new_line_content": "    av_frame_free(&s->frame);",
          "content_same": false
        },
        {
          "line": 1040,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(avctx, AV_LOG_ERROR, \"Unrecognized chunk type: %d\\n\", chunk_type)",
          "old_line_content": "",
          "new_line_content": "            av_log(avctx, AV_LOG_ERROR, \"Unrecognized chunk type: %d\\n\", chunk_type);",
          "content_same": false
        },
        {
          "line": 1044,
          "old_api": null,
          "new_api": "bytestream2_tell",
          "old_text": null,
          "new_text": "bytestream2_tell(&g2)",
          "old_line_content": "            break;",
          "new_line_content": "        if (stream_ptr_after_chunk - bytestream2_tell(&g2) >= 0) {",
          "content_same": false
        },
        {
          "line": 1045,
          "old_api": null,
          "new_api": "bytestream2_tell",
          "old_text": null,
          "new_text": "bytestream2_tell(&g2)",
          "old_line_content": "",
          "new_line_content": "            bytestream2_skip(&g2, stream_ptr_after_chunk - bytestream2_tell(&g2));",
          "content_same": false
        },
        {
          "line": 1076,
          "old_api": null,
          "new_api": "flic_decode_frame_8BPP",
          "old_text": null,
          "new_text": "flic_decode_frame_8BPP(avctx, data, got_frame,\n                                      buf, buf_size)",
          "old_line_content": "static int flic_decode_frame(AVCodecContext *avctx,",
          "new_line_content": "        return flic_decode_frame_8BPP(avctx, data, got_frame,",
          "content_same": false
        },
        {
          "line": 1080,
          "old_api": null,
          "new_api": "flic_decode_frame_15_16BPP",
          "old_text": null,
          "new_text": "flic_decode_frame_15_16BPP(avctx, data, got_frame,\n                                          buf, buf_size)",
          "old_line_content": "    const uint8_t *buf = avpkt->data;",
          "new_line_content": "        return flic_decode_frame_15_16BPP(avctx, data, got_frame,",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 1090,
          "old_api": "flic_decode_frame_24BPP",
          "new_api": null,
          "old_text": "flic_decode_frame_24BPP(avctx, data, got_frame,\n                                       buf, buf_size)",
          "new_text": null,
          "old_line_content": "        return flic_decode_frame_24BPP(avctx, data, got_frame,",
          "new_line_content": "    /* But in case we do, just error out. */",
          "content_same": false
        },
        {
          "line": 1030,
          "old_api": "bytestream2_get_le24",
          "new_api": null,
          "old_text": "bytestream2_get_le24(&g2)",
          "new_text": null,
          "old_line_content": "                        pixel = bytestream2_get_le24(&g2);",
          "new_line_content": "                }",
          "content_same": false
        },
        {
          "line": 1031,
          "old_api": "AV_WL24",
          "new_api": null,
          "old_text": "AV_WL24(&pixels[y_ptr + pixel_ptr], pixel)",
          "new_text": null,
          "old_line_content": "                        AV_WL24(&pixels[y_ptr + pixel_ptr], pixel);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 1064,
          "old_api": "bytestream2_get_bytes_left",
          "new_api": null,
          "old_text": "bytestream2_get_bytes_left(&g2)",
          "new_text": null,
          "old_line_content": "    if ((bytestream2_get_bytes_left(&g2) != 0) && (bytestream2_get_bytes_left(&g2) != 1))",
          "new_line_content": "    *got_frame = 1;",
          "content_same": false
        },
        {
          "line": 1065,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(avctx, AV_LOG_ERROR, \"Processed FLI chunk where chunk size = %d \" \\\n               \"and final chunk ptr = %d\\n\", buf_size, bytestream2_tell(&g2))",
          "new_text": null,
          "old_line_content": "        av_log(avctx, AV_LOG_ERROR, \"Processed FLI chunk where chunk size = %d \" \\",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1066,
          "old_api": "bytestream2_tell",
          "new_api": null,
          "old_text": "bytestream2_tell(&g2)",
          "new_text": null,
          "old_line_content": "               \"and final chunk ptr = %d\\n\", buf_size, bytestream2_tell(&g2));",
          "new_line_content": "    return buf_size;",
          "content_same": false
        },
        {
          "line": 1098,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(avctx, AV_LOG_ERROR, \"Unknown FLC format, my science cannot explain how this happened.\\n\")",
          "new_text": null,
          "old_line_content": "    av_log(avctx, AV_LOG_ERROR, \"Unknown FLC format, my science cannot explain how this happened.\\n\");",
          "new_line_content": "    FlicDecodeContext *s = avctx->priv_data;",
          "content_same": false
        },
        {
          "line": 1068,
          "old_api": "av_frame_ref",
          "new_api": null,
          "old_text": "av_frame_ref(data, s->frame)",
          "new_text": null,
          "old_line_content": "    if ((ret = av_frame_ref(data, s->frame)) < 0)",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1043,
          "old_api": "bytestream2_skip",
          "new_api": null,
          "old_text": "bytestream2_skip(&g2, chunk_size - 6)",
          "new_text": null,
          "old_line_content": "            bytestream2_skip(&g2, chunk_size - 6);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1114,
          "old_api": "NULL_IF_CONFIG_SMALL",
          "new_api": null,
          "old_text": "NULL_IF_CONFIG_SMALL(\"Autodesk Animator Flic video\")",
          "new_text": null,
          "old_line_content": "    .long_name      = NULL_IF_CONFIG_SMALL(\"Autodesk Animator Flic video\"),",
          "new_line_content": "    .capabilities   = AV_CODEC_CAP_DR1,",
          "content_same": false
        },
        {
          "line": 1051,
          "old_api": "bytestream2_tell",
          "new_api": null,
          "old_text": "bytestream2_tell(&g2)",
          "new_text": null,
          "old_line_content": "        if (stream_ptr_after_chunk - bytestream2_tell(&g2) >= 0) {",
          "new_line_content": "        frame_size -= chunk_size;",
          "content_same": false
        },
        {
          "line": 1052,
          "old_api": "bytestream2_tell",
          "new_api": null,
          "old_text": "bytestream2_tell(&g2)",
          "new_text": null,
          "old_line_content": "            bytestream2_skip(&g2, stream_ptr_after_chunk - bytestream2_tell(&g2));",
          "new_line_content": "        num_chunks--;",
          "content_same": false
        },
        {
          "line": 1054,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(avctx, AV_LOG_ERROR, \"Chunk overread\\n\")",
          "new_text": null,
          "old_line_content": "            av_log(avctx, AV_LOG_ERROR, \"Chunk overread\\n\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1087,
          "old_api": "flic_decode_frame_15_16BPP",
          "new_api": null,
          "old_text": "flic_decode_frame_15_16BPP(avctx, data, got_frame,\n                                          buf, buf_size)",
          "new_text": null,
          "old_line_content": "        return flic_decode_frame_15_16BPP(avctx, data, got_frame,",
          "new_line_content": "    /* Should not get  here, ever as the pix_fmt is processed */",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 2,
      "total_additions": 13,
      "total_deletions": 14,
      "total_api_changes": 29
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 8,
        "api_related_lines": 29,
        "non_api_lines": 4,
        "non_api_line_numbers": [
          1032,
          1033,
          1034,
          1028
        ]
      }
    },
    "api_calls_before": 232,
    "api_calls_after": 231,
    "diff_info": {
      "added_lines": 1,
      "removed_lines": 8,
      "total_diff_lines": 21
    }
  }
}