{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/f10aeab69ca094f2059bad992a8b68bc767a46c9",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/f10aeab69ca094f2059bad992a8b68bc767a46c9/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/f10aeab69ca094f2059bad992a8b68bc767a46c9/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/f10aeab69ca094f2059bad992a8b68bc767a46c9/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 158,
          "old_api": "av_assert1",
          "new_api": "av_assert0",
          "old_text": "av_assert1(off>=0)",
          "new_text": "av_assert0(ctx->channels == out->ch_count)",
          "old_line_content": "        av_assert1(off>=0);",
          "new_line_content": "    av_assert0(ctx->channels == out->ch_count);",
          "content_same": false
        },
        {
          "line": 164,
          "old_api": "simd_f",
          "new_api": "av_assert1",
          "old_text": "ctx->simd_f(out->ch+ch, in->ch+ch, off * (out->planar ? 1 :out->ch_count))",
          "new_text": "av_assert1(off>=0)",
          "old_line_content": "                    ctx->simd_f(out->ch+ch, in->ch+ch, off * (out->planar ? 1 :out->ch_count));",
          "new_line_content": "        av_assert1(off>=0);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 129,
          "old_api": null,
          "new_api": "av_get_planar_sample_fmt",
          "old_text": null,
          "new_text": "av_get_planar_sample_fmt( in_fmt)",
          "old_line_content": "    ctx->ch_map   = ch_map;",
          "new_line_content": "         in_fmt = av_get_planar_sample_fmt( in_fmt);",
          "content_same": false
        },
        {
          "line": 130,
          "old_api": null,
          "new_api": "av_get_planar_sample_fmt",
          "old_text": null,
          "new_text": "av_get_planar_sample_fmt(out_fmt)",
          "old_line_content": "    if (in_fmt == AV_SAMPLE_FMT_U8)",
          "new_line_content": "        out_fmt = av_get_planar_sample_fmt(out_fmt);",
          "content_same": false
        },
        {
          "line": 165,
          "old_api": null,
          "new_api": "av_assert1",
          "old_text": null,
          "new_text": "av_assert1(off<=len)",
          "old_line_content": "                }",
          "new_line_content": "        av_assert1(off<=len);",
          "content_same": false
        },
        {
          "line": 137,
          "old_api": null,
          "new_api": "memset",
          "old_text": null,
          "new_text": "memset(ctx->silence, 0x80, sizeof(ctx->silence))",
          "old_line_content": "",
          "new_line_content": "        memset(ctx->silence, 0x80, sizeof(ctx->silence));",
          "content_same": false
        },
        {
          "line": 170,
          "old_api": null,
          "new_api": "simd_f",
          "old_text": null,
          "new_text": "ctx->simd_f(out->ch+ch, in->ch+ch, off * (out->planar ? 1 :out->ch_count))",
          "old_line_content": "        if(off == len)",
          "new_line_content": "                    ctx->simd_f(out->ch+ch, in->ch+ch, off * (out->planar ? 1 :out->ch_count));",
          "content_same": false
        },
        {
          "line": 173,
          "old_api": null,
          "new_api": "simd_f",
          "old_text": null,
          "new_text": "ctx->simd_f(out->ch, in->ch, off)",
          "old_line_content": "",
          "new_line_content": "                ctx->simd_f(out->ch, in->ch, off);",
          "content_same": false
        },
        {
          "line": 142,
          "old_api": null,
          "new_api": "swri_audio_convert_init_x86",
          "old_text": null,
          "new_text": "swri_audio_convert_init_x86(ctx, out_fmt, in_fmt, channels)",
          "old_line_content": "{",
          "new_line_content": "    if(HAVE_YASM && HAVE_MMX) swri_audio_convert_init_x86(ctx, out_fmt, in_fmt, channels);",
          "content_same": false
        },
        {
          "line": 149,
          "old_api": null,
          "new_api": "av_freep",
          "old_text": null,
          "new_text": "av_freep(ctx)",
          "old_line_content": "    int off=0;",
          "new_line_content": "    av_freep(ctx);",
          "content_same": false
        },
        {
          "line": 188,
          "old_api": null,
          "new_api": "conv_f",
          "old_text": null,
          "new_text": "ctx->conv_f(po+off*os, pi+off*is, is, os, end)",
          "old_line_content": "",
          "new_line_content": "        ctx->conv_f(po+off*os, pi+off*is, is, os, end);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 131,
          "old_api": "memset",
          "new_api": null,
          "old_text": "memset(ctx->silence, 0x80, sizeof(ctx->silence))",
          "new_text": null,
          "old_line_content": "        memset(ctx->silence, 0x80, sizeof(ctx->silence));",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 167,
          "old_api": "simd_f",
          "new_api": null,
          "old_text": "ctx->simd_f(out->ch, in->ch, off)",
          "new_text": null,
          "old_line_content": "                ctx->simd_f(out->ch, in->ch, off);",
          "new_line_content": "            if(out->planar == in->planar){",
          "content_same": false
        },
        {
          "line": 136,
          "old_api": "swri_audio_convert_init_x86",
          "new_api": null,
          "old_text": "swri_audio_convert_init_x86(ctx, out_fmt, in_fmt, channels)",
          "new_text": null,
          "old_line_content": "    if(HAVE_YASM && HAVE_MMX) swri_audio_convert_init_x86(ctx, out_fmt, in_fmt, channels);",
          "new_line_content": "    if (in_fmt == AV_SAMPLE_FMT_U8)",
          "content_same": false
        },
        {
          "line": 143,
          "old_api": "av_freep",
          "new_api": null,
          "old_text": "av_freep(ctx)",
          "new_text": null,
          "old_line_content": "    av_freep(ctx);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 182,
          "old_api": "conv_f",
          "new_api": null,
          "old_text": "ctx->conv_f(po+off*os, pi+off*is, is, os, end)",
          "new_text": null,
          "old_line_content": "        ctx->conv_f(po+off*os, pi+off*is, is, os, end);",
          "new_line_content": "        const int is= ich < 0 ? 0 : (in->planar ? 1 : in->ch_count) * in->bps;",
          "content_same": false
        },
        {
          "line": 152,
          "old_api": "av_assert0",
          "new_api": null,
          "old_text": "av_assert0(ctx->channels == out->ch_count)",
          "new_text": null,
          "old_line_content": "    av_assert0(ctx->channels == out->ch_count);",
          "new_line_content": "int swri_audio_convert(AudioConvert *ctx, AudioData *out, AudioData *in, int len)",
          "content_same": false
        },
        {
          "line": 159,
          "old_api": "av_assert1",
          "new_api": null,
          "old_text": "av_assert1(off<=len)",
          "new_text": null,
          "old_line_content": "        av_assert1(off<=len);",
          "new_line_content": "",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 2,
      "total_additions": 9,
      "total_deletions": 7,
      "total_api_changes": 18
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 6,
        "api_related_lines": 18,
        "non_api_lines": 3,
        "non_api_line_numbers": [
          128,
          132,
          127
        ]
      }
    },
    "api_calls_before": 38,
    "api_calls_after": 40,
    "diff_info": {
      "added_lines": 6,
      "removed_lines": 0,
      "total_diff_lines": 18
    }
  }
}