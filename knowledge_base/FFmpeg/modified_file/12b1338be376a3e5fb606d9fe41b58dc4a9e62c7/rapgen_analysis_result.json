{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/12b1338be376a3e5fb606d9fe41b58dc4a9e62c7",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/12b1338be376a3e5fb606d9fe41b58dc4a9e62c7/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/12b1338be376a3e5fb606d9fe41b58dc4a9e62c7/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/12b1338be376a3e5fb606d9fe41b58dc4a9e62c7/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 437,
          "old_api": "memcpy",
          "new_api": "fill24",
          "old_text": "memcpy(dst, src, cnt)",
          "new_text": "fill24(dst, cnt)",
          "old_line_content": "            memcpy(dst, src, cnt);",
          "new_line_content": "        fill24(dst, cnt);",
          "content_same": false
        },
        {
          "line": 454,
          "old_api": "AV_COPY16U",
          "new_api": "AV_COPY32U",
          "old_text": "AV_COPY16U(dst, src)",
          "new_text": "AV_COPY32U(dst + 4, src + 4)",
          "old_line_content": "            AV_COPY16U(dst, src);",
          "new_line_content": "            AV_COPY32U(dst + 4, src + 4);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 439,
          "old_api": null,
          "new_api": "fill32",
          "old_text": null,
          "new_text": "fill32(dst, cnt)",
          "old_line_content": "        }",
          "new_line_content": "        fill32(dst, cnt);",
          "content_same": false
        },
        {
          "line": 449,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(dst, src, cnt)",
          "old_line_content": "            src += 4;",
          "new_line_content": "            memcpy(dst, src, cnt);",
          "content_same": false
        },
        {
          "line": 453,
          "old_api": null,
          "new_api": "AV_COPY32U",
          "old_text": null,
          "new_text": "AV_COPY32U(dst,     src)",
          "old_line_content": "        if (cnt >= 2) {",
          "new_line_content": "            AV_COPY32U(dst,     src);",
          "content_same": false
        },
        {
          "line": 486,
          "old_api": null,
          "new_api": "FFMAX",
          "old_text": null,
          "new_text": "FFMAX(min_size + min_size / 16 + 32, min_size)",
          "old_line_content": "}",
          "new_line_content": "    min_size = FFMIN(max_alloc_size - 32, FFMAX(min_size + min_size / 16 + 32, min_size));",
          "content_same": false
        },
        {
          "line": 488,
          "old_api": null,
          "new_api": "av_realloc",
          "old_text": null,
          "new_text": "av_realloc(ptr, min_size)",
          "old_line_content": "void av_fast_malloc(void *ptr, unsigned int *size, size_t min_size)",
          "new_line_content": "    ptr = av_realloc(ptr, min_size);",
          "content_same": false
        },
        {
          "line": 460,
          "old_api": null,
          "new_api": "AV_COPY32U",
          "old_text": null,
          "new_text": "AV_COPY32U(dst, src)",
          "old_line_content": "            *dst = *src;",
          "new_line_content": "            AV_COPY32U(dst, src);",
          "content_same": false
        },
        {
          "line": 433,
          "old_api": null,
          "new_api": "memset",
          "old_text": null,
          "new_text": "memset(dst, *src, cnt)",
          "old_line_content": "                dst       += blocklen;",
          "new_line_content": "        memset(dst, *src, cnt);",
          "content_same": false
        },
        {
          "line": 466,
          "old_api": null,
          "new_api": "AV_COPY16U",
          "old_text": null,
          "new_text": "AV_COPY16U(dst, src)",
          "old_line_content": "    if (min_size <= *size)",
          "new_line_content": "            AV_COPY16U(dst, src);",
          "content_same": false
        },
        {
          "line": 435,
          "old_api": null,
          "new_api": "fill16",
          "old_text": null,
          "new_text": "fill16(dst, cnt)",
          "old_line_content": "                blocklen <<= 1;",
          "new_line_content": "        fill16(dst, cnt);",
          "content_same": false
        },
        {
          "line": 405,
          "old_api": null,
          "new_api": "AV_WN64",
          "old_text": null,
          "new_text": "AV_WN64(dst   , v2)",
          "old_line_content": "        len -= 4;",
          "new_line_content": "        AV_WN64(dst   , v2);",
          "content_same": false
        },
        {
          "line": 406,
          "old_api": null,
          "new_api": "AV_WN64",
          "old_text": null,
          "new_text": "AV_WN64(dst+ 8, v2)",
          "old_line_content": "    }",
          "new_line_content": "        AV_WN64(dst+ 8, v2);",
          "content_same": false
        },
        {
          "line": 407,
          "old_api": null,
          "new_api": "AV_WN64",
          "old_text": null,
          "new_text": "AV_WN64(dst+16, v2)",
          "old_line_content": "",
          "new_line_content": "        AV_WN64(dst+16, v2);",
          "content_same": false
        },
        {
          "line": 408,
          "old_api": null,
          "new_api": "AV_WN64",
          "old_text": null,
          "new_text": "AV_WN64(dst+24, v2)",
          "old_line_content": "    while (len--) {",
          "new_line_content": "        AV_WN64(dst+24, v2);",
          "content_same": false
        },
        {
          "line": 502,
          "old_api": null,
          "new_api": "ff_fast_malloc",
          "old_text": null,
          "new_text": "ff_fast_malloc(ptr, size, min_size, 0)",
          "old_line_content": "",
          "new_line_content": "    ff_fast_malloc(ptr, size, min_size, 0);",
          "content_same": false
        },
        {
          "line": 507,
          "old_api": null,
          "new_api": "ff_fast_malloc",
          "old_text": null,
          "new_text": "ff_fast_malloc(ptr, size, min_size, 1)",
          "old_line_content": "",
          "new_line_content": "    ff_fast_malloc(ptr, size, min_size, 1);",
          "content_same": false
        },
        {
          "line": 444,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(dst, src, blocklen)",
          "old_line_content": "            dst += 8;",
          "new_line_content": "                memcpy(dst, src, blocklen);",
          "content_same": false
        },
        {
          "line": 415,
          "old_api": null,
          "new_api": "AV_WN32",
          "old_text": null,
          "new_text": "AV_WN32(dst, v)",
          "old_line_content": "{",
          "new_line_content": "        AV_WN32(dst, v);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 448,
          "old_api": "AV_COPY32U",
          "new_api": null,
          "old_text": "AV_COPY32U(dst, src)",
          "new_text": null,
          "old_line_content": "            AV_COPY32U(dst, src);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 421,
          "old_api": "memset",
          "new_api": null,
          "old_text": "memset(dst, *src, cnt)",
          "new_text": null,
          "old_line_content": "        memset(dst, *src, cnt);",
          "new_line_content": "        *dst = dst[-4];",
          "content_same": false
        },
        {
          "line": 423,
          "old_api": "fill16",
          "new_api": null,
          "old_text": "fill16(dst, cnt)",
          "new_text": null,
          "old_line_content": "        fill16(dst, cnt);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 425,
          "old_api": "fill24",
          "new_api": null,
          "old_text": "fill24(dst, cnt)",
          "new_text": null,
          "old_line_content": "        fill24(dst, cnt);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 490,
          "old_api": "ff_fast_malloc",
          "new_api": null,
          "old_text": "ff_fast_malloc(ptr, size, min_size, 0)",
          "new_text": null,
          "old_line_content": "    ff_fast_malloc(ptr, size, min_size, 0);",
          "new_line_content": "     * if the user lost the ptr and uses NULL now",
          "content_same": false
        },
        {
          "line": 427,
          "old_api": "fill32",
          "new_api": null,
          "old_text": "fill32(dst, cnt)",
          "new_text": null,
          "old_line_content": "        fill32(dst, cnt);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 495,
          "old_api": "ff_fast_malloc",
          "new_api": null,
          "old_text": "ff_fast_malloc(ptr, size, min_size, 1)",
          "new_text": null,
          "old_line_content": "    ff_fast_malloc(ptr, size, min_size, 1);",
          "new_line_content": "    *size = min_size;",
          "content_same": false
        },
        {
          "line": 432,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(dst, src, blocklen)",
          "new_text": null,
          "old_line_content": "                memcpy(dst, src, blocklen);",
          "new_line_content": "    if (back == 1) {",
          "content_same": false
        },
        {
          "line": 474,
          "old_api": "FFMAX",
          "new_api": null,
          "old_text": "FFMAX(min_size + min_size / 16 + 32, min_size)",
          "new_text": null,
          "old_line_content": "    min_size = FFMIN(max_alloc_size - 32, FFMAX(min_size + min_size / 16 + 32, min_size));",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 403,
          "old_api": "AV_WN32",
          "new_api": null,
          "old_text": "AV_WN32(dst, v)",
          "new_text": null,
          "old_line_content": "        AV_WN32(dst, v);",
          "new_line_content": "    uint64_t v2= v + ((uint64_t)v<<32);",
          "content_same": false
        },
        {
          "line": 441,
          "old_api": "AV_COPY32U",
          "new_api": null,
          "old_text": "AV_COPY32U(dst,     src)",
          "new_text": null,
          "old_line_content": "            AV_COPY32U(dst,     src);",
          "new_line_content": "        if (cnt >= 16) {",
          "content_same": false
        },
        {
          "line": 442,
          "old_api": "AV_COPY32U",
          "new_api": null,
          "old_text": "AV_COPY32U(dst + 4, src + 4)",
          "new_text": null,
          "old_line_content": "            AV_COPY32U(dst + 4, src + 4);",
          "new_line_content": "            int blocklen = back;",
          "content_same": false
        },
        {
          "line": 476,
          "old_api": "av_realloc",
          "new_api": null,
          "old_text": "av_realloc(ptr, min_size)",
          "new_text": null,
          "old_line_content": "    ptr = av_realloc(ptr, min_size);",
          "new_line_content": "void *av_fast_realloc(void *ptr, unsigned int *size, size_t min_size)",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 2,
      "total_additions": 17,
      "total_deletions": 13,
      "total_api_changes": 32
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 12,
        "api_related_lines": 32,
        "non_api_lines": 7,
        "non_api_line_numbers": [
          402,
          404,
          409,
          410,
          411,
          412,
          413
        ]
      }
    },
    "api_calls_before": 80,
    "api_calls_after": 84,
    "diff_info": {
      "added_lines": 12,
      "removed_lines": 0,
      "total_diff_lines": 24
    }
  }
}