{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/48f80831bad87addf40b6496210817ea0efc85af",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/48f80831bad87addf40b6496210817ea0efc85af/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/48f80831bad87addf40b6496210817ea0efc85af/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/48f80831bad87addf40b6496210817ea0efc85af/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 280,
          "old_api": "put_bits",
          "new_api": "renorm_cabac_encoder",
          "old_text": "put_bits(&c->pb, 2, ((c->low>>7)&3)|1)",
          "new_text": "renorm_cabac_encoder(c)",
          "old_line_content": "        put_bits(&c->pb, 2, ((c->low>>7)&3)|1);",
          "new_line_content": "        renorm_cabac_encoder(c);",
          "content_same": false
        },
        {
          "line": 285,
          "old_api": "put_bits_count",
          "new_api": "renorm_cabac_encoder",
          "old_text": "put_bits_count(&c->pb)",
          "new_text": "renorm_cabac_encoder(c)",
          "old_line_content": "    return (put_bits_count(&c->pb)+7)>>3;",
          "new_line_content": "        renorm_cabac_encoder(c);",
          "content_same": false
        },
        {
          "line": 305,
          "old_api": "put_cabac_bypass",
          "new_api": "av_lfg_init",
          "old_text": "put_cabac_bypass(&c, r[i]&1)",
          "new_text": "av_lfg_init(&prng, 1)",
          "old_line_content": "        put_cabac_bypass(&c, r[i]&1);",
          "new_line_content": "    av_lfg_init(&prng, 1);",
          "content_same": false
        },
        {
          "line": 309,
          "old_api": "put_cabac",
          "new_api": "av_lfg_get",
          "old_text": "put_cabac(&c, state, r[i]&1)",
          "new_text": "av_lfg_get(&prng)",
          "old_line_content": "        put_cabac(&c, state, r[i]&1);",
          "new_line_content": "        if(2*i<SIZE) r[i] = av_lfg_get(&prng) % 7;",
          "content_same": false
        },
        {
          "line": 314,
          "old_api": "ff_init_cabac_decoder",
          "new_api": "put_cabac_bypass",
          "old_text": "ff_init_cabac_decoder(&c, b, SIZE)",
          "new_text": "put_cabac_bypass(&c, r[i]&1)",
          "old_line_content": "    ff_init_cabac_decoder(&c, b, SIZE);",
          "new_line_content": "        put_cabac_bypass(&c, r[i]&1);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 262,
          "old_api": null,
          "new_api": "put_cabac_bit",
          "old_text": null,
          "new_text": "put_cabac_bit(c, 0)",
          "old_line_content": "",
          "new_line_content": "        put_cabac_bit(c, 0);",
          "content_same": false
        },
        {
          "line": 267,
          "old_api": null,
          "new_api": "put_cabac_bit",
          "old_text": null,
          "new_text": "put_cabac_bit(c, 1)",
          "old_line_content": "static int put_cabac_terminate(CABACContext *c, int bit){",
          "new_line_content": "        put_cabac_bit(c, 1);",
          "content_same": false
        },
        {
          "line": 287,
          "old_api": null,
          "new_api": "av_assert0",
          "old_text": null,
          "new_text": "av_assert0(c->low <= 0x1FF)",
          "old_line_content": "",
          "new_line_content": "        av_assert0(c->low <= 0x1FF);",
          "content_same": false
        },
        {
          "line": 288,
          "old_api": null,
          "new_api": "put_cabac_bit",
          "old_text": null,
          "new_text": "put_cabac_bit(c, c->low>>9)",
          "old_line_content": "int main(void){",
          "new_line_content": "        put_cabac_bit(c, c->low>>9);",
          "content_same": false
        },
        {
          "line": 289,
          "old_api": null,
          "new_api": "put_bits",
          "old_text": null,
          "new_text": "put_bits(&c->pb, 2, ((c->low>>7)&3)|1)",
          "old_line_content": "    CABACContext c;",
          "new_line_content": "        put_bits(&c->pb, 2, ((c->low>>7)&3)|1);",
          "content_same": false
        },
        {
          "line": 291,
          "old_api": null,
          "new_api": "flush_put_bits",
          "old_text": null,
          "new_text": "flush_put_bits(&c->pb)",
          "old_line_content": "    uint8_t r[9*SIZE];",
          "new_line_content": "        flush_put_bits(&c->pb); //FIXME FIXME FIXME XXX wrong",
          "content_same": false
        },
        {
          "line": 294,
          "old_api": null,
          "new_api": "put_bits_count",
          "old_text": null,
          "new_text": "put_bits_count(&c->pb)",
          "old_line_content": "    AVLFG prng;",
          "new_line_content": "    return (put_bits_count(&c->pb)+7)>>3;",
          "content_same": false
        },
        {
          "line": 306,
          "old_api": null,
          "new_api": "ff_init_cabac_encoder",
          "old_text": null,
          "new_text": "ff_init_cabac_encoder(&c, b, SIZE)",
          "old_line_content": "    }",
          "new_line_content": "    ff_init_cabac_encoder(&c, b, SIZE);",
          "content_same": false
        },
        {
          "line": 318,
          "old_api": null,
          "new_api": "put_cabac",
          "old_text": null,
          "new_text": "put_cabac(&c, state, r[i]&1)",
          "old_line_content": "    for(i=0; i<SIZE; i++){",
          "new_line_content": "        put_cabac(&c, state, r[i]&1);",
          "content_same": false
        },
        {
          "line": 321,
          "old_api": null,
          "new_api": "put_cabac_terminate",
          "old_text": null,
          "new_text": "put_cabac_terminate(&c, 1)",
          "old_line_content": "            ret = 1;",
          "new_line_content": "    put_cabac_terminate(&c, 1);",
          "content_same": false
        },
        {
          "line": 323,
          "old_api": null,
          "new_api": "ff_init_cabac_decoder",
          "old_text": null,
          "new_text": "ff_init_cabac_decoder(&c, b, SIZE)",
          "old_line_content": "    }",
          "new_line_content": "    ff_init_cabac_decoder(&c, b, SIZE);",
          "content_same": false
        },
        {
          "line": 325,
          "old_api": null,
          "new_api": "memset",
          "old_text": null,
          "new_text": "memset(state, 0, sizeof(state))",
          "old_line_content": "    for(i=0; i<SIZE; i++){",
          "new_line_content": "    memset(state, 0, sizeof(state));",
          "content_same": false
        },
        {
          "line": 328,
          "old_api": null,
          "new_api": "get_cabac_bypass",
          "old_text": null,
          "new_text": "get_cabac_bypass(&c)",
          "old_line_content": "            ret = 1;",
          "new_line_content": "        if( (r[i]&1) != get_cabac_bypass(&c) ) {",
          "content_same": false
        },
        {
          "line": 329,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(NULL, AV_LOG_ERROR, \"CABAC bypass failure at %d\\n\", i)",
          "old_line_content": "        }",
          "new_line_content": "            av_log(NULL, AV_LOG_ERROR, \"CABAC bypass failure at %d\\n\", i);",
          "content_same": false
        },
        {
          "line": 335,
          "old_api": null,
          "new_api": "get_cabac_noinline",
          "old_text": null,
          "new_text": "get_cabac_noinline(&c, state)",
          "old_line_content": "",
          "new_line_content": "        if( (r[i]&1) != get_cabac_noinline(&c, state) ) {",
          "content_same": false
        },
        {
          "line": 336,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(NULL, AV_LOG_ERROR, \"CABAC failure at %d\\n\", i)",
          "old_line_content": "    return ret;",
          "new_line_content": "            av_log(NULL, AV_LOG_ERROR, \"CABAC failure at %d\\n\", i);",
          "content_same": false
        },
        {
          "line": 212,
          "old_api": null,
          "new_api": "put_bits",
          "old_text": null,
          "new_text": "put_bits(&c->pb, 1, b)",
          "old_line_content": "        if(c->low<0x100){",
          "new_line_content": "    put_bits(&c->pb, 1, b);",
          "content_same": false
        },
        {
          "line": 340,
          "old_api": null,
          "new_api": "get_cabac_terminate",
          "old_text": null,
          "new_text": "get_cabac_terminate(&c)",
          "old_line_content": "",
          "new_line_content": "    if(!get_cabac_terminate(&c)) {",
          "content_same": false
        },
        {
          "line": 214,
          "old_api": null,
          "new_api": "put_bits",
          "old_text": null,
          "new_text": "put_bits(&c->pb, 1, 1-b)",
          "old_line_content": "        }else if(c->low<0x200){",
          "new_line_content": "        put_bits(&c->pb, 1, 1-b);",
          "content_same": false
        },
        {
          "line": 341,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(NULL, AV_LOG_ERROR, \"where's the Terminator?\\n\")",
          "old_line_content": "",
          "new_line_content": "        av_log(NULL, AV_LOG_ERROR, \"where's the Terminator?\\n\");",
          "content_same": false
        },
        {
          "line": 222,
          "old_api": null,
          "new_api": "put_cabac_bit",
          "old_text": null,
          "new_text": "put_cabac_bit(c, 0)",
          "old_line_content": "        c->range+= c->range;",
          "new_line_content": "            put_cabac_bit(c, 0);",
          "content_same": false
        },
        {
          "line": 227,
          "old_api": null,
          "new_api": "put_cabac_bit",
          "old_text": null,
          "new_text": "put_cabac_bit(c, 1)",
          "old_line_content": "static void put_cabac(CABACContext *c, uint8_t * const state, int bit){",
          "new_line_content": "            put_cabac_bit(c, 1);",
          "content_same": false
        },
        {
          "line": 248,
          "old_api": null,
          "new_api": "renorm_cabac_encoder",
          "old_text": null,
          "new_text": "renorm_cabac_encoder(c)",
          "old_line_content": "    if(bit){",
          "new_line_content": "    renorm_cabac_encoder(c);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 258,
          "old_api": "put_cabac_bit",
          "new_api": null,
          "old_text": "put_cabac_bit(c, 1)",
          "new_text": null,
          "old_line_content": "        put_cabac_bit(c, 1);",
          "new_line_content": "        c->low += c->range;",
          "content_same": false
        },
        {
          "line": 271,
          "old_api": "renorm_cabac_encoder",
          "new_api": null,
          "old_text": "renorm_cabac_encoder(c)",
          "new_text": null,
          "old_line_content": "        renorm_cabac_encoder(c);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 276,
          "old_api": "renorm_cabac_encoder",
          "new_api": null,
          "old_text": "renorm_cabac_encoder(c)",
          "new_text": null,
          "old_line_content": "        renorm_cabac_encoder(c);",
          "new_line_content": "static int put_cabac_terminate(CABACContext *c, int bit){",
          "content_same": false
        },
        {
          "line": 278,
          "old_api": "av_assert0",
          "new_api": null,
          "old_text": "av_assert0(c->low <= 0x1FF)",
          "new_text": null,
          "old_line_content": "        av_assert0(c->low <= 0x1FF);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 279,
          "old_api": "put_cabac_bit",
          "new_api": null,
          "old_text": "put_cabac_bit(c, c->low>>9)",
          "new_text": null,
          "old_line_content": "        put_cabac_bit(c, c->low>>9);",
          "new_line_content": "    if(!bit){",
          "content_same": false
        },
        {
          "line": 282,
          "old_api": "flush_put_bits",
          "new_api": null,
          "old_text": "flush_put_bits(&c->pb)",
          "new_text": null,
          "old_line_content": "        flush_put_bits(&c->pb); //FIXME FIXME FIXME XXX wrong",
          "new_line_content": "        c->low += c->range;",
          "content_same": false
        },
        {
          "line": 296,
          "old_api": "av_lfg_init",
          "new_api": null,
          "old_text": "av_lfg_init(&prng, 1)",
          "new_text": null,
          "old_line_content": "    av_lfg_init(&prng, 1);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 297,
          "old_api": "ff_init_cabac_encoder",
          "new_api": null,
          "old_text": "ff_init_cabac_encoder(&c, b, SIZE)",
          "new_text": null,
          "old_line_content": "    ff_init_cabac_encoder(&c, b, SIZE);",
          "new_line_content": "int main(void){",
          "content_same": false
        },
        {
          "line": 300,
          "old_api": "av_lfg_get",
          "new_api": null,
          "old_text": "av_lfg_get(&prng)",
          "new_text": null,
          "old_line_content": "        if(2*i<SIZE) r[i] = av_lfg_get(&prng) % 7;",
          "new_line_content": "    uint8_t r[9*SIZE];",
          "content_same": false
        },
        {
          "line": 312,
          "old_api": "put_cabac_terminate",
          "new_api": null,
          "old_text": "put_cabac_terminate(&c, 1)",
          "new_text": null,
          "old_line_content": "    put_cabac_terminate(&c, 1);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 316,
          "old_api": "memset",
          "new_api": null,
          "old_text": "memset(state, 0, sizeof(state))",
          "new_text": null,
          "old_line_content": "    memset(state, 0, sizeof(state));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 319,
          "old_api": "get_cabac_bypass",
          "new_api": null,
          "old_text": "get_cabac_bypass(&c)",
          "new_text": null,
          "old_line_content": "        if( (r[i]&1) != get_cabac_bypass(&c) ) {",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 320,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(NULL, AV_LOG_ERROR, \"CABAC bypass failure at %d\\n\", i)",
          "new_text": null,
          "old_line_content": "            av_log(NULL, AV_LOG_ERROR, \"CABAC bypass failure at %d\\n\", i);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 326,
          "old_api": "get_cabac_noinline",
          "new_api": null,
          "old_text": "get_cabac_noinline(&c, state)",
          "new_text": null,
          "old_line_content": "        if( (r[i]&1) != get_cabac_noinline(&c, state) ) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 327,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(NULL, AV_LOG_ERROR, \"CABAC failure at %d\\n\", i)",
          "new_text": null,
          "old_line_content": "            av_log(NULL, AV_LOG_ERROR, \"CABAC failure at %d\\n\", i);",
          "new_line_content": "    for(i=0; i<SIZE; i++){",
          "content_same": false
        },
        {
          "line": 203,
          "old_api": "put_bits",
          "new_api": null,
          "old_text": "put_bits(&c->pb, 1, b)",
          "new_text": null,
          "old_line_content": "    put_bits(&c->pb, 1, b);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 331,
          "old_api": "get_cabac_terminate",
          "new_api": null,
          "old_text": "get_cabac_terminate(&c)",
          "new_text": null,
          "old_line_content": "    if(!get_cabac_terminate(&c)) {",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 205,
          "old_api": "put_bits",
          "new_api": null,
          "old_text": "put_bits(&c->pb, 1, 1-b)",
          "new_text": null,
          "old_line_content": "        put_bits(&c->pb, 1, 1-b);",
          "new_line_content": "#ifdef TEST",
          "content_same": false
        },
        {
          "line": 332,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(NULL, AV_LOG_ERROR, \"where's the Terminator?\\n\")",
          "new_text": null,
          "old_line_content": "        av_log(NULL, AV_LOG_ERROR, \"where's the Terminator?\\n\");",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 213,
          "old_api": "put_cabac_bit",
          "new_api": null,
          "old_text": "put_cabac_bit(c, 0)",
          "new_text": null,
          "old_line_content": "            put_cabac_bit(c, 0);",
          "new_line_content": "    for(;c->outstanding_count; c->outstanding_count--){",
          "content_same": false
        },
        {
          "line": 218,
          "old_api": "put_cabac_bit",
          "new_api": null,
          "old_text": "put_cabac_bit(c, 1)",
          "new_text": null,
          "old_line_content": "            put_cabac_bit(c, 1);",
          "new_line_content": "static inline void renorm_cabac_encoder(CABACContext *c){",
          "content_same": false
        },
        {
          "line": 239,
          "old_api": "renorm_cabac_encoder",
          "new_api": null,
          "old_text": "renorm_cabac_encoder(c)",
          "new_text": null,
          "old_line_content": "    renorm_cabac_encoder(c);",
          "new_line_content": "    if(bit == ((*state)&1)){",
          "content_same": false
        },
        {
          "line": 253,
          "old_api": "put_cabac_bit",
          "new_api": null,
          "old_text": "put_cabac_bit(c, 0)",
          "new_text": null,
          "old_line_content": "        put_cabac_bit(c, 0);",
          "new_line_content": " */",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 5,
      "total_additions": 23,
      "total_deletions": 23,
      "total_api_changes": 51
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 10,
        "api_related_lines": 51,
        "non_api_lines": 10,
        "non_api_line_numbers": [
          192,
          193,
          194,
          198,
          186,
          187,
          188,
          189,
          190,
          191
        ]
      }
    },
    "api_calls_before": 29,
    "api_calls_after": 29,
    "diff_info": {
      "added_lines": 10,
      "removed_lines": 1,
      "total_diff_lines": 26
    }
  }
}