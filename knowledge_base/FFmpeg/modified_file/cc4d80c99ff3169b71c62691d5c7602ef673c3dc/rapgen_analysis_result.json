{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/cc4d80c99ff3169b71c62691d5c7602ef673c3dc",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/cc4d80c99ff3169b71c62691d5c7602ef673c3dc/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/cc4d80c99ff3169b71c62691d5c7602ef673c3dc/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/cc4d80c99ff3169b71c62691d5c7602ef673c3dc/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 550,
          "old_api": "memcmp",
          "new_api": "avio_read",
          "old_text": "memcmp(signature_buffer, signature, sizeof(signature))",
          "new_text": "avio_read(pb, signature_buffer, sizeof(signature_buffer))",
          "old_line_content": "    while (memcmp(signature_buffer, signature, sizeof(signature))) {",
          "new_line_content": "    avio_read(pb, signature_buffer, sizeof(signature_buffer));",
          "content_same": false
        },
        {
          "line": 551,
          "old_api": "memmove",
          "new_api": "memcmp",
          "old_text": "memmove(signature_buffer, signature_buffer + 1, sizeof(signature_buffer) - 1)",
          "new_text": "memcmp(signature_buffer, signature, sizeof(signature))",
          "old_line_content": "        memmove(signature_buffer, signature_buffer + 1, sizeof(signature_buffer) - 1);",
          "new_line_content": "    while (memcmp(signature_buffer, signature, sizeof(signature))) {",
          "content_same": false
        },
        {
          "line": 552,
          "old_api": "avio_r8",
          "new_api": "memmove",
          "old_text": "avio_r8(pb)",
          "new_text": "memmove(signature_buffer, signature_buffer + 1, sizeof(signature_buffer) - 1)",
          "old_line_content": "        signature_buffer[sizeof(signature_buffer) - 1] = avio_r8(pb);",
          "new_line_content": "        memmove(signature_buffer, signature_buffer + 1, sizeof(signature_buffer) - 1);",
          "content_same": false
        },
        {
          "line": 553,
          "old_api": "url_feof",
          "new_api": "avio_r8",
          "old_text": "url_feof(pb)",
          "new_text": "avio_r8(pb)",
          "old_line_content": "        if (url_feof(pb))",
          "new_line_content": "        signature_buffer[sizeof(signature_buffer) - 1] = avio_r8(pb);",
          "content_same": false
        },
        {
          "line": 576,
          "old_api": "AV_RL16",
          "new_api": "AVERROR",
          "old_text": "AV_RL16(&chunk_preamble[2])",
          "new_text": "AVERROR(EIO)",
          "old_line_content": "    chunk_type = AV_RL16(&chunk_preamble[2]);",
          "new_line_content": "        return AVERROR(EIO);",
          "content_same": false
        },
        {
          "line": 577,
          "old_api": "avio_seek",
          "new_api": "AV_RL16",
          "old_text": "avio_seek(pb, -CHUNK_PREAMBLE_SIZE, SEEK_CUR)",
          "new_text": "AV_RL16(&chunk_preamble[2])",
          "old_line_content": "    avio_seek(pb, -CHUNK_PREAMBLE_SIZE, SEEK_CUR);",
          "new_line_content": "    chunk_type = AV_RL16(&chunk_preamble[2]);",
          "content_same": false
        },
        {
          "line": 588,
          "old_api": "avpriv_set_pts_info",
          "new_api": "AVERROR",
          "old_text": "avpriv_set_pts_info(st, 63, 1, 1000000)",
          "new_text": "AVERROR(ENOMEM)",
          "old_line_content": "    avpriv_set_pts_info(st, 63, 1, 1000000);",
          "new_line_content": "        return AVERROR(ENOMEM);",
          "content_same": false
        },
        {
          "line": 601,
          "old_api": "avpriv_set_pts_info",
          "new_api": "AVERROR",
          "old_text": "avpriv_set_pts_info(st, 32, 1, ipmovie->audio_sample_rate)",
          "new_text": "AVERROR(ENOMEM)",
          "old_line_content": "        avpriv_set_pts_info(st, 32, 1, ipmovie->audio_sample_rate);",
          "new_line_content": "            return AVERROR(ENOMEM);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 578,
          "old_api": null,
          "new_api": "avio_seek",
          "old_text": null,
          "new_text": "avio_seek(pb, -CHUNK_PREAMBLE_SIZE, SEEK_CUR)",
          "old_line_content": "",
          "new_line_content": "    avio_seek(pb, -CHUNK_PREAMBLE_SIZE, SEEK_CUR);",
          "content_same": false
        },
        {
          "line": 582,
          "old_api": null,
          "new_api": "process_ipmovie_chunk",
          "old_text": null,
          "new_text": "process_ipmovie_chunk(ipmovie, pb, &pkt)",
          "old_line_content": "        return AVERROR_INVALIDDATA;",
          "new_line_content": "    else if (process_ipmovie_chunk(ipmovie, pb, &pkt) != CHUNK_INIT_AUDIO)",
          "content_same": false
        },
        {
          "line": 648,
          "old_api": null,
          "new_api": "NULL_IF_CONFIG_SMALL",
          "old_text": null,
          "new_text": "NULL_IF_CONFIG_SMALL(\"Interplay MVE format\")",
          "old_line_content": "    .priv_data_size = sizeof(IPMVEContext),",
          "new_line_content": "    .long_name      = NULL_IF_CONFIG_SMALL(\"Interplay MVE format\"),",
          "content_same": false
        },
        {
          "line": 554,
          "old_api": null,
          "new_api": "url_feof",
          "old_text": null,
          "new_text": "url_feof(pb)",
          "old_line_content": "            return AVERROR_EOF;",
          "new_line_content": "        if (url_feof(pb))",
          "content_same": false
        },
        {
          "line": 586,
          "old_api": null,
          "new_api": "avformat_new_stream",
          "old_text": null,
          "new_text": "avformat_new_stream(s, NULL)",
          "old_line_content": "    if (!st)",
          "new_line_content": "    st = avformat_new_stream(s, NULL);",
          "content_same": false
        },
        {
          "line": 589,
          "old_api": null,
          "new_api": "avpriv_set_pts_info",
          "old_text": null,
          "new_text": "avpriv_set_pts_info(st, 63, 1, 1000000)",
          "old_line_content": "    ipmovie->video_stream_index = st->index;",
          "new_line_content": "    avpriv_set_pts_info(st, 63, 1, 1000000);",
          "content_same": false
        },
        {
          "line": 563,
          "old_api": null,
          "new_api": "avio_tell",
          "old_text": null,
          "new_text": "avio_tell(pb)",
          "old_line_content": "",
          "new_line_content": "    ipmovie->next_chunk_offset = avio_tell(pb) + 4;",
          "content_same": false
        },
        {
          "line": 628,
          "old_api": null,
          "new_api": "process_ipmovie_chunk",
          "old_text": null,
          "new_text": "process_ipmovie_chunk(ipmovie, pb, pkt)",
          "old_line_content": "    if (ret == CHUNK_BAD)",
          "new_line_content": "    ret = process_ipmovie_chunk(ipmovie, pb, pkt);",
          "content_same": false
        },
        {
          "line": 634,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(ENOMEM)",
          "old_line_content": "    else if (ret == CHUNK_VIDEO)",
          "new_line_content": "        ret = AVERROR(ENOMEM);",
          "content_same": false
        },
        {
          "line": 599,
          "old_api": null,
          "new_api": "avformat_new_stream",
          "old_text": null,
          "new_text": "avformat_new_stream(s, NULL)",
          "old_line_content": "        if (!st)",
          "new_line_content": "        st = avformat_new_stream(s, NULL);",
          "content_same": false
        },
        {
          "line": 632,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(EIO)",
          "old_line_content": "    else if (ret == CHUNK_NOMEM)",
          "new_line_content": "        ret = AVERROR(EIO);",
          "content_same": false
        },
        {
          "line": 569,
          "old_api": null,
          "new_api": "process_ipmovie_chunk",
          "old_text": null,
          "new_text": "process_ipmovie_chunk(ipmovie, pb, &pkt)",
          "old_line_content": "        return AVERROR_INVALIDDATA;",
          "new_line_content": "    if (process_ipmovie_chunk(ipmovie, pb, &pkt) != CHUNK_INIT_VIDEO)",
          "content_same": false
        },
        {
          "line": 602,
          "old_api": null,
          "new_api": "avpriv_set_pts_info",
          "old_text": null,
          "new_text": "avpriv_set_pts_info(st, 32, 1, ipmovie->audio_sample_rate)",
          "old_line_content": "        ipmovie->audio_stream_index = st->index;",
          "new_line_content": "        avpriv_set_pts_info(st, 32, 1, ipmovie->audio_sample_rate);",
          "content_same": false
        },
        {
          "line": 574,
          "old_api": null,
          "new_api": "avio_read",
          "old_text": null,
          "new_text": "avio_read(pb, chunk_preamble, CHUNK_PREAMBLE_SIZE)",
          "old_line_content": "        CHUNK_PREAMBLE_SIZE)",
          "new_line_content": "    if (avio_read(pb, chunk_preamble, CHUNK_PREAMBLE_SIZE) !=",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 549,
          "old_api": "avio_read",
          "new_api": null,
          "old_text": "avio_read(pb, signature_buffer, sizeof(signature_buffer))",
          "new_text": null,
          "old_line_content": "    avio_read(pb, signature_buffer, sizeof(signature_buffer));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 581,
          "old_api": "process_ipmovie_chunk",
          "new_api": null,
          "old_text": "process_ipmovie_chunk(ipmovie, pb, &pkt)",
          "new_text": null,
          "old_line_content": "    else if (process_ipmovie_chunk(ipmovie, pb, &pkt) != CHUNK_INIT_AUDIO)",
          "new_line_content": "        ipmovie->audio_type = CODEC_ID_NONE;  /* no audio */",
          "content_same": false
        },
        {
          "line": 647,
          "old_api": "NULL_IF_CONFIG_SMALL",
          "new_api": null,
          "old_text": "NULL_IF_CONFIG_SMALL(\"Interplay MVE format\")",
          "new_text": null,
          "old_line_content": "    .long_name      = NULL_IF_CONFIG_SMALL(\"Interplay MVE format\"),",
          "new_line_content": "    .name           = \"ipmovie\",",
          "content_same": false
        },
        {
          "line": 585,
          "old_api": "avformat_new_stream",
          "new_api": null,
          "old_text": "avformat_new_stream(s, NULL)",
          "new_text": null,
          "old_line_content": "    st = avformat_new_stream(s, NULL);",
          "new_line_content": "    /* initialize the stream decoders */",
          "content_same": false
        },
        {
          "line": 587,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(ENOMEM)",
          "new_text": null,
          "old_line_content": "        return AVERROR(ENOMEM);",
          "new_line_content": "    if (!st)",
          "content_same": false
        },
        {
          "line": 600,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(ENOMEM)",
          "new_text": null,
          "old_line_content": "            return AVERROR(ENOMEM);",
          "new_line_content": "        if (!st)",
          "content_same": false
        },
        {
          "line": 562,
          "old_api": "avio_tell",
          "new_api": null,
          "old_text": "avio_tell(pb)",
          "new_text": null,
          "old_line_content": "    ipmovie->next_chunk_offset = avio_tell(pb) + 4;",
          "new_line_content": "    /* on the first read, this will position the stream at the first chunk */",
          "content_same": false
        },
        {
          "line": 627,
          "old_api": "process_ipmovie_chunk",
          "new_api": null,
          "old_text": "process_ipmovie_chunk(ipmovie, pb, pkt)",
          "new_text": null,
          "old_line_content": "    ret = process_ipmovie_chunk(ipmovie, pb, pkt);",
          "new_line_content": "    for (;;) {",
          "content_same": false
        },
        {
          "line": 598,
          "old_api": "avformat_new_stream",
          "new_api": null,
          "old_text": "avformat_new_stream(s, NULL)",
          "new_text": null,
          "old_line_content": "        st = avformat_new_stream(s, NULL);",
          "new_line_content": "    if (ipmovie->audio_type) {",
          "content_same": false
        },
        {
          "line": 631,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(EIO)",
          "new_text": null,
          "old_line_content": "        ret = AVERROR(EIO);",
          "new_line_content": "    else if (ret == CHUNK_EOF)",
          "content_same": false
        },
        {
          "line": 568,
          "old_api": "process_ipmovie_chunk",
          "new_api": null,
          "old_text": "process_ipmovie_chunk(ipmovie, pb, &pkt)",
          "new_text": null,
          "old_line_content": "    if (process_ipmovie_chunk(ipmovie, pb, &pkt) != CHUNK_INIT_VIDEO)",
          "new_line_content": "    /* process the first chunk which should be CHUNK_INIT_VIDEO */",
          "content_same": false
        },
        {
          "line": 633,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(ENOMEM)",
          "new_text": null,
          "old_line_content": "        ret = AVERROR(ENOMEM);",
          "new_line_content": "    else if (ret == CHUNK_NOMEM)",
          "content_same": false
        },
        {
          "line": 573,
          "old_api": "avio_read",
          "new_api": null,
          "old_text": "avio_read(pb, chunk_preamble, CHUNK_PREAMBLE_SIZE)",
          "new_text": null,
          "old_line_content": "    if (avio_read(pb, chunk_preamble, CHUNK_PREAMBLE_SIZE) !=",
          "new_line_content": "     * it; if it is the first video chunk, this is a silent file */",
          "content_same": false
        },
        {
          "line": 575,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(EIO)",
          "new_text": null,
          "old_line_content": "        return AVERROR(EIO);",
          "new_line_content": "        CHUNK_PREAMBLE_SIZE)",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 8,
      "total_additions": 14,
      "total_deletions": 14,
      "total_api_changes": 36
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 2,
        "api_related_lines": 36,
        "non_api_lines": 2,
        "non_api_line_numbers": [
          532,
          534
        ]
      }
    },
    "api_calls_before": 114,
    "api_calls_after": 114,
    "diff_info": {
      "added_lines": 2,
      "removed_lines": 1,
      "total_diff_lines": 16
    }
  }
}