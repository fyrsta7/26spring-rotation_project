{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/a82cc54fb5ce3774ac7f4a646e6c3a2388d528bd",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/a82cc54fb5ce3774ac7f4a646e6c3a2388d528bd/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/a82cc54fb5ce3774ac7f4a646e6c3a2388d528bd/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/a82cc54fb5ce3774ac7f4a646e6c3a2388d528bd/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 97,
          "old_api": "ERROR",
          "new_api": "priv_set_pts_info",
          "old_text": "ERROR(ENOMEM);\n",
          "new_text": "priv_set_pts_info(st, 64, pts_info.den, pts_info.num);\n",
          "old_line_content": "        return AVERROR(ENOMEM);",
          "new_line_content": "    avpriv_set_pts_info(st, 64, pts_info.den, pts_info.num);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 131,
          "old_api": null,
          "new_api": "LL_IF_CONFIG_SMALL",
          "old_text": null,
          "new_text": "LL_IF_CONFIG_SMALL(\"MPlayer subtitles\"),\n",
          "old_line_content": "    .name           = \"mpsub\",",
          "new_line_content": "    .long_name      = NULL_IF_CONFIG_SMALL(\"MPlayer subtitles\"),",
          "content_same": false
        },
        {
          "line": 40,
          "old_api": null,
          "new_api": "mcmp",
          "old_text": null,
          "new_text": "mcmp(ptr, \"FORMAT=TIME\", 11))\n",
          "old_line_content": "        int n;",
          "new_line_content": "        if (!memcmp(ptr, \"FORMAT=TIME\", 11))",
          "content_same": false
        },
        {
          "line": 44,
          "old_api": null,
          "new_api": "rcspn",
          "old_text": null,
          "new_text": "rcspn(ptr, \"\\n\") +",
          "old_line_content": "            return AVPROBE_SCORE_EXTENSION;",
          "new_line_content": "        ptr += strcspn(ptr, \"\\n\") + 1;",
          "content_same": false
        },
        {
          "line": 59,
          "old_api": null,
          "new_api": "_bprint_init",
          "old_text": null,
          "new_text": "_bprint_init(&buf, 0, AV_BPRINT_SIZE_UNLIMITED);\n",
          "old_line_content": "",
          "new_line_content": "    av_bprint_init(&buf, 0, AV_BPRINT_SIZE_UNLIMITED);",
          "content_same": false
        },
        {
          "line": 61,
          "old_api": null,
          "new_api": "l_feof",
          "old_text": null,
          "new_text": "l_feof(s->pb)) ",
          "old_line_content": "",
          "new_line_content": "    while (!url_feof(s->pb)) {",
          "content_same": false
        },
        {
          "line": 64,
          "old_api": null,
          "new_api": "_get_line",
          "old_text": null,
          "new_text": "_get_line(s->pb, line, sizeof(line));\n",
          "old_line_content": "        float start, duration;",
          "new_line_content": "        int fps, len = ff_get_line(s->pb, line, sizeof(line));",
          "content_same": false
        },
        {
          "line": 69,
          "old_api": null,
          "new_api": "rcspn",
          "old_text": null,
          "new_text": "rcspn(line, \"\\r\\n\")] ",
          "old_line_content": "",
          "new_line_content": "        line[strcspn(line, \"\\r\\n\")] = 0;",
          "content_same": false
        },
        {
          "line": 71,
          "old_api": null,
          "new_api": "canf",
          "old_text": null,
          "new_text": "canf(line, \"FORMAT=%d\", &fps) =",
          "old_line_content": "",
          "new_line_content": "        if (sscanf(line, \"FORMAT=%d\", &fps) == 1 && fps > 3 && fps < 100) {",
          "content_same": false
        },
        {
          "line": 75,
          "old_api": null,
          "new_api": "canf",
          "old_text": null,
          "new_text": "canf(line, \"%f %f\", &start, &duration) =",
          "old_line_content": "            multiplier = 1.0;",
          "new_line_content": "        } else if (sscanf(line, \"%f %f\", &start, &duration) == 2) {",
          "content_same": false
        },
        {
          "line": 77,
          "old_api": null,
          "new_api": "io_tell",
          "old_text": null,
          "new_text": "io_tell(s->pb);\n",
          "old_line_content": "            AVPacket *sub;",
          "new_line_content": "            const int64_t pos = avio_tell(s->pb);",
          "content_same": false
        },
        {
          "line": 79,
          "old_api": null,
          "new_api": "_subtitles_read_chunk",
          "old_text": null,
          "new_text": "_subtitles_read_chunk(s->pb, &buf);\n",
          "old_line_content": "",
          "new_line_content": "            ff_subtitles_read_chunk(s->pb, &buf);",
          "content_same": false
        },
        {
          "line": 81,
          "old_api": null,
          "new_api": "_subtitles_queue_insert",
          "old_text": null,
          "new_text": "_subtitles_queue_insert(&mpsub->q, buf.str, buf.len, 0);\n",
          "old_line_content": "            if (buf.len) {",
          "new_line_content": "                sub = ff_subtitles_queue_insert(&mpsub->q, buf.str, buf.len, 0);",
          "content_same": false
        },
        {
          "line": 83,
          "old_api": null,
          "new_api": "ERROR",
          "old_text": null,
          "new_text": "ERROR(ENOMEM);\n",
          "old_line_content": "                if (!sub) {",
          "new_line_content": "                    res = AVERROR(ENOMEM);",
          "content_same": false
        },
        {
          "line": 94,
          "old_api": null,
          "new_api": "format_new_stream",
          "old_text": null,
          "new_text": "format_new_stream(s, NULL);\n",
          "old_line_content": "",
          "new_line_content": "    st = avformat_new_stream(s, NULL);",
          "content_same": false
        },
        {
          "line": 96,
          "old_api": null,
          "new_api": "ERROR",
          "old_text": null,
          "new_text": "ERROR(ENOMEM);\n",
          "old_line_content": "    if (!st)",
          "new_line_content": "        return AVERROR(ENOMEM);",
          "content_same": false
        },
        {
          "line": 101,
          "old_api": null,
          "new_api": "_subtitles_queue_finalize",
          "old_text": null,
          "new_text": "_subtitles_queue_finalize(&mpsub->q);\n",
          "old_line_content": "",
          "new_line_content": "    ff_subtitles_queue_finalize(&mpsub->q);",
          "content_same": false
        },
        {
          "line": 104,
          "old_api": null,
          "new_api": "_bprint_finalize",
          "old_text": null,
          "new_text": "_bprint_finalize(&buf, NULL);\n",
          "old_line_content": "end:",
          "new_line_content": "    av_bprint_finalize(&buf, NULL);",
          "content_same": false
        },
        {
          "line": 111,
          "old_api": null,
          "new_api": "_subtitles_queue_read_packet",
          "old_text": null,
          "new_text": "_subtitles_queue_read_packet(&mpsub->q, pkt);\n",
          "old_line_content": "    MPSubContext *mpsub = s->priv_data;",
          "new_line_content": "    return ff_subtitles_queue_read_packet(&mpsub->q, pkt);",
          "content_same": false
        },
        {
          "line": 118,
          "old_api": null,
          "new_api": "_subtitles_queue_seek",
          "old_text": null,
          "new_text": "_subtitles_queue_seek(&mpsub->q, s, stream_index,\n                                   min_ts, ts, max_ts, flags);\n",
          "old_line_content": "    MPSubContext *mpsub = s->priv_data;",
          "new_line_content": "    return ff_subtitles_queue_seek(&mpsub->q, s, stream_index,",
          "content_same": false
        },
        {
          "line": 125,
          "old_api": null,
          "new_api": "_subtitles_queue_clean",
          "old_text": null,
          "new_text": "_subtitles_queue_clean(&mpsub->q);\n",
          "old_line_content": "    MPSubContext *mpsub = s->priv_data;",
          "new_line_content": "    ff_subtitles_queue_clean(&mpsub->q);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 132,
          "old_api": "LL_IF_CONFIG_SMALL",
          "new_api": null,
          "old_text": "LL_IF_CONFIG_SMALL(\"MPlayer subtitles\"),\n",
          "new_text": null,
          "old_line_content": "    .long_name      = NULL_IF_CONFIG_SMALL(\"MPlayer subtitles\"),",
          "new_line_content": "    .priv_data_size = sizeof(MPSubContext),",
          "content_same": false
        },
        {
          "line": 43,
          "old_api": "canf",
          "new_api": null,
          "old_text": "canf(ptr, \"FORMAT=%d\", &n) =",
          "new_text": null,
          "old_line_content": "            sscanf(ptr, \"FORMAT=%d\", &n) == 1)",
          "new_line_content": "            return AVPROBE_SCORE_EXTENSION / 3;",
          "content_same": false
        },
        {
          "line": 45,
          "old_api": "rcspn",
          "new_api": null,
          "old_text": "rcspn(ptr, \"\\n\") +",
          "new_text": null,
          "old_line_content": "        ptr += strcspn(ptr, \"\\n\") + 1;",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 60,
          "old_api": "_bprint_init",
          "new_api": null,
          "old_text": "_bprint_init(&buf, 0, AV_BPRINT_SIZE_UNLIMITED);\n",
          "new_text": null,
          "old_line_content": "    av_bprint_init(&buf, 0, AV_BPRINT_SIZE_UNLIMITED);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 62,
          "old_api": "l_feof",
          "new_api": null,
          "old_text": "l_feof(s->pb)) ",
          "new_text": null,
          "old_line_content": "    while (!url_feof(s->pb)) {",
          "new_line_content": "        char line[1024];",
          "content_same": false
        },
        {
          "line": 65,
          "old_api": "_get_line",
          "new_api": null,
          "old_text": "_get_line(s->pb, line, sizeof(line));\n",
          "new_text": null,
          "old_line_content": "        int fps, len = ff_get_line(s->pb, line, sizeof(line));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 70,
          "old_api": "rcspn",
          "new_api": null,
          "old_text": "rcspn(line, \"\\r\\n\")] ",
          "new_text": null,
          "old_line_content": "        line[strcspn(line, \"\\r\\n\")] = 0;",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 72,
          "old_api": "canf",
          "new_api": null,
          "old_text": "canf(line, \"FORMAT=%d\", &fps) =",
          "new_text": null,
          "old_line_content": "        if (sscanf(line, \"FORMAT=%d\", &fps) == 1 && fps > 3 && fps < 100) {",
          "new_line_content": "            /* frame based timing */",
          "content_same": false
        },
        {
          "line": 76,
          "old_api": "canf",
          "new_api": null,
          "old_text": "canf(line, \"%f %f\", &start, &duration) =",
          "new_text": null,
          "old_line_content": "        } else if (sscanf(line, \"%f %f\", &start, &duration) == 2) {",
          "new_line_content": "            AVPacket *sub;",
          "content_same": false
        },
        {
          "line": 78,
          "old_api": "io_tell",
          "new_api": null,
          "old_text": "io_tell(s->pb);\n",
          "new_text": null,
          "old_line_content": "            const int64_t pos = avio_tell(s->pb);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 80,
          "old_api": "_subtitles_read_chunk",
          "new_api": null,
          "old_text": "_subtitles_read_chunk(s->pb, &buf);\n",
          "new_text": null,
          "old_line_content": "            ff_subtitles_read_chunk(s->pb, &buf);",
          "new_line_content": "            if (buf.len) {",
          "content_same": false
        },
        {
          "line": 82,
          "old_api": "_subtitles_queue_insert",
          "new_api": null,
          "old_text": "_subtitles_queue_insert(&mpsub->q, buf.str, buf.len, 0);\n",
          "new_text": null,
          "old_line_content": "                sub = ff_subtitles_queue_insert(&mpsub->q, buf.str, buf.len, 0);",
          "new_line_content": "                if (!sub) {",
          "content_same": false
        },
        {
          "line": 84,
          "old_api": "ERROR",
          "new_api": null,
          "old_text": "ERROR(ENOMEM);\n",
          "new_text": null,
          "old_line_content": "                    res = AVERROR(ENOMEM);",
          "new_line_content": "                    goto end;",
          "content_same": false
        },
        {
          "line": 95,
          "old_api": "format_new_stream",
          "new_api": null,
          "old_text": "format_new_stream(s, NULL);\n",
          "new_text": null,
          "old_line_content": "    st = avformat_new_stream(s, NULL);",
          "new_line_content": "    if (!st)",
          "content_same": false
        },
        {
          "line": 98,
          "old_api": "priv_set_pts_info",
          "new_api": null,
          "old_text": "priv_set_pts_info(st, 64, pts_info.den, pts_info.num);\n",
          "new_text": null,
          "old_line_content": "    avpriv_set_pts_info(st, 64, pts_info.den, pts_info.num);",
          "new_line_content": "    st->codec->codec_type = AVMEDIA_TYPE_SUBTITLE;",
          "content_same": false
        },
        {
          "line": 102,
          "old_api": "_subtitles_queue_finalize",
          "new_api": null,
          "old_text": "_subtitles_queue_finalize(&mpsub->q);\n",
          "new_text": null,
          "old_line_content": "    ff_subtitles_queue_finalize(&mpsub->q);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 105,
          "old_api": "_bprint_finalize",
          "new_api": null,
          "old_text": "_bprint_finalize(&buf, NULL);\n",
          "new_text": null,
          "old_line_content": "    av_bprint_finalize(&buf, NULL);",
          "new_line_content": "    return res;",
          "content_same": false
        },
        {
          "line": 112,
          "old_api": "_subtitles_queue_read_packet",
          "new_api": null,
          "old_text": "_subtitles_queue_read_packet(&mpsub->q, pkt);\n",
          "new_text": null,
          "old_line_content": "    return ff_subtitles_queue_read_packet(&mpsub->q, pkt);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 119,
          "old_api": "_subtitles_queue_seek",
          "new_api": null,
          "old_text": "_subtitles_queue_seek(&mpsub->q, s, stream_index,\n                                   min_ts, ts, max_ts, flags);\n",
          "new_text": null,
          "old_line_content": "    return ff_subtitles_queue_seek(&mpsub->q, s, stream_index,",
          "new_line_content": "                                   min_ts, ts, max_ts, flags);",
          "content_same": false
        },
        {
          "line": 126,
          "old_api": "_subtitles_queue_clean",
          "new_api": null,
          "old_text": "_subtitles_queue_clean(&mpsub->q);\n",
          "new_text": null,
          "old_line_content": "    ff_subtitles_queue_clean(&mpsub->q);",
          "new_line_content": "    return 0;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 1,
      "total_additions": 20,
      "total_deletions": 20,
      "total_api_changes": 41
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 4,
        "api_related_lines": 41,
        "non_api_lines": 2,
        "non_api_line_numbers": [
          41,
          42
        ]
      }
    },
    "api_calls_before": 22,
    "api_calls_after": 22,
    "diff_info": {
      "added_lines": 3,
      "removed_lines": 4,
      "total_diff_lines": 20
    }
  }
}