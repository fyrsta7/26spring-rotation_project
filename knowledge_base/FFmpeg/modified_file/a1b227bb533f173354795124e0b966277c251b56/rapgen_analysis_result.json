{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/a1b227bb533f173354795124e0b966277c251b56",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/a1b227bb533f173354795124e0b966277c251b56/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/a1b227bb533f173354795124e0b966277c251b56/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/a1b227bb533f173354795124e0b966277c251b56/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 1559,
          "old_api": "vp8_v_loop_filter8uv_inner",
          "new_api": "vp8_v_loop_filter16y_inner",
          "old_text": "s->vp8dsp.vp8_v_loop_filter8uv_inner(dst[1] + 4 * uvlinesize,\n                                             dst[2] + 4 * uvlinesize,\n                                             uvlinesize,  bedge_lim,\n                                             inner_limit, hev_thresh)",
          "new_text": "s->vp8dsp.vp8_v_loop_filter16y_inner(dst[0]+12*linesize,\n                                             linesize,    bedge_lim,\n                                             inner_limit, hev_thresh)",
          "old_line_content": "        s->vp8dsp.vp8_v_loop_filter8uv_inner(dst[1] + 4 * uvlinesize,",
          "new_line_content": "        s->vp8dsp.vp8_v_loop_filter16y_inner(dst[0]+12*linesize,",
          "content_same": false
        },
        {
          "line": 1728,
          "old_api": "decode_mb_mode",
          "new_api": "prefetch",
          "old_text": "decode_mb_mode(s, mb, mb_x, mb_y, s->segmentation_map + mb_xy)",
          "new_text": "s->dsp.prefetch(dst[0] + (mb_x&3)*4*s->linesize + 64, s->linesize, 4)",
          "old_line_content": "            decode_mb_mode(s, mb, mb_x, mb_y, s->segmentation_map + mb_xy);",
          "new_line_content": "            s->dsp.prefetch(dst[0] + (mb_x&3)*4*s->linesize + 64, s->linesize, 4);",
          "content_same": false
        },
        {
          "line": 1733,
          "old_api": "decode_mb_coeffs",
          "new_api": "prefetch_motion",
          "old_text": "decode_mb_coeffs(s, c, mb, s->top_nnz[mb_x], s->left_nnz)",
          "new_text": "prefetch_motion(s, mb, mb_x, mb_y, mb_xy, VP56_FRAME_PREVIOUS)",
          "old_line_content": "                decode_mb_coeffs(s, c, mb, s->top_nnz[mb_x], s->left_nnz);",
          "new_line_content": "            prefetch_motion(s, mb, mb_x, mb_y, mb_xy, VP56_FRAME_PREVIOUS);",
          "content_same": false
        },
        {
          "line": 1736,
          "old_api": "intra_predict",
          "new_api": "decode_mb_coeffs",
          "old_text": "intra_predict(s, dst, mb, mb_x, mb_y)",
          "new_text": "decode_mb_coeffs(s, c, mb, s->top_nnz[mb_x], s->left_nnz)",
          "old_line_content": "                intra_predict(s, dst, mb, mb_x, mb_y);",
          "new_line_content": "                decode_mb_coeffs(s, c, mb, s->top_nnz[mb_x], s->left_nnz);",
          "content_same": false
        },
        {
          "line": 1743,
          "old_api": "idct_mb",
          "new_api": "prefetch_motion",
          "old_text": "idct_mb(s, dst, mb)",
          "new_text": "prefetch_motion(s, mb, mb_x, mb_y, mb_xy, VP56_FRAME_GOLDEN)",
          "old_line_content": "                idct_mb(s, dst, mb);",
          "new_line_content": "            prefetch_motion(s, mb, mb_x, mb_y, mb_xy, VP56_FRAME_GOLDEN);",
          "content_same": false
        },
        {
          "line": 1746,
          "old_api": "AV_WN64",
          "new_api": "idct_mb",
          "old_text": "AV_WN64(s->top_nnz[mb_x], 0)",
          "new_text": "idct_mb(s, dst, mb)",
          "old_line_content": "                AV_WN64(s->top_nnz[mb_x], 0);   // array of 9, so unaligned",
          "new_line_content": "                idct_mb(s, dst, mb);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 1536,
          "old_api": null,
          "new_api": "vp8_h_loop_filter16y_inner",
          "old_text": null,
          "new_text": "s->vp8dsp.vp8_h_loop_filter16y_inner(dst[0]+ 8, linesize, bedge_lim,\n                                             inner_limit, hev_thresh)",
          "old_line_content": "                                             inner_limit, hev_thresh);",
          "new_line_content": "        s->vp8dsp.vp8_h_loop_filter16y_inner(dst[0]+ 8, linesize, bedge_lim,",
          "content_same": false
        },
        {
          "line": 1538,
          "old_api": null,
          "new_api": "vp8_h_loop_filter16y_inner",
          "old_text": null,
          "new_text": "s->vp8dsp.vp8_h_loop_filter16y_inner(dst[0]+12, linesize, bedge_lim,\n                                             inner_limit, hev_thresh)",
          "old_line_content": "                                             uvlinesize,  bedge_lim,",
          "new_line_content": "        s->vp8dsp.vp8_h_loop_filter16y_inner(dst[0]+12, linesize, bedge_lim,",
          "content_same": false
        },
        {
          "line": 1540,
          "old_api": null,
          "new_api": "vp8_h_loop_filter8uv_inner",
          "old_text": null,
          "new_text": "s->vp8dsp.vp8_h_loop_filter8uv_inner(dst[1] + 4, dst[2] + 4,\n                                             uvlinesize,  bedge_lim,\n                                             inner_limit, hev_thresh)",
          "old_line_content": "    }",
          "new_line_content": "        s->vp8dsp.vp8_h_loop_filter8uv_inner(dst[1] + 4, dst[2] + 4,",
          "content_same": false
        },
        {
          "line": 1668,
          "old_api": null,
          "new_api": "get_buffer",
          "old_text": null,
          "new_text": "avctx->get_buffer(avctx, curframe)",
          "old_line_content": "    }",
          "new_line_content": "    if ((ret = avctx->get_buffer(avctx, curframe))) {",
          "content_same": false
        },
        {
          "line": 1669,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(avctx, AV_LOG_ERROR, \"get_buffer() failed!\\n\")",
          "old_line_content": "",
          "new_line_content": "        av_log(avctx, AV_LOG_ERROR, \"get_buffer() failed!\\n\");",
          "content_same": false
        },
        {
          "line": 1546,
          "old_api": null,
          "new_api": "vp8_v_loop_filter16y",
          "old_text": null,
          "new_text": "s->vp8dsp.vp8_v_loop_filter16y(dst[0],     linesize,\n                                       mbedge_lim, inner_limit, hev_thresh)",
          "old_line_content": "                                       mbedge_lim, inner_limit, hev_thresh);",
          "new_line_content": "        s->vp8dsp.vp8_v_loop_filter16y(dst[0],     linesize,",
          "content_same": false
        },
        {
          "line": 1803,
          "old_api": null,
          "new_api": "release_buffer",
          "old_text": null,
          "new_text": "avctx->release_buffer(avctx, &s->frames[i])",
          "old_line_content": "        *(AVFrame*)data = *s->framep[VP56_FRAME_CURRENT];",
          "new_line_content": "            avctx->release_buffer(avctx, &s->frames[i]);",
          "content_same": false
        },
        {
          "line": 1548,
          "old_api": null,
          "new_api": "vp8_v_loop_filter8uv",
          "old_text": null,
          "new_text": "s->vp8dsp.vp8_v_loop_filter8uv(dst[1],     dst[2],      uvlinesize,\n                                       mbedge_lim, inner_limit, hev_thresh)",
          "old_line_content": "",
          "new_line_content": "        s->vp8dsp.vp8_v_loop_filter8uv(dst[1],     dst[2],      uvlinesize,",
          "content_same": false
        },
        {
          "line": 1679,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(avctx, AV_LOG_WARNING, \"Discarding interframe without a prior keyframe!\\n\")",
          "old_line_content": "",
          "new_line_content": "        av_log(avctx, AV_LOG_WARNING, \"Discarding interframe without a prior keyframe!\\n\");",
          "content_same": false
        },
        {
          "line": 1687,
          "old_api": null,
          "new_api": "av_malloc",
          "old_text": null,
          "new_text": "av_malloc(21*s->linesize)",
          "old_line_content": "",
          "new_line_content": "        s->edge_emu_buffer = av_malloc(21*s->linesize);",
          "content_same": false
        },
        {
          "line": 1562,
          "old_api": null,
          "new_api": "vp8_v_loop_filter8uv_inner",
          "old_text": null,
          "new_text": "s->vp8dsp.vp8_v_loop_filter8uv_inner(dst[1] + 4 * uvlinesize,\n                                             dst[2] + 4 * uvlinesize,\n                                             uvlinesize,  bedge_lim,\n                                             inner_limit, hev_thresh)",
          "old_line_content": "                                             inner_limit, hev_thresh);",
          "new_line_content": "        s->vp8dsp.vp8_v_loop_filter8uv_inner(dst[1] + 4 * uvlinesize,",
          "content_same": false
        },
        {
          "line": 1692,
          "old_api": null,
          "new_api": "memset",
          "old_text": null,
          "new_text": "memset(s->macroblocks + s->mb_height*2 - 1, 0, (s->mb_width+1)*sizeof(*s->macroblocks))",
          "old_line_content": "    if (!(avctx->flags & CODEC_FLAG_EMU_EDGE)) {",
          "new_line_content": "    memset(s->macroblocks + s->mb_height*2 - 1, 0, (s->mb_width+1)*sizeof(*s->macroblocks));",
          "content_same": false
        },
        {
          "line": 1820,
          "old_api": null,
          "new_api": "dsputil_init",
          "old_text": null,
          "new_text": "dsputil_init(&s->dsp, avctx)",
          "old_line_content": "",
          "new_line_content": "    dsputil_init(&s->dsp, avctx);",
          "content_same": false
        },
        {
          "line": 1821,
          "old_api": null,
          "new_api": "ff_h264_pred_init",
          "old_text": null,
          "new_text": "ff_h264_pred_init(&s->hpc, CODEC_ID_VP8)",
          "old_line_content": "    return 0;",
          "new_line_content": "    ff_h264_pred_init(&s->hpc, CODEC_ID_VP8);",
          "content_same": false
        },
        {
          "line": 1822,
          "old_api": null,
          "new_api": "ff_vp8dsp_init",
          "old_text": null,
          "new_text": "ff_vp8dsp_init(&s->vp8dsp)",
          "old_line_content": "}",
          "new_line_content": "    ff_vp8dsp_init(&s->vp8dsp);",
          "content_same": false
        },
        {
          "line": 1697,
          "old_api": null,
          "new_api": "memset",
          "old_text": null,
          "new_text": "memset(s->top_border[1]-1, 127, s->mb_width*sizeof(*s->top_border)+1)",
          "old_line_content": "    if (s->keyframe)",
          "new_line_content": "        memset(s->top_border[1]-1, 127, s->mb_width*sizeof(*s->top_border)+1);",
          "content_same": false
        },
        {
          "line": 1699,
          "old_api": null,
          "new_api": "memset",
          "old_text": null,
          "new_text": "memset(s->ref_count, 0, sizeof(s->ref_count))",
          "old_line_content": "",
          "new_line_content": "    memset(s->ref_count, 0, sizeof(s->ref_count));",
          "content_same": false
        },
        {
          "line": 1701,
          "old_api": null,
          "new_api": "memset",
          "old_text": null,
          "new_text": "memset(s->intra4x4_pred_mode_top, DC_PRED, s->mb_width*4)",
          "old_line_content": "        VP56RangeCoder *c = &s->coeff_partition[mb_y & (s->num_coeff_partitions-1)];",
          "new_line_content": "        memset(s->intra4x4_pred_mode_top, DC_PRED, s->mb_width*4);",
          "content_same": false
        },
        {
          "line": 1829,
          "old_api": null,
          "new_api": "vp8_decode_flush",
          "old_text": null,
          "new_text": "vp8_decode_flush(avctx)",
          "old_line_content": "",
          "new_line_content": "    vp8_decode_flush(avctx);",
          "content_same": false
        },
        {
          "line": 1713,
          "old_api": null,
          "new_api": "memset",
          "old_text": null,
          "new_text": "memset(mb - 1, 0, sizeof(*mb))",
          "old_line_content": "",
          "new_line_content": "        memset(mb - 1, 0, sizeof(*mb));   // zero left macroblock",
          "content_same": false
        },
        {
          "line": 1586,
          "old_api": null,
          "new_api": "vp8_h_loop_filter_simple",
          "old_text": null,
          "new_text": "s->vp8dsp.vp8_h_loop_filter_simple(dst+ 4, linesize, bedge_lim)",
          "old_line_content": "    }",
          "new_line_content": "        s->vp8dsp.vp8_h_loop_filter_simple(dst+ 4, linesize, bedge_lim);",
          "content_same": false
        },
        {
          "line": 1587,
          "old_api": null,
          "new_api": "vp8_h_loop_filter_simple",
          "old_text": null,
          "new_text": "s->vp8dsp.vp8_h_loop_filter_simple(dst+ 8, linesize, bedge_lim)",
          "old_line_content": "",
          "new_line_content": "        s->vp8dsp.vp8_h_loop_filter_simple(dst+ 8, linesize, bedge_lim);",
          "content_same": false
        },
        {
          "line": 1588,
          "old_api": null,
          "new_api": "vp8_h_loop_filter_simple",
          "old_text": null,
          "new_text": "s->vp8dsp.vp8_h_loop_filter_simple(dst+12, linesize, bedge_lim)",
          "old_line_content": "    if (mb_y)",
          "new_line_content": "        s->vp8dsp.vp8_h_loop_filter_simple(dst+12, linesize, bedge_lim);",
          "content_same": false
        },
        {
          "line": 1714,
          "old_api": null,
          "new_api": "memset",
          "old_text": null,
          "new_text": "memset(s->left_nnz, 0, sizeof(s->left_nnz))",
          "old_line_content": "        // left edge of 129 for intra prediction",
          "new_line_content": "        memset(s->left_nnz, 0, sizeof(s->left_nnz));",
          "content_same": false
        },
        {
          "line": 1715,
          "old_api": null,
          "new_api": "AV_WN32A",
          "old_text": null,
          "new_text": "AV_WN32A(s->intra4x4_pred_mode_left, DC_PRED*0x01010101)",
          "old_line_content": "        if (!(avctx->flags & CODEC_FLAG_EMU_EDGE)) {",
          "new_line_content": "        AV_WN32A(s->intra4x4_pred_mode_left, DC_PRED*0x01010101);",
          "content_same": false
        },
        {
          "line": 1844,
          "old_api": null,
          "new_api": "NULL_IF_CONFIG_SMALL",
          "old_text": null,
          "new_text": "NULL_IF_CONFIG_SMALL(\"On2 VP8\")",
          "old_line_content": "",
          "new_line_content": "    .long_name = NULL_IF_CONFIG_SMALL(\"On2 VP8\"),",
          "content_same": false
        },
        {
          "line": 1594,
          "old_api": null,
          "new_api": "vp8_v_loop_filter_simple",
          "old_text": null,
          "new_text": "s->vp8dsp.vp8_v_loop_filter_simple(dst+ 4*linesize, linesize, bedge_lim)",
          "old_line_content": "    }",
          "new_line_content": "        s->vp8dsp.vp8_v_loop_filter_simple(dst+ 4*linesize, linesize, bedge_lim);",
          "content_same": false
        },
        {
          "line": 1595,
          "old_api": null,
          "new_api": "vp8_v_loop_filter_simple",
          "old_text": null,
          "new_text": "s->vp8dsp.vp8_v_loop_filter_simple(dst+ 8*linesize, linesize, bedge_lim)",
          "old_line_content": "}",
          "new_line_content": "        s->vp8dsp.vp8_v_loop_filter_simple(dst+ 8*linesize, linesize, bedge_lim);",
          "content_same": false
        },
        {
          "line": 1596,
          "old_api": null,
          "new_api": "vp8_v_loop_filter_simple",
          "old_text": null,
          "new_text": "s->vp8dsp.vp8_v_loop_filter_simple(dst+12*linesize, linesize, bedge_lim)",
          "old_line_content": "",
          "new_line_content": "        s->vp8dsp.vp8_v_loop_filter_simple(dst+12*linesize, linesize, bedge_lim);",
          "content_same": false
        },
        {
          "line": 1729,
          "old_api": null,
          "new_api": "prefetch",
          "old_text": null,
          "new_text": "s->dsp.prefetch(dst[1] + (mb_x&7)*s->uvlinesize + 64, dst[2] - dst[1], 2)",
          "old_line_content": "",
          "new_line_content": "            s->dsp.prefetch(dst[1] + (mb_x&7)*s->uvlinesize + 64, dst[2] - dst[1], 2);",
          "content_same": false
        },
        {
          "line": 1731,
          "old_api": null,
          "new_api": "decode_mb_mode",
          "old_text": null,
          "new_text": "decode_mb_mode(s, mb, mb_x, mb_y, s->segmentation_map + mb_xy)",
          "old_line_content": "",
          "new_line_content": "            decode_mb_mode(s, mb, mb_x, mb_y, s->segmentation_map + mb_xy);",
          "content_same": false
        },
        {
          "line": 1611,
          "old_api": null,
          "new_api": "backup_mb_border",
          "old_text": null,
          "new_text": "backup_mb_border(s->top_border[mb_x+1], dst[0], dst[1], dst[2], s->linesize, s->uvlinesize, 0)",
          "old_line_content": "        dst[1] += 8;",
          "new_line_content": "        backup_mb_border(s->top_border[mb_x+1], dst[0], dst[1], dst[2], s->linesize, s->uvlinesize, 0);",
          "content_same": false
        },
        {
          "line": 1612,
          "old_api": null,
          "new_api": "filter_mb",
          "old_text": null,
          "new_text": "filter_mb(s, dst, f++, mb_x, mb_y)",
          "old_line_content": "        dst[2] += 8;",
          "new_line_content": "        filter_mb(s, dst, f++, mb_x, mb_y);",
          "content_same": false
        },
        {
          "line": 1739,
          "old_api": null,
          "new_api": "intra_predict",
          "old_text": null,
          "new_text": "intra_predict(s, dst, mb, mb_x, mb_y)",
          "old_line_content": "",
          "new_line_content": "                intra_predict(s, dst, mb, mb_x, mb_y);",
          "content_same": false
        },
        {
          "line": 1486,
          "old_api": null,
          "new_api": "POW2CLIP",
          "old_text": null,
          "new_text": "POW2CLIP(filter_level, 63)",
          "old_line_content": "    if (s->filter.sharpness) {",
          "new_line_content": "    filter_level = POW2CLIP(filter_level, 63);",
          "content_same": false
        },
        {
          "line": 1741,
          "old_api": null,
          "new_api": "inter_predict",
          "old_text": null,
          "new_text": "inter_predict(s, dst, mb, mb_x, mb_y)",
          "old_line_content": "",
          "new_line_content": "                inter_predict(s, dst, mb, mb_x, mb_y);",
          "content_same": false
        },
        {
          "line": 1491,
          "old_api": null,
          "new_api": "FFMIN",
          "old_text": null,
          "new_text": "FFMIN(interior_limit, 9 - s->filter.sharpness)",
          "old_line_content": "",
          "new_line_content": "        interior_limit = FFMIN(interior_limit, 9 - s->filter.sharpness);",
          "content_same": false
        },
        {
          "line": 1748,
          "old_api": null,
          "new_api": "AV_ZERO64",
          "old_text": null,
          "new_text": "AV_ZERO64(s->left_nnz)",
          "old_line_content": "                // Reset DC block predictors if they would exist if the mb had coefficients",
          "new_line_content": "                AV_ZERO64(s->left_nnz);",
          "content_same": false
        },
        {
          "line": 1493,
          "old_api": null,
          "new_api": "FFMAX",
          "old_text": null,
          "new_text": "FFMAX(interior_limit, 1)",
          "old_line_content": "    f->inner_limit = interior_limit;",
          "new_line_content": "    interior_limit = FFMAX(interior_limit, 1);",
          "content_same": false
        },
        {
          "line": 1749,
          "old_api": null,
          "new_api": "AV_WN64",
          "old_text": null,
          "new_text": "AV_WN64(s->top_nnz[mb_x], 0)",
          "old_line_content": "                if (mb->mode != MODE_I4x4 && mb->mode != VP8_MVMODE_SPLIT) {",
          "new_line_content": "                AV_WN64(s->top_nnz[mb_x], 0);   // array of 9, so unaligned",
          "content_same": false
        },
        {
          "line": 1626,
          "old_api": null,
          "new_api": "backup_mb_border",
          "old_text": null,
          "new_text": "backup_mb_border(s->top_border[mb_x+1], dst, NULL, NULL, s->linesize, 0, 1)",
          "old_line_content": "    }",
          "new_line_content": "        backup_mb_border(s->top_border[mb_x+1], dst, NULL, NULL, s->linesize, 0, 1);",
          "content_same": false
        },
        {
          "line": 1627,
          "old_api": null,
          "new_api": "filter_mb_simple",
          "old_text": null,
          "new_text": "filter_mb_simple(s, dst, f++, mb_x, mb_y)",
          "old_line_content": "}",
          "new_line_content": "        filter_mb_simple(s, dst, f++, mb_x, mb_y);",
          "content_same": false
        },
        {
          "line": 1759,
          "old_api": null,
          "new_api": "filter_level_for_mb",
          "old_text": null,
          "new_text": "filter_level_for_mb(s, mb, &s->filter_strength[mb_x])",
          "old_line_content": "",
          "new_line_content": "                filter_level_for_mb(s, mb, &s->filter_strength[mb_x]);",
          "content_same": false
        },
        {
          "line": 1761,
          "old_api": null,
          "new_api": "prefetch_motion",
          "old_text": null,
          "new_text": "prefetch_motion(s, mb, mb_x, mb_y, mb_xy, VP56_FRAME_GOLDEN2)",
          "old_line_content": "            dst[1] += 8;",
          "new_line_content": "            prefetch_motion(s, mb, mb_x, mb_y, mb_xy, VP56_FRAME_GOLDEN2);",
          "content_same": false
        },
        {
          "line": 1640,
          "old_api": null,
          "new_api": "decode_frame_header",
          "old_text": null,
          "new_text": "decode_frame_header(s, avpkt->data, avpkt->size)",
          "old_line_content": "    referenced = s->update_last || s->update_golden == VP56_FRAME_CURRENT",
          "new_line_content": "    if ((ret = decode_frame_header(s, avpkt->data, avpkt->size)) < 0)",
          "content_same": false
        },
        {
          "line": 1769,
          "old_api": null,
          "new_api": "filter_mb_row_simple",
          "old_text": null,
          "new_text": "filter_mb_row_simple(s, mb_y)",
          "old_line_content": "        }",
          "new_line_content": "                filter_mb_row_simple(s, mb_y);",
          "content_same": false
        },
        {
          "line": 1771,
          "old_api": null,
          "new_api": "filter_mb_row",
          "old_text": null,
          "new_text": "filter_mb_row(s, mb_y)",
          "old_line_content": "",
          "new_line_content": "                filter_mb_row(s, mb_y);",
          "content_same": false
        },
        {
          "line": 1527,
          "old_api": null,
          "new_api": "vp8_h_loop_filter16y",
          "old_text": null,
          "new_text": "s->vp8dsp.vp8_h_loop_filter16y(dst[0],     linesize,\n                                       mbedge_lim, inner_limit, hev_thresh)",
          "old_line_content": "                                       mbedge_lim, inner_limit, hev_thresh);",
          "new_line_content": "        s->vp8dsp.vp8_h_loop_filter16y(dst[0],     linesize,",
          "content_same": false
        },
        {
          "line": 1784,
          "old_api": null,
          "new_api": "FFSWAP",
          "old_text": null,
          "new_text": "FFSWAP(AVFrame *, s->framep[VP56_FRAME_GOLDEN], s->framep[VP56_FRAME_GOLDEN2])",
          "old_line_content": "            s->framep[VP56_FRAME_GOLDEN2] = s->framep[s->update_altref];",
          "new_line_content": "        FFSWAP(AVFrame *, s->framep[VP56_FRAME_GOLDEN], s->framep[VP56_FRAME_GOLDEN2]);",
          "content_same": false
        },
        {
          "line": 1529,
          "old_api": null,
          "new_api": "vp8_h_loop_filter8uv",
          "old_text": null,
          "new_text": "s->vp8dsp.vp8_h_loop_filter8uv(dst[1],     dst[2],      uvlinesize,\n                                       mbedge_lim, inner_limit, hev_thresh)",
          "old_line_content": "",
          "new_line_content": "        s->vp8dsp.vp8_h_loop_filter8uv(dst[1],     dst[2],      uvlinesize,",
          "content_same": false
        },
        {
          "line": 1534,
          "old_api": null,
          "new_api": "vp8_h_loop_filter16y_inner",
          "old_text": null,
          "new_text": "s->vp8dsp.vp8_h_loop_filter16y_inner(dst[0]+ 4, linesize, bedge_lim,\n                                             inner_limit, hev_thresh)",
          "old_line_content": "                                             inner_limit, hev_thresh);",
          "new_line_content": "        s->vp8dsp.vp8_h_loop_filter16y_inner(dst[0]+ 4, linesize, bedge_lim,",
          "content_same": false
        },
        {
          "line": 1663,
          "old_api": null,
          "new_api": "release_buffer",
          "old_text": null,
          "new_text": "avctx->release_buffer(avctx, curframe)",
          "old_line_content": "    curframe->pict_type = s->keyframe ? FF_I_TYPE : FF_P_TYPE;",
          "new_line_content": "        avctx->release_buffer(avctx, curframe);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 1537,
          "old_api": "vp8_h_loop_filter8uv_inner",
          "new_api": null,
          "old_text": "s->vp8dsp.vp8_h_loop_filter8uv_inner(dst[1] + 4, dst[2] + 4,\n                                             uvlinesize,  bedge_lim,\n                                             inner_limit, hev_thresh)",
          "new_text": null,
          "old_line_content": "        s->vp8dsp.vp8_h_loop_filter8uv_inner(dst[1] + 4, dst[2] + 4,",
          "new_line_content": "                                             inner_limit, hev_thresh);",
          "content_same": false
        },
        {
          "line": 1665,
          "old_api": "get_buffer",
          "new_api": null,
          "old_text": "avctx->get_buffer(avctx, curframe)",
          "new_text": null,
          "old_line_content": "    if ((ret = avctx->get_buffer(avctx, curframe))) {",
          "new_line_content": "    curframe->key_frame = s->keyframe;",
          "content_same": false
        },
        {
          "line": 1666,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(avctx, AV_LOG_ERROR, \"get_buffer() failed!\\n\")",
          "new_text": null,
          "old_line_content": "        av_log(avctx, AV_LOG_ERROR, \"get_buffer() failed!\\n\");",
          "new_line_content": "    curframe->pict_type = s->keyframe ? FF_I_TYPE : FF_P_TYPE;",
          "content_same": false
        },
        {
          "line": 1543,
          "old_api": "vp8_v_loop_filter16y",
          "new_api": null,
          "old_text": "s->vp8dsp.vp8_v_loop_filter16y(dst[0],     linesize,\n                                       mbedge_lim, inner_limit, hev_thresh)",
          "new_text": null,
          "old_line_content": "        s->vp8dsp.vp8_v_loop_filter16y(dst[0],     linesize,",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1800,
          "old_api": "release_buffer",
          "new_api": null,
          "old_text": "avctx->release_buffer(avctx, &s->frames[i])",
          "new_text": null,
          "old_line_content": "            avctx->release_buffer(avctx, &s->frames[i]);",
          "new_line_content": "            &s->frames[i] != s->framep[VP56_FRAME_PREVIOUS] &&",
          "content_same": false
        },
        {
          "line": 1545,
          "old_api": "vp8_v_loop_filter8uv",
          "new_api": null,
          "old_text": "s->vp8dsp.vp8_v_loop_filter8uv(dst[1],     dst[2],      uvlinesize,\n                                       mbedge_lim, inner_limit, hev_thresh)",
          "new_text": null,
          "old_line_content": "        s->vp8dsp.vp8_v_loop_filter8uv(dst[1],     dst[2],      uvlinesize,",
          "new_line_content": "    if (mb_y) {",
          "content_same": false
        },
        {
          "line": 1676,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(avctx, AV_LOG_WARNING, \"Discarding interframe without a prior keyframe!\\n\")",
          "new_text": null,
          "old_line_content": "        av_log(avctx, AV_LOG_WARNING, \"Discarding interframe without a prior keyframe!\\n\");",
          "new_line_content": "    if (!s->keyframe && (!s->framep[VP56_FRAME_PREVIOUS] ||",
          "content_same": false
        },
        {
          "line": 1550,
          "old_api": "vp8_v_loop_filter16y_inner",
          "new_api": null,
          "old_text": "s->vp8dsp.vp8_v_loop_filter16y_inner(dst[0]+ 4*linesize,\n                                             linesize,    bedge_lim,\n                                             inner_limit, hev_thresh)",
          "new_text": null,
          "old_line_content": "        s->vp8dsp.vp8_v_loop_filter16y_inner(dst[0]+ 4*linesize,",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1684,
          "old_api": "av_malloc",
          "new_api": null,
          "old_text": "av_malloc(21*s->linesize)",
          "new_text": null,
          "old_line_content": "        s->edge_emu_buffer = av_malloc(21*s->linesize);",
          "new_line_content": "    s->uvlinesize = curframe->linesize[1];",
          "content_same": false
        },
        {
          "line": 1686,
          "old_api": "memset",
          "new_api": null,
          "old_text": "memset(s->top_nnz, 0, s->mb_width*sizeof(*s->top_nnz))",
          "new_text": null,
          "old_line_content": "    memset(s->top_nnz, 0, s->mb_width*sizeof(*s->top_nnz));",
          "new_line_content": "    if (!s->edge_emu_buffer)",
          "content_same": false
        },
        {
          "line": 1817,
          "old_api": "dsputil_init",
          "new_api": null,
          "old_text": "dsputil_init(&s->dsp, avctx)",
          "new_text": null,
          "old_line_content": "    dsputil_init(&s->dsp, avctx);",
          "new_line_content": "    s->avctx = avctx;",
          "content_same": false
        },
        {
          "line": 1818,
          "old_api": "ff_h264_pred_init",
          "new_api": null,
          "old_text": "ff_h264_pred_init(&s->hpc, CODEC_ID_VP8)",
          "new_text": null,
          "old_line_content": "    ff_h264_pred_init(&s->hpc, CODEC_ID_VP8);",
          "new_line_content": "    avctx->pix_fmt = PIX_FMT_YUV420P;",
          "content_same": false
        },
        {
          "line": 1819,
          "old_api": "ff_vp8dsp_init",
          "new_api": null,
          "old_text": "ff_vp8dsp_init(&s->vp8dsp)",
          "new_text": null,
          "old_line_content": "    ff_vp8dsp_init(&s->vp8dsp);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1694,
          "old_api": "memset",
          "new_api": null,
          "old_text": "memset(s->top_border[1]-1, 127, s->mb_width*sizeof(*s->top_border)+1)",
          "new_text": null,
          "old_line_content": "        memset(s->top_border[1]-1, 127, s->mb_width*sizeof(*s->top_border)+1);",
          "new_line_content": "    // top edge of 127 for intra prediction",
          "content_same": false
        },
        {
          "line": 1696,
          "old_api": "memset",
          "new_api": null,
          "old_text": "memset(s->ref_count, 0, sizeof(s->ref_count))",
          "new_text": null,
          "old_line_content": "    memset(s->ref_count, 0, sizeof(s->ref_count));",
          "new_line_content": "        s->top_border[0][15] = s->top_border[0][23] = 127;",
          "content_same": false
        },
        {
          "line": 1698,
          "old_api": "memset",
          "new_api": null,
          "old_text": "memset(s->intra4x4_pred_mode_top, DC_PRED, s->mb_width*4)",
          "new_text": null,
          "old_line_content": "        memset(s->intra4x4_pred_mode_top, DC_PRED, s->mb_width*4);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1826,
          "old_api": "vp8_decode_flush",
          "new_api": null,
          "old_text": "vp8_decode_flush(avctx)",
          "new_text": null,
          "old_line_content": "    vp8_decode_flush(avctx);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1581,
          "old_api": "vp8_h_loop_filter_simple",
          "new_api": null,
          "old_text": "s->vp8dsp.vp8_h_loop_filter_simple(dst, linesize, mbedge_lim)",
          "new_text": null,
          "old_line_content": "        s->vp8dsp.vp8_h_loop_filter_simple(dst, linesize, mbedge_lim);",
          "new_line_content": "     bedge_lim = 2* filter_level    + inner_limit;",
          "content_same": false
        },
        {
          "line": 1710,
          "old_api": "memset",
          "new_api": null,
          "old_text": "memset(mb - 1, 0, sizeof(*mb))",
          "new_text": null,
          "old_line_content": "        memset(mb - 1, 0, sizeof(*mb));   // zero left macroblock",
          "new_line_content": "            curframe->data[2] +  8*mb_y*s->uvlinesize",
          "content_same": false
        },
        {
          "line": 1583,
          "old_api": "vp8_h_loop_filter_simple",
          "new_api": null,
          "old_text": "s->vp8dsp.vp8_h_loop_filter_simple(dst+ 4, linesize, bedge_lim)",
          "new_text": null,
          "old_line_content": "        s->vp8dsp.vp8_h_loop_filter_simple(dst+ 4, linesize, bedge_lim);",
          "new_line_content": "    if (mb_x)",
          "content_same": false
        },
        {
          "line": 1711,
          "old_api": "memset",
          "new_api": null,
          "old_text": "memset(s->left_nnz, 0, sizeof(s->left_nnz))",
          "new_text": null,
          "old_line_content": "        memset(s->left_nnz, 0, sizeof(s->left_nnz));",
          "new_line_content": "        };",
          "content_same": false
        },
        {
          "line": 1585,
          "old_api": "vp8_h_loop_filter_simple",
          "new_api": null,
          "old_text": "s->vp8dsp.vp8_h_loop_filter_simple(dst+12, linesize, bedge_lim)",
          "new_text": null,
          "old_line_content": "        s->vp8dsp.vp8_h_loop_filter_simple(dst+12, linesize, bedge_lim);",
          "new_line_content": "    if (inner_filter) {",
          "content_same": false
        },
        {
          "line": 1712,
          "old_api": "AV_WN32A",
          "new_api": null,
          "old_text": "AV_WN32A(s->intra4x4_pred_mode_left, DC_PRED*0x01010101)",
          "new_text": null,
          "old_line_content": "        AV_WN32A(s->intra4x4_pred_mode_left, DC_PRED*0x01010101);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1841,
          "old_api": "NULL_IF_CONFIG_SMALL",
          "new_api": null,
          "old_text": "NULL_IF_CONFIG_SMALL(\"On2 VP8\")",
          "new_text": null,
          "old_line_content": "    .long_name = NULL_IF_CONFIG_SMALL(\"On2 VP8\"),",
          "new_line_content": "    vp8_decode_frame,",
          "content_same": false
        },
        {
          "line": 1589,
          "old_api": "vp8_v_loop_filter_simple",
          "new_api": null,
          "old_text": "s->vp8dsp.vp8_v_loop_filter_simple(dst, linesize, mbedge_lim)",
          "new_text": null,
          "old_line_content": "        s->vp8dsp.vp8_v_loop_filter_simple(dst, linesize, mbedge_lim);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1591,
          "old_api": "vp8_v_loop_filter_simple",
          "new_api": null,
          "old_text": "s->vp8dsp.vp8_v_loop_filter_simple(dst+ 4*linesize, linesize, bedge_lim)",
          "new_text": null,
          "old_line_content": "        s->vp8dsp.vp8_v_loop_filter_simple(dst+ 4*linesize, linesize, bedge_lim);",
          "new_line_content": "    if (mb_y)",
          "content_same": false
        },
        {
          "line": 1593,
          "old_api": "vp8_v_loop_filter_simple",
          "new_api": null,
          "old_text": "s->vp8dsp.vp8_v_loop_filter_simple(dst+12*linesize, linesize, bedge_lim)",
          "new_text": null,
          "old_line_content": "        s->vp8dsp.vp8_v_loop_filter_simple(dst+12*linesize, linesize, bedge_lim);",
          "new_line_content": "    if (inner_filter) {",
          "content_same": false
        },
        {
          "line": 1725,
          "old_api": "prefetch",
          "new_api": null,
          "old_text": "s->dsp.prefetch(dst[0] + (mb_x&3)*4*s->linesize + 64, s->linesize, 4)",
          "new_text": null,
          "old_line_content": "            s->dsp.prefetch(dst[0] + (mb_x&3)*4*s->linesize + 64, s->linesize, 4);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1726,
          "old_api": "prefetch",
          "new_api": null,
          "old_text": "s->dsp.prefetch(dst[1] + (mb_x&7)*s->uvlinesize + 64, dst[2] - dst[1], 2)",
          "new_text": null,
          "old_line_content": "            s->dsp.prefetch(dst[1] + (mb_x&7)*s->uvlinesize + 64, dst[2] - dst[1], 2);",
          "new_line_content": "        for (mb_x = 0; mb_x < s->mb_width; mb_x++, mb_xy++, mb++) {",
          "content_same": false
        },
        {
          "line": 1730,
          "old_api": "prefetch_motion",
          "new_api": null,
          "old_text": "prefetch_motion(s, mb, mb_x, mb_y, mb_xy, VP56_FRAME_PREVIOUS)",
          "new_text": null,
          "old_line_content": "            prefetch_motion(s, mb, mb_x, mb_y, mb_xy, VP56_FRAME_PREVIOUS);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1608,
          "old_api": "backup_mb_border",
          "new_api": null,
          "old_text": "backup_mb_border(s->top_border[mb_x+1], dst[0], dst[1], dst[2], s->linesize, s->uvlinesize, 0)",
          "new_text": null,
          "old_line_content": "        backup_mb_border(s->top_border[mb_x+1], dst[0], dst[1], dst[2], s->linesize, s->uvlinesize, 0);",
          "new_line_content": "    int mb_x;",
          "content_same": false
        },
        {
          "line": 1609,
          "old_api": "filter_mb",
          "new_api": null,
          "old_text": "filter_mb(s, dst, f++, mb_x, mb_y)",
          "new_text": null,
          "old_line_content": "        filter_mb(s, dst, f++, mb_x, mb_y);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1738,
          "old_api": "inter_predict",
          "new_api": null,
          "old_text": "inter_predict(s, dst, mb, mb_x, mb_y)",
          "new_text": null,
          "old_line_content": "                inter_predict(s, dst, mb, mb_x, mb_y);",
          "new_line_content": "            if (mb->mode <= MODE_I4x4)",
          "content_same": false
        },
        {
          "line": 1483,
          "old_api": "av_clip",
          "new_api": null,
          "old_text": "av_clip(filter_level, 0, 63)",
          "new_text": null,
          "old_line_content": "    filter_level = av_clip(filter_level, 0, 63);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1740,
          "old_api": "prefetch_motion",
          "new_api": null,
          "old_text": "prefetch_motion(s, mb, mb_x, mb_y, mb_xy, VP56_FRAME_GOLDEN)",
          "new_text": null,
          "old_line_content": "            prefetch_motion(s, mb, mb_x, mb_y, mb_xy, VP56_FRAME_GOLDEN);",
          "new_line_content": "            else",
          "content_same": false
        },
        {
          "line": 1488,
          "old_api": "FFMIN",
          "new_api": null,
          "old_text": "FFMIN(interior_limit, 9 - s->filter.sharpness)",
          "new_text": null,
          "old_line_content": "        interior_limit = FFMIN(interior_limit, 9 - s->filter.sharpness);",
          "new_line_content": "    interior_limit = filter_level;",
          "content_same": false
        },
        {
          "line": 1745,
          "old_api": "AV_ZERO64",
          "new_api": null,
          "old_text": "AV_ZERO64(s->left_nnz)",
          "new_text": null,
          "old_line_content": "                AV_ZERO64(s->left_nnz);",
          "new_line_content": "            if (!mb->skip) {",
          "content_same": false
        },
        {
          "line": 1490,
          "old_api": "FFMAX",
          "new_api": null,
          "old_text": "FFMAX(interior_limit, 1)",
          "new_text": null,
          "old_line_content": "    interior_limit = FFMAX(interior_limit, 1);",
          "new_line_content": "        interior_limit >>= s->filter.sharpness > 4 ? 2 : 1;",
          "content_same": false
        },
        {
          "line": 1623,
          "old_api": "backup_mb_border",
          "new_api": null,
          "old_text": "backup_mb_border(s->top_border[mb_x+1], dst, NULL, NULL, s->linesize, 0, 1)",
          "new_text": null,
          "old_line_content": "        backup_mb_border(s->top_border[mb_x+1], dst, NULL, NULL, s->linesize, 0, 1);",
          "new_line_content": "    int mb_x;",
          "content_same": false
        },
        {
          "line": 1624,
          "old_api": "filter_mb_simple",
          "new_api": null,
          "old_text": "filter_mb_simple(s, dst, f++, mb_x, mb_y)",
          "new_text": null,
          "old_line_content": "        filter_mb_simple(s, dst, f++, mb_x, mb_y);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1756,
          "old_api": "filter_level_for_mb",
          "new_api": null,
          "old_text": "filter_level_for_mb(s, mb, &s->filter_strength[mb_x])",
          "new_text": null,
          "old_line_content": "                filter_level_for_mb(s, mb, &s->filter_strength[mb_x]);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 1758,
          "old_api": "prefetch_motion",
          "new_api": null,
          "old_text": "prefetch_motion(s, mb, mb_x, mb_y, mb_xy, VP56_FRAME_GOLDEN2)",
          "new_text": null,
          "old_line_content": "            prefetch_motion(s, mb, mb_x, mb_y, mb_xy, VP56_FRAME_GOLDEN2);",
          "new_line_content": "            if (s->deblock_filter)",
          "content_same": false
        },
        {
          "line": 1637,
          "old_api": "decode_frame_header",
          "new_api": null,
          "old_text": "decode_frame_header(s, avpkt->data, avpkt->size)",
          "new_text": null,
          "old_line_content": "    if ((ret = decode_frame_header(s, avpkt->data, avpkt->size)) < 0)",
          "new_line_content": "    enum AVDiscard skip_thresh;",
          "content_same": false
        },
        {
          "line": 1766,
          "old_api": "filter_mb_row_simple",
          "new_api": null,
          "old_text": "filter_mb_row_simple(s, mb_y)",
          "new_text": null,
          "old_line_content": "                filter_mb_row_simple(s, mb_y);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 1768,
          "old_api": "filter_mb_row",
          "new_api": null,
          "old_text": "filter_mb_row(s, mb_y)",
          "new_text": null,
          "old_line_content": "                filter_mb_row(s, mb_y);",
          "new_line_content": "            if (s->filter.simple)",
          "content_same": false
        },
        {
          "line": 1524,
          "old_api": "vp8_h_loop_filter16y",
          "new_api": null,
          "old_text": "s->vp8dsp.vp8_h_loop_filter16y(dst[0],     linesize,\n                                       mbedge_lim, inner_limit, hev_thresh)",
          "new_text": null,
          "old_line_content": "        s->vp8dsp.vp8_h_loop_filter16y(dst[0],     linesize,",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1781,
          "old_api": "FFSWAP",
          "new_api": null,
          "old_text": "FFSWAP(AVFrame *, s->framep[VP56_FRAME_GOLDEN], s->framep[VP56_FRAME_GOLDEN2])",
          "new_text": null,
          "old_line_content": "        FFSWAP(AVFrame *, s->framep[VP56_FRAME_GOLDEN], s->framep[VP56_FRAME_GOLDEN2]);",
          "new_line_content": "    // check if golden and altref are swapped",
          "content_same": false
        },
        {
          "line": 1526,
          "old_api": "vp8_h_loop_filter8uv",
          "new_api": null,
          "old_text": "s->vp8dsp.vp8_h_loop_filter8uv(dst[1],     dst[2],      uvlinesize,\n                                       mbedge_lim, inner_limit, hev_thresh)",
          "new_text": null,
          "old_line_content": "        s->vp8dsp.vp8_h_loop_filter8uv(dst[1],     dst[2],      uvlinesize,",
          "new_line_content": "    if (mb_x) {",
          "content_same": false
        },
        {
          "line": 1531,
          "old_api": "vp8_h_loop_filter16y_inner",
          "new_api": null,
          "old_text": "s->vp8dsp.vp8_h_loop_filter16y_inner(dst[0]+ 4, linesize, bedge_lim,\n                                             inner_limit, hev_thresh)",
          "new_text": null,
          "old_line_content": "        s->vp8dsp.vp8_h_loop_filter16y_inner(dst[0]+ 4, linesize, bedge_lim,",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1660,
          "old_api": "release_buffer",
          "new_api": null,
          "old_text": "avctx->release_buffer(avctx, curframe)",
          "new_text": null,
          "old_line_content": "        avctx->release_buffer(avctx, curframe);",
          "new_line_content": "            break;",
          "content_same": false
        },
        {
          "line": 1533,
          "old_api": "vp8_h_loop_filter16y_inner",
          "new_api": null,
          "old_text": "s->vp8dsp.vp8_h_loop_filter16y_inner(dst[0]+ 8, linesize, bedge_lim,\n                                             inner_limit, hev_thresh)",
          "new_text": null,
          "old_line_content": "        s->vp8dsp.vp8_h_loop_filter16y_inner(dst[0]+ 8, linesize, bedge_lim,",
          "new_line_content": "    if (inner_filter) {",
          "content_same": false
        },
        {
          "line": 1535,
          "old_api": "vp8_h_loop_filter16y_inner",
          "new_api": null,
          "old_text": "s->vp8dsp.vp8_h_loop_filter16y_inner(dst[0]+12, linesize, bedge_lim,\n                                             inner_limit, hev_thresh)",
          "new_text": null,
          "old_line_content": "        s->vp8dsp.vp8_h_loop_filter16y_inner(dst[0]+12, linesize, bedge_lim,",
          "new_line_content": "                                             inner_limit, hev_thresh);",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 6,
      "total_additions": 52,
      "total_deletions": 52,
      "total_api_changes": 110
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 4,
        "api_related_lines": 110,
        "non_api_lines": 2,
        "non_api_line_numbers": [
          1484,
          1485
        ]
      }
    },
    "api_calls_before": 320,
    "api_calls_after": 320,
    "diff_info": {
      "added_lines": 4,
      "removed_lines": 1,
      "total_diff_lines": 17
    }
  }
}