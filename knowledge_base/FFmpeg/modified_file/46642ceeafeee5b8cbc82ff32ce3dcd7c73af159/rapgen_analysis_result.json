{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/46642ceeafeee5b8cbc82ff32ce3dcd7c73af159",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/46642ceeafeee5b8cbc82ff32ce3dcd7c73af159/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/46642ceeafeee5b8cbc82ff32ce3dcd7c73af159/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/46642ceeafeee5b8cbc82ff32ce3dcd7c73af159/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 253,
          "old_api": "t_best_frame",
          "new_api": "_request_frame",
          "old_text": "t_best_frame(ctx));",
          "new_text": "_request_frame(ctx->inputs[0]);\n",
          "old_line_content": "        ret = ff_filter_frame(link, get_best_frame(ctx));",
          "new_line_content": "    int ret = ff_request_frame(ctx->inputs[0]);",
          "content_same": false
        },
        {
          "line": 270,
          "old_api": "_calloc",
          "new_api": "_pix_fmt_desc_get",
          "old_text": "_calloc(HIST_SIZE, s->nb_threads * sizeof(*s->thread_histogram));\n",
          "new_text": "_pix_fmt_desc_get(inlink->format);\n",
          "old_line_content": "    s->thread_histogram = av_calloc(HIST_SIZE, s->nb_threads * sizeof(*s->thread_histogram));",
          "new_line_content": "    const AVPixFmtDescriptor *desc = av_pix_fmt_desc_get(inlink->format);",
          "content_same": false
        },
        {
          "line": 272,
          "old_api": "ERROR",
          "new_api": "_filter_get_nb_threads",
          "old_text": "ERROR(ENOMEM);\n",
          "new_text": "_filter_get_nb_threads(ctx);\n",
          "old_line_content": "        return AVERROR(ENOMEM);",
          "new_line_content": "    s->nb_threads = ff_filter_get_nb_threads(ctx);",
          "content_same": false
        },
        {
          "line": 275,
          "old_api": "_CEIL_RSHIFT",
          "new_api": "ERROR",
          "old_text": "_CEIL_RSHIFT(inlink->w, desc->log2_chroma_w);\n",
          "new_text": "ERROR(ENOMEM);\n",
          "old_line_content": "    s->planewidth[1]  = s->planewidth[2]  = AV_CEIL_RSHIFT(inlink->w, desc->log2_chroma_w);",
          "new_line_content": "        return AVERROR(ENOMEM);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 256,
          "old_api": null,
          "new_api": "t_best_frame",
          "old_text": null,
          "new_text": "t_best_frame(ctx));",
          "old_line_content": "        ret = AVERROR_EOF;",
          "new_line_content": "        ret = ff_filter_frame(link, get_best_frame(ctx));",
          "content_same": false
        },
        {
          "line": 224,
          "old_api": null,
          "new_api": "MIN",
          "old_text": null,
          "new_text": "MIN(frame->height, s->nb_threads); ",
          "old_line_content": "        for (int i = 0; i < HIST_SIZE; i++)",
          "new_line_content": "    for (int j = 0; j < FFMIN(frame->height, s->nb_threads); j++) {",
          "content_same": false
        },
        {
          "line": 322,
          "old_api": null,
          "new_api": "LL_IF_CONFIG_SMALL",
          "old_text": null,
          "new_text": "LL_IF_CONFIG_SMALL(\"Select the most representative frame in a given sequence of consecutive frames.\"),\n",
          "old_line_content": "    .uninit        = uninit,",
          "new_line_content": "    .description   = NULL_IF_CONFIG_SMALL(\"Select the most representative frame in a given sequence of consecutive frames.\"),",
          "content_same": false
        },
        {
          "line": 326,
          "old_api": null,
          "new_api": "LTER_INPUTS",
          "old_text": null,
          "new_text": "LTER_INPUTS(thumbnail_inputs),\n",
          "old_line_content": "    .priv_class    = &thumbnail_class,",
          "new_line_content": "    FILTER_INPUTS(thumbnail_inputs),",
          "content_same": false
        },
        {
          "line": 327,
          "old_api": null,
          "new_api": "LTER_OUTPUTS",
          "old_text": null,
          "new_text": "LTER_OUTPUTS(thumbnail_outputs),\n",
          "old_line_content": "    .flags         = AVFILTER_FLAG_SUPPORT_TIMELINE_GENERIC |",
          "new_line_content": "    FILTER_OUTPUTS(thumbnail_outputs),",
          "content_same": false
        },
        {
          "line": 328,
          "old_api": null,
          "new_api": "LTER_PIXFMTS_ARRAY",
          "old_text": null,
          "new_text": "LTER_PIXFMTS_ARRAY(pix_fmts),\n",
          "old_line_content": "                     AVFILTER_FLAG_SLICE_THREADS,",
          "new_line_content": "    FILTER_PIXFMTS_ARRAY(pix_fmts),",
          "content_same": false
        },
        {
          "line": 236,
          "old_api": null,
          "new_api": "t_best_frame",
          "old_text": null,
          "new_text": "t_best_frame(ctx));",
          "old_line_content": "static av_cold void uninit(AVFilterContext *ctx)",
          "new_line_content": "    return ff_filter_frame(outlink, get_best_frame(ctx));",
          "content_same": false
        },
        {
          "line": 273,
          "old_api": null,
          "new_api": "_calloc",
          "old_text": null,
          "new_text": "_calloc(HIST_SIZE, s->nb_threads * sizeof(*s->thread_histogram));\n",
          "old_line_content": "",
          "new_line_content": "    s->thread_histogram = av_calloc(HIST_SIZE, s->nb_threads * sizeof(*s->thread_histogram));",
          "content_same": false
        },
        {
          "line": 244,
          "old_api": null,
          "new_api": "_frame_free",
          "old_text": null,
          "new_text": "_frame_free(&s->frames[i].buf);\n",
          "old_line_content": "}",
          "new_line_content": "        av_frame_free(&s->frames[i].buf);",
          "content_same": false
        },
        {
          "line": 245,
          "old_api": null,
          "new_api": "_freep",
          "old_text": null,
          "new_text": "_freep(&s->frames);\n",
          "old_line_content": "",
          "new_line_content": "    av_freep(&s->frames);",
          "content_same": false
        },
        {
          "line": 278,
          "old_api": null,
          "new_api": "_CEIL_RSHIFT",
          "old_text": null,
          "new_text": "_CEIL_RSHIFT(inlink->w, desc->log2_chroma_w);\n",
          "old_line_content": "    s->planeheight[0] = s->planeheight[3] = inlink->h;",
          "new_line_content": "    s->planewidth[1]  = s->planewidth[2]  = AV_CEIL_RSHIFT(inlink->w, desc->log2_chroma_w);",
          "content_same": false
        },
        {
          "line": 246,
          "old_api": null,
          "new_api": "_freep",
          "old_text": null,
          "new_text": "_freep(&s->thread_histogram);\n",
          "old_line_content": "static int request_frame(AVFilterLink *link)",
          "new_line_content": "    av_freep(&s->thread_histogram);",
          "content_same": false
        },
        {
          "line": 280,
          "old_api": null,
          "new_api": "_CEIL_RSHIFT",
          "old_text": null,
          "new_text": "_CEIL_RSHIFT(inlink->h, desc->log2_chroma_h);\n",
          "old_line_content": "    return 0;",
          "new_line_content": "    s->planeheight[1] = s->planeheight[2] = AV_CEIL_RSHIFT(inlink->h, desc->log2_chroma_h);",
          "content_same": false
        },
        {
          "line": 220,
          "old_api": null,
          "new_api": "_filter_execute",
          "old_text": null,
          "new_text": "_filter_execute(ctx, do_slice, frame, NULL,\n                      FFMIN(frame->height, s->nb_threads));\n",
          "old_line_content": "    // update current frame histogram",
          "new_line_content": "    ff_filter_execute(ctx, do_slice, frame, NULL,",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 323,
          "old_api": "LTER_INPUTS",
          "new_api": null,
          "old_text": "LTER_INPUTS(thumbnail_inputs),\n",
          "new_text": null,
          "old_line_content": "    FILTER_INPUTS(thumbnail_inputs),",
          "new_line_content": "    .priv_size     = sizeof(ThumbContext),",
          "content_same": false
        },
        {
          "line": 324,
          "old_api": "LTER_OUTPUTS",
          "new_api": null,
          "old_text": "LTER_OUTPUTS(thumbnail_outputs),\n",
          "new_text": null,
          "old_line_content": "    FILTER_OUTPUTS(thumbnail_outputs),",
          "new_line_content": "    .init          = init,",
          "content_same": false
        },
        {
          "line": 325,
          "old_api": "LTER_PIXFMTS_ARRAY",
          "new_api": null,
          "old_text": "LTER_PIXFMTS_ARRAY(pix_fmts),\n",
          "new_text": null,
          "old_line_content": "    FILTER_PIXFMTS_ARRAY(pix_fmts),",
          "new_line_content": "    .uninit        = uninit,",
          "content_same": false
        },
        {
          "line": 233,
          "old_api": "t_best_frame",
          "new_api": null,
          "old_text": "t_best_frame(ctx));",
          "new_text": null,
          "old_line_content": "    return ff_filter_frame(outlink, get_best_frame(ctx));",
          "new_line_content": "    if (s->n < s->n_frames)",
          "content_same": false
        },
        {
          "line": 250,
          "old_api": "_request_frame",
          "new_api": null,
          "old_text": "_request_frame(ctx->inputs[0]);\n",
          "new_text": null,
          "old_line_content": "    int ret = ff_request_frame(ctx->inputs[0]);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 267,
          "old_api": "_pix_fmt_desc_get",
          "new_api": null,
          "old_text": "_pix_fmt_desc_get(inlink->format);\n",
          "new_text": null,
          "old_line_content": "    const AVPixFmtDescriptor *desc = av_pix_fmt_desc_get(inlink->format);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 269,
          "old_api": "_filter_get_nb_threads",
          "new_api": null,
          "old_text": "_filter_get_nb_threads(ctx);\n",
          "new_text": null,
          "old_line_content": "    s->nb_threads = ff_filter_get_nb_threads(ctx);",
          "new_line_content": "    ThumbContext *s = ctx->priv;",
          "content_same": false
        },
        {
          "line": 241,
          "old_api": "_frame_free",
          "new_api": null,
          "old_text": "_frame_free(&s->frames[i].buf);\n",
          "new_text": null,
          "old_line_content": "        av_frame_free(&s->frames[i].buf);",
          "new_line_content": "    int i;",
          "content_same": false
        },
        {
          "line": 242,
          "old_api": "_freep",
          "new_api": null,
          "old_text": "_freep(&s->frames);\n",
          "new_text": null,
          "old_line_content": "    av_freep(&s->frames);",
          "new_line_content": "    ThumbContext *s = ctx->priv;",
          "content_same": false
        },
        {
          "line": 243,
          "old_api": "_freep",
          "new_api": null,
          "old_text": "_freep(&s->thread_histogram);\n",
          "new_text": null,
          "old_line_content": "    av_freep(&s->thread_histogram);",
          "new_line_content": "    for (i = 0; i < s->n_frames && s->frames && s->frames[i].buf; i++)",
          "content_same": false
        },
        {
          "line": 277,
          "old_api": "_CEIL_RSHIFT",
          "new_api": null,
          "old_text": "_CEIL_RSHIFT(inlink->h, desc->log2_chroma_h);\n",
          "new_text": null,
          "old_line_content": "    s->planeheight[1] = s->planeheight[2] = AV_CEIL_RSHIFT(inlink->h, desc->log2_chroma_h);",
          "new_line_content": "    s->tb = inlink->time_base;",
          "content_same": false
        },
        {
          "line": 217,
          "old_api": "_filter_execute",
          "new_api": null,
          "old_text": "_filter_execute(ctx, do_slice, frame, NULL,\n                      FFMIN(frame->height, s->nb_threads));\n",
          "new_text": null,
          "old_line_content": "    ff_filter_execute(ctx, do_slice, frame, NULL,",
          "new_line_content": "    // keep a reference of each frame",
          "content_same": false
        },
        {
          "line": 218,
          "old_api": "MIN",
          "new_api": null,
          "old_text": "MIN(frame->height, s->nb_threads));",
          "new_text": null,
          "old_line_content": "                      FFMIN(frame->height, s->nb_threads));",
          "new_line_content": "    s->frames[s->n].buf = frame;",
          "content_same": false
        },
        {
          "line": 319,
          "old_api": "LL_IF_CONFIG_SMALL",
          "new_api": null,
          "old_text": "LL_IF_CONFIG_SMALL(\"Select the most representative frame in a given sequence of consecutive frames.\"),\n",
          "new_text": null,
          "old_line_content": "    .description   = NULL_IF_CONFIG_SMALL(\"Select the most representative frame in a given sequence of consecutive frames.\"),",
          "new_line_content": "",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 4,
      "total_additions": 14,
      "total_deletions": 14,
      "total_api_changes": 32
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 8,
        "api_related_lines": 32,
        "non_api_lines": 8,
        "non_api_line_numbers": [
          194,
          195,
          196,
          197,
          198,
          199,
          200,
          201
        ]
      }
    },
    "api_calls_before": 34,
    "api_calls_after": 34,
    "diff_info": {
      "added_lines": 6,
      "removed_lines": 3,
      "total_diff_lines": 23
    }
  }
}