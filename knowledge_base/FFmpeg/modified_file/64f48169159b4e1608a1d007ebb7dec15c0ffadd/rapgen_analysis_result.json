{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/64f48169159b4e1608a1d007ebb7dec15c0ffadd",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/64f48169159b4e1608a1d007ebb7dec15c0ffadd/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/64f48169159b4e1608a1d007ebb7dec15c0ffadd/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/64f48169159b4e1608a1d007ebb7dec15c0ffadd/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 109,
          "old_api": "av_add_index_entry",
          "new_api": "avio_r8",
          "old_text": "av_add_index_entry(s->streams[0],\n                           av_rescale(b, filesize, 256),\n                           av_rescale(i, duration, XING_TOC_COUNT),\n                           0, 0, AVINDEX_KEYFRAME)",
          "new_text": "avio_r8(s->pb)",
          "old_line_content": "            av_add_index_entry(s->streams[0],",
          "new_line_content": "        uint8_t b = avio_r8(s->pb);",
          "content_same": false
        },
        {
          "line": 111,
          "old_api": "av_rescale",
          "new_api": "av_add_index_entry",
          "old_text": "av_rescale(i, duration, XING_TOC_COUNT)",
          "new_text": "av_add_index_entry(s->streams[0],\n                           av_rescale(b, filesize, 256),\n                           av_rescale(i, duration, XING_TOC_COUNT),\n                           0, 0, AVINDEX_KEYFRAME)",
          "old_line_content": "                           av_rescale(i, duration, XING_TOC_COUNT),",
          "new_line_content": "            av_add_index_entry(s->streams[0],",
          "content_same": false
        },
        {
          "line": 146,
          "old_api": "MKBETAG",
          "new_api": "avio_skip",
          "old_text": "MKBETAG('I', 'n', 'f', 'o')",
          "new_text": "avio_skip(s->pb, xing_offtbl[c.lsf == 1][c.nb_channels == 1])",
          "old_line_content": "    is_cbr = v == MKBETAG('I', 'n', 'f', 'o');",
          "new_line_content": "    avio_skip(s->pb, xing_offtbl[c.lsf == 1][c.nb_channels == 1]);",
          "content_same": false
        },
        {
          "line": 147,
          "old_api": "MKBETAG",
          "new_api": "avio_rb32",
          "old_text": "MKBETAG('X', 'i', 'n', 'g')",
          "new_text": "avio_rb32(s->pb)",
          "old_line_content": "    if (v == MKBETAG('X', 'i', 'n', 'g') || is_cbr) {",
          "new_line_content": "    v = avio_rb32(s->pb);",
          "content_same": false
        },
        {
          "line": 148,
          "old_api": "avio_rb32",
          "new_api": "MKBETAG",
          "old_text": "avio_rb32(s->pb)",
          "new_text": "MKBETAG('I', 'n', 'f', 'o')",
          "old_line_content": "        v = avio_rb32(s->pb);",
          "new_line_content": "    is_cbr = v == MKBETAG('I', 'n', 'f', 'o');",
          "content_same": false
        },
        {
          "line": 154,
          "old_api": "av_rescale_q",
          "new_api": "avio_rb32",
          "old_text": "av_rescale_q(frames, (AVRational){spf, c.sample_rate},\n                                    st->time_base)",
          "new_text": "avio_rb32(s->pb)",
          "old_line_content": "            read_xing_toc(s, size, av_rescale_q(frames, (AVRational){spf, c.sample_rate},",
          "new_line_content": "            size = avio_rb32(s->pb);",
          "content_same": false
        },
        {
          "line": 159,
          "old_api": "avio_rb32",
          "new_api": "avio_skip",
          "old_text": "avio_rb32(s->pb)",
          "new_text": "avio_skip(s->pb, 4)",
          "old_line_content": "        v = avio_rb32(s->pb);",
          "new_line_content": "            avio_skip(s->pb, 4);",
          "content_same": false
        },
        {
          "line": 161,
          "old_api": "avio_skip",
          "new_api": "avio_rb32",
          "old_text": "avio_skip(s->pb, 21-4)",
          "new_text": "avio_rb32(s->pb)",
          "old_line_content": "            avio_skip(s->pb, 21-4);",
          "new_line_content": "        v = avio_rb32(s->pb);",
          "content_same": false
        },
        {
          "line": 162,
          "old_api": "avio_rb24",
          "new_api": "MKBETAG",
          "old_text": "avio_rb24(s->pb)",
          "new_text": "MKBETAG('L', 'a', 'v', 'f')",
          "old_line_content": "            v= avio_rb24(s->pb);",
          "new_line_content": "        if(v == MKBETAG('L', 'A', 'M', 'E') || v == MKBETAG('L', 'a', 'v', 'f')) {",
          "content_same": false
        },
        {
          "line": 173,
          "old_api": "MKBETAG",
          "new_api": "avio_seek",
          "old_text": "MKBETAG('V', 'B', 'R', 'I')",
          "new_text": "avio_seek(s->pb, base + 4 + 32, SEEK_SET)",
          "old_line_content": "    if(v == MKBETAG('V', 'B', 'R', 'I')) {",
          "new_line_content": "    avio_seek(s->pb, base + 4 + 32, SEEK_SET);",
          "content_same": false
        },
        {
          "line": 175,
          "old_api": "avio_rb16",
          "new_api": "MKBETAG",
          "old_text": "avio_rb16(s->pb)",
          "new_text": "MKBETAG('V', 'B', 'R', 'I')",
          "old_line_content": "        if(avio_rb16(s->pb) == 1) {",
          "new_line_content": "    if(v == MKBETAG('V', 'B', 'R', 'I')) {",
          "content_same": false
        },
        {
          "line": 177,
          "old_api": "avio_skip",
          "new_api": "avio_rb16",
          "old_text": "avio_skip(s->pb, 4)",
          "new_text": "avio_rb16(s->pb)",
          "old_line_content": "            avio_skip(s->pb, 4);",
          "new_line_content": "        if(avio_rb16(s->pb) == 1) {",
          "content_same": false
        },
        {
          "line": 179,
          "old_api": "avio_rb32",
          "new_api": "avio_skip",
          "old_text": "avio_rb32(s->pb)",
          "new_text": "avio_skip(s->pb, 4)",
          "old_line_content": "            frames = avio_rb32(s->pb);",
          "new_line_content": "            avio_skip(s->pb, 4);",
          "content_same": false
        },
        {
          "line": 209,
          "old_api": "AVERROR",
          "new_api": "avformat_new_stream",
          "old_text": "AVERROR(ENOMEM)",
          "new_text": "avformat_new_stream(s, NULL)",
          "old_line_content": "        return AVERROR(ENOMEM);",
          "new_line_content": "    st = avformat_new_stream(s, NULL);",
          "content_same": false
        },
        {
          "line": 222,
          "old_api": "av_dict_get",
          "new_api": "avio_tell",
          "old_text": "av_dict_get(s->metadata, \"\", NULL, AV_DICT_IGNORE_SUFFIX)",
          "new_text": "avio_tell(s->pb)",
          "old_line_content": "    if (!av_dict_get(s->metadata, \"\", NULL, AV_DICT_IGNORE_SUFFIX))",
          "new_line_content": "    off = avio_tell(s->pb);",
          "content_same": false
        },
        {
          "line": 228,
          "old_api": "mp3_parse_vbr_tags",
          "new_api": "avio_size",
          "old_text": "mp3_parse_vbr_tags(s, st, off)",
          "new_text": "avio_size(s->pb)",
          "old_line_content": "    if (mp3_parse_vbr_tags(s, st, off) < 0)",
          "new_line_content": "        mp3->filesize = avio_size(s->pb);",
          "content_same": false
        },
        {
          "line": 246,
          "old_api": "FFMIN",
          "new_api": "avio_tell",
          "old_text": "FFMIN(size, mp3->filesize - pos)",
          "new_text": "avio_tell(s->pb)",
          "old_line_content": "        size= FFMIN(size, mp3->filesize - pos);",
          "new_line_content": "    pos = avio_tell(s->pb);",
          "content_same": false
        },
        {
          "line": 248,
          "old_api": "av_get_packet",
          "new_api": "FFMIN",
          "old_text": "av_get_packet(s->pb, pkt, size)",
          "new_text": "FFMIN(size, mp3->filesize - pos)",
          "old_line_content": "    ret= av_get_packet(s->pb, pkt, size);",
          "new_line_content": "        size= FFMIN(size, mp3->filesize - pos);",
          "content_same": false
        },
        {
          "line": 278,
          "old_api": "avpriv_mpegaudio_decode_header",
          "new_api": "ff_mpa_check_header",
          "old_text": "avpriv_mpegaudio_decode_header(&sd, header)",
          "new_text": "ff_mpa_check_header(header)",
          "old_line_content": "    if (avpriv_mpegaudio_decode_header(&sd, header) == 1)",
          "new_line_content": "    if (ff_mpa_check_header(header) < 0)",
          "content_same": false
        },
        {
          "line": 301,
          "old_api": "av_clip64",
          "new_api": "av_rescale",
          "old_text": "av_clip64(timestamp, 0, duration)",
          "new_text": "av_rescale(st->duration, filesize, mp3->header_filesize - s->data_offset)",
          "old_line_content": "        timestamp = av_clip64(timestamp, 0, duration);",
          "new_line_content": "        duration = av_rescale(st->duration, filesize, mp3->header_filesize - s->data_offset);",
          "content_same": false
        },
        {
          "line": 303,
          "old_api": "av_rescale",
          "new_api": "av_clip64",
          "old_text": "av_rescale(timestamp, filesize, duration)",
          "new_text": "av_clip64(timestamp, 0, duration)",
          "old_line_content": "        ie->pos       = av_rescale(timestamp, filesize, duration) + s->data_offset;",
          "new_line_content": "        timestamp = av_clip64(timestamp, 0, duration);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 261,
          "old_api": null,
          "new_api": "memcmp",
          "old_text": null,
          "new_text": "memcmp(&pkt->data[ret - ID3v1_TAG_SIZE], \"TAG\", 3)",
          "old_line_content": "",
          "new_line_content": "        memcmp(&pkt->data[ret - ID3v1_TAG_SIZE], \"TAG\", 3) == 0)",
          "content_same": false
        },
        {
          "line": 134,
          "old_api": null,
          "new_api": "avio_rb32",
          "old_text": null,
          "new_text": "avio_rb32(s->pb)",
          "old_line_content": "      return -1;",
          "new_line_content": "    v = avio_rb32(s->pb);",
          "content_same": false
        },
        {
          "line": 135,
          "old_api": null,
          "new_api": "ff_mpa_check_header",
          "old_text": null,
          "new_text": "ff_mpa_check_header(v)",
          "old_line_content": "",
          "new_line_content": "    if(ff_mpa_check_header(v) < 0)",
          "content_same": false
        },
        {
          "line": 138,
          "old_api": null,
          "new_api": "avpriv_mpegaudio_decode_header",
          "old_text": null,
          "new_text": "avpriv_mpegaudio_decode_header(&c, v)",
          "old_line_content": "    if(c.layer != 3)",
          "new_line_content": "    if (avpriv_mpegaudio_decode_header(&c, v) == 0)",
          "content_same": false
        },
        {
          "line": 272,
          "old_api": null,
          "new_api": "avio_seek",
          "old_text": null,
          "new_text": "avio_seek(s->pb, pos, SEEK_SET)",
          "old_line_content": "    MPADecodeHeader sd;",
          "new_line_content": "    int64_t ret = avio_seek(s->pb, pos, SEEK_SET);",
          "content_same": false
        },
        {
          "line": 149,
          "old_api": null,
          "new_api": "MKBETAG",
          "old_text": null,
          "new_text": "MKBETAG('X', 'i', 'n', 'g')",
          "old_line_content": "        if(v & XING_FLAG_FRAMES)",
          "new_line_content": "    if (v == MKBETAG('X', 'i', 'n', 'g') || is_cbr) {",
          "content_same": false
        },
        {
          "line": 277,
          "old_api": null,
          "new_api": "avio_rb32",
          "old_text": null,
          "new_text": "avio_rb32(s->pb)",
          "old_line_content": "        return -1;",
          "new_line_content": "    header = avio_rb32(s->pb);",
          "content_same": false
        },
        {
          "line": 280,
          "old_api": null,
          "new_api": "avpriv_mpegaudio_decode_header",
          "old_text": null,
          "new_text": "avpriv_mpegaudio_decode_header(&sd, header)",
          "old_line_content": "    return sd.frame_size;",
          "new_line_content": "    if (avpriv_mpegaudio_decode_header(&sd, header) == 1)",
          "content_same": false
        },
        {
          "line": 156,
          "old_api": null,
          "new_api": "av_rescale_q",
          "old_text": null,
          "new_text": "av_rescale_q(frames, (AVRational){spf, c.sample_rate},\n                                    st->time_base)",
          "old_line_content": "        if(v & 8)",
          "new_line_content": "            read_xing_toc(s, size, av_rescale_q(frames, (AVRational){spf, c.sample_rate},",
          "content_same": false
        },
        {
          "line": 163,
          "old_api": null,
          "new_api": "avio_skip",
          "old_text": null,
          "new_text": "avio_skip(s->pb, 21-4)",
          "old_line_content": "            mp3->start_pad = v>>12;",
          "new_line_content": "            avio_skip(s->pb, 21-4);",
          "content_same": false
        },
        {
          "line": 164,
          "old_api": null,
          "new_api": "avio_rb24",
          "old_text": null,
          "new_text": "avio_rb24(s->pb)",
          "old_line_content": "            mp3->  end_pad = v&4095;",
          "new_line_content": "            v= avio_rb24(s->pb);",
          "content_same": false
        },
        {
          "line": 291,
          "old_api": null,
          "new_api": "av_index_search_timestamp",
          "old_text": null,
          "new_text": "av_index_search_timestamp(st, timestamp, flags)",
          "old_line_content": "    int dir = (flags&AVSEEK_FLAG_BACKWARD) ? -1 : 1;",
          "new_line_content": "    int64_t ret  = av_index_search_timestamp(st, timestamp, flags);",
          "content_same": false
        },
        {
          "line": 168,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(s, AV_LOG_DEBUG, \"pad %d %d\\n\", mp3->start_pad, mp3->  end_pad)",
          "old_line_content": "    }",
          "new_line_content": "            av_log(s, AV_LOG_DEBUG, \"pad %d %d\\n\", mp3->start_pad, mp3->  end_pad);",
          "content_same": false
        },
        {
          "line": 296,
          "old_api": null,
          "new_api": "avio_size",
          "old_text": null,
          "new_text": "avio_size(s->pb)",
          "old_line_content": "        if (filesize <= s->data_offset)",
          "new_line_content": "        int64_t filesize = avio_size(s->pb);",
          "content_same": false
        },
        {
          "line": 174,
          "old_api": null,
          "new_api": "avio_rb32",
          "old_text": null,
          "new_text": "avio_rb32(s->pb)",
          "old_line_content": "        /* Check tag version */",
          "new_line_content": "    v = avio_rb32(s->pb);",
          "content_same": false
        },
        {
          "line": 305,
          "old_api": null,
          "new_api": "av_rescale",
          "old_text": null,
          "new_text": "av_rescale(timestamp, filesize, duration)",
          "old_line_content": "        if (ret < 0)",
          "new_line_content": "        ie->pos       = av_rescale(timestamp, filesize, duration) + s->data_offset;",
          "content_same": false
        },
        {
          "line": 180,
          "old_api": null,
          "new_api": "avio_rb32",
          "old_text": null,
          "new_text": "avio_rb32(s->pb)",
          "old_line_content": "        }",
          "new_line_content": "            size = avio_rb32(s->pb);",
          "content_same": false
        },
        {
          "line": 181,
          "old_api": null,
          "new_api": "avio_rb32",
          "old_text": null,
          "new_text": "avio_rb32(s->pb)",
          "old_line_content": "    }",
          "new_line_content": "            frames = avio_rb32(s->pb);",
          "content_same": false
        },
        {
          "line": 189,
          "old_api": null,
          "new_api": "avio_seek",
          "old_text": null,
          "new_text": "avio_seek(s->pb, base + vbrtag_size, SEEK_SET)",
          "old_line_content": "    if(frames)",
          "new_line_content": "    avio_seek(s->pb, base + vbrtag_size, SEEK_SET);",
          "content_same": false
        },
        {
          "line": 317,
          "old_api": null,
          "new_api": "avio_seek",
          "old_text": null,
          "new_text": "avio_seek(s->pb, ie->pos, SEEK_SET)",
          "old_line_content": "        return ret;",
          "new_line_content": "    ret = avio_seek(s->pb, ie->pos, SEEK_SET);",
          "content_same": false
        },
        {
          "line": 192,
          "old_api": null,
          "new_api": "av_rescale_q",
          "old_text": null,
          "new_text": "av_rescale_q(frames, (AVRational){spf, c.sample_rate},\n                                    st->time_base)",
          "old_line_content": "    if (size && frames && !is_cbr)",
          "new_line_content": "        st->duration = av_rescale_q(frames, (AVRational){spf, c.sample_rate},",
          "content_same": false
        },
        {
          "line": 195,
          "old_api": null,
          "new_api": "av_rescale",
          "old_text": null,
          "new_text": "av_rescale(size, 8 * c.sample_rate, frames * (int64_t)spf)",
          "old_line_content": "    mp3->is_cbr          = is_cbr;",
          "new_line_content": "        st->codec->bit_rate = av_rescale(size, 8 * c.sample_rate, frames * (int64_t)spf);",
          "content_same": false
        },
        {
          "line": 325,
          "old_api": null,
          "new_api": "check",
          "old_text": null,
          "new_text": "check(s, pos)",
          "old_line_content": "                break;",
          "new_line_content": "            ret = check(s, pos);",
          "content_same": false
        },
        {
          "line": 70,
          "old_api": null,
          "new_api": "AV_RB32",
          "old_text": null,
          "new_text": "AV_RB32(buf2)",
          "old_line_content": "",
          "new_line_content": "        if(ff_mpa_check_header(AV_RB32(buf2)))",
          "content_same": false
        },
        {
          "line": 74,
          "old_api": null,
          "new_api": "AV_RB32",
          "old_text": null,
          "new_text": "AV_RB32(buf2)",
          "old_line_content": "            if(fsize < 0)",
          "new_line_content": "            header = AV_RB32(buf2);",
          "content_same": false
        },
        {
          "line": 75,
          "old_api": null,
          "new_api": "avpriv_mpa_decode_header",
          "old_text": null,
          "new_text": "avpriv_mpa_decode_header(&avctx, header, &sample_rate, &sample_rate, &sample_rate, &sample_rate)",
          "old_line_content": "                break;",
          "new_line_content": "            fsize = avpriv_mpa_decode_header(&avctx, header, &sample_rate, &sample_rate, &sample_rate, &sample_rate);",
          "content_same": false
        },
        {
          "line": 80,
          "old_api": null,
          "new_api": "FFMAX",
          "old_text": null,
          "new_text": "FFMAX(max_frames, frames)",
          "old_line_content": "            first_frames= frames;",
          "new_line_content": "        max_frames = FFMAX(max_frames, frames);",
          "content_same": false
        },
        {
          "line": 336,
          "old_api": null,
          "new_api": "avio_seek",
          "old_text": null,
          "new_text": "avio_seek(s->pb, ie->pos + i*dir, SEEK_SET)",
          "old_line_content": "        return ret;",
          "new_line_content": "    ret = avio_seek(s->pb, ie->pos + i*dir, SEEK_SET);",
          "content_same": false
        },
        {
          "line": 211,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(ENOMEM)",
          "old_line_content": "    st->codec->codec_type = AVMEDIA_TYPE_AUDIO;",
          "new_line_content": "        return AVERROR(ENOMEM);",
          "content_same": false
        },
        {
          "line": 339,
          "old_api": null,
          "new_api": "ff_update_cur_dts",
          "old_text": null,
          "new_text": "ff_update_cur_dts(s, st, ie->timestamp)",
          "old_line_content": "    return 0;",
          "new_line_content": "    ff_update_cur_dts(s, st, ie->timestamp);",
          "content_same": false
        },
        {
          "line": 89,
          "old_api": null,
          "new_api": "ff_id3v2_tag_len",
          "old_text": null,
          "new_text": "ff_id3v2_tag_len(buf0)",
          "old_line_content": "    else if(max_frames>=1) return 1;",
          "new_line_content": "    else if(ff_id3v2_match(buf0, ID3v2_DEFAULT_MAGIC) && 2*ff_id3v2_tag_len(buf0) >= p->buf_size)",
          "content_same": false
        },
        {
          "line": 345,
          "old_api": null,
          "new_api": "offsetof",
          "old_text": null,
          "new_text": "offsetof(MP3DecContext, usetoc)",
          "old_line_content": "};",
          "new_line_content": "    { \"usetoc\", \"use table of contents\", offsetof(MP3DecContext, usetoc), AV_OPT_TYPE_INT, {.i64 = -1}, -1, 1, AV_OPT_FLAG_DECODING_PARAM},",
          "content_same": false
        },
        {
          "line": 219,
          "old_api": null,
          "new_api": "avpriv_set_pts_info",
          "old_text": null,
          "new_text": "avpriv_set_pts_info(st, 64, 1, 14112000)",
          "old_line_content": "    s->pb->maxsize = -1;",
          "new_line_content": "    avpriv_set_pts_info(st, 64, 1, 14112000);",
          "content_same": false
        },
        {
          "line": 224,
          "old_api": null,
          "new_api": "av_dict_get",
          "old_text": null,
          "new_text": "av_dict_get(s->metadata, \"\", NULL, AV_DICT_IGNORE_SUFFIX)",
          "old_line_content": "",
          "new_line_content": "    if (!av_dict_get(s->metadata, \"\", NULL, AV_DICT_IGNORE_SUFFIX))",
          "content_same": false
        },
        {
          "line": 225,
          "old_api": null,
          "new_api": "ff_id3v1_read",
          "old_text": null,
          "new_text": "ff_id3v1_read(s)",
          "old_line_content": "    if(s->pb->seekable)",
          "new_line_content": "        ff_id3v1_read(s);",
          "content_same": false
        },
        {
          "line": 230,
          "old_api": null,
          "new_api": "mp3_parse_vbr_tags",
          "old_text": null,
          "new_text": "mp3_parse_vbr_tags(s, st, off)",
          "old_line_content": "",
          "new_line_content": "    if (mp3_parse_vbr_tags(s, st, off) < 0)",
          "content_same": false
        },
        {
          "line": 103,
          "old_api": null,
          "new_api": "avio_size",
          "old_text": null,
          "new_text": "avio_size(s->pb)",
          "old_line_content": "        fill_index = 0;",
          "new_line_content": "        !(filesize = avio_size(s->pb))) {",
          "content_same": false
        },
        {
          "line": 104,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(s, AV_LOG_WARNING, \"Cannot determine file size, skipping TOC table.\\n\")",
          "old_line_content": "    }",
          "new_line_content": "        av_log(s, AV_LOG_WARNING, \"Cannot determine file size, skipping TOC table.\\n\");",
          "content_same": false
        },
        {
          "line": 231,
          "old_api": null,
          "new_api": "avio_seek",
          "old_text": null,
          "new_text": "avio_seek(s->pb, off, SEEK_SET)",
          "old_line_content": "    /* the parameters will be extracted from the compressed bitstream */",
          "new_line_content": "        avio_seek(s->pb, off, SEEK_SET);",
          "content_same": false
        },
        {
          "line": 359,
          "old_api": null,
          "new_api": "NULL_IF_CONFIG_SMALL",
          "old_text": null,
          "new_text": "NULL_IF_CONFIG_SMALL(\"MP2/3 (MPEG audio layer 2/3)\")",
          "old_line_content": "    .read_header    = mp3_read_header,",
          "new_line_content": "    .long_name      = NULL_IF_CONFIG_SMALL(\"MP2/3 (MPEG audio layer 2/3)\"),",
          "content_same": false
        },
        {
          "line": 112,
          "old_api": null,
          "new_api": "av_rescale",
          "old_text": null,
          "new_text": "av_rescale(b, filesize, 256)",
          "old_line_content": "                           0, 0, AVINDEX_KEYFRAME);",
          "new_line_content": "                           av_rescale(b, filesize, 256),",
          "content_same": false
        },
        {
          "line": 113,
          "old_api": null,
          "new_api": "av_rescale",
          "old_text": null,
          "new_text": "av_rescale(i, duration, XING_TOC_COUNT)",
          "old_line_content": "    }",
          "new_line_content": "                           av_rescale(i, duration, XING_TOC_COUNT),",
          "content_same": false
        },
        {
          "line": 250,
          "old_api": null,
          "new_api": "av_get_packet",
          "old_text": null,
          "new_text": "av_get_packet(s->pb, pkt, size)",
          "old_line_content": "        if(ret<0)",
          "new_line_content": "    ret= av_get_packet(s->pb, pkt, size);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 259,
          "old_api": "memcmp",
          "new_api": null,
          "old_text": "memcmp(&pkt->data[ret - ID3v1_TAG_SIZE], \"TAG\", 3)",
          "new_text": null,
          "old_line_content": "        memcmp(&pkt->data[ret - ID3v1_TAG_SIZE], \"TAG\", 3) == 0)",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 132,
          "old_api": "avio_rb32",
          "new_api": null,
          "old_text": "avio_rb32(s->pb)",
          "new_text": null,
          "old_line_content": "    v = avio_rb32(s->pb);",
          "new_line_content": "    int is_cbr;",
          "content_same": false
        },
        {
          "line": 133,
          "old_api": "ff_mpa_check_header",
          "new_api": null,
          "old_text": "ff_mpa_check_header(v)",
          "new_text": null,
          "old_line_content": "    if(ff_mpa_check_header(v) < 0)",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 136,
          "old_api": "avpriv_mpegaudio_decode_header",
          "new_api": null,
          "old_text": "avpriv_mpegaudio_decode_header(&c, v)",
          "new_text": null,
          "old_line_content": "    if (avpriv_mpegaudio_decode_header(&c, v) == 0)",
          "new_line_content": "      return -1;",
          "content_same": false
        },
        {
          "line": 270,
          "old_api": "avio_seek",
          "new_api": null,
          "old_text": "avio_seek(s->pb, pos, SEEK_SET)",
          "new_text": null,
          "old_line_content": "    int64_t ret = avio_seek(s->pb, pos, SEEK_SET);",
          "new_line_content": "static int check(AVFormatContext *s, int64_t pos)",
          "content_same": false
        },
        {
          "line": 144,
          "old_api": "avio_skip",
          "new_api": null,
          "old_text": "avio_skip(s->pb, xing_offtbl[c.lsf == 1][c.nb_channels == 1])",
          "new_text": null,
          "old_line_content": "    avio_skip(s->pb, xing_offtbl[c.lsf == 1][c.nb_channels == 1]);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 145,
          "old_api": "avio_rb32",
          "new_api": null,
          "old_text": "avio_rb32(s->pb)",
          "new_text": null,
          "old_line_content": "    v = avio_rb32(s->pb);",
          "new_line_content": "    /* Check for Xing / Info tag */",
          "content_same": false
        },
        {
          "line": 275,
          "old_api": "avio_rb32",
          "new_api": null,
          "old_text": "avio_rb32(s->pb)",
          "new_text": null,
          "old_line_content": "    header = avio_rb32(s->pb);",
          "new_line_content": "    if (ret < 0)",
          "content_same": false
        },
        {
          "line": 276,
          "old_api": "ff_mpa_check_header",
          "new_api": null,
          "old_text": "ff_mpa_check_header(header)",
          "new_text": null,
          "old_line_content": "    if (ff_mpa_check_header(header) < 0)",
          "new_line_content": "        return ret;",
          "content_same": false
        },
        {
          "line": 157,
          "old_api": "avio_skip",
          "new_api": null,
          "old_text": "avio_skip(s->pb, 4)",
          "new_text": null,
          "old_line_content": "            avio_skip(s->pb, 4);",
          "new_line_content": "                                    st->time_base));",
          "content_same": false
        },
        {
          "line": 160,
          "old_api": "MKBETAG",
          "new_api": null,
          "old_text": "MKBETAG('L', 'a', 'v', 'f')",
          "new_text": null,
          "old_line_content": "        if(v == MKBETAG('L', 'A', 'M', 'E') || v == MKBETAG('L', 'a', 'v', 'f')) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 289,
          "old_api": "av_index_search_timestamp",
          "new_api": null,
          "old_text": "av_index_search_timestamp(st, timestamp, flags)",
          "new_text": null,
          "old_line_content": "    int64_t ret  = av_index_search_timestamp(st, timestamp, flags);",
          "new_line_content": "    AVIndexEntry *ie, ie1;",
          "content_same": false
        },
        {
          "line": 166,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(s, AV_LOG_DEBUG, \"pad %d %d\\n\", mp3->start_pad, mp3->  end_pad)",
          "new_text": null,
          "old_line_content": "            av_log(s, AV_LOG_DEBUG, \"pad %d %d\\n\", mp3->start_pad, mp3->  end_pad);",
          "new_line_content": "            mp3->  end_pad = v&4095;",
          "content_same": false
        },
        {
          "line": 294,
          "old_api": "avio_size",
          "new_api": null,
          "old_text": "avio_size(s->pb)",
          "new_text": null,
          "old_line_content": "        int64_t filesize = avio_size(s->pb);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 171,
          "old_api": "avio_seek",
          "new_api": null,
          "old_text": "avio_seek(s->pb, base + 4 + 32, SEEK_SET)",
          "new_text": null,
          "old_line_content": "    avio_seek(s->pb, base + 4 + 32, SEEK_SET);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 172,
          "old_api": "avio_rb32",
          "new_api": null,
          "old_text": "avio_rb32(s->pb)",
          "new_text": null,
          "old_line_content": "    v = avio_rb32(s->pb);",
          "new_line_content": "    /* Check for VBRI tag (always 32 bytes after end of mpegaudio header) */",
          "content_same": false
        },
        {
          "line": 299,
          "old_api": "av_rescale",
          "new_api": null,
          "old_text": "av_rescale(st->duration, filesize, mp3->header_filesize - s->data_offset)",
          "new_text": null,
          "old_line_content": "        duration = av_rescale(st->duration, filesize, mp3->header_filesize - s->data_offset);",
          "new_line_content": "            filesize = mp3->header_filesize;",
          "content_same": false
        },
        {
          "line": 178,
          "old_api": "avio_rb32",
          "new_api": null,
          "old_text": "avio_rb32(s->pb)",
          "new_text": null,
          "old_line_content": "            size = avio_rb32(s->pb);",
          "new_line_content": "            /* skip delay and quality */",
          "content_same": false
        },
        {
          "line": 187,
          "old_api": "avio_seek",
          "new_api": null,
          "old_text": "avio_seek(s->pb, base + vbrtag_size, SEEK_SET)",
          "new_text": null,
          "old_line_content": "    avio_seek(s->pb, base + vbrtag_size, SEEK_SET);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 315,
          "old_api": "avio_seek",
          "new_api": null,
          "old_text": "avio_seek(s->pb, ie->pos, SEEK_SET)",
          "new_text": null,
          "old_line_content": "    ret = avio_seek(s->pb, ie->pos, SEEK_SET);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 190,
          "old_api": "av_rescale_q",
          "new_api": null,
          "old_text": "av_rescale_q(frames, (AVRational){spf, c.sample_rate},\n                                    st->time_base)",
          "new_text": null,
          "old_line_content": "        st->duration = av_rescale_q(frames, (AVRational){spf, c.sample_rate},",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 193,
          "old_api": "av_rescale",
          "new_api": null,
          "old_text": "av_rescale(size, 8 * c.sample_rate, frames * (int64_t)spf)",
          "new_text": null,
          "old_line_content": "        st->codec->bit_rate = av_rescale(size, 8 * c.sample_rate, frames * (int64_t)spf);",
          "new_line_content": "                                    st->time_base);",
          "content_same": false
        },
        {
          "line": 323,
          "old_api": "check",
          "new_api": null,
          "old_text": "check(s, pos)",
          "new_text": null,
          "old_line_content": "            ret = check(s, pos);",
          "new_line_content": "        int64_t pos = ie->pos + i*dir;",
          "content_same": false
        },
        {
          "line": 72,
          "old_api": "AV_RB32",
          "new_api": null,
          "old_text": "AV_RB32(buf2)",
          "new_text": null,
          "old_line_content": "            header = AV_RB32(buf2);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 73,
          "old_api": "avpriv_mpa_decode_header",
          "new_api": null,
          "old_text": "avpriv_mpa_decode_header(&avctx, header, &sample_rate, &sample_rate, &sample_rate, &sample_rate)",
          "new_text": null,
          "old_line_content": "            fsize = avpriv_mpa_decode_header(&avctx, header, &sample_rate, &sample_rate, &sample_rate, &sample_rate);",
          "new_line_content": "        for(frames = 0; buf2 < end; frames++) {",
          "content_same": false
        },
        {
          "line": 78,
          "old_api": "FFMAX",
          "new_api": null,
          "old_text": "FFMAX(max_frames, frames)",
          "new_text": null,
          "old_line_content": "        max_frames = FFMAX(max_frames, frames);",
          "new_line_content": "            buf2 += fsize;",
          "content_same": false
        },
        {
          "line": 207,
          "old_api": "avformat_new_stream",
          "new_api": null,
          "old_text": "avformat_new_stream(s, NULL)",
          "new_text": null,
          "old_line_content": "    st = avformat_new_stream(s, NULL);",
          "new_line_content": "    int64_t off;",
          "content_same": false
        },
        {
          "line": 334,
          "old_api": "avio_seek",
          "new_api": null,
          "old_text": "avio_seek(s->pb, ie->pos + i*dir, SEEK_SET)",
          "new_text": null,
          "old_line_content": "    ret = avio_seek(s->pb, ie->pos + i*dir, SEEK_SET);",
          "new_line_content": "        i=0;",
          "content_same": false
        },
        {
          "line": 337,
          "old_api": "ff_update_cur_dts",
          "new_api": null,
          "old_text": "ff_update_cur_dts(s, st, ie->timestamp)",
          "new_text": null,
          "old_line_content": "    ff_update_cur_dts(s, st, ie->timestamp);",
          "new_line_content": "    if (ret < 0)",
          "content_same": false
        },
        {
          "line": 87,
          "old_api": "ff_id3v2_tag_len",
          "new_api": null,
          "old_text": "ff_id3v2_tag_len(buf0)",
          "new_text": null,
          "old_line_content": "    else if(ff_id3v2_match(buf0, ID3v2_DEFAULT_MAGIC) && 2*ff_id3v2_tag_len(buf0) >= p->buf_size)",
          "new_line_content": "    else if(max_frames>200)return AVPROBE_SCORE_EXTENSION;",
          "content_same": false
        },
        {
          "line": 343,
          "old_api": "offsetof",
          "new_api": null,
          "old_text": "offsetof(MP3DecContext, usetoc)",
          "new_text": null,
          "old_line_content": "    { \"usetoc\", \"use table of contents\", offsetof(MP3DecContext, usetoc), AV_OPT_TYPE_INT, {.i64 = -1}, -1, 1, AV_OPT_FLAG_DECODING_PARAM},",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 217,
          "old_api": "avpriv_set_pts_info",
          "new_api": null,
          "old_text": "avpriv_set_pts_info(st, 64, 1, 14112000)",
          "new_text": null,
          "old_line_content": "    avpriv_set_pts_info(st, 64, 1, 14112000);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 220,
          "old_api": "avio_tell",
          "new_api": null,
          "old_text": "avio_tell(s->pb)",
          "new_text": null,
          "old_line_content": "    off = avio_tell(s->pb);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 223,
          "old_api": "ff_id3v1_read",
          "new_api": null,
          "old_text": "ff_id3v1_read(s)",
          "new_text": null,
          "old_line_content": "        ff_id3v1_read(s);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 226,
          "old_api": "avio_size",
          "new_api": null,
          "old_text": "avio_size(s->pb)",
          "new_text": null,
          "old_line_content": "        mp3->filesize = avio_size(s->pb);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 101,
          "old_api": "avio_size",
          "new_api": null,
          "old_text": "avio_size(s->pb)",
          "new_text": null,
          "old_line_content": "        !(filesize = avio_size(s->pb))) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 102,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(s, AV_LOG_WARNING, \"Cannot determine file size, skipping TOC table.\\n\")",
          "new_text": null,
          "old_line_content": "        av_log(s, AV_LOG_WARNING, \"Cannot determine file size, skipping TOC table.\\n\");",
          "new_line_content": "    if (!filesize &&",
          "content_same": false
        },
        {
          "line": 229,
          "old_api": "avio_seek",
          "new_api": null,
          "old_text": "avio_seek(s->pb, off, SEEK_SET)",
          "new_text": null,
          "old_line_content": "        avio_seek(s->pb, off, SEEK_SET);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 357,
          "old_api": "NULL_IF_CONFIG_SMALL",
          "new_api": null,
          "old_text": "NULL_IF_CONFIG_SMALL(\"MP2/3 (MPEG audio layer 2/3)\")",
          "new_text": null,
          "old_line_content": "    .long_name      = NULL_IF_CONFIG_SMALL(\"MP2/3 (MPEG audio layer 2/3)\"),",
          "new_line_content": "AVInputFormat ff_mp3_demuxer = {",
          "content_same": false
        },
        {
          "line": 107,
          "old_api": "avio_r8",
          "new_api": null,
          "old_text": "avio_r8(s->pb)",
          "new_text": null,
          "old_line_content": "        uint8_t b = avio_r8(s->pb);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 110,
          "old_api": "av_rescale",
          "new_api": null,
          "old_text": "av_rescale(b, filesize, 256)",
          "new_text": null,
          "old_line_content": "                           av_rescale(b, filesize, 256),",
          "new_line_content": "        if (fill_index)",
          "content_same": false
        },
        {
          "line": 244,
          "old_api": "avio_tell",
          "new_api": null,
          "old_text": "avio_tell(s->pb)",
          "new_text": null,
          "old_line_content": "    pos = avio_tell(s->pb);",
          "new_line_content": "",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 21,
      "total_additions": 43,
      "total_deletions": 42,
      "total_api_changes": 106
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 2,
        "api_related_lines": 106,
        "non_api_lines": 1,
        "non_api_line_numbers": [
          71
        ]
      }
    },
    "api_calls_before": 68,
    "api_calls_after": 70,
    "diff_info": {
      "added_lines": 2,
      "removed_lines": 0,
      "total_diff_lines": 14
    }
  }
}