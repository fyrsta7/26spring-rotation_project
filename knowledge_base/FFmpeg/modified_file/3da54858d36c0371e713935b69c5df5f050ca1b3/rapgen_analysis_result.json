{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/3da54858d36c0371e713935b69c5df5f050ca1b3",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/3da54858d36c0371e713935b69c5df5f050ca1b3/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/3da54858d36c0371e713935b69c5df5f050ca1b3/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/3da54858d36c0371e713935b69c5df5f050ca1b3/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 290,
          "old_api": "av_frame_copy_props",
          "new_api": "ff_get_video_buffer",
          "old_text": "av_frame_copy_props(outpic, inpic)",
          "new_text": "ff_get_video_buffer(outlink, outlink->w, outlink->h)",
          "old_line_content": "    av_frame_copy_props(outpic, inpic);",
          "new_line_content": "    outpic = ff_get_video_buffer(outlink, outlink->w, outlink->h);",
          "content_same": false
        },
        {
          "line": 293,
          "old_api": "TS2T",
          "new_api": "AVERROR",
          "old_text": "TS2T(inpic->pts, inlink->time_base)",
          "new_text": "AVERROR(ENOMEM)",
          "old_line_content": "        hue->var_values[VAR_T]   = TS2T(inpic->pts, inlink->time_base);",
          "new_line_content": "        return AVERROR(ENOMEM);",
          "content_same": false
        },
        {
          "line": 300,
          "old_api": "av_clip",
          "new_api": "TS2D",
          "old_text": "av_clip(hue->saturation, SAT_MIN_VAL, SAT_MAX_VAL)",
          "new_text": "TS2D(inpic->pts)",
          "old_line_content": "                hue->saturation = av_clip(hue->saturation, SAT_MIN_VAL, SAT_MAX_VAL);",
          "new_line_content": "        hue->var_values[VAR_PTS] = TS2D(inpic->pts);",
          "content_same": false
        },
        {
          "line": 314,
          "old_api": "av_log",
          "new_api": "av_expr_eval",
          "old_text": "av_log(inlink->dst, AV_LOG_DEBUG,\n               \"H:%0.1f s:%0.f t:%0.1f n:%d\\n\",\n               hue->hue, hue->saturation,\n               hue->var_values[VAR_T], (int)hue->var_values[VAR_N])",
          "new_text": "av_expr_eval(hue->hue_deg_pexpr, hue->var_values, NULL)",
          "old_line_content": "        av_log(inlink->dst, AV_LOG_DEBUG,",
          "new_line_content": "            hue->hue_deg = av_expr_eval(hue->hue_deg_pexpr, hue->var_values, NULL);",
          "content_same": false
        },
        {
          "line": 341,
          "old_api": "set_options",
          "new_api": "av_frame_free",
          "old_text": "set_options(ctx, args)",
          "new_text": "av_frame_free(&inpic)",
          "old_line_content": "        return set_options(ctx, args);",
          "new_line_content": "    av_frame_free(&inpic);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 320,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(inlink->dst, AV_LOG_DEBUG,\n               \"H:%0.1f s:%0.f t:%0.1f n:%d\\n\",\n               hue->hue, hue->saturation,\n               hue->var_values[VAR_T], (int)hue->var_values[VAR_N])",
          "old_line_content": "    }",
          "new_line_content": "        av_log(inlink->dst, AV_LOG_DEBUG,",
          "content_same": false
        },
        {
          "line": 292,
          "old_api": null,
          "new_api": "av_frame_free",
          "old_text": null,
          "new_text": "av_frame_free(&inpic)",
          "old_line_content": "    if (!hue->flat_syntax) {",
          "new_line_content": "        av_frame_free(&inpic);",
          "content_same": false
        },
        {
          "line": 325,
          "old_api": null,
          "new_api": "compute_sin_and_cos",
          "old_text": null,
          "new_text": "compute_sin_and_cos(hue)",
          "old_line_content": "                        inpic->data[0],  inpic->linesize[0],",
          "new_line_content": "        compute_sin_and_cos(hue);",
          "content_same": false
        },
        {
          "line": 295,
          "old_api": null,
          "new_api": "av_frame_copy_props",
          "old_text": null,
          "new_text": "av_frame_copy_props(outpic, inpic)",
          "old_line_content": "",
          "new_line_content": "    av_frame_copy_props(outpic, inpic);",
          "content_same": false
        },
        {
          "line": 299,
          "old_api": null,
          "new_api": "TS2T",
          "old_text": null,
          "new_text": "TS2T(inpic->pts, inlink->time_base)",
          "old_line_content": "            if (hue->saturation < SAT_MIN_VAL || hue->saturation > SAT_MAX_VAL) {",
          "new_line_content": "        hue->var_values[VAR_T]   = TS2T(inpic->pts, inlink->time_base);",
          "content_same": false
        },
        {
          "line": 331,
          "old_api": null,
          "new_api": "av_image_copy_plane",
          "old_text": null,
          "new_text": "av_image_copy_plane(outpic->data[0], outpic->linesize[0],\n                        inpic->data[0],  inpic->linesize[0],\n                        inlink->w, inlink->h)",
          "old_line_content": "                        hue->hue_cos, hue->hue_sin);",
          "new_line_content": "    av_image_copy_plane(outpic->data[0], outpic->linesize[0],",
          "content_same": false
        },
        {
          "line": 349,
          "old_api": null,
          "new_api": "set_options",
          "old_text": null,
          "new_text": "set_options(ctx, args)",
          "old_line_content": "        .type         = AVMEDIA_TYPE_VIDEO,",
          "new_line_content": "        return set_options(ctx, args);",
          "content_same": false
        },
        {
          "line": 303,
          "old_api": null,
          "new_api": "av_expr_eval",
          "old_text": null,
          "new_text": "av_expr_eval(hue->saturation_pexpr, hue->var_values, NULL)",
          "old_line_content": "                       SAT_MIN_VAL, SAT_MAX_VAL, hue->saturation);",
          "new_line_content": "            hue->saturation = av_expr_eval(hue->saturation_pexpr, hue->var_values, NULL);",
          "content_same": false
        },
        {
          "line": 335,
          "old_api": null,
          "new_api": "process_chrominance",
          "old_text": null,
          "new_text": "process_chrominance(outpic->data[1], outpic->data[2], outpic->linesize[1],\n                        inpic->data[1],  inpic->data[2],  inpic->linesize[1],\n                        inlink->w >> hue->hsub, inlink->h >> hue->vsub,\n                        hue->hue_cos, hue->hue_sin)",
          "old_line_content": "}",
          "new_line_content": "    process_chrominance(outpic->data[1], outpic->data[2], outpic->linesize[1],",
          "content_same": false
        },
        {
          "line": 306,
          "old_api": null,
          "new_api": "av_clip",
          "old_text": null,
          "new_text": "av_clip(hue->saturation, SAT_MIN_VAL, SAT_MAX_VAL)",
          "old_line_content": "",
          "new_line_content": "                hue->saturation = av_clip(hue->saturation, SAT_MIN_VAL, SAT_MAX_VAL);",
          "content_same": false
        },
        {
          "line": 307,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(inlink->dst, AV_LOG_WARNING,\n                       \"Saturation value not in range [%d,%d]: clipping value to %0.1f\\n\",\n                       SAT_MIN_VAL, SAT_MAX_VAL, hue->saturation)",
          "old_line_content": "        if (hue->hue_deg_expr) {",
          "new_line_content": "                av_log(inlink->dst, AV_LOG_WARNING,",
          "content_same": false
        },
        {
          "line": 342,
          "old_api": null,
          "new_api": "ff_filter_frame",
          "old_text": null,
          "new_text": "ff_filter_frame(outlink, outpic)",
          "old_line_content": "    else",
          "new_line_content": "    return ff_filter_frame(outlink, outpic);",
          "content_same": false
        },
        {
          "line": 374,
          "old_api": null,
          "new_api": "NULL_IF_CONFIG_SMALL",
          "old_text": null,
          "new_text": "NULL_IF_CONFIG_SMALL(\"Adjust the hue and saturation of the input video.\")",
          "old_line_content": "    .inputs          = hue_inputs,",
          "new_line_content": "    .description = NULL_IF_CONFIG_SMALL(\"Adjust the hue and saturation of the input video.\"),",
          "content_same": false
        },
        {
          "line": 348,
          "old_api": null,
          "new_api": "strcmp",
          "old_text": null,
          "new_text": "strcmp(cmd, \"reinit\")",
          "old_line_content": "        .name         = \"default\",",
          "new_line_content": "    if (!strcmp(cmd, \"reinit\"))",
          "content_same": false
        },
        {
          "line": 317,
          "old_api": null,
          "new_api": "av_expr_eval",
          "old_text": null,
          "new_text": "av_expr_eval(hue->hue_pexpr, hue->var_values, NULL)",
          "old_line_content": "               hue->var_values[VAR_T], (int)hue->var_values[VAR_N]);",
          "new_line_content": "            hue->hue = av_expr_eval(hue->hue_pexpr, hue->var_values, NULL);",
          "content_same": false
        },
        {
          "line": 286,
          "old_api": null,
          "new_api": "av_frame_is_writable",
          "old_text": null,
          "new_text": "av_frame_is_writable(inpic)",
          "old_line_content": "    if (!outpic) {",
          "new_line_content": "    if (av_frame_is_writable(inpic)) {",
          "content_same": false
        },
        {
          "line": 351,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(ENOSYS)",
          "old_line_content": "        .config_props = config_props,",
          "new_line_content": "        return AVERROR(ENOSYS);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 288,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(ENOMEM)",
          "new_text": null,
          "old_line_content": "        return AVERROR(ENOMEM);",
          "new_line_content": "        outpic = inpic;",
          "content_same": false
        },
        {
          "line": 324,
          "old_api": "av_image_copy_plane",
          "new_api": null,
          "old_text": "av_image_copy_plane(outpic->data[0], outpic->linesize[0],\n                        inpic->data[0],  inpic->linesize[0],\n                        inlink->w, inlink->h)",
          "new_text": null,
          "old_line_content": "    av_image_copy_plane(outpic->data[0], outpic->linesize[0],",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 319,
          "old_api": "compute_sin_and_cos",
          "new_api": null,
          "old_text": "compute_sin_and_cos(hue)",
          "new_text": null,
          "old_line_content": "        compute_sin_and_cos(hue);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 294,
          "old_api": "TS2D",
          "new_api": null,
          "old_text": "TS2D(inpic->pts)",
          "new_text": null,
          "old_line_content": "        hue->var_values[VAR_PTS] = TS2D(inpic->pts);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 328,
          "old_api": "process_chrominance",
          "new_api": null,
          "old_text": "process_chrominance(outpic->data[1], outpic->data[2], outpic->linesize[1],\n                        inpic->data[1],  inpic->data[2],  inpic->linesize[1],\n                        inlink->w >> hue->hsub, inlink->h >> hue->vsub,\n                        hue->hue_cos, hue->hue_sin)",
          "new_text": null,
          "old_line_content": "    process_chrominance(outpic->data[1], outpic->data[2], outpic->linesize[1],",
          "new_line_content": "    hue->var_values[VAR_N] += 1;",
          "content_same": false
        },
        {
          "line": 297,
          "old_api": "av_expr_eval",
          "new_api": null,
          "old_text": "av_expr_eval(hue->saturation_pexpr, hue->var_values, NULL)",
          "new_text": null,
          "old_line_content": "            hue->saturation = av_expr_eval(hue->saturation_pexpr, hue->var_values, NULL);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 301,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(inlink->dst, AV_LOG_WARNING,\n                       \"Saturation value not in range [%d,%d]: clipping value to %0.1f\\n\",\n                       SAT_MIN_VAL, SAT_MAX_VAL, hue->saturation)",
          "new_text": null,
          "old_line_content": "                av_log(inlink->dst, AV_LOG_WARNING,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 333,
          "old_api": "av_frame_free",
          "new_api": null,
          "old_text": "av_frame_free(&inpic)",
          "new_text": null,
          "old_line_content": "    av_frame_free(&inpic);",
          "new_line_content": "                        inlink->w, inlink->h);",
          "content_same": false
        },
        {
          "line": 334,
          "old_api": "ff_filter_frame",
          "new_api": null,
          "old_text": "ff_filter_frame(outlink, outpic)",
          "new_text": null,
          "old_line_content": "    return ff_filter_frame(outlink, outpic);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 366,
          "old_api": "NULL_IF_CONFIG_SMALL",
          "new_api": null,
          "old_text": "NULL_IF_CONFIG_SMALL(\"Adjust the hue and saturation of the input video.\")",
          "new_text": null,
          "old_line_content": "    .description = NULL_IF_CONFIG_SMALL(\"Adjust the hue and saturation of the input video.\"),",
          "new_line_content": "        .name = \"default\",",
          "content_same": false
        },
        {
          "line": 308,
          "old_api": "av_expr_eval",
          "new_api": null,
          "old_text": "av_expr_eval(hue->hue_deg_pexpr, hue->var_values, NULL)",
          "new_text": null,
          "old_line_content": "            hue->hue_deg = av_expr_eval(hue->hue_deg_pexpr, hue->var_values, NULL);",
          "new_line_content": "                       \"Saturation value not in range [%d,%d]: clipping value to %0.1f\\n\",",
          "content_same": false
        },
        {
          "line": 340,
          "old_api": "strcmp",
          "new_api": null,
          "old_text": "strcmp(cmd, \"reinit\")",
          "new_text": null,
          "old_line_content": "    if (!strcmp(cmd, \"reinit\"))",
          "new_line_content": "    if (!direct)",
          "content_same": false
        },
        {
          "line": 311,
          "old_api": "av_expr_eval",
          "new_api": null,
          "old_text": "av_expr_eval(hue->hue_pexpr, hue->var_values, NULL)",
          "new_text": null,
          "old_line_content": "            hue->hue = av_expr_eval(hue->hue_pexpr, hue->var_values, NULL);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 285,
          "old_api": "ff_get_video_buffer",
          "new_api": null,
          "old_text": "ff_get_video_buffer(outlink, outlink->w, outlink->h)",
          "new_text": null,
          "old_line_content": "    outpic = ff_get_video_buffer(outlink, outlink->w, outlink->h);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 343,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(ENOSYS)",
          "new_text": null,
          "old_line_content": "        return AVERROR(ENOSYS);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 287,
          "old_api": "av_frame_free",
          "new_api": null,
          "old_text": "av_frame_free(&inpic)",
          "new_text": null,
          "old_line_content": "        av_frame_free(&inpic);",
          "new_line_content": "        direct = 1;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 5,
      "total_additions": 17,
      "total_deletions": 16,
      "total_api_changes": 38
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 8,
        "api_related_lines": 38,
        "non_api_lines": 4,
        "non_api_line_numbers": [
          296,
          289,
          330,
          284
        ]
      }
    },
    "api_calls_before": 53,
    "api_calls_after": 54,
    "diff_info": {
      "added_lines": 8,
      "removed_lines": 0,
      "total_diff_lines": 41
    }
  }
}