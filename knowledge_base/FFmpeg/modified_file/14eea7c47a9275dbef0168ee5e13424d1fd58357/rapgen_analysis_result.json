{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/14eea7c47a9275dbef0168ee5e13424d1fd58357",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/14eea7c47a9275dbef0168ee5e13424d1fd58357/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/14eea7c47a9275dbef0168ee5e13424d1fd58357/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/14eea7c47a9275dbef0168ee5e13424d1fd58357/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 92,
          "old_api": "strcmp",
          "new_api": "pnm_get",
          "old_text": "strcmp(buf1, \"WIDTH\")",
          "new_text": "pnm_get(s, buf1, sizeof(buf1))",
          "old_line_content": "            if (!strcmp(buf1, \"WIDTH\")) {",
          "new_line_content": "            pnm_get(s, buf1, sizeof(buf1));",
          "content_same": false
        },
        {
          "line": 93,
          "old_api": "pnm_get",
          "new_api": "strcmp",
          "old_text": "pnm_get(s, buf1, sizeof(buf1))",
          "new_text": "strcmp(buf1, \"WIDTH\")",
          "old_line_content": "                pnm_get(s, buf1, sizeof(buf1));",
          "new_line_content": "            if (!strcmp(buf1, \"WIDTH\")) {",
          "content_same": false
        },
        {
          "line": 94,
          "old_api": "strtol",
          "new_api": "pnm_get",
          "old_text": "strtol(buf1, NULL, 10)",
          "new_text": "pnm_get(s, buf1, sizeof(buf1))",
          "old_line_content": "                w = strtol(buf1, NULL, 10);",
          "new_line_content": "                pnm_get(s, buf1, sizeof(buf1));",
          "content_same": false
        },
        {
          "line": 95,
          "old_api": "strcmp",
          "new_api": "strtol",
          "old_text": "strcmp(buf1, \"HEIGHT\")",
          "new_text": "strtol(buf1, NULL, 10)",
          "old_line_content": "            } else if (!strcmp(buf1, \"HEIGHT\")) {",
          "new_line_content": "                w = strtol(buf1, NULL, 10);",
          "content_same": false
        },
        {
          "line": 96,
          "old_api": "pnm_get",
          "new_api": "strcmp",
          "old_text": "pnm_get(s, buf1, sizeof(buf1))",
          "new_text": "strcmp(buf1, \"HEIGHT\")",
          "old_line_content": "                pnm_get(s, buf1, sizeof(buf1));",
          "new_line_content": "            } else if (!strcmp(buf1, \"HEIGHT\")) {",
          "content_same": false
        },
        {
          "line": 97,
          "old_api": "strtol",
          "new_api": "pnm_get",
          "old_text": "strtol(buf1, NULL, 10)",
          "new_text": "pnm_get(s, buf1, sizeof(buf1))",
          "old_line_content": "                h = strtol(buf1, NULL, 10);",
          "new_line_content": "                pnm_get(s, buf1, sizeof(buf1));",
          "content_same": false
        },
        {
          "line": 98,
          "old_api": "strcmp",
          "new_api": "strtol",
          "old_text": "strcmp(buf1, \"DEPTH\")",
          "new_text": "strtol(buf1, NULL, 10)",
          "old_line_content": "            } else if (!strcmp(buf1, \"DEPTH\")) {",
          "new_line_content": "                h = strtol(buf1, NULL, 10);",
          "content_same": false
        },
        {
          "line": 99,
          "old_api": "pnm_get",
          "new_api": "strcmp",
          "old_text": "pnm_get(s, buf1, sizeof(buf1))",
          "new_text": "strcmp(buf1, \"DEPTH\")",
          "old_line_content": "                pnm_get(s, buf1, sizeof(buf1));",
          "new_line_content": "            } else if (!strcmp(buf1, \"DEPTH\")) {",
          "content_same": false
        },
        {
          "line": 100,
          "old_api": "strtol",
          "new_api": "pnm_get",
          "old_text": "strtol(buf1, NULL, 10)",
          "new_text": "pnm_get(s, buf1, sizeof(buf1))",
          "old_line_content": "                depth = strtol(buf1, NULL, 10);",
          "new_line_content": "                pnm_get(s, buf1, sizeof(buf1));",
          "content_same": false
        },
        {
          "line": 101,
          "old_api": "strcmp",
          "new_api": "strtol",
          "old_text": "strcmp(buf1, \"MAXVAL\")",
          "new_text": "strtol(buf1, NULL, 10)",
          "old_line_content": "            } else if (!strcmp(buf1, \"MAXVAL\")) {",
          "new_line_content": "                depth = strtol(buf1, NULL, 10);",
          "content_same": false
        },
        {
          "line": 102,
          "old_api": "pnm_get",
          "new_api": "strcmp",
          "old_text": "pnm_get(s, buf1, sizeof(buf1))",
          "new_text": "strcmp(buf1, \"MAXVAL\")",
          "old_line_content": "                pnm_get(s, buf1, sizeof(buf1));",
          "new_line_content": "            } else if (!strcmp(buf1, \"MAXVAL\")) {",
          "content_same": false
        },
        {
          "line": 103,
          "old_api": "strtol",
          "new_api": "pnm_get",
          "old_text": "strtol(buf1, NULL, 10)",
          "new_text": "pnm_get(s, buf1, sizeof(buf1))",
          "old_line_content": "                maxval = strtol(buf1, NULL, 10);",
          "new_line_content": "                pnm_get(s, buf1, sizeof(buf1));",
          "content_same": false
        },
        {
          "line": 104,
          "old_api": "strcmp",
          "new_api": "strtol",
          "old_text": "strcmp(buf1, \"TUPLTYPE\")",
          "new_text": "strtol(buf1, NULL, 10)",
          "old_line_content": "            } else if (!strcmp(buf1, \"TUPLTYPE\") ||",
          "new_line_content": "                maxval = strtol(buf1, NULL, 10);",
          "content_same": false
        },
        {
          "line": 107,
          "old_api": "pnm_get",
          "new_api": "strcmp",
          "old_text": "pnm_get(s, tuple_type, sizeof(tuple_type))",
          "new_text": "strcmp(buf1, \"TUPLETYPE\")",
          "old_line_content": "                pnm_get(s, tuple_type, sizeof(tuple_type));",
          "new_line_content": "                       !strcmp(buf1, \"TUPLETYPE\")) {",
          "content_same": false
        },
        {
          "line": 108,
          "old_api": "strcmp",
          "new_api": "pnm_get",
          "old_text": "strcmp(buf1, \"ENDHDR\")",
          "new_text": "pnm_get(s, tuple_type, sizeof(tuple_type))",
          "old_line_content": "            } else if (!strcmp(buf1, \"ENDHDR\")) {",
          "new_line_content": "                pnm_get(s, tuple_type, sizeof(tuple_type));",
          "content_same": false
        },
        {
          "line": 157,
          "old_api": "atoi",
          "new_api": "pnm_get",
          "old_text": "atoi(buf1)",
          "new_text": "pnm_get(s, buf1, sizeof(buf1))",
          "old_line_content": "    w = atoi(buf1);",
          "new_line_content": "    pnm_get(s, buf1, sizeof(buf1));",
          "content_same": false
        },
        {
          "line": 158,
          "old_api": "pnm_get",
          "new_api": "atoi",
          "old_text": "pnm_get(s, buf1, sizeof(buf1))",
          "new_text": "atoi(buf1)",
          "old_line_content": "    pnm_get(s, buf1, sizeof(buf1));",
          "new_line_content": "    w = atoi(buf1);",
          "content_same": false
        },
        {
          "line": 159,
          "old_api": "atoi",
          "new_api": "pnm_get",
          "old_text": "atoi(buf1)",
          "new_text": "pnm_get(s, buf1, sizeof(buf1))",
          "old_line_content": "    h = atoi(buf1);",
          "new_line_content": "    pnm_get(s, buf1, sizeof(buf1));",
          "content_same": false
        },
        {
          "line": 160,
          "old_api": "av_image_check_size",
          "new_api": "atoi",
          "old_text": "av_image_check_size(w, h, 0, avctx)",
          "new_text": "atoi(buf1)",
          "old_line_content": "    if(w <= 0 || h <= 0 || av_image_check_size(w, h, 0, avctx) || s->bytestream >= s->bytestream_end)",
          "new_line_content": "    h = atoi(buf1);",
          "content_same": false
        },
        {
          "line": 169,
          "old_api": "atoi",
          "new_api": "pnm_get",
          "old_text": "atoi(buf1)",
          "new_text": "pnm_get(s, buf1, sizeof(buf1))",
          "old_line_content": "        s->maxval = atoi(buf1);",
          "new_line_content": "        pnm_get(s, buf1, sizeof(buf1));",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 161,
          "old_api": null,
          "new_api": "av_image_check_size",
          "old_text": null,
          "new_text": "av_image_check_size(w, h, 0, avctx)",
          "old_line_content": "        return AVERROR_INVALIDDATA;",
          "new_line_content": "    if(w <= 0 || h <= 0 || av_image_check_size(w, h, 0, avctx) || s->bytestream >= s->bytestream_end)",
          "content_same": false
        },
        {
          "line": 164,
          "old_api": null,
          "new_api": "ff_set_dimensions",
          "old_text": null,
          "new_text": "ff_set_dimensions(avctx, w, h)",
          "old_line_content": "    if (ret < 0)",
          "new_line_content": "    ret = ff_set_dimensions(avctx, w, h);",
          "content_same": false
        },
        {
          "line": 196,
          "old_api": null,
          "new_api": "av_pix_fmt_desc_get",
          "old_text": null,
          "new_text": "av_pix_fmt_desc_get(avctx->pix_fmt)",
          "old_line_content": "        if ((avctx->width & 1) != 0)",
          "new_line_content": "    if (av_pix_fmt_desc_get(avctx->pix_fmt)->flags & AV_PIX_FMT_FLAG_PLANAR) {",
          "content_same": false
        },
        {
          "line": 71,
          "old_api": null,
          "new_api": "pnm_get",
          "old_text": null,
          "new_text": "pnm_get(s, buf1, sizeof(buf1))",
          "old_line_content": "    if(buf1[0] != 'P')",
          "new_line_content": "    pnm_get(s, buf1, sizeof(buf1));",
          "content_same": false
        },
        {
          "line": 105,
          "old_api": null,
          "new_api": "strcmp",
          "old_text": null,
          "new_text": "strcmp(buf1, \"TUPLTYPE\")",
          "old_line_content": "                       /* libavcodec used to write invalid files */",
          "new_line_content": "            } else if (!strcmp(buf1, \"TUPLTYPE\") ||",
          "content_same": false
        },
        {
          "line": 170,
          "old_api": null,
          "new_api": "atoi",
          "old_text": null,
          "new_text": "atoi(buf1)",
          "old_line_content": "        if (s->maxval <= 0 || s->maxval > UINT16_MAX) {",
          "new_line_content": "        s->maxval = atoi(buf1);",
          "content_same": false
        },
        {
          "line": 172,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(avctx, AV_LOG_ERROR, \"Invalid maxval: %d\\n\", s->maxval)",
          "old_line_content": "            s->maxval = 255;",
          "new_line_content": "            av_log(avctx, AV_LOG_ERROR, \"Invalid maxval: %d\\n\", s->maxval);",
          "content_same": false
        },
        {
          "line": 109,
          "old_api": null,
          "new_api": "strcmp",
          "old_text": null,
          "new_text": "strcmp(buf1, \"ENDHDR\")",
          "old_line_content": "                break;",
          "new_line_content": "            } else if (!strcmp(buf1, \"ENDHDR\")) {",
          "content_same": false
        },
        {
          "line": 188,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(avctx, AV_LOG_ERROR, \"Unsupported pixel format\\n\")",
          "old_line_content": "                avctx->pix_fmt = AV_PIX_FMT_NONE;",
          "new_line_content": "                av_log(avctx, AV_LOG_ERROR, \"Unsupported pixel format\\n\");",
          "content_same": false
        },
        {
          "line": 117,
          "old_api": null,
          "new_api": "av_image_check_size",
          "old_text": null,
          "new_text": "av_image_check_size(w, h, 0, avctx)",
          "old_line_content": "            return AVERROR_INVALIDDATA;",
          "new_line_content": "            av_image_check_size(w, h, 0, avctx) || s->bytestream >= s->bytestream_end)",
          "content_same": false
        },
        {
          "line": 120,
          "old_api": null,
          "new_api": "ff_set_dimensions",
          "old_text": null,
          "new_text": "ff_set_dimensions(avctx, w, h)",
          "old_line_content": "        if (ret < 0)",
          "new_line_content": "        ret = ff_set_dimensions(avctx, w, h);",
          "content_same": false
        },
        {
          "line": 60,
          "old_api": null,
          "new_api": "pnm_space",
          "old_text": null,
          "new_text": "pnm_space(c)",
          "old_line_content": "    *s = '\\0';",
          "new_line_content": "    while (bs < end && !pnm_space(c))",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 163,
          "old_api": "ff_set_dimensions",
          "new_api": null,
          "old_text": "ff_set_dimensions(avctx, w, h)",
          "new_text": null,
          "old_line_content": "    ret = ff_set_dimensions(avctx, w, h);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 195,
          "old_api": "av_pix_fmt_desc_get",
          "new_api": null,
          "old_text": "av_pix_fmt_desc_get(avctx->pix_fmt)",
          "new_text": null,
          "old_line_content": "    if (av_pix_fmt_desc_get(avctx->pix_fmt)->flags & AV_PIX_FMT_FLAG_PLANAR) {",
          "new_line_content": "    /* more check if YUV420 */",
          "content_same": false
        },
        {
          "line": 70,
          "old_api": "pnm_get",
          "new_api": null,
          "old_text": "pnm_get(s, buf1, sizeof(buf1))",
          "new_text": null,
          "old_line_content": "    pnm_get(s, buf1, sizeof(buf1));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 168,
          "old_api": "pnm_get",
          "new_api": null,
          "old_text": "pnm_get(s, buf1, sizeof(buf1))",
          "new_text": null,
          "old_line_content": "        pnm_get(s, buf1, sizeof(buf1));",
          "new_line_content": "    if (avctx->pix_fmt != AV_PIX_FMT_MONOWHITE && avctx->pix_fmt != AV_PIX_FMT_MONOBLACK) {",
          "content_same": false
        },
        {
          "line": 91,
          "old_api": "pnm_get",
          "new_api": null,
          "old_text": "pnm_get(s, buf1, sizeof(buf1))",
          "new_text": null,
          "old_line_content": "            pnm_get(s, buf1, sizeof(buf1));",
          "new_line_content": "        for (;;) {",
          "content_same": false
        },
        {
          "line": 171,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(avctx, AV_LOG_ERROR, \"Invalid maxval: %d\\n\", s->maxval)",
          "new_text": null,
          "old_line_content": "            av_log(avctx, AV_LOG_ERROR, \"Invalid maxval: %d\\n\", s->maxval);",
          "new_line_content": "        if (s->maxval <= 0 || s->maxval > UINT16_MAX) {",
          "content_same": false
        },
        {
          "line": 106,
          "old_api": "strcmp",
          "new_api": null,
          "old_text": "strcmp(buf1, \"TUPLETYPE\")",
          "new_text": null,
          "old_line_content": "                       !strcmp(buf1, \"TUPLETYPE\")) {",
          "new_line_content": "                       /* libavcodec used to write invalid files */",
          "content_same": false
        },
        {
          "line": 116,
          "old_api": "av_image_check_size",
          "new_api": null,
          "old_text": "av_image_check_size(w, h, 0, avctx)",
          "new_text": null,
          "old_line_content": "            av_image_check_size(w, h, 0, avctx) || s->bytestream >= s->bytestream_end)",
          "new_line_content": "        if (w <= 0 || h <= 0 || maxval <= 0 || maxval > UINT16_MAX || depth <= 0 || tuple_type[0] == '\\0' ||",
          "content_same": false
        },
        {
          "line": 119,
          "old_api": "ff_set_dimensions",
          "new_api": null,
          "old_text": "ff_set_dimensions(avctx, w, h)",
          "new_text": null,
          "old_line_content": "        ret = ff_set_dimensions(avctx, w, h);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 187,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(avctx, AV_LOG_ERROR, \"Unsupported pixel format\\n\")",
          "new_text": null,
          "old_line_content": "                av_log(avctx, AV_LOG_ERROR, \"Unsupported pixel format\\n\");",
          "new_line_content": "            } else {",
          "content_same": false
        },
        {
          "line": 156,
          "old_api": "pnm_get",
          "new_api": null,
          "old_text": "pnm_get(s, buf1, sizeof(buf1))",
          "new_text": null,
          "old_line_content": "    pnm_get(s, buf1, sizeof(buf1));",
          "new_line_content": "    }",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 20,
      "total_additions": 12,
      "total_deletions": 11,
      "total_api_changes": 43
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 5,
        "api_related_lines": 43,
        "non_api_lines": 4,
        "non_api_line_numbers": [
          56,
          57,
          61,
          55
        ]
      }
    },
    "api_calls_before": 33,
    "api_calls_after": 34,
    "diff_info": {
      "added_lines": 4,
      "removed_lines": 3,
      "total_diff_lines": 22
    }
  }
}