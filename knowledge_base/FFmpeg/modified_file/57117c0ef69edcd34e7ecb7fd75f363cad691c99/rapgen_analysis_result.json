{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/57117c0ef69edcd34e7ecb7fd75f363cad691c99",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/57117c0ef69edcd34e7ecb7fd75f363cad691c99/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/57117c0ef69edcd34e7ecb7fd75f363cad691c99/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/57117c0ef69edcd34e7ecb7fd75f363cad691c99/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [],
      "additions": [
        {
          "line": 128,
          "old_api": null,
          "new_api": "av_channel_layout_from_mask",
          "old_text": null,
          "new_text": "av_channel_layout_from_mask(&avctx->ch_layout, hdr.channel_layout)",
          "old_line_content": "#if FF_API_OLD_CHANNEL_LAYOUT",
          "new_line_content": "                    av_channel_layout_from_mask(&avctx->ch_layout, hdr.channel_layout);",
          "content_same": false
        },
        {
          "line": 99,
          "old_api": null,
          "new_api": "ff_ac3_find_syncword",
          "old_text": null,
          "new_text": "ff_ac3_find_syncword(buf, buf_size)",
          "old_line_content": "            buf += offset;",
          "new_line_content": "            int offset = ff_ac3_find_syncword(buf, buf_size);",
          "content_same": false
        },
        {
          "line": 107,
          "old_api": null,
          "new_api": "avpriv_ac3_parse_header",
          "old_text": null,
          "new_text": "avpriv_ac3_parse_header(&phrd, buf, buf_size)",
          "old_line_content": "                if (buf_size > hdr.frame_size) {",
          "new_line_content": "                int ret = avpriv_ac3_parse_header(&phrd, buf, buf_size);",
          "content_same": false
        },
        {
          "line": 78,
          "old_api": null,
          "new_api": "ff_combine_frame",
          "old_text": null,
          "new_text": "ff_combine_frame(pc, i, &buf, &buf_size)",
          "old_line_content": "        return buf_size;",
          "new_line_content": "    if(ff_combine_frame(pc, i, &buf, &buf_size)<0){",
          "content_same": false
        },
        {
          "line": 79,
          "old_api": null,
          "new_api": "FFMIN",
          "old_text": null,
          "new_text": "FFMIN(s->remaining_size, buf_size)",
          "old_line_content": "    }",
          "new_line_content": "        s->remaining_size -= FFMIN(s->remaining_size, buf_size);",
          "content_same": false
        },
        {
          "line": 147,
          "old_api": null,
          "new_api": "avpriv_adts_header_parse",
          "old_text": null,
          "new_text": "avpriv_adts_header_parse(&phrd, buf, buf_size)",
          "old_line_content": "            bit_rate = hdr.bit_rate;",
          "new_line_content": "            int ret = avpriv_adts_header_parse(&phrd, buf, buf_size);",
          "content_same": false
        },
        {
          "line": 57,
          "old_api": null,
          "new_api": "sync",
          "old_text": null,
          "new_text": "s->sync(s->state, &s->need_next_header, &new_frame_start)",
          "old_line_content": "                i=END_NOT_FOUND;",
          "new_line_content": "                if((len=s->sync(s->state, &s->need_next_header, &new_frame_start)))",
          "content_same": false
        },
        {
          "line": 126,
          "old_api": null,
          "new_api": "av_channel_layout_uninit",
          "old_text": null,
          "new_text": "av_channel_layout_uninit(&avctx->ch_layout)",
          "old_line_content": "                    avctx->ch_layout.nb_channels = hdr.channels;",
          "new_line_content": "                av_channel_layout_uninit(&avctx->ch_layout);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 102,
          "old_api": "avpriv_ac3_parse_header",
          "new_api": null,
          "old_text": "avpriv_ac3_parse_header(&phrd, buf, buf_size)",
          "new_text": null,
          "old_line_content": "                int ret = avpriv_ac3_parse_header(&phrd, buf, buf_size);",
          "new_line_content": "                return i;",
          "content_same": false
        },
        {
          "line": 74,
          "old_api": "ff_combine_frame",
          "new_api": null,
          "old_text": "ff_combine_frame(pc, i, &buf, &buf_size)",
          "new_text": null,
          "old_line_content": "    if(ff_combine_frame(pc, i, &buf, &buf_size)<0){",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 75,
          "old_api": "FFMIN",
          "new_api": null,
          "old_text": "FFMIN(s->remaining_size, buf_size)",
          "new_text": null,
          "old_line_content": "        s->remaining_size -= FFMIN(s->remaining_size, buf_size);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 142,
          "old_api": "avpriv_adts_header_parse",
          "new_api": null,
          "old_text": "avpriv_adts_header_parse(&phrd, buf, buf_size)",
          "new_text": null,
          "old_line_content": "            int ret = avpriv_adts_header_parse(&phrd, buf, buf_size);",
          "new_line_content": "            if (hdr.bitstream_mode == 0x7 && hdr.channels > 1)",
          "content_same": false
        },
        {
          "line": 53,
          "old_api": "sync",
          "new_api": null,
          "old_text": "s->sync(s->state, &s->need_next_header, &new_frame_start)",
          "new_text": null,
          "old_line_content": "                if((len=s->sync(s->state, &s->need_next_header, &new_frame_start)))",
          "new_line_content": "        }else{ //we need a header first",
          "content_same": false
        },
        {
          "line": 121,
          "old_api": "av_channel_layout_uninit",
          "new_api": null,
          "old_text": "av_channel_layout_uninit(&avctx->ch_layout)",
          "new_text": null,
          "old_line_content": "                av_channel_layout_uninit(&avctx->ch_layout);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 123,
          "old_api": "av_channel_layout_from_mask",
          "new_api": null,
          "old_text": "av_channel_layout_from_mask(&avctx->ch_layout, hdr.channel_layout)",
          "new_text": null,
          "old_line_content": "                    av_channel_layout_from_mask(&avctx->ch_layout, hdr.channel_layout);",
          "new_line_content": "                avctx->codec_id = AV_CODEC_ID_EAC3;",
          "content_same": false
        },
        {
          "line": 94,
          "old_api": "ff_ac3_find_syncword",
          "new_api": null,
          "old_text": "ff_ac3_find_syncword(buf, buf_size)",
          "new_text": null,
          "old_line_content": "            int offset = ff_ac3_find_syncword(buf, buf_size);",
          "new_line_content": "           reliable. Bit rate is still accurate because the total frame",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 0,
      "total_additions": 8,
      "total_deletions": 8,
      "total_api_changes": 16
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 5,
        "api_related_lines": 16,
        "non_api_lines": 5,
        "non_api_line_numbers": [
          43,
          44,
          45,
          46,
          84
        ]
      }
    },
    "api_calls_before": 8,
    "api_calls_after": 8,
    "diff_info": {
      "added_lines": 5,
      "removed_lines": 0,
      "total_diff_lines": 24
    }
  }
}