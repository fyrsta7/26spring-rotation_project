{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/1bc873acd6e15eaca8c2aebfd7dc6472b0429c50",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/1bc873acd6e15eaca8c2aebfd7dc6472b0429c50/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/1bc873acd6e15eaca8c2aebfd7dc6472b0429c50/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/1bc873acd6e15eaca8c2aebfd7dc6472b0429c50/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 158,
          "old_api": "FFMAX",
          "new_api": "sqrt",
          "old_text": "FFMAX(maxff, ff)",
          "new_text": "sqrt(2*ff/LEN)",
          "old_line_content": "            maxff= FFMAX(maxff, ff);",
          "new_line_content": "            ff= sqrt(2*ff/LEN);",
          "content_same": false
        },
        {
          "line": 163,
          "old_api": "av_log",
          "new_api": "FFMIN",
          "old_text": "av_log(NULL, AV_LOG_ERROR, \"i:%4d ss:%f ff:%13.6e-%13.6e sf:%13.6e-%13.6e\\n\", i, ss, maxff, minff, maxsf, minsf)",
          "new_text": "FFMIN(minsf, sf)",
          "old_line_content": "                av_log(NULL, AV_LOG_ERROR, \"i:%4d ss:%f ff:%13.6e-%13.6e sf:%13.6e-%13.6e\\n\", i, ss, maxff, minff, maxsf, minsf);",
          "new_line_content": "            minsf= FFMIN(minsf, sf);",
          "content_same": false
        },
        {
          "line": 186,
          "old_api": "av_mallocz",
          "new_api": "ceil",
          "old_text": "av_mallocz(sizeof(*c))",
          "new_text": "ceil(filter_size/factor)",
          "old_line_content": "        c = av_mallocz(sizeof(*c));",
          "new_line_content": "           || c->filter_length != FFMAX((int)ceil(filter_size/factor), 1) || c->format != format",
          "content_same": false
        },
        {
          "line": 221,
          "old_api": "av_calloc",
          "new_api": "ceil",
          "old_text": "av_calloc(c->filter_alloc, (phase_count+1)*c->felem_size)",
          "new_text": "ceil(filter_size/factor)",
          "old_line_content": "        c->filter_bank   = av_calloc(c->filter_alloc, (phase_count+1)*c->felem_size);",
          "new_line_content": "        c->filter_length = FFMAX((int)ceil(filter_size/factor), 1);",
          "content_same": false
        },
        {
          "line": 228,
          "old_api": "memcpy",
          "new_api": "build_filter",
          "old_text": "memcpy(c->filter_bank + (c->filter_alloc*phase_count+1)*c->felem_size, c->filter_bank, (c->filter_alloc-1)*c->felem_size)",
          "new_text": "build_filter(c, (void*)c->filter_bank, factor, c->filter_length, c->filter_alloc, phase_count, 1<<c->filter_shift, filter_type, kaiser_beta)",
          "old_line_content": "        memcpy(c->filter_bank + (c->filter_alloc*phase_count+1)*c->felem_size, c->filter_bank, (c->filter_alloc-1)*c->felem_size);",
          "new_line_content": "        if (build_filter(c, (void*)c->filter_bank, factor, c->filter_length, c->filter_alloc, phase_count, 1<<c->filter_shift, filter_type, kaiser_beta))",
          "content_same": false
        },
        {
          "line": 300,
          "old_api": "resample",
          "new_api": "FFMIN",
          "old_text": "c->dsp.resample(c, dst, src, dst_size, update_ctx)",
          "new_text": "FFMIN(dst_size, delta_n)",
          "old_line_content": "            *consumed = c->dsp.resample(c, dst, src, dst_size, update_ctx);",
          "new_line_content": "        dst_size = FFMIN(dst_size, delta_n);",
          "content_same": false
        },
        {
          "line": 363,
          "old_api": "FFMAX",
          "new_api": "AVERROR",
          "old_text": "FFMAX(num, (num * c->ideal_dst_incr - 1) / c->dst_incr + 1)",
          "new_text": "AVERROR(EINVAL)",
          "old_line_content": "        num = FFMAX(num, (num * c->ideal_dst_incr - 1) / c->dst_incr + 1);",
          "new_line_content": "            return AVERROR(EINVAL);",
          "content_same": false
        },
        {
          "line": 373,
          "old_api": "av_assert0",
          "new_api": "swri_realloc_audio",
          "old_text": "av_assert0(a->planar)",
          "new_text": "swri_realloc_audio(a, s->in_buffer_index + 2*s->in_buffer_count)",
          "old_line_content": "    av_assert0(a->planar);",
          "new_line_content": "    if((ret = swri_realloc_audio(a, s->in_buffer_index + 2*s->in_buffer_count)) < 0)",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 256,
          "old_api": null,
          "new_api": "av_freep",
          "old_text": null,
          "new_text": "av_freep(&(*c)->filter_bank)",
          "old_line_content": "}",
          "new_line_content": "    av_freep(&(*c)->filter_bank);",
          "content_same": false
        },
        {
          "line": 257,
          "old_api": null,
          "new_api": "av_freep",
          "old_text": null,
          "new_text": "av_freep(c)",
          "old_line_content": "",
          "new_line_content": "    av_freep(c);",
          "content_same": false
        },
        {
          "line": 390,
          "old_api": null,
          "new_api": "FFMIN",
          "old_text": null,
          "new_text": "FFMIN(in_count + *out_sz, c->filter_length + 1)",
          "old_line_content": "    if (c->index >= 0)",
          "new_line_content": "    int n, ch, num = FFMIN(in_count + *out_sz, c->filter_length + 1), res;",
          "content_same": false
        },
        {
          "line": 395,
          "old_api": null,
          "new_api": "swri_realloc_audio",
          "old_text": null,
          "new_text": "swri_realloc_audio(dst, c->filter_length * 2 + 1)",
          "old_line_content": "",
          "new_line_content": "    if ((res = swri_realloc_audio(dst, c->filter_length * 2 + 1)) < 0)",
          "content_same": false
        },
        {
          "line": 401,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(dst->ch[ch] + ((c->filter_length + n) * c->felem_size),\n                   src->ch[ch] + ((n - *out_sz) * c->felem_size), c->felem_size)",
          "old_line_content": "        }",
          "new_line_content": "            memcpy(dst->ch[ch] + ((c->filter_length + n) * c->felem_size),",
          "content_same": false
        },
        {
          "line": 146,
          "old_api": null,
          "new_api": "cos",
          "old_text": null,
          "new_text": "cos(i*j*M_PI/LEN)",
          "old_line_content": "                double sum=0;",
          "new_line_content": "                sine[j]= cos(i*j*M_PI/LEN);",
          "content_same": false
        },
        {
          "line": 284,
          "old_api": null,
          "new_api": "FFMIN",
          "old_text": null,
          "new_text": "FFMIN(dst_size, new_size)",
          "old_line_content": "",
          "new_line_content": "        dst_size= FFMIN(dst_size, new_size);",
          "content_same": false
        },
        {
          "line": 285,
          "old_api": null,
          "new_api": "resample_one",
          "old_text": null,
          "new_text": "c->dsp.resample_one(dst, src, dst_size, index2, incr)",
          "old_line_content": "        index += dst_size * c->dst_incr_div;",
          "new_line_content": "        c->dsp.resample_one(dst, src, dst_size, index2, incr);",
          "content_same": false
        },
        {
          "line": 157,
          "old_api": null,
          "new_api": "sqrt",
          "old_text": null,
          "new_text": "sqrt(2*ss/LEN)",
          "old_line_content": "            sf= 2*sf/LEN;",
          "new_line_content": "            ss= sqrt(2*ss/LEN);",
          "content_same": false
        },
        {
          "line": 416,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(dst->ch[ch] + ((c->filter_length - n) * c->felem_size),\n                   dst->ch[ch] + ((c->filter_length + n) * c->felem_size),\n                   c->felem_size)",
          "old_line_content": "                   c->felem_size);",
          "new_line_content": "            memcpy(dst->ch[ch] + ((c->filter_length - n) * c->felem_size),",
          "content_same": false
        },
        {
          "line": 289,
          "old_api": null,
          "new_api": "av_assert2",
          "old_text": null,
          "new_text": "av_assert2(index >= 0)",
          "old_line_content": "        if (update_ctx) {",
          "new_line_content": "        av_assert2(index >= 0);",
          "content_same": false
        },
        {
          "line": 162,
          "old_api": null,
          "new_api": "FFMAX",
          "old_text": null,
          "new_text": "FFMAX(maxsf, sf)",
          "old_line_content": "            if(i%11==0){",
          "new_line_content": "            maxsf= FFMAX(maxsf, sf);",
          "content_same": false
        },
        {
          "line": 165,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(NULL, AV_LOG_ERROR, \"i:%4d ss:%f ff:%13.6e-%13.6e sf:%13.6e-%13.6e\\n\", i, ss, maxff, minff, maxsf, minsf)",
          "old_line_content": "                maxff=maxsf= -2;",
          "new_line_content": "                av_log(NULL, AV_LOG_ERROR, \"i:%4d ss:%f ff:%13.6e-%13.6e sf:%13.6e-%13.6e\\n\", i, ss, maxff, minff, maxsf, minsf);",
          "content_same": false
        },
        {
          "line": 424,
          "old_api": null,
          "new_api": "FFMAX",
          "old_text": null,
          "new_text": "FFMAX(*out_sz + c->filter_length,\n                    1 + c->filter_length * 2)",
          "old_line_content": "    c->index &= c->phase_mask;",
          "new_line_content": "    *out_sz = FFMAX(*out_sz + c->filter_length,",
          "content_same": false
        },
        {
          "line": 428,
          "old_api": null,
          "new_api": "FFMAX",
          "old_text": null,
          "new_text": "FFMAX(res, 0)",
          "old_line_content": "",
          "new_line_content": "    return FFMAX(res, 0);",
          "content_same": false
        },
        {
          "line": 173,
          "old_api": null,
          "new_api": "av_free",
          "old_text": null,
          "new_text": "av_free(tab)",
          "old_line_content": "}",
          "new_line_content": "    av_free(tab);",
          "content_same": false
        },
        {
          "line": 302,
          "old_api": null,
          "new_api": "resample",
          "old_text": null,
          "new_text": "c->dsp.resample(c, dst, src, dst_size, update_ctx)",
          "old_line_content": "            *consumed = 0;",
          "new_line_content": "            *consumed = c->dsp.resample(c, dst, src, dst_size, update_ctx);",
          "content_same": false
        },
        {
          "line": 182,
          "old_api": null,
          "new_api": "FFMIN",
          "old_text": null,
          "new_text": "FFMIN(out_rate * cutoff / in_rate, 1.0)",
          "old_line_content": "",
          "new_line_content": "    double factor= FFMIN(out_rate * cutoff / in_rate, 1.0);",
          "content_same": false
        },
        {
          "line": 313,
          "old_api": null,
          "new_api": "av_get_cpu_flags",
          "old_text": null,
          "new_text": "av_get_cpu_flags()",
          "old_line_content": "                    (mm_flags & (AV_CPU_FLAG_MMX2 | AV_CPU_FLAG_SSE2)) == AV_CPU_FLAG_MMX2;",
          "new_line_content": "    int av_unused mm_flags = av_get_cpu_flags();",
          "content_same": false
        },
        {
          "line": 60,
          "old_api": null,
          "new_api": "av_assert2",
          "old_text": null,
          "new_text": "av_assert2(i<98)",
          "old_line_content": "    return v;",
          "new_line_content": "        av_assert2(i<98);",
          "content_same": false
        },
        {
          "line": 188,
          "old_api": null,
          "new_api": "av_mallocz",
          "old_text": null,
          "new_text": "av_mallocz(sizeof(*c))",
          "old_line_content": "            return NULL;",
          "new_line_content": "        c = av_mallocz(sizeof(*c));",
          "content_same": false
        },
        {
          "line": 319,
          "old_api": null,
          "new_api": "FFMIN",
          "old_text": null,
          "new_text": "FFMIN(dst_size, c->compensation_distance)",
          "old_line_content": "",
          "new_line_content": "        dst_size = FFMIN(dst_size, c->compensation_distance);",
          "content_same": false
        },
        {
          "line": 320,
          "old_api": null,
          "new_api": "FFMIN",
          "old_text": null,
          "new_text": "FFMIN(src_size, max_src_size)",
          "old_line_content": "    for(i=0; i<dst->ch_count; i++){",
          "new_line_content": "    src_size = FFMIN(src_size, max_src_size);",
          "content_same": false
        },
        {
          "line": 194,
          "old_api": null,
          "new_api": "av_get_bytes_per_sample",
          "old_text": null,
          "new_text": "av_get_bytes_per_sample(c->format)",
          "old_line_content": "        switch(c->format){",
          "new_line_content": "        c->felem_size= av_get_bytes_per_sample(c->format);",
          "content_same": false
        },
        {
          "line": 323,
          "old_api": null,
          "new_api": "swri_resample",
          "old_text": null,
          "new_text": "swri_resample(c, dst->ch[i], src->ch[i],\n                           consumed, src_size, dst_size, i+1==dst->ch_count)",
          "old_line_content": "    }",
          "new_line_content": "        ret= swri_resample(c, dst->ch[i], src->ch[i],",
          "content_same": false
        },
        {
          "line": 327,
          "old_api": null,
          "new_api": "emms_c",
          "old_text": null,
          "new_text": "emms_c()",
          "old_line_content": "    if (c->compensation_distance) {",
          "new_line_content": "        emms_c();",
          "content_same": false
        },
        {
          "line": 77,
          "old_api": null,
          "new_api": "av_malloc_array",
          "old_text": null,
          "new_text": "av_malloc_array(tap_count,  sizeof(*tab))",
          "old_line_content": "",
          "new_line_content": "    double *tab = av_malloc_array(tap_count,  sizeof(*tab));",
          "content_same": false
        },
        {
          "line": 208,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(NULL, AV_LOG_ERROR, \"Unsupported sample format\\n\")",
          "old_line_content": "        }",
          "new_line_content": "            av_log(NULL, AV_LOG_ERROR, \"Unsupported sample format\\n\");",
          "content_same": false
        },
        {
          "line": 81,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(ENOMEM)",
          "old_line_content": "    /* if upsampling, only need to interpolate, no filter */",
          "new_line_content": "        return AVERROR(ENOMEM);",
          "content_same": false
        },
        {
          "line": 209,
          "old_api": null,
          "new_api": "av_assert0",
          "old_text": null,
          "new_text": "av_assert0(0)",
          "old_line_content": "",
          "new_line_content": "            av_assert0(0);",
          "content_same": false
        },
        {
          "line": 213,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(NULL, AV_LOG_ERROR, \"Filter length too large\\n\")",
          "old_line_content": "        }",
          "new_line_content": "            av_log(NULL, AV_LOG_ERROR, \"Filter length too large\\n\");",
          "content_same": false
        },
        {
          "line": 92,
          "old_api": null,
          "new_api": "sin",
          "old_text": null,
          "new_text": "sin(x)",
          "old_line_content": "            case SWR_FILTER_TYPE_CUBIC:{",
          "new_line_content": "            else        y = sin(x) / x;",
          "content_same": false
        },
        {
          "line": 348,
          "old_api": null,
          "new_api": "av_rescale",
          "old_text": null,
          "new_text": "av_rescale(num, base, s->in_sample_rate*(int64_t)c->src_incr << c->phase_shift)",
          "old_line_content": "",
          "new_line_content": "    return av_rescale(num, base, s->in_sample_rate*(int64_t)c->src_incr << c->phase_shift);",
          "content_same": false
        },
        {
          "line": 222,
          "old_api": null,
          "new_api": "FFALIGN",
          "old_text": null,
          "new_text": "FFALIGN(c->filter_length, 8)",
          "old_line_content": "        c->filter_type   = filter_type;",
          "new_line_content": "        c->filter_alloc  = FFALIGN(c->filter_length, 8);",
          "content_same": false
        },
        {
          "line": 223,
          "old_api": null,
          "new_api": "av_calloc",
          "old_text": null,
          "new_text": "av_calloc(c->filter_alloc, (phase_count+1)*c->felem_size)",
          "old_line_content": "        c->kaiser_beta   = kaiser_beta;",
          "new_line_content": "        c->filter_bank   = av_calloc(c->filter_alloc, (phase_count+1)*c->felem_size);",
          "content_same": false
        },
        {
          "line": 96,
          "old_api": null,
          "new_api": "fabs",
          "old_text": null,
          "new_text": "fabs(((double)(i - center) - (double)ph / phase_count) * factor)",
          "old_line_content": "                else      y=                       d*(-4 + 8*x - 5*x*x + x*x*x);",
          "new_line_content": "                x = fabs(((double)(i - center) - (double)ph / phase_count) * factor);",
          "content_same": false
        },
        {
          "line": 120,
          "old_api": null,
          "new_api": "lrintf",
          "old_text": null,
          "new_text": "lrintf(tab[i] * scale / norm)",
          "old_line_content": "        case AV_SAMPLE_FMT_S32P:",
          "new_line_content": "                ((int16_t*)filter)[ph * alloc + i] = av_clip(lrintf(tab[i] * scale / norm), INT16_MIN, INT16_MAX);",
          "content_same": false
        },
        {
          "line": 102,
          "old_api": null,
          "new_api": "cos",
          "old_text": null,
          "new_text": "cos(3*w)",
          "old_line_content": "            case SWR_FILTER_TYPE_KAISER:",
          "new_line_content": "                y *= 0.3635819 - 0.4891775 * cos(w) + 0.1365995 * cos(2*w) - 0.0106411 * cos(3*w);",
          "content_same": false
        },
        {
          "line": 230,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(c->filter_bank + (c->filter_alloc*phase_count+1)*c->felem_size, c->filter_bank, (c->filter_alloc-1)*c->felem_size)",
          "old_line_content": "    }",
          "new_line_content": "        memcpy(c->filter_bank + (c->filter_alloc*phase_count+1)*c->felem_size, c->filter_bank, (c->filter_alloc-1)*c->felem_size);",
          "content_same": false
        },
        {
          "line": 231,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(c->filter_bank + (c->filter_alloc*phase_count  )*c->felem_size, c->filter_bank + (c->filter_alloc - 1)*c->felem_size, c->felem_size)",
          "old_line_content": "",
          "new_line_content": "        memcpy(c->filter_bank + (c->filter_alloc*phase_count  )*c->felem_size, c->filter_bank + (c->filter_alloc - 1)*c->felem_size, c->felem_size);",
          "content_same": false
        },
        {
          "line": 359,
          "old_api": null,
          "new_api": "av_rescale_rnd",
          "old_text": null,
          "new_text": "av_rescale_rnd(num, s->out_sample_rate, ((int64_t)s->in_sample_rate) << c->phase_shift, AV_ROUND_UP)",
          "old_line_content": "    if (c->compensation_distance) {",
          "new_line_content": "    num = av_rescale_rnd(num, s->out_sample_rate, ((int64_t)s->in_sample_rate) << c->phase_shift, AV_ROUND_UP) + 2;",
          "content_same": false
        },
        {
          "line": 106,
          "old_api": null,
          "new_api": "FFMAX",
          "old_text": null,
          "new_text": "FFMAX(1-w*w, 0)",
          "old_line_content": "            default:",
          "new_line_content": "                y *= bessel(kaiser_beta*sqrt(FFMAX(1-w*w, 0)));",
          "content_same": false
        },
        {
          "line": 235,
          "old_api": null,
          "new_api": "av_reduce",
          "old_text": null,
          "new_text": "av_reduce(&c->src_incr, &c->dst_incr, out_rate, in_rate * (int64_t)phase_count, INT32_MAX/2)",
          "old_line_content": "    c->ideal_dst_incr = c->dst_incr;",
          "new_line_content": "    if(!av_reduce(&c->src_incr, &c->dst_incr, out_rate, in_rate * (int64_t)phase_count, INT32_MAX/2))",
          "content_same": false
        },
        {
          "line": 109,
          "old_api": null,
          "new_api": "av_assert0",
          "old_text": null,
          "new_text": "av_assert0(0)",
          "old_line_content": "",
          "new_line_content": "                av_assert0(0);",
          "content_same": false
        },
        {
          "line": 365,
          "old_api": null,
          "new_api": "FFMAX",
          "old_text": null,
          "new_text": "FFMAX(num, (num * c->ideal_dst_incr - 1) / c->dst_incr + 1)",
          "old_line_content": "    return num;",
          "new_line_content": "        num = FFMAX(num, (num * c->ideal_dst_incr - 1) / c->dst_incr + 1);",
          "content_same": false
        },
        {
          "line": 244,
          "old_api": null,
          "new_api": "swri_resample_dsp_init",
          "old_text": null,
          "new_text": "swri_resample_dsp_init(c)",
          "old_line_content": "    return c;",
          "new_line_content": "    swri_resample_dsp_init(c);",
          "content_same": false
        },
        {
          "line": 375,
          "old_api": null,
          "new_api": "av_assert0",
          "old_text": null,
          "new_text": "av_assert0(a->planar)",
          "old_line_content": "        for(j=0; j<s->in_buffer_count; j++){",
          "new_line_content": "    av_assert0(a->planar);",
          "content_same": false
        },
        {
          "line": 248,
          "old_api": null,
          "new_api": "av_freep",
          "old_text": null,
          "new_text": "av_freep(&c->filter_bank)",
          "old_line_content": "    return NULL;",
          "new_line_content": "    av_freep(&c->filter_bank);",
          "content_same": false
        },
        {
          "line": 249,
          "old_api": null,
          "new_api": "av_free",
          "old_text": null,
          "new_text": "av_free(c)",
          "old_line_content": "}",
          "new_line_content": "    av_free(c);",
          "content_same": false
        },
        {
          "line": 378,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(a->ch[i] + (s->in_buffer_index+s->in_buffer_count+j  )*a->bps,\n                a->ch[i] + (s->in_buffer_index+s->in_buffer_count-j-1)*a->bps, a->bps)",
          "old_line_content": "        }",
          "new_line_content": "            memcpy(a->ch[i] + (s->in_buffer_index+s->in_buffer_count+j  )*a->bps,",
          "content_same": false
        },
        {
          "line": 124,
          "old_api": null,
          "new_api": "llrint",
          "old_text": null,
          "new_text": "llrint(tab[i] * scale / norm)",
          "old_line_content": "        case AV_SAMPLE_FMT_FLTP:",
          "new_line_content": "                ((int32_t*)filter)[ph * alloc + i] = av_clipl_int32(llrint(tab[i] * scale / norm));",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 388,
          "old_api": "FFMIN",
          "new_api": null,
          "old_text": "FFMIN(in_count + *out_sz, c->filter_length + 1)",
          "new_text": null,
          "old_line_content": "    int n, ch, num = FFMIN(in_count + *out_sz, c->filter_length + 1), res;",
          "new_line_content": "                                 int in_count, int *out_idx, int *out_sz)",
          "content_same": false
        },
        {
          "line": 393,
          "old_api": "swri_realloc_audio",
          "new_api": null,
          "old_text": "swri_realloc_audio(dst, c->filter_length * 2 + 1)",
          "new_text": null,
          "old_line_content": "    if ((res = swri_realloc_audio(dst, c->filter_length * 2 + 1)) < 0)",
          "new_line_content": "        return 0;",
          "content_same": false
        },
        {
          "line": 399,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(dst->ch[ch] + ((c->filter_length + n) * c->felem_size),\n                   src->ch[ch] + ((n - *out_sz) * c->felem_size), c->felem_size)",
          "new_text": null,
          "old_line_content": "            memcpy(dst->ch[ch] + ((c->filter_length + n) * c->felem_size),",
          "new_line_content": "    for (n = *out_sz; n < num; n++) {",
          "content_same": false
        },
        {
          "line": 144,
          "old_api": "cos",
          "new_api": null,
          "old_text": "cos(i*j*M_PI/LEN)",
          "new_text": null,
          "old_line_content": "                sine[j]= cos(i*j*M_PI/LEN);",
          "new_line_content": "            double ss=0, sf=0, ff=0;",
          "content_same": false
        },
        {
          "line": 282,
          "old_api": "FFMIN",
          "new_api": null,
          "old_text": "FFMIN(dst_size, new_size)",
          "new_text": null,
          "old_line_content": "        dst_size= FFMIN(dst_size, new_size);",
          "new_line_content": "        int new_size = (src_size * (int64_t)c->src_incr - frac + c->dst_incr - 1) / c->dst_incr;",
          "content_same": false
        },
        {
          "line": 283,
          "old_api": "resample_one",
          "new_api": null,
          "old_text": "c->dsp.resample_one(dst, src, dst_size, index2, incr)",
          "new_text": null,
          "old_line_content": "        c->dsp.resample_one(dst, src, dst_size, index2, incr);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 155,
          "old_api": "sqrt",
          "new_api": null,
          "old_text": "sqrt(2*ss/LEN)",
          "new_text": null,
          "old_line_content": "            ss= sqrt(2*ss/LEN);",
          "new_line_content": "                sf+= sine[j + center] * filtered[j];",
          "content_same": false
        },
        {
          "line": 156,
          "old_api": "sqrt",
          "new_api": null,
          "old_text": "sqrt(2*ff/LEN)",
          "new_text": null,
          "old_line_content": "            ff= sqrt(2*ff/LEN);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 414,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(dst->ch[ch] + ((c->filter_length - n) * c->felem_size),\n                   dst->ch[ch] + ((c->filter_length + n) * c->felem_size),\n                   c->felem_size)",
          "new_text": null,
          "old_line_content": "            memcpy(dst->ch[ch] + ((c->filter_length - n) * c->felem_size),",
          "new_line_content": "    for (n = 1; n <= c->filter_length; n++) {",
          "content_same": false
        },
        {
          "line": 287,
          "old_api": "av_assert2",
          "new_api": null,
          "old_text": "av_assert2(index >= 0)",
          "new_text": null,
          "old_line_content": "        av_assert2(index >= 0);",
          "new_line_content": "        index += dst_size * c->dst_incr_div;",
          "content_same": false
        },
        {
          "line": 159,
          "old_api": "FFMIN",
          "new_api": null,
          "old_text": "FFMIN(minff, ff)",
          "new_text": null,
          "old_line_content": "            minff= FFMIN(minff, ff);",
          "new_line_content": "            sf= 2*sf/LEN;",
          "content_same": false
        },
        {
          "line": 422,
          "old_api": "FFMAX",
          "new_api": null,
          "old_text": "FFMAX(*out_sz + c->filter_length,\n                    1 + c->filter_length * 2)",
          "new_text": null,
          "old_line_content": "    *out_sz = FFMAX(*out_sz + c->filter_length,",
          "new_line_content": "    res = num - *out_sz;",
          "content_same": false
        },
        {
          "line": 298,
          "old_api": "FFMIN",
          "new_api": null,
          "old_text": "FFMIN(dst_size, delta_n)",
          "new_text": null,
          "old_line_content": "        dst_size = FFMIN(dst_size, delta_n);",
          "new_line_content": "        int delta_n = (delta_frac + c->dst_incr - 1) / c->dst_incr;",
          "content_same": false
        },
        {
          "line": 171,
          "old_api": "av_free",
          "new_api": null,
          "old_text": "av_free(tab)",
          "new_text": null,
          "old_line_content": "    av_free(tab);",
          "new_line_content": "#endif",
          "content_same": false
        },
        {
          "line": 426,
          "old_api": "FFMAX",
          "new_api": null,
          "old_text": "FFMAX(res, 0)",
          "new_text": null,
          "old_line_content": "    return FFMAX(res, 0);",
          "new_line_content": "    c->index &= c->phase_mask;",
          "content_same": false
        },
        {
          "line": 180,
          "old_api": "FFMIN",
          "new_api": null,
          "old_text": "FFMIN(out_rate * cutoff / in_rate, 1.0)",
          "new_text": null,
          "old_line_content": "    double factor= FFMIN(out_rate * cutoff / in_rate, 1.0);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 311,
          "old_api": "av_get_cpu_flags",
          "new_api": null,
          "old_text": "av_get_cpu_flags()",
          "new_text": null,
          "old_line_content": "    int av_unused mm_flags = av_get_cpu_flags();",
          "new_line_content": "static int multiple_resample(ResampleContext *c, AudioData *dst, int dst_size, AudioData *src, int src_size, int *consumed){",
          "content_same": false
        },
        {
          "line": 184,
          "old_api": "ceil",
          "new_api": null,
          "old_text": "ceil(filter_size/factor)",
          "new_text": null,
          "old_line_content": "           || c->filter_length != FFMAX((int)ceil(filter_size/factor), 1) || c->format != format",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 58,
          "old_api": "av_assert2",
          "new_api": null,
          "old_text": "av_assert2(i<99)",
          "new_text": null,
          "old_line_content": "        av_assert2(i<99);",
          "new_line_content": "        t *= x*inv[i + 1];",
          "content_same": false
        },
        {
          "line": 317,
          "old_api": "FFMIN",
          "new_api": null,
          "old_text": "FFMIN(dst_size, c->compensation_distance)",
          "new_text": null,
          "old_line_content": "        dst_size = FFMIN(dst_size, c->compensation_distance);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 318,
          "old_api": "FFMIN",
          "new_api": null,
          "old_text": "FFMIN(src_size, max_src_size)",
          "new_text": null,
          "old_line_content": "    src_size = FFMIN(src_size, max_src_size);",
          "new_line_content": "    if (c->compensation_distance)",
          "content_same": false
        },
        {
          "line": 192,
          "old_api": "av_get_bytes_per_sample",
          "new_api": null,
          "old_text": "av_get_bytes_per_sample(c->format)",
          "new_text": null,
          "old_line_content": "        c->felem_size= av_get_bytes_per_sample(c->format);",
          "new_line_content": "        c->format= format;",
          "content_same": false
        },
        {
          "line": 321,
          "old_api": "swri_resample",
          "new_api": null,
          "old_text": "swri_resample(c, dst->ch[i], src->ch[i],\n                           consumed, src_size, dst_size, i+1==dst->ch_count)",
          "new_text": null,
          "old_line_content": "        ret= swri_resample(c, dst->ch[i], src->ch[i],",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 325,
          "old_api": "emms_c",
          "new_api": null,
          "old_text": "emms_c()",
          "new_text": null,
          "old_line_content": "        emms_c();",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 75,
          "old_api": "av_malloc_array",
          "new_api": null,
          "old_text": "av_malloc_array(tap_count,  sizeof(*tab))",
          "new_text": null,
          "old_line_content": "    double *tab = av_malloc_array(tap_count,  sizeof(*tab));",
          "new_line_content": "    int ph, i;",
          "content_same": false
        },
        {
          "line": 206,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(NULL, AV_LOG_ERROR, \"Unsupported sample format\\n\")",
          "new_text": null,
          "old_line_content": "            av_log(NULL, AV_LOG_ERROR, \"Unsupported sample format\\n\");",
          "new_line_content": "            break;",
          "content_same": false
        },
        {
          "line": 79,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(ENOMEM)",
          "new_text": null,
          "old_line_content": "        return AVERROR(ENOMEM);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 207,
          "old_api": "av_assert0",
          "new_api": null,
          "old_text": "av_assert0(0)",
          "new_text": null,
          "old_line_content": "            av_assert0(0);",
          "new_line_content": "        default:",
          "content_same": false
        },
        {
          "line": 211,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(NULL, AV_LOG_ERROR, \"Filter length too large\\n\")",
          "new_text": null,
          "old_line_content": "            av_log(NULL, AV_LOG_ERROR, \"Filter length too large\\n\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 90,
          "old_api": "sin",
          "new_api": null,
          "old_text": "sin(x)",
          "new_text": null,
          "old_line_content": "            else        y = sin(x) / x;",
          "new_line_content": "            x = M_PI * ((double)(i - center) - (double)ph / phase_count) * factor;",
          "content_same": false
        },
        {
          "line": 219,
          "old_api": "ceil",
          "new_api": null,
          "old_text": "ceil(filter_size/factor)",
          "new_text": null,
          "old_line_content": "        c->filter_length = FFMAX((int)ceil(filter_size/factor), 1);",
          "new_line_content": "        c->linear        = linear;",
          "content_same": false
        },
        {
          "line": 220,
          "old_api": "FFALIGN",
          "new_api": null,
          "old_text": "FFALIGN(c->filter_length, 8)",
          "new_text": null,
          "old_line_content": "        c->filter_alloc  = FFALIGN(c->filter_length, 8);",
          "new_line_content": "        c->factor        = factor;",
          "content_same": false
        },
        {
          "line": 346,
          "old_api": "av_rescale",
          "new_api": null,
          "old_text": "av_rescale(num, base, s->in_sample_rate*(int64_t)c->src_incr << c->phase_shift)",
          "new_text": null,
          "old_line_content": "    return av_rescale(num, base, s->in_sample_rate*(int64_t)c->src_incr << c->phase_shift);",
          "new_line_content": "    num *= c->src_incr;",
          "content_same": false
        },
        {
          "line": 94,
          "old_api": "fabs",
          "new_api": null,
          "old_text": "fabs(((double)(i - center) - (double)ph / phase_count) * factor)",
          "new_text": null,
          "old_line_content": "                x = fabs(((double)(i - center) - (double)ph / phase_count) * factor);",
          "new_line_content": "            case SWR_FILTER_TYPE_CUBIC:{",
          "content_same": false
        },
        {
          "line": 226,
          "old_api": "build_filter",
          "new_api": null,
          "old_text": "build_filter(c, (void*)c->filter_bank, factor, c->filter_length, c->filter_alloc, phase_count, 1<<c->filter_shift, filter_type, kaiser_beta)",
          "new_text": null,
          "old_line_content": "        if (build_filter(c, (void*)c->filter_bank, factor, c->filter_length, c->filter_alloc, phase_count, 1<<c->filter_shift, filter_type, kaiser_beta))",
          "new_line_content": "        if (!c->filter_bank)",
          "content_same": false
        },
        {
          "line": 100,
          "old_api": "cos",
          "new_api": null,
          "old_text": "cos(3*w)",
          "new_text": null,
          "old_line_content": "                y *= 0.3635819 - 0.4891775 * cos(w) + 0.1365995 * cos(2*w) - 0.0106411 * cos(3*w);",
          "new_line_content": "            case SWR_FILTER_TYPE_BLACKMAN_NUTTALL:",
          "content_same": false
        },
        {
          "line": 229,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(c->filter_bank + (c->filter_alloc*phase_count  )*c->felem_size, c->filter_bank + (c->filter_alloc - 1)*c->felem_size, c->felem_size)",
          "new_text": null,
          "old_line_content": "        memcpy(c->filter_bank + (c->filter_alloc*phase_count  )*c->felem_size, c->filter_bank + (c->filter_alloc - 1)*c->felem_size, c->felem_size);",
          "new_line_content": "            goto error;",
          "content_same": false
        },
        {
          "line": 357,
          "old_api": "av_rescale_rnd",
          "new_api": null,
          "old_text": "av_rescale_rnd(num, s->out_sample_rate, ((int64_t)s->in_sample_rate) << c->phase_shift, AV_ROUND_UP)",
          "new_text": null,
          "old_line_content": "    num = av_rescale_rnd(num, s->out_sample_rate, ((int64_t)s->in_sample_rate) << c->phase_shift, AV_ROUND_UP) + 2;",
          "new_line_content": "    num *= 1 << c->phase_shift;",
          "content_same": false
        },
        {
          "line": 376,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(a->ch[i] + (s->in_buffer_index+s->in_buffer_count+j  )*a->bps,\n                a->ch[i] + (s->in_buffer_index+s->in_buffer_count-j-1)*a->bps, a->bps)",
          "new_text": null,
          "old_line_content": "            memcpy(a->ch[i] + (s->in_buffer_index+s->in_buffer_count+j  )*a->bps,",
          "new_line_content": "    for(i=0; i<a->ch_count; i++){",
          "content_same": false
        },
        {
          "line": 104,
          "old_api": "FFMAX",
          "new_api": null,
          "old_text": "FFMAX(1-w*w, 0)",
          "new_text": null,
          "old_line_content": "                y *= bessel(kaiser_beta*sqrt(FFMAX(1-w*w, 0)));",
          "new_line_content": "            case SWR_FILTER_TYPE_KAISER:",
          "content_same": false
        },
        {
          "line": 233,
          "old_api": "av_reduce",
          "new_api": null,
          "old_text": "av_reduce(&c->src_incr, &c->dst_incr, out_rate, in_rate * (int64_t)phase_count, INT32_MAX/2)",
          "new_text": null,
          "old_line_content": "    if(!av_reduce(&c->src_incr, &c->dst_incr, out_rate, in_rate * (int64_t)phase_count, INT32_MAX/2))",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 361,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(EINVAL)",
          "new_text": null,
          "old_line_content": "            return AVERROR(EINVAL);",
          "new_line_content": "    if (c->compensation_distance) {",
          "content_same": false
        },
        {
          "line": 107,
          "old_api": "av_assert0",
          "new_api": null,
          "old_text": "av_assert0(0)",
          "new_text": null,
          "old_line_content": "                av_assert0(0);",
          "new_line_content": "                break;",
          "content_same": false
        },
        {
          "line": 242,
          "old_api": "swri_resample_dsp_init",
          "new_api": null,
          "old_text": "swri_resample_dsp_init(c)",
          "new_text": null,
          "old_line_content": "    swri_resample_dsp_init(c);",
          "new_line_content": "    c->frac= 0;",
          "content_same": false
        },
        {
          "line": 371,
          "old_api": "swri_realloc_audio",
          "new_api": null,
          "old_text": "swri_realloc_audio(a, s->in_buffer_index + 2*s->in_buffer_count)",
          "new_text": null,
          "old_line_content": "    if((ret = swri_realloc_audio(a, s->in_buffer_index + 2*s->in_buffer_count)) < 0)",
          "new_line_content": "    AudioData *a= &s->in_buffer;",
          "content_same": false
        },
        {
          "line": 118,
          "old_api": "lrintf",
          "new_api": null,
          "old_text": "lrintf(tab[i] * scale / norm)",
          "new_text": null,
          "old_line_content": "                ((int16_t*)filter)[ph * alloc + i] = av_clip(lrintf(tab[i] * scale / norm), INT16_MIN, INT16_MAX);",
          "new_line_content": "        case AV_SAMPLE_FMT_S16P:",
          "content_same": false
        },
        {
          "line": 247,
          "old_api": "av_free",
          "new_api": null,
          "old_text": "av_free(c)",
          "new_text": null,
          "old_line_content": "    av_free(c);",
          "new_line_content": "error:",
          "content_same": false
        },
        {
          "line": 246,
          "old_api": "av_freep",
          "new_api": null,
          "old_text": "av_freep(&c->filter_bank)",
          "new_text": null,
          "old_line_content": "    av_freep(&c->filter_bank);",
          "new_line_content": "    return c;",
          "content_same": false
        },
        {
          "line": 122,
          "old_api": "llrint",
          "new_api": null,
          "old_text": "llrint(tab[i] * scale / norm)",
          "new_text": null,
          "old_line_content": "                ((int32_t*)filter)[ph * alloc + i] = av_clipl_int32(llrint(tab[i] * scale / norm));",
          "new_line_content": "        case AV_SAMPLE_FMT_S32P:",
          "content_same": false
        },
        {
          "line": 254,
          "old_api": "av_freep",
          "new_api": null,
          "old_text": "av_freep(&(*c)->filter_bank)",
          "new_text": null,
          "old_line_content": "    av_freep(&(*c)->filter_bank);",
          "new_line_content": "    if(!*c)",
          "content_same": false
        },
        {
          "line": 255,
          "old_api": "av_freep",
          "new_api": null,
          "old_text": "av_freep(c)",
          "new_text": null,
          "old_line_content": "    av_freep(c);",
          "new_line_content": "        return;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 8,
      "total_additions": 51,
      "total_deletions": 51,
      "total_api_changes": 110
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 6,
        "api_related_lines": 110,
        "non_api_lines": 4,
        "non_api_line_numbers": [
          57,
          59,
          54,
          55
        ]
      }
    },
    "api_calls_before": 69,
    "api_calls_after": 69,
    "diff_info": {
      "added_lines": 5,
      "removed_lines": 3,
      "total_diff_lines": 22
    }
  }
}