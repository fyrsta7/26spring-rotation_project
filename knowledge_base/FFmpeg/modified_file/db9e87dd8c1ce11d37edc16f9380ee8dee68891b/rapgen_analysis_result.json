{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/db9e87dd8c1ce11d37edc16f9380ee8dee68891b",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/db9e87dd8c1ce11d37edc16f9380ee8dee68891b/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/db9e87dd8c1ce11d37edc16f9380ee8dee68891b/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/db9e87dd8c1ce11d37edc16f9380ee8dee68891b/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 249,
          "old_api": "AVERROR",
          "new_api": "S_ISFIFO",
          "old_text": "AVERROR(errno)",
          "new_text": "S_ISFIFO(st.st_mode)",
          "old_line_content": "    return ret < 0 ? AVERROR(errno) : ret;",
          "new_line_content": "        return ret < 0 ? AVERROR(errno) : (S_ISFIFO(st.st_mode) ? 0 : st.st_size);",
          "content_same": false
        },
        {
          "line": 285,
          "old_api": "readdir",
          "new_api": "ff_alloc_dir_entry",
          "old_text": "readdir(c->dir)",
          "new_text": "ff_alloc_dir_entry()",
          "old_line_content": "        dir = readdir(c->dir);",
          "new_line_content": "    *next = ff_alloc_dir_entry();",
          "content_same": false
        },
        {
          "line": 287,
          "old_api": "av_freep",
          "new_api": "AVERROR",
          "old_text": "av_freep(next)",
          "new_text": "AVERROR(ENOMEM)",
          "old_line_content": "            av_freep(next);",
          "new_line_content": "        return AVERROR(ENOMEM);",
          "content_same": false
        },
        {
          "line": 290,
          "old_api": "strcmp",
          "new_api": "readdir",
          "old_text": "strcmp(dir->d_name, \"..\")",
          "new_text": "readdir(c->dir)",
          "old_line_content": "    } while (!strcmp(dir->d_name, \".\") || !strcmp(dir->d_name, \"..\"));",
          "new_line_content": "        dir = readdir(c->dir);",
          "content_same": false
        },
        {
          "line": 292,
          "old_api": "av_append_path_component",
          "new_api": "av_freep",
          "old_text": "av_append_path_component(h->filename, dir->d_name)",
          "new_text": "av_freep(next)",
          "old_line_content": "    fullpath = av_append_path_component(h->filename, dir->d_name);",
          "new_line_content": "            av_freep(next);",
          "content_same": false
        },
        {
          "line": 295,
          "old_api": "lstat",
          "new_api": "strcmp",
          "old_text": "lstat(fullpath, &st)",
          "new_text": "strcmp(dir->d_name, \"..\")",
          "old_line_content": "        if (!lstat(fullpath, &st)) {",
          "new_line_content": "    } while (!strcmp(dir->d_name, \".\") || !strcmp(dir->d_name, \"..\"));",
          "content_same": false
        },
        {
          "line": 300,
          "old_api": "S_ISCHR",
          "new_api": "lstat",
          "old_text": "S_ISCHR(st.st_mode)",
          "new_text": "lstat(fullpath, &st)",
          "old_line_content": "            else if (S_ISCHR(st.st_mode))",
          "new_line_content": "        if (!lstat(fullpath, &st)) {",
          "content_same": false
        },
        {
          "line": 324,
          "old_api": "av_strdup",
          "new_api": "INT64_C",
          "old_text": "av_strdup(dir->d_name)",
          "new_text": "INT64_C(1000000)",
          "old_line_content": "    (*next)->name = av_strdup(dir->d_name);",
          "new_line_content": "            (*next)->status_change_timestamp = INT64_C(1000000) * st.st_ctime;",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 386,
          "old_api": null,
          "new_api": "setmode",
          "old_text": null,
          "new_text": "setmode(fd, O_BINARY)",
          "old_line_content": "}",
          "new_line_content": "    setmode(fd, O_BINARY);",
          "content_same": false
        },
        {
          "line": 260,
          "old_api": null,
          "new_api": "close",
          "old_text": null,
          "new_text": "close(c->fd)",
          "old_line_content": "#if HAVE_LSTAT",
          "new_line_content": "    return close(c->fd);",
          "content_same": false
        },
        {
          "line": 268,
          "old_api": null,
          "new_api": "opendir",
          "old_text": null,
          "new_text": "opendir(h->filename)",
          "old_line_content": "#else",
          "new_line_content": "    c->dir = opendir(h->filename);",
          "content_same": false
        },
        {
          "line": 270,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(errno)",
          "old_line_content": "#endif /* HAVE_LSTAT */",
          "new_line_content": "        return AVERROR(errno);",
          "content_same": false
        },
        {
          "line": 274,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(ENOSYS)",
          "old_line_content": "{",
          "new_line_content": "    return AVERROR(ENOSYS);",
          "content_same": false
        },
        {
          "line": 293,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(errno)",
          "old_line_content": "    if (fullpath) {",
          "new_line_content": "            return AVERROR(errno);",
          "content_same": false
        },
        {
          "line": 297,
          "old_api": null,
          "new_api": "av_append_path_component",
          "old_text": null,
          "new_text": "av_append_path_component(h->filename, dir->d_name)",
          "old_line_content": "                (*next)->type = AVIO_ENTRY_DIRECTORY;",
          "new_line_content": "    fullpath = av_append_path_component(h->filename, dir->d_name);",
          "content_same": false
        },
        {
          "line": 301,
          "old_api": null,
          "new_api": "S_ISDIR",
          "old_text": null,
          "new_text": "S_ISDIR(st.st_mode)",
          "old_line_content": "                (*next)->type = AVIO_ENTRY_CHARACTER_DEVICE;",
          "new_line_content": "            if (S_ISDIR(st.st_mode))",
          "content_same": false
        },
        {
          "line": 303,
          "old_api": null,
          "new_api": "S_ISFIFO",
          "old_text": null,
          "new_text": "S_ISFIFO(st.st_mode)",
          "old_line_content": "                (*next)->type = AVIO_ENTRY_BLOCK_DEVICE;",
          "new_line_content": "            else if (S_ISFIFO(st.st_mode))",
          "content_same": false
        },
        {
          "line": 305,
          "old_api": null,
          "new_api": "S_ISCHR",
          "old_text": null,
          "new_text": "S_ISCHR(st.st_mode)",
          "old_line_content": "                (*next)->type = AVIO_ENTRY_SYMBOLIC_LINK;",
          "new_line_content": "            else if (S_ISCHR(st.st_mode))",
          "content_same": false
        },
        {
          "line": 307,
          "old_api": null,
          "new_api": "S_ISBLK",
          "old_text": null,
          "new_text": "S_ISBLK(st.st_mode)",
          "old_line_content": "                (*next)->type = AVIO_ENTRY_SOCKET;",
          "new_line_content": "            else if (S_ISBLK(st.st_mode))",
          "content_same": false
        },
        {
          "line": 309,
          "old_api": null,
          "new_api": "S_ISLNK",
          "old_text": null,
          "new_text": "S_ISLNK(st.st_mode)",
          "old_line_content": "                (*next)->type = AVIO_ENTRY_FILE;",
          "new_line_content": "            else if (S_ISLNK(st.st_mode))",
          "content_same": false
        },
        {
          "line": 311,
          "old_api": null,
          "new_api": "S_ISSOCK",
          "old_text": null,
          "new_text": "S_ISSOCK(st.st_mode)",
          "old_line_content": "                (*next)->type = AVIO_ENTRY_UNKNOWN;",
          "new_line_content": "            else if (S_ISSOCK(st.st_mode))",
          "content_same": false
        },
        {
          "line": 313,
          "old_api": null,
          "new_api": "S_ISREG",
          "old_text": null,
          "new_text": "S_ISREG(st.st_mode)",
          "old_line_content": "            (*next)->group_id = st.st_gid;",
          "new_line_content": "            else if (S_ISREG(st.st_mode))",
          "content_same": false
        },
        {
          "line": 322,
          "old_api": null,
          "new_api": "INT64_C",
          "old_text": null,
          "new_text": "INT64_C(1000000)",
          "old_line_content": "    }",
          "new_line_content": "            (*next)->modification_timestamp = INT64_C(1000000) * st.st_mtime;",
          "content_same": false
        },
        {
          "line": 323,
          "old_api": null,
          "new_api": "INT64_C",
          "old_text": null,
          "new_text": "INT64_C(1000000)",
          "old_line_content": "",
          "new_line_content": "            (*next)->access_timestamp =  INT64_C(1000000) * st.st_atime;",
          "content_same": false
        },
        {
          "line": 326,
          "old_api": null,
          "new_api": "av_free",
          "old_text": null,
          "new_text": "av_free(fullpath)",
          "old_line_content": "#else",
          "new_line_content": "        av_free(fullpath);",
          "content_same": false
        },
        {
          "line": 329,
          "old_api": null,
          "new_api": "av_strdup",
          "old_text": null,
          "new_text": "av_strdup(dir->d_name)",
          "old_line_content": "}",
          "new_line_content": "    (*next)->name = av_strdup(dir->d_name);",
          "content_same": false
        },
        {
          "line": 332,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(ENOSYS)",
          "old_line_content": "{",
          "new_line_content": "    return AVERROR(ENOSYS);",
          "content_same": false
        },
        {
          "line": 340,
          "old_api": null,
          "new_api": "closedir",
          "old_text": null,
          "new_text": "closedir(c->dir)",
          "old_line_content": "}",
          "new_line_content": "    closedir(c->dir);",
          "content_same": false
        },
        {
          "line": 343,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(ENOSYS)",
          "old_line_content": "    .name                = \"file\",",
          "new_line_content": "    return AVERROR(ENOSYS);",
          "content_same": false
        },
        {
          "line": 375,
          "old_api": null,
          "new_api": "av_strstart",
          "old_text": null,
          "new_text": "av_strstart(filename, \"pipe:\", &filename)",
          "old_line_content": "            fd = 1;",
          "new_line_content": "    av_strstart(filename, \"pipe:\", &filename);",
          "content_same": false
        },
        {
          "line": 248,
          "old_api": null,
          "new_api": "fstat",
          "old_text": null,
          "new_text": "fstat(c->fd, &st)",
          "old_line_content": "",
          "new_line_content": "        ret = fstat(c->fd, &st);",
          "content_same": false
        },
        {
          "line": 377,
          "old_api": null,
          "new_api": "strtol",
          "old_text": null,
          "new_text": "strtol(filename, &final, 10)",
          "old_line_content": "            fd = 0;",
          "new_line_content": "    fd = strtol(filename, &final, 10);",
          "content_same": false
        },
        {
          "line": 252,
          "old_api": null,
          "new_api": "lseek",
          "old_text": null,
          "new_text": "lseek(c->fd, pos, whence)",
          "old_line_content": "static int file_close(URLContext *h)",
          "new_line_content": "    ret = lseek(c->fd, pos, whence);",
          "content_same": false
        },
        {
          "line": 254,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(errno)",
          "old_line_content": "    FileContext *c = h->priv_data;",
          "new_line_content": "    return ret < 0 ? AVERROR(errno) : ret;",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 263,
          "old_api": "opendir",
          "new_api": null,
          "old_text": "opendir(h->filename)",
          "new_text": null,
          "old_line_content": "    c->dir = opendir(h->filename);",
          "new_line_content": "static int file_open_dir(URLContext *h)",
          "content_same": false
        },
        {
          "line": 265,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(errno)",
          "new_text": null,
          "old_line_content": "        return AVERROR(errno);",
          "new_line_content": "#if HAVE_LSTAT",
          "content_same": false
        },
        {
          "line": 269,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(ENOSYS)",
          "new_text": null,
          "old_line_content": "    return AVERROR(ENOSYS);",
          "new_line_content": "    if (!c->dir)",
          "content_same": false
        },
        {
          "line": 280,
          "old_api": "ff_alloc_dir_entry",
          "new_api": null,
          "old_text": "ff_alloc_dir_entry()",
          "new_text": null,
          "old_line_content": "    *next = ff_alloc_dir_entry();",
          "new_line_content": "#if HAVE_LSTAT",
          "content_same": false
        },
        {
          "line": 282,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(ENOMEM)",
          "new_text": null,
          "old_line_content": "        return AVERROR(ENOMEM);",
          "new_line_content": "    struct dirent *dir;",
          "content_same": false
        },
        {
          "line": 288,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(errno)",
          "new_text": null,
          "old_line_content": "            return AVERROR(errno);",
          "new_line_content": "    do {",
          "content_same": false
        },
        {
          "line": 296,
          "old_api": "S_ISDIR",
          "new_api": null,
          "old_text": "S_ISDIR(st.st_mode)",
          "new_text": null,
          "old_line_content": "            if (S_ISDIR(st.st_mode))",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 298,
          "old_api": "S_ISFIFO",
          "new_api": null,
          "old_text": "S_ISFIFO(st.st_mode)",
          "new_text": null,
          "old_line_content": "            else if (S_ISFIFO(st.st_mode))",
          "new_line_content": "    if (fullpath) {",
          "content_same": false
        },
        {
          "line": 302,
          "old_api": "S_ISBLK",
          "new_api": null,
          "old_text": "S_ISBLK(st.st_mode)",
          "new_text": null,
          "old_line_content": "            else if (S_ISBLK(st.st_mode))",
          "new_line_content": "                (*next)->type = AVIO_ENTRY_DIRECTORY;",
          "content_same": false
        },
        {
          "line": 304,
          "old_api": "S_ISLNK",
          "new_api": null,
          "old_text": "S_ISLNK(st.st_mode)",
          "new_text": null,
          "old_line_content": "            else if (S_ISLNK(st.st_mode))",
          "new_line_content": "                (*next)->type = AVIO_ENTRY_NAMED_PIPE;",
          "content_same": false
        },
        {
          "line": 306,
          "old_api": "S_ISSOCK",
          "new_api": null,
          "old_text": "S_ISSOCK(st.st_mode)",
          "new_text": null,
          "old_line_content": "            else if (S_ISSOCK(st.st_mode))",
          "new_line_content": "                (*next)->type = AVIO_ENTRY_CHARACTER_DEVICE;",
          "content_same": false
        },
        {
          "line": 308,
          "old_api": "S_ISREG",
          "new_api": null,
          "old_text": "S_ISREG(st.st_mode)",
          "new_text": null,
          "old_line_content": "            else if (S_ISREG(st.st_mode))",
          "new_line_content": "                (*next)->type = AVIO_ENTRY_BLOCK_DEVICE;",
          "content_same": false
        },
        {
          "line": 317,
          "old_api": "INT64_C",
          "new_api": null,
          "old_text": "INT64_C(1000000)",
          "new_text": null,
          "old_line_content": "            (*next)->modification_timestamp = INT64_C(1000000) * st.st_mtime;",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 318,
          "old_api": "INT64_C",
          "new_api": null,
          "old_text": "INT64_C(1000000)",
          "new_text": null,
          "old_line_content": "            (*next)->access_timestamp =  INT64_C(1000000) * st.st_atime;",
          "new_line_content": "            (*next)->group_id = st.st_gid;",
          "content_same": false
        },
        {
          "line": 319,
          "old_api": "INT64_C",
          "new_api": null,
          "old_text": "INT64_C(1000000)",
          "new_text": null,
          "old_line_content": "            (*next)->status_change_timestamp = INT64_C(1000000) * st.st_ctime;",
          "new_line_content": "            (*next)->user_id = st.st_uid;",
          "content_same": false
        },
        {
          "line": 321,
          "old_api": "av_free",
          "new_api": null,
          "old_text": "av_free(fullpath)",
          "new_text": null,
          "old_line_content": "        av_free(fullpath);",
          "new_line_content": "            (*next)->filemode = st.st_mode & 0777;",
          "content_same": false
        },
        {
          "line": 327,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(ENOSYS)",
          "new_text": null,
          "old_line_content": "    return AVERROR(ENOSYS);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 335,
          "old_api": "closedir",
          "new_api": null,
          "old_text": "closedir(c->dir)",
          "new_text": null,
          "old_line_content": "    closedir(c->dir);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 338,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(ENOSYS)",
          "new_text": null,
          "old_line_content": "    return AVERROR(ENOSYS);",
          "new_line_content": "#if HAVE_LSTAT",
          "content_same": false
        },
        {
          "line": 370,
          "old_api": "av_strstart",
          "new_api": null,
          "old_text": "av_strstart(filename, \"pipe:\", &filename)",
          "new_text": null,
          "old_line_content": "    av_strstart(filename, \"pipe:\", &filename);",
          "new_line_content": "static int pipe_open(URLContext *h, const char *filename, int flags)",
          "content_same": false
        },
        {
          "line": 243,
          "old_api": "fstat",
          "new_api": null,
          "old_text": "fstat(c->fd, &st)",
          "new_text": null,
          "old_line_content": "        ret = fstat(c->fd, &st);",
          "new_line_content": "    FileContext *c = h->priv_data;",
          "content_same": false
        },
        {
          "line": 244,
          "old_api": "S_ISFIFO",
          "new_api": null,
          "old_text": "S_ISFIFO(st.st_mode)",
          "new_text": null,
          "old_line_content": "        return ret < 0 ? AVERROR(errno) : (S_ISFIFO(st.st_mode) ? 0 : st.st_size);",
          "new_line_content": "    int64_t ret;",
          "content_same": false
        },
        {
          "line": 372,
          "old_api": "strtol",
          "new_api": null,
          "old_text": "strtol(filename, &final, 10)",
          "new_text": null,
          "old_line_content": "    fd = strtol(filename, &final, 10);",
          "new_line_content": "    FileContext *c = h->priv_data;",
          "content_same": false
        },
        {
          "line": 247,
          "old_api": "lseek",
          "new_api": null,
          "old_text": "lseek(c->fd, pos, whence)",
          "new_text": null,
          "old_line_content": "    ret = lseek(c->fd, pos, whence);",
          "new_line_content": "        struct stat st;",
          "content_same": false
        },
        {
          "line": 381,
          "old_api": "setmode",
          "new_api": null,
          "old_text": "setmode(fd, O_BINARY)",
          "new_text": null,
          "old_line_content": "    setmode(fd, O_BINARY);",
          "new_line_content": "        } else {",
          "content_same": false
        },
        {
          "line": 255,
          "old_api": "close",
          "new_api": null,
          "old_text": "close(c->fd)",
          "new_text": null,
          "old_line_content": "    return close(c->fd);",
          "new_line_content": "}",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 8,
      "total_additions": 26,
      "total_deletions": 26,
      "total_api_changes": 60
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 5,
        "api_related_lines": 60,
        "non_api_lines": 5,
        "non_api_line_numbers": [
          232,
          233,
          234,
          235,
          236
        ]
      }
    },
    "api_calls_before": 69,
    "api_calls_after": 69,
    "diff_info": {
      "added_lines": 5,
      "removed_lines": 0,
      "total_diff_lines": 17
    }
  }
}