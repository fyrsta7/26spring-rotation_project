{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/29b75f0b673d92364c57bf3926a8b9168ea0a05b",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/29b75f0b673d92364c57bf3926a8b9168ea0a05b/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/29b75f0b673d92364c57bf3926a8b9168ea0a05b/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/29b75f0b673d92364c57bf3926a8b9168ea0a05b/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 117,
          "old_api": "FFMAX",
          "new_api": "FFMIN",
          "old_text": "FFMAX(v, psd[bin])",
          "new_text": "FFMIN(max - ((v + psd[bin] + 1) >> 1), 255)",
          "old_line_content": "            v = FFMAX(v, psd[bin]) + ff_ac3_log_add_tab[adr];",
          "new_line_content": "            int adr = FFMIN(max - ((v + psd[bin] + 1) >> 1), 255);",
          "content_same": false
        },
        {
          "line": 163,
          "old_api": "FFMAX",
          "new_api": "calc_lowcomp",
          "old_text": "FFMAX(fastleak - s->fast_decay, band_psd[band] - fast_gain)",
          "new_text": "calc_lowcomp(lowcomp, band_psd[band], band_psd[band+1], band)",
          "old_line_content": "            fastleak = FFMAX(fastleak - s->fast_decay, band_psd[band] - fast_gain);",
          "new_line_content": "                lowcomp = calc_lowcomp(lowcomp, band_psd[band], band_psd[band+1], band);",
          "content_same": false
        },
        {
          "line": 231,
          "old_api": "FFMIN",
          "new_api": "FFMAX",
          "old_text": "FFMIN(band_start_tab[band+1], end)",
          "new_text": "FFMAX(mask[band] - snr_offset - floor, 0)",
          "old_line_content": "        int band_end = FFMIN(band_start_tab[band+1], end);",
          "new_line_content": "        int m = (FFMAX(mask[band] - snr_offset - floor, 0) & 0x1FE0) + floor;",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 160,
          "old_api": null,
          "new_api": "FFMIN",
          "old_text": null,
          "new_text": "FFMIN(band_end, 22)",
          "old_line_content": "        for (band = begin; band < end1; band++) {",
          "new_line_content": "        end1 = FFMIN(band_end, 22);",
          "content_same": false
        },
        {
          "line": 224,
          "old_api": null,
          "new_api": "memset",
          "old_text": null,
          "new_text": "memset(bap, 0, 256)",
          "old_line_content": "        return;",
          "new_line_content": "        memset(bap, 0, 256);",
          "content_same": false
        },
        {
          "line": 259,
          "old_api": null,
          "new_api": "ff_ac3_bit_alloc_calc_bap",
          "old_text": null,
          "new_text": "ff_ac3_bit_alloc_calc_bap(mask, psd, start, end, snr_offset, s->floor,\n                              ff_ac3_bap_tab, bap)",
          "old_line_content": "                              ff_ac3_bap_tab, bap);",
          "new_line_content": "    ff_ac3_bit_alloc_calc_bap(mask, psd, start, end, snr_offset, s->floor,",
          "content_same": false
        },
        {
          "line": 166,
          "old_api": null,
          "new_api": "FFMAX",
          "old_text": null,
          "new_text": "FFMAX(fastleak - lowcomp, slowleak)",
          "old_line_content": "        }",
          "new_line_content": "            excite[band] = FFMAX(fastleak - lowcomp, slowleak);",
          "content_same": false
        },
        {
          "line": 232,
          "old_api": null,
          "new_api": "FFMIN",
          "old_text": null,
          "new_text": "FFMIN(band_start_tab[band+1], end)",
          "old_line_content": "        for (; bin < band_end; bin++) {",
          "new_line_content": "        int band_end = FFMIN(band_start_tab[band+1], end);",
          "content_same": false
        },
        {
          "line": 234,
          "old_api": null,
          "new_api": "av_clip",
          "old_text": null,
          "new_text": "av_clip((psd[bin] - m) >> 5, 0, 63)",
          "old_line_content": "            bap[bin] = bap_tab[address];",
          "new_line_content": "            int address = av_clip((psd[bin] - m) >> 5, 0, 63);",
          "content_same": false
        },
        {
          "line": 141,
          "old_api": null,
          "new_api": "calc_lowcomp1",
          "old_text": null,
          "new_text": "calc_lowcomp1(lowcomp, band_psd[0], band_psd[1], 384)",
          "old_line_content": "        excite[0] = band_psd[0] - fast_gain - lowcomp;",
          "new_line_content": "        lowcomp = calc_lowcomp1(lowcomp, band_psd[0], band_psd[1], 384);",
          "content_same": false
        },
        {
          "line": 143,
          "old_api": null,
          "new_api": "calc_lowcomp1",
          "old_text": null,
          "new_text": "calc_lowcomp1(lowcomp, band_psd[1], band_psd[2], 384)",
          "old_line_content": "        excite[1] = band_psd[1] - fast_gain - lowcomp;",
          "new_line_content": "        lowcomp = calc_lowcomp1(lowcomp, band_psd[1], band_psd[2], 384);",
          "content_same": false
        },
        {
          "line": 179,
          "old_api": null,
          "new_api": "FFMAX",
          "old_text": null,
          "new_text": "FFMAX(fastleak, slowleak)",
          "old_line_content": "    }",
          "new_line_content": "        excite[band] = FFMAX(fastleak, slowleak);",
          "content_same": false
        },
        {
          "line": 148,
          "old_api": null,
          "new_api": "calc_lowcomp1",
          "old_text": null,
          "new_text": "calc_lowcomp1(lowcomp, band_psd[band], band_psd[band+1], 384)",
          "old_line_content": "            fastleak = band_psd[band] - fast_gain;",
          "new_line_content": "                lowcomp = calc_lowcomp1(lowcomp, band_psd[band], band_psd[band+1], 384);",
          "content_same": false
        },
        {
          "line": 115,
          "old_api": null,
          "new_api": "FFMAX",
          "old_text": null,
          "new_text": "FFMAX(v, psd[bin])",
          "old_line_content": "            /* logadd */",
          "new_line_content": "            int max = FFMAX(v, psd[bin]);",
          "content_same": false
        },
        {
          "line": 253,
          "old_api": null,
          "new_api": "ff_ac3_bit_alloc_calc_psd",
          "old_text": null,
          "new_text": "ff_ac3_bit_alloc_calc_psd(exp, start, end, psd, band_psd)",
          "old_line_content": "",
          "new_line_content": "    ff_ac3_bit_alloc_calc_psd(exp, start, end, psd, band_psd);",
          "content_same": false
        },
        {
          "line": 189,
          "old_api": null,
          "new_api": "FFMAX",
          "old_text": null,
          "new_text": "FFMAX(ff_ac3_hearing_threshold_tab[band >> s->sr_shift][s->sr_code], excite[band])",
          "old_line_content": "    }",
          "new_line_content": "        mask[band] = FFMAX(ff_ac3_hearing_threshold_tab[band >> s->sr_shift][s->sr_code], excite[band]);",
          "content_same": false
        },
        {
          "line": 255,
          "old_api": null,
          "new_api": "ff_ac3_bit_alloc_calc_mask",
          "old_text": null,
          "new_text": "ff_ac3_bit_alloc_calc_mask(s, band_psd, start, end, fast_gain, is_lfe,\n                               dba_mode, dba_nsegs, dba_offsets, dba_lengths,\n                               dba_values, mask)",
          "old_line_content": "                               dba_mode, dba_nsegs, dba_offsets, dba_lengths,",
          "new_line_content": "    ff_ac3_bit_alloc_calc_mask(s, band_psd, start, end, fast_gain, is_lfe,",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 258,
          "old_api": "ff_ac3_bit_alloc_calc_bap",
          "new_api": null,
          "old_text": "ff_ac3_bit_alloc_calc_bap(mask, psd, start, end, snr_offset, s->floor,\n                              ff_ac3_bap_tab, bap)",
          "new_text": null,
          "old_line_content": "    ff_ac3_bit_alloc_calc_bap(mask, psd, start, end, snr_offset, s->floor,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 162,
          "old_api": "calc_lowcomp",
          "new_api": null,
          "old_text": "calc_lowcomp(lowcomp, band_psd[band], band_psd[band+1], band)",
          "new_text": null,
          "old_line_content": "                lowcomp = calc_lowcomp(lowcomp, band_psd[band], band_psd[band+1], band);",
          "new_line_content": "            if (!(is_lfe && band == 6))",
          "content_same": false
        },
        {
          "line": 223,
          "old_api": "memset",
          "new_api": null,
          "old_text": "memset(bap, 0, 256)",
          "new_text": null,
          "old_line_content": "        memset(bap, 0, 256);",
          "new_line_content": "    if (snr_offset == -960) {",
          "content_same": false
        },
        {
          "line": 230,
          "old_api": "FFMAX",
          "new_api": null,
          "old_text": "FFMAX(mask[band] - snr_offset - floor, 0)",
          "new_text": null,
          "old_line_content": "        int m = (FFMAX(mask[band] - snr_offset - floor, 0) & 0x1FE0) + floor;",
          "new_line_content": "    do {",
          "content_same": false
        },
        {
          "line": 233,
          "old_api": "av_clip",
          "new_api": null,
          "old_text": "av_clip((psd[bin] - m) >> 5, 0, 63)",
          "new_text": null,
          "old_line_content": "            int address = av_clip((psd[bin] - m) >> 5, 0, 63);",
          "new_line_content": "        for (; bin < band_end; bin++) {",
          "content_same": false
        },
        {
          "line": 140,
          "old_api": "calc_lowcomp1",
          "new_api": null,
          "old_text": "calc_lowcomp1(lowcomp, band_psd[0], band_psd[1], 384)",
          "new_text": null,
          "old_line_content": "        lowcomp = calc_lowcomp1(lowcomp, band_psd[0], band_psd[1], 384);",
          "new_line_content": "        lowcomp = 0;",
          "content_same": false
        },
        {
          "line": 142,
          "old_api": "calc_lowcomp1",
          "new_api": null,
          "old_text": "calc_lowcomp1(lowcomp, band_psd[1], band_psd[2], 384)",
          "new_text": null,
          "old_line_content": "        lowcomp = calc_lowcomp1(lowcomp, band_psd[1], band_psd[2], 384);",
          "new_line_content": "        excite[0] = band_psd[0] - fast_gain - lowcomp;",
          "content_same": false
        },
        {
          "line": 176,
          "old_api": "FFMAX",
          "new_api": null,
          "old_text": "FFMAX(fastleak - s->fast_decay, band_psd[band] - fast_gain)",
          "new_text": null,
          "old_line_content": "        fastleak = FFMAX(fastleak - s->fast_decay, band_psd[band] - fast_gain);",
          "new_line_content": "    for (band = begin; band < band_end; band++) {",
          "content_same": false
        },
        {
          "line": 147,
          "old_api": "calc_lowcomp1",
          "new_api": null,
          "old_text": "calc_lowcomp1(lowcomp, band_psd[band], band_psd[band+1], 384)",
          "new_text": null,
          "old_line_content": "                lowcomp = calc_lowcomp1(lowcomp, band_psd[band], band_psd[band+1], 384);",
          "new_line_content": "            if (!(is_lfe && band == 6))",
          "content_same": false
        },
        {
          "line": 116,
          "old_api": "FFABS",
          "new_api": null,
          "old_text": "FFABS(v - psd[bin])",
          "new_text": null,
          "old_line_content": "            int adr = FFMIN(FFABS(v - psd[bin]) >> 1, 255);",
          "new_line_content": "            /* logadd */",
          "content_same": false
        },
        {
          "line": 252,
          "old_api": "ff_ac3_bit_alloc_calc_psd",
          "new_api": null,
          "old_text": "ff_ac3_bit_alloc_calc_psd(exp, start, end, psd, band_psd)",
          "new_text": null,
          "old_line_content": "    ff_ac3_bit_alloc_calc_psd(exp, start, end, psd, band_psd);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 188,
          "old_api": "FFMAX",
          "new_api": null,
          "old_text": "FFMAX(ff_ac3_hearing_threshold_tab[band >> s->sr_shift][s->sr_code], excite[band])",
          "new_text": null,
          "old_line_content": "        mask[band] = FFMAX(ff_ac3_hearing_threshold_tab[band >> s->sr_shift][s->sr_code], excite[band]);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 254,
          "old_api": "ff_ac3_bit_alloc_calc_mask",
          "new_api": null,
          "old_text": "ff_ac3_bit_alloc_calc_mask(s, band_psd, start, end, fast_gain, is_lfe,\n                               dba_mode, dba_nsegs, dba_offsets, dba_lengths,\n                               dba_values, mask)",
          "new_text": null,
          "old_line_content": "    ff_ac3_bit_alloc_calc_mask(s, band_psd, start, end, fast_gain, is_lfe,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 159,
          "old_api": "FFMIN",
          "new_api": null,
          "old_text": "FFMIN(band_end, 22)",
          "new_text": null,
          "old_line_content": "        end1 = FFMIN(band_end, 22);",
          "new_line_content": "",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 3,
      "total_additions": 14,
      "total_deletions": 14,
      "total_api_changes": 31
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 4,
        "api_related_lines": 31,
        "non_api_lines": 1,
        "non_api_line_numbers": [
          118
        ]
      }
    },
    "api_calls_before": 27,
    "api_calls_after": 26,
    "diff_info": {
      "added_lines": 3,
      "removed_lines": 2,
      "total_diff_lines": 18
    }
  }
}