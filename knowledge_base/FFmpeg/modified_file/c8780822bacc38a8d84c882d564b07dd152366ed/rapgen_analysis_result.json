{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/c8780822bacc38a8d84c882d564b07dd152366ed",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/c8780822bacc38a8d84c882d564b07dd152366ed/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/c8780822bacc38a8d84c882d564b07dd152366ed/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/c8780822bacc38a8d84c882d564b07dd152366ed/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 197,
          "old_api": "FFMIN",
          "new_api": "FFMAX",
          "old_text": "FFMIN(minff, ff)",
          "new_text": "FFMAX(maxff, ff)",
          "old_line_content": "            minff= FFMIN(minff, ff);",
          "new_line_content": "            maxff= FFMAX(maxff, ff);",
          "content_same": false
        },
        {
          "line": 198,
          "old_api": "FFMAX",
          "new_api": "FFMIN",
          "old_text": "FFMAX(maxsf, sf)",
          "new_text": "FFMIN(minff, ff)",
          "old_line_content": "            maxsf= FFMAX(maxsf, sf);",
          "new_line_content": "            minff= FFMIN(minff, ff);",
          "content_same": false
        },
        {
          "line": 199,
          "old_api": "FFMIN",
          "new_api": "FFMAX",
          "old_text": "FFMIN(minsf, sf)",
          "new_text": "FFMAX(maxsf, sf)",
          "old_line_content": "            minsf= FFMIN(minsf, sf);",
          "new_line_content": "            maxsf= FFMAX(maxsf, sf);",
          "content_same": false
        },
        {
          "line": 245,
          "old_api": "av_assert0",
          "new_api": "av_log",
          "old_text": "av_assert0(0)",
          "new_text": "av_log(NULL, AV_LOG_ERROR, \"Unsupported sample format\\n\")",
          "old_line_content": "            av_assert0(0);",
          "new_line_content": "            av_log(NULL, AV_LOG_ERROR, \"Unsupported sample format\\n\");",
          "content_same": false
        },
        {
          "line": 258,
          "old_api": "FFALIGN",
          "new_api": "ceil",
          "old_text": "FFALIGN(c->filter_length, 8)",
          "new_text": "ceil(filter_size/factor)",
          "old_line_content": "        c->filter_alloc  = FFALIGN(c->filter_length, 8);",
          "new_line_content": "        c->filter_length = FFMAX((int)ceil(filter_size/factor), 1);",
          "content_same": false
        },
        {
          "line": 259,
          "old_api": "av_calloc",
          "new_api": "FFALIGN",
          "old_text": "av_calloc(c->filter_alloc, (phase_count+1)*c->felem_size)",
          "new_text": "FFALIGN(c->filter_length, 8)",
          "old_line_content": "        c->filter_bank   = av_calloc(c->filter_alloc, (phase_count+1)*c->felem_size);",
          "new_line_content": "        c->filter_alloc  = FFALIGN(c->filter_length, 8);",
          "content_same": false
        },
        {
          "line": 285,
          "old_api": "av_free",
          "new_api": "av_freep",
          "old_text": "av_free(c)",
          "new_text": "av_freep(&c->filter_bank)",
          "old_line_content": "    av_free(c);",
          "new_line_content": "    av_freep(&c->filter_bank);",
          "content_same": false
        },
        {
          "line": 321,
          "old_api": "resample_one",
          "new_api": "FFMIN",
          "old_text": "c->dsp.resample_one(dst, src, dst_size, index2, incr)",
          "new_text": "FFMIN(dst_size, new_size)",
          "old_line_content": "        c->dsp.resample_one(dst, src, dst_size, index2, incr);",
          "new_line_content": "        dst_size= FFMIN(dst_size, new_size);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 385,
          "old_api": null,
          "new_api": "av_rescale",
          "old_text": null,
          "new_text": "av_rescale(num, base, s->in_sample_rate*(int64_t)c->src_incr << c->phase_shift)",
          "old_line_content": "}",
          "new_line_content": "    return av_rescale(num, base, s->in_sample_rate*(int64_t)c->src_incr << c->phase_shift);",
          "content_same": false
        },
        {
          "line": 131,
          "old_api": null,
          "new_api": "lrintf",
          "old_text": null,
          "new_text": "lrintf(tab[i] * scale / (norm - tab[0] + tab[tap_count]))",
          "old_line_content": "            }",
          "new_line_content": "                        av_clip(lrintf(tab[i] * scale / (norm - tab[0] + tab[tap_count])), INT16_MIN, INT16_MAX);",
          "content_same": false
        },
        {
          "line": 260,
          "old_api": null,
          "new_api": "av_calloc",
          "old_text": null,
          "new_text": "av_calloc(c->filter_alloc, (phase_count+1)*c->felem_size)",
          "old_line_content": "        c->filter_type   = filter_type;",
          "new_line_content": "        c->filter_bank   = av_calloc(c->filter_alloc, (phase_count+1)*c->felem_size);",
          "content_same": false
        },
        {
          "line": 136,
          "old_api": null,
          "new_api": "llrint",
          "old_text": null,
          "new_text": "llrint(tab[i] * scale / norm)",
          "old_line_content": "            if (tap_count % 2 == 0) {",
          "new_line_content": "                ((int32_t*)filter)[ph * alloc + i] = av_clipl_int32(llrint(tab[i] * scale / norm));",
          "content_same": false
        },
        {
          "line": 265,
          "old_api": null,
          "new_api": "build_filter",
          "old_text": null,
          "new_text": "build_filter(c, (void*)c->filter_bank, factor, c->filter_length, c->filter_alloc, phase_count, 1<<c->filter_shift, filter_type, kaiser_beta)",
          "old_line_content": "            goto error;",
          "new_line_content": "        if (build_filter(c, (void*)c->filter_bank, factor, c->filter_length, c->filter_alloc, phase_count, 1<<c->filter_shift, filter_type, kaiser_beta))",
          "content_same": false
        },
        {
          "line": 268,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(c->filter_bank + (c->filter_alloc*phase_count  )*c->felem_size, c->filter_bank + (c->filter_alloc - 1)*c->felem_size, c->felem_size)",
          "old_line_content": "    }",
          "new_line_content": "        memcpy(c->filter_bank + (c->filter_alloc*phase_count  )*c->felem_size, c->filter_bank + (c->filter_alloc - 1)*c->felem_size, c->felem_size);",
          "content_same": false
        },
        {
          "line": 396,
          "old_api": null,
          "new_api": "av_rescale_rnd",
          "old_text": null,
          "new_text": "av_rescale_rnd(num, s->out_sample_rate, ((int64_t)s->in_sample_rate) << c->phase_shift, AV_ROUND_UP)",
          "old_line_content": "",
          "new_line_content": "    num = av_rescale_rnd(num, s->out_sample_rate, ((int64_t)s->in_sample_rate) << c->phase_shift, AV_ROUND_UP) + 2;",
          "content_same": false
        },
        {
          "line": 144,
          "old_api": null,
          "new_api": "llrint",
          "old_text": null,
          "new_text": "llrint(tab[i] * scale / (norm - tab[0] + tab[tap_count]))",
          "old_line_content": "            }",
          "new_line_content": "                        av_clipl_int32(llrint(tab[i] * scale / (norm - tab[0] + tab[tap_count])));",
          "content_same": false
        },
        {
          "line": 272,
          "old_api": null,
          "new_api": "av_reduce",
          "old_text": null,
          "new_text": "av_reduce(&c->src_incr, &c->dst_incr, out_rate, in_rate * (int64_t)phase_count, INT32_MAX/2)",
          "old_line_content": "        goto error;",
          "new_line_content": "    if(!av_reduce(&c->src_incr, &c->dst_incr, out_rate, in_rate * (int64_t)phase_count, INT32_MAX/2))",
          "content_same": false
        },
        {
          "line": 400,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(EINVAL)",
          "old_line_content": "",
          "new_line_content": "            return AVERROR(EINVAL);",
          "content_same": false
        },
        {
          "line": 402,
          "old_api": null,
          "new_api": "FFMAX",
          "old_text": null,
          "new_text": "FFMAX(num, (num * c->ideal_dst_incr - 1) / c->dst_incr + 1)",
          "old_line_content": "    }",
          "new_line_content": "        num = FFMAX(num, (num * c->ideal_dst_incr - 1) / c->dst_incr + 1);",
          "content_same": false
        },
        {
          "line": 281,
          "old_api": null,
          "new_api": "swri_resample_dsp_init",
          "old_text": null,
          "new_text": "swri_resample_dsp_init(c)",
          "old_line_content": "",
          "new_line_content": "    swri_resample_dsp_init(c);",
          "content_same": false
        },
        {
          "line": 410,
          "old_api": null,
          "new_api": "swri_realloc_audio",
          "old_text": null,
          "new_text": "swri_realloc_audio(a, s->in_buffer_index + 2*s->in_buffer_count)",
          "old_line_content": "        return ret;",
          "new_line_content": "    if((ret = swri_realloc_audio(a, s->in_buffer_index + 2*s->in_buffer_count)) < 0)",
          "content_same": false
        },
        {
          "line": 412,
          "old_api": null,
          "new_api": "av_assert0",
          "old_text": null,
          "new_text": "av_assert0(a->planar)",
          "old_line_content": "    for(i=0; i<a->ch_count; i++){",
          "new_line_content": "    av_assert0(a->planar);",
          "content_same": false
        },
        {
          "line": 286,
          "old_api": null,
          "new_api": "av_free",
          "old_text": null,
          "new_text": "av_free(c)",
          "old_line_content": "    return NULL;",
          "new_line_content": "    av_free(c);",
          "content_same": false
        },
        {
          "line": 415,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(a->ch[i] + (s->in_buffer_index+s->in_buffer_count+j  )*a->bps,\n                a->ch[i] + (s->in_buffer_index+s->in_buffer_count-j-1)*a->bps, a->bps)",
          "old_line_content": "                a->ch[i] + (s->in_buffer_index+s->in_buffer_count-j-1)*a->bps, a->bps);",
          "new_line_content": "            memcpy(a->ch[i] + (s->in_buffer_index+s->in_buffer_count+j  )*a->bps,",
          "content_same": false
        },
        {
          "line": 294,
          "old_api": null,
          "new_api": "av_freep",
          "old_text": null,
          "new_text": "av_freep(c)",
          "old_line_content": "}",
          "new_line_content": "    av_freep(c);",
          "content_same": false
        },
        {
          "line": 427,
          "old_api": null,
          "new_api": "FFMIN",
          "old_text": null,
          "new_text": "FFMIN(in_count + *out_sz, c->filter_length + 1)",
          "old_line_content": "",
          "new_line_content": "    int n, ch, num = FFMIN(in_count + *out_sz, c->filter_length + 1), res;",
          "content_same": false
        },
        {
          "line": 432,
          "old_api": null,
          "new_api": "swri_realloc_audio",
          "old_text": null,
          "new_text": "swri_realloc_audio(dst, c->filter_length * 2 + 1)",
          "old_line_content": "        return res;",
          "new_line_content": "    if ((res = swri_realloc_audio(dst, c->filter_length * 2 + 1)) < 0)",
          "content_same": false
        },
        {
          "line": 438,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(dst->ch[ch] + ((c->filter_length + n) * c->felem_size),\n                   src->ch[ch] + ((n - *out_sz) * c->felem_size), c->felem_size)",
          "old_line_content": "                   src->ch[ch] + ((n - *out_sz) * c->felem_size), c->felem_size);",
          "new_line_content": "            memcpy(dst->ch[ch] + ((c->filter_length + n) * c->felem_size),",
          "content_same": false
        },
        {
          "line": 183,
          "old_api": null,
          "new_api": "cos",
          "old_text": null,
          "new_text": "cos(i*j*M_PI/LEN)",
          "old_line_content": "            for(j=0; j<LEN; j++){",
          "new_line_content": "                sine[j]= cos(i*j*M_PI/LEN);",
          "content_same": false
        },
        {
          "line": 322,
          "old_api": null,
          "new_api": "resample_one",
          "old_text": null,
          "new_text": "c->dsp.resample_one(dst, src, dst_size, index2, incr)",
          "old_line_content": "",
          "new_line_content": "        c->dsp.resample_one(dst, src, dst_size, index2, incr);",
          "content_same": false
        },
        {
          "line": 195,
          "old_api": null,
          "new_api": "sqrt",
          "old_text": null,
          "new_text": "sqrt(2*ff/LEN)",
          "old_line_content": "            sf= 2*sf/LEN;",
          "new_line_content": "            ff= sqrt(2*ff/LEN);",
          "content_same": false
        },
        {
          "line": 453,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(dst->ch[ch] + ((c->filter_length - n) * c->felem_size),\n                   dst->ch[ch] + ((c->filter_length + n) * c->felem_size),\n                   c->felem_size)",
          "old_line_content": "                   dst->ch[ch] + ((c->filter_length + n) * c->felem_size),",
          "new_line_content": "            memcpy(dst->ch[ch] + ((c->filter_length - n) * c->felem_size),",
          "content_same": false
        },
        {
          "line": 326,
          "old_api": null,
          "new_api": "av_assert2",
          "old_text": null,
          "new_text": "av_assert2(index >= 0)",
          "old_line_content": "        *consumed= index;",
          "new_line_content": "        av_assert2(index >= 0);",
          "content_same": false
        },
        {
          "line": 200,
          "old_api": null,
          "new_api": "FFMIN",
          "old_text": null,
          "new_text": "FFMIN(minsf, sf)",
          "old_line_content": "            if(i%11==0){",
          "new_line_content": "            minsf= FFMIN(minsf, sf);",
          "content_same": false
        },
        {
          "line": 202,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(NULL, AV_LOG_ERROR, \"i:%4d ss:%f ff:%13.6e-%13.6e sf:%13.6e-%13.6e\\n\", i, ss, maxff, minff, maxsf, minsf)",
          "old_line_content": "                minff=minsf= 2;",
          "new_line_content": "                av_log(NULL, AV_LOG_ERROR, \"i:%4d ss:%f ff:%13.6e-%13.6e sf:%13.6e-%13.6e\\n\", i, ss, maxff, minff, maxsf, minsf);",
          "content_same": false
        },
        {
          "line": 461,
          "old_api": null,
          "new_api": "FFMAX",
          "old_text": null,
          "new_text": "FFMAX(*out_sz + c->filter_length,\n                    1 + c->filter_length * 2)",
          "old_line_content": "                    1 + c->filter_length * 2) - *out_idx;",
          "new_line_content": "    *out_sz = FFMAX(*out_sz + c->filter_length,",
          "content_same": false
        },
        {
          "line": 337,
          "old_api": null,
          "new_api": "FFMIN",
          "old_text": null,
          "new_text": "FFMIN(dst_size, delta_n)",
          "old_line_content": "        if (dst_size > 0) {",
          "new_line_content": "        dst_size = FFMIN(dst_size, delta_n);",
          "content_same": false
        },
        {
          "line": 210,
          "old_api": null,
          "new_api": "av_free",
          "old_text": null,
          "new_text": "av_free(tab)",
          "old_line_content": "    return 0;",
          "new_line_content": "    av_free(tab);",
          "content_same": false
        },
        {
          "line": 339,
          "old_api": null,
          "new_api": "resample",
          "old_text": null,
          "new_text": "c->dsp.resample(c, dst, src, dst_size, update_ctx)",
          "old_line_content": "        } else {",
          "new_line_content": "            *consumed = c->dsp.resample(c, dst, src, dst_size, update_ctx);",
          "content_same": false
        },
        {
          "line": 465,
          "old_api": null,
          "new_api": "FFMAX",
          "old_text": null,
          "new_text": "FFMAX(res, 0)",
          "old_line_content": "}",
          "new_line_content": "    return FFMAX(res, 0);",
          "content_same": false
        },
        {
          "line": 219,
          "old_api": null,
          "new_api": "FFMIN",
          "old_text": null,
          "new_text": "FFMIN(out_rate * cutoff / in_rate, 1.0)",
          "old_line_content": "    int phase_count= 1<<phase_shift;",
          "new_line_content": "    double factor= FFMIN(out_rate * cutoff / in_rate, 1.0);",
          "content_same": false
        },
        {
          "line": 350,
          "old_api": null,
          "new_api": "av_get_cpu_flags",
          "old_text": null,
          "new_text": "av_get_cpu_flags()",
          "old_line_content": "    int need_emms = c->format == AV_SAMPLE_FMT_S16P && ARCH_X86_32 &&",
          "new_line_content": "    int av_unused mm_flags = av_get_cpu_flags();",
          "content_same": false
        },
        {
          "line": 223,
          "old_api": null,
          "new_api": "ceil",
          "old_text": null,
          "new_text": "ceil(filter_size/factor)",
          "old_line_content": "           || c->filter_type != filter_type || c->kaiser_beta != kaiser_beta) {",
          "new_line_content": "           || c->filter_length != FFMAX((int)ceil(filter_size/factor), 1) || c->format != format",
          "content_same": false
        },
        {
          "line": 225,
          "old_api": null,
          "new_api": "av_mallocz",
          "old_text": null,
          "new_text": "av_mallocz(sizeof(*c))",
          "old_line_content": "        if (!c)",
          "new_line_content": "        c = av_mallocz(sizeof(*c));",
          "content_same": false
        },
        {
          "line": 357,
          "old_api": null,
          "new_api": "FFMIN",
          "old_text": null,
          "new_text": "FFMIN(src_size, max_src_size)",
          "old_line_content": "",
          "new_line_content": "    src_size = FFMIN(src_size, max_src_size);",
          "content_same": false
        },
        {
          "line": 231,
          "old_api": null,
          "new_api": "av_get_bytes_per_sample",
          "old_text": null,
          "new_text": "av_get_bytes_per_sample(c->format)",
          "old_line_content": "",
          "new_line_content": "        c->felem_size= av_get_bytes_per_sample(c->format);",
          "content_same": false
        },
        {
          "line": 360,
          "old_api": null,
          "new_api": "swri_resample",
          "old_text": null,
          "new_text": "swri_resample(c, dst->ch[i], src->ch[i],\n                           consumed, src_size, dst_size, i+1==dst->ch_count)",
          "old_line_content": "                           consumed, src_size, dst_size, i+1==dst->ch_count);",
          "new_line_content": "        ret= swri_resample(c, dst->ch[i], src->ch[i],",
          "content_same": false
        },
        {
          "line": 108,
          "old_api": null,
          "new_api": "FFMAX",
          "old_text": null,
          "new_text": "FFMAX(1-w*w, 0)",
          "old_line_content": "                break;",
          "new_line_content": "                y *= bessel(kaiser_beta*sqrt(FFMAX(1-w*w, 0)));",
          "content_same": false
        },
        {
          "line": 364,
          "old_api": null,
          "new_api": "emms_c",
          "old_text": null,
          "new_text": "emms_c()",
          "old_line_content": "",
          "new_line_content": "        emms_c();",
          "content_same": false
        },
        {
          "line": 111,
          "old_api": null,
          "new_api": "av_assert0",
          "old_text": null,
          "new_text": "av_assert0(0)",
          "old_line_content": "            }",
          "new_line_content": "                av_assert0(0);",
          "content_same": false
        },
        {
          "line": 246,
          "old_api": null,
          "new_api": "av_assert0",
          "old_text": null,
          "new_text": "av_assert0(0)",
          "old_line_content": "        }",
          "new_line_content": "            av_assert0(0);",
          "content_same": false
        },
        {
          "line": 250,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(NULL, AV_LOG_ERROR, \"Filter length too large\\n\")",
          "old_line_content": "            goto error;",
          "new_line_content": "            av_log(NULL, AV_LOG_ERROR, \"Filter length too large\\n\");",
          "content_same": false
        },
        {
          "line": 123,
          "old_api": null,
          "new_api": "lrintf",
          "old_text": null,
          "new_text": "lrintf(tab[i] * scale / norm)",
          "old_line_content": "            if (tap_count % 2 == 0) {",
          "new_line_content": "                ((int16_t*)filter)[ph * alloc + i] = av_clip(lrintf(tab[i] * scale / norm), INT16_MIN, INT16_MAX);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 384,
          "old_api": "av_rescale",
          "new_api": null,
          "old_text": "av_rescale(num, base, s->in_sample_rate*(int64_t)c->src_incr << c->phase_shift)",
          "new_text": null,
          "old_line_content": "    return av_rescale(num, base, s->in_sample_rate*(int64_t)c->src_incr << c->phase_shift);",
          "new_line_content": "    num -= c->frac;",
          "content_same": false
        },
        {
          "line": 257,
          "old_api": "ceil",
          "new_api": null,
          "old_text": "ceil(filter_size/factor)",
          "new_text": null,
          "old_line_content": "        c->filter_length = FFMAX((int)ceil(filter_size/factor), 1);",
          "new_line_content": "        c->factor        = factor;",
          "content_same": false
        },
        {
          "line": 130,
          "old_api": "lrintf",
          "new_api": null,
          "old_text": "lrintf(tab[i] * scale / (norm - tab[0] + tab[tap_count]))",
          "new_text": null,
          "old_line_content": "                        av_clip(lrintf(tab[i] * scale / (norm - tab[0] + tab[tap_count])), INT16_MIN, INT16_MAX);",
          "new_line_content": "                    ((int16_t*)filter)[(phase_count-ph) * alloc + tap_count-i] =",
          "content_same": false
        },
        {
          "line": 135,
          "old_api": "llrint",
          "new_api": null,
          "old_text": "llrint(tab[i] * scale / norm)",
          "new_text": null,
          "old_line_content": "                ((int32_t*)filter)[ph * alloc + i] = av_clipl_int32(llrint(tab[i] * scale / norm));",
          "new_line_content": "            for(i=0;i<tap_count;i++)",
          "content_same": false
        },
        {
          "line": 264,
          "old_api": "build_filter",
          "new_api": null,
          "old_text": "build_filter(c, (void*)c->filter_bank, factor, c->filter_length, c->filter_alloc, phase_count, 1<<c->filter_shift, filter_type, kaiser_beta)",
          "new_text": null,
          "old_line_content": "        if (build_filter(c, (void*)c->filter_bank, factor, c->filter_length, c->filter_alloc, phase_count, 1<<c->filter_shift, filter_type, kaiser_beta))",
          "new_line_content": "            goto error;",
          "content_same": false
        },
        {
          "line": 266,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(c->filter_bank + (c->filter_alloc*phase_count+1)*c->felem_size, c->filter_bank, (c->filter_alloc-1)*c->felem_size)",
          "new_text": null,
          "old_line_content": "        memcpy(c->filter_bank + (c->filter_alloc*phase_count+1)*c->felem_size, c->filter_bank, (c->filter_alloc-1)*c->felem_size);",
          "new_line_content": "            goto error;",
          "content_same": false
        },
        {
          "line": 395,
          "old_api": "av_rescale_rnd",
          "new_api": null,
          "old_text": "av_rescale_rnd(num, s->out_sample_rate, ((int64_t)s->in_sample_rate) << c->phase_shift, AV_ROUND_UP)",
          "new_text": null,
          "old_line_content": "    num = av_rescale_rnd(num, s->out_sample_rate, ((int64_t)s->in_sample_rate) << c->phase_shift, AV_ROUND_UP) + 2;",
          "new_line_content": "    num -= c->index;",
          "content_same": false
        },
        {
          "line": 143,
          "old_api": "llrint",
          "new_api": null,
          "old_text": "llrint(tab[i] * scale / (norm - tab[0] + tab[tap_count]))",
          "new_text": null,
          "old_line_content": "                        av_clipl_int32(llrint(tab[i] * scale / (norm - tab[0] + tab[tap_count])));",
          "new_line_content": "                    ((int32_t*)filter)[(phase_count-ph) * alloc + tap_count-i] =",
          "content_same": false
        },
        {
          "line": 271,
          "old_api": "av_reduce",
          "new_api": null,
          "old_text": "av_reduce(&c->src_incr, &c->dst_incr, out_rate, in_rate * (int64_t)phase_count, INT32_MAX/2)",
          "new_text": null,
          "old_line_content": "    if(!av_reduce(&c->src_incr, &c->dst_incr, out_rate, in_rate * (int64_t)phase_count, INT32_MAX/2))",
          "new_line_content": "    c->compensation_distance= 0;",
          "content_same": false
        },
        {
          "line": 399,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(EINVAL)",
          "new_text": null,
          "old_line_content": "            return AVERROR(EINVAL);",
          "new_line_content": "        if (num > INT_MAX)",
          "content_same": false
        },
        {
          "line": 401,
          "old_api": "FFMAX",
          "new_api": null,
          "old_text": "FFMAX(num, (num * c->ideal_dst_incr - 1) / c->dst_incr + 1)",
          "new_text": null,
          "old_line_content": "        num = FFMAX(num, (num * c->ideal_dst_incr - 1) / c->dst_incr + 1);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 280,
          "old_api": "swri_resample_dsp_init",
          "new_api": null,
          "old_text": "swri_resample_dsp_init(c)",
          "new_text": null,
          "old_line_content": "    swri_resample_dsp_init(c);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 409,
          "old_api": "swri_realloc_audio",
          "new_api": null,
          "old_text": "swri_realloc_audio(a, s->in_buffer_index + 2*s->in_buffer_count)",
          "new_text": null,
          "old_line_content": "    if((ret = swri_realloc_audio(a, s->in_buffer_index + 2*s->in_buffer_count)) < 0)",
          "new_line_content": "    int i, j, ret;",
          "content_same": false
        },
        {
          "line": 411,
          "old_api": "av_assert0",
          "new_api": null,
          "old_text": "av_assert0(a->planar)",
          "new_text": null,
          "old_line_content": "    av_assert0(a->planar);",
          "new_line_content": "        return ret;",
          "content_same": false
        },
        {
          "line": 284,
          "old_api": "av_freep",
          "new_api": null,
          "old_text": "av_freep(&c->filter_bank)",
          "new_text": null,
          "old_line_content": "    av_freep(&c->filter_bank);",
          "new_line_content": "error:",
          "content_same": false
        },
        {
          "line": 414,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(a->ch[i] + (s->in_buffer_index+s->in_buffer_count+j  )*a->bps,\n                a->ch[i] + (s->in_buffer_index+s->in_buffer_count-j-1)*a->bps, a->bps)",
          "new_text": null,
          "old_line_content": "            memcpy(a->ch[i] + (s->in_buffer_index+s->in_buffer_count+j  )*a->bps,",
          "new_line_content": "        for(j=0; j<s->in_buffer_count; j++){",
          "content_same": false
        },
        {
          "line": 292,
          "old_api": "av_freep",
          "new_api": null,
          "old_text": "av_freep(&(*c)->filter_bank)",
          "new_text": null,
          "old_line_content": "    av_freep(&(*c)->filter_bank);",
          "new_line_content": "        return;",
          "content_same": false
        },
        {
          "line": 426,
          "old_api": "FFMIN",
          "new_api": null,
          "old_text": "FFMIN(in_count + *out_sz, c->filter_length + 1)",
          "new_text": null,
          "old_line_content": "    int n, ch, num = FFMIN(in_count + *out_sz, c->filter_length + 1), res;",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 431,
          "old_api": "swri_realloc_audio",
          "new_api": null,
          "old_text": "swri_realloc_audio(dst, c->filter_length * 2 + 1)",
          "new_text": null,
          "old_line_content": "    if ((res = swri_realloc_audio(dst, c->filter_length * 2 + 1)) < 0)",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 437,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(dst->ch[ch] + ((c->filter_length + n) * c->felem_size),\n                   src->ch[ch] + ((n - *out_sz) * c->felem_size), c->felem_size)",
          "new_text": null,
          "old_line_content": "            memcpy(dst->ch[ch] + ((c->filter_length + n) * c->felem_size),",
          "new_line_content": "        for (ch = 0; ch < src->ch_count; ch++) {",
          "content_same": false
        },
        {
          "line": 182,
          "old_api": "cos",
          "new_api": null,
          "old_text": "cos(i*j*M_PI/LEN)",
          "new_text": null,
          "old_line_content": "                sine[j]= cos(i*j*M_PI/LEN);",
          "new_line_content": "            for(j=0; j<LEN+tap_count; j++)",
          "content_same": false
        },
        {
          "line": 320,
          "old_api": "FFMIN",
          "new_api": null,
          "old_text": "FFMIN(dst_size, new_size)",
          "new_text": null,
          "old_line_content": "        dst_size= FFMIN(dst_size, new_size);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 193,
          "old_api": "sqrt",
          "new_api": null,
          "old_text": "sqrt(2*ss/LEN)",
          "new_text": null,
          "old_line_content": "            ss= sqrt(2*ss/LEN);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 196,
          "old_api": "FFMAX",
          "new_api": null,
          "old_text": "FFMAX(maxff, ff)",
          "new_text": null,
          "old_line_content": "            maxff= FFMAX(maxff, ff);",
          "new_line_content": "            sf= 2*sf/LEN;",
          "content_same": false
        },
        {
          "line": 325,
          "old_api": "av_assert2",
          "new_api": null,
          "old_text": "av_assert2(index >= 0)",
          "new_text": null,
          "old_line_content": "        av_assert2(index >= 0);",
          "new_line_content": "        index += (frac + dst_size * (int64_t)c->dst_incr_mod) / c->src_incr;",
          "content_same": false
        },
        {
          "line": 452,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(dst->ch[ch] + ((c->filter_length - n) * c->felem_size),\n                   dst->ch[ch] + ((c->filter_length + n) * c->felem_size),\n                   c->felem_size)",
          "new_text": null,
          "old_line_content": "            memcpy(dst->ch[ch] + ((c->filter_length - n) * c->felem_size),",
          "new_line_content": "        for (ch = 0; ch < src->ch_count; ch++) {",
          "content_same": false
        },
        {
          "line": 201,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(NULL, AV_LOG_ERROR, \"i:%4d ss:%f ff:%13.6e-%13.6e sf:%13.6e-%13.6e\\n\", i, ss, maxff, minff, maxsf, minsf)",
          "new_text": null,
          "old_line_content": "                av_log(NULL, AV_LOG_ERROR, \"i:%4d ss:%f ff:%13.6e-%13.6e sf:%13.6e-%13.6e\\n\", i, ss, maxff, minff, maxsf, minsf);",
          "new_line_content": "            if(i%11==0){",
          "content_same": false
        },
        {
          "line": 460,
          "old_api": "FFMAX",
          "new_api": null,
          "old_text": "FFMAX(*out_sz + c->filter_length,\n                    1 + c->filter_length * 2)",
          "new_text": null,
          "old_line_content": "    *out_sz = FFMAX(*out_sz + c->filter_length,",
          "new_line_content": "    *out_idx = c->filter_length + (c->index >> c->phase_shift);",
          "content_same": false
        },
        {
          "line": 336,
          "old_api": "FFMIN",
          "new_api": null,
          "old_text": "FFMIN(dst_size, delta_n)",
          "new_text": null,
          "old_line_content": "        dst_size = FFMIN(dst_size, delta_n);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 209,
          "old_api": "av_free",
          "new_api": null,
          "old_text": "av_free(tab)",
          "new_text": null,
          "old_line_content": "    av_free(tab);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 338,
          "old_api": "resample",
          "new_api": null,
          "old_text": "c->dsp.resample(c, dst, src, dst_size, update_ctx)",
          "new_text": null,
          "old_line_content": "            *consumed = c->dsp.resample(c, dst, src, dst_size, update_ctx);",
          "new_line_content": "        if (dst_size > 0) {",
          "content_same": false
        },
        {
          "line": 464,
          "old_api": "FFMAX",
          "new_api": null,
          "old_text": "FFMAX(res, 0)",
          "new_text": null,
          "old_line_content": "    return FFMAX(res, 0);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 218,
          "old_api": "FFMIN",
          "new_api": null,
          "old_text": "FFMIN(out_rate * cutoff / in_rate, 1.0)",
          "new_text": null,
          "old_line_content": "    double factor= FFMIN(out_rate * cutoff / in_rate, 1.0);",
          "new_line_content": "    double cutoff = cutoff0? cutoff0 : 0.97;",
          "content_same": false
        },
        {
          "line": 349,
          "old_api": "av_get_cpu_flags",
          "new_api": null,
          "old_text": "av_get_cpu_flags()",
          "new_text": null,
          "old_line_content": "    int av_unused mm_flags = av_get_cpu_flags();",
          "new_line_content": "    int i, ret= -1;",
          "content_same": false
        },
        {
          "line": 222,
          "old_api": "ceil",
          "new_api": null,
          "old_text": "ceil(filter_size/factor)",
          "new_text": null,
          "old_line_content": "           || c->filter_length != FFMAX((int)ceil(filter_size/factor), 1) || c->format != format",
          "new_line_content": "    if (!c || c->phase_shift != phase_shift || c->linear!=linear || c->factor != factor",
          "content_same": false
        },
        {
          "line": 224,
          "old_api": "av_mallocz",
          "new_api": null,
          "old_text": "av_mallocz(sizeof(*c))",
          "new_text": null,
          "old_line_content": "        c = av_mallocz(sizeof(*c));",
          "new_line_content": "           || c->filter_type != filter_type || c->kaiser_beta != kaiser_beta) {",
          "content_same": false
        },
        {
          "line": 355,
          "old_api": "FFMIN",
          "new_api": null,
          "old_text": "FFMIN(dst_size, c->compensation_distance)",
          "new_text": null,
          "old_line_content": "        dst_size = FFMIN(dst_size, c->compensation_distance);",
          "new_line_content": "    if (c->compensation_distance)",
          "content_same": false
        },
        {
          "line": 230,
          "old_api": "av_get_bytes_per_sample",
          "new_api": null,
          "old_text": "av_get_bytes_per_sample(c->format)",
          "new_text": null,
          "old_line_content": "        c->felem_size= av_get_bytes_per_sample(c->format);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 359,
          "old_api": "swri_resample",
          "new_api": null,
          "old_text": "swri_resample(c, dst->ch[i], src->ch[i],\n                           consumed, src_size, dst_size, i+1==dst->ch_count)",
          "new_text": null,
          "old_line_content": "        ret= swri_resample(c, dst->ch[i], src->ch[i],",
          "new_line_content": "    for(i=0; i<dst->ch_count; i++){",
          "content_same": false
        },
        {
          "line": 107,
          "old_api": "FFMAX",
          "new_api": null,
          "old_text": "FFMAX(1-w*w, 0)",
          "new_text": null,
          "old_line_content": "                y *= bessel(kaiser_beta*sqrt(FFMAX(1-w*w, 0)));",
          "new_line_content": "                w = 2.0*x / (factor*tap_count*M_PI);",
          "content_same": false
        },
        {
          "line": 363,
          "old_api": "emms_c",
          "new_api": null,
          "old_text": "emms_c()",
          "new_text": null,
          "old_line_content": "        emms_c();",
          "new_line_content": "    if(need_emms)",
          "content_same": false
        },
        {
          "line": 110,
          "old_api": "av_assert0",
          "new_api": null,
          "old_text": "av_assert0(0)",
          "new_text": null,
          "old_line_content": "                av_assert0(0);",
          "new_line_content": "            default:",
          "content_same": false
        },
        {
          "line": 244,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(NULL, AV_LOG_ERROR, \"Unsupported sample format\\n\")",
          "new_text": null,
          "old_line_content": "            av_log(NULL, AV_LOG_ERROR, \"Unsupported sample format\\n\");",
          "new_line_content": "        default:",
          "content_same": false
        },
        {
          "line": 249,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(NULL, AV_LOG_ERROR, \"Filter length too large\\n\")",
          "new_text": null,
          "old_line_content": "            av_log(NULL, AV_LOG_ERROR, \"Filter length too large\\n\");",
          "new_line_content": "        if (filter_size/factor > INT32_MAX/256) {",
          "content_same": false
        },
        {
          "line": 122,
          "old_api": "lrintf",
          "new_api": null,
          "old_text": "lrintf(tab[i] * scale / norm)",
          "new_text": null,
          "old_line_content": "                ((int16_t*)filter)[ph * alloc + i] = av_clip(lrintf(tab[i] * scale / norm), INT16_MIN, INT16_MAX);",
          "new_line_content": "            for(i=0;i<tap_count;i++)",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 8,
      "total_additions": 45,
      "total_deletions": 45,
      "total_api_changes": 98
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 3,
        "api_related_lines": 98,
        "non_api_lines": 3,
        "non_api_line_numbers": [
          104,
          76,
          103
        ]
      }
    },
    "api_calls_before": 74,
    "api_calls_after": 72,
    "diff_info": {
      "added_lines": 3,
      "removed_lines": 2,
      "total_diff_lines": 24
    }
  }
}