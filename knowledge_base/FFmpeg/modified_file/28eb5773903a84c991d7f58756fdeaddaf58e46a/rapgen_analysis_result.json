{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/28eb5773903a84c991d7f58756fdeaddaf58e46a",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/28eb5773903a84c991d7f58756fdeaddaf58e46a/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/28eb5773903a84c991d7f58756fdeaddaf58e46a/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/28eb5773903a84c991d7f58756fdeaddaf58e46a/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 759,
          "old_api": "av_get_packet",
          "new_api": "url_ftell",
          "old_text": "av_get_packet(pb, pkt, size)",
          "new_text": "url_ftell(pb)",
          "old_line_content": "        err= av_get_packet(pb, pkt, size);",
          "new_line_content": "        avi->last_pkt_pos= url_ftell(pb);",
          "content_same": false
        },
        {
          "line": 819,
          "old_api": "url_feof",
          "new_api": "memset",
          "old_text": "url_feof(pb)",
          "new_text": "memset(d, -1, sizeof(int)*8)",
          "old_line_content": "    for(i=sync=url_ftell(pb); !url_feof(pb); i++) {",
          "new_line_content": "    memset(d, -1, sizeof(int)*8);",
          "content_same": false
        },
        {
          "line": 1009,
          "old_api": "get_le32",
          "new_api": "url_fseek",
          "old_text": "get_le32(s->pb)",
          "new_text": "url_fseek(s->pb, pos + 4, SEEK_SET)",
          "old_line_content": "            size= get_le32(s->pb);",
          "new_line_content": "            url_fseek(s->pb, pos + 4, SEEK_SET);",
          "content_same": false
        },
        {
          "line": 1051,
          "old_api": "avi_read_idx1",
          "new_api": "MKTAG",
          "old_text": "avi_read_idx1(s, size)",
          "new_text": "MKTAG('i', 'd', 'x', '1')",
          "old_line_content": "            if (avi_read_idx1(s, size) < 0)",
          "new_line_content": "        case MKTAG('i', 'd', 'x', '1'):",
          "content_same": false
        },
        {
          "line": 1123,
          "old_api": "av_index_search_timestamp",
          "new_api": "assert",
          "old_text": "av_index_search_timestamp(\n                st2,\n                av_rescale_q(timestamp, st->time_base, st2->time_base) * FFMAX(ast2->sample_size, 1),\n                flags | AVSEEK_FLAG_BACKWARD)",
          "new_text": "assert((int64_t)st2->time_base.num*ast2->rate == (int64_t)st2->time_base.den*ast2->scale)",
          "old_line_content": "        index = av_index_search_timestamp(",
          "new_line_content": "        assert((int64_t)st2->time_base.num*ast2->rate == (int64_t)st2->time_base.den*ast2->scale);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 770,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(pkt->data + pkt->size - 4*256, ast->pal, 4*256)",
          "old_line_content": "            }else",
          "new_line_content": "                memcpy(pkt->data + pkt->size - 4*256, ast->pal, 4*256);",
          "content_same": false
        },
        {
          "line": 898,
          "old_api": null,
          "new_api": "get_byte",
          "old_text": null,
          "new_text": "get_byte(pb)",
          "old_line_content": "",
          "new_line_content": "                int last = (k + get_byte(pb) - 1) & 0xFF;",
          "content_same": false
        },
        {
          "line": 1156,
          "old_api": null,
          "new_api": "av_free",
          "old_text": null,
          "new_text": "av_free(st->codec->palctrl)",
          "old_line_content": "    }",
          "new_line_content": "        av_free(st->codec->palctrl);",
          "content_same": false
        },
        {
          "line": 1029,
          "old_api": null,
          "new_api": "url_ftell",
          "old_text": null,
          "new_text": "url_ftell(pb)",
          "old_line_content": "    int ret = -1;",
          "new_line_content": "    int64_t pos= url_ftell(pb);",
          "content_same": false
        },
        {
          "line": 772,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(s, AV_LOG_ERROR, \"Failed to append palette\\n\")",
          "old_line_content": "        }",
          "new_line_content": "                av_log(s, AV_LOG_ERROR, \"Failed to append palette\\n\");",
          "content_same": false
        },
        {
          "line": 900,
          "old_api": null,
          "new_api": "get_le16",
          "old_text": null,
          "new_text": "get_le16(pb)",
          "old_line_content": "",
          "new_line_content": "                get_le16(pb); //flags",
          "content_same": false
        },
        {
          "line": 1032,
          "old_api": null,
          "new_api": "url_fseek",
          "old_text": null,
          "new_text": "url_fseek(pb, avi->movi_end, SEEK_SET)",
          "old_line_content": "        goto the_end; // maybe truncated file",
          "new_line_content": "    if (url_fseek(pb, avi->movi_end, SEEK_SET) < 0)",
          "content_same": false
        },
        {
          "line": 1160,
          "old_api": null,
          "new_api": "av_free",
          "old_text": null,
          "new_text": "av_free(avi->dv_demux)",
          "old_line_content": "",
          "new_line_content": "        av_free(avi->dv_demux);",
          "content_same": false
        },
        {
          "line": 777,
          "old_api": null,
          "new_api": "dv_produce_packet",
          "old_text": null,
          "new_text": "dv_produce_packet(avi->dv_demux, pkt,\n                                    pkt->data, pkt->size)",
          "old_line_content": "                                    pkt->data, pkt->size);",
          "new_line_content": "            size = dv_produce_packet(avi->dv_demux, pkt,",
          "content_same": false
        },
        {
          "line": 1035,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\"movi_end=0x%\"PRIx64\"\\n\", avi->movi_end)",
          "old_line_content": "#endif",
          "new_line_content": "    printf(\"movi_end=0x%\"PRIx64\"\\n\", avi->movi_end);",
          "content_same": false
        },
        {
          "line": 892,
          "old_api": null,
          "new_api": "url_fskip",
          "old_text": null,
          "new_text": "url_fskip(pb, size)",
          "old_line_content": "                goto resync;",
          "new_line_content": "                url_fskip(pb, size);",
          "content_same": false
        },
        {
          "line": 903,
          "old_api": null,
          "new_api": "get_be32",
          "old_text": null,
          "new_text": "get_be32(pb)",
          "old_line_content": "                ast->has_pal= 1;",
          "new_line_content": "                    ast->pal[k] = get_be32(pb)>>8;// b + (g << 8) + (r << 16);",
          "content_same": false
        },
        {
          "line": 1038,
          "old_api": null,
          "new_api": "url_feof",
          "old_text": null,
          "new_text": "url_feof(pb)",
          "old_line_content": "            break;",
          "new_line_content": "        if (url_feof(pb))",
          "content_same": false
        },
        {
          "line": 1041,
          "old_api": null,
          "new_api": "get_le32",
          "old_text": null,
          "new_text": "get_le32(pb)",
          "old_line_content": "#ifdef DEBUG_SEEK",
          "new_line_content": "        size = get_le32(pb);",
          "content_same": false
        },
        {
          "line": 1043,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\"tag=%c%c%c%c size=0x%x\\n\",\n               tag & 0xff,\n               (tag >> 8) & 0xff,\n               (tag >> 16) & 0xff,\n               (tag >> 24) & 0xff,\n               size)",
          "old_line_content": "               tag & 0xff,",
          "new_line_content": "        printf(\"tag=%c%c%c%c size=0x%x\\n\",",
          "content_same": false
        },
        {
          "line": 1172,
          "old_api": null,
          "new_api": "memcmp",
          "old_text": null,
          "new_text": "memcmp(p->buf+8, avi_headers[i]+4, 4)",
          "old_line_content": "            return AVPROBE_SCORE_MAX;",
          "new_line_content": "           !memcmp(p->buf+8, avi_headers[i]+4, 4))",
          "content_same": false
        },
        {
          "line": 793,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(st->index_entries)",
          "old_line_content": "",
          "new_line_content": "                assert(st->index_entries);",
          "content_same": false
        },
        {
          "line": 795,
          "old_api": null,
          "new_api": "av_index_search_timestamp",
          "old_text": null,
          "new_text": "av_index_search_timestamp(st, ast->frame_offset, 0)",
          "old_line_content": "                e= &st->index_entries[index];",
          "new_line_content": "                index= av_index_search_timestamp(st, ast->frame_offset, 0);",
          "content_same": false
        },
        {
          "line": 1052,
          "old_api": null,
          "new_api": "avi_read_idx1",
          "old_text": null,
          "new_text": "avi_read_idx1(s, size)",
          "old_line_content": "                goto skip;",
          "new_line_content": "            if (avi_read_idx1(s, size) < 0)",
          "content_same": false
        },
        {
          "line": 1180,
          "old_api": null,
          "new_api": "NULL_IF_CONFIG_SMALL",
          "old_text": null,
          "new_text": "NULL_IF_CONFIG_SMALL(\"AVI format\")",
          "old_line_content": "    sizeof(AVIContext),",
          "new_line_content": "    NULL_IF_CONFIG_SMALL(\"AVI format\"),",
          "content_same": false
        },
        {
          "line": 924,
          "old_api": null,
          "new_api": "url_ftell",
          "old_text": null,
          "new_text": "url_ftell(pb)",
          "old_line_content": "                    if(!st->index_entries || !st->nb_index_entries || st->index_entries[st->nb_index_entries - 1].pos < pos){",
          "new_line_content": "                    uint64_t pos= url_ftell(pb) - 8;",
          "content_same": false
        },
        {
          "line": 926,
          "old_api": null,
          "new_api": "av_add_index_entry",
          "old_text": null,
          "new_text": "av_add_index_entry(st, pos, ast->frame_offset, size, 0, AVINDEX_KEYFRAME)",
          "old_line_content": "                    }",
          "new_line_content": "                        av_add_index_entry(st, pos, ast->frame_offset, size, 0, AVINDEX_KEYFRAME);",
          "content_same": false
        },
        {
          "line": 1060,
          "old_api": null,
          "new_api": "url_fseek",
          "old_text": null,
          "new_text": "url_fseek(pb, size, SEEK_CUR)",
          "old_line_content": "                goto the_end; // something is wrong here",
          "new_line_content": "            if (url_fseek(pb, size, SEEK_CUR) < 0)",
          "content_same": false
        },
        {
          "line": 1066,
          "old_api": null,
          "new_api": "url_fseek",
          "old_text": null,
          "new_text": "url_fseek(pb, pos, SEEK_SET)",
          "old_line_content": "    return ret;",
          "new_line_content": "    url_fseek(pb, pos, SEEK_SET);",
          "content_same": false
        },
        {
          "line": 820,
          "old_api": null,
          "new_api": "url_feof",
          "old_text": null,
          "new_text": "url_feof(pb)",
          "old_line_content": "        int j;",
          "new_line_content": "    for(i=sync=url_ftell(pb); !url_feof(pb); i++) {",
          "content_same": false
        },
        {
          "line": 1080,
          "old_api": null,
          "new_api": "avi_load_index",
          "old_text": null,
          "new_text": "avi_load_index(s)",
          "old_line_content": "        avi->index_loaded = 1;",
          "new_line_content": "        avi_load_index(s);",
          "content_same": false
        },
        {
          "line": 825,
          "old_api": null,
          "new_api": "get_byte",
          "old_text": null,
          "new_text": "get_byte(pb)",
          "old_line_content": "",
          "new_line_content": "        d[7]= get_byte(pb);",
          "content_same": false
        },
        {
          "line": 1083,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(stream_index>= 0)",
          "old_line_content": "",
          "new_line_content": "    assert(stream_index>= 0);",
          "content_same": false
        },
        {
          "line": 829,
          "old_api": null,
          "new_api": "get_stream_idx",
          "old_text": null,
          "new_text": "get_stream_idx(d+2)",
          "old_line_content": "//av_log(s, AV_LOG_DEBUG, \"%X %X %X %X %X %X %X %X %\"PRId64\" %d %d\\n\", d[0], d[1], d[2], d[3], d[4], d[5], d[6], d[7], i, size, n);",
          "new_line_content": "        n= get_stream_idx(d+2);",
          "content_same": false
        },
        {
          "line": 958,
          "old_api": null,
          "new_api": "get_le32",
          "old_text": null,
          "new_text": "get_le32(pb)",
          "old_line_content": "#if defined(DEBUG_SEEK)",
          "new_line_content": "        len = get_le32(pb);",
          "content_same": false
        },
        {
          "line": 1087,
          "old_api": null,
          "new_api": "FFMAX",
          "old_text": null,
          "new_text": "FFMAX(ast->sample_size, 1)",
          "old_line_content": "    if(index<0)",
          "new_line_content": "    index= av_index_search_timestamp(st, timestamp * FFMAX(ast->sample_size, 1), flags);",
          "content_same": false
        },
        {
          "line": 960,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(s, AV_LOG_DEBUG, \"%d: tag=0x%x flags=0x%x pos=0x%x len=%d/\",\n               i, tag, flags, pos, len)",
          "old_line_content": "               i, tag, flags, pos, len);",
          "new_line_content": "        av_log(s, AV_LOG_DEBUG, \"%d: tag=0x%x flags=0x%x pos=0x%x len=%d/\",",
          "content_same": false
        },
        {
          "line": 1093,
          "old_api": null,
          "new_api": "FFMAX",
          "old_text": null,
          "new_text": "FFMAX(ast->sample_size, 1)",
          "old_line_content": "",
          "new_line_content": "    timestamp = st->index_entries[index].timestamp / FFMAX(ast->sample_size, 1);",
          "content_same": false
        },
        {
          "line": 839,
          "old_api": null,
          "new_api": "url_fskip",
          "old_text": null,
          "new_text": "url_fskip(pb, size)",
          "old_line_content": "//av_log(s, AV_LOG_DEBUG, \"SKIP\\n\");",
          "new_line_content": "            url_fskip(pb, size);",
          "content_same": false
        },
        {
          "line": 1101,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(stream_index == 0)",
          "old_line_content": "",
          "new_line_content": "        assert(stream_index == 0);",
          "content_same": false
        },
        {
          "line": 846,
          "old_api": null,
          "new_api": "url_fskip",
          "old_text": null,
          "new_text": "url_fskip(pb, 4)",
          "old_line_content": "            goto resync;",
          "new_line_content": "            url_fskip(pb, 4);",
          "content_same": false
        },
        {
          "line": 975,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(s, AV_LOG_DEBUG, \"%d cum_len=%\"PRId64\"\\n\", len, ast->cum_len)",
          "old_line_content": "#endif",
          "new_line_content": "        av_log(s, AV_LOG_DEBUG, \"%d cum_len=%\"PRId64\"\\n\", len, ast->cum_len);",
          "content_same": false
        },
        {
          "line": 1105,
          "old_api": null,
          "new_api": "dv_offset_reset",
          "old_text": null,
          "new_text": "dv_offset_reset(avi->dv_demux, timestamp)",
          "old_line_content": "",
          "new_line_content": "        dv_offset_reset(avi->dv_demux, timestamp);",
          "content_same": false
        },
        {
          "line": 850,
          "old_api": null,
          "new_api": "get_stream_idx",
          "old_text": null,
          "new_text": "get_stream_idx(d)",
          "old_line_content": "",
          "new_line_content": "        n= get_stream_idx(d);",
          "content_same": false
        },
        {
          "line": 1107,
          "old_api": null,
          "new_api": "url_fseek",
          "old_text": null,
          "new_text": "url_fseek(s->pb, pos, SEEK_SET)",
          "old_line_content": "        avi->stream_index= -1;",
          "new_line_content": "        url_fseek(s->pb, pos, SEEK_SET);",
          "content_same": false
        },
        {
          "line": 852,
          "old_api": null,
          "new_api": "get_stream_idx",
          "old_text": null,
          "new_text": "get_stream_idx(d+1)",
          "old_line_content": "            continue;",
          "new_line_content": "        if(!((i-avi->last_pkt_pos)&1) && get_stream_idx(d+1) < s->nb_streams)",
          "content_same": false
        },
        {
          "line": 977,
          "old_api": null,
          "new_api": "url_feof",
          "old_text": null,
          "new_text": "url_feof(pb)",
          "old_line_content": "            return -1;",
          "new_line_content": "        if(url_feof(pb))",
          "content_same": false
        },
        {
          "line": 983,
          "old_api": null,
          "new_api": "av_add_index_entry",
          "old_text": null,
          "new_text": "av_add_index_entry(st, pos, ast->cum_len, len, 0, (flags&AVIIF_INDEX) ? AVINDEX_KEYFRAME : 0)",
          "old_line_content": "        if(ast->sample_size)",
          "new_line_content": "            av_add_index_entry(st, pos, ast->cum_len, len, 0, (flags&AVIIF_INDEX) ? AVINDEX_KEYFRAME : 0);",
          "content_same": false
        },
        {
          "line": 857,
          "old_api": null,
          "new_api": "url_fskip",
          "old_text": null,
          "new_text": "url_fskip(pb, size)",
          "old_line_content": "            goto resync;",
          "new_line_content": "            url_fskip(pb, size);",
          "content_same": false
        },
        {
          "line": 1124,
          "old_api": null,
          "new_api": "av_index_search_timestamp",
          "old_text": null,
          "new_text": "av_index_search_timestamp(\n                st2,\n                av_rescale_q(timestamp, st->time_base, st2->time_base) * FFMAX(ast2->sample_size, 1),\n                flags | AVSEEK_FLAG_BACKWARD)",
          "old_line_content": "                st2,",
          "new_line_content": "        index = av_index_search_timestamp(",
          "content_same": false
        },
        {
          "line": 997,
          "old_api": null,
          "new_api": "url_ftell",
          "old_text": null,
          "new_text": "url_ftell(s->pb)",
          "old_line_content": "",
          "new_line_content": "    int64_t oldpos= url_ftell(s->pb);",
          "content_same": false
        },
        {
          "line": 1126,
          "old_api": null,
          "new_api": "FFMAX",
          "old_text": null,
          "new_text": "FFMAX(ast2->sample_size, 1)",
          "old_line_content": "                flags | AVSEEK_FLAG_BACKWARD);",
          "new_line_content": "                av_rescale_q(timestamp, st->time_base, st2->time_base) * FFMAX(ast2->sample_size, 1),",
          "content_same": false
        },
        {
          "line": 760,
          "old_api": null,
          "new_api": "av_get_packet",
          "old_text": null,
          "new_text": "av_get_packet(pb, pkt, size)",
          "old_line_content": "        if(err<0)",
          "new_line_content": "        err= av_get_packet(pb, pkt, size);",
          "content_same": false
        },
        {
          "line": 882,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(s, AV_LOG_WARNING, \"Invalid stream + prefix combination, assuming audio.\\n\")",
          "old_line_content": "                }",
          "new_line_content": "                    av_log(s, AV_LOG_WARNING, \"Invalid stream + prefix combination, assuming audio.\\n\");",
          "content_same": false
        },
        {
          "line": 1010,
          "old_api": null,
          "new_api": "get_le32",
          "old_text": null,
          "new_text": "get_le32(s->pb)",
          "old_line_content": "            if(pos + size > st->index_entries[1].pos)",
          "new_line_content": "            size= get_le32(s->pb);",
          "content_same": false
        },
        {
          "line": 1144,
          "old_api": null,
          "new_api": "url_fseek",
          "old_text": null,
          "new_text": "url_fseek(s->pb, pos, SEEK_SET)",
          "old_line_content": "    avi->stream_index= -1;",
          "new_line_content": "    url_fseek(s->pb, pos, SEEK_SET);",
          "content_same": false
        },
        {
          "line": 1020,
          "old_api": null,
          "new_api": "url_fseek",
          "old_text": null,
          "new_text": "url_fseek(s->pb, oldpos, SEEK_SET)",
          "old_line_content": "    return last_start > first_end;",
          "new_line_content": "    url_fseek(s->pb, oldpos, SEEK_SET);",
          "content_same": false
        },
        {
          "line": 765,
          "old_api": null,
          "new_api": "av_realloc",
          "old_text": null,
          "new_text": "av_realloc(pkt->data, pkt->size + 4*256 + FF_INPUT_BUFFER_PADDING_SIZE)",
          "old_line_content": "            if(ptr){",
          "new_line_content": "            void *ptr= av_realloc(pkt->data, pkt->size + 4*256 + FF_INPUT_BUFFER_PADDING_SIZE);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 896,
          "old_api": "get_byte",
          "new_api": null,
          "old_text": "get_byte(pb)",
          "new_text": null,
          "old_line_content": "                int k = get_byte(pb);",
          "new_line_content": "            if (d[2] == 'p' && d[3] == 'c' && size<=4*256+4) {",
          "content_same": false
        },
        {
          "line": 769,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(pkt->data + pkt->size - 4*256, ast->pal, 4*256)",
          "new_text": null,
          "old_line_content": "                memcpy(pkt->data + pkt->size - 4*256, ast->pal, 4*256);",
          "new_line_content": "            pkt->data= ptr;",
          "content_same": false
        },
        {
          "line": 1155,
          "old_api": "av_free",
          "new_api": null,
          "old_text": "av_free(st->codec->palctrl)",
          "new_text": null,
          "old_line_content": "        av_free(st->codec->palctrl);",
          "new_line_content": "        AVStream *st = s->streams[i];",
          "content_same": false
        },
        {
          "line": 1028,
          "old_api": "url_ftell",
          "new_api": null,
          "old_text": "url_ftell(pb)",
          "new_text": null,
          "old_line_content": "    int64_t pos= url_ftell(pb);",
          "new_line_content": "    uint32_t tag, size;",
          "content_same": false
        },
        {
          "line": 771,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(s, AV_LOG_ERROR, \"Failed to append palette\\n\")",
          "new_text": null,
          "old_line_content": "                av_log(s, AV_LOG_ERROR, \"Failed to append palette\\n\");",
          "new_line_content": "            }else",
          "content_same": false
        },
        {
          "line": 899,
          "old_api": "get_le16",
          "new_api": null,
          "old_text": "get_le16(pb)",
          "new_text": null,
          "old_line_content": "                get_le16(pb); //flags",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1031,
          "old_api": "url_fseek",
          "new_api": null,
          "old_text": "url_fseek(pb, avi->movi_end, SEEK_SET)",
          "new_text": null,
          "old_line_content": "    if (url_fseek(pb, avi->movi_end, SEEK_SET) < 0)",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1159,
          "old_api": "av_free",
          "new_api": null,
          "old_text": "av_free(avi->dv_demux)",
          "new_text": null,
          "old_line_content": "        av_free(avi->dv_demux);",
          "new_line_content": "    if (avi->dv_demux)",
          "content_same": false
        },
        {
          "line": 776,
          "old_api": "dv_produce_packet",
          "new_api": null,
          "old_text": "dv_produce_packet(avi->dv_demux, pkt,\n                                    pkt->data, pkt->size)",
          "new_text": null,
          "old_line_content": "            size = dv_produce_packet(avi->dv_demux, pkt,",
          "new_line_content": "            dstr = pkt->destruct;",
          "content_same": false
        },
        {
          "line": 1034,
          "old_api": "printf",
          "new_api": null,
          "old_text": "printf(\"movi_end=0x%\"PRIx64\"\\n\", avi->movi_end)",
          "new_text": null,
          "old_line_content": "    printf(\"movi_end=0x%\"PRIx64\"\\n\", avi->movi_end);",
          "new_line_content": "#ifdef DEBUG_SEEK",
          "content_same": false
        },
        {
          "line": 902,
          "old_api": "get_be32",
          "new_api": null,
          "old_text": "get_be32(pb)",
          "new_text": null,
          "old_line_content": "                    ast->pal[k] = get_be32(pb)>>8;// b + (g << 8) + (r << 16);",
          "new_line_content": "                for (; k <= last; k++)",
          "content_same": false
        },
        {
          "line": 1019,
          "old_api": "url_fseek",
          "new_api": null,
          "old_text": "url_fseek(s->pb, oldpos, SEEK_SET)",
          "new_text": null,
          "old_line_content": "    url_fseek(s->pb, oldpos, SEEK_SET);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1037,
          "old_api": "url_feof",
          "new_api": null,
          "old_text": "url_feof(pb)",
          "new_text": null,
          "old_line_content": "        if (url_feof(pb))",
          "new_line_content": "    for(;;) {",
          "content_same": false
        },
        {
          "line": 1039,
          "old_api": "get_le32",
          "new_api": null,
          "old_text": "get_le32(pb)",
          "new_text": null,
          "old_line_content": "        tag = get_le32(pb);",
          "new_line_content": "            break;",
          "content_same": false
        },
        {
          "line": 1042,
          "old_api": "printf",
          "new_api": null,
          "old_text": "printf(\"tag=%c%c%c%c size=0x%x\\n\",\n               tag & 0xff,\n               (tag >> 8) & 0xff,\n               (tag >> 16) & 0xff,\n               (tag >> 24) & 0xff,\n               size)",
          "new_text": null,
          "old_line_content": "        printf(\"tag=%c%c%c%c size=0x%x\\n\",",
          "new_line_content": "#ifdef DEBUG_SEEK",
          "content_same": false
        },
        {
          "line": 1170,
          "old_api": "memcmp",
          "new_api": null,
          "old_text": "memcmp(p->buf  , avi_headers[i]  , 4)",
          "new_text": null,
          "old_line_content": "        if(!memcmp(p->buf  , avi_headers[i]  , 4) &&",
          "new_line_content": "    for(i=0; avi_headers[i][0]; i++)",
          "content_same": false
        },
        {
          "line": 792,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(st->index_entries)",
          "new_text": null,
          "old_line_content": "                assert(st->index_entries);",
          "new_line_content": "                int index;",
          "content_same": false
        },
        {
          "line": 1050,
          "old_api": "MKTAG",
          "new_api": null,
          "old_text": "MKTAG('i', 'd', 'x', '1')",
          "new_text": null,
          "old_line_content": "        case MKTAG('i', 'd', 'x', '1'):",
          "new_line_content": "        switch(tag) {",
          "content_same": false
        },
        {
          "line": 1179,
          "old_api": "NULL_IF_CONFIG_SMALL",
          "new_api": null,
          "old_text": "NULL_IF_CONFIG_SMALL(\"AVI format\")",
          "new_text": null,
          "old_line_content": "    NULL_IF_CONFIG_SMALL(\"AVI format\"),",
          "new_line_content": "    \"avi\",",
          "content_same": false
        },
        {
          "line": 794,
          "old_api": "av_index_search_timestamp",
          "new_api": null,
          "old_text": "av_index_search_timestamp(st, ast->frame_offset, 0)",
          "new_text": null,
          "old_line_content": "                index= av_index_search_timestamp(st, ast->frame_offset, 0);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 923,
          "old_api": "url_ftell",
          "new_api": null,
          "old_text": "url_ftell(pb)",
          "new_text": null,
          "old_line_content": "                    uint64_t pos= url_ftell(pb) - 8;",
          "new_line_content": "                if(size || !ast->sample_size){",
          "content_same": false
        },
        {
          "line": 925,
          "old_api": "av_add_index_entry",
          "new_api": null,
          "old_text": "av_add_index_entry(st, pos, ast->frame_offset, size, 0, AVINDEX_KEYFRAME)",
          "new_text": null,
          "old_line_content": "                        av_add_index_entry(st, pos, ast->frame_offset, size, 0, AVINDEX_KEYFRAME);",
          "new_line_content": "                    if(!st->index_entries || !st->nb_index_entries || st->index_entries[st->nb_index_entries - 1].pos < pos){",
          "content_same": false
        },
        {
          "line": 1059,
          "old_api": "url_fseek",
          "new_api": null,
          "old_text": "url_fseek(pb, size, SEEK_CUR)",
          "new_text": null,
          "old_line_content": "            if (url_fseek(pb, size, SEEK_CUR) < 0)",
          "new_line_content": "            size += (size & 1);",
          "content_same": false
        },
        {
          "line": 1065,
          "old_api": "url_fseek",
          "new_api": null,
          "old_text": "url_fseek(pb, pos, SEEK_SET)",
          "new_text": null,
          "old_line_content": "    url_fseek(pb, pos, SEEK_SET);",
          "new_line_content": " the_end:",
          "content_same": false
        },
        {
          "line": 818,
          "old_api": "memset",
          "new_api": null,
          "old_text": "memset(d, -1, sizeof(int)*8)",
          "new_text": null,
          "old_line_content": "    memset(d, -1, sizeof(int)*8);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1079,
          "old_api": "avi_load_index",
          "new_api": null,
          "old_text": "avi_load_index(s)",
          "new_text": null,
          "old_line_content": "        avi_load_index(s);",
          "new_line_content": "        /* we only load the index on demand */",
          "content_same": false
        },
        {
          "line": 824,
          "old_api": "get_byte",
          "new_api": null,
          "old_text": "get_byte(pb)",
          "new_text": null,
          "old_line_content": "        d[7]= get_byte(pb);",
          "new_line_content": "            d[j]= d[j+1];",
          "content_same": false
        },
        {
          "line": 1082,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(stream_index>= 0)",
          "new_text": null,
          "old_line_content": "    assert(stream_index>= 0);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 954,
          "old_api": "get_le32",
          "new_api": null,
          "old_text": "get_le32(pb)",
          "new_text": null,
          "old_line_content": "        tag = get_le32(pb);",
          "new_line_content": "    for(i = 0; i < nb_index_entries; i++) {",
          "content_same": false
        },
        {
          "line": 828,
          "old_api": "get_stream_idx",
          "new_api": null,
          "old_text": "get_stream_idx(d+2)",
          "new_text": null,
          "old_line_content": "        n= get_stream_idx(d+2);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1086,
          "old_api": "FFMAX",
          "new_api": null,
          "old_text": "FFMAX(ast->sample_size, 1)",
          "new_text": null,
          "old_line_content": "    index= av_index_search_timestamp(st, timestamp * FFMAX(ast->sample_size, 1), flags);",
          "new_line_content": "    ast= st->priv_data;",
          "content_same": false
        },
        {
          "line": 959,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(s, AV_LOG_DEBUG, \"%d: tag=0x%x flags=0x%x pos=0x%x len=%d/\",\n               i, tag, flags, pos, len)",
          "new_text": null,
          "old_line_content": "        av_log(s, AV_LOG_DEBUG, \"%d: tag=0x%x flags=0x%x pos=0x%x len=%d/\",",
          "new_line_content": "#if defined(DEBUG_SEEK)",
          "content_same": false
        },
        {
          "line": 1092,
          "old_api": "FFMAX",
          "new_api": null,
          "old_text": "FFMAX(ast->sample_size, 1)",
          "new_text": null,
          "old_line_content": "    timestamp = st->index_entries[index].timestamp / FFMAX(ast->sample_size, 1);",
          "new_line_content": "    pos = st->index_entries[index].pos;",
          "content_same": false
        },
        {
          "line": 838,
          "old_api": "url_fskip",
          "new_api": null,
          "old_text": "url_fskip(pb, size)",
          "new_text": null,
          "old_line_content": "            url_fskip(pb, size);",
          "new_line_content": "           ||(d[0] == 'i' && d[1] == 'd' && d[2] == 'x' && d[3] == '1')){",
          "content_same": false
        },
        {
          "line": 1100,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(stream_index == 0)",
          "new_text": null,
          "old_line_content": "        assert(stream_index == 0);",
          "new_line_content": "        /* the av_index_search_timestamp call above.                     */",
          "content_same": false
        },
        {
          "line": 845,
          "old_api": "url_fskip",
          "new_api": null,
          "old_text": "url_fskip(pb, 4)",
          "new_text": null,
          "old_line_content": "            url_fskip(pb, 4);",
          "new_line_content": "        if(d[0] == 'L' && d[1] == 'I' && d[2] == 'S' && d[3] == 'T'){",
          "content_same": false
        },
        {
          "line": 974,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(s, AV_LOG_DEBUG, \"%d cum_len=%\"PRId64\"\\n\", len, ast->cum_len)",
          "new_text": null,
          "old_line_content": "        av_log(s, AV_LOG_DEBUG, \"%d cum_len=%\"PRId64\"\\n\", len, ast->cum_len);",
          "new_line_content": "#if defined(DEBUG_SEEK)",
          "content_same": false
        },
        {
          "line": 1104,
          "old_api": "dv_offset_reset",
          "new_api": null,
          "old_text": "dv_offset_reset(avi->dv_demux, timestamp)",
          "new_text": null,
          "old_line_content": "        dv_offset_reset(avi->dv_demux, timestamp);",
          "new_line_content": "        /* DV demux so it can synthesize correct timestamps.        */",
          "content_same": false
        },
        {
          "line": 849,
          "old_api": "get_stream_idx",
          "new_api": null,
          "old_text": "get_stream_idx(d)",
          "new_text": null,
          "old_line_content": "        n= get_stream_idx(d);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1106,
          "old_api": "url_fseek",
          "new_api": null,
          "old_text": "url_fseek(s->pb, pos, SEEK_SET)",
          "new_text": null,
          "old_line_content": "        url_fseek(s->pb, pos, SEEK_SET);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 851,
          "old_api": "get_stream_idx",
          "new_api": null,
          "old_text": "get_stream_idx(d+1)",
          "new_text": null,
          "old_line_content": "        if(!((i-avi->last_pkt_pos)&1) && get_stream_idx(d+1) < s->nb_streams)",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 976,
          "old_api": "url_feof",
          "new_api": null,
          "old_text": "url_feof(pb)",
          "new_text": null,
          "old_line_content": "        if(url_feof(pb))",
          "new_line_content": "#endif",
          "content_same": false
        },
        {
          "line": 982,
          "old_api": "av_add_index_entry",
          "new_api": null,
          "old_text": "av_add_index_entry(st, pos, ast->cum_len, len, 0, (flags&AVIIF_INDEX) ? AVINDEX_KEYFRAME : 0)",
          "new_text": null,
          "old_line_content": "            av_add_index_entry(st, pos, ast->cum_len, len, 0, (flags&AVIIF_INDEX) ? AVINDEX_KEYFRAME : 0);",
          "new_line_content": "        else if(len || !ast->sample_size)",
          "content_same": false
        },
        {
          "line": 856,
          "old_api": "url_fskip",
          "new_api": null,
          "old_text": "url_fskip(pb, size)",
          "new_text": null,
          "old_line_content": "            url_fskip(pb, size);",
          "new_line_content": "        if(d[2] == 'i' && d[3] == 'x' && n < s->nb_streams){",
          "content_same": false
        },
        {
          "line": 1122,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert((int64_t)st2->time_base.num*ast2->rate == (int64_t)st2->time_base.den*ast2->scale)",
          "new_text": null,
          "old_line_content": "        assert((int64_t)st2->time_base.num*ast2->rate == (int64_t)st2->time_base.den*ast2->scale);",
          "new_line_content": "//        assert(st2->codec->block_align);",
          "content_same": false
        },
        {
          "line": 996,
          "old_api": "url_ftell",
          "new_api": null,
          "old_text": "url_ftell(s->pb)",
          "new_text": null,
          "old_line_content": "    int64_t oldpos= url_ftell(s->pb);",
          "new_line_content": "    int64_t first_end= INT64_MAX;",
          "content_same": false
        },
        {
          "line": 1125,
          "old_api": "FFMAX",
          "new_api": null,
          "old_text": "FFMAX(ast2->sample_size, 1)",
          "new_text": null,
          "old_line_content": "                av_rescale_q(timestamp, st->time_base, st2->time_base) * FFMAX(ast2->sample_size, 1),",
          "new_line_content": "                st2,",
          "content_same": false
        },
        {
          "line": 1008,
          "old_api": "url_fseek",
          "new_api": null,
          "old_text": "url_fseek(s->pb, pos + 4, SEEK_SET)",
          "new_text": null,
          "old_line_content": "            url_fseek(s->pb, pos + 4, SEEK_SET);",
          "new_line_content": "            int64_t pos= st->index_entries[0].pos;",
          "content_same": false
        },
        {
          "line": 881,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(s, AV_LOG_WARNING, \"Invalid stream + prefix combination, assuming audio.\\n\")",
          "new_text": null,
          "old_line_content": "                    av_log(s, AV_LOG_WARNING, \"Invalid stream + prefix combination, assuming audio.\\n\");",
          "new_line_content": "                    ast = ast1;",
          "content_same": false
        },
        {
          "line": 758,
          "old_api": "url_ftell",
          "new_api": null,
          "old_text": "url_ftell(pb)",
          "new_text": null,
          "old_line_content": "        avi->last_pkt_pos= url_ftell(pb);",
          "new_line_content": "            size= ast->remaining;",
          "content_same": false
        },
        {
          "line": 1143,
          "old_api": "url_fseek",
          "new_api": null,
          "old_text": "url_fseek(s->pb, pos, SEEK_SET)",
          "new_text": null,
          "old_line_content": "    url_fseek(s->pb, pos, SEEK_SET);",
          "new_line_content": "    /* do the seek */",
          "content_same": false
        },
        {
          "line": 891,
          "old_api": "url_fskip",
          "new_api": null,
          "old_text": "url_fskip(pb, size)",
          "new_text": null,
          "old_line_content": "                url_fskip(pb, size);",
          "new_line_content": "                else                 ast->frame_offset++;",
          "content_same": false
        },
        {
          "line": 764,
          "old_api": "av_realloc",
          "new_api": null,
          "old_text": "av_realloc(pkt->data, pkt->size + 4*256 + FF_INPUT_BUFFER_PADDING_SIZE)",
          "new_text": null,
          "old_line_content": "            void *ptr= av_realloc(pkt->data, pkt->size + 4*256 + FF_INPUT_BUFFER_PADDING_SIZE);",
          "new_line_content": "        if(ast->has_pal && pkt->data && pkt->size<(unsigned)INT_MAX/2){",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 5,
      "total_additions": 53,
      "total_deletions": 53,
      "total_api_changes": 111
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 2,
        "api_related_lines": 111,
        "non_api_lines": 2,
        "non_api_line_numbers": [
          752,
          753
        ]
      }
    },
    "api_calls_before": 261,
    "api_calls_after": 261,
    "diff_info": {
      "added_lines": 2,
      "removed_lines": 1,
      "total_diff_lines": 15
    }
  }
}