{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/42c636c9722f64fe6290ea8eee13658d25f5fbe3",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/42c636c9722f64fe6290ea8eee13658d25f5fbe3/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/42c636c9722f64fe6290ea8eee13658d25f5fbe3/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/42c636c9722f64fe6290ea8eee13658d25f5fbe3/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 46,
          "old_api": "strlen",
          "new_api": "memcmp",
          "old_text": "strlen(key)",
          "new_text": "memcmp(p, key, keylen)",
          "old_line_content": "    p += strlen(key);",
          "new_line_content": "        if (!memcmp(p, key, keylen))",
          "content_same": false
        },
        {
          "line": 76,
          "old_api": "ff_set_dimensions",
          "new_api": "parse_str_int",
          "old_text": "ff_set_dimensions(avctx, width, height)",
          "new_text": "parse_str_int(avpkt->data, end, \"_width\")",
          "old_line_content": "    if ((ret = ff_set_dimensions(avctx, width, height)) < 0)",
          "new_line_content": "    width  = parse_str_int(avpkt->data, end, \"_width\");",
          "content_same": false
        },
        {
          "line": 79,
          "old_api": "ff_get_buffer",
          "new_api": "ff_set_dimensions",
          "old_text": "ff_get_buffer(avctx, p, 0)",
          "new_text": "ff_set_dimensions(avctx, width, height)",
          "old_line_content": "    if ((ret = ff_get_buffer(avctx, p, 0)) < 0)",
          "new_line_content": "    if ((ret = ff_set_dimensions(avctx, width, height)) < 0)",
          "content_same": false
        },
        {
          "line": 103,
          "old_api": "convert",
          "new_api": "av_isxdigit",
          "old_text": "convert(*ptr++)",
          "new_text": "av_isxdigit(*ptr)",
          "old_line_content": "                    val = (val << 4) + convert(*ptr++);",
          "new_line_content": "            if (ptr < end && av_isxdigit(*ptr)) {",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 133,
          "old_api": null,
          "new_api": "NULL_IF_CONFIG_SMALL",
          "old_text": null,
          "new_text": "NULL_IF_CONFIG_SMALL(\"XBM (X BitMap) image\")",
          "old_line_content": "    .decode       = xbm_decode_frame,",
          "new_line_content": "    .long_name    = NULL_IF_CONFIG_SMALL(\"XBM (X BitMap) image\"),",
          "content_same": false
        },
        {
          "line": 104,
          "old_api": null,
          "new_api": "convert",
          "old_text": null,
          "new_text": "convert(*ptr++)",
          "old_line_content": "                *dst++ = ff_reverse[val];",
          "new_line_content": "                val = convert(*ptr++);",
          "content_same": false
        },
        {
          "line": 106,
          "old_api": null,
          "new_api": "convert",
          "old_text": null,
          "new_text": "convert(*ptr++)",
          "old_line_content": "                    j++;",
          "new_line_content": "                    val = (val << 4) + convert(*ptr++);",
          "content_same": false
        },
        {
          "line": 77,
          "old_api": null,
          "new_api": "parse_str_int",
          "old_text": null,
          "new_text": "parse_str_int(avpkt->data, end, \"_height\")",
          "old_line_content": "        return ret;",
          "new_line_content": "    height = parse_str_int(avpkt->data, end, \"_height\");",
          "content_same": false
        },
        {
          "line": 110,
          "old_api": null,
          "new_api": "convert",
          "old_text": null,
          "new_text": "convert(*ptr++)",
          "old_line_content": "                    *dst++ = ff_reverse[val];",
          "new_line_content": "                    val = convert(*ptr++);",
          "content_same": false
        },
        {
          "line": 111,
          "old_api": null,
          "new_api": "av_isxdigit",
          "old_text": null,
          "new_text": "av_isxdigit(*ptr)",
          "old_line_content": "                }",
          "new_line_content": "                    if (av_isxdigit(*ptr))",
          "content_same": false
        },
        {
          "line": 112,
          "old_api": null,
          "new_api": "convert",
          "old_text": null,
          "new_text": "convert(*ptr++)",
          "old_line_content": "            } else {",
          "new_line_content": "                        val = (val << 4) + convert(*ptr++);",
          "content_same": false
        },
        {
          "line": 82,
          "old_api": null,
          "new_api": "ff_get_buffer",
          "old_text": null,
          "new_text": "ff_get_buffer(avctx, p, 0)",
          "old_line_content": "    // goto start of image data",
          "new_line_content": "    if ((ret = ff_get_buffer(avctx, p, 0)) < 0)",
          "content_same": false
        },
        {
          "line": 116,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(avctx, AV_LOG_ERROR,\n                       \"Unexpected data at %.8s.\\n\", ptr)",
          "old_line_content": "            }",
          "new_line_content": "                av_log(avctx, AV_LOG_ERROR,",
          "content_same": false
        },
        {
          "line": 86,
          "old_api": null,
          "new_api": "memchr",
          "old_text": null,
          "new_text": "memchr(ptr, '{', avpkt->size)",
          "old_line_content": "    if (!next)",
          "new_line_content": "    next = memchr(ptr, '{', avpkt->size);",
          "content_same": false
        },
        {
          "line": 55,
          "old_api": null,
          "new_api": "strtol",
          "old_text": null,
          "new_text": "strtol(p, &eptr, 10)",
          "old_line_content": "    }",
          "new_line_content": "        int64_t ret = strtol(p, &eptr, 10);",
          "content_same": false
        },
        {
          "line": 88,
          "old_api": null,
          "new_api": "memchr",
          "old_text": null,
          "new_text": "memchr(ptr, '(', avpkt->size)",
          "old_line_content": "    ptr = next + 1;",
          "new_line_content": "        next = memchr(ptr, '(', avpkt->size);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 130,
          "old_api": "NULL_IF_CONFIG_SMALL",
          "new_api": null,
          "old_text": "NULL_IF_CONFIG_SMALL(\"XBM (X BitMap) image\")",
          "new_text": null,
          "old_line_content": "    .long_name    = NULL_IF_CONFIG_SMALL(\"XBM (X BitMap) image\"),",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 100,
          "old_api": "av_isxdigit",
          "new_api": null,
          "old_text": "av_isxdigit(*ptr)",
          "new_text": null,
          "old_line_content": "            if (ptr < end && av_isxdigit(*ptr)) {",
          "new_line_content": "                ptr++;",
          "content_same": false
        },
        {
          "line": 101,
          "old_api": "convert",
          "new_api": null,
          "old_text": "convert(*ptr++)",
          "new_text": null,
          "old_line_content": "                val = convert(*ptr++);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 102,
          "old_api": "av_isxdigit",
          "new_api": null,
          "old_text": "av_isxdigit(*ptr)",
          "new_text": null,
          "old_line_content": "                if (av_isxdigit(*ptr))",
          "new_line_content": "            ptr ++;",
          "content_same": false
        },
        {
          "line": 73,
          "old_api": "parse_str_int",
          "new_api": null,
          "old_text": "parse_str_int(avpkt->data, end, \"_width\")",
          "new_text": null,
          "old_line_content": "    width  = parse_str_int(avpkt->data, end, \"_width\");",
          "new_line_content": "    avctx->pix_fmt = AV_PIX_FMT_MONOWHITE;",
          "content_same": false
        },
        {
          "line": 74,
          "old_api": "parse_str_int",
          "new_api": null,
          "old_text": "parse_str_int(avpkt->data, end, \"_height\")",
          "new_text": null,
          "old_line_content": "    height = parse_str_int(avpkt->data, end, \"_height\");",
          "new_line_content": "    end = avpkt->data + avpkt->size;",
          "content_same": false
        },
        {
          "line": 43,
          "old_api": "strlen",
          "new_api": null,
          "old_text": "strlen(key)",
          "new_text": null,
          "old_line_content": "        if (!memcmp(p, key, strlen(key)))",
          "new_line_content": "    const uint8_t *e = end - keylen;",
          "content_same": false
        },
        {
          "line": 107,
          "old_api": "convert",
          "new_api": null,
          "old_text": "convert(*ptr++)",
          "new_text": null,
          "old_line_content": "                    val = convert(*ptr++);",
          "new_line_content": "                *dst++ = ff_reverse[val];",
          "content_same": false
        },
        {
          "line": 109,
          "old_api": "convert",
          "new_api": null,
          "old_text": "convert(*ptr++)",
          "new_text": null,
          "old_line_content": "                        val = (val << 4) + convert(*ptr++);",
          "new_line_content": "                    j++;",
          "content_same": false
        },
        {
          "line": 113,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(avctx, AV_LOG_ERROR,\n                       \"Unexpected data at %.8s.\\n\", ptr)",
          "new_text": null,
          "old_line_content": "                av_log(avctx, AV_LOG_ERROR,",
          "new_line_content": "                    *dst++ = ff_reverse[val];",
          "content_same": false
        },
        {
          "line": 83,
          "old_api": "memchr",
          "new_api": null,
          "old_text": "memchr(ptr, '{', avpkt->size)",
          "new_text": null,
          "old_line_content": "    next = memchr(ptr, '{', avpkt->size);",
          "new_line_content": "        return ret;",
          "content_same": false
        },
        {
          "line": 52,
          "old_api": "strtol",
          "new_api": null,
          "old_text": "strtol(p, &eptr, 10)",
          "new_text": null,
          "old_line_content": "        int64_t ret = strtol(p, &eptr, 10);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 85,
          "old_api": "memchr",
          "new_api": null,
          "old_text": "memchr(ptr, '(', avpkt->size)",
          "new_text": null,
          "old_line_content": "        next = memchr(ptr, '(', avpkt->size);",
          "new_line_content": "    // goto start of image data",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 4,
      "total_additions": 12,
      "total_deletions": 13,
      "total_api_changes": 29
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 6,
        "api_related_lines": 29,
        "non_api_lines": 4,
        "non_api_line_numbers": [
          49,
          42,
          44,
          45
        ]
      }
    },
    "api_calls_before": 21,
    "api_calls_after": 19,
    "diff_info": {
      "added_lines": 6,
      "removed_lines": 3,
      "total_diff_lines": 23
    }
  }
}