{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/6cbd0241f216d74ac46c3ab73a36f6e341aa39e6",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/6cbd0241f216d74ac46c3ab73a36f6e341aa39e6/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/6cbd0241f216d74ac46c3ab73a36f6e341aa39e6/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/6cbd0241f216d74ac46c3ab73a36f6e341aa39e6/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 1171,
          "old_api": "av_log",
          "new_api": "bytestream2_get_bytes_left",
          "old_text": "av_log(s->avctx, AV_LOG_ERROR, \"Missing EOC\\n\")",
          "new_text": "bytestream2_get_bytes_left(&s->g)",
          "old_line_content": "            av_log(s->avctx, AV_LOG_ERROR, \"Missing EOC\\n\");",
          "new_line_content": "        if (bytestream2_get_bytes_left(&s->g) < 2) {",
          "content_same": false
        },
        {
          "line": 1176,
          "old_api": "bytestream2_tell",
          "new_api": "bytestream2_get_be16u",
          "old_text": "bytestream2_tell(&s->g)",
          "new_text": "bytestream2_get_be16u(&s->g)",
          "old_line_content": "        oldpos = bytestream2_tell(&s->g);",
          "new_line_content": "        marker = bytestream2_get_be16u(&s->g);",
          "content_same": false
        },
        {
          "line": 1183,
          "old_api": "bytestream2_skip",
          "new_api": "bytestream2_init",
          "old_text": "bytestream2_skip(&s->g, tp->tp_end - s->g.buffer)",
          "new_text": "bytestream2_init(&tp->tpg, s->g.buffer, tp->tp_end - s->g.buffer)",
          "old_line_content": "            bytestream2_skip(&s->g, tp->tp_end - s->g.buffer);",
          "new_line_content": "            bytestream2_init(&tp->tpg, s->g.buffer, tp->tp_end - s->g.buffer);",
          "content_same": false
        },
        {
          "line": 1191,
          "old_api": "AVERROR",
          "new_api": "bytestream2_get_bytes_left",
          "old_text": "AVERROR(EINVAL)",
          "new_text": "bytestream2_get_bytes_left(&s->g)",
          "old_line_content": "            return AVERROR(EINVAL);",
          "new_line_content": "        if (bytestream2_get_bytes_left(&s->g) < 2)",
          "content_same": false
        },
        {
          "line": 1192,
          "old_api": "bytestream2_get_be16u",
          "new_api": "AVERROR",
          "old_text": "bytestream2_get_be16u(&s->g)",
          "new_text": "AVERROR(EINVAL)",
          "old_line_content": "        len = bytestream2_get_be16u(&s->g);",
          "new_line_content": "            return AVERROR(EINVAL);",
          "content_same": false
        },
        {
          "line": 1230,
          "old_api": "bytestream2_skip",
          "new_api": "bytestream2_tell",
          "old_text": "bytestream2_skip(&s->g, len - 2)",
          "new_text": "bytestream2_tell(&s->g)",
          "old_line_content": "            bytestream2_skip(&s->g, len - 2);",
          "new_line_content": "                   marker, bytestream2_tell(&s->g) - 4);",
          "content_same": false
        },
        {
          "line": 1234,
          "old_api": "av_log",
          "new_api": "bytestream2_tell",
          "old_text": "av_log(s->avctx, AV_LOG_ERROR,\n                   \"error during processing marker segment %.4x\\n\", marker)",
          "new_text": "bytestream2_tell(&s->g)",
          "old_line_content": "            av_log(s->avctx, AV_LOG_ERROR,",
          "new_line_content": "        if (bytestream2_tell(&s->g) - oldpos != len || ret) {",
          "content_same": false
        },
        {
          "line": 1268,
          "old_api": "bytestream2_get_be32u",
          "new_api": "bytestream2_get_bytes_left",
          "old_text": "bytestream2_get_be32u(&s->g)",
          "new_text": "bytestream2_get_bytes_left(&s->g)",
          "old_line_content": "        atom_size = bytestream2_get_be32u(&s->g);",
          "new_line_content": "    while (!found_codestream && search_range && bytestream2_get_bytes_left(&s->g) >= 8) {",
          "content_same": false
        },
        {
          "line": 1301,
          "old_api": "AVERROR",
          "new_api": "bytestream2_get_bytes_left",
          "old_text": "AVERROR(EINVAL)",
          "new_text": "bytestream2_get_bytes_left(&s->g)",
          "old_line_content": "        ret = AVERROR(EINVAL);",
          "new_line_content": "    if (bytestream2_get_bytes_left(&s->g) < 2) {",
          "content_same": false
        },
        {
          "line": 1307,
          "old_api": "bytestream2_get_be32u",
          "new_api": "bytestream2_get_bytes_left",
          "old_text": "bytestream2_get_be32u(&s->g)",
          "new_text": "bytestream2_get_bytes_left(&s->g)",
          "old_line_content": "       (bytestream2_get_be32u(&s->g) == 12) &&",
          "new_line_content": "    if (bytestream2_get_bytes_left(&s->g) >= 12 &&",
          "content_same": false
        },
        {
          "line": 1310,
          "old_api": "jp2_find_codestream",
          "new_api": "bytestream2_get_be32u",
          "old_text": "jp2_find_codestream(s)",
          "new_text": "bytestream2_get_be32u(&s->g)",
          "old_line_content": "        if (!jp2_find_codestream(s)) {",
          "new_line_content": "       (bytestream2_get_be32u(&s->g) == JP2_SIG_VALUE)) {",
          "content_same": false
        },
        {
          "line": 1311,
          "old_api": "av_log",
          "new_api": "jp2_find_codestream",
          "old_text": "av_log(avctx, AV_LOG_ERROR,\n                   \"couldn't find jpeg2k codestream atom\\n\")",
          "new_text": "jp2_find_codestream(s)",
          "old_line_content": "            av_log(avctx, AV_LOG_ERROR,",
          "new_line_content": "        if (!jp2_find_codestream(s)) {",
          "content_same": false
        },
        {
          "line": 1321,
          "old_api": "av_log",
          "new_api": "bytestream2_get_be16u",
          "old_text": "av_log(avctx, AV_LOG_ERROR, \"SOC marker not present\\n\")",
          "new_text": "bytestream2_get_be16u(&s->g)",
          "old_line_content": "        av_log(avctx, AV_LOG_ERROR, \"SOC marker not present\\n\");",
          "new_line_content": "    if (bytestream2_get_be16u(&s->g) != JPEG2000_SOC) {",
          "content_same": false
        },
        {
          "line": 1330,
          "old_api": "av_log",
          "new_api": "ff_thread_get_buffer",
          "old_text": "av_log(avctx, AV_LOG_ERROR, \"ff_thread_get_buffer() failed.\\n\")",
          "new_text": "ff_thread_get_buffer(avctx, &frame, 0)",
          "old_line_content": "        av_log(avctx, AV_LOG_ERROR, \"ff_thread_get_buffer() failed.\\n\");",
          "new_line_content": "    if ((ret = ff_thread_get_buffer(avctx, &frame, 0)) < 0) {",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 1153,
          "old_api": null,
          "new_api": "ff_jpeg2000_cleanup",
          "old_text": null,
          "new_text": "ff_jpeg2000_cleanup(comp, codsty)",
          "old_line_content": "        }",
          "new_line_content": "            ff_jpeg2000_cleanup(comp, codsty);",
          "content_same": false
        },
        {
          "line": 1155,
          "old_api": null,
          "new_api": "av_freep",
          "old_text": null,
          "new_text": "av_freep(&s->tile[tileno].comp)",
          "old_line_content": "    }",
          "new_line_content": "        av_freep(&s->tile[tileno].comp);",
          "content_same": false
        },
        {
          "line": 1157,
          "old_api": null,
          "new_api": "av_freep",
          "old_text": null,
          "new_text": "av_freep(&s->tile)",
          "old_line_content": "}",
          "new_line_content": "    av_freep(&s->tile);",
          "content_same": false
        },
        {
          "line": 1295,
          "old_api": null,
          "new_api": "bytestream2_init",
          "old_text": null,
          "new_text": "bytestream2_init(&s->g, avpkt->data, avpkt->size)",
          "old_line_content": "    s->curtileno = -1;",
          "new_line_content": "    bytestream2_init(&s->g, avpkt->data, avpkt->size);",
          "content_same": false
        },
        {
          "line": 1172,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(s->avctx, AV_LOG_ERROR, \"Missing EOC\\n\")",
          "old_line_content": "            break;",
          "new_line_content": "            av_log(s->avctx, AV_LOG_ERROR, \"Missing EOC\\n\");",
          "content_same": false
        },
        {
          "line": 1302,
          "old_api": null,
          "new_api": "AVERROR",
          "old_text": null,
          "new_text": "AVERROR(EINVAL)",
          "old_line_content": "        goto end;",
          "new_line_content": "        ret = AVERROR(EINVAL);",
          "content_same": false
        },
        {
          "line": 1177,
          "old_api": null,
          "new_api": "bytestream2_tell",
          "old_text": null,
          "new_text": "bytestream2_tell(&s->g)",
          "old_line_content": "",
          "new_line_content": "        oldpos = bytestream2_tell(&s->g);",
          "content_same": false
        },
        {
          "line": 1054,
          "old_api": null,
          "new_api": "decode_cblk",
          "old_text": null,
          "new_text": "decode_cblk(s, codsty, &t1, cblk,\n                                    cblk->coord[0][1] - cblk->coord[0][0],\n                                    cblk->coord[1][1] - cblk->coord[1][0],\n                                    bandpos)",
          "old_line_content": "                                    cblk->coord[0][1] - cblk->coord[0][0],",
          "new_line_content": "                        decode_cblk(s, codsty, &t1, cblk,",
          "content_same": false
        },
        {
          "line": 1184,
          "old_api": null,
          "new_api": "bytestream2_skip",
          "old_text": null,
          "new_text": "bytestream2_skip(&s->g, tp->tp_end - s->g.buffer)",
          "old_line_content": "",
          "new_line_content": "            bytestream2_skip(&s->g, tp->tp_end - s->g.buffer);",
          "content_same": false
        },
        {
          "line": 1312,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(avctx, AV_LOG_ERROR,\n                   \"couldn't find jpeg2k codestream atom\\n\")",
          "old_line_content": "                   \"couldn't find jpeg2k codestream atom\\n\");",
          "new_line_content": "            av_log(avctx, AV_LOG_ERROR,",
          "content_same": false
        },
        {
          "line": 1318,
          "old_api": null,
          "new_api": "bytestream2_seek",
          "old_text": null,
          "new_text": "bytestream2_seek(&s->g, 0, SEEK_SET)",
          "old_line_content": "    }",
          "new_line_content": "        bytestream2_seek(&s->g, 0, SEEK_SET);",
          "content_same": false
        },
        {
          "line": 1064,
          "old_api": null,
          "new_api": "dequantization_float",
          "old_text": null,
          "new_text": "dequantization_float(x, y, cblk, comp, &t1, band)",
          "old_line_content": "                        else",
          "new_line_content": "                            dequantization_float(x, y, cblk, comp, &t1, band);",
          "content_same": false
        },
        {
          "line": 1193,
          "old_api": null,
          "new_api": "bytestream2_get_be16u",
          "old_text": null,
          "new_text": "bytestream2_get_be16u(&s->g)",
          "old_line_content": "        switch (marker) {",
          "new_line_content": "        len = bytestream2_get_be16u(&s->g);",
          "content_same": false
        },
        {
          "line": 1066,
          "old_api": null,
          "new_api": "dequantization_int",
          "old_text": null,
          "new_text": "dequantization_int(x, y, cblk, comp, &t1, band)",
          "old_line_content": "                   } /* end cblk */",
          "new_line_content": "                            dequantization_int(x, y, cblk, comp, &t1, band);",
          "content_same": false
        },
        {
          "line": 1322,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(avctx, AV_LOG_ERROR, \"SOC marker not present\\n\")",
          "old_line_content": "        ret = -1;",
          "new_line_content": "        av_log(avctx, AV_LOG_ERROR, \"SOC marker not present\\n\");",
          "content_same": false
        },
        {
          "line": 1196,
          "old_api": null,
          "new_api": "get_siz",
          "old_text": null,
          "new_text": "get_siz(s)",
          "old_line_content": "            if (!s->tile)",
          "new_line_content": "            ret = get_siz(s);",
          "content_same": false
        },
        {
          "line": 1326,
          "old_api": null,
          "new_api": "jpeg2000_read_main_headers",
          "old_text": null,
          "new_text": "jpeg2000_read_main_headers(s)",
          "old_line_content": "        goto end;",
          "new_line_content": "    if (ret = jpeg2000_read_main_headers(s))",
          "content_same": false
        },
        {
          "line": 1073,
          "old_api": null,
          "new_api": "ff_dwt_decode",
          "old_text": null,
          "new_text": "ff_dwt_decode(&comp->dwt, codsty->transform == FF_DWT97 ? (void*)comp->f_data : (void*)comp->i_data)",
          "old_line_content": "    } /*end comp */",
          "new_line_content": "        ff_dwt_decode(&comp->dwt, codsty->transform == FF_DWT97 ? (void*)comp->f_data : (void*)comp->i_data);",
          "content_same": false
        },
        {
          "line": 1201,
          "old_api": null,
          "new_api": "get_coc",
          "old_text": null,
          "new_text": "get_coc(s, codsty, properties)",
          "old_line_content": "            break;",
          "new_line_content": "            ret = get_coc(s, codsty, properties);",
          "content_same": false
        },
        {
          "line": 1331,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(avctx, AV_LOG_ERROR, \"ff_thread_get_buffer() failed.\\n\")",
          "old_line_content": "        goto end;",
          "new_line_content": "        av_log(avctx, AV_LOG_ERROR, \"ff_thread_get_buffer() failed.\\n\");",
          "content_same": false
        },
        {
          "line": 1204,
          "old_api": null,
          "new_api": "get_cod",
          "old_text": null,
          "new_text": "get_cod(s, codsty, properties)",
          "old_line_content": "            break;",
          "new_line_content": "            ret = get_cod(s, codsty, properties);",
          "content_same": false
        },
        {
          "line": 1078,
          "old_api": null,
          "new_api": "mct_decode",
          "old_text": null,
          "new_text": "mct_decode(s, tile)",
          "old_line_content": "",
          "new_line_content": "        mct_decode(s, tile);",
          "content_same": false
        },
        {
          "line": 1207,
          "old_api": null,
          "new_api": "get_qcc",
          "old_text": null,
          "new_text": "get_qcc(s, len, qntsty, properties)",
          "old_line_content": "            break;",
          "new_line_content": "            ret = get_qcc(s, len, qntsty, properties);",
          "content_same": false
        },
        {
          "line": 1337,
          "old_api": null,
          "new_api": "jpeg2000_read_bitstream_packets",
          "old_text": null,
          "new_text": "jpeg2000_read_bitstream_packets(s)",
          "old_line_content": "        goto end;",
          "new_line_content": "    if (ret = jpeg2000_read_bitstream_packets(s))",
          "content_same": false
        },
        {
          "line": 1210,
          "old_api": null,
          "new_api": "get_qcd",
          "old_text": null,
          "new_text": "get_qcd(s, len, qntsty, properties)",
          "old_line_content": "            break;",
          "new_line_content": "            ret = get_qcd(s, len, qntsty, properties);",
          "content_same": false
        },
        {
          "line": 1213,
          "old_api": null,
          "new_api": "get_sot",
          "old_text": null,
          "new_text": "get_sot(s, len)",
          "old_line_content": "                codsty = s->tile[s->curtileno].codsty;",
          "new_line_content": "            if (!(ret = get_sot(s, len))) {",
          "content_same": false
        },
        {
          "line": 1341,
          "old_api": null,
          "new_api": "jpeg2000_decode_tile",
          "old_text": null,
          "new_text": "jpeg2000_decode_tile(s, s->tile + tileno, picture)",
          "old_line_content": "            goto end;",
          "new_line_content": "        if (ret = jpeg2000_decode_tile(s, s->tile + tileno, picture))",
          "content_same": false
        },
        {
          "line": 1344,
          "old_api": null,
          "new_api": "jpeg2000_dec_cleanup",
          "old_text": null,
          "new_text": "jpeg2000_dec_cleanup(s)",
          "old_line_content": "",
          "new_line_content": "    jpeg2000_dec_cleanup(s);",
          "content_same": false
        },
        {
          "line": 1348,
          "old_api": null,
          "new_api": "bytestream2_tell",
          "old_text": null,
          "new_text": "bytestream2_tell(&s->g)",
          "old_line_content": "end:",
          "new_line_content": "    return bytestream2_tell(&s->g);",
          "content_same": false
        },
        {
          "line": 1221,
          "old_api": null,
          "new_api": "bytestream2_skip",
          "old_text": null,
          "new_text": "bytestream2_skip(&s->g, len - 2)",
          "old_line_content": "            break;",
          "new_line_content": "            bytestream2_skip(&s->g, len - 2);",
          "content_same": false
        },
        {
          "line": 1350,
          "old_api": null,
          "new_api": "jpeg2000_dec_cleanup",
          "old_text": null,
          "new_text": "jpeg2000_dec_cleanup(s)",
          "old_line_content": "    return ret;",
          "new_line_content": "    jpeg2000_dec_cleanup(s);",
          "content_same": false
        },
        {
          "line": 1225,
          "old_api": null,
          "new_api": "get_tlm",
          "old_text": null,
          "new_text": "get_tlm(s, len)",
          "old_line_content": "            break;",
          "new_line_content": "            ret = get_tlm(s, len);",
          "content_same": false
        },
        {
          "line": 1098,
          "old_api": null,
          "new_api": "lrintf",
          "old_text": null,
          "new_text": "lrintf(*datap)",
          "old_line_content": "                    else",
          "new_line_content": "                        val = lrintf(*datap) + (1 << (s->cbps[compno] - 1));",
          "content_same": false
        },
        {
          "line": 1228,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(s->avctx, AV_LOG_ERROR,\n                   \"unsupported marker 0x%.4X at pos 0x%X\\n\",\n                   marker, bytestream2_tell(&s->g) - 4)",
          "old_line_content": "                   \"unsupported marker 0x%.4X at pos 0x%X\\n\",",
          "new_line_content": "            av_log(s->avctx, AV_LOG_ERROR,",
          "content_same": false
        },
        {
          "line": 1101,
          "old_api": null,
          "new_api": "av_clip",
          "old_text": null,
          "new_text": "av_clip(val, 0, (1 << s->cbps[compno]) - 1)",
          "old_line_content": "                    *dst = val << (8 - s->cbps[compno]);",
          "new_line_content": "                    val = av_clip(val, 0, (1 << s->cbps[compno]) - 1);",
          "content_same": false
        },
        {
          "line": 1356,
          "old_api": null,
          "new_api": "ff_jpeg2000_init_tier1_luts",
          "old_text": null,
          "new_text": "ff_jpeg2000_init_tier1_luts()",
          "old_line_content": "}",
          "new_line_content": "    ff_jpeg2000_init_tier1_luts();",
          "content_same": false
        },
        {
          "line": 1231,
          "old_api": null,
          "new_api": "bytestream2_skip",
          "old_text": null,
          "new_text": "bytestream2_skip(&s->g, len - 2)",
          "old_line_content": "            break;",
          "new_line_content": "            bytestream2_skip(&s->g, len - 2);",
          "content_same": false
        },
        {
          "line": 1235,
          "old_api": null,
          "new_api": "av_log",
          "old_text": null,
          "new_text": "av_log(s->avctx, AV_LOG_ERROR,\n                   \"error during processing marker segment %.4x\\n\", marker)",
          "old_line_content": "                   \"error during processing marker segment %.4x\\n\", marker);",
          "new_line_content": "            av_log(s->avctx, AV_LOG_ERROR,",
          "content_same": false
        },
        {
          "line": 1364,
          "old_api": null,
          "new_api": "OFFSET",
          "old_text": null,
          "new_text": "OFFSET(lowres)",
          "old_line_content": "    { NULL },",
          "new_line_content": "        OFFSET(lowres), AV_OPT_TYPE_INT, { .i64 = 0 }, 0, JPEG2000_MAX_RESLEVELS - 1, VD },",
          "content_same": false
        },
        {
          "line": 1252,
          "old_api": null,
          "new_api": "init_tile",
          "old_text": null,
          "new_text": "init_tile(s, tileno)",
          "old_line_content": "            return ret;",
          "new_line_content": "        if (ret = init_tile(s, tileno))",
          "content_same": false
        },
        {
          "line": 1128,
          "old_api": null,
          "new_api": "lrintf",
          "old_text": null,
          "new_text": "lrintf(*datap)",
          "old_line_content": "                    else",
          "new_line_content": "                        val = lrintf(*datap) + (1 << (s->cbps[compno] - 1));",
          "content_same": false
        },
        {
          "line": 1256,
          "old_api": null,
          "new_api": "jpeg2000_decode_packets",
          "old_text": null,
          "new_text": "jpeg2000_decode_packets(s, tile)",
          "old_line_content": "            return ret;",
          "new_line_content": "        if (ret = jpeg2000_decode_packets(s, tile))",
          "content_same": false
        },
        {
          "line": 1386,
          "old_api": null,
          "new_api": "NULL_IF_CONFIG_SMALL",
          "old_text": null,
          "new_text": "NULL_IF_CONFIG_SMALL(\"JPEG 2000\")",
          "old_line_content": "    .type             = AVMEDIA_TYPE_VIDEO,",
          "new_line_content": "    .long_name        = NULL_IF_CONFIG_SMALL(\"JPEG 2000\"),",
          "content_same": false
        },
        {
          "line": 1131,
          "old_api": null,
          "new_api": "av_clip",
          "old_text": null,
          "new_text": "av_clip(val, 0, (1 << s->cbps[compno]) - 1)",
          "old_line_content": "                    /* align 12 bit values in little-endian mode */",
          "new_line_content": "                    val = av_clip(val, 0, (1 << s->cbps[compno]) - 1);",
          "content_same": false
        },
        {
          "line": 1395,
          "old_api": null,
          "new_api": "NULL_IF_CONFIG_SMALL",
          "old_text": null,
          "new_text": "NULL_IF_CONFIG_SMALL(profiles)",
          "old_line_content": "};",
          "new_line_content": "    .profiles         = NULL_IF_CONFIG_SMALL(profiles)",
          "content_same": false
        },
        {
          "line": 1270,
          "old_api": null,
          "new_api": "bytestream2_get_be32u",
          "old_text": null,
          "new_text": "bytestream2_get_be32u(&s->g)",
          "old_line_content": "        if (atom == JP2_CODESTREAM) {",
          "new_line_content": "        atom      = bytestream2_get_be32u(&s->g);",
          "content_same": false
        },
        {
          "line": 1274,
          "old_api": null,
          "new_api": "bytestream2_get_bytes_left",
          "old_text": null,
          "new_text": "bytestream2_get_bytes_left(&s->g)",
          "old_line_content": "                return 0;",
          "new_line_content": "            if (bytestream2_get_bytes_left(&s->g) < atom_size - 8)",
          "content_same": false
        },
        {
          "line": 1276,
          "old_api": null,
          "new_api": "bytestream2_skipu",
          "old_text": null,
          "new_text": "bytestream2_skipu(&s->g, atom_size - 8)",
          "old_line_content": "            search_range--;",
          "new_line_content": "            bytestream2_skipu(&s->g, atom_size - 8);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 1152,
          "old_api": "ff_jpeg2000_cleanup",
          "new_api": null,
          "old_text": "ff_jpeg2000_cleanup(comp, codsty)",
          "new_text": null,
          "old_line_content": "            ff_jpeg2000_cleanup(comp, codsty);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1154,
          "old_api": "av_freep",
          "new_api": null,
          "old_text": "av_freep(&s->tile[tileno].comp)",
          "new_text": null,
          "old_line_content": "        av_freep(&s->tile[tileno].comp);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 1156,
          "old_api": "av_freep",
          "new_api": null,
          "old_text": "av_freep(&s->tile)",
          "new_text": null,
          "old_line_content": "    av_freep(&s->tile);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1294,
          "old_api": "bytestream2_init",
          "new_api": null,
          "old_text": "bytestream2_init(&s->g, avpkt->data, avpkt->size)",
          "new_text": null,
          "old_line_content": "    bytestream2_init(&s->g, avpkt->data, avpkt->size);",
          "new_line_content": "    s->avctx     = avctx;",
          "content_same": false
        },
        {
          "line": 1170,
          "old_api": "bytestream2_get_bytes_left",
          "new_api": null,
          "old_text": "bytestream2_get_bytes_left(&s->g)",
          "new_text": null,
          "old_line_content": "        if (bytestream2_get_bytes_left(&s->g) < 2) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1300,
          "old_api": "bytestream2_get_bytes_left",
          "new_api": null,
          "old_text": "bytestream2_get_bytes_left(&s->g)",
          "new_text": null,
          "old_line_content": "    if (bytestream2_get_bytes_left(&s->g) < 2) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1175,
          "old_api": "bytestream2_get_be16u",
          "new_api": null,
          "old_text": "bytestream2_get_be16u(&s->g)",
          "new_text": null,
          "old_line_content": "        marker = bytestream2_get_be16u(&s->g);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1306,
          "old_api": "bytestream2_get_bytes_left",
          "new_api": null,
          "old_text": "bytestream2_get_bytes_left(&s->g)",
          "new_text": null,
          "old_line_content": "    if (bytestream2_get_bytes_left(&s->g) >= 12 &&",
          "new_line_content": "    // check if the image is in jp2 format",
          "content_same": false
        },
        {
          "line": 1053,
          "old_api": "decode_cblk",
          "new_api": null,
          "old_text": "decode_cblk(s, codsty, &t1, cblk,\n                                    cblk->coord[0][1] - cblk->coord[0][0],\n                                    cblk->coord[1][1] - cblk->coord[1][0],\n                                    bandpos)",
          "new_text": null,
          "old_line_content": "                        decode_cblk(s, codsty, &t1, cblk,",
          "new_line_content": "                        Jpeg2000Cblk *cblk = prec->cblk + cblkno;",
          "content_same": false
        },
        {
          "line": 1182,
          "old_api": "bytestream2_init",
          "new_api": null,
          "old_text": "bytestream2_init(&tp->tpg, s->g.buffer, tp->tp_end - s->g.buffer)",
          "new_text": null,
          "old_line_content": "            bytestream2_init(&tp->tpg, s->g.buffer, tp->tp_end - s->g.buffer);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1317,
          "old_api": "bytestream2_seek",
          "new_api": null,
          "old_text": "bytestream2_seek(&s->g, 0, SEEK_SET)",
          "new_text": null,
          "old_line_content": "        bytestream2_seek(&s->g, 0, SEEK_SET);",
          "new_line_content": "    } else {",
          "content_same": false
        },
        {
          "line": 1190,
          "old_api": "bytestream2_get_bytes_left",
          "new_api": null,
          "old_text": "bytestream2_get_bytes_left(&s->g)",
          "new_text": null,
          "old_line_content": "        if (bytestream2_get_bytes_left(&s->g) < 2)",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1063,
          "old_api": "dequantization_float",
          "new_api": null,
          "old_text": "dequantization_float(x, y, cblk, comp, &t1, band)",
          "new_text": null,
          "old_line_content": "                            dequantization_float(x, y, cblk, comp, &t1, band);",
          "new_line_content": "                        if (codsty->transform == FF_DWT97)",
          "content_same": false
        },
        {
          "line": 1320,
          "old_api": "bytestream2_get_be16u",
          "new_api": null,
          "old_text": "bytestream2_get_be16u(&s->g)",
          "new_text": null,
          "old_line_content": "    if (bytestream2_get_be16u(&s->g) != JPEG2000_SOC) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1065,
          "old_api": "dequantization_int",
          "new_api": null,
          "old_text": "dequantization_int(x, y, cblk, comp, &t1, band)",
          "new_text": null,
          "old_line_content": "                            dequantization_int(x, y, cblk, comp, &t1, band);",
          "new_line_content": "                        else",
          "content_same": false
        },
        {
          "line": 1195,
          "old_api": "get_siz",
          "new_api": null,
          "old_text": "get_siz(s)",
          "new_text": null,
          "old_line_content": "            ret = get_siz(s);",
          "new_line_content": "        case JPEG2000_SIZ:",
          "content_same": false
        },
        {
          "line": 1325,
          "old_api": "jpeg2000_read_main_headers",
          "new_api": null,
          "old_text": "jpeg2000_read_main_headers(s)",
          "new_text": null,
          "old_line_content": "    if (ret = jpeg2000_read_main_headers(s))",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1072,
          "old_api": "ff_dwt_decode",
          "new_api": null,
          "old_text": "ff_dwt_decode(&comp->dwt, codsty->transform == FF_DWT97 ? (void*)comp->f_data : (void*)comp->i_data)",
          "new_text": null,
          "old_line_content": "        ff_dwt_decode(&comp->dwt, codsty->transform == FF_DWT97 ? (void*)comp->f_data : (void*)comp->i_data);",
          "new_line_content": "        /* inverse DWT */",
          "content_same": false
        },
        {
          "line": 1200,
          "old_api": "get_coc",
          "new_api": null,
          "old_text": "get_coc(s, codsty, properties)",
          "new_text": null,
          "old_line_content": "            ret = get_coc(s, codsty, properties);",
          "new_line_content": "        case JPEG2000_COC:",
          "content_same": false
        },
        {
          "line": 1329,
          "old_api": "ff_thread_get_buffer",
          "new_api": null,
          "old_text": "ff_thread_get_buffer(avctx, &frame, 0)",
          "new_text": null,
          "old_line_content": "    if ((ret = ff_thread_get_buffer(avctx, &frame, 0)) < 0) {",
          "new_line_content": "    /* get picture buffer */",
          "content_same": false
        },
        {
          "line": 1203,
          "old_api": "get_cod",
          "new_api": null,
          "old_text": "get_cod(s, codsty, properties)",
          "new_text": null,
          "old_line_content": "            ret = get_cod(s, codsty, properties);",
          "new_line_content": "        case JPEG2000_COD:",
          "content_same": false
        },
        {
          "line": 1077,
          "old_api": "mct_decode",
          "new_api": null,
          "old_text": "mct_decode(s, tile)",
          "new_text": null,
          "old_line_content": "        mct_decode(s, tile);",
          "new_line_content": "    if (tile->codsty[0].mct)",
          "content_same": false
        },
        {
          "line": 1206,
          "old_api": "get_qcc",
          "new_api": null,
          "old_text": "get_qcc(s, len, qntsty, properties)",
          "new_text": null,
          "old_line_content": "            ret = get_qcc(s, len, qntsty, properties);",
          "new_line_content": "        case JPEG2000_QCC:",
          "content_same": false
        },
        {
          "line": 1336,
          "old_api": "jpeg2000_read_bitstream_packets",
          "new_api": null,
          "old_text": "jpeg2000_read_bitstream_packets(s)",
          "new_text": null,
          "old_line_content": "    if (ret = jpeg2000_read_bitstream_packets(s))",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1209,
          "old_api": "get_qcd",
          "new_api": null,
          "old_text": "get_qcd(s, len, qntsty, properties)",
          "new_text": null,
          "old_line_content": "            ret = get_qcd(s, len, qntsty, properties);",
          "new_line_content": "        case JPEG2000_QCD:",
          "content_same": false
        },
        {
          "line": 1212,
          "old_api": "get_sot",
          "new_api": null,
          "old_text": "get_sot(s, len)",
          "new_text": null,
          "old_line_content": "            if (!(ret = get_sot(s, len))) {",
          "new_line_content": "        case JPEG2000_SOT:",
          "content_same": false
        },
        {
          "line": 1340,
          "old_api": "jpeg2000_decode_tile",
          "new_api": null,
          "old_text": "jpeg2000_decode_tile(s, s->tile + tileno, picture)",
          "new_text": null,
          "old_line_content": "        if (ret = jpeg2000_decode_tile(s, s->tile + tileno, picture))",
          "new_line_content": "    for (tileno = 0; tileno < s->numXtiles * s->numYtiles; tileno++)",
          "content_same": false
        },
        {
          "line": 1343,
          "old_api": "jpeg2000_dec_cleanup",
          "new_api": null,
          "old_text": "jpeg2000_dec_cleanup(s)",
          "new_text": null,
          "old_line_content": "    jpeg2000_dec_cleanup(s);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1347,
          "old_api": "bytestream2_tell",
          "new_api": null,
          "old_text": "bytestream2_tell(&s->g)",
          "new_text": null,
          "old_line_content": "    return bytestream2_tell(&s->g);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1220,
          "old_api": "bytestream2_skip",
          "new_api": null,
          "old_text": "bytestream2_skip(&s->g, len - 2)",
          "new_text": null,
          "old_line_content": "            bytestream2_skip(&s->g, len - 2);",
          "new_line_content": "            // the comment is ignored",
          "content_same": false
        },
        {
          "line": 1349,
          "old_api": "jpeg2000_dec_cleanup",
          "new_api": null,
          "old_text": "jpeg2000_dec_cleanup(s)",
          "new_text": null,
          "old_line_content": "    jpeg2000_dec_cleanup(s);",
          "new_line_content": "end:",
          "content_same": false
        },
        {
          "line": 1224,
          "old_api": "get_tlm",
          "new_api": null,
          "old_text": "get_tlm(s, len)",
          "new_text": null,
          "old_line_content": "            ret = get_tlm(s, len);",
          "new_line_content": "            // Tile-part lengths",
          "content_same": false
        },
        {
          "line": 1097,
          "old_api": "lrintf",
          "new_api": null,
          "old_text": "lrintf(*datap)",
          "new_text": null,
          "old_line_content": "                        val = lrintf(*datap) + (1 << (s->cbps[compno] - 1));",
          "new_line_content": "                    if (tile->codsty->transform == FF_DWT97)",
          "content_same": false
        },
        {
          "line": 1227,
          "old_api": "av_log",
          "new_api": null,
          "old_text": "av_log(s->avctx, AV_LOG_ERROR,\n                   \"unsupported marker 0x%.4X at pos 0x%X\\n\",\n                   marker, bytestream2_tell(&s->g) - 4)",
          "new_text": null,
          "old_line_content": "            av_log(s->avctx, AV_LOG_ERROR,",
          "new_line_content": "        default:",
          "content_same": false
        },
        {
          "line": 1100,
          "old_api": "av_clip",
          "new_api": null,
          "old_text": "av_clip(val, 0, (1 << s->cbps[compno]) - 1)",
          "new_text": null,
          "old_line_content": "                    val = av_clip(val, 0, (1 << s->cbps[compno]) - 1);",
          "new_line_content": "                        val = *i_datap + (1 << (s->cbps[compno] - 1));",
          "content_same": false
        },
        {
          "line": 1229,
          "old_api": "bytestream2_tell",
          "new_api": null,
          "old_text": "bytestream2_tell(&s->g)",
          "new_text": null,
          "old_line_content": "                   marker, bytestream2_tell(&s->g) - 4);",
          "new_line_content": "                   \"unsupported marker 0x%.4X at pos 0x%X\\n\",",
          "content_same": false
        },
        {
          "line": 1355,
          "old_api": "ff_jpeg2000_init_tier1_luts",
          "new_api": null,
          "old_text": "ff_jpeg2000_init_tier1_luts()",
          "new_text": null,
          "old_line_content": "    ff_jpeg2000_init_tier1_luts();",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 1233,
          "old_api": "bytestream2_tell",
          "new_api": null,
          "old_text": "bytestream2_tell(&s->g)",
          "new_text": null,
          "old_line_content": "        if (bytestream2_tell(&s->g) - oldpos != len || ret) {",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 1363,
          "old_api": "OFFSET",
          "new_api": null,
          "old_text": "OFFSET(lowres)",
          "new_text": null,
          "old_line_content": "        OFFSET(lowres), AV_OPT_TYPE_INT, { .i64 = 0 }, 0, JPEG2000_MAX_RESLEVELS - 1, VD },",
          "new_line_content": "    { \"lowres\",  \"Lower the decoding resolution by a power of two\",",
          "content_same": false
        },
        {
          "line": 1251,
          "old_api": "init_tile",
          "new_api": null,
          "old_text": "init_tile(s, tileno)",
          "new_text": null,
          "old_line_content": "        if (ret = init_tile(s, tileno))",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1127,
          "old_api": "lrintf",
          "new_api": null,
          "old_text": "lrintf(*datap)",
          "new_text": null,
          "old_line_content": "                        val = lrintf(*datap) + (1 << (s->cbps[compno] - 1));",
          "new_line_content": "                    if (tile->codsty->transform == FF_DWT97)",
          "content_same": false
        },
        {
          "line": 1255,
          "old_api": "jpeg2000_decode_packets",
          "new_api": null,
          "old_text": "jpeg2000_decode_packets(s, tile)",
          "new_text": null,
          "old_line_content": "        if (ret = jpeg2000_decode_packets(s, tile))",
          "new_line_content": "        s->g = tile->tile_part[0].tpg;",
          "content_same": false
        },
        {
          "line": 1385,
          "old_api": "NULL_IF_CONFIG_SMALL",
          "new_api": null,
          "old_text": "NULL_IF_CONFIG_SMALL(\"JPEG 2000\")",
          "new_text": null,
          "old_line_content": "    .long_name        = NULL_IF_CONFIG_SMALL(\"JPEG 2000\"),",
          "new_line_content": "    .name             = \"jpeg2000\",",
          "content_same": false
        },
        {
          "line": 1130,
          "old_api": "av_clip",
          "new_api": null,
          "old_text": "av_clip(val, 0, (1 << s->cbps[compno]) - 1)",
          "new_text": null,
          "old_line_content": "                    val = av_clip(val, 0, (1 << s->cbps[compno]) - 1);",
          "new_line_content": "                        val = *i_datap + (1 << (s->cbps[compno] - 1));",
          "content_same": false
        },
        {
          "line": 1394,
          "old_api": "NULL_IF_CONFIG_SMALL",
          "new_api": null,
          "old_text": "NULL_IF_CONFIG_SMALL(profiles)",
          "new_text": null,
          "old_line_content": "    .profiles         = NULL_IF_CONFIG_SMALL(profiles)",
          "new_line_content": "    .max_lowres       = 5,",
          "content_same": false
        },
        {
          "line": 1267,
          "old_api": "bytestream2_get_bytes_left",
          "new_api": null,
          "old_text": "bytestream2_get_bytes_left(&s->g)",
          "new_text": null,
          "old_line_content": "    while (!found_codestream && search_range && bytestream2_get_bytes_left(&s->g) >= 8) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1273,
          "old_api": "bytestream2_get_bytes_left",
          "new_api": null,
          "old_text": "bytestream2_get_bytes_left(&s->g)",
          "new_text": null,
          "old_line_content": "            if (bytestream2_get_bytes_left(&s->g) < atom_size - 8)",
          "new_line_content": "        } else {",
          "content_same": false
        },
        {
          "line": 1275,
          "old_api": "bytestream2_skipu",
          "new_api": null,
          "old_text": "bytestream2_skipu(&s->g, atom_size - 8)",
          "new_text": null,
          "old_line_content": "            bytestream2_skipu(&s->g, atom_size - 8);",
          "new_line_content": "                return 0;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 14,
      "total_additions": 48,
      "total_deletions": 48,
      "total_api_changes": 110
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 8,
        "api_related_lines": 110,
        "non_api_lines": 8,
        "non_api_line_numbers": [
          928,
          929,
          930,
          931,
          932,
          933,
          926,
          927
        ]
      }
    },
    "api_calls_before": 231,
    "api_calls_after": 231,
    "diff_info": {
      "added_lines": 8,
      "removed_lines": 7,
      "total_diff_lines": 27
    }
  }
}