{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/521daf140977238c903a50ba9c704044974724f5",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/521daf140977238c903a50ba9c704044974724f5/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/521daf140977238c903a50ba9c704044974724f5/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/521daf140977238c903a50ba9c704044974724f5/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 150,
          "old_api": "ff_get_video_buffer",
          "new_api": "av_pix_fmt_desc_get",
          "old_text": "ff_get_video_buffer(outlink, AV_PERM_WRITE|AV_PERM_ALIGN, outlink->w, outlink->h)",
          "new_text": "av_pix_fmt_desc_get(inlink->format)",
          "old_line_content": "    outpic = ff_get_video_buffer(outlink, AV_PERM_WRITE|AV_PERM_ALIGN, outlink->w, outlink->h);",
          "new_line_content": "    const int is_packed_rgb = av_pix_fmt_desc_get(inlink->format)->flags & PIX_FMT_RGB;",
          "content_same": false
        },
        {
          "line": 152,
          "old_api": "avfilter_unref_bufferp",
          "new_api": "ff_get_video_buffer",
          "old_text": "avfilter_unref_bufferp(&inpic)",
          "new_text": "ff_get_video_buffer(outlink, AV_PERM_WRITE|AV_PERM_ALIGN, outlink->w, outlink->h)",
          "old_line_content": "        avfilter_unref_bufferp(&inpic);",
          "new_line_content": "    outpic = ff_get_video_buffer(outlink, AV_PERM_WRITE|AV_PERM_ALIGN, outlink->w, outlink->h);",
          "content_same": false
        },
        {
          "line": 155,
          "old_api": "avfilter_copy_buffer_ref_props",
          "new_api": "AVERROR",
          "old_text": "avfilter_copy_buffer_ref_props(outpic, inpic)",
          "new_text": "AVERROR(ENOMEM)",
          "old_line_content": "    avfilter_copy_buffer_ref_props(outpic, inpic);",
          "new_line_content": "        return AVERROR(ENOMEM);",
          "content_same": false
        },
        {
          "line": 211,
          "old_api": "av_pix_fmt_desc_get",
          "new_api": "abs",
          "old_text": "av_pix_fmt_desc_get(inlink->format)",
          "new_text": "abs((int)prvpp[x] - (int)srcpp[x])",
          "old_line_content": "                    int is_packed_rgb = av_pix_fmt_desc_get(inlink->format)->flags & PIX_FMT_RGB;",
          "new_line_content": "                    (abs((int)prvpp[x] - (int)srcpp[x]) > thresh) ||",
          "content_same": false
        },
        {
          "line": 293,
          "old_api": "ff_filter_frame",
          "new_api": "avfilter_unref_buffer",
          "old_text": "ff_filter_frame(outlink, outpic)",
          "new_text": "avfilter_unref_buffer(inpic)",
          "old_line_content": "    return ff_filter_frame(outlink, outpic);",
          "new_line_content": "    avfilter_unref_buffer(inpic);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 290,
          "old_api": null,
          "new_api": "av_image_copy_plane",
          "old_text": null,
          "new_text": "av_image_copy_plane(dstp, psrc_linesize, srcp, src_linesize, bwidth, h)",
          "old_line_content": "    }",
          "new_line_content": "        av_image_copy_plane(dstp, psrc_linesize, srcp, src_linesize, bwidth, h);",
          "content_same": false
        },
        {
          "line": 294,
          "old_api": null,
          "new_api": "ff_filter_frame",
          "old_text": null,
          "new_text": "ff_filter_frame(outlink, outpic)",
          "old_line_content": "}",
          "new_line_content": "    return ff_filter_frame(outlink, outpic);",
          "content_same": false
        },
        {
          "line": 262,
          "old_api": null,
          "new_api": "av_clip",
          "old_text": null,
          "new_text": "av_clip(val, lo, hi)",
          "old_line_content": "                        }",
          "new_line_content": "                            dstp[x] = av_clip(val, lo, hi);",
          "content_same": false
        },
        {
          "line": 173,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(dstp, srcp, bwidth)",
          "old_line_content": "            dstp += 2 * dst_linesize;",
          "new_line_content": "            memcpy(dstp, srcp, bwidth);",
          "content_same": false
        },
        {
          "line": 212,
          "old_api": null,
          "new_api": "abs",
          "old_text": null,
          "new_text": "abs((int)prvpn[x] - (int)srcpn[x])",
          "old_line_content": "                    if (map) {",
          "new_line_content": "                    (abs((int)prvpn[x] - (int)srcpn[x]) > thresh)) {",
          "content_same": false
        },
        {
          "line": 181,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(dstp_saved + (h - 2 + order)  * dst_linesize, srcp_saved + (h - 1 - order) * src_linesize, bwidth)",
          "old_line_content": "",
          "new_line_content": "        memcpy(dstp_saved + (h - 2 + order)  * dst_linesize, srcp_saved + (h - 1 - order) * src_linesize, bwidth);",
          "content_same": false
        },
        {
          "line": 182,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(dstp_saved + (h - 4 + order)  * dst_linesize, srcp_saved + (h - 3 - order) * src_linesize, bwidth)",
          "old_line_content": "        /* For the other field choose adaptively between using the previous field",
          "new_line_content": "        memcpy(dstp_saved + (h - 4 + order)  * dst_linesize, srcp_saved + (h - 3 - order) * src_linesize, bwidth);",
          "content_same": false
        },
        {
          "line": 221,
          "old_api": null,
          "new_api": "AV_WB32",
          "old_text": null,
          "new_text": "AV_WB32(dstp + g, 0xeb80eb80)",
          "old_line_content": "                            x = g + 3;",
          "new_line_content": "                            AV_WB32(dstp + g, 0xeb80eb80);",
          "content_same": false
        },
        {
          "line": 217,
          "old_api": null,
          "new_api": "AV_WB32",
          "old_text": null,
          "new_text": "AV_WB32(dstp + g, 0xffffffff)",
          "old_line_content": "                            x = g + 3;",
          "new_line_content": "                            AV_WB32(dstp + g, 0xffffffff);",
          "content_same": false
        },
        {
          "line": 154,
          "old_api": null,
          "new_api": "avfilter_unref_bufferp",
          "old_text": null,
          "new_text": "avfilter_unref_bufferp(&inpic)",
          "old_line_content": "    }",
          "new_line_content": "        avfilter_unref_bufferp(&inpic);",
          "content_same": false
        },
        {
          "line": 252,
          "old_api": null,
          "new_api": "av_clip",
          "old_text": null,
          "new_text": "av_clip(valf, lo, hi)",
          "old_line_content": "                        } else {",
          "new_line_content": "                            dstp[x] = av_clip(valf, lo, hi);",
          "content_same": false
        },
        {
          "line": 157,
          "old_api": null,
          "new_api": "avfilter_copy_buffer_ref_props",
          "old_text": null,
          "new_text": "avfilter_copy_buffer_ref_props(outpic, inpic)",
          "old_line_content": "",
          "new_line_content": "    avfilter_copy_buffer_ref_props(outpic, inpic);",
          "content_same": false
        },
        {
          "line": 318,
          "old_api": null,
          "new_api": "NULL_IF_CONFIG_SMALL",
          "old_text": null,
          "new_text": "NULL_IF_CONFIG_SMALL(\"Apply kernel deinterlacing to the input.\")",
          "old_line_content": "    .priv_size     = sizeof(KerndeintContext),",
          "new_line_content": "    .description   = NULL_IF_CONFIG_SMALL(\"Apply kernel deinterlacing to the input.\"),",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 289,
          "old_api": "av_image_copy_plane",
          "new_api": null,
          "old_text": "av_image_copy_plane(dstp, psrc_linesize, srcp, src_linesize, bwidth, h)",
          "new_text": null,
          "old_line_content": "        av_image_copy_plane(dstp, psrc_linesize, srcp, src_linesize, bwidth, h);",
          "new_line_content": "        dstp = kerndeint->tmp_data[plane];",
          "content_same": false
        },
        {
          "line": 292,
          "old_api": "avfilter_unref_buffer",
          "new_api": null,
          "old_text": "avfilter_unref_buffer(inpic)",
          "new_text": null,
          "old_line_content": "    avfilter_unref_buffer(inpic);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 261,
          "old_api": "av_clip",
          "new_api": null,
          "old_text": "av_clip(val, lo, hi)",
          "new_text": null,
          "old_line_content": "                            dstp[x] = av_clip(val, lo, hi);",
          "new_line_content": "                            }",
          "content_same": false
        },
        {
          "line": 171,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(dstp, srcp, bwidth)",
          "new_text": null,
          "old_line_content": "            memcpy(dstp, srcp, bwidth);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 208,
          "old_api": "abs",
          "new_api": null,
          "old_text": "abs((int)prvp[x]  - (int)srcp[x])",
          "new_text": null,
          "old_line_content": "                    (abs((int)prvp[x]  - (int)srcp[x])  > thresh) ||",
          "new_line_content": "            for (x = 0; x < bwidth; x++) {",
          "content_same": false
        },
        {
          "line": 177,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(dstp_saved + order            * dst_linesize, srcp_saved + (1 -     order) * src_linesize, bwidth)",
          "new_text": null,
          "old_line_content": "        memcpy(dstp_saved + order            * dst_linesize, srcp_saved + (1 -     order) * src_linesize, bwidth);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 178,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(dstp_saved + (2 + order    )  * dst_linesize, srcp_saved + (3 -     order) * src_linesize, bwidth)",
          "new_text": null,
          "old_line_content": "        memcpy(dstp_saved + (2 + order    )  * dst_linesize, srcp_saved + (3 -     order) * src_linesize, bwidth);",
          "new_line_content": "        // Copy through the lines that will be missed below.",
          "content_same": false
        },
        {
          "line": 209,
          "old_api": "abs",
          "new_api": null,
          "old_text": "abs((int)prvpp[x] - (int)srcpp[x])",
          "new_text": null,
          "old_line_content": "                    (abs((int)prvpp[x] - (int)srcpp[x]) > thresh) ||",
          "new_line_content": "                if (thresh == 0 || n == 0 ||",
          "content_same": false
        },
        {
          "line": 216,
          "old_api": "AV_WB32",
          "new_api": null,
          "old_text": "AV_WB32(dstp + g, 0xffffffff)",
          "new_text": null,
          "old_line_content": "                            AV_WB32(dstp + g, 0xffffffff);",
          "new_line_content": "                        if (is_packed_rgb) {",
          "content_same": false
        },
        {
          "line": 153,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(ENOMEM)",
          "new_text": null,
          "old_line_content": "        return AVERROR(ENOMEM);",
          "new_line_content": "    if (!outpic) {",
          "content_same": false
        },
        {
          "line": 251,
          "old_api": "av_clip",
          "new_api": null,
          "old_text": "av_clip(valf, lo, hi)",
          "new_text": null,
          "old_line_content": "                            dstp[x] = av_clip(valf, lo, hi);",
          "new_line_content": "                            }",
          "content_same": false
        },
        {
          "line": 220,
          "old_api": "AV_WB32",
          "new_api": null,
          "old_text": "AV_WB32(dstp + g, 0xeb80eb80)",
          "new_text": null,
          "old_line_content": "                            AV_WB32(dstp + g, 0xeb80eb80);",
          "new_line_content": "                            // y <- 235, u <- 128, y <- 235, v <- 128",
          "content_same": false
        },
        {
          "line": 317,
          "old_api": "NULL_IF_CONFIG_SMALL",
          "new_api": null,
          "old_text": "NULL_IF_CONFIG_SMALL(\"Apply kernel deinterlacing to the input.\")",
          "new_text": null,
          "old_line_content": "    .description   = NULL_IF_CONFIG_SMALL(\"Apply kernel deinterlacing to the input.\"),",
          "new_line_content": "    .name          = \"kerndeint\",",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 5,
      "total_additions": 13,
      "total_deletions": 13,
      "total_api_changes": 31
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 3,
        "api_related_lines": 31,
        "non_api_lines": 1,
        "non_api_line_numbers": [
          151
        ]
      }
    },
    "api_calls_before": 36,
    "api_calls_after": 36,
    "diff_info": {
      "added_lines": 2,
      "removed_lines": 1,
      "total_diff_lines": 22
    }
  }
}