{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/db1347f66ed009ec5a80749d853e1a5768225d26",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/db1347f66ed009ec5a80749d853e1a5768225d26/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/db1347f66ed009ec5a80749d853e1a5768225d26/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/db1347f66ed009ec5a80749d853e1a5768225d26/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 1782,
          "old_api": "av_assert0",
          "new_api": "ff_reduce_index",
          "old_text": "av_assert0(pkt.pos >= 0)",
          "new_text": "ff_reduce_index(s, pkt.stream_index)",
          "old_line_content": "            av_assert0(pkt.pos >= 0);",
          "new_line_content": "            ff_reduce_index(s, pkt.stream_index);",
          "content_same": false
        },
        {
          "line": 1850,
          "old_api": "ff_restore_parser_state",
          "new_api": "ff_gen_syncpoint_search",
          "old_text": "ff_restore_parser_state(s, backup)",
          "new_text": "ff_gen_syncpoint_search(s, stream_index, pos,\n                                min_ts, target_ts, max_ts,\n                                flags)",
          "old_line_content": "        ff_restore_parser_state(s, backup);",
          "new_line_content": "    if (ff_gen_syncpoint_search(s, stream_index, pos,",
          "content_same": false
        },
        {
          "line": 1890,
          "old_api": "avio_seek",
          "new_api": "avio_tell",
          "old_text": "avio_seek(s->pb, pos, SEEK_SET)",
          "new_text": "avio_tell(s->pb)",
          "old_line_content": "        avio_seek(s->pb, pos, SEEK_SET);",
          "new_line_content": "    pos= avio_tell(s->pb);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 1921,
          "old_api": null,
          "new_api": "mpegts_open_section_filter",
          "old_text": null,
          "new_text": "mpegts_open_section_filter(ts, SDT_PID, sdt_cb, ts, 1)",
          "old_line_content": "    return ts;",
          "new_line_content": "    mpegts_open_section_filter(ts, SDT_PID, sdt_cb, ts, 1);",
          "content_same": false
        },
        {
          "line": 1922,
          "old_api": null,
          "new_api": "mpegts_open_section_filter",
          "old_text": null,
          "new_text": "mpegts_open_section_filter(ts, PAT_PID, pat_cb, ts, 1)",
          "old_line_content": "}",
          "new_line_content": "    mpegts_open_section_filter(ts, PAT_PID, pat_cb, ts, 1);",
          "content_same": false
        },
        {
          "line": 1811,
          "old_api": null,
          "new_api": "ff_store_parser_state",
          "old_text": null,
          "new_text": "ff_store_parser_state(s)",
          "old_line_content": "    flags |= (target_ts - min_ts > (uint64_t)(max_ts - target_ts)) ?",
          "new_line_content": "    backup = ff_store_parser_state(s);",
          "content_same": false
        },
        {
          "line": 1944,
          "old_api": null,
          "new_api": "handle_packet",
          "old_text": null,
          "new_text": "handle_packet(ts, buf)",
          "old_line_content": "            if (ts->stop_parse == 1)",
          "new_line_content": "            handle_packet(ts, buf);",
          "content_same": false
        },
        {
          "line": 1823,
          "old_api": null,
          "new_api": "av_find_default_stream_index",
          "old_text": null,
          "new_text": "av_find_default_stream_index(s)",
          "old_line_content": "                return -1;",
          "new_line_content": "            stream_index_gen_search = av_find_default_stream_index(s);",
          "content_same": false
        },
        {
          "line": 1825,
          "old_api": null,
          "new_api": "ff_restore_parser_state",
          "old_text": null,
          "new_text": "ff_restore_parser_state(s, backup)",
          "old_line_content": "",
          "new_line_content": "                ff_restore_parser_state(s, backup);",
          "content_same": false
        },
        {
          "line": 1831,
          "old_api": null,
          "new_api": "av_rescale",
          "old_text": null,
          "new_text": "av_rescale(target_ts,\n                                st->time_base.den,\n                                AV_TIME_BASE * (int64_t)st->time_base.num)",
          "old_line_content": "        } else {",
          "new_line_content": "            ts_adj = av_rescale(target_ts,",
          "content_same": false
        },
        {
          "line": 1959,
          "old_api": null,
          "new_api": "av_free",
          "old_text": null,
          "new_text": "av_free(ts->pids[i])",
          "old_line_content": "",
          "new_line_content": "        av_free(ts->pids[i]);",
          "content_same": false
        },
        {
          "line": 1960,
          "old_api": null,
          "new_api": "av_free",
          "old_text": null,
          "new_text": "av_free(ts)",
          "old_line_content": "AVInputFormat ff_mpegts_demuxer = {",
          "new_line_content": "    av_free(ts);",
          "content_same": false
        },
        {
          "line": 1965,
          "old_api": null,
          "new_api": "NULL_IF_CONFIG_SMALL",
          "old_text": null,
          "new_text": "NULL_IF_CONFIG_SMALL(\"MPEG-2 transport stream format\")",
          "old_line_content": "    .read_header    = mpegts_read_header,",
          "new_line_content": "    .long_name      = NULL_IF_CONFIG_SMALL(\"MPEG-2 transport stream format\"),",
          "content_same": false
        },
        {
          "line": 1838,
          "old_api": null,
          "new_api": "av_gen_search",
          "old_text": null,
          "new_text": "av_gen_search(s, stream_index_gen_search, ts_adj,\n                            0, INT64_MAX, -1,\n                            AV_NOPTS_VALUE,\n                            AV_NOPTS_VALUE,\n                            flags, &ts_ret, mpegts_get_pcr)",
          "old_line_content": "                            AV_NOPTS_VALUE,",
          "new_line_content": "        pos = av_gen_search(s, stream_index_gen_search, ts_adj,",
          "content_same": false
        },
        {
          "line": 1844,
          "old_api": null,
          "new_api": "ff_restore_parser_state",
          "old_text": null,
          "new_text": "ff_restore_parser_state(s, backup)",
          "old_line_content": "    }",
          "new_line_content": "            ff_restore_parser_state(s, backup);",
          "content_same": false
        },
        {
          "line": 1853,
          "old_api": null,
          "new_api": "ff_restore_parser_state",
          "old_text": null,
          "new_text": "ff_restore_parser_state(s, backup)",
          "old_line_content": "",
          "new_line_content": "        ff_restore_parser_state(s, backup);",
          "content_same": false
        },
        {
          "line": 1981,
          "old_api": null,
          "new_api": "NULL_IF_CONFIG_SMALL",
          "old_text": null,
          "new_text": "NULL_IF_CONFIG_SMALL(\"MPEG-2 raw transport stream format\")",
          "old_line_content": "    .read_packet    = mpegts_raw_read_packet,",
          "new_line_content": "    .long_name      = NULL_IF_CONFIG_SMALL(\"MPEG-2 raw transport stream format\"),",
          "content_same": false
        },
        {
          "line": 1857,
          "old_api": null,
          "new_api": "ff_free_parser_state",
          "old_text": null,
          "new_text": "ff_free_parser_state(s, backup)",
          "old_line_content": "",
          "new_line_content": "    ff_free_parser_state(s, backup);",
          "content_same": false
        },
        {
          "line": 1869,
          "old_api": null,
          "new_api": "read_seek2",
          "old_text": null,
          "new_text": "read_seek2(s, stream_index, INT64_MIN, target_ts, INT64_MAX, flags)",
          "old_line_content": "        if (ret < 0)",
          "new_line_content": "            ret = read_seek2(s, stream_index, INT64_MIN, target_ts, INT64_MAX, flags);",
          "content_same": false
        },
        {
          "line": 1874,
          "old_api": null,
          "new_api": "read_seek2",
          "old_text": null,
          "new_text": "read_seek2(s, stream_index, INT64_MIN, target_ts, INT64_MAX, flags)",
          "old_line_content": "}",
          "new_line_content": "            ret = read_seek2(s, stream_index, INT64_MIN, target_ts, INT64_MAX, flags);",
          "content_same": false
        },
        {
          "line": 1886,
          "old_api": null,
          "new_api": "av_seek_frame_binary",
          "old_text": null,
          "new_text": "av_seek_frame_binary(s, stream_index, target_ts, flags)",
          "old_line_content": "    return 0;",
          "new_line_content": "    if(av_seek_frame_binary(s, stream_index, target_ts, flags) < 0)",
          "content_same": false
        },
        {
          "line": 1888,
          "old_api": null,
          "new_api": "ff_read_frame_flush",
          "old_text": null,
          "new_text": "ff_read_frame_flush(s)",
          "old_line_content": "",
          "new_line_content": "    ff_read_frame_flush(s);",
          "content_same": false
        },
        {
          "line": 1893,
          "old_api": null,
          "new_api": "avio_seek",
          "old_text": null,
          "new_text": "avio_seek(s->pb, pos, SEEK_SET)",
          "old_line_content": "//        pid = AV_RB16(buf + 1) & 0x1fff;",
          "new_line_content": "        avio_seek(s->pb, pos, SEEK_SET);",
          "content_same": false
        },
        {
          "line": 1894,
          "old_api": null,
          "new_api": "avio_read",
          "old_text": null,
          "new_text": "avio_read(s->pb, buf, TS_PACKET_SIZE)",
          "old_line_content": "        if(buf[1] & 0x40) break;",
          "new_line_content": "        if (avio_read(s->pb, buf, TS_PACKET_SIZE) != TS_PACKET_SIZE)",
          "content_same": false
        },
        {
          "line": 1900,
          "old_api": null,
          "new_api": "avio_seek",
          "old_text": null,
          "new_text": "avio_seek(s->pb, pos, SEEK_SET)",
          "old_line_content": "}",
          "new_line_content": "    avio_seek(s->pb, pos, SEEK_SET);",
          "content_same": false
        },
        {
          "line": 1783,
          "old_api": null,
          "new_api": "av_add_index_entry",
          "old_text": null,
          "new_text": "av_add_index_entry(s->streams[pkt.stream_index], pkt.pos, pkt.dts, 0, 0, AVINDEX_KEYFRAME /* FIXME keyframe? */)",
          "old_line_content": "            *ppos= pkt.pos;",
          "new_line_content": "            av_add_index_entry(s->streams[pkt.stream_index], pkt.pos, pkt.dts, 0, 0, AVINDEX_KEYFRAME /* FIXME keyframe? */);",
          "content_same": false
        },
        {
          "line": 1914,
          "old_api": null,
          "new_api": "av_mallocz",
          "old_text": null,
          "new_text": "av_mallocz(sizeof(MpegTSContext))",
          "old_line_content": "    /* no stream case, currently used by RTP */",
          "new_line_content": "    ts = av_mallocz(sizeof(MpegTSContext));",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 1808,
          "old_api": "ff_store_parser_state",
          "new_api": null,
          "old_text": "ff_store_parser_state(s)",
          "new_text": null,
          "old_line_content": "    backup = ff_store_parser_state(s);",
          "new_line_content": "    AVStream *st;",
          "content_same": false
        },
        {
          "line": 1941,
          "old_api": "handle_packet",
          "new_api": null,
          "old_text": "handle_packet(ts, buf)",
          "new_text": null,
          "old_line_content": "            handle_packet(ts, buf);",
          "new_line_content": "            buf++;",
          "content_same": false
        },
        {
          "line": 1820,
          "old_api": "av_find_default_stream_index",
          "new_api": null,
          "old_text": "av_find_default_stream_index(s)",
          "new_text": null,
          "old_line_content": "            stream_index_gen_search = av_find_default_stream_index(s);",
          "new_line_content": "    } else {",
          "content_same": false
        },
        {
          "line": 1822,
          "old_api": "ff_restore_parser_state",
          "new_api": null,
          "old_text": "ff_restore_parser_state(s, backup)",
          "new_text": null,
          "old_line_content": "                ff_restore_parser_state(s, backup);",
          "new_line_content": "        if (stream_index < 0) {",
          "content_same": false
        },
        {
          "line": 1828,
          "old_api": "av_rescale",
          "new_api": null,
          "old_text": "av_rescale(target_ts,\n                                st->time_base.den,\n                                AV_TIME_BASE * (int64_t)st->time_base.num)",
          "new_text": null,
          "old_line_content": "            ts_adj = av_rescale(target_ts,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1956,
          "old_api": "av_free",
          "new_api": null,
          "old_text": "av_free(ts->pids[i])",
          "new_text": null,
          "old_line_content": "        av_free(ts->pids[i]);",
          "new_line_content": "    int i;",
          "content_same": false
        },
        {
          "line": 1957,
          "old_api": "av_free",
          "new_api": null,
          "old_text": "av_free(ts)",
          "new_text": null,
          "old_line_content": "    av_free(ts);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1962,
          "old_api": "NULL_IF_CONFIG_SMALL",
          "new_api": null,
          "old_text": "NULL_IF_CONFIG_SMALL(\"MPEG-2 transport stream format\")",
          "new_text": null,
          "old_line_content": "    .long_name      = NULL_IF_CONFIG_SMALL(\"MPEG-2 transport stream format\"),",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1835,
          "old_api": "av_gen_search",
          "new_api": null,
          "old_text": "av_gen_search(s, stream_index_gen_search, ts_adj,\n                            0, INT64_MAX, -1,\n                            AV_NOPTS_VALUE,\n                            AV_NOPTS_VALUE,\n                            flags, &ts_ret, mpegts_get_pcr)",
          "new_text": null,
          "old_line_content": "        pos = av_gen_search(s, stream_index_gen_search, ts_adj,",
          "new_line_content": "            ts_adj = target_ts;",
          "content_same": false
        },
        {
          "line": 1841,
          "old_api": "ff_restore_parser_state",
          "new_api": null,
          "old_text": "ff_restore_parser_state(s, backup)",
          "new_text": null,
          "old_line_content": "            ff_restore_parser_state(s, backup);",
          "new_line_content": "                            AV_NOPTS_VALUE,",
          "content_same": false
        },
        {
          "line": 1847,
          "old_api": "ff_gen_syncpoint_search",
          "new_api": null,
          "old_text": "ff_gen_syncpoint_search(s, stream_index, pos,\n                                min_ts, target_ts, max_ts,\n                                flags)",
          "new_text": null,
          "old_line_content": "    if (ff_gen_syncpoint_search(s, stream_index, pos,",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1978,
          "old_api": "NULL_IF_CONFIG_SMALL",
          "new_api": null,
          "old_text": "NULL_IF_CONFIG_SMALL(\"MPEG-2 raw transport stream format\")",
          "new_text": null,
          "old_line_content": "    .long_name      = NULL_IF_CONFIG_SMALL(\"MPEG-2 raw transport stream format\"),",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1854,
          "old_api": "ff_free_parser_state",
          "new_api": null,
          "old_text": "ff_free_parser_state(s, backup)",
          "new_text": null,
          "old_line_content": "    ff_free_parser_state(s, backup);",
          "new_line_content": "        return -1;",
          "content_same": false
        },
        {
          "line": 1863,
          "old_api": "read_seek2",
          "new_api": null,
          "old_text": "read_seek2(s, stream_index, INT64_MIN, target_ts, target_ts, flags)",
          "new_text": null,
          "old_line_content": "        ret = read_seek2(s, stream_index, INT64_MIN, target_ts, target_ts, flags);",
          "new_line_content": "    int ret;",
          "content_same": false
        },
        {
          "line": 1868,
          "old_api": "read_seek2",
          "new_api": null,
          "old_text": "read_seek2(s, stream_index, target_ts, target_ts, INT64_MAX, flags)",
          "new_text": null,
          "old_line_content": "        ret = read_seek2(s, stream_index, target_ts, target_ts, INT64_MAX, flags);",
          "new_line_content": "            // for compatibility reasons, seek to the best-fitting timestamp",
          "content_same": false
        },
        {
          "line": 1883,
          "old_api": "av_seek_frame_binary",
          "new_api": null,
          "old_text": "av_seek_frame_binary(s, stream_index, target_ts, flags)",
          "new_text": null,
          "old_line_content": "    if(av_seek_frame_binary(s, stream_index, target_ts, flags) < 0)",
          "new_line_content": "    uint8_t buf[TS_PACKET_SIZE];",
          "content_same": false
        },
        {
          "line": 1885,
          "old_api": "ff_read_frame_flush",
          "new_api": null,
          "old_text": "ff_read_frame_flush(s)",
          "new_text": null,
          "old_line_content": "    ff_read_frame_flush(s);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1887,
          "old_api": "avio_tell",
          "new_api": null,
          "old_text": "avio_tell(s->pb)",
          "new_text": null,
          "old_line_content": "    pos= avio_tell(s->pb);",
          "new_line_content": "        return -1;",
          "content_same": false
        },
        {
          "line": 1891,
          "old_api": "avio_read",
          "new_api": null,
          "old_text": "avio_read(s->pb, buf, TS_PACKET_SIZE)",
          "new_text": null,
          "old_line_content": "        if (avio_read(s->pb, buf, TS_PACKET_SIZE) != TS_PACKET_SIZE)",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1897,
          "old_api": "avio_seek",
          "new_api": null,
          "old_text": "avio_seek(s->pb, pos, SEEK_SET)",
          "new_text": null,
          "old_line_content": "    avio_seek(s->pb, pos, SEEK_SET);",
          "new_line_content": "        if(buf[1] & 0x40) break;",
          "content_same": false
        },
        {
          "line": 1911,
          "old_api": "av_mallocz",
          "new_api": null,
          "old_text": "av_mallocz(sizeof(MpegTSContext))",
          "new_text": null,
          "old_line_content": "    ts = av_mallocz(sizeof(MpegTSContext));",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 1918,
          "old_api": "mpegts_open_section_filter",
          "new_api": null,
          "old_text": "mpegts_open_section_filter(ts, SDT_PID, sdt_cb, ts, 1)",
          "new_text": null,
          "old_line_content": "    mpegts_open_section_filter(ts, SDT_PID, sdt_cb, ts, 1);",
          "new_line_content": "    ts->raw_packet_size = TS_PACKET_SIZE;",
          "content_same": false
        },
        {
          "line": 1919,
          "old_api": "mpegts_open_section_filter",
          "new_api": null,
          "old_text": "mpegts_open_section_filter(ts, PAT_PID, pat_cb, ts, 1)",
          "new_text": null,
          "old_line_content": "    mpegts_open_section_filter(ts, PAT_PID, pat_cb, ts, 1);",
          "new_line_content": "    ts->stream = s;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 3,
      "total_additions": 24,
      "total_deletions": 23,
      "total_api_changes": 50
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 7,
        "api_related_lines": 50,
        "non_api_lines": 5,
        "non_api_line_numbers": [
          1781,
          1784,
          1785,
          1786,
          1787
        ]
      }
    },
    "api_calls_before": 285,
    "api_calls_after": 286,
    "diff_info": {
      "added_lines": 7,
      "removed_lines": 4,
      "total_diff_lines": 23
    }
  }
}