{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/f15477169ea9947336448af2772087c8fa1c6cdf",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/f15477169ea9947336448af2772087c8fa1c6cdf/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/f15477169ea9947336448af2772087c8fa1c6cdf/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/FFmpeg/modified_file/f15477169ea9947336448af2772087c8fa1c6cdf/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 105,
          "old_api": "snprintf",
          "new_api": "exif_add_metadata",
          "old_text": "snprintf(use_name, 7, \"0x%04X\", id)",
          "new_text": "exif_add_metadata(logctx, count, type, name, NULL,\n                                gbytes, le, metadata)",
          "old_line_content": "            snprintf(use_name, 7, \"0x%04X\", id);",
          "new_line_content": "        ret = exif_add_metadata(logctx, count, type, name, NULL,",
          "content_same": false
        },
        {
          "line": 128,
          "old_api": "ff_tget_short",
          "new_api": "exif_decode_tag",
          "old_text": "ff_tget_short(gbytes, le)",
          "new_text": "exif_decode_tag(logctx, gbytes, le, depth, metadata)",
          "old_line_content": "    entries = ff_tget_short(gbytes, le);",
          "new_line_content": "        if ((ret = exif_decode_tag(logctx, gbytes, le, depth, metadata)) < 0) {",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 102,
          "old_api": null,
          "new_api": "snprintf",
          "old_text": null,
          "new_text": "snprintf(buf, sizeof(buf), \"0x%04X\", id)",
          "old_line_content": "            if (!use_name) {",
          "new_line_content": "            snprintf(buf, sizeof(buf), \"0x%04X\", id);",
          "content_same": false
        },
        {
          "line": 134,
          "old_api": null,
          "new_api": "ff_tget_long",
          "old_text": null,
          "new_text": "ff_tget_long(gbytes, le)",
          "old_line_content": "    for (i = 0; i < entries; i++) {",
          "new_line_content": "    return ff_tget_long(gbytes, le);",
          "content_same": false
        },
        {
          "line": 109,
          "old_api": null,
          "new_api": "bytestream2_seek",
          "old_text": null,
          "new_text": "bytestream2_seek(gbytes, cur_pos, SEEK_SET)",
          "old_line_content": "                                gbytes, le, metadata);",
          "new_line_content": "    bytestream2_seek(gbytes, cur_pos, SEEK_SET);",
          "content_same": false
        },
        {
          "line": 142,
          "old_api": null,
          "new_api": "bytestream2_init",
          "old_text": null,
          "new_text": "bytestream2_init(&gb, buf, size)",
          "old_line_content": "}",
          "new_line_content": "    bytestream2_init(&gb, buf, size);",
          "content_same": false
        },
        {
          "line": 144,
          "old_api": null,
          "new_api": "ff_exif_decode_ifd",
          "old_text": null,
          "new_text": "ff_exif_decode_ifd(logctx, &gb, le, depth, metadata)",
          "old_line_content": "int avpriv_exif_decode_ifd(void *logctx, const uint8_t *buf, int size,",
          "new_line_content": "    return ff_exif_decode_ifd(logctx, &gb, le, depth, metadata);",
          "content_same": false
        },
        {
          "line": 121,
          "old_api": null,
          "new_api": "ff_tget_short",
          "old_text": null,
          "new_text": "ff_tget_short(gbytes, le)",
          "old_line_content": "",
          "new_line_content": "    entries = ff_tget_short(gbytes, le);",
          "content_same": false
        },
        {
          "line": 123,
          "old_api": null,
          "new_api": "bytestream2_get_bytes_left",
          "old_text": null,
          "new_text": "bytestream2_get_bytes_left(gbytes)",
          "old_line_content": "                       int le, int depth, AVDictionary **metadata)",
          "new_line_content": "    if (bytestream2_get_bytes_left(gbytes) < entries * 12) {",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 130,
          "old_api": "bytestream2_get_bytes_left",
          "new_api": null,
          "old_text": "bytestream2_get_bytes_left(gbytes)",
          "new_text": null,
          "old_line_content": "    if (bytestream2_get_bytes_left(gbytes) < entries * 12) {",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 101,
          "old_api": "av_malloc",
          "new_api": null,
          "old_text": "av_malloc(7)",
          "new_text": null,
          "old_line_content": "            use_name = av_malloc(7);",
          "new_line_content": "            name = buf;",
          "content_same": false
        },
        {
          "line": 135,
          "old_api": "exif_decode_tag",
          "new_api": null,
          "old_text": "exif_decode_tag(logctx, gbytes, le, depth, metadata)",
          "new_text": null,
          "old_line_content": "        if ((ret = exif_decode_tag(logctx, gbytes, le, depth, metadata)) < 0) {",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 103,
          "old_api": "AVERROR",
          "new_api": null,
          "old_text": "AVERROR(ENOMEM)",
          "new_text": null,
          "old_line_content": "                return AVERROR(ENOMEM);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 108,
          "old_api": "exif_add_metadata",
          "new_api": null,
          "old_text": "exif_add_metadata(logctx, count, type, use_name, NULL,\n                                gbytes, le, metadata)",
          "new_text": null,
          "old_line_content": "        ret = exif_add_metadata(logctx, count, type, use_name, NULL,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 141,
          "old_api": "ff_tget_long",
          "new_api": null,
          "old_text": "ff_tget_long(gbytes, le)",
          "new_text": null,
          "old_line_content": "    return ff_tget_long(gbytes, le);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 112,
          "old_api": "av_freep",
          "new_api": null,
          "old_text": "av_freep(&use_name)",
          "new_text": null,
          "old_line_content": "            av_freep(&use_name);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 116,
          "old_api": "bytestream2_seek",
          "new_api": null,
          "old_text": "bytestream2_seek(gbytes, cur_pos, SEEK_SET)",
          "new_text": null,
          "old_line_content": "    bytestream2_seek(gbytes, cur_pos, SEEK_SET);",
          "new_line_content": "                       int le, int depth, AVDictionary **metadata)",
          "content_same": false
        },
        {
          "line": 149,
          "old_api": "bytestream2_init",
          "new_api": null,
          "old_text": "bytestream2_init(&gb, buf, size)",
          "new_text": null,
          "old_line_content": "    bytestream2_init(&gb, buf, size);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 151,
          "old_api": "ff_exif_decode_ifd",
          "new_api": null,
          "old_text": "ff_exif_decode_ifd(logctx, &gb, le, depth, metadata)",
          "new_text": null,
          "old_line_content": "    return ff_exif_decode_ifd(logctx, &gb, le, depth, metadata);",
          "new_line_content": "",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 2,
      "total_additions": 7,
      "total_deletions": 10,
      "total_api_changes": 19
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 13,
        "api_related_lines": 19,
        "non_api_lines": 6,
        "non_api_line_numbers": [
          98,
          99,
          100,
          104,
          106,
          107
        ]
      }
    },
    "api_calls_before": 29,
    "api_calls_after": 26,
    "diff_info": {
      "added_lines": 6,
      "removed_lines": 13,
      "total_diff_lines": 34
    }
  }
}