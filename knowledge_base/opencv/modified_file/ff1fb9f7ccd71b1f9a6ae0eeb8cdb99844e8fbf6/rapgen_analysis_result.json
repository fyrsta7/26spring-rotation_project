{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/opencv/modified_file/ff1fb9f7ccd71b1f9a6ae0eeb8cdb99844e8fbf6",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/opencv/modified_file/ff1fb9f7ccd71b1f9a6ae0eeb8cdb99844e8fbf6/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/opencv/modified_file/ff1fb9f7ccd71b1f9a6ae0eeb8cdb99844e8fbf6/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/opencv/modified_file/ff1fb9f7ccd71b1f9a6ae0eeb8cdb99844e8fbf6/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 401,
          "old_api": "abledDeviceCount",
          "new_api": "(try_use_gpu && getCud",
          "old_text": "abledDeviceCount() > 0)",
          "new_text": " (try_use_gpu && getCud",
          "old_line_content": null,
          "new_line_content": "        descriptors1_.release();",
          "content_same": true
        },
        {
          "line": 402,
          "old_api": "pl_ = new GpuMatcher(ma",
          "new_api": "iceCount",
          "old_text": "pl_ = new GpuMatcher(ma",
          "new_text": "iceCount() > 0)\n    {\n ",
          "old_line_content": null,
          "new_line_content": "        descriptors2_.release();",
          "content_same": true
        },
        {
          "line": 403,
          "old_api": "else\n        imp",
          "new_api": "ceInfo info;",
          "old_text": "    else\n        imp",
          "new_text": "ceInfo info;\n       ",
          "old_line_content": null,
          "new_line_content": "        train_idx_.release();",
          "content_same": true
        },
        {
          "line": 404,
          "old_api": "uMatcher",
          "new_api": "ajorVersion",
          "old_text": "uMatcher(match_conf",
          "new_text": "ajorVersion() >= 2 ",
          "old_line_content": null,
          "new_line_content": "        distance_.release();",
          "content_same": true
        },
        {
          "line": 405,
          "old_api": "thread_safe_ = impl",
          "new_api": "umberOfCPUs",
          "old_text": "thread_safe_ = impl",
          "new_text": "umberOfCPUs() < 4)\n",
          "old_line_content": null,
          "new_line_content": "        all_dist_.release();",
          "content_same": true
        },
        {
          "line": 406,
          "old_api": "Safe",
          "new_api": "use_gpu = true;\n    }\n\n    if (use_gpu)",
          "old_text": "Safe();\n    num_matches_thresh1_ = num_matche",
          "new_text": " use_gpu = true;\n    }\n\n    if (use_gpu)\n    ",
          "old_line_content": null,
          "new_line_content": "        vector< vector<DMatch> >().swap(pair_matches);",
          "content_same": true
        },
        {
          "line": 450,
          "old_api": "= 0; i < matches_i",
          "new_api": "g_size.width * 0.5f;",
          "old_text": " = 0; i < matches_i",
          "new_text": "g_size.width * 0.5f;\n      ",
          "old_line_content": "        src_points.at<Point2f>(0, static_cast<int>(i)) = p;",
          "new_line_content": "    Mat dst_points(1, static_cast<int>(matches_info.matches.size()), CV_32FC2);",
          "content_same": false
        },
        {
          "line": 463,
          "old_api": "create",
          "new_api": "size",
          "old_text": ";\n    dst_points.create(1, match",
          "new_text": "size());\n\n    // Ch",
          "old_line_content": "    for (size_t i = 0; i < matches_info.inliers_mask.size(); ++i)",
          "new_line_content": "        dst_points.at<Point2f>(0, static_cast<int>(i)) = p;",
          "content_same": false
        },
        {
          "line": 467,
          "old_api": "k[i])\n            continue;",
          "new_api": "rs < num_matches_thresh2_)\n        return;\n\n    // Construct point-point cor",
          "old_text": "k[i])\n            continue;",
          "new_text": "rs < num_matches_thresh2_)\n        return;\n\n    // Construct point-point cor",
          "old_line_content": "    matches_info.confidence = matches_info.num_inliers / (8 + 0.3*matches_info.matches.size());",
          "new_line_content": "    matches_info.H = findHomography(src_points, dst_points, matches_info.inliers_mask, CV_RANSAC);",
          "content_same": false
        },
        {
          "line": 475,
          "old_api": "p = features2.keypoints[m.trainIdx].pt;\n        p.",
          "new_api": "continue;",
          "old_text": "      p = features2.keypoints[m.trainIdx].pt;\n        p.",
          "new_text": "          continue;\n\n      ",
          "old_line_content": "    dst_points.create(1, matches_info.num_inliers, CV_32FC2);",
          "new_line_content": "    matches_info.confidence = matches_info.num_inliers / (8 + 0.3*matches_info.matches.size());",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 449,
          "old_api": null,
          "new_api": "= p;\n\n        p = features2",
          "old_text": null,
          "new_text": "= p;\n\n        p = features2",
          "old_line_content": "        p.y -= features1.img_size.height * 0.5f;",
          "new_line_content": "    Mat src_points(1, static_cast<int>(matches_info.matches.size()), CV_32FC2);",
          "content_same": false
        },
        {
          "line": 418,
          "old_api": null,
          "new_api": "2,",
          "old_text": null,
          "new_text": "2,\n                  ",
          "old_line_content": "",
          "new_line_content": "        if (info.majorVersion() >= 2 && cv::getNumberOfCPUs() < 4)",
          "content_same": false
        },
        {
          "line": 451,
          "old_api": null,
          "new_api": "dst_points.at<Poin",
          "old_text": null,
          "new_text": "\n        dst_points.at<Poin",
          "old_line_content": "",
          "new_line_content": "    for (size_t i = 0; i < matches_info.matches.size(); ++i)",
          "content_same": false
        },
        {
          "line": 482,
          "old_api": null,
          "new_api": "src_points.at<Point2f>(0, inlier_idx) = p;",
          "old_text": null,
          "new_text": "\n        src_points.at<Point2f>(0, inlier_idx) = p;\n\n   ",
          "old_line_content": "        const DMatch& m = matches_info.matches[i];",
          "new_line_content": "    src_points.create(1, matches_info.num_inliers, CV_32FC2);",
          "content_same": false
        },
        {
          "line": 483,
          "old_api": null,
          "new_api": "= features2.keypoints[m.trainIdx].pt;\n        p.x -= fea",
          "old_text": null,
          "new_text": "= features2.keypoints[m.trainIdx].pt;\n        p.x -= fea",
          "old_line_content": "",
          "new_line_content": "    dst_points.create(1, matches_info.num_inliers, CV_32FC2);",
          "content_same": false
        },
        {
          "line": 485,
          "old_api": null,
          "new_api": "img_size.height * 0.5f;",
          "old_text": null,
          "new_text": "img_size.height * 0.5f;\n   ",
          "old_line_content": "        p.x -= features1.img_size.width * 0.5f;",
          "new_line_content": "    for (size_t i = 0; i < matches_info.matches.size(); ++i)",
          "content_same": false
        },
        {
          "line": 458,
          "old_api": null,
          "new_api": "< matches_info.inli",
          "old_text": null,
          "new_text": "< matches_info.inli",
          "old_line_content": "    // Find pair-wise motion",
          "new_line_content": "        src_points.at<Point2f>(0, static_cast<int>(i)) = p;",
          "content_same": false
        },
        {
          "line": 427,
          "old_api": null,
          "new_api": "s2.keypoints, matches",
          "old_text": null,
          "new_text": "s2.keypoints, matches",
          "old_line_content": "{",
          "new_line_content": "    is_thread_safe_ = impl_->isThreadSafe();",
          "content_same": false
        },
        {
          "line": 511,
          "old_api": null,
          "new_api": "",
          "old_text": null,
          "new_text": "",
          "old_line_content": "",
          "new_line_content": "    impl_->releaseMemory();",
          "content_same": false
        },
        {
          "line": 495,
          "old_api": null,
          "new_api": "",
          "old_text": null,
          "new_text": "",
          "old_line_content": "    }",
          "new_line_content": "        src_points.at<Point2f>(0, inlier_idx) = p;",
          "content_same": false
        },
        {
          "line": 436,
          "old_api": null,
          "new_api": "eturn;\n\n    // Construct point-point corres",
          "old_text": null,
          "new_text": "eturn;\n\n    // Construct point-point corres",
          "old_line_content": "    // Check if it makes sense to find homography",
          "new_line_content": "    (*impl_)(features1, features2, matches_info);",
          "content_same": false
        },
        {
          "line": 500,
          "old_api": null,
          "new_api": "",
          "old_text": null,
          "new_text": "",
          "old_line_content": "",
          "new_line_content": "        dst_points.at<Point2f>(0, inlier_idx) = p;",
          "content_same": false
        },
        {
          "line": 471,
          "old_api": null,
          "new_api": "create",
          "old_text": null,
          "new_text": "t_points.create(1, matches_info.",
          "old_line_content": "        return;",
          "new_line_content": "    for (size_t i = 0; i < matches_info.inliers_mask.size(); ++i)",
          "content_same": false
        },
        {
          "line": 506,
          "old_api": null,
          "new_api": "",
          "old_text": null,
          "new_text": "",
          "old_line_content": "",
          "new_line_content": "    matches_info.H = findHomography(src_points, dst_points, CV_RANSAC);",
          "content_same": false
        },
        {
          "line": 445,
          "old_api": null,
          "new_api": "oints[m.queryIdx].pt;\n        p.x -= feat",
          "old_text": null,
          "new_text": "oints[m.queryIdx].pt;\n        p.x -= feat",
          "old_line_content": "        const DMatch& m = matches_info.matches[i];",
          "new_line_content": "    if (matches_info.matches.size() < static_cast<size_t>(num_matches_thresh1_))",
          "content_same": false
        },
        {
          "line": 415,
          "old_api": null,
          "new_api": "hresh2;\n}\n\n\nvoid BestOf2Nea",
          "old_text": null,
          "new_text": "hresh2;\n}\n\n\nvoid BestOf2Nea",
          "old_line_content": "        impl_ = new GpuMatcher(match_conf);",
          "new_line_content": "    if (try_use_gpu && getCudaEnabledDeviceCount() > 0)",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 419,
          "old_api": "features2.keypoints,",
          "new_api": null,
          "old_text": " features2.keypoints,",
          "new_text": null,
          "old_line_content": "    is_thread_safe_ = impl_->isThreadSafe();",
          "new_line_content": "            use_gpu = true;",
          "content_same": false
        },
        {
          "line": 455,
          "old_api": "size",
          "new_api": null,
          "old_text": "matches.size());\n\n ",
          "new_text": null,
          "old_line_content": "        dst_points.at<Point2f>(0, static_cast<int>(i)) = p;",
          "new_line_content": "        Point2f p = features1.keypoints[m.queryIdx].pt;",
          "content_same": false
        },
        {
          "line": 487,
          "old_api": "",
          "new_api": null,
          "old_text": "",
          "new_text": null,
          "old_line_content": "        src_points.at<Point2f>(0, inlier_idx) = p;",
          "new_line_content": "        if (!matches_info.inliers_mask[i])",
          "content_same": false
        },
        {
          "line": 459,
          "old_api": "um_inliers < num_matches_thresh2_)\n        return;\n\n    // Construct point-p",
          "new_api": null,
          "old_text": "um_inliers < num_matches_thresh2_)\n        return;\n\n    // Construct point-p",
          "new_text": null,
          "old_line_content": "    matches_info.H = findHomography(src_points, dst_points, matches_info.inliers_mask, CV_RANSAC);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 428,
          "old_api": "return;\n\n    // Construct point-poin",
          "new_api": null,
          "old_text": "       return;\n\n    // Construct point-poin",
          "new_text": null,
          "old_line_content": "    (*impl_)(features1, features2, matches_info);",
          "new_line_content": "    num_matches_thresh1_ = num_matches_thresh1;",
          "content_same": false
        },
        {
          "line": 492,
          "old_api": "",
          "new_api": null,
          "old_text": "",
          "new_text": null,
          "old_line_content": "        dst_points.at<Point2f>(0, inlier_idx) = p;",
          "new_line_content": "        Point2f p = features1.keypoints[m.queryIdx].pt;",
          "content_same": false
        },
        {
          "line": 474,
          "old_api": "* 0.5f;\n        src_points.at<Point2f>(0, inlier_idx) =",
          "new_api": null,
          "old_text": " * 0.5f;\n        src_points.at<Point2f>(0, inlier_idx) =",
          "new_text": null,
          "old_line_content": "    src_points.create(1, matches_info.num_inliers, CV_32FC2);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 498,
          "old_api": "",
          "new_api": null,
          "old_text": "",
          "new_text": null,
          "old_line_content": "    matches_info.H = findHomography(src_points, dst_points, CV_RANSAC);",
          "new_line_content": "        p.x -= features2.img_size.width * 0.5f;",
          "content_same": false
        },
        {
          "line": 437,
          "old_api": "es1.keypoints[m.queryIdx].pt;\n        p.x",
          "new_api": null,
          "old_text": "es1.keypoints[m.queryIdx].pt;\n        p.x",
          "new_text": null,
          "old_line_content": "    if (matches_info.matches.size() < static_cast<size_t>(num_matches_thresh1_))",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 503,
          "old_api": "",
          "new_api": null,
          "old_text": "",
          "new_text": null,
          "old_line_content": "    impl_->releaseMemory();",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 441,
          "old_api": "nt>(i)) = p;\n\n        p = f",
          "new_api": null,
          "old_text": "nt>(i)) = p;\n\n        p = f",
          "new_text": null,
          "old_line_content": "    Mat src_points(1, static_cast<int>(matches_info.matches.size()), CV_32FC2);",
          "new_line_content": "    //ss << features1.img_idx << features2.img_idx << \".png\";",
          "content_same": false
        },
        {
          "line": 442,
          "old_api": "ures2.img_size.width * 0.5f",
          "new_api": null,
          "old_text": "ures2.img_size.width * 0.5f",
          "new_text": null,
          "old_line_content": "    Mat dst_points(1, static_cast<int>(matches_info.matches.size()), CV_32FC2);",
          "new_line_content": "    //imwrite(ss.str(), out);",
          "content_same": false
        },
        {
          "line": 443,
          "old_api": "* 0.5f;\n        dst_points",
          "new_api": null,
          "old_text": " * 0.5f;\n        dst_points",
          "new_text": null,
          "old_line_content": "    for (size_t i = 0; i < matches_info.matches.size(); ++i)",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 477,
          "old_api": "atures2.img_size.height * 0",
          "new_api": null,
          "old_text": "atures2.img_size.height * 0",
          "new_text": null,
          "old_line_content": "    for (size_t i = 0; i < matches_info.matches.size(); ++i)",
          "new_line_content": "    // Check if we should try to refine motion",
          "content_same": false
        },
        {
          "line": 414,
          "old_api": "esInfo &matches_info)\n{",
          "new_api": null,
          "old_text": "esInfo &matches_info)\n{\n   ",
          "new_text": null,
          "old_line_content": "    if (try_use_gpu && getCudaEnabledDeviceCount() > 0)",
          "new_line_content": "    bool use_gpu = false;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 10,
      "total_additions": 16,
      "total_deletions": 15,
      "total_api_changes": 41
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 8,
        "api_related_lines": 41,
        "non_api_lines": 5,
        "non_api_line_numbers": [
          416,
          417,
          420,
          421,
          422
        ]
      }
    },
    "api_calls_before": 129,
    "api_calls_after": 131,
    "diff_info": {
      "added_lines": 8,
      "removed_lines": 0,
      "total_diff_lines": 21
    }
  }
}