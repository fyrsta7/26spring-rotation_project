{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/opencv/modified_file/c04750ab570e6d067748770a7cf43967f32caefd",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/opencv/modified_file/c04750ab570e6d067748770a7cf43967f32caefd/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/opencv/modified_file/c04750ab570e6d067748770a7cf43967f32caefd/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/opencv/modified_file/c04750ab570e6d067748770a7cf43967f32caefd/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 215,
          "old_api": "face.at<float>(0, 3)",
          "new_api": "face.at<float>(0, 0)",
          "old_text": "face.at<float>(0, 3)",
          "new_text": "face.at<float>(0, 0)",
          "old_line_content": "                    face.at<float>(0, 3) = h;",
          "new_line_content": "                    face.at<float>(0, 0) = x1;",
          "content_same": false
        },
        {
          "line": 222,
          "old_api": "push_back",
          "new_api": "face.at<float>(0, 4 + 2 * n)",
          "old_text": "faces.push_back(face)",
          "new_text": "face.at<float>(0, 4 + 2 * n)",
          "old_line_content": "                    faces.push_back(face);",
          "new_line_content": "                        face.at<float>(0, 4 + 2 * n) = (kps_v[idx * 10 + 2 * n] + c) * strides[i];",
          "content_same": false
        },
        {
          "line": 237,
          "old_api": "faces.at<float>(rIdx, 3)",
          "new_api": "faces.at<float>(rIdx, 0)",
          "old_text": "faces.at<float>(rIdx, 3)",
          "new_text": "faces.at<float>(rIdx, 0)",
          "old_line_content": "                                           int(faces.at<float>(rIdx, 3))));",
          "new_line_content": "                faceBoxes.push_back(Rect2i(int(faces.at<float>(rIdx, 0)),",
          "content_same": false
        },
        {
          "line": 238,
          "old_api": "faces.at<float>(rIdx, 14)",
          "new_api": "faces.at<float>(rIdx, 1)",
          "old_text": "faces.at<float>(rIdx, 14)",
          "new_text": "faces.at<float>(rIdx, 1)",
          "old_line_content": "                faceScores.push_back(faces.at<float>(rIdx, 14));",
          "new_line_content": "                                           int(faces.at<float>(rIdx, 1)),",
          "content_same": false
        },
        {
          "line": 292,
          "old_api": "CV_Error",
          "new_api": "makePtr<FaceDetectorYNImpl>(model, config, input_size, score_threshold, nms_threshold, top_k, backend_id, target_id)",
          "old_text": "CV_Error(cv::Error::StsNotImplemented, \"cv::FaceDetectorYN requires enabled 'dnn' module.\")",
          "new_text": "makePtr<FaceDetectorYNImpl>(model, config, input_size, score_threshold, nms_threshold, top_k, backend_id, target_id)",
          "old_line_content": "    CV_Error(cv::Error::StsNotImplemented, \"cv::FaceDetectorYN requires enabled 'dnn' module.\");",
          "new_line_content": "    return makePtr<FaceDetectorYNImpl>(model, config, input_size, score_threshold, nms_threshold, top_k, backend_id, target_id);",
          "content_same": false
        },
        {
          "line": 310,
          "old_api": "CV_Error",
          "new_api": "makePtr<FaceDetectorYNImpl>(framework, bufferModel, bufferConfig, input_size, score_threshold, nms_threshold, top_k, backend_id, target_id)",
          "old_text": "CV_Error(cv::Error::StsNotImplemented, \"cv::FaceDetectorYN requires enabled 'dnn' module.\")",
          "new_text": "makePtr<FaceDetectorYNImpl>(framework, bufferModel, bufferConfig, input_size, score_threshold, nms_threshold, top_k, backend_id, target_id)",
          "old_line_content": "    CV_Error(cv::Error::StsNotImplemented, \"cv::FaceDetectorYN requires enabled 'dnn' module.\");",
          "new_line_content": "    return makePtr<FaceDetectorYNImpl>(framework, bufferModel, bufferConfig, input_size, score_threshold, nms_threshold, top_k, backend_id, target_id);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 225,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "faces.push_back(face)",
          "old_line_content": "        }",
          "new_line_content": "                    faces.push_back(face);",
          "content_same": false
        },
        {
          "line": 223,
          "old_api": null,
          "new_api": "face.at<float>(0, 4 + 2 * n + 1)",
          "old_text": null,
          "new_text": "face.at<float>(0, 4 + 2 * n + 1)",
          "old_line_content": "                }",
          "new_line_content": "                        face.at<float>(0, 4 + 2 * n + 1) = (kps_v[idx * 10 + 2 * n + 1]+ r) * strides[i];",
          "content_same": false
        },
        {
          "line": 217,
          "old_api": null,
          "new_api": "face.at<float>(0, 2)",
          "old_text": null,
          "new_text": "face.at<float>(0, 2)",
          "old_line_content": "                    // Get landmarks",
          "new_line_content": "                    face.at<float>(0, 2) = w;",
          "content_same": false
        },
        {
          "line": 294,
          "old_api": null,
          "new_api": "CV_UNUSED",
          "old_text": null,
          "new_text": "CV_UNUSED(target_id)",
          "old_line_content": "}",
          "new_line_content": "    CV_UNUSED(model); CV_UNUSED(config); CV_UNUSED(input_size); CV_UNUSED(score_threshold); CV_UNUSED(nms_threshold); CV_UNUSED(top_k); CV_UNUSED(backend_id); CV_UNUSED(target_id);",
          "content_same": false
        },
        {
          "line": 295,
          "old_api": null,
          "new_api": "CV_Error",
          "old_text": null,
          "new_text": "CV_Error(cv::Error::StsNotImplemented, \"cv::FaceDetectorYN requires enabled 'dnn' module.\")",
          "old_line_content": "",
          "new_line_content": "    CV_Error(cv::Error::StsNotImplemented, \"cv::FaceDetectorYN requires enabled 'dnn' module.\");",
          "content_same": false
        },
        {
          "line": 265,
          "old_api": null,
          "new_api": "copyMakeBorder",
          "old_text": null,
          "new_text": "copyMakeBorder(input_image, pad_image, 0, bottom, 0, right, BORDER_CONSTANT, 0)",
          "old_line_content": "    dnn::Net net;",
          "new_line_content": "        copyMakeBorder(input_image, pad_image, 0, bottom, 0, right, BORDER_CONSTANT, 0);",
          "content_same": false
        },
        {
          "line": 239,
          "old_api": null,
          "new_api": "faces.at<float>(rIdx, 2)",
          "old_text": null,
          "new_text": "faces.at<float>(rIdx, 2)",
          "old_line_content": "            }",
          "new_line_content": "                                           int(faces.at<float>(rIdx, 2)),",
          "content_same": false
        },
        {
          "line": 240,
          "old_api": null,
          "new_api": "faces.at<float>(rIdx, 3)",
          "old_text": null,
          "new_text": "faces.at<float>(rIdx, 3)",
          "old_line_content": "",
          "new_line_content": "                                           int(faces.at<float>(rIdx, 3))));",
          "content_same": false
        },
        {
          "line": 209,
          "old_api": null,
          "new_api": "exp",
          "old_text": null,
          "new_text": "exp(bbox_v[idx * 4 + 2])",
          "old_line_content": "                    float x1 = cx - w / 2.f;",
          "new_line_content": "                    float w = exp(bbox_v[idx * 4 + 2]) * strides[i];",
          "content_same": false
        },
        {
          "line": 210,
          "old_api": null,
          "new_api": "exp",
          "old_text": null,
          "new_text": "exp(bbox_v[idx * 4 + 3])",
          "old_line_content": "                    float y1 = cy - h / 2.f;",
          "new_line_content": "                    float h = exp(bbox_v[idx * 4 + 3]) * strides[i];",
          "content_same": false
        },
        {
          "line": 241,
          "old_api": null,
          "new_api": "faces.at<float>(rIdx, 14)",
          "old_text": null,
          "new_text": "faces.at<float>(rIdx, 14)",
          "old_line_content": "            std::vector<int> keepIdx;",
          "new_line_content": "                faceScores.push_back(faces.at<float>(rIdx, 14));",
          "content_same": false
        },
        {
          "line": 245,
          "old_api": null,
          "new_api": "dnn::NMSBoxes(faceBoxes, faceScores, scoreThreshold, nmsThreshold, keepIdx, 1.f, topK)",
          "old_text": null,
          "new_text": "dnn::NMSBoxes(faceBoxes, faceScores, scoreThreshold, nmsThreshold, keepIdx, 1.f, topK)",
          "old_line_content": "            Mat nms_faces;",
          "new_line_content": "            dnn::NMSBoxes(faceBoxes, faceScores, scoreThreshold, nmsThreshold, keepIdx, 1.f, topK);",
          "content_same": false
        },
        {
          "line": 312,
          "old_api": null,
          "new_api": "CV_UNUSED",
          "old_text": null,
          "new_text": "CV_UNUSED(target_id)",
          "old_line_content": "}",
          "new_line_content": "    CV_UNUSED(bufferModel); CV_UNUSED(bufferConfig); CV_UNUSED(input_size); CV_UNUSED(score_threshold); CV_UNUSED(nms_threshold); CV_UNUSED(top_k); CV_UNUSED(backend_id); CV_UNUSED(target_id);",
          "content_same": false
        },
        {
          "line": 313,
          "old_api": null,
          "new_api": "CV_Error",
          "old_text": null,
          "new_text": "CV_Error(cv::Error::StsNotImplemented, \"cv::FaceDetectorYN requires enabled 'dnn' module.\")",
          "old_line_content": "",
          "new_line_content": "    CV_Error(cv::Error::StsNotImplemented, \"cv::FaceDetectorYN requires enabled 'dnn' module.\");",
          "content_same": false
        },
        {
          "line": 218,
          "old_api": null,
          "new_api": "face.at<float>(0, 3)",
          "old_text": null,
          "new_text": "face.at<float>(0, 3)",
          "old_line_content": "                    for(int n = 0; n < 5; ++n) {",
          "new_line_content": "                    face.at<float>(0, 3) = h;",
          "content_same": false
        },
        {
          "line": 251,
          "old_api": null,
          "new_api": "row",
          "old_text": null,
          "new_text": "faces.row(idx)",
          "old_line_content": "        }",
          "new_line_content": "                nms_faces.push_back(faces.row(idx));",
          "content_same": false
        },
        {
          "line": 216,
          "old_api": null,
          "new_api": "face.at<float>(0, 1)",
          "old_text": null,
          "new_text": "face.at<float>(0, 1)",
          "old_line_content": "",
          "new_line_content": "                    face.at<float>(0, 1) = y1;",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 289,
          "old_api": "makePtr<FaceDetectorYNImpl>(model, config, input_size, score_threshold, nms_threshold, top_k, backend_id, target_id)",
          "new_api": null,
          "old_text": "makePtr<FaceDetectorYNImpl>(model, config, input_size, score_threshold, nms_threshold, top_k, backend_id, target_id)",
          "new_text": null,
          "old_line_content": "    return makePtr<FaceDetectorYNImpl>(model, config, input_size, score_threshold, nms_threshold, top_k, backend_id, target_id);",
          "new_line_content": "                                           const int target_id)",
          "content_same": false
        },
        {
          "line": 291,
          "old_api": "CV_UNUSED",
          "new_api": null,
          "old_text": "CV_UNUSED(target_id)",
          "new_text": null,
          "old_line_content": "    CV_UNUSED(model); CV_UNUSED(config); CV_UNUSED(input_size); CV_UNUSED(score_threshold); CV_UNUSED(nms_threshold); CV_UNUSED(top_k); CV_UNUSED(backend_id); CV_UNUSED(target_id);",
          "new_line_content": "#ifdef HAVE_OPENCV_DNN",
          "content_same": false
        },
        {
          "line": 262,
          "old_api": "copyMakeBorder",
          "new_api": null,
          "old_text": "copyMakeBorder(input_image, pad_image, 0, bottom, 0, right, BORDER_CONSTANT, 0)",
          "new_text": null,
          "old_line_content": "        copyMakeBorder(input_image, pad_image, 0, bottom, 0, right, BORDER_CONSTANT, 0);",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 234,
          "old_api": "faces.at<float>(rIdx, 0)",
          "new_api": null,
          "old_text": "faces.at<float>(rIdx, 0)",
          "new_text": null,
          "old_line_content": "                faceBoxes.push_back(Rect2i(int(faces.at<float>(rIdx, 0)),",
          "new_line_content": "            std::vector<float> faceScores;",
          "content_same": false
        },
        {
          "line": 235,
          "old_api": "faces.at<float>(rIdx, 1)",
          "new_api": null,
          "old_text": "faces.at<float>(rIdx, 1)",
          "new_text": null,
          "old_line_content": "                                           int(faces.at<float>(rIdx, 1)),",
          "new_line_content": "            for (int rIdx = 0; rIdx < faces.rows; rIdx++)",
          "content_same": false
        },
        {
          "line": 236,
          "old_api": "faces.at<float>(rIdx, 2)",
          "new_api": null,
          "old_text": "faces.at<float>(rIdx, 2)",
          "new_text": null,
          "old_line_content": "                                           int(faces.at<float>(rIdx, 2)),",
          "new_line_content": "            {",
          "content_same": false
        },
        {
          "line": 206,
          "old_api": "exp",
          "new_api": null,
          "old_text": "exp(bbox_v[idx * 4 + 2])",
          "new_text": null,
          "old_line_content": "                    float w = exp(bbox_v[idx * 4 + 2]) * strides[i];",
          "new_line_content": "                    // Get bounding box",
          "content_same": false
        },
        {
          "line": 207,
          "old_api": "exp",
          "new_api": null,
          "old_text": "exp(bbox_v[idx * 4 + 3])",
          "new_text": null,
          "old_line_content": "                    float h = exp(bbox_v[idx * 4 + 3]) * strides[i];",
          "new_line_content": "                    float cx = ((c + bbox_v[idx * 4 + 0]) * strides[i]);",
          "content_same": false
        },
        {
          "line": 242,
          "old_api": "dnn::NMSBoxes(faceBoxes, faceScores, scoreThreshold, nmsThreshold, keepIdx, 1.f, topK)",
          "new_api": null,
          "old_text": "dnn::NMSBoxes(faceBoxes, faceScores, scoreThreshold, nmsThreshold, keepIdx, 1.f, topK)",
          "new_text": null,
          "old_line_content": "            dnn::NMSBoxes(faceBoxes, faceScores, scoreThreshold, nmsThreshold, keepIdx, 1.f, topK);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 307,
          "old_api": "makePtr<FaceDetectorYNImpl>(framework, bufferModel, bufferConfig, input_size, score_threshold, nms_threshold, top_k, backend_id, target_id)",
          "new_api": null,
          "old_text": "makePtr<FaceDetectorYNImpl>(framework, bufferModel, bufferConfig, input_size, score_threshold, nms_threshold, top_k, backend_id, target_id)",
          "new_text": null,
          "old_line_content": "    return makePtr<FaceDetectorYNImpl>(framework, bufferModel, bufferConfig, input_size, score_threshold, nms_threshold, top_k, backend_id, target_id);",
          "new_line_content": "                                           const int target_id)",
          "content_same": false
        },
        {
          "line": 212,
          "old_api": "face.at<float>(0, 0)",
          "new_api": null,
          "old_text": "face.at<float>(0, 0)",
          "new_text": null,
          "old_line_content": "                    face.at<float>(0, 0) = x1;",
          "new_line_content": "                    float x1 = cx - w / 2.f;",
          "content_same": false
        },
        {
          "line": 309,
          "old_api": "CV_UNUSED",
          "new_api": null,
          "old_text": "CV_UNUSED(target_id)",
          "new_text": null,
          "old_line_content": "    CV_UNUSED(bufferModel); CV_UNUSED(bufferConfig); CV_UNUSED(input_size); CV_UNUSED(score_threshold); CV_UNUSED(nms_threshold); CV_UNUSED(top_k); CV_UNUSED(backend_id); CV_UNUSED(target_id);",
          "new_line_content": "#ifdef HAVE_OPENCV_DNN",
          "content_same": false
        },
        {
          "line": 213,
          "old_api": "face.at<float>(0, 1)",
          "new_api": null,
          "old_text": "face.at<float>(0, 1)",
          "new_text": null,
          "old_line_content": "                    face.at<float>(0, 1) = y1;",
          "new_line_content": "                    float y1 = cy - h / 2.f;",
          "content_same": false
        },
        {
          "line": 214,
          "old_api": "face.at<float>(0, 2)",
          "new_api": null,
          "old_text": "face.at<float>(0, 2)",
          "new_text": null,
          "old_line_content": "                    face.at<float>(0, 2) = w;",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 248,
          "old_api": "row",
          "new_api": null,
          "old_text": "faces.row(idx)",
          "new_text": null,
          "old_line_content": "                nms_faces.push_back(faces.row(idx));",
          "new_line_content": "            Mat nms_faces;",
          "content_same": false
        },
        {
          "line": 219,
          "old_api": "face.at<float>(0, 4 + 2 * n)",
          "new_api": null,
          "old_text": "face.at<float>(0, 4 + 2 * n)",
          "new_text": null,
          "old_line_content": "                        face.at<float>(0, 4 + 2 * n) = (kps_v[idx * 10 + 2 * n] + c) * strides[i];",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 220,
          "old_api": "face.at<float>(0, 4 + 2 * n + 1)",
          "new_api": null,
          "old_text": "face.at<float>(0, 4 + 2 * n + 1)",
          "new_text": null,
          "old_line_content": "                        face.at<float>(0, 4 + 2 * n + 1) = (kps_v[idx * 10 + 2 * n + 1]+ r) * strides[i];",
          "new_line_content": "                    // Get landmarks",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 6,
      "total_additions": 17,
      "total_deletions": 17,
      "total_api_changes": 40
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 3,
        "api_related_lines": 40,
        "non_api_lines": 3,
        "non_api_line_numbers": [
          203,
          204,
          205
        ]
      }
    },
    "api_calls_before": 74,
    "api_calls_after": 74,
    "diff_info": {
      "added_lines": 3,
      "removed_lines": 0,
      "total_diff_lines": 15
    }
  }
}