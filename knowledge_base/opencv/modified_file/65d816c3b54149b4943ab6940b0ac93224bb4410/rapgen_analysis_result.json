{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/opencv/modified_file/65d816c3b54149b4943ab6940b0ac93224bb4410",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/opencv/modified_file/65d816c3b54149b4943ab6940b0ac93224bb4410/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/opencv/modified_file/65d816c3b54149b4943ab6940b0ac93224bb4410/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/opencv/modified_file/65d816c3b54149b4943ab6940b0ac93224bb4410/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 324,
          "old_api": "getMat",
          "new_api": "needed",
          "old_text": "_samples.getMat()",
          "new_text": "_results.needed()",
          "old_line_content": "        Mat test_samples = _samples.getMat();",
          "new_line_content": "        if( _results.needed() )",
          "content_same": false
        },
        {
          "line": 331,
          "old_api": "release",
          "new_api": "create",
          "old_text": "_neighborResponses.release()",
          "new_text": "_neighborResponses.create(testcount, k, CV_32F)",
          "old_line_content": "            _neighborResponses.release();",
          "new_line_content": "            _neighborResponses.create(testcount, k, CV_32F);",
          "content_same": false
        },
        {
          "line": 332,
          "old_api": "release",
          "new_api": "getMat",
          "old_text": "_dists.release()",
          "new_text": "_neighborResponses.getMat()",
          "old_line_content": "            _dists.release();",
          "new_line_content": "            pnr = &(nr = _neighborResponses.getMat());",
          "content_same": false
        },
        {
          "line": 337,
          "old_api": "needed",
          "new_api": "getMat",
          "old_text": "_results.needed()",
          "new_text": "_dists.getMat()",
          "old_line_content": "        if( _results.needed() )",
          "new_line_content": "            pd = &(d = _dists.getMat());",
          "content_same": false
        },
        {
          "line": 380,
          "old_api": "getMat",
          "new_api": "needed",
          "old_text": "_samples.getMat()",
          "new_text": "_results.needed()",
          "old_line_content": "        Mat test_samples = _samples.getMat();",
          "new_line_content": "        if( _results.needed() )",
          "content_same": false
        },
        {
          "line": 387,
          "old_api": "release",
          "new_api": "create",
          "old_text": "_neighborResponses.release()",
          "new_text": "_neighborResponses.create(testcount, k, CV_32F)",
          "old_line_content": "            _neighborResponses.release();",
          "new_line_content": "            _neighborResponses.create(testcount, k, CV_32F);",
          "content_same": false
        },
        {
          "line": 388,
          "old_api": "release",
          "new_api": "getMat",
          "old_text": "_dists.release()",
          "new_text": "_neighborResponses.getMat()",
          "old_line_content": "            _dists.release();",
          "new_line_content": "            nr = _neighborResponses.getMat();",
          "content_same": false
        },
        {
          "line": 393,
          "old_api": "needed",
          "new_api": "getMat",
          "old_text": "_results.needed()",
          "new_text": "_dists.getMat()",
          "old_line_content": "        if( _results.needed() )",
          "new_line_content": "            d = _dists.getMat();",
          "content_same": false
        },
        {
          "line": 401,
          "old_api": "getMat",
          "new_api": "row",
          "old_text": "_neighborResponses.getMat()",
          "new_text": "res.row(i)",
          "old_line_content": "            nr = _neighborResponses.getMat();",
          "new_line_content": "                _res = res.row(i);",
          "content_same": false
        },
        {
          "line": 405,
          "old_api": "create",
          "new_api": "row",
          "old_text": "_dists.create(testcount, k, CV_32F)",
          "new_text": "nr.row(i)",
          "old_line_content": "            _dists.create(testcount, k, CV_32F);",
          "new_line_content": "                _nr = nr.row(i);",
          "content_same": false
        },
        {
          "line": 453,
          "old_api": "initImpl",
          "new_api": "empty",
          "old_text": "initImpl(val)",
          "new_text": "impl->samples.empty()",
          "old_line_content": "        initImpl(val);",
          "new_line_content": "    bool isTrained() const CV_OVERRIDE { return !impl->samples.empty(); }",
          "content_same": false
        },
        {
          "line": 459,
          "old_api": "initImpl",
          "new_api": "writeFormat",
          "old_text": "initImpl(BRUTE_FORCE)",
          "new_text": "writeFormat(fs)",
          "old_line_content": "        initImpl(BRUTE_FORCE);",
          "new_line_content": "        writeFormat(fs);",
          "content_same": false
        },
        {
          "line": 466,
          "old_api": "empty",
          "new_api": "name",
          "old_text": "impl->samples.empty()",
          "new_text": "fn.name()",
          "old_line_content": "    bool isTrained() const CV_OVERRIDE { return !impl->samples.empty(); }",
          "new_line_content": "        if (fn.name() == NAME_KDTREE)",
          "content_same": false
        },
        {
          "line": 482,
          "old_api": "read",
          "new_api": "noArray",
          "old_text": "impl->read(fn)",
          "new_text": "noArray()",
          "old_line_content": "        impl->read(fn);",
          "new_line_content": "        return impl->findNearest( inputs, impl->defaultK, outputs, noArray(), noArray() );",
          "content_same": false
        },
        {
          "line": 487,
          "old_api": "noArray",
          "new_api": "train",
          "old_text": "noArray()",
          "new_text": "impl->train(data, flags)",
          "old_line_content": "                       OutputArray neighborResponses=noArray(),",
          "new_line_content": "        return impl->train(data, flags);",
          "content_same": false
        },
        {
          "line": 490,
          "old_api": "findNearest",
          "new_api": "getModelName",
          "old_text": "impl->findNearest(samples, k, results, neighborResponses, dist)",
          "new_text": "impl->getModelName()",
          "old_line_content": "        return impl->findNearest(samples, k, results, neighborResponses, dist);",
          "new_line_content": "    String getDefaultName() const CV_OVERRIDE { return impl->getModelName(); }",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 385,
          "old_api": null,
          "new_api": "needed",
          "old_text": null,
          "new_text": "_neighborResponses.needed()",
          "old_line_content": "        {",
          "new_line_content": "        if( _neighborResponses.needed() )",
          "content_same": false
        },
        {
          "line": 390,
          "old_api": null,
          "new_api": "needed",
          "old_text": null,
          "new_text": "_dists.needed()",
          "old_line_content": "        }",
          "new_line_content": "        if( _dists.needed() )",
          "content_same": false
        },
        {
          "line": 263,
          "old_api": null,
          "new_api": "results->at<float>(testidx + range.start)",
          "old_text": null,
          "new_text": "results->at<float>(testidx + range.start)",
          "old_line_content": "                        if( j == k || rp[j] != rp[j-1] )",
          "new_line_content": "                    results->at<float>(testidx + range.start) = result;",
          "content_same": false
        },
        {
          "line": 392,
          "old_api": null,
          "new_api": "create",
          "old_text": null,
          "new_text": "_dists.create(testcount, k, CV_32F)",
          "old_line_content": "        Mat res, nr, d;",
          "new_line_content": "            _dists.create(testcount, k, CV_32F);",
          "content_same": false
        },
        {
          "line": 409,
          "old_api": null,
          "new_api": "row",
          "old_text": null,
          "new_text": "d.row(i)",
          "old_line_content": "        for (int i=0; i<test_samples.rows; ++i)",
          "new_line_content": "                _d = d.row(i);",
          "content_same": false
        },
        {
          "line": 411,
          "old_api": null,
          "new_api": "noArray",
          "old_text": null,
          "new_text": "noArray()",
          "old_line_content": "            Mat _res, _nr, _d;",
          "new_line_content": "            tr.findNearest(test_samples.row(i), k, Emax, _res, _nr, _d, noArray());",
          "content_same": false
        },
        {
          "line": 286,
          "old_api": null,
          "new_api": "std::min(range.end - range.start, 256)",
          "old_text": null,
          "new_text": "std::min(range.end - range.start, 256)",
          "old_line_content": "                            Mat* __results, Mat* __neighbor_responses, Mat* __dists, float* _presult)",
          "new_line_content": "            int delta = std::min(range.end - range.start, 256);",
          "content_same": false
        },
        {
          "line": 289,
          "old_api": null,
          "new_api": "std::min(start + delta, range.end)",
          "old_text": null,
          "new_text": "std::min(start + delta, range.end)",
          "old_line_content": "            k = _k;",
          "new_line_content": "                p->findNearestCore( *_samples, k, Range(start, std::min(start + delta, range.end)),",
          "content_same": false
        },
        {
          "line": 434,
          "old_api": null,
          "new_api": "getType",
          "old_text": null,
          "new_text": "impl->getType()",
          "old_line_content": "",
          "new_line_content": "        return impl->getType();",
          "content_same": false
        },
        {
          "line": 309,
          "old_api": null,
          "new_api": "CV_Assert",
          "old_text": null,
          "new_text": "CV_Assert( 0 < k )",
          "old_line_content": "        const Mat* _samples;",
          "new_line_content": "        CV_Assert( 0 < k );",
          "content_same": false
        },
        {
          "line": 311,
          "old_api": null,
          "new_api": "getMat",
          "old_text": null,
          "new_text": "_samples.getMat()",
          "old_line_content": "        Mat* _neighbor_responses;",
          "new_line_content": "        Mat test_samples = _samples.getMat();",
          "content_same": false
        },
        {
          "line": 312,
          "old_api": null,
          "new_api": "type",
          "old_text": null,
          "new_text": "test_samples.type()",
          "old_line_content": "        Mat* _dists;",
          "new_line_content": "        CV_Assert( test_samples.type() == CV_32F && test_samples.cols == samples.cols );",
          "content_same": false
        },
        {
          "line": 440,
          "old_api": null,
          "new_api": "initImpl",
          "old_text": null,
          "new_text": "initImpl(val)",
          "old_line_content": "    inline void setIsClassifier(bool val) CV_OVERRIDE { impl->isclassifier = val; }",
          "new_line_content": "        initImpl(val);",
          "content_same": false
        },
        {
          "line": 444,
          "old_api": null,
          "new_api": "KNearestImpl",
          "old_text": null,
          "new_text": "KNearestImpl()",
          "old_line_content": "public:",
          "new_line_content": "    KNearestImpl()",
          "content_same": false
        },
        {
          "line": 317,
          "old_api": null,
          "new_api": "release",
          "old_text": null,
          "new_text": "_results.release()",
          "old_line_content": "                       OutputArray _results,",
          "new_line_content": "            _results.release();",
          "content_same": false
        },
        {
          "line": 318,
          "old_api": null,
          "new_api": "release",
          "old_text": null,
          "new_text": "_neighborResponses.release()",
          "old_line_content": "                       OutputArray _neighborResponses,",
          "new_line_content": "            _neighborResponses.release();",
          "content_same": false
        },
        {
          "line": 319,
          "old_api": null,
          "new_api": "release",
          "old_text": null,
          "new_text": "_dists.release()",
          "old_line_content": "                       OutputArray _dists ) const CV_OVERRIDE",
          "new_line_content": "            _dists.release();",
          "content_same": false
        },
        {
          "line": 446,
          "old_api": null,
          "new_api": "initImpl",
          "old_text": null,
          "new_text": "initImpl(BRUTE_FORCE)",
          "old_line_content": "    {",
          "new_line_content": "        initImpl(BRUTE_FORCE);",
          "content_same": false
        },
        {
          "line": 326,
          "old_api": null,
          "new_api": "create",
          "old_text": null,
          "new_text": "_results.create(testcount, 1, CV_32F)",
          "old_line_content": "        int testcount = test_samples.rows;",
          "new_line_content": "            _results.create(testcount, 1, CV_32F);",
          "content_same": false
        },
        {
          "line": 327,
          "old_api": null,
          "new_api": "getMat",
          "old_text": null,
          "new_text": "_results.getMat()",
          "old_line_content": "",
          "new_line_content": "            pres = &(res = _results.getMat());",
          "content_same": false
        },
        {
          "line": 329,
          "old_api": null,
          "new_api": "needed",
          "old_text": null,
          "new_text": "_neighborResponses.needed()",
          "old_line_content": "        {",
          "new_line_content": "        if( _neighborResponses.needed() )",
          "content_same": false
        },
        {
          "line": 460,
          "old_api": null,
          "new_api": "write",
          "old_text": null,
          "new_text": "impl->write(fs)",
          "old_line_content": "    }",
          "new_line_content": "        impl->write(fs);",
          "content_same": false
        },
        {
          "line": 334,
          "old_api": null,
          "new_api": "needed",
          "old_text": null,
          "new_text": "_dists.needed()",
          "old_line_content": "        }",
          "new_line_content": "        if( _dists.needed() )",
          "content_same": false
        },
        {
          "line": 336,
          "old_api": null,
          "new_api": "create",
          "old_text": null,
          "new_text": "_dists.create(testcount, k, CV_32F)",
          "old_line_content": "        Mat res, nr, d, *pres = 0, *pnr = 0, *pd = 0;",
          "new_line_content": "            _dists.create(testcount, k, CV_32F);",
          "content_same": false
        },
        {
          "line": 468,
          "old_api": null,
          "new_api": "initImpl",
          "old_text": null,
          "new_text": "initImpl(algorithmType)",
          "old_line_content": "    int getVarCount() const CV_OVERRIDE { return impl->samples.cols; }",
          "new_line_content": "        initImpl(algorithmType);",
          "content_same": false
        },
        {
          "line": 341,
          "old_api": null,
          "new_api": "Range",
          "old_text": null,
          "new_text": "Range(0, testcount)",
          "old_line_content": "        }",
          "new_line_content": "        parallel_for_(Range(0, testcount), invoker);",
          "content_same": false
        },
        {
          "line": 469,
          "old_api": null,
          "new_api": "read",
          "old_text": null,
          "new_text": "impl->read(fn)",
          "old_line_content": "",
          "new_line_content": "        impl->read(fn);",
          "content_same": false
        },
        {
          "line": 474,
          "old_api": null,
          "new_api": "noArray",
          "old_text": null,
          "new_text": "noArray()",
          "old_line_content": "    }",
          "new_line_content": "                       OutputArray neighborResponses=noArray(),",
          "content_same": false
        },
        {
          "line": 475,
          "old_api": null,
          "new_api": "noArray",
          "old_text": null,
          "new_text": "noArray()",
          "old_line_content": "",
          "new_line_content": "                       OutputArray dist=noArray() ) const CV_OVERRIDE",
          "content_same": false
        },
        {
          "line": 477,
          "old_api": null,
          "new_api": "findNearest",
          "old_text": null,
          "new_text": "impl->findNearest(samples, k, results, neighborResponses, dist)",
          "old_line_content": "    {",
          "new_line_content": "        return impl->findNearest(samples, k, results, neighborResponses, dist);",
          "content_same": false
        },
        {
          "line": 356,
          "old_api": null,
          "new_api": "build",
          "old_text": null,
          "new_text": "tr.build(points)",
          "old_line_content": "        return result;",
          "new_line_content": "        tr.build(points);",
          "content_same": false
        },
        {
          "line": 365,
          "old_api": null,
          "new_api": "CV_Assert",
          "old_text": null,
          "new_text": "CV_Assert( 0 < k )",
          "old_line_content": "    int getType() const CV_OVERRIDE { return ml::KNearest::KDTREE; }",
          "new_line_content": "        CV_Assert( 0 < k );",
          "content_same": false
        },
        {
          "line": 367,
          "old_api": null,
          "new_api": "getMat",
          "old_text": null,
          "new_text": "_samples.getMat()",
          "old_line_content": "    void doTrain(InputArray points) CV_OVERRIDE",
          "new_line_content": "        Mat test_samples = _samples.getMat();",
          "content_same": false
        },
        {
          "line": 368,
          "old_api": null,
          "new_api": "type",
          "old_text": null,
          "new_text": "test_samples.type()",
          "old_line_content": "    {",
          "new_line_content": "        CV_Assert( test_samples.type() == CV_32F && test_samples.cols == samples.cols );",
          "content_same": false
        },
        {
          "line": 496,
          "old_api": null,
          "new_api": "makePtr<BruteForceImpl>()",
          "old_text": null,
          "new_text": "makePtr<BruteForceImpl>()",
          "old_line_content": "    }",
          "new_line_content": "            impl = makePtr<BruteForceImpl>();",
          "content_same": false
        },
        {
          "line": 498,
          "old_api": null,
          "new_api": "makePtr<KDTreeImpl>()",
          "old_text": null,
          "new_text": "makePtr<KDTreeImpl>()",
          "old_line_content": "    bool train( const Ptr<TrainData>& data, int flags ) CV_OVERRIDE",
          "new_line_content": "            impl = makePtr<KDTreeImpl>();",
          "content_same": false
        },
        {
          "line": 243,
          "old_api": null,
          "new_api": "std::sort(rp, rp+k)",
          "old_text": null,
          "new_text": "std::sort(rp, rp+k)",
          "old_line_content": "                    for( j = k-1; j > 0; j-- )",
          "new_line_content": "                    std::sort(rp, rp+k);",
          "content_same": false
        },
        {
          "line": 373,
          "old_api": null,
          "new_api": "release",
          "old_text": null,
          "new_text": "_results.release()",
          "old_line_content": "                       OutputArray _results,",
          "new_line_content": "            _results.release();",
          "content_same": false
        },
        {
          "line": 374,
          "old_api": null,
          "new_api": "release",
          "old_text": null,
          "new_text": "_neighborResponses.release()",
          "old_line_content": "                       OutputArray _neighborResponses,",
          "new_line_content": "            _neighborResponses.release();",
          "content_same": false
        },
        {
          "line": 375,
          "old_api": null,
          "new_api": "release",
          "old_text": null,
          "new_text": "_dists.release()",
          "old_line_content": "                       OutputArray _dists ) const CV_OVERRIDE",
          "new_line_content": "            _dists.release();",
          "content_same": false
        },
        {
          "line": 505,
          "old_api": null,
          "new_api": "makePtr<KNearestImpl>()",
          "old_text": null,
          "new_text": "makePtr<KNearestImpl>()",
          "old_line_content": "protected:",
          "new_line_content": "    return makePtr<KNearestImpl>();",
          "content_same": false
        },
        {
          "line": 382,
          "old_api": null,
          "new_api": "create",
          "old_text": null,
          "new_text": "_results.create(testcount, 1, CV_32F)",
          "old_line_content": "        int testcount = test_samples.rows;",
          "new_line_content": "            _results.create(testcount, 1, CV_32F);",
          "content_same": false
        },
        {
          "line": 383,
          "old_api": null,
          "new_api": "getMat",
          "old_text": null,
          "new_text": "_results.getMat()",
          "old_line_content": "",
          "new_line_content": "            res = _results.getMat();",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 509,
          "old_api": "makePtr<BruteForceImpl>()",
          "new_api": null,
          "old_text": "makePtr<BruteForceImpl>()",
          "new_text": null,
          "old_line_content": "            impl = makePtr<BruteForceImpl>();",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 386,
          "old_api": "release",
          "new_api": null,
          "old_text": "_results.release()",
          "new_text": null,
          "old_line_content": "            _results.release();",
          "new_line_content": "        {",
          "content_same": false
        },
        {
          "line": 518,
          "old_api": "makePtr<KNearestImpl>()",
          "new_api": null,
          "old_text": "makePtr<KNearestImpl>()",
          "new_text": null,
          "old_line_content": "    return makePtr<KNearestImpl>();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 395,
          "old_api": "create",
          "new_api": null,
          "old_text": "_results.create(testcount, 1, CV_32F)",
          "new_text": null,
          "old_line_content": "            _results.create(testcount, 1, CV_32F);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 396,
          "old_api": "getMat",
          "new_api": null,
          "old_text": "_results.getMat()",
          "new_text": null,
          "old_line_content": "            res = _results.getMat();",
          "new_line_content": "        for (int i=0; i<test_samples.rows; ++i)",
          "content_same": false
        },
        {
          "line": 398,
          "old_api": "needed",
          "new_api": null,
          "old_text": "_neighborResponses.needed()",
          "new_text": null,
          "old_line_content": "        if( _neighborResponses.needed() )",
          "new_line_content": "            Mat _res, _nr, _d;",
          "content_same": false
        },
        {
          "line": 400,
          "old_api": "create",
          "new_api": null,
          "old_text": "_neighborResponses.create(testcount, k, CV_32F)",
          "new_text": null,
          "old_line_content": "            _neighborResponses.create(testcount, k, CV_32F);",
          "new_line_content": "            {",
          "content_same": false
        },
        {
          "line": 403,
          "old_api": "needed",
          "new_api": null,
          "old_text": "_dists.needed()",
          "new_text": null,
          "old_line_content": "        if( _dists.needed() )",
          "new_line_content": "            if (nr.rows>i)",
          "content_same": false
        },
        {
          "line": 276,
          "old_api": "results->at<float>(testidx + range.start)",
          "new_api": null,
          "old_text": "results->at<float>(testidx + range.start)",
          "new_text": null,
          "old_line_content": "                    results->at<float>(testidx + range.start) = result;",
          "new_line_content": "            k = _k;",
          "content_same": false
        },
        {
          "line": 406,
          "old_api": "getMat",
          "new_api": null,
          "old_text": "_dists.getMat()",
          "new_text": null,
          "old_line_content": "            d = _dists.getMat();",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 414,
          "old_api": "row",
          "new_api": null,
          "old_text": "res.row(i)",
          "new_text": null,
          "old_line_content": "                _res = res.row(i);",
          "new_line_content": "        return result; // currently always 0",
          "content_same": false
        },
        {
          "line": 418,
          "old_api": "row",
          "new_api": null,
          "old_text": "nr.row(i)",
          "new_text": null,
          "old_line_content": "                _nr = nr.row(i);",
          "new_line_content": "};",
          "content_same": false
        },
        {
          "line": 422,
          "old_api": "row",
          "new_api": null,
          "old_text": "d.row(i)",
          "new_text": null,
          "old_line_content": "                _d = d.row(i);",
          "new_line_content": "class KNearestImpl CV_FINAL : public KNearest",
          "content_same": false
        },
        {
          "line": 424,
          "old_api": "noArray",
          "new_api": null,
          "old_text": "noArray()",
          "new_text": null,
          "old_line_content": "            tr.findNearest(test_samples.row(i), k, Emax, _res, _nr, _d, noArray());",
          "new_line_content": "    inline int getDefaultK() const CV_OVERRIDE { return impl->defaultK; }",
          "content_same": false
        },
        {
          "line": 299,
          "old_api": "std::min(range.end - range.start, 256)",
          "new_api": null,
          "old_text": "std::min(range.end - range.start, 256)",
          "new_text": null,
          "old_line_content": "            int delta = std::min(range.end - range.start, 256);",
          "new_line_content": "        Mat* _dists;",
          "content_same": false
        },
        {
          "line": 302,
          "old_api": "std::min(start + delta, range.end)",
          "new_api": null,
          "old_text": "std::min(start + delta, range.end)",
          "new_text": null,
          "old_line_content": "                p->findNearestCore( *_samples, k, Range(start, std::min(start + delta, range.end)),",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 447,
          "old_api": "getType",
          "new_api": null,
          "old_text": "impl->getType()",
          "new_text": null,
          "old_line_content": "        return impl->getType();",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 322,
          "old_api": "CV_Assert",
          "new_api": null,
          "old_text": "CV_Assert( 0 < k )",
          "new_text": null,
          "old_line_content": "        CV_Assert( 0 < k );",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 325,
          "old_api": "type",
          "new_api": null,
          "old_text": "test_samples.type()",
          "new_text": null,
          "old_line_content": "        CV_Assert( test_samples.type() == CV_32F && test_samples.cols == samples.cols );",
          "new_line_content": "        {",
          "content_same": false
        },
        {
          "line": 457,
          "old_api": "KNearestImpl",
          "new_api": null,
          "old_text": "KNearestImpl()",
          "new_text": null,
          "old_line_content": "    KNearestImpl()",
          "new_line_content": "    void write( FileStorage& fs ) const CV_OVERRIDE",
          "content_same": false
        },
        {
          "line": 330,
          "old_api": "release",
          "new_api": null,
          "old_text": "_results.release()",
          "new_text": null,
          "old_line_content": "            _results.release();",
          "new_line_content": "        {",
          "content_same": false
        },
        {
          "line": 339,
          "old_api": "create",
          "new_api": null,
          "old_text": "_results.create(testcount, 1, CV_32F)",
          "new_text": null,
          "old_line_content": "            _results.create(testcount, 1, CV_32F);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 340,
          "old_api": "getMat",
          "new_api": null,
          "old_text": "_results.getMat()",
          "new_text": null,
          "old_line_content": "            pres = &(res = _results.getMat());",
          "new_line_content": "        findKNearestInvoker invoker(this, k, test_samples, pres, pnr, pd, &result);",
          "content_same": false
        },
        {
          "line": 342,
          "old_api": "needed",
          "new_api": null,
          "old_text": "_neighborResponses.needed()",
          "new_text": null,
          "old_line_content": "        if( _neighborResponses.needed() )",
          "new_line_content": "        //invoker(Range(0, testcount));",
          "content_same": false
        },
        {
          "line": 344,
          "old_api": "create",
          "new_api": null,
          "old_text": "_neighborResponses.create(testcount, k, CV_32F)",
          "new_text": null,
          "old_line_content": "            _neighborResponses.create(testcount, k, CV_32F);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 345,
          "old_api": "getMat",
          "new_api": null,
          "old_text": "_neighborResponses.getMat()",
          "new_text": null,
          "old_line_content": "            pnr = &(nr = _neighborResponses.getMat());",
          "new_line_content": "};",
          "content_same": false
        },
        {
          "line": 472,
          "old_api": "writeFormat",
          "new_api": null,
          "old_text": "writeFormat(fs)",
          "new_text": null,
          "old_line_content": "        writeFormat(fs);",
          "new_line_content": "    float findNearest( InputArray samples, int k,",
          "content_same": false
        },
        {
          "line": 347,
          "old_api": "needed",
          "new_api": null,
          "old_text": "_dists.needed()",
          "new_text": null,
          "old_line_content": "        if( _dists.needed() )",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 473,
          "old_api": "write",
          "new_api": null,
          "old_text": "impl->write(fs)",
          "new_text": null,
          "old_line_content": "        impl->write(fs);",
          "new_line_content": "                       OutputArray results,",
          "content_same": false
        },
        {
          "line": 349,
          "old_api": "create",
          "new_api": null,
          "old_text": "_dists.create(testcount, k, CV_32F)",
          "new_text": null,
          "old_line_content": "            _dists.create(testcount, k, CV_32F);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 350,
          "old_api": "getMat",
          "new_api": null,
          "old_text": "_dists.getMat()",
          "new_text": null,
          "old_line_content": "            pd = &(d = _dists.getMat());",
          "new_line_content": "public:",
          "content_same": false
        },
        {
          "line": 479,
          "old_api": "name",
          "new_api": null,
          "old_text": "fn.name()",
          "new_text": null,
          "old_line_content": "        if (fn.name() == NAME_KDTREE)",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 481,
          "old_api": "initImpl",
          "new_api": null,
          "old_text": "initImpl(algorithmType)",
          "new_text": null,
          "old_line_content": "        initImpl(algorithmType);",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 354,
          "old_api": "Range",
          "new_api": null,
          "old_text": "Range(0, testcount)",
          "new_text": null,
          "old_line_content": "        parallel_for_(Range(0, testcount), invoker);",
          "new_line_content": "    void doTrain(InputArray points) CV_OVERRIDE",
          "content_same": false
        },
        {
          "line": 488,
          "old_api": "noArray",
          "new_api": null,
          "old_text": "noArray()",
          "new_text": null,
          "old_line_content": "                       OutputArray dist=noArray() ) const CV_OVERRIDE",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 250,
          "old_api": "std::swap(rp[i], rp[i+1])",
          "new_api": null,
          "old_text": "std::swap(rp[i], rp[i+1])",
          "new_text": null,
          "old_line_content": "                                std::swap(rp[i], rp[i+1]);",
          "new_line_content": "                        if( j == k || rp[j] != rp[j-1] )",
          "content_same": false
        },
        {
          "line": 495,
          "old_api": "noArray",
          "new_api": null,
          "old_text": "noArray()",
          "new_text": null,
          "old_line_content": "        return impl->findNearest( inputs, impl->defaultK, outputs, noArray(), noArray() );",
          "new_line_content": "        if (algorithmType != KDTREE)",
          "content_same": false
        },
        {
          "line": 369,
          "old_api": "build",
          "new_api": null,
          "old_text": "tr.build(points)",
          "new_text": null,
          "old_line_content": "        tr.build(points);",
          "new_line_content": "        int testcount = test_samples.rows;",
          "content_same": false
        },
        {
          "line": 500,
          "old_api": "train",
          "new_api": null,
          "old_text": "impl->train(data, flags)",
          "new_text": null,
          "old_line_content": "        return impl->train(data, flags);",
          "new_line_content": "    Ptr<Impl> impl;",
          "content_same": false
        },
        {
          "line": 503,
          "old_api": "getModelName",
          "new_api": null,
          "old_text": "impl->getModelName()",
          "new_text": null,
          "old_line_content": "    String getDefaultName() const CV_OVERRIDE { return impl->getModelName(); }",
          "new_line_content": "Ptr<KNearest> KNearest::create()",
          "content_same": false
        },
        {
          "line": 378,
          "old_api": "CV_Assert",
          "new_api": null,
          "old_text": "CV_Assert( 0 < k )",
          "new_text": null,
          "old_line_content": "        CV_Assert( 0 < k );",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 381,
          "old_api": "type",
          "new_api": null,
          "old_text": "test_samples.type()",
          "new_text": null,
          "old_line_content": "        CV_Assert( test_samples.type() == CV_32F && test_samples.cols == samples.cols );",
          "new_line_content": "        {",
          "content_same": false
        },
        {
          "line": 511,
          "old_api": "makePtr<KDTreeImpl>()",
          "new_api": null,
          "old_text": "makePtr<KDTreeImpl>()",
          "new_text": null,
          "old_line_content": "            impl = makePtr<KDTreeImpl>();",
          "new_line_content": "/* End of file */",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 16,
      "total_additions": 43,
      "total_deletions": 43,
      "total_api_changes": 102
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 14,
        "api_related_lines": 102,
        "non_api_lines": 12,
        "non_api_line_numbers": [
          256,
          244,
          245,
          246,
          247,
          248,
          249,
          251,
          252,
          253,
          254,
          255
        ]
      }
    },
    "api_calls_before": 88,
    "api_calls_after": 88,
    "diff_info": {
      "added_lines": 1,
      "removed_lines": 14,
      "total_diff_lines": 27
    }
  }
}