{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/opencv/modified_file/7de2e1e7957075ebbd504b2c9aea256e61b2d547",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/opencv/modified_file/7de2e1e7957075ebbd504b2c9aea256e61b2d547/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/opencv/modified_file/7de2e1e7957075ebbd504b2c9aea256e61b2d547/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/opencv/modified_file/7de2e1e7957075ebbd504b2c9aea256e61b2d547/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 363,
          "old_api": "MAX",
          "new_api": "findInliers",
          "old_text": "MAX( sigma, 0.001 )",
          "new_text": "findInliers( m1, m2, bestModel, err, mask, sigma )",
          "old_line_content": "            sigma = MAX( sigma, 0.001 );",
          "new_line_content": "            count = findInliers( m1, m2, bestModel, err, mask, sigma );",
          "content_same": false
        },
        {
          "line": 366,
          "old_api": "needed",
          "new_api": "size",
          "old_text": "_mask.needed()",
          "new_text": "mask.size()",
          "old_line_content": "            if( _mask.needed() && mask0.data != mask.data )",
          "new_line_content": "                if( mask0.size() == mask.size() )",
          "content_same": false
        },
        {
          "line": 369,
          "old_api": "copyTo",
          "new_api": "transpose",
          "old_text": "mask.copyTo(mask0)",
          "new_text": "transpose(mask, mask0)",
          "old_line_content": "                    mask.copyTo(mask0);",
          "new_line_content": "                    transpose(mask, mask0);",
          "content_same": false
        },
        {
          "line": 371,
          "old_api": "transpose",
          "new_api": "copyTo",
          "old_text": "transpose(mask, mask0)",
          "new_text": "bestModel.copyTo(_model)",
          "old_line_content": "                    transpose(mask, mask0);",
          "new_line_content": "            bestModel.copyTo(_model);",
          "content_same": false
        },
        {
          "line": 406,
          "old_api": "getMat",
          "new_api": "m2.ptr<Point3f>()",
          "old_text": "_m2.getMat()",
          "new_text": "m2.ptr<Point3f>()",
          "old_line_content": "        Mat m1 = _m1.getMat(), m2 = _m2.getMat();",
          "new_line_content": "        const Point3f* to   = m2.ptr<Point3f>();",
          "content_same": false
        },
        {
          "line": 415,
          "old_api": "A.ptr<double>()",
          "new_api": "Scalar::all(0)",
          "old_text": "A.ptr<double>()",
          "new_text": "Scalar::all(0)",
          "old_line_content": "        double* Adata = A.ptr<double>();",
          "new_line_content": "        A = Scalar::all(0);",
          "content_same": false
        },
        {
          "line": 444,
          "old_api": "getMat",
          "new_api": "m2.ptr<Point3f>()",
          "old_text": "_model.getMat()",
          "new_text": "m2.ptr<Point3f>()",
          "old_line_content": "        Mat m1 = _m1.getMat(), m2 = _m2.getMat(), model = _model.getMat();",
          "new_line_content": "        const Point3f* to   = m2.ptr<Point3f>();",
          "content_same": false
        },
        {
          "line": 445,
          "old_api": "m1.ptr<Point3f>()",
          "new_api": "model.ptr<double>()",
          "old_text": "m1.ptr<Point3f>()",
          "new_text": "model.ptr<double>()",
          "old_line_content": "        const Point3f* from = m1.ptr<Point3f>();",
          "new_line_content": "        const double* F = model.ptr<double>();",
          "content_same": false
        },
        {
          "line": 447,
          "old_api": "model.ptr<double>()",
          "new_api": "checkVector",
          "old_text": "model.ptr<double>()",
          "new_text": "m1.checkVector(3)",
          "old_line_content": "        const double* F = model.ptr<double>();",
          "new_line_content": "        int count = m1.checkVector(3);",
          "content_same": false
        },
        {
          "line": 450,
          "old_api": "CV_Assert",
          "new_api": "create",
          "old_text": "CV_Assert( count > 0 )",
          "new_text": "_err.create(count, 1, CV_32F)",
          "old_line_content": "        CV_Assert( count > 0 );",
          "new_line_content": "        _err.create(count, 1, CV_32F);",
          "content_same": false
        },
        {
          "line": 452,
          "old_api": "create",
          "new_api": "err.ptr<float>()",
          "old_text": "_err.create(count, 1, CV_32F)",
          "new_text": "err.ptr<float>()",
          "old_line_content": "        _err.create(count, 1, CV_32F);",
          "new_line_content": "        float* errptr = err.ptr<float>();",
          "content_same": false
        },
        {
          "line": 478,
          "old_api": "msi->ptr<Point3f>()",
          "new_api": "CV_Assert",
          "old_text": "msi->ptr<Point3f>()",
          "new_text": "CV_Assert( count <= msi->rows )",
          "old_line_content": "            const Point3f* ptr = msi->ptr<Point3f>();",
          "new_line_content": "            CV_Assert( count <= msi->rows );",
          "content_same": false
        },
        {
          "line": 510,
          "old_api": "CV_INSTRUMENT_REGION",
          "new_api": "getMat",
          "old_text": "CV_INSTRUMENT_REGION()",
          "new_text": "_to.getMat()",
          "old_line_content": "    CV_INSTRUMENT_REGION()",
          "new_line_content": "    Mat from = _from.getMat(), to = _to.getMat();",
          "content_same": false
        },
        {
          "line": 518,
          "old_api": "convertTo",
          "new_api": "reshape",
          "old_text": "from.convertTo(dFrom, CV_32F)",
          "new_text": "dFrom.reshape(3, count)",
          "old_line_content": "    from.convertTo(dFrom, CV_32F);",
          "new_line_content": "    dFrom = dFrom.reshape(3, count);",
          "content_same": false
        },
        {
          "line": 519,
          "old_api": "convertTo",
          "new_api": "reshape",
          "old_text": "to.convertTo(dTo, CV_32F)",
          "new_text": "dTo.reshape(3, count)",
          "old_line_content": "    to.convertTo(dTo, CV_32F);",
          "new_line_content": "    dTo = dTo.reshape(3, count);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 386,
          "old_api": null,
          "new_api": "Ptr<PointSetRegistrator>(\n        new RANSACPointSetRegistrator(_cb, _modelPoints, _threshold, _confidence, _maxIters))",
          "old_text": null,
          "new_text": "Ptr<PointSetRegistrator>(\n        new RANSACPointSetRegistrator(_cb, _modelPoints, _threshold, _confidence, _maxIters))",
          "old_line_content": "                                                         double _confidence, int _maxIters)",
          "new_line_content": "    return Ptr<PointSetRegistrator>(",
          "content_same": false
        },
        {
          "line": 516,
          "old_api": null,
          "new_api": "convertTo",
          "old_text": null,
          "new_text": "from.convertTo(dFrom, CV_32F)",
          "old_line_content": "",
          "new_line_content": "    from.convertTo(dFrom, CV_32F);",
          "content_same": false
        },
        {
          "line": 517,
          "old_api": null,
          "new_api": "convertTo",
          "old_text": null,
          "new_text": "to.convertTo(dTo, CV_32F)",
          "old_line_content": "    Mat dFrom, dTo;",
          "new_line_content": "    to.convertTo(dTo, CV_32F);",
          "content_same": false
        },
        {
          "line": 394,
          "old_api": null,
          "new_api": "Ptr<PointSetRegistrator>(\n        new LMeDSPointSetRegistrator(_cb, _modelPoints, _confidence, _maxIters))",
          "old_text": null,
          "new_text": "Ptr<PointSetRegistrator>(\n        new LMeDSPointSetRegistrator(_cb, _modelPoints, _confidence, _maxIters))",
          "old_line_content": "                             int _modelPoints, double _confidence, int _maxIters)",
          "new_line_content": "    return Ptr<PointSetRegistrator>(",
          "content_same": false
        },
        {
          "line": 525,
          "old_api": null,
          "new_api": "makePtr<Affine3DEstimatorCallback>()",
          "old_text": null,
          "new_text": "makePtr<Affine3DEstimatorCallback>()",
          "old_line_content": "    param2 = (param2 < epsilon) ? 0.99 : (param2 > 1 - epsilon) ? 0.99 : param2;",
          "new_line_content": "    return createRANSACPointSetRegistrator(makePtr<Affine3DEstimatorCallback>(), 4, param1, param2)->run(dFrom, dTo, _out, _inliers);",
          "content_same": false
        },
        {
          "line": 404,
          "old_api": null,
          "new_api": "getMat",
          "old_text": null,
          "new_text": "_m2.getMat()",
          "old_line_content": "    int runKernel( InputArray _m1, InputArray _m2, OutputArray _model ) const",
          "new_line_content": "        Mat m1 = _m1.getMat(), m2 = _m2.getMat();",
          "content_same": false
        },
        {
          "line": 405,
          "old_api": null,
          "new_api": "m1.ptr<Point3f>()",
          "old_text": null,
          "new_text": "m1.ptr<Point3f>()",
          "old_line_content": "    {",
          "new_line_content": "        const Point3f* from = m1.ptr<Point3f>();",
          "content_same": false
        },
        {
          "line": 413,
          "old_api": null,
          "new_api": "A.ptr<double>()",
          "old_text": null,
          "new_text": "A.ptr<double>()",
          "old_line_content": "        Mat B(N, 1, CV_64F, &buf[0] + N*N);",
          "new_line_content": "        double* Adata = A.ptr<double>();",
          "content_same": false
        },
        {
          "line": 414,
          "old_api": null,
          "new_api": "B.ptr<double>()",
          "old_text": null,
          "new_text": "B.ptr<double>()",
          "old_line_content": "        Mat X(N, 1, CV_64F, &buf[0] + N*N + N);",
          "new_line_content": "        double* Bdata = B.ptr<double>();",
          "content_same": false
        },
        {
          "line": 434,
          "old_api": null,
          "new_api": "solve",
          "old_text": null,
          "new_text": "solve(A, B, X, DECOMP_SVD)",
          "old_line_content": "        }",
          "new_line_content": "        solve(A, B, X, DECOMP_SVD);",
          "content_same": false
        },
        {
          "line": 435,
          "old_api": null,
          "new_api": "reshape",
          "old_text": null,
          "new_text": "X.reshape(1, 3).copyTo(_model)",
          "old_line_content": "",
          "new_line_content": "        X.reshape(1, 3).copyTo(_model);",
          "content_same": false
        },
        {
          "line": 442,
          "old_api": null,
          "new_api": "getMat",
          "old_text": null,
          "new_text": "_model.getMat()",
          "old_line_content": "    void computeError( InputArray _m1, InputArray _m2, InputArray _model, OutputArray _err ) const",
          "new_line_content": "        Mat m1 = _m1.getMat(), m2 = _m2.getMat(), model = _model.getMat();",
          "content_same": false
        },
        {
          "line": 443,
          "old_api": null,
          "new_api": "m1.ptr<Point3f>()",
          "old_text": null,
          "new_text": "m1.ptr<Point3f>()",
          "old_line_content": "    {",
          "new_line_content": "        const Point3f* from = m1.ptr<Point3f>();",
          "content_same": false
        },
        {
          "line": 448,
          "old_api": null,
          "new_api": "CV_Assert",
          "old_text": null,
          "new_text": "CV_Assert( count > 0 )",
          "old_line_content": "",
          "new_line_content": "        CV_Assert( count > 0 );",
          "content_same": false
        },
        {
          "line": 451,
          "old_api": null,
          "new_api": "getMat",
          "old_text": null,
          "new_text": "_err.getMat()",
          "old_line_content": "",
          "new_line_content": "        Mat err = _err.getMat();",
          "content_same": false
        },
        {
          "line": 470,
          "old_api": null,
          "new_api": "getMat",
          "old_text": null,
          "new_text": "_ms2.getMat()",
          "old_line_content": "    {",
          "new_line_content": "        Mat ms1 = _ms1.getMat(), ms2 = _ms2.getMat();",
          "content_same": false
        },
        {
          "line": 348,
          "old_api": null,
          "new_api": "errf.at<float>(count/2)",
          "old_text": null,
          "new_text": "errf.at<float>(count/2)",
          "old_line_content": "",
          "new_line_content": "                double median = errf.at<float>(count/2);",
          "content_same": false
        },
        {
          "line": 476,
          "old_api": null,
          "new_api": "msi->ptr<Point3f>()",
          "old_text": null,
          "new_text": "msi->ptr<Point3f>()",
          "old_line_content": "            int j, k, i = count - 1;",
          "new_line_content": "            const Point3f* ptr = msi->ptr<Point3f>();",
          "content_same": false
        },
        {
          "line": 353,
          "old_api": null,
          "new_api": "copyTo",
          "old_text": null,
          "new_text": "model_i.copyTo(bestModel)",
          "old_line_content": "                {",
          "new_line_content": "                    model_i.copyTo(bestModel);",
          "content_same": false
        },
        {
          "line": 360,
          "old_api": null,
          "new_api": "std::sqrt(minMedian)",
          "old_text": null,
          "new_text": "std::sqrt(minMedian)",
          "old_line_content": "        if( minMedian < DBL_MAX )",
          "new_line_content": "            double sigma = 2.5*1.4826*(1 + 5./(count - modelPoints))*std::sqrt(minMedian);",
          "content_same": false
        },
        {
          "line": 361,
          "old_api": null,
          "new_api": "MAX",
          "old_text": null,
          "new_text": "MAX( sigma, 0.001 )",
          "old_line_content": "        {",
          "new_line_content": "            sigma = MAX( sigma, 0.001 );",
          "content_same": false
        },
        {
          "line": 364,
          "old_api": null,
          "new_api": "needed",
          "old_text": null,
          "new_text": "_mask.needed()",
          "old_line_content": "",
          "new_line_content": "            if( _mask.needed() && mask0.data != mask.data )",
          "content_same": false
        },
        {
          "line": 367,
          "old_api": null,
          "new_api": "copyTo",
          "old_text": null,
          "new_text": "mask.copyTo(mask0)",
          "old_line_content": "            {",
          "new_line_content": "                    mask.copyTo(mask0);",
          "content_same": false
        },
        {
          "line": 375,
          "old_api": null,
          "new_api": "release",
          "old_text": null,
          "new_text": "_model.release()",
          "old_line_content": "        }",
          "new_line_content": "            _model.release();",
          "content_same": false
        },
        {
          "line": 508,
          "old_api": null,
          "new_api": "CV_INSTRUMENT_REGION",
          "old_text": null,
          "new_text": "CV_INSTRUMENT_REGION()",
          "old_line_content": "                         double param1, double param2)",
          "new_line_content": "    CV_INSTRUMENT_REGION()",
          "content_same": false
        },
        {
          "line": 511,
          "old_api": null,
          "new_api": "checkVector",
          "old_text": null,
          "new_text": "from.checkVector(3)",
          "old_line_content": "",
          "new_line_content": "    int count = from.checkVector(3);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 512,
          "old_api": "getMat",
          "new_api": null,
          "old_text": "_to.getMat()",
          "new_text": null,
          "old_line_content": "    Mat from = _from.getMat(), to = _to.getMat();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 515,
          "old_api": "checkVector",
          "new_api": null,
          "old_text": "to.checkVector(3)",
          "new_text": null,
          "old_line_content": "    CV_Assert( count >= 0 && to.checkVector(3) == count );",
          "new_line_content": "    Mat dFrom, dTo;",
          "content_same": false
        },
        {
          "line": 388,
          "old_api": "Ptr<PointSetRegistrator>(\n        new RANSACPointSetRegistrator(_cb, _modelPoints, _threshold, _confidence, _maxIters))",
          "new_api": null,
          "old_text": "Ptr<PointSetRegistrator>(\n        new RANSACPointSetRegistrator(_cb, _modelPoints, _threshold, _confidence, _maxIters))",
          "new_text": null,
          "old_line_content": "    return Ptr<PointSetRegistrator>(",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 520,
          "old_api": "reshape",
          "new_api": null,
          "old_text": "dFrom.reshape(3, count)",
          "new_text": null,
          "old_line_content": "    dFrom = dFrom.reshape(3, count);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 521,
          "old_api": "reshape",
          "new_api": null,
          "old_text": "dTo.reshape(3, count)",
          "new_text": null,
          "old_line_content": "    dTo = dTo.reshape(3, count);",
          "new_line_content": "    const double epsilon = DBL_EPSILON;",
          "content_same": false
        },
        {
          "line": 396,
          "old_api": "Ptr<PointSetRegistrator>(\n        new LMeDSPointSetRegistrator(_cb, _modelPoints, _confidence, _maxIters))",
          "new_api": null,
          "old_text": "Ptr<PointSetRegistrator>(\n        new LMeDSPointSetRegistrator(_cb, _modelPoints, _confidence, _maxIters))",
          "new_text": null,
          "old_line_content": "    return Ptr<PointSetRegistrator>(",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 527,
          "old_api": "makePtr<Affine3DEstimatorCallback>()",
          "new_api": null,
          "old_text": "makePtr<Affine3DEstimatorCallback>()",
          "new_text": null,
          "old_line_content": "    return createRANSACPointSetRegistrator(makePtr<Affine3DEstimatorCallback>(), 4, param1, param2)->run(dFrom, dTo, _out, _inliers);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 407,
          "old_api": "m1.ptr<Point3f>()",
          "new_api": null,
          "old_text": "m1.ptr<Point3f>()",
          "new_text": null,
          "old_line_content": "        const Point3f* from = m1.ptr<Point3f>();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 408,
          "old_api": "m2.ptr<Point3f>()",
          "new_api": null,
          "old_text": "m2.ptr<Point3f>()",
          "new_text": null,
          "old_line_content": "        const Point3f* to   = m2.ptr<Point3f>();",
          "new_line_content": "        const int N = 12;",
          "content_same": false
        },
        {
          "line": 416,
          "old_api": "B.ptr<double>()",
          "new_api": null,
          "old_text": "B.ptr<double>()",
          "new_text": null,
          "old_line_content": "        double* Bdata = B.ptr<double>();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 417,
          "old_api": "Scalar::all(0)",
          "new_api": null,
          "old_text": "Scalar::all(0)",
          "new_text": null,
          "old_line_content": "        A = Scalar::all(0);",
          "new_line_content": "        for( int i = 0; i < (N/3); i++ )",
          "content_same": false
        },
        {
          "line": 436,
          "old_api": "solve",
          "new_api": null,
          "old_text": "solve(A, B, X, DECOMP_SVD)",
          "new_text": null,
          "old_line_content": "        solve(A, B, X, DECOMP_SVD);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 437,
          "old_api": "reshape",
          "new_api": null,
          "old_text": "X.reshape(1, 3).copyTo(_model)",
          "new_text": null,
          "old_line_content": "        X.reshape(1, 3).copyTo(_model);",
          "new_line_content": "        return 1;",
          "content_same": false
        },
        {
          "line": 446,
          "old_api": "m2.ptr<Point3f>()",
          "new_api": null,
          "old_text": "m2.ptr<Point3f>()",
          "new_text": null,
          "old_line_content": "        const Point3f* to   = m2.ptr<Point3f>();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 449,
          "old_api": "checkVector",
          "new_api": null,
          "old_text": "m1.checkVector(3)",
          "new_text": null,
          "old_line_content": "        int count = m1.checkVector(3);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 453,
          "old_api": "getMat",
          "new_api": null,
          "old_text": "_err.getMat()",
          "new_text": null,
          "old_line_content": "        Mat err = _err.getMat();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 454,
          "old_api": "err.ptr<float>()",
          "new_api": null,
          "old_text": "err.ptr<float>()",
          "new_text": null,
          "old_line_content": "        float* errptr = err.ptr<float>();",
          "new_line_content": "        for(int i = 0; i < count; i++ )",
          "content_same": false
        },
        {
          "line": 472,
          "old_api": "getMat",
          "new_api": null,
          "old_text": "_ms2.getMat()",
          "new_text": null,
          "old_line_content": "        Mat ms1 = _ms1.getMat(), ms2 = _ms2.getMat();",
          "new_line_content": "        for( int inp = 1; inp <= 2; inp++ )",
          "content_same": false
        },
        {
          "line": 350,
          "old_api": "errf.at<float>(count/2)",
          "new_api": null,
          "old_text": "errf.at<float>(count/2)",
          "new_text": null,
          "old_line_content": "                errf.at<float>(count/2) : (errf.at<float>(count/2-1) + errf.at<float>(count/2))*0.5;",
          "new_line_content": "                if( median < minMedian )",
          "content_same": false
        },
        {
          "line": 480,
          "old_api": "CV_Assert",
          "new_api": null,
          "old_text": "CV_Assert( count <= msi->rows )",
          "new_text": null,
          "old_line_content": "            CV_Assert( count <= msi->rows );",
          "new_line_content": "            // check that the i-th selected point does not belong",
          "content_same": false
        },
        {
          "line": 355,
          "old_api": "copyTo",
          "new_api": null,
          "old_text": "model_i.copyTo(bestModel)",
          "new_text": null,
          "old_line_content": "                    model_i.copyTo(bestModel);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 362,
          "old_api": "std::sqrt(minMedian)",
          "new_api": null,
          "old_text": "std::sqrt(minMedian)",
          "new_text": null,
          "old_line_content": "            double sigma = 2.5*1.4826*(1 + 5./(count - modelPoints))*std::sqrt(minMedian);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 365,
          "old_api": "findInliers",
          "new_api": null,
          "old_text": "findInliers( m1, m2, bestModel, err, mask, sigma )",
          "new_text": null,
          "old_line_content": "            count = findInliers( m1, m2, bestModel, err, mask, sigma );",
          "new_line_content": "            {",
          "content_same": false
        },
        {
          "line": 368,
          "old_api": "size",
          "new_api": null,
          "old_text": "mask.size()",
          "new_text": null,
          "old_line_content": "                if( mask0.size() == mask.size() )",
          "new_line_content": "                else",
          "content_same": false
        },
        {
          "line": 373,
          "old_api": "copyTo",
          "new_api": null,
          "old_text": "bestModel.copyTo(_model)",
          "new_text": null,
          "old_line_content": "            bestModel.copyTo(_model);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 377,
          "old_api": "release",
          "new_api": null,
          "old_text": "_model.release()",
          "new_text": null,
          "old_line_content": "            _model.release();",
          "new_line_content": "        return result;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 15,
      "total_additions": 26,
      "total_deletions": 26,
      "total_api_changes": 67
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 4,
        "api_related_lines": 67,
        "non_api_lines": 2,
        "non_api_line_numbers": [
          347,
          349
        ]
      }
    },
    "api_calls_before": 174,
    "api_calls_after": 173,
    "diff_info": {
      "added_lines": 2,
      "removed_lines": 4,
      "total_diff_lines": 18
    }
  }
}