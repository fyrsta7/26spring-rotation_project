{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ClickHouse/modified_file/7cd7782e4f25b0a2aad9cfa69cd9ffcb4da1e6cc",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ClickHouse/modified_file/7cd7782e4f25b0a2aad9cfa69cd9ffcb4da1e6cc/before.h",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ClickHouse/modified_file/7cd7782e4f25b0a2aad9cfa69cd9ffcb4da1e6cc/after.h",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ClickHouse/modified_file/7cd7782e4f25b0a2aad9cfa69cd9ffcb4da1e6cc/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 48,
          "old_api": "createColumn",
          "new_api": "ColumnUInt64::create()",
          "old_text": "std::make_shared<DataTypeUInt64>()->createColumn()",
          "new_text": "ColumnUInt64::create()",
          "old_line_content": "        auto result = std::make_shared<DataTypeUInt64>()->createColumn();",
          "new_line_content": "        auto result = ColumnUInt64::create();",
          "content_same": false
        },
        {
          "line": 57,
          "old_api": "Field",
          "new_api": "checker",
          "old_text": "Field(value)",
          "new_text": "checker(set_index, index)",
          "old_line_content": "            result->insert(Field(value));",
          "new_line_content": "                value = (value << 1) + (checker(set_index, index) ? 1 : 0);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 68,
          "old_api": null,
          "new_api": "explicit",
          "old_text": null,
          "new_text": "explicit",
          "old_line_content": "    {}",
          "new_line_content": "    explicit FunctionGroupingOrdinary(ColumnNumbers arguments_indexes_)",
          "content_same": false
        },
        {
          "line": 69,
          "old_api": null,
          "new_api": "std::move(arguments_indexes_)",
          "old_text": null,
          "new_text": "std::move(arguments_indexes_)",
          "old_line_content": "",
          "new_line_content": "        : FunctionGroupingBase(std::move(arguments_indexes_))",
          "content_same": false
        },
        {
          "line": 76,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "arguments_indexes.size()",
          "old_line_content": "    }",
          "new_line_content": "        UInt64 value = (ONE << arguments_indexes.size()) - 1;",
          "content_same": false
        },
        {
          "line": 77,
          "old_api": null,
          "new_api": "ColumnUInt64::create(input_rows_count, value)",
          "old_text": null,
          "new_text": "ColumnUInt64::create(input_rows_count, value)",
          "old_line_content": "};",
          "new_line_content": "        return ColumnUInt64::create(input_rows_count, value);",
          "content_same": false
        },
        {
          "line": 49,
          "old_api": null,
          "new_api": "getData",
          "old_text": null,
          "new_text": "result->getData()",
          "old_line_content": "        for (size_t i = 0; i < input_rows_count; ++i)",
          "new_line_content": "        auto & result_data = result->getData();",
          "content_same": false
        },
        {
          "line": 146,
          "old_api": null,
          "new_api": "std::move(arguments_indexes_)",
          "old_text": null,
          "new_text": "std::move(arguments_indexes_)",
          "old_line_content": "        for (auto const & set : grouping_sets_)",
          "new_line_content": "        : FunctionGroupingBase(std::move(arguments_indexes_))",
          "content_same": false
        },
        {
          "line": 50,
          "old_api": null,
          "new_api": "reserve",
          "old_text": null,
          "new_text": "result_data.reserve(input_rows_count)",
          "old_line_content": "        {",
          "new_line_content": "        result_data.reserve(input_rows_count);",
          "content_same": false
        },
        {
          "line": 149,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "set.end()",
          "old_line_content": "",
          "new_line_content": "            grouping_sets.emplace_back(set.begin(), set.end());",
          "content_same": false
        },
        {
          "line": 53,
          "old_api": null,
          "new_api": "getElement",
          "old_text": null,
          "new_text": "grouping_set_column->getElement(i)",
          "old_line_content": "            UInt64 value = 0;",
          "new_line_content": "            UInt64 set_index = grouping_set_column->getElement(i);",
          "content_same": false
        },
        {
          "line": 87,
          "old_api": null,
          "new_api": "std::move(arguments_indexes_)",
          "old_text": null,
          "new_text": "std::move(arguments_indexes_)",
          "old_line_content": "    {}",
          "new_line_content": "        : FunctionGroupingBase(std::move(arguments_indexes_))",
          "content_same": false
        },
        {
          "line": 59,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "result_data.push_back(value)",
          "old_line_content": "        return result;",
          "new_line_content": "            result_data.push_back(value);",
          "content_same": false
        },
        {
          "line": 156,
          "old_api": null,
          "new_api": "contains",
          "old_text": null,
          "new_text": "FunctionGroupingBase::executeImpl(arguments, input_rows_count,\n            [this](UInt64 set_index, UInt64 arg_index)\n            {\n                return grouping_sets[set_index].contains(arg_index);\n            }\n        )",
          "old_line_content": "            {",
          "new_line_content": "        return FunctionGroupingBase::executeImpl(arguments, input_rows_count,",
          "content_same": false
        },
        {
          "line": 125,
          "old_api": null,
          "new_api": "FunctionGroupingBase::executeImpl(arguments, input_rows_count,\n            [this](UInt64 set_index, UInt64 arg_index)\n            {\n                // For CUBE(a, b) there will be following grouping set indexes:\n                // | GROUPING SET | INDEX |\n                // | (a, b)       |   0   |\n                // | (a)          |   1   |\n                // | (b)          |   2   |\n                // | ()           |   3   |\n                auto set_mask = (ONE << aggregation_keys_number) - 1 - set_index;\n                return set_mask & (ONE << (aggregation_keys_number - arg_index - 1));\n            }\n        )",
          "old_text": null,
          "new_text": "FunctionGroupingBase::executeImpl(arguments, input_rows_count,\n            [this](UInt64 set_index, UInt64 arg_index)\n            {\n                // For CUBE(a, b) there will be following grouping set indexes:\n                // | GROUPING SET | INDEX |\n                // | (a, b)       |   0   |\n                // | (a)          |   1   |\n                // | (b)          |   2   |\n                // | ()           |   3   |\n                auto set_mask = (ONE << aggregation_keys_number) - 1 - set_index;\n                return set_mask & (ONE << (aggregation_keys_number - arg_index - 1));\n            }\n        )",
          "old_line_content": "            {",
          "new_line_content": "        return FunctionGroupingBase::executeImpl(arguments, input_rows_count,",
          "content_same": false
        },
        {
          "line": 95,
          "old_api": null,
          "new_api": "FunctionGroupingBase::executeImpl(arguments, input_rows_count,\n            [this](UInt64 set_index, UInt64 arg_index)\n            {\n                // For ROLLUP(a, b, c) there will be following grouping set indexes:\n                // | GROUPING SET | INDEX |\n                // | (a, b, c)    |   0   |\n                // | (a, b)       |   1   |\n                // | (a)          |   2   |\n                // | ()           |   3   |\n                return arg_index < aggregation_keys_number - set_index;\n            }\n        )",
          "old_text": null,
          "new_text": "FunctionGroupingBase::executeImpl(arguments, input_rows_count,\n            [this](UInt64 set_index, UInt64 arg_index)\n            {\n                // For ROLLUP(a, b, c) there will be following grouping set indexes:\n                // | GROUPING SET | INDEX |\n                // | (a, b, c)    |   0   |\n                // | (a, b)       |   1   |\n                // | (a)          |   2   |\n                // | ()           |   3   |\n                return arg_index < aggregation_keys_number - set_index;\n            }\n        )",
          "old_line_content": "            {",
          "new_line_content": "        return FunctionGroupingBase::executeImpl(arguments, input_rows_count,",
          "content_same": false
        },
        {
          "line": 159,
          "old_api": null,
          "new_api": "contains",
          "old_text": null,
          "new_text": "grouping_sets[set_index].contains(arg_index)",
          "old_line_content": "        );",
          "new_line_content": "                return grouping_sets[set_index].contains(arg_index);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 66,
          "old_api": "explicit",
          "new_api": null,
          "old_text": "explicit",
          "new_text": null,
          "old_line_content": "    explicit FunctionGroupingOrdinary(ColumnNumbers arguments_indexes_)",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 67,
          "old_api": "std::move(arguments_indexes_)",
          "new_api": null,
          "old_text": "std::move(arguments_indexes_)",
          "new_text": null,
          "old_line_content": "        : FunctionGroupingBase(std::move(arguments_indexes_))",
          "new_line_content": "public:",
          "content_same": false
        },
        {
          "line": 74,
          "old_api": "size",
          "new_api": null,
          "old_text": "arguments_indexes.size()",
          "new_text": null,
          "old_line_content": "        UInt64 value = (ONE << arguments_indexes.size()) - 1;",
          "new_line_content": "    ColumnPtr executeImpl(const ColumnsWithTypeAndName &, const DataTypePtr &, size_t input_rows_count) const override",
          "content_same": false
        },
        {
          "line": 75,
          "old_api": "ColumnUInt64::create(input_rows_count, value)",
          "new_api": null,
          "old_text": "ColumnUInt64::create(input_rows_count, value)",
          "new_text": null,
          "old_line_content": "        return ColumnUInt64::create(input_rows_count, value);",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 144,
          "old_api": "std::move(arguments_indexes_)",
          "new_api": null,
          "old_text": "std::move(arguments_indexes_)",
          "new_text": null,
          "old_line_content": "        : FunctionGroupingBase(std::move(arguments_indexes_))",
          "new_line_content": "public:",
          "content_same": false
        },
        {
          "line": 51,
          "old_api": "get64",
          "new_api": null,
          "old_text": "grouping_set_column->get64(i)",
          "new_text": null,
          "old_line_content": "            UInt64 set_index = grouping_set_column->get64(i);",
          "new_line_content": "        for (size_t i = 0; i < input_rows_count; ++i)",
          "content_same": false
        },
        {
          "line": 147,
          "old_api": "end",
          "new_api": null,
          "old_text": "set.end()",
          "new_text": null,
          "old_line_content": "            grouping_sets.emplace_back(set.begin(), set.end());",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 85,
          "old_api": "std::move(arguments_indexes_)",
          "new_api": null,
          "old_text": "std::move(arguments_indexes_)",
          "new_text": null,
          "old_line_content": "        : FunctionGroupingBase(std::move(arguments_indexes_))",
          "new_line_content": "public:",
          "content_same": false
        },
        {
          "line": 93,
          "old_api": "FunctionGroupingBase::executeImpl(arguments, input_rows_count,\n            [this](UInt64 set_index, UInt64 arg_index)\n            {\n                // For ROLLUP(a, b, c) there will be following grouping set indexes:\n                // | GROUPING SET | INDEX |\n                // | (a, b, c)    |   0   |\n                // | (a, b)       |   1   |\n                // | (a)          |   2   |\n                // | ()           |   3   |\n                return arg_index < aggregation_keys_number - set_index;\n            }\n        )",
          "new_api": null,
          "old_text": "FunctionGroupingBase::executeImpl(arguments, input_rows_count,\n            [this](UInt64 set_index, UInt64 arg_index)\n            {\n                // For ROLLUP(a, b, c) there will be following grouping set indexes:\n                // | GROUPING SET | INDEX |\n                // | (a, b, c)    |   0   |\n                // | (a, b)       |   1   |\n                // | (a)          |   2   |\n                // | ()           |   3   |\n                return arg_index < aggregation_keys_number - set_index;\n            }\n        )",
          "new_text": null,
          "old_line_content": "        return FunctionGroupingBase::executeImpl(arguments, input_rows_count,",
          "new_line_content": "    ColumnPtr executeImpl(const ColumnsWithTypeAndName & arguments, const DataTypePtr &, size_t input_rows_count) const override",
          "content_same": false
        },
        {
          "line": 55,
          "old_api": "checker",
          "new_api": null,
          "old_text": "checker(set_index, index)",
          "new_text": null,
          "old_line_content": "                value = (value << 1) + (checker(set_index, index) ? 1 : 0);",
          "new_line_content": "            UInt64 value = 0;",
          "content_same": false
        },
        {
          "line": 154,
          "old_api": "contains",
          "new_api": null,
          "old_text": "FunctionGroupingBase::executeImpl(arguments, input_rows_count,\n            [this](UInt64 set_index, UInt64 arg_index)\n            {\n                return grouping_sets[set_index].contains(arg_index);\n            }\n        )",
          "new_text": null,
          "old_line_content": "        return FunctionGroupingBase::executeImpl(arguments, input_rows_count,",
          "new_line_content": "    ColumnPtr executeImpl(const ColumnsWithTypeAndName & arguments, const DataTypePtr &, size_t input_rows_count) const override",
          "content_same": false
        },
        {
          "line": 123,
          "old_api": "FunctionGroupingBase::executeImpl(arguments, input_rows_count,\n            [this](UInt64 set_index, UInt64 arg_index)\n            {\n                // For CUBE(a, b) there will be following grouping set indexes:\n                // | GROUPING SET | INDEX |\n                // | (a, b)       |   0   |\n                // | (a)          |   1   |\n                // | (b)          |   2   |\n                // | ()           |   3   |\n                auto set_mask = (ONE << aggregation_keys_number) - 1 - set_index;\n                return set_mask & (ONE << (aggregation_keys_number - arg_index - 1));\n            }\n        )",
          "new_api": null,
          "old_text": "FunctionGroupingBase::executeImpl(arguments, input_rows_count,\n            [this](UInt64 set_index, UInt64 arg_index)\n            {\n                // For CUBE(a, b) there will be following grouping set indexes:\n                // | GROUPING SET | INDEX |\n                // | (a, b)       |   0   |\n                // | (a)          |   1   |\n                // | (b)          |   2   |\n                // | ()           |   3   |\n                auto set_mask = (ONE << aggregation_keys_number) - 1 - set_index;\n                return set_mask & (ONE << (aggregation_keys_number - arg_index - 1));\n            }\n        )",
          "new_text": null,
          "old_line_content": "        return FunctionGroupingBase::executeImpl(arguments, input_rows_count,",
          "new_line_content": "    ColumnPtr executeImpl(const ColumnsWithTypeAndName & arguments, const DataTypePtr &, size_t input_rows_count) const override",
          "content_same": false
        },
        {
          "line": 157,
          "old_api": "contains",
          "new_api": null,
          "old_text": "grouping_sets[set_index].contains(arg_index)",
          "new_text": null,
          "old_line_content": "                return grouping_sets[set_index].contains(arg_index);",
          "new_line_content": "            [this](UInt64 set_index, UInt64 arg_index)",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 2,
      "total_additions": 15,
      "total_deletions": 13,
      "total_api_changes": 30
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 8,
        "api_related_lines": 30,
        "non_api_lines": 1,
        "non_api_line_numbers": [
          46
        ]
      }
    },
    "api_calls_before": 24,
    "api_calls_after": 24,
    "diff_info": {
      "added_lines": 6,
      "removed_lines": 4,
      "total_diff_lines": 30
    }
  }
}