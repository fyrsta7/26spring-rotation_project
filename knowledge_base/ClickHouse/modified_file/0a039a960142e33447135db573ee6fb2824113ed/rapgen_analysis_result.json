{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ClickHouse/modified_file/0a039a960142e33447135db573ee6fb2824113ed",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ClickHouse/modified_file/0a039a960142e33447135db573ee6fb2824113ed/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ClickHouse/modified_file/0a039a960142e33447135db573ee6fb2824113ed/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ClickHouse/modified_file/0a039a960142e33447135db573ee6fb2824113ed/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [],
      "additions": [
        {
          "line": 137,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "file.size()",
          "old_line_content": "",
          "new_line_content": "    return {file.size(), State::END};",
          "content_same": false
        },
        {
          "line": 153,
          "old_api": null,
          "new_api": "std::move(extractor_configuration_)",
          "old_text": null,
          "new_text": "std::move(extractor_configuration_)",
          "old_line_content": "}",
          "new_line_content": "    : extractor_configuration(std::move(extractor_configuration_))",
          "content_same": false
        },
        {
          "line": 155,
          "old_api": null,
          "new_api": "EscapingNeedleFactory::getReadNeedles(extractor_configuration)",
          "old_text": null,
          "new_text": "EscapingNeedleFactory::getReadNeedles(extractor_configuration)",
          "old_line_content": "",
          "new_line_content": "    read_needles = EscapingNeedleFactory::getReadNeedles(extractor_configuration);",
          "content_same": false
        },
        {
          "line": 156,
          "old_api": null,
          "new_api": "EscapingNeedleFactory::getReadQuotedNeedles(extractor_configuration)",
          "old_text": null,
          "new_text": "EscapingNeedleFactory::getReadQuotedNeedles(extractor_configuration)",
          "old_line_content": "InlineEscapingValueStateHandler::InlineEscapingValueStateHandler(Configuration extractor_configuration_)",
          "new_line_content": "    read_quoted_needles = EscapingNeedleFactory::getReadQuotedNeedles(extractor_configuration);",
          "content_same": false
        },
        {
          "line": 164,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "file.size()",
          "old_line_content": "{",
          "new_line_content": "    if (pos < file.size())",
          "content_same": false
        },
        {
          "line": 189,
          "old_api": null,
          "new_api": "clear",
          "old_text": null,
          "new_text": "value.clear()",
          "old_line_content": "NextState InlineEscapingValueStateHandler::read(std::string_view file, ElementType & value) const",
          "new_line_content": "    value.clear();",
          "content_same": false
        },
        {
          "line": 192,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "file.end()",
          "old_line_content": "",
          "new_line_content": "    while (const auto * p = find_first_symbols_or_null({file.begin() + pos, file.end()}, read_needles))",
          "content_same": false
        },
        {
          "line": 194,
          "old_api": null,
          "new_api": "begin",
          "old_text": null,
          "new_text": "file.begin()",
          "old_line_content": "",
          "new_line_content": "        auto character_position = p - file.begin();",
          "content_same": false
        },
        {
          "line": 199,
          "old_api": null,
          "new_api": "consumeWithEscapeSequence",
          "old_text": null,
          "new_text": "consumeWithEscapeSequence(file, pos, character_position, value)",
          "old_line_content": "        size_t next_pos = character_position + 1u;",
          "new_line_content": "            const size_t escape_seq_len = consumeWithEscapeSequence(file, pos, character_position, value);",
          "content_same": false
        },
        {
          "line": 211,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "pair_delimiters.end()",
          "old_line_content": "        {",
          "new_line_content": "        else if (std::find(pair_delimiters.begin(), pair_delimiters.end(), *p) != pair_delimiters.end())",
          "content_same": false
        },
        {
          "line": 214,
          "old_api": null,
          "new_api": "begin",
          "old_text": null,
          "new_text": "file.begin()",
          "old_line_content": "        }",
          "new_line_content": "            value.insert(value.end(), file.begin() + pos, file.begin() + character_position);",
          "content_same": false
        },
        {
          "line": 223,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "file.end()",
          "old_line_content": "        pos = next_pos;",
          "new_line_content": "    value.insert(value.end(), file.begin() + pos, file.end());",
          "content_same": false
        },
        {
          "line": 231,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "read_quoted_needles.end()",
          "old_line_content": "",
          "new_line_content": "    const std::string_view needles{read_quoted_needles.begin(), read_quoted_needles.end()};",
          "content_same": false
        },
        {
          "line": 233,
          "old_api": null,
          "new_api": "clear",
          "old_text": null,
          "new_text": "value.clear()",
          "old_line_content": "{",
          "new_line_content": "    value.clear();",
          "content_same": false
        },
        {
          "line": 236,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "file.end()",
          "old_line_content": "",
          "new_line_content": "    while (const auto * p = find_first_symbols_or_null({file.begin() + pos, file.end()}, needles))",
          "content_same": false
        },
        {
          "line": 238,
          "old_api": null,
          "new_api": "begin",
          "old_text": null,
          "new_text": "file.begin()",
          "old_line_content": "",
          "new_line_content": "        auto character_position = p - file.begin();",
          "content_same": false
        },
        {
          "line": 243,
          "old_api": null,
          "new_api": "consumeWithEscapeSequence",
          "old_text": null,
          "new_text": "consumeWithEscapeSequence(file, pos, character_position, value)",
          "old_line_content": "        size_t next_pos = character_position + 1u;",
          "new_line_content": "            const size_t escape_seq_len = consumeWithEscapeSequence(file, pos, character_position, value);",
          "content_same": false
        },
        {
          "line": 252,
          "old_api": null,
          "new_api": "begin",
          "old_text": null,
          "new_text": "file.begin()",
          "old_line_content": "            }",
          "new_line_content": "            value.insert(value.end(), file.begin() + pos, file.begin() + character_position);",
          "content_same": false
        },
        {
          "line": 124,
          "old_api": null,
          "new_api": "begin",
          "old_text": null,
          "new_text": "file.begin()",
          "old_line_content": "            // todo try to optimize with resize and memcpy",
          "new_line_content": "            key.insert(key.end(), file.begin() + pos, file.begin() + character_position);",
          "content_same": false
        },
        {
          "line": 126,
          "old_api": null,
          "new_api": "empty",
          "old_text": null,
          "new_text": "key.empty()",
          "old_line_content": "            {",
          "new_line_content": "            if (key.empty())",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 256,
          "old_api": "begin",
          "new_api": null,
          "old_text": "file.begin()",
          "new_text": null,
          "old_line_content": "            value.insert(value.end(), file.begin() + pos, file.begin() + character_position);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 130,
          "old_api": "empty",
          "new_api": null,
          "old_text": "key.empty()",
          "new_text": null,
          "old_line_content": "            if (key.empty())",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 141,
          "old_api": "size",
          "new_api": null,
          "old_text": "file.size()",
          "new_text": null,
          "old_line_content": "    return {file.size(), State::END};",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 157,
          "old_api": "std::move(extractor_configuration_)",
          "new_api": null,
          "old_text": "std::move(extractor_configuration_)",
          "new_text": null,
          "old_line_content": "    : extractor_configuration(std::move(extractor_configuration_))",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 159,
          "old_api": "EscapingNeedleFactory::getReadNeedles(extractor_configuration)",
          "new_api": null,
          "old_text": "EscapingNeedleFactory::getReadNeedles(extractor_configuration)",
          "new_text": null,
          "old_line_content": "    read_needles = EscapingNeedleFactory::getReadNeedles(extractor_configuration);",
          "new_line_content": "NextState InlineEscapingValueStateHandler::wait(std::string_view file) const",
          "content_same": false
        },
        {
          "line": 160,
          "old_api": "EscapingNeedleFactory::getReadQuotedNeedles(extractor_configuration)",
          "new_api": null,
          "old_text": "EscapingNeedleFactory::getReadQuotedNeedles(extractor_configuration)",
          "new_text": null,
          "old_line_content": "    read_quoted_needles = EscapingNeedleFactory::getReadQuotedNeedles(extractor_configuration);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 168,
          "old_api": "size",
          "new_api": null,
          "old_text": "file.size()",
          "new_text": null,
          "old_line_content": "    if (pos < file.size())",
          "new_line_content": "        if (quoting_character == current_character)",
          "content_same": false
        },
        {
          "line": 193,
          "old_api": "clear",
          "new_api": null,
          "old_text": "value.clear()",
          "new_text": null,
          "old_line_content": "    value.clear();",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 196,
          "old_api": "end",
          "new_api": null,
          "old_text": "file.end()",
          "new_text": null,
          "old_line_content": "    while (const auto * p = find_first_symbols_or_null({file.begin() + pos, file.end()}, read_needles))",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 198,
          "old_api": "begin",
          "new_api": null,
          "old_text": "file.begin()",
          "new_text": null,
          "old_line_content": "        auto character_position = p - file.begin();",
          "new_line_content": "        {",
          "content_same": false
        },
        {
          "line": 203,
          "old_api": "consumeWithEscapeSequence",
          "new_api": null,
          "old_text": "consumeWithEscapeSequence(file, pos, character_position, value)",
          "new_text": null,
          "old_line_content": "            const size_t escape_seq_len = consumeWithEscapeSequence(file, pos, character_position, value);",
          "new_line_content": "                return {next_pos, State::WAITING_KEY};",
          "content_same": false
        },
        {
          "line": 215,
          "old_api": "end",
          "new_api": null,
          "old_text": "pair_delimiters.end()",
          "new_text": null,
          "old_line_content": "        else if (std::find(pair_delimiters.begin(), pair_delimiters.end(), *p) != pair_delimiters.end())",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 218,
          "old_api": "begin",
          "new_api": null,
          "old_text": "file.begin()",
          "new_text": null,
          "old_line_content": "            value.insert(value.end(), file.begin() + pos, file.begin() + character_position);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 227,
          "old_api": "end",
          "new_api": null,
          "old_text": "file.end()",
          "new_text": null,
          "old_line_content": "    value.insert(value.end(), file.begin() + pos, file.end());",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 235,
          "old_api": "end",
          "new_api": null,
          "old_text": "read_quoted_needles.end()",
          "new_text": null,
          "old_line_content": "    const std::string_view needles{read_quoted_needles.begin(), read_quoted_needles.end()};",
          "new_line_content": "    size_t pos = 0;",
          "content_same": false
        },
        {
          "line": 237,
          "old_api": "clear",
          "new_api": null,
          "old_text": "value.clear()",
          "new_text": null,
          "old_line_content": "    value.clear();",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 240,
          "old_api": "end",
          "new_api": null,
          "old_text": "file.end()",
          "new_text": null,
          "old_line_content": "    while (const auto * p = find_first_symbols_or_null({file.begin() + pos, file.end()}, needles))",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 242,
          "old_api": "begin",
          "new_api": null,
          "old_text": "file.begin()",
          "new_text": null,
          "old_line_content": "        auto character_position = p - file.begin();",
          "new_line_content": "        {",
          "content_same": false
        },
        {
          "line": 247,
          "old_api": "consumeWithEscapeSequence",
          "new_api": null,
          "old_text": "consumeWithEscapeSequence(file, pos, character_position, value)",
          "new_text": null,
          "old_line_content": "            const size_t escape_seq_len = consumeWithEscapeSequence(file, pos, character_position, value);",
          "new_line_content": "                return {next_pos, State::WAITING_KEY};",
          "content_same": false
        },
        {
          "line": 127,
          "old_api": "push_back",
          "new_api": null,
          "old_text": "key.push_back(file[i])",
          "new_text": null,
          "old_line_content": "                key.push_back(file[i]);",
          "new_line_content": "            {",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 0,
      "total_additions": 20,
      "total_deletions": 20,
      "total_api_changes": 40
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 5,
        "api_related_lines": 40,
        "non_api_lines": 2,
        "non_api_line_numbers": [
          128,
          125
        ]
      }
    },
    "api_calls_before": 75,
    "api_calls_after": 78,
    "diff_info": {
      "added_lines": 1,
      "removed_lines": 5,
      "total_diff_lines": 18
    }
  }
}