{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ClickHouse/modified_file/e6c8100f6342feba3f629e04b39da959bf62e128",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ClickHouse/modified_file/e6c8100f6342feba3f629e04b39da959bf62e128/before.h",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ClickHouse/modified_file/e6c8100f6342feba3f629e04b39da959bf62e128/after.h",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ClickHouse/modified_file/e6c8100f6342feba3f629e04b39da959bf62e128/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 323,
          "old_api": "std::make_shared<ResultDataType>()",
          "new_api": "__builtin_unreachable",
          "old_text": "std::make_shared<ResultDataType>()",
          "new_text": "__builtin_unreachable()",
          "old_line_content": "            return std::make_shared<ResultDataType>();",
          "new_line_content": "        __builtin_unreachable();",
          "content_same": false
        },
        {
          "line": 352,
          "old_api": "assert_cast<const ColVecType &>(*columns[0])",
          "new_api": "getData",
          "old_text": "assert_cast<const ColVecType &>(*columns[0])",
          "new_text": "column.getData()",
          "old_line_content": "            const auto & column = assert_cast<const ColVecType &>(*columns[0]);",
          "new_line_content": "            this->data(place).add(column.getData()[row_num]);",
          "content_same": false
        },
        {
          "line": 426,
          "old_api": "static_cast<llvm::IRBuilder<> &>(builder)",
          "new_api": "getReturnType",
          "old_text": "static_cast<llvm::IRBuilder<> &>(builder)",
          "new_text": "getReturnType()",
          "old_line_content": "        llvm::IRBuilder<> & b = static_cast<llvm::IRBuilder<> &>(builder);",
          "new_line_content": "        auto return_type = getReturnType();",
          "content_same": false
        },
        {
          "line": 436,
          "old_api": "nativeCast",
          "new_api": "getReturnType",
          "old_text": "nativeCast(b, argument_type, argument_value, return_type)",
          "new_text": "getReturnType()",
          "old_line_content": "        auto * value_cast_to_result = nativeCast(b, argument_type, argument_value, return_type);",
          "new_line_content": "        auto * return_type = toNativeType(b, getReturnType());",
          "content_same": false
        },
        {
          "line": 437,
          "old_api": "CreateFAdd",
          "new_api": "getPointerTo",
          "old_text": "b.CreateFAdd(sum_value, value_cast_to_result)",
          "new_text": "return_type->getPointerTo()",
          "old_line_content": "        auto * sum_result_value = sum_value->getType()->isIntegerTy() ? b.CreateAdd(sum_value, value_cast_to_result) : b.CreateFAdd(sum_value, value_cast_to_result);",
          "new_line_content": "        auto * aggregate_sum_ptr = b.CreatePointerCast(aggregate_data_ptr, return_type->getPointerTo());",
          "content_same": false
        },
        {
          "line": 439,
          "old_api": "CreateStore",
          "new_api": "llvm::Constant::getNullValue(return_type)",
          "old_text": "b.CreateStore(sum_result_value, sum_value_ptr)",
          "new_text": "llvm::Constant::getNullValue(return_type)",
          "old_line_content": "        b.CreateStore(sum_result_value, sum_value_ptr);",
          "new_line_content": "        b.CreateStore(llvm::Constant::getNullValue(return_type), aggregate_sum_ptr);",
          "content_same": false
        },
        {
          "line": 454,
          "old_api": "CreateFAdd",
          "new_api": "nativeCast",
          "old_text": "b.CreateFAdd(sum_value_dst, sum_value_src)",
          "new_text": "nativeCast(b, argument_type, argument_value, return_type)",
          "old_line_content": "        auto * sum_return_value = sum_value_dst->getType()->isIntegerTy() ? b.CreateAdd(sum_value_dst, sum_value_src) : b.CreateFAdd(sum_value_dst, sum_value_src);",
          "new_line_content": "        auto * value_cast_to_result = nativeCast(b, argument_type, argument_value, return_type);",
          "content_same": false
        },
        {
          "line": 455,
          "old_api": "CreateStore",
          "new_api": "CreateFAdd",
          "old_text": "b.CreateStore(sum_return_value, sum_value_dst_ptr)",
          "new_text": "b.CreateFAdd(sum_value, value_cast_to_result)",
          "old_line_content": "        b.CreateStore(sum_return_value, sum_value_dst_ptr);",
          "new_line_content": "        auto * sum_result_value = sum_value->getType()->isIntegerTy() ? b.CreateAdd(sum_value, value_cast_to_result) : b.CreateFAdd(sum_value, value_cast_to_result);",
          "content_same": false
        },
        {
          "line": 462,
          "old_api": "getReturnType",
          "new_api": "static_cast<llvm::IRBuilder<> &>(builder)",
          "old_text": "getReturnType()",
          "new_text": "static_cast<llvm::IRBuilder<> &>(builder)",
          "old_line_content": "        auto * return_type = toNativeType(b, getReturnType());",
          "new_line_content": "        llvm::IRBuilder<> & b = static_cast<llvm::IRBuilder<> &>(builder);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 384,
          "old_api": null,
          "new_api": "add",
          "old_text": null,
          "new_text": "add(place, columns, i, arena)",
          "old_line_content": "",
          "new_line_content": "                    add(place, columns, i, arena);",
          "content_same": false
        },
        {
          "line": 257,
          "old_api": null,
          "new_api": "addImpl",
          "old_text": null,
          "new_text": "addImpl(*ptr, sum, compensation)",
          "old_line_content": "    {",
          "new_line_content": "                addImpl(*ptr, sum, compensation);",
          "content_same": false
        },
        {
          "line": 388,
          "old_api": null,
          "new_api": "assert_cast<const ColVecType &>(*columns[0])",
          "old_text": null,
          "new_text": "assert_cast<const ColVecType &>(*columns[0])",
          "old_line_content": "    }",
          "new_line_content": "            const auto & column = assert_cast<const ColVecType &>(*columns[0]);",
          "content_same": false
        },
        {
          "line": 389,
          "old_api": null,
          "new_api": "getData",
          "old_text": null,
          "new_text": "column.getData().data()",
          "old_line_content": "",
          "new_line_content": "            this->data(place).addManyNotNull(column.getData().data(), null_map, batch_size);",
          "content_same": false
        },
        {
          "line": 135,
          "old_api": null,
          "new_api": "Impl::add(partial_sums[i], ptr[i])",
          "old_text": null,
          "new_text": "Impl::add(partial_sums[i], ptr[i])",
          "old_line_content": "        }",
          "new_line_content": "                        Impl::add(partial_sums[i], ptr[i]);",
          "content_same": false
        },
        {
          "line": 395,
          "old_api": null,
          "new_api": "data",
          "old_text": null,
          "new_text": "this->data(rhs)",
          "old_line_content": "",
          "new_line_content": "        this->data(place).merge(this->data(rhs));",
          "content_same": false
        },
        {
          "line": 143,
          "old_api": null,
          "new_api": "Impl::add(sum, partial_sums[i])",
          "old_text": null,
          "new_text": "Impl::add(sum, partial_sums[i])",
          "old_line_content": "",
          "new_line_content": "                Impl::add(sum, partial_sums[i]);",
          "content_same": false
        },
        {
          "line": 400,
          "old_api": null,
          "new_api": "write",
          "old_text": null,
          "new_text": "this->data(place).write(buf)",
          "old_line_content": "        if constexpr (Type == AggregateFunctionTypeSumKahan)",
          "new_line_content": "        this->data(place).write(buf);",
          "content_same": false
        },
        {
          "line": 276,
          "old_api": null,
          "new_api": "mergeImpl",
          "old_text": null,
          "new_text": "mergeImpl(sum, compensation, rhs.sum, rhs.compensation)",
          "old_line_content": "    }",
          "new_line_content": "        mergeImpl(sum, compensation, rhs.sum, rhs.compensation);",
          "content_same": false
        },
        {
          "line": 405,
          "old_api": null,
          "new_api": "read",
          "old_text": null,
          "new_text": "this->data(place).read(buf)",
          "old_line_content": "        for (const auto & argument_type : this->argument_types)",
          "new_line_content": "        this->data(place).read(buf);",
          "content_same": false
        },
        {
          "line": 150,
          "old_api": null,
          "new_api": "Impl::add(local_sum, *ptr)",
          "old_text": null,
          "new_text": "Impl::add(local_sum, *ptr)",
          "old_line_content": "    {",
          "new_line_content": "                Impl::add(local_sum, *ptr);",
          "content_same": false
        },
        {
          "line": 281,
          "old_api": null,
          "new_api": "writeBinary",
          "old_text": null,
          "new_text": "writeBinary(sum, buf)",
          "old_line_content": "{",
          "new_line_content": "        writeBinary(sum, buf);",
          "content_same": false
        },
        {
          "line": 154,
          "old_api": null,
          "new_api": "Impl::add(sum, local_sum)",
          "old_text": null,
          "new_text": "Impl::add(sum, local_sum)",
          "old_line_content": "    T get() const",
          "new_line_content": "        Impl::add(sum, local_sum);",
          "content_same": false
        },
        {
          "line": 282,
          "old_api": null,
          "new_api": "writeBinary",
          "old_text": null,
          "new_text": "writeBinary(compensation, buf)",
          "old_line_content": "    AggregateFunctionTypeSum,",
          "new_line_content": "        writeBinary(compensation, buf);",
          "content_same": false
        },
        {
          "line": 410,
          "old_api": null,
          "new_api": "assert_cast<ColVecResult &>(to)",
          "old_text": null,
          "new_text": "assert_cast<ColVecResult &>(to)",
          "old_line_content": "",
          "new_line_content": "        auto & column = assert_cast<ColVecResult &>(to);",
          "content_same": false
        },
        {
          "line": 411,
          "old_api": null,
          "new_api": "get",
          "old_text": null,
          "new_text": "this->data(place).get()",
          "old_line_content": "        return can_be_compiled;",
          "new_line_content": "        column.getData().push_back(this->data(place).get());",
          "content_same": false
        },
        {
          "line": 159,
          "old_api": null,
          "new_api": "Impl::add(sum, rhs.sum)",
          "old_text": null,
          "new_text": "Impl::add(sum, rhs.sum)",
          "old_line_content": "};",
          "new_line_content": "        Impl::add(sum, rhs.sum);",
          "content_same": false
        },
        {
          "line": 287,
          "old_api": null,
          "new_api": "readBinary",
          "old_text": null,
          "new_text": "readBinary(sum, buf)",
          "old_line_content": "template <typename T, typename TResult, typename Data, AggregateFunctionSumType Type>",
          "new_line_content": "        readBinary(sum, buf);",
          "content_same": false
        },
        {
          "line": 288,
          "old_api": null,
          "new_api": "readBinary",
          "old_text": null,
          "new_text": "readBinary(compensation, buf)",
          "old_line_content": "class AggregateFunctionSum final : public IAggregateFunctionDataHelper<Data, AggregateFunctionSum<T, TResult, Data, Type>>",
          "new_line_content": "        readBinary(compensation, buf);",
          "content_same": false
        },
        {
          "line": 164,
          "old_api": null,
          "new_api": "writeBinary",
          "old_text": null,
          "new_text": "writeBinary(sum, buf)",
          "old_line_content": "    static_assert(std::is_floating_point_v<T>,",
          "new_line_content": "        writeBinary(sum, buf);",
          "content_same": false
        },
        {
          "line": 424,
          "old_api": null,
          "new_api": "canBeNativeType",
          "old_text": null,
          "new_text": "canBeNativeType(*argument_type)",
          "old_line_content": "    void compileAdd(llvm::IRBuilderBase & builder, llvm::Value * aggregate_data_ptr, const DataTypes & arguments_types, const std::vector<llvm::Value *> & argument_values) const override",
          "new_line_content": "            can_be_compiled &= canBeNativeType(*argument_type);",
          "content_same": false
        },
        {
          "line": 169,
          "old_api": null,
          "new_api": "readBinary",
          "old_text": null,
          "new_text": "readBinary(sum, buf)",
          "old_line_content": "",
          "new_line_content": "        readBinary(sum, buf);",
          "content_same": false
        },
        {
          "line": 427,
          "old_api": null,
          "new_api": "canBeNativeType",
          "old_text": null,
          "new_text": "canBeNativeType(*return_type)",
          "old_line_content": "",
          "new_line_content": "        can_be_compiled &= canBeNativeType(*return_type);",
          "content_same": false
        },
        {
          "line": 434,
          "old_api": null,
          "new_api": "static_cast<llvm::IRBuilder<> &>(builder)",
          "old_text": null,
          "new_text": "static_cast<llvm::IRBuilder<> &>(builder)",
          "old_line_content": "        const auto & argument_value = argument_values[0];",
          "new_line_content": "        llvm::IRBuilder<> & b = static_cast<llvm::IRBuilder<> &>(builder);",
          "content_same": false
        },
        {
          "line": 309,
          "old_api": null,
          "new_api": "constexpr",
          "old_text": null,
          "new_text": "constexpr",
          "old_line_content": "        : IAggregateFunctionDataHelper<Data, AggregateFunctionSum<T, TResult, Data, Type>>(argument_types_, {})",
          "new_line_content": "    static constexpr bool DateTime64Supported = false;",
          "content_same": false
        },
        {
          "line": 191,
          "old_api": null,
          "new_api": "static_cast<T>(value)",
          "old_text": null,
          "new_text": "static_cast<T>(value)",
          "old_line_content": "        T partial_sums[unroll_count]{};",
          "new_line_content": "        auto compensated_value = static_cast<T>(value) - out_compensation;",
          "content_same": false
        },
        {
          "line": 199,
          "old_api": null,
          "new_api": "addImpl",
          "old_text": null,
          "new_text": "addImpl(value, sum, compensation)",
          "old_line_content": "            for (size_t i = 0; i < unroll_count; ++i)",
          "new_line_content": "        addImpl(value, sum, compensation);",
          "content_same": false
        },
        {
          "line": 457,
          "old_api": null,
          "new_api": "CreateStore",
          "old_text": null,
          "new_text": "b.CreateStore(sum_result_value, sum_value_ptr)",
          "old_line_content": "",
          "new_line_content": "        b.CreateStore(sum_result_value, sum_value_ptr);",
          "content_same": false
        },
        {
          "line": 333,
          "old_api": null,
          "new_api": "getDecimalScale",
          "old_text": null,
          "new_text": "getDecimalScale(data_type)",
          "old_line_content": "        else",
          "new_line_content": "        , scale(getDecimalScale(data_type))",
          "content_same": false
        },
        {
          "line": 208,
          "old_api": null,
          "new_api": "constexpr",
          "old_text": null,
          "new_text": "constexpr",
          "old_line_content": "        {",
          "new_line_content": "        constexpr size_t unroll_count = 4;",
          "content_same": false
        },
        {
          "line": 464,
          "old_api": null,
          "new_api": "getReturnType",
          "old_text": null,
          "new_text": "getReturnType()",
          "old_line_content": "",
          "new_line_content": "        auto * return_type = toNativeType(b, getReturnType());",
          "content_same": false
        },
        {
          "line": 466,
          "old_api": null,
          "new_api": "getPointerTo",
          "old_text": null,
          "new_text": "return_type->getPointerTo()",
          "old_line_content": "    }",
          "new_line_content": "        auto * sum_value_dst_ptr = b.CreatePointerCast(aggregate_data_dst_ptr, return_type->getPointerTo());",
          "content_same": false
        },
        {
          "line": 339,
          "old_api": null,
          "new_api": "ResultDataType::maxPrecision()",
          "old_text": null,
          "new_text": "ResultDataType::maxPrecision()",
          "old_line_content": "        size_t batch_size, AggregateDataPtr place, const IColumn ** columns, Arena * arena, ssize_t if_argument_pos) const override",
          "new_line_content": "            return std::make_shared<ResultDataType>(ResultDataType::maxPrecision(), scale);",
          "content_same": false
        },
        {
          "line": 467,
          "old_api": null,
          "new_api": "CreateLoad",
          "old_text": null,
          "new_text": "b.CreateLoad(return_type, sum_value_dst_ptr)",
          "old_line_content": "",
          "new_line_content": "        auto * sum_value_dst = b.CreateLoad(return_type, sum_value_dst_ptr);",
          "content_same": false
        },
        {
          "line": 341,
          "old_api": null,
          "new_api": "std::make_shared<ResultDataType>()",
          "old_text": null,
          "new_text": "std::make_shared<ResultDataType>()",
          "old_line_content": "        if (if_argument_pos >= 0)",
          "new_line_content": "            return std::make_shared<ResultDataType>();",
          "content_same": false
        },
        {
          "line": 469,
          "old_api": null,
          "new_api": "getPointerTo",
          "old_text": null,
          "new_text": "return_type->getPointerTo()",
          "old_line_content": "",
          "new_line_content": "        auto * sum_value_src_ptr = b.CreatePointerCast(aggregate_data_src_ptr, return_type->getPointerTo());",
          "content_same": false
        },
        {
          "line": 470,
          "old_api": null,
          "new_api": "CreateLoad",
          "old_text": null,
          "new_text": "b.CreateLoad(return_type, sum_value_src_ptr)",
          "old_line_content": "private:",
          "new_line_content": "        auto * sum_value_src = b.CreateLoad(return_type, sum_value_src_ptr);",
          "content_same": false
        },
        {
          "line": 472,
          "old_api": null,
          "new_api": "CreateFAdd",
          "old_text": null,
          "new_text": "b.CreateFAdd(sum_value_dst, sum_value_src)",
          "old_line_content": "};",
          "new_line_content": "        auto * sum_return_value = sum_value_dst->getType()->isIntegerTy() ? b.CreateAdd(sum_value_dst, sum_value_src) : b.CreateFAdd(sum_value_dst, sum_value_src);",
          "content_same": false
        },
        {
          "line": 473,
          "old_api": null,
          "new_api": "CreateStore",
          "old_text": null,
          "new_text": "b.CreateStore(sum_return_value, sum_value_dst_ptr)",
          "old_line_content": "",
          "new_line_content": "        b.CreateStore(sum_return_value, sum_value_dst_ptr);",
          "content_same": false
        },
        {
          "line": 218,
          "old_api": null,
          "new_api": "addImpl",
          "old_text": null,
          "new_text": "addImpl(ptr[i], partial_sums[i], partial_compensations[i])",
          "old_line_content": "        T partial_sums[unroll_count]{};",
          "new_line_content": "                addImpl(ptr[i], partial_sums[i], partial_compensations[i]);",
          "content_same": false
        },
        {
          "line": 348,
          "old_api": null,
          "new_api": "assert_cast<const ColVecType &>(*columns[0])",
          "old_text": null,
          "new_text": "assert_cast<const ColVecType &>(*columns[0])",
          "old_line_content": "            }",
          "new_line_content": "        const auto & column = assert_cast<const ColVecType &>(*columns[0]);",
          "content_same": false
        },
        {
          "line": 350,
          "old_api": null,
          "new_api": "getData",
          "old_text": null,
          "new_text": "column.getData()",
          "old_line_content": "        else",
          "new_line_content": "            this->data(place).add(static_cast<TResult>(column.getData()[row_num]));",
          "content_same": false
        },
        {
          "line": 223,
          "old_api": null,
          "new_api": "mergeImpl",
          "old_text": null,
          "new_text": "mergeImpl(sum, compensation, partial_sums[i], partial_compensations[i])",
          "old_line_content": "",
          "new_line_content": "            mergeImpl(sum, compensation, partial_sums[i], partial_compensations[i]);",
          "content_same": false
        },
        {
          "line": 478,
          "old_api": null,
          "new_api": "static_cast<llvm::IRBuilder<> &>(builder)",
          "old_text": null,
          "new_text": "static_cast<llvm::IRBuilder<> &>(builder)",
          "old_line_content": "",
          "new_line_content": "        llvm::IRBuilder<> & b = static_cast<llvm::IRBuilder<> &>(builder);",
          "content_same": false
        },
        {
          "line": 480,
          "old_api": null,
          "new_api": "getReturnType",
          "old_text": null,
          "new_text": "getReturnType()",
          "old_line_content": "",
          "new_line_content": "        auto * return_type = toNativeType(b, getReturnType());",
          "content_same": false
        },
        {
          "line": 481,
          "old_api": null,
          "new_api": "getPointerTo",
          "old_text": null,
          "new_text": "return_type->getPointerTo()",
          "old_line_content": "",
          "new_line_content": "        auto * sum_value_ptr = b.CreatePointerCast(aggregate_data_ptr, return_type->getPointerTo());",
          "content_same": false
        },
        {
          "line": 227,
          "old_api": null,
          "new_api": "addImpl",
          "old_text": null,
          "new_text": "addImpl(*ptr, sum, compensation)",
          "old_line_content": "                if (!null_map[i])",
          "new_line_content": "            addImpl(*ptr, sum, compensation);",
          "content_same": false
        },
        {
          "line": 483,
          "old_api": null,
          "new_api": "CreateLoad",
          "old_text": null,
          "new_text": "b.CreateLoad(return_type, sum_value_ptr)",
          "old_line_content": "",
          "new_line_content": "        return b.CreateLoad(return_type, sum_value_ptr);",
          "content_same": false
        },
        {
          "line": 361,
          "old_api": null,
          "new_api": "getData",
          "old_text": null,
          "new_text": "assert_cast<const ColumnUInt8 &>(*columns[if_argument_pos]).getData()",
          "old_line_content": "        if (if_argument_pos >= 0)",
          "new_line_content": "            const auto & flags = assert_cast<const ColumnUInt8 &>(*columns[if_argument_pos]).getData();",
          "content_same": false
        },
        {
          "line": 235,
          "old_api": null,
          "new_api": "constexpr",
          "old_text": null,
          "new_text": "constexpr",
          "old_line_content": "",
          "new_line_content": "        constexpr size_t unroll_count = 4;",
          "content_same": false
        },
        {
          "line": 365,
          "old_api": null,
          "new_api": "add",
          "old_text": null,
          "new_text": "add(place, columns, i, arena)",
          "old_line_content": "                if (!null_map[i] && flags[i])",
          "new_line_content": "                    add(place, columns, i, arena);",
          "content_same": false
        },
        {
          "line": 124,
          "old_api": null,
          "new_api": "constexpr",
          "old_text": null,
          "new_text": "constexpr",
          "old_line_content": "            for (size_t i = 0; i < unroll_count; ++i)",
          "new_line_content": "            constexpr size_t unroll_count = 128 / sizeof(T);",
          "content_same": false
        },
        {
          "line": 114,
          "old_api": null,
          "new_api": "Impl::add(local_sum, *ptr * multiplier)",
          "old_text": null,
          "new_text": "Impl::add(local_sum, *ptr * multiplier)",
          "old_line_content": "                {",
          "new_line_content": "                Impl::add(local_sum, *ptr * multiplier);",
          "content_same": false
        },
        {
          "line": 118,
          "old_api": null,
          "new_api": "Impl::add(sum, local_sum)",
          "old_text": null,
          "new_text": "Impl::add(sum, local_sum)",
          "old_line_content": "                    }",
          "new_line_content": "            Impl::add(sum, local_sum);",
          "content_same": false
        },
        {
          "line": 246,
          "old_api": null,
          "new_api": "addImpl",
          "old_text": null,
          "new_text": "addImpl(ptr[i], partial_sums[i], partial_compensations[i])",
          "old_line_content": "    {",
          "new_line_content": "                    addImpl(ptr[i], partial_sums[i], partial_compensations[i]);",
          "content_same": false
        },
        {
          "line": 252,
          "old_api": null,
          "new_api": "mergeImpl",
          "old_text": null,
          "new_text": "mergeImpl(sum, compensation, partial_sums[i], partial_compensations[i])",
          "old_line_content": "        to_sum = raw_sum + compensations;",
          "new_line_content": "            mergeImpl(sum, compensation, partial_sums[i], partial_compensations[i]);",
          "content_same": false
        },
        {
          "line": 381,
          "old_api": null,
          "new_api": "getData",
          "old_text": null,
          "new_text": "assert_cast<const ColumnUInt8 &>(*columns[if_argument_pos]).getData()",
          "old_line_content": "    {",
          "new_line_content": "            const auto & flags = assert_cast<const ColumnUInt8 &>(*columns[if_argument_pos]).getData();",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 258,
          "old_api": "mergeImpl",
          "new_api": null,
          "old_text": "mergeImpl(sum, compensation, rhs.sum, rhs.compensation)",
          "new_text": null,
          "old_line_content": "        mergeImpl(sum, compensation, rhs.sum, rhs.compensation);",
          "new_line_content": "            ++ptr;",
          "content_same": false
        },
        {
          "line": 387,
          "old_api": "read",
          "new_api": null,
          "old_text": "this->data(place).read(buf)",
          "new_text": null,
          "old_line_content": "        this->data(place).read(buf);",
          "new_line_content": "        {",
          "content_same": false
        },
        {
          "line": 132,
          "old_api": "Impl::add(local_sum, *ptr)",
          "new_api": null,
          "old_text": "Impl::add(local_sum, *ptr)",
          "new_text": null,
          "old_line_content": "                Impl::add(local_sum, *ptr);",
          "new_line_content": "                {",
          "content_same": false
        },
        {
          "line": 263,
          "old_api": "writeBinary",
          "new_api": null,
          "old_text": "writeBinary(sum, buf)",
          "new_text": null,
          "old_line_content": "        writeBinary(sum, buf);",
          "new_line_content": "    void ALWAYS_INLINE mergeImpl(T & to_sum, T & to_compensation, T from_sum, T from_compensation)",
          "content_same": false
        },
        {
          "line": 136,
          "old_api": "Impl::add(sum, local_sum)",
          "new_api": null,
          "old_text": "Impl::add(sum, local_sum)",
          "new_text": null,
          "old_line_content": "        Impl::add(sum, local_sum);",
          "new_line_content": "                    }",
          "content_same": false
        },
        {
          "line": 264,
          "old_api": "writeBinary",
          "new_api": null,
          "old_text": "writeBinary(compensation, buf)",
          "new_text": null,
          "old_line_content": "        writeBinary(compensation, buf);",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 392,
          "old_api": "assert_cast<ColVecResult &>(to)",
          "new_api": null,
          "old_text": "assert_cast<ColVecResult &>(to)",
          "new_text": null,
          "old_line_content": "        auto & column = assert_cast<ColVecResult &>(to);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 393,
          "old_api": "get",
          "new_api": null,
          "old_text": "this->data(place).get()",
          "new_text": null,
          "old_line_content": "        column.getData().push_back(this->data(place).get());",
          "new_line_content": "    void merge(AggregateDataPtr __restrict place, ConstAggregateDataPtr rhs, Arena *) const override",
          "content_same": false
        },
        {
          "line": 141,
          "old_api": "Impl::add(sum, rhs.sum)",
          "new_api": null,
          "old_text": "Impl::add(sum, rhs.sum)",
          "new_text": null,
          "old_line_content": "        Impl::add(sum, rhs.sum);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 269,
          "old_api": "readBinary",
          "new_api": null,
          "old_text": "readBinary(sum, buf)",
          "new_text": null,
          "old_line_content": "        readBinary(sum, buf);",
          "new_line_content": "        auto compensations = ((from_sum - rhs_compensated) + (to_sum - (raw_sum - rhs_compensated))) + compensation + from_compensation;",
          "content_same": false
        },
        {
          "line": 270,
          "old_api": "readBinary",
          "new_api": null,
          "old_text": "readBinary(compensation, buf)",
          "new_text": null,
          "old_line_content": "        readBinary(compensation, buf);",
          "new_line_content": "        to_sum = raw_sum + compensations;",
          "content_same": false
        },
        {
          "line": 146,
          "old_api": "writeBinary",
          "new_api": null,
          "old_text": "writeBinary(sum, buf)",
          "new_text": null,
          "old_line_content": "        writeBinary(sum, buf);",
          "new_line_content": "        T local_sum{};",
          "content_same": false
        },
        {
          "line": 406,
          "old_api": "canBeNativeType",
          "new_api": null,
          "old_text": "canBeNativeType(*argument_type)",
          "new_text": null,
          "old_line_content": "            can_be_compiled &= canBeNativeType(*argument_type);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 151,
          "old_api": "readBinary",
          "new_api": null,
          "old_text": "readBinary(sum, buf)",
          "new_text": null,
          "old_line_content": "        readBinary(sum, buf);",
          "new_line_content": "            ++ptr;",
          "content_same": false
        },
        {
          "line": 408,
          "old_api": "getReturnType",
          "new_api": null,
          "old_text": "getReturnType()",
          "new_text": null,
          "old_line_content": "        auto return_type = getReturnType();",
          "new_line_content": "    void insertResultInto(AggregateDataPtr __restrict place, IColumn & to, Arena *) const override",
          "content_same": false
        },
        {
          "line": 409,
          "old_api": "canBeNativeType",
          "new_api": null,
          "old_text": "canBeNativeType(*return_type)",
          "new_text": null,
          "old_line_content": "        can_be_compiled &= canBeNativeType(*return_type);",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 416,
          "old_api": "static_cast<llvm::IRBuilder<> &>(builder)",
          "new_api": null,
          "old_text": "static_cast<llvm::IRBuilder<> &>(builder)",
          "new_text": null,
          "old_line_content": "        llvm::IRBuilder<> & b = static_cast<llvm::IRBuilder<> &>(builder);",
          "new_line_content": "    bool isCompilable() const override",
          "content_same": false
        },
        {
          "line": 418,
          "old_api": "getReturnType",
          "new_api": null,
          "old_text": "getReturnType()",
          "new_text": null,
          "old_line_content": "        auto * return_type = toNativeType(b, getReturnType());",
          "new_line_content": "        if constexpr (Type == AggregateFunctionTypeSumKahan)",
          "content_same": false
        },
        {
          "line": 291,
          "old_api": "constexpr",
          "new_api": null,
          "old_text": "constexpr",
          "new_text": null,
          "old_line_content": "    static constexpr bool DateTime64Supported = false;",
          "new_line_content": "    T get() const",
          "content_same": false
        },
        {
          "line": 419,
          "old_api": "getPointerTo",
          "new_api": null,
          "old_text": "return_type->getPointerTo()",
          "new_text": null,
          "old_line_content": "        auto * aggregate_sum_ptr = b.CreatePointerCast(aggregate_data_ptr, return_type->getPointerTo());",
          "new_line_content": "            return false;",
          "content_same": false
        },
        {
          "line": 421,
          "old_api": "llvm::Constant::getNullValue(return_type)",
          "new_api": null,
          "old_text": "llvm::Constant::getNullValue(return_type)",
          "new_text": null,
          "old_line_content": "        b.CreateStore(llvm::Constant::getNullValue(return_type), aggregate_sum_ptr);",
          "new_line_content": "        bool can_be_compiled = true;",
          "content_same": false
        },
        {
          "line": 428,
          "old_api": "getReturnType",
          "new_api": null,
          "old_text": "getReturnType()",
          "new_text": null,
          "old_line_content": "        auto * return_type = toNativeType(b, getReturnType());",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 173,
          "old_api": "static_cast<T>(value)",
          "new_api": null,
          "old_text": "static_cast<T>(value)",
          "new_text": null,
          "old_line_content": "        auto compensated_value = static_cast<T>(value) - out_compensation;",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 430,
          "old_api": "getPointerTo",
          "new_api": null,
          "old_text": "return_type->getPointerTo()",
          "new_text": null,
          "old_line_content": "        auto * sum_value_ptr = b.CreatePointerCast(aggregate_data_ptr, return_type->getPointerTo());",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 431,
          "old_api": "CreateLoad",
          "new_api": null,
          "old_text": "b.CreateLoad(return_type, sum_value_ptr)",
          "new_text": null,
          "old_line_content": "        auto * sum_value = b.CreateLoad(return_type, sum_value_ptr);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 305,
          "old_api": "__builtin_unreachable",
          "new_api": null,
          "old_text": "__builtin_unreachable()",
          "new_text": null,
          "old_line_content": "        __builtin_unreachable();",
          "new_line_content": "template <typename T, typename TResult, typename Data, AggregateFunctionSumType Type>",
          "content_same": false
        },
        {
          "line": 181,
          "old_api": "addImpl",
          "new_api": null,
          "old_text": "addImpl(value, sum, compensation)",
          "new_text": null,
          "old_line_content": "        addImpl(value, sum, compensation);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 315,
          "old_api": "getDecimalScale",
          "new_api": null,
          "old_text": "getDecimalScale(data_type)",
          "new_text": null,
          "old_line_content": "        , scale(getDecimalScale(data_type))",
          "new_line_content": "    String getName() const override",
          "content_same": false
        },
        {
          "line": 190,
          "old_api": "constexpr",
          "new_api": null,
          "old_text": "constexpr",
          "new_text": null,
          "old_line_content": "        constexpr size_t unroll_count = 4;",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 321,
          "old_api": "ResultDataType::maxPrecision()",
          "new_api": null,
          "old_text": "ResultDataType::maxPrecision()",
          "new_text": null,
          "old_line_content": "            return std::make_shared<ResultDataType>(ResultDataType::maxPrecision(), scale);",
          "new_line_content": "        else if constexpr (Type == AggregateFunctionTypeSumKahan)",
          "content_same": false
        },
        {
          "line": 451,
          "old_api": "getPointerTo",
          "new_api": null,
          "old_text": "return_type->getPointerTo()",
          "new_text": null,
          "old_line_content": "        auto * sum_value_src_ptr = b.CreatePointerCast(aggregate_data_src_ptr, return_type->getPointerTo());",
          "new_line_content": "        const auto & argument_type = arguments_types[0];",
          "content_same": false
        },
        {
          "line": 452,
          "old_api": "CreateLoad",
          "new_api": null,
          "old_text": "b.CreateLoad(return_type, sum_value_src_ptr)",
          "new_text": null,
          "old_line_content": "        auto * sum_value_src = b.CreateLoad(return_type, sum_value_src_ptr);",
          "new_line_content": "        const auto & argument_value = argument_values[0];",
          "content_same": false
        },
        {
          "line": 200,
          "old_api": "addImpl",
          "new_api": null,
          "old_text": "addImpl(ptr[i], partial_sums[i], partial_compensations[i])",
          "new_text": null,
          "old_line_content": "                addImpl(ptr[i], partial_sums[i], partial_compensations[i]);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 330,
          "old_api": "assert_cast<const ColVecType &>(*columns[0])",
          "new_api": null,
          "old_text": "assert_cast<const ColVecType &>(*columns[0])",
          "new_text": null,
          "old_line_content": "        const auto & column = assert_cast<const ColVecType &>(*columns[0]);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 332,
          "old_api": "getData",
          "new_api": null,
          "old_text": "column.getData()",
          "new_text": null,
          "old_line_content": "            this->data(place).add(static_cast<TResult>(column.getData()[row_num]));",
          "new_line_content": "        : IAggregateFunctionDataHelper<Data, AggregateFunctionSum<T, TResult, Data, Type>>(argument_types_, {})",
          "content_same": false
        },
        {
          "line": 205,
          "old_api": "mergeImpl",
          "new_api": null,
          "old_text": "mergeImpl(sum, compensation, partial_sums[i], partial_compensations[i])",
          "new_text": null,
          "old_line_content": "            mergeImpl(sum, compensation, partial_sums[i], partial_compensations[i]);",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 334,
          "old_api": "getData",
          "new_api": null,
          "old_text": "column.getData()",
          "new_text": null,
          "old_line_content": "            this->data(place).add(column.getData()[row_num]);",
          "new_line_content": "    {}",
          "content_same": false
        },
        {
          "line": 460,
          "old_api": "static_cast<llvm::IRBuilder<> &>(builder)",
          "new_api": null,
          "old_text": "static_cast<llvm::IRBuilder<> &>(builder)",
          "new_text": null,
          "old_line_content": "        llvm::IRBuilder<> & b = static_cast<llvm::IRBuilder<> &>(builder);",
          "new_line_content": "    void compileMerge(llvm::IRBuilderBase & builder, llvm::Value * aggregate_data_dst_ptr, llvm::Value * aggregate_data_src_ptr) const override",
          "content_same": false
        },
        {
          "line": 463,
          "old_api": "getPointerTo",
          "new_api": null,
          "old_text": "return_type->getPointerTo()",
          "new_text": null,
          "old_line_content": "        auto * sum_value_ptr = b.CreatePointerCast(aggregate_data_ptr, return_type->getPointerTo());",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 209,
          "old_api": "addImpl",
          "new_api": null,
          "old_text": "addImpl(*ptr, sum, compensation)",
          "new_text": null,
          "old_line_content": "            addImpl(*ptr, sum, compensation);",
          "new_line_content": "        T partial_sums[unroll_count]{};",
          "content_same": false
        },
        {
          "line": 465,
          "old_api": "CreateLoad",
          "new_api": null,
          "old_text": "b.CreateLoad(return_type, sum_value_ptr)",
          "new_text": null,
          "old_line_content": "        return b.CreateLoad(return_type, sum_value_ptr);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 343,
          "old_api": "getData",
          "new_api": null,
          "old_text": "assert_cast<const ColumnUInt8 &>(*columns[if_argument_pos]).getData()",
          "new_text": null,
          "old_line_content": "            const auto & flags = assert_cast<const ColumnUInt8 &>(*columns[if_argument_pos]).getData();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 217,
          "old_api": "constexpr",
          "new_api": null,
          "old_text": "constexpr",
          "new_text": null,
          "old_line_content": "        constexpr size_t unroll_count = 4;",
          "new_line_content": "            for (size_t i = 0; i < unroll_count; ++i)",
          "content_same": false
        },
        {
          "line": 347,
          "old_api": "add",
          "new_api": null,
          "old_text": "add(place, columns, i, arena)",
          "new_text": null,
          "old_line_content": "                    add(place, columns, i, arena);",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 353,
          "old_api": "getData",
          "new_api": null,
          "old_text": "column.getData().data()",
          "new_text": null,
          "old_line_content": "            this->data(place).addMany(column.getData().data(), batch_size);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 228,
          "old_api": "addImpl",
          "new_api": null,
          "old_text": "addImpl(ptr[i], partial_sums[i], partial_compensations[i])",
          "new_text": null,
          "old_line_content": "                    addImpl(ptr[i], partial_sums[i], partial_compensations[i]);",
          "new_line_content": "            ++ptr;",
          "content_same": false
        },
        {
          "line": 106,
          "old_api": "constexpr",
          "new_api": null,
          "old_text": "constexpr",
          "new_text": null,
          "old_line_content": "            constexpr size_t unroll_count = 128 / sizeof(T);",
          "new_line_content": "            || (IsDecimalNumber<T> && !std::is_same_v<T, Decimal256> && !std::is_same_v<T, Decimal128>))",
          "content_same": false
        },
        {
          "line": 234,
          "old_api": "mergeImpl",
          "new_api": null,
          "old_text": "mergeImpl(sum, compensation, partial_sums[i], partial_compensations[i])",
          "new_text": null,
          "old_line_content": "            mergeImpl(sum, compensation, partial_sums[i], partial_compensations[i]);",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 363,
          "old_api": "getData",
          "new_api": null,
          "old_text": "assert_cast<const ColumnUInt8 &>(*columns[if_argument_pos]).getData()",
          "new_text": null,
          "old_line_content": "            const auto & flags = assert_cast<const ColumnUInt8 &>(*columns[if_argument_pos]).getData();",
          "new_line_content": "            {",
          "content_same": false
        },
        {
          "line": 366,
          "old_api": "add",
          "new_api": null,
          "old_text": "add(place, columns, i, arena)",
          "new_text": null,
          "old_line_content": "                    add(place, columns, i, arena);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 239,
          "old_api": "addImpl",
          "new_api": null,
          "old_text": "addImpl(*ptr, sum, compensation)",
          "new_text": null,
          "old_line_content": "                addImpl(*ptr, sum, compensation);",
          "new_line_content": "        const auto * end = ptr + count;",
          "content_same": false
        },
        {
          "line": 117,
          "old_api": "Impl::add(partial_sums[i], ptr[i])",
          "new_api": null,
          "old_text": "Impl::add(partial_sums[i], ptr[i])",
          "new_text": null,
          "old_line_content": "                        Impl::add(partial_sums[i], ptr[i]);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 377,
          "old_api": "data",
          "new_api": null,
          "old_text": "this->data(rhs)",
          "new_text": null,
          "old_line_content": "        this->data(place).merge(this->data(rhs));",
          "new_line_content": "        const override",
          "content_same": false
        },
        {
          "line": 125,
          "old_api": "Impl::add(sum, partial_sums[i])",
          "new_api": null,
          "old_text": "Impl::add(sum, partial_sums[i])",
          "new_text": null,
          "old_line_content": "                Impl::add(sum, partial_sums[i]);",
          "new_line_content": "            T partial_sums[unroll_count]{};",
          "content_same": false
        },
        {
          "line": 382,
          "old_api": "write",
          "new_api": null,
          "old_text": "this->data(place).write(buf)",
          "new_text": null,
          "old_line_content": "        this->data(place).write(buf);",
          "new_line_content": "            for (size_t i = 0; i < batch_size; ++i)",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 9,
      "total_additions": 57,
      "total_deletions": 55,
      "total_api_changes": 121
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 18,
        "api_related_lines": 121,
        "non_api_lines": 12,
        "non_api_line_numbers": [
          128,
          130,
          134,
          138,
          108,
          140,
          110,
          112,
          116,
          120,
          122,
          126
        ]
      }
    },
    "api_calls_before": 114,
    "api_calls_after": 116,
    "diff_info": {
      "added_lines": 19,
      "removed_lines": 1,
      "total_diff_lines": 55
    }
  }
}