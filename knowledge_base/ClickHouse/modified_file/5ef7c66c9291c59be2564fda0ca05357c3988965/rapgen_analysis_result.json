{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ClickHouse/modified_file/5ef7c66c9291c59be2564fda0ca05357c3988965",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ClickHouse/modified_file/5ef7c66c9291c59be2564fda0ca05357c3988965/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ClickHouse/modified_file/5ef7c66c9291c59be2564fda0ca05357c3988965/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ClickHouse/modified_file/5ef7c66c9291c59be2564fda0ca05357c3988965/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 166,
          "old_api": "reinterpret_cast<char*>(&data[offset - size - 1])",
          "new_api": "typeid_cast<ColumnString &>(column)",
          "old_text": "reinterpret_cast<char*>(&data[offset - size - 1])",
          "new_text": "typeid_cast<ColumnString &>(column)",
          "old_line_content": "                istr.readStrict(reinterpret_cast<char*>(&data[offset - size - 1]), size);",
          "new_line_content": "    ColumnString & column_string = typeid_cast<ColumnString &>(column);",
          "content_same": false
        },
        {
          "line": 191,
          "old_api": "std::ceil(limit * avg_chars_size)",
          "new_api": "addMessage",
          "old_text": "std::ceil(limit * avg_chars_size)",
          "new_text": "e.addMessage(\n                \"(avg_value_size_hint = \" + toString(avg_value_size_hint)\n                + \", avg_chars_size = \" + toString(avg_chars_size)\n                + \", limit = \" + toString(limit) + \")\")",
          "old_line_content": "    size_t size_to_reserve = data.size() + std::ceil(limit * avg_chars_size);",
          "new_line_content": "            e.addMessage(",
          "content_same": false
        },
        {
          "line": 202,
          "old_api": "addMessage",
          "new_api": "deserializeBinarySSE2<4>(data, offsets, istr, limit)",
          "old_text": "e.addMessage(\n                \"(avg_value_size_hint = \" + toString(avg_value_size_hint)\n                + \", avg_chars_size = \" + toString(avg_chars_size)\n                + \", limit = \" + toString(limit) + \")\")",
          "new_text": "deserializeBinarySSE2<4>(data, offsets, istr, limit)",
          "old_line_content": "            e.addMessage(",
          "new_line_content": "        deserializeBinarySSE2<4>(data, offsets, istr, limit);",
          "content_same": false
        },
        {
          "line": 204,
          "old_api": "toString",
          "new_api": "deserializeBinarySSE2<3>(data, offsets, istr, limit)",
          "old_text": "toString(avg_chars_size)",
          "new_text": "deserializeBinarySSE2<3>(data, offsets, istr, limit)",
          "old_line_content": "                + \", avg_chars_size = \" + toString(avg_chars_size)",
          "new_line_content": "        deserializeBinarySSE2<3>(data, offsets, istr, limit);",
          "content_same": false
        },
        {
          "line": 231,
          "old_api": "getDataAt",
          "new_api": "size",
          "old_text": "static_cast<const ColumnString &>(column).getDataAt(row_num)",
          "new_text": "offsets.size()",
          "old_line_content": "    writeEscapedString(static_cast<const ColumnString &>(column).getDataAt(row_num), ostr);",
          "new_line_content": "    size_t old_offsets_size = offsets.size();",
          "content_same": false
        },
        {
          "line": 240,
          "old_api": "getOffsets",
          "new_api": "resize_assume_reserved",
          "old_text": "column_string.getOffsets()",
          "new_text": "offsets.resize_assume_reserved(old_offsets_size)",
          "old_line_content": "    ColumnString::Offsets & offsets = column_string.getOffsets();",
          "new_line_content": "        offsets.resize_assume_reserved(old_offsets_size);",
          "content_same": false
        },
        {
          "line": 241,
          "old_api": "size",
          "new_api": "resize_assume_reserved",
          "old_text": "data.size()",
          "new_text": "data.resize_assume_reserved(old_chars_size)",
          "old_line_content": "    size_t old_chars_size = data.size();",
          "new_line_content": "        data.resize_assume_reserved(old_chars_size);",
          "content_same": false
        },
        {
          "line": 317,
          "old_api": "static_cast<ColumnString &>(column)",
          "new_api": "size",
          "old_text": "static_cast<ColumnString &>(column)",
          "new_text": "data.size()",
          "old_line_content": "    auto & column_string = static_cast<ColumnString &>(column);",
          "new_line_content": "                offsets.emplace_back(data.size());",
          "content_same": false
        },
        {
          "line": 328,
          "old_api": "size",
          "new_api": "emplace_back",
          "old_text": "data.size()",
          "new_text": "temp_data.emplace_back(0)",
          "old_line_content": "                offsets.emplace_back(data.size());",
          "new_line_content": "                temp_data.emplace_back(0);",
          "content_same": false
        },
        {
          "line": 332,
          "old_api": "back",
          "new_api": "size",
          "old_text": "offsets.back()",
          "new_text": "data.size()",
          "old_line_content": "                data.resize_assume_reserved(offsets.back());",
          "new_line_content": "                offsets.emplace_back(data.size());",
          "content_same": false
        },
        {
          "line": 339,
          "old_api": "emplace_back",
          "new_api": "back",
          "old_text": "temp_data.emplace_back(0)",
          "new_text": "offsets.back()",
          "old_line_content": "                temp_data.emplace_back(0);",
          "new_line_content": "        data.resize_assume_reserved(offsets.back());",
          "content_same": false
        },
        {
          "line": 370,
          "old_api": "std::make_shared<DataTypeString>()",
          "new_api": "registerAlias",
          "old_text": "std::make_shared<DataTypeString>()",
          "new_text": "factory.registerAlias(\"LONGTEXT\", \"String\", DataTypeFactory::CaseInsensitive)",
          "old_line_content": "    auto creator = static_cast<DataTypePtr(*)()>([] { return DataTypePtr(std::make_shared<DataTypeString>()); });",
          "new_line_content": "    factory.registerAlias(\"LONGTEXT\", \"String\", DataTypeFactory::CaseInsensitive);",
          "content_same": false
        },
        {
          "line": 372,
          "old_api": "registerSimpleDataType",
          "new_api": "registerAlias",
          "old_text": "factory.registerSimpleDataType(\"String\", creator)",
          "new_text": "factory.registerAlias(\"TINYBLOB\", \"String\", DataTypeFactory::CaseInsensitive)",
          "old_line_content": "    factory.registerSimpleDataType(\"String\", creator);",
          "new_line_content": "    factory.registerAlias(\"TINYBLOB\", \"String\", DataTypeFactory::CaseInsensitive);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 261,
          "old_api": null,
          "new_api": "readQuotedStringInto<true>(data, istr)",
          "old_text": null,
          "new_text": "readQuotedStringInto<true>(data, istr)",
          "old_line_content": "}",
          "new_line_content": "    read(column, [&](ColumnString::Chars & data) { readQuotedStringInto<true>(data, istr); });",
          "content_same": false
        },
        {
          "line": 267,
          "old_api": null,
          "new_api": "getDataAt",
          "old_text": null,
          "new_text": "static_cast<const ColumnString &>(column).getDataAt(row_num)",
          "old_line_content": "}",
          "new_line_content": "    writeJSONString(static_cast<const ColumnString &>(column).getDataAt(row_num), ostr, settings);",
          "content_same": false
        },
        {
          "line": 144,
          "old_api": null,
          "new_api": "_mm_loadu_si128",
          "old_text": null,
          "new_text": "_mm_loadu_si128(sse_src_pos + j)",
          "old_line_content": "                    /// for (size_t j = 0; j < UNROLL_TIMES; ++j)",
          "new_line_content": "                        _mm_storeu_si128(sse_dst_pos + j, _mm_loadu_si128(sse_src_pos + j));",
          "content_same": false
        },
        {
          "line": 273,
          "old_api": null,
          "new_api": "readJSONStringInto",
          "old_text": null,
          "new_text": "readJSONStringInto(data, istr)",
          "old_line_content": "}",
          "new_line_content": "    read(column, [&](ColumnString::Chars & data) { readJSONStringInto(data, istr); });",
          "content_same": false
        },
        {
          "line": 150,
          "old_api": null,
          "new_api": "position",
          "old_text": null,
          "new_text": "istr.position()",
          "old_line_content": "                    if (UNROLL_TIMES >= 4) __asm__(\"movdqu %0, %%xmm0\" :: \"m\"(sse_src_pos[-4]));",
          "new_line_content": "                istr.position() += size;",
          "content_same": false
        },
        {
          "line": 279,
          "old_api": null,
          "new_api": "getDataAt",
          "old_text": null,
          "new_text": "static_cast<const ColumnString &>(column).getDataAt(row_num)",
          "old_line_content": "}",
          "new_line_content": "    writeXMLString(static_cast<const ColumnString &>(column).getDataAt(row_num), ostr);",
          "content_same": false
        },
        {
          "line": 155,
          "old_api": null,
          "new_api": "reinterpret_cast<char*>(&data[offset - size - 1])",
          "old_text": null,
          "new_text": "reinterpret_cast<char*>(&data[offset - size - 1])",
          "old_line_content": "                    if (UNROLL_TIMES >= 4) __asm__(\"movdqu %%xmm0, %0\" : \"=m\"(sse_dst_pos[-4]));",
          "new_line_content": "                istr.readStrict(reinterpret_cast<char*>(&data[offset - size - 1]), size);",
          "content_same": false
        },
        {
          "line": 285,
          "old_api": null,
          "new_api": "getDataAt",
          "old_text": null,
          "new_text": "static_cast<const ColumnString &>(column).getDataAt(row_num)",
          "old_line_content": "}",
          "new_line_content": "    writeCSVString<>(static_cast<const ColumnString &>(column).getDataAt(row_num), ostr);",
          "content_same": false
        },
        {
          "line": 291,
          "old_api": null,
          "new_api": "readCSVStringInto",
          "old_text": null,
          "new_text": "readCSVStringInto(data, istr, settings.csv)",
          "old_line_content": "}",
          "new_line_content": "    read(column, [&](ColumnString::Chars & data) { readCSVStringInto(data, istr, settings.csv); });",
          "content_same": false
        },
        {
          "line": 167,
          "old_api": null,
          "new_api": "getChars",
          "old_text": null,
          "new_text": "column_string.getChars()",
          "old_line_content": "            }",
          "new_line_content": "    ColumnString::Chars & data = column_string.getChars();",
          "content_same": false
        },
        {
          "line": 168,
          "old_api": null,
          "new_api": "getOffsets",
          "old_text": null,
          "new_text": "column_string.getOffsets()",
          "old_line_content": "        }",
          "new_line_content": "    ColumnString::Offsets & offsets = column_string.getOffsets();",
          "content_same": false
        },
        {
          "line": 299,
          "old_api": null,
          "new_api": "getDataAt",
          "old_text": null,
          "new_text": "static_cast<const ColumnString &>(column).getDataAt(row_num)",
          "old_line_content": "",
          "new_line_content": "    value_index = static_cast<bool>(protobuf.writeString(static_cast<const ColumnString &>(column).getDataAt(row_num)));",
          "content_same": false
        },
        {
          "line": 175,
          "old_api": null,
          "new_api": "constexpr",
          "old_text": null,
          "new_text": "constexpr",
          "old_line_content": "void DataTypeString::deserializeBinaryBulk(IColumn & column, ReadBuffer & istr, size_t limit, double avg_value_size_hint) const",
          "new_line_content": "        constexpr auto avg_value_size_hint_reserve_multiplier = 1.2;",
          "content_same": false
        },
        {
          "line": 306,
          "old_api": null,
          "new_api": "static_cast<ColumnString &>(column)",
          "old_text": null,
          "new_text": "static_cast<ColumnString &>(column)",
          "old_line_content": "void DataTypeString::serializeProtobuf(const IColumn & column, size_t row_num, ProtobufWriter & protobuf, size_t & value_index) const",
          "new_line_content": "    auto & column_string = static_cast<ColumnString &>(column);",
          "content_same": false
        },
        {
          "line": 307,
          "old_api": null,
          "new_api": "getChars",
          "old_text": null,
          "new_text": "column_string.getChars()",
          "old_line_content": "{",
          "new_line_content": "    ColumnString::Chars & data = column_string.getChars();",
          "content_same": false
        },
        {
          "line": 180,
          "old_api": null,
          "new_api": "std::ceil(limit * avg_chars_size)",
          "old_text": null,
          "new_text": "std::ceil(limit * avg_chars_size)",
          "old_line_content": "",
          "new_line_content": "    size_t size_to_reserve = data.size() + std::ceil(limit * avg_chars_size);",
          "content_same": false
        },
        {
          "line": 308,
          "old_api": null,
          "new_api": "getOffsets",
          "old_text": null,
          "new_text": "column_string.getOffsets()",
          "old_line_content": "    if (value_index)",
          "new_line_content": "    ColumnString::Offsets & offsets = column_string.getOffsets();",
          "content_same": false
        },
        {
          "line": 309,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "offsets.size()",
          "old_line_content": "        return;",
          "new_line_content": "    size_t old_size = offsets.size();",
          "content_same": false
        },
        {
          "line": 314,
          "old_api": null,
          "new_api": "readStringInto",
          "old_text": null,
          "new_text": "protobuf.readStringInto(data)",
          "old_line_content": "void DataTypeString::deserializeProtobuf(IColumn & column, ProtobufReader & protobuf, bool allow_add_row, bool & row_added) const",
          "new_line_content": "            if (protobuf.readStringInto(data))",
          "content_same": false
        },
        {
          "line": 187,
          "old_api": null,
          "new_api": "reserve",
          "old_text": null,
          "new_text": "data.reserve(size_to_reserve)",
          "old_line_content": "",
          "new_line_content": "            data.reserve(size_to_reserve);",
          "content_same": false
        },
        {
          "line": 316,
          "old_api": null,
          "new_api": "emplace_back",
          "old_text": null,
          "new_text": "data.emplace_back(0)",
          "old_line_content": "    row_added = false;",
          "new_line_content": "                data.emplace_back(0);",
          "content_same": false
        },
        {
          "line": 192,
          "old_api": null,
          "new_api": "toString",
          "old_text": null,
          "new_text": "toString(avg_value_size_hint)",
          "old_line_content": "",
          "new_line_content": "                \"(avg_value_size_hint = \" + toString(avg_value_size_hint)",
          "content_same": false
        },
        {
          "line": 193,
          "old_api": null,
          "new_api": "toString",
          "old_text": null,
          "new_text": "toString(avg_chars_size)",
          "old_line_content": "    /// Never reserve for too big size.",
          "new_line_content": "                + \", avg_chars_size = \" + toString(avg_chars_size)",
          "content_same": false
        },
        {
          "line": 194,
          "old_api": null,
          "new_api": "toString",
          "old_text": null,
          "new_text": "toString(limit)",
          "old_line_content": "    if (size_to_reserve < 256 * 1024 * 1024)",
          "new_line_content": "                + \", limit = \" + toString(limit) + \")\");",
          "content_same": false
        },
        {
          "line": 321,
          "old_api": null,
          "new_api": "back",
          "old_text": null,
          "new_text": "offsets.back()",
          "old_line_content": "    try",
          "new_line_content": "                data.resize_assume_reserved(offsets.back());",
          "content_same": false
        },
        {
          "line": 326,
          "old_api": null,
          "new_api": "readStringInto",
          "old_text": null,
          "new_text": "protobuf.readStringInto(temp_data)",
          "old_line_content": "            {",
          "new_line_content": "            if (protobuf.readStringInto(temp_data))",
          "content_same": false
        },
        {
          "line": 199,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "offsets.size()",
          "old_line_content": "        }",
          "new_line_content": "    offsets.reserve(offsets.size() + limit);",
          "content_same": false
        },
        {
          "line": 329,
          "old_api": null,
          "new_api": "popBack",
          "old_text": null,
          "new_text": "column_string.popBack(1)",
          "old_line_content": "                row_added = true;",
          "new_line_content": "                column_string.popBack(1);",
          "content_same": false
        },
        {
          "line": 330,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "offsets.size()",
          "old_line_content": "            }",
          "new_line_content": "                old_size = offsets.size();",
          "content_same": false
        },
        {
          "line": 331,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "temp_data.end()",
          "old_line_content": "            else",
          "new_line_content": "                data.insertSmallAllowReadWriteOverflow15(temp_data.begin(), temp_data.end());",
          "content_same": false
        },
        {
          "line": 206,
          "old_api": null,
          "new_api": "deserializeBinarySSE2<2>(data, offsets, istr, limit)",
          "old_text": null,
          "new_text": "deserializeBinarySSE2<2>(data, offsets, istr, limit)",
          "old_line_content": "            throw;",
          "new_line_content": "        deserializeBinarySSE2<2>(data, offsets, istr, limit);",
          "content_same": false
        },
        {
          "line": 208,
          "old_api": null,
          "new_api": "deserializeBinarySSE2<1>(data, offsets, istr, limit)",
          "old_text": null,
          "new_text": "deserializeBinarySSE2<1>(data, offsets, istr, limit)",
          "old_line_content": "    }",
          "new_line_content": "        deserializeBinarySSE2<1>(data, offsets, istr, limit);",
          "content_same": false
        },
        {
          "line": 338,
          "old_api": null,
          "new_api": "resize_assume_reserved",
          "old_text": null,
          "new_text": "offsets.resize_assume_reserved(old_size)",
          "old_line_content": "            {",
          "new_line_content": "        offsets.resize_assume_reserved(old_size);",
          "content_same": false
        },
        {
          "line": 214,
          "old_api": null,
          "new_api": "getDataAt",
          "old_text": null,
          "new_text": "static_cast<const ColumnString &>(column).getDataAt(row_num)",
          "old_line_content": "    else if (avg_chars_size >= 48)",
          "new_line_content": "    writeString(static_cast<const ColumnString &>(column).getDataAt(row_num), ostr);",
          "content_same": false
        },
        {
          "line": 347,
          "old_api": null,
          "new_api": "ColumnString::create()",
          "old_text": null,
          "new_text": "ColumnString::create()",
          "old_line_content": "    catch (...)",
          "new_line_content": "    return ColumnString::create();",
          "content_same": false
        },
        {
          "line": 220,
          "old_api": null,
          "new_api": "getDataAt",
          "old_text": null,
          "new_text": "static_cast<const ColumnString &>(column).getDataAt(row_num)",
          "old_line_content": "}",
          "new_line_content": "    writeEscapedString(static_cast<const ColumnString &>(column).getDataAt(row_num), ostr);",
          "content_same": false
        },
        {
          "line": 353,
          "old_api": null,
          "new_api": "typeid",
          "old_text": null,
          "new_text": "typeid(*this)",
          "old_line_content": "}",
          "new_line_content": "    return typeid(rhs) == typeid(*this);",
          "content_same": false
        },
        {
          "line": 227,
          "old_api": null,
          "new_api": "static_cast<ColumnString &>(column)",
          "old_text": null,
          "new_text": "static_cast<ColumnString &>(column)",
          "old_line_content": "",
          "new_line_content": "    ColumnString & column_string = static_cast<ColumnString &>(column);",
          "content_same": false
        },
        {
          "line": 228,
          "old_api": null,
          "new_api": "getChars",
          "old_text": null,
          "new_text": "column_string.getChars()",
          "old_line_content": "",
          "new_line_content": "    ColumnString::Chars & data = column_string.getChars();",
          "content_same": false
        },
        {
          "line": 229,
          "old_api": null,
          "new_api": "getOffsets",
          "old_text": null,
          "new_text": "column_string.getOffsets()",
          "old_line_content": "void DataTypeString::serializeTextEscaped(const IColumn & column, size_t row_num, WriteBuffer & ostr, const FormatSettings &) const",
          "new_line_content": "    ColumnString::Offsets & offsets = column_string.getOffsets();",
          "content_same": false
        },
        {
          "line": 230,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "data.size()",
          "old_line_content": "{",
          "new_line_content": "    size_t old_chars_size = data.size();",
          "content_same": false
        },
        {
          "line": 359,
          "old_api": null,
          "new_api": "std::make_shared<DataTypeString>()",
          "old_text": null,
          "new_text": "std::make_shared<DataTypeString>()",
          "old_line_content": "}",
          "new_line_content": "    auto creator = static_cast<DataTypePtr(*)()>([] { return DataTypePtr(std::make_shared<DataTypeString>()); });",
          "content_same": false
        },
        {
          "line": 361,
          "old_api": null,
          "new_api": "registerSimpleDataType",
          "old_text": null,
          "new_text": "factory.registerSimpleDataType(\"String\", creator)",
          "old_line_content": "",
          "new_line_content": "    factory.registerSimpleDataType(\"String\", creator);",
          "content_same": false
        },
        {
          "line": 234,
          "old_api": null,
          "new_api": "reader",
          "old_text": null,
          "new_text": "reader(data)",
          "old_line_content": "",
          "new_line_content": "        reader(data);",
          "content_same": false
        },
        {
          "line": 235,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "data.push_back(0)",
          "old_line_content": "template <typename Reader>",
          "new_line_content": "        data.push_back(0);",
          "content_same": false
        },
        {
          "line": 236,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "data.size()",
          "old_line_content": "static inline void read(IColumn & column, Reader && reader)",
          "new_line_content": "        offsets.push_back(data.size());",
          "content_same": false
        },
        {
          "line": 365,
          "old_api": null,
          "new_api": "registerAlias",
          "old_text": null,
          "new_text": "factory.registerAlias(\"CHAR\", \"String\", DataTypeFactory::CaseInsensitive)",
          "old_line_content": "}",
          "new_line_content": "    factory.registerAlias(\"CHAR\", \"String\", DataTypeFactory::CaseInsensitive);",
          "content_same": false
        },
        {
          "line": 366,
          "old_api": null,
          "new_api": "registerAlias",
          "old_text": null,
          "new_text": "factory.registerAlias(\"VARCHAR\", \"String\", DataTypeFactory::CaseInsensitive)",
          "old_line_content": "",
          "new_line_content": "    factory.registerAlias(\"VARCHAR\", \"String\", DataTypeFactory::CaseInsensitive);",
          "content_same": false
        },
        {
          "line": 367,
          "old_api": null,
          "new_api": "registerAlias",
          "old_text": null,
          "new_text": "factory.registerAlias(\"TEXT\", \"String\", DataTypeFactory::CaseInsensitive)",
          "old_line_content": "",
          "new_line_content": "    factory.registerAlias(\"TEXT\", \"String\", DataTypeFactory::CaseInsensitive);",
          "content_same": false
        },
        {
          "line": 368,
          "old_api": null,
          "new_api": "registerAlias",
          "old_text": null,
          "new_text": "factory.registerAlias(\"TINYTEXT\", \"String\", DataTypeFactory::CaseInsensitive)",
          "old_line_content": "void registerDataTypeString(DataTypeFactory & factory)",
          "new_line_content": "    factory.registerAlias(\"TINYTEXT\", \"String\", DataTypeFactory::CaseInsensitive);",
          "content_same": false
        },
        {
          "line": 369,
          "old_api": null,
          "new_api": "registerAlias",
          "old_text": null,
          "new_text": "factory.registerAlias(\"MEDIUMTEXT\", \"String\", DataTypeFactory::CaseInsensitive)",
          "old_line_content": "{",
          "new_line_content": "    factory.registerAlias(\"MEDIUMTEXT\", \"String\", DataTypeFactory::CaseInsensitive);",
          "content_same": false
        },
        {
          "line": 371,
          "old_api": null,
          "new_api": "registerAlias",
          "old_text": null,
          "new_text": "factory.registerAlias(\"BLOB\", \"String\", DataTypeFactory::CaseInsensitive)",
          "old_line_content": "",
          "new_line_content": "    factory.registerAlias(\"BLOB\", \"String\", DataTypeFactory::CaseInsensitive);",
          "content_same": false
        },
        {
          "line": 373,
          "old_api": null,
          "new_api": "registerAlias",
          "old_text": null,
          "new_text": "factory.registerAlias(\"MEDIUMBLOB\", \"String\", DataTypeFactory::CaseInsensitive)",
          "old_line_content": "",
          "new_line_content": "    factory.registerAlias(\"MEDIUMBLOB\", \"String\", DataTypeFactory::CaseInsensitive);",
          "content_same": false
        },
        {
          "line": 374,
          "old_api": null,
          "new_api": "registerAlias",
          "old_text": null,
          "new_text": "factory.registerAlias(\"LONGBLOB\", \"String\", DataTypeFactory::CaseInsensitive)",
          "old_line_content": "    /// These synonyms are added for compatibility.",
          "new_line_content": "    factory.registerAlias(\"LONGBLOB\", \"String\", DataTypeFactory::CaseInsensitive);",
          "content_same": false
        },
        {
          "line": 249,
          "old_api": null,
          "new_api": "readEscapedStringInto",
          "old_text": null,
          "new_text": "readEscapedStringInto(data, istr)",
          "old_line_content": "    catch (...)",
          "new_line_content": "    read(column, [&](ColumnString::Chars & data) { readEscapedStringInto(data, istr); });",
          "content_same": false
        },
        {
          "line": 255,
          "old_api": null,
          "new_api": "getDataAt",
          "old_text": null,
          "new_text": "static_cast<const ColumnString &>(column).getDataAt(row_num)",
          "old_line_content": "}",
          "new_line_content": "    writeQuotedString(static_cast<const ColumnString &>(column).getDataAt(row_num), ostr);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 384,
          "old_api": "registerAlias",
          "new_api": null,
          "old_text": "factory.registerAlias(\"MEDIUMBLOB\", \"String\", DataTypeFactory::CaseInsensitive)",
          "new_text": null,
          "old_line_content": "    factory.registerAlias(\"MEDIUMBLOB\", \"String\", DataTypeFactory::CaseInsensitive);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 385,
          "old_api": "registerAlias",
          "new_api": null,
          "old_text": "factory.registerAlias(\"LONGBLOB\", \"String\", DataTypeFactory::CaseInsensitive)",
          "new_text": null,
          "old_line_content": "    factory.registerAlias(\"LONGBLOB\", \"String\", DataTypeFactory::CaseInsensitive);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 260,
          "old_api": "readEscapedStringInto",
          "new_api": null,
          "old_text": "readEscapedStringInto(data, istr)",
          "new_text": null,
          "old_line_content": "    read(column, [&](ColumnString::Chars & data) { readEscapedStringInto(data, istr); });",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 266,
          "old_api": "getDataAt",
          "new_api": null,
          "old_text": "static_cast<const ColumnString &>(column).getDataAt(row_num)",
          "new_text": null,
          "old_line_content": "    writeQuotedString(static_cast<const ColumnString &>(column).getDataAt(row_num), ostr);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 272,
          "old_api": "readQuotedStringInto<true>(data, istr)",
          "new_api": null,
          "old_text": "readQuotedStringInto<true>(data, istr)",
          "new_text": null,
          "old_line_content": "    read(column, [&](ColumnString::Chars & data) { readQuotedStringInto<true>(data, istr); });",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 278,
          "old_api": "getDataAt",
          "new_api": null,
          "old_text": "static_cast<const ColumnString &>(column).getDataAt(row_num)",
          "new_text": null,
          "old_line_content": "    writeJSONString(static_cast<const ColumnString &>(column).getDataAt(row_num), ostr, settings);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 284,
          "old_api": "readJSONStringInto",
          "new_api": null,
          "old_text": "readJSONStringInto(data, istr)",
          "new_text": null,
          "old_line_content": "    read(column, [&](ColumnString::Chars & data) { readJSONStringInto(data, istr); });",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 161,
          "old_api": "position",
          "new_api": null,
          "old_text": "istr.position()",
          "new_text": null,
          "old_line_content": "                istr.position() += size;",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 290,
          "old_api": "getDataAt",
          "new_api": null,
          "old_text": "static_cast<const ColumnString &>(column).getDataAt(row_num)",
          "new_text": null,
          "old_line_content": "    writeXMLString(static_cast<const ColumnString &>(column).getDataAt(row_num), ostr);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 296,
          "old_api": "getDataAt",
          "new_api": null,
          "old_text": "static_cast<const ColumnString &>(column).getDataAt(row_num)",
          "new_text": null,
          "old_line_content": "    writeCSVString<>(static_cast<const ColumnString &>(column).getDataAt(row_num), ostr);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 302,
          "old_api": "readCSVStringInto",
          "new_api": null,
          "old_text": "readCSVStringInto(data, istr, settings.csv)",
          "new_text": null,
          "old_line_content": "    read(column, [&](ColumnString::Chars & data) { readCSVStringInto(data, istr, settings.csv); });",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 177,
          "old_api": "typeid_cast<ColumnString &>(column)",
          "new_api": null,
          "old_text": "typeid_cast<ColumnString &>(column)",
          "new_text": null,
          "old_line_content": "    ColumnString & column_string = typeid_cast<ColumnString &>(column);",
          "new_line_content": "        avg_chars_size = (avg_value_size_hint - sizeof(offsets[0])) * avg_value_size_hint_reserve_multiplier;",
          "content_same": false
        },
        {
          "line": 178,
          "old_api": "getChars",
          "new_api": null,
          "old_text": "column_string.getChars()",
          "new_text": null,
          "old_line_content": "    ColumnString::Chars & data = column_string.getChars();",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 179,
          "old_api": "getOffsets",
          "new_api": null,
          "old_text": "column_string.getOffsets()",
          "new_text": null,
          "old_line_content": "    ColumnString::Offsets & offsets = column_string.getOffsets();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 310,
          "old_api": "getDataAt",
          "new_api": null,
          "old_text": "static_cast<const ColumnString &>(column).getDataAt(row_num)",
          "new_text": null,
          "old_line_content": "    value_index = static_cast<bool>(protobuf.writeString(static_cast<const ColumnString &>(column).getDataAt(row_num)));",
          "new_line_content": "    try",
          "content_same": false
        },
        {
          "line": 186,
          "old_api": "constexpr",
          "new_api": null,
          "old_text": "constexpr",
          "new_text": null,
          "old_line_content": "        constexpr auto avg_value_size_hint_reserve_multiplier = 1.2;",
          "new_line_content": "        {",
          "content_same": false
        },
        {
          "line": 318,
          "old_api": "getChars",
          "new_api": null,
          "old_text": "column_string.getChars()",
          "new_text": null,
          "old_line_content": "    ColumnString::Chars & data = column_string.getChars();",
          "new_line_content": "                row_added = true;",
          "content_same": false
        },
        {
          "line": 319,
          "old_api": "getOffsets",
          "new_api": null,
          "old_text": "column_string.getOffsets()",
          "new_text": null,
          "old_line_content": "    ColumnString::Offsets & offsets = column_string.getOffsets();",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 320,
          "old_api": "size",
          "new_api": null,
          "old_text": "offsets.size()",
          "new_text": null,
          "old_line_content": "    size_t old_size = offsets.size();",
          "new_line_content": "            else",
          "content_same": false
        },
        {
          "line": 325,
          "old_api": "readStringInto",
          "new_api": null,
          "old_text": "protobuf.readStringInto(data)",
          "new_text": null,
          "old_line_content": "            if (protobuf.readStringInto(data))",
          "new_line_content": "            ColumnString::Chars temp_data;",
          "content_same": false
        },
        {
          "line": 198,
          "old_api": "reserve",
          "new_api": null,
          "old_text": "data.reserve(size_to_reserve)",
          "new_text": null,
          "old_line_content": "            data.reserve(size_to_reserve);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 327,
          "old_api": "emplace_back",
          "new_api": null,
          "old_text": "data.emplace_back(0)",
          "new_text": null,
          "old_line_content": "                data.emplace_back(0);",
          "new_line_content": "            {",
          "content_same": false
        },
        {
          "line": 203,
          "old_api": "toString",
          "new_api": null,
          "old_text": "toString(avg_value_size_hint)",
          "new_text": null,
          "old_line_content": "                \"(avg_value_size_hint = \" + toString(avg_value_size_hint)",
          "new_line_content": "    else if (avg_chars_size >= 48)",
          "content_same": false
        },
        {
          "line": 205,
          "old_api": "toString",
          "new_api": null,
          "old_text": "toString(limit)",
          "new_text": null,
          "old_line_content": "                + \", limit = \" + toString(limit) + \")\");",
          "new_line_content": "    else if (avg_chars_size >= 32)",
          "content_same": false
        },
        {
          "line": 337,
          "old_api": "readStringInto",
          "new_api": null,
          "old_text": "protobuf.readStringInto(temp_data)",
          "new_text": null,
          "old_line_content": "            if (protobuf.readStringInto(temp_data))",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 210,
          "old_api": "size",
          "new_api": null,
          "old_text": "offsets.size()",
          "new_text": null,
          "old_line_content": "    offsets.reserve(offsets.size() + limit);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 340,
          "old_api": "popBack",
          "new_api": null,
          "old_text": "column_string.popBack(1)",
          "new_text": null,
          "old_line_content": "                column_string.popBack(1);",
          "new_line_content": "        throw;",
          "content_same": false
        },
        {
          "line": 213,
          "old_api": "deserializeBinarySSE2<4>(data, offsets, istr, limit)",
          "new_api": null,
          "old_text": "deserializeBinarySSE2<4>(data, offsets, istr, limit)",
          "new_text": null,
          "old_line_content": "        deserializeBinarySSE2<4>(data, offsets, istr, limit);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 341,
          "old_api": "size",
          "new_api": null,
          "old_text": "offsets.size()",
          "new_text": null,
          "old_line_content": "                old_size = offsets.size();",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 215,
          "old_api": "deserializeBinarySSE2<3>(data, offsets, istr, limit)",
          "new_api": null,
          "old_text": "deserializeBinarySSE2<3>(data, offsets, istr, limit)",
          "new_text": null,
          "old_line_content": "        deserializeBinarySSE2<3>(data, offsets, istr, limit);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 342,
          "old_api": "end",
          "new_api": null,
          "old_text": "temp_data.end()",
          "new_text": null,
          "old_line_content": "                data.insertSmallAllowReadWriteOverflow15(temp_data.begin(), temp_data.end());",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 217,
          "old_api": "deserializeBinarySSE2<2>(data, offsets, istr, limit)",
          "new_api": null,
          "old_text": "deserializeBinarySSE2<2>(data, offsets, istr, limit)",
          "new_text": null,
          "old_line_content": "        deserializeBinarySSE2<2>(data, offsets, istr, limit);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 343,
          "old_api": "size",
          "new_api": null,
          "old_text": "data.size()",
          "new_text": null,
          "old_line_content": "                offsets.emplace_back(data.size());",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 219,
          "old_api": "deserializeBinarySSE2<1>(data, offsets, istr, limit)",
          "new_api": null,
          "old_text": "deserializeBinarySSE2<1>(data, offsets, istr, limit)",
          "new_text": null,
          "old_line_content": "        deserializeBinarySSE2<1>(data, offsets, istr, limit);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 380,
          "old_api": "registerAlias",
          "new_api": null,
          "old_text": "factory.registerAlias(\"MEDIUMTEXT\", \"String\", DataTypeFactory::CaseInsensitive)",
          "new_text": null,
          "old_line_content": "    factory.registerAlias(\"MEDIUMTEXT\", \"String\", DataTypeFactory::CaseInsensitive);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 349,
          "old_api": "resize_assume_reserved",
          "new_api": null,
          "old_text": "offsets.resize_assume_reserved(old_size)",
          "new_text": null,
          "old_line_content": "        offsets.resize_assume_reserved(old_size);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 350,
          "old_api": "back",
          "new_api": null,
          "old_text": "offsets.back()",
          "new_text": null,
          "old_line_content": "        data.resize_assume_reserved(offsets.back());",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 225,
          "old_api": "getDataAt",
          "new_api": null,
          "old_text": "static_cast<const ColumnString &>(column).getDataAt(row_num)",
          "new_text": null,
          "old_line_content": "    writeString(static_cast<const ColumnString &>(column).getDataAt(row_num), ostr);",
          "new_line_content": "static inline void read(IColumn & column, Reader && reader)",
          "content_same": false
        },
        {
          "line": 358,
          "old_api": "ColumnString::create()",
          "new_api": null,
          "old_text": "ColumnString::create()",
          "new_text": null,
          "old_line_content": "    return ColumnString::create();",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 364,
          "old_api": "typeid",
          "new_api": null,
          "old_text": "typeid(*this)",
          "new_text": null,
          "old_line_content": "    return typeid(rhs) == typeid(*this);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 238,
          "old_api": "static_cast<ColumnString &>(column)",
          "new_api": null,
          "old_text": "static_cast<ColumnString &>(column)",
          "new_text": null,
          "old_line_content": "    ColumnString & column_string = static_cast<ColumnString &>(column);",
          "new_line_content": "    catch (...)",
          "content_same": false
        },
        {
          "line": 239,
          "old_api": "getChars",
          "new_api": null,
          "old_text": "column_string.getChars()",
          "new_text": null,
          "old_line_content": "    ColumnString::Chars & data = column_string.getChars();",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 242,
          "old_api": "size",
          "new_api": null,
          "old_text": "offsets.size()",
          "new_text": null,
          "old_line_content": "    size_t old_offsets_size = offsets.size();",
          "new_line_content": "        throw;",
          "content_same": false
        },
        {
          "line": 379,
          "old_api": "registerAlias",
          "new_api": null,
          "old_text": "factory.registerAlias(\"TINYTEXT\", \"String\", DataTypeFactory::CaseInsensitive)",
          "new_text": null,
          "old_line_content": "    factory.registerAlias(\"TINYTEXT\", \"String\", DataTypeFactory::CaseInsensitive);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 245,
          "old_api": "reader",
          "new_api": null,
          "old_text": "reader(data)",
          "new_text": null,
          "old_line_content": "        reader(data);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 246,
          "old_api": "push_back",
          "new_api": null,
          "old_text": "data.push_back(0)",
          "new_text": null,
          "old_line_content": "        data.push_back(0);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 247,
          "old_api": "size",
          "new_api": null,
          "old_text": "data.size()",
          "new_text": null,
          "old_line_content": "        offsets.push_back(data.size());",
          "new_line_content": "void DataTypeString::deserializeTextEscaped(IColumn & column, ReadBuffer & istr, const FormatSettings &) const",
          "content_same": false
        },
        {
          "line": 376,
          "old_api": "registerAlias",
          "new_api": null,
          "old_text": "factory.registerAlias(\"CHAR\", \"String\", DataTypeFactory::CaseInsensitive)",
          "new_text": null,
          "old_line_content": "    factory.registerAlias(\"CHAR\", \"String\", DataTypeFactory::CaseInsensitive);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 377,
          "old_api": "registerAlias",
          "new_api": null,
          "old_text": "factory.registerAlias(\"VARCHAR\", \"String\", DataTypeFactory::CaseInsensitive)",
          "new_text": null,
          "old_line_content": "    factory.registerAlias(\"VARCHAR\", \"String\", DataTypeFactory::CaseInsensitive);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 378,
          "old_api": "registerAlias",
          "new_api": null,
          "old_text": "factory.registerAlias(\"TEXT\", \"String\", DataTypeFactory::CaseInsensitive)",
          "new_text": null,
          "old_line_content": "    factory.registerAlias(\"TEXT\", \"String\", DataTypeFactory::CaseInsensitive);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 251,
          "old_api": "resize_assume_reserved",
          "new_api": null,
          "old_text": "offsets.resize_assume_reserved(old_offsets_size)",
          "new_text": null,
          "old_line_content": "        offsets.resize_assume_reserved(old_offsets_size);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 252,
          "old_api": "resize_assume_reserved",
          "new_api": null,
          "old_text": "data.resize_assume_reserved(old_chars_size)",
          "new_text": null,
          "old_line_content": "        data.resize_assume_reserved(old_chars_size);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 381,
          "old_api": "registerAlias",
          "new_api": null,
          "old_text": "factory.registerAlias(\"LONGTEXT\", \"String\", DataTypeFactory::CaseInsensitive)",
          "new_text": null,
          "old_line_content": "    factory.registerAlias(\"LONGTEXT\", \"String\", DataTypeFactory::CaseInsensitive);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 382,
          "old_api": "registerAlias",
          "new_api": null,
          "old_text": "factory.registerAlias(\"BLOB\", \"String\", DataTypeFactory::CaseInsensitive)",
          "new_text": null,
          "old_line_content": "    factory.registerAlias(\"BLOB\", \"String\", DataTypeFactory::CaseInsensitive);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 383,
          "old_api": "registerAlias",
          "new_api": null,
          "old_text": "factory.registerAlias(\"TINYBLOB\", \"String\", DataTypeFactory::CaseInsensitive)",
          "new_text": null,
          "old_line_content": "    factory.registerAlias(\"TINYBLOB\", \"String\", DataTypeFactory::CaseInsensitive);",
          "new_line_content": "",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 13,
      "total_additions": 56,
      "total_deletions": 55,
      "total_api_changes": 124
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 14,
        "api_related_lines": 124,
        "non_api_lines": 11,
        "non_api_line_numbers": [
          133,
          143,
          145,
          149,
          151,
          152,
          153,
          154,
          156,
          157,
          158
        ]
      }
    },
    "api_calls_before": 149,
    "api_calls_after": 151,
    "diff_info": {
      "added_lines": 3,
      "removed_lines": 14,
      "total_diff_lines": 39
    }
  }
}