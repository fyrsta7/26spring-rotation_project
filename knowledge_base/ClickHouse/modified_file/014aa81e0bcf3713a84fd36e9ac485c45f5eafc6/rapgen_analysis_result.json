{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ClickHouse/modified_file/014aa81e0bcf3713a84fd36e9ac485c45f5eafc6",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ClickHouse/modified_file/014aa81e0bcf3713a84fd36e9ac485c45f5eafc6/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ClickHouse/modified_file/014aa81e0bcf3713a84fd36e9ac485c45f5eafc6/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ClickHouse/modified_file/014aa81e0bcf3713a84fd36e9ac485c45f5eafc6/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 97,
          "old_api": "constexpr",
          "new_api": "FieldVisitorToString",
          "old_text": "constexpr",
          "new_text": "FieldVisitorToString()",
          "old_line_content": "    constexpr auto min_elements_for_hashing = 100;",
          "new_line_content": "            String column_name = applyVisitor(FieldVisitorToString(), value);",
          "content_same": false
        },
        {
          "line": 110,
          "old_api": "writeText",
          "new_api": "getType",
          "old_text": "writeText(low, ostr)",
          "new_text": "value.getType()",
          "old_line_content": "        writeText(low, ostr);",
          "new_line_content": "    auto type = value.getType();",
          "content_same": false
        },
        {
          "line": 111,
          "old_api": "write",
          "new_api": "size",
          "old_text": "ostr.write('_')",
          "new_text": "value.get<const Array &>().size()",
          "old_line_content": "        ostr.write('_');",
          "new_line_content": "    if ((type == Field::Types::Array && value.get<const Array &>().size() > min_elements_for_hashing))",
          "content_same": false
        },
        {
          "line": 116,
          "old_api": "FieldVisitorToColumnName",
          "new_api": "get128",
          "old_text": "FieldVisitorToColumnName()",
          "new_text": "hash.get128(low, high)",
          "old_line_content": "        String column_name = applyVisitor(FieldVisitorToColumnName(), value);",
          "new_line_content": "        hash.get128(low, high);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 98,
          "old_api": null,
          "new_api": "writeString",
          "old_text": null,
          "new_text": "writeString(column_name, ostr)",
          "old_line_content": "",
          "new_line_content": "            writeString(column_name, ostr);",
          "content_same": false
        },
        {
          "line": 132,
          "old_api": null,
          "new_api": "FieldVisitorToString",
          "old_text": null,
          "new_text": "FieldVisitorToString()",
          "old_line_content": "",
          "new_line_content": "    settings.ostr << applyVisitor(FieldVisitorToString(), value);",
          "content_same": false
        },
        {
          "line": 106,
          "old_api": null,
          "new_api": "constexpr",
          "old_text": null,
          "new_text": "constexpr",
          "old_line_content": "        UInt64 low, high;",
          "new_line_content": "    constexpr auto min_elements_for_hashing = 100;",
          "content_same": false
        },
        {
          "line": 114,
          "old_api": null,
          "new_api": "FieldVisitorHash",
          "old_text": null,
          "new_text": "FieldVisitorHash(hash)",
          "old_line_content": "    else",
          "new_line_content": "        applyVisitor(FieldVisitorHash(hash), value);",
          "content_same": false
        },
        {
          "line": 125,
          "old_api": null,
          "new_api": "FieldVisitorToColumnName",
          "old_text": null,
          "new_text": "FieldVisitorToColumnName()",
          "old_line_content": "",
          "new_line_content": "        String column_name = applyVisitor(FieldVisitorToColumnName(), value);",
          "content_same": false
        },
        {
          "line": 118,
          "old_api": null,
          "new_api": "writeCString",
          "old_text": null,
          "new_text": "writeCString(\"__array_\", ostr)",
          "old_line_content": "    }",
          "new_line_content": "        writeCString(\"__array_\", ostr);",
          "content_same": false
        },
        {
          "line": 119,
          "old_api": null,
          "new_api": "writeText",
          "old_text": null,
          "new_text": "writeText(low, ostr)",
          "old_line_content": "}",
          "new_line_content": "        writeText(low, ostr);",
          "content_same": false
        },
        {
          "line": 120,
          "old_api": null,
          "new_api": "write",
          "old_text": null,
          "new_text": "ostr.write('_')",
          "old_line_content": "",
          "new_line_content": "        ostr.write('_');",
          "content_same": false
        },
        {
          "line": 121,
          "old_api": null,
          "new_api": "writeText",
          "old_text": null,
          "new_text": "writeText(high, ostr)",
          "old_line_content": "void ASTLiteral::formatImplWithoutAlias(const FormatSettings & settings, IAST::FormatState &, IAST::FormatStateStacked) const",
          "new_line_content": "        writeText(high, ostr);",
          "content_same": false
        },
        {
          "line": 91,
          "old_api": null,
          "new_api": "getType",
          "old_text": null,
          "new_text": "value.getType()",
          "old_line_content": "    }",
          "new_line_content": "        if (value.getType() == Field::Types::String)",
          "content_same": false
        },
        {
          "line": 93,
          "old_api": null,
          "new_api": "value.get<String>()",
          "old_text": null,
          "new_text": "value.get<String>()",
          "old_line_content": "",
          "new_line_content": "            writeQuoted(value.get<String>(), ostr);",
          "content_same": false
        },
        {
          "line": 126,
          "old_api": null,
          "new_api": "writeString",
          "old_text": null,
          "new_text": "writeString(column_name, ostr)",
          "old_line_content": "}",
          "new_line_content": "        writeString(column_name, ostr);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 101,
          "old_api": "getType",
          "new_api": null,
          "old_text": "value.getType()",
          "new_text": null,
          "old_line_content": "    auto type = value.getType();",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 102,
          "old_api": "size",
          "new_api": null,
          "old_text": "value.get<const Array &>().size()",
          "new_text": null,
          "old_line_content": "    if ((type == Field::Types::Array && value.get<const Array &>().size() > min_elements_for_hashing))",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 105,
          "old_api": "FieldVisitorHash",
          "new_api": null,
          "old_text": "FieldVisitorHash(hash)",
          "new_text": null,
          "old_line_content": "        applyVisitor(FieldVisitorHash(hash), value);",
          "new_line_content": "     /// 100 - just arbitrary value.",
          "content_same": false
        },
        {
          "line": 107,
          "old_api": "get128",
          "new_api": null,
          "old_text": "hash.get128(low, high)",
          "new_text": null,
          "old_line_content": "        hash.get128(low, high);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 109,
          "old_api": "writeCString",
          "new_api": null,
          "old_text": "writeCString(\"__array_\", ostr)",
          "new_text": null,
          "old_line_content": "        writeCString(\"__array_\", ostr);",
          "new_line_content": "    /// (Otherwise column name will be too long, that will lead to significant slowdown of expression analysis.)",
          "content_same": false
        },
        {
          "line": 112,
          "old_api": "writeText",
          "new_api": null,
          "old_text": "writeText(high, ostr)",
          "new_text": null,
          "old_line_content": "        writeText(high, ostr);",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 117,
          "old_api": "writeString",
          "new_api": null,
          "old_text": "writeString(column_name, ostr)",
          "new_text": null,
          "old_line_content": "        writeString(column_name, ostr);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 89,
          "old_api": "FieldVisitorToString",
          "new_api": null,
          "old_text": "FieldVisitorToString()",
          "new_text": null,
          "old_line_content": "        String column_name = applyVisitor(FieldVisitorToString(), value);",
          "new_line_content": "        /// Special case for huge AST. The `FieldVisitorToString` becomes expensive",
          "content_same": false
        },
        {
          "line": 90,
          "old_api": "writeString",
          "new_api": null,
          "old_text": "writeString(column_name, ostr)",
          "new_text": null,
          "old_line_content": "        writeString(column_name, ostr);",
          "new_line_content": "        /// for tons of literals.",
          "content_same": false
        },
        {
          "line": 123,
          "old_api": "FieldVisitorToString",
          "new_api": null,
          "old_text": "FieldVisitorToString()",
          "new_text": null,
          "old_line_content": "    settings.ostr << applyVisitor(FieldVisitorToString(), value);",
          "new_line_content": "    else",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 4,
      "total_additions": 12,
      "total_deletions": 10,
      "total_api_changes": 26
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 11,
        "api_related_lines": 26,
        "non_api_lines": 5,
        "non_api_line_numbers": [
          96,
          99,
          92,
          94,
          95
        ]
      }
    },
    "api_calls_before": 44,
    "api_calls_after": 47,
    "diff_info": {
      "added_lines": 11,
      "removed_lines": 2,
      "total_diff_lines": 25
    }
  }
}