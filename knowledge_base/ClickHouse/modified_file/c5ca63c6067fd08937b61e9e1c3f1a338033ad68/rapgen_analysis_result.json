{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ClickHouse/modified_file/c5ca63c6067fd08937b61e9e1c3f1a338033ad68",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ClickHouse/modified_file/c5ca63c6067fd08937b61e9e1c3f1a338033ad68/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ClickHouse/modified_file/c5ca63c6067fd08937b61e9e1c3f1a338033ad68/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ClickHouse/modified_file/c5ca63c6067fd08937b61e9e1c3f1a338033ad68/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 491,
          "old_api": "unlikely",
          "new_api": "wildCopy<copy_amount>(op, ip, copy_end)",
          "old_text": "unlikely(ip + 1 >= input_end)",
          "new_text": "wildCopy<copy_amount>(op, ip, copy_end)",
          "old_line_content": "        if (unlikely(ip + 1 >= input_end))",
          "new_line_content": "        wildCopy<copy_amount>(op, ip, copy_end);    /// Here we can write up to copy_amount - 1 bytes after buffer.",
          "content_same": false
        },
        {
          "line": 588,
          "old_api": "stop",
          "new_api": "decompressImpl<16, true>(source, dest, source_size, dest_size)",
          "old_text": "watch.stop()",
          "new_text": "decompressImpl<16, true>(source, dest, source_size, dest_size)",
          "old_line_content": "        watch.stop();",
          "new_line_content": "            success = decompressImpl<16, true>(source, dest, source_size, dest_size);",
          "content_same": false
        },
        {
          "line": 592,
          "old_api": "elapsedSeconds",
          "new_api": "decompressImpl<8, true>(source, dest, source_size, dest_size)",
          "old_text": "watch.elapsedSeconds()",
          "new_text": "decompressImpl<8, true>(source, dest, source_size, dest_size)",
          "old_line_content": "        statistics.data[best_variant].update(watch.elapsedSeconds(), dest_size);",
          "new_line_content": "            success = decompressImpl<8, true>(source, dest, source_size, dest_size);",
          "content_same": false
        },
        {
          "line": 660,
          "old_api": "literal",
          "new_api": "unlikely",
          "old_text": "stat.literal(length)",
          "new_text": "unlikely(s == 255)",
          "old_line_content": "        stat.literal(length);",
          "new_line_content": "            } while (unlikely(s == 255));",
          "content_same": false
        },
        {
          "line": 668,
          "old_api": "unalignedLoad<UInt16>(ip)",
          "new_api": "literal",
          "old_text": "unalignedLoad<UInt16>(ip)",
          "new_text": "stat.literal(length)",
          "old_line_content": "        size_t offset = unalignedLoad<UInt16>(ip);",
          "new_line_content": "        stat.literal(length);",
          "content_same": false
        },
        {
          "line": 676,
          "old_api": "match",
          "new_api": "unalignedLoad<UInt16>(ip)",
          "old_text": "stat.match(length, offset)",
          "new_text": "unalignedLoad<UInt16>(ip)",
          "old_line_content": "        stat.match(length, offset);",
          "new_line_content": "        size_t offset = unalignedLoad<UInt16>(ip);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 516,
          "old_api": null,
          "new_api": "unlikely",
          "old_text": null,
          "new_text": "unlikely(ip + 1 >= input_end)",
          "old_line_content": "        copy_end = op + length;",
          "new_line_content": "            if (unlikely(ip + 1 >= input_end))",
          "content_same": false
        },
        {
          "line": 518,
          "old_api": null,
          "new_api": "continue_read_length",
          "old_text": null,
          "new_text": "continue_read_length()",
          "old_line_content": "        /** Here we can write up to copy_amount - 1 - 4 * 2 bytes after buffer.",
          "new_line_content": "            continue_read_length();",
          "content_same": false
        },
        {
          "line": 646,
          "old_api": null,
          "new_api": "reinterpret_cast<const UInt8 *>(source)",
          "old_text": null,
          "new_text": "reinterpret_cast<const UInt8 *>(source)",
          "old_line_content": "        {",
          "new_line_content": "    const UInt8 * ip = reinterpret_cast<const UInt8 *>(source);",
          "content_same": false
        },
        {
          "line": 647,
          "old_api": null,
          "new_api": "reinterpret_cast<UInt8 *>(dest)",
          "old_text": null,
          "new_text": "reinterpret_cast<UInt8 *>(dest)",
          "old_line_content": "            unsigned s;",
          "new_line_content": "    UInt8 * op = reinterpret_cast<UInt8 *>(dest);",
          "content_same": false
        },
        {
          "line": 530,
          "old_api": null,
          "new_api": "unlikely",
          "old_text": null,
          "new_text": "unlikely(offset < copy_amount)",
          "old_line_content": "            ///              [------] - copy them here",
          "new_line_content": "        if (unlikely(offset < copy_amount))",
          "content_same": false
        },
        {
          "line": 666,
          "old_api": null,
          "new_api": "continue_read_length",
          "old_text": null,
          "new_text": "continue_read_length()",
          "old_line_content": "            return;",
          "new_line_content": "            continue_read_length();",
          "content_same": false
        },
        {
          "line": 543,
          "old_api": null,
          "new_api": "copyOverlap<copy_amount, use_shuffle>(op, match, offset)",
          "old_text": null,
          "new_text": "copyOverlap<copy_amount, use_shuffle>(op, match, offset)",
          "old_line_content": "        op += copy_amount;",
          "new_line_content": "            copyOverlap<copy_amount, use_shuffle>(op, match, offset);",
          "content_same": false
        },
        {
          "line": 547,
          "old_api": null,
          "new_api": "copy<copy_amount>(op, match)",
          "old_text": null,
          "new_text": "copy<copy_amount>(op, match)",
          "old_line_content": "        {",
          "new_line_content": "            copy<copy_amount>(op, match);",
          "content_same": false
        },
        {
          "line": 553,
          "old_api": null,
          "new_api": "copy<copy_amount>(op, match)",
          "old_text": null,
          "new_text": "copy<copy_amount>(op, match)",
          "old_line_content": "        op = copy_end;",
          "new_line_content": "        copy<copy_amount>(op, match);   /// copy_amount + copy_amount - 1 - 4 * 2 bytes after buffer.",
          "content_same": false
        },
        {
          "line": 681,
          "old_api": null,
          "new_api": "continue_read_length",
          "old_text": null,
          "new_text": "continue_read_length()",
          "old_line_content": "",
          "new_line_content": "            continue_read_length();",
          "content_same": false
        },
        {
          "line": 556,
          "old_api": null,
          "new_api": "unlikely",
          "old_text": null,
          "new_text": "unlikely(copy_end > output_end)",
          "old_line_content": "",
          "new_line_content": "            if (unlikely(copy_end > output_end))",
          "content_same": false
        },
        {
          "line": 684,
          "old_api": null,
          "new_api": "match",
          "old_text": null,
          "new_text": "stat.match(length, offset)",
          "old_line_content": "",
          "new_line_content": "        stat.match(length, offset);",
          "content_same": false
        },
        {
          "line": 558,
          "old_api": null,
          "new_api": "wildCopy<copy_amount>(op + copy_amount, match + copy_amount, copy_end)",
          "old_text": null,
          "new_text": "wildCopy<copy_amount>(op + copy_amount, match + copy_amount, copy_end)",
          "old_line_content": "",
          "new_line_content": "            wildCopy<copy_amount>(op + copy_amount, match + copy_amount, copy_end);",
          "content_same": false
        },
        {
          "line": 581,
          "old_api": null,
          "new_api": "select",
          "old_text": null,
          "new_text": "statistics.select()",
          "old_line_content": "        if (best_variant == 1)",
          "new_line_content": "        size_t best_variant = statistics.select();",
          "content_same": false
        },
        {
          "line": 590,
          "old_api": null,
          "new_api": "decompressImpl<16, false>(source, dest, source_size, dest_size)",
          "old_text": null,
          "new_text": "decompressImpl<16, false>(source, dest, source_size, dest_size)",
          "old_line_content": "        /// Update performance statistics.",
          "new_line_content": "            success = decompressImpl<16, false>(source, dest, source_size, dest_size);",
          "content_same": false
        },
        {
          "line": 594,
          "old_api": null,
          "new_api": "decompressImpl<32, false>(source, dest, source_size, dest_size)",
          "old_text": null,
          "new_text": "decompressImpl<32, false>(source, dest, source_size, dest_size)",
          "old_line_content": "        return success;",
          "new_line_content": "            success = decompressImpl<32, false>(source, dest, source_size, dest_size);",
          "content_same": false
        },
        {
          "line": 596,
          "old_api": null,
          "new_api": "stop",
          "old_text": null,
          "new_text": "watch.stop()",
          "old_line_content": "    else",
          "new_line_content": "        watch.stop();",
          "content_same": false
        },
        {
          "line": 600,
          "old_api": null,
          "new_api": "elapsedSeconds",
          "old_text": null,
          "new_text": "watch.elapsedSeconds()",
          "old_line_content": "}",
          "new_line_content": "        statistics.data[best_variant].update(watch.elapsedSeconds(), dest_size);",
          "content_same": false
        },
        {
          "line": 606,
          "old_api": null,
          "new_api": "decompressImpl<8, false>(source, dest, source_size, dest_size)",
          "old_text": null,
          "new_text": "decompressImpl<8, false>(source, dest, source_size, dest_size)",
          "old_line_content": "    sum_literal_lengths += length;",
          "new_line_content": "        return decompressImpl<8, false>(source, dest, source_size, dest_size);",
          "content_same": false
        },
        {
          "line": 486,
          "old_api": null,
          "new_api": "std::runtime_error(\"Compile error!\")",
          "old_text": null,
          "new_text": "std::runtime_error(\"Compile error!\")",
          "old_line_content": "            return true;",
          "new_line_content": "            throw std::runtime_error(\"Compile error!\");",
          "content_same": false
        },
        {
          "line": 488,
          "old_api": null,
          "new_api": "unlikely",
          "old_text": null,
          "new_text": "unlikely(ip + real_length >= input_end + ADDITIONAL_BYTES_AT_END_OF_BUFFER)",
          "old_line_content": "        ip += length;",
          "new_line_content": "        if (unlikely(ip + real_length >= input_end + ADDITIONAL_BYTES_AT_END_OF_BUFFER))",
          "content_same": false
        },
        {
          "line": 499,
          "old_api": null,
          "new_api": "unlikely",
          "old_text": null,
          "new_text": "unlikely(ip + 1 >= input_end)",
          "old_line_content": "",
          "new_line_content": "        if (unlikely(ip + 1 >= input_end))",
          "content_same": false
        },
        {
          "line": 504,
          "old_api": null,
          "new_api": "unalignedLoad<UInt16>(ip)",
          "old_text": null,
          "new_text": "unalignedLoad<UInt16>(ip)",
          "old_line_content": "",
          "new_line_content": "        size_t offset = unalignedLoad<UInt16>(ip);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 510,
          "old_api": "continue_read_length",
          "new_api": null,
          "old_text": "continue_read_length()",
          "new_text": null,
          "old_line_content": "            continue_read_length();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 522,
          "old_api": "unlikely",
          "new_api": null,
          "old_text": "unlikely(offset < copy_amount)",
          "new_text": null,
          "old_line_content": "        if (unlikely(offset < copy_amount))",
          "new_line_content": "        /// Copy match within block, that produce overlapping pattern. Match may replicate itself.",
          "content_same": false
        },
        {
          "line": 652,
          "old_api": "unlikely",
          "new_api": null,
          "old_text": "unlikely(s == 255)",
          "new_text": null,
          "old_line_content": "            } while (unlikely(s == 255));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 658,
          "old_api": "continue_read_length",
          "new_api": null,
          "old_text": "continue_read_length()",
          "new_text": null,
          "old_line_content": "            continue_read_length();",
          "new_line_content": "                s = *ip++;",
          "content_same": false
        },
        {
          "line": 535,
          "old_api": "copyOverlap<copy_amount, use_shuffle>(op, match, offset)",
          "new_api": null,
          "old_text": "copyOverlap<copy_amount, use_shuffle>(op, match, offset)",
          "new_text": null,
          "old_line_content": "            copyOverlap<copy_amount, use_shuffle>(op, match, offset);",
          "new_line_content": "            ///",
          "content_same": false
        },
        {
          "line": 539,
          "old_api": "copy<copy_amount>(op, match)",
          "new_api": null,
          "old_text": "copy<copy_amount>(op, match)",
          "new_text": null,
          "old_line_content": "            copy<copy_amount>(op, match);",
          "new_line_content": "            ///",
          "content_same": false
        },
        {
          "line": 545,
          "old_api": "copy<copy_amount>(op, match)",
          "new_api": null,
          "old_text": "copy<copy_amount>(op, match)",
          "new_text": null,
          "old_line_content": "        copy<copy_amount>(op, match);   /// copy_amount + copy_amount - 1 - 4 * 2 bytes after buffer.",
          "new_line_content": "        else",
          "content_same": false
        },
        {
          "line": 673,
          "old_api": "continue_read_length",
          "new_api": null,
          "old_text": "continue_read_length()",
          "new_text": null,
          "old_line_content": "            continue_read_length();",
          "new_line_content": "        if (op > output_end)",
          "content_same": false
        },
        {
          "line": 548,
          "old_api": "unlikely",
          "new_api": null,
          "old_text": "unlikely(copy_end > output_end)",
          "new_text": null,
          "old_line_content": "            if (unlikely(copy_end > output_end))",
          "new_line_content": "            match += copy_amount;",
          "content_same": false
        },
        {
          "line": 550,
          "old_api": "wildCopy<copy_amount>(op + copy_amount, match + copy_amount, copy_end)",
          "new_api": null,
          "old_text": "wildCopy<copy_amount>(op + copy_amount, match + copy_amount, copy_end)",
          "new_text": null,
          "old_line_content": "            wildCopy<copy_amount>(op + copy_amount, match + copy_amount, copy_end);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 573,
          "old_api": "select",
          "new_api": null,
          "old_text": "statistics.select()",
          "new_text": null,
          "old_line_content": "        size_t best_variant = statistics.select();",
          "new_line_content": "    PerformanceStatistics & statistics [[maybe_unused]])",
          "content_same": false
        },
        {
          "line": 580,
          "old_api": "decompressImpl<16, true>(source, dest, source_size, dest_size)",
          "new_api": null,
          "old_text": "decompressImpl<16, true>(source, dest, source_size, dest_size)",
          "new_text": null,
          "old_line_content": "            success = decompressImpl<16, true>(source, dest, source_size, dest_size);",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 582,
          "old_api": "decompressImpl<16, false>(source, dest, source_size, dest_size)",
          "new_api": null,
          "old_text": "decompressImpl<16, false>(source, dest, source_size, dest_size)",
          "new_text": null,
          "old_line_content": "            success = decompressImpl<16, false>(source, dest, source_size, dest_size);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 584,
          "old_api": "decompressImpl<8, true>(source, dest, source_size, dest_size)",
          "new_api": null,
          "old_text": "decompressImpl<8, true>(source, dest, source_size, dest_size)",
          "new_text": null,
          "old_line_content": "            success = decompressImpl<8, true>(source, dest, source_size, dest_size);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 586,
          "old_api": "decompressImpl<32, false>(source, dest, source_size, dest_size)",
          "new_api": null,
          "old_text": "decompressImpl<32, false>(source, dest, source_size, dest_size)",
          "new_text": null,
          "old_line_content": "            success = decompressImpl<32, false>(source, dest, source_size, dest_size);",
          "new_line_content": "        bool success = true;",
          "content_same": false
        },
        {
          "line": 598,
          "old_api": "decompressImpl<8, false>(source, dest, source_size, dest_size)",
          "new_api": null,
          "old_text": "decompressImpl<8, false>(source, dest, source_size, dest_size)",
          "new_text": null,
          "old_line_content": "        return decompressImpl<8, false>(source, dest, source_size, dest_size);",
          "new_line_content": "        /// Update performance statistics.",
          "content_same": false
        },
        {
          "line": 478,
          "old_api": "static_cast<double>(length)",
          "new_api": null,
          "old_text": "static_cast<double>(length)",
          "new_text": null,
          "old_line_content": "        const size_t real_length = std::max(copy_amount, static_cast<size_t>(std::ceil(static_cast<double>(length) / copy_amount) * copy_amount));",
          "new_line_content": "        size_t real_length = 0;",
          "content_same": false
        },
        {
          "line": 480,
          "old_api": "unlikely",
          "new_api": null,
          "old_text": "unlikely(ip + real_length >= input_end + ADDITIONAL_BYTES_AT_END_OF_BUFFER)",
          "new_text": null,
          "old_line_content": "        if (unlikely(ip + real_length >= input_end + ADDITIONAL_BYTES_AT_END_OF_BUFFER))",
          "new_line_content": "            real_length = (((length >> 3) + 1) * 8);",
          "content_same": false
        },
        {
          "line": 483,
          "old_api": "wildCopy<copy_amount>(op, ip, copy_end)",
          "new_api": null,
          "old_text": "wildCopy<copy_amount>(op, ip, copy_end)",
          "new_text": null,
          "old_line_content": "        wildCopy<copy_amount>(op, ip, copy_end);    /// Here we can write up to copy_amount - 1 bytes after buffer.",
          "new_line_content": "        else if constexpr (copy_amount == 32)",
          "content_same": false
        },
        {
          "line": 496,
          "old_api": "unalignedLoad<UInt16>(ip)",
          "new_api": null,
          "old_text": "unalignedLoad<UInt16>(ip)",
          "new_text": null,
          "old_line_content": "        size_t offset = unalignedLoad<UInt16>(ip);",
          "new_line_content": "        ip += length;",
          "content_same": false
        },
        {
          "line": 500,
          "old_api": "unlikely",
          "new_api": null,
          "old_text": "unlikely(match < output_begin)",
          "new_text": null,
          "old_line_content": "        if (unlikely(match < output_begin))",
          "new_line_content": "            return false;",
          "content_same": false
        },
        {
          "line": 638,
          "old_api": "reinterpret_cast<const UInt8 *>(source)",
          "new_api": null,
          "old_text": "reinterpret_cast<const UInt8 *>(source)",
          "new_text": null,
          "old_line_content": "    const UInt8 * ip = reinterpret_cast<const UInt8 *>(source);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 639,
          "old_api": "reinterpret_cast<UInt8 *>(dest)",
          "new_api": null,
          "old_text": "reinterpret_cast<UInt8 *>(dest)",
          "new_text": null,
          "old_line_content": "    UInt8 * op = reinterpret_cast<UInt8 *>(dest);",
          "new_line_content": "",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 6,
      "total_additions": 23,
      "total_deletions": 23,
      "total_api_changes": 52
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 9,
        "api_related_lines": 52,
        "non_api_lines": 5,
        "non_api_line_numbers": [
          481,
          482,
          484,
          485,
          479
        ]
      }
    },
    "api_calls_before": 129,
    "api_calls_after": 126,
    "diff_info": {
      "added_lines": 9,
      "removed_lines": 1,
      "total_diff_lines": 22
    }
  }
}