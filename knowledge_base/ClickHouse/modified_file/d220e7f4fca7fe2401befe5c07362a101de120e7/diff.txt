diff --git a/src/Common/StringSearcher.h b/src/Common/StringSearcher.h
index a2acea1ca39..451b8cae0a1 100644
--- a/src/Common/StringSearcher.h
+++ b/src/Common/StringSearcher.h
@@ -703,7 +703,7 @@ public:
         }
 #endif
 
-        while (haystack < haystack_end)
+        while (haystack < haystack_end && haystack_end - haystack >= needle_end - needle)
         {
 #ifdef __SSE4_1__
             /// find first and second characters
