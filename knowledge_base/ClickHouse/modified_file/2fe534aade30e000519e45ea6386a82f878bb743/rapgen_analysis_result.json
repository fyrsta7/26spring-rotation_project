{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ClickHouse/modified_file/2fe534aade30e000519e45ea6386a82f878bb743",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ClickHouse/modified_file/2fe534aade30e000519e45ea6386a82f878bb743/before.h",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ClickHouse/modified_file/2fe534aade30e000519e45ea6386a82f878bb743/after.h",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ClickHouse/modified_file/2fe534aade30e000519e45ea6386a82f878bb743/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 223,
          "old_api": "= &data[0];\n\n\t\twhile",
          "new_api": "= &data[0];\n\n\t\tconst",
          "old_text": " = &data[0];\n\n\t\twhile ",
          "new_text": " = &data[0];\n\n\t\tconst ",
          "old_line_content": null,
          "new_line_content": "\t\tres_data.reserve(size);",
          "content_same": true
        },
        {
          "line": 279,
          "old_api": "lf::Contain",
          "new_api": "nPtr res = res_;\n\t\tty",
          "old_text": "lf::Contain",
          "new_text": "nPtr res = res_;\n\t\tty",
          "old_line_content": "\t\tif (perm.size() < limit)",
          "new_line_content": "\t\t\tlimit = std::min(size, limit);",
          "content_same": false
        },
        {
          "line": 295,
          "old_api": "name NearestFieldType<T>::Type(0);\n\t\t\tmax = typename NearestFieldType<T>::Type(0);\n\t\t\treturn;\n\t\t}",
          "new_api": "e = data.si",
          "old_text": "name NearestFieldType<T>::Type(0);\n\t\t\tmax = typename NearestFieldType<T>::Type(0);\n\t\t\treturn;\n\t\t}\n\n\t\t",
          "new_text": "e = data.si",
          "old_line_content": "\t\t\tthrow Exception(\"Size of offsets doesn't match size of column.\", ErrorCodes::SIZES_OF_COLUMNS_DOESNT_MATCH);",
          "new_line_content": "\t\tsize_t size = data.size();",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 263,
          "old_api": null,
          "new_api": "IColumn::Offsets_t & offsets",
          "old_text": null,
          "new_text": " IColumn::Offsets_t & offsets",
          "old_line_content": "\t\t\t++filt_pos;",
          "new_line_content": "\t\t\t\tres_data.push_back(*data_pos);",
          "content_same": false
        },
        {
          "line": 274,
          "old_api": null,
          "new_api": ":SIZES_OF_C",
          "old_text": null,
          "new_text": ":SIZES_OF_C",
          "old_line_content": "\t\tif (limit == 0)",
          "new_line_content": "\t\tsize_t size = data.size();",
          "content_same": false
        },
        {
          "line": 281,
          "old_api": null,
          "new_api": "lf::Contain",
          "old_text": null,
          "new_text": "lf::Contain",
          "old_line_content": "",
          "new_line_content": "\t\tif (perm.size() < limit)",
          "content_same": false
        },
        {
          "line": 282,
          "old_api": null,
          "new_api": "reserve",
          "old_text": null,
          "new_text": "es_->getData();\n\t\tres_data.reserve(offsets.back());\n\n\t\tIColumn::Offset_t prev_offset = 0;\n\t\tfor (s",
          "old_line_content": "\t\tSelf * res_ = new Self(limit);",
          "new_line_content": "\t\t\tthrow Exception(\"Size of permutation is less than required.\", ErrorCodes::SIZES_OF_COLUMNS_DOESNT_MATCH);",
          "content_same": false
        },
        {
          "line": 286,
          "old_api": null,
          "new_api": "= offsets[i];",
          "old_text": null,
          "new_text": " = offsets[i];\n",
          "old_line_content": "\t\t\tres_data[i] = data[perm[i]];",
          "new_line_content": "\t\ttypename Self::Container_t & res_data = res_->getData();",
          "content_same": false
        },
        {
          "line": 296,
          "old_api": null,
          "new_api": "e == 0)\n\t\t{",
          "old_text": null,
          "new_text": "e == 0)\n\t\t{\n\t\t",
          "old_line_content": "",
          "new_line_content": "\t\tif (size != offsets.size())",
          "content_same": false
        },
        {
          "line": 297,
          "old_api": null,
          "new_api": "name NearestFieldType<T>::Type(0);\n\t\t\tmax = typename NearestFieldType<T>::Type(0);\n\t\t\treturn;\n\t\t}",
          "old_text": null,
          "new_text": "name NearestFieldType<T>::Type(0);\n\t\t\tmax = typename NearestFieldType<T>::Type(0);\n\t\t\treturn;\n\t\t}\n\n\t\t",
          "old_line_content": "\t\tSelf * res_ = new Self;",
          "new_line_content": "\t\t\tthrow Exception(\"Size of offsets doesn't match size of column.\", ErrorCodes::SIZES_OF_COLUMNS_DOESNT_MATCH);",
          "content_same": false
        },
        {
          "line": 301,
          "old_api": null,
          "new_api": "a[i] < cur_min)",
          "old_text": null,
          "new_text": "a[i] < cur_min)",
          "old_line_content": "",
          "new_line_content": "\t\ttypename Self::Container_t & res_data = res_->getData();",
          "content_same": false
        },
        {
          "line": 302,
          "old_api": null,
          "new_api": "];\n\n\t\t\tif (dat",
          "old_text": null,
          "new_text": "];\n\n\t\t\tif (dat",
          "old_line_content": "\t\tIColumn::Offset_t prev_offset = 0;",
          "new_line_content": "\t\tres_data.reserve(offsets.back());",
          "content_same": false
        },
        {
          "line": 311,
          "old_api": null,
          "new_api": "()\n\t{\n\t\treturn data;\n\t}\n\n\tc",
          "old_text": null,
          "new_text": "()\n\t{\n\t\treturn data;\n\t}\n\n\tc",
          "old_line_content": "",
          "new_line_content": "\t\t\t\tres_data.push_back(data[i]);",
          "content_same": false
        },
        {
          "line": 319,
          "old_api": null,
          "new_api": "mplate <typ",
          "old_text": null,
          "new_text": "mplate <typ",
          "old_line_content": "\t\tif (size == 0)",
          "new_line_content": "\t\tsize_t size = data.size();",
          "content_same": false
        },
        {
          "line": 323,
          "old_api": null,
          "new_api": "e_t n) const\n{\n\treturn data[",
          "old_text": null,
          "new_text": "e_t n) const\n{\n\treturn data[",
          "old_line_content": "\t\t\treturn;",
          "new_line_content": "\t\t\tmin = typename NearestFieldType<T>::Type(0);",
          "content_same": false
        },
        {
          "line": 324,
          "old_api": null,
          "new_api": "nline UInt64 ColumnVector<Fl",
          "old_text": null,
          "new_text": "nline UInt64 ColumnVector<Fl",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\t\tmax = typename NearestFieldType<T>::Type(0);",
          "content_same": false
        },
        {
          "line": 340,
          "old_api": null,
          "new_api": "res = 0;\n\tsrc = data[n];\n\treturn r",
          "old_text": null,
          "new_text": "res = 0;\n\tsrc = data[n];\n\treturn r",
          "old_line_content": "\t}",
          "new_line_content": "\t\tmin = typename NearestFieldType<T>::Type(cur_min);",
          "content_same": false
        },
        {
          "line": 341,
          "old_api": null,
          "new_api": "",
          "old_text": null,
          "new_text": "",
          "old_line_content": "",
          "new_line_content": "\t\tmax = typename NearestFieldType<T>::Type(cur_max);",
          "content_same": false
        },
        {
          "line": 235,
          "old_api": null,
          "new_api": "eturn res;\n\t}",
          "old_text": null,
          "new_text": "eturn res;\n\t}\n\n\t",
          "old_line_content": "\t\twhile (filt_pos < filt_end_sse)",
          "new_line_content": "\t\tconst __m128i zero16 = _mm_set1_epi8(0);",
          "content_same": false
        },
        {
          "line": 239,
          "old_api": null,
          "new_api": "if (limit == 0)\n\t\t\tlimit = size;\n\t\telse",
          "old_text": null,
          "new_text": "\n\n\t\tif (limit == 0)\n\t\t\tlimit = size;\n\t\telse",
          "old_line_content": "\t\t\tif (0 == mask)",
          "new_line_content": "\t\t\tint mask = _mm_movemask_epi8(_mm_cmpgt_epi8(_mm_loadu_si128(reinterpret_cast<const __m128i *>(filt_pos)), zero16));",
          "content_same": false
        },
        {
          "line": 247,
          "old_api": null,
          "new_api": "\", ErrorCodes::SIZES_OF_COLUMNS_DOESNT_MATCH);\n\n\t\tSelf *",
          "old_text": null,
          "new_text": "\", ErrorCodes::SIZES_OF_COLUMNS_DOESNT_MATCH);\n\n\t\tSelf *",
          "old_line_content": "\t\t\telse",
          "new_line_content": "\t\t\t\tres_data.insert_assume_reserved(data_pos, data_pos + 16);",
          "content_same": false
        },
        {
          "line": 253,
          "old_api": null,
          "new_api": "getData",
          "old_text": null,
          "new_text": "data = res_->getData();\n\t\tfor (",
          "old_line_content": "",
          "new_line_content": "\t\t\t\t\t\tres_data.push_back(data_pos[i]);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 321,
          "old_api": "e_t n) const\n{\n\treturn data[",
          "new_api": null,
          "old_text": "e_t n) const\n{\n\treturn data[",
          "new_text": null,
          "old_line_content": "\t\t\tmin = typename NearestFieldType<T>::Type(0);",
          "new_line_content": "\t\tif (size == 0)",
          "content_same": false
        },
        {
          "line": 322,
          "old_api": "nline UInt64 ColumnVector<Fl",
          "new_api": null,
          "old_text": "nline UInt64 ColumnVector<Fl",
          "new_text": null,
          "old_line_content": "\t\t\tmax = typename NearestFieldType<T>::Type(0);",
          "new_line_content": "\t\t{",
          "content_same": false
        },
        {
          "line": 261,
          "old_api": "IColumn::Offsets_t & offsets",
          "new_api": null,
          "old_text": " IColumn::Offsets_t & offsets",
          "new_text": null,
          "old_line_content": "\t\t\t\tres_data.push_back(*data_pos);",
          "new_line_content": "\t\t{",
          "content_same": false
        },
        {
          "line": 293,
          "old_api": "e = data.si",
          "new_api": null,
          "old_text": "e = data.si",
          "new_text": null,
          "old_line_content": "\t\tsize_t size = data.size();",
          "new_line_content": "\tColumnPtr replicate(const IColumn::Offsets_t & offsets) const",
          "content_same": false
        },
        {
          "line": 294,
          "old_api": "e == 0)\n\t\t{",
          "new_api": null,
          "old_text": "e == 0)\n\t\t{\n\t\t",
          "new_text": null,
          "old_line_content": "\t\tif (size != offsets.size())",
          "new_line_content": "\t{",
          "content_same": false
        },
        {
          "line": 299,
          "old_api": "a[i] < cur_min)",
          "new_api": null,
          "old_text": "a[i] < cur_min)",
          "new_text": null,
          "old_line_content": "\t\ttypename Self::Container_t & res_data = res_->getData();",
          "new_line_content": "\t\tSelf * res_ = new Self;",
          "content_same": false
        },
        {
          "line": 300,
          "old_api": "];\n\n\t\t\tif (dat",
          "new_api": null,
          "old_text": "];\n\n\t\t\tif (dat",
          "new_text": null,
          "old_line_content": "\t\tres_data.reserve(offsets.back());",
          "new_line_content": "\t\tColumnPtr res = res_;",
          "content_same": false
        },
        {
          "line": 237,
          "old_api": "imit == 0)\n\t\t\tlimit = size;\n\t\telse\n\t\t\tlimit",
          "new_api": null,
          "old_text": "imit == 0)\n\t\t\tlimit = size;\n\t\telse\n\t\t\tlimit",
          "new_text": null,
          "old_line_content": "\t\t\tint mask = _mm_movemask_epi8(_mm_loadu_si128(reinterpret_cast<const __m128i *>(filt_pos)));",
          "new_line_content": "\t\twhile (filt_pos < filt_end_sse)",
          "content_same": false
        },
        {
          "line": 272,
          "old_api": ":SIZES_OF_C",
          "new_api": null,
          "old_text": ":SIZES_OF_C",
          "new_text": null,
          "old_line_content": "\t\tsize_t size = data.size();",
          "new_line_content": "\tColumnPtr permute(const IColumn::Permutation & perm, size_t limit) const",
          "content_same": false
        },
        {
          "line": 338,
          "old_api": "res = 0;\n\tsrc = data[n];\n\treturn r",
          "new_api": null,
          "old_text": "res = 0;\n\tsrc = data[n];\n\treturn r",
          "new_text": null,
          "old_line_content": "\t\tmin = typename NearestFieldType<T>::Type(cur_min);",
          "new_line_content": "\t\t}",
          "content_same": false
        },
        {
          "line": 339,
          "old_api": "",
          "new_api": null,
          "old_text": "",
          "new_text": null,
          "old_line_content": "\t\tmax = typename NearestFieldType<T>::Type(cur_max);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 277,
          "old_api": "nPtr res = res_;\n\t\tty",
          "new_api": null,
          "old_text": "nPtr res = res_;\n\t\tty",
          "new_text": null,
          "old_line_content": "\t\t\tlimit = std::min(size, limit);",
          "new_line_content": "\t\t\tlimit = size;",
          "content_same": false
        },
        {
          "line": 309,
          "old_api": "()\n\t{\n\t\treturn data;\n\t}\n\n\tc",
          "new_api": null,
          "old_text": "()\n\t{\n\t\treturn data;\n\t}\n\n\tc",
          "new_text": null,
          "old_line_content": "\t\t\t\tres_data.push_back(data[i]);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 245,
          "old_api": "\", ErrorCodes::SIZES_OF_COLUMNS_DOESNT_MATCH);\n\n\t\tSelf *",
          "new_api": null,
          "old_text": "\", ErrorCodes::SIZES_OF_COLUMNS_DOESNT_MATCH);\n\n\t\tSelf *",
          "new_text": null,
          "old_line_content": "\t\t\t\tres_data.insert_assume_reserved(data_pos, data_pos + 16);",
          "new_line_content": "\t\t\telse if (0xFFFF == mask)",
          "content_same": false
        },
        {
          "line": 280,
          "old_api": "reserve",
          "new_api": null,
          "old_text": "es_->getData();\n\t\tres_data.reserve(offsets.back());\n\n\t\tIColumn::Offset_t prev_offset = 0;\n\t\tfor (s",
          "new_text": null,
          "old_line_content": "\t\t\tthrow Exception(\"Size of permutation is less than required.\", ErrorCodes::SIZES_OF_COLUMNS_DOESNT_MATCH);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 251,
          "old_api": "getData",
          "new_api": null,
          "old_text": "data = res_->getData();\n\t\tfor (",
          "new_text": null,
          "old_line_content": "\t\t\t\t\t\tres_data.push_back(data_pos[i]);",
          "new_line_content": "\t\t\t\tfor (size_t i = 0; i < 16; ++i)",
          "content_same": false
        },
        {
          "line": 284,
          "old_api": "= offsets[i];",
          "new_api": null,
          "old_text": " = offsets[i];\n",
          "new_text": null,
          "old_line_content": "\t\ttypename Self::Container_t & res_data = res_->getData();",
          "new_line_content": "\t\tSelf * res_ = new Self(limit);",
          "content_same": false
        },
        {
          "line": 317,
          "old_api": "mplate <typ",
          "new_api": null,
          "old_text": "mplate <typ",
          "new_text": null,
          "old_line_content": "\t\tsize_t size = data.size();",
          "new_line_content": "\tvoid getExtremes(Field & min, Field & max) const",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 3,
      "total_additions": 19,
      "total_deletions": 18,
      "total_api_changes": 40
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 4,
        "api_related_lines": 40,
        "non_api_lines": 1,
        "non_api_line_numbers": [
          236
        ]
      }
    },
    "api_calls_before": 86,
    "api_calls_after": 88,
    "diff_info": {
      "added_lines": 3,
      "removed_lines": 1,
      "total_diff_lines": 18
    }
  }
}