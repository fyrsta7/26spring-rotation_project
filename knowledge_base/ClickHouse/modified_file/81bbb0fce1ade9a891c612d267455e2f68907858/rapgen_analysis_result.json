{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ClickHouse/modified_file/81bbb0fce1ade9a891c612d267455e2f68907858",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ClickHouse/modified_file/81bbb0fce1ade9a891c612d267455e2f68907858/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ClickHouse/modified_file/81bbb0fce1ade9a891c612d267455e2f68907858/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ClickHouse/modified_file/81bbb0fce1ade9a891c612d267455e2f68907858/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 195,
          "old_api": "begin",
          "new_api": "std::max(max_size, cur_size)",
          "old_text": "parts.begin()",
          "new_text": "std::max(max_size, cur_size)",
          "old_line_content": "                    parts.begin() + end,",
          "new_line_content": "            max_size = std::max(max_size, cur_size);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 226,
          "old_api": null,
          "new_api": "selectWithinPartition",
          "old_text": null,
          "new_text": "selectWithinPartition(part_range, max_total_size_to_merge, estimator, settings, min_size_to_lower_base_log, max_size_to_lower_base_log)",
          "old_line_content": "",
          "new_line_content": "        selectWithinPartition(part_range, max_total_size_to_merge, estimator, settings, min_size_to_lower_base_log, max_size_to_lower_base_log);",
          "content_same": false
        },
        {
          "line": 196,
          "old_api": null,
          "new_api": "std::min(min_age, cur_age)",
          "old_text": null,
          "new_text": "std::min(min_age, cur_age)",
          "old_line_content": "                    sum_size,",
          "new_line_content": "            min_age = std::min(min_age, cur_age);",
          "content_same": false
        },
        {
          "line": 228,
          "old_api": null,
          "new_api": "getBest",
          "old_text": null,
          "new_text": "estimator.getBest()",
          "old_line_content": "",
          "new_line_content": "    return estimator.getBest();",
          "content_same": false
        },
        {
          "line": 168,
          "old_api": null,
          "new_api": "constexpr",
          "old_text": null,
          "new_text": "constexpr",
          "old_line_content": "",
          "new_line_content": "    static constexpr size_t parts_threshold = 1000;",
          "content_same": false
        },
        {
          "line": 201,
          "old_api": null,
          "new_api": "allow",
          "old_text": null,
          "new_text": "allow(sum_size, max_size, min_age, end - begin, parts_count, min_size_to_lower_base_log, max_size_to_lower_base_log, settings)",
          "old_line_content": "}",
          "new_line_content": "            if (allow(sum_size, max_size, min_age, end - begin, parts_count, min_size_to_lower_base_log, max_size_to_lower_base_log, settings))",
          "content_same": false
        },
        {
          "line": 202,
          "old_api": null,
          "new_api": "consider",
          "old_text": null,
          "new_text": "estimator.consider(\n                    parts.begin() + begin,\n                    parts.begin() + end,\n                    sum_size,\n                    begin == 0 ? 0 : parts[begin - 1].size,\n                    settings)",
          "old_line_content": "",
          "new_line_content": "                estimator.consider(",
          "content_same": false
        },
        {
          "line": 203,
          "old_api": null,
          "new_api": "begin",
          "old_text": null,
          "new_text": "parts.begin()",
          "old_line_content": "}",
          "new_line_content": "                    parts.begin() + begin,",
          "content_same": false
        },
        {
          "line": 204,
          "old_api": null,
          "new_api": "begin",
          "old_text": null,
          "new_text": "parts.begin()",
          "old_line_content": "",
          "new_line_content": "                    parts.begin() + end,",
          "content_same": false
        },
        {
          "line": 184,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(end > begin)",
          "old_line_content": "",
          "new_line_content": "            assert(end > begin);",
          "content_same": false
        },
        {
          "line": 222,
          "old_api": null,
          "new_api": "log",
          "old_text": null,
          "new_text": "log(1 + settings.min_size_to_lower_base)",
          "old_line_content": "}",
          "new_line_content": "    const double min_size_to_lower_base_log = log(1 + settings.min_size_to_lower_base);",
          "content_same": false
        },
        {
          "line": 223,
          "old_api": null,
          "new_api": "log",
          "old_text": null,
          "new_text": "log(1 + settings.max_size_to_lower_base)",
          "old_line_content": "",
          "new_line_content": "    const double max_size_to_lower_base_log = log(1 + settings.max_size_to_lower_base);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 192,
          "old_api": "allow",
          "new_api": null,
          "old_text": "allow(sum_size, max_size, min_age, end - begin, parts_count, min_size_to_lower_base_log, max_size_to_lower_base_log, settings)",
          "new_text": null,
          "old_line_content": "            if (allow(sum_size, max_size, min_age, end - begin, parts_count, min_size_to_lower_base_log, max_size_to_lower_base_log, settings))",
          "new_line_content": "            size_t cur_age = parts[end - 1].age;",
          "content_same": false
        },
        {
          "line": 193,
          "old_api": "consider",
          "new_api": null,
          "old_text": "estimator.consider(\n                    parts.begin() + begin,\n                    parts.begin() + end,\n                    sum_size,\n                    begin == 0 ? 0 : parts[begin - 1].size,\n                    settings)",
          "new_text": null,
          "old_line_content": "                estimator.consider(",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 194,
          "old_api": "begin",
          "new_api": null,
          "old_text": "parts.begin()",
          "new_text": null,
          "old_line_content": "                    parts.begin() + begin,",
          "new_line_content": "            sum_size += cur_size;",
          "content_same": false
        },
        {
          "line": 219,
          "old_api": "getBest",
          "new_api": null,
          "old_text": "estimator.getBest()",
          "new_text": null,
          "old_line_content": "    return estimator.getBest();",
          "new_line_content": "    Estimator estimator;",
          "content_same": false
        },
        {
          "line": 175,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(end > begin)",
          "new_text": null,
          "old_line_content": "            assert(end > begin);",
          "new_line_content": "        if (!parts[begin].shall_participate_in_merges)",
          "content_same": false
        },
        {
          "line": 213,
          "old_api": "log",
          "new_api": null,
          "old_text": "log(1 + settings.min_size_to_lower_base)",
          "new_text": null,
          "old_line_content": "    const double min_size_to_lower_base_log = log(1 + settings.min_size_to_lower_base);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 214,
          "old_api": "log",
          "new_api": null,
          "old_text": "log(1 + settings.max_size_to_lower_base)",
          "new_text": null,
          "old_line_content": "    const double max_size_to_lower_base_log = log(1 + settings.max_size_to_lower_base);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 217,
          "old_api": "selectWithinPartition",
          "new_api": null,
          "old_text": "selectWithinPartition(part_range, max_total_size_to_merge, estimator, settings, min_size_to_lower_base_log, max_size_to_lower_base_log)",
          "new_text": null,
          "old_line_content": "        selectWithinPartition(part_range, max_total_size_to_merge, estimator, settings, min_size_to_lower_base_log, max_size_to_lower_base_log);",
          "new_line_content": "    size_t max_total_size_to_merge)",
          "content_same": false
        },
        {
          "line": 186,
          "old_api": "std::max(max_size, cur_size)",
          "new_api": null,
          "old_text": "std::max(max_size, cur_size)",
          "new_text": null,
          "old_line_content": "            max_size = std::max(max_size, cur_size);",
          "new_line_content": "                break;",
          "content_same": false
        },
        {
          "line": 187,
          "old_api": "std::min(min_age, cur_age)",
          "new_api": null,
          "old_text": "std::min(min_age, cur_age)",
          "new_text": null,
          "old_line_content": "            min_age = std::min(min_age, cur_age);",
          "new_line_content": "",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 1,
      "total_additions": 11,
      "total_deletions": 10,
      "total_api_changes": 22
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 14,
        "api_related_lines": 22,
        "non_api_lines": 13,
        "non_api_line_numbers": [
          160,
          161,
          162,
          163,
          164,
          165,
          166,
          167,
          169,
          170,
          171,
          172,
          173
        ]
      }
    },
    "api_calls_before": 26,
    "api_calls_after": 27,
    "diff_info": {
      "added_lines": 14,
      "removed_lines": 5,
      "total_diff_lines": 32
    }
  }
}