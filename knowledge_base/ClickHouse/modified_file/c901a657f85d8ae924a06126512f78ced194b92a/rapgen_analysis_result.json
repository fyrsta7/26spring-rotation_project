{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ClickHouse/modified_file/c901a657f85d8ae924a06126512f78ced194b92a",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ClickHouse/modified_file/c901a657f85d8ae924a06126512f78ced194b92a/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ClickHouse/modified_file/c901a657f85d8ae924a06126512f78ced194b92a/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ClickHouse/modified_file/c901a657f85d8ae924a06126512f78ced194b92a/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 69,
          "old_api": "data",
          "new_api": "std::min(format_settings.pretty.max_column_pad_width,\n                    std::min<UInt64>(format_settings.pretty.max_value_width, widths[i][j]))",
          "old_text": "std::min<UInt64>(format_settings.pretty.max_column_pad_width,\n                UTF8::computeWidth(reinterpret_cast<const UInt8 *>(elem.name.data()), elem.name.size()))",
          "new_text": "std::min(format_settings.pretty.max_column_pad_width,\n                    std::min<UInt64>(format_settings.pretty.max_value_width, widths[i][j]))",
          "old_line_content": "            name_widths[i] = std::min<UInt64>(format_settings.pretty.max_column_pad_width,",
          "new_line_content": "                std::min(format_settings.pretty.max_column_pad_width,",
          "content_same": false
        },
        {
          "line": 70,
          "old_api": "size",
          "new_api": "std::min<UInt64>(format_settings.pretty.max_value_width, widths[i][j])",
          "old_text": "elem.name.size()",
          "new_text": "std::min<UInt64>(format_settings.pretty.max_value_width, widths[i][j])",
          "old_line_content": "                UTF8::computeWidth(reinterpret_cast<const UInt8 *>(elem.name.data()), elem.name.size()));",
          "new_line_content": "                    std::min<UInt64>(format_settings.pretty.max_value_width, widths[i][j])));",
          "content_same": false
        },
        {
          "line": 91,
          "old_api": "getHeader",
          "new_api": "getNumRows",
          "old_text": "getPort(port_kind).getHeader()",
          "new_text": "chunk.getNumRows()",
          "old_line_content": "    const auto & header = getPort(port_kind).getHeader();",
          "new_line_content": "        total_rows += chunk.getNumRows();",
          "content_same": false
        },
        {
          "line": 96,
          "old_api": "calculateWidths",
          "new_api": "getNumColumns",
          "old_text": "calculateWidths(header, chunk, widths, max_widths, name_widths)",
          "new_text": "chunk.getNumColumns()",
          "old_line_content": "    calculateWidths(header, chunk, widths, max_widths, name_widths);",
          "new_line_content": "    auto num_columns = chunk.getNumColumns();",
          "content_same": false
        },
        {
          "line": 140,
          "old_api": "(size_t i = 0; i < num_c",
          "new_api": "std::string bottom_separat",
          "old_text": " (size_t i = 0; i < num_c",
          "new_text": "   std::string bottom_separat",
          "old_line_content": "    writeCString(\"┃ \", out);",
          "new_line_content": "    std::string middle_values_separator_s = middle_values_separator.str();",
          "content_same": false
        },
        {
          "line": 144,
          "old_api": "const auto & col = header",
          "new_api": ");\n\n    /// Names\n    writeCStrin",
          "old_text": " const auto & col = header",
          "new_text": ");\n\n    /// Names\n    writeCStrin",
          "old_line_content": "            writeCString(\" ┃ \", out);",
          "new_line_content": "    writeString(top_separator_s, out);",
          "content_same": false
        },
        {
          "line": 151,
          "old_api": "rmats",
          "new_api": "const auto & col = header",
          "old_text": "rmats())\n        {\n            for (size_t ",
          "new_text": " const auto & col = header",
          "old_line_content": "        if (col.type->shouldAlignRightInPrettyFormats())",
          "new_line_content": "            writeCString(\" ┃ \", out);",
          "content_same": false
        },
        {
          "line": 156,
          "old_api": "}\n        else\n        {",
          "new_api": "if (col.type->shouldAlign",
          "old_text": "}\n        else\n        {\n ",
          "new_text": "   if (col.type->shouldAlign",
          "old_line_content": "            writeString(col.name, out);",
          "new_line_content": "            writeCString(\"\\033[1m\", out);",
          "content_same": false
        },
        {
          "line": 163,
          "old_api": "if (format_sett",
          "new_api": "}\n        else\n        {",
          "old_text": "    if (format_sett",
          "new_text": "}\n        else\n        {\n ",
          "old_line_content": "                writeChar(' ', out);",
          "new_line_content": "            writeString(col.name, out);",
          "content_same": false
        },
        {
          "line": 167,
          "old_api": "writeCString(\" ┃\\n\", out",
          "new_api": "for (size_t k = 0; k",
          "old_text": "    writeCString(\" ┃\\n\", out",
          "new_text": "     for (size_t k = 0; k ",
          "old_line_content": "            writeCString(\"\\033[0m\", out);",
          "new_line_content": "            writeString(col.name, out);",
          "content_same": false
        },
        {
          "line": 176,
          "old_api": "out);\n\n        writeCString(\"│\", out);",
          "new_api": "eString",
          "old_text": " out);\n\n        writeCString(\"│\", out);\n\n  ",
          "new_text": "eString(middle_names_separa",
          "old_line_content": "            writeString(middle_values_separator_s, out);",
          "new_line_content": "    writeCString(\" ┃\\n\", out);",
          "content_same": false
        },
        {
          "line": 178,
          "old_api": "size_t j = 0; j < num_co",
          "new_api": "out);\n\n    for (size_t i = 0; i < num_rows",
          "old_text": "size_t j = 0; j < num_co",
          "new_text": "out);\n\n    for (size_t i = 0; i < num_rows",
          "old_line_content": "        writeCString(\"│\", out);",
          "new_line_content": "    writeString(middle_names_separator_s, out);",
          "content_same": false
        },
        {
          "line": 183,
          "old_api": "st auto & type = *header",
          "new_api": "out);\n\n        writeCString(\"│\", out);",
          "old_text": "st auto & type = *header",
          "new_text": " out);\n\n        writeCString(\"│\", out);\n\n  ",
          "old_line_content": "                writeCString(\"│\", out);",
          "new_line_content": "            writeString(middle_values_separator_s, out);",
          "content_same": false
        },
        {
          "line": 185,
          "old_api": "writeValueWithPadding",
          "new_api": "size_t j = 0; j < num_co",
          "old_text": "writeValueWithPadding(*",
          "new_text": "size_t j = 0; j < num_co",
          "old_line_content": "            const auto & type = *header.getByPosition(j).type;",
          "new_line_content": "        writeCString(\"│\", out);",
          "content_same": false
        },
        {
          "line": 194,
          "old_api": "otal_rows += num_rows;\n}\n\n\nvoid Pret",
          "new_api": "[j][i],",
          "old_text": "otal_rows += num_rows;\n}\n\n\nvoid Pret",
          "new_text": "[j][i],\n         ",
          "old_line_content": "    writeString(bottom_separator_s, out);",
          "new_line_content": "                widths[j].empty() ? max_widths[j] : widths[j][i],",
          "content_same": false
        },
        {
          "line": 238,
          "old_api": ");\n    }\n}\n\n\nvoid Prett",
          "new_api": "write_padding();\n        out.wri",
          "old_text": ");\n    }\n}\n\n\nvoid Prett",
          "new_text": "      write_padding();\n        out.wri",
          "old_line_content": "        out.write(serialized_value.data(), serialized_value.size());",
          "new_line_content": "    if (type.shouldAlignRightInPrettyFormats())",
          "content_same": false
        },
        {
          "line": 246,
          "old_api": "kOutputFormat::consumeTotals",
          "new_api": "tFormat::consum",
          "old_text": "kOutputFormat::consumeTotals",
          "new_text": "tFormat::consum",
          "old_line_content": "    write(chunk, PortKind::Main);",
          "new_line_content": "        write_padding();",
          "content_same": false
        },
        {
          "line": 253,
          "old_api": "k, PortKind::Totals);\n}\n\nvoid Pr",
          "new_api": "kOutputFormat::consumeTotals",
          "old_text": "k, PortKind::Totals);\n}\n\nvoid Pr",
          "new_text": "kOutputFormat::consumeTotals",
          "old_line_content": "    writeCString(\"\\nTotals:\\n\", out);",
          "new_line_content": "    write(chunk, PortKind::Main);",
          "content_same": false
        },
        {
          "line": 260,
          "old_api": ":\\n\", out);\n    wr",
          "new_api": "k, PortKind::Totals);\n}\n\nvoid Pr",
          "old_text": ":\\n\", out);\n    wr",
          "new_text": "k, PortKind::Totals);\n}\n\nvoid Pr",
          "old_line_content": "    writeSuffixIfNot();",
          "new_line_content": "    writeCString(\"\\nTotals:\\n\", out);",
          "content_same": false
        },
        {
          "line": 261,
          "old_api": "unk, PortKind::Extremes);\n}\n\n\nvoid",
          "new_api": "ockOutputFormat::consumeExtrem",
          "old_text": "unk, PortKind::Extremes);\n}\n\n\nvoid",
          "new_text": "ockOutputFormat::consumeExtrem",
          "old_line_content": "    writeCString(\"\\nExtremes:\\n\", out);",
          "new_line_content": "    write(chunk, PortKind::Totals);",
          "content_same": false
        },
        {
          "line": 278,
          "old_api": "tProcessorPretty",
          "new_api": "t);\n        writeCString(\".\\n\", out);\n    }\n}\n\nvoi",
          "old_text": "tProcessorPretty(F",
          "new_text": "t);\n        writeCString(\".\\n\", out);\n    }\n}\n\nvoi",
          "old_line_content": "    writeSuffixIfNot();",
          "new_line_content": "        writeIntText(format_settings.pretty.max_rows, out);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 259,
          "old_api": null,
          "new_api": "n\", out);\n    writ",
          "old_text": null,
          "new_text": "n\", out);\n    writ",
          "old_line_content": "    total_rows = 0;",
          "new_line_content": "    writeSuffixIfNot();",
          "content_same": false
        },
        {
          "line": 138,
          "old_api": null,
          "new_api": "ring middle_names_s",
          "old_text": null,
          "new_text": "ring middle_names_s",
          "old_line_content": "",
          "new_line_content": "    std::string top_separator_s = top_separator.str();",
          "content_same": false
        },
        {
          "line": 267,
          "old_api": null,
          "new_api": ":\\n\", out);\n    wr",
          "old_text": null,
          "new_text": ":\\n\", out);\n    wr",
          "old_line_content": "{",
          "new_line_content": "    writeSuffixIfNot();",
          "content_same": false
        },
        {
          "line": 139,
          "old_api": null,
          "new_api": "std::string middle_values_",
          "old_text": null,
          "new_text": "  std::string middle_values_",
          "old_line_content": "    /// Names",
          "new_line_content": "    std::string middle_names_separator_s = middle_names_separator.str();",
          "content_same": false
        },
        {
          "line": 141,
          "old_api": null,
          "new_api": "Output the block",
          "old_text": null,
          "new_text": " Output the block\n    ",
          "old_line_content": "    for (size_t i = 0; i < num_columns; ++i)",
          "new_line_content": "    std::string bottom_separator_s = bottom_separator.str();",
          "content_same": false
        },
        {
          "line": 268,
          "old_api": null,
          "new_api": "unk, PortKind::Extremes);\n}\n\n\nvoid",
          "old_text": null,
          "new_text": "unk, PortKind::Extremes);\n}\n\n\nvoid",
          "old_line_content": "    if (total_rows >= format_settings.pretty.max_rows)",
          "new_line_content": "    writeCString(\"\\nExtremes:\\n\", out);",
          "content_same": false
        },
        {
          "line": 269,
          "old_api": null,
          "new_api": "yBlockOutputFormat::writeSuffix(",
          "old_text": null,
          "new_text": "yBlockOutputFormat::writeSuffix(",
          "old_line_content": "    {",
          "new_line_content": "    write(chunk, PortKind::Extremes);",
          "content_same": false
        },
        {
          "line": 147,
          "old_api": null,
          "new_api": "(size_t i = 0; i < num_c",
          "old_text": null,
          "new_text": " (size_t i = 0; i < num_c",
          "old_line_content": "",
          "new_line_content": "    writeCString(\"┃ \", out);",
          "content_same": false
        },
        {
          "line": 277,
          "old_api": null,
          "new_api": "iteIntText",
          "old_text": null,
          "new_text": "iteIntText(format_settings.pretty.ma",
          "old_line_content": "{",
          "new_line_content": "        writeCString(\"  Showed first \", out);",
          "content_same": false
        },
        {
          "line": 279,
          "old_api": null,
          "new_api": "ockOutputFormat::finaliz",
          "old_text": null,
          "new_text": "ockOutputFormat::finaliz",
          "old_line_content": "}",
          "new_line_content": "        writeCString(\".\\n\", out);",
          "content_same": false
        },
        {
          "line": 153,
          "old_api": null,
          "new_api": "(format_settings.prett",
          "old_text": null,
          "new_text": " (format_settings.prett",
          "old_line_content": "            for (size_t k = 0; k < max_widths[i] - name_widths[i]; ++k)",
          "new_line_content": "        const auto & col = header.getByPosition(i);",
          "content_same": false
        },
        {
          "line": 285,
          "old_api": null,
          "new_api": "tProcessorPretty",
          "old_text": null,
          "new_text": "tProcessorPretty(F",
          "old_line_content": "        WriteBuffer & buf,",
          "new_line_content": "    writeSuffixIfNot();",
          "content_same": false
        },
        {
          "line": 158,
          "old_api": null,
          "new_api": "rmats",
          "old_text": null,
          "new_text": "rmats())\n        {\n            for (size_t ",
          "old_line_content": "        else",
          "new_line_content": "        if (col.type->shouldAlignRightInPrettyFormats())",
          "content_same": false
        },
        {
          "line": 161,
          "old_api": null,
          "new_api": "iteString",
          "old_text": null,
          "new_text": "iteString(col.name,",
          "old_line_content": "",
          "new_line_content": "                writeChar(' ', out);",
          "content_same": false
        },
        {
          "line": 291,
          "old_api": null,
          "new_api": "registerOutputFormatProcessor",
          "old_text": null,
          "new_text": "[](\n        WriteBuffer & buf,\n        const Block & sample,\n        FormatFactory::WriteCallback,\n        const FormatSettings & format_settings)\n    {\n        return std::make_shared<PrettyBlockOutputFormat>(buf, sample, format_settings);\n    });\n\n    factory.registerOutputFormatProcessor(\"Pr",
          "old_line_content": "    });",
          "new_line_content": "    factory.registerOutputFormatProcessor(\"Pretty\", [](",
          "content_same": false
        },
        {
          "line": 297,
          "old_api": null,
          "new_api": "ample, format_settings);\n    });\n\n    factory.registerOutputFormatProce",
          "old_text": null,
          "new_text": "ample, format_settings);\n    });\n\n    factory.registerOutputFormatProce",
          "old_line_content": "        const FormatSettings & format_settings)",
          "new_line_content": "        return std::make_shared<PrettyBlockOutputFormat>(buf, sample, format_settings);",
          "content_same": false
        },
        {
          "line": 170,
          "old_api": null,
          "new_api": "if (format_sett",
          "old_text": null,
          "new_text": "    if (format_sett",
          "old_line_content": "",
          "new_line_content": "                writeChar(' ', out);",
          "content_same": false
        },
        {
          "line": 300,
          "old_api": null,
          "new_api": "scapes\", [](\n        WriteBuffer & buf,\n        const Block & sample,\n        FormatFactory::WriteCallback,\n        const FormatSettings & format_settings)\n    {\n        FormatSettings changed_settings = format_settings;\n        changed_settings.pretty.color = false;\n        return std::make_shared<PrettyBlockOutputFormat>(buf, sample, changed_settings);\n    });\n}\n\n}",
          "old_text": null,
          "new_text": "scapes\", [](\n        WriteBuffer & buf,\n        const Block & sample,\n        FormatFactory::WriteCallback,\n        const FormatSettings & format_settings)\n    {\n        FormatSettings changed_settings = format_settings;\n        changed_settings.pretty.color = false;\n        return std::make_shared<PrettyBlockOutputFormat>(buf, sample, changed_settings);\n    });\n}\n\n}\n",
          "old_line_content": "        changed_settings.pretty.color = false;",
          "new_line_content": "    factory.registerOutputFormatProcessor(\"PrettyNoEscapes\", [](",
          "content_same": false
        },
        {
          "line": 174,
          "old_api": null,
          "new_api": "writeCString(\" ┃\\n\", out",
          "old_text": null,
          "new_text": "    writeCString(\" ┃\\n\", out",
          "old_line_content": "    {",
          "new_line_content": "            writeCString(\"\\033[0m\", out);",
          "content_same": false
        },
        {
          "line": 308,
          "old_api": null,
          "new_api": "ample, changed_settings);\n    });\n}\n\n}",
          "old_text": null,
          "new_text": "ample, changed_settings);\n    });\n}\n\n}\n",
          "old_line_content": "",
          "new_line_content": "        return std::make_shared<PrettyBlockOutputFormat>(buf, sample, changed_settings);",
          "content_same": false
        },
        {
          "line": 190,
          "old_api": null,
          "new_api": "st auto & type = *header",
          "old_text": null,
          "new_text": "st auto & type = *header",
          "old_line_content": "",
          "new_line_content": "                writeCString(\"│\", out);",
          "content_same": false
        },
        {
          "line": 64,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "serialized_value.size()",
          "old_line_content": "        }",
          "new_line_content": "            if (serialized_value.size() > format_settings.pretty.max_value_width * 4)",
          "content_same": false
        },
        {
          "line": 65,
          "old_api": null,
          "new_api": "resize",
          "old_text": null,
          "new_text": "serialized_value.resize(format_settings.pretty.max_value_width * 4)",
          "old_line_content": "",
          "new_line_content": "                serialized_value.resize(format_settings.pretty.max_value_width * 4);",
          "content_same": false
        },
        {
          "line": 192,
          "old_api": null,
          "new_api": "writeValueWithPadding",
          "old_text": null,
          "new_text": "writeValueWithPadding(*",
          "old_line_content": "    }",
          "new_line_content": "            const auto & type = *header.getByPosition(j).type;",
          "content_same": false
        },
        {
          "line": 67,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "serialized_value.size()",
          "old_line_content": "        {",
          "new_line_content": "            widths[i][j] = UTF8::computeWidth(reinterpret_cast<const UInt8 *>(serialized_value.data()), serialized_value.size(), prefix);",
          "content_same": false
        },
        {
          "line": 68,
          "old_api": null,
          "new_api": "std::max(max_padded_widths[i],\n                std::min(format_settings.pretty.max_column_pad_width,\n                    std::min<UInt64>(format_settings.pretty.max_value_width, widths[i][j])))",
          "old_text": null,
          "new_text": "std::max(max_padded_widths[i],\n                std::min(format_settings.pretty.max_column_pad_width,\n                    std::min<UInt64>(format_settings.pretty.max_value_width, widths[i][j])))",
          "old_line_content": "            // name string doesn't contain Tab, no need to pass `prefix`",
          "new_line_content": "            max_padded_widths[i] = std::max(max_padded_widths[i],",
          "content_same": false
        },
        {
          "line": 193,
          "old_api": null,
          "new_api": "empty",
          "old_text": null,
          "new_text": ",\n                widths[j].empty() ? max_widths[j] : widths[j][i],\n                max_widths[j]);\n        }\n\n        writeCString(\"│\\n\", o",
          "old_line_content": "",
          "new_line_content": "            writeValueWithPadding(*columns[j], type, i,",
          "content_same": false
        },
        {
          "line": 198,
          "old_api": null,
          "new_api": "String",
          "old_text": null,
          "new_text": "String(bottom_separator_s,",
          "old_line_content": "",
          "new_line_content": "        writeCString(\"│\\n\", out);",
          "content_same": false
        },
        {
          "line": 201,
          "old_api": null,
          "new_api": "otal_rows += num_rows;\n}\n\n\nvoid Pret",
          "old_text": null,
          "new_text": "otal_rows += num_rows;\n}\n\n\nvoid Pret",
          "old_line_content": "        const IColumn & column, const IDataType & type, size_t row_num, size_t value_width, size_t pad_to_width)",
          "new_line_content": "    writeString(bottom_separator_s, out);",
          "content_same": false
        },
        {
          "line": 76,
          "old_api": null,
          "new_api": "data",
          "old_text": null,
          "new_text": "std::min<UInt64>(format_settings.pretty.max_column_pad_width,\n                UTF8::computeWidth(reinterpret_cast<const UInt8 *>(elem.name.data()), elem.name.size()))",
          "old_line_content": "",
          "new_line_content": "            name_widths[i] = std::min<UInt64>(format_settings.pretty.max_column_pad_width,",
          "content_same": false
        },
        {
          "line": 77,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "elem.name.size()",
          "old_line_content": "",
          "new_line_content": "                UTF8::computeWidth(reinterpret_cast<const UInt8 *>(elem.name.data()), elem.name.size()));",
          "content_same": false
        },
        {
          "line": 78,
          "old_api": null,
          "new_api": "std::max(max_padded_widths[i], name_widths[i])",
          "old_text": null,
          "new_text": "std::max(max_padded_widths[i], name_widths[i])",
          "old_line_content": "void PrettyBlockOutputFormat::write(const Chunk & chunk, PortKind port_kind)",
          "new_line_content": "            max_padded_widths[i] = std::max(max_padded_widths[i], name_widths[i]);",
          "content_same": false
        },
        {
          "line": 213,
          "old_api": null,
          "new_api": "rialize, format_settings);\n    }\n\n    if (value_width > format_settin",
          "old_text": null,
          "new_text": "rialize, format_settings);\n    }\n\n    if (value_width > format_settin",
          "old_line_content": "",
          "new_line_content": "        type.serializeAsText(column, row_num, out_serialize, format_settings);",
          "content_same": false
        },
        {
          "line": 218,
          "old_api": null,
          "new_api": "data",
          "old_text": null,
          "new_text": "einterpret_cast<const UInt8 *>(serialized_value.data()), serialized_value.size(), 0, 1 + format_settings.pretty.max_value_width));\n\n        if (format_settings.pretty.color",
          "old_line_content": "",
          "new_line_content": "        serialized_value.resize(UTF8::computeBytesBeforeWidth(",
          "content_same": false
        },
        {
          "line": 219,
          "old_api": null,
          "new_api": "ngs.pretty.max_value_wi",
          "old_text": null,
          "new_text": "ngs.pretty.max_value_wi",
          "old_line_content": "        value_width = format_settings.pretty.max_value_width;",
          "new_line_content": "            reinterpret_cast<const UInt8 *>(serialized_value.data()), serialized_value.size(), 0, 1 + format_settings.pretty.max_value_width));",
          "content_same": false
        },
        {
          "line": 95,
          "old_api": null,
          "new_api": "getNumRows",
          "old_text": null,
          "new_text": "chunk.getNumRows()",
          "old_line_content": "    Widths name_widths;",
          "new_line_content": "    auto num_rows = chunk.getNumRows();",
          "content_same": false
        },
        {
          "line": 97,
          "old_api": null,
          "new_api": "getColumns",
          "old_text": null,
          "new_text": "chunk.getColumns()",
          "old_line_content": "",
          "new_line_content": "    const auto & columns = chunk.getColumns();",
          "content_same": false
        },
        {
          "line": 98,
          "old_api": null,
          "new_api": "getHeader",
          "old_text": null,
          "new_text": "getPort(port_kind).getHeader()",
          "old_line_content": "    /// Create separators",
          "new_line_content": "    const auto & header = getPort(port_kind).getHeader();",
          "content_same": false
        },
        {
          "line": 103,
          "old_api": null,
          "new_api": "calculateWidths",
          "old_text": null,
          "new_text": "calculateWidths(header, chunk, widths, max_widths, name_widths)",
          "old_line_content": "",
          "new_line_content": "    calculateWidths(header, chunk, widths, max_widths, name_widths);",
          "content_same": false
        },
        {
          "line": 235,
          "old_api": null,
          "new_api": "AlignRightInPrettyF",
          "old_text": null,
          "new_text": "AlignRightInPrettyF",
          "old_line_content": "    }",
          "new_line_content": "                writeChar(' ', out);",
          "content_same": false
        },
        {
          "line": 240,
          "old_api": null,
          "new_api": "data",
          "old_text": null,
          "new_text": "lue.data(), ser",
          "old_line_content": "    }",
          "new_line_content": "        write_padding();",
          "content_same": false
        },
        {
          "line": 241,
          "old_api": null,
          "new_api": "write",
          "old_text": null,
          "new_text": "       out.write(serial",
          "old_line_content": "}",
          "new_line_content": "        out.write(serialized_value.data(), serialized_value.size());",
          "content_same": false
        },
        {
          "line": 245,
          "old_api": null,
          "new_api": ");\n    }\n}\n\n\nvoid Prett",
          "old_text": null,
          "new_text": ");\n    }\n}\n\n\nvoid Prett",
          "old_line_content": "{",
          "new_line_content": "        out.write(serialized_value.data(), serialized_value.size());",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 131,
          "old_api": "ring middle_names_s",
          "new_api": null,
          "old_text": "ring middle_names_s",
          "new_text": null,
          "old_line_content": "    std::string top_separator_s = top_separator.str();",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 132,
          "old_api": "std::string middle_values_",
          "new_api": null,
          "old_text": "  std::string middle_values_",
          "new_text": null,
          "old_line_content": "    std::string middle_names_separator_s = middle_names_separator.str();",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 133,
          "old_api": "std::string bottom_separat",
          "new_api": null,
          "old_text": "   std::string bottom_separat",
          "new_text": null,
          "old_line_content": "    std::string middle_values_separator_s = middle_values_separator.str();",
          "new_line_content": "    top_separator           << \"┓\\n\";",
          "content_same": false
        },
        {
          "line": 134,
          "old_api": "Output the block",
          "new_api": null,
          "old_text": " Output the block\n    ",
          "new_text": null,
          "old_line_content": "    std::string bottom_separator_s = bottom_separator.str();",
          "new_line_content": "    middle_names_separator  << \"┩\\n\";",
          "content_same": false
        },
        {
          "line": 262,
          "old_api": "yBlockOutputFormat::writeSuffix(",
          "new_api": null,
          "old_text": "yBlockOutputFormat::writeSuffix(",
          "new_text": null,
          "old_line_content": "    write(chunk, PortKind::Extremes);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 137,
          "old_api": ");\n\n    /// Names\n    writeCStrin",
          "new_api": null,
          "old_text": ");\n\n    /// Names\n    writeCStrin",
          "new_text": null,
          "old_line_content": "    writeString(top_separator_s, out);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 270,
          "old_api": "iteIntText",
          "new_api": null,
          "old_text": "iteIntText(format_settings.pretty.ma",
          "new_text": null,
          "old_line_content": "        writeCString(\"  Showed first \", out);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 271,
          "old_api": "t);\n        writeCString(\".\\n\", out);\n    }\n}\n\nvoi",
          "new_api": null,
          "old_text": "t);\n        writeCString(\".\\n\", out);\n    }\n}\n\nvoi",
          "new_text": null,
          "old_line_content": "        writeIntText(format_settings.pretty.max_rows, out);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 272,
          "old_api": "ockOutputFormat::finaliz",
          "new_api": null,
          "old_text": "ockOutputFormat::finaliz",
          "new_text": null,
          "old_line_content": "        writeCString(\".\\n\", out);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 146,
          "old_api": "(format_settings.prett",
          "new_api": null,
          "old_text": " (format_settings.prett",
          "new_text": null,
          "old_line_content": "        const auto & col = header.getByPosition(i);",
          "new_line_content": "    /// Names",
          "content_same": false
        },
        {
          "line": 149,
          "old_api": "if (col.type->shouldAlign",
          "new_api": null,
          "old_text": "   if (col.type->shouldAlign",
          "new_text": null,
          "old_line_content": "            writeCString(\"\\033[1m\", out);",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 154,
          "old_api": "iteString",
          "new_api": null,
          "old_text": "iteString(col.name,",
          "new_text": null,
          "old_line_content": "                writeChar(' ', out);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 284,
          "old_api": "registerOutputFormatProcessor",
          "new_api": null,
          "old_text": "[](\n        WriteBuffer & buf,\n        const Block & sample,\n        FormatFactory::WriteCallback,\n        const FormatSettings & format_settings)\n    {\n        return std::make_shared<PrettyBlockOutputFormat>(buf, sample, format_settings);\n    });\n\n    factory.registerOutputFormatProcessor(\"Pr",
          "new_text": null,
          "old_line_content": "    factory.registerOutputFormatProcessor(\"Pretty\", [](",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 160,
          "old_api": "for (size_t k = 0; k",
          "new_api": null,
          "old_text": "     for (size_t k = 0; k ",
          "new_text": null,
          "old_line_content": "            writeString(col.name, out);",
          "new_line_content": "            for (size_t k = 0; k < max_widths[i] - name_widths[i]; ++k)",
          "content_same": false
        },
        {
          "line": 290,
          "old_api": "ample, format_settings);\n    });\n\n    factory.registerOutputFormatProce",
          "new_api": null,
          "old_text": "ample, format_settings);\n    });\n\n    factory.registerOutputFormatProce",
          "new_text": null,
          "old_line_content": "        return std::make_shared<PrettyBlockOutputFormat>(buf, sample, format_settings);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 293,
          "old_api": "scapes\", [](\n        WriteBuffer & buf,\n        const Block & sample,\n        FormatFactory::WriteCallback,\n        const FormatSettings & format_settings)\n    {\n        FormatSettings changed_settings = format_settings;\n        changed_settings.pretty.color = false;\n        return std::make_shared<PrettyBlockOutputFormat>(buf, sample, changed_settings);\n    });\n}\n\n}",
          "new_api": null,
          "old_text": "scapes\", [](\n        WriteBuffer & buf,\n        const Block & sample,\n        FormatFactory::WriteCallback,\n        const FormatSettings & format_settings)\n    {\n        FormatSettings changed_settings = format_settings;\n        changed_settings.pretty.color = false;\n        return std::make_shared<PrettyBlockOutputFormat>(buf, sample, changed_settings);\n    });\n}\n\n}\n",
          "new_text": null,
          "old_line_content": "    factory.registerOutputFormatProcessor(\"PrettyNoEscapes\", [](",
          "new_line_content": "        const Block & sample,",
          "content_same": false
        },
        {
          "line": 169,
          "old_api": "eString",
          "new_api": null,
          "old_text": "eString(middle_names_separa",
          "new_text": null,
          "old_line_content": "    writeCString(\" ┃\\n\", out);",
          "new_line_content": "            for (size_t k = 0; k < max_widths[i] - name_widths[i]; ++k)",
          "content_same": false
        },
        {
          "line": 171,
          "old_api": "out);\n\n    for (size_t i = 0; i < num_rows",
          "new_api": null,
          "old_text": "out);\n\n    for (size_t i = 0; i < num_rows",
          "new_text": null,
          "old_line_content": "    writeString(middle_names_separator_s, out);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 301,
          "old_api": "ample, changed_settings);\n    });\n}\n\n}",
          "new_api": null,
          "old_text": "ample, changed_settings);\n    });\n}\n\n}\n",
          "new_text": null,
          "old_line_content": "        return std::make_shared<PrettyBlockOutputFormat>(buf, sample, changed_settings);",
          "new_line_content": "        WriteBuffer & buf,",
          "content_same": false
        },
        {
          "line": 186,
          "old_api": "empty",
          "new_api": null,
          "old_text": ",\n                widths[j].empty() ? max_widths[j] : widths[j][i],\n                max_widths[j]);\n        }\n\n        writeCString(\"│\\n\", o",
          "new_text": null,
          "old_line_content": "            writeValueWithPadding(*columns[j], type, i,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 187,
          "old_api": "[j][i],",
          "new_api": null,
          "old_text": "[j][i],\n         ",
          "new_text": null,
          "old_line_content": "                widths[j].empty() ? max_widths[j] : widths[j][i],",
          "new_line_content": "        for (size_t j = 0; j < num_columns; ++j)",
          "content_same": false
        },
        {
          "line": 60,
          "old_api": "size",
          "new_api": null,
          "old_text": "serialized_value.size()",
          "new_text": null,
          "old_line_content": "            widths[i][j] = UTF8::computeWidth(reinterpret_cast<const UInt8 *>(serialized_value.data()), serialized_value.size(), prefix);",
          "new_line_content": "            /// Avoid calculating width of too long strings by limiting the size in bytes.",
          "content_same": false
        },
        {
          "line": 61,
          "old_api": "std::max(max_padded_widths[i],\n                std::min(format_settings.pretty.max_column_pad_width,\n                    std::min<UInt64>(format_settings.pretty.max_value_width, widths[i][j])))",
          "new_api": null,
          "old_text": "std::max(max_padded_widths[i],\n                std::min(format_settings.pretty.max_column_pad_width,\n                    std::min<UInt64>(format_settings.pretty.max_value_width, widths[i][j])))",
          "new_text": null,
          "old_line_content": "            max_padded_widths[i] = std::max(max_padded_widths[i],",
          "new_line_content": "            /// Note that it is just an estimation. 4 is the maximum size of Unicode code point in bytes in UTF-8.",
          "content_same": false
        },
        {
          "line": 62,
          "old_api": "std::min(format_settings.pretty.max_column_pad_width,\n                    std::min<UInt64>(format_settings.pretty.max_value_width, widths[i][j]))",
          "new_api": null,
          "old_text": "std::min(format_settings.pretty.max_column_pad_width,\n                    std::min<UInt64>(format_settings.pretty.max_value_width, widths[i][j]))",
          "new_text": null,
          "old_line_content": "                std::min(format_settings.pretty.max_column_pad_width,",
          "new_line_content": "            /// But it's possible that the string is long in bytes but very short in visible size.",
          "content_same": false
        },
        {
          "line": 63,
          "old_api": "std::min<UInt64>(format_settings.pretty.max_value_width, widths[i][j])",
          "new_api": null,
          "old_text": "std::min<UInt64>(format_settings.pretty.max_value_width, widths[i][j])",
          "new_text": null,
          "old_line_content": "                    std::min<UInt64>(format_settings.pretty.max_value_width, widths[i][j])));",
          "new_line_content": "            /// (e.g. non-printable characters, diacritics, combining characters)",
          "content_same": false
        },
        {
          "line": 191,
          "old_api": "String",
          "new_api": null,
          "old_text": "String(bottom_separator_s,",
          "new_text": null,
          "old_line_content": "        writeCString(\"│\\n\", out);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 71,
          "old_api": "std::max(max_padded_widths[i], name_widths[i])",
          "new_api": null,
          "old_text": "std::max(max_padded_widths[i], name_widths[i])",
          "new_text": null,
          "old_line_content": "            max_padded_widths[i] = std::max(max_padded_widths[i], name_widths[i]);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 206,
          "old_api": "rialize, format_settings);\n    }\n\n    if (value_width > format_settin",
          "new_api": null,
          "old_text": "rialize, format_settings);\n    }\n\n    if (value_width > format_settin",
          "new_text": null,
          "old_line_content": "        type.serializeAsText(column, row_num, out_serialize, format_settings);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 211,
          "old_api": "data",
          "new_api": null,
          "old_text": "einterpret_cast<const UInt8 *>(serialized_value.data()), serialized_value.size(), 0, 1 + format_settings.pretty.max_value_width));\n\n        if (format_settings.pretty.color",
          "new_text": null,
          "old_line_content": "        serialized_value.resize(UTF8::computeBytesBeforeWidth(",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 84,
          "old_api": "getNumRows",
          "new_api": null,
          "old_text": "chunk.getNumRows()",
          "new_text": null,
          "old_line_content": "        total_rows += chunk.getNumRows();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 212,
          "old_api": "ngs.pretty.max_value_wi",
          "new_api": null,
          "old_text": "ngs.pretty.max_value_wi",
          "new_text": null,
          "old_line_content": "            reinterpret_cast<const UInt8 *>(serialized_value.data()), serialized_value.size(), 0, 1 + format_settings.pretty.max_value_width));",
          "new_line_content": "        WriteBufferFromString out_serialize(serialized_value, WriteBufferFromString::AppendModeTag());",
          "content_same": false
        },
        {
          "line": 88,
          "old_api": "getNumRows",
          "new_api": null,
          "old_text": "chunk.getNumRows()",
          "new_text": null,
          "old_line_content": "    auto num_rows = chunk.getNumRows();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 89,
          "old_api": "getNumColumns",
          "new_api": null,
          "old_text": "chunk.getNumColumns()",
          "new_text": null,
          "old_line_content": "    auto num_columns = chunk.getNumColumns();",
          "new_line_content": "    if (total_rows >= max_rows)",
          "content_same": false
        },
        {
          "line": 90,
          "old_api": "getColumns",
          "new_api": null,
          "old_text": "chunk.getColumns()",
          "new_text": null,
          "old_line_content": "    const auto & columns = chunk.getColumns();",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 228,
          "old_api": "AlignRightInPrettyF",
          "new_api": null,
          "old_text": "AlignRightInPrettyF",
          "new_text": null,
          "old_line_content": "                writeChar(' ', out);",
          "new_line_content": "    else",
          "content_same": false
        },
        {
          "line": 231,
          "old_api": "write_padding();\n        out.wri",
          "new_api": null,
          "old_text": "      write_padding();\n        out.wri",
          "new_text": null,
          "old_line_content": "    if (type.shouldAlignRightInPrettyFormats())",
          "new_line_content": "    auto write_padding = [&]()",
          "content_same": false
        },
        {
          "line": 233,
          "old_api": "data",
          "new_api": null,
          "old_text": "lue.data(), ser",
          "new_text": null,
          "old_line_content": "        write_padding();",
          "new_line_content": "        if (pad_to_width > value_width)",
          "content_same": false
        },
        {
          "line": 234,
          "old_api": "write",
          "new_api": null,
          "old_text": "       out.write(serial",
          "new_text": null,
          "old_line_content": "        out.write(serialized_value.data(), serialized_value.size());",
          "new_line_content": "            for (size_t k = 0; k < pad_to_width - value_width; ++k)",
          "content_same": false
        },
        {
          "line": 239,
          "old_api": "tFormat::consum",
          "new_api": null,
          "old_text": "tFormat::consum",
          "new_text": null,
          "old_line_content": "        write_padding();",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 252,
          "old_api": "n\", out);\n    writ",
          "new_api": null,
          "old_text": "n\", out);\n    writ",
          "new_text": null,
          "old_line_content": "    writeSuffixIfNot();",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 254,
          "old_api": "ockOutputFormat::consumeExtrem",
          "new_api": null,
          "old_text": "ockOutputFormat::consumeExtrem",
          "new_text": null,
          "old_line_content": "    write(chunk, PortKind::Totals);",
          "new_line_content": "}",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 21,
      "total_additions": 43,
      "total_deletions": 41,
      "total_api_changes": 105
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 7,
        "api_related_lines": 105,
        "non_api_lines": 1,
        "non_api_line_numbers": [
          66
        ]
      }
    },
    "api_calls_before": 87,
    "api_calls_after": 89,
    "diff_info": {
      "added_lines": 7,
      "removed_lines": 0,
      "total_diff_lines": 19
    }
  }
}