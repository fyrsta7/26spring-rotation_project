{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ClickHouse/modified_file/e67b3537f741f5590e5fbe32789d78b4a83fa072",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ClickHouse/modified_file/e67b3537f741f5590e5fbe32789d78b4a83fa072/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ClickHouse/modified_file/e67b3537f741f5590e5fbe32789d78b4a83fa072/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ClickHouse/modified_file/e67b3537f741f5590e5fbe32789d78b4a83fa072/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 110,
          "old_api": "data",
          "new_api": "resize",
          "old_text": "u_strFromUTF8(\n                from_uchars.data(),\n                from_uchars.size(),\n                &from_code_points,\n                reinterpret_cast<const char*>(&data[current_from_offset]),\n                from_size,\n                &err)",
          "new_text": "from_uchars.resize(from_size + 1)",
          "old_line_content": "            u_strFromUTF8(",
          "new_line_content": "            from_uchars.resize(from_size + 1);",
          "content_same": false
        },
        {
          "line": 112,
          "old_api": "size",
          "new_api": "data",
          "old_text": "from_uchars.size()",
          "new_text": "u_strFromUTF8(\n                from_uchars.data(),\n                from_uchars.size(),\n                &from_code_points,\n                reinterpret_cast<const char*>(&data[current_from_offset]),\n                from_size,\n                &err)",
          "old_line_content": "                from_uchars.size(),",
          "new_line_content": "            u_strFromUTF8(",
          "content_same": false
        },
        {
          "line": 114,
          "old_api": "reinterpret_cast<const char*>(&data[current_from_offset])",
          "new_api": "size",
          "old_text": "reinterpret_cast<const char*>(&data[current_from_offset])",
          "new_text": "from_uchars.size()",
          "old_line_content": "                reinterpret_cast<const char*>(&data[current_from_offset]),",
          "new_line_content": "                from_uchars.size(),",
          "content_same": false
        },
        {
          "line": 120,
          "old_api": "resize",
          "new_api": "u_errorName",
          "old_text": "to_uchars.resize(from_code_points * NormalizeImpl::expansionFactor + 1)",
          "new_text": "u_errorName(err)",
          "old_line_content": "            to_uchars.resize(from_code_points * NormalizeImpl::expansionFactor + 1);",
          "new_line_content": "                throw Exception(ErrorCodes::CANNOT_NORMALIZE_STRING, \"Normalization failed (strFromUTF8): {}\", u_errorName(err));",
          "content_same": false
        },
        {
          "line": 122,
          "old_api": "data",
          "new_api": "resize",
          "old_text": "unorm2_normalize(\n                normalizer,\n                from_uchars.data(),\n                from_code_points,\n                to_uchars.data(),\n                to_uchars.size(),\n                &err)",
          "new_text": "to_uchars.resize(from_code_points * NormalizeImpl::expansionFactor + 1)",
          "old_line_content": "            int32_t to_code_points = unorm2_normalize(",
          "new_line_content": "            to_uchars.resize(from_code_points * NormalizeImpl::expansionFactor + 1);",
          "content_same": false
        },
        {
          "line": 129,
          "old_api": "U_FAILURE",
          "new_api": "size",
          "old_text": "U_FAILURE(err)",
          "new_text": "to_uchars.size()",
          "old_line_content": "            if (U_FAILURE(err))",
          "new_line_content": "                to_uchars.size(),",
          "content_same": false
        },
        {
          "line": 141,
          "old_api": "data",
          "new_api": "size",
          "old_text": "to_uchars.data()",
          "new_text": "res_data.size()",
          "old_line_content": "                to_uchars.data(),",
          "new_line_content": "                res_data.size() - current_to_offset,",
          "content_same": false
        },
        {
          "line": 160,
          "old_api": "Exception",
          "new_api": "noreturn",
          "old_text": "Exception(\"Cannot apply function normalizeUTF8 to fixed string.\", ErrorCodes::ILLEGAL_COLUMN)",
          "new_text": "noreturn",
          "old_line_content": "        throw Exception(\"Cannot apply function normalizeUTF8 to fixed string.\", ErrorCodes::ILLEGAL_COLUMN);",
          "new_line_content": "    [[noreturn]] static void vectorFixed(const ColumnString::Chars &, size_t, ColumnString::Chars &)",
          "content_same": false
        },
        {
          "line": 174,
          "old_api": "factory.registerFunction<FunctionNormalizeUTF8NFKC>()",
          "new_api": "factory.registerFunction<FunctionNormalizeUTF8NFC>()",
          "old_text": "factory.registerFunction<FunctionNormalizeUTF8NFKC>()",
          "new_text": "factory.registerFunction<FunctionNormalizeUTF8NFC>()",
          "old_line_content": "    factory.registerFunction<FunctionNormalizeUTF8NFKC>();",
          "new_line_content": "    factory.registerFunction<FunctionNormalizeUTF8NFC>();",
          "content_same": false
        },
        {
          "line": 175,
          "old_api": "factory.registerFunction<FunctionNormalizeUTF8NFKD>()",
          "new_api": "factory.registerFunction<FunctionNormalizeUTF8NFD>()",
          "old_text": "factory.registerFunction<FunctionNormalizeUTF8NFKD>()",
          "new_text": "factory.registerFunction<FunctionNormalizeUTF8NFD>()",
          "old_line_content": "    factory.registerFunction<FunctionNormalizeUTF8NFKD>();",
          "new_line_content": "    factory.registerFunction<FunctionNormalizeUTF8NFD>();",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 128,
          "old_api": null,
          "new_api": "data",
          "old_text": null,
          "new_text": "to_uchars.data()",
          "old_line_content": "                &err);",
          "new_line_content": "                to_uchars.data(),",
          "content_same": false
        },
        {
          "line": 162,
          "old_api": null,
          "new_api": "Exception",
          "old_text": null,
          "new_text": "Exception(\"Cannot apply function normalizeUTF8 to fixed string.\", ErrorCodes::ILLEGAL_COLUMN)",
          "old_line_content": "};",
          "new_line_content": "        throw Exception(\"Cannot apply function normalizeUTF8 to fixed string.\", ErrorCodes::ILLEGAL_COLUMN);",
          "content_same": false
        },
        {
          "line": 131,
          "old_api": null,
          "new_api": "U_FAILURE",
          "old_text": null,
          "new_text": "U_FAILURE(err)",
          "old_line_content": "",
          "new_line_content": "            if (U_FAILURE(err))",
          "content_same": false
        },
        {
          "line": 132,
          "old_api": null,
          "new_api": "u_errorName",
          "old_text": null,
          "new_text": "u_errorName(err)",
          "old_line_content": "            size_t max_to_size = current_to_offset + 4 * to_code_points + 1;",
          "new_line_content": "                throw Exception(ErrorCodes::CANNOT_NORMALIZE_STRING, \"Normalization failed (normalize): {}\", u_errorName(err));",
          "content_same": false
        },
        {
          "line": 98,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "data.size()",
          "old_line_content": "        ColumnString::Offset current_from_offset = 0;",
          "new_line_content": "        res_data.reserve(data.size() * 2);",
          "content_same": false
        },
        {
          "line": 135,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "res_data.size()",
          "old_line_content": "",
          "new_line_content": "            if (res_data.size() < max_to_size)",
          "content_same": false
        },
        {
          "line": 136,
          "old_api": null,
          "new_api": "resize",
          "old_text": null,
          "new_text": "res_data.resize(max_to_size)",
          "old_line_content": "            int32_t to_size = 0;",
          "new_line_content": "                res_data.resize(max_to_size);",
          "content_same": false
        },
        {
          "line": 140,
          "old_api": null,
          "new_api": "reinterpret_cast<char*>(&res_data[current_to_offset])",
          "old_text": null,
          "new_text": "reinterpret_cast<char*>(&res_data[current_to_offset])",
          "old_line_content": "                &to_size,",
          "new_line_content": "                reinterpret_cast<char*>(&res_data[current_to_offset]),",
          "content_same": false
        },
        {
          "line": 143,
          "old_api": null,
          "new_api": "data",
          "old_text": null,
          "new_text": "to_uchars.data()",
          "old_line_content": "                &err);",
          "new_line_content": "                to_uchars.data(),",
          "content_same": false
        },
        {
          "line": 176,
          "old_api": null,
          "new_api": "factory.registerFunction<FunctionNormalizeUTF8NFKC>()",
          "old_text": null,
          "new_text": "factory.registerFunction<FunctionNormalizeUTF8NFKC>()",
          "old_line_content": "}",
          "new_line_content": "    factory.registerFunction<FunctionNormalizeUTF8NFKC>();",
          "content_same": false
        },
        {
          "line": 177,
          "old_api": null,
          "new_api": "factory.registerFunction<FunctionNormalizeUTF8NFKD>()",
          "old_text": null,
          "new_text": "factory.registerFunction<FunctionNormalizeUTF8NFKD>()",
          "old_line_content": "",
          "new_line_content": "    factory.registerFunction<FunctionNormalizeUTF8NFKD>();",
          "content_same": false
        },
        {
          "line": 146,
          "old_api": null,
          "new_api": "U_FAILURE",
          "old_text": null,
          "new_text": "U_FAILURE(err)",
          "old_line_content": "",
          "new_line_content": "            if (U_FAILURE(err))",
          "content_same": false
        },
        {
          "line": 147,
          "old_api": null,
          "new_api": "u_errorName",
          "old_text": null,
          "new_text": "u_errorName(err)",
          "old_line_content": "            current_to_offset += to_size;",
          "new_line_content": "                throw Exception(ErrorCodes::CANNOT_NORMALIZE_STRING, \"Normalization failed (strToUTF8): {}\", u_errorName(err));",
          "content_same": false
        },
        {
          "line": 113,
          "old_api": null,
          "new_api": "data",
          "old_text": null,
          "new_text": "from_uchars.data()",
          "old_line_content": "                &from_code_points,",
          "new_line_content": "                from_uchars.data(),",
          "content_same": false
        },
        {
          "line": 116,
          "old_api": null,
          "new_api": "reinterpret_cast<const char*>(&data[current_from_offset])",
          "old_text": null,
          "new_text": "reinterpret_cast<const char*>(&data[current_from_offset])",
          "old_line_content": "                &err);",
          "new_line_content": "                reinterpret_cast<const char*>(&data[current_from_offset]),",
          "content_same": false
        },
        {
          "line": 119,
          "old_api": null,
          "new_api": "U_FAILURE",
          "old_text": null,
          "new_text": "U_FAILURE(err)",
          "old_line_content": "",
          "new_line_content": "            if (U_FAILURE(err))",
          "content_same": false
        },
        {
          "line": 157,
          "old_api": null,
          "new_api": "resize",
          "old_text": null,
          "new_text": "res_data.resize(current_to_offset)",
          "old_line_content": "",
          "new_line_content": "        res_data.resize(current_to_offset);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 130,
          "old_api": "u_errorName",
          "new_api": null,
          "old_text": "u_errorName(err)",
          "new_text": null,
          "old_line_content": "                throw Exception(ErrorCodes::CANNOT_NORMALIZE_STRING, \"Normalization failed (normalize): {}\", u_errorName(err));",
          "new_line_content": "                &err);",
          "content_same": false
        },
        {
          "line": 133,
          "old_api": "size",
          "new_api": null,
          "old_text": "res_data.size()",
          "new_text": null,
          "old_line_content": "            if (res_data.size() < max_to_size)",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 134,
          "old_api": "resize",
          "new_api": null,
          "old_text": "res_data.resize(max_to_size)",
          "new_text": null,
          "old_line_content": "                res_data.resize(max_to_size);",
          "new_line_content": "            size_t max_to_size = current_to_offset + 4 * to_code_points + 1;",
          "content_same": false
        },
        {
          "line": 137,
          "old_api": "size",
          "new_api": null,
          "old_text": "u_strToUTF8(\n                reinterpret_cast<char*>(&res_data[current_to_offset]),\n                res_data.size() - current_to_offset,\n                &to_size,\n                to_uchars.data(),\n                to_code_points,\n                &err)",
          "new_text": null,
          "old_line_content": "            u_strToUTF8(",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 138,
          "old_api": "reinterpret_cast<char*>(&res_data[current_to_offset])",
          "new_api": null,
          "old_text": "reinterpret_cast<char*>(&res_data[current_to_offset])",
          "new_text": null,
          "old_line_content": "                reinterpret_cast<char*>(&res_data[current_to_offset]),",
          "new_line_content": "            int32_t to_size = 0;",
          "content_same": false
        },
        {
          "line": 172,
          "old_api": "factory.registerFunction<FunctionNormalizeUTF8NFC>()",
          "new_api": null,
          "old_text": "factory.registerFunction<FunctionNormalizeUTF8NFC>()",
          "new_text": null,
          "old_line_content": "    factory.registerFunction<FunctionNormalizeUTF8NFC>();",
          "new_line_content": "void registerFunctionNormalizeUTF8(FunctionFactory & factory)",
          "content_same": false
        },
        {
          "line": 173,
          "old_api": "factory.registerFunction<FunctionNormalizeUTF8NFD>()",
          "new_api": null,
          "old_text": "factory.registerFunction<FunctionNormalizeUTF8NFD>()",
          "new_text": null,
          "old_line_content": "    factory.registerFunction<FunctionNormalizeUTF8NFD>();",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 108,
          "old_api": "resize",
          "new_api": null,
          "old_text": "from_uchars.resize(from_size + 1)",
          "new_text": null,
          "old_line_content": "            from_uchars.resize(from_size + 1);",
          "new_line_content": "            size_t from_size = offsets[i] - current_from_offset - 1;",
          "content_same": false
        },
        {
          "line": 111,
          "old_api": "data",
          "new_api": null,
          "old_text": "from_uchars.data()",
          "new_text": null,
          "old_line_content": "                from_uchars.data(),",
          "new_line_content": "            int32_t from_code_points = 0;",
          "content_same": false
        },
        {
          "line": 144,
          "old_api": "U_FAILURE",
          "new_api": null,
          "old_text": "U_FAILURE(err)",
          "new_text": null,
          "old_line_content": "            if (U_FAILURE(err))",
          "new_line_content": "                to_code_points,",
          "content_same": false
        },
        {
          "line": 145,
          "old_api": "u_errorName",
          "new_api": null,
          "old_text": "u_errorName(err)",
          "new_text": null,
          "old_line_content": "                throw Exception(ErrorCodes::CANNOT_NORMALIZE_STRING, \"Normalization failed (strToUTF8): {}\", u_errorName(err));",
          "new_line_content": "                &err);",
          "content_same": false
        },
        {
          "line": 117,
          "old_api": "U_FAILURE",
          "new_api": null,
          "old_text": "U_FAILURE(err)",
          "new_text": null,
          "old_line_content": "            if (U_FAILURE(err))",
          "new_line_content": "                from_size,",
          "content_same": false
        },
        {
          "line": 118,
          "old_api": "u_errorName",
          "new_api": null,
          "old_text": "u_errorName(err)",
          "new_text": null,
          "old_line_content": "                throw Exception(ErrorCodes::CANNOT_NORMALIZE_STRING, \"Normalization failed (strFromUTF8): {}\", u_errorName(err));",
          "new_line_content": "                &err);",
          "content_same": false
        },
        {
          "line": 155,
          "old_api": "resize",
          "new_api": null,
          "old_text": "res_data.resize(current_to_offset)",
          "new_text": null,
          "old_line_content": "        res_data.resize(current_to_offset);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 158,
          "old_api": "noreturn",
          "new_api": null,
          "old_text": "noreturn",
          "new_text": null,
          "old_line_content": "    [[noreturn]] static void vectorFixed(const ColumnString::Chars &, size_t, ColumnString::Chars &)",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 127,
          "old_api": "size",
          "new_api": null,
          "old_text": "to_uchars.size()",
          "new_text": null,
          "old_line_content": "                to_uchars.size(),",
          "new_line_content": "                from_code_points,",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 10,
      "total_additions": 17,
      "total_deletions": 16,
      "total_api_changes": 43
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 2,
        "api_related_lines": 43,
        "non_api_lines": 1,
        "non_api_line_numbers": [
          99
        ]
      }
    },
    "api_calls_before": 50,
    "api_calls_after": 52,
    "diff_info": {
      "added_lines": 2,
      "removed_lines": 0,
      "total_diff_lines": 14
    }
  }
}