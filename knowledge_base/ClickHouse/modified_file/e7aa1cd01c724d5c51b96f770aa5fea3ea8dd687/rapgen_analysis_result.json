{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ClickHouse/modified_file/e7aa1cd01c724d5c51b96f770aa5fea3ea8dd687",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ClickHouse/modified_file/e7aa1cd01c724d5c51b96f770aa5fea3ea8dd687/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ClickHouse/modified_file/e7aa1cd01c724d5c51b96f770aa5fea3ea8dd687/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ClickHouse/modified_file/e7aa1cd01c724d5c51b96f770aa5fea3ea8dd687/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 137,
          "old_api": "E2<4>(data, offsets, istr, limit)",
          "new_api": "onstexpr auto avg_value_",
          "old_text": "E2<4>(data, offsets, istr, limit)",
          "new_text": "onstexpr auto avg_value_",
          "old_line_content": "\tdata.reserve(data.size() + std::ceil(limit * avg_chars_size));",
          "new_line_content": "\tColumnString::Chars_t & data = column_string.getChars();",
          "content_same": false
        },
        {
          "line": 154,
          "old_api": "ignString",
          "new_api": "istr, limit);\n\telse\n\t\tdeserializeBinarySSE2<1>(data,",
          "old_text": "ignString(\"\", 0);\n\treadStr",
          "new_text": "istr, limit);\n\telse\n\t\tdeserializeBinarySSE2<1>(data,",
          "old_line_content": "\twriteString(get<const String &>(field), ostr);",
          "new_line_content": "\t\tdeserializeBinarySSE2<3>(data, offsets, istr, limit);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 136,
          "old_api": null,
          "new_api": "ts_t & offsets = column_string.getO",
          "old_text": null,
          "new_text": "ts_t & offsets = column_string.getO",
          "old_line_content": "",
          "new_line_content": "\tColumnString & column_string = typeid_cast<ColumnString &>(column);",
          "content_same": false
        },
        {
          "line": 138,
          "old_api": null,
          "new_api": "ouble avg_chars_size = (av",
          "old_text": null,
          "new_text": "ouble avg_chars_size = (av",
          "old_line_content": "",
          "new_line_content": "\tColumnString::Offsets_t & offsets = column_string.getOffsets();",
          "content_same": false
        },
        {
          "line": 141,
          "old_api": null,
          "new_api": "nt > size",
          "old_text": null,
          "new_text": "nt > size",
          "old_line_content": "\tif (avg_chars_size >= 64)",
          "new_line_content": "\tconstexpr auto avg_value_size_hint_reserve_multiplier = 1.2;",
          "content_same": false
        },
        {
          "line": 147,
          "old_api": null,
          "new_api": "E2<4>(data, offsets, istr, limit)",
          "old_text": null,
          "new_text": "E2<4>(data, offsets, istr, limit)",
          "old_line_content": "\telse",
          "new_line_content": "\tdata.reserve(data.size() + std::ceil(limit * avg_chars_size));",
          "content_same": false
        },
        {
          "line": 149,
          "old_api": null,
          "new_api": "_size >= 48)",
          "old_text": null,
          "new_text": "_size >= 48)\n\t",
          "old_line_content": "}",
          "new_line_content": "\toffsets.reserve(offsets.size() + limit);",
          "content_same": false
        },
        {
          "line": 152,
          "old_api": null,
          "new_api": "istr, limit);\n\telse if (avg_chars_size >= 32)\n\t\tdese",
          "old_text": null,
          "new_text": "istr, limit);\n\telse if (avg_chars_size >= 32)\n\t\tdese",
          "old_line_content": "void DataTypeString::serializeText(const Field & field, WriteBuffer & ostr) const",
          "new_line_content": "\t\tdeserializeBinarySSE2<4>(data, offsets, istr, limit);",
          "content_same": false
        },
        {
          "line": 156,
          "old_api": null,
          "new_api": "aTypeString::serializeText(const Field & field, Writ",
          "old_text": null,
          "new_text": "aTypeString::serializeText(const Field & field, Writ",
          "old_line_content": "",
          "new_line_content": "\t\tdeserializeBinarySSE2<2>(data, offsets, istr, limit);",
          "content_same": false
        },
        {
          "line": 158,
          "old_api": null,
          "new_api": "ostr) const\n{\n\twriteString(get<const String &>(field",
          "old_text": null,
          "new_text": "ostr) const\n{\n\twriteString(get<const String &>(field",
          "old_line_content": "void DataTypeString::deserializeText(Field & field, ReadBuffer & istr) const",
          "new_line_content": "\t\tdeserializeBinarySSE2<1>(data, offsets, istr, limit);",
          "content_same": false
        },
        {
          "line": 164,
          "old_api": null,
          "new_api": "ignString",
          "old_text": null,
          "new_text": "ignString(\"\", 0);\n\treadStr",
          "old_line_content": "",
          "new_line_content": "\twriteString(get<const String &>(field), ostr);",
          "content_same": false
        },
        {
          "line": 170,
          "old_api": null,
          "new_api": "field, WriteBuffer & ostr",
          "old_text": null,
          "new_text": "field, WriteBuffer & ostr",
          "old_line_content": "",
          "new_line_content": "\tfield.assignString(\"\", 0);",
          "content_same": false
        },
        {
          "line": 171,
          "old_api": null,
          "new_api": "teEscapedString",
          "old_text": null,
          "new_text": "teEscapedString(get<",
          "old_line_content": "void DataTypeString::deserializeTextEscaped(Field & field, ReadBuffer & istr) const",
          "new_line_content": "\treadString(get<String &>(field), istr);",
          "content_same": false
        },
        {
          "line": 177,
          "old_api": null,
          "new_api": "assignString",
          "old_text": null,
          "new_text": "eld.assignString(\"\", 0);\n\t",
          "old_line_content": "",
          "new_line_content": "\twriteEscapedString(get<const String &>(field), ostr);",
          "content_same": false
        },
        {
          "line": 183,
          "old_api": null,
          "new_api": "eld & field, WriteBuffer",
          "old_text": null,
          "new_text": "eld & field, WriteBuffer ",
          "old_line_content": "",
          "new_line_content": "\tfield.assignString(\"\", 0);",
          "content_same": false
        },
        {
          "line": 184,
          "old_api": null,
          "new_api": "eQuotedString",
          "old_text": null,
          "new_text": "eQuotedString(get<co",
          "old_line_content": "void DataTypeString::deserializeTextQuoted(Field & field, ReadBuffer & istr) const",
          "new_line_content": "\treadEscapedString(get<String &>(field), istr);",
          "content_same": false
        },
        {
          "line": 190,
          "old_api": null,
          "new_api": "assignString",
          "old_text": null,
          "new_text": "ld.assignString(\"\", 0);\n\tr",
          "old_line_content": "",
          "new_line_content": "\twriteQuotedString(get<const String &>(field), ostr);",
          "content_same": false
        },
        {
          "line": 196,
          "old_api": null,
          "new_api": "& field, WriteBuffer & o",
          "old_text": null,
          "new_text": " & field, WriteBuffer & o",
          "old_line_content": "",
          "new_line_content": "\tfield.assignString(\"\", 0);",
          "content_same": false
        },
        {
          "line": 197,
          "old_api": null,
          "new_api": "SONString",
          "old_text": null,
          "new_text": "SONString(get<const ",
          "old_line_content": "ColumnPtr DataTypeString::createColumn() const",
          "new_line_content": "\treadQuotedString(get<String &>(field), istr);",
          "content_same": false
        },
        {
          "line": 203,
          "old_api": null,
          "new_api": "DataTypeString::createCons",
          "old_text": null,
          "new_text": "DataTypeString::createCons",
          "old_line_content": "ColumnPtr DataTypeString::createConstColumn(size_t size, const Field & field) const",
          "new_line_content": "\twriteJSONString(get<const String &>(field), ostr);",
          "content_same": false
        },
        {
          "line": 215,
          "old_api": null,
          "new_api": "",
          "old_text": null,
          "new_text": "",
          "old_line_content": "",
          "new_line_content": "\treturn new ColumnConst<String>(size, get<const String &>(field));",
          "content_same": false
        },
        {
          "line": 121,
          "old_api": null,
          "new_api": "ize);\n\t\t\t}\n\t\t}",
          "old_text": null,
          "new_text": "ize);\n\t\t\t}\n\t\t}\n",
          "old_line_content": "}",
          "new_line_content": "\t\t\t\tistr.position() += size;",
          "content_same": false
        },
        {
          "line": 125,
          "old_api": null,
          "new_api": "ing::deserializeBinary(IColumn & column, ReadBuff",
          "old_text": null,
          "new_text": "ing::deserializeBinary(IColumn & column, ReadBuff",
          "old_line_content": "{",
          "new_line_content": "\t\t\t\tistr.readStrict(reinterpret_cast<char*>(&data[offset - size - 1]), size);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 128,
          "old_api": "ouble avg_chars_size = (av",
          "new_api": null,
          "old_text": "ouble avg_chars_size = (av",
          "new_text": null,
          "old_line_content": "\tColumnString::Offsets_t & offsets = column_string.getOffsets();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 131,
          "old_api": "nt > size",
          "new_api": null,
          "old_text": "nt > size",
          "new_text": null,
          "old_line_content": "\tconstexpr auto avg_value_size_hint_reserve_multiplier = 1.2;",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 139,
          "old_api": "_size >= 48)",
          "new_api": null,
          "old_text": "_size >= 48)\n\t",
          "new_text": null,
          "old_line_content": "\toffsets.reserve(offsets.size() + limit);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 142,
          "old_api": "istr, limit);\n\telse if (avg_chars_size >= 32)\n\t\tdese",
          "new_api": null,
          "old_text": "istr, limit);\n\telse if (avg_chars_size >= 32)\n\t\tdese",
          "new_text": null,
          "old_line_content": "\t\tdeserializeBinarySSE2<4>(data, offsets, istr, limit);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 144,
          "old_api": "istr, limit);\n\telse\n\t\tdeserializeBinarySSE2<1>(data,",
          "new_api": null,
          "old_text": "istr, limit);\n\telse\n\t\tdeserializeBinarySSE2<1>(data,",
          "new_text": null,
          "old_line_content": "\t\tdeserializeBinarySSE2<3>(data, offsets, istr, limit);",
          "new_line_content": "\t\t? (avg_value_size_hint - sizeof(offsets[0])) * avg_value_size_hint_reserve_multiplier",
          "content_same": false
        },
        {
          "line": 146,
          "old_api": "aTypeString::serializeText(const Field & field, Writ",
          "new_api": null,
          "old_text": "aTypeString::serializeText(const Field & field, Writ",
          "new_text": null,
          "old_line_content": "\t\tdeserializeBinarySSE2<2>(data, offsets, istr, limit);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 148,
          "old_api": "ostr) const\n{\n\twriteString(get<const String &>(field",
          "new_api": null,
          "old_text": "ostr) const\n{\n\twriteString(get<const String &>(field",
          "new_text": null,
          "old_line_content": "\t\tdeserializeBinarySSE2<1>(data, offsets, istr, limit);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 160,
          "old_api": "field, WriteBuffer & ostr",
          "new_api": null,
          "old_text": "field, WriteBuffer & ostr",
          "new_text": null,
          "old_line_content": "\tfield.assignString(\"\", 0);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 161,
          "old_api": "teEscapedString",
          "new_api": null,
          "old_text": "teEscapedString(get<",
          "new_text": null,
          "old_line_content": "\treadString(get<String &>(field), istr);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 167,
          "old_api": "assignString",
          "new_api": null,
          "old_text": "eld.assignString(\"\", 0);\n\t",
          "new_text": null,
          "old_line_content": "\twriteEscapedString(get<const String &>(field), ostr);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 173,
          "old_api": "eld & field, WriteBuffer",
          "new_api": null,
          "old_text": "eld & field, WriteBuffer ",
          "new_text": null,
          "old_line_content": "\tfield.assignString(\"\", 0);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 174,
          "old_api": "eQuotedString",
          "new_api": null,
          "old_text": "eQuotedString(get<co",
          "new_text": null,
          "old_line_content": "\treadEscapedString(get<String &>(field), istr);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 180,
          "old_api": "assignString",
          "new_api": null,
          "old_text": "ld.assignString(\"\", 0);\n\tr",
          "new_text": null,
          "old_line_content": "\twriteQuotedString(get<const String &>(field), ostr);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 186,
          "old_api": "& field, WriteBuffer & o",
          "new_api": null,
          "old_text": " & field, WriteBuffer & o",
          "new_text": null,
          "old_line_content": "\tfield.assignString(\"\", 0);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 187,
          "old_api": "SONString",
          "new_api": null,
          "old_text": "SONString(get<const ",
          "new_text": null,
          "old_line_content": "\treadQuotedString(get<String &>(field), istr);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 193,
          "old_api": "DataTypeString::createCons",
          "new_api": null,
          "old_text": "DataTypeString::createCons",
          "new_text": null,
          "old_line_content": "\twriteJSONString(get<const String &>(field), ostr);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 205,
          "old_api": "",
          "new_api": null,
          "old_text": "",
          "new_text": null,
          "old_line_content": "\treturn new ColumnConst<String>(size, get<const String &>(field));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 105,
          "old_api": "position",
          "new_api": null,
          "old_text": "istr.position() += size;\n\t\t\t}\n\t\t",
          "new_text": null,
          "old_line_content": "\t\t\t\t\t\t_mm_storeu_si128(sse_dst_pos + j, _mm_loadu_si128(sse_src_pos + j));",
          "new_line_content": "\t\t\t\t\t///\t_mm_storeu_si128(sse_dst_pos + j, _mm_loadu_si128(sse_src_pos + j));",
          "content_same": false
        },
        {
          "line": 111,
          "old_api": "ize);\n\t\t\t}\n\t\t}",
          "new_api": null,
          "old_text": "ize);\n\t\t\t}\n\t\t}\n",
          "new_text": null,
          "old_line_content": "\t\t\t\tistr.position() += size;",
          "new_line_content": "\t\t\t\t\tif (UNROLL_TIMES >= 2) __asm__(\"movdqu %0, %%xmm1\" :: \"m\"(sse_src_pos[-2]));",
          "content_same": false
        },
        {
          "line": 115,
          "old_api": "ing::deserializeBinary(IColumn & column, ReadBuff",
          "new_api": null,
          "old_text": "ing::deserializeBinary(IColumn & column, ReadBuff",
          "new_text": null,
          "old_line_content": "\t\t\t\tistr.readStrict(reinterpret_cast<char*>(&data[offset - size - 1]), size);",
          "new_line_content": "\t\t\t\t\tif (UNROLL_TIMES >= 3) __asm__(\"movdqu %%xmm0, %0\" : \"=m\"(sse_dst_pos[-3]));",
          "content_same": false
        },
        {
          "line": 126,
          "old_api": "ts_t & offsets = column_string.getO",
          "new_api": null,
          "old_text": "ts_t & offsets = column_string.getO",
          "new_text": null,
          "old_line_content": "\tColumnString & column_string = typeid_cast<ColumnString &>(column);",
          "new_line_content": "\t\t\t}",
          "content_same": false
        },
        {
          "line": 127,
          "old_api": "onstexpr auto avg_value_",
          "new_api": null,
          "old_text": "onstexpr auto avg_value_",
          "new_text": null,
          "old_line_content": "\tColumnString::Chars_t & data = column_string.getChars();",
          "new_line_content": "\t\t}",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 2,
      "total_additions": 21,
      "total_deletions": 22,
      "total_api_changes": 45
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 12,
        "api_related_lines": 45,
        "non_api_lines": 9,
        "non_api_line_numbers": [
          104,
          109,
          110,
          112,
          113,
          114,
          116,
          117,
          118
        ]
      }
    },
    "api_calls_before": 67,
    "api_calls_after": 65,
    "diff_info": {
      "added_lines": 12,
      "removed_lines": 2,
      "total_diff_lines": 29
    }
  }
}