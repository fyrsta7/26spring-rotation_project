{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ClickHouse/modified_file/72719584eacff24d74117703dae1c3aa43f72acc",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ClickHouse/modified_file/72719584eacff24d74117703dae1c3aa43f72acc/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ClickHouse/modified_file/72719584eacff24d74117703dae1c3aa43f72acc/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ClickHouse/modified_file/72719584eacff24d74117703dae1c3aa43f72acc/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 336,
          "old_api": "simplePushDownOverStep<SortingStep>(parent_node, nodes, child)",
          "new_api": "get",
          "old_text": "simplePushDownOverStep<SortingStep>(parent_node, nodes, child)",
          "new_text": "child.get()",
          "old_line_content": "    if (auto updated_steps = simplePushDownOverStep<SortingStep>(parent_node, nodes, child))",
          "new_line_content": "    if (auto * sorting = typeid_cast<SortingStep *>(child.get()))",
          "content_same": false
        },
        {
          "line": 339,
          "old_api": "simplePushDownOverStep<CreateSetAndFilterOnTheFlyStep>(parent_node, nodes, child)",
          "new_api": "end",
          "old_text": "simplePushDownOverStep<CreateSetAndFilterOnTheFlyStep>(parent_node, nodes, child)",
          "new_text": "sort_description.end()",
          "old_line_content": "    if (auto updated_steps = simplePushDownOverStep<CreateSetAndFilterOnTheFlyStep>(parent_node, nodes, child))",
          "new_line_content": "        auto sort_description_it = std::find_if(sort_description.begin(), sort_description.end(), [&](auto & sort_column_description)",
          "content_same": false
        },
        {
          "line": 346,
          "old_api": "getInputStreams",
          "new_api": "tryAddNewFilterStep",
          "old_text": "child->getInputStreams()",
          "new_text": "tryAddNewFilterStep(parent_node, nodes, allowed_inputs, can_remove_filter)",
          "old_line_content": "        auto union_input_streams = child->getInputStreams();",
          "new_line_content": "        if (auto updated_steps = tryAddNewFilterStep(parent_node, nodes, allowed_inputs, can_remove_filter))",
          "content_same": false
        },
        {
          "line": 357,
          "old_api": "std::swap(parent_node->children, child_node->children)",
          "new_api": "getInputStreams",
          "old_text": "std::swap(parent_node->children, child_node->children)",
          "new_text": "child->getInputStreams()",
          "old_line_content": "        std::swap(parent_node->children, child_node->children);",
          "new_line_content": "        auto union_input_streams = child->getInputStreams();",
          "content_same": false
        },
        {
          "line": 367,
          "old_api": "push_back",
          "new_api": "std::swap(parent, child)",
          "old_text": "filter_node.children.push_back(parent_node->children[i])",
          "new_text": "std::swap(parent, child)",
          "old_line_content": "            filter_node.children.push_back(parent_node->children[i]);",
          "new_line_content": "        std::swap(parent, child);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 384,
          "old_api": null,
          "new_api": "getFilterColumnName",
          "old_text": null,
          "new_text": "filter->getFilterColumnName()",
          "old_line_content": "    return 0;",
          "new_line_content": "                filter->getFilterColumnName(),",
          "content_same": false
        },
        {
          "line": 353,
          "old_api": null,
          "new_api": "get",
          "old_text": null,
          "new_text": "child.get()",
          "old_line_content": "",
          "new_line_content": "    if (auto * union_step = typeid_cast<UnionStep *>(child.get()))",
          "content_same": false
        },
        {
          "line": 382,
          "old_api": null,
          "new_api": "front",
          "old_text": null,
          "new_text": "filter_node.children.front()->step->getOutputStream()",
          "old_line_content": "    }",
          "new_line_content": "                filter_node.children.front()->step->getOutputStream(),",
          "content_same": false
        },
        {
          "line": 385,
          "old_api": null,
          "new_api": "removesFilterColumn",
          "old_text": null,
          "new_text": "filter->removesFilterColumn()",
          "old_line_content": "}",
          "new_line_content": "                filter->removesFilterColumn());",
          "content_same": false
        },
        {
          "line": 359,
          "old_api": null,
          "new_api": "getOutputStream",
          "old_text": null,
          "new_text": "filter->getOutputStream()",
          "old_line_content": "",
          "new_line_content": "            input_stream.header = filter->getOutputStream().header;",
          "content_same": false
        },
        {
          "line": 383,
          "old_api": null,
          "new_api": "getExpression",
          "old_text": null,
          "new_text": "filter->getExpression()->clone()",
          "old_line_content": "",
          "new_line_content": "                filter->getExpression()->clone(),",
          "content_same": false
        },
        {
          "line": 377,
          "old_api": null,
          "new_api": "emplace_back",
          "old_text": null,
          "new_text": "nodes.emplace_back()",
          "old_line_content": "        ///       - Filter - Something",
          "new_line_content": "            auto & filter_node = nodes.emplace_back();",
          "content_same": false
        },
        {
          "line": 365,
          "old_api": null,
          "new_api": "getMaxThreads",
          "old_text": null,
          "new_text": "union_step->getMaxThreads()",
          "old_line_content": "        {",
          "new_line_content": "        child = std::make_unique<UnionStep>(union_input_streams, union_step->getMaxThreads());",
          "content_same": false
        },
        {
          "line": 368,
          "old_api": null,
          "new_api": "std::swap(parent_node->children, child_node->children)",
          "old_text": null,
          "new_text": "std::swap(parent_node->children, child_node->children)",
          "old_line_content": "            parent_node->children[i] = &filter_node;",
          "new_line_content": "        std::swap(parent_node->children, child_node->children);",
          "content_same": false
        },
        {
          "line": 369,
          "old_api": null,
          "new_api": "front",
          "old_text": null,
          "new_text": "child_node->children.front()",
          "old_line_content": "",
          "new_line_content": "        std::swap(parent_node->children.front(), child_node->children.front());",
          "content_same": false
        },
        {
          "line": 338,
          "old_api": null,
          "new_api": "getSortDescription",
          "old_text": null,
          "new_text": "sorting->getSortDescription()",
          "old_line_content": "",
          "new_line_content": "        const auto & sort_description = sorting->getSortDescription();",
          "content_same": false
        },
        {
          "line": 341,
          "old_api": null,
          "new_api": "getFilterColumnName",
          "old_text": null,
          "new_text": "filter->getFilterColumnName()",
          "old_line_content": "",
          "new_line_content": "            return sort_column_description.column_name == filter->getFilterColumnName();",
          "content_same": false
        },
        {
          "line": 343,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "sort_description.end()",
          "old_line_content": "    {",
          "new_line_content": "        bool can_remove_filter = sort_description_it == sort_description.end();",
          "content_same": false
        },
        {
          "line": 345,
          "old_api": null,
          "new_api": "getNames",
          "old_text": null,
          "new_text": "child->getOutputStream().header.getNames()",
          "old_line_content": "        /// We can push down filter and update header.",
          "new_line_content": "        Names allowed_inputs = child->getOutputStream().header.getNames();",
          "content_same": false
        },
        {
          "line": 378,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "filter_node.children.push_back(parent_node->children[i])",
          "old_line_content": "        /// Union - Filter - Something",
          "new_line_content": "            filter_node.children.push_back(parent_node->children[i]);",
          "content_same": false
        },
        {
          "line": 381,
          "old_api": null,
          "new_api": "front",
          "old_text": null,
          "new_text": "std::make_unique<FilterStep>(\n                filter_node.children.front()->step->getOutputStream(),\n                filter->getExpression()->clone(),\n                filter->getFilterColumnName(),\n                filter->removesFilterColumn())",
          "old_line_content": "        return 3;",
          "new_line_content": "            filter_node.step = std::make_unique<FilterStep>(",
          "content_same": false
        },
        {
          "line": 350,
          "old_api": null,
          "new_api": "simplePushDownOverStep<CreateSetAndFilterOnTheFlyStep>(parent_node, nodes, child)",
          "old_text": null,
          "new_text": "simplePushDownOverStep<CreateSetAndFilterOnTheFlyStep>(parent_node, nodes, child)",
          "old_line_content": "        ///                - Something",
          "new_line_content": "    if (auto updated_steps = simplePushDownOverStep<CreateSetAndFilterOnTheFlyStep>(parent_node, nodes, child))",
          "content_same": false
        },
        {
          "line": 375,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "parent_node->children.size()",
          "old_line_content": "        }",
          "new_line_content": "        for (size_t i = 1; i < parent_node->children.size(); ++i)",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 354,
          "old_api": "getMaxThreads",
          "new_api": null,
          "old_text": "union_step->getMaxThreads()",
          "new_text": null,
          "old_line_content": "        child = std::make_unique<UnionStep>(union_input_streams, union_step->getMaxThreads());",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 356,
          "old_api": "std::swap(parent, child)",
          "new_api": null,
          "old_text": "std::swap(parent, child)",
          "new_text": null,
          "old_line_content": "        std::swap(parent, child);",
          "new_line_content": "        /// We can push down filter and update header.",
          "content_same": false
        },
        {
          "line": 358,
          "old_api": "front",
          "new_api": null,
          "old_text": "child_node->children.front()",
          "new_text": null,
          "old_line_content": "        std::swap(parent_node->children.front(), child_node->children.front());",
          "new_line_content": "        for (auto & input_stream : union_input_streams)",
          "content_same": false
        },
        {
          "line": 364,
          "old_api": "size",
          "new_api": null,
          "old_text": "parent_node->children.size()",
          "new_text": null,
          "old_line_content": "        for (size_t i = 1; i < parent_node->children.size(); ++i)",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 366,
          "old_api": "emplace_back",
          "new_api": null,
          "old_text": "nodes.emplace_back()",
          "new_text": null,
          "old_line_content": "            auto & filter_node = nodes.emplace_back();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 370,
          "old_api": "front",
          "new_api": null,
          "old_text": "std::make_unique<FilterStep>(\n                filter_node.children.front()->step->getOutputStream(),\n                filter->getExpression()->clone(),\n                filter->getFilterColumnName(),\n                filter->removesFilterColumn())",
          "new_text": null,
          "old_line_content": "            filter_node.step = std::make_unique<FilterStep>(",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 371,
          "old_api": "front",
          "new_api": null,
          "old_text": "filter_node.children.front()->step->getOutputStream()",
          "new_text": null,
          "old_line_content": "                filter_node.children.front()->step->getOutputStream(),",
          "new_line_content": "        ///       - Filter - Something",
          "content_same": false
        },
        {
          "line": 372,
          "old_api": "getExpression",
          "new_api": null,
          "old_text": "filter->getExpression()->clone()",
          "new_text": null,
          "old_line_content": "                filter->getExpression()->clone(),",
          "new_line_content": "        /// Union - Something",
          "content_same": false
        },
        {
          "line": 373,
          "old_api": "getFilterColumnName",
          "new_api": null,
          "old_text": "filter->getFilterColumnName()",
          "new_text": null,
          "old_line_content": "                filter->getFilterColumnName(),",
          "new_line_content": "        ///       - Something",
          "content_same": false
        },
        {
          "line": 342,
          "old_api": "get",
          "new_api": null,
          "old_text": "child.get()",
          "new_text": null,
          "old_line_content": "    if (auto * union_step = typeid_cast<UnionStep *>(child.get()))",
          "new_line_content": "        });",
          "content_same": false
        },
        {
          "line": 374,
          "old_api": "removesFilterColumn",
          "new_api": null,
          "old_text": "filter->removesFilterColumn()",
          "new_text": null,
          "old_line_content": "                filter->removesFilterColumn());",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 348,
          "old_api": "getOutputStream",
          "new_api": null,
          "old_text": "filter->getOutputStream()",
          "new_text": null,
          "old_line_content": "            input_stream.header = filter->getOutputStream().header;",
          "new_line_content": "    }",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 5,
      "total_additions": 18,
      "total_deletions": 12,
      "total_api_changes": 35
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 13,
        "api_related_lines": 35,
        "non_api_lines": 4,
        "non_api_line_numbers": [
          344,
          337,
          347,
          340
        ]
      }
    },
    "api_calls_before": 161,
    "api_calls_after": 171,
    "diff_info": {
      "added_lines": 13,
      "removed_lines": 2,
      "total_diff_lines": 27
    }
  }
}