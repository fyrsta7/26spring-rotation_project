diff --git a/dbms/src/Storages/MergeTree/MergeTreeDataSelectExecutor.cpp b/dbms/src/Storages/MergeTree/MergeTreeDataSelectExecutor.cpp
index 5b93bf8cca1..f83537bc78e 100644
--- a/dbms/src/Storages/MergeTree/MergeTreeDataSelectExecutor.cpp
+++ b/dbms/src/Storages/MergeTree/MergeTreeDataSelectExecutor.cpp
@@ -60,9 +60,16 @@ BlockInputStreams MergeTreeDataSelectExecutor::read(
 			virt_column_names.push_back(name);
 
 	/// Если в запросе только виртуальные столбцы, надо запросить хотя бы один любой другой.
-	if (real_column_names.size() == 0)
+	if (real_column_names.empty())
 		real_column_names.push_back(ExpressionActions::getSmallestColumn(data.getColumnsList()));
 
+	ASTSelectQuery & select = *typeid_cast<ASTSelectQuery*>(&*query);
+
+	/// Try transferring some condition from WHERE to PREWHERE if enabled and viable
+	if (settings.optimize_move_to_prewhere)
+		if (select.where_expression && !select.prewhere_expression)
+			MergeTreeWhereOptimizer{select, data, column_names_to_return, log};
+
 	Block virtual_columns_block = getBlockWithVirtualColumns(parts);
 
 	/// Если запрошен хотя бы один виртуальный столбец, пробуем индексировать
@@ -104,11 +111,6 @@ BlockInputStreams MergeTreeDataSelectExecutor::read(
 	ASTFunctionPtr filter_function;
 	ExpressionActionsPtr filter_expression;
 
-	ASTSelectQuery & select = *typeid_cast<ASTSelectQuery*>(&*query);
-	if (settings.optimize_move_to_prewhere)
-		if (select.where_expression && !select.prewhere_expression)
-			MergeTreeWhereOptimizer{select, data, column_names_to_return, log};
-
 	if (select.sample_size)
 	{
 		double size = apply_visitor(FieldVisitorConvertToNumber<double>(),
