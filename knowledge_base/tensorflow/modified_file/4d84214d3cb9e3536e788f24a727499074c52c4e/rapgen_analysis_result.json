{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/tensorflow/modified_file/4d84214d3cb9e3536e788f24a727499074c52c4e",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/tensorflow/modified_file/4d84214d3cb9e3536e788f24a727499074c52c4e/before.cc",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/tensorflow/modified_file/4d84214d3cb9e3536e788f24a727499074c52c4e/after.cc",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/tensorflow/modified_file/4d84214d3cb9e3536e788f24a727499074c52c4e/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [],
      "additions": [
        {
          "line": 45,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "nodes_to_root.push_back(cur)",
          "old_line_content": "  }",
          "new_line_content": "    nodes_to_root.push_back(cur);",
          "content_same": false
        },
        {
          "line": 51,
          "old_api": null,
          "new_api": "empty",
          "old_text": null,
          "new_text": "nodes_to_root.empty()",
          "old_line_content": "void MergeColocationGroup(std::unordered_map<string, string>* map,",
          "new_line_content": "  if (!nodes_to_root.empty()) {",
          "content_same": false
        },
        {
          "line": 52,
          "old_api": null,
          "new_api": "pop_back",
          "old_text": null,
          "new_text": "nodes_to_root.pop_back()",
          "old_line_content": "                          const string& left, const string& right) {",
          "new_line_content": "    nodes_to_root.pop_back();",
          "content_same": false
        },
        {
          "line": 65,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "map->end()",
          "old_line_content": "// Use of disjoint set algorithm to build the colocation groups from the input",
          "new_line_content": "  if (map->find(left) == map->end() || map->find(right) == map->end()) {",
          "content_same": false
        },
        {
          "line": 71,
          "old_api": null,
          "new_api": "at",
          "old_text": null,
          "new_text": "map->at(right)",
          "old_line_content": "// the group colocate with the representative node.",
          "new_line_content": "    map->at(right) = left;",
          "content_same": false
        },
        {
          "line": 84,
          "old_api": null,
          "new_api": "constexpr",
          "old_text": null,
          "new_text": "constexpr",
          "old_line_content": "        if (pos == 0) {",
          "new_line_content": "  constexpr char kClassAttr[] = \"_class\";",
          "content_same": false
        },
        {
          "line": 85,
          "old_api": null,
          "new_api": "constexpr",
          "old_text": null,
          "new_text": "constexpr",
          "old_line_content": "          // After we find a colocation, update the colocation groups.",
          "new_line_content": "  constexpr char kColocPrefix[] = \"loc:@\";",
          "content_same": false
        },
        {
          "line": 90,
          "old_api": null,
          "new_api": "node",
          "old_text": null,
          "new_text": "graph->node()",
          "old_line_content": "        }",
          "new_line_content": "  for (const auto& node : graph->node()) {",
          "content_same": false
        },
        {
          "line": 91,
          "old_api": null,
          "new_api": "attr",
          "old_text": null,
          "new_text": "node.attr().find(kClassAttr)",
          "old_line_content": "      }",
          "new_line_content": "    auto iter = node.attr().find(kClassAttr);",
          "content_same": false
        },
        {
          "line": 92,
          "old_api": null,
          "new_api": "has_list",
          "old_text": null,
          "new_text": "iter->second.has_list()",
          "old_line_content": "    }",
          "new_line_content": "    if (iter != node.attr().end() && iter->second.has_list()) {",
          "content_same": false
        },
        {
          "line": 93,
          "old_api": null,
          "new_api": "list",
          "old_text": null,
          "new_text": "iter->second.list().s()",
          "old_line_content": "  }",
          "new_line_content": "      for (const auto& str : iter->second.list().s()) {",
          "content_same": false
        },
        {
          "line": 94,
          "old_api": null,
          "new_api": "find",
          "old_text": null,
          "new_text": "str.find(kColocPrefix)",
          "old_line_content": "",
          "new_line_content": "        size_t pos = str.find(kColocPrefix);",
          "content_same": false
        },
        {
          "line": 97,
          "old_api": null,
          "new_api": "strlen",
          "old_text": null,
          "new_text": "strlen(kColocPrefix)",
          "old_line_content": "  // if the node is in the graph.",
          "new_line_content": "          string colocate_node = str.substr(pos + strlen(kColocPrefix));",
          "content_same": false
        },
        {
          "line": 98,
          "old_api": null,
          "new_api": "name",
          "old_text": null,
          "new_text": "MergeColocationGroup(\n              &coloc_groups, GetColocationGroupRoot(&coloc_groups, node.name()),\n              GetColocationGroupRoot(&coloc_groups, colocate_node))",
          "old_line_content": "  for (const auto& pair : coloc_groups) {",
          "new_line_content": "          MergeColocationGroup(",
          "content_same": false
        },
        {
          "line": 99,
          "old_api": null,
          "new_api": "name",
          "old_text": null,
          "new_text": "node.name()",
          "old_line_content": "    if (pair.first != pair.second) {",
          "new_line_content": "              &coloc_groups, GetColocationGroupRoot(&coloc_groups, node.name()),",
          "content_same": false
        },
        {
          "line": 100,
          "old_api": null,
          "new_api": "GetColocationGroupRoot",
          "old_text": null,
          "new_text": "GetColocationGroupRoot(&coloc_groups, colocate_node)",
          "old_line_content": "      // This is a child node.",
          "new_line_content": "              GetColocationGroupRoot(&coloc_groups, colocate_node));",
          "content_same": false
        },
        {
          "line": 116,
          "old_api": null,
          "new_api": "mutable_list",
          "old_text": null,
          "new_text": "new_value.mutable_list()->add_s(\n            kColocPrefix + GetColocationGroupRoot(&coloc_groups, pair.first))",
          "old_line_content": "      }",
          "new_line_content": "        new_value.mutable_list()->add_s(",
          "content_same": false
        },
        {
          "line": 117,
          "old_api": null,
          "new_api": "GetColocationGroupRoot",
          "old_text": null,
          "new_text": "GetColocationGroupRoot(&coloc_groups, pair.first)",
          "old_line_content": "    }",
          "new_line_content": "            kColocPrefix + GetColocationGroupRoot(&coloc_groups, pair.first));",
          "content_same": false
        },
        {
          "line": 118,
          "old_api": null,
          "new_api": "mutable_attr",
          "old_text": null,
          "new_text": "node->mutable_attr()->erase(kClassAttr)",
          "old_line_content": "  }",
          "new_line_content": "        node->mutable_attr()->erase(kClassAttr);",
          "content_same": false
        },
        {
          "line": 119,
          "old_api": null,
          "new_api": "mutable_attr",
          "old_text": null,
          "new_text": "node->mutable_attr()->insert({kClassAttr, new_value})",
          "old_line_content": "}",
          "new_line_content": "        node->mutable_attr()->insert({kClassAttr, new_value});",
          "content_same": false
        },
        {
          "line": 123,
          "old_api": null,
          "new_api": "GetNode",
          "old_text": null,
          "new_text": "node_map.GetNode(pair.first)",
          "old_line_content": "",
          "new_line_content": "      NodeDef* node = node_map.GetNode(pair.first);",
          "content_same": false
        },
        {
          "line": 126,
          "old_api": null,
          "new_api": "mutable_attr",
          "old_text": null,
          "new_text": "node->mutable_attr()->erase(kClassAttr)",
          "old_line_content": "",
          "new_line_content": "        node->mutable_attr()->erase(kClassAttr);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 54,
          "old_api": "end",
          "new_api": null,
          "old_text": "map->end()",
          "new_text": null,
          "old_line_content": "  if (map->find(left) == map->end() || map->find(right) == map->end()) {",
          "new_line_content": "      (*map)[node] = cur;",
          "content_same": false
        },
        {
          "line": 60,
          "old_api": "at",
          "new_api": null,
          "old_text": "map->at(right)",
          "new_text": null,
          "old_line_content": "    map->at(right) = left;",
          "new_line_content": "// Merge two colocation groups into one.",
          "content_same": false
        },
        {
          "line": 73,
          "old_api": "constexpr",
          "new_api": null,
          "old_text": "constexpr",
          "new_text": null,
          "old_line_content": "  constexpr char kClassAttr[] = \"_class\";",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 74,
          "old_api": "constexpr",
          "new_api": null,
          "old_text": "constexpr",
          "new_text": null,
          "old_line_content": "  constexpr char kColocPrefix[] = \"loc:@\";",
          "new_line_content": "}  // namespace",
          "content_same": false
        },
        {
          "line": 79,
          "old_api": "node",
          "new_api": null,
          "old_text": "graph->node()",
          "new_text": null,
          "old_line_content": "  for (const auto& node : graph->node()) {",
          "new_line_content": "// their colocation groups together. After we traverse all colocation pairs",
          "content_same": false
        },
        {
          "line": 80,
          "old_api": "attr",
          "new_api": null,
          "old_text": "node.attr().find(kClassAttr)",
          "new_text": null,
          "old_line_content": "    auto iter = node.attr().find(kClassAttr);",
          "new_line_content": "// in the graph, we will have several disjoint sets. Then we pick the root node",
          "content_same": false
        },
        {
          "line": 81,
          "old_api": "has_list",
          "new_api": null,
          "old_text": "iter->second.has_list()",
          "new_text": null,
          "old_line_content": "    if (iter != node.attr().end() && iter->second.has_list()) {",
          "new_line_content": "// of each disjoint set as the representative node, and let all other nodes in",
          "content_same": false
        },
        {
          "line": 82,
          "old_api": "list",
          "new_api": null,
          "old_text": "iter->second.list().s()",
          "new_text": null,
          "old_line_content": "      for (const auto& str : iter->second.list().s()) {",
          "new_line_content": "// the group colocate with the representative node.",
          "content_same": false
        },
        {
          "line": 83,
          "old_api": "find",
          "new_api": null,
          "old_text": "str.find(kColocPrefix)",
          "new_text": null,
          "old_line_content": "        size_t pos = str.find(kColocPrefix);",
          "new_line_content": "void ReassignColocation(GraphDef* graph) {",
          "content_same": false
        },
        {
          "line": 86,
          "old_api": "strlen",
          "new_api": null,
          "old_text": "strlen(kColocPrefix)",
          "new_text": null,
          "old_line_content": "          string colocate_node = str.substr(pos + strlen(kColocPrefix));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 87,
          "old_api": "name",
          "new_api": null,
          "old_text": "MergeColocationGroup(\n              &coloc_groups, GetColocationGroupRoot(&coloc_groups, node.name()),\n              GetColocationGroupRoot(&coloc_groups, colocate_node))",
          "new_text": null,
          "old_line_content": "          MergeColocationGroup(",
          "new_line_content": "  // A hashmap that maps from a node name to its parent node name.",
          "content_same": false
        },
        {
          "line": 88,
          "old_api": "name",
          "new_api": null,
          "old_text": "node.name()",
          "new_text": null,
          "old_line_content": "              &coloc_groups, GetColocationGroupRoot(&coloc_groups, node.name()),",
          "new_line_content": "  std::unordered_map<string, string> coloc_groups;",
          "content_same": false
        },
        {
          "line": 89,
          "old_api": "GetColocationGroupRoot",
          "new_api": null,
          "old_text": "GetColocationGroupRoot(&coloc_groups, colocate_node)",
          "new_text": null,
          "old_line_content": "              GetColocationGroupRoot(&coloc_groups, colocate_node));",
          "new_line_content": "  NodeMap node_map(graph);",
          "content_same": false
        },
        {
          "line": 101,
          "old_api": "GetNode",
          "new_api": null,
          "old_text": "node_map.GetNode(pair.first)",
          "new_text": null,
          "old_line_content": "      NodeDef* node = node_map.GetNode(pair.first);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 105,
          "old_api": "mutable_list",
          "new_api": null,
          "old_text": "new_value.mutable_list()->add_s(\n            kColocPrefix + GetColocationGroupRoot(&coloc_groups, pair.first))",
          "new_text": null,
          "old_line_content": "        new_value.mutable_list()->add_s(",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 106,
          "old_api": "GetColocationGroupRoot",
          "new_api": null,
          "old_text": "GetColocationGroupRoot(&coloc_groups, pair.first)",
          "new_text": null,
          "old_line_content": "            kColocPrefix + GetColocationGroupRoot(&coloc_groups, pair.first));",
          "new_line_content": "  // We use the root node of each colocation groups as its representative",
          "content_same": false
        },
        {
          "line": 107,
          "old_api": "mutable_attr",
          "new_api": null,
          "old_text": "node->mutable_attr()->erase(kClassAttr)",
          "new_text": null,
          "old_line_content": "        node->mutable_attr()->erase(kClassAttr);",
          "new_line_content": "  // node. For each node in one group, colocate with the representative node",
          "content_same": false
        },
        {
          "line": 108,
          "old_api": "mutable_attr",
          "new_api": null,
          "old_text": "node->mutable_attr()->insert({kClassAttr, new_value})",
          "new_text": null,
          "old_line_content": "        node->mutable_attr()->insert({kClassAttr, new_value});",
          "new_line_content": "  // if the node is in the graph.",
          "content_same": false
        },
        {
          "line": 115,
          "old_api": "mutable_attr",
          "new_api": null,
          "old_text": "node->mutable_attr()->erase(kClassAttr)",
          "new_text": null,
          "old_line_content": "        node->mutable_attr()->erase(kClassAttr);",
          "new_line_content": "        AttrValue new_value;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 0,
      "total_additions": 22,
      "total_deletions": 19,
      "total_api_changes": 41
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 11,
        "api_related_lines": 41,
        "non_api_lines": 7,
        "non_api_line_numbers": [
          41,
          48,
          49,
          50,
          53,
          55,
          56
        ]
      }
    },
    "api_calls_before": 36,
    "api_calls_after": 39,
    "diff_info": {
      "added_lines": 11,
      "removed_lines": 0,
      "total_diff_lines": 28
    }
  }
}