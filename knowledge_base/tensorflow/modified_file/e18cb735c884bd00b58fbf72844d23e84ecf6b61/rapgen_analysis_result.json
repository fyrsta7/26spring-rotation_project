{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/tensorflow/modified_file/e18cb735c884bd00b58fbf72844d23e84ecf6b61",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/tensorflow/modified_file/e18cb735c884bd00b58fbf72844d23e84ecf6b61/before.h",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/tensorflow/modified_file/e18cb735c884bd00b58fbf72844d23e84ecf6b61/after.h",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/tensorflow/modified_file/e18cb735c884bd00b58fbf72844d23e84ecf6b61/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 111,
          "old_api": "size",
          "new_api": "reinterpret_cast<const T*>(storage_[index].data)",
          "old_text": "storage_.size()",
          "new_text": "reinterpret_cast<const T*>(storage_[index].data)",
          "old_line_content": "  size_t size() const { return storage_.size(); }",
          "new_line_content": "    return *reinterpret_cast<const T*>(storage_[index].data);",
          "content_same": false
        },
        {
          "line": 180,
          "old_api": "assert",
          "new_api": "llvm::ArrayRef<T>(list)",
          "old_text": "assert(index < size_ && \"index out of bounds\")",
          "new_text": "llvm::ArrayRef<T>(list)",
          "old_line_content": "    assert(index < size_ && \"index out of bounds\");",
          "new_line_content": "      : ArgumentsRef(llvm::ArrayRef<T>(list)) {}",
          "content_same": false
        },
        {
          "line": 273,
          "old_api": "end",
          "new_api": "size",
          "old_text": "sizes.end()",
          "new_text": "sizes.size()",
          "old_line_content": "    sizes_and_strides_.append(sizes.begin(), sizes.end());",
          "new_line_content": "      : rank_(sizes.size()), dtype_(dtype), data_(data), offset_(offset) {",
          "content_same": false
        },
        {
          "line": 274,
          "old_api": "end",
          "new_api": "size",
          "old_text": "strides.end()",
          "new_text": "strides.size()",
          "old_line_content": "    sizes_and_strides_.append(strides.begin(), strides.end());",
          "new_line_content": "    assert(sizes.size() == strides.size() && \"invalid sizes and strides pair\");",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 269,
          "old_api": null,
          "new_api": "constexpr",
          "old_text": null,
          "new_text": "constexpr",
          "old_line_content": "             absl::Span<const int64_t> sizes, absl::Span<const int64_t> strides)",
          "new_line_content": "  static constexpr char ID = 0;  // NOLINT",
          "content_same": false
        },
        {
          "line": 275,
          "old_api": null,
          "new_api": "reserve",
          "old_text": null,
          "new_text": "sizes_and_strides_.reserve(2 * rank_)",
          "old_line_content": "  }",
          "new_line_content": "    sizes_and_strides_.reserve(2 * rank_);",
          "content_same": false
        },
        {
          "line": 276,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "sizes.end()",
          "old_line_content": "",
          "new_line_content": "    sizes_and_strides_.append(sizes.begin(), sizes.end());",
          "content_same": false
        },
        {
          "line": 277,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "strides.end()",
          "old_line_content": "  // Constructs MemrefDesc of the given rank and calls user-provided callback to",
          "new_line_content": "    sizes_and_strides_.append(strides.begin(), strides.end());",
          "content_same": false
        },
        {
          "line": 151,
          "old_api": null,
          "new_api": "constexpr",
          "old_text": null,
          "new_text": "constexpr",
          "old_line_content": "  ArgumentsRef() : data_(nullptr), size_(0), stride_(0) {}",
          "new_line_content": "  static constexpr bool is_argument = std::is_base_of_v<Argument, T>;",
          "content_same": false
        },
        {
          "line": 158,
          "old_api": null,
          "new_api": "data",
          "old_text": null,
          "new_text": "args.storage_.data()",
          "old_line_content": "",
          "new_line_content": "      : data_(reinterpret_cast<const Argument*>(args.storage_.data())),",
          "content_same": false
        },
        {
          "line": 159,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "args.size()",
          "old_line_content": "  template <typename T, std::enable_if_t<is_argument<T>>* = nullptr>",
          "new_line_content": "        size_(args.size()),",
          "content_same": false
        },
        {
          "line": 164,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "ref.size()",
          "old_line_content": "  ArgumentsRef(const llvm::SmallVectorImpl<T>& vec)  // NOLINT",
          "new_line_content": "      : data_(ref.data()), size_(ref.size()), stride_(sizeof(T)) {}",
          "content_same": false
        },
        {
          "line": 168,
          "old_api": null,
          "new_api": "llvm::ArrayRef<T>(vec)",
          "old_text": null,
          "new_text": "llvm::ArrayRef<T>(vec)",
          "old_line_content": "  ArgumentsRef(const std::vector<T>& vec)  // NOLINT",
          "new_line_content": "      : ArgumentsRef(llvm::ArrayRef<T>(vec)) {}",
          "content_same": false
        },
        {
          "line": 172,
          "old_api": null,
          "new_api": "llvm::ArrayRef<T>(vec)",
          "old_text": null,
          "new_text": "llvm::ArrayRef<T>(vec)",
          "old_line_content": "  ArgumentsRef(const std::array<T, n>& arr)  // NOLINT",
          "new_line_content": "      : ArgumentsRef(llvm::ArrayRef<T>(vec)) {}",
          "content_same": false
        },
        {
          "line": 176,
          "old_api": null,
          "new_api": "llvm::ArrayRef<T>(arr)",
          "old_text": null,
          "new_text": "llvm::ArrayRef<T>(arr)",
          "old_line_content": "  ArgumentsRef(std::initializer_list<T> list)  // NOLINT",
          "new_line_content": "      : ArgumentsRef(llvm::ArrayRef<T>(arr)) {}",
          "content_same": false
        },
        {
          "line": 183,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(index < size_ && \"index out of bounds\")",
          "old_line_content": "  }",
          "new_line_content": "    assert(index < size_ && \"index out of bounds\");",
          "content_same": false
        },
        {
          "line": 184,
          "old_api": null,
          "new_api": "reinterpret_cast<const std::byte*>(data_)",
          "old_text": null,
          "new_text": "reinterpret_cast<const std::byte*>(data_)",
          "old_line_content": "",
          "new_line_content": "    auto* ptr = reinterpret_cast<const std::byte*>(data_) + index * stride_;",
          "content_same": false
        },
        {
          "line": 185,
          "old_api": null,
          "new_api": "reinterpret_cast<const Argument*>(ptr)",
          "old_text": null,
          "new_text": "reinterpret_cast<const Argument*>(ptr)",
          "old_line_content": "  size_t size() const { return size_; }",
          "new_line_content": "    return *reinterpret_cast<const Argument*>(ptr);",
          "content_same": false
        },
        {
          "line": 313,
          "old_api": null,
          "new_api": "data",
          "old_text": null,
          "new_text": "sizes_and_strides_.data()",
          "old_line_content": "  absl::Span<const int64_t> strides() const {",
          "new_line_content": "    return {sizes_and_strides_.data(), rank_};",
          "content_same": false
        },
        {
          "line": 317,
          "old_api": null,
          "new_api": "data",
          "old_text": null,
          "new_text": "sizes_and_strides_.data()",
          "old_line_content": "  absl::Status Verify(const Type& type) const final;",
          "new_line_content": "    return {sizes_and_strides_.data() + rank_, rank_};",
          "content_same": false
        },
        {
          "line": 339,
          "old_api": null,
          "new_api": "resize",
          "old_text": null,
          "new_text": "sizes_and_strides_.resize(2 * rank_)",
          "old_line_content": "}",
          "new_line_content": "  sizes_and_strides_.resize(2 * rank_);",
          "content_same": false
        },
        {
          "line": 340,
          "old_api": null,
          "new_api": "absl::Span<int64_t>(sizes_and_strides_)",
          "old_text": null,
          "new_text": "absl::Span<int64_t>(sizes_and_strides_)",
          "old_line_content": "",
          "new_line_content": "  auto ref = absl::Span<int64_t>(sizes_and_strides_);",
          "content_same": false
        },
        {
          "line": 213,
          "old_api": null,
          "new_api": "constexpr",
          "old_text": null,
          "new_text": "constexpr",
          "old_line_content": "",
          "new_line_content": "  static constexpr char ID = 0;  // NOLINT",
          "content_same": false
        },
        {
          "line": 341,
          "old_api": null,
          "new_api": "subspan",
          "old_text": null,
          "new_text": "ref.subspan(rank_)",
          "old_line_content": "//===----------------------------------------------------------------------===//",
          "new_line_content": "  initialize(ref.subspan(0, rank_), ref.subspan(rank_));",
          "content_same": false
        },
        {
          "line": 215,
          "old_api": null,
          "new_api": "explicit",
          "old_text": null,
          "new_text": "explicit",
          "old_line_content": "",
          "new_line_content": "  explicit OpaqueArg(void* ptr) : ptr_(ptr) {}",
          "content_same": false
        },
        {
          "line": 236,
          "old_api": null,
          "new_api": "constexpr",
          "old_text": null,
          "new_text": "constexpr",
          "old_line_content": "            std::enable_if_t<kIsOneOf<T, float, int32_t, int64_t>>* = nullptr>",
          "new_line_content": "  static constexpr char ID = 0;  // NOLINT",
          "content_same": false
        },
        {
          "line": 240,
          "old_api": null,
          "new_api": "explicit",
          "old_text": null,
          "new_text": "explicit",
          "old_line_content": "  absl::Status Verify(const Type& type) const final;",
          "new_line_content": "  explicit ScalarArg(T value)",
          "content_same": false
        },
        {
          "line": 241,
          "old_api": null,
          "new_api": "primitive_util::NativeToPrimitiveType<T>()",
          "old_text": null,
          "new_text": "primitive_util::NativeToPrimitiveType<T>()",
          "old_line_content": "  void Pack(absl::Span<void*> args) const final;",
          "new_line_content": "      : type_(primitive_util::NativeToPrimitiveType<T>()), value_(value) {}",
          "content_same": false
        },
        {
          "line": 114,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "storage_.size()",
          "old_line_content": "  friend class ArgumentsRef;",
          "new_line_content": "  size_t size() const { return storage_.size(); }",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 266,
          "old_api": "constexpr",
          "new_api": null,
          "old_text": "constexpr",
          "new_text": null,
          "old_line_content": "  static constexpr char ID = 0;  // NOLINT",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 270,
          "old_api": "size",
          "new_api": null,
          "old_text": "sizes.size()",
          "new_text": null,
          "old_line_content": "      : rank_(sizes.size()), dtype_(dtype), data_(data), offset_(offset) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 271,
          "old_api": "size",
          "new_api": null,
          "old_text": "strides.size()",
          "new_text": null,
          "old_line_content": "    assert(sizes.size() == strides.size() && \"invalid sizes and strides pair\");",
          "new_line_content": "  MemrefDesc(PrimitiveType dtype, void* data, int64_t offset,",
          "content_same": false
        },
        {
          "line": 272,
          "old_api": "reserve",
          "new_api": null,
          "old_text": "sizes_and_strides_.reserve(2 * rank_)",
          "new_text": null,
          "old_line_content": "    sizes_and_strides_.reserve(2 * rank_);",
          "new_line_content": "             absl::Span<const int64_t> sizes, absl::Span<const int64_t> strides)",
          "content_same": false
        },
        {
          "line": 148,
          "old_api": "constexpr",
          "new_api": null,
          "old_text": "constexpr",
          "new_text": null,
          "old_line_content": "  static constexpr bool is_argument = std::is_base_of_v<Argument, T>;",
          "new_line_content": "// and array reference or vector of any argument subtype.",
          "content_same": false
        },
        {
          "line": 155,
          "old_api": "data",
          "new_api": null,
          "old_text": "args.storage_.data()",
          "new_text": null,
          "old_line_content": "      : data_(reinterpret_cast<const Argument*>(args.storage_.data())),",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 156,
          "old_api": "size",
          "new_api": null,
          "old_text": "args.size()",
          "new_text": null,
          "old_line_content": "        size_(args.size()),",
          "new_line_content": "  template <typename... Ts, std::enable_if_t<sizeof...(Ts) != 0>* = nullptr>",
          "content_same": false
        },
        {
          "line": 161,
          "old_api": "size",
          "new_api": null,
          "old_text": "ref.size()",
          "new_text": null,
          "old_line_content": "      : data_(ref.data()), size_(ref.size()), stride_(sizeof(T)) {}",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 165,
          "old_api": "llvm::ArrayRef<T>(vec)",
          "new_api": null,
          "old_text": "llvm::ArrayRef<T>(vec)",
          "new_text": null,
          "old_line_content": "      : ArgumentsRef(llvm::ArrayRef<T>(vec)) {}",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 169,
          "old_api": "llvm::ArrayRef<T>(vec)",
          "new_api": null,
          "old_text": "llvm::ArrayRef<T>(vec)",
          "new_text": null,
          "old_line_content": "      : ArgumentsRef(llvm::ArrayRef<T>(vec)) {}",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 173,
          "old_api": "llvm::ArrayRef<T>(arr)",
          "new_api": null,
          "old_text": "llvm::ArrayRef<T>(arr)",
          "new_text": null,
          "old_line_content": "      : ArgumentsRef(llvm::ArrayRef<T>(arr)) {}",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 177,
          "old_api": "llvm::ArrayRef<T>(list)",
          "new_api": null,
          "old_text": "llvm::ArrayRef<T>(list)",
          "new_text": null,
          "old_line_content": "      : ArgumentsRef(llvm::ArrayRef<T>(list)) {}",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 181,
          "old_api": "reinterpret_cast<const std::byte*>(data_)",
          "new_api": null,
          "old_text": "reinterpret_cast<const std::byte*>(data_)",
          "new_text": null,
          "old_line_content": "    auto* ptr = reinterpret_cast<const std::byte*>(data_) + index * stride_;",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 182,
          "old_api": "reinterpret_cast<const Argument*>(ptr)",
          "new_api": null,
          "old_text": "reinterpret_cast<const Argument*>(ptr)",
          "new_text": null,
          "old_line_content": "    return *reinterpret_cast<const Argument*>(ptr);",
          "new_line_content": "  const Argument& operator[](size_t index) const {",
          "content_same": false
        },
        {
          "line": 310,
          "old_api": "data",
          "new_api": null,
          "old_text": "sizes_and_strides_.data()",
          "new_text": null,
          "old_line_content": "    return {sizes_and_strides_.data(), rank_};",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 314,
          "old_api": "data",
          "new_api": null,
          "old_text": "sizes_and_strides_.data()",
          "new_text": null,
          "old_line_content": "    return {sizes_and_strides_.data() + rank_, rank_};",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 336,
          "old_api": "resize",
          "new_api": null,
          "old_text": "sizes_and_strides_.resize(2 * rank_)",
          "new_text": null,
          "old_line_content": "  sizes_and_strides_.resize(2 * rank_);",
          "new_line_content": "MemrefDesc::MemrefDesc(unsigned rank, PrimitiveType dtype, void* data,",
          "content_same": false
        },
        {
          "line": 337,
          "old_api": "absl::Span<int64_t>(sizes_and_strides_)",
          "new_api": null,
          "old_text": "absl::Span<int64_t>(sizes_and_strides_)",
          "new_text": null,
          "old_line_content": "  auto ref = absl::Span<int64_t>(sizes_and_strides_);",
          "new_line_content": "                       int64_t offset, InitializeSizesAndStrides initialize)",
          "content_same": false
        },
        {
          "line": 210,
          "old_api": "constexpr",
          "new_api": null,
          "old_text": "constexpr",
          "new_text": null,
          "old_line_content": "  static constexpr char ID = 0;  // NOLINT",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 338,
          "old_api": "subspan",
          "new_api": null,
          "old_text": "ref.subspan(rank_)",
          "new_text": null,
          "old_line_content": "  initialize(ref.subspan(0, rank_), ref.subspan(rank_));",
          "new_line_content": "    : rank_(rank), dtype_(dtype), data_(data), offset_(offset) {",
          "content_same": false
        },
        {
          "line": 212,
          "old_api": "explicit",
          "new_api": null,
          "old_text": "explicit",
          "new_text": null,
          "old_line_content": "  explicit OpaqueArg(void* ptr) : ptr_(ptr) {}",
          "new_line_content": " public:",
          "content_same": false
        },
        {
          "line": 230,
          "old_api": "constexpr",
          "new_api": null,
          "old_text": "constexpr",
          "new_text": null,
          "old_line_content": "  static inline constexpr bool kIsOneOf = (std::is_same_v<T, Ts> || ...);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 108,
          "old_api": "reinterpret_cast<const Argument*>(storage_[index].data)",
          "new_api": null,
          "old_text": "reinterpret_cast<const Argument*>(storage_[index].data)",
          "new_text": null,
          "old_line_content": "    return *reinterpret_cast<const Argument*>(storage_[index].data);",
          "new_line_content": "    using T = std::conditional_t<sizeof...(Ts) == 1,",
          "content_same": false
        },
        {
          "line": 237,
          "old_api": "explicit",
          "new_api": null,
          "old_text": "explicit",
          "new_text": null,
          "old_line_content": "  explicit ScalarArg(T value)",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 238,
          "old_api": "primitive_util::NativeToPrimitiveType<T>()",
          "new_api": null,
          "old_text": "primitive_util::NativeToPrimitiveType<T>()",
          "new_text": null,
          "old_line_content": "      : type_(primitive_util::NativeToPrimitiveType<T>()), value_(value) {}",
          "new_line_content": "  template <typename T,",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 4,
      "total_additions": 25,
      "total_deletions": 25,
      "total_api_changes": 54
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 5,
        "api_related_lines": 54,
        "non_api_lines": 3,
        "non_api_line_numbers": [
          107,
          109,
          110
        ]
      }
    },
    "api_calls_before": 58,
    "api_calls_after": 58,
    "diff_info": {
      "added_lines": 5,
      "removed_lines": 2,
      "total_diff_lines": 19
    }
  }
}