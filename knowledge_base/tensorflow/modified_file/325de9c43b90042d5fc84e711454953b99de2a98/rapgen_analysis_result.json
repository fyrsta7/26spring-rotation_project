{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/tensorflow/modified_file/325de9c43b90042d5fc84e711454953b99de2a98",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/tensorflow/modified_file/325de9c43b90042d5fc84e711454953b99de2a98/before.cc",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/tensorflow/modified_file/325de9c43b90042d5fc84e711454953b99de2a98/after.cc",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/tensorflow/modified_file/325de9c43b90042d5fc84e711454953b99de2a98/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 151,
          "old_api": "IsApple",
          "new_api": "push_back",
          "old_text": "gpu_info.IsApple()",
          "new_text": "ordered_axis_to_reduce.push_back(it->first)",
          "old_line_content": "  if (gpu_info.IsApple()) {",
          "new_line_content": "      ordered_axis_to_reduce.push_back(it->first);",
          "content_same": false
        },
        {
          "line": 165,
          "old_api": "std::move(operation)",
          "new_api": "IsApple",
          "old_text": "std::move(operation)",
          "new_text": "gpu_info.IsApple()",
          "old_line_content": "    : GPUOperation(std::move(operation)),",
          "new_line_content": "  if (gpu_info.IsApple()) {",
          "content_same": false
        },
        {
          "line": 196,
          "old_api": "HasAxis",
          "new_api": "AddDstTensor",
          "old_text": "HasAxis(axis_to_reduce, Axis::CHANNELS)",
          "new_text": "AddDstTensor(\"dst_tensor\", op_def.dst_tensors[0])",
          "old_line_content": "  const bool channels_reduction = HasAxis(axis_to_reduce, Axis::CHANNELS);",
          "new_line_content": "  AddDstTensor(\"dst_tensor\", op_def.dst_tensors[0]);",
          "content_same": false
        },
        {
          "line": 210,
          "old_api": "std::to_string(i)",
          "new_api": "HasAxis",
          "old_text": "std::to_string(i)",
          "new_text": "HasAxis(axis_to_reduce, Axis::CHANNELS)",
          "old_line_content": "      return \"GROUP_ID_\" + std::to_string(i);",
          "new_line_content": "  const bool channels_reduction = HasAxis(axis_to_reduce, Axis::CHANNELS);",
          "content_same": false
        },
        {
          "line": 230,
          "old_api": "std::to_string(work_group_size.y)",
          "new_api": "GetDataType",
          "old_text": "std::to_string(work_group_size.y)",
          "new_text": "op_def.src_tensors[0].GetDataType()",
          "old_line_content": "  const std::string wg_y = std::to_string(work_group_size.y);",
          "new_line_content": "  auto accum_type = GetAccumType(op_def.src_tensors[0].GetDataType());",
          "content_same": false
        },
        {
          "line": 289,
          "old_api": "empty",
          "new_api": "count",
          "old_text": "dst_check.empty()",
          "new_text": "axis_to_leave.count(Axis::CHANNELS)",
          "old_line_content": "    if (!dst_check.empty()) {",
          "new_line_content": "  if (axis_to_leave.count(Axis::CHANNELS)) {",
          "content_same": false
        },
        {
          "line": 380,
          "old_api": "empty",
          "new_api": "GetOneValue",
          "old_text": "src_coordinates.empty()",
          "new_text": "GetOneValue(gpu_info, accum_type, 4)",
          "old_line_content": "      if (!src_coordinates.empty()) {",
          "new_line_content": "           \" mask_a = last ? mask : \" + GetOneValue(gpu_info, accum_type, 4) +",
          "content_same": false
        },
        {
          "line": 414,
          "old_api": "std::to_string(remainder)",
          "new_api": "size",
          "old_text": "std::to_string(remainder)",
          "new_text": "axis_to_reduce.size()",
          "old_line_content": "      c += \"  if (local_id < \" + std::to_string(remainder) + \") {\\n\";",
          "new_line_content": "  for (int i = 0; i < axis_to_reduce.size(); ++i) {",
          "content_same": false
        },
        {
          "line": 437,
          "old_api": "std::to_string(offset * i)",
          "new_api": "MakeOp",
          "old_text": "std::to_string(offset * i)",
          "new_text": "MakeOp(op_type, \"reduced\",\n                  \"accum[t + \" + std::to_string(offset * 3) + \"]\")",
          "old_line_content": "                  \"accum[\" + std::to_string(offset * i) + \"]\") +",
          "new_line_content": "           MakeOp(op_type, \"reduced\",",
          "content_same": false
        },
        {
          "line": 484,
          "old_api": "Depth",
          "new_api": "count",
          "old_text": "src_[0]->Depth()",
          "new_text": "axis_to_leave.count(a)",
          "old_line_content": "                                    src_[0]->Height() * src_[0]->Depth() *",
          "new_line_content": "      if (axis_to_leave.count(a)) {",
          "content_same": false
        },
        {
          "line": 497,
          "old_api": "SetFloat",
          "new_api": "Width",
          "old_text": "args->SetFloat(\"inv_multiplier_1\", 1.0 / reduction_size)",
          "new_text": "src_[0]->Width()",
          "old_line_content": "    RETURN_IF_ERROR(args->SetFloat(\"inv_multiplier_1\", 1.0 / reduction_size));",
          "new_line_content": "  const double total_src_elements = 1.0 * src_[0]->Batch() * src_[0]->Width() *",
          "content_same": false
        },
        {
          "line": 498,
          "old_api": "SetFloat",
          "new_api": "Depth",
          "old_text": "args->SetFloat(\"inv_multiplier_2\", 1.0)",
          "new_text": "src_[0]->Depth()",
          "old_line_content": "    RETURN_IF_ERROR(args->SetFloat(\"inv_multiplier_2\", 1.0));",
          "new_line_content": "                                    src_[0]->Height() * src_[0]->Depth() *",
          "content_same": false
        },
        {
          "line": 500,
          "old_api": "absl::OkStatus()",
          "new_api": "Width",
          "old_text": "absl::OkStatus()",
          "new_text": "dst_[0]->Width()",
          "old_line_content": "  return absl::OkStatus();",
          "new_line_content": "  const double total_dst_elements = 1.0 * dst_[0]->Batch() * dst_[0]->Width() *",
          "content_same": false
        },
        {
          "line": 512,
          "old_api": "int3",
          "new_api": "SetFloat",
          "old_text": "int3(grid_x, grid_y, grid_z)",
          "new_text": "args->SetFloat(\"inv_multiplier_2\", 1.0)",
          "old_line_content": "  return int3(grid_x, grid_y, grid_z);",
          "new_line_content": "    RETURN_IF_ERROR(args->SetFloat(\"inv_multiplier_2\", 1.0));",
          "content_same": false
        },
        {
          "line": 520,
          "old_api": "push_back",
          "new_api": "Slices",
          "old_text": "work_groups->push_back(work_group_size_)",
          "new_text": "dst_[0]->Slices()",
          "old_line_content": "    work_groups->push_back(work_group_size_);",
          "new_line_content": "  int grid_z = dst_[0]->Slices();",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 514,
          "old_api": null,
          "new_api": "absl::OkStatus()",
          "old_text": null,
          "new_text": "absl::OkStatus()",
          "old_line_content": "",
          "new_line_content": "  return absl::OkStatus();",
          "content_same": false
        },
        {
          "line": 518,
          "old_api": null,
          "new_api": "Batch",
          "old_text": null,
          "new_text": "dst_[0]->Batch()",
          "old_line_content": "                                         std::vector<int3>* work_groups) const {",
          "new_line_content": "  int grid_x = dst_[0]->Width() * dst_[0]->Batch();",
          "content_same": false
        },
        {
          "line": 519,
          "old_api": null,
          "new_api": "Depth",
          "old_text": null,
          "new_text": "dst_[0]->Depth()",
          "old_line_content": "  if (use_wg_reduction_) {",
          "new_line_content": "  int grid_y = dst_[0]->Height() * dst_[0]->Depth();",
          "content_same": false
        },
        {
          "line": 526,
          "old_api": null,
          "new_api": "int3",
          "old_text": null,
          "new_text": "int3(grid_x, grid_y, grid_z)",
          "old_line_content": "",
          "new_line_content": "  return int3(grid_x, grid_y, grid_z);",
          "content_same": false
        },
        {
          "line": 534,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "work_groups->push_back(work_group_size_)",
          "old_line_content": "Reduce CreateReduce(const std::set<Axis>& axis_to_reduce,",
          "new_line_content": "    work_groups->push_back(work_group_size_);",
          "content_same": false
        },
        {
          "line": 536,
          "old_api": null,
          "new_api": "GetPossibleWorkGroups",
          "old_text": null,
          "new_text": "GetPossibleWorkGroups(tuning_type, gpu_info, kernel_info, grid_size_,\n                          work_groups)",
          "old_line_content": "                    const OperationDef& definition, const GpuInfo& gpu_info) {",
          "new_line_content": "    GetPossibleWorkGroups(tuning_type, gpu_info, kernel_info, grid_size_,",
          "content_same": false
        },
        {
          "line": 544,
          "old_api": null,
          "new_api": "GetSizesFromShape",
          "old_text": null,
          "new_text": "GetSizesFromShape(axis_to_reduce, src_shape)",
          "old_line_content": "",
          "new_line_content": "  return Reduce(GetSizesFromShape(axis_to_reduce, src_shape), op_type,",
          "content_same": false
        },
        {
          "line": 551,
          "old_api": null,
          "new_api": "GetSizesFromShape",
          "old_text": null,
          "new_text": "GetSizesFromShape(axis_to_reduce, src_shape)",
          "old_line_content": "",
          "new_line_content": "  return Reduce(GetSizesFromShape(axis_to_reduce, src_shape), op_type,",
          "content_same": false
        },
        {
          "line": 84,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "ordered_sizes.size()",
          "old_line_content": "      wg_size_total *= 2;",
          "new_line_content": "  for (int i = ordered_sizes.size() - 1; i >= 0; i--) {",
          "content_same": false
        },
        {
          "line": 85,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "ordered_sizes.size()",
          "old_line_content": "      if (wg_size_total > max_total_wg_size) {",
          "new_line_content": "    const int wg_index = ordered_sizes.size() - 1 - i;",
          "content_same": false
        },
        {
          "line": 112,
          "old_api": null,
          "new_api": "get",
          "old_text": null,
          "new_text": "shape.get(a)",
          "old_line_content": "DataType GetAccumType(DataType src_type) {",
          "new_line_content": "    result[a] = shape.get(a);",
          "content_same": false
        },
        {
          "line": 121,
          "old_api": null,
          "new_api": "get",
          "old_text": null,
          "new_text": "shape.get(a)",
          "old_line_content": "  } else {",
          "new_line_content": "    result[a] = shape.get(a);",
          "content_same": false
        },
        {
          "line": 149,
          "old_api": null,
          "new_api": "find",
          "old_text": null,
          "new_text": "axis_to_reduce.find(a)",
          "old_line_content": "      current_wg_size.x * current_wg_size.y * current_wg_size.z;",
          "new_line_content": "    auto it = axis_to_reduce.find(a);",
          "content_same": false
        },
        {
          "line": 150,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "axis_to_reduce.end()",
          "old_line_content": "  int threshold = max_total_wg_size / 4;",
          "new_line_content": "    if (it != axis_to_reduce.end()) {",
          "content_same": false
        },
        {
          "line": 154,
          "old_api": null,
          "new_api": "DivideRoundUp",
          "old_text": null,
          "new_text": "DivideRoundUp(reduction_size, 4)",
          "old_line_content": "  if (current_wg_size_total < threshold) {",
          "new_line_content": "        reduction_size = DivideRoundUp(reduction_size, 4);",
          "content_same": false
        },
        {
          "line": 156,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "ordered_sizes.push_back(reduction_size)",
          "old_line_content": "  } else {",
          "new_line_content": "      ordered_sizes.push_back(reduction_size);",
          "content_same": false
        },
        {
          "line": 159,
          "old_api": null,
          "new_api": "GetMaximumWGTotalSize",
          "old_text": null,
          "new_text": "GetMaximumWGTotalSize(gpu_info)",
          "old_line_content": "  }",
          "new_line_content": "  const int max_total_wg_size = GetMaximumWGTotalSize(gpu_info);",
          "content_same": false
        },
        {
          "line": 161,
          "old_api": null,
          "new_api": "GetMaximumPossibleWGSize",
          "old_text": null,
          "new_text": "GetMaximumPossibleWGSize(ordered_sizes, max_total_wg_size)",
          "old_line_content": "                              ordered_axis_to_reduce, op_type);",
          "new_line_content": "      GetMaximumPossibleWGSize(ordered_sizes, max_total_wg_size);",
          "content_same": false
        },
        {
          "line": 174,
          "old_api": null,
          "new_api": "GetReduceKernelCode",
          "old_text": null,
          "new_text": "GetReduceKernelCode(definition_, gpu_info, work_group_size_,\n                              ordered_axis_to_reduce, op_type)",
          "old_line_content": "}",
          "new_line_content": "  code_ = GetReduceKernelCode(definition_, gpu_info, work_group_size_,",
          "content_same": false
        },
        {
          "line": 179,
          "old_api": null,
          "new_api": "std::move(operation)",
          "old_text": null,
          "new_text": "std::move(operation)",
          "old_line_content": "                                        const std::vector<Axis>& axis_to_reduce,",
          "new_line_content": "    : GPUOperation(std::move(operation)),",
          "content_same": false
        },
        {
          "line": 185,
          "old_api": null,
          "new_api": "std::move(operation)",
          "old_text": null,
          "new_text": "std::move(operation)",
          "old_line_content": "",
          "new_line_content": "    GPUOperation::operator=(std::move(operation));",
          "content_same": false
        },
        {
          "line": 195,
          "old_api": null,
          "new_api": "AddSrcTensor",
          "old_text": null,
          "new_text": "AddSrcTensor(\"src_tensor\", op_def.src_tensors[0])",
          "old_line_content": "  }",
          "new_line_content": "  AddSrcTensor(\"src_tensor\", op_def.src_tensors[0]);",
          "content_same": false
        },
        {
          "line": 197,
          "old_api": null,
          "new_api": "AddFloat",
          "old_text": null,
          "new_text": "args_.AddFloat(\"inv_multiplier_1\")",
          "old_line_content": "  int wg_dims = 0;",
          "new_line_content": "  args_.AddFloat(\"inv_multiplier_1\");",
          "content_same": false
        },
        {
          "line": 198,
          "old_api": null,
          "new_api": "AddFloat",
          "old_text": null,
          "new_text": "args_.AddFloat(\"inv_multiplier_2\")",
          "old_line_content": "  if (use_wg_reduction_) {",
          "new_line_content": "  args_.AddFloat(\"inv_multiplier_2\");",
          "content_same": false
        },
        {
          "line": 204,
          "old_api": null,
          "new_api": "HasAxis",
          "old_text": null,
          "new_text": "op_def.dst_tensors[0].HasAxis(a)",
          "old_line_content": "      wg_dims = 3;",
          "new_line_content": "    if (op_def.dst_tensors[0].HasAxis(a)) {",
          "content_same": false
        },
        {
          "line": 205,
          "old_api": null,
          "new_api": "HasAxis",
          "old_text": null,
          "new_text": "HasAxis(axis_to_reduce, a)",
          "old_line_content": "    }",
          "new_line_content": "      if (!HasAxis(axis_to_reduce, a)) {",
          "content_same": false
        },
        {
          "line": 206,
          "old_api": null,
          "new_api": "insert",
          "old_text": null,
          "new_text": "axis_to_leave.insert(a)",
          "old_line_content": "  }",
          "new_line_content": "        axis_to_leave.insert(a);",
          "content_same": false
        },
        {
          "line": 224,
          "old_api": null,
          "new_api": "std::to_string(i)",
          "old_text": null,
          "new_text": "std::to_string(i)",
          "old_line_content": "  } else if (accum_type == DataType::UINT32) {",
          "new_line_content": "      return \"GROUP_ID_\" + std::to_string(i);",
          "content_same": false
        },
        {
          "line": 226,
          "old_api": null,
          "new_api": "std::to_string(i)",
          "old_text": null,
          "new_text": "std::to_string(i)",
          "old_line_content": "  }",
          "new_line_content": "      return \"GLOBAL_ID_\" + std::to_string(i);",
          "content_same": false
        },
        {
          "line": 232,
          "old_api": null,
          "new_api": "GetTypeDeclaration",
          "old_text": null,
          "new_text": "GetTypeDeclaration(gpu_info, accum_type, 4)",
          "old_line_content": "  const int wg_total_size =",
          "new_line_content": "      GetTypeDeclaration(gpu_info, accum_type, 4);",
          "content_same": false
        },
        {
          "line": 243,
          "old_api": null,
          "new_api": "std::to_string(work_group_size.x)",
          "old_text": null,
          "new_text": "std::to_string(work_group_size.x)",
          "old_line_content": "      c += \"  int local_y = LOCAL_ID_1;\\n\";",
          "new_line_content": "  const std::string wg_x = std::to_string(work_group_size.x);",
          "content_same": false
        },
        {
          "line": 244,
          "old_api": null,
          "new_api": "std::to_string(work_group_size.y)",
          "old_text": null,
          "new_text": "std::to_string(work_group_size.y)",
          "old_line_content": "      c += \"  int local_id = local_y * \" + wg_x + \" + local_x;\\n\";",
          "new_line_content": "  const std::string wg_y = std::to_string(work_group_size.y);",
          "content_same": false
        },
        {
          "line": 245,
          "old_api": null,
          "new_api": "std::to_string(work_group_size.z)",
          "old_text": null,
          "new_text": "std::to_string(work_group_size.z)",
          "old_line_content": "    } else if (wg_dims == 3) {",
          "new_line_content": "  const std::string wg_z = std::to_string(work_group_size.z);",
          "content_same": false
        },
        {
          "line": 251,
          "old_api": null,
          "new_api": "std::to_string(wg_total_size)",
          "old_text": null,
          "new_text": "std::to_string(wg_total_size)",
          "old_line_content": "    }",
          "new_line_content": "         std::to_string(wg_total_size) + \"];\\n\";",
          "content_same": false
        },
        {
          "line": 267,
          "old_api": null,
          "new_api": "count",
          "old_text": null,
          "new_text": "axis_to_leave.count(Axis::WIDTH)",
          "old_line_content": "      c += \"  int DST_Y = linear_id % args.dst_tensor.Height();\\n\";",
          "new_line_content": "  if (axis_to_leave.count(Axis::WIDTH)) {",
          "content_same": false
        },
        {
          "line": 268,
          "old_api": null,
          "new_api": "count",
          "old_text": null,
          "new_text": "axis_to_leave.count(Axis::BATCH)",
          "old_line_content": "      c += \"  int DST_Z = linear_id / args.dst_tensor.Height();\\n\";",
          "new_line_content": "    if (axis_to_leave.count(Axis::BATCH)) {",
          "content_same": false
        },
        {
          "line": 269,
          "old_api": null,
          "new_api": "get_global_id",
          "old_text": null,
          "new_text": "get_global_id(0)",
          "old_line_content": "    } else {",
          "new_line_content": "      c += \"  int linear_id = \" + get_global_id(0) + \";\\n\";",
          "content_same": false
        },
        {
          "line": 278,
          "old_api": null,
          "new_api": "count",
          "old_text": null,
          "new_text": "axis_to_leave.count(Axis::HEIGHT)",
          "old_line_content": "  std::map<Axis, std::string> axis_to_selector = {",
          "new_line_content": "  if (axis_to_leave.count(Axis::HEIGHT)) {",
          "content_same": false
        },
        {
          "line": 279,
          "old_api": null,
          "new_api": "count",
          "old_text": null,
          "new_text": "axis_to_leave.count(Axis::DEPTH)",
          "old_line_content": "      {Axis::BATCH, \"Batch()\"},     {Axis::WIDTH, \"Width()\"},",
          "new_line_content": "    if (axis_to_leave.count(Axis::DEPTH)) {",
          "content_same": false
        },
        {
          "line": 280,
          "old_api": null,
          "new_api": "get_global_id",
          "old_text": null,
          "new_text": "get_global_id(1)",
          "old_line_content": "      {Axis::HEIGHT, \"Height()\"},   {Axis::DEPTH, \"Depth()\"},",
          "new_line_content": "      c += \"  int linear_id = \" + get_global_id(1) + \";\\n\";",
          "content_same": false
        },
        {
          "line": 284,
          "old_api": null,
          "new_api": "get_global_id",
          "old_text": null,
          "new_text": "get_global_id(1)",
          "old_line_content": "      {Axis::BATCH, \"B\"}, {Axis::WIDTH, \"X\"},    {Axis::HEIGHT, \"Y\"},",
          "new_line_content": "      c += \"  int DST_Y = \" + get_global_id(1) + \";\\n\";",
          "content_same": false
        },
        {
          "line": 286,
          "old_api": null,
          "new_api": "count",
          "old_text": null,
          "new_text": "axis_to_leave.count(Axis::DEPTH)",
          "old_line_content": "  };",
          "new_line_content": "  } else if (axis_to_leave.count(Axis::DEPTH)) {",
          "content_same": false
        },
        {
          "line": 287,
          "old_api": null,
          "new_api": "get_global_id",
          "old_text": null,
          "new_text": "get_global_id(1)",
          "old_line_content": "  std::string dst_check;",
          "new_line_content": "    c += \"  int DST_Z = \" + get_global_id(1) + \";\\n\";",
          "content_same": false
        },
        {
          "line": 290,
          "old_api": null,
          "new_api": "get_global_id",
          "old_text": null,
          "new_text": "get_global_id(2)",
          "old_line_content": "      dst_check += \" || \";",
          "new_line_content": "    c += \"  int DST_S = \" + get_global_id(2) + \";\\n\";",
          "content_same": false
        },
        {
          "line": 303,
          "old_api": null,
          "new_api": "empty",
          "old_text": null,
          "new_text": "dst_check.empty()",
          "old_line_content": "      src_coords[a] = \"0\";",
          "new_line_content": "    if (!dst_check.empty()) {",
          "content_same": false
        },
        {
          "line": 314,
          "old_api": null,
          "new_api": "HasAxis",
          "old_text": null,
          "new_text": "HasAxis(axis_to_reduce, a)",
          "old_line_content": "  }",
          "new_line_content": "    if (op_def.dst_tensors[0].HasAxis(a) && !HasAxis(axis_to_reduce, a)) {",
          "content_same": false
        },
        {
          "line": 322,
          "old_api": null,
          "new_api": "HasAxis",
          "old_text": null,
          "new_text": "op_def.src_tensors[0].HasAxis(a)",
          "old_line_content": "             op_type == OperationType::REDUCE_MINIMUM) {",
          "new_line_content": "    if (op_def.src_tensors[0].HasAxis(a)) {",
          "content_same": false
        },
        {
          "line": 323,
          "old_api": null,
          "new_api": "empty",
          "old_text": null,
          "new_text": "src_coordinates.empty()",
          "old_line_content": "    c += \"  \" + accum_type_decl + \" reducer = args.src_tensor.Read\" +",
          "new_line_content": "      if (!src_coordinates.empty()) {",
          "content_same": false
        },
        {
          "line": 331,
          "old_api": null,
          "new_api": "GetZeroValue",
          "old_text": null,
          "new_text": "GetZeroValue(gpu_info, accum_type, 4)",
          "old_line_content": "  const std::vector<std::string> local_ids = {\"local_x\", \"local_y\", \"local_z\"};",
          "new_line_content": "         \" reducer = \" + GetZeroValue(gpu_info, accum_type, 4) + \";\\n\";",
          "content_same": false
        },
        {
          "line": 334,
          "old_api": null,
          "new_api": "GetOneValue",
          "old_text": null,
          "new_text": "GetOneValue(gpu_info, accum_type, 4)",
          "old_line_content": "    if (axis == Axis::CHANNELS) {",
          "new_line_content": "         \" reducer = \" + GetOneValue(gpu_info, accum_type, 4) + \";\\n\";",
          "content_same": false
        },
        {
          "line": 351,
          "old_api": null,
          "new_api": "GetOneValue",
          "old_text": null,
          "new_text": "GetOneValue(gpu_info, accum_type, 1)",
          "old_line_content": "    }",
          "new_line_content": "          GetOneValue(gpu_info, accum_type, 1) + \" : \" +",
          "content_same": false
        },
        {
          "line": 352,
          "old_api": null,
          "new_api": "GetZeroValue",
          "old_text": null,
          "new_text": "GetZeroValue(gpu_info, accum_type, 1)",
          "old_line_content": "  }",
          "new_line_content": "          GetZeroValue(gpu_info, accum_type, 1);",
          "content_same": false
        },
        {
          "line": 367,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "axis_to_reduce.size()",
          "old_line_content": "           \";\\n\";",
          "new_line_content": "  for (int i = 0; i < axis_to_reduce.size(); ++i) {",
          "content_same": false
        },
        {
          "line": 369,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "axis_to_reduce.size()",
          "old_line_content": "          op_type == OperationType::REDUCE_MAXIMUM ||",
          "new_line_content": "    const int index = axis_to_reduce.size() - 1 - i;",
          "content_same": false
        },
        {
          "line": 386,
          "old_api": null,
          "new_api": "GetOneValue",
          "old_text": null,
          "new_text": "GetOneValue(gpu_info, accum_type, 4)",
          "old_line_content": "  c += \"    \" + accum_type_decl + \" src_val = args.src_tensor.Read\" +",
          "new_line_content": "             \" mask_b = \" + GetOneValue(gpu_info, accum_type, 4) +",
          "content_same": false
        },
        {
          "line": 393,
          "old_api": null,
          "new_api": "HasAxis",
          "old_text": null,
          "new_text": "op_def.src_tensors[0].HasAxis(a)",
          "old_line_content": "      c += \"    src_val = src_val * mask_a + mask_b;\\n\";",
          "new_line_content": "    if (op_def.src_tensors[0].HasAxis(a)) {",
          "content_same": false
        },
        {
          "line": 394,
          "old_api": null,
          "new_api": "empty",
          "old_text": null,
          "new_text": "src_coordinates.empty()",
          "old_line_content": "    } else if (op_type == OperationType::REDUCE_MAXIMUM ||",
          "new_line_content": "      if (!src_coordinates.empty()) {",
          "content_same": false
        },
        {
          "line": 413,
          "old_api": null,
          "new_api": "MakeOp",
          "old_text": null,
          "new_text": "MakeOp(op_type, \"reducer\", \"src_val\")",
          "old_line_content": "    for (; remainder >= 8; remainder /= 4, offset *= 4) {",
          "new_line_content": "  c += \"    reducer = \" + MakeOp(op_type, \"reducer\", \"src_val\") + \";\\n\";",
          "content_same": false
        },
        {
          "line": 428,
          "old_api": null,
          "new_api": "std::to_string(remainder)",
          "old_text": null,
          "new_text": "std::to_string(remainder)",
          "old_line_content": "      c += \"  LOCAL_MEM_BARRIER;\\n\";",
          "new_line_content": "      c += \"  if (local_id < \" + std::to_string(remainder) + \") {\\n\";",
          "content_same": false
        },
        {
          "line": 429,
          "old_api": null,
          "new_api": "std::to_string(offset * 4)",
          "old_text": null,
          "new_text": "std::to_string(offset * 4)",
          "old_line_content": "    }",
          "new_line_content": "      c += \"    int t = local_id * \" + std::to_string(offset * 4) + \";\\n\";",
          "content_same": false
        },
        {
          "line": 431,
          "old_api": null,
          "new_api": "std::to_string(offset)",
          "old_text": null,
          "new_text": "std::to_string(offset)",
          "old_line_content": "    c += \"  if (local_id != 0) return;\\n\";",
          "new_line_content": "           std::to_string(offset) + \"];\\n\";",
          "content_same": false
        },
        {
          "line": 433,
          "old_api": null,
          "new_api": "MakeOp",
          "old_text": null,
          "new_text": "MakeOp(op_type, \"reduced\",\n                  \"accum[t + \" + std::to_string(offset * 2) + \"]\")",
          "old_line_content": "    remainder *= 4;",
          "new_line_content": "           MakeOp(op_type, \"reduced\",",
          "content_same": false
        },
        {
          "line": 434,
          "old_api": null,
          "new_api": "std::to_string(offset * 2)",
          "old_text": null,
          "new_text": "std::to_string(offset * 2)",
          "old_line_content": "    for (int i = 1; i < remainder; ++i) {",
          "new_line_content": "                  \"accum[t + \" + std::to_string(offset * 2) + \"]\") +",
          "content_same": false
        },
        {
          "line": 438,
          "old_api": null,
          "new_api": "std::to_string(offset * 3)",
          "old_text": null,
          "new_text": "std::to_string(offset * 3)",
          "old_line_content": "           \";\\n\";",
          "new_line_content": "                  \"accum[t + \" + std::to_string(offset * 3) + \"]\") +",
          "content_same": false
        },
        {
          "line": 440,
          "old_api": null,
          "new_api": "MakeOp",
          "old_text": null,
          "new_text": "MakeOp(op_type, \"accum[t]\", \"reduced\")",
          "old_line_content": "    if (op_type == OperationType::MEAN) {",
          "new_line_content": "      c += \"    accum[t] = \" + MakeOp(op_type, \"accum[t]\", \"reduced\") + \";\\n\";",
          "content_same": false
        },
        {
          "line": 450,
          "old_api": null,
          "new_api": "MakeOp",
          "old_text": null,
          "new_text": "MakeOp(op_type, \"reducer\",\n                  \"accum[\" + std::to_string(offset * i) + \"]\")",
          "old_line_content": "    } else if (op_type == OperationType::REDUCE_MAXIMUM) {",
          "new_line_content": "           MakeOp(op_type, \"reducer\",",
          "content_same": false
        },
        {
          "line": 451,
          "old_api": null,
          "new_api": "std::to_string(offset * i)",
          "old_text": null,
          "new_text": "std::to_string(offset * i)",
          "old_line_content": "      c += \"  reducer.x = max(reducer.x, reducer.y);\\n\";",
          "new_line_content": "                  \"accum[\" + std::to_string(offset * i) + \"]\") +",
          "content_same": false
        },
        {
          "line": 474,
          "old_api": null,
          "new_api": "GetDataType",
          "old_text": null,
          "new_text": "GetTypeConversion(\n      gpu_info, accum_type, op_def.src_tensors[0].GetDataType(), 4)",
          "old_line_content": "      }",
          "new_line_content": "  const std::string conversion = GetTypeConversion(",
          "content_same": false
        },
        {
          "line": 475,
          "old_api": null,
          "new_api": "GetDataType",
          "old_text": null,
          "new_text": "op_def.src_tensors[0].GetDataType()",
          "old_line_content": "    }",
          "new_line_content": "      gpu_info, accum_type, op_def.src_tensors[0].GetDataType(), 4);",
          "content_same": false
        },
        {
          "line": 477,
          "old_api": null,
          "new_api": "absl::Substitute(conversion, \"reducer\")",
          "old_text": null,
          "new_text": "absl::Substitute(conversion, \"reducer\")",
          "old_line_content": "  c += \"  args.dst_tensor.Write(result, \" + dst_coordinates + \");\\n\";",
          "new_line_content": "       absl::Substitute(conversion, \"reducer\") + \";\\n\";",
          "content_same": false
        },
        {
          "line": 480,
          "old_api": null,
          "new_api": "HasAxis",
          "old_text": null,
          "new_text": "op_def.dst_tensors[0].HasAxis(a)",
          "old_line_content": "}",
          "new_line_content": "    if (op_def.dst_tensors[0].HasAxis(a)) {",
          "content_same": false
        },
        {
          "line": 481,
          "old_api": null,
          "new_api": "empty",
          "old_text": null,
          "new_text": "dst_coordinates.empty()",
          "old_line_content": "",
          "new_line_content": "      if (!dst_coordinates.empty()) {",
          "content_same": false
        },
        {
          "line": 499,
          "old_api": null,
          "new_api": "Channels",
          "old_text": null,
          "new_text": "src_[0]->Channels()",
          "old_line_content": "  }",
          "new_line_content": "                                    src_[0]->Channels();",
          "content_same": false
        },
        {
          "line": 501,
          "old_api": null,
          "new_api": "Depth",
          "old_text": null,
          "new_text": "dst_[0]->Depth()",
          "old_line_content": "}",
          "new_line_content": "                                    dst_[0]->Height() * dst_[0]->Depth() *",
          "content_same": false
        },
        {
          "line": 502,
          "old_api": null,
          "new_api": "Channels",
          "old_text": null,
          "new_text": "dst_[0]->Channels()",
          "old_line_content": "",
          "new_line_content": "                                    dst_[0]->Channels();",
          "content_same": false
        },
        {
          "line": 508,
          "old_api": null,
          "new_api": "SetFloat",
          "old_text": null,
          "new_text": "args->SetFloat(\"inv_multiplier_1\", 1.0 / size_1)",
          "old_line_content": "    grid_x *= work_group_size_.x;",
          "new_line_content": "    RETURN_IF_ERROR(args->SetFloat(\"inv_multiplier_1\", 1.0 / size_1));",
          "content_same": false
        },
        {
          "line": 509,
          "old_api": null,
          "new_api": "SetFloat",
          "old_text": null,
          "new_text": "args->SetFloat(\"inv_multiplier_2\", 1.0 / size_0)",
          "old_line_content": "    grid_y *= work_group_size_.y;",
          "new_line_content": "    RETURN_IF_ERROR(args->SetFloat(\"inv_multiplier_2\", 1.0 / size_0));",
          "content_same": false
        },
        {
          "line": 511,
          "old_api": null,
          "new_api": "SetFloat",
          "old_text": null,
          "new_text": "args->SetFloat(\"inv_multiplier_1\", 1.0 / reduction_size)",
          "old_line_content": "  }",
          "new_line_content": "    RETURN_IF_ERROR(args->SetFloat(\"inv_multiplier_1\", 1.0 / reduction_size));",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 522,
          "old_api": "GetPossibleWorkGroups",
          "new_api": null,
          "old_text": "GetPossibleWorkGroups(tuning_type, gpu_info, kernel_info, grid_size_,\n                          work_groups)",
          "new_text": null,
          "old_line_content": "    GetPossibleWorkGroups(tuning_type, gpu_info, kernel_info, grid_size_,",
          "new_line_content": "    grid_x *= work_group_size_.x;",
          "content_same": false
        },
        {
          "line": 530,
          "old_api": "GetSizesFromShape",
          "new_api": null,
          "old_text": "GetSizesFromShape(axis_to_reduce, src_shape)",
          "new_text": null,
          "old_line_content": "  return Reduce(GetSizesFromShape(axis_to_reduce, src_shape), op_type,",
          "new_line_content": "                                         const GpuInfo& gpu_info,",
          "content_same": false
        },
        {
          "line": 537,
          "old_api": "GetSizesFromShape",
          "new_api": null,
          "old_text": "GetSizesFromShape(axis_to_reduce, src_shape)",
          "new_text": null,
          "old_line_content": "  return Reduce(GetSizesFromShape(axis_to_reduce, src_shape), op_type,",
          "new_line_content": "                          work_groups);",
          "content_same": false
        },
        {
          "line": 78,
          "old_api": "size",
          "new_api": null,
          "old_text": "ordered_sizes.size()",
          "new_text": null,
          "old_line_content": "  for (int i = ordered_sizes.size() - 1; i >= 0; i--) {",
          "new_line_content": "  // Make sure that a minimum number of reductions happens inside the loop over",
          "content_same": false
        },
        {
          "line": 79,
          "old_api": "size",
          "new_api": null,
          "old_text": "ordered_sizes.size()",
          "new_text": null,
          "old_line_content": "    const int wg_index = ordered_sizes.size() - 1 - i;",
          "new_line_content": "  // reduction dims. Otherwise, the reduction size could equal the number of",
          "content_same": false
        },
        {
          "line": 98,
          "old_api": "get",
          "new_api": null,
          "old_text": "shape.get(a)",
          "new_text": null,
          "old_line_content": "    result[a] = shape.get(a);",
          "new_line_content": "      wg_size_total *= 2;",
          "content_same": false
        },
        {
          "line": 107,
          "old_api": "get",
          "new_api": null,
          "old_text": "shape.get(a)",
          "new_text": null,
          "old_line_content": "    result[a] = shape.get(a);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 135,
          "old_api": "find",
          "new_api": null,
          "old_text": "axis_to_reduce.find(a)",
          "new_text": null,
          "old_line_content": "    auto it = axis_to_reduce.find(a);",
          "new_line_content": "  } else {",
          "content_same": false
        },
        {
          "line": 136,
          "old_api": "end",
          "new_api": null,
          "old_text": "axis_to_reduce.end()",
          "new_text": null,
          "old_line_content": "    if (it != axis_to_reduce.end()) {",
          "new_line_content": "    return src_type;",
          "content_same": false
        },
        {
          "line": 137,
          "old_api": "push_back",
          "new_api": null,
          "old_text": "ordered_axis_to_reduce.push_back(it->first)",
          "new_text": null,
          "old_line_content": "      ordered_axis_to_reduce.push_back(it->first);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 140,
          "old_api": "DivideRoundUp",
          "new_api": null,
          "old_text": "DivideRoundUp(reduction_size, 4)",
          "new_text": null,
          "old_line_content": "        reduction_size = DivideRoundUp(reduction_size, 4);",
          "new_line_content": "}  // namespace",
          "content_same": false
        },
        {
          "line": 142,
          "old_api": "push_back",
          "new_api": null,
          "old_text": "ordered_sizes.push_back(reduction_size)",
          "new_text": null,
          "old_line_content": "      ordered_sizes.push_back(reduction_size);",
          "new_line_content": "Reduce::Reduce(const std::map<Axis, int>& axis_to_reduce, OperationType op_type,",
          "content_same": false
        },
        {
          "line": 145,
          "old_api": "GetMaximumWGTotalSize",
          "new_api": null,
          "old_text": "GetMaximumWGTotalSize(gpu_info)",
          "new_text": null,
          "old_line_content": "  const int max_total_wg_size = GetMaximumWGTotalSize(gpu_info);",
          "new_line_content": "  std::vector<Axis> ordered_axis_to_reduce;",
          "content_same": false
        },
        {
          "line": 147,
          "old_api": "GetMaximumPossibleWGSize",
          "new_api": null,
          "old_text": "GetMaximumPossibleWGSize(ordered_sizes, max_total_wg_size)",
          "new_text": null,
          "old_line_content": "      GetMaximumPossibleWGSize(ordered_sizes, max_total_wg_size);",
          "new_line_content": "  for (const auto& a :",
          "content_same": false
        },
        {
          "line": 160,
          "old_api": "GetReduceKernelCode",
          "new_api": null,
          "old_text": "GetReduceKernelCode(definition_, gpu_info, work_group_size_,\n                              ordered_axis_to_reduce, op_type)",
          "new_text": null,
          "old_line_content": "  code_ = GetReduceKernelCode(definition_, gpu_info, work_group_size_,",
          "new_line_content": "  int3 current_wg_size =",
          "content_same": false
        },
        {
          "line": 171,
          "old_api": "std::move(operation)",
          "new_api": null,
          "old_text": "std::move(operation)",
          "new_text": null,
          "old_line_content": "    GPUOperation::operator=(std::move(operation));",
          "new_line_content": "    use_wg_reduction_ = true;",
          "content_same": false
        },
        {
          "line": 181,
          "old_api": "AddSrcTensor",
          "new_api": null,
          "old_text": "AddSrcTensor(\"src_tensor\", op_def.src_tensors[0])",
          "new_text": null,
          "old_line_content": "  AddSrcTensor(\"src_tensor\", op_def.src_tensors[0]);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 182,
          "old_api": "AddDstTensor",
          "new_api": null,
          "old_text": "AddDstTensor(\"dst_tensor\", op_def.dst_tensors[0])",
          "new_text": null,
          "old_line_content": "  AddDstTensor(\"dst_tensor\", op_def.dst_tensors[0]);",
          "new_line_content": "Reduce& Reduce::operator=(Reduce&& operation) {",
          "content_same": false
        },
        {
          "line": 183,
          "old_api": "AddFloat",
          "new_api": null,
          "old_text": "args_.AddFloat(\"inv_multiplier_1\")",
          "new_text": null,
          "old_line_content": "  args_.AddFloat(\"inv_multiplier_1\");",
          "new_line_content": "  if (this != &operation) {",
          "content_same": false
        },
        {
          "line": 184,
          "old_api": "AddFloat",
          "new_api": null,
          "old_text": "args_.AddFloat(\"inv_multiplier_2\")",
          "new_text": null,
          "old_line_content": "  args_.AddFloat(\"inv_multiplier_2\");",
          "new_line_content": "    use_wg_reduction_ = operation.use_wg_reduction_;",
          "content_same": false
        },
        {
          "line": 190,
          "old_api": "HasAxis",
          "new_api": null,
          "old_text": "op_def.dst_tensors[0].HasAxis(a)",
          "new_text": null,
          "old_line_content": "    if (op_def.dst_tensors[0].HasAxis(a)) {",
          "new_line_content": "std::string Reduce::GetReduceKernelCode(const OperationDef& op_def,",
          "content_same": false
        },
        {
          "line": 191,
          "old_api": "HasAxis",
          "new_api": null,
          "old_text": "HasAxis(axis_to_reduce, a)",
          "new_text": null,
          "old_line_content": "      if (!HasAxis(axis_to_reduce, a)) {",
          "new_line_content": "                                        const GpuInfo& gpu_info,",
          "content_same": false
        },
        {
          "line": 192,
          "old_api": "insert",
          "new_api": null,
          "old_text": "axis_to_leave.insert(a)",
          "new_text": null,
          "old_line_content": "        axis_to_leave.insert(a);",
          "new_line_content": "                                        const int3& work_group_size,",
          "content_same": false
        },
        {
          "line": 212,
          "old_api": "std::to_string(i)",
          "new_api": null,
          "old_text": "std::to_string(i)",
          "new_text": null,
          "old_line_content": "      return \"GLOBAL_ID_\" + std::to_string(i);",
          "new_line_content": "  if (use_wg_reduction_) {",
          "content_same": false
        },
        {
          "line": 216,
          "old_api": "GetDataType",
          "new_api": null,
          "old_text": "op_def.src_tensors[0].GetDataType()",
          "new_text": null,
          "old_line_content": "  auto accum_type = GetAccumType(op_def.src_tensors[0].GetDataType());",
          "new_line_content": "      wg_dims = 2;",
          "content_same": false
        },
        {
          "line": 218,
          "old_api": "GetTypeDeclaration",
          "new_api": null,
          "old_text": "GetTypeDeclaration(gpu_info, accum_type, 4)",
          "new_text": null,
          "old_line_content": "      GetTypeDeclaration(gpu_info, accum_type, 4);",
          "new_line_content": "      wg_dims = 3;",
          "content_same": false
        },
        {
          "line": 229,
          "old_api": "std::to_string(work_group_size.x)",
          "new_api": null,
          "old_text": "std::to_string(work_group_size.x)",
          "new_text": null,
          "old_line_content": "  const std::string wg_x = std::to_string(work_group_size.x);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 231,
          "old_api": "std::to_string(work_group_size.z)",
          "new_api": null,
          "old_text": "std::to_string(work_group_size.z)",
          "new_text": null,
          "old_line_content": "  const std::string wg_z = std::to_string(work_group_size.z);",
          "new_line_content": "  const std::string accum_type_decl =",
          "content_same": false
        },
        {
          "line": 237,
          "old_api": "std::to_string(wg_total_size)",
          "new_api": null,
          "old_text": "std::to_string(wg_total_size)",
          "new_text": null,
          "old_line_content": "         std::to_string(wg_total_size) + \"];\\n\";",
          "new_line_content": "    read_as_template = \"<int>\";",
          "content_same": false
        },
        {
          "line": 253,
          "old_api": "count",
          "new_api": null,
          "old_text": "axis_to_leave.count(Axis::WIDTH)",
          "new_text": null,
          "old_line_content": "  if (axis_to_leave.count(Axis::WIDTH)) {",
          "new_line_content": "      c += \"  int local_x = LOCAL_ID_0;\\n\";",
          "content_same": false
        },
        {
          "line": 254,
          "old_api": "count",
          "new_api": null,
          "old_text": "axis_to_leave.count(Axis::BATCH)",
          "new_text": null,
          "old_line_content": "    if (axis_to_leave.count(Axis::BATCH)) {",
          "new_line_content": "      c += \"  int local_id = local_x;\\n\";",
          "content_same": false
        },
        {
          "line": 255,
          "old_api": "get_global_id",
          "new_api": null,
          "old_text": "get_global_id(0)",
          "new_text": null,
          "old_line_content": "      c += \"  int linear_id = \" + get_global_id(0) + \";\\n\";",
          "new_line_content": "    } else if (wg_dims == 2) {",
          "content_same": false
        },
        {
          "line": 259,
          "old_api": "get_global_id",
          "new_api": null,
          "old_text": "get_global_id(0)",
          "new_text": null,
          "old_line_content": "      c += \"  int DST_X = \" + get_global_id(0) + \";\\n\";",
          "new_line_content": "    } else if (wg_dims == 3) {",
          "content_same": false
        },
        {
          "line": 261,
          "old_api": "count",
          "new_api": null,
          "old_text": "axis_to_leave.count(Axis::BATCH)",
          "new_text": null,
          "old_line_content": "  } else if (axis_to_leave.count(Axis::BATCH)) {",
          "new_line_content": "      c += \"  int local_y = LOCAL_ID_1;\\n\";",
          "content_same": false
        },
        {
          "line": 262,
          "old_api": "get_global_id",
          "new_api": null,
          "old_text": "get_global_id(0)",
          "new_text": null,
          "old_line_content": "    c += \"  int DST_B = \" + get_global_id(0) + \";\\n\";",
          "new_line_content": "      c += \"  int local_z = LOCAL_ID_2;\\n\";",
          "content_same": false
        },
        {
          "line": 264,
          "old_api": "count",
          "new_api": null,
          "old_text": "axis_to_leave.count(Axis::HEIGHT)",
          "new_text": null,
          "old_line_content": "  if (axis_to_leave.count(Axis::HEIGHT)) {",
          "new_line_content": "           \" + local_x;\\n\";",
          "content_same": false
        },
        {
          "line": 265,
          "old_api": "count",
          "new_api": null,
          "old_text": "axis_to_leave.count(Axis::DEPTH)",
          "new_text": null,
          "old_line_content": "    if (axis_to_leave.count(Axis::DEPTH)) {",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 266,
          "old_api": "get_global_id",
          "new_api": null,
          "old_text": "get_global_id(1)",
          "new_text": null,
          "old_line_content": "      c += \"  int linear_id = \" + get_global_id(1) + \";\\n\";",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 270,
          "old_api": "get_global_id",
          "new_api": null,
          "old_text": "get_global_id(1)",
          "new_text": null,
          "old_line_content": "      c += \"  int DST_Y = \" + get_global_id(1) + \";\\n\";",
          "new_line_content": "      c += \"  int DST_X = linear_id / args.dst_tensor.Batch();\\n\";",
          "content_same": false
        },
        {
          "line": 272,
          "old_api": "count",
          "new_api": null,
          "old_text": "axis_to_leave.count(Axis::DEPTH)",
          "new_text": null,
          "old_line_content": "  } else if (axis_to_leave.count(Axis::DEPTH)) {",
          "new_line_content": "    } else {",
          "content_same": false
        },
        {
          "line": 295,
          "old_api": "empty",
          "new_api": null,
          "old_text": "dst_check.empty()",
          "new_text": null,
          "old_line_content": "  if (!dst_check.empty()) {",
          "new_line_content": "      {Axis::CHANNELS, \"Slices()\"},",
          "content_same": false
        },
        {
          "line": 300,
          "old_api": "HasAxis",
          "new_api": null,
          "old_text": "HasAxis(axis_to_reduce, a)",
          "new_text": null,
          "old_line_content": "    if (op_def.dst_tensors[0].HasAxis(a) && !HasAxis(axis_to_reduce, a)) {",
          "new_line_content": "  };",
          "content_same": false
        },
        {
          "line": 308,
          "old_api": "HasAxis",
          "new_api": null,
          "old_text": "op_def.src_tensors[0].HasAxis(a)",
          "new_text": null,
          "old_line_content": "    if (op_def.src_tensors[0].HasAxis(a)) {",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 317,
          "old_api": "GetZeroValue",
          "new_api": null,
          "old_text": "GetZeroValue(gpu_info, accum_type, 4)",
          "new_text": null,
          "old_line_content": "         \" reducer = \" + GetZeroValue(gpu_info, accum_type, 4) + \";\\n\";",
          "new_line_content": "      src_coords[a] = \"0\";",
          "content_same": false
        },
        {
          "line": 320,
          "old_api": "GetOneValue",
          "new_api": null,
          "old_text": "GetOneValue(gpu_info, accum_type, 4)",
          "new_text": null,
          "old_line_content": "         \" reducer = \" + GetOneValue(gpu_info, accum_type, 4) + \";\\n\";",
          "new_line_content": "  std::string src_coordinates;",
          "content_same": false
        },
        {
          "line": 337,
          "old_api": "GetOneValue",
          "new_api": null,
          "old_text": "GetOneValue(gpu_info, accum_type, 1)",
          "new_text": null,
          "old_line_content": "          GetOneValue(gpu_info, accum_type, 1) + \" : \" +",
          "new_line_content": "    c += \"  \" + accum_type_decl + \" reducer = args.src_tensor.Read\" +",
          "content_same": false
        },
        {
          "line": 338,
          "old_api": "GetZeroValue",
          "new_api": null,
          "old_text": "GetZeroValue(gpu_info, accum_type, 1)",
          "new_text": null,
          "old_line_content": "          GetZeroValue(gpu_info, accum_type, 1);",
          "new_line_content": "         read_as_template + \"(\" + src_coordinates + \");\\n\";",
          "content_same": false
        },
        {
          "line": 353,
          "old_api": "size",
          "new_api": null,
          "old_text": "axis_to_reduce.size()",
          "new_text": null,
          "old_line_content": "  for (int i = 0; i < axis_to_reduce.size(); ++i) {",
          "new_line_content": "      c += \"  mask.x = (args.src_tensor.Slices() - 1) * 4 + 0 < \"",
          "content_same": false
        },
        {
          "line": 355,
          "old_api": "size",
          "new_api": null,
          "old_text": "axis_to_reduce.size()",
          "new_text": null,
          "old_line_content": "    const int index = axis_to_reduce.size() - 1 - i;",
          "new_line_content": "           one_or_zero_value + \";\\n\";",
          "content_same": false
        },
        {
          "line": 366,
          "old_api": "GetOneValue",
          "new_api": null,
          "old_text": "GetOneValue(gpu_info, accum_type, 4)",
          "new_text": null,
          "old_line_content": "           \" mask_a = last ? mask : \" + GetOneValue(gpu_info, accum_type, 4) +",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 372,
          "old_api": "GetOneValue",
          "new_api": null,
          "old_text": "GetOneValue(gpu_info, accum_type, 4)",
          "new_text": null,
          "old_line_content": "             \" mask_b = \" + GetOneValue(gpu_info, accum_type, 4) +",
          "new_line_content": "    const std::string src_coord = \"SRC_\" + axis_to_coord[axis];",
          "content_same": false
        },
        {
          "line": 379,
          "old_api": "HasAxis",
          "new_api": null,
          "old_text": "op_def.src_tensors[0].HasAxis(a)",
          "new_text": null,
          "old_line_content": "    if (op_def.src_tensors[0].HasAxis(a)) {",
          "new_line_content": "      c += \"    \" + accum_type_decl +",
          "content_same": false
        },
        {
          "line": 399,
          "old_api": "MakeOp",
          "new_api": null,
          "old_text": "MakeOp(op_type, \"reducer\", \"src_val\")",
          "new_text": null,
          "old_line_content": "  c += \"    reducer = \" + MakeOp(op_type, \"reducer\", \"src_val\") + \";\\n\";",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 400,
          "old_api": "size",
          "new_api": null,
          "old_text": "axis_to_reduce.size()",
          "new_text": null,
          "old_line_content": "  for (int i = 0; i < axis_to_reduce.size(); ++i) {",
          "new_line_content": "  c += \"    \" + accum_type_decl + \" src_val = args.src_tensor.Read\" +",
          "content_same": false
        },
        {
          "line": 415,
          "old_api": "std::to_string(offset * 4)",
          "new_api": null,
          "old_text": "std::to_string(offset * 4)",
          "new_text": null,
          "old_line_content": "      c += \"    int t = local_id * \" + std::to_string(offset * 4) + \";\\n\";",
          "new_line_content": "    c += \"  }\\n\";",
          "content_same": false
        },
        {
          "line": 417,
          "old_api": "std::to_string(offset)",
          "new_api": null,
          "old_text": "std::to_string(offset)",
          "new_text": null,
          "old_line_content": "           std::to_string(offset) + \"];\\n\";",
          "new_line_content": "  if (op_type == OperationType::MEAN) {",
          "content_same": false
        },
        {
          "line": 419,
          "old_api": "MakeOp",
          "new_api": null,
          "old_text": "MakeOp(op_type, \"reduced\",\n                  \"accum[t + \" + std::to_string(offset * 2) + \"]\")",
          "new_text": null,
          "old_line_content": "           MakeOp(op_type, \"reduced\",",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 420,
          "old_api": "std::to_string(offset * 2)",
          "new_api": null,
          "old_text": "std::to_string(offset * 2)",
          "new_text": null,
          "old_line_content": "                  \"accum[t + \" + std::to_string(offset * 2) + \"]\") +",
          "new_line_content": "  if (use_wg_reduction_) {",
          "content_same": false
        },
        {
          "line": 423,
          "old_api": "MakeOp",
          "new_api": null,
          "old_text": "MakeOp(op_type, \"reduced\",\n                  \"accum[t + \" + std::to_string(offset * 3) + \"]\")",
          "new_text": null,
          "old_line_content": "           MakeOp(op_type, \"reduced\",",
          "new_line_content": "    const int total_size =",
          "content_same": false
        },
        {
          "line": 424,
          "old_api": "std::to_string(offset * 3)",
          "new_api": null,
          "old_text": "std::to_string(offset * 3)",
          "new_text": null,
          "old_line_content": "                  \"accum[t + \" + std::to_string(offset * 3) + \"]\") +",
          "new_line_content": "        work_group_size.x * work_group_size.y * work_group_size.z;",
          "content_same": false
        },
        {
          "line": 426,
          "old_api": "MakeOp",
          "new_api": null,
          "old_text": "MakeOp(op_type, \"accum[t]\", \"reduced\")",
          "new_text": null,
          "old_line_content": "      c += \"    accum[t] = \" + MakeOp(op_type, \"accum[t]\", \"reduced\") + \";\\n\";",
          "new_line_content": "    int remainder = total_size / 4;",
          "content_same": false
        },
        {
          "line": 436,
          "old_api": "MakeOp",
          "new_api": null,
          "old_text": "MakeOp(op_type, \"reducer\",\n                  \"accum[\" + std::to_string(offset * i) + \"]\")",
          "new_text": null,
          "old_line_content": "           MakeOp(op_type, \"reducer\",",
          "new_line_content": "      c += \"    reduced = \" +",
          "content_same": false
        },
        {
          "line": 460,
          "old_api": "GetDataType",
          "new_api": null,
          "old_text": "GetTypeConversion(\n      gpu_info, accum_type, op_def.src_tensors[0].GetDataType(), 4)",
          "new_text": null,
          "old_line_content": "  const std::string conversion = GetTypeConversion(",
          "new_line_content": "        op_type == OperationType::MEAN) {",
          "content_same": false
        },
        {
          "line": 461,
          "old_api": "GetDataType",
          "new_api": null,
          "old_text": "op_def.src_tensors[0].GetDataType()",
          "new_text": null,
          "old_line_content": "      gpu_info, accum_type, op_def.src_tensors[0].GetDataType(), 4);",
          "new_line_content": "      c += \"  reducer.x += reducer.y + reducer.z + reducer.w;\\n\";",
          "content_same": false
        },
        {
          "line": 463,
          "old_api": "absl::Substitute(conversion, \"reducer\")",
          "new_api": null,
          "old_text": "absl::Substitute(conversion, \"reducer\")",
          "new_text": null,
          "old_line_content": "       absl::Substitute(conversion, \"reducer\") + \";\\n\";",
          "new_line_content": "      c += \"  reducer.x *= reducer.y * reducer.z * reducer.w;\\n\";",
          "content_same": false
        },
        {
          "line": 466,
          "old_api": "HasAxis",
          "new_api": null,
          "old_text": "op_def.dst_tensors[0].HasAxis(a)",
          "new_text": null,
          "old_line_content": "    if (op_def.dst_tensors[0].HasAxis(a)) {",
          "new_line_content": "      c += \"  reducer.x = max(reducer.x, reducer.z);\\n\";",
          "content_same": false
        },
        {
          "line": 467,
          "old_api": "empty",
          "new_api": null,
          "old_text": "dst_coordinates.empty()",
          "new_text": null,
          "old_line_content": "      if (!dst_coordinates.empty()) {",
          "new_line_content": "      c += \"  reducer.x = max(reducer.x, reducer.w);\\n\";",
          "content_same": false
        },
        {
          "line": 470,
          "old_api": "count",
          "new_api": null,
          "old_text": "axis_to_leave.count(a)",
          "new_text": null,
          "old_line_content": "      if (axis_to_leave.count(a)) {",
          "new_line_content": "      c += \"  reducer.x = min(reducer.x, reducer.z);\\n\";",
          "content_same": false
        },
        {
          "line": 483,
          "old_api": "Width",
          "new_api": null,
          "old_text": "src_[0]->Width()",
          "new_text": null,
          "old_line_content": "  const double total_src_elements = 1.0 * src_[0]->Batch() * src_[0]->Width() *",
          "new_line_content": "      }",
          "content_same": false
        },
        {
          "line": 485,
          "old_api": "Channels",
          "new_api": null,
          "old_text": "src_[0]->Channels()",
          "new_text": null,
          "old_line_content": "                                    src_[0]->Channels();",
          "new_line_content": "        dst_coordinates += \"DST_\" + axis_to_coord[a];",
          "content_same": false
        },
        {
          "line": 486,
          "old_api": "Width",
          "new_api": null,
          "old_text": "dst_[0]->Width()",
          "new_text": null,
          "old_line_content": "  const double total_dst_elements = 1.0 * dst_[0]->Batch() * dst_[0]->Width() *",
          "new_line_content": "      } else {",
          "content_same": false
        },
        {
          "line": 487,
          "old_api": "Depth",
          "new_api": null,
          "old_text": "dst_[0]->Depth()",
          "new_text": null,
          "old_line_content": "                                    dst_[0]->Height() * dst_[0]->Depth() *",
          "new_line_content": "        dst_coordinates += \"0\";",
          "content_same": false
        },
        {
          "line": 488,
          "old_api": "Channels",
          "new_api": null,
          "old_text": "dst_[0]->Channels()",
          "new_text": null,
          "old_line_content": "                                    dst_[0]->Channels();",
          "new_line_content": "      }",
          "content_same": false
        },
        {
          "line": 494,
          "old_api": "SetFloat",
          "new_api": null,
          "old_text": "args->SetFloat(\"inv_multiplier_1\", 1.0 / size_1)",
          "new_text": null,
          "old_line_content": "    RETURN_IF_ERROR(args->SetFloat(\"inv_multiplier_1\", 1.0 / size_1));",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 495,
          "old_api": "SetFloat",
          "new_api": null,
          "old_text": "args->SetFloat(\"inv_multiplier_2\", 1.0 / size_0)",
          "new_text": null,
          "old_line_content": "    RETURN_IF_ERROR(args->SetFloat(\"inv_multiplier_2\", 1.0 / size_0));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 504,
          "old_api": "Batch",
          "new_api": null,
          "old_text": "dst_[0]->Batch()",
          "new_text": null,
          "old_line_content": "  int grid_x = dst_[0]->Width() * dst_[0]->Batch();",
          "new_line_content": "  if (use_wg_reduction_) {",
          "content_same": false
        },
        {
          "line": 505,
          "old_api": "Depth",
          "new_api": null,
          "old_text": "dst_[0]->Depth()",
          "new_text": null,
          "old_line_content": "  int grid_y = dst_[0]->Height() * dst_[0]->Depth();",
          "new_line_content": "    const double size_0 =",
          "content_same": false
        },
        {
          "line": 506,
          "old_api": "Slices",
          "new_api": null,
          "old_text": "dst_[0]->Slices()",
          "new_text": null,
          "old_line_content": "  int grid_z = dst_[0]->Slices();",
          "new_line_content": "        work_group_size_.x * work_group_size_.y * work_group_size_.z;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 15,
      "total_additions": 78,
      "total_deletions": 78,
      "total_api_changes": 171
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 15,
        "api_related_lines": 171,
        "non_api_lines": 13,
        "non_api_line_numbers": [
          96,
          97,
          80,
          81,
          82,
          83,
          89,
          90,
          91,
          92,
          93,
          94,
          95
        ]
      }
    },
    "api_calls_before": 119,
    "api_calls_after": 119,
    "diff_info": {
      "added_lines": 15,
      "removed_lines": 1,
      "total_diff_lines": 33
    }
  }
}