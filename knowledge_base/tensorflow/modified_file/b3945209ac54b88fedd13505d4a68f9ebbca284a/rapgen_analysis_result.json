{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/tensorflow/modified_file/b3945209ac54b88fedd13505d4a68f9ebbca284a",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/tensorflow/modified_file/b3945209ac54b88fedd13505d4a68f9ebbca284a/before.cc",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/tensorflow/modified_file/b3945209ac54b88fedd13505d4a68f9ebbca284a/after.cc",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/tensorflow/modified_file/b3945209ac54b88fedd13505d4a68f9ebbca284a/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 104,
          "old_api": "std::min<int64_t>(16, sizes.n)",
          "new_api": "std::min<int64_t>(64, sizes.n)",
          "old_text": "std::min<int64_t>(16, sizes.n)",
          "new_text": "std::min<int64_t>(64, sizes.n)",
          "old_line_content": "    result.n = std::min<int64_t>(16, sizes.n);",
          "new_line_content": "    result.n = std::min<int64_t>(64, sizes.n) * (sizes.k <= 64 ? 1 : 2);",
          "content_same": false
        },
        {
          "line": 121,
          "old_api": "heuristic",
          "new_api": "roundDownToPowerOfTwo",
          "old_text": "heuristic(sizes)",
          "new_text": "roundDownToPowerOfTwo(sizes.k)",
          "old_line_content": "    return heuristic(sizes);",
          "new_line_content": "    sizes.k = roundDownToPowerOfTwo(sizes.k);",
          "content_same": false
        },
        {
          "line": 130,
          "old_api": "getDimSize",
          "new_api": "getType",
          "old_text": "lhsTy.getDimSize(0)",
          "new_text": "op->getOperand(1).getType().cast<ShapedType>()",
          "old_line_content": "  sizes.m = lhsTy.getDimSize(0);",
          "new_line_content": "  ShapedType rhsTy = op->getOperand(1).getType().cast<ShapedType>();",
          "content_same": false
        },
        {
          "line": 150,
          "old_api": "getDimSize",
          "new_api": "getType",
          "old_text": "ty.getDimSize(0)",
          "new_text": "op->getOperand(0).getType().cast<ShapedType>()",
          "old_line_content": "  sizes.m = ty.getDimSize(0);",
          "new_line_content": "  ShapedType ty = op->getOperand(0).getType().cast<ShapedType>();",
          "content_same": false
        },
        {
          "line": 185,
          "old_api": "std::move(reductionDimTileSizeFn)",
          "new_api": "std::move(tileSizeFn)",
          "old_text": "std::move(reductionDimTileSizeFn)",
          "new_text": "std::move(tileSizeFn)",
          "old_line_content": "        reductionDimTileSizeFn(std::move(reductionDimTileSizeFn)) {}",
          "new_line_content": "        tileSizeFn(std::move(tileSizeFn)),",
          "content_same": false
        },
        {
          "line": 199,
          "old_api": "isa<thlo::ReverseOp>(op)",
          "new_api": "dyn_cast<linalg::MapOp>(op)",
          "old_text": "isa<thlo::ReverseOp>(op)",
          "new_text": "dyn_cast<linalg::MapOp>(op)",
          "old_line_content": "      return isa<thlo::ReverseOp>(op);",
          "new_line_content": "      if (auto mapOp = dyn_cast<linalg::MapOp>(op))",
          "content_same": false
        },
        {
          "line": 209,
          "old_api": "isa<DotTy>(tilingRoot)",
          "new_api": "getMatmulSizes",
          "old_text": "isa<DotTy>(tilingRoot)",
          "new_text": "getMatmulSizes(dotOp)",
          "old_line_content": "    if (!isa<DotTy>(tilingRoot))",
          "new_line_content": "    auto tileSizes = tileSizeFn(getMatmulSizes(dotOp));",
          "content_same": false
        },
        {
          "line": 210,
          "old_api": "dropZeros",
          "new_api": "parallelDimTileSizeFn",
          "old_text": "dropZeros(parallelDimsTileSizes)",
          "new_text": "parallelDimTileSizeFn(tileSizes)",
          "old_line_content": "      parallelDimsTileSizes = dropZeros(parallelDimsTileSizes);",
          "new_line_content": "    auto parallelDimsTileSizes = parallelDimTileSizeFn(tileSizes);",
          "content_same": false
        },
        {
          "line": 212,
          "old_api": "contains",
          "new_api": "dropZeros",
          "old_text": "tileUsingSCFForallOpAndFuseGreedily(\n        rewriter, tilingRoot, getSCFTilingOptions(parallelDimsTileSizes),\n        [&](Operation *op) { return fusionCluster.contains(op); })",
          "new_text": "dropZeros(parallelDimsTileSizes)",
          "old_line_content": "    auto tilingParallelDimsResult = tileUsingSCFForallOpAndFuseGreedily(",
          "new_line_content": "      parallelDimsTileSizes = dropZeros(parallelDimsTileSizes);",
          "content_same": false
        },
        {
          "line": 215,
          "old_api": "failure",
          "new_api": "getSCFTilingOptions",
          "old_text": "failure()",
          "new_text": "getSCFTilingOptions(parallelDimsTileSizes)",
          "old_line_content": "    if (failed(tilingParallelDimsResult)) return failure();",
          "new_line_content": "        rewriter, tilingRoot, getSCFTilingOptions(parallelDimsTileSizes),",
          "content_same": false
        },
        {
          "line": 229,
          "old_api": "reductionDimTileSizeFn",
          "new_api": "getBody",
          "old_text": "reductionDimTileSizeFn(tileSizes)",
          "new_text": "mainParallelLoop.getBody()->getOps<DotTy>().begin()",
          "old_line_content": "                                         reductionDimTileSizeFn(tileSizes),",
          "new_line_content": "      auto tiledDotOp = *mainParallelLoop.getBody()->getOps<DotTy>().begin();",
          "content_same": false
        },
        {
          "line": 231,
          "old_api": "failure",
          "new_api": "reductionDimTileSizeFn",
          "old_text": "failure()",
          "new_text": "reductionDimTileSizeFn(tileSizes)",
          "old_line_content": "        return failure();",
          "new_line_content": "                                         reductionDimTileSizeFn(tileSizes),",
          "content_same": false
        },
        {
          "line": 239,
          "old_api": "tileUsingSCFForOpAndFuseGreedily",
          "new_api": "getBody",
          "old_text": "tileUsingSCFForOpAndFuseGreedily(\n            rewriter, tiledDotOp,\n            getSCFTilingOptions(reductionDimTileSizeFn(tileSizes)),\n            producerFilterFn)",
          "new_text": "llvm::to_vector(\n               tailParallelLoop.getBody()->template getOps<DotTy>())",
          "old_line_content": "        auto reductionDimTilingResult = tileUsingSCFForOpAndFuseGreedily(",
          "new_line_content": "      for (auto tiledDotOp : llvm::to_vector(",
          "content_same": false
        },
        {
          "line": 241,
          "old_api": "reductionDimTileSizeFn",
          "new_api": "tileUsingSCFForOpAndFuseGreedily",
          "old_text": "reductionDimTileSizeFn(tileSizes)",
          "new_text": "tileUsingSCFForOpAndFuseGreedily(\n            rewriter, tiledDotOp,\n            getSCFTilingOptions(reductionDimTileSizeFn(tileSizes)),\n            producerFilterFn)",
          "old_line_content": "            getSCFTilingOptions(reductionDimTileSizeFn(tileSizes)),",
          "new_line_content": "        auto reductionDimTilingResult = tileUsingSCFForOpAndFuseGreedily(",
          "content_same": false
        },
        {
          "line": 243,
          "old_api": "failure",
          "new_api": "reductionDimTileSizeFn",
          "old_text": "failure()",
          "new_text": "reductionDimTileSizeFn(tileSizes)",
          "old_line_content": "        if (failed(reductionDimTilingResult)) return failure();",
          "new_line_content": "            getSCFTilingOptions(reductionDimTileSizeFn(tileSizes)),",
          "content_same": false
        },
        {
          "line": 258,
          "old_api": "failure",
          "new_api": "getSCFTilingOptions",
          "old_text": "failure()",
          "new_text": "getSCFTilingOptions(reductionDimTileSizes)",
          "old_line_content": "    if (failed(reductionDimTilingResult)) return failure();",
          "new_line_content": "            rewriter, reduceOp, getSCFTilingOptions(reductionDimTileSizes),",
          "content_same": false
        },
        {
          "line": 263,
          "old_api": "setLabel",
          "new_api": "front",
          "old_text": "setLabel(reductionDimPeelingResult.mainLoop, kPerfectlyTiledLoopLabel)",
          "new_text": "reductionDimTilingResult->loops.front()",
          "old_line_content": "      setLabel(reductionDimPeelingResult.mainLoop, kPerfectlyTiledLoopLabel);",
          "new_line_content": "        peelSCFForOp(rewriter, reductionDimTilingResult->loops.front());",
          "content_same": false
        },
        {
          "line": 265,
          "old_api": "success",
          "new_api": "setLabel",
          "old_text": "success()",
          "new_text": "setLabel(reductionDimPeelingResult.mainLoop, kPerfectlyTiledLoopLabel)",
          "old_line_content": "    return success();",
          "new_line_content": "      setLabel(reductionDimPeelingResult.mainLoop, kPerfectlyTiledLoopLabel);",
          "content_same": false
        },
        {
          "line": 277,
          "old_api": "getType",
          "new_api": "m_Constant",
          "old_text": "input.getType().cast<ShapedType>()",
          "new_text": "m_Constant(&inputValues)",
          "old_line_content": "  auto inputType = input.getType().cast<ShapedType>();",
          "new_line_content": "  matchPattern(input, m_Constant(&inputValues));",
          "content_same": false
        },
        {
          "line": 279,
          "old_api": "size",
          "new_api": "getType",
          "old_text": "inputShape.size()",
          "new_text": "input.getType().cast<ShapedType>()",
          "old_line_content": "  assert(inputShape.size() == 2);",
          "new_line_content": "  auto inputType = input.getType().cast<ShapedType>();",
          "content_same": false
        },
        {
          "line": 281,
          "old_api": "getElementType",
          "new_api": "size",
          "old_text": "RankedTensorType::get({inputShape[1], inputShape[0]},\n                                          inputType.getElementType())",
          "new_text": "inputShape.size()",
          "old_line_content": "  auto outputType = RankedTensorType::get({inputShape[1], inputShape[0]},",
          "new_line_content": "  assert(inputShape.size() == 2);",
          "content_same": false
        },
        {
          "line": 284,
          "old_api": "getNumElements",
          "new_api": "getElementType",
          "old_text": "inputType.getNumElements()",
          "new_text": "inputType.getElementType()",
          "old_line_content": "  SmallVector<Attribute, 4> outputValues(inputType.getNumElements());",
          "new_line_content": "                                          inputType.getElementType());",
          "content_same": false
        },
        {
          "line": 286,
          "old_api": "index",
          "new_api": "getNumElements",
          "old_text": "it.index()",
          "new_text": "inputType.getNumElements()",
          "old_line_content": "    auto row = it.index() / inputShape[1];",
          "new_line_content": "  SmallVector<Attribute, 4> outputValues(inputType.getNumElements());",
          "content_same": false
        },
        {
          "line": 287,
          "old_api": "index",
          "new_api": "inputValues.getValues<Attribute>()",
          "old_text": "it.index()",
          "new_text": "inputValues.getValues<Attribute>()",
          "old_line_content": "    auto col = it.index() % inputShape[1];",
          "new_line_content": "  for (const auto &it : llvm::enumerate(inputValues.getValues<Attribute>())) {",
          "content_same": false
        },
        {
          "line": 288,
          "old_api": "value",
          "new_api": "index",
          "old_text": "it.value()",
          "new_text": "it.index()",
          "old_line_content": "    outputValues[col * inputShape[0] + row] = it.value();",
          "new_line_content": "    auto row = it.index() / inputShape[1];",
          "content_same": false
        },
        {
          "line": 290,
          "old_api": "builder.create<arith::ConstantOp>(\n      outputType, DenseElementsAttr::get(outputType, outputValues))",
          "new_api": "value",
          "old_text": "builder.create<arith::ConstantOp>(\n      outputType, DenseElementsAttr::get(outputType, outputValues))",
          "new_text": "it.value()",
          "old_line_content": "  return builder.create<arith::ConstantOp>(",
          "new_line_content": "    outputValues[col * inputShape[0] + row] = it.value();",
          "content_same": false
        },
        {
          "line": 306,
          "old_api": "getLoc",
          "new_api": "failure",
          "old_text": "constantMatrix.getLoc()",
          "new_text": "failure()",
          "old_line_content": "    ImplicitLocOpBuilder builder(constantMatrix.getLoc(), rewriter);",
          "new_line_content": "    if (!constantMatrix) return failure();",
          "content_same": false
        },
        {
          "line": 308,
          "old_api": "getOperand",
          "new_api": "getLoc",
          "old_text": "rewriter.replaceOpWithNewOp<linalg::VecmatOp>(\n        matvecOp, ValueRange{matvecOp.getOperand(1), transposed},\n        matvecOp.getOutputs())",
          "new_text": "constantMatrix.getLoc()",
          "old_line_content": "    rewriter.replaceOpWithNewOp<linalg::VecmatOp>(",
          "new_line_content": "    ImplicitLocOpBuilder builder(constantMatrix.getLoc(), rewriter);",
          "content_same": false
        },
        {
          "line": 309,
          "old_api": "getOperand",
          "new_api": "transposeMatrixConstant",
          "old_text": "matvecOp.getOperand(1)",
          "new_text": "transposeMatrixConstant(builder, constantMatrix)",
          "old_line_content": "        matvecOp, ValueRange{matvecOp.getOperand(1), transposed},",
          "new_line_content": "    Value transposed = transposeMatrixConstant(builder, constantMatrix);",
          "content_same": false
        },
        {
          "line": 310,
          "old_api": "getOutputs",
          "new_api": "getOperand",
          "old_text": "matvecOp.getOutputs()",
          "new_text": "rewriter.replaceOpWithNewOp<linalg::VecmatOp>(\n        matvecOp, ValueRange{matvecOp.getOperand(1), transposed},\n        matvecOp.getOutputs())",
          "old_line_content": "        matvecOp.getOutputs());",
          "new_line_content": "    rewriter.replaceOpWithNewOp<linalg::VecmatOp>(",
          "content_same": false
        },
        {
          "line": 311,
          "old_api": "success",
          "new_api": "getOperand",
          "old_text": "success()",
          "new_text": "matvecOp.getOperand(1)",
          "old_line_content": "    return success();",
          "new_line_content": "        matvecOp, ValueRange{matvecOp.getOperand(1), transposed},",
          "content_same": false
        },
        {
          "line": 328,
          "old_api": "tensor::registerInferTypeOpInterfaceExternalModels(registry)",
          "new_api": "linalg::registerTilingInterfaceExternalModels(registry)",
          "old_text": "tensor::registerInferTypeOpInterfaceExternalModels(registry)",
          "new_text": "linalg::registerTilingInterfaceExternalModels(registry)",
          "old_line_content": "    tensor::registerInferTypeOpInterfaceExternalModels(registry);",
          "new_line_content": "    linalg::registerTilingInterfaceExternalModels(registry);",
          "content_same": false
        },
        {
          "line": 395,
          "old_api": "wrapHeuristic",
          "new_api": "starts_with",
          "old_text": "wrapHeuristic(skylakeTilingHeuristic, {16, 16, 4})",
          "new_text": "cpuName.starts_with(\"znver\")",
          "old_line_content": "                          : wrapHeuristic(skylakeTilingHeuristic, {16, 16, 4});",
          "new_line_content": "    tilingHeuristic = cpuName.starts_with(\"znver\")",
          "content_same": false
        },
        {
          "line": 397,
          "old_api": "std::make_unique<mlir::gml_st::TransformDotForCpuPass>(\n      std::move(tilingHeuristic))",
          "new_api": "wrapHeuristic",
          "old_text": "std::make_unique<mlir::gml_st::TransformDotForCpuPass>(\n      std::move(tilingHeuristic))",
          "new_text": "wrapHeuristic(skylakeTilingHeuristic, {16, 16, 4})",
          "old_line_content": "  return std::make_unique<mlir::gml_st::TransformDotForCpuPass>(",
          "new_line_content": "                          : wrapHeuristic(skylakeTilingHeuristic, {16, 16, 4});",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 129,
          "old_api": null,
          "new_api": "getType",
          "old_text": null,
          "new_text": "op->getOperand(0).getType().cast<ShapedType>()",
          "old_line_content": "  MatmulSizes sizes;",
          "new_line_content": "  ShapedType lhsTy = op->getOperand(0).getType().cast<ShapedType>();",
          "content_same": false
        },
        {
          "line": 257,
          "old_api": null,
          "new_api": "tileUsingSCFForOpAndFuseGreedily",
          "old_text": null,
          "new_text": "tileUsingSCFForOpAndFuseGreedily(\n            rewriter, reduceOp, getSCFTilingOptions(reductionDimTileSizes),\n            producerFilterFn)",
          "old_line_content": "            producerFilterFn);",
          "new_line_content": "        tileUsingSCFForOpAndFuseGreedily(",
          "content_same": false
        },
        {
          "line": 260,
          "old_api": null,
          "new_api": "failure",
          "old_text": null,
          "new_text": "failure()",
          "old_line_content": "    SCFForPeelingResult reductionDimPeelingResult =",
          "new_line_content": "    if (failed(reductionDimTilingResult)) return failure();",
          "content_same": false
        },
        {
          "line": 133,
          "old_api": null,
          "new_api": "getDimSize",
          "old_text": null,
          "new_text": "rhsTy.getDimSize(0)",
          "old_line_content": "  return sizes;",
          "new_line_content": "  sizes.k = rhsTy.getDimSize(0);",
          "content_same": false
        },
        {
          "line": 134,
          "old_api": null,
          "new_api": "getDimSize",
          "old_text": null,
          "new_text": "rhsTy.getDimSize(1)",
          "old_line_content": "}",
          "new_line_content": "  sizes.n = rhsTy.getDimSize(1);",
          "content_same": false
        },
        {
          "line": 390,
          "old_api": null,
          "new_api": "empty",
          "old_text": null,
          "new_text": "tileSizes.empty()",
          "old_line_content": "    MatmulSizes fixedSizes{tileSizes[0], tileSizes[1], tileSizes[2]};",
          "new_line_content": "  if (!tileSizes.empty()) {",
          "content_same": false
        },
        {
          "line": 391,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "tileSizes.size()",
          "old_line_content": "    tilingHeuristic = [=](MatmulSizes) { return fixedSizes; };",
          "new_line_content": "    assert(tileSizes.size() == 3 && \"Expected exactly 3 tile sizes for matmul\");",
          "content_same": false
        },
        {
          "line": 267,
          "old_api": null,
          "new_api": "success",
          "old_text": null,
          "new_text": "success()",
          "old_line_content": "",
          "new_line_content": "    return success();",
          "content_same": false
        },
        {
          "line": 140,
          "old_api": null,
          "new_api": "getType",
          "old_text": null,
          "new_text": "op->getOperand(1).getType().cast<ShapedType>()",
          "old_line_content": "  sizes.m = 1;",
          "new_line_content": "  ShapedType ty = op->getOperand(1).getType().cast<ShapedType>();",
          "content_same": false
        },
        {
          "line": 396,
          "old_api": null,
          "new_api": "wrapHeuristic",
          "old_text": null,
          "new_text": "wrapHeuristic(znver2TilingHeuristic, {16, 8, 8})",
          "old_line_content": "  }",
          "new_line_content": "                          ? wrapHeuristic(znver2TilingHeuristic, {16, 8, 8})",
          "content_same": false
        },
        {
          "line": 143,
          "old_api": null,
          "new_api": "getDimSize",
          "old_text": null,
          "new_text": "ty.getDimSize(0)",
          "old_line_content": "  return sizes;",
          "new_line_content": "  sizes.k = ty.getDimSize(0);",
          "content_same": false
        },
        {
          "line": 144,
          "old_api": null,
          "new_api": "getDimSize",
          "old_text": null,
          "new_text": "ty.getDimSize(1)",
          "old_line_content": "}",
          "new_line_content": "  sizes.n = ty.getDimSize(1);",
          "content_same": false
        },
        {
          "line": 399,
          "old_api": null,
          "new_api": "std::make_unique<mlir::gml_st::TransformDotForCpuPass>(\n      std::move(tilingHeuristic))",
          "old_text": null,
          "new_text": "std::make_unique<mlir::gml_st::TransformDotForCpuPass>(\n      std::move(tilingHeuristic))",
          "old_line_content": "}",
          "new_line_content": "  return std::make_unique<mlir::gml_st::TransformDotForCpuPass>(",
          "content_same": false
        },
        {
          "line": 400,
          "old_api": null,
          "new_api": "std::move(tilingHeuristic)",
          "old_text": null,
          "new_text": "std::move(tilingHeuristic)",
          "old_line_content": "",
          "new_line_content": "      std::move(tilingHeuristic));",
          "content_same": false
        },
        {
          "line": 152,
          "old_api": null,
          "new_api": "getDimSize",
          "old_text": null,
          "new_text": "ty.getDimSize(0)",
          "old_line_content": "  sizes.n = 1;",
          "new_line_content": "  sizes.m = ty.getDimSize(0);",
          "content_same": false
        },
        {
          "line": 153,
          "old_api": null,
          "new_api": "getDimSize",
          "old_text": null,
          "new_text": "ty.getDimSize(1)",
          "old_line_content": "  return sizes;",
          "new_line_content": "  sizes.k = ty.getDimSize(1);",
          "content_same": false
        },
        {
          "line": 280,
          "old_api": null,
          "new_api": "getShape",
          "old_text": null,
          "new_text": "inputType.getShape()",
          "old_line_content": "",
          "new_line_content": "  ArrayRef<int64_t> inputShape = inputType.getShape();",
          "content_same": false
        },
        {
          "line": 283,
          "old_api": null,
          "new_api": "getElementType",
          "old_text": null,
          "new_text": "RankedTensorType::get({inputShape[1], inputShape[0]},\n                                          inputType.getElementType())",
          "old_line_content": "",
          "new_line_content": "  auto outputType = RankedTensorType::get({inputShape[1], inputShape[0]},",
          "content_same": false
        },
        {
          "line": 160,
          "old_api": null,
          "new_api": "getType",
          "old_text": null,
          "new_text": "op->getOperand(0).getType().cast<ShapedType>()",
          "old_line_content": "  sizes.m = 1;",
          "new_line_content": "  ShapedType ty = op->getOperand(0).getType().cast<ShapedType>();",
          "content_same": false
        },
        {
          "line": 289,
          "old_api": null,
          "new_api": "index",
          "old_text": null,
          "new_text": "it.index()",
          "old_line_content": "  }",
          "new_line_content": "    auto col = it.index() % inputShape[1];",
          "content_same": false
        },
        {
          "line": 163,
          "old_api": null,
          "new_api": "getDimSize",
          "old_text": null,
          "new_text": "ty.getDimSize(0)",
          "old_line_content": "  return sizes;",
          "new_line_content": "  sizes.k = ty.getDimSize(0);",
          "content_same": false
        },
        {
          "line": 292,
          "old_api": null,
          "new_api": "builder.create<arith::ConstantOp>(\n      outputType, DenseElementsAttr::get(outputType, outputValues))",
          "old_text": null,
          "new_text": "builder.create<arith::ConstantOp>(\n      outputType, DenseElementsAttr::get(outputType, outputValues))",
          "old_line_content": "}",
          "new_line_content": "  return builder.create<arith::ConstantOp>(",
          "content_same": false
        },
        {
          "line": 293,
          "old_api": null,
          "new_api": "DenseElementsAttr::get(outputType, outputValues)",
          "old_text": null,
          "new_text": "DenseElementsAttr::get(outputType, outputValues)",
          "old_line_content": "",
          "new_line_content": "      outputType, DenseElementsAttr::get(outputType, outputValues));",
          "content_same": false
        },
        {
          "line": 169,
          "old_api": null,
          "new_api": "llvm::make_filter_range(\n      tileSizes, [](int64_t size) { return size != 0; })",
          "old_text": null,
          "new_text": "llvm::make_filter_range(\n      tileSizes, [](int64_t size) { return size != 0; })",
          "old_line_content": "}",
          "new_line_content": "  return to_vector(llvm::make_filter_range(",
          "content_same": false
        },
        {
          "line": 305,
          "old_api": null,
          "new_api": "getOperand",
          "old_text": null,
          "new_text": "matvecOp.getOperand(0).getDefiningOp<arith::ConstantOp>()",
          "old_line_content": "",
          "new_line_content": "        matvecOp.getOperand(0).getDefiningOp<arith::ConstantOp>();",
          "content_same": false
        },
        {
          "line": 179,
          "old_api": null,
          "new_api": "explicit",
          "old_text": null,
          "new_text": "explicit",
          "old_line_content": "      std::function<SmallVector<int64_t>(MatmulSizes)> parallelDimTileSizeFn,",
          "new_line_content": "  explicit DotTransformPattern(",
          "content_same": false
        },
        {
          "line": 312,
          "old_api": null,
          "new_api": "getOutputs",
          "old_text": null,
          "new_text": "matvecOp.getOutputs()",
          "old_line_content": "  }",
          "new_line_content": "        matvecOp.getOutputs());",
          "content_same": false
        },
        {
          "line": 313,
          "old_api": null,
          "new_api": "success",
          "old_text": null,
          "new_text": "success()",
          "old_line_content": "};",
          "new_line_content": "    return success();",
          "content_same": false
        },
        {
          "line": 186,
          "old_api": null,
          "new_api": "std::move(parallelDimTileSizeFn)",
          "old_text": null,
          "new_text": "std::move(parallelDimTileSizeFn)",
          "old_line_content": "",
          "new_line_content": "        parallelDimTileSizeFn(std::move(parallelDimTileSizeFn)),",
          "content_same": false
        },
        {
          "line": 187,
          "old_api": null,
          "new_api": "std::move(reductionDimTileSizeFn)",
          "old_text": null,
          "new_text": "std::move(reductionDimTileSizeFn)",
          "old_line_content": "  LogicalResult matchAndRewrite(DotTy dotOp,",
          "new_line_content": "        reductionDimTileSizeFn(std::move(reductionDimTileSizeFn)) {}",
          "content_same": false
        },
        {
          "line": 191,
          "old_api": null,
          "new_api": "hasLabel",
          "old_text": null,
          "new_text": "hasLabel(dotOp, kTransformedLabel)",
          "old_line_content": "                                         \"has already been transformed.\");",
          "new_line_content": "    if (hasLabel(dotOp, kTransformedLabel)) {",
          "content_same": false
        },
        {
          "line": 192,
          "old_api": null,
          "new_api": "notifyMatchFailure",
          "old_text": null,
          "new_text": "rewriter.notifyMatchFailure(dotOp,\n                                         \"has already been transformed.\")",
          "old_line_content": "    }",
          "new_line_content": "      return rewriter.notifyMatchFailure(dotOp,",
          "content_same": false
        },
        {
          "line": 321,
          "old_api": null,
          "new_api": "explicit",
          "old_text": null,
          "new_text": "explicit",
          "old_line_content": "",
          "new_line_content": "  explicit TransformDotForCpuPass(MatmulTileSizeComputationFn tileSizeFn)",
          "content_same": false
        },
        {
          "line": 322,
          "old_api": null,
          "new_api": "std::move(tileSizeFn)",
          "old_text": null,
          "new_text": "std::move(tileSizeFn)",
          "old_line_content": "  void getDependentDialects(DialectRegistry &registry) const final {",
          "new_line_content": "      : tileSizeFn(std::move(tileSizeFn)) {}",
          "content_same": false
        },
        {
          "line": 196,
          "old_api": null,
          "new_api": "isa<linalg::FillOp, thlo::ReverseOp, tensor::CastOp>(op)",
          "old_text": null,
          "new_text": "isa<linalg::FillOp, thlo::ReverseOp, tensor::CastOp>(op)",
          "old_line_content": "    auto consumerFilterFn = [](Operation *op) {",
          "new_line_content": "      return isa<linalg::FillOp, thlo::ReverseOp, tensor::CastOp>(op);",
          "content_same": false
        },
        {
          "line": 325,
          "old_api": null,
          "new_api": "registry.insert<mlir::gml_st::GmlStDialect, arith::ArithDialect,\n                    linalg::LinalgDialect, scf::SCFDialect,\n                    tensor::TensorDialect>()",
          "old_text": null,
          "new_text": "registry.insert<mlir::gml_st::GmlStDialect, arith::ArithDialect,\n                    linalg::LinalgDialect, scf::SCFDialect,\n                    tensor::TensorDialect>()",
          "old_line_content": "                    tensor::TensorDialect>();",
          "new_line_content": "    registry.insert<mlir::gml_st::GmlStDialect, arith::ArithDialect,",
          "content_same": false
        },
        {
          "line": 200,
          "old_api": null,
          "new_api": "getNumDpsInputs",
          "old_text": null,
          "new_text": "mapOp.getNumDpsInputs()",
          "old_line_content": "    };",
          "new_line_content": "        return mapOp.getNumDpsInputs() == 1;",
          "content_same": false
        },
        {
          "line": 201,
          "old_api": null,
          "new_api": "isa<thlo::ReverseOp>(op)",
          "old_text": null,
          "new_text": "isa<thlo::ReverseOp>(op)",
          "old_line_content": "",
          "new_line_content": "      return isa<thlo::ReverseOp>(op);",
          "content_same": false
        },
        {
          "line": 329,
          "old_api": null,
          "new_api": "tensor::registerTilingInterfaceExternalModels(registry)",
          "old_text": null,
          "new_text": "tensor::registerTilingInterfaceExternalModels(registry)",
          "old_line_content": "  }",
          "new_line_content": "    tensor::registerTilingInterfaceExternalModels(registry);",
          "content_same": false
        },
        {
          "line": 330,
          "old_api": null,
          "new_api": "tensor::registerInferTypeOpInterfaceExternalModels(registry)",
          "old_text": null,
          "new_text": "tensor::registerInferTypeOpInterfaceExternalModels(registry)",
          "old_line_content": "",
          "new_line_content": "    tensor::registerInferTypeOpInterfaceExternalModels(registry);",
          "content_same": false
        },
        {
          "line": 76,
          "old_api": null,
          "new_api": "std::min<int64_t>(sizes.n, 32)",
          "old_text": null,
          "new_text": "std::min<int64_t>(sizes.n, 32)",
          "old_line_content": "",
          "new_line_content": "    return {1, std::min<int64_t>(sizes.n, 32), 1};",
          "content_same": false
        },
        {
          "line": 204,
          "old_api": null,
          "new_api": "getFusionCluster",
          "old_text": null,
          "new_text": "getFusionCluster(dotOp, producerFilterFn, consumerFilterFn)",
          "old_line_content": "    auto *tilingRoot = cluster.root;",
          "new_line_content": "    auto cluster = getFusionCluster(dotOp, producerFilterFn, consumerFilterFn);",
          "content_same": false
        },
        {
          "line": 334,
          "old_api": null,
          "new_api": "getOperation",
          "old_text": null,
          "new_text": "getOperation()",
          "old_line_content": "",
          "new_line_content": "    func::FuncOp f = getOperation();",
          "content_same": false
        },
        {
          "line": 335,
          "old_api": null,
          "new_api": "getContext",
          "old_text": null,
          "new_text": "getContext()",
          "old_line_content": "    // Dot operations can have at most 3 dimensions ((upto) 2 parallel + 1",
          "new_line_content": "    MLIRContext *ctx = &getContext();",
          "content_same": false
        },
        {
          "line": 83,
          "old_api": null,
          "new_api": "std::min<int64_t>(8, sizes.m)",
          "old_text": null,
          "new_text": "std::min<int64_t>(8, sizes.m)",
          "old_line_content": "",
          "new_line_content": "    return {std::min<int64_t>(8, sizes.m), 1, 4};",
          "content_same": false
        },
        {
          "line": 211,
          "old_api": null,
          "new_api": "isa<DotTy>(tilingRoot)",
          "old_text": null,
          "new_text": "isa<DotTy>(tilingRoot)",
          "old_line_content": "",
          "new_line_content": "    if (!isa<DotTy>(tilingRoot))",
          "content_same": false
        },
        {
          "line": 88,
          "old_api": null,
          "new_api": "std::min<int64_t>(8, sizes.n)",
          "old_text": null,
          "new_text": "std::min<int64_t>(8, sizes.n)",
          "old_line_content": "  return result;",
          "new_line_content": "  result.n = std::min<int64_t>(8, sizes.n) << (sizes.m <= 16 ? 1 : 0);",
          "content_same": false
        },
        {
          "line": 89,
          "old_api": null,
          "new_api": "std::min<int64_t>(32, sizes.m)",
          "old_text": null,
          "new_text": "std::min<int64_t>(32, sizes.m)",
          "old_line_content": "}",
          "new_line_content": "  result.m = std::min<int64_t>(32, sizes.m) << (sizes.n <= 4 ? 1 : 0);",
          "content_same": false
        },
        {
          "line": 216,
          "old_api": null,
          "new_api": "contains",
          "old_text": null,
          "new_text": "fusionCluster.contains(op)",
          "old_line_content": "",
          "new_line_content": "        [&](Operation *op) { return fusionCluster.contains(op); });",
          "content_same": false
        },
        {
          "line": 217,
          "old_api": null,
          "new_api": "failure",
          "old_text": null,
          "new_text": "failure()",
          "old_line_content": "    if (!tilingParallelDimsResult->loop) {",
          "new_line_content": "    if (failed(tilingParallelDimsResult)) return failure();",
          "content_same": false
        },
        {
          "line": 220,
          "old_api": null,
          "new_api": "tileAndPeelReductionDim",
          "old_text": null,
          "new_text": "tileAndPeelReductionDim(\n          rewriter, dotOp, reductionDimTileSizeFn(tileSizes), producerFilterFn)",
          "old_line_content": "    }",
          "new_line_content": "      return tileAndPeelReductionDim(",
          "content_same": false
        },
        {
          "line": 221,
          "old_api": null,
          "new_api": "reductionDimTileSizeFn",
          "old_text": null,
          "new_text": "reductionDimTileSizeFn(tileSizes)",
          "old_line_content": "    auto peeledParallelLoop =",
          "new_line_content": "          rewriter, dotOp, reductionDimTileSizeFn(tileSizes), producerFilterFn);",
          "content_same": false
        },
        {
          "line": 348,
          "old_api": null,
          "new_api": "patterns.add<MatVecToVecMatPattern>(ctx, 2)",
          "old_text": null,
          "new_text": "patterns.add<MatVecToVecMatPattern>(ctx, 2)",
          "old_line_content": "        ctx, tileSizeFn,",
          "new_line_content": "    patterns.add<MatVecToVecMatPattern>(ctx, 2);",
          "content_same": false
        },
        {
          "line": 349,
          "old_api": null,
          "new_api": "patterns.add<DotTransformPattern<linalg::MatmulOp>>(\n        ctx, tileSizeFn,\n        [&](MatmulSizes sizes) -> SmallVector<int64_t> {\n          return {sizes.m, sizes.n, 0};\n        },\n        [&](MatmulSizes sizes) -> SmallVector<int64_t> {\n          return {0, 0, sizes.k};\n        })",
          "old_text": null,
          "new_text": "patterns.add<DotTransformPattern<linalg::MatmulOp>>(\n        ctx, tileSizeFn,\n        [&](MatmulSizes sizes) -> SmallVector<int64_t> {\n          return {sizes.m, sizes.n, 0};\n        },\n        [&](MatmulSizes sizes) -> SmallVector<int64_t> {\n          return {0, 0, sizes.k};\n        })",
          "old_line_content": "        [&](MatmulSizes sizes) -> SmallVector<int64_t> {",
          "new_line_content": "    patterns.add<DotTransformPattern<linalg::MatmulOp>>(",
          "content_same": false
        },
        {
          "line": 224,
          "old_api": null,
          "new_api": "peelAllLoops",
          "old_text": null,
          "new_text": "peelAllLoops(tilingParallelDimsResult->loop, rewriter)",
          "old_line_content": "    // Process main parallel loop.",
          "new_line_content": "        peelAllLoops(tilingParallelDimsResult->loop, rewriter);",
          "content_same": false
        },
        {
          "line": 248,
          "old_api": null,
          "new_api": "success",
          "old_text": null,
          "new_text": "success()",
          "old_line_content": "",
          "new_line_content": "    return success();",
          "content_same": false
        },
        {
          "line": 357,
          "old_api": null,
          "new_api": "patterns.add<DotTransformPattern<linalg::MatvecOp>>(\n        ctx, tileSizeFn,\n        [&](MatmulSizes sizes) -> SmallVector<int64_t> {\n          return {sizes.m, 0};\n        },\n        [&](MatmulSizes sizes) -> SmallVector<int64_t> {\n          return {0, sizes.k};\n        })",
          "old_text": null,
          "new_text": "patterns.add<DotTransformPattern<linalg::MatvecOp>>(\n        ctx, tileSizeFn,\n        [&](MatmulSizes sizes) -> SmallVector<int64_t> {\n          return {sizes.m, 0};\n        },\n        [&](MatmulSizes sizes) -> SmallVector<int64_t> {\n          return {0, sizes.k};\n        })",
          "old_line_content": "        [&](MatmulSizes sizes) -> SmallVector<int64_t> {",
          "new_line_content": "    patterns.add<DotTransformPattern<linalg::MatvecOp>>(",
          "content_same": false
        },
        {
          "line": 230,
          "old_api": null,
          "new_api": "tileAndPeelReductionDim",
          "old_text": null,
          "new_text": "tileAndPeelReductionDim(rewriter, tiledDotOp,\n                                         reductionDimTileSizeFn(tileSizes),\n                                         producerFilterFn)",
          "old_line_content": "                                         producerFilterFn))) {",
          "new_line_content": "      if (failed(tileAndPeelReductionDim(rewriter, tiledDotOp,",
          "content_same": false
        },
        {
          "line": 233,
          "old_api": null,
          "new_api": "failure",
          "old_text": null,
          "new_text": "failure()",
          "old_line_content": "    }",
          "new_line_content": "        return failure();",
          "content_same": false
        },
        {
          "line": 106,
          "old_api": null,
          "new_api": "std::min<int64_t>(16, sizes.n)",
          "old_text": null,
          "new_text": "std::min<int64_t>(16, sizes.n)",
          "old_line_content": "  return result;",
          "new_line_content": "    result.n = std::min<int64_t>(16, sizes.n);",
          "content_same": false
        },
        {
          "line": 365,
          "old_api": null,
          "new_api": "patterns.add<DotTransformPattern<linalg::VecmatOp>>(\n        ctx, tileSizeFn,\n        [&](MatmulSizes sizes) -> SmallVector<int64_t> {\n          return {sizes.n, 0};\n        },\n        [&](MatmulSizes sizes) -> SmallVector<int64_t> {\n          return {0, sizes.k};\n        })",
          "old_text": null,
          "new_text": "patterns.add<DotTransformPattern<linalg::VecmatOp>>(\n        ctx, tileSizeFn,\n        [&](MatmulSizes sizes) -> SmallVector<int64_t> {\n          return {sizes.n, 0};\n        },\n        [&](MatmulSizes sizes) -> SmallVector<int64_t> {\n          return {0, sizes.k};\n        })",
          "old_line_content": "        [&](MatmulSizes sizes) -> SmallVector<int64_t> {",
          "new_line_content": "    patterns.add<DotTransformPattern<linalg::VecmatOp>>(",
          "content_same": false
        },
        {
          "line": 240,
          "old_api": null,
          "new_api": "getBody",
          "old_text": null,
          "new_text": "tailParallelLoop.getBody()->template getOps<DotTy>()",
          "old_line_content": "            rewriter, tiledDotOp,",
          "new_line_content": "               tailParallelLoop.getBody()->template getOps<DotTy>())) {",
          "content_same": false
        },
        {
          "line": 379,
          "old_api": null,
          "new_api": "signalPassFailure",
          "old_text": null,
          "new_text": "signalPassFailure()",
          "old_line_content": "",
          "new_line_content": "      return signalPassFailure();",
          "content_same": false
        },
        {
          "line": 245,
          "old_api": null,
          "new_api": "failure",
          "old_text": null,
          "new_text": "failure()",
          "old_line_content": "    }",
          "new_line_content": "        if (failed(reductionDimTilingResult)) return failure();",
          "content_same": false
        },
        {
          "line": 373,
          "old_api": null,
          "new_api": "patterns.add<DotTransformPattern<linalg::DotOp>>(\n        ctx, tileSizeFn,\n        [&](MatmulSizes) -> SmallVector<int64_t> { return {}; },\n        [&](MatmulSizes sizes) -> SmallVector<int64_t> { return {sizes.k}; })",
          "old_text": null,
          "new_text": "patterns.add<DotTransformPattern<linalg::DotOp>>(\n        ctx, tileSizeFn,\n        [&](MatmulSizes) -> SmallVector<int64_t> { return {}; },\n        [&](MatmulSizes sizes) -> SmallVector<int64_t> { return {sizes.k}; })",
          "old_line_content": "        [&](MatmulSizes) -> SmallVector<int64_t> { return {}; },",
          "new_line_content": "    patterns.add<DotTransformPattern<linalg::DotOp>>(",
          "content_same": false
        },
        {
          "line": 120,
          "old_api": null,
          "new_api": "roundDownToPowerOfTwo",
          "old_text": null,
          "new_text": "roundDownToPowerOfTwo(sizes.n)",
          "old_line_content": "",
          "new_line_content": "    sizes.n = roundDownToPowerOfTwo(sizes.n);",
          "content_same": false
        },
        {
          "line": 378,
          "old_api": null,
          "new_api": "std::move(patterns)",
          "old_text": null,
          "new_text": "std::move(patterns)",
          "old_line_content": "  }",
          "new_line_content": "    if (failed(applyPatternsAndFoldGreedily(f, std::move(patterns))))",
          "content_same": false
        },
        {
          "line": 123,
          "old_api": null,
          "new_api": "heuristic",
          "old_text": null,
          "new_text": "heuristic(sizes)",
          "old_line_content": "}",
          "new_line_content": "    return heuristic(sizes);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 128,
          "old_api": "getType",
          "new_api": null,
          "old_text": "op->getOperand(1).getType().cast<ShapedType>()",
          "new_text": null,
          "old_line_content": "  ShapedType rhsTy = op->getOperand(1).getType().cast<ShapedType>();",
          "new_line_content": "  // [m, k] x [k, n]",
          "content_same": false
        },
        {
          "line": 256,
          "old_api": "getSCFTilingOptions",
          "new_api": null,
          "old_text": "getSCFTilingOptions(reductionDimTileSizes)",
          "new_text": null,
          "old_line_content": "            rewriter, reduceOp, getSCFTilingOptions(reductionDimTileSizes),",
          "new_line_content": "    FailureOr<scf::SCFTilingResult> reductionDimTilingResult =",
          "content_same": false
        },
        {
          "line": 131,
          "old_api": "getDimSize",
          "new_api": null,
          "old_text": "rhsTy.getDimSize(0)",
          "new_text": null,
          "old_line_content": "  sizes.k = rhsTy.getDimSize(0);",
          "new_line_content": "  MatmulSizes sizes;",
          "content_same": false
        },
        {
          "line": 255,
          "old_api": "tileUsingSCFForOpAndFuseGreedily",
          "new_api": null,
          "old_text": "tileUsingSCFForOpAndFuseGreedily(\n            rewriter, reduceOp, getSCFTilingOptions(reductionDimTileSizes),\n            producerFilterFn)",
          "new_text": null,
          "old_line_content": "        tileUsingSCFForOpAndFuseGreedily(",
          "new_line_content": "      llvm::function_ref<bool(Operation *)> producerFilterFn) const {",
          "content_same": false
        },
        {
          "line": 261,
          "old_api": "front",
          "new_api": null,
          "old_text": "reductionDimTilingResult->loops.front()",
          "new_text": null,
          "old_line_content": "        peelSCFForOp(rewriter, reductionDimTilingResult->loops.front());",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 388,
          "old_api": "empty",
          "new_api": null,
          "old_text": "tileSizes.empty()",
          "new_text": null,
          "old_line_content": "  if (!tileSizes.empty()) {",
          "new_line_content": "createTransformDotForCpuPass(ArrayRef<int64_t> tileSizes, StringRef cpuName) {",
          "content_same": false
        },
        {
          "line": 389,
          "old_api": "size",
          "new_api": null,
          "old_text": "tileSizes.size()",
          "new_text": null,
          "old_line_content": "    assert(tileSizes.size() == 3 && \"Expected exactly 3 tile sizes for matmul\");",
          "new_line_content": "  std::function<MatmulSizes(MatmulSizes)> tilingHeuristic;",
          "content_same": false
        },
        {
          "line": 393,
          "old_api": "starts_with",
          "new_api": null,
          "old_text": "cpuName.starts_with(\"znver\")",
          "new_text": null,
          "old_line_content": "    tilingHeuristic = cpuName.starts_with(\"znver\")",
          "new_line_content": "    tilingHeuristic = [=](MatmulSizes) { return fixedSizes; };",
          "content_same": false
        },
        {
          "line": 138,
          "old_api": "getType",
          "new_api": null,
          "old_text": "op->getOperand(1).getType().cast<ShapedType>()",
          "new_text": null,
          "old_line_content": "  ShapedType ty = op->getOperand(1).getType().cast<ShapedType>();",
          "new_line_content": "MatmulSizes getMatmulSizes(linalg::VecmatOp op) {",
          "content_same": false
        },
        {
          "line": 394,
          "old_api": "wrapHeuristic",
          "new_api": null,
          "old_text": "wrapHeuristic(znver2TilingHeuristic, {16, 8, 8})",
          "new_text": null,
          "old_line_content": "                          ? wrapHeuristic(znver2TilingHeuristic, {16, 8, 8})",
          "new_line_content": "  } else {",
          "content_same": false
        },
        {
          "line": 141,
          "old_api": "getDimSize",
          "new_api": null,
          "old_text": "ty.getDimSize(0)",
          "new_text": null,
          "old_line_content": "  sizes.k = ty.getDimSize(0);",
          "new_line_content": "  MatmulSizes sizes;",
          "content_same": false
        },
        {
          "line": 142,
          "old_api": "getDimSize",
          "new_api": null,
          "old_text": "ty.getDimSize(1)",
          "new_text": null,
          "old_line_content": "  sizes.n = ty.getDimSize(1);",
          "new_line_content": "  sizes.m = 1;",
          "content_same": false
        },
        {
          "line": 398,
          "old_api": "std::move(tilingHeuristic)",
          "new_api": null,
          "old_text": "std::move(tilingHeuristic)",
          "new_text": null,
          "old_line_content": "      std::move(tilingHeuristic));",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 275,
          "old_api": "m_Constant",
          "new_api": null,
          "old_text": "m_Constant(&inputValues)",
          "new_text": null,
          "old_line_content": "  matchPattern(input, m_Constant(&inputValues));",
          "new_line_content": "Value transposeMatrixConstant(ImplicitLocOpBuilder &builder, Value input) {",
          "content_same": false
        },
        {
          "line": 148,
          "old_api": "getType",
          "new_api": null,
          "old_text": "op->getOperand(0).getType().cast<ShapedType>()",
          "new_text": null,
          "old_line_content": "  ShapedType ty = op->getOperand(0).getType().cast<ShapedType>();",
          "new_line_content": "MatmulSizes getMatmulSizes(linalg::MatvecOp op) {",
          "content_same": false
        },
        {
          "line": 278,
          "old_api": "getShape",
          "new_api": null,
          "old_text": "inputType.getShape()",
          "new_text": null,
          "old_line_content": "  ArrayRef<int64_t> inputShape = inputType.getShape();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 151,
          "old_api": "getDimSize",
          "new_api": null,
          "old_text": "ty.getDimSize(1)",
          "new_text": null,
          "old_line_content": "  sizes.k = ty.getDimSize(1);",
          "new_line_content": "  MatmulSizes sizes;",
          "content_same": false
        },
        {
          "line": 282,
          "old_api": "getElementType",
          "new_api": null,
          "old_text": "inputType.getElementType()",
          "new_text": null,
          "old_line_content": "                                          inputType.getElementType());",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 285,
          "old_api": "inputValues.getValues<Attribute>()",
          "new_api": null,
          "old_text": "inputValues.getValues<Attribute>()",
          "new_text": null,
          "old_line_content": "  for (const auto &it : llvm::enumerate(inputValues.getValues<Attribute>())) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 158,
          "old_api": "getType",
          "new_api": null,
          "old_text": "op->getOperand(0).getType().cast<ShapedType>()",
          "new_text": null,
          "old_line_content": "  ShapedType ty = op->getOperand(0).getType().cast<ShapedType>();",
          "new_line_content": "MatmulSizes getMatmulSizes(linalg::DotOp op) {",
          "content_same": false
        },
        {
          "line": 161,
          "old_api": "getDimSize",
          "new_api": null,
          "old_text": "ty.getDimSize(0)",
          "new_text": null,
          "old_line_content": "  sizes.k = ty.getDimSize(0);",
          "new_line_content": "  MatmulSizes sizes;",
          "content_same": false
        },
        {
          "line": 291,
          "old_api": "DenseElementsAttr::get(outputType, outputValues)",
          "new_api": null,
          "old_text": "DenseElementsAttr::get(outputType, outputValues)",
          "new_text": null,
          "old_line_content": "      outputType, DenseElementsAttr::get(outputType, outputValues));",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 167,
          "old_api": "llvm::make_filter_range(\n      tileSizes, [](int64_t size) { return size != 0; })",
          "new_api": null,
          "old_text": "llvm::make_filter_range(\n      tileSizes, [](int64_t size) { return size != 0; })",
          "new_text": null,
          "old_line_content": "  return to_vector(llvm::make_filter_range(",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 303,
          "old_api": "getOperand",
          "new_api": null,
          "old_text": "matvecOp.getOperand(0).getDefiningOp<arith::ConstantOp>()",
          "new_text": null,
          "old_line_content": "        matvecOp.getOperand(0).getDefiningOp<arith::ConstantOp>();",
          "new_line_content": "                                PatternRewriter &rewriter) const override {",
          "content_same": false
        },
        {
          "line": 304,
          "old_api": "failure",
          "new_api": null,
          "old_text": "failure()",
          "new_text": null,
          "old_line_content": "    if (!constantMatrix) return failure();",
          "new_line_content": "    auto constantMatrix =",
          "content_same": false
        },
        {
          "line": 177,
          "old_api": "explicit",
          "new_api": null,
          "old_text": "explicit",
          "new_text": null,
          "old_line_content": "  explicit DotTransformPattern(",
          "new_line_content": "  using OpRewritePattern<DotTy>::OpRewritePattern;",
          "content_same": false
        },
        {
          "line": 307,
          "old_api": "transposeMatrixConstant",
          "new_api": null,
          "old_text": "transposeMatrixConstant(builder, constantMatrix)",
          "new_text": null,
          "old_line_content": "    Value transposed = transposeMatrixConstant(builder, constantMatrix);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 183,
          "old_api": "std::move(tileSizeFn)",
          "new_api": null,
          "old_text": "std::move(tileSizeFn)",
          "new_text": null,
          "old_line_content": "        tileSizeFn(std::move(tileSizeFn)),",
          "new_line_content": "      PatternBenefit benefit = 1)",
          "content_same": false
        },
        {
          "line": 184,
          "old_api": "std::move(parallelDimTileSizeFn)",
          "new_api": null,
          "old_text": "std::move(parallelDimTileSizeFn)",
          "new_text": null,
          "old_line_content": "        parallelDimTileSizeFn(std::move(parallelDimTileSizeFn)),",
          "new_line_content": "      : OpRewritePattern<DotTy>(context, benefit),",
          "content_same": false
        },
        {
          "line": 189,
          "old_api": "hasLabel",
          "new_api": null,
          "old_text": "hasLabel(dotOp, kTransformedLabel)",
          "new_text": null,
          "old_line_content": "    if (hasLabel(dotOp, kTransformedLabel)) {",
          "new_line_content": "  LogicalResult matchAndRewrite(DotTy dotOp,",
          "content_same": false
        },
        {
          "line": 190,
          "old_api": "notifyMatchFailure",
          "new_api": null,
          "old_text": "rewriter.notifyMatchFailure(dotOp,\n                                         \"has already been transformed.\")",
          "new_text": null,
          "old_line_content": "      return rewriter.notifyMatchFailure(dotOp,",
          "new_line_content": "                                PatternRewriter &rewriter) const override {",
          "content_same": false
        },
        {
          "line": 319,
          "old_api": "explicit",
          "new_api": null,
          "old_text": "explicit",
          "new_text": null,
          "old_line_content": "  explicit TransformDotForCpuPass(MatmulTileSizeComputationFn tileSizeFn)",
          "new_line_content": "  TransformDotForCpuPass() = default;",
          "content_same": false
        },
        {
          "line": 320,
          "old_api": "std::move(tileSizeFn)",
          "new_api": null,
          "old_text": "std::move(tileSizeFn)",
          "new_text": null,
          "old_line_content": "      : tileSizeFn(std::move(tileSizeFn)) {}",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 194,
          "old_api": "isa<linalg::FillOp, thlo::ReverseOp, tensor::CastOp>(op)",
          "new_api": null,
          "old_text": "isa<linalg::FillOp, thlo::ReverseOp, tensor::CastOp>(op)",
          "new_text": null,
          "old_line_content": "      return isa<linalg::FillOp, thlo::ReverseOp, tensor::CastOp>(op);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 323,
          "old_api": "registry.insert<mlir::gml_st::GmlStDialect, arith::ArithDialect,\n                    linalg::LinalgDialect, scf::SCFDialect,\n                    tensor::TensorDialect>()",
          "new_api": null,
          "old_text": "registry.insert<mlir::gml_st::GmlStDialect, arith::ArithDialect,\n                    linalg::LinalgDialect, scf::SCFDialect,\n                    tensor::TensorDialect>()",
          "new_text": null,
          "old_line_content": "    registry.insert<mlir::gml_st::GmlStDialect, arith::ArithDialect,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 197,
          "old_api": "dyn_cast<linalg::MapOp>(op)",
          "new_api": null,
          "old_text": "dyn_cast<linalg::MapOp>(op)",
          "new_text": null,
          "old_line_content": "      if (auto mapOp = dyn_cast<linalg::MapOp>(op))",
          "new_line_content": "    };",
          "content_same": false
        },
        {
          "line": 198,
          "old_api": "getNumDpsInputs",
          "new_api": null,
          "old_text": "mapOp.getNumDpsInputs()",
          "new_text": null,
          "old_line_content": "        return mapOp.getNumDpsInputs() == 1;",
          "new_line_content": "    auto consumerFilterFn = [](Operation *op) {",
          "content_same": false
        },
        {
          "line": 326,
          "old_api": "linalg::registerTilingInterfaceExternalModels(registry)",
          "new_api": null,
          "old_text": "linalg::registerTilingInterfaceExternalModels(registry)",
          "new_text": null,
          "old_line_content": "    linalg::registerTilingInterfaceExternalModels(registry);",
          "new_line_content": "                    linalg::LinalgDialect, scf::SCFDialect,",
          "content_same": false
        },
        {
          "line": 327,
          "old_api": "tensor::registerTilingInterfaceExternalModels(registry)",
          "new_api": null,
          "old_text": "tensor::registerTilingInterfaceExternalModels(registry)",
          "new_text": null,
          "old_line_content": "    tensor::registerTilingInterfaceExternalModels(registry);",
          "new_line_content": "                    tensor::TensorDialect>();",
          "content_same": false
        },
        {
          "line": 202,
          "old_api": "getFusionCluster",
          "new_api": null,
          "old_text": "getFusionCluster(dotOp, producerFilterFn, consumerFilterFn)",
          "new_text": null,
          "old_line_content": "    auto cluster = getFusionCluster(dotOp, producerFilterFn, consumerFilterFn);",
          "new_line_content": "    };",
          "content_same": false
        },
        {
          "line": 332,
          "old_api": "getOperation",
          "new_api": null,
          "old_text": "getOperation()",
          "new_text": null,
          "old_line_content": "    func::FuncOp f = getOperation();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 333,
          "old_api": "getContext",
          "new_api": null,
          "old_text": "getContext()",
          "new_text": null,
          "old_line_content": "    MLIRContext *ctx = &getContext();",
          "new_line_content": "  void runOnOperation() override {",
          "content_same": false
        },
        {
          "line": 207,
          "old_api": "getMatmulSizes",
          "new_api": null,
          "old_text": "getMatmulSizes(dotOp)",
          "new_text": null,
          "old_line_content": "    auto tileSizes = tileSizeFn(getMatmulSizes(dotOp));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 208,
          "old_api": "parallelDimTileSizeFn",
          "new_api": null,
          "old_text": "parallelDimTileSizeFn(tileSizes)",
          "new_text": null,
          "old_line_content": "    auto parallelDimsTileSizes = parallelDimTileSizeFn(tileSizes);",
          "new_line_content": "    // First level tiling: parallel dimension.",
          "content_same": false
        },
        {
          "line": 81,
          "old_api": "std::min<int64_t>(8, sizes.m)",
          "new_api": null,
          "old_text": "std::min<int64_t>(8, sizes.m)",
          "new_text": null,
          "old_line_content": "    return {std::min<int64_t>(8, sizes.m), 1, 4};",
          "new_line_content": "      return {1, 1, 1};",
          "content_same": false
        },
        {
          "line": 213,
          "old_api": "getSCFTilingOptions",
          "new_api": null,
          "old_text": "getSCFTilingOptions(parallelDimsTileSizes)",
          "new_text": null,
          "old_line_content": "        rewriter, tilingRoot, getSCFTilingOptions(parallelDimsTileSizes),",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 86,
          "old_api": "std::min<int64_t>(8, sizes.n)",
          "new_api": null,
          "old_text": "std::min<int64_t>(8, sizes.n)",
          "new_text": null,
          "old_line_content": "  result.n = std::min<int64_t>(8, sizes.n) << (sizes.m <= 16 ? 1 : 0);",
          "new_line_content": "  MatmulSizes result;",
          "content_same": false
        },
        {
          "line": 87,
          "old_api": "std::min<int64_t>(32, sizes.m)",
          "new_api": null,
          "old_text": "std::min<int64_t>(32, sizes.m)",
          "new_text": null,
          "old_line_content": "  result.m = std::min<int64_t>(32, sizes.m) << (sizes.n <= 4 ? 1 : 0);",
          "new_line_content": "  result.k = sizes.k <= 8 ? 1 : 4;",
          "content_same": false
        },
        {
          "line": 218,
          "old_api": "tileAndPeelReductionDim",
          "new_api": null,
          "old_text": "tileAndPeelReductionDim(\n          rewriter, dotOp, reductionDimTileSizeFn(tileSizes), producerFilterFn)",
          "new_text": null,
          "old_line_content": "      return tileAndPeelReductionDim(",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 219,
          "old_api": "reductionDimTileSizeFn",
          "new_api": null,
          "old_text": "reductionDimTileSizeFn(tileSizes)",
          "new_text": null,
          "old_line_content": "          rewriter, dotOp, reductionDimTileSizeFn(tileSizes), producerFilterFn);",
          "new_line_content": "    if (!tilingParallelDimsResult->loop) {",
          "content_same": false
        },
        {
          "line": 346,
          "old_api": "patterns.add<MatVecToVecMatPattern>(ctx, 2)",
          "new_api": null,
          "old_text": "patterns.add<MatVecToVecMatPattern>(ctx, 2)",
          "new_text": null,
          "old_line_content": "    patterns.add<MatVecToVecMatPattern>(ctx, 2);",
          "new_line_content": "    // - for linalg.dot: only the last element of tileSizes is used.",
          "content_same": false
        },
        {
          "line": 347,
          "old_api": "patterns.add<DotTransformPattern<linalg::MatmulOp>>(\n        ctx, tileSizeFn,\n        [&](MatmulSizes sizes) -> SmallVector<int64_t> {\n          return {sizes.m, sizes.n, 0};\n        },\n        [&](MatmulSizes sizes) -> SmallVector<int64_t> {\n          return {0, 0, sizes.k};\n        })",
          "new_api": null,
          "old_text": "patterns.add<DotTransformPattern<linalg::MatmulOp>>(\n        ctx, tileSizeFn,\n        [&](MatmulSizes sizes) -> SmallVector<int64_t> {\n          return {sizes.m, sizes.n, 0};\n        },\n        [&](MatmulSizes sizes) -> SmallVector<int64_t> {\n          return {0, 0, sizes.k};\n        })",
          "new_text": null,
          "old_line_content": "    patterns.add<DotTransformPattern<linalg::MatmulOp>>(",
          "new_line_content": "    RewritePatternSet patterns(ctx);",
          "content_same": false
        },
        {
          "line": 222,
          "old_api": "peelAllLoops",
          "new_api": null,
          "old_text": "peelAllLoops(tilingParallelDimsResult->loop, rewriter)",
          "new_text": null,
          "old_line_content": "        peelAllLoops(tilingParallelDimsResult->loop, rewriter);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 227,
          "old_api": "getBody",
          "new_api": null,
          "old_text": "mainParallelLoop.getBody()->getOps<DotTy>().begin()",
          "new_text": null,
          "old_line_content": "      auto tiledDotOp = *mainParallelLoop.getBody()->getOps<DotTy>().begin();",
          "new_line_content": "    scf::ForallOp mainParallelLoop = peeledParallelLoop.mainLoop;",
          "content_same": false
        },
        {
          "line": 228,
          "old_api": "tileAndPeelReductionDim",
          "new_api": null,
          "old_text": "tileAndPeelReductionDim(rewriter, tiledDotOp,\n                                         reductionDimTileSizeFn(tileSizes),\n                                         producerFilterFn)",
          "new_text": null,
          "old_line_content": "      if (failed(tileAndPeelReductionDim(rewriter, tiledDotOp,",
          "new_line_content": "    if (mainParallelLoop) {",
          "content_same": false
        },
        {
          "line": 355,
          "old_api": "patterns.add<DotTransformPattern<linalg::MatvecOp>>(\n        ctx, tileSizeFn,\n        [&](MatmulSizes sizes) -> SmallVector<int64_t> {\n          return {sizes.m, 0};\n        },\n        [&](MatmulSizes sizes) -> SmallVector<int64_t> {\n          return {0, sizes.k};\n        })",
          "new_api": null,
          "old_text": "patterns.add<DotTransformPattern<linalg::MatvecOp>>(\n        ctx, tileSizeFn,\n        [&](MatmulSizes sizes) -> SmallVector<int64_t> {\n          return {sizes.m, 0};\n        },\n        [&](MatmulSizes sizes) -> SmallVector<int64_t> {\n          return {0, sizes.k};\n        })",
          "new_text": null,
          "old_line_content": "    patterns.add<DotTransformPattern<linalg::MatvecOp>>(",
          "new_line_content": "          return {0, 0, sizes.k};",
          "content_same": false
        },
        {
          "line": 102,
          "old_api": "std::min<int64_t>(64, sizes.n)",
          "new_api": null,
          "old_text": "std::min<int64_t>(64, sizes.n)",
          "new_text": null,
          "old_line_content": "    result.n = std::min<int64_t>(64, sizes.n) * (sizes.k <= 64 ? 1 : 2);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 363,
          "old_api": "patterns.add<DotTransformPattern<linalg::VecmatOp>>(\n        ctx, tileSizeFn,\n        [&](MatmulSizes sizes) -> SmallVector<int64_t> {\n          return {sizes.n, 0};\n        },\n        [&](MatmulSizes sizes) -> SmallVector<int64_t> {\n          return {0, sizes.k};\n        })",
          "new_api": null,
          "old_text": "patterns.add<DotTransformPattern<linalg::VecmatOp>>(\n        ctx, tileSizeFn,\n        [&](MatmulSizes sizes) -> SmallVector<int64_t> {\n          return {sizes.n, 0};\n        },\n        [&](MatmulSizes sizes) -> SmallVector<int64_t> {\n          return {0, sizes.k};\n        })",
          "new_text": null,
          "old_line_content": "    patterns.add<DotTransformPattern<linalg::VecmatOp>>(",
          "new_line_content": "          return {0, sizes.k};",
          "content_same": false
        },
        {
          "line": 237,
          "old_api": "getBody",
          "new_api": null,
          "old_text": "llvm::to_vector(\n               tailParallelLoop.getBody()->template getOps<DotTy>())",
          "new_text": null,
          "old_line_content": "      for (auto tiledDotOp : llvm::to_vector(",
          "new_line_content": "    // Process tail parallel loop.",
          "content_same": false
        },
        {
          "line": 238,
          "old_api": "getBody",
          "new_api": null,
          "old_text": "tailParallelLoop.getBody()->template getOps<DotTy>()",
          "new_text": null,
          "old_line_content": "               tailParallelLoop.getBody()->template getOps<DotTy>())) {",
          "new_line_content": "    for (scf::ForallOp tailParallelLoop : peeledParallelLoop.tailLoops) {",
          "content_same": false
        },
        {
          "line": 371,
          "old_api": "patterns.add<DotTransformPattern<linalg::DotOp>>(\n        ctx, tileSizeFn,\n        [&](MatmulSizes) -> SmallVector<int64_t> { return {}; },\n        [&](MatmulSizes sizes) -> SmallVector<int64_t> { return {sizes.k}; })",
          "new_api": null,
          "old_text": "patterns.add<DotTransformPattern<linalg::DotOp>>(\n        ctx, tileSizeFn,\n        [&](MatmulSizes) -> SmallVector<int64_t> { return {}; },\n        [&](MatmulSizes sizes) -> SmallVector<int64_t> { return {sizes.k}; })",
          "new_text": null,
          "old_line_content": "    patterns.add<DotTransformPattern<linalg::DotOp>>(",
          "new_line_content": "          return {0, sizes.k};",
          "content_same": false
        },
        {
          "line": 117,
          "old_api": "roundDownToPowerOfTwo",
          "new_api": null,
          "old_text": "roundDownToPowerOfTwo(sizes.m)",
          "new_text": null,
          "old_line_content": "    sizes.m = roundDownToPowerOfTwo(sizes.m);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 118,
          "old_api": "roundDownToPowerOfTwo",
          "new_api": null,
          "old_text": "roundDownToPowerOfTwo(sizes.n)",
          "new_text": null,
          "old_line_content": "    sizes.n = roundDownToPowerOfTwo(sizes.n);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 246,
          "old_api": "success",
          "new_api": null,
          "old_text": "success()",
          "new_text": null,
          "old_line_content": "    return success();",
          "new_line_content": "      }",
          "content_same": false
        },
        {
          "line": 376,
          "old_api": "std::move(patterns)",
          "new_api": null,
          "old_text": "std::move(patterns)",
          "new_text": null,
          "old_line_content": "    if (failed(applyPatternsAndFoldGreedily(f, std::move(patterns))))",
          "new_line_content": "        [&](MatmulSizes sizes) -> SmallVector<int64_t> { return {sizes.k}; });",
          "content_same": false
        },
        {
          "line": 377,
          "old_api": "signalPassFailure",
          "new_api": null,
          "old_text": "signalPassFailure()",
          "new_text": null,
          "old_line_content": "      return signalPassFailure();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 127,
          "old_api": "getType",
          "new_api": null,
          "old_text": "op->getOperand(0).getType().cast<ShapedType>()",
          "new_text": null,
          "old_line_content": "  ShapedType lhsTy = op->getOperand(0).getType().cast<ShapedType>();",
          "new_line_content": "MatmulSizes getMatmulSizes(linalg::MatmulOp op) {",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 34,
      "total_additions": 68,
      "total_deletions": 67,
      "total_api_changes": 169
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 3,
        "api_related_lines": 169,
        "non_api_lines": 2,
        "non_api_line_numbers": [
          74,
          75
        ]
      }
    },
    "api_calls_before": 133,
    "api_calls_after": 134,
    "diff_info": {
      "added_lines": 3,
      "removed_lines": 1,
      "total_diff_lines": 16
    }
  }
}