{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/tensorflow/modified_file/a3068e362380fc4240bddeb0532d5389b28cdf02",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/tensorflow/modified_file/a3068e362380fc4240bddeb0532d5389b28cdf02/before.cc",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/tensorflow/modified_file/a3068e362380fc4240bddeb0532d5389b28cdf02/after.cc",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/tensorflow/modified_file/a3068e362380fc4240bddeb0532d5389b28cdf02/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 789,
          "old_api": "padding_low",
          "new_api": "std::min<int64_t>(\n                input_limits[spatial_dimension] + undilated_index_base,\n                output_limits[spatial_dimension])",
          "old_text": "window_dim.padding_low()",
          "new_text": "std::min<int64_t>(\n                input_limits[spatial_dimension] + undilated_index_base,\n                output_limits[spatial_dimension])",
          "old_line_content": "            output_idx * window_dim.stride() - window_dim.padding_low() +",
          "new_line_content": "            std::min<int64_t>(",
          "content_same": false
        },
        {
          "line": 813,
          "old_api": "push_back",
          "new_api": "base_dilation",
          "old_text": "valid_position_counts.push_back(valid_position_count)",
          "new_text": "window_dim.base_dilation()",
          "old_line_content": "    valid_position_counts.push_back(valid_position_count);",
          "new_line_content": "        if (undilated_index != lhs_spatial_index * window_dim.base_dilation()) {",
          "content_same": false
        },
        {
          "line": 830,
          "old_api": "IsTuple",
          "new_api": "feature_group_count",
          "old_text": "fft->operand(0)->shape().IsTuple()",
          "new_text": "convolution->feature_group_count()",
          "old_line_content": "      fft->operand(0)->shape().IsTuple()",
          "new_line_content": "      (input_feature / convolution->feature_group_count()) * output_feature *",
          "content_same": false
        },
        {
          "line": 831,
          "old_api": "operand",
          "new_api": "batch_group_count",
          "old_text": "fft->operand(0)->shape()",
          "new_text": "convolution->batch_group_count()",
          "old_line_content": "          ? ShapeUtil::GetTupleElementShape(fft->operand(0)->shape(), 0)",
          "new_line_content": "      (batch / convolution->batch_group_count()) *",
          "content_same": false
        },
        {
          "line": 832,
          "old_api": "operand",
          "new_api": "Product",
          "old_text": "fft->operand(0)->shape()",
          "new_text": "Product(valid_position_counts)",
          "old_line_content": "          : fft->operand(0)->shape();",
          "new_line_content": "      Product(valid_position_counts);",
          "content_same": false
        },
        {
          "line": 845,
          "old_api": "shape",
          "new_api": "operand",
          "old_text": "hlo->shape()",
          "new_text": "fft->operand(0)->shape()",
          "old_line_content": "  float bytes_accessed = GetShapeSize(hlo->shape());",
          "new_line_content": "          : fft->operand(0)->shape();",
          "content_same": false
        },
        {
          "line": 846,
          "old_api": "shape",
          "new_api": "constexpr",
          "old_text": "hlo->shape()",
          "new_text": "constexpr",
          "old_line_content": "  current_properties_.set_output_bytes_accessed(GetShapeSize(hlo->shape()));",
          "new_line_content": "  constexpr int kFmaPerComplexMul = 4;",
          "content_same": false
        },
        {
          "line": 848,
          "old_api": "set_operand_bytes_accessed",
          "new_api": "fft_length",
          "old_text": "current_properties_.set_operand_bytes_accessed(\n      0, GetShapeSize(hlo->operand(0)->shape()) / 2.0f)",
          "new_text": "fft->fft_length()",
          "old_line_content": "  current_properties_.set_operand_bytes_accessed(",
          "new_line_content": "  for (int64_t dim : fft->fft_length()) {",
          "content_same": false
        },
        {
          "line": 849,
          "old_api": "operand",
          "new_api": "Log2Floor<uint64_t>(dim)",
          "old_text": "hlo->operand(0)->shape()",
          "new_text": "Log2Floor<uint64_t>(dim)",
          "old_line_content": "      0, GetShapeSize(hlo->operand(0)->shape()) / 2.0f);",
          "new_line_content": "    log_factors *= Log2Floor<uint64_t>(dim);",
          "content_same": false
        },
        {
          "line": 852,
          "old_api": "operand",
          "new_api": "ShapeUtil::ElementsIn(real_shape)",
          "old_text": "hlo->operand(1)->shape()",
          "new_text": "ShapeUtil::ElementsIn(real_shape)",
          "old_line_content": "      0, GetShapeSize(hlo->operand(1)->shape()));",
          "new_line_content": "                                   ShapeUtil::ElementsIn(real_shape);",
          "content_same": false
        },
        {
          "line": 858,
          "old_api": "dimensions_size",
          "new_api": "shape",
          "old_text": "a_shape.dimensions_size()",
          "new_text": "hlo->shape()",
          "old_line_content": "  int64_t elems = a_shape.dimensions(a_shape.dimensions_size() - 1);",
          "new_line_content": "  float bytes_accessed = GetShapeSize(hlo->shape());",
          "content_same": false
        },
        {
          "line": 859,
          "old_api": "ShapeUtil::ElementsIn(b_shape)",
          "new_api": "shape",
          "old_text": "ShapeUtil::ElementsIn(b_shape)",
          "new_text": "hlo->shape()",
          "old_line_content": "  elems *= ShapeUtil::ElementsIn(b_shape);",
          "new_line_content": "  current_properties_.set_output_bytes_accessed(GetShapeSize(hlo->shape()));",
          "content_same": false
        },
        {
          "line": 861,
          "old_api": "OkStatus",
          "new_api": "set_operand_bytes_accessed",
          "old_text": "OkStatus()",
          "new_text": "current_properties_.set_operand_bytes_accessed(\n      0, GetShapeSize(hlo->operand(0)->shape()) / 2.0f)",
          "old_line_content": "  return OkStatus();",
          "new_line_content": "  current_properties_.set_operand_bytes_accessed(",
          "content_same": false
        },
        {
          "line": 871,
          "old_api": "operand",
          "new_api": "dimensions_size",
          "old_text": "hlo->operand(0)->shape()",
          "new_text": "a_shape.dimensions_size()",
          "old_line_content": "      0, GetShapeSize(hlo->operand(0)->shape()) / 2.0f);",
          "new_line_content": "  int64_t elems = a_shape.dimensions(a_shape.dimensions_size() - 1);",
          "content_same": false
        },
        {
          "line": 874,
          "old_api": "operand",
          "new_api": "OkStatus",
          "old_text": "hlo->operand(0)->shape()",
          "new_text": "OkStatus()",
          "old_line_content": "  const Shape& a_shape = hlo->operand(0)->shape();",
          "new_line_content": "  return OkStatus();",
          "content_same": false
        },
        {
          "line": 879,
          "old_api": "OkStatus",
          "new_api": "operand",
          "old_text": "OkStatus()",
          "new_text": "hlo->operand(0)->shape()",
          "old_line_content": "  return OkStatus();",
          "new_line_content": "  float bytes_accessed = GetShapeSize(hlo->operand(0)->shape()) / 2.0f;",
          "content_same": false
        },
        {
          "line": 884,
          "old_api": "OkStatus",
          "new_api": "operand",
          "old_text": "OkStatus()",
          "new_text": "hlo->operand(0)->shape()",
          "old_line_content": "  return OkStatus();",
          "new_line_content": "      0, GetShapeSize(hlo->operand(0)->shape()) / 2.0f);",
          "content_same": false
        },
        {
          "line": 892,
          "old_api": "HandleAllGather",
          "new_api": "OkStatus",
          "old_text": "HandleAllGather(hlo)",
          "new_text": "OkStatus()",
          "old_line_content": "  return HandleAllGather(hlo);",
          "new_line_content": "  return OkStatus();",
          "content_same": false
        },
        {
          "line": 909,
          "old_api": "IsArray",
          "new_api": "OkStatus",
          "old_text": "subshape.IsArray()",
          "new_text": "OkStatus()",
          "old_line_content": "        if (subshape.IsArray()) {",
          "new_line_content": "  return OkStatus();",
          "content_same": false
        },
        {
          "line": 921,
          "old_api": "OkStatus",
          "new_api": "shape",
          "old_text": "OkStatus()",
          "new_text": "crs->shape()",
          "old_line_content": "  return OkStatus();",
          "new_line_content": "      crs->shape(), [&](const Shape& subshape, const ShapeIndex&) {",
          "content_same": false
        },
        {
          "line": 929,
          "old_api": "HandleAllReduce",
          "new_api": "shape",
          "old_text": "HandleAllReduce(hlo)",
          "new_text": "operand->shape()",
          "old_line_content": "  return HandleAllReduce(hlo);",
          "new_line_content": "    bytes_accessed += GetShapeSize(operand->shape());",
          "content_same": false
        },
        {
          "line": 989,
          "old_api": "IsCustomFusion",
          "new_api": "shape",
          "old_text": "fusion->IsCustomFusion()",
          "new_text": "random->shape()",
          "old_line_content": "  if (fusion->IsCustomFusion()) {",
          "new_line_content": "      ShapeUtil::ElementsInRecursive(random->shape());",
          "content_same": false
        },
        {
          "line": 995,
          "old_api": "opcode",
          "new_api": "OkStatus",
          "old_text": "hlo->opcode()",
          "new_text": "OkStatus()",
          "old_line_content": "      if (hlo->opcode() == HloOpcode::kScatter) {",
          "new_line_content": "  return OkStatus();",
          "content_same": false
        },
        {
          "line": 1000,
          "old_api": "fused_instructions_computation",
          "new_api": "fused_expression_root",
          "old_text": "TF_ASSIGN_OR_RETURN(\n      current_properties_,\n      ProcessSubcomputation(fusion->fused_instructions_computation()))",
          "new_text": "fusion->fused_expression_root()",
          "old_line_content": "  TF_ASSIGN_OR_RETURN(",
          "new_line_content": "  const HloInstruction* root = fusion->fused_expression_root();",
          "content_same": false
        },
        {
          "line": 1002,
          "old_api": "fused_instructions_computation",
          "new_api": "IsCustomFusion",
          "old_text": "fusion->fused_instructions_computation()",
          "new_text": "fusion->IsCustomFusion()",
          "old_line_content": "      ProcessSubcomputation(fusion->fused_instructions_computation()));",
          "new_line_content": "  if (fusion->IsCustomFusion()) {",
          "content_same": false
        },
        {
          "line": 1008,
          "old_api": "IsArray",
          "new_api": "opcode",
          "old_text": "ShapeUtil::ForEachSubshape(\n      fusion->shape(),\n      [this, root](const Shape& subshape, const ShapeIndex& shape_index) {\n        if (!subshape.IsArray()) {\n          return;\n        }\n        if (shape_index.empty()) {\n          if (root->opcode() == HloOpcode::kDynamicUpdateSlice) {\n            int64_t size = GetShapeSize(root->operand(1)->shape());\n            current_properties_[kBytesAccessedKey] += size;\n            current_properties_.set_output_bytes_accessed(shape_index, size);\n            hlo_properties_[root][GetOperandUtilizationKey(0)] = 0;\n            return;\n          }\n        } else if (shape_index.size() == 1) {\n          if (root->opcode() == HloOpcode::kTuple &&\n              root->operand(shape_index[0])->opcode() ==\n                  HloOpcode::kDynamicUpdateSlice) {\n            int64_t size = GetShapeSize(\n                root->operand(shape_index[0])->operand(1)->shape());\n            current_properties_[kBytesAccessedKey] += size;\n            current_properties_.set_output_bytes_accessed(shape_index, size);\n            hlo_properties_[root->operand(shape_index[0])]\n                           [GetOperandUtilizationKey(0)] = 0;\n            return;\n          }\n        }\n        current_properties_[kBytesAccessedKey] += GetShapeSize(subshape);\n        current_properties_.set_output_bytes_accessed(shape_index,\n                                                      GetShapeSize(subshape));\n      })",
          "new_text": "hlo->opcode()",
          "old_line_content": "  ShapeUtil::ForEachSubshape(",
          "new_line_content": "      if (hlo->opcode() == HloOpcode::kScatter) {",
          "content_same": false
        },
        {
          "line": 1009,
          "old_api": "shape",
          "new_api": "HandleScatter",
          "old_text": "fusion->shape()",
          "new_text": "HandleScatter(hlo)",
          "old_line_content": "      fusion->shape(),",
          "new_line_content": "        return HandleScatter(hlo);",
          "content_same": false
        },
        {
          "line": 1015,
          "old_api": "opcode",
          "new_api": "fused_instructions_computation",
          "old_text": "root->opcode()",
          "new_text": "fusion->fused_instructions_computation()",
          "old_line_content": "          if (root->opcode() == HloOpcode::kDynamicUpdateSlice) {",
          "new_line_content": "      ProcessSubcomputation(fusion->fused_instructions_computation()));",
          "content_same": false
        },
        {
          "line": 1022,
          "old_api": "size",
          "new_api": "shape",
          "old_text": "shape_index.size()",
          "new_text": "fusion->shape()",
          "old_line_content": "        } else if (shape_index.size() == 1) {",
          "new_line_content": "      fusion->shape(),",
          "content_same": false
        },
        {
          "line": 1024,
          "old_api": "operand",
          "new_api": "IsArray",
          "old_text": "root->operand(shape_index[0])->opcode()",
          "new_text": "subshape.IsArray()",
          "old_line_content": "              root->operand(shape_index[0])->opcode() ==",
          "new_line_content": "        if (!subshape.IsArray()) {",
          "content_same": false
        },
        {
          "line": 1027,
          "old_api": "operand",
          "new_api": "empty",
          "old_text": "root->operand(shape_index[0])->operand(1)->shape()",
          "new_text": "shape_index.empty()",
          "old_line_content": "                root->operand(shape_index[0])->operand(1)->shape());",
          "new_line_content": "        if (shape_index.empty()) {",
          "content_same": false
        },
        {
          "line": 1029,
          "old_api": "set_output_bytes_accessed",
          "new_api": "operand",
          "old_text": "current_properties_.set_output_bytes_accessed(shape_index, size)",
          "new_text": "root->operand(1)->shape()",
          "old_line_content": "            current_properties_.set_output_bytes_accessed(shape_index, size);",
          "new_line_content": "            int64_t size = GetShapeSize(root->operand(1)->shape());",
          "content_same": false
        },
        {
          "line": 1031,
          "old_api": "GetOperandUtilizationKey",
          "new_api": "set_output_bytes_accessed",
          "old_text": "GetOperandUtilizationKey(0)",
          "new_text": "current_properties_.set_output_bytes_accessed(shape_index, size)",
          "old_line_content": "                           [GetOperandUtilizationKey(0)] = 0;",
          "new_line_content": "            current_properties_.set_output_bytes_accessed(shape_index, size);",
          "content_same": false
        },
        {
          "line": 1035,
          "old_api": "GetShapeSize",
          "new_api": "size",
          "old_text": "GetShapeSize(subshape)",
          "new_text": "shape_index.size()",
          "old_line_content": "        current_properties_[kBytesAccessedKey] += GetShapeSize(subshape);",
          "new_line_content": "        } else if (shape_index.size() == 1) {",
          "content_same": false
        },
        {
          "line": 1036,
          "old_api": "set_output_bytes_accessed",
          "new_api": "opcode",
          "old_text": "current_properties_.set_output_bytes_accessed(shape_index,\n                                                      GetShapeSize(subshape))",
          "new_text": "root->opcode()",
          "old_line_content": "        current_properties_.set_output_bytes_accessed(shape_index,",
          "new_line_content": "          if (root->opcode() == HloOpcode::kTuple &&",
          "content_same": false
        },
        {
          "line": 1037,
          "old_api": "GetShapeSize",
          "new_api": "operand",
          "old_text": "GetShapeSize(subshape)",
          "new_text": "root->operand(shape_index[0])->opcode()",
          "old_line_content": "                                                      GetShapeSize(subshape));",
          "new_line_content": "              root->operand(shape_index[0])->opcode() ==",
          "content_same": false
        },
        {
          "line": 1040,
          "old_api": "IsTuple",
          "new_api": "operand",
          "old_text": "fusion->shape().IsTuple()",
          "new_text": "root->operand(shape_index[0])->operand(1)->shape()",
          "old_line_content": "  if (fusion->shape().IsTuple()) {",
          "new_line_content": "                root->operand(shape_index[0])->operand(1)->shape());",
          "content_same": false
        },
        {
          "line": 1050,
          "old_api": "GetOutputBytesAccessedKey",
          "new_api": "GetShapeSize",
          "old_text": "GetOutputBytesAccessedKey(shape_index)",
          "new_text": "GetShapeSize(subshape)",
          "old_line_content": "          current_properties_[GetOutputBytesAccessedKey(shape_index)];",
          "new_line_content": "                                                      GetShapeSize(subshape));",
          "content_same": false
        },
        {
          "line": 1067,
          "old_api": "FusionCalculateUtilizations",
          "new_api": "tuple_shapes_size",
          "old_text": "FusionCalculateUtilizations(fusion)",
          "new_text": "shape.tuple_shapes_size()",
          "old_line_content": "  TF_RETURN_IF_ERROR(FusionCalculateUtilizations(fusion));",
          "new_line_content": "      for (int i = 0; i < shape.tuple_shapes_size(); ++i) {",
          "content_same": false
        },
        {
          "line": 1072,
          "old_api": "opcode",
          "new_api": "propagate_output_size_to_parent",
          "old_text": "instr->opcode()",
          "new_text": "propagate_output_size_to_parent(subshape, subshape_index)",
          "old_line_content": "    if (instr->opcode() == HloOpcode::kConstant &&",
          "new_line_content": "            propagate_output_size_to_parent(subshape, subshape_index);",
          "content_same": false
        },
        {
          "line": 1077,
          "old_api": "fmin",
          "new_api": "shape",
          "old_text": "fmin(utilization, 1.0)",
          "new_text": "fusion->shape()",
          "old_line_content": "        utilization = fmin(utilization, 1.0);",
          "new_line_content": "    propagate_output_size_to_parent(fusion->shape(), {});",
          "content_same": false
        },
        {
          "line": 1080,
          "old_api": "shape",
          "new_api": "FusionCalculateUtilizations",
          "old_text": "instr->shape()",
          "new_text": "FusionCalculateUtilizations(fusion)",
          "old_line_content": "          GetShapeSize(instr->shape()) * utilization;",
          "new_line_content": "  TF_RETURN_IF_ERROR(FusionCalculateUtilizations(fusion));",
          "content_same": false
        },
        {
          "line": 1084,
          "old_api": "size",
          "new_api": "fused_instructions_computation",
          "old_text": "fusion->fused_parameters().size()",
          "new_text": "fusion->fused_instructions_computation()->instructions()",
          "old_line_content": "  for (int64_t i = 0; i < fusion->fused_parameters().size(); ++i) {",
          "new_line_content": "       fusion->fused_instructions_computation()->instructions()) {",
          "content_same": false
        },
        {
          "line": 1085,
          "old_api": "fused_parameter",
          "new_api": "opcode",
          "old_text": "fusion->fused_parameter(i)",
          "new_text": "instr->opcode()",
          "old_line_content": "    const HloInstruction* operand = fusion->fused_parameter(i);",
          "new_line_content": "    if (instr->opcode() == HloOpcode::kConstant &&",
          "content_same": false
        },
        {
          "line": 1087,
          "old_api": "IsTuple",
          "new_api": "immediate_constant_max_elements",
          "old_text": "operand->shape().IsTuple()",
          "new_text": "immediate_constant_max_elements()",
          "old_line_content": "    if (!operand->shape().IsTuple()) {",
          "new_line_content": "            immediate_constant_max_elements()) {",
          "content_same": false
        },
        {
          "line": 1097,
          "old_api": "opcode",
          "new_api": "size",
          "old_text": "user->opcode()",
          "new_text": "fusion->fused_parameters().size()",
          "old_line_content": "            if (user->opcode() == HloOpcode::kGetTupleElement &&",
          "new_line_content": "  for (int64_t i = 0; i < fusion->fused_parameters().size(); ++i) {",
          "content_same": false
        },
        {
          "line": 1098,
          "old_api": "tuple_index",
          "new_api": "fused_parameter",
          "old_text": "user->tuple_index()",
          "new_text": "fusion->fused_parameter(i)",
          "old_line_content": "                user->tuple_index() == index) {",
          "new_line_content": "    const HloInstruction* operand = fusion->fused_parameter(i);",
          "content_same": false
        },
        {
          "line": 1106,
          "old_api": "set_operand_bytes_accessed",
          "new_api": "shape",
          "old_text": "current_properties_.set_operand_bytes_accessed(i, indexed_shape.index,\n                                                       size)",
          "new_text": "operand->shape()",
          "old_line_content": "        current_properties_.set_operand_bytes_accessed(i, indexed_shape.index,",
          "new_line_content": "           ShapeUtil::GetLeafShapes(operand->shape())) {",
          "content_same": false
        },
        {
          "line": 1111,
          "old_api": "set_operand_bytes_accessed",
          "new_api": "tuple_index",
          "old_text": "current_properties_.set_operand_bytes_accessed(i, operand_size)",
          "new_text": "user->tuple_index()",
          "old_line_content": "    current_properties_.set_operand_bytes_accessed(i, operand_size);",
          "new_line_content": "                user->tuple_index() == index) {",
          "content_same": false
        },
        {
          "line": 1133,
          "old_api": "set_output_bytes_accessed",
          "new_api": "to_apply",
          "old_text": "current_properties_.set_output_bytes_accessed(-1)",
          "new_text": "TF_ASSIGN_OR_RETURN(current_properties_,\n                      ProcessSubcomputation(call->to_apply()))",
          "old_line_content": "  current_properties_.set_output_bytes_accessed(-1);",
          "new_line_content": "  TF_ASSIGN_OR_RETURN(current_properties_,",
          "content_same": false
        },
        {
          "line": 1134,
          "old_api": "operand_count",
          "new_api": "to_apply",
          "old_text": "custom_call->operand_count()",
          "new_text": "call->to_apply()",
          "old_line_content": "  for (int i = 0; i < custom_call->operand_count(); ++i) {",
          "new_line_content": "                      ProcessSubcomputation(call->to_apply()));",
          "content_same": false
        },
        {
          "line": 1146,
          "old_api": "Log2Ceiling<uint64_t>(elements)",
          "new_api": "set_output_bytes_accessed",
          "old_text": "Log2Ceiling<uint64_t>(elements)",
          "new_text": "current_properties_.set_output_bytes_accessed(-1)",
          "old_line_content": "  current_properties_[kFlopsKey] = elements * Log2Ceiling<uint64_t>(elements);",
          "new_line_content": "  current_properties_.set_output_bytes_accessed(-1);",
          "content_same": false
        },
        {
          "line": 1147,
          "old_api": "OkStatus",
          "new_api": "operand_count",
          "old_text": "OkStatus()",
          "new_text": "custom_call->operand_count()",
          "old_line_content": "  return OkStatus();",
          "new_line_content": "  for (int i = 0; i < custom_call->operand_count(); ++i) {",
          "content_same": false
        },
        {
          "line": 1160,
          "old_api": "Properties",
          "new_api": "OkStatus",
          "old_text": "Properties()",
          "new_text": "OkStatus()",
          "old_line_content": "  current_properties_ = Properties();",
          "new_line_content": "  return OkStatus();",
          "content_same": false
        },
        {
          "line": 1199,
          "old_api": "operand",
          "new_api": "std::max(current_property, val)",
          "old_text": "gather->operand(1)->shape()",
          "new_text": "std::max(current_property, val)",
          "old_line_content": "      output_size * 2 + GetShapeSize(gather->operand(1)->shape());",
          "new_line_content": "          current_property = std::max(current_property, val);",
          "content_same": false
        },
        {
          "line": 1204,
          "old_api": "shape",
          "new_api": "OkStatus",
          "old_text": "gather->shape()",
          "new_text": "OkStatus()",
          "old_line_content": "      0, 1.0 * ShapeUtil::ElementsIn(gather->shape()) /",
          "new_line_content": "  return OkStatus();",
          "content_same": false
        },
        {
          "line": 1212,
          "old_api": "Cast<HloScatterInstruction>(hlo)",
          "new_api": "operand",
          "old_text": "Cast<HloScatterInstruction>(hlo)",
          "new_text": "gather->operand(1)->shape()",
          "old_line_content": "  auto* scatter = Cast<HloScatterInstruction>(hlo);",
          "new_line_content": "      output_size * 2 + GetShapeSize(gather->operand(1)->shape());",
          "content_same": false
        },
        {
          "line": 1216,
          "old_api": "scatter_operand_count",
          "new_api": "set_operand_utilization",
          "old_text": "scatter->scatter_operand_count()",
          "new_text": "current_properties_.set_operand_utilization(\n      0, 1.0 * ShapeUtil::ElementsIn(gather->shape()) /\n             ShapeUtil::ElementsIn(gather->operand(0)->shape()))",
          "old_line_content": "  for (int i = 0, n = scatter->scatter_operand_count(); i < n; ++i) {",
          "new_line_content": "  current_properties_.set_operand_utilization(",
          "content_same": false
        },
        {
          "line": 1217,
          "old_api": "scatter_updates",
          "new_api": "shape",
          "old_text": "scatter->scatter_updates()[i]->shape()",
          "new_text": "gather->shape()",
          "old_line_content": "    int64_t update_size = GetShapeSize(scatter->scatter_updates()[i]->shape());",
          "new_line_content": "      0, 1.0 * ShapeUtil::ElementsIn(gather->shape()) /",
          "content_same": false
        },
        {
          "line": 1218,
          "old_api": "set_operand_bytes_accessed",
          "new_api": "operand",
          "old_text": "current_properties_.set_operand_bytes_accessed(i, update_size)",
          "new_text": "gather->operand(0)->shape()",
          "old_line_content": "    current_properties_.set_operand_bytes_accessed(i, update_size);",
          "new_line_content": "             ShapeUtil::ElementsIn(gather->operand(0)->shape()));",
          "content_same": false
        },
        {
          "line": 1219,
          "old_api": "set_operand_bytes_accessed",
          "new_api": "set_output_bytes_accessed",
          "old_text": "current_properties_.set_operand_bytes_accessed(n + 1 + i, update_size)",
          "new_text": "current_properties_.set_output_bytes_accessed(output_size)",
          "old_line_content": "    current_properties_.set_operand_bytes_accessed(n + 1 + i, update_size);",
          "new_line_content": "  current_properties_.set_output_bytes_accessed(output_size);",
          "content_same": false
        },
        {
          "line": 1225,
          "old_api": "scatter_operand_count",
          "new_api": "Cast<HloScatterInstruction>(hlo)",
          "old_text": "scatter->scatter_operand_count()",
          "new_text": "Cast<HloScatterInstruction>(hlo)",
          "old_line_content": "      scatter->scatter_operand_count(), scatter_indices_size);",
          "new_line_content": "  auto* scatter = Cast<HloScatterInstruction>(hlo);",
          "content_same": false
        },
        {
          "line": 1238,
          "old_api": "OkStatus",
          "new_api": "scatter_operand_count",
          "old_text": "OkStatus()",
          "new_text": "scatter->scatter_operand_count()",
          "old_line_content": "  return OkStatus();",
          "new_line_content": "      scatter->scatter_operand_count(), scatter_indices_size);",
          "content_same": false
        },
        {
          "line": 1243,
          "old_api": "OkStatus",
          "new_api": "scatter_updates",
          "old_text": "OkStatus()",
          "new_text": "scatter->scatter_updates()[0]->shape()",
          "old_line_content": "  return OkStatus();",
          "new_line_content": "      ShapeUtil::ElementsIn(scatter->scatter_updates()[0]->shape());",
          "content_same": false
        },
        {
          "line": 1291,
          "old_api": "GetOperandUtilizationKey",
          "new_api": "GetPropertyForHlo",
          "old_text": "GetOperandUtilizationKey(operand_num, index)",
          "new_text": "GetPropertyForHlo(hlo, kBytesAccessedKey, hlo_properties_)",
          "old_line_content": "  return GetPropertyForHlo(hlo, GetOperandUtilizationKey(operand_num, index),",
          "new_line_content": "  return GetPropertyForHlo(hlo, kBytesAccessedKey, hlo_properties_);",
          "content_same": false
        },
        {
          "line": 1297,
          "old_api": "GetOutputBytesAccessedKey",
          "new_api": "GetOperandBytesAccessedKey",
          "old_text": "GetOutputBytesAccessedKey(index)",
          "new_text": "GetOperandBytesAccessedKey(operand_num, index)",
          "old_line_content": "  return GetPropertyForHlo(hlo, GetOutputBytesAccessedKey(index),",
          "new_line_content": "  return GetPropertyForHlo(hlo, GetOperandBytesAccessedKey(operand_num, index),",
          "content_same": false
        },
        {
          "line": 1310,
          "old_api": "operand",
          "new_api": "GetOutputBytesAccessedKey",
          "old_text": "hlo.operand(operand_number)->shape()",
          "new_text": "GetOutputBytesAccessedKey(index)",
          "old_line_content": "    const Shape& shape = hlo.operand(operand_number)->shape();",
          "new_line_content": "  return GetPropertyForHlo(hlo, GetOutputBytesAccessedKey(index),",
          "content_same": false
        },
        {
          "line": 1315,
          "old_api": "has_layout",
          "new_api": "GetPropertyForHlo",
          "old_text": "sub_shape.has_layout()",
          "new_text": "GetPropertyForHlo(hlo, kOptimalSecondsKey, hlo_properties_)",
          "old_line_content": "            if (sub_shape.has_layout()) {",
          "new_line_content": "  return GetPropertyForHlo(hlo, kOptimalSecondsKey, hlo_properties_);",
          "content_same": false
        },
        {
          "line": 1346,
          "old_api": "instruction_count",
          "new_api": "has_layout",
          "old_text": "computation->instruction_count()",
          "new_text": "indexed_shape.shape.has_layout()",
          "old_line_content": "  visitor->ReserveVisitStates(computation->instruction_count());",
          "new_line_content": "    if (indexed_shape.shape.has_layout()) {",
          "content_same": false
        },
        {
          "line": 1347,
          "old_api": "get",
          "new_api": "layout",
          "old_text": "visitor.get()",
          "new_text": "indexed_shape.shape.layout().memory_space()",
          "old_line_content": "  TF_RETURN_IF_ERROR(computation->Accept(visitor.get()));",
          "new_line_content": "      index_memory_space = indexed_shape.shape.layout().memory_space();",
          "content_same": false
        },
        {
          "line": 1360,
          "old_api": "ToString",
          "new_api": "get",
          "old_text": "absl::StrCat(kBytesAccessedKey, \" operand \", operand_num, \" \",\n                      index.ToString())",
          "new_text": "visitor.get()",
          "old_line_content": "  return absl::StrCat(kBytesAccessedKey, \" operand \", operand_num, \" \",",
          "new_line_content": "  TF_RETURN_IF_ERROR(computation->Accept(visitor.get()));",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 1028,
          "old_api": null,
          "new_api": "opcode",
          "old_text": null,
          "new_text": "root->opcode()",
          "old_line_content": "            current_properties_[kBytesAccessedKey] += size;",
          "new_line_content": "          if (root->opcode() == HloOpcode::kDynamicUpdateSlice) {",
          "content_same": false
        },
        {
          "line": 1032,
          "old_api": null,
          "new_api": "GetOperandUtilizationKey",
          "old_text": null,
          "new_text": "GetOperandUtilizationKey(0)",
          "old_line_content": "            return;",
          "new_line_content": "            hlo_properties_[root][GetOperandUtilizationKey(0)] = 0;",
          "content_same": false
        },
        {
          "line": 1039,
          "old_api": null,
          "new_api": "operand",
          "old_text": null,
          "new_text": "GetShapeSize(\n                root->operand(shape_index[0])->operand(1)->shape())",
          "old_line_content": "",
          "new_line_content": "            int64_t size = GetShapeSize(",
          "content_same": false
        },
        {
          "line": 1042,
          "old_api": null,
          "new_api": "set_output_bytes_accessed",
          "old_text": null,
          "new_text": "current_properties_.set_output_bytes_accessed(shape_index, size)",
          "old_line_content": "    // This ensures we have the correct output bytes accessed for the shape",
          "new_line_content": "            current_properties_.set_output_bytes_accessed(shape_index, size);",
          "content_same": false
        },
        {
          "line": 1043,
          "old_api": null,
          "new_api": "operand",
          "old_text": null,
          "new_text": "root->operand(shape_index[0])",
          "old_line_content": "    // index",
          "new_line_content": "            hlo_properties_[root->operand(shape_index[0])]",
          "content_same": false
        },
        {
          "line": 1044,
          "old_api": null,
          "new_api": "GetOperandUtilizationKey",
          "old_text": null,
          "new_text": "GetOperandUtilizationKey(0)",
          "old_line_content": "    // {}.",
          "new_line_content": "                           [GetOperandUtilizationKey(0)] = 0;",
          "content_same": false
        },
        {
          "line": 1048,
          "old_api": null,
          "new_api": "GetShapeSize",
          "old_text": null,
          "new_text": "GetShapeSize(subshape)",
          "old_line_content": "                                          const ShapeIndex& shape_index) {",
          "new_line_content": "        current_properties_[kBytesAccessedKey] += GetShapeSize(subshape);",
          "content_same": false
        },
        {
          "line": 1049,
          "old_api": null,
          "new_api": "set_output_bytes_accessed",
          "old_text": null,
          "new_text": "current_properties_.set_output_bytes_accessed(shape_index,\n                                                      GetShapeSize(subshape))",
          "old_line_content": "      float& bytes_accessed =",
          "new_line_content": "        current_properties_.set_output_bytes_accessed(shape_index,",
          "content_same": false
        },
        {
          "line": 1053,
          "old_api": null,
          "new_api": "IsTuple",
          "old_text": null,
          "new_text": "fusion->shape().IsTuple()",
          "old_line_content": "      }",
          "new_line_content": "  if (fusion->shape().IsTuple()) {",
          "content_same": false
        },
        {
          "line": 1068,
          "old_api": null,
          "new_api": "tuple_shapes",
          "old_text": null,
          "new_text": "shape.tuple_shapes(i)",
          "old_line_content": "",
          "new_line_content": "        const Shape& subshape = shape.tuple_shapes(i);",
          "content_same": false
        },
        {
          "line": 1070,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "subshape_index.push_back(i)",
          "old_line_content": "  for (const HloInstruction* instr :",
          "new_line_content": "        subshape_index.push_back(i);",
          "content_same": false
        },
        {
          "line": 1076,
          "old_api": null,
          "new_api": "GetOutputBytesAccessedKey",
          "old_text": null,
          "new_text": "GetOutputBytesAccessedKey()",
          "old_line_content": "      if (!options_.count_multiple_input_accesses) {",
          "new_line_content": "    current_properties_[GetOutputBytesAccessedKey()] = 0;",
          "content_same": false
        },
        {
          "line": 1086,
          "old_api": null,
          "new_api": "shape",
          "old_text": null,
          "new_text": "instr->shape()",
          "old_line_content": "    int64_t operand_size = 0;",
          "new_line_content": "        ShapeUtil::ElementsIn(instr->shape()) >",
          "content_same": false
        },
        {
          "line": 1090,
          "old_api": null,
          "new_api": "fmin",
          "old_text": null,
          "new_text": "fmin(utilization, 1.0)",
          "old_line_content": "      // If the fusion parameter is a tuple type, find the gte for the leaf",
          "new_line_content": "        utilization = fmin(utilization, 1.0);",
          "content_same": false
        },
        {
          "line": 1100,
          "old_api": null,
          "new_api": "IsTuple",
          "old_text": null,
          "new_text": "operand->shape().IsTuple()",
          "old_line_content": "              break;",
          "new_line_content": "    if (!operand->shape().IsTuple()) {",
          "content_same": false
        },
        {
          "line": 1101,
          "old_api": null,
          "new_api": "FusionParameterReadBytes",
          "old_text": null,
          "new_text": "FusionParameterReadBytes(operand)",
          "old_line_content": "            }",
          "new_line_content": "      operand_size = FusionParameterReadBytes(operand);",
          "content_same": false
        },
        {
          "line": 1109,
          "old_api": null,
          "new_api": "users",
          "old_text": null,
          "new_text": "gte->users()",
          "old_line_content": "    }",
          "new_line_content": "          for (const HloInstruction* user : gte->users()) {",
          "content_same": false
        },
        {
          "line": 1110,
          "old_api": null,
          "new_api": "opcode",
          "old_text": null,
          "new_text": "user->opcode()",
          "old_line_content": "    current_properties_[kBytesAccessedKey] += operand_size;",
          "new_line_content": "            if (user->opcode() == HloOpcode::kGetTupleElement &&",
          "content_same": false
        },
        {
          "line": 1117,
          "old_api": null,
          "new_api": "FusionParameterReadBytes",
          "old_text": null,
          "new_text": "FusionParameterReadBytes(gte)",
          "old_line_content": "}",
          "new_line_content": "        int64_t size = FusionParameterReadBytes(gte);",
          "content_same": false
        },
        {
          "line": 1119,
          "old_api": null,
          "new_api": "set_operand_bytes_accessed",
          "old_text": null,
          "new_text": "current_properties_.set_operand_bytes_accessed(i, indexed_shape.index,\n                                                       size)",
          "old_line_content": "Status HloCostAnalysis::HandleCall(const HloInstruction* call) {",
          "new_line_content": "        current_properties_.set_operand_bytes_accessed(i, indexed_shape.index,",
          "content_same": false
        },
        {
          "line": 1124,
          "old_api": null,
          "new_api": "set_operand_bytes_accessed",
          "old_text": null,
          "new_text": "current_properties_.set_operand_bytes_accessed(i, operand_size)",
          "old_line_content": "}",
          "new_line_content": "    current_properties_.set_operand_bytes_accessed(i, operand_size);",
          "content_same": false
        },
        {
          "line": 1125,
          "old_api": null,
          "new_api": "set_operand_utilization",
          "old_text": null,
          "new_text": "current_properties_.set_operand_utilization(\n        i, hlo_properties_[operand][kUtilizationKey])",
          "old_line_content": "",
          "new_line_content": "    current_properties_.set_operand_utilization(",
          "content_same": false
        },
        {
          "line": 1129,
          "old_api": null,
          "new_api": "OkStatus",
          "old_text": null,
          "new_text": "OkStatus()",
          "old_line_content": "  // iteration, and therefore would prevent us from getting *any* stats for a",
          "new_line_content": "  return OkStatus();",
          "content_same": false
        },
        {
          "line": 1136,
          "old_api": null,
          "new_api": "OkStatus",
          "old_text": null,
          "new_text": "OkStatus()",
          "old_line_content": "  }",
          "new_line_content": "  return OkStatus();",
          "content_same": false
        },
        {
          "line": 1148,
          "old_api": null,
          "new_api": "set_operand_bytes_accessed",
          "old_text": null,
          "new_text": "current_properties_.set_operand_bytes_accessed(i, -1)",
          "old_line_content": "}",
          "new_line_content": "    current_properties_.set_operand_bytes_accessed(i, -1);",
          "content_same": false
        },
        {
          "line": 1152,
          "old_api": null,
          "new_api": "OkStatus",
          "old_text": null,
          "new_text": "OkStatus()",
          "old_line_content": "  // something that we can statically analyze, we cannot precisely compute the",
          "new_line_content": "  return OkStatus();",
          "content_same": false
        },
        {
          "line": 1158,
          "old_api": null,
          "new_api": "operand",
          "old_text": null,
          "new_text": "sort->operand(0)->shape()",
          "old_line_content": "                      ProcessSubcomputation(xla_while->while_condition()));",
          "new_line_content": "  int64_t elements = ShapeUtil::ElementsIn(sort->operand(0)->shape());",
          "content_same": false
        },
        {
          "line": 1159,
          "old_api": null,
          "new_api": "Log2Ceiling<uint64_t>(elements)",
          "old_text": null,
          "new_text": "Log2Ceiling<uint64_t>(elements)",
          "old_line_content": "",
          "new_line_content": "  current_properties_[kFlopsKey] = elements * Log2Ceiling<uint64_t>(elements);",
          "content_same": false
        },
        {
          "line": 1173,
          "old_api": null,
          "new_api": "Properties",
          "old_text": null,
          "new_text": "Properties()",
          "old_line_content": "  // Compute the cost of the branch computations and take the maximum from those",
          "new_line_content": "  current_properties_ = Properties();",
          "content_same": false
        },
        {
          "line": 1174,
          "old_api": null,
          "new_api": "ForEach",
          "old_text": null,
          "new_text": "body_properties.ForEach([&](absl::string_view key, float val) {\n    current_properties_[key] += val;\n  })",
          "old_line_content": "  // for each property.",
          "new_line_content": "  body_properties.ForEach([&](absl::string_view key, float val) {",
          "content_same": false
        },
        {
          "line": 1177,
          "old_api": null,
          "new_api": "ForEach",
          "old_text": null,
          "new_text": "condition_properties.ForEach([&](absl::string_view key, float val) {\n    current_properties_[key] += val;\n  })",
          "old_line_content": "      ProcessSubcomputation(conditional->branch_computation(0)));",
          "new_line_content": "  condition_properties.ForEach([&](absl::string_view key, float val) {",
          "content_same": false
        },
        {
          "line": 1182,
          "old_api": null,
          "new_api": "OkStatus",
          "old_text": null,
          "new_text": "OkStatus()",
          "old_line_content": "        ProcessSubcomputation(conditional->branch_computation(j)));",
          "new_line_content": "  return OkStatus();",
          "content_same": false
        },
        {
          "line": 1192,
          "old_api": null,
          "new_api": "branch_count",
          "old_text": null,
          "new_text": "conditional->branch_count()",
          "old_line_content": "}",
          "new_line_content": "  for (int j = 1; j < conditional->branch_count(); ++j) {",
          "content_same": false
        },
        {
          "line": 1196,
          "old_api": null,
          "new_api": "ForEach",
          "old_text": null,
          "new_text": "branch_computation_properties.ForEach(\n        [&](absl::string_view key, float val) {\n          auto& current_property = current_properties_[key];\n          current_property = std::max(current_property, val);\n        })",
          "old_line_content": "  // size of the output shape and a read of the gather indices.",
          "new_line_content": "    branch_computation_properties.ForEach(",
          "content_same": false
        },
        {
          "line": 1210,
          "old_api": null,
          "new_api": "shape",
          "old_text": null,
          "new_text": "gather->shape()",
          "old_line_content": "",
          "new_line_content": "  int64_t output_size = GetShapeSize(gather->shape());",
          "content_same": false
        },
        {
          "line": 1213,
          "old_api": null,
          "new_api": "set_operand_bytes_accessed",
          "old_text": null,
          "new_text": "current_properties_.set_operand_bytes_accessed(0, output_size)",
          "old_line_content": "  // Scatter accesses the equivalent of 3N update shapes (input, output, and",
          "new_line_content": "  current_properties_.set_operand_bytes_accessed(0, output_size);",
          "content_same": false
        },
        {
          "line": 1214,
          "old_api": null,
          "new_api": "set_operand_bytes_accessed",
          "old_text": null,
          "new_text": "current_properties_.set_operand_bytes_accessed(\n      1, GetShapeSize(gather->operand(1)->shape()))",
          "old_line_content": "  // updates), and the scatter indices.",
          "new_line_content": "  current_properties_.set_operand_bytes_accessed(",
          "content_same": false
        },
        {
          "line": 1215,
          "old_api": null,
          "new_api": "operand",
          "old_text": null,
          "new_text": "gather->operand(1)->shape()",
          "old_line_content": "  int64_t total_update_size = 0;",
          "new_line_content": "      1, GetShapeSize(gather->operand(1)->shape()));",
          "content_same": false
        },
        {
          "line": 1221,
          "old_api": null,
          "new_api": "OkStatus",
          "old_text": null,
          "new_text": "OkStatus()",
          "old_line_content": "  }",
          "new_line_content": "  return OkStatus();",
          "content_same": false
        },
        {
          "line": 1229,
          "old_api": null,
          "new_api": "scatter_operand_count",
          "old_text": null,
          "new_text": "scatter->scatter_operand_count()",
          "old_line_content": "  const int64_t element_count =",
          "new_line_content": "  for (int i = 0, n = scatter->scatter_operand_count(); i < n; ++i) {",
          "content_same": false
        },
        {
          "line": 1231,
          "old_api": null,
          "new_api": "set_operand_bytes_accessed",
          "old_text": null,
          "new_text": "current_properties_.set_operand_bytes_accessed(i, update_size)",
          "old_line_content": "  TF_ASSIGN_OR_RETURN(const Properties sub_properties,",
          "new_line_content": "    current_properties_.set_operand_bytes_accessed(i, update_size);",
          "content_same": false
        },
        {
          "line": 1232,
          "old_api": null,
          "new_api": "set_operand_bytes_accessed",
          "old_text": null,
          "new_text": "current_properties_.set_operand_bytes_accessed(n + 1 + i, update_size)",
          "old_line_content": "                      ProcessSubcomputation(scatter->to_apply()));",
          "new_line_content": "    current_properties_.set_operand_bytes_accessed(n + 1 + i, update_size);",
          "content_same": false
        },
        {
          "line": 1236,
          "old_api": null,
          "new_api": "scatter_indices",
          "old_text": null,
          "new_text": "scatter->scatter_indices()->shape()",
          "old_line_content": "    }",
          "new_line_content": "      GetShapeSize(scatter->scatter_indices()->shape());",
          "content_same": false
        },
        {
          "line": 1237,
          "old_api": null,
          "new_api": "set_operand_bytes_accessed",
          "old_text": null,
          "new_text": "current_properties_.set_operand_bytes_accessed(\n      scatter->scatter_operand_count(), scatter_indices_size)",
          "old_line_content": "  });",
          "new_line_content": "  current_properties_.set_operand_bytes_accessed(",
          "content_same": false
        },
        {
          "line": 1241,
          "old_api": null,
          "new_api": "set_output_bytes_accessed",
          "old_text": null,
          "new_text": "current_properties_.set_output_bytes_accessed(total_update_size)",
          "old_line_content": "Status HloCostAnalysis::HandleGetDimensionSize(",
          "new_line_content": "  current_properties_.set_output_bytes_accessed(total_update_size);",
          "content_same": false
        },
        {
          "line": 1246,
          "old_api": null,
          "new_api": "ForEach",
          "old_text": null,
          "new_text": "sub_properties.ForEach([&](absl::string_view key, float val) {\n    if (KeyToCopyFromSubcomputation(key)) {\n      current_properties_[key] = val * element_count;\n    }\n  })",
          "old_line_content": "Status HloCostAnalysis::HandleSetDimensionSize(",
          "new_line_content": "  sub_properties.ForEach([&](absl::string_view key, float val) {",
          "content_same": false
        },
        {
          "line": 1247,
          "old_api": null,
          "new_api": "KeyToCopyFromSubcomputation",
          "old_text": null,
          "new_text": "KeyToCopyFromSubcomputation(key)",
          "old_line_content": "    const HloInstruction* /*set_size*/) {",
          "new_line_content": "    if (KeyToCopyFromSubcomputation(key)) {",
          "content_same": false
        },
        {
          "line": 1251,
          "old_api": null,
          "new_api": "OkStatus",
          "old_text": null,
          "new_text": "OkStatus()",
          "old_line_content": "Status HloCostAnalysis::FinishVisit(const HloInstruction*) {",
          "new_line_content": "  return OkStatus();",
          "content_same": false
        },
        {
          "line": 1256,
          "old_api": null,
          "new_api": "OkStatus",
          "old_text": null,
          "new_text": "OkStatus()",
          "old_line_content": "",
          "new_line_content": "  return OkStatus();",
          "content_same": false
        },
        {
          "line": 1261,
          "old_api": null,
          "new_api": "OkStatus",
          "old_text": null,
          "new_text": "OkStatus()",
          "old_line_content": "float HloCostAnalysis::bytes_accessed() const {",
          "new_line_content": "  return OkStatus();",
          "content_same": false
        },
        {
          "line": 1265,
          "old_api": null,
          "new_api": "OkStatus",
          "old_text": null,
          "new_text": "OkStatus()",
          "old_line_content": "float HloCostAnalysis::optimal_seconds() const {",
          "new_line_content": "  return OkStatus();",
          "content_same": false
        },
        {
          "line": 1283,
          "old_api": null,
          "new_api": "GetPropertyForHlo",
          "old_text": null,
          "new_text": "GetPropertyForHlo(hlo, kFlopsKey, hlo_properties_)",
          "old_line_content": "                                                ShapeIndex index) const {",
          "new_line_content": "  return GetPropertyForHlo(hlo, kFlopsKey, hlo_properties_);",
          "content_same": false
        },
        {
          "line": 1287,
          "old_api": null,
          "new_api": "GetPropertyForHlo",
          "old_text": null,
          "new_text": "GetPropertyForHlo(hlo, kTranscendentalsKey, hlo_properties_)",
          "old_line_content": "",
          "new_line_content": "  return GetPropertyForHlo(hlo, kTranscendentalsKey, hlo_properties_);",
          "content_same": false
        },
        {
          "line": 784,
          "old_api": null,
          "new_api": "base_dilation",
          "old_text": null,
          "new_text": "window_dim.base_dilation()",
          "old_line_content": "      for (int64_t output_idx = 0;",
          "new_line_content": "      if (window_dim.stride() == 1 && window_dim.base_dilation() == 1) {",
          "content_same": false
        },
        {
          "line": 786,
          "old_api": null,
          "new_api": "padding_low",
          "old_text": null,
          "new_text": "window_dim.padding_low()",
          "old_line_content": "        // Calculate lhs (input) index without taking base dilation into",
          "new_line_content": "            window_dim.padding_low() -",
          "content_same": false
        },
        {
          "line": 787,
          "old_api": null,
          "new_api": "window_dilation",
          "old_text": null,
          "new_text": "window_dim.window_dilation()",
          "old_line_content": "        // account.",
          "new_line_content": "            kernel_idx * window_dim.window_dilation();",
          "content_same": false
        },
        {
          "line": 788,
          "old_api": null,
          "new_api": "std::max<int64_t>(\n            std::min<int64_t>(\n                input_limits[spatial_dimension] + undilated_index_base,\n                output_limits[spatial_dimension]) -\n                std::max<int64_t>(undilated_index_base, 0l),\n            0l)",
          "old_text": null,
          "new_text": "std::max<int64_t>(\n            std::min<int64_t>(\n                input_limits[spatial_dimension] + undilated_index_base,\n                output_limits[spatial_dimension]) -\n                std::max<int64_t>(undilated_index_base, 0l),\n            0l)",
          "old_line_content": "        const int64_t undilated_index =",
          "new_line_content": "        valid_position_count += std::max<int64_t>(",
          "content_same": false
        },
        {
          "line": 792,
          "old_api": null,
          "new_api": "std::max<int64_t>(undilated_index_base, 0l)",
          "old_text": null,
          "new_text": "std::max<int64_t>(undilated_index_base, 0l)",
          "old_line_content": "        // Calculate the actual lhs (input) index after dilation. Avoid the",
          "new_line_content": "                std::max<int64_t>(undilated_index_base, 0l),",
          "content_same": false
        },
        {
          "line": 1304,
          "old_api": null,
          "new_api": "GetOperandUtilizationKey",
          "old_text": null,
          "new_text": "GetOperandUtilizationKey(operand_num, index)",
          "old_line_content": "",
          "new_line_content": "  return GetPropertyForHlo(hlo, GetOperandUtilizationKey(operand_num, index),",
          "content_same": false
        },
        {
          "line": 802,
          "old_api": null,
          "new_api": "padding_low",
          "old_text": null,
          "new_text": "window_dim.padding_low()",
          "old_line_content": "        }",
          "new_line_content": "            output_idx * window_dim.stride() - window_dim.padding_low() +",
          "content_same": false
        },
        {
          "line": 803,
          "old_api": null,
          "new_api": "window_dilation",
          "old_text": null,
          "new_text": "window_dim.window_dilation()",
          "old_line_content": "",
          "new_line_content": "            kernel_idx * window_dim.window_dilation();",
          "content_same": false
        },
        {
          "line": 808,
          "old_api": null,
          "new_api": "base_dilation",
          "old_text": null,
          "new_text": "window_dim.base_dilation()",
          "old_line_content": "        }",
          "new_line_content": "            window_dim.base_dilation() > 1",
          "content_same": false
        },
        {
          "line": 809,
          "old_api": null,
          "new_api": "base_dilation",
          "old_text": null,
          "new_text": "window_dim.base_dilation()",
          "old_line_content": "",
          "new_line_content": "                ? undilated_index / window_dim.base_dilation()",
          "content_same": false
        },
        {
          "line": 1321,
          "old_api": null,
          "new_api": "operand_count",
          "old_text": null,
          "new_text": "hlo.operand_count()",
          "old_line_content": "          }",
          "new_line_content": "  for (int operand_number = 0; operand_number < hlo.operand_count();",
          "content_same": false
        },
        {
          "line": 1323,
          "old_api": null,
          "new_api": "operand",
          "old_text": null,
          "new_text": "hlo.operand(operand_number)->shape()",
          "old_line_content": "  }",
          "new_line_content": "    const Shape& shape = hlo.operand(operand_number)->shape();",
          "content_same": false
        },
        {
          "line": 1324,
          "old_api": null,
          "new_api": "has_layout",
          "old_text": null,
          "new_text": "ShapeUtil::ForEachSubshape(\n        shape, [&](const Shape& sub_shape, const ShapeIndex& index) {\n          if (ShapeUtil::IsLeafIndex(shape, index)) {\n            std::optional<int64_t> index_memory_space;\n            if (sub_shape.has_layout()) {\n              index_memory_space = sub_shape.layout().memory_space();\n            }\n            if (!memory_space || memory_space == index_memory_space) {\n              bytes_read += operand_bytes_accessed(hlo, operand_number, index);\n            }\n          }\n        })",
          "old_line_content": "  return bytes_read;",
          "new_line_content": "    ShapeUtil::ForEachSubshape(",
          "content_same": false
        },
        {
          "line": 1326,
          "old_api": null,
          "new_api": "ShapeUtil::IsLeafIndex(shape, index)",
          "old_text": null,
          "new_text": "ShapeUtil::IsLeafIndex(shape, index)",
          "old_line_content": "",
          "new_line_content": "          if (ShapeUtil::IsLeafIndex(shape, index)) {",
          "content_same": false
        },
        {
          "line": 1328,
          "old_api": null,
          "new_api": "has_layout",
          "old_text": null,
          "new_text": "sub_shape.has_layout()",
          "old_line_content": "    const HloInstruction& hlo, std::optional<int64_t> memory_space) const {",
          "new_line_content": "            if (sub_shape.has_layout()) {",
          "content_same": false
        },
        {
          "line": 1329,
          "old_api": null,
          "new_api": "layout",
          "old_text": null,
          "new_text": "sub_shape.layout().memory_space()",
          "old_line_content": "  int64_t bytes_written = 0;",
          "new_line_content": "              index_memory_space = sub_shape.layout().memory_space();",
          "content_same": false
        },
        {
          "line": 1332,
          "old_api": null,
          "new_api": "operand_bytes_accessed",
          "old_text": null,
          "new_text": "operand_bytes_accessed(hlo, operand_number, index)",
          "old_line_content": "    std::optional<int64_t> index_memory_space;",
          "new_line_content": "              bytes_read += operand_bytes_accessed(hlo, operand_number, index);",
          "content_same": false
        },
        {
          "line": 826,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "valid_position_counts.push_back(valid_position_count)",
          "old_line_content": "}",
          "new_line_content": "    valid_position_counts.push_back(valid_position_count);",
          "content_same": false
        },
        {
          "line": 1344,
          "old_api": null,
          "new_api": "shape",
          "old_text": null,
          "new_text": "hlo.shape()",
          "old_line_content": "    HloComputation* computation) {",
          "new_line_content": "       ShapeUtil::GetLeafShapes(hlo.shape())) {",
          "content_same": false
        },
        {
          "line": 837,
          "old_api": null,
          "new_api": "GetConvolutionFlops",
          "old_text": null,
          "new_text": "GetConvolutionFlops(convolution)",
          "old_line_content": "  }",
          "new_line_content": "  current_properties_[kFlopsKey] = GetConvolutionFlops(convolution);",
          "content_same": false
        },
        {
          "line": 838,
          "old_api": null,
          "new_api": "OkStatus",
          "old_text": null,
          "new_text": "OkStatus()",
          "old_line_content": "  current_properties_[kFlopsKey] = kFmaFlops * kFmaPerComplexMul * log_factors *",
          "new_line_content": "  return OkStatus();",
          "content_same": false
        },
        {
          "line": 1350,
          "old_api": null,
          "new_api": "output_bytes_accessed",
          "old_text": null,
          "new_text": "output_bytes_accessed(hlo, indexed_shape.index)",
          "old_line_content": "  }",
          "new_line_content": "      bytes_written += output_bytes_accessed(hlo, indexed_shape.index);",
          "content_same": false
        },
        {
          "line": 843,
          "old_api": null,
          "new_api": "IsTuple",
          "old_text": null,
          "new_text": "fft->operand(0)->shape().IsTuple()",
          "old_line_content": "Status HloCostAnalysis::HandleTriangularSolve(const HloInstruction* hlo) {",
          "new_line_content": "      fft->operand(0)->shape().IsTuple()",
          "content_same": false
        },
        {
          "line": 844,
          "old_api": null,
          "new_api": "operand",
          "old_text": null,
          "new_text": "fft->operand(0)->shape()",
          "old_line_content": "  // Half of operand 0 is read.",
          "new_line_content": "          ? ShapeUtil::GetTupleElementShape(fft->operand(0)->shape(), 0)",
          "content_same": false
        },
        {
          "line": 1358,
          "old_api": null,
          "new_api": "CreateNestedCostAnalysis",
          "old_text": null,
          "new_text": "CreateNestedCostAnalysis()",
          "old_line_content": "/*static*/ std::string HloCostAnalysis::GetOperandBytesAccessedKey(",
          "new_line_content": "  auto visitor = CreateNestedCostAnalysis();",
          "content_same": false
        },
        {
          "line": 1359,
          "old_api": null,
          "new_api": "instruction_count",
          "old_text": null,
          "new_text": "computation->instruction_count()",
          "old_line_content": "    int64_t operand_num, const ShapeIndex& index) {",
          "new_line_content": "  visitor->ReserveVisitStates(computation->instruction_count());",
          "content_same": false
        },
        {
          "line": 1362,
          "old_api": null,
          "new_api": "std::move(entry.second)",
          "old_text": null,
          "new_text": "std::move(entry.second)",
          "old_line_content": "}",
          "new_line_content": "    hlo_properties_[entry.first] = std::move(entry.second);",
          "content_same": false
        },
        {
          "line": 1364,
          "old_api": null,
          "new_api": "properties",
          "old_text": null,
          "new_text": "visitor->properties()",
          "old_line_content": "/*static*/ std::string HloCostAnalysis::GetOperandUtilizationKey(",
          "new_line_content": "  return visitor->properties();",
          "content_same": false
        },
        {
          "line": 853,
          "old_api": null,
          "new_api": "OkStatus",
          "old_text": null,
          "new_text": "OkStatus()",
          "old_line_content": "  current_properties_[kBytesAccessedKey] = bytes_accessed;",
          "new_line_content": "  return OkStatus();",
          "content_same": false
        },
        {
          "line": 1368,
          "old_api": null,
          "new_api": "std::make_unique<HloCostAnalysis>(options_)",
          "old_text": null,
          "new_text": "std::make_unique<HloCostAnalysis>(options_)",
          "old_line_content": "}",
          "new_line_content": "  return std::make_unique<HloCostAnalysis>(options_);",
          "content_same": false
        },
        {
          "line": 860,
          "old_api": null,
          "new_api": "operand",
          "old_text": null,
          "new_text": "hlo->operand(0)->shape()",
          "old_line_content": "  current_properties_[kFlopsKey] = kFmaFlops * elems;",
          "new_line_content": "  bytes_accessed += GetShapeSize(hlo->operand(0)->shape()) / 2.0f;",
          "content_same": false
        },
        {
          "line": 1373,
          "old_api": null,
          "new_api": "ToString",
          "old_text": null,
          "new_text": "absl::StrCat(kBytesAccessedKey, \" operand \", operand_num, \" \",\n                      index.ToString())",
          "old_line_content": "}",
          "new_line_content": "  return absl::StrCat(kBytesAccessedKey, \" operand \", operand_num, \" \",",
          "content_same": false
        },
        {
          "line": 862,
          "old_api": null,
          "new_api": "operand",
          "old_text": null,
          "new_text": "hlo->operand(0)->shape()",
          "old_line_content": "}",
          "new_line_content": "      0, GetShapeSize(hlo->operand(0)->shape()) / 2.0f);",
          "content_same": false
        },
        {
          "line": 863,
          "old_api": null,
          "new_api": "operand",
          "old_text": null,
          "new_text": "hlo->operand(1)->shape()",
          "old_line_content": "",
          "new_line_content": "  bytes_accessed += GetShapeSize(hlo->operand(1)->shape());",
          "content_same": false
        },
        {
          "line": 864,
          "old_api": null,
          "new_api": "set_operand_bytes_accessed",
          "old_text": null,
          "new_text": "current_properties_.set_operand_bytes_accessed(\n      0, GetShapeSize(hlo->operand(1)->shape()))",
          "old_line_content": "Status HloCostAnalysis::HandleCholesky(const HloInstruction* hlo) {",
          "new_line_content": "  current_properties_.set_operand_bytes_accessed(",
          "content_same": false
        },
        {
          "line": 865,
          "old_api": null,
          "new_api": "operand",
          "old_text": null,
          "new_text": "hlo->operand(1)->shape()",
          "old_line_content": "  // Half of operand 0 is read and half of the output will be written.",
          "new_line_content": "      0, GetShapeSize(hlo->operand(1)->shape()));",
          "content_same": false
        },
        {
          "line": 1374,
          "old_api": null,
          "new_api": "ToString",
          "old_text": null,
          "new_text": "index.ToString()",
          "old_line_content": "",
          "new_line_content": "                      index.ToString());",
          "content_same": false
        },
        {
          "line": 1379,
          "old_api": null,
          "new_api": "ToString",
          "old_text": null,
          "new_text": "absl::StrCat(kUtilizationKey, \" operand \", operand_num, \" \",\n                      index.ToString())",
          "old_line_content": "",
          "new_line_content": "  return absl::StrCat(kUtilizationKey, \" operand \", operand_num, \" \",",
          "content_same": false
        },
        {
          "line": 1380,
          "old_api": null,
          "new_api": "ToString",
          "old_text": null,
          "new_text": "index.ToString()",
          "old_line_content": "}  // namespace xla",
          "new_line_content": "                      index.ToString());",
          "content_same": false
        },
        {
          "line": 872,
          "old_api": null,
          "new_api": "ShapeUtil::ElementsIn(b_shape)",
          "old_text": null,
          "new_text": "ShapeUtil::ElementsIn(b_shape)",
          "old_line_content": "  current_properties_[kBytesAccessedKey] = bytes_accessed;",
          "new_line_content": "  elems *= ShapeUtil::ElementsIn(b_shape);",
          "content_same": false
        },
        {
          "line": 1385,
          "old_api": null,
          "new_api": "ToString",
          "old_text": null,
          "new_text": "index.ToString()",
          "old_line_content": "",
          "new_line_content": "  return absl::StrCat(kBytesAccessedKey, \" output \", index.ToString());",
          "content_same": false
        },
        {
          "line": 1389,
          "old_api": null,
          "new_api": "absl::StartsWith(key, kBytesAccessedKey)",
          "old_text": null,
          "new_text": "absl::StartsWith(key, kBytesAccessedKey)",
          "old_line_content": "",
          "new_line_content": "  return !absl::StartsWith(key, kBytesAccessedKey) &&",
          "content_same": false
        },
        {
          "line": 1390,
          "old_api": null,
          "new_api": "absl::StartsWith(key, kUtilizationKey)",
          "old_text": null,
          "new_text": "absl::StartsWith(key, kUtilizationKey)",
          "old_line_content": "",
          "new_line_content": "         !absl::StartsWith(key, kUtilizationKey);",
          "content_same": false
        },
        {
          "line": 880,
          "old_api": null,
          "new_api": "set_output_bytes_accessed",
          "old_text": null,
          "new_text": "current_properties_.set_output_bytes_accessed(\n      GetShapeSize(hlo->operand(0)->shape()) / 2.0f)",
          "old_line_content": "}",
          "new_line_content": "  current_properties_.set_output_bytes_accessed(",
          "content_same": false
        },
        {
          "line": 881,
          "old_api": null,
          "new_api": "operand",
          "old_text": null,
          "new_text": "hlo->operand(0)->shape()",
          "old_line_content": "",
          "new_line_content": "      GetShapeSize(hlo->operand(0)->shape()) / 2.0f);",
          "content_same": false
        },
        {
          "line": 882,
          "old_api": null,
          "new_api": "operand",
          "old_text": null,
          "new_text": "hlo->operand(0)->shape()",
          "old_line_content": "Status HloCostAnalysis::HandleOptimizationBarrier(",
          "new_line_content": "  bytes_accessed += GetShapeSize(hlo->operand(0)->shape()) / 2.0f;",
          "content_same": false
        },
        {
          "line": 883,
          "old_api": null,
          "new_api": "set_operand_bytes_accessed",
          "old_text": null,
          "new_text": "current_properties_.set_operand_bytes_accessed(\n      0, GetShapeSize(hlo->operand(0)->shape()) / 2.0f)",
          "old_line_content": "    const HloInstruction* /*hlo*/) {",
          "new_line_content": "  current_properties_.set_operand_bytes_accessed(",
          "content_same": false
        },
        {
          "line": 887,
          "old_api": null,
          "new_api": "operand",
          "old_text": null,
          "new_text": "hlo->operand(0)->shape()",
          "old_line_content": "Status HloCostAnalysis::HandleAllGather(const HloInstruction* /*hlo*/) {",
          "new_line_content": "  const Shape& a_shape = hlo->operand(0)->shape();",
          "content_same": false
        },
        {
          "line": 889,
          "old_api": null,
          "new_api": "dimensions_size",
          "old_text": null,
          "new_text": "a_shape.dimensions_size()",
          "old_line_content": "}",
          "new_line_content": "  int64_t elems = a_shape.dimensions(a_shape.dimensions_size() - 1);",
          "content_same": false
        },
        {
          "line": 890,
          "old_api": null,
          "new_api": "ShapeUtil::ElementsIn(a_shape)",
          "old_text": null,
          "new_text": "ShapeUtil::ElementsIn(a_shape)",
          "old_line_content": "",
          "new_line_content": "  elems *= ShapeUtil::ElementsIn(a_shape);",
          "content_same": false
        },
        {
          "line": 897,
          "old_api": null,
          "new_api": "OkStatus",
          "old_text": null,
          "new_text": "OkStatus()",
          "old_line_content": "}",
          "new_line_content": "  return OkStatus();",
          "content_same": false
        },
        {
          "line": 901,
          "old_api": null,
          "new_api": "OkStatus",
          "old_text": null,
          "new_text": "OkStatus()",
          "old_line_content": "  // elements.",
          "new_line_content": "  return OkStatus();",
          "content_same": false
        },
        {
          "line": 905,
          "old_api": null,
          "new_api": "HandleAllGather",
          "old_text": null,
          "new_text": "HandleAllGather(hlo)",
          "old_line_content": "  double flops = 0.0;",
          "new_line_content": "  return HandleAllGather(hlo);",
          "content_same": false
        },
        {
          "line": 920,
          "old_api": null,
          "new_api": "IsArray",
          "old_text": null,
          "new_text": "ShapeUtil::ForEachSubshape(\n      crs->shape(), [&](const Shape& subshape, const ShapeIndex&) {\n        if (subshape.IsArray()) {\n          flops += ShapeUtil::ElementsIn(subshape);\n          output_bytes_accessed += GetShapeSize(subshape);\n        }\n      })",
          "old_line_content": "  current_properties_[kBytesAccessedKey] = bytes_accessed;",
          "new_line_content": "  ShapeUtil::ForEachSubshape(",
          "content_same": false
        },
        {
          "line": 922,
          "old_api": null,
          "new_api": "IsArray",
          "old_text": null,
          "new_text": "subshape.IsArray()",
          "old_line_content": "}",
          "new_line_content": "        if (subshape.IsArray()) {",
          "content_same": false
        },
        {
          "line": 923,
          "old_api": null,
          "new_api": "ShapeUtil::ElementsIn(subshape)",
          "old_text": null,
          "new_text": "ShapeUtil::ElementsIn(subshape)",
          "old_line_content": "",
          "new_line_content": "          flops += ShapeUtil::ElementsIn(subshape);",
          "content_same": false
        },
        {
          "line": 924,
          "old_api": null,
          "new_api": "GetShapeSize",
          "old_text": null,
          "new_text": "GetShapeSize(subshape)",
          "old_line_content": "Status HloCostAnalysis::HandleReduceScatter(const HloInstruction* hlo) {",
          "new_line_content": "          output_bytes_accessed += GetShapeSize(subshape);",
          "content_same": false
        },
        {
          "line": 928,
          "old_api": null,
          "new_api": "operands",
          "old_text": null,
          "new_text": "crs->operands()",
          "old_line_content": "Status HloCostAnalysis::HandleAllReduceStart(const HloInstruction* hlo) {",
          "new_line_content": "  for (const HloInstruction* operand : crs->operands()) {",
          "content_same": false
        },
        {
          "line": 932,
          "old_api": null,
          "new_api": "set_output_bytes_accessed",
          "old_text": null,
          "new_text": "current_properties_.set_output_bytes_accessed(output_bytes_accessed)",
          "old_line_content": "Status HloCostAnalysis::HandleAllReduceDone(const HloInstruction* /*hlo*/) {",
          "new_line_content": "  current_properties_.set_output_bytes_accessed(output_bytes_accessed);",
          "content_same": false
        },
        {
          "line": 934,
          "old_api": null,
          "new_api": "OkStatus",
          "old_text": null,
          "new_text": "OkStatus()",
          "old_line_content": "}",
          "new_line_content": "  return OkStatus();",
          "content_same": false
        },
        {
          "line": 938,
          "old_api": null,
          "new_api": "OkStatus",
          "old_text": null,
          "new_text": "OkStatus()",
          "old_line_content": "}",
          "new_line_content": "  return OkStatus();",
          "content_same": false
        },
        {
          "line": 942,
          "old_api": null,
          "new_api": "HandleAllReduce",
          "old_text": null,
          "new_text": "HandleAllReduce(hlo)",
          "old_line_content": "}",
          "new_line_content": "  return HandleAllReduce(hlo);",
          "content_same": false
        },
        {
          "line": 950,
          "old_api": null,
          "new_api": "OkStatus",
          "old_text": null,
          "new_text": "OkStatus()",
          "old_line_content": "    const HloInstruction* /*hlo*/) {",
          "new_line_content": "  return OkStatus();",
          "content_same": false
        },
        {
          "line": 954,
          "old_api": null,
          "new_api": "OkStatus",
          "old_text": null,
          "new_text": "OkStatus()",
          "old_line_content": "Status HloCostAnalysis::HandlePartitionId(const HloInstruction* /*hlo*/) {",
          "new_line_content": "  return OkStatus();",
          "content_same": false
        },
        {
          "line": 964,
          "old_api": null,
          "new_api": "OkStatus",
          "old_text": null,
          "new_text": "OkStatus()",
          "old_line_content": "  // cost changes with the implementation and the distribution. For now, assume",
          "new_line_content": "  return OkStatus();",
          "content_same": false
        },
        {
          "line": 972,
          "old_api": null,
          "new_api": "OkStatus",
          "old_text": null,
          "new_text": "OkStatus()",
          "old_line_content": "  // TODO(b/26346211): Implement better estimates for the RNG cost, since the",
          "new_line_content": "  return OkStatus();",
          "content_same": false
        },
        {
          "line": 980,
          "old_api": null,
          "new_api": "shape",
          "old_text": null,
          "new_text": "random->shape()",
          "old_line_content": "Status HloCostAnalysis::HandleRngGetAndUpdateState(",
          "new_line_content": "      ShapeUtil::ElementsIn(random->shape());",
          "content_same": false
        },
        {
          "line": 981,
          "old_api": null,
          "new_api": "OkStatus",
          "old_text": null,
          "new_text": "OkStatus()",
          "old_line_content": "    const HloInstruction* random) {",
          "new_line_content": "  return OkStatus();",
          "content_same": false
        },
        {
          "line": 990,
          "old_api": null,
          "new_api": "OkStatus",
          "old_text": null,
          "new_text": "OkStatus()",
          "old_line_content": "    for (const HloInstruction* hlo :",
          "new_line_content": "  return OkStatus();",
          "content_same": false
        },
        {
          "line": 999,
          "old_api": null,
          "new_api": "ToString",
          "old_text": null,
          "new_text": "fusion->ToString()",
          "old_line_content": "  }",
          "new_line_content": "  VLOG(8) << \"Processing fusion \" << fusion->ToString();",
          "content_same": false
        },
        {
          "line": 1004,
          "old_api": null,
          "new_api": "fused_instructions_computation",
          "old_text": null,
          "new_text": "fusion->fused_instructions_computation()->instructions()",
          "old_line_content": "  // Fusion nodes that produce a tuple also produce the entries in the tuple.",
          "new_line_content": "         fusion->fused_instructions_computation()->instructions()) {",
          "content_same": false
        },
        {
          "line": 1005,
          "old_api": null,
          "new_api": "opcode",
          "old_text": null,
          "new_text": "hlo->opcode()",
          "old_line_content": "  // Ignore the memory accessed inside fused ops, since fusion is supposed to",
          "new_line_content": "      if (hlo->opcode() == HloOpcode::kGather) {",
          "content_same": false
        },
        {
          "line": 1006,
          "old_api": null,
          "new_api": "HandleGather",
          "old_text": null,
          "new_text": "HandleGather(hlo)",
          "old_line_content": "  // prevent intermediate data from touching slow memory.",
          "new_line_content": "        return HandleGather(hlo);",
          "content_same": false
        },
        {
          "line": 1013,
          "old_api": null,
          "new_api": "fused_instructions_computation",
          "old_text": null,
          "new_text": "TF_ASSIGN_OR_RETURN(\n      current_properties_,\n      ProcessSubcomputation(fusion->fused_instructions_computation()))",
          "old_line_content": "        }",
          "new_line_content": "  TF_ASSIGN_OR_RETURN(",
          "content_same": false
        },
        {
          "line": 1021,
          "old_api": null,
          "new_api": "IsArray",
          "old_text": null,
          "new_text": "ShapeUtil::ForEachSubshape(\n      fusion->shape(),\n      [this, root](const Shape& subshape, const ShapeIndex& shape_index) {\n        if (!subshape.IsArray()) {\n          return;\n        }\n        if (shape_index.empty()) {\n          if (root->opcode() == HloOpcode::kDynamicUpdateSlice) {\n            int64_t size = GetShapeSize(root->operand(1)->shape());\n            current_properties_[kBytesAccessedKey] += size;\n            current_properties_.set_output_bytes_accessed(shape_index, size);\n            hlo_properties_[root][GetOperandUtilizationKey(0)] = 0;\n            return;\n          }\n        } else if (shape_index.size() == 1) {\n          if (root->opcode() == HloOpcode::kTuple &&\n              root->operand(shape_index[0])->opcode() ==\n                  HloOpcode::kDynamicUpdateSlice) {\n            int64_t size = GetShapeSize(\n                root->operand(shape_index[0])->operand(1)->shape());\n            current_properties_[kBytesAccessedKey] += size;\n            current_properties_.set_output_bytes_accessed(shape_index, size);\n            hlo_properties_[root->operand(shape_index[0])]\n                           [GetOperandUtilizationKey(0)] = 0;\n            return;\n          }\n        }\n        current_properties_[kBytesAccessedKey] += GetShapeSize(subshape);\n        current_properties_.set_output_bytes_accessed(shape_index,\n                                                      GetShapeSize(subshape));\n      })",
          "old_line_content": "          }",
          "new_line_content": "  ShapeUtil::ForEachSubshape(",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 1026,
          "old_api": "operand",
          "new_api": null,
          "old_text": "GetShapeSize(\n                root->operand(shape_index[0])->operand(1)->shape())",
          "new_text": null,
          "old_line_content": "            int64_t size = GetShapeSize(",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 1030,
          "old_api": "operand",
          "new_api": null,
          "old_text": "root->operand(shape_index[0])",
          "new_text": null,
          "old_line_content": "            hlo_properties_[root->operand(shape_index[0])]",
          "new_line_content": "            current_properties_[kBytesAccessedKey] += size;",
          "content_same": false
        },
        {
          "line": 1054,
          "old_api": "tuple_shapes_size",
          "new_api": null,
          "old_text": "shape.tuple_shapes_size()",
          "new_text": null,
          "old_line_content": "      for (int i = 0; i < shape.tuple_shapes_size(); ++i) {",
          "new_line_content": "    // Propagate and accumulate the output tuple bytes from the tuple subshapes.",
          "content_same": false
        },
        {
          "line": 1055,
          "old_api": "tuple_shapes",
          "new_api": null,
          "old_text": "shape.tuple_shapes(i)",
          "new_text": null,
          "old_line_content": "        const Shape& subshape = shape.tuple_shapes(i);",
          "new_line_content": "    // This ensures we have the correct output bytes accessed for the shape",
          "content_same": false
        },
        {
          "line": 1057,
          "old_api": "push_back",
          "new_api": null,
          "old_text": "subshape_index.push_back(i)",
          "new_text": null,
          "old_line_content": "        subshape_index.push_back(i);",
          "new_line_content": "    // {}.",
          "content_same": false
        },
        {
          "line": 1059,
          "old_api": "propagate_output_size_to_parent",
          "new_api": null,
          "old_text": "propagate_output_size_to_parent(subshape, subshape_index)",
          "new_text": null,
          "old_line_content": "            propagate_output_size_to_parent(subshape, subshape_index);",
          "new_line_content": "        propagate_output_size_to_parent;",
          "content_same": false
        },
        {
          "line": 1064,
          "old_api": "shape",
          "new_api": null,
          "old_text": "fusion->shape()",
          "new_text": null,
          "old_line_content": "    propagate_output_size_to_parent(fusion->shape(), {});",
          "new_line_content": "      if (bytes_accessed != 0) {",
          "content_same": false
        },
        {
          "line": 1071,
          "old_api": "fused_instructions_computation",
          "new_api": null,
          "old_text": "fusion->fused_instructions_computation()->instructions()",
          "new_text": null,
          "old_line_content": "       fusion->fused_instructions_computation()->instructions()) {",
          "new_line_content": "        bytes_accessed +=",
          "content_same": false
        },
        {
          "line": 1073,
          "old_api": "shape",
          "new_api": null,
          "old_text": "instr->shape()",
          "new_text": null,
          "old_line_content": "        ShapeUtil::ElementsIn(instr->shape()) >",
          "new_line_content": "      }",
          "content_same": false
        },
        {
          "line": 1074,
          "old_api": "immediate_constant_max_elements",
          "new_api": null,
          "old_text": "immediate_constant_max_elements()",
          "new_text": null,
          "old_line_content": "            immediate_constant_max_elements()) {",
          "new_line_content": "      return bytes_accessed;",
          "content_same": false
        },
        {
          "line": 1088,
          "old_api": "FusionParameterReadBytes",
          "new_api": null,
          "old_text": "FusionParameterReadBytes(operand)",
          "new_text": null,
          "old_line_content": "      operand_size = FusionParameterReadBytes(operand);",
          "new_line_content": "      float utilization = hlo_properties_[instr][kUtilizationKey];",
          "content_same": false
        },
        {
          "line": 1096,
          "old_api": "users",
          "new_api": null,
          "old_text": "gte->users()",
          "new_text": null,
          "old_line_content": "          for (const HloInstruction* user : gte->users()) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1104,
          "old_api": "FusionParameterReadBytes",
          "new_api": null,
          "old_text": "FusionParameterReadBytes(gte)",
          "new_text": null,
          "old_line_content": "        int64_t size = FusionParameterReadBytes(gte);",
          "new_line_content": "      // shape and calculate the bytes accessed for those array types.",
          "content_same": false
        },
        {
          "line": 1112,
          "old_api": "set_operand_utilization",
          "new_api": null,
          "old_text": "current_properties_.set_operand_utilization(\n        i, hlo_properties_[operand][kUtilizationKey])",
          "new_text": null,
          "old_line_content": "    current_properties_.set_operand_utilization(",
          "new_line_content": "              gte = user;",
          "content_same": false
        },
        {
          "line": 1116,
          "old_api": "OkStatus",
          "new_api": null,
          "old_text": "OkStatus()",
          "new_text": null,
          "old_line_content": "  return OkStatus();",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 1120,
          "old_api": "to_apply",
          "new_api": null,
          "old_text": "TF_ASSIGN_OR_RETURN(current_properties_,\n                      ProcessSubcomputation(call->to_apply()))",
          "new_text": null,
          "old_line_content": "  TF_ASSIGN_OR_RETURN(current_properties_,",
          "new_line_content": "                                                       size);",
          "content_same": false
        },
        {
          "line": 1121,
          "old_api": "to_apply",
          "new_api": null,
          "old_text": "call->to_apply()",
          "new_text": null,
          "old_line_content": "                      ProcessSubcomputation(call->to_apply()));",
          "new_line_content": "      }",
          "content_same": false
        },
        {
          "line": 1123,
          "old_api": "OkStatus",
          "new_api": null,
          "old_text": "OkStatus()",
          "new_text": null,
          "old_line_content": "  return OkStatus();",
          "new_line_content": "    current_properties_[kBytesAccessedKey] += operand_size;",
          "content_same": false
        },
        {
          "line": 1135,
          "old_api": "set_operand_bytes_accessed",
          "new_api": null,
          "old_text": "current_properties_.set_operand_bytes_accessed(i, -1)",
          "new_text": null,
          "old_line_content": "    current_properties_.set_operand_bytes_accessed(i, -1);",
          "new_line_content": "  current_should_compute_bottleneck_time_ = false;",
          "content_same": false
        },
        {
          "line": 1139,
          "old_api": "OkStatus",
          "new_api": null,
          "old_text": "OkStatus()",
          "new_text": null,
          "old_line_content": "  return OkStatus();",
          "new_line_content": "Status HloCostAnalysis::HandleCustomCall(const HloInstruction* custom_call) {",
          "content_same": false
        },
        {
          "line": 1145,
          "old_api": "operand",
          "new_api": null,
          "old_text": "sort->operand(0)->shape()",
          "new_text": null,
          "old_line_content": "  int64_t elements = ShapeUtil::ElementsIn(sort->operand(0)->shape());",
          "new_line_content": "  current_properties_[kBytesAccessedKey] = -1;",
          "content_same": false
        },
        {
          "line": 1161,
          "old_api": "ForEach",
          "new_api": null,
          "old_text": "body_properties.ForEach([&](absl::string_view key, float val) {\n    current_properties_[key] += val;\n  })",
          "new_text": null,
          "old_line_content": "  body_properties.ForEach([&](absl::string_view key, float val) {",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 1164,
          "old_api": "ForEach",
          "new_api": null,
          "old_text": "condition_properties.ForEach([&](absl::string_view key, float val) {\n    current_properties_[key] += val;\n  })",
          "new_text": null,
          "old_line_content": "  condition_properties.ForEach([&](absl::string_view key, float val) {",
          "new_line_content": "  // Since the number of iterations of the while node will not always be",
          "content_same": false
        },
        {
          "line": 1169,
          "old_api": "OkStatus",
          "new_api": null,
          "old_text": "OkStatus()",
          "new_text": null,
          "old_line_content": "  return OkStatus();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1179,
          "old_api": "branch_count",
          "new_api": null,
          "old_text": "conditional->branch_count()",
          "new_text": null,
          "old_line_content": "  for (int j = 1; j < conditional->branch_count(); ++j) {",
          "new_line_content": "  });",
          "content_same": false
        },
        {
          "line": 1183,
          "old_api": "ForEach",
          "new_api": null,
          "old_text": "branch_computation_properties.ForEach(\n        [&](absl::string_view key, float val) {\n          auto& current_property = current_properties_[key];\n          current_property = std::max(current_property, val);\n        })",
          "new_text": null,
          "old_line_content": "    branch_computation_properties.ForEach(",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 1186,
          "old_api": "std::max(current_property, val)",
          "new_api": null,
          "old_text": "std::max(current_property, val)",
          "new_text": null,
          "old_line_content": "          current_property = std::max(current_property, val);",
          "new_line_content": "  // Compute the cost of the branch computations and take the maximum from those",
          "content_same": false
        },
        {
          "line": 1191,
          "old_api": "OkStatus",
          "new_api": null,
          "old_text": "OkStatus()",
          "new_text": null,
          "old_line_content": "  return OkStatus();",
          "new_line_content": "  current_properties_ = branch0_computation_properties;",
          "content_same": false
        },
        {
          "line": 1197,
          "old_api": "shape",
          "new_api": null,
          "old_text": "gather->shape()",
          "new_text": null,
          "old_line_content": "  int64_t output_size = GetShapeSize(gather->shape());",
          "new_line_content": "        [&](absl::string_view key, float val) {",
          "content_same": false
        },
        {
          "line": 1200,
          "old_api": "set_operand_bytes_accessed",
          "new_api": null,
          "old_text": "current_properties_.set_operand_bytes_accessed(0, output_size)",
          "new_text": null,
          "old_line_content": "  current_properties_.set_operand_bytes_accessed(0, output_size);",
          "new_line_content": "        });",
          "content_same": false
        },
        {
          "line": 1201,
          "old_api": "set_operand_bytes_accessed",
          "new_api": null,
          "old_text": "current_properties_.set_operand_bytes_accessed(\n      1, GetShapeSize(gather->operand(1)->shape()))",
          "new_text": null,
          "old_line_content": "  current_properties_.set_operand_bytes_accessed(",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 1202,
          "old_api": "operand",
          "new_api": null,
          "old_text": "gather->operand(1)->shape()",
          "new_text": null,
          "old_line_content": "      1, GetShapeSize(gather->operand(1)->shape()));",
          "new_line_content": "  current_should_compute_bottleneck_time_ = false;",
          "content_same": false
        },
        {
          "line": 1203,
          "old_api": "set_operand_utilization",
          "new_api": null,
          "old_text": "current_properties_.set_operand_utilization(\n      0, 1.0 * ShapeUtil::ElementsIn(gather->shape()) /\n             ShapeUtil::ElementsIn(gather->operand(0)->shape()))",
          "new_text": null,
          "old_line_content": "  current_properties_.set_operand_utilization(",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1205,
          "old_api": "operand",
          "new_api": null,
          "old_text": "gather->operand(0)->shape()",
          "new_text": null,
          "old_line_content": "             ShapeUtil::ElementsIn(gather->operand(0)->shape()));",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 1206,
          "old_api": "set_output_bytes_accessed",
          "new_api": null,
          "old_text": "current_properties_.set_output_bytes_accessed(output_size)",
          "new_text": null,
          "old_line_content": "  current_properties_.set_output_bytes_accessed(output_size);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1208,
          "old_api": "OkStatus",
          "new_api": null,
          "old_text": "OkStatus()",
          "new_text": null,
          "old_line_content": "  return OkStatus();",
          "new_line_content": "  // Gather doesn't read the whole input buffer, it's equivalent to a copy the",
          "content_same": false
        },
        {
          "line": 1223,
          "old_api": "scatter_indices",
          "new_api": null,
          "old_text": "scatter->scatter_indices()->shape()",
          "new_text": null,
          "old_line_content": "      GetShapeSize(scatter->scatter_indices()->shape());",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1224,
          "old_api": "set_operand_bytes_accessed",
          "new_api": null,
          "old_text": "current_properties_.set_operand_bytes_accessed(\n      scatter->scatter_operand_count(), scatter_indices_size)",
          "new_text": null,
          "old_line_content": "  current_properties_.set_operand_bytes_accessed(",
          "new_line_content": "Status HloCostAnalysis::HandleScatter(const HloInstruction* hlo) {",
          "content_same": false
        },
        {
          "line": 1228,
          "old_api": "set_output_bytes_accessed",
          "new_api": null,
          "old_text": "current_properties_.set_output_bytes_accessed(total_update_size)",
          "new_text": null,
          "old_line_content": "  current_properties_.set_output_bytes_accessed(total_update_size);",
          "new_line_content": "  int64_t total_update_size = 0;",
          "content_same": false
        },
        {
          "line": 1233,
          "old_api": "ForEach",
          "new_api": null,
          "old_text": "sub_properties.ForEach([&](absl::string_view key, float val) {\n    if (KeyToCopyFromSubcomputation(key)) {\n      current_properties_[key] = val * element_count;\n    }\n  })",
          "new_text": null,
          "old_line_content": "  sub_properties.ForEach([&](absl::string_view key, float val) {",
          "new_line_content": "    total_update_size += update_size;",
          "content_same": false
        },
        {
          "line": 1234,
          "old_api": "KeyToCopyFromSubcomputation",
          "new_api": null,
          "old_text": "KeyToCopyFromSubcomputation(key)",
          "new_text": null,
          "old_line_content": "    if (KeyToCopyFromSubcomputation(key)) {",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 1248,
          "old_api": "OkStatus",
          "new_api": null,
          "old_text": "OkStatus()",
          "new_text": null,
          "old_line_content": "  return OkStatus();",
          "new_line_content": "      current_properties_[key] = val * element_count;",
          "content_same": false
        },
        {
          "line": 1252,
          "old_api": "OkStatus",
          "new_api": null,
          "old_text": "OkStatus()",
          "new_text": null,
          "old_line_content": "  return OkStatus();",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 1270,
          "old_api": "GetPropertyForHlo",
          "new_api": null,
          "old_text": "GetPropertyForHlo(hlo, kFlopsKey, hlo_properties_)",
          "new_text": null,
          "old_line_content": "  return GetPropertyForHlo(hlo, kFlopsKey, hlo_properties_);",
          "new_line_content": "float HloCostAnalysis::transcendental_count() const {",
          "content_same": false
        },
        {
          "line": 1274,
          "old_api": "GetPropertyForHlo",
          "new_api": null,
          "old_text": "GetPropertyForHlo(hlo, kTranscendentalsKey, hlo_properties_)",
          "new_text": null,
          "old_line_content": "  return GetPropertyForHlo(hlo, kTranscendentalsKey, hlo_properties_);",
          "new_line_content": "float HloCostAnalysis::bytes_accessed() const {",
          "content_same": false
        },
        {
          "line": 1278,
          "old_api": "GetPropertyForHlo",
          "new_api": null,
          "old_text": "GetPropertyForHlo(hlo, kBytesAccessedKey, hlo_properties_)",
          "new_text": null,
          "old_line_content": "  return GetPropertyForHlo(hlo, kBytesAccessedKey, hlo_properties_);",
          "new_line_content": "float HloCostAnalysis::optimal_seconds() const {",
          "content_same": false
        },
        {
          "line": 1284,
          "old_api": "GetOperandBytesAccessedKey",
          "new_api": null,
          "old_text": "GetOperandBytesAccessedKey(operand_num, index)",
          "new_text": null,
          "old_line_content": "  return GetPropertyForHlo(hlo, GetOperandBytesAccessedKey(operand_num, index),",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 790,
          "old_api": "window_dilation",
          "new_api": null,
          "old_text": "window_dim.window_dilation()",
          "new_text": null,
          "old_line_content": "            kernel_idx * window_dim.window_dilation();",
          "new_line_content": "                input_limits[spatial_dimension] + undilated_index_base,",
          "content_same": false
        },
        {
          "line": 1302,
          "old_api": "GetPropertyForHlo",
          "new_api": null,
          "old_text": "GetPropertyForHlo(hlo, kOptimalSecondsKey, hlo_properties_)",
          "new_text": null,
          "old_line_content": "  return GetPropertyForHlo(hlo, kOptimalSecondsKey, hlo_properties_);",
          "new_line_content": "                                           int64_t operand_num,",
          "content_same": false
        },
        {
          "line": 795,
          "old_api": "base_dilation",
          "new_api": null,
          "old_text": "window_dim.base_dilation()",
          "new_text": null,
          "old_line_content": "            window_dim.base_dilation() > 1",
          "new_line_content": "      }",
          "content_same": false
        },
        {
          "line": 796,
          "old_api": "base_dilation",
          "new_api": null,
          "old_text": "window_dim.base_dilation()",
          "new_text": null,
          "old_line_content": "                ? undilated_index / window_dim.base_dilation()",
          "new_line_content": "      // Loop over each point in the output.",
          "content_same": false
        },
        {
          "line": 1308,
          "old_api": "operand_count",
          "new_api": null,
          "old_text": "hlo.operand_count()",
          "new_text": null,
          "old_line_content": "  for (int operand_number = 0; operand_number < hlo.operand_count();",
          "new_line_content": "int64_t HloCostAnalysis::output_bytes_accessed(const HloInstruction& hlo,",
          "content_same": false
        },
        {
          "line": 1311,
          "old_api": "has_layout",
          "new_api": null,
          "old_text": "ShapeUtil::ForEachSubshape(\n        shape, [&](const Shape& sub_shape, const ShapeIndex& index) {\n          if (ShapeUtil::IsLeafIndex(shape, index)) {\n            std::optional<int64_t> index_memory_space;\n            if (sub_shape.has_layout()) {\n              index_memory_space = sub_shape.layout().memory_space();\n            }\n            if (!memory_space || memory_space == index_memory_space) {\n              bytes_read += operand_bytes_accessed(hlo, operand_number, index);\n            }\n          }\n        })",
          "new_text": null,
          "old_line_content": "    ShapeUtil::ForEachSubshape(",
          "new_line_content": "                           hlo_properties_);",
          "content_same": false
        },
        {
          "line": 800,
          "old_api": "base_dilation",
          "new_api": null,
          "old_text": "window_dim.base_dilation()",
          "new_text": null,
          "old_line_content": "        if (undilated_index != lhs_spatial_index * window_dim.base_dilation()) {",
          "new_line_content": "        // account.",
          "content_same": false
        },
        {
          "line": 1313,
          "old_api": "ShapeUtil::IsLeafIndex(shape, index)",
          "new_api": null,
          "old_text": "ShapeUtil::IsLeafIndex(shape, index)",
          "new_text": null,
          "old_line_content": "          if (ShapeUtil::IsLeafIndex(shape, index)) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1316,
          "old_api": "layout",
          "new_api": null,
          "old_text": "sub_shape.layout().memory_space()",
          "new_text": null,
          "old_line_content": "              index_memory_space = sub_shape.layout().memory_space();",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 1319,
          "old_api": "operand_bytes_accessed",
          "new_api": null,
          "old_text": "operand_bytes_accessed(hlo, operand_number, index)",
          "new_text": null,
          "old_line_content": "              bytes_read += operand_bytes_accessed(hlo, operand_number, index);",
          "new_line_content": "    const HloInstruction& hlo, std::optional<int64_t> memory_space) const {",
          "content_same": false
        },
        {
          "line": 817,
          "old_api": "feature_group_count",
          "new_api": null,
          "old_text": "convolution->feature_group_count()",
          "new_text": null,
          "old_line_content": "      (input_feature / convolution->feature_group_count()) * output_feature *",
          "new_line_content": "        // Skip if input index is not in bound.",
          "content_same": false
        },
        {
          "line": 818,
          "old_api": "batch_group_count",
          "new_api": null,
          "old_text": "convolution->batch_group_count()",
          "new_text": null,
          "old_line_content": "      (batch / convolution->batch_group_count()) *",
          "new_line_content": "        if (lhs_spatial_index < 0 ||",
          "content_same": false
        },
        {
          "line": 819,
          "old_api": "Product",
          "new_api": null,
          "old_text": "Product(valid_position_counts)",
          "new_text": null,
          "old_line_content": "      Product(valid_position_counts);",
          "new_line_content": "            lhs_spatial_index >= input_limits[spatial_dimension]) {",
          "content_same": false
        },
        {
          "line": 1331,
          "old_api": "shape",
          "new_api": null,
          "old_text": "hlo.shape()",
          "new_text": null,
          "old_line_content": "       ShapeUtil::GetLeafShapes(hlo.shape())) {",
          "new_line_content": "            if (!memory_space || memory_space == index_memory_space) {",
          "content_same": false
        },
        {
          "line": 1333,
          "old_api": "has_layout",
          "new_api": null,
          "old_text": "indexed_shape.shape.has_layout()",
          "new_text": null,
          "old_line_content": "    if (indexed_shape.shape.has_layout()) {",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 1334,
          "old_api": "layout",
          "new_api": null,
          "old_text": "indexed_shape.shape.layout().memory_space()",
          "new_text": null,
          "old_line_content": "      index_memory_space = indexed_shape.shape.layout().memory_space();",
          "new_line_content": "          }",
          "content_same": false
        },
        {
          "line": 824,
          "old_api": "GetConvolutionFlops",
          "new_api": null,
          "old_text": "GetConvolutionFlops(convolution)",
          "new_text": null,
          "old_line_content": "  current_properties_[kFlopsKey] = GetConvolutionFlops(convolution);",
          "new_line_content": "      }",
          "content_same": false
        },
        {
          "line": 825,
          "old_api": "OkStatus",
          "new_api": null,
          "old_text": "OkStatus()",
          "new_text": null,
          "old_line_content": "  return OkStatus();",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1337,
          "old_api": "output_bytes_accessed",
          "new_api": null,
          "old_text": "output_bytes_accessed(hlo, indexed_shape.index)",
          "new_text": null,
          "old_line_content": "      bytes_written += output_bytes_accessed(hlo, indexed_shape.index);",
          "new_line_content": "  return bytes_read;",
          "content_same": false
        },
        {
          "line": 833,
          "old_api": "constexpr",
          "new_api": null,
          "old_text": "constexpr",
          "new_text": null,
          "old_line_content": "  constexpr int kFmaPerComplexMul = 4;",
          "new_line_content": "  return fma_count * kFmaFlops;",
          "content_same": false
        },
        {
          "line": 1345,
          "old_api": "CreateNestedCostAnalysis",
          "new_api": null,
          "old_text": "CreateNestedCostAnalysis()",
          "new_text": null,
          "old_line_content": "  auto visitor = CreateNestedCostAnalysis();",
          "new_line_content": "    std::optional<int64_t> index_memory_space;",
          "content_same": false
        },
        {
          "line": 835,
          "old_api": "fft_length",
          "new_api": null,
          "old_text": "fft->fft_length()",
          "new_text": null,
          "old_line_content": "  for (int64_t dim : fft->fft_length()) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 836,
          "old_api": "Log2Floor<uint64_t>(dim)",
          "new_api": null,
          "old_text": "Log2Floor<uint64_t>(dim)",
          "new_text": null,
          "old_line_content": "    log_factors *= Log2Floor<uint64_t>(dim);",
          "new_line_content": "Status HloCostAnalysis::HandleConvolution(const HloInstruction* convolution) {",
          "content_same": false
        },
        {
          "line": 1349,
          "old_api": "std::move(entry.second)",
          "new_api": null,
          "old_text": "std::move(entry.second)",
          "new_text": null,
          "old_line_content": "    hlo_properties_[entry.first] = std::move(entry.second);",
          "new_line_content": "    if (!memory_space || memory_space == index_memory_space) {",
          "content_same": false
        },
        {
          "line": 839,
          "old_api": "ShapeUtil::ElementsIn(real_shape)",
          "new_api": null,
          "old_text": "ShapeUtil::ElementsIn(real_shape)",
          "new_text": null,
          "old_line_content": "                                   ShapeUtil::ElementsIn(real_shape);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 840,
          "old_api": "OkStatus",
          "new_api": null,
          "old_text": "OkStatus()",
          "new_text": null,
          "old_line_content": "  return OkStatus();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1351,
          "old_api": "properties",
          "new_api": null,
          "old_text": "visitor->properties()",
          "new_text": null,
          "old_line_content": "  return visitor->properties();",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1355,
          "old_api": "std::make_unique<HloCostAnalysis>(options_)",
          "new_api": null,
          "old_text": "std::make_unique<HloCostAnalysis>(options_)",
          "new_text": null,
          "old_line_content": "  return std::make_unique<HloCostAnalysis>(options_);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 847,
          "old_api": "operand",
          "new_api": null,
          "old_text": "hlo->operand(0)->shape()",
          "new_text": null,
          "old_line_content": "  bytes_accessed += GetShapeSize(hlo->operand(0)->shape()) / 2.0f;",
          "new_line_content": "  int64_t log_factors = 1;",
          "content_same": false
        },
        {
          "line": 1361,
          "old_api": "ToString",
          "new_api": null,
          "old_text": "index.ToString()",
          "new_text": null,
          "old_line_content": "                      index.ToString());",
          "new_line_content": "  for (auto& entry : visitor->hlo_properties_) {",
          "content_same": false
        },
        {
          "line": 850,
          "old_api": "operand",
          "new_api": null,
          "old_text": "hlo->operand(1)->shape()",
          "new_text": null,
          "old_line_content": "  bytes_accessed += GetShapeSize(hlo->operand(1)->shape());",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 851,
          "old_api": "set_operand_bytes_accessed",
          "new_api": null,
          "old_text": "current_properties_.set_operand_bytes_accessed(\n      0, GetShapeSize(hlo->operand(1)->shape()))",
          "new_text": null,
          "old_line_content": "  current_properties_.set_operand_bytes_accessed(",
          "new_line_content": "  current_properties_[kFlopsKey] = kFmaFlops * kFmaPerComplexMul * log_factors *",
          "content_same": false
        },
        {
          "line": 1366,
          "old_api": "ToString",
          "new_api": null,
          "old_text": "absl::StrCat(kUtilizationKey, \" operand \", operand_num, \" \",\n                      index.ToString())",
          "new_text": null,
          "old_line_content": "  return absl::StrCat(kUtilizationKey, \" operand \", operand_num, \" \",",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 855,
          "old_api": "operand",
          "new_api": null,
          "old_text": "hlo->operand(0)->shape()",
          "new_text": null,
          "old_line_content": "  const Shape& a_shape = hlo->operand(0)->shape();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 856,
          "old_api": "operand",
          "new_api": null,
          "old_text": "hlo->operand(1)->shape()",
          "new_text": null,
          "old_line_content": "  const Shape& b_shape = hlo->operand(1)->shape();",
          "new_line_content": "Status HloCostAnalysis::HandleTriangularSolve(const HloInstruction* hlo) {",
          "content_same": false
        },
        {
          "line": 1367,
          "old_api": "ToString",
          "new_api": null,
          "old_text": "index.ToString()",
          "new_text": null,
          "old_line_content": "                      index.ToString());",
          "new_line_content": "std::unique_ptr<HloCostAnalysis> HloCostAnalysis::CreateNestedCostAnalysis() {",
          "content_same": false
        },
        {
          "line": 1372,
          "old_api": "ToString",
          "new_api": null,
          "old_text": "index.ToString()",
          "new_text": null,
          "old_line_content": "  return absl::StrCat(kBytesAccessedKey, \" output \", index.ToString());",
          "new_line_content": "    int64_t operand_num, const ShapeIndex& index) {",
          "content_same": false
        },
        {
          "line": 1376,
          "old_api": "absl::StartsWith(key, kBytesAccessedKey)",
          "new_api": null,
          "old_text": "absl::StartsWith(key, kBytesAccessedKey)",
          "new_text": null,
          "old_line_content": "  return !absl::StartsWith(key, kBytesAccessedKey) &&",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1377,
          "old_api": "absl::StartsWith(key, kUtilizationKey)",
          "new_api": null,
          "old_text": "absl::StartsWith(key, kUtilizationKey)",
          "new_text": null,
          "old_line_content": "         !absl::StartsWith(key, kUtilizationKey);",
          "new_line_content": "/*static*/ std::string HloCostAnalysis::GetOperandUtilizationKey(",
          "content_same": false
        },
        {
          "line": 866,
          "old_api": "operand",
          "new_api": null,
          "old_text": "hlo->operand(0)->shape()",
          "new_text": null,
          "old_line_content": "  float bytes_accessed = GetShapeSize(hlo->operand(0)->shape()) / 2.0f;",
          "new_line_content": "  current_properties_[kBytesAccessedKey] = bytes_accessed;",
          "content_same": false
        },
        {
          "line": 867,
          "old_api": "set_output_bytes_accessed",
          "new_api": null,
          "old_text": "current_properties_.set_output_bytes_accessed(\n      GetShapeSize(hlo->operand(0)->shape()) / 2.0f)",
          "new_text": null,
          "old_line_content": "  current_properties_.set_output_bytes_accessed(",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 870,
          "old_api": "set_operand_bytes_accessed",
          "new_api": null,
          "old_text": "current_properties_.set_operand_bytes_accessed(\n      0, GetShapeSize(hlo->operand(0)->shape()) / 2.0f)",
          "new_text": null,
          "old_line_content": "  current_properties_.set_operand_bytes_accessed(",
          "new_line_content": "  // Estimate as batch * mn^2 / 2 flops.",
          "content_same": false
        },
        {
          "line": 876,
          "old_api": "dimensions_size",
          "new_api": null,
          "old_text": "a_shape.dimensions_size()",
          "new_text": null,
          "old_line_content": "  int64_t elems = a_shape.dimensions(a_shape.dimensions_size() - 1);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 877,
          "old_api": "ShapeUtil::ElementsIn(a_shape)",
          "new_api": null,
          "old_text": "ShapeUtil::ElementsIn(a_shape)",
          "new_text": null,
          "old_line_content": "  elems *= ShapeUtil::ElementsIn(a_shape);",
          "new_line_content": "Status HloCostAnalysis::HandleCholesky(const HloInstruction* hlo) {",
          "content_same": false
        },
        {
          "line": 888,
          "old_api": "OkStatus",
          "new_api": null,
          "old_text": "OkStatus()",
          "new_text": null,
          "old_line_content": "  return OkStatus();",
          "new_line_content": "  // Estimate as batch * n^3 / 3 flops.",
          "content_same": false
        },
        {
          "line": 896,
          "old_api": "OkStatus",
          "new_api": null,
          "old_text": "OkStatus()",
          "new_text": null,
          "old_line_content": "  return OkStatus();",
          "new_line_content": "    const HloInstruction* /*hlo*/) {",
          "content_same": false
        },
        {
          "line": 907,
          "old_api": "IsArray",
          "new_api": null,
          "old_text": "ShapeUtil::ForEachSubshape(\n      crs->shape(), [&](const Shape& subshape, const ShapeIndex&) {\n        if (subshape.IsArray()) {\n          flops += ShapeUtil::ElementsIn(subshape);\n          output_bytes_accessed += GetShapeSize(subshape);\n        }\n      })",
          "new_text": null,
          "old_line_content": "  ShapeUtil::ForEachSubshape(",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 908,
          "old_api": "shape",
          "new_api": null,
          "old_text": "crs->shape()",
          "new_text": null,
          "old_line_content": "      crs->shape(), [&](const Shape& subshape, const ShapeIndex&) {",
          "new_line_content": "Status HloCostAnalysis::HandleAllGatherDone(const HloInstruction* /*hlo*/) {",
          "content_same": false
        },
        {
          "line": 910,
          "old_api": "ShapeUtil::ElementsIn(subshape)",
          "new_api": null,
          "old_text": "ShapeUtil::ElementsIn(subshape)",
          "new_text": null,
          "old_line_content": "          flops += ShapeUtil::ElementsIn(subshape);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 911,
          "old_api": "GetShapeSize",
          "new_api": null,
          "old_text": "GetShapeSize(subshape)",
          "new_text": null,
          "old_line_content": "          output_bytes_accessed += GetShapeSize(subshape);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 915,
          "old_api": "operands",
          "new_api": null,
          "old_text": "crs->operands()",
          "new_text": null,
          "old_line_content": "  for (const HloInstruction* operand : crs->operands()) {",
          "new_line_content": "  //",
          "content_same": false
        },
        {
          "line": 916,
          "old_api": "shape",
          "new_api": null,
          "old_text": "operand->shape()",
          "new_text": null,
          "old_line_content": "    bytes_accessed += GetShapeSize(operand->shape());",
          "new_line_content": "  // TODO(b/33004697): Compute correct cost here, taking the actual number of",
          "content_same": false
        },
        {
          "line": 919,
          "old_api": "set_output_bytes_accessed",
          "new_api": null,
          "old_text": "current_properties_.set_output_bytes_accessed(output_bytes_accessed)",
          "new_text": null,
          "old_line_content": "  current_properties_.set_output_bytes_accessed(output_bytes_accessed);",
          "new_line_content": "  int64_t output_bytes_accessed = 0;",
          "content_same": false
        },
        {
          "line": 925,
          "old_api": "OkStatus",
          "new_api": null,
          "old_text": "OkStatus()",
          "new_text": null,
          "old_line_content": "  return OkStatus();",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 933,
          "old_api": "OkStatus",
          "new_api": null,
          "old_text": "OkStatus()",
          "new_text": null,
          "old_line_content": "  return OkStatus();",
          "new_line_content": "  current_properties_[kBytesAccessedKey] = bytes_accessed;",
          "content_same": false
        },
        {
          "line": 937,
          "old_api": "OkStatus",
          "new_api": null,
          "old_text": "OkStatus()",
          "new_text": null,
          "old_line_content": "  return OkStatus();",
          "new_line_content": "Status HloCostAnalysis::HandleReduceScatter(const HloInstruction* hlo) {",
          "content_same": false
        },
        {
          "line": 941,
          "old_api": "OkStatus",
          "new_api": null,
          "old_text": "OkStatus()",
          "new_text": null,
          "old_line_content": "  return OkStatus();",
          "new_line_content": "Status HloCostAnalysis::HandleAllReduceStart(const HloInstruction* hlo) {",
          "content_same": false
        },
        {
          "line": 951,
          "old_api": "OkStatus",
          "new_api": null,
          "old_text": "OkStatus()",
          "new_text": null,
          "old_line_content": "  return OkStatus();",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 955,
          "old_api": "OkStatus",
          "new_api": null,
          "old_text": "OkStatus()",
          "new_text": null,
          "old_line_content": "  return OkStatus();",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 967,
          "old_api": "shape",
          "new_api": null,
          "old_text": "random->shape()",
          "new_text": null,
          "old_line_content": "      ShapeUtil::ElementsIn(random->shape());",
          "new_line_content": "Status HloCostAnalysis::HandlePartitionId(const HloInstruction* /*hlo*/) {",
          "content_same": false
        },
        {
          "line": 976,
          "old_api": "shape",
          "new_api": null,
          "old_text": "random->shape()",
          "new_text": null,
          "old_line_content": "      ShapeUtil::ElementsInRecursive(random->shape());",
          "new_line_content": "  // TODO(b/26346211): Implement better estimates for the RNG cost, since the",
          "content_same": false
        },
        {
          "line": 977,
          "old_api": "OkStatus",
          "new_api": null,
          "old_text": "OkStatus()",
          "new_text": null,
          "old_line_content": "  return OkStatus();",
          "new_line_content": "  // cost changes with the implementation and the distribution. For now, assume",
          "content_same": false
        },
        {
          "line": 982,
          "old_api": "OkStatus",
          "new_api": null,
          "old_text": "OkStatus()",
          "new_text": null,
          "old_line_content": "  return OkStatus();",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 986,
          "old_api": "ToString",
          "new_api": null,
          "old_text": "fusion->ToString()",
          "new_text": null,
          "old_line_content": "  VLOG(8) << \"Processing fusion \" << fusion->ToString();",
          "new_line_content": "  // cost changes with the implementation and the distribution. For now, assume",
          "content_same": false
        },
        {
          "line": 987,
          "old_api": "fused_expression_root",
          "new_api": null,
          "old_text": "fusion->fused_expression_root()",
          "new_text": null,
          "old_line_content": "  const HloInstruction* root = fusion->fused_expression_root();",
          "new_line_content": "  // the cost of each RNG is same as a transcendental operation.",
          "content_same": false
        },
        {
          "line": 991,
          "old_api": "fused_instructions_computation",
          "new_api": null,
          "old_text": "fusion->fused_instructions_computation()->instructions()",
          "new_text": null,
          "old_line_content": "         fusion->fused_instructions_computation()->instructions()) {",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 992,
          "old_api": "opcode",
          "new_api": null,
          "old_text": "hlo->opcode()",
          "new_text": null,
          "old_line_content": "      if (hlo->opcode() == HloOpcode::kGather) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 993,
          "old_api": "HandleGather",
          "new_api": null,
          "old_text": "HandleGather(hlo)",
          "new_text": null,
          "old_line_content": "        return HandleGather(hlo);",
          "new_line_content": "Status HloCostAnalysis::HandleRngGetAndUpdateState(",
          "content_same": false
        },
        {
          "line": 996,
          "old_api": "HandleScatter",
          "new_api": null,
          "old_text": "HandleScatter(hlo)",
          "new_text": null,
          "old_line_content": "        return HandleScatter(hlo);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 1011,
          "old_api": "IsArray",
          "new_api": null,
          "old_text": "subshape.IsArray()",
          "new_text": null,
          "old_line_content": "        if (!subshape.IsArray()) {",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1014,
          "old_api": "empty",
          "new_api": null,
          "old_text": "shape_index.empty()",
          "new_text": null,
          "old_line_content": "        if (shape_index.empty()) {",
          "new_line_content": "      current_properties_,",
          "content_same": false
        },
        {
          "line": 1016,
          "old_api": "operand",
          "new_api": null,
          "old_text": "root->operand(1)->shape()",
          "new_text": null,
          "old_line_content": "            int64_t size = GetShapeSize(root->operand(1)->shape());",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1018,
          "old_api": "set_output_bytes_accessed",
          "new_api": null,
          "old_text": "current_properties_.set_output_bytes_accessed(shape_index, size)",
          "new_text": null,
          "old_line_content": "            current_properties_.set_output_bytes_accessed(shape_index, size);",
          "new_line_content": "  // Ignore the memory accessed inside fused ops, since fusion is supposed to",
          "content_same": false
        },
        {
          "line": 1019,
          "old_api": "GetOperandUtilizationKey",
          "new_api": null,
          "old_text": "GetOperandUtilizationKey(0)",
          "new_text": null,
          "old_line_content": "            hlo_properties_[root][GetOperandUtilizationKey(0)] = 0;",
          "new_line_content": "  // prevent intermediate data from touching slow memory.",
          "content_same": false
        },
        {
          "line": 1023,
          "old_api": "opcode",
          "new_api": null,
          "old_text": "root->opcode()",
          "new_text": null,
          "old_line_content": "          if (root->opcode() == HloOpcode::kTuple &&",
          "new_line_content": "      [this, root](const Shape& subshape, const ShapeIndex& shape_index) {",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 71,
      "total_additions": 128,
      "total_deletions": 122,
      "total_api_changes": 321
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 13,
        "api_related_lines": 321,
        "non_api_lines": 5,
        "non_api_line_numbers": [
          783,
          785,
          791,
          793,
          794
        ]
      }
    },
    "api_calls_before": 637,
    "api_calls_after": 644,
    "diff_info": {
      "added_lines": 13,
      "removed_lines": 0,
      "total_diff_lines": 25
    }
  }
}