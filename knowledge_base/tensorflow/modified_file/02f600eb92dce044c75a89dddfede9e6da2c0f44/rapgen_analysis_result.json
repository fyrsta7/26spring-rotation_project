{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/tensorflow/modified_file/02f600eb92dce044c75a89dddfede9e6da2c0f44",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/tensorflow/modified_file/02f600eb92dce044c75a89dddfede9e6da2c0f44/before.cc",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/tensorflow/modified_file/02f600eb92dce044c75a89dddfede9e6da2c0f44/after.cc",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/tensorflow/modified_file/02f600eb92dce044c75a89dddfede9e6da2c0f44/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": true,
    "api_changes": {
      "replacements": [
        {
          "line": 207,
          "old_api": "getContext",
          "new_api": "size",
          "old_text": "output_val.getContext()",
          "new_text": "shape.size()",
          "old_line_content": "          mlir::IntegerType::get(32, output_val.getContext())),",
          "new_line_content": "          {static_cast<int>(shape.size())},",
          "content_same": false
        },
        {
          "line": 208,
          "old_api": "llvm::makeArrayRef(shape)",
          "new_api": "getContext",
          "old_text": "llvm::makeArrayRef(shape)",
          "new_text": "output_val.getContext()",
          "old_line_content": "      llvm::makeArrayRef(shape));",
          "new_line_content": "          mlir::IntegerType::get(32, output_val.getContext())),",
          "content_same": false
        },
        {
          "line": 213,
          "old_api": "type.dyn_cast<ShapedType>()",
          "new_api": "getValue",
          "old_text": "type.dyn_cast<ShapedType>()",
          "new_text": "type_attr.getValue()",
          "old_line_content": "  auto shaped_type = type.dyn_cast<ShapedType>();",
          "new_line_content": "  auto type = type_attr.getValue();",
          "content_same": false
        },
        {
          "line": 233,
          "old_api": "failure",
          "new_api": "rhs",
          "old_text": "failure()",
          "new_text": "add_op.rhs()",
          "old_line_content": "    if (!matchPattern(constant_val, m_Constant(&added_value))) return failure();",
          "new_line_content": "    Value constant_val = add_op.rhs();",
          "content_same": false
        },
        {
          "line": 238,
          "old_api": "failure",
          "new_api": "lhs",
          "old_text": "failure()",
          "new_text": "add_op.lhs().getDefiningOp()",
          "old_line_content": "    if (!fc_op) return failure();",
          "new_line_content": "        dyn_cast_or_null<TFL::FullyConnectedOp>(add_op.lhs().getDefiningOp());",
          "content_same": false
        },
        {
          "line": 252,
          "old_api": "failure",
          "new_api": "getRank",
          "old_text": "failure()",
          "new_text": "constant_val_type.getRank()",
          "old_line_content": "      return failure();",
          "new_line_content": "    } else if (constant_val_type.getRank() != 1) {",
          "content_same": false
        },
        {
          "line": 256,
          "old_api": "bias",
          "new_api": "filter",
          "old_text": "fc_op.bias()",
          "new_text": "fc_op.filter()",
          "old_line_content": "    Value bias = fc_op.bias();",
          "new_line_content": "    Value filter = fc_op.filter();",
          "content_same": false
        },
        {
          "line": 259,
          "old_api": "failure",
          "new_api": "getType",
          "old_text": "failure()",
          "new_text": "bias.getType().isa<NoneType>()",
          "old_line_content": "    if (fc_op.fused_activation_function() != \"NONE\") return failure();",
          "new_line_content": "    const bool is_none_bias = bias.getType().isa<NoneType>();",
          "content_same": false
        },
        {
          "line": 262,
          "old_api": "failure",
          "new_api": "m_Constant",
          "old_text": "failure()",
          "new_text": "m_Constant(&bias_value)",
          "old_line_content": "      return failure();",
          "new_line_content": "    if (!is_none_bias && !matchPattern(bias, m_Constant(&bias_value)))",
          "content_same": false
        },
        {
          "line": 275,
          "old_api": "failure",
          "new_api": "getRank",
          "old_text": "failure()",
          "new_text": "filter_type.getRank()",
          "old_line_content": "          return failure();",
          "new_line_content": "        if (filter_type.getRank() != 2) {",
          "content_same": false
        },
        {
          "line": 286,
          "old_api": "getZeroAttr",
          "new_api": "getElementType",
          "old_text": "rewriter.getZeroAttr(type)",
          "new_text": "constant_val_type.getElementType()",
          "old_line_content": "        auto attr = rewriter.getZeroAttr(type);",
          "new_line_content": "            {num_channels}, constant_val_type.getElementType());",
          "content_same": false
        },
        {
          "line": 287,
          "old_api": "getLoc",
          "new_api": "getZeroAttr",
          "old_text": "add_op.getLoc()",
          "new_text": "rewriter.getZeroAttr(type)",
          "old_line_content": "        bias = rewriter.create<ConstantOp>(add_op.getLoc(), type, attr);",
          "new_line_content": "        auto attr = rewriter.getZeroAttr(type);",
          "content_same": false
        },
        {
          "line": 288,
          "old_api": "getStringAttr",
          "new_api": "getLoc",
          "old_text": "rewriter.getStringAttr(\"NONE\")",
          "new_text": "add_op.getLoc()",
          "old_line_content": "        auto none_af = rewriter.getStringAttr(\"NONE\");",
          "new_line_content": "        bias = rewriter.create<ConstantOp>(add_op.getLoc(), type, attr);",
          "content_same": false
        },
        {
          "line": 305,
          "old_api": "getContext",
          "new_api": "getLoc",
          "old_text": "fc_op.getContext()",
          "new_text": "rewriter.create<TFL::FullyConnectedOp>(\n        FusedLoc::get({fc_op.getLoc(), add_op.getLoc()}, fc_op.getContext()),\n        add_op.getType(),\n        /*input=*/fc_op.input(),\n        /*filter=*/filter,\n        /*bias=*/bias,\n        /*fused_activation_function=*/\n        rewriter.getStringAttr(add_op.fused_activation_function()),\n        /*weights_format=*/rewriter.getStringAttr(fc_op.weights_format()),\n        /*keep_num_dims=*/rewriter.getBoolAttr(fc_op.keep_num_dims()))",
          "old_line_content": "        FusedLoc::get({fc_op.getLoc(), add_op.getLoc()}, fc_op.getContext()),",
          "new_line_content": "    auto fc = rewriter.create<TFL::FullyConnectedOp>(",
          "content_same": false
        },
        {
          "line": 306,
          "old_api": "getType",
          "new_api": "getContext",
          "old_text": "add_op.getType()",
          "new_text": "fc_op.getContext()",
          "old_line_content": "        add_op.getType(),",
          "new_line_content": "        FusedLoc::get({fc_op.getLoc(), add_op.getLoc()}, fc_op.getContext()),",
          "content_same": false
        },
        {
          "line": 307,
          "old_api": "input",
          "new_api": "getType",
          "old_text": "fc_op.input()",
          "new_text": "add_op.getType()",
          "old_line_content": "        /*input=*/fc_op.input(),",
          "new_line_content": "        add_op.getType(),",
          "content_same": false
        },
        {
          "line": 312,
          "old_api": "weights_format",
          "new_api": "fused_activation_function",
          "old_text": "fc_op.weights_format()",
          "new_text": "add_op.fused_activation_function()",
          "old_line_content": "        /*weights_format=*/rewriter.getStringAttr(fc_op.weights_format()),",
          "new_line_content": "        rewriter.getStringAttr(add_op.fused_activation_function()),",
          "content_same": false
        },
        {
          "line": 313,
          "old_api": "keep_num_dims",
          "new_api": "weights_format",
          "old_text": "fc_op.keep_num_dims()",
          "new_text": "fc_op.weights_format()",
          "old_line_content": "        /*keep_num_dims=*/rewriter.getBoolAttr(fc_op.keep_num_dims()));",
          "new_line_content": "        /*weights_format=*/rewriter.getStringAttr(fc_op.weights_format()),",
          "content_same": false
        },
        {
          "line": 314,
          "old_api": "output",
          "new_api": "keep_num_dims",
          "old_text": "fc.output()",
          "new_text": "fc_op.keep_num_dims()",
          "old_line_content": "    rewriter.replaceOp(add_op, fc.output());",
          "new_line_content": "        /*keep_num_dims=*/rewriter.getBoolAttr(fc_op.keep_num_dims()));",
          "content_same": false
        },
        {
          "line": 328,
          "old_api": "failure",
          "new_api": "getOperand",
          "old_text": "failure()",
          "new_text": "relu_op.getOperand().getDefiningOp()",
          "old_line_content": "    if (!isa_and_nonnull<FullyConnectedOp>(input)) return failure();",
          "new_line_content": "    Operation *input = relu_op.getOperand().getDefiningOp();",
          "content_same": false
        },
        {
          "line": 329,
          "old_api": "cast<FullyConnectedOp>(input)",
          "new_api": "failure",
          "old_text": "cast<FullyConnectedOp>(input)",
          "new_text": "failure()",
          "old_line_content": "    auto fully_connected_op = cast<FullyConnectedOp>(input);",
          "new_line_content": "    if (!isa_and_nonnull<FullyConnectedOp>(input)) return failure();",
          "content_same": false
        },
        {
          "line": 330,
          "old_api": "fused_activation_function",
          "new_api": "cast<FullyConnectedOp>(input)",
          "old_text": "fully_connected_op.fused_activation_function()",
          "new_text": "cast<FullyConnectedOp>(input)",
          "old_line_content": "    if (fully_connected_op.fused_activation_function() != \"NONE\")",
          "new_line_content": "    auto fully_connected_op = cast<FullyConnectedOp>(input);",
          "content_same": false
        },
        {
          "line": 331,
          "old_api": "failure",
          "new_api": "fused_activation_function",
          "old_text": "failure()",
          "new_text": "fully_connected_op.fused_activation_function()",
          "old_line_content": "      return failure();",
          "new_line_content": "    if (fully_connected_op.fused_activation_function() != \"NONE\")",
          "content_same": false
        },
        {
          "line": 338,
          "old_api": "getLoc",
          "new_api": "keep_num_dims",
          "old_text": "rewriter.create<FullyConnectedOp>(\n        FusedLoc::get({fully_connected_op.getLoc(), relu_op.getLoc()},\n                      relu_op.getContext()),\n        relu_op.getType(), fully_connected_op.input(),\n        fully_connected_op.filter(), fully_connected_op.bias(),\n        new_activation_func, new_weights_format, new_keep_num_dims)",
          "new_text": "fully_connected_op.keep_num_dims()",
          "old_line_content": "    auto fc = rewriter.create<FullyConnectedOp>(",
          "new_line_content": "        rewriter.getBoolAttr(fully_connected_op.keep_num_dims());",
          "content_same": false
        },
        {
          "line": 340,
          "old_api": "getContext",
          "new_api": "getLoc",
          "old_text": "relu_op.getContext()",
          "new_text": "relu_op.getLoc()",
          "old_line_content": "                      relu_op.getContext()),",
          "new_line_content": "        FusedLoc::get({fully_connected_op.getLoc(), relu_op.getLoc()},",
          "content_same": false
        },
        {
          "line": 341,
          "old_api": "input",
          "new_api": "getContext",
          "old_text": "fully_connected_op.input()",
          "new_text": "relu_op.getContext()",
          "old_line_content": "        relu_op.getType(), fully_connected_op.input(),",
          "new_line_content": "                      relu_op.getContext()),",
          "content_same": false
        },
        {
          "line": 342,
          "old_api": "bias",
          "new_api": "input",
          "old_text": "fully_connected_op.bias()",
          "new_text": "fully_connected_op.input()",
          "old_line_content": "        fully_connected_op.filter(), fully_connected_op.bias(),",
          "new_line_content": "        relu_op.getType(), fully_connected_op.input(),",
          "content_same": false
        },
        {
          "line": 360,
          "old_api": "failure",
          "new_api": "rhs",
          "old_text": "failure()",
          "new_text": "mul_op.rhs()",
          "old_line_content": "    if (!matchPattern(constant_val, m_Constant(&cst))) return failure();",
          "new_line_content": "    Value constant_val = mul_op.rhs();",
          "content_same": false
        },
        {
          "line": 365,
          "old_api": "failure",
          "new_api": "lhs",
          "old_text": "failure()",
          "new_text": "mul_op.lhs().getDefiningOp()",
          "old_line_content": "    if (!fc_op) return failure();",
          "new_line_content": "        dyn_cast_or_null<TFL::FullyConnectedOp>(mul_op.lhs().getDefiningOp());",
          "content_same": false
        },
        {
          "line": 366,
          "old_api": "filter",
          "new_api": "failure",
          "old_text": "fc_op.filter()",
          "new_text": "failure()",
          "old_line_content": "    Value filter = fc_op.filter();",
          "new_line_content": "    if (!fc_op) return failure();",
          "content_same": false
        },
        {
          "line": 367,
          "old_api": "bias",
          "new_api": "filter",
          "old_text": "fc_op.bias()",
          "new_text": "fc_op.filter()",
          "old_line_content": "    Value bias = fc_op.bias();",
          "new_line_content": "    Value filter = fc_op.filter();",
          "content_same": false
        },
        {
          "line": 370,
          "old_api": "getType",
          "new_api": "failure",
          "old_text": "bias.getType().isa<NoneType>()",
          "new_text": "failure()",
          "old_line_content": "    if (!bias.getType().isa<NoneType>() &&",
          "new_line_content": "    if (!matchPattern(filter, m_Constant(&cst_tmp))) return failure();",
          "content_same": false
        },
        {
          "line": 371,
          "old_api": "m_Constant",
          "new_api": "getType",
          "old_text": "m_Constant(&cst_tmp)",
          "new_text": "bias.getType().isa<NoneType>()",
          "old_line_content": "        !matchPattern(bias, m_Constant(&cst_tmp)))",
          "new_line_content": "    if (!bias.getType().isa<NoneType>() &&",
          "content_same": false
        },
        {
          "line": 372,
          "old_api": "failure",
          "new_api": "m_Constant",
          "old_text": "failure()",
          "new_text": "m_Constant(&cst_tmp)",
          "old_line_content": "      return failure();",
          "new_line_content": "        !matchPattern(bias, m_Constant(&cst_tmp)))",
          "content_same": false
        },
        {
          "line": 381,
          "old_api": "begin",
          "new_api": "getType",
          "old_text": "original_shape.begin()",
          "new_text": "cst.getType().getShape()",
          "old_line_content": "      llvm::SmallVector<int64_t, 4> normalized_shape(original_shape.begin(),",
          "new_line_content": "      auto original_shape = cst.getType().getShape();",
          "content_same": false
        },
        {
          "line": 382,
          "old_api": "end",
          "new_api": "begin",
          "old_text": "original_shape.end()",
          "new_text": "original_shape.begin()",
          "old_line_content": "                                                     original_shape.end());",
          "new_line_content": "      llvm::SmallVector<int64_t, 4> normalized_shape(original_shape.begin(),",
          "content_same": false
        },
        {
          "line": 383,
          "old_api": "push_back",
          "new_api": "end",
          "old_text": "normalized_shape.push_back(1)",
          "new_text": "original_shape.end()",
          "old_line_content": "      normalized_shape.push_back(1);",
          "new_line_content": "                                                     original_shape.end());",
          "content_same": false
        },
        {
          "line": 384,
          "old_api": "getType",
          "new_api": "push_back",
          "old_text": "RankedTensorType::get(\n          normalized_shape, cst.getType().getElementType())",
          "new_text": "normalized_shape.push_back(1)",
          "old_line_content": "      auto new_cst = cst.reshape(RankedTensorType::get(",
          "new_line_content": "      normalized_shape.push_back(1);",
          "content_same": false
        },
        {
          "line": 388,
          "old_api": "failure",
          "new_api": "getType",
          "old_text": "failure()",
          "new_text": "filter.getType()",
          "old_line_content": "        return failure();",
          "new_line_content": "      if (!IsBroadcastableElementsAttrAndType(new_type, filter.getType())) {",
          "content_same": false
        },
        {
          "line": 392,
          "old_api": "getResult",
          "new_api": "getLoc",
          "old_text": "new_op.getResult()",
          "new_text": "mul_op.getLoc()",
          "old_line_content": "      new_const_val = new_op.getResult();",
          "new_line_content": "          rewriter.create<ConstantOp>(mul_op.getLoc(), new_type, new_cst);",
          "content_same": false
        },
        {
          "line": 407,
          "old_api": "getContext",
          "new_api": "getLoc",
          "old_text": "fc_op.getContext()",
          "new_text": "rewriter.create<TFL::FullyConnectedOp>(\n        FusedLoc::get({fc_op.getLoc(), mul_op.getLoc()}, fc_op.getContext()),\n        mul_op.getType(),\n        /*input=*/fc_op.input(),\n        /*filter=*/new_filter,\n        /*bias=*/bias,\n        /*fused_activation_function=*/\n        rewriter.getStringAttr(mul_op.fused_activation_function()),\n        /*weights_format=*/rewriter.getStringAttr(fc_op.weights_format()),\n        /*keep_num_dims=*/rewriter.getBoolAttr(fc_op.keep_num_dims()))",
          "old_line_content": "        FusedLoc::get({fc_op.getLoc(), mul_op.getLoc()}, fc_op.getContext()),",
          "new_line_content": "    auto fc = rewriter.create<TFL::FullyConnectedOp>(",
          "content_same": false
        },
        {
          "line": 408,
          "old_api": "getType",
          "new_api": "getContext",
          "old_text": "mul_op.getType()",
          "new_text": "fc_op.getContext()",
          "old_line_content": "        mul_op.getType(),",
          "new_line_content": "        FusedLoc::get({fc_op.getLoc(), mul_op.getLoc()}, fc_op.getContext()),",
          "content_same": false
        },
        {
          "line": 409,
          "old_api": "input",
          "new_api": "getType",
          "old_text": "fc_op.input()",
          "new_text": "mul_op.getType()",
          "old_line_content": "        /*input=*/fc_op.input(),",
          "new_line_content": "        mul_op.getType(),",
          "content_same": false
        },
        {
          "line": 414,
          "old_api": "weights_format",
          "new_api": "fused_activation_function",
          "old_text": "fc_op.weights_format()",
          "new_text": "mul_op.fused_activation_function()",
          "old_line_content": "        /*weights_format=*/rewriter.getStringAttr(fc_op.weights_format()),",
          "new_line_content": "        rewriter.getStringAttr(mul_op.fused_activation_function()),",
          "content_same": false
        },
        {
          "line": 415,
          "old_api": "keep_num_dims",
          "new_api": "weights_format",
          "old_text": "fc_op.keep_num_dims()",
          "new_text": "fc_op.weights_format()",
          "old_line_content": "        /*keep_num_dims=*/rewriter.getBoolAttr(fc_op.keep_num_dims()));",
          "new_line_content": "        /*weights_format=*/rewriter.getStringAttr(fc_op.weights_format()),",
          "content_same": false
        },
        {
          "line": 416,
          "old_api": "output",
          "new_api": "keep_num_dims",
          "old_text": "fc.output()",
          "new_text": "fc_op.keep_num_dims()",
          "old_line_content": "    rewriter.replaceOp(mul_op, fc.output());",
          "new_line_content": "        /*keep_num_dims=*/rewriter.getBoolAttr(fc_op.keep_num_dims()));",
          "content_same": false
        },
        {
          "line": 455,
          "old_api": "failure",
          "new_api": "rhs",
          "old_text": "failure()",
          "new_text": "mul_op.rhs()",
          "old_line_content": "    if (!matchPattern(gamma, m_Constant(&gamma_cst))) return failure();",
          "new_line_content": "    Value gamma = mul_op.rhs();",
          "content_same": false
        },
        {
          "line": 460,
          "old_api": "dyn_cast_or_null<AffineOpType>(mul_op_lhs)",
          "new_api": "lhs",
          "old_text": "dyn_cast_or_null<AffineOpType>(mul_op_lhs)",
          "new_text": "mul_op.lhs().getDefiningOp()",
          "old_line_content": "    auto fc_op = dyn_cast_or_null<AffineOpType>(mul_op_lhs);",
          "new_line_content": "    Operation *mul_op_lhs = mul_op.lhs().getDefiningOp();",
          "content_same": false
        },
        {
          "line": 461,
          "old_api": "failure",
          "new_api": "dyn_cast_or_null<AffineOpType>(mul_op_lhs)",
          "old_text": "failure()",
          "new_text": "dyn_cast_or_null<AffineOpType>(mul_op_lhs)",
          "old_line_content": "    if (!fc_op) return failure();",
          "new_line_content": "    auto fc_op = dyn_cast_or_null<AffineOpType>(mul_op_lhs);",
          "content_same": false
        },
        {
          "line": 462,
          "old_api": "filter",
          "new_api": "failure",
          "old_text": "fc_op.filter()",
          "new_text": "failure()",
          "old_line_content": "    Value filter = fc_op.filter();",
          "new_line_content": "    if (!fc_op) return failure();",
          "content_same": false
        },
        {
          "line": 463,
          "old_api": "bias",
          "new_api": "filter",
          "old_text": "fc_op.bias()",
          "new_text": "fc_op.filter()",
          "old_line_content": "    Value bias = fc_op.bias();",
          "new_line_content": "    Value filter = fc_op.filter();",
          "content_same": false
        },
        {
          "line": 467,
          "old_api": "failure",
          "new_api": "getDefiningOp",
          "old_text": "failure()",
          "new_text": "filter.getDefiningOp()",
          "old_line_content": "    if (!dq_op) return failure();",
          "new_line_content": "    auto dq_op = dyn_cast_or_null<TFL::DequantizeOp>(filter.getDefiningOp());",
          "content_same": false
        },
        {
          "line": 470,
          "old_api": "failure",
          "new_api": "input",
          "old_text": "failure()",
          "new_text": "dq_op.input().getDefiningOp()",
          "old_line_content": "    if (!q_op) return failure();",
          "new_line_content": "        dyn_cast_or_null<TFL::QuantizeOp>(dq_op.input().getDefiningOp());",
          "content_same": false
        },
        {
          "line": 471,
          "old_api": "input",
          "new_api": "failure",
          "old_text": "q_op.input()",
          "new_text": "failure()",
          "old_line_content": "    filter = q_op.input();",
          "new_line_content": "    if (!q_op) return failure();",
          "content_same": false
        },
        {
          "line": 476,
          "old_api": "getType",
          "new_api": "failure",
          "old_text": "bias.getType().isa<NoneType>()",
          "new_text": "failure()",
          "old_line_content": "    if (!bias.getType().isa<NoneType>() &&",
          "new_line_content": "    if (!matchPattern(filter, m_Constant(&cst_tmp))) return failure();",
          "content_same": false
        },
        {
          "line": 477,
          "old_api": "m_Constant",
          "new_api": "getType",
          "old_text": "m_Constant(&cst_tmp)",
          "new_text": "bias.getType().isa<NoneType>()",
          "old_line_content": "        !matchPattern(bias, m_Constant(&cst_tmp)))",
          "new_line_content": "    if (!bias.getType().isa<NoneType>() &&",
          "content_same": false
        },
        {
          "line": 478,
          "old_api": "failure",
          "new_api": "m_Constant",
          "old_text": "failure()",
          "new_text": "m_Constant(&cst_tmp)",
          "old_line_content": "      return failure();",
          "new_line_content": "        !matchPattern(bias, m_Constant(&cst_tmp)))",
          "content_same": false
        },
        {
          "line": 485,
          "old_api": "getLoc",
          "new_api": "setInsertionPoint",
          "old_text": "fc_op.getLoc()",
          "new_text": "rewriter.setInsertionPoint(q_op)",
          "old_line_content": "    Location loc = fc_op.getLoc();",
          "new_line_content": "    rewriter.setInsertionPoint(q_op);",
          "content_same": false
        },
        {
          "line": 488,
          "old_api": "ExpandTo4DForConv",
          "new_api": "isa<TFL::Conv2DOp>(mul_op_lhs)",
          "old_text": "ExpandTo4DForConv(gamma_cst)",
          "new_text": "isa<TFL::Conv2DOp>(mul_op_lhs)",
          "old_line_content": "      auto mul_rhs = ExpandTo4DForConv(gamma_cst);",
          "new_line_content": "    if (isa<TFL::Conv2DOp>(mul_op_lhs)) {",
          "content_same": false
        },
        {
          "line": 489,
          "old_api": "rewriter.create<ConstOp>(loc, mul_rhs)",
          "new_api": "ExpandTo4DForConv",
          "old_text": "rewriter.create<ConstOp>(loc, mul_rhs)",
          "new_text": "ExpandTo4DForConv(gamma_cst)",
          "old_line_content": "      broadcasted_gamma = rewriter.create<ConstOp>(loc, mul_rhs);",
          "new_line_content": "      auto mul_rhs = ExpandTo4DForConv(gamma_cst);",
          "content_same": false
        },
        {
          "line": 490,
          "old_api": "isa<TFL::DepthwiseConv2DOp>(mul_op_lhs)",
          "new_api": "rewriter.create<ConstOp>(loc, mul_rhs)",
          "old_text": "isa<TFL::DepthwiseConv2DOp>(mul_op_lhs)",
          "new_text": "rewriter.create<ConstOp>(loc, mul_rhs)",
          "old_line_content": "    } else if (isa<TFL::DepthwiseConv2DOp>(mul_op_lhs)) {",
          "new_line_content": "      broadcasted_gamma = rewriter.create<ConstOp>(loc, mul_rhs);",
          "content_same": false
        },
        {
          "line": 491,
          "old_api": "ExpandTo4DForDepthwiseConv",
          "new_api": "isa<TFL::DepthwiseConv2DOp>(mul_op_lhs)",
          "old_text": "ExpandTo4DForDepthwiseConv(gamma_cst)",
          "new_text": "isa<TFL::DepthwiseConv2DOp>(mul_op_lhs)",
          "old_line_content": "      auto mul_rhs = ExpandTo4DForDepthwiseConv(gamma_cst);",
          "new_line_content": "    } else if (isa<TFL::DepthwiseConv2DOp>(mul_op_lhs)) {",
          "content_same": false
        },
        {
          "line": 492,
          "old_api": "rewriter.create<ConstOp>(loc, mul_rhs)",
          "new_api": "ExpandTo4DForDepthwiseConv",
          "old_text": "rewriter.create<ConstOp>(loc, mul_rhs)",
          "new_text": "ExpandTo4DForDepthwiseConv(gamma_cst)",
          "old_line_content": "      broadcasted_gamma = rewriter.create<ConstOp>(loc, mul_rhs);",
          "new_line_content": "      auto mul_rhs = ExpandTo4DForDepthwiseConv(gamma_cst);",
          "content_same": false
        },
        {
          "line": 503,
          "old_api": "failure",
          "new_api": "qtype",
          "old_text": "failure()",
          "new_text": "q_op.qtype()",
          "old_line_content": "    if (!new_qtype) return failure();",
          "new_line_content": "    auto new_qtype = RescaleQtype(q_op.qtype(), gamma_cst);",
          "content_same": false
        },
        {
          "line": 504,
          "old_api": "getValue",
          "new_api": "failure",
          "old_text": "new_qtype.getValue()",
          "new_text": "failure()",
          "old_line_content": "    rewriter.replaceOpWithNewOp<TFL::QuantizeOp>(q_op, new_qtype.getValue(),",
          "new_line_content": "    if (!new_qtype) return failure();",
          "content_same": false
        },
        {
          "line": 509,
          "old_api": "setInsertionPoint",
          "new_api": "getType",
          "old_text": "rewriter.setInsertionPoint(fc_op)",
          "new_text": "bias.getType().isa<NoneType>()",
          "old_line_content": "      rewriter.setInsertionPoint(fc_op);",
          "new_line_content": "    if (!bias.getType().isa<NoneType>()) {",
          "content_same": false
        },
        {
          "line": 510,
          "old_api": "rewriter.create<TF::MulOp>(loc, bias, gamma)",
          "new_api": "setInsertionPoint",
          "old_text": "rewriter.create<TF::MulOp>(loc, bias, gamma)",
          "new_text": "rewriter.setInsertionPoint(fc_op)",
          "old_line_content": "      auto new_bias = rewriter.create<TF::MulOp>(loc, bias, gamma);",
          "new_line_content": "      rewriter.setInsertionPoint(fc_op);",
          "content_same": false
        },
        {
          "line": 511,
          "old_api": "getOperation",
          "new_api": "rewriter.create<TF::MulOp>(loc, bias, gamma)",
          "old_text": "fc_op.getOperation()->replaceUsesOfWith(bias, new_bias)",
          "new_text": "rewriter.create<TF::MulOp>(loc, bias, gamma)",
          "old_line_content": "      fc_op.getOperation()->replaceUsesOfWith(bias, new_bias);",
          "new_line_content": "      auto new_bias = rewriter.create<TF::MulOp>(loc, bias, gamma);",
          "content_same": false
        },
        {
          "line": 516,
          "old_api": "success",
          "new_api": "getResult",
          "old_text": "success()",
          "new_text": "fc_op.getResult()",
          "old_line_content": "    return success();",
          "new_line_content": "    mul_op.replaceAllUsesWith(fc_op.getResult());",
          "content_same": false
        },
        {
          "line": 533,
          "old_api": "failure",
          "new_api": "input",
          "old_text": "failure()",
          "new_text": "fc_op.input().getDefiningOp()",
          "old_line_content": "    if (!binary_op || binary_op->getNumOperands() != 2) return failure();",
          "new_line_content": "    Operation *binary_op = fc_op.input().getDefiningOp();",
          "content_same": false
        },
        {
          "line": 540,
          "old_api": "failure",
          "new_api": "m_Constant",
          "old_text": "failure()",
          "new_text": "m_Constant(&cst)",
          "old_line_content": "      return failure();",
          "new_line_content": "    if (!matchPattern(binary_op->getOperand(1), m_Constant(&cst)))",
          "content_same": false
        },
        {
          "line": 542,
          "old_api": "float_value_begin",
          "new_api": "failure",
          "old_text": "cst.float_value_begin()",
          "new_text": "failure()",
          "old_line_content": "    APFloat cst_value = *cst.float_value_begin();",
          "new_line_content": "    if (cst.getNumElements() != 1) return failure();",
          "content_same": false
        },
        {
          "line": 546,
          "old_api": "bias",
          "new_api": "filter",
          "old_text": "fc_op.bias()",
          "new_text": "fc_op.filter()",
          "old_line_content": "    Value bias = fc_op.bias();",
          "new_line_content": "    Value filter = fc_op.filter();",
          "content_same": false
        },
        {
          "line": 551,
          "old_api": "failure",
          "new_api": "getDefiningOp",
          "old_text": "failure()",
          "new_text": "filter.getDefiningOp()",
          "old_line_content": "      if (!dq) return failure();",
          "new_line_content": "      auto dq = llvm::dyn_cast_or_null<DequantizeOp>(filter.getDefiningOp());",
          "content_same": false
        },
        {
          "line": 552,
          "old_api": "input",
          "new_api": "failure",
          "old_text": "dq.input().getDefiningOp()",
          "new_text": "failure()",
          "old_line_content": "      auto q = llvm::dyn_cast_or_null<QuantizeOp>(dq.input().getDefiningOp());",
          "new_line_content": "      if (!dq) return failure();",
          "content_same": false
        },
        {
          "line": 553,
          "old_api": "m_Constant",
          "new_api": "input",
          "old_text": "m_Constant(&filter_cst)",
          "new_text": "dq.input().getDefiningOp()",
          "old_line_content": "      if (!q || !matchPattern(q.input(), m_Constant(&filter_cst))) {",
          "new_line_content": "      auto q = llvm::dyn_cast_or_null<QuantizeOp>(dq.input().getDefiningOp());",
          "content_same": false
        },
        {
          "line": 554,
          "old_api": "failure",
          "new_api": "m_Constant",
          "old_text": "failure()",
          "new_text": "m_Constant(&filter_cst)",
          "old_line_content": "        return failure();",
          "new_line_content": "      if (!q || !matchPattern(q.input(), m_Constant(&filter_cst))) {",
          "content_same": false
        },
        {
          "line": 559,
          "old_api": "m_Constant",
          "new_api": "getType",
          "old_text": "m_Constant(&bias_cst)",
          "new_text": "bias.getType().isa<NoneType>()",
          "old_line_content": "        !matchPattern(bias, m_Constant(&bias_cst)))",
          "new_line_content": "    if (!bias.getType().isa<NoneType>() &&",
          "content_same": false
        },
        {
          "line": 560,
          "old_api": "failure",
          "new_api": "m_Constant",
          "old_text": "failure()",
          "new_text": "m_Constant(&bias_cst)",
          "old_line_content": "      return failure();",
          "new_line_content": "        !matchPattern(bias, m_Constant(&bias_cst)))",
          "content_same": false
        },
        {
          "line": 561,
          "old_api": "getType",
          "new_api": "failure",
          "old_text": "filter_cst.getType()",
          "new_text": "failure()",
          "old_line_content": "    ShapedType filter_type = filter_cst.getType();",
          "new_line_content": "      return failure();",
          "content_same": false
        },
        {
          "line": 564,
          "old_api": "fc_op.template getAttrOfType<StringAttr>(\"padding\")",
          "new_api": "llvm::isa<AddOp, SubOp>(binary_op)",
          "old_text": "fc_op.template getAttrOfType<StringAttr>(\"padding\")",
          "new_text": "llvm::isa<AddOp, SubOp>(binary_op)",
          "old_line_content": "      auto padding = fc_op.template getAttrOfType<StringAttr>(\"padding\");",
          "new_line_content": "    if (llvm::isa<AddOp, SubOp>(binary_op)) {",
          "content_same": false
        },
        {
          "line": 565,
          "old_api": "failure",
          "new_api": "fc_op.template getAttrOfType<StringAttr>(\"padding\")",
          "old_text": "failure()",
          "new_text": "fc_op.template getAttrOfType<StringAttr>(\"padding\")",
          "old_line_content": "      if (padding && padding.getValue() != \"VALID\") return failure();",
          "new_line_content": "      auto padding = fc_op.template getAttrOfType<StringAttr>(\"padding\");",
          "content_same": false
        },
        {
          "line": 584,
          "old_api": "APFloat",
          "new_api": "getType",
          "old_text": "APFloat(0.0)",
          "new_text": "bias.getType().isa<NoneType>()",
          "old_line_content": "        new_bias_values.resize(bias_size, APFloat(0.0));",
          "new_line_content": "      if (bias.getType().isa<NoneType>()) {  // none bias, a list of zeros",
          "content_same": false
        },
        {
          "line": 585,
          "old_api": "getNumElements",
          "new_api": "APFloat",
          "old_text": "bias_cst.getNumElements()",
          "new_text": "APFloat(0.0)",
          "old_line_content": "      } else if (bias_cst.getNumElements() == 1) {  // scalar bias, broadcast it",
          "new_line_content": "        new_bias_values.resize(bias_size, APFloat(0.0));",
          "content_same": false
        },
        {
          "line": 586,
          "old_api": "float_value_begin",
          "new_api": "getNumElements",
          "old_text": "bias_cst.float_value_begin()",
          "new_text": "bias_cst.getNumElements()",
          "old_line_content": "        new_bias_values.resize(bias_size, *bias_cst.float_value_begin());",
          "new_line_content": "      } else if (bias_cst.getNumElements() == 1) {  // scalar bias, broadcast it",
          "content_same": false
        },
        {
          "line": 587,
          "old_api": "getNumElements",
          "new_api": "float_value_begin",
          "old_text": "bias_cst.getNumElements()",
          "new_text": "bias_cst.float_value_begin()",
          "old_line_content": "      } else if (bias_cst.getNumElements() == bias_size) {  // 1-d bias, copy it",
          "new_line_content": "        new_bias_values.resize(bias_size, *bias_cst.float_value_begin());",
          "content_same": false
        },
        {
          "line": 588,
          "old_api": "begin",
          "new_api": "getNumElements",
          "old_text": "new_bias_values.begin()",
          "new_text": "bias_cst.getNumElements()",
          "old_line_content": "        new_bias_values.insert(new_bias_values.begin(),",
          "new_line_content": "      } else if (bias_cst.getNumElements() == bias_size) {  // 1-d bias, copy it",
          "content_same": false
        },
        {
          "line": 589,
          "old_api": "float_value_begin",
          "new_api": "begin",
          "old_text": "bias_cst.float_value_begin()",
          "new_text": "new_bias_values.begin()",
          "old_line_content": "                               bias_cst.float_value_begin(),",
          "new_line_content": "        new_bias_values.insert(new_bias_values.begin(),",
          "content_same": false
        },
        {
          "line": 590,
          "old_api": "float_value_end",
          "new_api": "float_value_begin",
          "old_text": "bias_cst.float_value_end()",
          "new_text": "bias_cst.float_value_begin()",
          "old_line_content": "                               bias_cst.float_value_end());",
          "new_line_content": "                               bias_cst.float_value_begin(),",
          "content_same": false
        },
        {
          "line": 597,
          "old_api": "float_value_end",
          "new_api": "float_value_begin",
          "old_text": "filter_cst.float_value_end()",
          "new_text": "filter_cst.float_value_begin()",
          "old_line_content": "                fp_end = filter_cst.float_value_end();",
          "new_line_content": "      for (auto fp_it = filter_cst.float_value_begin(),",
          "content_same": false
        },
        {
          "line": 607,
          "old_api": "getOperand",
          "new_api": "getLoc",
          "old_text": "binary_op->getOperand(0)",
          "new_text": "fc_op.getLoc()",
          "old_line_content": "      fc_op.setOperand(0, binary_op->getOperand(0));",
          "new_line_content": "          rewriter.create<ConstOp>(fc_op.getLoc(), new_bias_type, new_bias);",
          "content_same": false
        },
        {
          "line": 608,
          "old_api": "setOperand",
          "new_api": "getOperand",
          "old_text": "fc_op.setOperand(2, new_bias_op)",
          "new_text": "binary_op->getOperand(0)",
          "old_line_content": "      fc_op.setOperand(2, new_bias_op);",
          "new_line_content": "      fc_op.setOperand(0, binary_op->getOperand(0));",
          "content_same": false
        },
        {
          "line": 609,
          "old_api": "llvm::isa<MulOp, DivOp>(binary_op)",
          "new_api": "setOperand",
          "old_text": "llvm::isa<MulOp, DivOp>(binary_op)",
          "new_text": "fc_op.setOperand(2, new_bias_op)",
          "old_line_content": "    } else if (llvm::isa<MulOp, DivOp>(binary_op)) {",
          "new_line_content": "      fc_op.setOperand(2, new_bias_op);",
          "content_same": false
        },
        {
          "line": 617,
          "old_api": "bitcastToAPInt",
          "new_api": "getElementType",
          "old_text": "is_mul ? it * cst_value : it / cst_value).bitcastToAPInt()",
          "new_text": "filter_type.getElementType()",
          "old_line_content": "            return (is_mul ? it * cst_value : it / cst_value).bitcastToAPInt();",
          "new_line_content": "          filter_cst.mapValues(filter_type.getElementType(), [&](APFloat it) {",
          "content_same": false
        },
        {
          "line": 622,
          "old_api": "getType",
          "new_api": "getLoc",
          "old_text": "filter.getType()",
          "new_text": "rewriter.create<ConstOp>(\n          fc_op.getLoc(), filter.getType(), new_filter)",
          "old_line_content": "          fc_op.getLoc(), filter.getType(), new_filter);",
          "new_line_content": "      auto new_filter_op = rewriter.create<ConstOp>(",
          "content_same": false
        },
        {
          "line": 623,
          "old_api": "getOperand",
          "new_api": "getType",
          "old_text": "binary_op->getOperand(0)",
          "new_text": "filter.getType()",
          "old_line_content": "      fc_op.setOperand(0, binary_op->getOperand(0));",
          "new_line_content": "          fc_op.getLoc(), filter.getType(), new_filter);",
          "content_same": false
        },
        {
          "line": 624,
          "old_api": "filter",
          "new_api": "getOperand",
          "old_text": "fc_op.filter()",
          "new_text": "binary_op->getOperand(0)",
          "old_line_content": "      if (fc_op.filter() != filter) {",
          "new_line_content": "      fc_op.setOperand(0, binary_op->getOperand(0));",
          "content_same": false
        },
        {
          "line": 649,
          "old_api": "GetChannelDimIndex",
          "new_api": "begin",
          "old_text": "op.GetChannelDimIndex()",
          "new_text": "filter_shape.begin()",
          "old_line_content": "    std::advance(channel_index_iter, op.GetChannelDimIndex());",
          "new_line_content": "    auto channel_index_iter = filter_shape.begin();",
          "content_same": false
        },
        {
          "line": 653,
          "old_api": "std::multiplies<int64_t>()",
          "new_api": "end",
          "old_text": "std::multiplies<int64_t>()",
          "new_text": "filter_shape.end()",
          "old_line_content": "                        std::multiplies<int64_t>());",
          "new_line_content": "        std::accumulate(std::next(channel_index_iter), filter_shape.end(), 1,",
          "content_same": false
        },
        {
          "line": 665,
          "old_api": "output",
          "new_api": "input",
          "old_text": "transpose_op.output().getType().cast<ShapedType>()",
          "new_text": "transpose_op.input().getType().cast<ShapedType>()",
          "old_line_content": "    auto output_type = transpose_op.output().getType().cast<ShapedType>();",
          "new_line_content": "    auto input_type = transpose_op.input().getType().cast<ShapedType>();",
          "content_same": false
        },
        {
          "line": 669,
          "old_api": "failure",
          "new_api": "hasStaticShape",
          "old_text": "failure()",
          "new_text": "output_type.hasStaticShape()",
          "old_line_content": "      return failure();",
          "new_line_content": "    if (!input_type.hasStaticShape() || !output_type.hasStaticShape())",
          "content_same": false
        },
        {
          "line": 670,
          "old_api": "perm",
          "new_api": "failure",
          "old_text": "transpose_op.perm()",
          "new_text": "failure()",
          "old_line_content": "    Value perm = transpose_op.perm();",
          "new_line_content": "      return failure();",
          "content_same": false
        },
        {
          "line": 677,
          "old_api": "getSExtValue",
          "new_api": "getIntValues",
          "old_text": "dim.getSExtValue()",
          "new_text": "perm_values_attr.getIntValues()",
          "old_line_content": "      perm_values.push_back(dim.getSExtValue());",
          "new_line_content": "    for (const auto &dim : perm_values_attr.getIntValues())",
          "content_same": false
        },
        {
          "line": 681,
          "old_api": "emitError",
          "new_api": "size",
          "old_text": "transpose_op.emitError(\n          \"TransposeOP has inconsistent input and perm values.\")",
          "new_text": "perm_values.size()",
          "old_line_content": "      transpose_op.emitError(",
          "new_line_content": "    if (input_shape.size() != perm_values.size()) {",
          "content_same": false
        },
        {
          "line": 705,
          "old_api": "push_back",
          "new_api": "getShape",
          "old_text": "output_shape_values.push_back(dim)",
          "new_text": "output_type.getShape()",
          "old_line_content": "      output_shape_values.push_back(dim);",
          "new_line_content": "    for (auto dim : output_type.getShape()) {",
          "content_same": false
        },
        {
          "line": 708,
          "old_api": "getIntegerType",
          "new_api": "size",
          "old_text": "rewriter.getIntegerType(32)",
          "new_text": "output_shape_values.size()",
          "old_line_content": "                                            rewriter.getIntegerType(32));",
          "new_line_content": "    auto type = mlir::RankedTensorType::get(output_shape_values.size(),",
          "content_same": false
        },
        {
          "line": 711,
          "old_api": "rewriter.create<TF::ConstOp>(loc, new_shape_attr)",
          "new_api": "mlir::DenseIntElementsAttr::get(type, output_shape_values)",
          "old_text": "rewriter.create<TF::ConstOp>(loc, new_shape_attr)",
          "new_text": "mlir::DenseIntElementsAttr::get(type, output_shape_values)",
          "old_line_content": "    auto new_shape = rewriter.create<TF::ConstOp>(loc, new_shape_attr);",
          "new_line_content": "        mlir::DenseIntElementsAttr::get(type, output_shape_values);",
          "content_same": false
        },
        {
          "line": 714,
          "old_api": "input",
          "new_api": "output",
          "old_text": "transpose_op.input()",
          "new_text": "rewriter.replaceOpWithNewOp<TFL::ReshapeOp>(\n        transpose_op, transpose_op.output().getType(), transpose_op.input(),\n        new_shape)",
          "old_line_content": "        transpose_op, transpose_op.output().getType(), transpose_op.input(),",
          "new_line_content": "    rewriter.replaceOpWithNewOp<TFL::ReshapeOp>(",
          "content_same": false
        },
        {
          "line": 730,
          "old_api": "getFunction",
          "new_api": "getContext",
          "old_text": "getFunction()",
          "new_text": "getContext()",
          "old_line_content": "  auto func = getFunction();",
          "new_line_content": "  auto *ctx = &getContext();",
          "content_same": false
        },
        {
          "line": 736,
          "old_api": "patterns.insert<FuseFullyConnectedAndAdd,\n                  FuseFullyConnectedAndReluX<TFL::ReluOp, kRelu>,\n                  FuseFullyConnectedAndReluX<TFL::Relu6Op, kRelu6>,\n                  FuseFullyConnectedAndReluX<TFL::Relu1Op, kRelu1>,\n                  FuseFullyConnectedAndMul>(ctx)",
          "new_api": "TFL::populateWithGenerated(ctx, &patterns)",
          "old_text": "patterns.insert<FuseFullyConnectedAndAdd,\n                  FuseFullyConnectedAndReluX<TFL::ReluOp, kRelu>,\n                  FuseFullyConnectedAndReluX<TFL::Relu6Op, kRelu6>,\n                  FuseFullyConnectedAndReluX<TFL::Relu1Op, kRelu1>,\n                  FuseFullyConnectedAndMul>(ctx)",
          "new_text": "TFL::populateWithGenerated(ctx, &patterns)",
          "old_line_content": "  patterns.insert<FuseFullyConnectedAndAdd,",
          "new_line_content": "  TFL::populateWithGenerated(ctx, &patterns);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 512,
          "old_api": null,
          "new_api": "getOperation",
          "old_text": null,
          "new_text": "fc_op.getOperation()->replaceUsesOfWith(bias, new_bias)",
          "old_line_content": "    }",
          "new_line_content": "      fc_op.getOperation()->replaceUsesOfWith(bias, new_bias);",
          "content_same": false
        },
        {
          "line": 517,
          "old_api": null,
          "new_api": "success",
          "old_text": null,
          "new_text": "success()",
          "old_line_content": "  }",
          "new_line_content": "    return success();",
          "content_same": false
        },
        {
          "line": 534,
          "old_api": null,
          "new_api": "failure",
          "old_text": null,
          "new_text": "failure()",
          "old_line_content": "    // We only handle the cases the RHS is a scalar.",
          "new_line_content": "    if (!binary_op || binary_op->getNumOperands() != 2) return failure();",
          "content_same": false
        },
        {
          "line": 543,
          "old_api": null,
          "new_api": "float_value_begin",
          "old_text": null,
          "new_text": "cst.float_value_begin()",
          "old_line_content": "",
          "new_line_content": "    APFloat cst_value = *cst.float_value_begin();",
          "content_same": false
        },
        {
          "line": 547,
          "old_api": null,
          "new_api": "bias",
          "old_text": null,
          "new_text": "fc_op.bias()",
          "old_line_content": "    DenseFPElementsAttr filter_cst, bias_cst;",
          "new_line_content": "    Value bias = fc_op.bias();",
          "content_same": false
        },
        {
          "line": 549,
          "old_api": null,
          "new_api": "m_Constant",
          "old_text": null,
          "new_text": "m_Constant(&filter_cst)",
          "old_line_content": "      // The filter maybe quantized, then we should set it to the real constant.",
          "new_line_content": "    if (!matchPattern(filter, m_Constant(&filter_cst))) {",
          "content_same": false
        },
        {
          "line": 555,
          "old_api": null,
          "new_api": "failure",
          "old_text": null,
          "new_text": "failure()",
          "old_line_content": "      }",
          "new_line_content": "        return failure();",
          "content_same": false
        },
        {
          "line": 557,
          "old_api": null,
          "new_api": "input",
          "old_text": null,
          "new_text": "q.input()",
          "old_line_content": "    }",
          "new_line_content": "      filter = q.input();",
          "content_same": false
        },
        {
          "line": 562,
          "old_api": null,
          "new_api": "getType",
          "old_text": null,
          "new_text": "filter_cst.getType()",
          "old_line_content": "",
          "new_line_content": "    ShapedType filter_type = filter_cst.getType();",
          "content_same": false
        },
        {
          "line": 566,
          "old_api": null,
          "new_api": "failure",
          "old_text": null,
          "new_text": "failure()",
          "old_line_content": "",
          "new_line_content": "      if (padding && padding.getValue() != \"VALID\") return failure();",
          "content_same": false
        },
        {
          "line": 572,
          "old_api": null,
          "new_api": "changeSign",
          "old_text": null,
          "new_text": "cst_value.changeSign()",
          "old_line_content": "",
          "new_line_content": "      if (llvm::isa<SubOp>(binary_op)) cst_value.changeSign();",
          "content_same": false
        },
        {
          "line": 575,
          "old_api": null,
          "new_api": "getShape",
          "old_text": null,
          "new_text": "filter_type.getShape()",
          "old_line_content": "      int64_t bias_size = bias_and_slice.first;",
          "new_line_content": "          GetBiasDimAndSliceSize(filter_type.getShape(), fc_op);",
          "content_same": false
        },
        {
          "line": 579,
          "old_api": null,
          "new_api": "getElementType",
          "old_text": null,
          "new_text": "filter_type.getElementType()",
          "old_line_content": "",
          "new_line_content": "          RankedTensorType::get({bias_size}, filter_type.getElementType());",
          "content_same": false
        },
        {
          "line": 591,
          "old_api": null,
          "new_api": "float_value_end",
          "old_text": null,
          "new_text": "bias_cst.float_value_end()",
          "old_line_content": "      } else {",
          "new_line_content": "                               bias_cst.float_value_end());",
          "content_same": false
        },
        {
          "line": 593,
          "old_api": null,
          "new_api": "failure",
          "old_text": null,
          "new_text": "failure()",
          "old_line_content": "      }",
          "new_line_content": "        return failure();",
          "content_same": false
        },
        {
          "line": 598,
          "old_api": null,
          "new_api": "float_value_end",
          "old_text": null,
          "new_text": "filter_cst.float_value_end()",
          "old_line_content": "           fp_it != fp_end; ++fp_it) {",
          "new_line_content": "                fp_end = filter_cst.float_value_end();",
          "content_same": false
        },
        {
          "line": 605,
          "old_api": null,
          "new_api": "DenseFPElementsAttr::get(new_bias_type, new_bias_values)",
          "old_text": null,
          "new_text": "DenseFPElementsAttr::get(new_bias_type, new_bias_values)",
          "old_line_content": "      auto new_bias_op =",
          "new_line_content": "      auto new_bias = DenseFPElementsAttr::get(new_bias_type, new_bias_values);",
          "content_same": false
        },
        {
          "line": 610,
          "old_api": null,
          "new_api": "llvm::isa<MulOp, DivOp>(binary_op)",
          "old_text": null,
          "new_text": "llvm::isa<MulOp, DivOp>(binary_op)",
          "old_line_content": "      // The fusion of mul/div is actually applying the following",
          "new_line_content": "    } else if (llvm::isa<MulOp, DivOp>(binary_op)) {",
          "content_same": false
        },
        {
          "line": 615,
          "old_api": null,
          "new_api": "llvm::isa<MulOp>(binary_op)",
          "old_text": null,
          "new_text": "llvm::isa<MulOp>(binary_op)",
          "old_line_content": "      auto new_filter =",
          "new_line_content": "      bool is_mul = llvm::isa<MulOp>(binary_op);",
          "content_same": false
        },
        {
          "line": 618,
          "old_api": null,
          "new_api": "bitcastToAPInt",
          "old_text": null,
          "new_text": "is_mul ? it * cst_value : it / cst_value).bitcastToAPInt()",
          "old_line_content": "          });",
          "new_line_content": "            return (is_mul ? it * cst_value : it / cst_value).bitcastToAPInt();",
          "content_same": false
        },
        {
          "line": 625,
          "old_api": null,
          "new_api": "filter",
          "old_text": null,
          "new_text": "fc_op.filter()",
          "old_line_content": "        // This filter goes through quantize and dequantize ops. Then we just",
          "new_line_content": "      if (fc_op.filter() != filter) {",
          "content_same": false
        },
        {
          "line": 628,
          "old_api": null,
          "new_api": "replaceAllUsesWith",
          "old_text": null,
          "new_text": "filter.replaceAllUsesWith(new_filter_op)",
          "old_line_content": "      } else {",
          "new_line_content": "        filter.replaceAllUsesWith(new_filter_op);",
          "content_same": false
        },
        {
          "line": 632,
          "old_api": null,
          "new_api": "setOperand",
          "old_text": null,
          "new_text": "fc_op.setOperand(1, new_filter_op)",
          "old_line_content": "      }",
          "new_line_content": "        fc_op.setOperand(1, new_filter_op);",
          "content_same": false
        },
        {
          "line": 635,
          "old_api": null,
          "new_api": "failure",
          "old_text": null,
          "new_text": "failure()",
          "old_line_content": "    }",
          "new_line_content": "      return failure();",
          "content_same": false
        },
        {
          "line": 637,
          "old_api": null,
          "new_api": "success",
          "old_text": null,
          "new_text": "success()",
          "old_line_content": "  }",
          "new_line_content": "    return success();",
          "content_same": false
        },
        {
          "line": 650,
          "old_api": null,
          "new_api": "GetChannelDimIndex",
          "old_text": null,
          "new_text": "op.GetChannelDimIndex()",
          "old_line_content": "    // The slide size is the size of the data in higher dimensions.",
          "new_line_content": "    std::advance(channel_index_iter, op.GetChannelDimIndex());",
          "content_same": false
        },
        {
          "line": 654,
          "old_api": null,
          "new_api": "std::multiplies<int64_t>()",
          "old_text": null,
          "new_text": "std::multiplies<int64_t>()",
          "old_line_content": "    return {*channel_index_iter, slice_size};",
          "new_line_content": "                        std::multiplies<int64_t>());",
          "content_same": false
        },
        {
          "line": 666,
          "old_api": null,
          "new_api": "output",
          "old_text": null,
          "new_text": "transpose_op.output().getType().cast<ShapedType>()",
          "old_line_content": "    // It's possible to know if the transformation is safe only if the input",
          "new_line_content": "    auto output_type = transpose_op.output().getType().cast<ShapedType>();",
          "content_same": false
        },
        {
          "line": 671,
          "old_api": null,
          "new_api": "perm",
          "old_text": null,
          "new_text": "transpose_op.perm()",
          "old_line_content": "    DenseElementsAttr perm_values_attr;",
          "new_line_content": "    Value perm = transpose_op.perm();",
          "content_same": false
        },
        {
          "line": 673,
          "old_api": null,
          "new_api": "failure",
          "old_text": null,
          "new_text": "failure()",
          "old_line_content": "",
          "new_line_content": "    if (!matchPattern(perm, m_Constant(&perm_values_attr))) return failure();",
          "content_same": false
        },
        {
          "line": 675,
          "old_api": null,
          "new_api": "getShape",
          "old_text": null,
          "new_text": "input_type.getShape()",
          "old_line_content": "    SmallVector<int64_t, 8> perm_values;",
          "new_line_content": "    auto input_shape = input_type.getShape();",
          "content_same": false
        },
        {
          "line": 678,
          "old_api": null,
          "new_api": "getSExtValue",
          "old_text": null,
          "new_text": "dim.getSExtValue()",
          "old_line_content": "",
          "new_line_content": "      perm_values.push_back(dim.getSExtValue());",
          "content_same": false
        },
        {
          "line": 682,
          "old_api": null,
          "new_api": "emitError",
          "old_text": null,
          "new_text": "transpose_op.emitError(\n          \"TransposeOP has inconsistent input and perm values.\")",
          "old_line_content": "          \"TransposeOP has inconsistent input and perm values.\");",
          "new_line_content": "      transpose_op.emitError(",
          "content_same": false
        },
        {
          "line": 688,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "input_shape.size()",
          "old_line_content": "      if (input_shape[i] != 1) {",
          "new_line_content": "    for (int i = 0, end = input_shape.size(); i < end; i++) {",
          "content_same": false
        },
        {
          "line": 690,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "old_major_index_ordering.push_back(i)",
          "old_line_content": "      }",
          "new_line_content": "        old_major_index_ordering.push_back(i);",
          "content_same": false
        },
        {
          "line": 694,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "new_major_index_ordering.push_back(perm_values[i])",
          "old_line_content": "      }",
          "new_line_content": "        new_major_index_ordering.push_back(perm_values[i]);",
          "content_same": false
        },
        {
          "line": 698,
          "old_api": null,
          "new_api": "failure",
          "old_text": null,
          "new_text": "failure()",
          "old_line_content": "    }",
          "new_line_content": "      return failure();",
          "content_same": false
        },
        {
          "line": 702,
          "old_api": null,
          "new_api": "getLoc",
          "old_text": null,
          "new_text": "transpose_op.getLoc()",
          "old_line_content": "",
          "new_line_content": "    Location loc = transpose_op.getLoc();",
          "content_same": false
        },
        {
          "line": 706,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "output_shape_values.push_back(dim)",
          "old_line_content": "    }",
          "new_line_content": "      output_shape_values.push_back(dim);",
          "content_same": false
        },
        {
          "line": 709,
          "old_api": null,
          "new_api": "getIntegerType",
          "old_text": null,
          "new_text": "rewriter.getIntegerType(32)",
          "old_line_content": "    auto new_shape_attr =",
          "new_line_content": "                                            rewriter.getIntegerType(32));",
          "content_same": false
        },
        {
          "line": 712,
          "old_api": null,
          "new_api": "rewriter.create<TF::ConstOp>(loc, new_shape_attr)",
          "old_text": null,
          "new_text": "rewriter.create<TF::ConstOp>(loc, new_shape_attr)",
          "old_line_content": "",
          "new_line_content": "    auto new_shape = rewriter.create<TF::ConstOp>(loc, new_shape_attr);",
          "content_same": false
        },
        {
          "line": 201,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "shape_vector.size()",
          "old_line_content": "  for (auto shape_object : shape_vector) {",
          "new_line_content": "  shape.reserve(shape_vector.size());",
          "content_same": false
        },
        {
          "line": 203,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "shape.push_back(shape_object)",
          "old_line_content": "  }",
          "new_line_content": "    shape.push_back(shape_object);",
          "content_same": false
        },
        {
          "line": 715,
          "old_api": null,
          "new_api": "input",
          "old_text": null,
          "new_text": "transpose_op.input()",
          "old_line_content": "        new_shape);",
          "new_line_content": "        transpose_op, transpose_op.output().getType(), transpose_op.input(),",
          "content_same": false
        },
        {
          "line": 718,
          "old_api": null,
          "new_api": "success",
          "old_text": null,
          "new_text": "success()",
          "old_line_content": "  }",
          "new_line_content": "    return success();",
          "content_same": false
        },
        {
          "line": 209,
          "old_api": null,
          "new_api": "llvm::makeArrayRef(shape)",
          "old_text": null,
          "new_text": "llvm::makeArrayRef(shape)",
          "old_line_content": "}",
          "new_line_content": "      llvm::makeArrayRef(shape));",
          "content_same": false
        },
        {
          "line": 214,
          "old_api": null,
          "new_api": "type.dyn_cast<ShapedType>()",
          "old_text": null,
          "new_text": "type.dyn_cast<ShapedType>()",
          "old_line_content": "  if (shaped_type) {",
          "new_line_content": "  auto shaped_type = type.dyn_cast<ShapedType>();",
          "content_same": false
        },
        {
          "line": 216,
          "old_api": null,
          "new_api": "getElementType",
          "old_text": null,
          "new_text": "shaped_type.getElementType()",
          "old_line_content": "  } else {",
          "new_line_content": "    return shaped_type.getElementType();",
          "content_same": false
        },
        {
          "line": 731,
          "old_api": null,
          "new_api": "getFunction",
          "old_text": null,
          "new_text": "getFunction()",
          "old_line_content": "",
          "new_line_content": "  auto func = getFunction();",
          "content_same": false
        },
        {
          "line": 737,
          "old_api": null,
          "new_api": "patterns.insert<FuseFullyConnectedAndAdd,\n                  FuseFullyConnectedAndReluX<TFL::ReluOp, kRelu>,\n                  FuseFullyConnectedAndReluX<TFL::Relu6Op, kRelu6>,\n                  FuseFullyConnectedAndReluX<TFL::Relu1Op, kRelu1>,\n                  FuseFullyConnectedAndMul>(ctx)",
          "old_text": null,
          "new_text": "patterns.insert<FuseFullyConnectedAndAdd,\n                  FuseFullyConnectedAndReluX<TFL::ReluOp, kRelu>,\n                  FuseFullyConnectedAndReluX<TFL::Relu6Op, kRelu6>,\n                  FuseFullyConnectedAndReluX<TFL::Relu1Op, kRelu1>,\n                  FuseFullyConnectedAndMul>(ctx)",
          "old_line_content": "                  FuseFullyConnectedAndReluX<TFL::ReluOp, kRelu>,",
          "new_line_content": "  patterns.insert<FuseFullyConnectedAndAdd,",
          "content_same": false
        },
        {
          "line": 742,
          "old_api": null,
          "new_api": "applyPatternsAndFoldGreedily",
          "old_text": null,
          "new_text": "applyPatternsAndFoldGreedily(func, patterns)",
          "old_line_content": "",
          "new_line_content": "  applyPatternsAndFoldGreedily(func, patterns);",
          "content_same": false
        },
        {
          "line": 745,
          "old_api": null,
          "new_api": "patterns.insert<\n      FuseBinaryOpToFollowingConv2D, FuseBinaryOpToFollowingDepthwiseConv2D,\n      FuseBinaryOpToFollowingFullyConnected, FuseConv2DAndMulWithQDQs,\n      FuseDepthwiseConv2DAndMulWithQDQs, ConvertTrivialTransposeOpToReshapeOp>(\n      ctx)",
          "old_text": null,
          "new_text": "patterns.insert<\n      FuseBinaryOpToFollowingConv2D, FuseBinaryOpToFollowingDepthwiseConv2D,\n      FuseBinaryOpToFollowingFullyConnected, FuseConv2DAndMulWithQDQs,\n      FuseDepthwiseConv2DAndMulWithQDQs, ConvertTrivialTransposeOpToReshapeOp>(\n      ctx)",
          "old_line_content": "      FuseBinaryOpToFollowingConv2D, FuseBinaryOpToFollowingDepthwiseConv2D,",
          "new_line_content": "  patterns.insert<",
          "content_same": false
        },
        {
          "line": 234,
          "old_api": null,
          "new_api": "failure",
          "old_text": null,
          "new_text": "failure()",
          "old_line_content": "",
          "new_line_content": "    if (!matchPattern(constant_val, m_Constant(&added_value))) return failure();",
          "content_same": false
        },
        {
          "line": 750,
          "old_api": null,
          "new_api": "applyPatternsAndFoldGreedily",
          "old_text": null,
          "new_text": "applyPatternsAndFoldGreedily(func, patterns)",
          "old_line_content": "}",
          "new_line_content": "  applyPatternsAndFoldGreedily(func, patterns);",
          "content_same": false
        },
        {
          "line": 239,
          "old_api": null,
          "new_api": "failure",
          "old_text": null,
          "new_text": "failure()",
          "old_line_content": "",
          "new_line_content": "    if (!fc_op) return failure();",
          "content_same": false
        },
        {
          "line": 243,
          "old_api": null,
          "new_api": "getType",
          "old_text": null,
          "new_text": "constant_val.getType().cast<TensorType>()",
          "old_line_content": "",
          "new_line_content": "    auto constant_val_type = constant_val.getType().cast<TensorType>();",
          "content_same": false
        },
        {
          "line": 757,
          "old_api": null,
          "new_api": "std::make_unique<Optimize>()",
          "old_text": null,
          "new_text": "std::make_unique<Optimize>()",
          "old_line_content": "}",
          "new_line_content": "  return std::make_unique<Optimize>();",
          "content_same": false
        },
        {
          "line": 250,
          "old_api": null,
          "new_api": "getRank",
          "old_text": null,
          "new_text": "constant_val_type.getRank()",
          "old_line_content": "      is_scalar_rhs = true;",
          "new_line_content": "    if (constant_val_type.getRank() == 0) {",
          "content_same": false
        },
        {
          "line": 253,
          "old_api": null,
          "new_api": "failure",
          "old_text": null,
          "new_text": "failure()",
          "old_line_content": "    }",
          "new_line_content": "      return failure();",
          "content_same": false
        },
        {
          "line": 257,
          "old_api": null,
          "new_api": "bias",
          "old_text": null,
          "new_text": "fc_op.bias()",
          "old_line_content": "    ElementsAttr bias_value;",
          "new_line_content": "    Value bias = fc_op.bias();",
          "content_same": false
        },
        {
          "line": 260,
          "old_api": null,
          "new_api": "failure",
          "old_text": null,
          "new_text": "failure()",
          "old_line_content": "",
          "new_line_content": "    if (fc_op.fused_activation_function() != \"NONE\") return failure();",
          "content_same": false
        },
        {
          "line": 263,
          "old_api": null,
          "new_api": "failure",
          "old_text": null,
          "new_text": "failure()",
          "old_line_content": "",
          "new_line_content": "      return failure();",
          "content_same": false
        },
        {
          "line": 272,
          "old_api": null,
          "new_api": "getType",
          "old_text": null,
          "new_text": "filter.getType().cast<ShapedType>()",
          "old_line_content": "        // Filter must be a `2D` tensor with `{num_channels, num_features}`",
          "new_line_content": "        auto filter_type = filter.getType().cast<ShapedType>();",
          "content_same": false
        },
        {
          "line": 276,
          "old_api": null,
          "new_api": "failure",
          "old_text": null,
          "new_text": "failure()",
          "old_line_content": "        }",
          "new_line_content": "          return failure();",
          "content_same": false
        },
        {
          "line": 278,
          "old_api": null,
          "new_api": "getShape",
          "old_text": null,
          "new_text": "filter_type.getShape()",
          "old_line_content": "",
          "new_line_content": "        int num_channels = filter_type.getShape()[0];",
          "content_same": false
        },
        {
          "line": 289,
          "old_api": null,
          "new_api": "getStringAttr",
          "old_text": null,
          "new_text": "rewriter.getStringAttr(\"NONE\")",
          "old_line_content": "        bias =",
          "new_line_content": "        auto none_af = rewriter.getStringAttr(\"NONE\");",
          "content_same": false
        },
        {
          "line": 291,
          "old_api": null,
          "new_api": "getLoc",
          "old_text": null,
          "new_text": "add_op.getLoc()",
          "old_line_content": "                .output();",
          "new_line_content": "            rewriter.create<AddOp>(add_op.getLoc(), bias, constant_val, none_af)",
          "content_same": false
        },
        {
          "line": 299,
          "old_api": null,
          "new_api": "getStringAttr",
          "old_text": null,
          "new_text": "rewriter.getStringAttr(\"NONE\")",
          "old_line_content": "      bias =",
          "new_line_content": "      auto none_af = rewriter.getStringAttr(\"NONE\");",
          "content_same": false
        },
        {
          "line": 301,
          "old_api": null,
          "new_api": "getLoc",
          "old_text": null,
          "new_text": "add_op.getLoc()",
          "old_line_content": "              .output();",
          "new_line_content": "          rewriter.create<AddOp>(add_op.getLoc(), bias, constant_val, none_af)",
          "content_same": false
        },
        {
          "line": 308,
          "old_api": null,
          "new_api": "input",
          "old_text": null,
          "new_text": "fc_op.input()",
          "old_line_content": "        /*filter=*/filter,",
          "new_line_content": "        /*input=*/fc_op.input(),",
          "content_same": false
        },
        {
          "line": 315,
          "old_api": null,
          "new_api": "output",
          "old_text": null,
          "new_text": "fc.output()",
          "old_line_content": "",
          "new_line_content": "    rewriter.replaceOp(add_op, fc.output());",
          "content_same": false
        },
        {
          "line": 317,
          "old_api": null,
          "new_api": "success",
          "old_text": null,
          "new_text": "success()",
          "old_line_content": "  }",
          "new_line_content": "    return success();",
          "content_same": false
        },
        {
          "line": 332,
          "old_api": null,
          "new_api": "failure",
          "old_text": null,
          "new_text": "failure()",
          "old_line_content": "",
          "new_line_content": "      return failure();",
          "content_same": false
        },
        {
          "line": 334,
          "old_api": null,
          "new_api": "getStringAttr",
          "old_text": null,
          "new_text": "rewriter.getStringAttr(Act)",
          "old_line_content": "    auto new_weights_format =",
          "new_line_content": "    auto new_activation_func = rewriter.getStringAttr(Act);",
          "content_same": false
        },
        {
          "line": 336,
          "old_api": null,
          "new_api": "weights_format",
          "old_text": null,
          "new_text": "fully_connected_op.weights_format()",
          "old_line_content": "    auto new_keep_num_dims =",
          "new_line_content": "        rewriter.getStringAttr(fully_connected_op.weights_format());",
          "content_same": false
        },
        {
          "line": 343,
          "old_api": null,
          "new_api": "bias",
          "old_text": null,
          "new_text": "fully_connected_op.bias()",
          "old_line_content": "        new_activation_func, new_weights_format, new_keep_num_dims);",
          "new_line_content": "        fully_connected_op.filter(), fully_connected_op.bias(),",
          "content_same": false
        },
        {
          "line": 345,
          "old_api": null,
          "new_api": "output",
          "old_text": null,
          "new_text": "fc.output()",
          "old_line_content": "",
          "new_line_content": "    rewriter.replaceOp(relu_op, fc.output());",
          "content_same": false
        },
        {
          "line": 347,
          "old_api": null,
          "new_api": "success",
          "old_text": null,
          "new_text": "success()",
          "old_line_content": "  }",
          "new_line_content": "    return success();",
          "content_same": false
        },
        {
          "line": 361,
          "old_api": null,
          "new_api": "failure",
          "old_text": null,
          "new_text": "failure()",
          "old_line_content": "",
          "new_line_content": "    if (!matchPattern(constant_val, m_Constant(&cst))) return failure();",
          "content_same": false
        },
        {
          "line": 368,
          "old_api": null,
          "new_api": "bias",
          "old_text": null,
          "new_text": "fc_op.bias()",
          "old_line_content": "    ElementsAttr cst_tmp;",
          "new_line_content": "    Value bias = fc_op.bias();",
          "content_same": false
        },
        {
          "line": 374,
          "old_api": null,
          "new_api": "failure",
          "old_text": null,
          "new_text": "failure()",
          "old_line_content": "",
          "new_line_content": "    if (fc_op.fused_activation_function() != \"NONE\") return failure();",
          "content_same": false
        },
        {
          "line": 389,
          "old_api": null,
          "new_api": "failure",
          "old_text": null,
          "new_text": "failure()",
          "old_line_content": "      }",
          "new_line_content": "        return failure();",
          "content_same": false
        },
        {
          "line": 393,
          "old_api": null,
          "new_api": "getResult",
          "old_text": null,
          "new_text": "new_op.getResult()",
          "old_line_content": "    }",
          "new_line_content": "      new_const_val = new_op.getResult();",
          "content_same": false
        },
        {
          "line": 400,
          "old_api": null,
          "new_api": "getLoc",
          "old_text": null,
          "new_text": "mul_op.getLoc()",
          "old_line_content": "    // If bias isn't None, it needs to be multiplied as well.",
          "new_line_content": "        rewriter.create<TF::MulOp>(mul_op.getLoc(), filter, new_const_val).z();",
          "content_same": false
        },
        {
          "line": 402,
          "old_api": null,
          "new_api": "getType",
          "old_text": null,
          "new_text": "bias.getType().isa<NoneType>()",
          "old_line_content": "      bias =",
          "new_line_content": "    if (!bias.getType().isa<NoneType>()) {",
          "content_same": false
        },
        {
          "line": 404,
          "old_api": null,
          "new_api": "getLoc",
          "old_text": null,
          "new_text": "mul_op.getLoc()",
          "old_line_content": "    }",
          "new_line_content": "          rewriter.create<TF::MulOp>(mul_op.getLoc(), bias, constant_val).z();",
          "content_same": false
        },
        {
          "line": 410,
          "old_api": null,
          "new_api": "input",
          "old_text": null,
          "new_text": "fc_op.input()",
          "old_line_content": "        /*filter=*/new_filter,",
          "new_line_content": "        /*input=*/fc_op.input(),",
          "content_same": false
        },
        {
          "line": 417,
          "old_api": null,
          "new_api": "output",
          "old_text": null,
          "new_text": "fc.output()",
          "old_line_content": "",
          "new_line_content": "    rewriter.replaceOp(mul_op, fc.output());",
          "content_same": false
        },
        {
          "line": 419,
          "old_api": null,
          "new_api": "success",
          "old_text": null,
          "new_text": "success()",
          "old_line_content": "  }",
          "new_line_content": "    return success();",
          "content_same": false
        },
        {
          "line": 457,
          "old_api": null,
          "new_api": "failure",
          "old_text": null,
          "new_text": "failure()",
          "old_line_content": "",
          "new_line_content": "    if (gamma_cst.getType().getRank() != 1) return failure();",
          "content_same": false
        },
        {
          "line": 464,
          "old_api": null,
          "new_api": "bias",
          "old_text": null,
          "new_text": "fc_op.bias()",
          "old_line_content": "",
          "new_line_content": "    Value bias = fc_op.bias();",
          "content_same": false
        },
        {
          "line": 468,
          "old_api": null,
          "new_api": "failure",
          "old_text": null,
          "new_text": "failure()",
          "old_line_content": "    auto q_op =",
          "new_line_content": "    if (!dq_op) return failure();",
          "content_same": false
        },
        {
          "line": 472,
          "old_api": null,
          "new_api": "input",
          "old_text": null,
          "new_text": "q_op.input()",
          "old_line_content": "",
          "new_line_content": "    filter = q_op.input();",
          "content_same": false
        },
        {
          "line": 480,
          "old_api": null,
          "new_api": "failure",
          "old_text": null,
          "new_text": "failure()",
          "old_line_content": "",
          "new_line_content": "    if (fc_op.fused_activation_function() != \"NONE\") return failure();",
          "content_same": false
        },
        {
          "line": 486,
          "old_api": null,
          "new_api": "getLoc",
          "old_text": null,
          "new_text": "fc_op.getLoc()",
          "old_line_content": "    Value broadcasted_gamma;",
          "new_line_content": "    Location loc = fc_op.getLoc();",
          "content_same": false
        },
        {
          "line": 493,
          "old_api": null,
          "new_api": "rewriter.create<ConstOp>(loc, mul_rhs)",
          "old_text": null,
          "new_text": "rewriter.create<ConstOp>(loc, mul_rhs)",
          "old_line_content": "    } else {",
          "new_line_content": "      broadcasted_gamma = rewriter.create<ConstOp>(loc, mul_rhs);",
          "content_same": false
        },
        {
          "line": 495,
          "old_api": null,
          "new_api": "failure",
          "old_text": null,
          "new_text": "failure()",
          "old_line_content": "    }",
          "new_line_content": "      return failure();",
          "content_same": false
        },
        {
          "line": 501,
          "old_api": null,
          "new_api": "z",
          "old_text": null,
          "new_text": "rewriter.create<TF::MulOp>(loc, filter, broadcasted_gamma).z()",
          "old_line_content": "    // Update the scale in the quantize op.",
          "new_line_content": "        rewriter.create<TF::MulOp>(loc, filter, broadcasted_gamma).z();",
          "content_same": false
        },
        {
          "line": 505,
          "old_api": null,
          "new_api": "getValue",
          "old_text": null,
          "new_text": "new_qtype.getValue()",
          "old_line_content": "                                                 new_filter, new_qtype);",
          "new_line_content": "    rewriter.replaceOpWithNewOp<TFL::QuantizeOp>(q_op, new_qtype.getValue(),",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 515,
          "old_api": "getResult",
          "new_api": null,
          "old_text": "fc_op.getResult()",
          "new_text": null,
          "old_line_content": "    mul_op.replaceAllUsesWith(fc_op.getResult());",
          "new_line_content": "    // Remove the tailing mul op.",
          "content_same": false
        },
        {
          "line": 532,
          "old_api": "input",
          "new_api": null,
          "old_text": "fc_op.input().getDefiningOp()",
          "new_text": null,
          "old_line_content": "    Operation *binary_op = fc_op.input().getDefiningOp();",
          "new_line_content": "    // Binary op.",
          "content_same": false
        },
        {
          "line": 539,
          "old_api": "m_Constant",
          "new_api": null,
          "old_text": "m_Constant(&cst)",
          "new_text": null,
          "old_line_content": "    if (!matchPattern(binary_op->getOperand(1), m_Constant(&cst)))",
          "new_line_content": "    DenseFPElementsAttr cst;",
          "content_same": false
        },
        {
          "line": 545,
          "old_api": "filter",
          "new_api": null,
          "old_text": "fc_op.filter()",
          "new_text": null,
          "old_line_content": "    Value filter = fc_op.filter();",
          "new_line_content": "    // Affine op.",
          "content_same": false
        },
        {
          "line": 548,
          "old_api": "m_Constant",
          "new_api": null,
          "old_text": "m_Constant(&filter_cst)",
          "new_text": null,
          "old_line_content": "    if (!matchPattern(filter, m_Constant(&filter_cst))) {",
          "new_line_content": "    DenseFPElementsAttr filter_cst, bias_cst;",
          "content_same": false
        },
        {
          "line": 550,
          "old_api": "getDefiningOp",
          "new_api": null,
          "old_text": "filter.getDefiningOp()",
          "new_text": null,
          "old_line_content": "      auto dq = llvm::dyn_cast_or_null<DequantizeOp>(filter.getDefiningOp());",
          "new_line_content": "      // The filter maybe quantized, then we should set it to the real constant.",
          "content_same": false
        },
        {
          "line": 556,
          "old_api": "input",
          "new_api": null,
          "old_text": "q.input()",
          "new_text": null,
          "old_line_content": "      filter = q.input();",
          "new_line_content": "      }",
          "content_same": false
        },
        {
          "line": 558,
          "old_api": "getType",
          "new_api": null,
          "old_text": "bias.getType().isa<NoneType>()",
          "new_text": null,
          "old_line_content": "    if (!bias.getType().isa<NoneType>() &&",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 563,
          "old_api": "llvm::isa<AddOp, SubOp>(binary_op)",
          "new_api": null,
          "old_text": "llvm::isa<AddOp, SubOp>(binary_op)",
          "new_text": null,
          "old_line_content": "    if (llvm::isa<AddOp, SubOp>(binary_op)) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 571,
          "old_api": "changeSign",
          "new_api": null,
          "old_text": "cst_value.changeSign()",
          "new_text": null,
          "old_line_content": "      if (llvm::isa<SubOp>(binary_op)) cst_value.changeSign();",
          "new_line_content": "      // so we have to update the bias.",
          "content_same": false
        },
        {
          "line": 574,
          "old_api": "getShape",
          "new_api": null,
          "old_text": "filter_type.getShape()",
          "new_text": null,
          "old_line_content": "          GetBiasDimAndSliceSize(filter_type.getShape(), fc_op);",
          "new_line_content": "      auto bias_and_slice =",
          "content_same": false
        },
        {
          "line": 578,
          "old_api": "getElementType",
          "new_api": null,
          "old_text": "filter_type.getElementType()",
          "new_text": null,
          "old_line_content": "          RankedTensorType::get({bias_size}, filter_type.getElementType());",
          "new_line_content": "      ShapedType new_bias_type =",
          "content_same": false
        },
        {
          "line": 583,
          "old_api": "getType",
          "new_api": null,
          "old_text": "bias.getType().isa<NoneType>()",
          "new_text": null,
          "old_line_content": "      if (bias.getType().isa<NoneType>()) {  // none bias, a list of zeros",
          "new_line_content": "      SmallVector<APFloat, 4> new_bias_values;",
          "content_same": false
        },
        {
          "line": 592,
          "old_api": "failure",
          "new_api": null,
          "old_text": "failure()",
          "new_text": null,
          "old_line_content": "        return failure();",
          "new_line_content": "      } else {",
          "content_same": false
        },
        {
          "line": 596,
          "old_api": "float_value_begin",
          "new_api": null,
          "old_text": "filter_cst.float_value_begin()",
          "new_text": null,
          "old_line_content": "      for (auto fp_it = filter_cst.float_value_begin(),",
          "new_line_content": "      int64_t flatten_index = 0;",
          "content_same": false
        },
        {
          "line": 604,
          "old_api": "DenseFPElementsAttr::get(new_bias_type, new_bias_values)",
          "new_api": null,
          "old_text": "DenseFPElementsAttr::get(new_bias_type, new_bias_values)",
          "new_text": null,
          "old_line_content": "      auto new_bias = DenseFPElementsAttr::get(new_bias_type, new_bias_values);",
          "new_line_content": "      }",
          "content_same": false
        },
        {
          "line": 606,
          "old_api": "getLoc",
          "new_api": null,
          "old_text": "fc_op.getLoc()",
          "new_text": null,
          "old_line_content": "          rewriter.create<ConstOp>(fc_op.getLoc(), new_bias_type, new_bias);",
          "new_line_content": "      auto new_bias_op =",
          "content_same": false
        },
        {
          "line": 614,
          "old_api": "llvm::isa<MulOp>(binary_op)",
          "new_api": null,
          "old_text": "llvm::isa<MulOp>(binary_op)",
          "new_text": null,
          "old_line_content": "      bool is_mul = llvm::isa<MulOp>(binary_op);",
          "new_line_content": "      // so we have to update the weight.",
          "content_same": false
        },
        {
          "line": 616,
          "old_api": "getElementType",
          "new_api": null,
          "old_text": "filter_type.getElementType()",
          "new_text": null,
          "old_line_content": "          filter_cst.mapValues(filter_type.getElementType(), [&](APFloat it) {",
          "new_line_content": "      auto new_filter =",
          "content_same": false
        },
        {
          "line": 621,
          "old_api": "getLoc",
          "new_api": null,
          "old_text": "rewriter.create<ConstOp>(\n          fc_op.getLoc(), filter.getType(), new_filter)",
          "new_text": null,
          "old_line_content": "      auto new_filter_op = rewriter.create<ConstOp>(",
          "new_line_content": "      // might increase the model size.",
          "content_same": false
        },
        {
          "line": 627,
          "old_api": "replaceAllUsesWith",
          "new_api": null,
          "old_text": "filter.replaceAllUsesWith(new_filter_op)",
          "new_text": null,
          "old_line_content": "        filter.replaceAllUsesWith(new_filter_op);",
          "new_line_content": "        // need to update the weight to the quantize op.",
          "content_same": false
        },
        {
          "line": 631,
          "old_api": "setOperand",
          "new_api": null,
          "old_text": "fc_op.setOperand(1, new_filter_op)",
          "new_text": null,
          "old_line_content": "        fc_op.setOperand(1, new_filter_op);",
          "new_line_content": "        // we update the weight of the affine op directly.",
          "content_same": false
        },
        {
          "line": 634,
          "old_api": "failure",
          "new_api": null,
          "old_text": "failure()",
          "new_text": null,
          "old_line_content": "      return failure();",
          "new_line_content": "    } else {",
          "content_same": false
        },
        {
          "line": 636,
          "old_api": "success",
          "new_api": null,
          "old_text": "success()",
          "new_text": null,
          "old_line_content": "    return success();",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 648,
          "old_api": "begin",
          "new_api": null,
          "old_text": "filter_shape.begin()",
          "new_text": null,
          "old_line_content": "    auto channel_index_iter = filter_shape.begin();",
          "new_line_content": "    // Channel dimension index is specified as op property",
          "content_same": false
        },
        {
          "line": 652,
          "old_api": "end",
          "new_api": null,
          "old_text": "filter_shape.end()",
          "new_text": null,
          "old_line_content": "        std::accumulate(std::next(channel_index_iter), filter_shape.end(), 1,",
          "new_line_content": "    int64_t slice_size =",
          "content_same": false
        },
        {
          "line": 664,
          "old_api": "input",
          "new_api": null,
          "old_text": "transpose_op.input().getType().cast<ShapedType>()",
          "new_text": null,
          "old_line_content": "    auto input_type = transpose_op.input().getType().cast<ShapedType>();",
          "new_line_content": "                                PatternRewriter &rewriter) const override {",
          "content_same": false
        },
        {
          "line": 668,
          "old_api": "hasStaticShape",
          "new_api": null,
          "old_text": "output_type.hasStaticShape()",
          "new_text": null,
          "old_line_content": "    if (!input_type.hasStaticShape() || !output_type.hasStaticShape())",
          "new_line_content": "    // & output shapes are fully known and permutation is a constant.",
          "content_same": false
        },
        {
          "line": 672,
          "old_api": "failure",
          "new_api": null,
          "old_text": "failure()",
          "new_text": null,
          "old_line_content": "    if (!matchPattern(perm, m_Constant(&perm_values_attr))) return failure();",
          "new_line_content": "    DenseElementsAttr perm_values_attr;",
          "content_same": false
        },
        {
          "line": 674,
          "old_api": "getShape",
          "new_api": null,
          "old_text": "input_type.getShape()",
          "new_text": null,
          "old_line_content": "    auto input_shape = input_type.getShape();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 676,
          "old_api": "getIntValues",
          "new_api": null,
          "old_text": "perm_values_attr.getIntValues()",
          "new_text": null,
          "old_line_content": "    for (const auto &dim : perm_values_attr.getIntValues())",
          "new_line_content": "    SmallVector<int64_t, 8> perm_values;",
          "content_same": false
        },
        {
          "line": 680,
          "old_api": "size",
          "new_api": null,
          "old_text": "perm_values.size()",
          "new_text": null,
          "old_line_content": "    if (input_shape.size() != perm_values.size()) {",
          "new_line_content": "    // This should never happen unless the input graph is malformed.",
          "content_same": false
        },
        {
          "line": 687,
          "old_api": "size",
          "new_api": null,
          "old_text": "input_shape.size()",
          "new_text": null,
          "old_line_content": "    for (int i = 0, end = input_shape.size(); i < end; i++) {",
          "new_line_content": "    SmallVector<int, 8> new_major_index_ordering;",
          "content_same": false
        },
        {
          "line": 689,
          "old_api": "push_back",
          "new_api": null,
          "old_text": "old_major_index_ordering.push_back(i)",
          "new_text": null,
          "old_line_content": "        old_major_index_ordering.push_back(i);",
          "new_line_content": "      if (input_shape[i] != 1) {",
          "content_same": false
        },
        {
          "line": 693,
          "old_api": "push_back",
          "new_api": null,
          "old_text": "new_major_index_ordering.push_back(perm_values[i])",
          "new_text": null,
          "old_line_content": "        new_major_index_ordering.push_back(perm_values[i]);",
          "new_line_content": "      if (input_shape[perm_values[i]] != 1) {",
          "content_same": false
        },
        {
          "line": 697,
          "old_api": "failure",
          "new_api": null,
          "old_text": "failure()",
          "new_text": null,
          "old_line_content": "      return failure();",
          "new_line_content": "    if (old_major_index_ordering != new_major_index_ordering) {",
          "content_same": false
        },
        {
          "line": 701,
          "old_api": "getLoc",
          "new_api": null,
          "old_text": "transpose_op.getLoc()",
          "new_text": null,
          "old_line_content": "    Location loc = transpose_op.getLoc();",
          "new_line_content": "    // Rewrite.",
          "content_same": false
        },
        {
          "line": 704,
          "old_api": "getShape",
          "new_api": null,
          "old_text": "output_type.getShape()",
          "new_text": null,
          "old_line_content": "    for (auto dim : output_type.getShape()) {",
          "new_line_content": "    SmallVector<int32_t, 8> output_shape_values;",
          "content_same": false
        },
        {
          "line": 707,
          "old_api": "size",
          "new_api": null,
          "old_text": "output_shape_values.size()",
          "new_text": null,
          "old_line_content": "    auto type = mlir::RankedTensorType::get(output_shape_values.size(),",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 710,
          "old_api": "mlir::DenseIntElementsAttr::get(type, output_shape_values)",
          "new_api": null,
          "old_text": "mlir::DenseIntElementsAttr::get(type, output_shape_values)",
          "new_text": null,
          "old_line_content": "        mlir::DenseIntElementsAttr::get(type, output_shape_values);",
          "new_line_content": "    auto new_shape_attr =",
          "content_same": false
        },
        {
          "line": 713,
          "old_api": "output",
          "new_api": null,
          "old_text": "rewriter.replaceOpWithNewOp<TFL::ReshapeOp>(\n        transpose_op, transpose_op.output().getType(), transpose_op.input(),\n        new_shape)",
          "new_text": null,
          "old_line_content": "    rewriter.replaceOpWithNewOp<TFL::ReshapeOp>(",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 202,
          "old_api": "push_back",
          "new_api": null,
          "old_text": "shape.push_back(shape_object)",
          "new_text": null,
          "old_line_content": "    shape.push_back(shape_object);",
          "new_line_content": "  for (auto shape_object : shape_vector) {",
          "content_same": false
        },
        {
          "line": 204,
          "old_api": "size",
          "new_api": null,
          "old_text": "mlir::DenseElementsAttr::get(\n      RankedTensorType::get(\n          {static_cast<int>(shape.size())},\n          mlir::IntegerType::get(32, output_val.getContext())),\n      llvm::makeArrayRef(shape))",
          "new_text": null,
          "old_line_content": "  return mlir::DenseElementsAttr::get(",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 717,
          "old_api": "success",
          "new_api": null,
          "old_text": "success()",
          "new_text": null,
          "old_line_content": "    return success();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 212,
          "old_api": "getValue",
          "new_api": null,
          "old_text": "type_attr.getValue()",
          "new_text": null,
          "old_line_content": "  auto type = type_attr.getValue();",
          "new_line_content": "static Type GetShapeStrippedType(TypeAttr type_attr) {",
          "content_same": false
        },
        {
          "line": 215,
          "old_api": "getElementType",
          "new_api": null,
          "old_text": "shaped_type.getElementType()",
          "new_text": null,
          "old_line_content": "    return shaped_type.getElementType();",
          "new_line_content": "  if (shaped_type) {",
          "content_same": false
        },
        {
          "line": 729,
          "old_api": "getContext",
          "new_api": null,
          "old_text": "getContext()",
          "new_text": null,
          "old_line_content": "  auto *ctx = &getContext();",
          "new_line_content": "  OwningRewritePatternList patterns;",
          "content_same": false
        },
        {
          "line": 735,
          "old_api": "TFL::populateWithGenerated(ctx, &patterns)",
          "new_api": null,
          "old_text": "TFL::populateWithGenerated(ctx, &patterns)",
          "new_text": null,
          "old_line_content": "  TFL::populateWithGenerated(ctx, &patterns);",
          "new_line_content": "  // following ops in a second pattern match.",
          "content_same": false
        },
        {
          "line": 741,
          "old_api": "applyPatternsAndFoldGreedily",
          "new_api": null,
          "old_text": "applyPatternsAndFoldGreedily(func, patterns)",
          "new_text": null,
          "old_line_content": "  applyPatternsAndFoldGreedily(func, patterns);",
          "new_line_content": "                  FuseFullyConnectedAndMul>(ctx);",
          "content_same": false
        },
        {
          "line": 232,
          "old_api": "rhs",
          "new_api": null,
          "old_text": "add_op.rhs()",
          "new_text": null,
          "old_line_content": "    Value constant_val = add_op.rhs();",
          "new_line_content": "    DenseElementsAttr added_value;",
          "content_same": false
        },
        {
          "line": 744,
          "old_api": "patterns.insert<\n      FuseBinaryOpToFollowingConv2D, FuseBinaryOpToFollowingDepthwiseConv2D,\n      FuseBinaryOpToFollowingFullyConnected, FuseConv2DAndMulWithQDQs,\n      FuseDepthwiseConv2DAndMulWithQDQs, ConvertTrivialTransposeOpToReshapeOp>(\n      ctx)",
          "new_api": null,
          "old_text": "patterns.insert<\n      FuseBinaryOpToFollowingConv2D, FuseBinaryOpToFollowingDepthwiseConv2D,\n      FuseBinaryOpToFollowingFullyConnected, FuseConv2DAndMulWithQDQs,\n      FuseDepthwiseConv2DAndMulWithQDQs, ConvertTrivialTransposeOpToReshapeOp>(\n      ctx)",
          "new_text": null,
          "old_line_content": "  patterns.insert<",
          "new_line_content": "  // Fuse the binary ops with the following ops.",
          "content_same": false
        },
        {
          "line": 237,
          "old_api": "lhs",
          "new_api": null,
          "old_text": "add_op.lhs().getDefiningOp()",
          "new_text": null,
          "old_line_content": "        dyn_cast_or_null<TFL::FullyConnectedOp>(add_op.lhs().getDefiningOp());",
          "new_line_content": "    auto fc_op =",
          "content_same": false
        },
        {
          "line": 749,
          "old_api": "applyPatternsAndFoldGreedily",
          "new_api": null,
          "old_text": "applyPatternsAndFoldGreedily(func, patterns)",
          "new_text": null,
          "old_line_content": "  applyPatternsAndFoldGreedily(func, patterns);",
          "new_line_content": "      ctx);",
          "content_same": false
        },
        {
          "line": 242,
          "old_api": "getType",
          "new_api": null,
          "old_text": "constant_val.getType().cast<TensorType>()",
          "new_text": null,
          "old_line_content": "    auto constant_val_type = constant_val.getType().cast<TensorType>();",
          "new_line_content": "    // `{num_channels}` shape.",
          "content_same": false
        },
        {
          "line": 756,
          "old_api": "std::make_unique<Optimize>()",
          "new_api": null,
          "old_text": "std::make_unique<Optimize>()",
          "new_text": null,
          "old_line_content": "  return std::make_unique<Optimize>();",
          "new_line_content": "std::unique_ptr<OperationPass<FuncOp>> CreateOptimizePass() {",
          "content_same": false
        },
        {
          "line": 249,
          "old_api": "getRank",
          "new_api": null,
          "old_text": "constant_val_type.getRank()",
          "new_text": null,
          "old_line_content": "    if (constant_val_type.getRank() == 0) {",
          "new_line_content": "    bool is_scalar_rhs = false;",
          "content_same": false
        },
        {
          "line": 251,
          "old_api": "getRank",
          "new_api": null,
          "old_text": "constant_val_type.getRank()",
          "new_text": null,
          "old_line_content": "    } else if (constant_val_type.getRank() != 1) {",
          "new_line_content": "      is_scalar_rhs = true;",
          "content_same": false
        },
        {
          "line": 255,
          "old_api": "filter",
          "new_api": null,
          "old_text": "fc_op.filter()",
          "new_text": null,
          "old_line_content": "    Value filter = fc_op.filter();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 258,
          "old_api": "getType",
          "new_api": null,
          "old_text": "bias.getType().isa<NoneType>()",
          "new_text": null,
          "old_line_content": "    const bool is_none_bias = bias.getType().isa<NoneType>();",
          "new_line_content": "    ElementsAttr bias_value;",
          "content_same": false
        },
        {
          "line": 261,
          "old_api": "m_Constant",
          "new_api": null,
          "old_text": "m_Constant(&bias_value)",
          "new_text": null,
          "old_line_content": "    if (!is_none_bias && !matchPattern(bias, m_Constant(&bias_value)))",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 271,
          "old_api": "getType",
          "new_api": null,
          "old_text": "filter.getType().cast<ShapedType>()",
          "new_text": null,
          "old_line_content": "        auto filter_type = filter.getType().cast<ShapedType>();",
          "new_line_content": "        // Get the number of channels if possible.",
          "content_same": false
        },
        {
          "line": 274,
          "old_api": "getRank",
          "new_api": null,
          "old_text": "filter_type.getRank()",
          "new_text": null,
          "old_line_content": "        if (filter_type.getRank() != 2) {",
          "new_line_content": "        // shape. The following check is rejecting unknown rank (-1).",
          "content_same": false
        },
        {
          "line": 277,
          "old_api": "getShape",
          "new_api": null,
          "old_text": "filter_type.getShape()",
          "new_text": null,
          "old_line_content": "        int num_channels = filter_type.getShape()[0];",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 284,
          "old_api": "getElementType",
          "new_api": null,
          "old_text": "RankedTensorType::get(\n            {num_channels}, constant_val_type.getElementType())",
          "new_text": null,
          "old_line_content": "        RankedTensorType type = RankedTensorType::get(",
          "new_line_content": "        // not.",
          "content_same": false
        },
        {
          "line": 290,
          "old_api": "getLoc",
          "new_api": null,
          "old_text": "add_op.getLoc()",
          "new_text": null,
          "old_line_content": "            rewriter.create<AddOp>(add_op.getLoc(), bias, constant_val, none_af)",
          "new_line_content": "        bias =",
          "content_same": false
        },
        {
          "line": 298,
          "old_api": "getStringAttr",
          "new_api": null,
          "old_text": "rewriter.getStringAttr(\"NONE\")",
          "new_text": null,
          "old_line_content": "      auto none_af = rewriter.getStringAttr(\"NONE\");",
          "new_line_content": "    } else {",
          "content_same": false
        },
        {
          "line": 300,
          "old_api": "getLoc",
          "new_api": null,
          "old_text": "add_op.getLoc()",
          "new_text": null,
          "old_line_content": "          rewriter.create<AddOp>(add_op.getLoc(), bias, constant_val, none_af)",
          "new_line_content": "      bias =",
          "content_same": false
        },
        {
          "line": 304,
          "old_api": "getLoc",
          "new_api": null,
          "old_text": "rewriter.create<TFL::FullyConnectedOp>(\n        FusedLoc::get({fc_op.getLoc(), add_op.getLoc()}, fc_op.getContext()),\n        add_op.getType(),\n        /*input=*/fc_op.input(),\n        /*filter=*/filter,\n        /*bias=*/bias,\n        /*fused_activation_function=*/\n        rewriter.getStringAttr(add_op.fused_activation_function()),\n        /*weights_format=*/rewriter.getStringAttr(fc_op.weights_format()),\n        /*keep_num_dims=*/rewriter.getBoolAttr(fc_op.keep_num_dims()))",
          "new_text": null,
          "old_line_content": "    auto fc = rewriter.create<TFL::FullyConnectedOp>(",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 311,
          "old_api": "fused_activation_function",
          "new_api": null,
          "old_text": "add_op.fused_activation_function()",
          "new_text": null,
          "old_line_content": "        rewriter.getStringAttr(add_op.fused_activation_function()),",
          "new_line_content": "        /*fused_activation_function=*/",
          "content_same": false
        },
        {
          "line": 316,
          "old_api": "success",
          "new_api": null,
          "old_text": "success()",
          "new_text": null,
          "old_line_content": "    return success();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 327,
          "old_api": "getOperand",
          "new_api": null,
          "old_text": "relu_op.getOperand().getDefiningOp()",
          "new_text": null,
          "old_line_content": "    Operation *input = relu_op.getOperand().getDefiningOp();",
          "new_line_content": "                                PatternRewriter &rewriter) const override {",
          "content_same": false
        },
        {
          "line": 333,
          "old_api": "getStringAttr",
          "new_api": null,
          "old_text": "rewriter.getStringAttr(Act)",
          "new_text": null,
          "old_line_content": "    auto new_activation_func = rewriter.getStringAttr(Act);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 335,
          "old_api": "weights_format",
          "new_api": null,
          "old_text": "fully_connected_op.weights_format()",
          "new_text": null,
          "old_line_content": "        rewriter.getStringAttr(fully_connected_op.weights_format());",
          "new_line_content": "    auto new_weights_format =",
          "content_same": false
        },
        {
          "line": 337,
          "old_api": "keep_num_dims",
          "new_api": null,
          "old_text": "fully_connected_op.keep_num_dims()",
          "new_text": null,
          "old_line_content": "        rewriter.getBoolAttr(fully_connected_op.keep_num_dims());",
          "new_line_content": "    auto new_keep_num_dims =",
          "content_same": false
        },
        {
          "line": 344,
          "old_api": "output",
          "new_api": null,
          "old_text": "fc.output()",
          "new_text": null,
          "old_line_content": "    rewriter.replaceOp(relu_op, fc.output());",
          "new_line_content": "        new_activation_func, new_weights_format, new_keep_num_dims);",
          "content_same": false
        },
        {
          "line": 346,
          "old_api": "success",
          "new_api": null,
          "old_text": "success()",
          "new_text": null,
          "old_line_content": "    return success();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 359,
          "old_api": "rhs",
          "new_api": null,
          "old_text": "mul_op.rhs()",
          "new_text": null,
          "old_line_content": "    Value constant_val = mul_op.rhs();",
          "new_line_content": "    DenseElementsAttr cst;",
          "content_same": false
        },
        {
          "line": 364,
          "old_api": "lhs",
          "new_api": null,
          "old_text": "mul_op.lhs().getDefiningOp()",
          "new_text": null,
          "old_line_content": "        dyn_cast_or_null<TFL::FullyConnectedOp>(mul_op.lhs().getDefiningOp());",
          "new_line_content": "    auto fc_op =",
          "content_same": false
        },
        {
          "line": 369,
          "old_api": "failure",
          "new_api": null,
          "old_text": "failure()",
          "new_text": null,
          "old_line_content": "    if (!matchPattern(filter, m_Constant(&cst_tmp))) return failure();",
          "new_line_content": "    ElementsAttr cst_tmp;",
          "content_same": false
        },
        {
          "line": 379,
          "old_api": "getType",
          "new_api": null,
          "old_text": "filter.getType()",
          "new_text": null,
          "old_line_content": "    if (!IsBroadcastableElementsAttrAndType(cst.getType(), filter.getType())) {",
          "new_line_content": "    Value new_const_val = constant_val;",
          "content_same": false
        },
        {
          "line": 391,
          "old_api": "getLoc",
          "new_api": null,
          "old_text": "mul_op.getLoc()",
          "new_text": null,
          "old_line_content": "          rewriter.create<ConstantOp>(mul_op.getLoc(), new_type, new_cst);",
          "new_line_content": "      auto new_op =",
          "content_same": false
        },
        {
          "line": 399,
          "old_api": "getLoc",
          "new_api": null,
          "old_text": "mul_op.getLoc()",
          "new_text": null,
          "old_line_content": "        rewriter.create<TF::MulOp>(mul_op.getLoc(), filter, new_const_val).z();",
          "new_line_content": "    auto new_filter =",
          "content_same": false
        },
        {
          "line": 401,
          "old_api": "getType",
          "new_api": null,
          "old_text": "bias.getType().isa<NoneType>()",
          "new_text": null,
          "old_line_content": "    if (!bias.getType().isa<NoneType>()) {",
          "new_line_content": "    // If bias isn't None, it needs to be multiplied as well.",
          "content_same": false
        },
        {
          "line": 403,
          "old_api": "getLoc",
          "new_api": null,
          "old_text": "mul_op.getLoc()",
          "new_text": null,
          "old_line_content": "          rewriter.create<TF::MulOp>(mul_op.getLoc(), bias, constant_val).z();",
          "new_line_content": "      bias =",
          "content_same": false
        },
        {
          "line": 406,
          "old_api": "getLoc",
          "new_api": null,
          "old_text": "rewriter.create<TFL::FullyConnectedOp>(\n        FusedLoc::get({fc_op.getLoc(), mul_op.getLoc()}, fc_op.getContext()),\n        mul_op.getType(),\n        /*input=*/fc_op.input(),\n        /*filter=*/new_filter,\n        /*bias=*/bias,\n        /*fused_activation_function=*/\n        rewriter.getStringAttr(mul_op.fused_activation_function()),\n        /*weights_format=*/rewriter.getStringAttr(fc_op.weights_format()),\n        /*keep_num_dims=*/rewriter.getBoolAttr(fc_op.keep_num_dims()))",
          "new_text": null,
          "old_line_content": "    auto fc = rewriter.create<TFL::FullyConnectedOp>(",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 413,
          "old_api": "fused_activation_function",
          "new_api": null,
          "old_text": "mul_op.fused_activation_function()",
          "new_text": null,
          "old_line_content": "        rewriter.getStringAttr(mul_op.fused_activation_function()),",
          "new_line_content": "        /*fused_activation_function=*/",
          "content_same": false
        },
        {
          "line": 418,
          "old_api": "success",
          "new_api": null,
          "old_text": "success()",
          "new_text": null,
          "old_line_content": "    return success();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 454,
          "old_api": "rhs",
          "new_api": null,
          "old_text": "mul_op.rhs()",
          "new_text": null,
          "old_line_content": "    Value gamma = mul_op.rhs();",
          "new_line_content": "    DenseElementsAttr gamma_cst;",
          "content_same": false
        },
        {
          "line": 459,
          "old_api": "lhs",
          "new_api": null,
          "old_text": "mul_op.lhs().getDefiningOp()",
          "new_text": null,
          "old_line_content": "    Operation *mul_op_lhs = mul_op.lhs().getDefiningOp();",
          "new_line_content": "    // Affine op",
          "content_same": false
        },
        {
          "line": 466,
          "old_api": "getDefiningOp",
          "new_api": null,
          "old_text": "filter.getDefiningOp()",
          "new_text": null,
          "old_line_content": "    auto dq_op = dyn_cast_or_null<TFL::DequantizeOp>(filter.getDefiningOp());",
          "new_line_content": "    // QDQs",
          "content_same": false
        },
        {
          "line": 469,
          "old_api": "input",
          "new_api": null,
          "old_text": "dq_op.input().getDefiningOp()",
          "new_text": null,
          "old_line_content": "        dyn_cast_or_null<TFL::QuantizeOp>(dq_op.input().getDefiningOp());",
          "new_line_content": "    auto q_op =",
          "content_same": false
        },
        {
          "line": 475,
          "old_api": "failure",
          "new_api": null,
          "old_text": "failure()",
          "new_text": null,
          "old_line_content": "    if (!matchPattern(filter, m_Constant(&cst_tmp))) return failure();",
          "new_line_content": "    ElementsAttr cst_tmp;",
          "content_same": false
        },
        {
          "line": 484,
          "old_api": "setInsertionPoint",
          "new_api": null,
          "old_text": "rewriter.setInsertionPoint(q_op)",
          "new_text": null,
          "old_line_content": "    rewriter.setInsertionPoint(q_op);",
          "new_line_content": "    // dimension, when the operand's depth is 1.",
          "content_same": false
        },
        {
          "line": 487,
          "old_api": "isa<TFL::Conv2DOp>(mul_op_lhs)",
          "new_api": null,
          "old_text": "isa<TFL::Conv2DOp>(mul_op_lhs)",
          "new_text": null,
          "old_line_content": "    if (isa<TFL::Conv2DOp>(mul_op_lhs)) {",
          "new_line_content": "    Value broadcasted_gamma;",
          "content_same": false
        },
        {
          "line": 494,
          "old_api": "failure",
          "new_api": null,
          "old_text": "failure()",
          "new_text": null,
          "old_line_content": "      return failure();",
          "new_line_content": "    } else {",
          "content_same": false
        },
        {
          "line": 500,
          "old_api": "z",
          "new_api": null,
          "old_text": "rewriter.create<TF::MulOp>(loc, filter, broadcasted_gamma).z()",
          "new_text": null,
          "old_line_content": "        rewriter.create<TF::MulOp>(loc, filter, broadcasted_gamma).z();",
          "new_line_content": "    auto new_filter =",
          "content_same": false
        },
        {
          "line": 502,
          "old_api": "qtype",
          "new_api": null,
          "old_text": "q_op.qtype()",
          "new_text": null,
          "old_line_content": "    auto new_qtype = RescaleQtype(q_op.qtype(), gamma_cst);",
          "new_line_content": "    // Update the scale in the quantize op.",
          "content_same": false
        },
        {
          "line": 508,
          "old_api": "getType",
          "new_api": null,
          "old_text": "bias.getType().isa<NoneType>()",
          "new_text": null,
          "old_line_content": "    if (!bias.getType().isa<NoneType>()) {",
          "new_line_content": "    // If bias isn't None, it needs to be multiplied as well.",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 110,
      "total_additions": 99,
      "total_deletions": 98,
      "total_api_changes": 307
    },
    "non_api_changes": {
      "has_non_api_changes": false,
      "evidence": {
        "total_diff_lines": 1,
        "api_related_lines": 307,
        "non_api_lines": 0,
        "non_api_line_numbers": []
      }
    },
    "api_calls_before": 417,
    "api_calls_after": 419,
    "diff_info": {
      "added_lines": 1,
      "removed_lines": 0,
      "total_diff_lines": 13
    }
  }
}