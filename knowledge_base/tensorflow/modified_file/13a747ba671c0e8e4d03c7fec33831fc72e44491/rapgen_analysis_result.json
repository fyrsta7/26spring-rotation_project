{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/tensorflow/modified_file/13a747ba671c0e8e4d03c7fec33831fc72e44491",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/tensorflow/modified_file/13a747ba671c0e8e4d03c7fec33831fc72e44491/before.cc",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/tensorflow/modified_file/13a747ba671c0e8e4d03c7fec33831fc72e44491/after.cc",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/tensorflow/modified_file/13a747ba671c0e8e4d03c7fec33831fc72e44491/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": true,
    "api_changes": {
      "replacements": [
        {
          "line": 135,
          "old_api": "CreateTPURewritePass",
          "new_api": "TFDevice::CreateMarkInputOutputAliasesPass()",
          "old_text": "CreateTPURewritePass()",
          "new_text": "TFDevice::CreateMarkInputOutputAliasesPass()",
          "old_line_content": "  pm.addPass(CreateTPURewritePass());",
          "new_line_content": "  pm.addPass(TFDevice::CreateMarkInputOutputAliasesPass());",
          "content_same": false
        },
        {
          "line": 136,
          "old_api": "createSymbolDCEPass",
          "new_api": "CreateTPURewritePass",
          "old_text": "createSymbolDCEPass()",
          "new_text": "CreateTPURewritePass()",
          "old_line_content": "  pm.addPass(createSymbolDCEPass());",
          "new_line_content": "  pm.addPass(CreateTPURewritePass());",
          "content_same": false
        },
        {
          "line": 137,
          "old_api": "TFDevice::CreateReplicateInvariantOpHoistingPass()",
          "new_api": "createSymbolDCEPass",
          "old_text": "TFDevice::CreateReplicateInvariantOpHoistingPass()",
          "new_text": "createSymbolDCEPass()",
          "old_line_content": "  pm.addNestedPass<FuncOp>(TFDevice::CreateReplicateInvariantOpHoistingPass());",
          "new_line_content": "  pm.addPass(createSymbolDCEPass());",
          "content_same": false
        },
        {
          "line": 138,
          "old_api": "CreateTPUMergeVariablesWithExecutePass",
          "new_api": "TFDevice::CreateReplicateInvariantOpHoistingPass()",
          "old_text": "CreateTPUMergeVariablesWithExecutePass()",
          "new_text": "TFDevice::CreateReplicateInvariantOpHoistingPass()",
          "old_line_content": "  pm.addNestedPass<FuncOp>(CreateTPUMergeVariablesWithExecutePass());",
          "new_line_content": "  pm.addNestedPass<FuncOp>(TFDevice::CreateReplicateInvariantOpHoistingPass());",
          "content_same": false
        },
        {
          "line": 139,
          "old_api": "CreateTPUColocateCompositeResourceOps",
          "new_api": "CreateTPUMergeVariablesWithExecutePass",
          "old_text": "CreateTPUColocateCompositeResourceOps()",
          "new_text": "CreateTPUMergeVariablesWithExecutePass()",
          "old_line_content": "  pm.addNestedPass<FuncOp>(CreateTPUColocateCompositeResourceOps());",
          "new_line_content": "  pm.addNestedPass<FuncOp>(CreateTPUMergeVariablesWithExecutePass());",
          "content_same": false
        },
        {
          "line": 140,
          "old_api": "CreateTPUVariableReformattingPass",
          "new_api": "CreateTPUColocateCompositeResourceOps",
          "old_text": "CreateTPUVariableReformattingPass()",
          "new_text": "CreateTPUColocateCompositeResourceOps()",
          "old_line_content": "  pm.addPass(CreateTPUVariableReformattingPass());",
          "new_line_content": "  pm.addNestedPass<FuncOp>(CreateTPUColocateCompositeResourceOps());",
          "content_same": false
        },
        {
          "line": 141,
          "old_api": "TF::CreateTFRegionControlFlowToFunctional()",
          "new_api": "CreateTPUVariableReformattingPass",
          "old_text": "TF::CreateTFRegionControlFlowToFunctional()",
          "new_text": "CreateTPUVariableReformattingPass()",
          "old_line_content": "  pm.addPass(TF::CreateTFRegionControlFlowToFunctional());",
          "new_line_content": "  pm.addPass(CreateTPUVariableReformattingPass());",
          "content_same": false
        },
        {
          "line": 152,
          "old_api": "tf_executor::CreateTFExecutorTPUV1IslandOutliningPass()",
          "new_api": "tf_executor::CreateTFExecutorTPUV1IslandCoarseningPass()",
          "old_text": "tf_executor::CreateTFExecutorTPUV1IslandOutliningPass()",
          "new_text": "tf_executor::CreateTFExecutorTPUV1IslandCoarseningPass()",
          "old_line_content": "  pm.addPass(tf_executor::CreateTFExecutorTPUV1IslandOutliningPass());",
          "new_line_content": "  pm.addPass(tf_executor::CreateTFExecutorTPUV1IslandCoarseningPass());",
          "content_same": false
        },
        {
          "line": 153,
          "old_api": "pm.nest<ModuleOp>()",
          "new_api": "tf_executor::CreateTFExecutorTPUV1IslandOutliningPass()",
          "old_text": "pm.nest<ModuleOp>()",
          "new_text": "tf_executor::CreateTFExecutorTPUV1IslandOutliningPass()",
          "old_line_content": "  OpPassManager &nested_module = pm.nest<ModuleOp>();",
          "new_line_content": "  pm.addPass(tf_executor::CreateTFExecutorTPUV1IslandOutliningPass());",
          "content_same": false
        },
        {
          "line": 154,
          "old_api": "CreateTPUBridgePipeline",
          "new_api": "pm.nest<ModuleOp>()",
          "old_text": "CreateTPUBridgePipeline(nested_module)",
          "new_text": "pm.nest<ModuleOp>()",
          "old_line_content": "  CreateTPUBridgePipeline(nested_module);",
          "new_line_content": "  OpPassManager &nested_module = pm.nest<ModuleOp>();",
          "content_same": false
        },
        {
          "line": 155,
          "old_api": "tf_executor::CreateTFExecutorTPUV1IslandInliningPass()",
          "new_api": "CreateTPUBridgePipeline",
          "old_text": "tf_executor::CreateTFExecutorTPUV1IslandInliningPass()",
          "new_text": "CreateTPUBridgePipeline(nested_module)",
          "old_line_content": "  pm.addPass(tf_executor::CreateTFExecutorTPUV1IslandInliningPass());",
          "new_line_content": "  CreateTPUBridgePipeline(nested_module);",
          "content_same": false
        },
        {
          "line": 172,
          "old_api": "CreateBreakUpIslandsPass",
          "new_api": "std::move(pass)",
          "old_text": "CreateBreakUpIslandsPass()",
          "new_text": "std::move(pass)",
          "old_line_content": "    pm.addPass(CreateBreakUpIslandsPass());",
          "new_line_content": "    pm.addNestedPass<FuncOp>(std::move(pass));",
          "content_same": false
        },
        {
          "line": 176,
          "old_api": "TFDevice::CreateReplicateToIslandPass()",
          "new_api": "CreateFunctionalToExecutorDialectConversionPass",
          "old_text": "TFDevice::CreateReplicateToIslandPass()",
          "new_text": "CreateFunctionalToExecutorDialectConversionPass()",
          "old_line_content": "  add_pass(TFDevice::CreateReplicateToIslandPass());",
          "new_line_content": "  add_pass(CreateFunctionalToExecutorDialectConversionPass());",
          "content_same": false
        },
        {
          "line": 177,
          "old_api": "TFDevice::CreateParallelExecuteToIslandsPass()",
          "new_api": "TFDevice::CreateReplicateToIslandPass()",
          "old_text": "TFDevice::CreateParallelExecuteToIslandsPass()",
          "new_text": "TFDevice::CreateReplicateToIslandPass()",
          "old_line_content": "  add_pass(TFDevice::CreateParallelExecuteToIslandsPass());",
          "new_line_content": "  add_pass(TFDevice::CreateReplicateToIslandPass());",
          "content_same": false
        },
        {
          "line": 178,
          "old_api": "TFDevice::CreateLaunchToDeviceAttributePass()",
          "new_api": "TFDevice::CreateParallelExecuteToIslandsPass()",
          "old_text": "TFDevice::CreateLaunchToDeviceAttributePass()",
          "new_text": "TFDevice::CreateParallelExecuteToIslandsPass()",
          "old_line_content": "  add_pass(TFDevice::CreateLaunchToDeviceAttributePass());",
          "new_line_content": "  add_pass(TFDevice::CreateParallelExecuteToIslandsPass());",
          "content_same": false
        },
        {
          "line": 179,
          "old_api": "TFTPU::CreateTPUDevicePropagationPass()",
          "new_api": "TFDevice::CreateLaunchToDeviceAttributePass()",
          "old_text": "TFTPU::CreateTPUDevicePropagationPass()",
          "new_text": "TFDevice::CreateLaunchToDeviceAttributePass()",
          "old_line_content": "  pm.addNestedPass<FuncOp>(TFTPU::CreateTPUDevicePropagationPass());",
          "new_line_content": "  add_pass(TFDevice::CreateLaunchToDeviceAttributePass());",
          "content_same": false
        },
        {
          "line": 180,
          "old_api": "createSymbolDCEPass",
          "new_api": "TFTPU::CreateTPUDevicePropagationPass()",
          "old_text": "createSymbolDCEPass()",
          "new_text": "TFTPU::CreateTPUDevicePropagationPass()",
          "old_line_content": "  pm.addPass(createSymbolDCEPass());",
          "new_line_content": "  pm.addNestedPass<FuncOp>(TFTPU::CreateTPUDevicePropagationPass());",
          "content_same": false
        },
        {
          "line": 181,
          "old_api": "CreateVerifySuitableForExportPass",
          "new_api": "createSymbolDCEPass",
          "old_text": "CreateVerifySuitableForExportPass()",
          "new_text": "createSymbolDCEPass()",
          "old_line_content": "  pm.addPass(CreateVerifySuitableForExportPass());",
          "new_line_content": "  pm.addPass(createSymbolDCEPass());",
          "content_same": false
        },
        {
          "line": 188,
          "old_api": "VLOG_IS_ON",
          "new_api": "getContext",
          "old_text": "VLOG_IS_ON(1)",
          "new_text": "module.getContext()",
          "old_line_content": "  if (enable_logging || VLOG_IS_ON(1)) {",
          "new_line_content": "  PassManager bridge(module.getContext());",
          "content_same": false
        },
        {
          "line": 189,
          "old_api": "tensorflow::DumpMlirOpToFile(\"standard_pipeline_before\", module)",
          "new_api": "VLOG_IS_ON",
          "old_text": "tensorflow::DumpMlirOpToFile(\"standard_pipeline_before\", module)",
          "new_text": "VLOG_IS_ON(1)",
          "old_line_content": "    tensorflow::DumpMlirOpToFile(\"standard_pipeline_before\", module);",
          "new_line_content": "  if (enable_logging || VLOG_IS_ON(1)) {",
          "content_same": false
        },
        {
          "line": 190,
          "old_api": "EnableLogging",
          "new_api": "tensorflow::DumpMlirOpToFile(\"standard_pipeline_before\", module)",
          "old_text": "EnableLogging(&bridge)",
          "new_text": "tensorflow::DumpMlirOpToFile(\"standard_pipeline_before\", module)",
          "old_line_content": "    if (VLOG_IS_ON(2)) EnableLogging(&bridge);",
          "new_line_content": "    tensorflow::DumpMlirOpToFile(\"standard_pipeline_before\", module);",
          "content_same": false
        },
        {
          "line": 195,
          "old_api": "CreateTFStandardPipeline",
          "new_api": "setValue",
          "old_text": "CreateTFStandardPipeline(bridge, pipeline_options)",
          "new_text": "pipeline_options.enable_inliner.setValue(enable_inliner)",
          "old_line_content": "  CreateTFStandardPipeline(bridge, pipeline_options);",
          "new_line_content": "  pipeline_options.enable_inliner.setValue(enable_inliner);",
          "content_same": false
        },
        {
          "line": 196,
          "old_api": "getContext",
          "new_api": "CreateTFStandardPipeline",
          "old_text": "module.getContext()",
          "new_text": "CreateTFStandardPipeline(bridge, pipeline_options)",
          "old_line_content": "  mlir::StatusScopedDiagnosticHandler diag_handler(module.getContext());",
          "new_line_content": "  CreateTFStandardPipeline(bridge, pipeline_options);",
          "content_same": false
        },
        {
          "line": 197,
          "old_api": "run",
          "new_api": "getContext",
          "old_text": "bridge.run(module)",
          "new_text": "module.getContext()",
          "old_line_content": "  LogicalResult result = bridge.run(module);",
          "new_line_content": "  mlir::StatusScopedDiagnosticHandler diag_handler(module.getContext());",
          "content_same": false
        },
        {
          "line": 200,
          "old_api": "tensorflow::DumpMlirOpToFile(\"standard_pipeline_after\", module)",
          "new_api": "VLOG_IS_ON",
          "old_text": "tensorflow::DumpMlirOpToFile(\"standard_pipeline_after\", module)",
          "new_text": "VLOG_IS_ON(1)",
          "old_line_content": "    tensorflow::DumpMlirOpToFile(\"standard_pipeline_after\", module);",
          "new_line_content": "  if (enable_logging || VLOG_IS_ON(1))",
          "content_same": false
        },
        {
          "line": 201,
          "old_api": "ConsumeStatus",
          "new_api": "tensorflow::DumpMlirOpToFile(\"standard_pipeline_after\", module)",
          "old_text": "diag_handler.ConsumeStatus()",
          "new_text": "tensorflow::DumpMlirOpToFile(\"standard_pipeline_after\", module)",
          "old_line_content": "  return diag_handler.ConsumeStatus();",
          "new_line_content": "    tensorflow::DumpMlirOpToFile(\"standard_pipeline_after\", module);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 160,
          "old_api": null,
          "new_api": "RunTPUBridge",
          "old_text": null,
          "new_text": "RunTPUBridge(module, enable_logging, CreateTPUBridgePipeline)",
          "old_line_content": "}",
          "new_line_content": "  return RunTPUBridge(module, enable_logging, CreateTPUBridgePipeline);",
          "content_same": false
        },
        {
          "line": 163,
          "old_api": null,
          "new_api": "RunTPUBridge",
          "old_text": null,
          "new_text": "RunTPUBridge(module, enable_logging, CreateTPUBridgePipelineV1)",
          "old_line_content": "}",
          "new_line_content": "  return RunTPUBridge(module, enable_logging, CreateTPUBridgePipelineV1);",
          "content_same": false
        },
        {
          "line": 198,
          "old_api": null,
          "new_api": "run",
          "old_text": null,
          "new_text": "bridge.run(module)",
          "old_line_content": "  (void)result;",
          "new_line_content": "  LogicalResult result = bridge.run(module);",
          "content_same": false
        },
        {
          "line": 202,
          "old_api": null,
          "new_api": "ConsumeStatus",
          "old_text": null,
          "new_text": "diag_handler.ConsumeStatus()",
          "old_line_content": "}",
          "new_line_content": "  return diag_handler.ConsumeStatus();",
          "content_same": false
        },
        {
          "line": 173,
          "old_api": null,
          "new_api": "CreateBreakUpIslandsPass",
          "old_text": null,
          "new_text": "CreateBreakUpIslandsPass()",
          "old_line_content": "  };",
          "new_line_content": "    pm.addPass(CreateBreakUpIslandsPass());",
          "content_same": false
        },
        {
          "line": 142,
          "old_api": null,
          "new_api": "TF::CreateTFRegionControlFlowToFunctional()",
          "old_text": null,
          "new_text": "TF::CreateTFRegionControlFlowToFunctional()",
          "old_line_content": "}",
          "new_line_content": "  pm.addPass(TF::CreateTFRegionControlFlowToFunctional());",
          "content_same": false
        },
        {
          "line": 146,
          "old_api": null,
          "new_api": "TF::CreateTFShapeInferencePass()",
          "old_text": null,
          "new_text": "TF::CreateTFShapeInferencePass()",
          "old_line_content": "  // For V1 compatibility, we process a module where the graph does not have",
          "new_line_content": "  pm.addPass(TF::CreateTFShapeInferencePass());",
          "content_same": false
        },
        {
          "line": 182,
          "old_api": null,
          "new_api": "CreateVerifySuitableForExportPass",
          "old_text": null,
          "new_text": "CreateVerifySuitableForExportPass()",
          "old_line_content": "}",
          "new_line_content": "  pm.addPass(CreateVerifySuitableForExportPass());",
          "content_same": false
        },
        {
          "line": 156,
          "old_api": null,
          "new_api": "tf_executor::CreateTFExecutorTPUV1IslandInliningPass()",
          "old_text": null,
          "new_text": "tf_executor::CreateTFExecutorTPUV1IslandInliningPass()",
          "old_line_content": "}",
          "new_line_content": "  pm.addPass(tf_executor::CreateTFExecutorTPUV1IslandInliningPass());",
          "content_same": false
        },
        {
          "line": 191,
          "old_api": null,
          "new_api": "EnableLogging",
          "old_text": null,
          "new_text": "EnableLogging(&bridge)",
          "old_line_content": "  }",
          "new_line_content": "    if (VLOG_IS_ON(2)) EnableLogging(&bridge);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 162,
          "old_api": "RunTPUBridge",
          "new_api": null,
          "old_text": "RunTPUBridge(module, enable_logging, CreateTPUBridgePipelineV1)",
          "new_text": null,
          "old_line_content": "  return RunTPUBridge(module, enable_logging, CreateTPUBridgePipelineV1);",
          "new_line_content": "tensorflow::Status TPUBridgeV1Compat(ModuleOp module, bool enable_logging) {",
          "content_same": false
        },
        {
          "line": 194,
          "old_api": "setValue",
          "new_api": null,
          "old_text": "pipeline_options.enable_inliner.setValue(enable_inliner)",
          "new_text": null,
          "old_line_content": "  pipeline_options.enable_inliner.setValue(enable_inliner);",
          "new_line_content": "  StandardPipelineOptions pipeline_options;",
          "content_same": false
        },
        {
          "line": 199,
          "old_api": "VLOG_IS_ON",
          "new_api": null,
          "old_text": "VLOG_IS_ON(1)",
          "new_text": null,
          "old_line_content": "  if (enable_logging || VLOG_IS_ON(1))",
          "new_line_content": "  (void)result;",
          "content_same": false
        },
        {
          "line": 171,
          "old_api": "std::move(pass)",
          "new_api": null,
          "old_text": "std::move(pass)",
          "new_text": null,
          "old_line_content": "    pm.addNestedPass<FuncOp>(std::move(pass));",
          "new_line_content": "  auto add_pass = [&](std::unique_ptr<Pass> pass) {",
          "content_same": false
        },
        {
          "line": 175,
          "old_api": "CreateFunctionalToExecutorDialectConversionPass",
          "new_api": null,
          "old_text": "CreateFunctionalToExecutorDialectConversionPass()",
          "new_text": null,
          "old_line_content": "  add_pass(CreateFunctionalToExecutorDialectConversionPass());",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 145,
          "old_api": "TF::CreateTFShapeInferencePass()",
          "new_api": null,
          "old_text": "TF::CreateTFShapeInferencePass()",
          "new_text": null,
          "old_line_content": "  pm.addPass(TF::CreateTFShapeInferencePass());",
          "new_line_content": "void CreateTPUBridgePipelineV1(OpPassManager &pm) {",
          "content_same": false
        },
        {
          "line": 151,
          "old_api": "tf_executor::CreateTFExecutorTPUV1IslandCoarseningPass()",
          "new_api": null,
          "old_text": "tf_executor::CreateTFExecutorTPUV1IslandCoarseningPass()",
          "new_text": null,
          "old_line_content": "  pm.addPass(tf_executor::CreateTFExecutorTPUV1IslandCoarseningPass());",
          "new_line_content": "  // Afterward we inline back in the parent module and delete the nested one.",
          "content_same": false
        },
        {
          "line": 187,
          "old_api": "getContext",
          "new_api": null,
          "old_text": "module.getContext()",
          "new_text": null,
          "old_line_content": "  PassManager bridge(module.getContext());",
          "new_line_content": "                                                 bool enable_inliner) {",
          "content_same": false
        },
        {
          "line": 159,
          "old_api": "RunTPUBridge",
          "new_api": null,
          "old_text": "RunTPUBridge(module, enable_logging, CreateTPUBridgePipeline)",
          "new_text": null,
          "old_line_content": "  return RunTPUBridge(module, enable_logging, CreateTPUBridgePipeline);",
          "new_line_content": "tensorflow::Status TPUBridge(ModuleOp module, bool enable_logging) {",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 26,
      "total_additions": 10,
      "total_deletions": 9,
      "total_api_changes": 45
    },
    "non_api_changes": {
      "has_non_api_changes": false,
      "evidence": {
        "total_diff_lines": 1,
        "api_related_lines": 45,
        "non_api_lines": 0,
        "non_api_line_numbers": []
      }
    },
    "api_calls_before": 134,
    "api_calls_after": 136,
    "diff_info": {
      "added_lines": 1,
      "removed_lines": 0,
      "total_diff_lines": 13
    }
  }
}