{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/tensorflow/modified_file/07306637681f1f832ac3643016779cfd07048b42",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/tensorflow/modified_file/07306637681f1f832ac3643016779cfd07048b42/before.cc",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/tensorflow/modified_file/07306637681f1f832ac3643016779cfd07048b42/after.cc",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/tensorflow/modified_file/07306637681f1f832ac3643016779cfd07048b42/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 756,
          "old_api": "dequantize",
          "new_api": "RuntimeShape",
          "old_text": "dequantize(scores_quant[idx])",
          "new_text": "RuntimeShape(1, num_boxes * num_classes_with_background)",
          "old_line_content": "    GetTensorData<float>(scores)[idx] = dequantize(scores_quant[idx]);",
          "new_line_content": "  const auto shape = RuntimeShape(1, num_boxes * num_classes_with_background);",
          "content_same": false
        },
        {
          "line": 801,
          "old_api": "NonMaxSuppressionMultiClassFastHelper",
          "new_api": "GetTensorData<float>(scores)",
          "old_text": "NonMaxSuppressionMultiClassFastHelper(\n        context, node, op_data, GetTensorData<float>(scores))",
          "new_text": "GetTensorData<float>(scores)",
          "old_line_content": "    TF_LITE_ENSURE_STATUS(NonMaxSuppressionMultiClassFastHelper(",
          "new_line_content": "        context, node, op_data, GetTensorData<float>(scores)));",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 770,
          "old_api": null,
          "new_api": "TF_LITE_ENSURE_OK",
          "old_text": null,
          "new_text": "TF_LITE_ENSURE_OK(context,\n                    GetInputSafe(context, node, kInputTensorClassPredictions,\n                                 &input_class_predictions))",
          "old_line_content": "                                 &input_class_predictions));",
          "new_line_content": "  TF_LITE_ENSURE_OK(context,",
          "content_same": false
        },
        {
          "line": 771,
          "old_api": null,
          "new_api": "GetInputSafe",
          "old_text": null,
          "new_text": "GetInputSafe(context, node, kInputTensorClassPredictions,\n                                 &input_class_predictions)",
          "old_line_content": "  const int num_boxes = input_box_encodings->dims->data[1];",
          "new_line_content": "                    GetInputSafe(context, node, kInputTensorClassPredictions,",
          "content_same": false
        },
        {
          "line": 777,
          "old_api": null,
          "new_api": "TF_LITE_ENSURE_EQ",
          "old_text": null,
          "new_text": "TF_LITE_ENSURE_EQ(context, input_class_predictions->dims->data[1], num_boxes)",
          "old_line_content": "      input_class_predictions->dims->data[2];",
          "new_line_content": "  TF_LITE_ENSURE_EQ(context, input_class_predictions->dims->data[1], num_boxes);",
          "content_same": false
        },
        {
          "line": 781,
          "old_api": null,
          "new_api": "TF_LITE_ENSURE",
          "old_text": null,
          "new_text": "TF_LITE_ENSURE(context, (num_classes_with_background - num_classes <= 1))",
          "old_line_content": "",
          "new_line_content": "  TF_LITE_ENSURE(context, (num_classes_with_background - num_classes <= 1));",
          "content_same": false
        },
        {
          "line": 782,
          "old_api": null,
          "new_api": "TF_LITE_ENSURE",
          "old_text": null,
          "new_text": "TF_LITE_ENSURE(context, (num_classes_with_background >= num_classes))",
          "old_line_content": "  const TfLiteTensor* scores;",
          "new_line_content": "  TF_LITE_ENSURE(context, (num_classes_with_background >= num_classes));",
          "content_same": false
        },
        {
          "line": 788,
          "old_api": null,
          "new_api": "DequantizeClassPredictions",
          "old_text": null,
          "new_text": "DequantizeClassPredictions(input_class_predictions, num_boxes,\n                                 num_classes_with_background, temporary_scores)",
          "old_line_content": "      scores = temporary_scores;",
          "new_line_content": "      DequantizeClassPredictions(input_class_predictions, num_boxes,",
          "content_same": false
        },
        {
          "line": 800,
          "old_api": null,
          "new_api": "NonMaxSuppressionMultiClassRegularHelper",
          "old_text": null,
          "new_text": "NonMaxSuppressionMultiClassRegularHelper(\n        context, node, op_data, GetTensorData<float>(scores))",
          "old_line_content": "  else",
          "new_line_content": "    TF_LITE_ENSURE_STATUS(NonMaxSuppressionMultiClassRegularHelper(",
          "content_same": false
        },
        {
          "line": 803,
          "old_api": null,
          "new_api": "NonMaxSuppressionMultiClassFastHelper",
          "old_text": null,
          "new_text": "NonMaxSuppressionMultiClassFastHelper(\n        context, node, op_data, GetTensorData<float>(scores))",
          "old_line_content": "",
          "new_line_content": "    TF_LITE_ENSURE_STATUS(NonMaxSuppressionMultiClassFastHelper(",
          "content_same": false
        },
        {
          "line": 804,
          "old_api": null,
          "new_api": "GetTensorData<float>(scores)",
          "old_text": null,
          "new_text": "GetTensorData<float>(scores)",
          "old_line_content": "  return kTfLiteOk;",
          "new_line_content": "        context, node, op_data, GetTensorData<float>(scores)));",
          "content_same": false
        },
        {
          "line": 811,
          "old_api": null,
          "new_api": "TF_LITE_ENSURE",
          "old_text": null,
          "new_text": "TF_LITE_ENSURE(context, (kBatchSize == 1))",
          "old_line_content": "  // These two functions correspond to two blocks in the Object Detection model.",
          "new_line_content": "  TF_LITE_ENSURE(context, (kBatchSize == 1));",
          "content_same": false
        },
        {
          "line": 812,
          "old_api": null,
          "new_api": "static_cast<OpData*>(node->user_data)",
          "old_text": null,
          "new_text": "static_cast<OpData*>(node->user_data)",
          "old_line_content": "  // In future, we would like to break the custom op in two blocks, which is",
          "new_line_content": "  auto* op_data = static_cast<OpData*>(node->user_data);",
          "content_same": false
        },
        {
          "line": 822,
          "old_api": null,
          "new_api": "DecodeCenterSizeBoxes",
          "old_text": null,
          "new_text": "DecodeCenterSizeBoxes(context, node, op_data)",
          "old_line_content": "  // by choosing effective set of decoded boxes",
          "new_line_content": "  TF_LITE_ENSURE_STATUS(DecodeCenterSizeBoxes(context, node, op_data));",
          "content_same": false
        },
        {
          "line": 827,
          "old_api": null,
          "new_api": "NonMaxSuppressionMultiClass",
          "old_text": null,
          "new_text": "NonMaxSuppressionMultiClass(context, node, op_data)",
          "old_line_content": "  return kTfLiteOk;",
          "new_line_content": "  TF_LITE_ENSURE_STATUS(NonMaxSuppressionMultiClass(context, node, op_data));",
          "content_same": false
        },
        {
          "line": 844,
          "old_api": null,
          "new_api": "Register_DETECTION_POSTPROCESS",
          "old_text": null,
          "new_text": "Register_DETECTION_POSTPROCESS()",
          "old_line_content": "",
          "new_line_content": "  return Register_DETECTION_POSTPROCESS();",
          "content_same": false
        },
        {
          "line": 757,
          "old_api": null,
          "new_api": "optimized_ops::Dequantize(op_params, shape,\n                            GetTensorData<uint8>(input_class_predictions),\n                            shape, GetTensorData<float>(scores))",
          "old_text": null,
          "new_text": "optimized_ops::Dequantize(op_params, shape,\n                            GetTensorData<uint8>(input_class_predictions),\n                            shape, GetTensorData<float>(scores))",
          "old_line_content": "  }",
          "new_line_content": "  optimized_ops::Dequantize(op_params, shape,",
          "content_same": false
        },
        {
          "line": 758,
          "old_api": null,
          "new_api": "GetTensorData<uint8>(input_class_predictions)",
          "old_text": null,
          "new_text": "GetTensorData<uint8>(input_class_predictions)",
          "old_line_content": "}",
          "new_line_content": "                            GetTensorData<uint8>(input_class_predictions),",
          "content_same": false
        },
        {
          "line": 759,
          "old_api": null,
          "new_api": "GetTensorData<float>(scores)",
          "old_text": null,
          "new_text": "GetTensorData<float>(scores)",
          "old_line_content": "",
          "new_line_content": "                            shape, GetTensorData<float>(scores));",
          "content_same": false
        },
        {
          "line": 766,
          "old_api": null,
          "new_api": "TF_LITE_ENSURE_OK",
          "old_text": null,
          "new_text": "TF_LITE_ENSURE_OK(context,\n                    GetInputSafe(context, node, kInputTensorBoxEncodings,\n                                 &input_box_encodings))",
          "old_line_content": "                                 &input_box_encodings));",
          "new_line_content": "  TF_LITE_ENSURE_OK(context,",
          "content_same": false
        },
        {
          "line": 767,
          "old_api": null,
          "new_api": "GetInputSafe",
          "old_text": null,
          "new_text": "GetInputSafe(context, node, kInputTensorBoxEncodings,\n                                 &input_box_encodings)",
          "old_line_content": "  const TfLiteTensor* input_class_predictions;",
          "new_line_content": "                    GetInputSafe(context, node, kInputTensorBoxEncodings,",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 768,
          "old_api": "TF_LITE_ENSURE_OK",
          "new_api": null,
          "old_text": "TF_LITE_ENSURE_OK(context,\n                    GetInputSafe(context, node, kInputTensorClassPredictions,\n                                 &input_class_predictions))",
          "new_text": null,
          "old_line_content": "  TF_LITE_ENSURE_OK(context,",
          "new_line_content": "                                 &input_box_encodings));",
          "content_same": false
        },
        {
          "line": 769,
          "old_api": "GetInputSafe",
          "new_api": null,
          "old_text": "GetInputSafe(context, node, kInputTensorClassPredictions,\n                                 &input_class_predictions)",
          "new_text": null,
          "old_line_content": "                    GetInputSafe(context, node, kInputTensorClassPredictions,",
          "new_line_content": "  const TfLiteTensor* input_class_predictions;",
          "content_same": false
        },
        {
          "line": 802,
          "old_api": "GetTensorData<float>(scores)",
          "new_api": null,
          "old_text": "GetTensorData<float>(scores)",
          "new_text": null,
          "old_line_content": "        context, node, op_data, GetTensorData<float>(scores)));",
          "new_line_content": "  else",
          "content_same": false
        },
        {
          "line": 773,
          "old_api": "TF_LITE_ENSURE_EQ",
          "new_api": null,
          "old_text": "TF_LITE_ENSURE_EQ(context, input_class_predictions->dims->data[0],\n                    kBatchSize)",
          "new_text": null,
          "old_line_content": "  TF_LITE_ENSURE_EQ(context, input_class_predictions->dims->data[0],",
          "new_line_content": "  const int num_boxes = input_box_encodings->dims->data[1];",
          "content_same": false
        },
        {
          "line": 809,
          "old_api": "TF_LITE_ENSURE",
          "new_api": null,
          "old_text": "TF_LITE_ENSURE(context, (kBatchSize == 1))",
          "new_text": null,
          "old_line_content": "  TF_LITE_ENSURE(context, (kBatchSize == 1));",
          "new_line_content": "TfLiteStatus Eval(TfLiteContext* context, TfLiteNode* node) {",
          "content_same": false
        },
        {
          "line": 810,
          "old_api": "static_cast<OpData*>(node->user_data)",
          "new_api": null,
          "old_text": "static_cast<OpData*>(node->user_data)",
          "new_text": null,
          "old_line_content": "  auto* op_data = static_cast<OpData*>(node->user_data);",
          "new_line_content": "  // TODO(b/177068051):  Generalize for any batch size.",
          "content_same": false
        },
        {
          "line": 779,
          "old_api": "TF_LITE_ENSURE",
          "new_api": null,
          "old_text": "TF_LITE_ENSURE(context, (num_classes_with_background - num_classes <= 1))",
          "new_text": null,
          "old_line_content": "  TF_LITE_ENSURE(context, (num_classes_with_background - num_classes <= 1));",
          "new_line_content": "      input_class_predictions->dims->data[2];",
          "content_same": false
        },
        {
          "line": 780,
          "old_api": "TF_LITE_ENSURE",
          "new_api": null,
          "old_text": "TF_LITE_ENSURE(context, (num_classes_with_background >= num_classes))",
          "new_text": null,
          "old_line_content": "  TF_LITE_ENSURE(context, (num_classes_with_background >= num_classes));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 842,
          "old_api": "Register_DETECTION_POSTPROCESS",
          "new_api": null,
          "old_text": "Register_DETECTION_POSTPROCESS()",
          "new_text": null,
          "old_line_content": "  return Register_DETECTION_POSTPROCESS();",
          "new_line_content": "// \"Register_TFLITE_DETECTION_POST_PROCESS\".",
          "content_same": false
        },
        {
          "line": 754,
          "old_api": "GetTensorData<uint8>(input_class_predictions)",
          "new_api": null,
          "old_text": "GetTensorData<uint8>(input_class_predictions)",
          "new_text": null,
          "old_line_content": "  const uint8* scores_quant = GetTensorData<uint8>(input_class_predictions);",
          "new_line_content": "  op_params.zero_point = quant_zero_point;",
          "content_same": false
        },
        {
          "line": 786,
          "old_api": "DequantizeClassPredictions",
          "new_api": null,
          "old_text": "DequantizeClassPredictions(input_class_predictions, num_boxes,\n                                 num_classes_with_background, temporary_scores)",
          "new_text": null,
          "old_line_content": "      DequantizeClassPredictions(input_class_predictions, num_boxes,",
          "new_line_content": "    case kTfLiteUInt8: {",
          "content_same": false
        },
        {
          "line": 820,
          "old_api": "DecodeCenterSizeBoxes",
          "new_api": null,
          "old_text": "DecodeCenterSizeBoxes(context, node, op_data)",
          "new_text": null,
          "old_line_content": "  TF_LITE_ENSURE_STATUS(DecodeCenterSizeBoxes(context, node, op_data));",
          "new_line_content": "  // by transforming input_box_encodings and input_anchors from",
          "content_same": false
        },
        {
          "line": 825,
          "old_api": "NonMaxSuppressionMultiClass",
          "new_api": null,
          "old_text": "NonMaxSuppressionMultiClass(context, node, op_data)",
          "new_text": null,
          "old_line_content": "  TF_LITE_ENSURE_STATUS(NonMaxSuppressionMultiClass(context, node, op_data));",
          "new_line_content": "  // based on Non Maximal Suppression, i.e. selecting",
          "content_same": false
        },
        {
          "line": 764,
          "old_api": "TF_LITE_ENSURE_OK",
          "new_api": null,
          "old_text": "TF_LITE_ENSURE_OK(context,\n                    GetInputSafe(context, node, kInputTensorBoxEncodings,\n                                 &input_box_encodings))",
          "new_text": null,
          "old_line_content": "  TF_LITE_ENSURE_OK(context,",
          "new_line_content": "  // Get the input tensors",
          "content_same": false
        },
        {
          "line": 765,
          "old_api": "GetInputSafe",
          "new_api": null,
          "old_text": "GetInputSafe(context, node, kInputTensorBoxEncodings,\n                                 &input_box_encodings)",
          "new_text": null,
          "old_line_content": "                    GetInputSafe(context, node, kInputTensorBoxEncodings,",
          "new_line_content": "  const TfLiteTensor* input_box_encodings;",
          "content_same": false
        },
        {
          "line": 798,
          "old_api": "NonMaxSuppressionMultiClassRegularHelper",
          "new_api": null,
          "old_text": "NonMaxSuppressionMultiClassRegularHelper(\n        context, node, op_data, GetTensorData<float>(scores))",
          "new_text": null,
          "old_line_content": "    TF_LITE_ENSURE_STATUS(NonMaxSuppressionMultiClassRegularHelper(",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 799,
          "old_api": "GetTensorData<float>(scores)",
          "new_api": null,
          "old_text": "GetTensorData<float>(scores)",
          "new_text": null,
          "old_line_content": "        context, node, op_data, GetTensorData<float>(scores)));",
          "new_line_content": "  if (op_data->use_regular_non_max_suppression)",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 2,
      "total_additions": 19,
      "total_deletions": 17,
      "total_api_changes": 38
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 7,
        "api_related_lines": 38,
        "non_api_lines": 2,
        "non_api_line_numbers": [
          753,
          755
        ]
      }
    },
    "api_calls_before": 242,
    "api_calls_after": 243,
    "diff_info": {
      "added_lines": 7,
      "removed_lines": 5,
      "total_diff_lines": 24
    }
  }
}