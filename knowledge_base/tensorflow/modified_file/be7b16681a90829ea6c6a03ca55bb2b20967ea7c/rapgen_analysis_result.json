{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/tensorflow/modified_file/be7b16681a90829ea6c6a03ca55bb2b20967ea7c",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/tensorflow/modified_file/be7b16681a90829ea6c6a03ca55bb2b20967ea7c/before.cc",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/tensorflow/modified_file/be7b16681a90829ea6c6a03ca55bb2b20967ea7c/after.cc",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/tensorflow/modified_file/be7b16681a90829ea6c6a03ca55bb2b20967ea7c/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 2618,
          "old_api": "end",
          "new_api": "name",
          "old_text": "instructions_by_name_.end()",
          "new_text": "instruction->name()",
          "old_line_content": "    TF_RET_CHECK(previous == instructions_by_name_.end())",
          "new_line_content": "        instructions_by_name_.insert({instruction->name(), instruction});",
          "content_same": false
        },
        {
          "line": 2629,
          "old_api": "shape",
          "new_api": "ok",
          "old_text": "instruction->shape()",
          "new_text": "status.ok()",
          "old_line_content": "          instruction->sharding().Validate(instruction->shape(), num_devices_);",
          "new_line_content": "      if (!status.ok()) {",
          "content_same": false
        },
        {
          "line": 2630,
          "old_api": "ok",
          "new_api": "code",
          "old_text": "status.ok()",
          "new_text": "status.code()",
          "old_line_content": "      if (!status.ok()) {",
          "new_line_content": "        return Status(status.code(),",
          "content_same": false
        },
        {
          "line": 2631,
          "old_api": "code",
          "new_api": "error_message",
          "old_text": "status.code()",
          "new_text": "absl::StrCat(\"Invalid sharding for instruction: \",\n                                   instruction->ToString(), \": \",\n                                   status.error_message())",
          "old_line_content": "        return Status(status.code(),",
          "new_line_content": "                      absl::StrCat(\"Invalid sharding for instruction: \",",
          "content_same": false
        },
        {
          "line": 2632,
          "old_api": "error_message",
          "new_api": "ToString",
          "old_text": "absl::StrCat(\"Invalid sharding for instruction: \",\n                                   instruction->ToString(), \": \",\n                                   status.error_message())",
          "new_text": "instruction->ToString()",
          "old_line_content": "                      absl::StrCat(\"Invalid sharding for instruction: \",",
          "new_line_content": "                                   instruction->ToString(), \": \",",
          "content_same": false
        },
        {
          "line": 2633,
          "old_api": "ToString",
          "new_api": "error_message",
          "old_text": "instruction->ToString()",
          "new_text": "status.error_message()",
          "old_line_content": "                                   instruction->ToString(), \": \",",
          "new_line_content": "                                   status.error_message()));",
          "content_same": false
        },
        {
          "line": 2642,
          "old_api": "InstructionCanChangeLayout",
          "new_api": "shape",
          "old_text": "opts_.InstructionCanChangeLayout(instruction)",
          "new_text": "instruction->shape()",
          "old_line_content": "    if (!opts_.InstructionCanChangeLayout(instruction) &&",
          "new_line_content": "        LayoutUtil::IsDenseArray(instruction->shape()) &&",
          "content_same": false
        },
        {
          "line": 2643,
          "old_api": "shape",
          "new_api": "has_layout",
          "old_text": "instruction->shape()",
          "new_text": "instruction->shape().has_layout()",
          "old_line_content": "        LayoutUtil::IsDenseArray(instruction->shape()) &&",
          "new_line_content": "        instruction->shape().has_layout()) {",
          "content_same": false
        },
        {
          "line": 2644,
          "old_api": "has_layout",
          "new_api": "shape",
          "old_text": "instruction->shape().has_layout()",
          "new_text": "instruction->shape()",
          "old_line_content": "        instruction->shape().has_layout()) {",
          "new_line_content": "      const Shape& result_shape = instruction->shape();",
          "content_same": false
        },
        {
          "line": 2645,
          "old_api": "shape",
          "new_api": "layout",
          "old_text": "instruction->shape()",
          "new_text": "result_shape.layout()",
          "old_line_content": "      const Shape& result_shape = instruction->shape();",
          "new_line_content": "      const Layout& result_layout = result_shape.layout();",
          "content_same": false
        },
        {
          "line": 2646,
          "old_api": "layout",
          "new_api": "operands",
          "old_text": "result_shape.layout()",
          "new_text": "instruction->operands()",
          "old_line_content": "      const Layout& result_layout = result_shape.layout();",
          "new_line_content": "      for (HloInstruction* operand : instruction->operands()) {",
          "content_same": false
        },
        {
          "line": 2647,
          "old_api": "operands",
          "new_api": "shape",
          "old_text": "instruction->operands()",
          "new_text": "operand->shape()",
          "old_line_content": "      for (HloInstruction* operand : instruction->operands()) {",
          "new_line_content": "        const Shape& operand_shape = operand->shape();",
          "content_same": false
        },
        {
          "line": 2648,
          "old_api": "shape",
          "new_api": "LayoutUtil::IsDenseArray(operand_shape)",
          "old_text": "operand->shape()",
          "new_text": "LayoutUtil::IsDenseArray(operand_shape)",
          "old_line_content": "        const Shape& operand_shape = operand->shape();",
          "new_line_content": "        if (LayoutUtil::IsDenseArray(operand_shape) &&",
          "content_same": false
        },
        {
          "line": 2649,
          "old_api": "LayoutUtil::IsDenseArray(operand_shape)",
          "new_api": "rank",
          "old_text": "LayoutUtil::IsDenseArray(operand_shape)",
          "new_text": "result_shape.rank()",
          "old_line_content": "        if (LayoutUtil::IsDenseArray(operand_shape) &&",
          "new_line_content": "            operand_shape.rank() == result_shape.rank() &&",
          "content_same": false
        },
        {
          "line": 2650,
          "old_api": "rank",
          "new_api": "has_layout",
          "old_text": "result_shape.rank()",
          "new_text": "operand_shape.has_layout()",
          "old_line_content": "            operand_shape.rank() == result_shape.rank() &&",
          "new_line_content": "            operand_shape.has_layout()) {",
          "content_same": false
        },
        {
          "line": 2651,
          "old_api": "has_layout",
          "new_api": "layout",
          "old_text": "operand_shape.has_layout()",
          "new_text": "operand_shape.layout()",
          "old_line_content": "            operand_shape.has_layout()) {",
          "new_line_content": "          const Layout& operand_layout = operand_shape.layout();",
          "content_same": false
        },
        {
          "line": 2652,
          "old_api": "layout",
          "new_api": "LayoutUtil::Equal(result_layout, operand_layout)",
          "old_text": "operand_shape.layout()",
          "new_text": "LayoutUtil::Equal(result_layout, operand_layout)",
          "old_line_content": "          const Layout& operand_layout = operand_shape.layout();",
          "new_line_content": "          TF_RET_CHECK(LayoutUtil::Equal(result_layout, operand_layout))",
          "content_same": false
        },
        {
          "line": 2678,
          "old_api": "sharding",
          "new_api": "opcode",
          "old_text": "common_sharding_inst->sharding()",
          "new_text": "parent->opcode()",
          "old_line_content": "      TF_RET_CHECK(check_inst->sharding() == common_sharding_inst->sharding())",
          "new_line_content": "          << \"Inconsistent \" << HloOpcodeString(parent->opcode())",
          "content_same": false
        },
        {
          "line": 2688,
          "old_api": "operands",
          "new_api": "shape",
          "old_text": "instruction->operands()",
          "new_text": "operand->shape()",
          "old_line_content": "    for (HloInstruction* operand : instruction->operands()) {",
          "new_line_content": "      if (ShapeUtil::HasPrimitiveType(operand->shape(), F8E5M2) ||",
          "content_same": false
        },
        {
          "line": 2699,
          "old_api": "operands",
          "new_api": "shape",
          "old_text": "instruction->operands()",
          "new_text": "operand->shape()",
          "old_line_content": "        absl::c_any_of(instruction->operands(), [](HloInstruction* operand) {",
          "new_line_content": "          return ShapeUtil::HasPrimitiveType(operand->shape(), F8E5M2) ||",
          "content_same": false
        },
        {
          "line": 2706,
          "old_api": "opcode",
          "new_api": "ToString",
          "old_text": "instruction->opcode()",
          "new_text": "InvalidArgument(\n          \"FP8 is currently only supported in convert instructions, but got \"\n          \"instruction with FP8 input: %s\",\n          instruction->ToString())",
          "old_line_content": "    if (has_fp8_operand && instruction->opcode() != HloOpcode::kConvert) {",
          "new_line_content": "      return InvalidArgument(",
          "content_same": false
        },
        {
          "line": 2725,
          "old_api": "debug_options",
          "new_api": "end",
          "old_text": "module->config().debug_options().xla_disable_hlo_passes()",
          "new_text": "disabled.end()",
          "old_line_content": "  auto disabled = module->config().debug_options().xla_disable_hlo_passes();",
          "new_line_content": "  if (std::find(disabled.begin(), disabled.end(), name()) != disabled.end()) {",
          "content_same": false
        },
        {
          "line": 2732,
          "old_api": "entry_computation",
          "new_api": "InvalidArgument",
          "old_text": "module->entry_computation()->IsFusionComputation()",
          "new_text": "InvalidArgument(\n          \"Module entry computation cannot be a fusion computation\")",
          "old_line_content": "    if (module->entry_computation()->IsFusionComputation()) {",
          "new_line_content": "      return InvalidArgument(",
          "content_same": false
        },
        {
          "line": 2737,
          "old_api": "VerifyHloStructure",
          "new_api": "VerifyAsynchronousInstructionPairs",
          "old_text": "VerifyHloStructure(module)",
          "new_text": "VerifyAsynchronousInstructionPairs(*module)",
          "old_line_content": "    TF_RETURN_IF_ERROR(VerifyHloStructure(module));",
          "new_line_content": "    TF_RETURN_IF_ERROR(VerifyAsynchronousInstructionPairs(*module));",
          "content_same": false
        },
        {
          "line": 2738,
          "old_api": "VerifyAsynchronousInstructionPairs",
          "new_api": "VerifyChannels",
          "old_text": "VerifyAsynchronousInstructionPairs(*module)",
          "new_text": "VerifyChannels(*module)",
          "old_line_content": "    TF_RETURN_IF_ERROR(VerifyAsynchronousInstructionPairs(*module));",
          "new_line_content": "    TF_RETURN_IF_ERROR(VerifyChannels(*module));",
          "content_same": false
        },
        {
          "line": 2744,
          "old_api": "GetVerifierOpts",
          "new_api": "computations",
          "old_text": "target_metadata_->GetVerifierOpts()",
          "new_text": "module->computations(execution_threads)",
          "old_line_content": "        module, target_metadata_->GetVerifierOpts());",
          "new_line_content": "    for (auto* computation : module->computations(execution_threads)) {",
          "content_same": false
        },
        {
          "line": 2745,
          "old_api": "computations",
          "new_api": "get",
          "old_text": "module->computations(execution_threads)",
          "new_text": "shape_verifier.get()",
          "old_line_content": "    for (auto* computation : module->computations(execution_threads)) {",
          "new_line_content": "      TF_RETURN_IF_ERROR(computation->Accept(shape_verifier.get()));",
          "content_same": false
        },
        {
          "line": 2746,
          "old_api": "get",
          "new_api": "Accept",
          "old_text": "shape_verifier.get()",
          "new_text": "computation->Accept(&instruction_verifier)",
          "old_line_content": "      TF_RETURN_IF_ERROR(computation->Accept(shape_verifier.get()));",
          "new_line_content": "      TF_RETURN_IF_ERROR(computation->Accept(&instruction_verifier));",
          "content_same": false
        },
        {
          "line": 2750,
          "old_api": "VerifyEntryComputationLayout",
          "new_api": "VerifyEntryAndExitShapes",
          "old_text": "shape_verifier->VerifyEntryComputationLayout(*module)",
          "new_text": "VerifyEntryAndExitShapes(*module)",
          "old_line_content": "    TF_RETURN_IF_ERROR(shape_verifier->VerifyEntryComputationLayout(*module));",
          "new_line_content": "    TF_RETURN_IF_ERROR(VerifyEntryAndExitShapes(*module));",
          "content_same": false
        },
        {
          "line": 2754,
          "old_api": "has_schedule",
          "new_api": "Verify",
          "old_text": "module->has_schedule()",
          "new_text": "module->schedule().Verify()",
          "old_line_content": "    if (module->has_schedule()) {",
          "new_line_content": "      TF_RETURN_IF_ERROR(module->schedule().Verify());",
          "content_same": false
        },
        {
          "line": 2760,
          "old_api": "IsLayoutSensitive",
          "new_api": "ShapeSize",
          "old_text": "target_metadata_->GetVerifierOpts().IsLayoutSensitive()",
          "new_text": "target_metadata_->GetVerifierOpts().ShapeSize(shape)",
          "old_line_content": "          if (target_metadata_->GetVerifierOpts().IsLayoutSensitive()) {",
          "new_line_content": "            return target_metadata_->GetVerifierOpts().ShapeSize(shape);",
          "content_same": false
        },
        {
          "line": 2767,
          "old_api": "Verify",
          "new_api": "VerifyLayoutConstrainedAllReduce",
          "old_text": "module->dynamic_parameter_binding().Verify(*module)",
          "new_text": "VerifyLayoutConstrainedAllReduce(*module)",
          "old_line_content": "    TF_RETURN_IF_ERROR(module->dynamic_parameter_binding().Verify(*module));",
          "new_line_content": "    TF_RETURN_IF_ERROR(VerifyLayoutConstrainedAllReduce(*module));",
          "content_same": false
        },
        {
          "line": 2771,
          "old_api": "ok",
          "new_api": "value",
          "old_text": "status_or_changed.ok()",
          "new_text": "status_or_changed.value()",
          "old_line_content": "  if (status_or_changed.ok()) {",
          "new_line_content": "    return status_or_changed.value();",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 2698,
          "old_api": null,
          "new_api": "operands",
          "old_text": null,
          "new_text": "instruction->operands()",
          "old_line_content": "    bool has_fp8_operand =",
          "new_line_content": "        absl::c_any_of(instruction->operands(), [](HloInstruction* operand) {",
          "content_same": false
        },
        {
          "line": 2705,
          "old_api": null,
          "new_api": "opcode",
          "old_text": null,
          "new_text": "instruction->opcode()",
          "old_line_content": "    // only support FP8 operands in the convert instruction.",
          "new_line_content": "    if (has_fp8_operand && instruction->opcode() != HloOpcode::kConvert) {",
          "content_same": false
        },
        {
          "line": 2709,
          "old_api": null,
          "new_api": "ToString",
          "old_text": null,
          "new_text": "instruction->ToString()",
          "old_line_content": "          \"instruction with FP8 input: %s\",",
          "new_line_content": "          instruction->ToString());",
          "content_same": false
        },
        {
          "line": 2711,
          "old_api": null,
          "new_api": "OkStatus",
          "old_text": null,
          "new_text": "OkStatus()",
          "old_line_content": "    }",
          "new_line_content": "    return OkStatus();",
          "content_same": false
        },
        {
          "line": 2724,
          "old_api": null,
          "new_api": "debug_options",
          "old_text": null,
          "new_text": "module->config().debug_options().xla_disable_hlo_passes()",
          "old_line_content": "    const absl::flat_hash_set<absl::string_view>& execution_threads) {",
          "new_line_content": "  auto disabled = module->config().debug_options().xla_disable_hlo_passes();",
          "content_same": false
        },
        {
          "line": 2728,
          "old_api": null,
          "new_api": "empty",
          "old_text": null,
          "new_text": "() -> StatusOr<bool> {\n    TF_RET_CHECK(!module->name().empty());\n\n    if (module->entry_computation()->IsFusionComputation()) {\n      return InvalidArgument(\n          \"Module entry computation cannot be a fusion computation\");\n    }\n\n    TF_RETURN_IF_ERROR(VerifyHloStructure(module));\n    TF_RETURN_IF_ERROR(VerifyAsynchronousInstructionPairs(*module));\n    TF_RETURN_IF_ERROR(VerifyChannels(*module));\n\n    std::unique_ptr<ShapeVerifier> shape_verifier =\n        target_metadata_->GetVerifier();\n    InstructionVerifier instruction_verifier(\n        module, target_metadata_->GetVerifierOpts());\n    for (auto* computation : module->computations(execution_threads)) {\n      TF_RETURN_IF_ERROR(computation->Accept(shape_verifier.get()));\n      TF_RETURN_IF_ERROR(computation->Accept(&instruction_verifier));\n    }\n\n    TF_RETURN_IF_ERROR(shape_verifier->VerifyEntryComputationLayout(*module));\n    TF_RETURN_IF_ERROR(VerifyEntryAndExitShapes(*module));\n\n    // If the module has a schedule, it must be valid.\n    if (module->has_schedule()) {\n      TF_RETURN_IF_ERROR(module->schedule().Verify());\n    }\n\n    TF_RETURN_IF_ERROR(module->input_output_alias_config().Verify(\n        *module, [this](const Shape& shape) -> int64_t {\n          if (target_metadata_->GetVerifierOpts().IsLayoutSensitive()) {\n            return target_metadata_->GetVerifierOpts().ShapeSize(shape);\n          } else {\n            return 0;\n          }\n        }));\n\n    TF_RETURN_IF_ERROR(module->dynamic_parameter_binding().Verify(*module));\n    TF_RETURN_IF_ERROR(VerifyLayoutConstrainedAllReduce(*module));\n    return false;\n  }()",
          "old_line_content": "  }",
          "new_line_content": "  auto status_or_changed = [&]() -> StatusOr<bool> {",
          "content_same": false
        },
        {
          "line": 2731,
          "old_api": null,
          "new_api": "entry_computation",
          "old_text": null,
          "new_text": "module->entry_computation()->IsFusionComputation()",
          "old_line_content": "",
          "new_line_content": "    if (module->entry_computation()->IsFusionComputation()) {",
          "content_same": false
        },
        {
          "line": 2736,
          "old_api": null,
          "new_api": "VerifyHloStructure",
          "old_text": null,
          "new_text": "VerifyHloStructure(module)",
          "old_line_content": "",
          "new_line_content": "    TF_RETURN_IF_ERROR(VerifyHloStructure(module));",
          "content_same": false
        },
        {
          "line": 2741,
          "old_api": null,
          "new_api": "GetVerifier",
          "old_text": null,
          "new_text": "target_metadata_->GetVerifier()",
          "old_line_content": "    std::unique_ptr<ShapeVerifier> shape_verifier =",
          "new_line_content": "        target_metadata_->GetVerifier();",
          "content_same": false
        },
        {
          "line": 2743,
          "old_api": null,
          "new_api": "GetVerifierOpts",
          "old_text": null,
          "new_text": "target_metadata_->GetVerifierOpts()",
          "old_line_content": "    InstructionVerifier instruction_verifier(",
          "new_line_content": "        module, target_metadata_->GetVerifierOpts());",
          "content_same": false
        },
        {
          "line": 2619,
          "old_api": null,
          "new_api": "TF_RET_CHECK",
          "old_text": null,
          "new_text": "TF_RET_CHECK(inserted)",
          "old_line_content": "        << \"HLO has name that is not unique within module:\\n\"",
          "new_line_content": "    TF_RET_CHECK(inserted) << \"HLO has name that is not unique within module:\\n\"",
          "content_same": false
        },
        {
          "line": 2749,
          "old_api": null,
          "new_api": "VerifyEntryComputationLayout",
          "old_text": null,
          "new_text": "shape_verifier->VerifyEntryComputationLayout(*module)",
          "old_line_content": "",
          "new_line_content": "    TF_RETURN_IF_ERROR(shape_verifier->VerifyEntryComputationLayout(*module));",
          "content_same": false
        },
        {
          "line": 2753,
          "old_api": null,
          "new_api": "has_schedule",
          "old_text": null,
          "new_text": "module->has_schedule()",
          "old_line_content": "    // If the module has a schedule, it must be valid.",
          "new_line_content": "    if (module->has_schedule()) {",
          "content_same": false
        },
        {
          "line": 2626,
          "old_api": null,
          "new_api": "has_sharding",
          "old_text": null,
          "new_text": "instruction->has_sharding()",
          "old_line_content": "",
          "new_line_content": "    if (instruction->has_sharding()) {",
          "content_same": false
        },
        {
          "line": 2628,
          "old_api": null,
          "new_api": "shape",
          "old_text": null,
          "new_text": "instruction->shape()",
          "old_line_content": "      Status status =",
          "new_line_content": "          instruction->sharding().Validate(instruction->shape(), num_devices_);",
          "content_same": false
        },
        {
          "line": 2757,
          "old_api": null,
          "new_api": "Verify",
          "old_text": null,
          "new_text": "module->input_output_alias_config().Verify(\n        *module, [this](const Shape& shape) -> int64_t {\n          if (target_metadata_->GetVerifierOpts().IsLayoutSensitive()) {\n            return target_metadata_->GetVerifierOpts().ShapeSize(shape);\n          } else {\n            return 0;\n          }\n        })",
          "old_line_content": "",
          "new_line_content": "    TF_RETURN_IF_ERROR(module->input_output_alias_config().Verify(",
          "content_same": false
        },
        {
          "line": 2759,
          "old_api": null,
          "new_api": "IsLayoutSensitive",
          "old_text": null,
          "new_text": "target_metadata_->GetVerifierOpts().IsLayoutSensitive()",
          "old_line_content": "        *module, [this](const Shape& shape) -> int64_t {",
          "new_line_content": "          if (target_metadata_->GetVerifierOpts().IsLayoutSensitive()) {",
          "content_same": false
        },
        {
          "line": 2637,
          "old_api": null,
          "new_api": "OkStatus",
          "old_text": null,
          "new_text": "OkStatus()",
          "old_line_content": "",
          "new_line_content": "    return OkStatus();",
          "content_same": false
        },
        {
          "line": 2766,
          "old_api": null,
          "new_api": "Verify",
          "old_text": null,
          "new_text": "module->dynamic_parameter_binding().Verify(*module)",
          "old_line_content": "",
          "new_line_content": "    TF_RETURN_IF_ERROR(module->dynamic_parameter_binding().Verify(*module));",
          "content_same": false
        },
        {
          "line": 2641,
          "old_api": null,
          "new_api": "InstructionCanChangeLayout",
          "old_text": null,
          "new_text": "opts_.InstructionCanChangeLayout(instruction)",
          "old_line_content": "  Status Postprocess(HloInstruction* instruction) override {",
          "new_line_content": "    if (!opts_.InstructionCanChangeLayout(instruction) &&",
          "content_same": false
        },
        {
          "line": 2770,
          "old_api": null,
          "new_api": "ok",
          "old_text": null,
          "new_text": "status_or_changed.ok()",
          "old_line_content": "  }();",
          "new_line_content": "  if (status_or_changed.ok()) {",
          "content_same": false
        },
        {
          "line": 2773,
          "old_api": null,
          "new_api": "status",
          "old_text": null,
          "new_text": "status_or_changed.status().code()",
          "old_line_content": "  }",
          "new_line_content": "  return Status(status_or_changed.status().code(),",
          "content_same": false
        },
        {
          "line": 2654,
          "old_api": null,
          "new_api": "ToString",
          "old_text": null,
          "new_text": "instruction->ToString()",
          "old_line_content": "              << \"Instruction shouldn't change layouts \"",
          "new_line_content": "              << instruction->ToString() << \" From \" << result_shape << \" To \"",
          "content_same": false
        },
        {
          "line": 2659,
          "old_api": null,
          "new_api": "VerifyF8Usage",
          "old_text": null,
          "new_text": "VerifyF8Usage(instruction)",
          "old_line_content": "    }",
          "new_line_content": "    TF_RETURN_IF_ERROR(VerifyF8Usage(instruction));",
          "content_same": false
        },
        {
          "line": 2661,
          "old_api": null,
          "new_api": "OkStatus",
          "old_text": null,
          "new_text": "OkStatus()",
          "old_line_content": "",
          "new_line_content": "    return OkStatus();",
          "content_same": false
        },
        {
          "line": 2670,
          "old_api": null,
          "new_api": "has_sharding",
          "old_text": null,
          "new_text": "check_inst->has_sharding()",
          "old_line_content": "    for (const HloInstruction* check_inst : instructions) {",
          "new_line_content": "      if (!check_inst->has_sharding()) {",
          "content_same": false
        },
        {
          "line": 2677,
          "old_api": null,
          "new_api": "sharding",
          "old_text": null,
          "new_text": "common_sharding_inst->sharding()",
          "old_line_content": "      }",
          "new_line_content": "      TF_RET_CHECK(check_inst->sharding() == common_sharding_inst->sharding())",
          "content_same": false
        },
        {
          "line": 2680,
          "old_api": null,
          "new_api": "ToString",
          "old_text": null,
          "new_text": "common_sharding_inst->ToString()",
          "old_line_content": "          << \" sharding among instructions: \\n\"",
          "new_line_content": "          << common_sharding_inst->ToString() << \"\\n\"",
          "content_same": false
        },
        {
          "line": 2683,
          "old_api": null,
          "new_api": "OkStatus",
          "old_text": null,
          "new_text": "OkStatus()",
          "old_line_content": "    }",
          "new_line_content": "    return OkStatus();",
          "content_same": false
        },
        {
          "line": 2687,
          "old_api": null,
          "new_api": "operands",
          "old_text": null,
          "new_text": "instruction->operands()",
          "old_line_content": "  static bool HasFp8Operand(HloInstruction* instruction) {",
          "new_line_content": "    for (HloInstruction* operand : instruction->operands()) {",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 2690,
          "old_api": "shape",
          "new_api": null,
          "old_text": "operand->shape()",
          "new_text": null,
          "old_line_content": "          ShapeUtil::HasPrimitiveType(operand->shape(), F8E4M3FN)) {",
          "new_line_content": "        return true;",
          "content_same": false
        },
        {
          "line": 2701,
          "old_api": "shape",
          "new_api": null,
          "old_text": "operand->shape()",
          "new_text": null,
          "old_line_content": "                 ShapeUtil::HasPrimitiveType(operand->shape(), F8E4M3FN);",
          "new_line_content": "        });",
          "content_same": false
        },
        {
          "line": 2707,
          "old_api": "ToString",
          "new_api": null,
          "old_text": "InvalidArgument(\n          \"FP8 is currently only supported in convert instructions, but got \"\n          \"instruction with FP8 input: %s\",\n          instruction->ToString())",
          "new_text": null,
          "old_line_content": "      return InvalidArgument(",
          "new_line_content": "          \"FP8 is currently only supported in convert instructions, but got \"",
          "content_same": false
        },
        {
          "line": 2710,
          "old_api": "ToString",
          "new_api": null,
          "old_text": "instruction->ToString()",
          "new_text": null,
          "old_line_content": "          instruction->ToString());",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 2712,
          "old_api": "OkStatus",
          "new_api": null,
          "old_text": "OkStatus()",
          "new_text": null,
          "old_line_content": "    return OkStatus();",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 2726,
          "old_api": "end",
          "new_api": null,
          "old_text": "disabled.end()",
          "new_text": null,
          "old_line_content": "  if (std::find(disabled.begin(), disabled.end(), name()) != disabled.end()) {",
          "new_line_content": "    return false;",
          "content_same": false
        },
        {
          "line": 2730,
          "old_api": "empty",
          "new_api": null,
          "old_text": "module->name().empty()",
          "new_text": null,
          "old_line_content": "    TF_RET_CHECK(!module->name().empty());",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2733,
          "old_api": "InvalidArgument",
          "new_api": null,
          "old_text": "InvalidArgument(\n          \"Module entry computation cannot be a fusion computation\")",
          "new_text": null,
          "old_line_content": "      return InvalidArgument(",
          "new_line_content": "          \"Module entry computation cannot be a fusion computation\");",
          "content_same": false
        },
        {
          "line": 2739,
          "old_api": "VerifyChannels",
          "new_api": null,
          "old_text": "VerifyChannels(*module)",
          "new_text": null,
          "old_line_content": "    TF_RETURN_IF_ERROR(VerifyChannels(*module));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2742,
          "old_api": "GetVerifier",
          "new_api": null,
          "old_text": "target_metadata_->GetVerifier()",
          "new_text": null,
          "old_line_content": "        target_metadata_->GetVerifier();",
          "new_line_content": "    InstructionVerifier instruction_verifier(",
          "content_same": false
        },
        {
          "line": 2617,
          "old_api": "name",
          "new_api": null,
          "old_text": "instruction->name()",
          "new_text": null,
          "old_line_content": "    auto previous = instructions_by_name_.find(instruction->name());",
          "new_line_content": "    auto [it, inserted] =",
          "content_same": false
        },
        {
          "line": 2747,
          "old_api": "Accept",
          "new_api": null,
          "old_text": "computation->Accept(&instruction_verifier)",
          "new_text": null,
          "old_line_content": "      TF_RETURN_IF_ERROR(computation->Accept(&instruction_verifier));",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 2751,
          "old_api": "VerifyEntryAndExitShapes",
          "new_api": null,
          "old_text": "VerifyEntryAndExitShapes(*module)",
          "new_text": null,
          "old_line_content": "    TF_RETURN_IF_ERROR(VerifyEntryAndExitShapes(*module));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2625,
          "old_api": "name",
          "new_api": null,
          "old_text": "instruction->name()",
          "new_text": null,
          "old_line_content": "    instructions_by_name_[instruction->name()] = instruction;",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2627,
          "old_api": "has_sharding",
          "new_api": null,
          "old_text": "instruction->has_sharding()",
          "new_text": null,
          "old_line_content": "    if (instruction->has_sharding()) {",
          "new_line_content": "      Status status =",
          "content_same": false
        },
        {
          "line": 2755,
          "old_api": "Verify",
          "new_api": null,
          "old_text": "module->schedule().Verify()",
          "new_text": null,
          "old_line_content": "      TF_RETURN_IF_ERROR(module->schedule().Verify());",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 2758,
          "old_api": "Verify",
          "new_api": null,
          "old_text": "module->input_output_alias_config().Verify(\n        *module, [this](const Shape& shape) -> int64_t {\n          if (target_metadata_->GetVerifierOpts().IsLayoutSensitive()) {\n            return target_metadata_->GetVerifierOpts().ShapeSize(shape);\n          } else {\n            return 0;\n          }\n        })",
          "new_text": null,
          "old_line_content": "    TF_RETURN_IF_ERROR(module->input_output_alias_config().Verify(",
          "new_line_content": "        *module, [this](const Shape& shape) -> int64_t {",
          "content_same": false
        },
        {
          "line": 2761,
          "old_api": "ShapeSize",
          "new_api": null,
          "old_text": "target_metadata_->GetVerifierOpts().ShapeSize(shape)",
          "new_text": null,
          "old_line_content": "            return target_metadata_->GetVerifierOpts().ShapeSize(shape);",
          "new_line_content": "          } else {",
          "content_same": false
        },
        {
          "line": 2634,
          "old_api": "error_message",
          "new_api": null,
          "old_text": "status.error_message()",
          "new_text": null,
          "old_line_content": "                                   status.error_message()));",
          "new_line_content": "      }",
          "content_same": false
        },
        {
          "line": 2638,
          "old_api": "OkStatus",
          "new_api": null,
          "old_text": "OkStatus()",
          "new_text": null,
          "old_line_content": "    return OkStatus();",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 2768,
          "old_api": "VerifyLayoutConstrainedAllReduce",
          "new_api": null,
          "old_text": "VerifyLayoutConstrainedAllReduce(*module)",
          "new_text": null,
          "old_line_content": "    TF_RETURN_IF_ERROR(VerifyLayoutConstrainedAllReduce(*module));",
          "new_line_content": "    return false;",
          "content_same": false
        },
        {
          "line": 2772,
          "old_api": "value",
          "new_api": null,
          "old_text": "status_or_changed.value()",
          "new_text": null,
          "old_line_content": "    return status_or_changed.value();",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 2776,
          "old_api": "status",
          "new_api": null,
          "old_text": "status_or_changed.status().error_message()",
          "new_text": null,
          "old_line_content": "                             status_or_changed.status().error_message()));",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 2653,
          "old_api": "LayoutUtil::Equal(result_layout, operand_layout)",
          "new_api": null,
          "old_text": "LayoutUtil::Equal(result_layout, operand_layout)",
          "new_text": null,
          "old_line_content": "          TF_RET_CHECK(LayoutUtil::Equal(result_layout, operand_layout))",
          "new_line_content": "              << \"Instruction shouldn't change layouts \"",
          "content_same": false
        },
        {
          "line": 2655,
          "old_api": "ToString",
          "new_api": null,
          "old_text": "instruction->ToString()",
          "new_text": null,
          "old_line_content": "              << instruction->ToString() << \" From \" << result_shape << \" To \"",
          "new_line_content": "              << operand_shape;",
          "content_same": false
        },
        {
          "line": 2660,
          "old_api": "VerifyF8Usage",
          "new_api": null,
          "old_text": "VerifyF8Usage(instruction)",
          "new_text": null,
          "old_line_content": "    TF_RETURN_IF_ERROR(VerifyF8Usage(instruction));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2662,
          "old_api": "OkStatus",
          "new_api": null,
          "old_text": "OkStatus()",
          "new_text": null,
          "old_line_content": "    return OkStatus();",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 2671,
          "old_api": "has_sharding",
          "new_api": null,
          "old_text": "check_inst->has_sharding()",
          "new_text": null,
          "old_line_content": "      if (!check_inst->has_sharding()) {",
          "new_line_content": "        continue;",
          "content_same": false
        },
        {
          "line": 2679,
          "old_api": "opcode",
          "new_api": null,
          "old_text": "parent->opcode()",
          "new_text": null,
          "old_line_content": "          << \"Inconsistent \" << HloOpcodeString(parent->opcode())",
          "new_line_content": "          << \" sharding among instructions: \\n\"",
          "content_same": false
        },
        {
          "line": 2682,
          "old_api": "ToString",
          "new_api": null,
          "old_text": "check_inst->ToString()",
          "new_text": null,
          "old_line_content": "          << check_inst->ToString();",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 2684,
          "old_api": "OkStatus",
          "new_api": null,
          "old_text": "OkStatus()",
          "new_text": null,
          "old_line_content": "    return OkStatus();",
          "new_line_content": "  }",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 33,
      "total_additions": 30,
      "total_deletions": 31,
      "total_api_changes": 94
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 9,
        "api_related_lines": 94,
        "non_api_lines": 5,
        "non_api_line_numbers": [
          2624,
          2620,
          2621,
          2622,
          2623
        ]
      }
    },
    "api_calls_before": 1846,
    "api_calls_after": 1844,
    "diff_info": {
      "added_lines": 8,
      "removed_lines": 9,
      "total_diff_lines": 29
    }
  }
}