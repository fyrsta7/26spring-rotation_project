{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/tensorflow/modified_file/2e73f722e514124c7aa94b018b1cf62a8004cb44",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/tensorflow/modified_file/2e73f722e514124c7aa94b018b1cf62a8004cb44/before.cc",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/tensorflow/modified_file/2e73f722e514124c7aa94b018b1cf62a8004cb44/after.cc",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/tensorflow/modified_file/2e73f722e514124c7aa94b018b1cf62a8004cb44/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": true,
    "api_changes": {
      "replacements": [
        {
          "line": 236,
          "old_api": "grpc::CreateCustomChannel(address_, credentials, args)",
          "new_api": "SetInt",
          "old_text": "grpc::CreateCustomChannel(address_, credentials, args)",
          "new_text": "args.SetInt(GRPC_ARG_USE_LOCAL_SUBCHANNEL_POOL, true)",
          "old_line_content": "  auto channel = grpc::CreateCustomChannel(address_, credentials, args);",
          "new_line_content": "  args.SetInt(GRPC_ARG_USE_LOCAL_SUBCHANNEL_POOL, true);",
          "content_same": false
        },
        {
          "line": 237,
          "old_api": "DispatcherService::NewStub(channel)",
          "new_api": "grpc::CreateCustomChannel(address_, credentials, args)",
          "old_text": "DispatcherService::NewStub(channel)",
          "new_text": "grpc::CreateCustomChannel(address_, credentials, args)",
          "old_line_content": "  stub_ = DispatcherService::NewStub(channel);",
          "new_line_content": "  auto channel = grpc::CreateCustomChannel(address_, credentials, args);",
          "content_same": false
        },
        {
          "line": 238,
          "old_api": "Status::OK()",
          "new_api": "DispatcherService::NewStub(channel)",
          "old_text": "Status::OK()",
          "new_text": "DispatcherService::NewStub(channel)",
          "old_line_content": "  return Status::OK();",
          "new_line_content": "  stub_ = DispatcherService::NewStub(channel);",
          "content_same": false
        },
        {
          "line": 247,
          "old_api": "grpc::CreateCustomChannel(address, credentials, args)",
          "new_api": "SetMaxReceiveMessageSize",
          "old_text": "grpc::CreateCustomChannel(address, credentials, args)",
          "new_text": "args.SetMaxReceiveMessageSize(-1)",
          "old_line_content": "    auto channel = grpc::CreateCustomChannel(address, credentials, args);",
          "new_line_content": "    args.SetMaxReceiveMessageSize(-1);",
          "content_same": false
        },
        {
          "line": 248,
          "old_api": "WorkerService::NewStub(channel)",
          "new_api": "grpc::CreateCustomChannel(address, credentials, args)",
          "old_text": "WorkerService::NewStub(channel)",
          "new_text": "grpc::CreateCustomChannel(address, credentials, args)",
          "old_line_content": "    stub_ = WorkerService::NewStub(channel);",
          "new_line_content": "    auto channel = grpc::CreateCustomChannel(address, credentials, args);",
          "content_same": false
        },
        {
          "line": 270,
          "old_api": "grpc_util::WrapError(\"Failed to get element\", s)",
          "new_api": "ok",
          "old_text": "grpc_util::WrapError(\"Failed to get element\", s)",
          "new_text": "s.ok()",
          "old_line_content": "      return grpc_util::WrapError(\"Failed to get element\", s);",
          "new_line_content": "    if (!s.ok()) {",
          "content_same": false
        },
        {
          "line": 315,
          "old_api": "GetElement",
          "new_api": "EnsureInitialized",
          "old_text": "client_->GetElement(req, resp)",
          "new_text": "EnsureInitialized()",
          "old_line_content": "  return client_->GetElement(req, resp);",
          "new_line_content": "  TF_RETURN_IF_ERROR(EnsureInitialized());",
          "content_same": false
        },
        {
          "line": 335,
          "old_api": "Initialize",
          "new_api": "absl::make_unique<DataServiceDispatcherClient>(address, protocol)",
          "old_text": "client->Initialize()",
          "new_text": "absl::make_unique<DataServiceDispatcherClient>(address, protocol)",
          "old_line_content": "  TF_RETURN_IF_ERROR(client->Initialize());",
          "new_line_content": "      absl::make_unique<DataServiceDispatcherClient>(address, protocol);",
          "content_same": false
        },
        {
          "line": 336,
          "old_api": "std::move(client)",
          "new_api": "Initialize",
          "old_text": "std::move(client)",
          "new_text": "client->Initialize()",
          "old_line_content": "  out = std::move(client);",
          "new_line_content": "  TF_RETURN_IF_ERROR(client->Initialize());",
          "content_same": false
        },
        {
          "line": 337,
          "old_api": "Status::OK()",
          "new_api": "std::move(client)",
          "old_text": "Status::OK()",
          "new_text": "std::move(client)",
          "old_line_content": "  return Status::OK();",
          "new_line_content": "  out = std::move(client);",
          "content_same": false
        },
        {
          "line": 347,
          "old_api": "std::move(client)",
          "new_api": "Initialize",
          "old_text": "std::move(client)",
          "new_text": "client->Initialize()",
          "old_line_content": "  out = std::move(client);",
          "new_line_content": "  TF_RETURN_IF_ERROR(client->Initialize());",
          "content_same": false
        },
        {
          "line": 348,
          "old_api": "Status::OK()",
          "new_api": "std::move(client)",
          "old_text": "Status::OK()",
          "new_text": "std::move(client)",
          "old_line_content": "  return Status::OK();",
          "new_line_content": "  out = std::move(client);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 257,
          "old_api": null,
          "new_api": "errors::Cancelled(\"Client was cancelled.\")",
          "old_text": null,
          "new_text": "errors::Cancelled(\"Client was cancelled.\")",
          "old_line_content": "      }",
          "new_line_content": "        return errors::Cancelled(\"Client was cancelled.\");",
          "content_same": false
        },
        {
          "line": 263,
          "old_api": null,
          "new_api": "insert",
          "old_text": null,
          "new_text": "active_contexts_.insert(&ctx)",
          "old_line_content": "    }",
          "new_line_content": "      active_contexts_.insert(&ctx);",
          "content_same": false
        },
        {
          "line": 265,
          "old_api": null,
          "new_api": "GetElement",
          "old_text": null,
          "new_text": "stub_->GetElement(&ctx, req, &resp)",
          "old_line_content": "    {",
          "new_line_content": "    grpc::Status s = stub_->GetElement(&ctx, req, &resp);",
          "content_same": false
        },
        {
          "line": 268,
          "old_api": null,
          "new_api": "erase",
          "old_text": null,
          "new_text": "active_contexts_.erase(&ctx)",
          "old_line_content": "    }",
          "new_line_content": "      active_contexts_.erase(&ctx);",
          "content_same": false
        },
        {
          "line": 271,
          "old_api": null,
          "new_api": "grpc_util::WrapError(\"Failed to get element\", s)",
          "old_text": null,
          "new_text": "grpc_util::WrapError(\"Failed to get element\", s)",
          "old_line_content": "    }",
          "new_line_content": "      return grpc_util::WrapError(\"Failed to get element\", s);",
          "content_same": false
        },
        {
          "line": 273,
          "old_api": null,
          "new_api": "Status::OK()",
          "old_text": null,
          "new_text": "Status::OK()",
          "old_line_content": "  }",
          "new_line_content": "    return Status::OK();",
          "content_same": false
        },
        {
          "line": 280,
          "old_api": null,
          "new_api": "TryCancel",
          "old_text": null,
          "new_text": "ctx->TryCancel()",
          "old_line_content": "    }",
          "new_line_content": "      ctx->TryCancel();",
          "content_same": false
        },
        {
          "line": 299,
          "old_api": null,
          "new_api": "DataTransferClient::Register(\n        \"grpc\", [](DataTransferClient::Config config,\n                   std::unique_ptr<DataTransferClient>* out) {\n          std::shared_ptr<grpc::ChannelCredentials> credentials;\n          TF_RETURN_IF_ERROR(CredentialsFactory::CreateClientCredentials(\n              config.protocol, &credentials));\n          *out = std::make_unique<GrpcDataTransferClient>(credentials,\n                                                          config.address);\n          return Status::OK();\n        })",
          "old_text": null,
          "new_text": "DataTransferClient::Register(\n        \"grpc\", [](DataTransferClient::Config config,\n                   std::unique_ptr<DataTransferClient>* out) {\n          std::shared_ptr<grpc::ChannelCredentials> credentials;\n          TF_RETURN_IF_ERROR(CredentialsFactory::CreateClientCredentials(\n              config.protocol, &credentials));\n          *out = std::make_unique<GrpcDataTransferClient>(credentials,\n                                                          config.address);\n          return Status::OK();\n        })",
          "old_line_content": "        \"grpc\", [](DataTransferClient::Config config,",
          "new_line_content": "    DataTransferClient::Register(",
          "content_same": false
        },
        {
          "line": 303,
          "old_api": null,
          "new_api": "CredentialsFactory::CreateClientCredentials(\n              config.protocol, &credentials)",
          "old_text": null,
          "new_text": "CredentialsFactory::CreateClientCredentials(\n              config.protocol, &credentials)",
          "old_line_content": "              config.protocol, &credentials));",
          "new_line_content": "          TF_RETURN_IF_ERROR(CredentialsFactory::CreateClientCredentials(",
          "content_same": false
        },
        {
          "line": 305,
          "old_api": null,
          "new_api": "std::make_unique<GrpcDataTransferClient>(credentials,\n                                                          config.address)",
          "old_text": null,
          "new_text": "std::make_unique<GrpcDataTransferClient>(credentials,\n                                                          config.address)",
          "old_line_content": "                                                          config.address);",
          "new_line_content": "          *out = std::make_unique<GrpcDataTransferClient>(credentials,",
          "content_same": false
        },
        {
          "line": 307,
          "old_api": null,
          "new_api": "Status::OK()",
          "old_text": null,
          "new_text": "Status::OK()",
          "old_line_content": "        });",
          "new_line_content": "          return Status::OK();",
          "content_same": false
        },
        {
          "line": 316,
          "old_api": null,
          "new_api": "GetElement",
          "old_text": null,
          "new_text": "client_->GetElement(req, resp)",
          "old_line_content": "}",
          "new_line_content": "  return client_->GetElement(req, resp);",
          "content_same": false
        },
        {
          "line": 322,
          "old_api": null,
          "new_api": "Status::OK()",
          "old_text": null,
          "new_text": "Status::OK()",
          "old_line_content": "  }",
          "new_line_content": "    return Status::OK();",
          "content_same": false
        },
        {
          "line": 324,
          "old_api": null,
          "new_api": "DataTransferClient::Build(\n      transfer_protocol_, {protocol_, address_}, &client_)",
          "old_text": null,
          "new_text": "DataTransferClient::Build(\n      transfer_protocol_, {protocol_, address_}, &client_)",
          "old_line_content": "      transfer_protocol_, {protocol_, address_}, &client_));",
          "new_line_content": "  TF_RETURN_IF_ERROR(DataTransferClient::Build(",
          "content_same": false
        },
        {
          "line": 326,
          "old_api": null,
          "new_api": "Status::OK()",
          "old_text": null,
          "new_text": "Status::OK()",
          "old_line_content": "}",
          "new_line_content": "  return Status::OK();",
          "content_same": false
        },
        {
          "line": 329,
          "old_api": null,
          "new_api": "TryCancel",
          "old_text": null,
          "new_text": "client_->TryCancel()",
          "old_line_content": "",
          "new_line_content": "void DataServiceWorkerClient::TryCancel() { client_->TryCancel(); }",
          "content_same": false
        },
        {
          "line": 338,
          "old_api": null,
          "new_api": "Status::OK()",
          "old_text": null,
          "new_text": "Status::OK()",
          "old_line_content": "}",
          "new_line_content": "  return Status::OK();",
          "content_same": false
        },
        {
          "line": 345,
          "old_api": null,
          "new_api": "absl::make_unique<DataServiceWorkerClient>(address, protocol,\n                                                           transfer_protocol)",
          "old_text": null,
          "new_text": "absl::make_unique<DataServiceWorkerClient>(address, protocol,\n                                                           transfer_protocol)",
          "old_line_content": "                                                           transfer_protocol);",
          "new_line_content": "  auto client = absl::make_unique<DataServiceWorkerClient>(address, protocol,",
          "content_same": false
        },
        {
          "line": 349,
          "old_api": null,
          "new_api": "Status::OK()",
          "old_text": null,
          "new_text": "Status::OK()",
          "old_line_content": "}",
          "new_line_content": "  return Status::OK();",
          "content_same": false
        },
        {
          "line": 239,
          "old_api": null,
          "new_api": "Status::OK()",
          "old_text": null,
          "new_text": "Status::OK()",
          "old_line_content": "}",
          "new_line_content": "  return Status::OK();",
          "content_same": false
        },
        {
          "line": 249,
          "old_api": null,
          "new_api": "WorkerService::NewStub(channel)",
          "old_text": null,
          "new_text": "WorkerService::NewStub(channel)",
          "old_line_content": "  }",
          "new_line_content": "    stub_ = WorkerService::NewStub(channel);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 256,
          "old_api": "errors::Cancelled(\"Client was cancelled.\")",
          "new_api": null,
          "old_text": "errors::Cancelled(\"Client was cancelled.\")",
          "new_text": null,
          "old_line_content": "        return errors::Cancelled(\"Client was cancelled.\");",
          "new_line_content": "      if (cancelled_) {",
          "content_same": false
        },
        {
          "line": 262,
          "old_api": "insert",
          "new_api": null,
          "old_text": "active_contexts_.insert(&ctx)",
          "new_text": null,
          "old_line_content": "      active_contexts_.insert(&ctx);",
          "new_line_content": "      mutex_lock l(mu_);",
          "content_same": false
        },
        {
          "line": 264,
          "old_api": "GetElement",
          "new_api": null,
          "old_text": "stub_->GetElement(&ctx, req, &resp)",
          "new_text": null,
          "old_line_content": "    grpc::Status s = stub_->GetElement(&ctx, req, &resp);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 267,
          "old_api": "erase",
          "new_api": null,
          "old_text": "active_contexts_.erase(&ctx)",
          "new_text": null,
          "old_line_content": "      active_contexts_.erase(&ctx);",
          "new_line_content": "      mutex_lock l(mu_);",
          "content_same": false
        },
        {
          "line": 269,
          "old_api": "ok",
          "new_api": null,
          "old_text": "s.ok()",
          "new_text": null,
          "old_line_content": "    if (!s.ok()) {",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 272,
          "old_api": "Status::OK()",
          "new_api": null,
          "old_text": "Status::OK()",
          "new_text": null,
          "old_line_content": "    return Status::OK();",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 279,
          "old_api": "TryCancel",
          "new_api": null,
          "old_text": "ctx->TryCancel()",
          "new_text": null,
          "old_line_content": "      ctx->TryCancel();",
          "new_line_content": "    for (const auto& ctx : active_contexts_) {",
          "content_same": false
        },
        {
          "line": 298,
          "old_api": "DataTransferClient::Register(\n        \"grpc\", [](DataTransferClient::Config config,\n                   std::unique_ptr<DataTransferClient>* out) {\n          std::shared_ptr<grpc::ChannelCredentials> credentials;\n          TF_RETURN_IF_ERROR(CredentialsFactory::CreateClientCredentials(\n              config.protocol, &credentials));\n          *out = std::make_unique<GrpcDataTransferClient>(credentials,\n                                                          config.address);\n          return Status::OK();\n        })",
          "new_api": null,
          "old_text": "DataTransferClient::Register(\n        \"grpc\", [](DataTransferClient::Config config,\n                   std::unique_ptr<DataTransferClient>* out) {\n          std::shared_ptr<grpc::ChannelCredentials> credentials;\n          TF_RETURN_IF_ERROR(CredentialsFactory::CreateClientCredentials(\n              config.protocol, &credentials));\n          *out = std::make_unique<GrpcDataTransferClient>(credentials,\n                                                          config.address);\n          return Status::OK();\n        })",
          "new_text": null,
          "old_line_content": "    DataTransferClient::Register(",
          "new_line_content": "  GrpcTransferClientRegistrar() {",
          "content_same": false
        },
        {
          "line": 302,
          "old_api": "CredentialsFactory::CreateClientCredentials(\n              config.protocol, &credentials)",
          "new_api": null,
          "old_text": "CredentialsFactory::CreateClientCredentials(\n              config.protocol, &credentials)",
          "new_text": null,
          "old_line_content": "          TF_RETURN_IF_ERROR(CredentialsFactory::CreateClientCredentials(",
          "new_line_content": "          std::shared_ptr<grpc::ChannelCredentials> credentials;",
          "content_same": false
        },
        {
          "line": 304,
          "old_api": "std::make_unique<GrpcDataTransferClient>(credentials,\n                                                          config.address)",
          "new_api": null,
          "old_text": "std::make_unique<GrpcDataTransferClient>(credentials,\n                                                          config.address)",
          "new_text": null,
          "old_line_content": "          *out = std::make_unique<GrpcDataTransferClient>(credentials,",
          "new_line_content": "              config.protocol, &credentials));",
          "content_same": false
        },
        {
          "line": 306,
          "old_api": "Status::OK()",
          "new_api": null,
          "old_text": "Status::OK()",
          "new_text": null,
          "old_line_content": "          return Status::OK();",
          "new_line_content": "                                                          config.address);",
          "content_same": false
        },
        {
          "line": 314,
          "old_api": "EnsureInitialized",
          "new_api": null,
          "old_text": "EnsureInitialized()",
          "new_text": null,
          "old_line_content": "  TF_RETURN_IF_ERROR(EnsureInitialized());",
          "new_line_content": "                                           GetElementResponse& resp) {",
          "content_same": false
        },
        {
          "line": 321,
          "old_api": "Status::OK()",
          "new_api": null,
          "old_text": "Status::OK()",
          "new_text": null,
          "old_line_content": "    return Status::OK();",
          "new_line_content": "  if (client_) {",
          "content_same": false
        },
        {
          "line": 323,
          "old_api": "DataTransferClient::Build(\n      transfer_protocol_, {protocol_, address_}, &client_)",
          "new_api": null,
          "old_text": "DataTransferClient::Build(\n      transfer_protocol_, {protocol_, address_}, &client_)",
          "new_text": null,
          "old_line_content": "  TF_RETURN_IF_ERROR(DataTransferClient::Build(",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 325,
          "old_api": "Status::OK()",
          "new_api": null,
          "old_text": "Status::OK()",
          "new_text": null,
          "old_line_content": "  return Status::OK();",
          "new_line_content": "      transfer_protocol_, {protocol_, address_}, &client_));",
          "content_same": false
        },
        {
          "line": 328,
          "old_api": "TryCancel",
          "new_api": null,
          "old_text": "client_->TryCancel()",
          "new_text": null,
          "old_line_content": "void DataServiceWorkerClient::TryCancel() { client_->TryCancel(); }",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 334,
          "old_api": "absl::make_unique<DataServiceDispatcherClient>(address, protocol)",
          "new_api": null,
          "old_text": "absl::make_unique<DataServiceDispatcherClient>(address, protocol)",
          "new_text": null,
          "old_line_content": "      absl::make_unique<DataServiceDispatcherClient>(address, protocol);",
          "new_line_content": "  auto client =",
          "content_same": false
        },
        {
          "line": 344,
          "old_api": "absl::make_unique<DataServiceWorkerClient>(address, protocol,\n                                                           transfer_protocol)",
          "new_api": null,
          "old_text": "absl::make_unique<DataServiceWorkerClient>(address, protocol,\n                                                           transfer_protocol)",
          "new_text": null,
          "old_line_content": "  auto client = absl::make_unique<DataServiceWorkerClient>(address, protocol,",
          "new_line_content": "    std::unique_ptr<DataServiceWorkerClient>& out) {",
          "content_same": false
        },
        {
          "line": 346,
          "old_api": "Initialize",
          "new_api": null,
          "old_text": "client->Initialize()",
          "new_text": null,
          "old_line_content": "  TF_RETURN_IF_ERROR(client->Initialize());",
          "new_line_content": "                                                           transfer_protocol);",
          "content_same": false
        },
        {
          "line": 246,
          "old_api": "SetMaxReceiveMessageSize",
          "new_api": null,
          "old_text": "args.SetMaxReceiveMessageSize(-1)",
          "new_text": null,
          "old_line_content": "    args.SetMaxReceiveMessageSize(-1);",
          "new_line_content": "    grpc::ChannelArguments args;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 12,
      "total_additions": 21,
      "total_deletions": 20,
      "total_api_changes": 53
    },
    "non_api_changes": {
      "has_non_api_changes": false,
      "evidence": {
        "total_diff_lines": 1,
        "api_related_lines": 53,
        "non_api_lines": 0,
        "non_api_line_numbers": []
      }
    },
    "api_calls_before": 137,
    "api_calls_after": 138,
    "diff_info": {
      "added_lines": 1,
      "removed_lines": 0,
      "total_diff_lines": 13
    }
  }
}