{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/srs/modified_file/19a7c7682edd3d9b6e8b75c6d8805bbb629423f3",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/srs/modified_file/19a7c7682edd3d9b6e8b75c6d8805bbb629423f3/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/srs/modified_file/19a7c7682edd3d9b6e8b75c6d8805bbb629423f3/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/srs/modified_file/19a7c7682edd3d9b6e8b75c6d8805bbb629423f3/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 551,
          "old_api": "can_print",
          "new_api": "set_id",
          "old_text": "pp_pkt_handler_err->can_print(err, &nn)",
          "new_text": "_srs_context->set_id(cid)",
          "old_line_content": "            if (pp_pkt_handler_err->can_print(err, &nn)) {",
          "new_line_content": "                _srs_context->set_id(cid);",
          "content_same": false
        },
        {
          "line": 554,
          "old_api": "c_str",
          "new_api": "size",
          "old_text": "srs_error_desc(err).c_str()",
          "new_text": "skt.size()",
          "old_line_content": "                srs_warn(\"handle udp pkt, count=%u/%u, err: %s\", pp_pkt_handler_err->nn_count, nn, srs_error_desc(err).c_str());",
          "new_line_content": "                err = srs_error_wrap(err, \"size=%u, data=[%s]\", skt.size(), srs_string_dumps_hex(skt.data(), skt.size(), 8).c_str());",
          "content_same": false
        },
        {
          "line": 560,
          "old_api": "can_print",
          "new_api": "elapse",
          "old_text": "pprint->can_print()",
          "new_text": "pprint->elapse()",
          "old_line_content": "        if (pprint->can_print()) {",
          "new_line_content": "        pprint->elapse();",
          "content_same": false
        },
        {
          "line": 563,
          "old_api": "srs_get_system_startup_time",
          "new_api": "set_id",
          "old_text": "srs_get_system_startup_time()",
          "new_text": "_srs_context->set_id(cid)",
          "old_line_content": "                if (srs_get_system_time() > srs_get_system_startup_time()) {",
          "new_line_content": "            _srs_context->set_id(cid);",
          "content_same": false
        },
        {
          "line": 567,
          "old_api": "srs_get_system_time",
          "new_api": "srs_get_system_startup_time",
          "old_text": "srs_get_system_time()",
          "new_text": "srs_get_system_startup_time()",
          "old_line_content": "                    pps_last = (int)((nn_msgs - nn_msgs_last) * SRS_UTIME_SECONDS / (srs_get_system_time() - time_last));",
          "new_line_content": "                if (srs_get_system_time() > srs_get_system_startup_time()) {",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 544,
          "old_api": null,
          "new_api": "on_udp_packet",
          "old_text": null,
          "new_text": "handler->on_udp_packet(&skt)",
          "old_line_content": "        if (true) {",
          "new_line_content": "        err = handler->on_udp_packet(&skt);",
          "content_same": false
        },
        {
          "line": 549,
          "old_api": null,
          "new_api": "can_print",
          "old_text": null,
          "new_text": "pp_pkt_handler_err->can_print(err, &nn)",
          "old_line_content": "        if (err != srs_success) {",
          "new_line_content": "            if (pp_pkt_handler_err->can_print(err, &nn)) {",
          "content_same": false
        },
        {
          "line": 582,
          "old_api": null,
          "new_api": "c_str",
          "old_text": null,
          "new_text": "srs_trace(\"<- RTC RECV #%d, udp %\" PRId64 \", pps %d/%d%s, schedule %\" PRId64,\n                srs_netfd_fileno(lfd), nn_msgs_stage, pps_average, pps_last, pps_unit.c_str(), nn_loop)",
          "old_line_content": "        }",
          "new_line_content": "            srs_trace(\"<- RTC RECV #%d, udp %\" PRId64 \", pps %d/%d%s, schedule %\" PRId64,",
          "content_same": false
        },
        {
          "line": 583,
          "old_api": null,
          "new_api": "c_str",
          "old_text": null,
          "new_text": "pps_unit.c_str()",
          "old_line_content": "    ",
          "new_line_content": "                srs_netfd_fileno(lfd), nn_msgs_stage, pps_average, pps_last, pps_unit.c_str(), nn_loop);",
          "content_same": false
        },
        {
          "line": 584,
          "old_api": null,
          "new_api": "srs_get_system_time",
          "old_text": null,
          "new_text": "srs_get_system_time()",
          "old_line_content": "        if (SrsUdpPacketRecvCycleInterval > 0) {",
          "new_line_content": "            nn_msgs_last = nn_msgs; time_last = srs_get_system_time();",
          "content_same": false
        },
        {
          "line": 555,
          "old_api": null,
          "new_api": "c_str",
          "old_text": null,
          "new_text": "srs_error_desc(err).c_str()",
          "old_line_content": "            }",
          "new_line_content": "                srs_warn(\"handle udp pkt, count=%u/%u, err: %s\", pp_pkt_handler_err->nn_count, nn, srs_error_desc(err).c_str());",
          "content_same": false
        },
        {
          "line": 557,
          "old_api": null,
          "new_api": "srs_freep",
          "old_text": null,
          "new_text": "srs_freep(err)",
          "old_line_content": "        }",
          "new_line_content": "            srs_freep(err);",
          "content_same": false
        },
        {
          "line": 589,
          "old_api": null,
          "new_api": "srs_usleep",
          "old_text": null,
          "new_text": "srs_usleep(SrsUdpPacketRecvCycleInterval)",
          "old_line_content": "    return err;",
          "new_line_content": "            srs_usleep(SrsUdpPacketRecvCycleInterval);",
          "content_same": false
        },
        {
          "line": 561,
          "old_api": null,
          "new_api": "can_print",
          "old_text": null,
          "new_text": "pprint->can_print()",
          "old_line_content": "            int pps_average = 0; int pps_last = 0;",
          "new_line_content": "        if (pprint->can_print()) {",
          "content_same": false
        },
        {
          "line": 568,
          "old_api": null,
          "new_api": "srs_get_system_startup_time",
          "old_text": null,
          "new_text": "srs_get_system_startup_time()",
          "old_line_content": "                }",
          "new_line_content": "                    pps_average = (int)(nn_msgs * SRS_UTIME_SECONDS / (srs_get_system_time() - srs_get_system_startup_time()));",
          "content_same": false
        },
        {
          "line": 570,
          "old_api": null,
          "new_api": "srs_get_system_time",
          "old_text": null,
          "new_text": "srs_get_system_time()",
          "old_line_content": "",
          "new_line_content": "                if (srs_get_system_time() > time_last) {",
          "content_same": false
        },
        {
          "line": 571,
          "old_api": null,
          "new_api": "srs_get_system_time",
          "old_text": null,
          "new_text": "srs_get_system_time()",
          "old_line_content": "            string pps_unit = \"\";",
          "new_line_content": "                    pps_last = (int)((nn_msgs - nn_msgs_last) * SRS_UTIME_SECONDS / (srs_get_system_time() - time_last));",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 545,
          "old_api": "SrsContextRestore",
          "new_api": null,
          "old_text": "SrsContextRestore(cid)",
          "new_text": null,
          "old_line_content": "            SrsContextRestore(cid);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 546,
          "old_api": "on_udp_packet",
          "new_api": null,
          "old_text": "handler->on_udp_packet(&skt)",
          "new_text": null,
          "old_line_content": "            err = handler->on_udp_packet(&skt);",
          "new_line_content": "        // Use pithy print to show more smart information.",
          "content_same": false
        },
        {
          "line": 578,
          "old_api": "c_str",
          "new_api": null,
          "old_text": "srs_trace(\"<- RTC RECV #%d, udp %\" PRId64 \", pps %d/%d%s, schedule %\" PRId64,\n                srs_netfd_fileno(lfd), nn_msgs_stage, pps_average, pps_last, pps_unit.c_str(), nn_loop)",
          "new_text": null,
          "old_line_content": "            srs_trace(\"<- RTC RECV #%d, udp %\" PRId64 \", pps %d/%d%s, schedule %\" PRId64,",
          "new_line_content": "            } else if (pps_last > 1000 || pps_average > 1000) {",
          "content_same": false
        },
        {
          "line": 579,
          "old_api": "c_str",
          "new_api": null,
          "old_text": "pps_unit.c_str()",
          "new_text": null,
          "old_line_content": "                srs_netfd_fileno(lfd), nn_msgs_stage, pps_average, pps_last, pps_unit.c_str(), nn_loop);",
          "new_line_content": "                pps_unit = \"(k)\"; pps_last /= 10000; pps_average /= 10000;",
          "content_same": false
        },
        {
          "line": 580,
          "old_api": "srs_get_system_time",
          "new_api": null,
          "old_text": "srs_get_system_time()",
          "new_text": null,
          "old_line_content": "            nn_msgs_last = nn_msgs; time_last = srs_get_system_time();",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 553,
          "old_api": "size",
          "new_api": null,
          "old_text": "skt.size()",
          "new_text": null,
          "old_line_content": "                err = srs_error_wrap(err, \"size=%u, data=[%s]\", skt.size(), srs_string_dumps_hex(skt.data(), skt.size(), 8).c_str());",
          "new_line_content": "                // Append more information.",
          "content_same": false
        },
        {
          "line": 585,
          "old_api": "srs_usleep",
          "new_api": null,
          "old_text": "srs_usleep(SrsUdpPacketRecvCycleInterval)",
          "new_text": null,
          "old_line_content": "            srs_usleep(SrsUdpPacketRecvCycleInterval);",
          "new_line_content": "            nn_loop = 0; nn_msgs_stage = 0;",
          "content_same": false
        },
        {
          "line": 556,
          "old_api": "srs_freep",
          "new_api": null,
          "old_text": "srs_freep(err)",
          "new_text": null,
          "old_line_content": "            srs_freep(err);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 559,
          "old_api": "elapse",
          "new_api": null,
          "old_text": "pprint->elapse()",
          "new_text": null,
          "old_line_content": "        pprint->elapse();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 564,
          "old_api": "srs_get_system_startup_time",
          "new_api": null,
          "old_text": "srs_get_system_startup_time()",
          "new_text": null,
          "old_line_content": "                    pps_average = (int)(nn_msgs * SRS_UTIME_SECONDS / (srs_get_system_time() - srs_get_system_startup_time()));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 566,
          "old_api": "srs_get_system_time",
          "new_api": null,
          "old_text": "srs_get_system_time()",
          "new_text": null,
          "old_line_content": "                if (srs_get_system_time() > time_last) {",
          "new_line_content": "            if (true) {",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 5,
      "total_additions": 12,
      "total_deletions": 11,
      "total_api_changes": 28
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 11,
        "api_related_lines": 28,
        "non_api_lines": 5,
        "non_api_line_numbers": [
          547,
          550,
          552,
          562,
          543
        ]
      }
    },
    "api_calls_before": 134,
    "api_calls_after": 135,
    "diff_info": {
      "added_lines": 9,
      "removed_lines": 5,
      "total_diff_lines": 37
    }
  }
}