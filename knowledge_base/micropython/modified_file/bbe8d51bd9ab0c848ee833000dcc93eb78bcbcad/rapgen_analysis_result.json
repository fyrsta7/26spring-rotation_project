{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/micropython/modified_file/bbe8d51bd9ab0c848ee833000dcc93eb78bcbcad",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/micropython/modified_file/bbe8d51bd9ab0c848ee833000dcc93eb78bcbcad/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/micropython/modified_file/bbe8d51bd9ab0c848ee833000dcc93eb78bcbcad/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/micropython/modified_file/bbe8d51bd9ab0c848ee833000dcc93eb78bcbcad/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [],
      "additions": [
        {
          "line": 266,
          "old_api": null,
          "new_api": "MP_OBJ_IS_QSTR",
          "old_text": null,
          "new_text": "MP_OBJ_IS_QSTR(index)",
          "old_line_content": "                    // restart the search for the new element",
          "new_line_content": "                    if (!MP_OBJ_IS_QSTR(index)) {",
          "content_same": false
        },
        {
          "line": 272,
          "old_api": null,
          "new_api": "mp_map_rehash",
          "old_text": null,
          "new_text": "mp_map_rehash(map)",
          "old_line_content": "        }",
          "new_line_content": "                    mp_map_rehash(map);",
          "content_same": false
        },
        {
          "line": 400,
          "old_api": null,
          "new_api": "m_del",
          "old_text": null,
          "new_text": "m_del(mp_obj_t, set->table, set->alloc)",
          "old_line_content": "",
          "new_line_content": "    m_del(mp_obj_t, set->table, set->alloc);",
          "content_same": false
        },
        {
          "line": 412,
          "old_api": null,
          "new_api": "mp_obj_print",
          "old_text": null,
          "new_text": "mp_obj_print(map->table[i].key, PRINT_REPR)",
          "old_line_content": "}",
          "new_line_content": "            mp_obj_print(map->table[i].key, PRINT_REPR);",
          "content_same": false
        },
        {
          "line": 414,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\"(nil)\")",
          "old_line_content": "",
          "new_line_content": "            printf(\"(nil)\");",
          "content_same": false
        },
        {
          "line": 416,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\": %p\\n\", map->table[i].value)",
          "old_line_content": "",
          "new_line_content": "        printf(\": %p\\n\", map->table[i].value);",
          "content_same": false
        },
        {
          "line": 418,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\"---\\n\")",
          "old_line_content": "",
          "new_line_content": "    printf(\"---\\n\");",
          "content_same": false
        },
        {
          "line": 291,
          "old_api": null,
          "new_api": "m_new0",
          "old_text": null,
          "new_text": "m_new0(mp_obj_t, set->alloc)",
          "old_line_content": "    set->used = 0;",
          "new_line_content": "    set->table = m_new0(mp_obj_t, set->alloc);",
          "content_same": false
        },
        {
          "line": 297,
          "old_api": null,
          "new_api": "get_doubling_prime_greater_or_equal_to",
          "old_text": null,
          "new_text": "get_doubling_prime_greater_or_equal_to(set->alloc + 1)",
          "old_line_content": "    }",
          "new_line_content": "    set->alloc = get_doubling_prime_greater_or_equal_to(set->alloc + 1);",
          "content_same": false
        },
        {
          "line": 299,
          "old_api": null,
          "new_api": "m_new0",
          "old_text": null,
          "new_text": "m_new0(mp_obj_t, set->alloc)",
          "old_line_content": "}",
          "new_line_content": "    set->table = m_new0(mp_obj_t, set->alloc);",
          "content_same": false
        },
        {
          "line": 302,
          "old_api": null,
          "new_api": "mp_set_lookup",
          "old_text": null,
          "new_text": "mp_set_lookup(set, old_table[i], MP_MAP_LOOKUP_ADD_IF_NOT_FOUND)",
          "old_line_content": "    // Note: lookup_kind can be MP_MAP_LOOKUP_ADD_IF_NOT_FOUND_OR_REMOVE_IF_FOUND which",
          "new_line_content": "            mp_set_lookup(set, old_table[i], MP_MAP_LOOKUP_ADD_IF_NOT_FOUND);",
          "content_same": false
        },
        {
          "line": 305,
          "old_api": null,
          "new_api": "m_del",
          "old_text": null,
          "new_text": "m_del(mp_obj_t, old_table, old_alloc)",
          "old_line_content": "    if (set->alloc == 0) {",
          "new_line_content": "    m_del(mp_obj_t, old_table, old_alloc);",
          "content_same": false
        },
        {
          "line": 314,
          "old_api": null,
          "new_api": "mp_set_rehash",
          "old_text": null,
          "new_text": "mp_set_rehash(set)",
          "old_line_content": "    mp_uint_t start_pos = pos;",
          "new_line_content": "            mp_set_rehash(set);",
          "content_same": false
        },
        {
          "line": 319,
          "old_api": null,
          "new_api": "mp_unary_op",
          "old_text": null,
          "new_text": "mp_unary_op(MP_UNARY_OP_HASH, index)",
          "old_line_content": "            // found NULL slot, so index is not in table",
          "new_line_content": "    mp_uint_t hash = MP_OBJ_SMALL_INT_VALUE(mp_unary_op(MP_UNARY_OP_HASH, index));",
          "content_same": false
        },
        {
          "line": 206,
          "old_api": null,
          "new_api": "MP_OBJ_IS_QSTR",
          "old_text": null,
          "new_text": "MP_OBJ_IS_QSTR(index)",
          "old_line_content": "    mp_uint_t start_pos = pos;",
          "new_line_content": "    if (MP_OBJ_IS_QSTR(index)) {",
          "content_same": false
        },
        {
          "line": 207,
          "old_api": null,
          "new_api": "MP_OBJ_QSTR_VALUE",
          "old_text": null,
          "new_text": "MP_OBJ_QSTR_VALUE(index)",
          "old_line_content": "    mp_map_elem_t *avail_slot = NULL;",
          "new_line_content": "        hash = qstr_hash(MP_OBJ_QSTR_VALUE(index));",
          "content_same": false
        },
        {
          "line": 209,
          "old_api": null,
          "new_api": "mp_unary_op",
          "old_text": null,
          "new_text": "mp_unary_op(MP_UNARY_OP_HASH, index)",
          "old_line_content": "        mp_map_elem_t *slot = &map->table[pos];",
          "new_line_content": "        hash = MP_OBJ_SMALL_INT_VALUE(mp_unary_op(MP_UNARY_OP_HASH, index));",
          "content_same": false
        },
        {
          "line": 342,
          "old_api": null,
          "new_api": "mp_obj_equal",
          "old_text": null,
          "new_text": "mp_obj_equal(elem, index)",
          "old_line_content": "                    set->table[pos] = MP_OBJ_NULL;",
          "new_line_content": "        } else if (mp_obj_equal(elem, index)) {",
          "content_same": false
        },
        {
          "line": 226,
          "old_api": null,
          "new_api": "MP_OBJ_IS_QSTR",
          "old_text": null,
          "new_text": "MP_OBJ_IS_QSTR(index)",
          "old_line_content": "        } else if (slot->key == MP_OBJ_SENTINEL) {",
          "new_line_content": "                if (!MP_OBJ_IS_QSTR(index)) {",
          "content_same": false
        },
        {
          "line": 238,
          "old_api": null,
          "new_api": "mp_obj_equal",
          "old_text": null,
          "new_text": "mp_obj_equal(slot->key, index)",
          "old_line_content": "                    // optimisation if next slot is empty",
          "new_line_content": "        } else if (slot->key == index || (!compare_only_ptrs && mp_obj_equal(slot->key, index))) {",
          "content_same": false
        },
        {
          "line": 370,
          "old_api": null,
          "new_api": "mp_set_rehash",
          "old_text": null,
          "new_text": "mp_set_rehash(set)",
          "old_line_content": "        }",
          "new_line_content": "                    mp_set_rehash(set);",
          "content_same": false
        },
        {
          "line": 383,
          "old_api": null,
          "new_api": "MP_SET_SLOT_IS_FILLED",
          "old_text": null,
          "new_text": "MP_SET_SLOT_IS_FILLED(set, pos)",
          "old_line_content": "            } else {",
          "new_line_content": "        if (MP_SET_SLOT_IS_FILLED(set, pos)) {",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 259,
          "old_api": "MP_OBJ_IS_QSTR",
          "new_api": null,
          "old_text": "MP_OBJ_IS_QSTR(index)",
          "new_text": null,
          "old_line_content": "                    if (!MP_OBJ_IS_QSTR(index)) {",
          "new_line_content": "            // search got back to starting position, so index is not in table",
          "content_same": false
        },
        {
          "line": 265,
          "old_api": "mp_map_rehash",
          "new_api": null,
          "old_text": "mp_map_rehash(map)",
          "new_text": null,
          "old_line_content": "                    mp_map_rehash(map);",
          "new_line_content": "                    avail_slot->value = MP_OBJ_NULL;",
          "content_same": false
        },
        {
          "line": 393,
          "old_api": "m_del",
          "new_api": null,
          "old_text": "m_del(mp_obj_t, set->table, set->alloc)",
          "new_text": null,
          "old_line_content": "    m_del(mp_obj_t, set->table, set->alloc);",
          "new_line_content": "            return elem;",
          "content_same": false
        },
        {
          "line": 405,
          "old_api": "mp_obj_print",
          "new_api": null,
          "old_text": "mp_obj_print(map->table[i].key, PRINT_REPR)",
          "new_text": null,
          "old_line_content": "            mp_obj_print(map->table[i].key, PRINT_REPR);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 407,
          "old_api": "printf",
          "new_api": null,
          "old_text": "printf(\"(nil)\")",
          "new_text": null,
          "old_line_content": "            printf(\"(nil)\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 409,
          "old_api": "printf",
          "new_api": null,
          "old_text": "printf(\": %p\\n\", map->table[i].value)",
          "new_text": null,
          "old_line_content": "        printf(\": %p\\n\", map->table[i].value);",
          "new_line_content": "void mp_map_dump(mp_map_t *map) {",
          "content_same": false
        },
        {
          "line": 411,
          "old_api": "printf",
          "new_api": null,
          "old_text": "printf(\"---\\n\")",
          "new_text": null,
          "old_line_content": "    printf(\"---\\n\");",
          "new_line_content": "        if (map->table[i].key != NULL) {",
          "content_same": false
        },
        {
          "line": 284,
          "old_api": "m_new0",
          "new_api": null,
          "old_text": "m_new0(mp_obj_t, set->alloc)",
          "new_text": null,
          "old_line_content": "    set->table = m_new0(mp_obj_t, set->alloc);",
          "new_line_content": "/* set                                                                        */",
          "content_same": false
        },
        {
          "line": 290,
          "old_api": "get_doubling_prime_greater_or_equal_to",
          "new_api": null,
          "old_text": "get_doubling_prime_greater_or_equal_to(set->alloc + 1)",
          "new_text": null,
          "old_line_content": "    set->alloc = get_doubling_prime_greater_or_equal_to(set->alloc + 1);",
          "new_line_content": "    set->used = 0;",
          "content_same": false
        },
        {
          "line": 292,
          "old_api": "m_new0",
          "new_api": null,
          "old_text": "m_new0(mp_obj_t, set->alloc)",
          "new_text": null,
          "old_line_content": "    set->table = m_new0(mp_obj_t, set->alloc);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 295,
          "old_api": "mp_set_lookup",
          "new_api": null,
          "old_text": "mp_set_lookup(set, old_table[i], MP_MAP_LOOKUP_ADD_IF_NOT_FOUND)",
          "new_text": null,
          "old_line_content": "            mp_set_lookup(set, old_table[i], MP_MAP_LOOKUP_ADD_IF_NOT_FOUND);",
          "new_line_content": "    mp_uint_t old_alloc = set->alloc;",
          "content_same": false
        },
        {
          "line": 298,
          "old_api": "m_del",
          "new_api": null,
          "old_text": "m_del(mp_obj_t, old_table, old_alloc)",
          "new_text": null,
          "old_line_content": "    m_del(mp_obj_t, old_table, old_alloc);",
          "new_line_content": "    set->used = 0;",
          "content_same": false
        },
        {
          "line": 307,
          "old_api": "mp_set_rehash",
          "new_api": null,
          "old_text": "mp_set_rehash(set)",
          "new_text": null,
          "old_line_content": "            mp_set_rehash(set);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 312,
          "old_api": "mp_unary_op",
          "new_api": null,
          "old_text": "mp_unary_op(MP_UNARY_OP_HASH, index)",
          "new_text": null,
          "old_line_content": "    mp_uint_t hash = MP_OBJ_SMALL_INT_VALUE(mp_unary_op(MP_UNARY_OP_HASH, index));",
          "new_line_content": "    if (set->alloc == 0) {",
          "content_same": false
        },
        {
          "line": 204,
          "old_api": "mp_unary_op",
          "new_api": null,
          "old_text": "mp_unary_op(MP_UNARY_OP_HASH, index)",
          "new_text": null,
          "old_line_content": "    mp_uint_t hash = MP_OBJ_SMALL_INT_VALUE(mp_unary_op(MP_UNARY_OP_HASH, index));",
          "new_line_content": "    // get hash of index, with fast path for common case of qstr",
          "content_same": false
        },
        {
          "line": 335,
          "old_api": "mp_obj_equal",
          "new_api": null,
          "old_text": "mp_obj_equal(elem, index)",
          "new_text": null,
          "old_line_content": "        } else if (mp_obj_equal(elem, index)) {",
          "new_line_content": "                return MP_OBJ_NULL;",
          "content_same": false
        },
        {
          "line": 219,
          "old_api": "MP_OBJ_IS_QSTR",
          "new_api": null,
          "old_text": "MP_OBJ_IS_QSTR(index)",
          "new_text": null,
          "old_line_content": "                if (!MP_OBJ_IS_QSTR(index)) {",
          "new_line_content": "            if (lookup_kind == MP_MAP_LOOKUP_ADD_IF_NOT_FOUND) {",
          "content_same": false
        },
        {
          "line": 231,
          "old_api": "mp_obj_equal",
          "new_api": null,
          "old_text": "mp_obj_equal(slot->key, index)",
          "new_text": null,
          "old_line_content": "        } else if (slot->key == index || (!compare_only_ptrs && mp_obj_equal(slot->key, index))) {",
          "new_line_content": "                return NULL;",
          "content_same": false
        },
        {
          "line": 363,
          "old_api": "mp_set_rehash",
          "new_api": null,
          "old_text": "mp_set_rehash(set)",
          "new_text": null,
          "old_line_content": "                    mp_set_rehash(set);",
          "new_line_content": "                if (avail_slot != NULL) {",
          "content_same": false
        },
        {
          "line": 376,
          "old_api": "MP_SET_SLOT_IS_FILLED",
          "new_api": null,
          "old_text": "MP_SET_SLOT_IS_FILLED(set, pos)",
          "new_text": null,
          "old_line_content": "        if (MP_SET_SLOT_IS_FILLED(set, pos)) {",
          "new_line_content": "            }",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 0,
      "total_additions": 22,
      "total_deletions": 20,
      "total_api_changes": 42
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 8,
        "api_related_lines": 42,
        "non_api_lines": 4,
        "non_api_line_numbers": [
          208,
          210,
          211,
          205
        ]
      }
    },
    "api_calls_before": 43,
    "api_calls_after": 46,
    "diff_info": {
      "added_lines": 8,
      "removed_lines": 1,
      "total_diff_lines": 21
    }
  }
}