{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/micropython/modified_file/f350b640a038477c5b00aaae7467b9485d5e9a2b",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/micropython/modified_file/f350b640a038477c5b00aaae7467b9485d5e9a2b/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/micropython/modified_file/f350b640a038477c5b00aaae7467b9485d5e9a2b/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/micropython/modified_file/f350b640a038477c5b00aaae7467b9485d5e9a2b/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 415,
          "old_api": "_socket_recvfrom",
          "new_api": "mp_obj_get_int",
          "old_text": "_socket_recvfrom(self_in, len_in, NULL, NULL)",
          "new_text": "mp_obj_get_int(len_in)",
          "old_line_content": "    return _socket_recvfrom(self_in, len_in, NULL, NULL);",
          "new_line_content": "    size_t len = mp_obj_get_int(len_in);",
          "content_same": false
        },
        {
          "line": 430,
          "old_api": "mp_obj_new_tuple",
          "new_api": "_socket_recvfrom",
          "old_text": "mp_obj_new_tuple(2, tuple)",
          "new_text": "_socket_recvfrom(self_in, len_in, NULL, NULL)",
          "old_line_content": "    return mp_obj_new_tuple(2, tuple);",
          "new_line_content": "    return _socket_recvfrom(self_in, len_in, NULL, NULL);",
          "content_same": false
        },
        {
          "line": 439,
          "old_api": "MP_THREAD_GIL_ENTER",
          "new_api": "_socket_recvfrom",
          "old_text": "MP_THREAD_GIL_ENTER()",
          "new_text": "_socket_recvfrom(self_in, len_in, &from, &fromlen)",
          "old_line_content": "        MP_THREAD_GIL_ENTER();",
          "new_line_content": "    tuple[0] = _socket_recvfrom(self_in, len_in, &from, &fromlen);",
          "content_same": false
        },
        {
          "line": 442,
          "old_api": "check_for_exceptions",
          "new_api": "lwip_ntohs",
          "old_text": "check_for_exceptions()",
          "new_text": "lwip_ntohs(((struct sockaddr_in*)&from)->sin_port)",
          "old_line_content": "        check_for_exceptions();",
          "new_line_content": "    mp_uint_t port = lwip_ntohs(((struct sockaddr_in*)&from)->sin_port);",
          "content_same": false
        },
        {
          "line": 452,
          "old_api": "_socket_send",
          "new_api": "MP_THREAD_GIL_EXIT",
          "old_text": "_socket_send(sock, data, datalen)",
          "new_text": "MP_THREAD_GIL_EXIT()",
          "old_line_content": "    int r = _socket_send(sock, data, datalen);",
          "new_line_content": "        MP_THREAD_GIL_EXIT();",
          "content_same": false
        },
        {
          "line": 453,
          "old_api": "mp_obj_new_int",
          "new_api": "lwip_write_r",
          "old_text": "mp_obj_new_int(r)",
          "new_text": "lwip_write_r(sock->fd, data+sentlen, datalen-sentlen)",
          "old_line_content": "    return mp_obj_new_int(r);",
          "new_line_content": "        int r = lwip_write_r(sock->fd, data+sentlen, datalen-sentlen);",
          "content_same": false
        },
        {
          "line": 464,
          "old_api": "mp_raise_OSError",
          "new_api": "MP_OBJ_TO_PTR",
          "old_text": "mp_raise_OSError(MP_ETIMEDOUT)",
          "new_text": "MP_OBJ_TO_PTR(arg0)",
          "old_line_content": "    if (r < bufinfo.len) mp_raise_OSError(MP_ETIMEDOUT);",
          "new_line_content": "    socket_obj_t *sock = MP_OBJ_TO_PTR(arg0);",
          "content_same": false
        },
        {
          "line": 485,
          "old_api": "lwip_sendto_r",
          "new_api": "MP_OBJ_TO_PTR",
          "old_text": "lwip_sendto_r(self->fd, bufinfo.buf, bufinfo.len, 0, (struct sockaddr*)&to, sizeof(to))",
          "new_text": "MP_OBJ_TO_PTR(self_in)",
          "old_line_content": "        int ret = lwip_sendto_r(self->fd, bufinfo.buf, bufinfo.len, 0, (struct sockaddr*)&to, sizeof(to));",
          "new_line_content": "    socket_obj_t *self = MP_OBJ_TO_PTR(self_in);",
          "content_same": false
        },
        {
          "line": 489,
          "old_api": "exception_from_errno",
          "new_api": "mp_get_buffer_raise",
          "old_text": "exception_from_errno(errno)",
          "new_text": "mp_get_buffer_raise(data_in, &bufinfo, MP_BUFFER_READ)",
          "old_line_content": "            exception_from_errno(errno);",
          "new_line_content": "    mp_get_buffer_raise(data_in, &bufinfo, MP_BUFFER_READ);",
          "content_same": false
        },
        {
          "line": 499,
          "old_api": "mp_obj_new_int",
          "new_api": "MP_THREAD_GIL_EXIT",
          "old_text": "mp_obj_new_int(self->fd)",
          "new_text": "MP_THREAD_GIL_EXIT()",
          "old_line_content": "    return mp_obj_new_int(self->fd);",
          "new_line_content": "        MP_THREAD_GIL_EXIT();",
          "content_same": false
        },
        {
          "line": 531,
          "old_api": "FD_ZERO",
          "new_api": "MP_THREAD_GIL_EXIT",
          "old_text": "FD_ZERO(&rfds)",
          "new_text": "MP_THREAD_GIL_EXIT()",
          "old_line_content": "        fd_set rfds; FD_ZERO(&rfds);",
          "new_line_content": "        MP_THREAD_GIL_EXIT();",
          "content_same": false
        },
        {
          "line": 532,
          "old_api": "FD_ZERO",
          "new_api": "lwip_write_r",
          "old_text": "FD_ZERO(&wfds)",
          "new_text": "lwip_write_r(sock->fd, buf, size)",
          "old_line_content": "        fd_set wfds; FD_ZERO(&wfds);",
          "new_line_content": "        int r = lwip_write_r(sock->fd, buf, size);",
          "content_same": false
        },
        {
          "line": 533,
          "old_api": "FD_ZERO",
          "new_api": "MP_THREAD_GIL_ENTER",
          "old_text": "FD_ZERO(&efds)",
          "new_text": "MP_THREAD_GIL_ENTER()",
          "old_line_content": "        fd_set efds; FD_ZERO(&efds);",
          "new_line_content": "        MP_THREAD_GIL_ENTER();",
          "content_same": false
        },
        {
          "line": 536,
          "old_api": "FD_SET",
          "new_api": "check_for_exceptions",
          "old_text": "FD_SET(socket->fd, &wfds)",
          "new_text": "check_for_exceptions()",
          "old_line_content": "        if (arg & MP_STREAM_POLL_WR) FD_SET(socket->fd, &wfds);",
          "new_line_content": "        check_for_exceptions();",
          "content_same": false
        },
        {
          "line": 546,
          "old_api": "FD_ISSET",
          "new_api": "FD_ZERO",
          "old_text": "FD_ISSET(socket->fd, &rfds)",
          "new_text": "FD_ZERO(&rfds)",
          "old_line_content": "        if (FD_ISSET(socket->fd, &rfds)) ret |= MP_STREAM_POLL_RD;",
          "new_line_content": "        fd_set rfds; FD_ZERO(&rfds);",
          "content_same": false
        },
        {
          "line": 547,
          "old_api": "FD_ISSET",
          "new_api": "FD_ZERO",
          "old_text": "FD_ISSET(socket->fd, &wfds)",
          "new_text": "FD_ZERO(&wfds)",
          "old_line_content": "        if (FD_ISSET(socket->fd, &wfds)) ret |= MP_STREAM_POLL_WR;",
          "new_line_content": "        fd_set wfds; FD_ZERO(&wfds);",
          "content_same": false
        },
        {
          "line": 548,
          "old_api": "FD_ISSET",
          "new_api": "FD_ZERO",
          "old_text": "FD_ISSET(socket->fd, &efds)",
          "new_text": "FD_ZERO(&efds)",
          "old_line_content": "        if (FD_ISSET(socket->fd, &efds)) ret |= MP_STREAM_POLL_HUP;",
          "new_line_content": "        fd_set efds; FD_ZERO(&efds);",
          "content_same": false
        },
        {
          "line": 554,
          "old_api": "usocket_events_remove",
          "new_api": "select",
          "old_text": "usocket_events_remove(socket)",
          "new_text": "select((socket->fd)+1, &rfds, &wfds, &efds, &timeout)",
          "old_line_content": "                usocket_events_remove(socket);",
          "new_line_content": "        int r = select((socket->fd)+1, &rfds, &wfds, &efds, &timeout);",
          "content_same": false
        },
        {
          "line": 573,
          "old_api": "MP_ROM_PTR",
          "new_api": "lwip_close_r",
          "old_text": "MP_ROM_PTR(&mp_stream_close_obj)",
          "new_text": "lwip_close_r(socket->fd)",
          "old_line_content": "    { MP_ROM_QSTR(MP_QSTR___del__), MP_ROM_PTR(&mp_stream_close_obj) },",
          "new_line_content": "            int ret = lwip_close_r(socket->fd);",
          "content_same": false
        },
        {
          "line": 633,
          "old_api": "MP_OBJ_FROM_PTR",
          "new_api": "mp_obj_get_int",
          "old_text": "MP_OBJ_FROM_PTR(sock)",
          "new_text": "mp_obj_get_int(args[0])",
          "old_line_content": "    return MP_OBJ_FROM_PTR(sock);",
          "new_line_content": "        sock->domain = mp_obj_get_int(args[0]);",
          "content_same": false
        },
        {
          "line": 642,
          "old_api": "mp_obj_new_list",
          "new_api": "lwip_socket",
          "old_text": "mp_obj_new_list(0, NULL)",
          "new_text": "lwip_socket(sock->domain, sock->type, sock->proto)",
          "old_line_content": "    mp_obj_t ret_list = mp_obj_new_list(0, NULL);",
          "new_line_content": "    sock->fd = lwip_socket(sock->domain, sock->type, sock->proto);",
          "content_same": false
        },
        {
          "line": 646,
          "old_api": "mp_obj_new_int",
          "new_api": "_socket_settimeout",
          "old_text": "mp_obj_new_int(resi->ai_family)",
          "new_text": "_socket_settimeout(sock, UINT64_MAX)",
          "old_line_content": "            mp_obj_new_int(resi->ai_family),",
          "new_line_content": "    _socket_settimeout(sock, UINT64_MAX);",
          "content_same": false
        },
        {
          "line": 648,
          "old_api": "mp_obj_new_int",
          "new_api": "MP_OBJ_FROM_PTR",
          "old_text": "mp_obj_new_int(resi->ai_protocol)",
          "new_text": "MP_OBJ_FROM_PTR(sock)",
          "old_line_content": "            mp_obj_new_int(resi->ai_protocol),",
          "new_line_content": "    return MP_OBJ_FROM_PTR(sock);",
          "content_same": false
        },
        {
          "line": 661,
          "old_api": "ntohs",
          "new_api": "mp_obj_new_int",
          "old_text": "ntohs(addr->sin_port)",
          "new_text": "mp_obj_new_int(resi->ai_family)",
          "old_line_content": "                mp_obj_new_int(ntohs(addr->sin_port))",
          "new_line_content": "            mp_obj_new_int(resi->ai_family),",
          "content_same": false
        },
        {
          "line": 663,
          "old_api": "mp_obj_new_tuple",
          "new_api": "mp_obj_new_int",
          "old_text": "mp_obj_new_tuple(2, inaddr_objs)",
          "new_text": "mp_obj_new_int(resi->ai_protocol)",
          "old_line_content": "            addrinfo_objs[4] = mp_obj_new_tuple(2, inaddr_objs);",
          "new_line_content": "            mp_obj_new_int(resi->ai_protocol),",
          "content_same": false
        },
        {
          "line": 676,
          "old_api": "ESP_LOGI",
          "new_api": "ntohs",
          "old_text": "ESP_LOGI(\"modsocket\", \"Initializing\")",
          "new_text": "ntohs(addr->sin_port)",
          "old_line_content": "        ESP_LOGI(\"modsocket\", \"Initializing\");",
          "new_line_content": "                mp_obj_new_int(ntohs(addr->sin_port))",
          "content_same": false
        },
        {
          "line": 691,
          "old_api": "MP_ROM_INT",
          "new_api": "ESP_LOGI",
          "old_text": "MP_ROM_INT(AF_INET6)",
          "new_text": "ESP_LOGI(\"modsocket\", \"Initializing\")",
          "old_line_content": "    { MP_ROM_QSTR(MP_QSTR_AF_INET6), MP_ROM_INT(AF_INET6) },",
          "new_line_content": "        ESP_LOGI(\"modsocket\", \"Initializing\");",
          "content_same": false
        },
        {
          "line": 692,
          "old_api": "MP_ROM_INT",
          "new_api": "tcpip_adapter_init",
          "old_text": "MP_ROM_INT(SOCK_STREAM)",
          "new_text": "tcpip_adapter_init()",
          "old_line_content": "    { MP_ROM_QSTR(MP_QSTR_SOCK_STREAM), MP_ROM_INT(SOCK_STREAM) },",
          "new_line_content": "        tcpip_adapter_init();",
          "content_same": false
        },
        {
          "line": 700,
          "old_api": "MP_ROM_INT",
          "new_api": "MP_ROM_QSTR",
          "old_text": "MP_ROM_INT(IP_ADD_MEMBERSHIP)",
          "new_text": "MP_ROM_QSTR(MP_QSTR_usocket)",
          "old_line_content": "    { MP_ROM_QSTR(MP_QSTR_IP_ADD_MEMBERSHIP), MP_ROM_INT(IP_ADD_MEMBERSHIP) },",
          "new_line_content": "    { MP_ROM_QSTR(MP_QSTR___name__), MP_ROM_QSTR(MP_QSTR_usocket) },",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 513,
          "old_api": null,
          "new_api": "MP_OBJ_TO_PTR",
          "old_text": null,
          "new_text": "MP_OBJ_TO_PTR(arg0)",
          "old_line_content": "STATIC mp_uint_t socket_stream_write(mp_obj_t self_in, const void *buf, mp_uint_t size, int *errcode) {",
          "new_line_content": "    socket_obj_t *self = MP_OBJ_TO_PTR(arg0);",
          "content_same": false
        },
        {
          "line": 514,
          "old_api": null,
          "new_api": "mp_obj_new_int",
          "old_text": null,
          "new_text": "mp_obj_new_int(self->fd)",
          "old_line_content": "    socket_obj_t *sock = self_in;",
          "new_line_content": "    return mp_obj_new_int(self->fd);",
          "content_same": false
        },
        {
          "line": 525,
          "old_api": null,
          "new_api": "_socket_read_data",
          "old_text": null,
          "new_text": "_socket_read_data(self_in, buf, size, NULL, NULL, errcode)",
          "old_line_content": "}",
          "new_line_content": "    return _socket_read_data(self_in, buf, size, NULL, NULL, errcode);",
          "content_same": false
        },
        {
          "line": 550,
          "old_api": null,
          "new_api": "FD_SET",
          "old_text": null,
          "new_text": "FD_SET(socket->fd, &rfds)",
          "old_line_content": "    } else if (request == MP_STREAM_CLOSE) {",
          "new_line_content": "        if (arg & MP_STREAM_POLL_RD) FD_SET(socket->fd, &rfds);",
          "content_same": false
        },
        {
          "line": 551,
          "old_api": null,
          "new_api": "FD_SET",
          "old_text": null,
          "new_text": "FD_SET(socket->fd, &wfds)",
          "old_line_content": "        if (socket->fd >= 0) {",
          "new_line_content": "        if (arg & MP_STREAM_POLL_WR) FD_SET(socket->fd, &wfds);",
          "content_same": false
        },
        {
          "line": 552,
          "old_api": null,
          "new_api": "FD_SET",
          "old_text": null,
          "new_text": "FD_SET(socket->fd, &efds)",
          "old_line_content": "            #if MICROPY_PY_USOCKET_EVENTS",
          "new_line_content": "        if (arg & MP_STREAM_POLL_HUP) FD_SET(socket->fd, &efds);",
          "content_same": false
        },
        {
          "line": 561,
          "old_api": null,
          "new_api": "FD_ISSET",
          "old_text": null,
          "new_text": "FD_ISSET(socket->fd, &rfds)",
          "old_line_content": "                return MP_STREAM_ERROR;",
          "new_line_content": "        if (FD_ISSET(socket->fd, &rfds)) ret |= MP_STREAM_POLL_RD;",
          "content_same": false
        },
        {
          "line": 562,
          "old_api": null,
          "new_api": "FD_ISSET",
          "old_text": null,
          "new_text": "FD_ISSET(socket->fd, &wfds)",
          "old_line_content": "            }",
          "new_line_content": "        if (FD_ISSET(socket->fd, &wfds)) ret |= MP_STREAM_POLL_WR;",
          "content_same": false
        },
        {
          "line": 563,
          "old_api": null,
          "new_api": "FD_ISSET",
          "old_text": null,
          "new_text": "FD_ISSET(socket->fd, &efds)",
          "old_line_content": "            socket->fd = -1;",
          "new_line_content": "        if (FD_ISSET(socket->fd, &efds)) ret |= MP_STREAM_POLL_HUP;",
          "content_same": false
        },
        {
          "line": 569,
          "old_api": null,
          "new_api": "usocket_events_remove",
          "old_text": null,
          "new_text": "usocket_events_remove(socket)",
          "old_line_content": "    return MP_STREAM_ERROR;",
          "new_line_content": "                usocket_events_remove(socket);",
          "content_same": false
        },
        {
          "line": 589,
          "old_api": null,
          "new_api": "MP_ROM_PTR",
          "old_text": null,
          "new_text": "MP_ROM_PTR(&mp_stream_close_obj)",
          "old_line_content": "",
          "new_line_content": "    { MP_ROM_QSTR(MP_QSTR_close), MP_ROM_PTR(&mp_stream_close_obj) },",
          "content_same": false
        },
        {
          "line": 594,
          "old_api": null,
          "new_api": "MP_ROM_PTR",
          "old_text": null,
          "new_text": "MP_ROM_PTR(&socket_send_obj)",
          "old_line_content": "};",
          "new_line_content": "    { MP_ROM_QSTR(MP_QSTR_send), MP_ROM_PTR(&socket_send_obj) },",
          "content_same": false
        },
        {
          "line": 595,
          "old_api": null,
          "new_api": "MP_ROM_PTR",
          "old_text": null,
          "new_text": "MP_ROM_PTR(&socket_sendall_obj)",
          "old_line_content": "STATIC MP_DEFINE_CONST_DICT(socket_locals_dict, socket_locals_dict_table);",
          "new_line_content": "    { MP_ROM_QSTR(MP_QSTR_sendall), MP_ROM_PTR(&socket_sendall_obj) },",
          "content_same": false
        },
        {
          "line": 596,
          "old_api": null,
          "new_api": "MP_ROM_PTR",
          "old_text": null,
          "new_text": "MP_ROM_PTR(&socket_sendto_obj)",
          "old_line_content": "",
          "new_line_content": "    { MP_ROM_QSTR(MP_QSTR_sendto), MP_ROM_PTR(&socket_sendto_obj) },",
          "content_same": false
        },
        {
          "line": 597,
          "old_api": null,
          "new_api": "MP_ROM_PTR",
          "old_text": null,
          "new_text": "MP_ROM_PTR(&socket_recv_obj)",
          "old_line_content": "STATIC const mp_stream_p_t socket_stream_p = {",
          "new_line_content": "    { MP_ROM_QSTR(MP_QSTR_recv), MP_ROM_PTR(&socket_recv_obj) },",
          "content_same": false
        },
        {
          "line": 598,
          "old_api": null,
          "new_api": "MP_ROM_PTR",
          "old_text": null,
          "new_text": "MP_ROM_PTR(&socket_recvfrom_obj)",
          "old_line_content": "    .read = socket_stream_read,",
          "new_line_content": "    { MP_ROM_QSTR(MP_QSTR_recvfrom), MP_ROM_PTR(&socket_recvfrom_obj) },",
          "content_same": false
        },
        {
          "line": 599,
          "old_api": null,
          "new_api": "MP_ROM_PTR",
          "old_text": null,
          "new_text": "MP_ROM_PTR(&socket_setsockopt_obj)",
          "old_line_content": "    .write = socket_stream_write,",
          "new_line_content": "    { MP_ROM_QSTR(MP_QSTR_setsockopt), MP_ROM_PTR(&socket_setsockopt_obj) },",
          "content_same": false
        },
        {
          "line": 600,
          "old_api": null,
          "new_api": "MP_ROM_PTR",
          "old_text": null,
          "new_text": "MP_ROM_PTR(&socket_settimeout_obj)",
          "old_line_content": "    .ioctl = socket_stream_ioctl",
          "new_line_content": "    { MP_ROM_QSTR(MP_QSTR_settimeout), MP_ROM_PTR(&socket_settimeout_obj) },",
          "content_same": false
        },
        {
          "line": 601,
          "old_api": null,
          "new_api": "MP_ROM_PTR",
          "old_text": null,
          "new_text": "MP_ROM_PTR(&socket_setblocking_obj)",
          "old_line_content": "};",
          "new_line_content": "    { MP_ROM_QSTR(MP_QSTR_setblocking), MP_ROM_PTR(&socket_setblocking_obj) },",
          "content_same": false
        },
        {
          "line": 602,
          "old_api": null,
          "new_api": "MP_ROM_PTR",
          "old_text": null,
          "new_text": "MP_ROM_PTR(&socket_makefile_obj)",
          "old_line_content": "",
          "new_line_content": "    { MP_ROM_QSTR(MP_QSTR_makefile), MP_ROM_PTR(&socket_makefile_obj) },",
          "content_same": false
        },
        {
          "line": 603,
          "old_api": null,
          "new_api": "MP_ROM_PTR",
          "old_text": null,
          "new_text": "MP_ROM_PTR(&socket_fileno_obj)",
          "old_line_content": "STATIC const mp_obj_type_t socket_type = {",
          "new_line_content": "    { MP_ROM_QSTR(MP_QSTR_fileno), MP_ROM_PTR(&socket_fileno_obj) },",
          "content_same": false
        },
        {
          "line": 605,
          "old_api": null,
          "new_api": "MP_ROM_PTR",
          "old_text": null,
          "new_text": "MP_ROM_PTR(&mp_stream_read_obj)",
          "old_line_content": "    .name = MP_QSTR_socket,",
          "new_line_content": "    { MP_ROM_QSTR(MP_QSTR_read), MP_ROM_PTR(&mp_stream_read_obj) },",
          "content_same": false
        },
        {
          "line": 606,
          "old_api": null,
          "new_api": "MP_ROM_PTR",
          "old_text": null,
          "new_text": "MP_ROM_PTR(&mp_stream_readinto_obj)",
          "old_line_content": "    .protocol = &socket_stream_p,",
          "new_line_content": "    { MP_ROM_QSTR(MP_QSTR_readinto), MP_ROM_PTR(&mp_stream_readinto_obj) },",
          "content_same": false
        },
        {
          "line": 607,
          "old_api": null,
          "new_api": "MP_ROM_PTR",
          "old_text": null,
          "new_text": "MP_ROM_PTR(&mp_stream_unbuffered_readline_obj)",
          "old_line_content": "    .locals_dict = (mp_obj_t)&socket_locals_dict,",
          "new_line_content": "    { MP_ROM_QSTR(MP_QSTR_readline), MP_ROM_PTR(&mp_stream_unbuffered_readline_obj) },",
          "content_same": false
        },
        {
          "line": 608,
          "old_api": null,
          "new_api": "MP_ROM_PTR",
          "old_text": null,
          "new_text": "MP_ROM_PTR(&mp_stream_write_obj)",
          "old_line_content": "};",
          "new_line_content": "    { MP_ROM_QSTR(MP_QSTR_write), MP_ROM_PTR(&mp_stream_write_obj) },",
          "content_same": false
        },
        {
          "line": 626,
          "old_api": null,
          "new_api": "m_new_obj_with_finaliser",
          "old_text": null,
          "new_text": "m_new_obj_with_finaliser(socket_obj_t)",
          "old_line_content": "",
          "new_line_content": "    socket_obj_t *sock = m_new_obj_with_finaliser(socket_obj_t);",
          "content_same": false
        },
        {
          "line": 635,
          "old_api": null,
          "new_api": "mp_obj_get_int",
          "old_text": null,
          "new_text": "mp_obj_get_int(args[1])",
          "old_line_content": "STATIC MP_DEFINE_CONST_FUN_OBJ_VAR_BETWEEN(get_socket_obj, 0, 3, get_socket);",
          "new_line_content": "            sock->type = mp_obj_get_int(args[1]);",
          "content_same": false
        },
        {
          "line": 637,
          "old_api": null,
          "new_api": "mp_obj_get_int",
          "old_text": null,
          "new_text": "mp_obj_get_int(args[2])",
          "old_line_content": "STATIC mp_obj_t esp_socket_getaddrinfo(size_t n_args, const mp_obj_t *args) {",
          "new_line_content": "                sock->proto = mp_obj_get_int(args[2]);",
          "content_same": false
        },
        {
          "line": 644,
          "old_api": null,
          "new_api": "exception_from_errno",
          "old_text": null,
          "new_text": "exception_from_errno(errno)",
          "old_line_content": "    for (struct addrinfo *resi = res; resi; resi = resi->ai_next) {",
          "new_line_content": "        exception_from_errno(errno);",
          "content_same": false
        },
        {
          "line": 656,
          "old_api": null,
          "new_api": "_socket_getaddrinfo2",
          "old_text": null,
          "new_text": "_socket_getaddrinfo2(args[0], args[1], &res)",
          "old_line_content": "            ip4_addr_t ip4_addr = { .addr = addr->sin_addr.s_addr };",
          "new_line_content": "    _socket_getaddrinfo2(args[0], args[1], &res);",
          "content_same": false
        },
        {
          "line": 657,
          "old_api": null,
          "new_api": "mp_obj_new_list",
          "old_text": null,
          "new_text": "mp_obj_new_list(0, NULL)",
          "old_line_content": "            char buf[16];",
          "new_line_content": "    mp_obj_t ret_list = mp_obj_new_list(0, NULL);",
          "content_same": false
        },
        {
          "line": 662,
          "old_api": null,
          "new_api": "mp_obj_new_int",
          "old_text": null,
          "new_text": "mp_obj_new_int(resi->ai_socktype)",
          "old_line_content": "            };",
          "new_line_content": "            mp_obj_new_int(resi->ai_socktype),",
          "content_same": false
        },
        {
          "line": 664,
          "old_api": null,
          "new_api": "strlen",
          "old_text": null,
          "new_text": "strlen(resi->ai_canonname)",
          "old_line_content": "        }",
          "new_line_content": "            mp_obj_new_str(resi->ai_canonname, strlen(resi->ai_canonname)),",
          "content_same": false
        },
        {
          "line": 673,
          "old_api": null,
          "new_api": "ip4addr_ntoa_r",
          "old_text": null,
          "new_text": "ip4addr_ntoa_r(&ip4_addr, buf, sizeof(buf))",
          "old_line_content": "STATIC mp_obj_t esp_socket_initialize() {",
          "new_line_content": "            ip4addr_ntoa_r(&ip4_addr, buf, sizeof(buf));",
          "content_same": false
        },
        {
          "line": 675,
          "old_api": null,
          "new_api": "strlen",
          "old_text": null,
          "new_text": "strlen(buf)",
          "old_line_content": "    if (!initialized) {",
          "new_line_content": "                mp_obj_new_str(buf, strlen(buf)),",
          "content_same": false
        },
        {
          "line": 678,
          "old_api": null,
          "new_api": "mp_obj_new_tuple",
          "old_text": null,
          "new_text": "mp_obj_new_tuple(2, inaddr_objs)",
          "old_line_content": "        initialized = 1;",
          "new_line_content": "            addrinfo_objs[4] = mp_obj_new_tuple(2, inaddr_objs);",
          "content_same": false
        },
        {
          "line": 680,
          "old_api": null,
          "new_api": "mp_obj_new_tuple",
          "old_text": null,
          "new_text": "mp_obj_new_tuple(5, addrinfo_objs)",
          "old_line_content": "    return mp_const_none;",
          "new_line_content": "        mp_obj_list_append(ret_list, mp_obj_new_tuple(5, addrinfo_objs));",
          "content_same": false
        },
        {
          "line": 683,
          "old_api": null,
          "new_api": "lwip_freeaddrinfo",
          "old_text": null,
          "new_text": "lwip_freeaddrinfo(res)",
          "old_line_content": "",
          "new_line_content": "    if (res) lwip_freeaddrinfo(res);",
          "content_same": false
        },
        {
          "line": 701,
          "old_api": null,
          "new_api": "MP_ROM_PTR",
          "old_text": null,
          "new_text": "MP_ROM_PTR(&esp_socket_initialize_obj)",
          "old_line_content": "};",
          "new_line_content": "    { MP_ROM_QSTR(MP_QSTR___init__), MP_ROM_PTR(&esp_socket_initialize_obj) },",
          "content_same": false
        },
        {
          "line": 702,
          "old_api": null,
          "new_api": "MP_ROM_PTR",
          "old_text": null,
          "new_text": "MP_ROM_PTR(&get_socket_obj)",
          "old_line_content": "",
          "new_line_content": "    { MP_ROM_QSTR(MP_QSTR_socket), MP_ROM_PTR(&get_socket_obj) },",
          "content_same": false
        },
        {
          "line": 703,
          "old_api": null,
          "new_api": "MP_ROM_PTR",
          "old_text": null,
          "new_text": "MP_ROM_PTR(&esp_socket_getaddrinfo_obj)",
          "old_line_content": "STATIC MP_DEFINE_CONST_DICT(mp_module_socket_globals, mp_module_socket_globals_table);",
          "new_line_content": "    { MP_ROM_QSTR(MP_QSTR_getaddrinfo), MP_ROM_PTR(&esp_socket_getaddrinfo_obj) },",
          "content_same": false
        },
        {
          "line": 705,
          "old_api": null,
          "new_api": "MP_ROM_INT",
          "old_text": null,
          "new_text": "MP_ROM_INT(AF_INET)",
          "old_line_content": "const mp_obj_module_t mp_module_usocket = {",
          "new_line_content": "    { MP_ROM_QSTR(MP_QSTR_AF_INET), MP_ROM_INT(AF_INET) },",
          "content_same": false
        },
        {
          "line": 706,
          "old_api": null,
          "new_api": "MP_ROM_INT",
          "old_text": null,
          "new_text": "MP_ROM_INT(AF_INET6)",
          "old_line_content": "    .base = { &mp_type_module },",
          "new_line_content": "    { MP_ROM_QSTR(MP_QSTR_AF_INET6), MP_ROM_INT(AF_INET6) },",
          "content_same": false
        },
        {
          "line": 707,
          "old_api": null,
          "new_api": "MP_ROM_INT",
          "old_text": null,
          "new_text": "MP_ROM_INT(SOCK_STREAM)",
          "old_line_content": "    .globals = (mp_obj_dict_t*)&mp_module_socket_globals,",
          "new_line_content": "    { MP_ROM_QSTR(MP_QSTR_SOCK_STREAM), MP_ROM_INT(SOCK_STREAM) },",
          "content_same": false
        },
        {
          "line": 708,
          "old_api": null,
          "new_api": "MP_ROM_INT",
          "old_text": null,
          "new_text": "MP_ROM_INT(SOCK_DGRAM)",
          "old_line_content": "};",
          "new_line_content": "    { MP_ROM_QSTR(MP_QSTR_SOCK_DGRAM), MP_ROM_INT(SOCK_DGRAM) },",
          "content_same": false
        },
        {
          "line": 709,
          "old_api": null,
          "new_api": "MP_ROM_INT",
          "old_text": null,
          "new_text": "MP_ROM_INT(SOCK_RAW)",
          "old_line_content": "",
          "new_line_content": "    { MP_ROM_QSTR(MP_QSTR_SOCK_RAW), MP_ROM_INT(SOCK_RAW) },",
          "content_same": false
        },
        {
          "line": 710,
          "old_api": null,
          "new_api": "MP_ROM_INT",
          "old_text": null,
          "new_text": "MP_ROM_INT(IPPROTO_TCP)",
          "old_line_content": "",
          "new_line_content": "    { MP_ROM_QSTR(MP_QSTR_IPPROTO_TCP), MP_ROM_INT(IPPROTO_TCP) },",
          "content_same": false
        },
        {
          "line": 711,
          "old_api": null,
          "new_api": "MP_ROM_INT",
          "old_text": null,
          "new_text": "MP_ROM_INT(IPPROTO_UDP)",
          "old_line_content": "",
          "new_line_content": "    { MP_ROM_QSTR(MP_QSTR_IPPROTO_UDP), MP_ROM_INT(IPPROTO_UDP) },",
          "content_same": false
        },
        {
          "line": 712,
          "old_api": null,
          "new_api": "MP_ROM_INT",
          "old_text": null,
          "new_text": "MP_ROM_INT(IPPROTO_IP)",
          "old_line_content": "",
          "new_line_content": "    { MP_ROM_QSTR(MP_QSTR_IPPROTO_IP), MP_ROM_INT(IPPROTO_IP) },",
          "content_same": false
        },
        {
          "line": 713,
          "old_api": null,
          "new_api": "MP_ROM_INT",
          "old_text": null,
          "new_text": "MP_ROM_INT(SOL_SOCKET)",
          "old_line_content": "",
          "new_line_content": "    { MP_ROM_QSTR(MP_QSTR_SOL_SOCKET), MP_ROM_INT(SOL_SOCKET) },",
          "content_same": false
        },
        {
          "line": 714,
          "old_api": null,
          "new_api": "MP_ROM_INT",
          "old_text": null,
          "new_text": "MP_ROM_INT(SO_REUSEADDR)",
          "old_line_content": "",
          "new_line_content": "    { MP_ROM_QSTR(MP_QSTR_SO_REUSEADDR), MP_ROM_INT(SO_REUSEADDR) },",
          "content_same": false
        },
        {
          "line": 715,
          "old_api": null,
          "new_api": "MP_ROM_INT",
          "old_text": null,
          "new_text": "MP_ROM_INT(IP_ADD_MEMBERSHIP)",
          "old_line_content": "",
          "new_line_content": "    { MP_ROM_QSTR(MP_QSTR_IP_ADD_MEMBERSHIP), MP_ROM_INT(IP_ADD_MEMBERSHIP) },",
          "content_same": false
        },
        {
          "line": 383,
          "old_api": null,
          "new_api": "FD_ZERO",
          "old_text": null,
          "new_text": "FD_ZERO(&rfds)",
          "old_line_content": "        }",
          "new_line_content": "            FD_ZERO(&rfds);",
          "content_same": false
        },
        {
          "line": 384,
          "old_api": null,
          "new_api": "FD_SET",
          "old_text": null,
          "new_text": "FD_SET(sock->fd, &rfds)",
          "old_line_content": "        if (r >= 0) {",
          "new_line_content": "            FD_SET(sock->fd, &rfds);",
          "content_same": false
        },
        {
          "line": 386,
          "old_api": null,
          "new_api": "select",
          "old_text": null,
          "new_text": "select(sock->fd + 1, &rfds, NULL, NULL, &timeout)",
          "old_line_content": "        }",
          "new_line_content": "            int r = select(sock->fd + 1, &rfds, NULL, NULL, &timeout);",
          "content_same": false
        },
        {
          "line": 390,
          "old_api": null,
          "new_api": "MP_THREAD_GIL_EXIT",
          "old_text": null,
          "new_text": "MP_THREAD_GIL_EXIT()",
          "old_line_content": "        }",
          "new_line_content": "            MP_THREAD_GIL_EXIT();",
          "content_same": false
        },
        {
          "line": 392,
          "old_api": null,
          "new_api": "lwip_recvfrom_r",
          "old_text": null,
          "new_text": "lwip_recvfrom_r(sock->fd, buf, size, 0, from, from_len)",
          "old_line_content": "    }",
          "new_line_content": "        int r = lwip_recvfrom_r(sock->fd, buf, size, 0, from, from_len);",
          "content_same": false
        },
        {
          "line": 394,
          "old_api": null,
          "new_api": "MP_THREAD_GIL_ENTER",
          "old_text": null,
          "new_text": "MP_THREAD_GIL_ENTER()",
          "old_line_content": "    *errcode = sock->retries == 0 ? MP_EWOULDBLOCK : MP_ETIMEDOUT;",
          "new_line_content": "            MP_THREAD_GIL_ENTER();",
          "content_same": false
        },
        {
          "line": 406,
          "old_api": null,
          "new_api": "check_for_exceptions",
          "old_text": null,
          "new_text": "check_for_exceptions()",
          "old_line_content": "    if (ret == MP_STREAM_ERROR) {",
          "new_line_content": "        check_for_exceptions();",
          "content_same": false
        },
        {
          "line": 417,
          "old_api": null,
          "new_api": "vstr_init_len",
          "old_text": null,
          "new_text": "vstr_init_len(&vstr, len)",
          "old_line_content": "STATIC MP_DEFINE_CONST_FUN_OBJ_2(socket_recv_obj, socket_recv);",
          "new_line_content": "    vstr_init_len(&vstr, len);",
          "content_same": false
        },
        {
          "line": 420,
          "old_api": null,
          "new_api": "_socket_read_data",
          "old_text": null,
          "new_text": "_socket_read_data(self_in, vstr.buf, len, from, from_len, &errcode)",
          "old_line_content": "    struct sockaddr from;",
          "new_line_content": "    mp_uint_t ret = _socket_read_data(self_in, vstr.buf, len, from, from_len, &errcode);",
          "content_same": false
        },
        {
          "line": 422,
          "old_api": null,
          "new_api": "exception_from_errno",
          "old_text": null,
          "new_text": "exception_from_errno(errcode)",
          "old_line_content": "",
          "new_line_content": "        exception_from_errno(errcode);",
          "content_same": false
        },
        {
          "line": 426,
          "old_api": null,
          "new_api": "mp_obj_new_str_from_vstr",
          "old_text": null,
          "new_text": "mp_obj_new_str_from_vstr(&mp_type_bytes, &vstr)",
          "old_line_content": "    uint8_t *ip = (uint8_t*)&((struct sockaddr_in*)&from)->sin_addr;",
          "new_line_content": "    return mp_obj_new_str_from_vstr(&mp_type_bytes, &vstr);",
          "content_same": false
        },
        {
          "line": 443,
          "old_api": null,
          "new_api": "netutils_format_inet_addr",
          "old_text": null,
          "new_text": "netutils_format_inet_addr(ip, port, NETUTILS_BIG)",
          "old_line_content": "    }",
          "new_line_content": "    tuple[1] = netutils_format_inet_addr(ip, port, NETUTILS_BIG);",
          "content_same": false
        },
        {
          "line": 445,
          "old_api": null,
          "new_api": "mp_obj_new_tuple",
          "old_text": null,
          "new_text": "mp_obj_new_tuple(2, tuple)",
          "old_line_content": "    return sentlen;",
          "new_line_content": "    return mp_obj_new_tuple(2, tuple);",
          "content_same": false
        },
        {
          "line": 454,
          "old_api": null,
          "new_api": "MP_THREAD_GIL_ENTER",
          "old_text": null,
          "new_text": "MP_THREAD_GIL_ENTER()",
          "old_line_content": "}",
          "new_line_content": "        MP_THREAD_GIL_ENTER();",
          "content_same": false
        },
        {
          "line": 455,
          "old_api": null,
          "new_api": "exception_from_errno",
          "old_text": null,
          "new_text": "exception_from_errno(errno)",
          "old_line_content": "STATIC MP_DEFINE_CONST_FUN_OBJ_2(socket_send_obj, socket_send);",
          "new_line_content": "        if (r < 0 && errno != EWOULDBLOCK) exception_from_errno(errno);",
          "content_same": false
        },
        {
          "line": 457,
          "old_api": null,
          "new_api": "check_for_exceptions",
          "old_text": null,
          "new_text": "check_for_exceptions()",
          "old_line_content": "STATIC mp_obj_t socket_sendall(const mp_obj_t arg0, const mp_obj_t arg1) {",
          "new_line_content": "        check_for_exceptions();",
          "content_same": false
        },
        {
          "line": 459,
          "old_api": null,
          "new_api": "mp_raise_OSError",
          "old_text": null,
          "new_text": "mp_raise_OSError(MP_ETIMEDOUT)",
          "old_line_content": "    // XXX also timeout behaviour.",
          "new_line_content": "    if (sentlen == 0) mp_raise_OSError(MP_ETIMEDOUT); ",
          "content_same": false
        },
        {
          "line": 466,
          "old_api": null,
          "new_api": "mp_obj_str_get_data",
          "old_text": null,
          "new_text": "mp_obj_str_get_data(arg1, &datalen)",
          "old_line_content": "}",
          "new_line_content": "    const char *data = mp_obj_str_get_data(arg1, &datalen);",
          "content_same": false
        },
        {
          "line": 467,
          "old_api": null,
          "new_api": "_socket_send",
          "old_text": null,
          "new_text": "_socket_send(sock, data, datalen)",
          "old_line_content": "STATIC MP_DEFINE_CONST_FUN_OBJ_2(socket_sendall_obj, socket_sendall);",
          "new_line_content": "    int r = _socket_send(sock, data, datalen);",
          "content_same": false
        },
        {
          "line": 468,
          "old_api": null,
          "new_api": "mp_obj_new_int",
          "old_text": null,
          "new_text": "mp_obj_new_int(r)",
          "old_line_content": "",
          "new_line_content": "    return mp_obj_new_int(r);",
          "content_same": false
        },
        {
          "line": 475,
          "old_api": null,
          "new_api": "MP_OBJ_TO_PTR",
          "old_text": null,
          "new_text": "MP_OBJ_TO_PTR(arg0)",
          "old_line_content": "",
          "new_line_content": "    socket_obj_t *sock = MP_OBJ_TO_PTR(arg0);",
          "content_same": false
        },
        {
          "line": 477,
          "old_api": null,
          "new_api": "mp_get_buffer_raise",
          "old_text": null,
          "new_text": "mp_get_buffer_raise(arg1, &bufinfo, MP_BUFFER_READ)",
          "old_line_content": "    struct sockaddr_in to;",
          "new_line_content": "    mp_get_buffer_raise(arg1, &bufinfo, MP_BUFFER_READ);",
          "content_same": false
        },
        {
          "line": 478,
          "old_api": null,
          "new_api": "_socket_send",
          "old_text": null,
          "new_text": "_socket_send(sock, bufinfo.buf, bufinfo.len)",
          "old_line_content": "    to.sin_len = sizeof(to);",
          "new_line_content": "    int r = _socket_send(sock, bufinfo.buf, bufinfo.len);",
          "content_same": false
        },
        {
          "line": 479,
          "old_api": null,
          "new_api": "mp_raise_OSError",
          "old_text": null,
          "new_text": "mp_raise_OSError(MP_ETIMEDOUT)",
          "old_line_content": "    to.sin_family = AF_INET;",
          "new_line_content": "    if (r < bufinfo.len) mp_raise_OSError(MP_ETIMEDOUT);",
          "content_same": false
        },
        {
          "line": 495,
          "old_api": null,
          "new_api": "netutils_parse_inet_addr",
          "old_text": null,
          "new_text": "netutils_parse_inet_addr(addr_in, (uint8_t*)&to.sin_addr, NETUTILS_BIG)",
          "old_line_content": "STATIC MP_DEFINE_CONST_FUN_OBJ_3(socket_sendto_obj, socket_sendto);",
          "new_line_content": "    to.sin_port = lwip_htons(netutils_parse_inet_addr(addr_in, (uint8_t*)&to.sin_addr, NETUTILS_BIG));",
          "content_same": false
        },
        {
          "line": 500,
          "old_api": null,
          "new_api": "lwip_sendto_r",
          "old_text": null,
          "new_text": "lwip_sendto_r(self->fd, bufinfo.buf, bufinfo.len, 0, (struct sockaddr*)&to, sizeof(to))",
          "old_line_content": "}",
          "new_line_content": "        int ret = lwip_sendto_r(self->fd, bufinfo.buf, bufinfo.len, 0, (struct sockaddr*)&to, sizeof(to));",
          "content_same": false
        },
        {
          "line": 501,
          "old_api": null,
          "new_api": "MP_THREAD_GIL_ENTER",
          "old_text": null,
          "new_text": "MP_THREAD_GIL_ENTER()",
          "old_line_content": "STATIC MP_DEFINE_CONST_FUN_OBJ_1(socket_fileno_obj, socket_fileno);",
          "new_line_content": "        MP_THREAD_GIL_ENTER();",
          "content_same": false
        },
        {
          "line": 502,
          "old_api": null,
          "new_api": "mp_obj_new_int_from_uint",
          "old_text": null,
          "new_text": "mp_obj_new_int_from_uint(ret)",
          "old_line_content": "",
          "new_line_content": "        if (ret > 0) return mp_obj_new_int_from_uint(ret);",
          "content_same": false
        },
        {
          "line": 504,
          "old_api": null,
          "new_api": "exception_from_errno",
          "old_text": null,
          "new_text": "exception_from_errno(errno)",
          "old_line_content": "    (void)n_args;",
          "new_line_content": "            exception_from_errno(errno);",
          "content_same": false
        },
        {
          "line": 506,
          "old_api": null,
          "new_api": "check_for_exceptions",
          "old_text": null,
          "new_text": "check_for_exceptions()",
          "old_line_content": "}",
          "new_line_content": "        check_for_exceptions();",
          "content_same": false
        },
        {
          "line": 508,
          "old_api": null,
          "new_api": "mp_raise_OSError",
          "old_text": null,
          "new_text": "mp_raise_OSError(MP_ETIMEDOUT)",
          "old_line_content": "",
          "new_line_content": "    mp_raise_OSError(MP_ETIMEDOUT); ",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 516,
          "old_api": "MP_THREAD_GIL_EXIT",
          "new_api": null,
          "old_text": "MP_THREAD_GIL_EXIT()",
          "new_text": null,
          "old_line_content": "        MP_THREAD_GIL_EXIT();",
          "new_line_content": "STATIC MP_DEFINE_CONST_FUN_OBJ_1(socket_fileno_obj, socket_fileno);",
          "content_same": false
        },
        {
          "line": 517,
          "old_api": "lwip_write_r",
          "new_api": null,
          "old_text": "lwip_write_r(sock->fd, buf, size)",
          "new_text": null,
          "old_line_content": "        int r = lwip_write_r(sock->fd, buf, size);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 518,
          "old_api": "MP_THREAD_GIL_ENTER",
          "new_api": null,
          "old_text": "MP_THREAD_GIL_ENTER()",
          "new_text": null,
          "old_line_content": "        MP_THREAD_GIL_ENTER();",
          "new_line_content": "STATIC mp_obj_t socket_makefile(size_t n_args, const mp_obj_t *args) {",
          "content_same": false
        },
        {
          "line": 521,
          "old_api": "check_for_exceptions",
          "new_api": null,
          "old_text": "check_for_exceptions()",
          "new_text": null,
          "old_line_content": "        check_for_exceptions();",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 535,
          "old_api": "FD_SET",
          "new_api": null,
          "old_text": "FD_SET(socket->fd, &rfds)",
          "new_text": null,
          "old_line_content": "        if (arg & MP_STREAM_POLL_RD) FD_SET(socket->fd, &rfds);",
          "new_line_content": "        if (r < 0 && errno != EWOULDBLOCK) { *errcode = errno; return MP_STREAM_ERROR; }",
          "content_same": false
        },
        {
          "line": 537,
          "old_api": "FD_SET",
          "new_api": null,
          "old_text": "FD_SET(socket->fd, &efds)",
          "new_text": null,
          "old_line_content": "        if (arg & MP_STREAM_POLL_HUP) FD_SET(socket->fd, &efds);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 539,
          "old_api": "select",
          "new_api": null,
          "old_text": "select((socket->fd)+1, &rfds, &wfds, &efds, &timeout)",
          "new_text": null,
          "old_line_content": "        int r = select((socket->fd)+1, &rfds, &wfds, &efds, &timeout);",
          "new_line_content": "    return MP_STREAM_ERROR;",
          "content_same": false
        },
        {
          "line": 558,
          "old_api": "lwip_close_r",
          "new_api": null,
          "old_text": "lwip_close_r(socket->fd)",
          "new_text": null,
          "old_line_content": "            int ret = lwip_close_r(socket->fd);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 574,
          "old_api": "MP_ROM_PTR",
          "new_api": null,
          "old_text": "MP_ROM_PTR(&mp_stream_close_obj)",
          "new_text": null,
          "old_line_content": "    { MP_ROM_QSTR(MP_QSTR_close), MP_ROM_PTR(&mp_stream_close_obj) },",
          "new_line_content": "            if (ret != 0) {",
          "content_same": false
        },
        {
          "line": 575,
          "old_api": "MP_ROM_PTR",
          "new_api": null,
          "old_text": "MP_ROM_PTR(&socket_bind_obj)",
          "new_text": null,
          "old_line_content": "    { MP_ROM_QSTR(MP_QSTR_bind), MP_ROM_PTR(&socket_bind_obj) },",
          "new_line_content": "                *errcode = errno;",
          "content_same": false
        },
        {
          "line": 576,
          "old_api": "MP_ROM_PTR",
          "new_api": null,
          "old_text": "MP_ROM_PTR(&socket_listen_obj)",
          "new_text": null,
          "old_line_content": "    { MP_ROM_QSTR(MP_QSTR_listen), MP_ROM_PTR(&socket_listen_obj) },",
          "new_line_content": "                return MP_STREAM_ERROR;",
          "content_same": false
        },
        {
          "line": 577,
          "old_api": "MP_ROM_PTR",
          "new_api": null,
          "old_text": "MP_ROM_PTR(&socket_accept_obj)",
          "new_text": null,
          "old_line_content": "    { MP_ROM_QSTR(MP_QSTR_accept), MP_ROM_PTR(&socket_accept_obj) },",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 578,
          "old_api": "MP_ROM_PTR",
          "new_api": null,
          "old_text": "MP_ROM_PTR(&socket_connect_obj)",
          "new_text": null,
          "old_line_content": "    { MP_ROM_QSTR(MP_QSTR_connect), MP_ROM_PTR(&socket_connect_obj) },",
          "new_line_content": "            socket->fd = -1;",
          "content_same": false
        },
        {
          "line": 579,
          "old_api": "MP_ROM_PTR",
          "new_api": null,
          "old_text": "MP_ROM_PTR(&socket_send_obj)",
          "new_text": null,
          "old_line_content": "    { MP_ROM_QSTR(MP_QSTR_send), MP_ROM_PTR(&socket_send_obj) },",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 580,
          "old_api": "MP_ROM_PTR",
          "new_api": null,
          "old_text": "MP_ROM_PTR(&socket_sendall_obj)",
          "new_text": null,
          "old_line_content": "    { MP_ROM_QSTR(MP_QSTR_sendall), MP_ROM_PTR(&socket_sendall_obj) },",
          "new_line_content": "        return 0;",
          "content_same": false
        },
        {
          "line": 581,
          "old_api": "MP_ROM_PTR",
          "new_api": null,
          "old_text": "MP_ROM_PTR(&socket_sendto_obj)",
          "new_text": null,
          "old_line_content": "    { MP_ROM_QSTR(MP_QSTR_sendto), MP_ROM_PTR(&socket_sendto_obj) },",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 582,
          "old_api": "MP_ROM_PTR",
          "new_api": null,
          "old_text": "MP_ROM_PTR(&socket_recv_obj)",
          "new_text": null,
          "old_line_content": "    { MP_ROM_QSTR(MP_QSTR_recv), MP_ROM_PTR(&socket_recv_obj) },",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 583,
          "old_api": "MP_ROM_PTR",
          "new_api": null,
          "old_text": "MP_ROM_PTR(&socket_recvfrom_obj)",
          "new_text": null,
          "old_line_content": "    { MP_ROM_QSTR(MP_QSTR_recvfrom), MP_ROM_PTR(&socket_recvfrom_obj) },",
          "new_line_content": "    *errcode = MP_EINVAL;",
          "content_same": false
        },
        {
          "line": 584,
          "old_api": "MP_ROM_PTR",
          "new_api": null,
          "old_text": "MP_ROM_PTR(&socket_setsockopt_obj)",
          "new_text": null,
          "old_line_content": "    { MP_ROM_QSTR(MP_QSTR_setsockopt), MP_ROM_PTR(&socket_setsockopt_obj) },",
          "new_line_content": "    return MP_STREAM_ERROR;",
          "content_same": false
        },
        {
          "line": 585,
          "old_api": "MP_ROM_PTR",
          "new_api": null,
          "old_text": "MP_ROM_PTR(&socket_settimeout_obj)",
          "new_text": null,
          "old_line_content": "    { MP_ROM_QSTR(MP_QSTR_settimeout), MP_ROM_PTR(&socket_settimeout_obj) },",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 586,
          "old_api": "MP_ROM_PTR",
          "new_api": null,
          "old_text": "MP_ROM_PTR(&socket_setblocking_obj)",
          "new_text": null,
          "old_line_content": "    { MP_ROM_QSTR(MP_QSTR_setblocking), MP_ROM_PTR(&socket_setblocking_obj) },",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 587,
          "old_api": "MP_ROM_PTR",
          "new_api": null,
          "old_text": "MP_ROM_PTR(&socket_makefile_obj)",
          "new_text": null,
          "old_line_content": "    { MP_ROM_QSTR(MP_QSTR_makefile), MP_ROM_PTR(&socket_makefile_obj) },",
          "new_line_content": "STATIC const mp_rom_map_elem_t socket_locals_dict_table[] = {",
          "content_same": false
        },
        {
          "line": 611,
          "old_api": "m_new_obj_with_finaliser",
          "new_api": null,
          "old_text": "m_new_obj_with_finaliser(socket_obj_t)",
          "new_text": null,
          "old_line_content": "    socket_obj_t *sock = m_new_obj_with_finaliser(socket_obj_t);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 618,
          "old_api": "mp_obj_get_int",
          "new_api": null,
          "old_text": "mp_obj_get_int(args[0])",
          "new_text": null,
          "old_line_content": "        sock->domain = mp_obj_get_int(args[0]);",
          "new_line_content": "STATIC const mp_obj_type_t socket_type = {",
          "content_same": false
        },
        {
          "line": 620,
          "old_api": "mp_obj_get_int",
          "new_api": null,
          "old_text": "mp_obj_get_int(args[1])",
          "new_text": null,
          "old_line_content": "            sock->type = mp_obj_get_int(args[1]);",
          "new_line_content": "    .name = MP_QSTR_socket,",
          "content_same": false
        },
        {
          "line": 622,
          "old_api": "mp_obj_get_int",
          "new_api": null,
          "old_text": "mp_obj_get_int(args[2])",
          "new_text": null,
          "old_line_content": "                sock->proto = mp_obj_get_int(args[2]);",
          "new_line_content": "    .locals_dict = (mp_obj_t)&socket_locals_dict,",
          "content_same": false
        },
        {
          "line": 627,
          "old_api": "lwip_socket",
          "new_api": null,
          "old_text": "lwip_socket(sock->domain, sock->type, sock->proto)",
          "new_text": null,
          "old_line_content": "    sock->fd = lwip_socket(sock->domain, sock->type, sock->proto);",
          "new_line_content": "    sock->base.type = &socket_type;",
          "content_same": false
        },
        {
          "line": 629,
          "old_api": "exception_from_errno",
          "new_api": null,
          "old_text": "exception_from_errno(errno)",
          "new_text": null,
          "old_line_content": "        exception_from_errno(errno);",
          "new_line_content": "    sock->type = SOCK_STREAM;",
          "content_same": false
        },
        {
          "line": 631,
          "old_api": "_socket_settimeout",
          "new_api": null,
          "old_text": "_socket_settimeout(sock, UINT64_MAX)",
          "new_text": null,
          "old_line_content": "    _socket_settimeout(sock, UINT64_MAX);",
          "new_line_content": "    sock->peer_closed = false;",
          "content_same": false
        },
        {
          "line": 641,
          "old_api": "_socket_getaddrinfo2",
          "new_api": null,
          "old_text": "_socket_getaddrinfo2(args[0], args[1], &res)",
          "new_text": null,
          "old_line_content": "    _socket_getaddrinfo2(args[0], args[1], &res);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 647,
          "old_api": "mp_obj_new_int",
          "new_api": null,
          "old_text": "mp_obj_new_int(resi->ai_socktype)",
          "new_text": null,
          "old_line_content": "            mp_obj_new_int(resi->ai_socktype),",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 649,
          "old_api": "strlen",
          "new_api": null,
          "old_text": "strlen(resi->ai_canonname)",
          "new_text": null,
          "old_line_content": "            mp_obj_new_str(resi->ai_canonname, strlen(resi->ai_canonname)),",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 658,
          "old_api": "ip4addr_ntoa_r",
          "new_api": null,
          "old_text": "ip4addr_ntoa_r(&ip4_addr, buf, sizeof(buf))",
          "new_text": null,
          "old_line_content": "            ip4addr_ntoa_r(&ip4_addr, buf, sizeof(buf));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 660,
          "old_api": "strlen",
          "new_api": null,
          "old_text": "strlen(buf)",
          "new_text": null,
          "old_line_content": "                mp_obj_new_str(buf, strlen(buf)),",
          "new_line_content": "        mp_obj_t addrinfo_objs[5] = {",
          "content_same": false
        },
        {
          "line": 665,
          "old_api": "mp_obj_new_tuple",
          "new_api": null,
          "old_text": "mp_obj_new_tuple(5, addrinfo_objs)",
          "new_text": null,
          "old_line_content": "        mp_obj_list_append(ret_list, mp_obj_new_tuple(5, addrinfo_objs));",
          "new_line_content": "            mp_const_none",
          "content_same": false
        },
        {
          "line": 668,
          "old_api": "lwip_freeaddrinfo",
          "new_api": null,
          "old_text": "lwip_freeaddrinfo(res)",
          "new_text": null,
          "old_line_content": "    if (res) lwip_freeaddrinfo(res);",
          "new_line_content": "        if (resi->ai_family == AF_INET) {",
          "content_same": false
        },
        {
          "line": 677,
          "old_api": "tcpip_adapter_init",
          "new_api": null,
          "old_text": "tcpip_adapter_init()",
          "new_text": null,
          "old_line_content": "        tcpip_adapter_init();",
          "new_line_content": "            };",
          "content_same": false
        },
        {
          "line": 685,
          "old_api": "MP_ROM_QSTR",
          "new_api": null,
          "old_text": "MP_ROM_QSTR(MP_QSTR_usocket)",
          "new_text": null,
          "old_line_content": "    { MP_ROM_QSTR(MP_QSTR___name__), MP_ROM_QSTR(MP_QSTR_usocket) },",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 686,
          "old_api": "MP_ROM_PTR",
          "new_api": null,
          "old_text": "MP_ROM_PTR(&esp_socket_initialize_obj)",
          "new_text": null,
          "old_line_content": "    { MP_ROM_QSTR(MP_QSTR___init__), MP_ROM_PTR(&esp_socket_initialize_obj) },",
          "new_line_content": "STATIC MP_DEFINE_CONST_FUN_OBJ_VAR_BETWEEN(esp_socket_getaddrinfo_obj, 2, 6, esp_socket_getaddrinfo);",
          "content_same": false
        },
        {
          "line": 687,
          "old_api": "MP_ROM_PTR",
          "new_api": null,
          "old_text": "MP_ROM_PTR(&get_socket_obj)",
          "new_text": null,
          "old_line_content": "    { MP_ROM_QSTR(MP_QSTR_socket), MP_ROM_PTR(&get_socket_obj) },",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 688,
          "old_api": "MP_ROM_PTR",
          "new_api": null,
          "old_text": "MP_ROM_PTR(&esp_socket_getaddrinfo_obj)",
          "new_text": null,
          "old_line_content": "    { MP_ROM_QSTR(MP_QSTR_getaddrinfo), MP_ROM_PTR(&esp_socket_getaddrinfo_obj) },",
          "new_line_content": "STATIC mp_obj_t esp_socket_initialize() {",
          "content_same": false
        },
        {
          "line": 690,
          "old_api": "MP_ROM_INT",
          "new_api": null,
          "old_text": "MP_ROM_INT(AF_INET)",
          "new_text": null,
          "old_line_content": "    { MP_ROM_QSTR(MP_QSTR_AF_INET), MP_ROM_INT(AF_INET) },",
          "new_line_content": "    if (!initialized) {",
          "content_same": false
        },
        {
          "line": 693,
          "old_api": "MP_ROM_INT",
          "new_api": null,
          "old_text": "MP_ROM_INT(SOCK_DGRAM)",
          "new_text": null,
          "old_line_content": "    { MP_ROM_QSTR(MP_QSTR_SOCK_DGRAM), MP_ROM_INT(SOCK_DGRAM) },",
          "new_line_content": "        initialized = 1;",
          "content_same": false
        },
        {
          "line": 694,
          "old_api": "MP_ROM_INT",
          "new_api": null,
          "old_text": "MP_ROM_INT(SOCK_RAW)",
          "new_text": null,
          "old_line_content": "    { MP_ROM_QSTR(MP_QSTR_SOCK_RAW), MP_ROM_INT(SOCK_RAW) },",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 695,
          "old_api": "MP_ROM_INT",
          "new_api": null,
          "old_text": "MP_ROM_INT(IPPROTO_TCP)",
          "new_text": null,
          "old_line_content": "    { MP_ROM_QSTR(MP_QSTR_IPPROTO_TCP), MP_ROM_INT(IPPROTO_TCP) },",
          "new_line_content": "    return mp_const_none;",
          "content_same": false
        },
        {
          "line": 696,
          "old_api": "MP_ROM_INT",
          "new_api": null,
          "old_text": "MP_ROM_INT(IPPROTO_UDP)",
          "new_text": null,
          "old_line_content": "    { MP_ROM_QSTR(MP_QSTR_IPPROTO_UDP), MP_ROM_INT(IPPROTO_UDP) },",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 697,
          "old_api": "MP_ROM_INT",
          "new_api": null,
          "old_text": "MP_ROM_INT(IPPROTO_IP)",
          "new_text": null,
          "old_line_content": "    { MP_ROM_QSTR(MP_QSTR_IPPROTO_IP), MP_ROM_INT(IPPROTO_IP) },",
          "new_line_content": "STATIC MP_DEFINE_CONST_FUN_OBJ_0(esp_socket_initialize_obj, esp_socket_initialize);",
          "content_same": false
        },
        {
          "line": 698,
          "old_api": "MP_ROM_INT",
          "new_api": null,
          "old_text": "MP_ROM_INT(SOL_SOCKET)",
          "new_text": null,
          "old_line_content": "    { MP_ROM_QSTR(MP_QSTR_SOL_SOCKET), MP_ROM_INT(SOL_SOCKET) },",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 699,
          "old_api": "MP_ROM_INT",
          "new_api": null,
          "old_text": "MP_ROM_INT(SO_REUSEADDR)",
          "new_text": null,
          "old_line_content": "    { MP_ROM_QSTR(MP_QSTR_SO_REUSEADDR), MP_ROM_INT(SO_REUSEADDR) },",
          "new_line_content": "STATIC const mp_rom_map_elem_t mp_module_socket_globals_table[] = {",
          "content_same": false
        },
        {
          "line": 378,
          "old_api": "MP_THREAD_GIL_EXIT",
          "new_api": null,
          "old_text": "MP_THREAD_GIL_EXIT()",
          "new_text": null,
          "old_line_content": "        MP_THREAD_GIL_EXIT();",
          "new_line_content": "        // Poll the socket to see if it has waiting data and only release the GIL if it doesn't.",
          "content_same": false
        },
        {
          "line": 379,
          "old_api": "lwip_recvfrom_r",
          "new_api": null,
          "old_text": "lwip_recvfrom_r(sock->fd, buf, size, 0, from, from_len)",
          "new_text": null,
          "old_line_content": "        int r = lwip_recvfrom_r(sock->fd, buf, size, 0, from, from_len);",
          "new_line_content": "        // This ensures higher performance in the case of many small reads, eg for readline.",
          "content_same": false
        },
        {
          "line": 380,
          "old_api": "MP_THREAD_GIL_ENTER",
          "new_api": null,
          "old_text": "MP_THREAD_GIL_ENTER()",
          "new_text": null,
          "old_line_content": "        MP_THREAD_GIL_ENTER();",
          "new_line_content": "        bool release_gil;",
          "content_same": false
        },
        {
          "line": 391,
          "old_api": "check_for_exceptions",
          "new_api": null,
          "old_text": "check_for_exceptions()",
          "new_text": null,
          "old_line_content": "        check_for_exceptions();",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 400,
          "old_api": "mp_obj_get_int",
          "new_api": null,
          "old_text": "mp_obj_get_int(len_in)",
          "new_text": null,
          "old_line_content": "    size_t len = mp_obj_get_int(len_in);",
          "new_line_content": "            return r;",
          "content_same": false
        },
        {
          "line": 402,
          "old_api": "vstr_init_len",
          "new_api": null,
          "old_text": "vstr_init_len(&vstr, len)",
          "new_text": null,
          "old_line_content": "    vstr_init_len(&vstr, len);",
          "new_line_content": "        if (errno != EWOULDBLOCK) {",
          "content_same": false
        },
        {
          "line": 405,
          "old_api": "_socket_read_data",
          "new_api": null,
          "old_text": "_socket_read_data(self_in, vstr.buf, len, from, from_len, &errcode)",
          "new_text": null,
          "old_line_content": "    mp_uint_t ret = _socket_read_data(self_in, vstr.buf, len, from, from_len, &errcode);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 407,
          "old_api": "exception_from_errno",
          "new_api": null,
          "old_text": "exception_from_errno(errcode)",
          "new_text": null,
          "old_line_content": "        exception_from_errno(errcode);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 411,
          "old_api": "mp_obj_new_str_from_vstr",
          "new_api": null,
          "old_text": "mp_obj_new_str_from_vstr(&mp_type_bytes, &vstr)",
          "new_text": null,
          "old_line_content": "    return mp_obj_new_str_from_vstr(&mp_type_bytes, &vstr);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 424,
          "old_api": "_socket_recvfrom",
          "new_api": null,
          "old_text": "_socket_recvfrom(self_in, len_in, &from, &fromlen)",
          "new_text": null,
          "old_line_content": "    tuple[0] = _socket_recvfrom(self_in, len_in, &from, &fromlen);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 427,
          "old_api": "lwip_ntohs",
          "new_api": null,
          "old_text": "lwip_ntohs(((struct sockaddr_in*)&from)->sin_port)",
          "new_text": null,
          "old_line_content": "    mp_uint_t port = lwip_ntohs(((struct sockaddr_in*)&from)->sin_port);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 428,
          "old_api": "netutils_format_inet_addr",
          "new_api": null,
          "old_text": "netutils_format_inet_addr(ip, port, NETUTILS_BIG)",
          "new_text": null,
          "old_line_content": "    tuple[1] = netutils_format_inet_addr(ip, port, NETUTILS_BIG);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 437,
          "old_api": "MP_THREAD_GIL_EXIT",
          "new_api": null,
          "old_text": "MP_THREAD_GIL_EXIT()",
          "new_text": null,
          "old_line_content": "        MP_THREAD_GIL_EXIT();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 438,
          "old_api": "lwip_write_r",
          "new_api": null,
          "old_text": "lwip_write_r(sock->fd, data+sentlen, datalen-sentlen)",
          "new_text": null,
          "old_line_content": "        int r = lwip_write_r(sock->fd, data+sentlen, datalen-sentlen);",
          "new_line_content": "    mp_obj_t tuple[2];",
          "content_same": false
        },
        {
          "line": 440,
          "old_api": "exception_from_errno",
          "new_api": null,
          "old_text": "exception_from_errno(errno)",
          "new_text": null,
          "old_line_content": "        if (r < 0 && errno != EWOULDBLOCK) exception_from_errno(errno);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 444,
          "old_api": "mp_raise_OSError",
          "new_api": null,
          "old_text": "mp_raise_OSError(MP_ETIMEDOUT)",
          "new_text": null,
          "old_line_content": "    if (sentlen == 0) mp_raise_OSError(MP_ETIMEDOUT); ",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 449,
          "old_api": "MP_OBJ_TO_PTR",
          "new_api": null,
          "old_text": "MP_OBJ_TO_PTR(arg0)",
          "new_text": null,
          "old_line_content": "    socket_obj_t *sock = MP_OBJ_TO_PTR(arg0);",
          "new_line_content": "int _socket_send(socket_obj_t *sock, const char *data, size_t datalen) {",
          "content_same": false
        },
        {
          "line": 451,
          "old_api": "mp_obj_str_get_data",
          "new_api": null,
          "old_text": "mp_obj_str_get_data(arg1, &datalen)",
          "new_text": null,
          "old_line_content": "    const char *data = mp_obj_str_get_data(arg1, &datalen);",
          "new_line_content": "    for (int i=0; i<=sock->retries && sentlen < datalen; i++) {",
          "content_same": false
        },
        {
          "line": 460,
          "old_api": "MP_OBJ_TO_PTR",
          "new_api": null,
          "old_text": "MP_OBJ_TO_PTR(arg0)",
          "new_text": null,
          "old_line_content": "    socket_obj_t *sock = MP_OBJ_TO_PTR(arg0);",
          "new_line_content": "    return sentlen;",
          "content_same": false
        },
        {
          "line": 462,
          "old_api": "mp_get_buffer_raise",
          "new_api": null,
          "old_text": "mp_get_buffer_raise(arg1, &bufinfo, MP_BUFFER_READ)",
          "new_text": null,
          "old_line_content": "    mp_get_buffer_raise(arg1, &bufinfo, MP_BUFFER_READ);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 463,
          "old_api": "_socket_send",
          "new_api": null,
          "old_text": "_socket_send(sock, bufinfo.buf, bufinfo.len)",
          "new_text": null,
          "old_line_content": "    int r = _socket_send(sock, bufinfo.buf, bufinfo.len);",
          "new_line_content": "STATIC mp_obj_t socket_send(const mp_obj_t arg0, const mp_obj_t arg1) {",
          "content_same": false
        },
        {
          "line": 470,
          "old_api": "MP_OBJ_TO_PTR",
          "new_api": null,
          "old_text": "MP_OBJ_TO_PTR(self_in)",
          "new_text": null,
          "old_line_content": "    socket_obj_t *self = MP_OBJ_TO_PTR(self_in);",
          "new_line_content": "STATIC MP_DEFINE_CONST_FUN_OBJ_2(socket_send_obj, socket_send);",
          "content_same": false
        },
        {
          "line": 474,
          "old_api": "mp_get_buffer_raise",
          "new_api": null,
          "old_text": "mp_get_buffer_raise(data_in, &bufinfo, MP_BUFFER_READ)",
          "new_text": null,
          "old_line_content": "    mp_get_buffer_raise(data_in, &bufinfo, MP_BUFFER_READ);",
          "new_line_content": "    // XXX also timeout behaviour.",
          "content_same": false
        },
        {
          "line": 480,
          "old_api": "netutils_parse_inet_addr",
          "new_api": null,
          "old_text": "netutils_parse_inet_addr(addr_in, (uint8_t*)&to.sin_addr, NETUTILS_BIG)",
          "new_text": null,
          "old_line_content": "    to.sin_port = lwip_htons(netutils_parse_inet_addr(addr_in, (uint8_t*)&to.sin_addr, NETUTILS_BIG));",
          "new_line_content": "    return mp_const_none;",
          "content_same": false
        },
        {
          "line": 484,
          "old_api": "MP_THREAD_GIL_EXIT",
          "new_api": null,
          "old_text": "MP_THREAD_GIL_EXIT()",
          "new_text": null,
          "old_line_content": "        MP_THREAD_GIL_EXIT();",
          "new_line_content": "STATIC mp_obj_t socket_sendto(mp_obj_t self_in, mp_obj_t data_in, mp_obj_t addr_in) {",
          "content_same": false
        },
        {
          "line": 486,
          "old_api": "MP_THREAD_GIL_ENTER",
          "new_api": null,
          "old_text": "MP_THREAD_GIL_ENTER()",
          "new_text": null,
          "old_line_content": "        MP_THREAD_GIL_ENTER();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 487,
          "old_api": "mp_obj_new_int_from_uint",
          "new_api": null,
          "old_text": "mp_obj_new_int_from_uint(ret)",
          "new_text": null,
          "old_line_content": "        if (ret > 0) return mp_obj_new_int_from_uint(ret);",
          "new_line_content": "    // get the buffer to send",
          "content_same": false
        },
        {
          "line": 491,
          "old_api": "check_for_exceptions",
          "new_api": null,
          "old_text": "check_for_exceptions()",
          "new_text": null,
          "old_line_content": "        check_for_exceptions();",
          "new_line_content": "    // create the destination address",
          "content_same": false
        },
        {
          "line": 493,
          "old_api": "mp_raise_OSError",
          "new_api": null,
          "old_text": "mp_raise_OSError(MP_ETIMEDOUT)",
          "new_text": null,
          "old_line_content": "    mp_raise_OSError(MP_ETIMEDOUT); ",
          "new_line_content": "    to.sin_len = sizeof(to);",
          "content_same": false
        },
        {
          "line": 498,
          "old_api": "MP_OBJ_TO_PTR",
          "new_api": null,
          "old_text": "MP_OBJ_TO_PTR(arg0)",
          "new_text": null,
          "old_line_content": "    socket_obj_t *self = MP_OBJ_TO_PTR(arg0);",
          "new_line_content": "    for (int i=0; i<=self->retries; i++) {",
          "content_same": false
        },
        {
          "line": 510,
          "old_api": "_socket_read_data",
          "new_api": null,
          "old_text": "_socket_read_data(self_in, buf, size, NULL, NULL, errcode)",
          "new_text": null,
          "old_line_content": "    return _socket_read_data(self_in, buf, size, NULL, NULL, errcode);",
          "new_line_content": "STATIC MP_DEFINE_CONST_FUN_OBJ_3(socket_sendto_obj, socket_sendto);",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 29,
      "total_additions": 83,
      "total_deletions": 80,
      "total_api_changes": 192
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 17,
        "api_related_lines": 192,
        "non_api_lines": 8,
        "non_api_line_numbers": [
          385,
          387,
          388,
          389,
          393,
          395,
          381,
          382
        ]
      }
    },
    "api_calls_before": 226,
    "api_calls_after": 229,
    "diff_info": {
      "added_lines": 17,
      "removed_lines": 2,
      "total_diff_lines": 32
    }
  }
}