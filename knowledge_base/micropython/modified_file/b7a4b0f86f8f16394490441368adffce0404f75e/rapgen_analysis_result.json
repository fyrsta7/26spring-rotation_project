{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/micropython/modified_file/b7a4b0f86f8f16394490441368adffce0404f75e",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/micropython/modified_file/b7a4b0f86f8f16394490441368adffce0404f75e/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/micropython/modified_file/b7a4b0f86f8f16394490441368adffce0404f75e/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/micropython/modified_file/b7a4b0f86f8f16394490441368adffce0404f75e/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 184,
          "old_api": "m_free",
          "new_api": "mp_obj_str_builder_end_with_len",
          "old_text": "m_free(buf, sz)",
          "new_text": "mp_obj_str_builder_end_with_len(ret_obj, out_sz)",
          "old_line_content": "        m_free(buf, sz);",
          "new_line_content": "        return mp_obj_str_builder_end_with_len(ret_obj, out_sz);",
          "content_same": false
        },
        {
          "line": 215,
          "old_api": "mp_get_buffer_raise",
          "new_api": "mp_stream_write",
          "old_text": "mp_get_buffer_raise(arg, &bufinfo, MP_BUFFER_READ)",
          "new_text": "mp_stream_write(self_in, bufinfo.buf, bufinfo.len)",
          "old_line_content": "    mp_get_buffer_raise(arg, &bufinfo, MP_BUFFER_READ);",
          "new_line_content": "    return mp_stream_write(self_in, bufinfo.buf, bufinfo.len);",
          "content_same": false
        },
        {
          "line": 227,
          "old_api": "vstr_new_size",
          "new_api": "vstr_str",
          "old_text": "vstr_new_size(DEFAULT_BUFFER_SIZE)",
          "new_text": "vstr_str(vstr)",
          "old_line_content": "    vstr_t *vstr = vstr_new_size(DEFAULT_BUFFER_SIZE);",
          "new_line_content": "    char *p = vstr_str(vstr);",
          "content_same": false
        },
        {
          "line": 262,
          "old_api": "STREAM_CONTENT_TYPE",
          "new_api": "vstr_free",
          "old_text": "STREAM_CONTENT_TYPE(o->type->stream_p)",
          "new_text": "vstr_free(vstr)",
          "old_line_content": "    mp_obj_t s = mp_obj_new_str_of_type(STREAM_CONTENT_TYPE(o->type->stream_p), (byte*)vstr->buf, total_size);",
          "new_line_content": "    vstr_free(vstr);",
          "content_same": false
        },
        {
          "line": 325,
          "old_api": "STREAM_CONTENT_TYPE",
          "new_api": "vstr_free",
          "old_text": "STREAM_CONTENT_TYPE(o->type->stream_p)",
          "new_text": "vstr_free(vstr)",
          "old_line_content": "    mp_obj_t ret = mp_obj_new_str_of_type(STREAM_CONTENT_TYPE(o->type->stream_p), (byte*)vstr->buf, vstr->len);",
          "new_line_content": "    vstr_free(vstr);",
          "content_same": false
        },
        {
          "line": 334,
          "old_api": "stream_unbuffered_readline",
          "new_api": "mp_obj_is_true",
          "old_text": "stream_unbuffered_readline(1, &self)",
          "new_text": "mp_obj_is_true(line)",
          "old_line_content": "        mp_obj_t line = stream_unbuffered_readline(1, &self);",
          "new_line_content": "        if (!mp_obj_is_true(line)) {",
          "content_same": false
        },
        {
          "line": 345,
          "old_api": "stream_unbuffered_readline",
          "new_api": "mp_obj_is_true",
          "old_text": "stream_unbuffered_readline(1, &self)",
          "new_text": "mp_obj_is_true(l_in)",
          "old_line_content": "    mp_obj_t l_in = stream_unbuffered_readline(1, &self);",
          "new_line_content": "    if (mp_obj_is_true(l_in)) {",
          "content_same": false
        },
        {
          "line": 352,
          "old_api": "MP_DEFINE_CONST_FUN_OBJ_VAR_BETWEEN",
          "new_api": "MP_DEFINE_CONST_FUN_OBJ_1",
          "old_text": "MP_DEFINE_CONST_FUN_OBJ_VAR_BETWEEN(mp_stream_read_obj, 1, 2, stream_read)",
          "new_text": "MP_DEFINE_CONST_FUN_OBJ_1(mp_stream_readall_obj, stream_readall)",
          "old_line_content": "MP_DEFINE_CONST_FUN_OBJ_VAR_BETWEEN(mp_stream_read_obj, 1, 2, stream_read);",
          "new_line_content": "MP_DEFINE_CONST_FUN_OBJ_1(mp_stream_readall_obj, stream_readall);",
          "content_same": false
        },
        {
          "line": 353,
          "old_api": "MP_DEFINE_CONST_FUN_OBJ_1",
          "new_api": "MP_DEFINE_CONST_FUN_OBJ_VAR_BETWEEN",
          "old_text": "MP_DEFINE_CONST_FUN_OBJ_1(mp_stream_readall_obj, stream_readall)",
          "new_text": "MP_DEFINE_CONST_FUN_OBJ_VAR_BETWEEN(mp_stream_unbuffered_readline_obj, 1, 2, stream_unbuffered_readline)",
          "old_line_content": "MP_DEFINE_CONST_FUN_OBJ_1(mp_stream_readall_obj, stream_readall);",
          "new_line_content": "MP_DEFINE_CONST_FUN_OBJ_VAR_BETWEEN(mp_stream_unbuffered_readline_obj, 1, 2, stream_unbuffered_readline);",
          "content_same": false
        },
        {
          "line": 354,
          "old_api": "MP_DEFINE_CONST_FUN_OBJ_VAR_BETWEEN",
          "new_api": "MP_DEFINE_CONST_FUN_OBJ_2",
          "old_text": "MP_DEFINE_CONST_FUN_OBJ_VAR_BETWEEN(mp_stream_unbuffered_readline_obj, 1, 2, stream_unbuffered_readline)",
          "new_text": "MP_DEFINE_CONST_FUN_OBJ_2(mp_stream_write_obj, stream_write_method)",
          "old_line_content": "MP_DEFINE_CONST_FUN_OBJ_VAR_BETWEEN(mp_stream_unbuffered_readline_obj, 1, 2, stream_unbuffered_readline);",
          "new_line_content": "MP_DEFINE_CONST_FUN_OBJ_2(mp_stream_write_obj, stream_write_method);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 256,
          "old_api": null,
          "new_api": "mp_obj_new_exception_msg_varg",
          "old_text": null,
          "new_text": "mp_obj_new_exception_msg_varg(&mp_type_OSError/*&mp_type_RuntimeError*/, \"Out of memory\")",
          "old_line_content": "                // TODO",
          "new_line_content": "                nlr_raise(mp_obj_new_exception_msg_varg(&mp_type_OSError/*&mp_type_RuntimeError*/, \"Out of memory\"));",
          "content_same": false
        },
        {
          "line": 261,
          "old_api": null,
          "new_api": "STREAM_CONTENT_TYPE",
          "old_text": null,
          "new_text": "STREAM_CONTENT_TYPE(o->type->stream_p)",
          "old_line_content": "",
          "new_line_content": "    mp_obj_t s = mp_obj_new_str_of_type(STREAM_CONTENT_TYPE(o->type->stream_p), (byte*)vstr->buf, total_size);",
          "content_same": false
        },
        {
          "line": 271,
          "old_api": null,
          "new_api": "mp_obj_new_exception_msg",
          "old_text": null,
          "new_text": "mp_obj_new_exception_msg(&mp_type_OSError, \"Operation not supported\")",
          "old_line_content": "        // CPython: io.UnsupportedOperation, OSError subclass",
          "new_line_content": "        nlr_raise(mp_obj_new_exception_msg(&mp_type_OSError, \"Operation not supported\"));",
          "content_same": false
        },
        {
          "line": 276,
          "old_api": null,
          "new_api": "MP_OBJ_SMALL_INT_VALUE",
          "old_text": null,
          "new_text": "MP_OBJ_SMALL_INT_VALUE(args[1])",
          "old_line_content": "    if (n_args > 1) {",
          "new_line_content": "        max_size = MP_OBJ_SMALL_INT_VALUE(args[1]);",
          "content_same": false
        },
        {
          "line": 281,
          "old_api": null,
          "new_api": "vstr_new_size",
          "old_text": null,
          "new_text": "vstr_new_size(max_size)",
          "old_line_content": "    if (max_size != -1) {",
          "new_line_content": "        vstr = vstr_new_size(max_size);",
          "content_same": false
        },
        {
          "line": 283,
          "old_api": null,
          "new_api": "vstr_new",
          "old_text": null,
          "new_text": "vstr_new()",
          "old_line_content": "    } else {",
          "new_line_content": "        vstr = vstr_new();",
          "content_same": false
        },
        {
          "line": 288,
          "old_api": null,
          "new_api": "vstr_add_len",
          "old_text": null,
          "new_text": "vstr_add_len(vstr, 1)",
          "old_line_content": "    while (max_size == -1 || max_size-- != 0) {",
          "new_line_content": "        char *p = vstr_add_len(vstr, 1);",
          "content_same": false
        },
        {
          "line": 290,
          "old_api": null,
          "new_api": "mp_obj_new_exception_msg_varg",
          "old_text": null,
          "new_text": "mp_obj_new_exception_msg_varg(&mp_type_MemoryError, \"out of memory\")",
          "old_line_content": "        if (p == NULL) {",
          "new_line_content": "            nlr_raise(mp_obj_new_exception_msg_varg(&mp_type_MemoryError, \"out of memory\"));",
          "content_same": false
        },
        {
          "line": 293,
          "old_api": null,
          "new_api": "read",
          "old_text": null,
          "new_text": "o->type->stream_p->read(o, p, 1, &error)",
          "old_line_content": "",
          "new_line_content": "        mp_uint_t out_sz = o->type->stream_p->read(o, p, 1, &error);",
          "content_same": false
        },
        {
          "line": 295,
          "old_api": null,
          "new_api": "is_nonblocking_error",
          "old_text": null,
          "new_text": "is_nonblocking_error(error)",
          "old_line_content": "        if (out_sz == MP_STREAM_ERROR) {",
          "new_line_content": "            if (is_nonblocking_error(error)) {",
          "content_same": false
        },
        {
          "line": 170,
          "old_api": null,
          "new_api": "STREAM_CONTENT_TYPE",
          "old_text": null,
          "new_text": "STREAM_CONTENT_TYPE(o->type->stream_p)",
          "old_line_content": "    int error;",
          "new_line_content": "    mp_obj_t ret_obj = mp_obj_str_builder_start(STREAM_CONTENT_TYPE(o->type->stream_p), sz, &buf);",
          "content_same": false
        },
        {
          "line": 172,
          "old_api": null,
          "new_api": "read",
          "old_text": null,
          "new_text": "o->type->stream_p->read(o, buf, sz, &error)",
          "old_line_content": "    if (out_sz == MP_STREAM_ERROR) {",
          "new_line_content": "    mp_uint_t out_sz = o->type->stream_p->read(o, buf, sz, &error);",
          "content_same": false
        },
        {
          "line": 174,
          "old_api": null,
          "new_api": "is_nonblocking_error",
          "old_text": null,
          "new_text": "is_nonblocking_error(error)",
          "old_line_content": "            // https://docs.python.org/3.4/library/io.html#io.RawIOBase.read",
          "new_line_content": "        if (is_nonblocking_error(error)) {",
          "content_same": false
        },
        {
          "line": 303,
          "old_api": null,
          "new_api": "vstr_free",
          "old_text": null,
          "new_text": "vstr_free(vstr)",
          "old_line_content": "                    // behavior - return None.",
          "new_line_content": "                    vstr_free(vstr);",
          "content_same": false
        },
        {
          "line": 309,
          "old_api": null,
          "new_api": "MP_OBJ_NEW_SMALL_INT",
          "old_text": null,
          "new_text": "MP_OBJ_NEW_SMALL_INT(error)",
          "old_line_content": "            }",
          "new_line_content": "            nlr_raise(mp_obj_new_exception_arg1(&mp_type_OSError, MP_OBJ_NEW_SMALL_INT(error)));",
          "content_same": false
        },
        {
          "line": 182,
          "old_api": null,
          "new_api": "MP_OBJ_NEW_SMALL_INT",
          "old_text": null,
          "new_text": "MP_OBJ_NEW_SMALL_INT(error)",
          "old_line_content": "    } else {",
          "new_line_content": "        nlr_raise(mp_obj_new_exception_arg1(&mp_type_OSError, MP_OBJ_NEW_SMALL_INT(error)));",
          "content_same": false
        },
        {
          "line": 316,
          "old_api": null,
          "new_api": "vstr_cut_tail_bytes",
          "old_text": null,
          "new_text": "vstr_cut_tail_bytes(vstr, 1)",
          "old_line_content": "            // char is lost), or allocate first as we do.",
          "new_line_content": "            vstr_cut_tail_bytes(vstr, 1);",
          "content_same": false
        },
        {
          "line": 192,
          "old_api": null,
          "new_api": "mp_obj_new_exception_msg",
          "old_text": null,
          "new_text": "mp_obj_new_exception_msg(&mp_type_OSError, \"Operation not supported\")",
          "old_line_content": "        // CPython: io.UnsupportedOperation, OSError subclass",
          "new_line_content": "        nlr_raise(mp_obj_new_exception_msg(&mp_type_OSError, \"Operation not supported\"));",
          "content_same": false
        },
        {
          "line": 196,
          "old_api": null,
          "new_api": "write",
          "old_text": null,
          "new_text": "o->type->stream_p->write(self_in, buf, len, &error)",
          "old_line_content": "    int error;",
          "new_line_content": "    mp_uint_t out_sz = o->type->stream_p->write(self_in, buf, len, &error);",
          "content_same": false
        },
        {
          "line": 324,
          "old_api": null,
          "new_api": "STREAM_CONTENT_TYPE",
          "old_text": null,
          "new_text": "STREAM_CONTENT_TYPE(o->type->stream_p)",
          "old_line_content": "    // TODO need a string creation API that doesn't copy the given data",
          "new_line_content": "    mp_obj_t ret = mp_obj_new_str_of_type(STREAM_CONTENT_TYPE(o->type->stream_p), (byte*)vstr->buf, vstr->len);",
          "content_same": false
        },
        {
          "line": 198,
          "old_api": null,
          "new_api": "is_nonblocking_error",
          "old_text": null,
          "new_text": "is_nonblocking_error(error)",
          "old_line_content": "    if (out_sz == MP_STREAM_ERROR) {",
          "new_line_content": "        if (is_nonblocking_error(error)) {",
          "content_same": false
        },
        {
          "line": 331,
          "old_api": null,
          "new_api": "mp_obj_new_list",
          "old_text": null,
          "new_text": "mp_obj_new_list(0, NULL)",
          "old_line_content": "STATIC mp_obj_t stream_unbuffered_readlines(mp_obj_t self) {",
          "new_line_content": "    mp_obj_t lines = mp_obj_new_list(0, NULL);",
          "content_same": false
        },
        {
          "line": 333,
          "old_api": null,
          "new_api": "stream_unbuffered_readline",
          "old_text": null,
          "new_text": "stream_unbuffered_readline(1, &self)",
          "old_line_content": "    for (;;) {",
          "new_line_content": "        mp_obj_t line = stream_unbuffered_readline(1, &self);",
          "content_same": false
        },
        {
          "line": 206,
          "old_api": null,
          "new_api": "MP_OBJ_NEW_SMALL_INT",
          "old_text": null,
          "new_text": "MP_OBJ_NEW_SMALL_INT(error)",
          "old_line_content": "        }",
          "new_line_content": "        nlr_raise(mp_obj_new_exception_arg1(&mp_type_OSError, MP_OBJ_NEW_SMALL_INT(error)));",
          "content_same": false
        },
        {
          "line": 208,
          "old_api": null,
          "new_api": "MP_OBJ_NEW_SMALL_INT",
          "old_text": null,
          "new_text": "MP_OBJ_NEW_SMALL_INT(out_sz)",
          "old_line_content": "    } else {",
          "new_line_content": "        return MP_OBJ_NEW_SMALL_INT(out_sz);",
          "content_same": false
        },
        {
          "line": 337,
          "old_api": null,
          "new_api": "mp_obj_list_append",
          "old_text": null,
          "new_text": "mp_obj_list_append(lines, line)",
          "old_line_content": "        }",
          "new_line_content": "        mp_obj_list_append(lines, line);",
          "content_same": false
        },
        {
          "line": 341,
          "old_api": null,
          "new_api": "MP_DEFINE_CONST_FUN_OBJ_1",
          "old_text": null,
          "new_text": "MP_DEFINE_CONST_FUN_OBJ_1(mp_stream_unbuffered_readlines_obj, stream_unbuffered_readlines)",
          "old_line_content": "}",
          "new_line_content": "MP_DEFINE_CONST_FUN_OBJ_1(mp_stream_unbuffered_readlines_obj, stream_unbuffered_readlines);",
          "content_same": false
        },
        {
          "line": 214,
          "old_api": null,
          "new_api": "mp_get_buffer_raise",
          "old_text": null,
          "new_text": "mp_get_buffer_raise(arg, &bufinfo, MP_BUFFER_READ)",
          "old_line_content": "    mp_buffer_info_t bufinfo;",
          "new_line_content": "    mp_get_buffer_raise(arg, &bufinfo, MP_BUFFER_READ);",
          "content_same": false
        },
        {
          "line": 344,
          "old_api": null,
          "new_api": "stream_unbuffered_readline",
          "old_text": null,
          "new_text": "stream_unbuffered_readline(1, &self)",
          "old_line_content": "mp_obj_t mp_stream_unbuffered_iter(mp_obj_t self) {",
          "new_line_content": "    mp_obj_t l_in = stream_unbuffered_readline(1, &self);",
          "content_same": false
        },
        {
          "line": 222,
          "old_api": null,
          "new_api": "mp_obj_new_exception_msg",
          "old_text": null,
          "new_text": "mp_obj_new_exception_msg(&mp_type_OSError, \"Operation not supported\")",
          "old_line_content": "        // CPython: io.UnsupportedOperation, OSError subclass",
          "new_line_content": "        nlr_raise(mp_obj_new_exception_msg(&mp_type_OSError, \"Operation not supported\"));",
          "content_same": false
        },
        {
          "line": 351,
          "old_api": null,
          "new_api": "MP_DEFINE_CONST_FUN_OBJ_VAR_BETWEEN",
          "old_text": null,
          "new_text": "MP_DEFINE_CONST_FUN_OBJ_VAR_BETWEEN(mp_stream_read_obj, 1, 2, stream_read)",
          "old_line_content": "",
          "new_line_content": "MP_DEFINE_CONST_FUN_OBJ_VAR_BETWEEN(mp_stream_read_obj, 1, 2, stream_read);",
          "content_same": false
        },
        {
          "line": 226,
          "old_api": null,
          "new_api": "vstr_new_size",
          "old_text": null,
          "new_text": "vstr_new_size(DEFAULT_BUFFER_SIZE)",
          "old_line_content": "    int total_size = 0;",
          "new_line_content": "    vstr_t *vstr = vstr_new_size(DEFAULT_BUFFER_SIZE);",
          "content_same": false
        },
        {
          "line": 231,
          "old_api": null,
          "new_api": "read",
          "old_text": null,
          "new_text": "o->type->stream_p->read(self_in, p, current_read, &error)",
          "old_line_content": "    while (true) {",
          "new_line_content": "        mp_uint_t out_sz = o->type->stream_p->read(self_in, p, current_read, &error);",
          "content_same": false
        },
        {
          "line": 233,
          "old_api": null,
          "new_api": "is_nonblocking_error",
          "old_text": null,
          "new_text": "is_nonblocking_error(error)",
          "old_line_content": "        if (out_sz == MP_STREAM_ERROR) {",
          "new_line_content": "            if (is_nonblocking_error(error)) {",
          "content_same": false
        },
        {
          "line": 242,
          "old_api": null,
          "new_api": "MP_OBJ_NEW_SMALL_INT",
          "old_text": null,
          "new_text": "MP_OBJ_NEW_SMALL_INT(error)",
          "old_line_content": "            }",
          "new_line_content": "            nlr_raise(mp_obj_new_exception_arg1(&mp_type_OSError, MP_OBJ_NEW_SMALL_INT(error)));",
          "content_same": false
        },
        {
          "line": 253,
          "old_api": null,
          "new_api": "vstr_extend",
          "old_text": null,
          "new_text": "vstr_extend(vstr, current_read)",
          "old_line_content": "            current_read = DEFAULT_BUFFER_SIZE;",
          "new_line_content": "            p = vstr_extend(vstr, current_read);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 257,
          "old_api": "mp_obj_new_exception_msg_varg",
          "new_api": null,
          "old_text": "mp_obj_new_exception_msg_varg(&mp_type_OSError/*&mp_type_RuntimeError*/, \"Out of memory\")",
          "new_text": null,
          "old_line_content": "                nlr_raise(mp_obj_new_exception_msg_varg(&mp_type_OSError/*&mp_type_RuntimeError*/, \"Out of memory\"));",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 263,
          "old_api": "vstr_free",
          "new_api": null,
          "old_text": "vstr_free(vstr)",
          "new_text": null,
          "old_line_content": "    vstr_free(vstr);",
          "new_line_content": "    return s;",
          "content_same": false
        },
        {
          "line": 272,
          "old_api": "mp_obj_new_exception_msg",
          "new_api": null,
          "old_text": "mp_obj_new_exception_msg(&mp_type_OSError, \"Operation not supported\")",
          "new_text": null,
          "old_line_content": "        nlr_raise(mp_obj_new_exception_msg(&mp_type_OSError, \"Operation not supported\"));",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 277,
          "old_api": "MP_OBJ_SMALL_INT_VALUE",
          "new_api": null,
          "old_text": "MP_OBJ_SMALL_INT_VALUE(args[1])",
          "new_text": null,
          "old_line_content": "        max_size = MP_OBJ_SMALL_INT_VALUE(args[1]);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 282,
          "old_api": "vstr_new_size",
          "new_api": null,
          "old_text": "vstr_new_size(max_size)",
          "new_text": null,
          "old_line_content": "        vstr = vstr_new_size(max_size);",
          "new_line_content": "    } else {",
          "content_same": false
        },
        {
          "line": 284,
          "old_api": "vstr_new",
          "new_api": null,
          "old_text": "vstr_new()",
          "new_text": null,
          "old_line_content": "        vstr = vstr_new();",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 289,
          "old_api": "vstr_add_len",
          "new_api": null,
          "old_text": "vstr_add_len(vstr, 1)",
          "new_text": null,
          "old_line_content": "        char *p = vstr_add_len(vstr, 1);",
          "new_line_content": "        if (p == NULL) {",
          "content_same": false
        },
        {
          "line": 291,
          "old_api": "mp_obj_new_exception_msg_varg",
          "new_api": null,
          "old_text": "mp_obj_new_exception_msg_varg(&mp_type_MemoryError, \"out of memory\")",
          "new_text": null,
          "old_line_content": "            nlr_raise(mp_obj_new_exception_msg_varg(&mp_type_MemoryError, \"out of memory\"));",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 294,
          "old_api": "read",
          "new_api": null,
          "old_text": "o->type->stream_p->read(o, p, 1, &error)",
          "new_text": null,
          "old_line_content": "        mp_uint_t out_sz = o->type->stream_p->read(o, p, 1, &error);",
          "new_line_content": "        if (out_sz == MP_STREAM_ERROR) {",
          "content_same": false
        },
        {
          "line": 296,
          "old_api": "is_nonblocking_error",
          "new_api": null,
          "old_text": "is_nonblocking_error(error)",
          "new_text": null,
          "old_line_content": "            if (is_nonblocking_error(error)) {",
          "new_line_content": "                if (vstr->len == 1) {",
          "content_same": false
        },
        {
          "line": 169,
          "old_api": "m_new",
          "new_api": null,
          "old_text": "m_new(byte, sz)",
          "new_text": null,
          "old_line_content": "    byte *buf = m_new(byte, sz);",
          "new_line_content": "    byte *buf;",
          "content_same": false
        },
        {
          "line": 171,
          "old_api": "read",
          "new_api": null,
          "old_text": "o->type->stream_p->read(o, buf, sz, &error)",
          "new_text": null,
          "old_line_content": "    mp_uint_t out_sz = o->type->stream_p->read(o, buf, sz, &error);",
          "new_line_content": "    int error;",
          "content_same": false
        },
        {
          "line": 173,
          "old_api": "is_nonblocking_error",
          "new_api": null,
          "old_text": "is_nonblocking_error(error)",
          "new_text": null,
          "old_line_content": "        if (is_nonblocking_error(error)) {",
          "new_line_content": "    if (out_sz == MP_STREAM_ERROR) {",
          "content_same": false
        },
        {
          "line": 304,
          "old_api": "vstr_free",
          "new_api": null,
          "old_text": "vstr_free(vstr)",
          "new_text": null,
          "old_line_content": "                    vstr_free(vstr);",
          "new_line_content": "                    return mp_const_none;",
          "content_same": false
        },
        {
          "line": 181,
          "old_api": "MP_OBJ_NEW_SMALL_INT",
          "new_api": null,
          "old_text": "MP_OBJ_NEW_SMALL_INT(error)",
          "new_text": null,
          "old_line_content": "        nlr_raise(mp_obj_new_exception_arg1(&mp_type_OSError, MP_OBJ_NEW_SMALL_INT(error)));",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 310,
          "old_api": "MP_OBJ_NEW_SMALL_INT",
          "new_api": null,
          "old_text": "MP_OBJ_NEW_SMALL_INT(error)",
          "new_text": null,
          "old_line_content": "            nlr_raise(mp_obj_new_exception_arg1(&mp_type_OSError, MP_OBJ_NEW_SMALL_INT(error)));",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 183,
          "old_api": "STREAM_CONTENT_TYPE",
          "new_api": null,
          "old_text": "STREAM_CONTENT_TYPE(o->type->stream_p)",
          "new_text": null,
          "old_line_content": "        mp_obj_t s = mp_obj_new_str_of_type(STREAM_CONTENT_TYPE(o->type->stream_p), buf, out_sz); // will reallocate to use exact size",
          "new_line_content": "    } else {",
          "content_same": false
        },
        {
          "line": 317,
          "old_api": "vstr_cut_tail_bytes",
          "new_api": null,
          "old_text": "vstr_cut_tail_bytes(vstr, 1)",
          "new_text": null,
          "old_line_content": "            vstr_cut_tail_bytes(vstr, 1);",
          "new_line_content": "            break;",
          "content_same": false
        },
        {
          "line": 193,
          "old_api": "mp_obj_new_exception_msg",
          "new_api": null,
          "old_text": "mp_obj_new_exception_msg(&mp_type_OSError, \"Operation not supported\")",
          "new_text": null,
          "old_line_content": "        nlr_raise(mp_obj_new_exception_msg(&mp_type_OSError, \"Operation not supported\"));",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 197,
          "old_api": "write",
          "new_api": null,
          "old_text": "o->type->stream_p->write(self_in, buf, len, &error)",
          "new_text": null,
          "old_line_content": "    mp_uint_t out_sz = o->type->stream_p->write(self_in, buf, len, &error);",
          "new_line_content": "    if (out_sz == MP_STREAM_ERROR) {",
          "content_same": false
        },
        {
          "line": 326,
          "old_api": "vstr_free",
          "new_api": null,
          "old_text": "vstr_free(vstr)",
          "new_text": null,
          "old_line_content": "    vstr_free(vstr);",
          "new_line_content": "    return ret;",
          "content_same": false
        },
        {
          "line": 199,
          "old_api": "is_nonblocking_error",
          "new_api": null,
          "old_text": "is_nonblocking_error(error)",
          "new_text": null,
          "old_line_content": "        if (is_nonblocking_error(error)) {",
          "new_line_content": "            // http://docs.python.org/3/library/io.html#io.RawIOBase.write",
          "content_same": false
        },
        {
          "line": 332,
          "old_api": "mp_obj_new_list",
          "new_api": null,
          "old_text": "mp_obj_new_list(0, NULL)",
          "new_text": null,
          "old_line_content": "    mp_obj_t lines = mp_obj_new_list(0, NULL);",
          "new_line_content": "    for (;;) {",
          "content_same": false
        },
        {
          "line": 207,
          "old_api": "MP_OBJ_NEW_SMALL_INT",
          "new_api": null,
          "old_text": "MP_OBJ_NEW_SMALL_INT(error)",
          "new_text": null,
          "old_line_content": "        nlr_raise(mp_obj_new_exception_arg1(&mp_type_OSError, MP_OBJ_NEW_SMALL_INT(error)));",
          "new_line_content": "    } else {",
          "content_same": false
        },
        {
          "line": 335,
          "old_api": "mp_obj_is_true",
          "new_api": null,
          "old_text": "mp_obj_is_true(line)",
          "new_text": null,
          "old_line_content": "        if (!mp_obj_is_true(line)) {",
          "new_line_content": "            break;",
          "content_same": false
        },
        {
          "line": 209,
          "old_api": "MP_OBJ_NEW_SMALL_INT",
          "new_api": null,
          "old_text": "MP_OBJ_NEW_SMALL_INT(out_sz)",
          "new_text": null,
          "old_line_content": "        return MP_OBJ_NEW_SMALL_INT(out_sz);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 338,
          "old_api": "mp_obj_list_append",
          "new_api": null,
          "old_text": "mp_obj_list_append(lines, line)",
          "new_text": null,
          "old_line_content": "        mp_obj_list_append(lines, line);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 342,
          "old_api": "MP_DEFINE_CONST_FUN_OBJ_1",
          "new_api": null,
          "old_text": "MP_DEFINE_CONST_FUN_OBJ_1(mp_stream_unbuffered_readlines_obj, stream_unbuffered_readlines)",
          "new_text": null,
          "old_line_content": "MP_DEFINE_CONST_FUN_OBJ_1(mp_stream_unbuffered_readlines_obj, stream_unbuffered_readlines);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 216,
          "old_api": "mp_stream_write",
          "new_api": null,
          "old_text": "mp_stream_write(self_in, bufinfo.buf, bufinfo.len)",
          "new_text": null,
          "old_line_content": "    return mp_stream_write(self_in, bufinfo.buf, bufinfo.len);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 346,
          "old_api": "mp_obj_is_true",
          "new_api": null,
          "old_text": "mp_obj_is_true(l_in)",
          "new_text": null,
          "old_line_content": "    if (mp_obj_is_true(l_in)) {",
          "new_line_content": "        return l_in;",
          "content_same": false
        },
        {
          "line": 223,
          "old_api": "mp_obj_new_exception_msg",
          "new_api": null,
          "old_text": "mp_obj_new_exception_msg(&mp_type_OSError, \"Operation not supported\")",
          "new_text": null,
          "old_line_content": "        nlr_raise(mp_obj_new_exception_msg(&mp_type_OSError, \"Operation not supported\"));",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 355,
          "old_api": "MP_DEFINE_CONST_FUN_OBJ_2",
          "new_api": null,
          "old_text": "MP_DEFINE_CONST_FUN_OBJ_2(mp_stream_write_obj, stream_write_method)",
          "new_text": null,
          "old_line_content": "MP_DEFINE_CONST_FUN_OBJ_2(mp_stream_write_obj, stream_write_method);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 228,
          "old_api": "vstr_str",
          "new_api": null,
          "old_text": "vstr_str(vstr)",
          "new_text": null,
          "old_line_content": "    char *p = vstr_str(vstr);",
          "new_line_content": "    int error;",
          "content_same": false
        },
        {
          "line": 232,
          "old_api": "read",
          "new_api": null,
          "old_text": "o->type->stream_p->read(self_in, p, current_read, &error)",
          "new_text": null,
          "old_line_content": "        mp_uint_t out_sz = o->type->stream_p->read(self_in, p, current_read, &error);",
          "new_line_content": "        if (out_sz == MP_STREAM_ERROR) {",
          "content_same": false
        },
        {
          "line": 234,
          "old_api": "is_nonblocking_error",
          "new_api": null,
          "old_text": "is_nonblocking_error(error)",
          "new_text": null,
          "old_line_content": "            if (is_nonblocking_error(error)) {",
          "new_line_content": "                // With non-blocking streams, we read as much as we can.",
          "content_same": false
        },
        {
          "line": 243,
          "old_api": "MP_OBJ_NEW_SMALL_INT",
          "new_api": null,
          "old_text": "MP_OBJ_NEW_SMALL_INT(error)",
          "new_text": null,
          "old_line_content": "            nlr_raise(mp_obj_new_exception_arg1(&mp_type_OSError, MP_OBJ_NEW_SMALL_INT(error)));",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 254,
          "old_api": "vstr_extend",
          "new_api": null,
          "old_text": "vstr_extend(vstr, current_read)",
          "new_text": null,
          "old_line_content": "            p = vstr_extend(vstr, current_read);",
          "new_line_content": "            if (p == NULL) {",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 10,
      "total_additions": 36,
      "total_deletions": 37,
      "total_api_changes": 83
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 5,
        "api_related_lines": 83,
        "non_api_lines": 1,
        "non_api_line_numbers": [
          185
        ]
      }
    },
    "api_calls_before": 82,
    "api_calls_after": 81,
    "diff_info": {
      "added_lines": 3,
      "removed_lines": 4,
      "total_diff_lines": 26
    }
  }
}