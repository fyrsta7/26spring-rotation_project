{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/micropython/modified_file/fed1b4fb56421e8f8a1ee54b2c16296204176bb3",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/micropython/modified_file/fed1b4fb56421e8f8a1ee54b2c16296204176bb3/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/micropython/modified_file/fed1b4fb56421e8f8a1ee54b2c16296204176bb3/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/micropython/modified_file/fed1b4fb56421e8f8a1ee54b2c16296204176bb3/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 254,
          "old_api": "HAL_SD_GetCardState",
          "new_api": "__WFI",
          "old_text": "HAL_SD_GetCardState(sd)",
          "new_text": "__WFI()",
          "old_line_content": "        HAL_SD_CardStateTypedef state = HAL_SD_GetCardState(sd);",
          "new_line_content": "        __WFI();",
          "content_same": false
        },
        {
          "line": 313,
          "old_api": "restore_irq_pri",
          "new_api": "MP_HAL_CLEANINVALIDATE_DCACHE",
          "old_text": "restore_irq_pri(basepri)",
          "new_text": "MP_HAL_CLEANINVALIDATE_DCACHE(dest, num_blocks * SDCARD_BLOCK_SIZE)",
          "old_line_content": "        restore_irq_pri(basepri);",
          "new_line_content": "        MP_HAL_CLEANINVALIDATE_DCACHE(dest, num_blocks * SDCARD_BLOCK_SIZE);",
          "content_same": false
        },
        {
          "line": 315,
          "old_api": "HAL_SD_ReadBlocks",
          "new_api": "HAL_SD_ReadBlocks_DMA",
          "old_text": "HAL_SD_ReadBlocks(&sd_handle, dest, block_num, num_blocks, 60000)",
          "new_text": "HAL_SD_ReadBlocks_DMA(&sd_handle, dest, block_num, num_blocks)",
          "old_line_content": "        err = HAL_SD_ReadBlocks(&sd_handle, dest, block_num, num_blocks, 60000);",
          "new_line_content": "        err = HAL_SD_ReadBlocks_DMA(&sd_handle, dest, block_num, num_blocks);",
          "content_same": false
        },
        {
          "line": 323,
          "old_api": "memmove",
          "new_api": "restore_irq_pri",
          "old_text": "memmove(orig_dest, dest, num_blocks * SDCARD_BLOCK_SIZE)",
          "new_text": "restore_irq_pri(basepri)",
          "old_line_content": "        memmove(orig_dest, dest, num_blocks * SDCARD_BLOCK_SIZE);",
          "new_line_content": "        restore_irq_pri(basepri);",
          "content_same": false
        },
        {
          "line": 356,
          "old_api": "query_irq",
          "new_api": "memcpy",
          "old_text": "query_irq()",
          "new_text": "memcpy(src_aligned, src + i * SDCARD_BLOCK_SIZE, SDCARD_BLOCK_SIZE)",
          "old_line_content": "    if (query_irq() == IRQ_STATE_ENABLED) {",
          "new_line_content": "            memcpy(src_aligned, src + i * SDCARD_BLOCK_SIZE, SDCARD_BLOCK_SIZE);",
          "content_same": false
        },
        {
          "line": 366,
          "old_api": "HAL_SD_WriteBlocks_DMA",
          "new_api": "query_irq",
          "old_text": "HAL_SD_WriteBlocks_DMA(&sd_handle, (uint8_t*)src, block_num, num_blocks)",
          "new_text": "query_irq()",
          "old_line_content": "        err = HAL_SD_WriteBlocks_DMA(&sd_handle, (uint8_t*)src, block_num, num_blocks);",
          "new_line_content": "    if (query_irq() == IRQ_STATE_ENABLED) {",
          "content_same": false
        },
        {
          "line": 368,
          "old_api": "sdcard_wait_finished",
          "new_api": "raise_irq_pri",
          "old_text": "sdcard_wait_finished(&sd_handle, 60000)",
          "new_text": "raise_irq_pri(IRQ_PRI_OTG_FS)",
          "old_line_content": "            err = sdcard_wait_finished(&sd_handle, 60000);",
          "new_line_content": "        uint32_t basepri = raise_irq_pri(IRQ_PRI_OTG_FS);",
          "content_same": false
        },
        {
          "line": 370,
          "old_api": "dma_deinit",
          "new_api": "dma_init",
          "old_text": "dma_deinit(&SDMMC_TX_DMA)",
          "new_text": "dma_init(&sd_tx_dma, &SDMMC_TX_DMA, &sd_handle)",
          "old_line_content": "        dma_deinit(&SDMMC_TX_DMA);",
          "new_line_content": "        dma_init(&sd_tx_dma, &SDMMC_TX_DMA, &sd_handle);",
          "content_same": false
        },
        {
          "line": 435,
          "old_api": "m_new",
          "new_api": "mp_obj_new_int_from_ull",
          "old_text": "m_new(uint8_t, SDCARD_BLOCK_SIZE)",
          "new_text": "mp_obj_new_int_from_ull((uint64_t)cardinfo.LogBlockNbr * (uint64_t)cardinfo.LogBlockSize)",
          "old_line_content": "    uint8_t *dest = m_new(uint8_t, SDCARD_BLOCK_SIZE);",
          "new_line_content": "        mp_obj_new_int_from_ull((uint64_t)cardinfo.LogBlockNbr * (uint64_t)cardinfo.LogBlockSize),",
          "content_same": false
        },
        {
          "line": 436,
          "old_api": "mp_obj_get_int",
          "new_api": "mp_obj_new_int_from_uint",
          "old_text": "mp_obj_get_int(block_num)",
          "new_text": "mp_obj_new_int_from_uint(cardinfo.LogBlockSize)",
          "old_line_content": "    mp_uint_t ret = sdcard_read_blocks(dest, mp_obj_get_int(block_num), 1);",
          "new_line_content": "        mp_obj_new_int_from_uint(cardinfo.LogBlockSize),",
          "content_same": false
        },
        {
          "line": 450,
          "old_api": "mp_get_buffer_raise",
          "new_api": "mp_obj_new_exception_msg_varg",
          "old_text": "mp_get_buffer_raise(data, &bufinfo, MP_BUFFER_READ)",
          "new_text": "mp_obj_new_exception_msg_varg(&mp_type_Exception, \"sdcard_read_blocks failed [%u]\", ret)",
          "old_line_content": "    mp_get_buffer_raise(data, &bufinfo, MP_BUFFER_READ);",
          "new_line_content": "        nlr_raise(mp_obj_new_exception_msg_varg(&mp_type_Exception, \"sdcard_read_blocks failed [%u]\", ret));",
          "content_same": false
        },
        {
          "line": 468,
          "old_api": "mp_obj_get_int",
          "new_api": "mp_obj_new_exception_msg_varg",
          "old_text": "mp_obj_get_int(block_num)",
          "new_text": "mp_obj_new_exception_msg_varg(&mp_type_Exception, \"sdcard_write_blocks failed [%u]\", ret)",
          "old_line_content": "    mp_uint_t ret = sdcard_read_blocks(bufinfo.buf, mp_obj_get_int(block_num), bufinfo.len / SDCARD_BLOCK_SIZE);",
          "new_line_content": "        nlr_raise(mp_obj_new_exception_msg_varg(&mp_type_Exception, \"sdcard_write_blocks failed [%u]\", ret));",
          "content_same": false
        },
        {
          "line": 477,
          "old_api": "mp_obj_new_bool",
          "new_api": "mp_get_buffer_raise",
          "old_text": "mp_obj_new_bool(ret == 0)",
          "new_text": "mp_get_buffer_raise(buf, &bufinfo, MP_BUFFER_WRITE)",
          "old_line_content": "    return mp_obj_new_bool(ret == 0);",
          "new_line_content": "    mp_get_buffer_raise(buf, &bufinfo, MP_BUFFER_WRITE);",
          "content_same": false
        },
        {
          "line": 485,
          "old_api": "sdcard_power_on",
          "new_api": "mp_get_buffer_raise",
          "old_text": "sdcard_power_on()",
          "new_text": "mp_get_buffer_raise(buf, &bufinfo, MP_BUFFER_READ)",
          "old_line_content": "            if (!sdcard_power_on()) {",
          "new_line_content": "    mp_get_buffer_raise(buf, &bufinfo, MP_BUFFER_READ);",
          "content_same": false
        },
        {
          "line": 486,
          "old_api": "MP_OBJ_NEW_SMALL_INT",
          "new_api": "mp_obj_get_int",
          "old_text": "MP_OBJ_NEW_SMALL_INT(-1)",
          "new_text": "mp_obj_get_int(block_num)",
          "old_line_content": "                return MP_OBJ_NEW_SMALL_INT(-1); // error",
          "new_line_content": "    mp_uint_t ret = sdcard_write_blocks(bufinfo.buf, mp_obj_get_int(block_num), bufinfo.len / SDCARD_BLOCK_SIZE);",
          "content_same": false
        },
        {
          "line": 492,
          "old_api": "MP_OBJ_NEW_SMALL_INT",
          "new_api": "mp_obj_get_int",
          "old_text": "MP_OBJ_NEW_SMALL_INT(0)",
          "new_text": "mp_obj_get_int(cmd_in)",
          "old_line_content": "            return MP_OBJ_NEW_SMALL_INT(0); // success",
          "new_line_content": "    mp_int_t cmd = mp_obj_get_int(cmd_in);",
          "content_same": false
        },
        {
          "line": 512,
          "old_api": "MP_ROM_PTR",
          "new_api": "MP_OBJ_NEW_SMALL_INT",
          "old_text": "MP_ROM_PTR(&sd_power_obj)",
          "new_text": "MP_OBJ_NEW_SMALL_INT(SDCARD_BLOCK_SIZE)",
          "old_line_content": "    { MP_ROM_QSTR(MP_QSTR_power), MP_ROM_PTR(&sd_power_obj) },",
          "new_line_content": "            return MP_OBJ_NEW_SMALL_INT(SDCARD_BLOCK_SIZE);",
          "content_same": false
        },
        {
          "line": 515,
          "old_api": "MP_ROM_PTR",
          "new_api": "MP_OBJ_NEW_SMALL_INT",
          "old_text": "MP_ROM_PTR(&sd_write_obj)",
          "new_text": "MP_OBJ_NEW_SMALL_INT(-1)",
          "old_line_content": "    { MP_ROM_QSTR(MP_QSTR_write), MP_ROM_PTR(&sd_write_obj) },",
          "new_line_content": "            return MP_OBJ_NEW_SMALL_INT(-1); // error",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 256,
          "old_api": null,
          "new_api": "HAL_GetTick",
          "old_text": null,
          "new_text": "HAL_GetTick()",
          "old_line_content": "            return HAL_OK;",
          "new_line_content": "        if (HAL_GetTick() - start >= timeout) {",
          "content_same": false
        },
        {
          "line": 385,
          "old_api": null,
          "new_api": "HAL_SD_WriteBlocks",
          "old_text": null,
          "new_text": "HAL_SD_WriteBlocks(&sd_handle, (uint8_t*)src, block_num, num_blocks, 60000)",
          "old_line_content": "// MicroPython bindings",
          "new_line_content": "        err = HAL_SD_WriteBlocks(&sd_handle, (uint8_t*)src, block_num, num_blocks, 60000);",
          "content_same": false
        },
        {
          "line": 387,
          "old_api": null,
          "new_api": "sdcard_wait_finished",
          "old_text": null,
          "new_text": "sdcard_wait_finished(&sd_handle, 60000)",
          "old_line_content": "// Expose the SD card as an object with the block protocol.",
          "new_line_content": "            err = sdcard_wait_finished(&sd_handle, 60000);",
          "content_same": false
        },
        {
          "line": 263,
          "old_api": null,
          "new_api": "HAL_SD_GetCardState",
          "old_text": null,
          "new_text": "HAL_SD_GetCardState(sd)",
          "old_line_content": "        }",
          "new_line_content": "        HAL_SD_CardStateTypedef state = HAL_SD_GetCardState(sd);",
          "content_same": false
        },
        {
          "line": 383,
          "old_api": null,
          "new_api": "restore_irq_pri",
          "old_text": null,
          "new_text": "restore_irq_pri(basepri)",
          "old_line_content": "",
          "new_line_content": "        restore_irq_pri(basepri);",
          "content_same": false
        },
        {
          "line": 521,
          "old_api": null,
          "new_api": "MP_ROM_PTR",
          "old_text": null,
          "new_text": "MP_ROM_PTR(&sd_present_obj)",
          "old_line_content": "",
          "new_line_content": "    { MP_ROM_QSTR(MP_QSTR_present), MP_ROM_PTR(&sd_present_obj) },",
          "content_same": false
        },
        {
          "line": 522,
          "old_api": null,
          "new_api": "MP_ROM_PTR",
          "old_text": null,
          "new_text": "MP_ROM_PTR(&sd_power_obj)",
          "old_line_content": "STATIC MP_DEFINE_CONST_DICT(pyb_sdcard_locals_dict, pyb_sdcard_locals_dict_table);",
          "new_line_content": "    { MP_ROM_QSTR(MP_QSTR_power), MP_ROM_PTR(&sd_power_obj) },",
          "content_same": false
        },
        {
          "line": 523,
          "old_api": null,
          "new_api": "MP_ROM_PTR",
          "old_text": null,
          "new_text": "MP_ROM_PTR(&sd_info_obj)",
          "old_line_content": "",
          "new_line_content": "    { MP_ROM_QSTR(MP_QSTR_info), MP_ROM_PTR(&sd_info_obj) },",
          "content_same": false
        },
        {
          "line": 524,
          "old_api": null,
          "new_api": "MP_ROM_PTR",
          "old_text": null,
          "new_text": "MP_ROM_PTR(&sd_read_obj)",
          "old_line_content": "const mp_obj_type_t pyb_sdcard_type = {",
          "new_line_content": "    { MP_ROM_QSTR(MP_QSTR_read), MP_ROM_PTR(&sd_read_obj) },",
          "content_same": false
        },
        {
          "line": 525,
          "old_api": null,
          "new_api": "MP_ROM_PTR",
          "old_text": null,
          "new_text": "MP_ROM_PTR(&sd_write_obj)",
          "old_line_content": "    { &mp_type_type },",
          "new_line_content": "    { MP_ROM_QSTR(MP_QSTR_write), MP_ROM_PTR(&sd_write_obj) },",
          "content_same": false
        },
        {
          "line": 270,
          "old_api": null,
          "new_api": "HAL_GetTick",
          "old_text": null,
          "new_text": "HAL_GetTick()",
          "old_line_content": "    if (sd_handle.Instance == NULL) {",
          "new_line_content": "        if (HAL_GetTick() - start >= timeout) {",
          "content_same": false
        },
        {
          "line": 527,
          "old_api": null,
          "new_api": "MP_ROM_PTR",
          "old_text": null,
          "new_text": "MP_ROM_PTR(&pyb_sdcard_readblocks_obj)",
          "old_line_content": "    .make_new = pyb_sdcard_make_new,",
          "new_line_content": "    { MP_ROM_QSTR(MP_QSTR_readblocks), MP_ROM_PTR(&pyb_sdcard_readblocks_obj) },",
          "content_same": false
        },
        {
          "line": 528,
          "old_api": null,
          "new_api": "MP_ROM_PTR",
          "old_text": null,
          "new_text": "MP_ROM_PTR(&pyb_sdcard_writeblocks_obj)",
          "old_line_content": "    .locals_dict = (mp_obj_dict_t*)&pyb_sdcard_locals_dict,",
          "new_line_content": "    { MP_ROM_QSTR(MP_QSTR_writeblocks), MP_ROM_PTR(&pyb_sdcard_writeblocks_obj) },",
          "content_same": false
        },
        {
          "line": 529,
          "old_api": null,
          "new_api": "MP_ROM_PTR",
          "old_text": null,
          "new_text": "MP_ROM_PTR(&pyb_sdcard_ioctl_obj)",
          "old_line_content": "};",
          "new_line_content": "    { MP_ROM_QSTR(MP_QSTR_ioctl), MP_ROM_PTR(&pyb_sdcard_ioctl_obj) },",
          "content_same": false
        },
        {
          "line": 273,
          "old_api": null,
          "new_api": "__WFI",
          "old_text": null,
          "new_text": "__WFI()",
          "old_line_content": "",
          "new_line_content": "        __WFI();",
          "content_same": false
        },
        {
          "line": 404,
          "old_api": null,
          "new_api": "mp_arg_check_num",
          "old_text": null,
          "new_text": "mp_arg_check_num(n_args, n_kw, 0, 0, false)",
          "old_line_content": "",
          "new_line_content": "    mp_arg_check_num(n_args, n_kw, 0, 0, false);",
          "content_same": false
        },
        {
          "line": 411,
          "old_api": null,
          "new_api": "sdcard_is_present",
          "old_text": null,
          "new_text": "sdcard_is_present()",
          "old_line_content": "        result = true;",
          "new_line_content": "    return mp_obj_new_bool(sdcard_is_present());",
          "content_same": false
        },
        {
          "line": 417,
          "old_api": null,
          "new_api": "mp_obj_is_true",
          "old_text": null,
          "new_text": "mp_obj_is_true(state)",
          "old_line_content": "STATIC mp_obj_t sd_info(mp_obj_t self) {",
          "new_line_content": "    if (mp_obj_is_true(state)) {",
          "content_same": false
        },
        {
          "line": 418,
          "old_api": null,
          "new_api": "sdcard_power_on",
          "old_text": null,
          "new_text": "sdcard_power_on()",
          "old_line_content": "    if (sd_handle.Instance == NULL) {",
          "new_line_content": "        result = sdcard_power_on();",
          "content_same": false
        },
        {
          "line": 420,
          "old_api": null,
          "new_api": "sdcard_power_off",
          "old_text": null,
          "new_text": "sdcard_power_off()",
          "old_line_content": "    }",
          "new_line_content": "        sdcard_power_off();",
          "content_same": false
        },
        {
          "line": 423,
          "old_api": null,
          "new_api": "mp_obj_new_bool",
          "old_text": null,
          "new_text": "mp_obj_new_bool(result)",
          "old_line_content": "    // cardinfo.SD_csd and cardinfo.SD_cid have lots of info but we don't use them",
          "new_line_content": "    return mp_obj_new_bool(result);",
          "content_same": false
        },
        {
          "line": 304,
          "old_api": null,
          "new_api": "query_irq",
          "old_text": null,
          "new_text": "query_irq()",
          "old_line_content": "",
          "new_line_content": "    if (query_irq() == IRQ_STATE_ENABLED) {",
          "content_same": false
        },
        {
          "line": 432,
          "old_api": null,
          "new_api": "HAL_SD_GetCardInfo",
          "old_text": null,
          "new_text": "HAL_SD_GetCardInfo(&sd_handle, &cardinfo)",
          "old_line_content": "",
          "new_line_content": "    HAL_SD_GetCardInfo(&sd_handle, &cardinfo);",
          "content_same": false
        },
        {
          "line": 306,
          "old_api": null,
          "new_api": "raise_irq_pri",
          "old_text": null,
          "new_text": "raise_irq_pri(IRQ_PRI_OTG_FS)",
          "old_line_content": "        if (err == HAL_OK) {",
          "new_line_content": "        uint32_t basepri = raise_irq_pri(IRQ_PRI_OTG_FS);",
          "content_same": false
        },
        {
          "line": 308,
          "old_api": null,
          "new_api": "dma_init",
          "old_text": null,
          "new_text": "dma_init(&sd_rx_dma, &SDMMC_RX_DMA, &sd_handle)",
          "old_line_content": "        }",
          "new_line_content": "        dma_init(&sd_rx_dma, &SDMMC_RX_DMA, &sd_handle);",
          "content_same": false
        },
        {
          "line": 437,
          "old_api": null,
          "new_api": "mp_obj_new_int",
          "old_text": null,
          "new_text": "mp_obj_new_int(cardinfo.CardType)",
          "old_line_content": "",
          "new_line_content": "        mp_obj_new_int(cardinfo.CardType),",
          "content_same": false
        },
        {
          "line": 439,
          "old_api": null,
          "new_api": "mp_obj_new_tuple",
          "old_text": null,
          "new_text": "mp_obj_new_tuple(3, tuple)",
          "old_line_content": "        m_del(uint8_t, dest, SDCARD_BLOCK_SIZE);",
          "new_line_content": "    return mp_obj_new_tuple(3, tuple);",
          "content_same": false
        },
        {
          "line": 445,
          "old_api": null,
          "new_api": "m_new",
          "old_text": null,
          "new_text": "m_new(uint8_t, SDCARD_BLOCK_SIZE)",
          "old_line_content": "STATIC MP_DEFINE_CONST_FUN_OBJ_2(sd_read_obj, sd_read);",
          "new_line_content": "    uint8_t *dest = m_new(uint8_t, SDCARD_BLOCK_SIZE);",
          "content_same": false
        },
        {
          "line": 446,
          "old_api": null,
          "new_api": "mp_obj_get_int",
          "old_text": null,
          "new_text": "mp_obj_get_int(block_num)",
          "old_line_content": "",
          "new_line_content": "    mp_uint_t ret = sdcard_read_blocks(dest, mp_obj_get_int(block_num), 1);",
          "content_same": false
        },
        {
          "line": 320,
          "old_api": null,
          "new_api": "dma_deinit",
          "old_text": null,
          "new_text": "dma_deinit(&SDMMC_RX_DMA)",
          "old_line_content": "",
          "new_line_content": "        dma_deinit(&SDMMC_RX_DMA);",
          "content_same": false
        },
        {
          "line": 325,
          "old_api": null,
          "new_api": "HAL_SD_ReadBlocks",
          "old_text": null,
          "new_text": "HAL_SD_ReadBlocks(&sd_handle, dest, block_num, num_blocks, 60000)",
          "old_line_content": "    }",
          "new_line_content": "        err = HAL_SD_ReadBlocks(&sd_handle, dest, block_num, num_blocks, 60000);",
          "content_same": false
        },
        {
          "line": 453,
          "old_api": null,
          "new_api": "mp_obj_new_bytearray_by_ref",
          "old_text": null,
          "new_text": "mp_obj_new_bytearray_by_ref(SDCARD_BLOCK_SIZE, dest)",
          "old_line_content": "    }",
          "new_line_content": "    return mp_obj_new_bytearray_by_ref(SDCARD_BLOCK_SIZE, dest);",
          "content_same": false
        },
        {
          "line": 327,
          "old_api": null,
          "new_api": "sdcard_wait_finished",
          "old_text": null,
          "new_text": "sdcard_wait_finished(&sd_handle, 60000)",
          "old_line_content": "    return err;",
          "new_line_content": "            err = sdcard_wait_finished(&sd_handle, 60000);",
          "content_same": false
        },
        {
          "line": 460,
          "old_api": null,
          "new_api": "mp_get_buffer_raise",
          "old_text": null,
          "new_text": "mp_get_buffer_raise(data, &bufinfo, MP_BUFFER_READ)",
          "old_line_content": "",
          "new_line_content": "    mp_get_buffer_raise(data, &bufinfo, MP_BUFFER_READ);",
          "content_same": false
        },
        {
          "line": 333,
          "old_api": null,
          "new_api": "memmove",
          "old_text": null,
          "new_text": "memmove(orig_dest, dest, num_blocks * SDCARD_BLOCK_SIZE)",
          "old_line_content": "        return HAL_ERROR;",
          "new_line_content": "        memmove(orig_dest, dest, num_blocks * SDCARD_BLOCK_SIZE);",
          "content_same": false
        },
        {
          "line": 334,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(dest, &saved_word, orig_dest - dest)",
          "old_line_content": "    }",
          "new_line_content": "        memcpy(dest, &saved_word, orig_dest - dest);",
          "content_same": false
        },
        {
          "line": 462,
          "old_api": null,
          "new_api": "mp_obj_new_exception_msg_varg",
          "old_text": null,
          "new_text": "mp_obj_new_exception_msg_varg(&mp_type_ValueError, \"writes must be a multiple of %d bytes\", SDCARD_BLOCK_SIZE)",
          "old_line_content": "}",
          "new_line_content": "        nlr_raise(mp_obj_new_exception_msg_varg(&mp_type_ValueError, \"writes must be a multiple of %d bytes\", SDCARD_BLOCK_SIZE));",
          "content_same": false
        },
        {
          "line": 465,
          "old_api": null,
          "new_api": "mp_obj_get_int",
          "old_text": null,
          "new_text": "mp_obj_get_int(block_num)",
          "old_line_content": "STATIC mp_obj_t pyb_sdcard_readblocks(mp_obj_t self, mp_obj_t block_num, mp_obj_t buf) {",
          "new_line_content": "    mp_uint_t ret = sdcard_write_blocks(bufinfo.buf, mp_obj_get_int(block_num), bufinfo.len / SDCARD_BLOCK_SIZE);",
          "content_same": false
        },
        {
          "line": 478,
          "old_api": null,
          "new_api": "mp_obj_get_int",
          "old_text": null,
          "new_text": "mp_obj_get_int(block_num)",
          "old_line_content": "}",
          "new_line_content": "    mp_uint_t ret = sdcard_read_blocks(bufinfo.buf, mp_obj_get_int(block_num), bufinfo.len / SDCARD_BLOCK_SIZE);",
          "content_same": false
        },
        {
          "line": 351,
          "old_api": null,
          "new_api": "m_new_maybe",
          "old_text": null,
          "new_text": "m_new_maybe(uint8_t, SDCARD_BLOCK_SIZE)",
          "old_line_content": "        }",
          "new_line_content": "        uint8_t *src_aligned = m_new_maybe(uint8_t, SDCARD_BLOCK_SIZE);",
          "content_same": false
        },
        {
          "line": 479,
          "old_api": null,
          "new_api": "mp_obj_new_bool",
          "old_text": null,
          "new_text": "mp_obj_new_bool(ret == 0)",
          "old_line_content": "STATIC MP_DEFINE_CONST_FUN_OBJ_3(pyb_sdcard_writeblocks_obj, pyb_sdcard_writeblocks);",
          "new_line_content": "    return mp_obj_new_bool(ret == 0);",
          "content_same": false
        },
        {
          "line": 357,
          "old_api": null,
          "new_api": "sdcard_write_blocks",
          "old_text": null,
          "new_text": "sdcard_write_blocks(src_aligned, block_num + i, 1)",
          "old_line_content": "        // we must disable USB irqs to prevent MSC contention with SD card",
          "new_line_content": "            err = sdcard_write_blocks(src_aligned, block_num + i, 1);",
          "content_same": false
        },
        {
          "line": 487,
          "old_api": null,
          "new_api": "mp_obj_new_bool",
          "old_text": null,
          "new_text": "mp_obj_new_bool(ret == 0)",
          "old_line_content": "            }",
          "new_line_content": "    return mp_obj_new_bool(ret == 0);",
          "content_same": false
        },
        {
          "line": 495,
          "old_api": null,
          "new_api": "sdcard_power_on",
          "old_text": null,
          "new_text": "sdcard_power_on()",
          "old_line_content": "            // nothing to do",
          "new_line_content": "            if (!sdcard_power_on()) {",
          "content_same": false
        },
        {
          "line": 498,
          "old_api": null,
          "new_api": "MP_OBJ_NEW_SMALL_INT",
          "old_text": null,
          "new_text": "MP_OBJ_NEW_SMALL_INT(0)",
          "old_line_content": "        case BP_IOCTL_SEC_COUNT:",
          "new_line_content": "            return MP_OBJ_NEW_SMALL_INT(0); // success",
          "content_same": false
        },
        {
          "line": 506,
          "old_api": null,
          "new_api": "MP_OBJ_NEW_SMALL_INT",
          "old_text": null,
          "new_text": "MP_OBJ_NEW_SMALL_INT(0)",
          "old_line_content": "    }",
          "new_line_content": "            return MP_OBJ_NEW_SMALL_INT(0); // success",
          "content_same": false
        },
        {
          "line": 501,
          "old_api": null,
          "new_api": "sdcard_power_off",
          "old_text": null,
          "new_text": "sdcard_power_off()",
          "old_line_content": "        case BP_IOCTL_SEC_SIZE:",
          "new_line_content": "            sdcard_power_off();",
          "content_same": false
        },
        {
          "line": 374,
          "old_api": null,
          "new_api": "MP_HAL_CLEAN_DCACHE",
          "old_text": null,
          "new_text": "MP_HAL_CLEAN_DCACHE(src, num_blocks * SDCARD_BLOCK_SIZE)",
          "old_line_content": "    } else {",
          "new_line_content": "        MP_HAL_CLEAN_DCACHE(src, num_blocks * SDCARD_BLOCK_SIZE);",
          "content_same": false
        },
        {
          "line": 376,
          "old_api": null,
          "new_api": "HAL_SD_WriteBlocks_DMA",
          "old_text": null,
          "new_text": "HAL_SD_WriteBlocks_DMA(&sd_handle, (uint8_t*)src, block_num, num_blocks)",
          "old_line_content": "        if (err == HAL_OK) {",
          "new_line_content": "        err = HAL_SD_WriteBlocks_DMA(&sd_handle, (uint8_t*)src, block_num, num_blocks);",
          "content_same": false
        },
        {
          "line": 249,
          "old_api": null,
          "new_api": "disable_irq",
          "old_text": null,
          "new_text": "disable_irq()",
          "old_line_content": "            return HAL_TIMEOUT;",
          "new_line_content": "        uint32_t irq_state = disable_irq();",
          "content_same": false
        },
        {
          "line": 378,
          "old_api": null,
          "new_api": "sdcard_wait_finished",
          "old_text": null,
          "new_text": "sdcard_wait_finished(&sd_handle, 60000)",
          "old_line_content": "        }",
          "new_line_content": "            err = sdcard_wait_finished(&sd_handle, 60000);",
          "content_same": false
        },
        {
          "line": 251,
          "old_api": null,
          "new_api": "enable_irq",
          "old_text": null,
          "new_text": "enable_irq(irq_state)",
          "old_line_content": "    }",
          "new_line_content": "            enable_irq(irq_state);",
          "content_same": false
        },
        {
          "line": 380,
          "old_api": null,
          "new_api": "dma_deinit",
          "old_text": null,
          "new_text": "dma_deinit(&SDMMC_TX_DMA)",
          "old_line_content": "",
          "new_line_content": "        dma_deinit(&SDMMC_TX_DMA);",
          "content_same": false
        },
        {
          "line": 509,
          "old_api": null,
          "new_api": "MP_OBJ_NEW_SMALL_INT",
          "old_text": null,
          "new_text": "MP_OBJ_NEW_SMALL_INT(0)",
          "old_line_content": "",
          "new_line_content": "            return MP_OBJ_NEW_SMALL_INT(0); // TODO",
          "content_same": false
        },
        {
          "line": 255,
          "old_api": null,
          "new_api": "enable_irq",
          "old_text": null,
          "new_text": "enable_irq(irq_state)",
          "old_line_content": "        if (state == HAL_SD_CARD_TRANSFER) {",
          "new_line_content": "        enable_irq(irq_state);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 513,
          "old_api": "MP_ROM_PTR",
          "new_api": null,
          "old_text": "MP_ROM_PTR(&sd_info_obj)",
          "new_text": null,
          "old_line_content": "    { MP_ROM_QSTR(MP_QSTR_info), MP_ROM_PTR(&sd_info_obj) },",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 514,
          "old_api": "MP_ROM_PTR",
          "new_api": null,
          "old_text": "MP_ROM_PTR(&sd_read_obj)",
          "new_text": null,
          "old_line_content": "    { MP_ROM_QSTR(MP_QSTR_read), MP_ROM_PTR(&sd_read_obj) },",
          "new_line_content": "        default: // unknown command",
          "content_same": false
        },
        {
          "line": 517,
          "old_api": "MP_ROM_PTR",
          "new_api": null,
          "old_text": "MP_ROM_PTR(&pyb_sdcard_readblocks_obj)",
          "new_text": null,
          "old_line_content": "    { MP_ROM_QSTR(MP_QSTR_readblocks), MP_ROM_PTR(&pyb_sdcard_readblocks_obj) },",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 518,
          "old_api": "MP_ROM_PTR",
          "new_api": null,
          "old_text": "MP_ROM_PTR(&pyb_sdcard_writeblocks_obj)",
          "new_text": null,
          "old_line_content": "    { MP_ROM_QSTR(MP_QSTR_writeblocks), MP_ROM_PTR(&pyb_sdcard_writeblocks_obj) },",
          "new_line_content": "STATIC MP_DEFINE_CONST_FUN_OBJ_3(pyb_sdcard_ioctl_obj, pyb_sdcard_ioctl);",
          "content_same": false
        },
        {
          "line": 519,
          "old_api": "MP_ROM_PTR",
          "new_api": null,
          "old_text": "MP_ROM_PTR(&pyb_sdcard_ioctl_obj)",
          "new_text": null,
          "old_line_content": "    { MP_ROM_QSTR(MP_QSTR_ioctl), MP_ROM_PTR(&pyb_sdcard_ioctl_obj) },",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 261,
          "old_api": "HAL_GetTick",
          "new_api": null,
          "old_text": "HAL_GetTick()",
          "new_text": null,
          "old_line_content": "        if (HAL_GetTick() - start >= timeout) {",
          "new_line_content": "    // Wait for SD card to complete the operation",
          "content_same": false
        },
        {
          "line": 394,
          "old_api": "mp_arg_check_num",
          "new_api": null,
          "old_text": "mp_arg_check_num(n_args, n_kw, 0, 0, false)",
          "new_text": null,
          "old_line_content": "    mp_arg_check_num(n_args, n_kw, 0, 0, false);",
          "new_line_content": "/******************************************************************************/",
          "content_same": false
        },
        {
          "line": 401,
          "old_api": "sdcard_is_present",
          "new_api": null,
          "old_text": "sdcard_is_present()",
          "new_text": null,
          "old_line_content": "    return mp_obj_new_bool(sdcard_is_present());",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 407,
          "old_api": "mp_obj_is_true",
          "new_api": null,
          "old_text": "mp_obj_is_true(state)",
          "new_text": null,
          "old_line_content": "    if (mp_obj_is_true(state)) {",
          "new_line_content": "    return (mp_obj_t)&pyb_sdcard_obj;",
          "content_same": false
        },
        {
          "line": 408,
          "old_api": "sdcard_power_on",
          "new_api": null,
          "old_text": "sdcard_power_on()",
          "new_text": null,
          "old_line_content": "        result = sdcard_power_on();",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 410,
          "old_api": "sdcard_power_off",
          "new_api": null,
          "old_text": "sdcard_power_off()",
          "new_text": null,
          "old_line_content": "        sdcard_power_off();",
          "new_line_content": "STATIC mp_obj_t sd_present(mp_obj_t self) {",
          "content_same": false
        },
        {
          "line": 413,
          "old_api": "mp_obj_new_bool",
          "new_api": null,
          "old_text": "mp_obj_new_bool(result)",
          "new_text": null,
          "old_line_content": "    return mp_obj_new_bool(result);",
          "new_line_content": "STATIC MP_DEFINE_CONST_FUN_OBJ_1(sd_present_obj, sd_present);",
          "content_same": false
        },
        {
          "line": 294,
          "old_api": "query_irq",
          "new_api": null,
          "old_text": "query_irq()",
          "new_text": null,
          "old_line_content": "    if (query_irq() == IRQ_STATE_ENABLED) {",
          "new_line_content": "        // location, read into the aligned memory, move the memory back to the",
          "content_same": false
        },
        {
          "line": 422,
          "old_api": "HAL_SD_GetCardInfo",
          "new_api": null,
          "old_text": "HAL_SD_GetCardInfo(&sd_handle, &cardinfo)",
          "new_text": null,
          "old_line_content": "    HAL_SD_GetCardInfo(&sd_handle, &cardinfo);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 296,
          "old_api": "raise_irq_pri",
          "new_api": null,
          "old_text": "raise_irq_pri(IRQ_PRI_OTG_FS)",
          "new_text": null,
          "old_line_content": "        uint32_t basepri = raise_irq_pri(IRQ_PRI_OTG_FS);",
          "new_line_content": "        // location.  We should have no trouble doing this as those initial",
          "content_same": false
        },
        {
          "line": 425,
          "old_api": "mp_obj_new_int_from_ull",
          "new_api": null,
          "old_text": "mp_obj_new_int_from_ull((uint64_t)cardinfo.LogBlockNbr * (uint64_t)cardinfo.LogBlockSize)",
          "new_text": null,
          "old_line_content": "        mp_obj_new_int_from_ull((uint64_t)cardinfo.LogBlockNbr * (uint64_t)cardinfo.LogBlockSize),",
          "new_line_content": "STATIC MP_DEFINE_CONST_FUN_OBJ_2(sd_power_obj, sd_power);",
          "content_same": false
        },
        {
          "line": 298,
          "old_api": "dma_init",
          "new_api": null,
          "old_text": "dma_init(&sd_rx_dma, &SDMMC_RX_DMA, &sd_handle)",
          "new_text": null,
          "old_line_content": "        dma_init(&sd_rx_dma, &SDMMC_RX_DMA, &sd_handle);",
          "new_line_content": "        // duration of this function call.",
          "content_same": false
        },
        {
          "line": 426,
          "old_api": "mp_obj_new_int_from_uint",
          "new_api": null,
          "old_text": "mp_obj_new_int_from_uint(cardinfo.LogBlockSize)",
          "new_text": null,
          "old_line_content": "        mp_obj_new_int_from_uint(cardinfo.LogBlockSize),",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 427,
          "old_api": "mp_obj_new_int",
          "new_api": null,
          "old_text": "mp_obj_new_int(cardinfo.CardType)",
          "new_text": null,
          "old_line_content": "        mp_obj_new_int(cardinfo.CardType),",
          "new_line_content": "STATIC mp_obj_t sd_info(mp_obj_t self) {",
          "content_same": false
        },
        {
          "line": 429,
          "old_api": "mp_obj_new_tuple",
          "new_api": null,
          "old_text": "mp_obj_new_tuple(3, tuple)",
          "new_text": null,
          "old_line_content": "    return mp_obj_new_tuple(3, tuple);",
          "new_line_content": "        return mp_const_none;",
          "content_same": false
        },
        {
          "line": 303,
          "old_api": "MP_HAL_CLEANINVALIDATE_DCACHE",
          "new_api": null,
          "old_text": "MP_HAL_CLEANINVALIDATE_DCACHE(dest, num_blocks * SDCARD_BLOCK_SIZE)",
          "new_text": null,
          "old_line_content": "        MP_HAL_CLEANINVALIDATE_DCACHE(dest, num_blocks * SDCARD_BLOCK_SIZE);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 305,
          "old_api": "HAL_SD_ReadBlocks_DMA",
          "new_api": null,
          "old_text": "HAL_SD_ReadBlocks_DMA(&sd_handle, dest, block_num, num_blocks)",
          "new_text": null,
          "old_line_content": "        err = HAL_SD_ReadBlocks_DMA(&sd_handle, dest, block_num, num_blocks);",
          "new_line_content": "        // we must disable USB irqs to prevent MSC contention with SD card",
          "content_same": false
        },
        {
          "line": 307,
          "old_api": "sdcard_wait_finished",
          "new_api": null,
          "old_text": "sdcard_wait_finished(&sd_handle, 60000)",
          "new_text": null,
          "old_line_content": "            err = sdcard_wait_finished(&sd_handle, 60000);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 310,
          "old_api": "dma_deinit",
          "new_api": null,
          "old_text": "dma_deinit(&SDMMC_RX_DMA)",
          "new_text": null,
          "old_line_content": "        dma_deinit(&SDMMC_RX_DMA);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 440,
          "old_api": "mp_obj_new_exception_msg_varg",
          "new_api": null,
          "old_text": "mp_obj_new_exception_msg_varg(&mp_type_Exception, \"sdcard_read_blocks failed [%u]\", ret)",
          "new_text": null,
          "old_line_content": "        nlr_raise(mp_obj_new_exception_msg_varg(&mp_type_Exception, \"sdcard_read_blocks failed [%u]\", ret));",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 443,
          "old_api": "mp_obj_new_bytearray_by_ref",
          "new_api": null,
          "old_text": "mp_obj_new_bytearray_by_ref(SDCARD_BLOCK_SIZE, dest)",
          "new_text": null,
          "old_line_content": "    return mp_obj_new_bytearray_by_ref(SDCARD_BLOCK_SIZE, dest);",
          "new_line_content": "// now obsolete, kept for backwards compatibility",
          "content_same": false
        },
        {
          "line": 324,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(dest, &saved_word, orig_dest - dest)",
          "new_text": null,
          "old_line_content": "        memcpy(dest, &saved_word, orig_dest - dest);",
          "new_line_content": "    } else {",
          "content_same": false
        },
        {
          "line": 452,
          "old_api": "mp_obj_new_exception_msg_varg",
          "new_api": null,
          "old_text": "mp_obj_new_exception_msg_varg(&mp_type_ValueError, \"writes must be a multiple of %d bytes\", SDCARD_BLOCK_SIZE)",
          "new_text": null,
          "old_line_content": "        nlr_raise(mp_obj_new_exception_msg_varg(&mp_type_ValueError, \"writes must be a multiple of %d bytes\", SDCARD_BLOCK_SIZE));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 455,
          "old_api": "mp_obj_get_int",
          "new_api": null,
          "old_text": "mp_obj_get_int(block_num)",
          "new_text": null,
          "old_line_content": "    mp_uint_t ret = sdcard_write_blocks(bufinfo.buf, mp_obj_get_int(block_num), bufinfo.len / SDCARD_BLOCK_SIZE);",
          "new_line_content": "STATIC MP_DEFINE_CONST_FUN_OBJ_2(sd_read_obj, sd_read);",
          "content_same": false
        },
        {
          "line": 458,
          "old_api": "mp_obj_new_exception_msg_varg",
          "new_api": null,
          "old_text": "mp_obj_new_exception_msg_varg(&mp_type_Exception, \"sdcard_write_blocks failed [%u]\", ret)",
          "new_text": null,
          "old_line_content": "        nlr_raise(mp_obj_new_exception_msg_varg(&mp_type_Exception, \"sdcard_write_blocks failed [%u]\", ret));",
          "new_line_content": "STATIC mp_obj_t sd_write(mp_obj_t self, mp_obj_t block_num, mp_obj_t data) {",
          "content_same": false
        },
        {
          "line": 467,
          "old_api": "mp_get_buffer_raise",
          "new_api": null,
          "old_text": "mp_get_buffer_raise(buf, &bufinfo, MP_BUFFER_WRITE)",
          "new_text": null,
          "old_line_content": "    mp_get_buffer_raise(buf, &bufinfo, MP_BUFFER_WRITE);",
          "new_line_content": "    if (ret != 0) {",
          "content_same": false
        },
        {
          "line": 341,
          "old_api": "m_new_maybe",
          "new_api": null,
          "old_text": "m_new_maybe(uint8_t, SDCARD_BLOCK_SIZE)",
          "new_text": null,
          "old_line_content": "        uint8_t *src_aligned = m_new_maybe(uint8_t, SDCARD_BLOCK_SIZE);",
          "new_line_content": "    // check that SD card is initialised",
          "content_same": false
        },
        {
          "line": 469,
          "old_api": "mp_obj_new_bool",
          "new_api": null,
          "old_text": "mp_obj_new_bool(ret == 0)",
          "new_text": null,
          "old_line_content": "    return mp_obj_new_bool(ret == 0);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 346,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(src_aligned, src + i * SDCARD_BLOCK_SIZE, SDCARD_BLOCK_SIZE)",
          "new_text": null,
          "old_line_content": "            memcpy(src_aligned, src + i * SDCARD_BLOCK_SIZE, SDCARD_BLOCK_SIZE);",
          "new_line_content": "    HAL_StatusTypeDef err = HAL_OK;",
          "content_same": false
        },
        {
          "line": 347,
          "old_api": "sdcard_write_blocks",
          "new_api": null,
          "old_text": "sdcard_write_blocks(src_aligned, block_num + i, 1)",
          "new_text": null,
          "old_line_content": "            err = sdcard_write_blocks(src_aligned, block_num + i, 1);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 475,
          "old_api": "mp_get_buffer_raise",
          "new_api": null,
          "old_text": "mp_get_buffer_raise(buf, &bufinfo, MP_BUFFER_READ)",
          "new_text": null,
          "old_line_content": "    mp_get_buffer_raise(buf, &bufinfo, MP_BUFFER_READ);",
          "new_line_content": "STATIC mp_obj_t pyb_sdcard_readblocks(mp_obj_t self, mp_obj_t block_num, mp_obj_t buf) {",
          "content_same": false
        },
        {
          "line": 476,
          "old_api": "mp_obj_get_int",
          "new_api": null,
          "old_text": "mp_obj_get_int(block_num)",
          "new_text": null,
          "old_line_content": "    mp_uint_t ret = sdcard_write_blocks(bufinfo.buf, mp_obj_get_int(block_num), bufinfo.len / SDCARD_BLOCK_SIZE);",
          "new_line_content": "    mp_buffer_info_t bufinfo;",
          "content_same": false
        },
        {
          "line": 482,
          "old_api": "mp_obj_get_int",
          "new_api": null,
          "old_text": "mp_obj_get_int(cmd_in)",
          "new_text": null,
          "old_line_content": "    mp_int_t cmd = mp_obj_get_int(cmd_in);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 358,
          "old_api": "raise_irq_pri",
          "new_api": null,
          "old_text": "raise_irq_pri(IRQ_PRI_OTG_FS)",
          "new_text": null,
          "old_line_content": "        uint32_t basepri = raise_irq_pri(IRQ_PRI_OTG_FS);",
          "new_line_content": "            if (err != HAL_OK) {",
          "content_same": false
        },
        {
          "line": 360,
          "old_api": "dma_init",
          "new_api": null,
          "old_text": "dma_init(&sd_tx_dma, &SDMMC_TX_DMA, &sd_handle)",
          "new_text": null,
          "old_line_content": "        dma_init(&sd_tx_dma, &SDMMC_TX_DMA, &sd_handle);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 488,
          "old_api": "MP_OBJ_NEW_SMALL_INT",
          "new_api": null,
          "old_text": "MP_OBJ_NEW_SMALL_INT(0)",
          "new_text": null,
          "old_line_content": "            return MP_OBJ_NEW_SMALL_INT(0); // success",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 491,
          "old_api": "sdcard_power_off",
          "new_api": null,
          "old_text": "sdcard_power_off()",
          "new_text": null,
          "old_line_content": "            sdcard_power_off();",
          "new_line_content": "STATIC mp_obj_t pyb_sdcard_ioctl(mp_obj_t self, mp_obj_t cmd_in, mp_obj_t arg_in) {",
          "content_same": false
        },
        {
          "line": 364,
          "old_api": "MP_HAL_CLEAN_DCACHE",
          "new_api": null,
          "old_text": "MP_HAL_CLEAN_DCACHE(src, num_blocks * SDCARD_BLOCK_SIZE)",
          "new_text": null,
          "old_line_content": "        MP_HAL_CLEAN_DCACHE(src, num_blocks * SDCARD_BLOCK_SIZE);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 505,
          "old_api": "MP_OBJ_NEW_SMALL_INT",
          "new_api": null,
          "old_text": "MP_OBJ_NEW_SMALL_INT(-1)",
          "new_text": null,
          "old_line_content": "            return MP_OBJ_NEW_SMALL_INT(-1); // error",
          "new_line_content": "            // nothing to do",
          "content_same": false
        },
        {
          "line": 499,
          "old_api": "MP_OBJ_NEW_SMALL_INT",
          "new_api": null,
          "old_text": "MP_OBJ_NEW_SMALL_INT(0)",
          "new_text": null,
          "old_line_content": "            return MP_OBJ_NEW_SMALL_INT(0); // TODO",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 373,
          "old_api": "restore_irq_pri",
          "new_api": null,
          "old_text": "restore_irq_pri(basepri)",
          "new_text": null,
          "old_line_content": "        restore_irq_pri(basepri);",
          "new_line_content": "        // make sure cache is flushed to RAM so the DMA can read the correct data",
          "content_same": false
        },
        {
          "line": 375,
          "old_api": "HAL_SD_WriteBlocks",
          "new_api": null,
          "old_text": "HAL_SD_WriteBlocks(&sd_handle, (uint8_t*)src, block_num, num_blocks, 60000)",
          "new_text": null,
          "old_line_content": "        err = HAL_SD_WriteBlocks(&sd_handle, (uint8_t*)src, block_num, num_blocks, 60000);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 248,
          "old_api": "HAL_GetTick",
          "new_api": null,
          "old_text": "HAL_GetTick()",
          "new_text": null,
          "old_line_content": "        if (HAL_GetTick() - start >= timeout) {",
          "new_line_content": "        // Do an atomic check of the state; WFI will exit even if IRQs are disabled",
          "content_same": false
        },
        {
          "line": 377,
          "old_api": "sdcard_wait_finished",
          "new_api": null,
          "old_text": "sdcard_wait_finished(&sd_handle, 60000)",
          "new_text": null,
          "old_line_content": "            err = sdcard_wait_finished(&sd_handle, 60000);",
          "new_line_content": "        if (err == HAL_OK) {",
          "content_same": false
        },
        {
          "line": 511,
          "old_api": "MP_ROM_PTR",
          "new_api": null,
          "old_text": "MP_ROM_PTR(&sd_present_obj)",
          "new_text": null,
          "old_line_content": "    { MP_ROM_QSTR(MP_QSTR_present), MP_ROM_PTR(&sd_present_obj) },",
          "new_line_content": "        case BP_IOCTL_SEC_SIZE:",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 18,
      "total_additions": 55,
      "total_deletions": 50,
      "total_api_changes": 123
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 11,
        "api_related_lines": 123,
        "non_api_lines": 5,
        "non_api_line_numbers": [
          260,
          247,
          250,
          252,
          253
        ]
      }
    },
    "api_calls_before": 120,
    "api_calls_after": 125,
    "diff_info": {
      "added_lines": 11,
      "removed_lines": 1,
      "total_diff_lines": 35
    }
  }
}