{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/micropython/modified_file/b0a46900de885644c30414caeb4d39fae493e931",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/micropython/modified_file/b0a46900de885644c30414caeb4d39fae493e931/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/micropython/modified_file/b0a46900de885644c30414caeb4d39fae493e931/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/micropython/modified_file/b0a46900de885644c30414caeb4d39fae493e931/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 188,
          "old_api": "led_state",
          "new_api": "HAL_GetTick",
          "old_text": "led_state(PYB_LED_R2, 1)",
          "new_text": "HAL_GetTick()",
          "old_line_content": "        led_state(PYB_LED_R2, 1);",
          "new_line_content": "        uint32_t start_tick = HAL_GetTick();",
          "content_same": false
        },
        {
          "line": 195,
          "old_api": "printf",
          "new_api": "MP_STATE_PORT",
          "old_text": "printf(\"PYB: can't create flash filesystem\\n\")",
          "new_text": "MP_STATE_PORT(fs_user_mount)",
          "old_line_content": "            printf(\"PYB: can't create flash filesystem\\n\");",
          "new_line_content": "            MP_STATE_PORT(fs_user_mount)[0] = NULL;",
          "content_same": false
        },
        {
          "line": 212,
          "old_api": "f_open",
          "new_api": "f_write",
          "old_text": "f_open(&fp, \"/flash/pybcdc.inf\", FA_WRITE | FA_CREATE_ALWAYS)",
          "new_text": "f_write(&fp, fresh_pybcdc_inf, sizeof(fresh_pybcdc_inf) - 1 /* don't count null terminator */, &n)",
          "old_line_content": "        f_open(&fp, \"/flash/pybcdc.inf\", FA_WRITE | FA_CREATE_ALWAYS);",
          "new_line_content": "        f_write(&fp, fresh_pybcdc_inf, sizeof(fresh_pybcdc_inf) - 1 /* don't count null terminator */, &n);",
          "content_same": false
        },
        {
          "line": 213,
          "old_api": "f_write",
          "new_api": "f_close",
          "old_text": "f_write(&fp, fresh_pybcdc_inf, sizeof(fresh_pybcdc_inf) - 1 /* don't count null terminator */, &n)",
          "new_text": "f_close(&fp)",
          "old_line_content": "        f_write(&fp, fresh_pybcdc_inf, sizeof(fresh_pybcdc_inf) - 1 /* don't count null terminator */, &n);",
          "new_line_content": "        f_close(&fp);",
          "content_same": false
        },
        {
          "line": 217,
          "old_api": "f_open",
          "new_api": "f_write",
          "old_text": "f_open(&fp, \"/flash/README.txt\", FA_WRITE | FA_CREATE_ALWAYS)",
          "new_text": "f_write(&fp, fresh_readme_txt, sizeof(fresh_readme_txt) - 1 /* don't count null terminator */, &n)",
          "old_line_content": "        f_open(&fp, \"/flash/README.txt\", FA_WRITE | FA_CREATE_ALWAYS);",
          "new_line_content": "        f_write(&fp, fresh_readme_txt, sizeof(fresh_readme_txt) - 1 /* don't count null terminator */, &n);",
          "content_same": false
        },
        {
          "line": 218,
          "old_api": "f_write",
          "new_api": "f_close",
          "old_text": "f_write(&fp, fresh_readme_txt, sizeof(fresh_readme_txt) - 1 /* don't count null terminator */, &n)",
          "new_text": "f_close(&fp)",
          "old_line_content": "        f_write(&fp, fresh_readme_txt, sizeof(fresh_readme_txt) - 1 /* don't count null terminator */, &n);",
          "new_line_content": "        f_close(&fp);",
          "content_same": false
        },
        {
          "line": 222,
          "old_api": "sys_tick_wait_at_least",
          "new_api": "led_state",
          "old_text": "sys_tick_wait_at_least(start_tick, 200)",
          "new_text": "led_state(PYB_LED_R2, 0)",
          "old_line_content": "        sys_tick_wait_at_least(start_tick, 200);",
          "new_line_content": "        led_state(PYB_LED_R2, 0);",
          "content_same": false
        },
        {
          "line": 227,
          "old_api": "printf",
          "new_api": "MP_STATE_PORT",
          "old_text": "printf(\"PYB: can't mount flash\\n\")",
          "new_text": "MP_STATE_PORT(fs_user_mount)",
          "old_line_content": "        printf(\"PYB: can't mount flash\\n\");",
          "new_line_content": "        MP_STATE_PORT(fs_user_mount)[0] = NULL;",
          "content_same": false
        },
        {
          "line": 255,
          "old_api": "led_state",
          "new_api": "HAL_GetTick",
          "old_text": "led_state(PYB_LED_R2, 1)",
          "new_text": "HAL_GetTick()",
          "old_line_content": "        led_state(PYB_LED_R2, 1);",
          "new_line_content": "        uint32_t start_tick = HAL_GetTick();",
          "content_same": false
        },
        {
          "line": 266,
          "old_api": "sys_tick_wait_at_least",
          "new_api": "led_state",
          "old_text": "sys_tick_wait_at_least(start_tick, 200)",
          "new_text": "led_state(PYB_LED_R2, 0)",
          "old_line_content": "        sys_tick_wait_at_least(start_tick, 200);",
          "new_line_content": "        led_state(PYB_LED_R2, 0);",
          "content_same": false
        },
        {
          "line": 296,
          "old_api": "led_state",
          "new_api": "HAL_Delay",
          "old_text": "led_state(4, 0)",
          "new_text": "HAL_Delay(50)",
          "old_line_content": "            led_state(4, 0);",
          "new_line_content": "            HAL_Delay(50);",
          "content_same": false
        },
        {
          "line": 297,
          "old_api": "HAL_Delay",
          "new_api": "led_state",
          "old_text": "HAL_Delay(50)",
          "new_text": "led_state(2, reset_mode & 1)",
          "old_line_content": "            HAL_Delay(50);",
          "new_line_content": "            led_state(2, reset_mode & 1);",
          "content_same": false
        },
        {
          "line": 300,
          "old_api": "led_state",
          "new_api": "HAL_Delay",
          "old_text": "led_state(4, reset_mode & 4)",
          "new_text": "HAL_Delay(50)",
          "old_line_content": "            led_state(4, reset_mode & 4);",
          "new_line_content": "            HAL_Delay(50);",
          "content_same": false
        },
        {
          "line": 315,
          "old_api": "led_state",
          "new_api": "HAL_Delay",
          "old_text": "led_state(1, 1)",
          "new_text": "HAL_Delay(100)",
          "old_line_content": "                led_state(1, 1);",
          "new_line_content": "                HAL_Delay(100);",
          "content_same": false
        },
        {
          "line": 316,
          "old_api": "HAL_Delay",
          "new_api": "led_state",
          "old_text": "HAL_Delay(100)",
          "new_text": "led_state(1, 0)",
          "old_line_content": "                HAL_Delay(100);",
          "new_line_content": "                led_state(1, 0);",
          "content_same": false
        },
        {
          "line": 317,
          "old_api": "led_state",
          "new_api": "HAL_Delay",
          "old_text": "led_state(1, 0)",
          "new_text": "HAL_Delay(200)",
          "old_line_content": "                led_state(1, 0);",
          "new_line_content": "                HAL_Delay(200);",
          "content_same": false
        },
        {
          "line": 320,
          "old_api": "HAL_Delay",
          "new_api": "switch_get",
          "old_text": "HAL_Delay(400)",
          "new_text": "switch_get()",
          "old_line_content": "            HAL_Delay(400);",
          "new_line_content": "            if (!switch_get()) {",
          "content_same": false
        },
        {
          "line": 331,
          "old_api": "led_state",
          "new_api": "HAL_Delay",
          "old_text": "led_state(1, 1)",
          "new_text": "HAL_Delay(100)",
          "old_line_content": "                led_state(1, 1);",
          "new_line_content": "                HAL_Delay(100);",
          "content_same": false
        },
        {
          "line": 332,
          "old_api": "HAL_Delay",
          "new_api": "led_state",
          "old_text": "HAL_Delay(100)",
          "new_text": "led_state(1, 0)",
          "old_line_content": "                HAL_Delay(100);",
          "new_line_content": "                led_state(1, 0);",
          "content_same": false
        },
        {
          "line": 333,
          "old_api": "led_state",
          "new_api": "HAL_Delay",
          "old_text": "led_state(1, 0)",
          "new_text": "HAL_Delay(200)",
          "old_line_content": "                led_state(1, 0);",
          "new_line_content": "                HAL_Delay(200);",
          "content_same": false
        },
        {
          "line": 351,
          "old_api": "mp_stack_ctrl_init",
          "new_api": "mp_stack_set_limit",
          "old_text": "mp_stack_ctrl_init()",
          "new_text": "mp_stack_set_limit((char*)&_ram_end - (char*)&_heap_end - 1024)",
          "old_line_content": "    mp_stack_ctrl_init();",
          "new_line_content": "    mp_stack_set_limit((char*)&_ram_end - (char*)&_heap_end - 1024);",
          "content_same": false
        },
        {
          "line": 366,
          "old_api": "__GPIOA_CLK_ENABLE",
          "new_api": "__GPIOB_CLK_ENABLE",
          "old_text": "__GPIOA_CLK_ENABLE()",
          "new_text": "__GPIOB_CLK_ENABLE()",
          "old_line_content": "    __GPIOA_CLK_ENABLE();",
          "new_line_content": "    __GPIOB_CLK_ENABLE();",
          "content_same": false
        },
        {
          "line": 367,
          "old_api": "__GPIOB_CLK_ENABLE",
          "new_api": "__GPIOC_CLK_ENABLE",
          "old_text": "__GPIOB_CLK_ENABLE()",
          "new_text": "__GPIOC_CLK_ENABLE()",
          "old_line_content": "    __GPIOB_CLK_ENABLE();",
          "new_line_content": "    __GPIOC_CLK_ENABLE();",
          "content_same": false
        },
        {
          "line": 368,
          "old_api": "__GPIOC_CLK_ENABLE",
          "new_api": "__GPIOD_CLK_ENABLE",
          "old_text": "__GPIOC_CLK_ENABLE()",
          "new_text": "__GPIOD_CLK_ENABLE()",
          "old_line_content": "    __GPIOC_CLK_ENABLE();",
          "new_line_content": "    __GPIOD_CLK_ENABLE();",
          "content_same": false
        },
        {
          "line": 387,
          "old_api": "pendsv_init",
          "new_api": "led_init",
          "old_text": "pendsv_init()",
          "new_text": "led_init()",
          "old_line_content": "    pendsv_init();",
          "new_line_content": "    led_init();",
          "content_same": false
        },
        {
          "line": 411,
          "old_api": "led_state",
          "new_api": "update_reset_mode",
          "old_text": "led_state(4, 0)",
          "new_text": "update_reset_mode(1)",
          "old_line_content": "    led_state(4, 0);",
          "new_line_content": "    uint reset_mode = update_reset_mode(1);",
          "content_same": false
        },
        {
          "line": 436,
          "old_api": "mp_init",
          "new_api": "mp_obj_list_init",
          "old_text": "mp_init()",
          "new_text": "mp_obj_list_init(mp_sys_path, 0)",
          "old_line_content": "    mp_init();",
          "new_line_content": "    mp_obj_list_init(mp_sys_path, 0);",
          "content_same": false
        },
        {
          "line": 437,
          "old_api": "mp_obj_list_init",
          "new_api": "MP_OBJ_NEW_QSTR",
          "old_text": "mp_obj_list_init(mp_sys_path, 0)",
          "new_text": "MP_OBJ_NEW_QSTR(MP_QSTR_)",
          "old_line_content": "    mp_obj_list_init(mp_sys_path, 0);",
          "new_line_content": "    mp_obj_list_append(mp_sys_path, MP_OBJ_NEW_QSTR(MP_QSTR_)); // current dir (or base dir of the script)",
          "content_same": false
        },
        {
          "line": 440,
          "old_api": "MP_OBJ_NEW_QSTR",
          "new_api": "mp_obj_list_init",
          "old_text": "MP_OBJ_NEW_QSTR(MP_QSTR__slash_flash_slash_lib)",
          "new_text": "mp_obj_list_init(mp_sys_argv, 0)",
          "old_line_content": "    mp_obj_list_append(mp_sys_path, MP_OBJ_NEW_QSTR(MP_QSTR__slash_flash_slash_lib));",
          "new_line_content": "    mp_obj_list_init(mp_sys_argv, 0);",
          "content_same": false
        },
        {
          "line": 451,
          "old_api": "readline_init0",
          "new_api": "pin_init0",
          "old_text": "readline_init0()",
          "new_text": "pin_init0()",
          "old_line_content": "    readline_init0();",
          "new_line_content": "    pin_init0();",
          "content_same": false
        },
        {
          "line": 452,
          "old_api": "pin_init0",
          "new_api": "extint_init0",
          "old_text": "pin_init0()",
          "new_text": "extint_init0()",
          "old_line_content": "    pin_init0();",
          "new_line_content": "    extint_init0();",
          "content_same": false
        },
        {
          "line": 453,
          "old_api": "extint_init0",
          "new_api": "timer_init0",
          "old_text": "extint_init0()",
          "new_text": "timer_init0()",
          "old_line_content": "    extint_init0();",
          "new_line_content": "    timer_init0();",
          "content_same": false
        },
        {
          "line": 454,
          "old_api": "timer_init0",
          "new_api": "uart_init0",
          "old_text": "timer_init0()",
          "new_text": "uart_init0()",
          "old_line_content": "    timer_init0();",
          "new_line_content": "    uart_init0();",
          "content_same": false
        },
        {
          "line": 480,
          "old_api": "i2c_init0",
          "new_api": "spi_init0",
          "old_text": "i2c_init0()",
          "new_text": "spi_init0()",
          "old_line_content": "    i2c_init0();",
          "new_line_content": "    spi_init0();",
          "content_same": false
        },
        {
          "line": 481,
          "old_api": "spi_init0",
          "new_api": "pyb_usb_init0",
          "old_text": "spi_init0()",
          "new_text": "pyb_usb_init0()",
          "old_line_content": "    spi_init0();",
          "new_line_content": "    pyb_usb_init0();",
          "content_same": false
        },
        {
          "line": 506,
          "old_api": "printf",
          "new_api": "MP_STATE_PORT",
          "old_text": "printf(\"PYB: can't mount SD card\\n\")",
          "new_text": "MP_STATE_PORT(fs_user_mount)",
          "old_line_content": "            printf(\"PYB: can't mount SD card\\n\");",
          "new_line_content": "            MP_STATE_PORT(fs_user_mount)[1] = NULL;",
          "content_same": false
        },
        {
          "line": 507,
          "old_api": "MP_STATE_PORT",
          "new_api": "m_del_obj",
          "old_text": "MP_STATE_PORT(fs_user_mount)",
          "new_text": "m_del_obj(fs_user_mount_t, vfs)",
          "old_line_content": "            MP_STATE_PORT(fs_user_mount)[1] = NULL;",
          "new_line_content": "            m_del_obj(fs_user_mount_t, vfs);",
          "content_same": false
        },
        {
          "line": 632,
          "old_api": "printf",
          "new_api": "storage_flush",
          "old_text": "printf(\"PYB: sync filesystems\\n\")",
          "new_text": "storage_flush()",
          "old_line_content": "    printf(\"PYB: sync filesystems\\n\");",
          "new_line_content": "    storage_flush();",
          "content_same": false
        },
        {
          "line": 635,
          "old_api": "printf",
          "new_api": "timer_deinit",
          "old_text": "printf(\"PYB: soft reboot\\n\")",
          "new_text": "timer_deinit()",
          "old_line_content": "    printf(\"PYB: soft reboot\\n\");",
          "new_line_content": "    timer_deinit();",
          "content_same": false
        },
        {
          "line": 636,
          "old_api": "timer_deinit",
          "new_api": "uart_deinit",
          "old_text": "timer_deinit()",
          "new_text": "uart_deinit()",
          "old_line_content": "    timer_deinit();",
          "new_line_content": "    uart_deinit();",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 526,
          "old_api": null,
          "new_api": "f_chdrive",
          "old_text": null,
          "new_text": "f_chdrive(\"/sd\")",
          "old_line_content": "                // use SD card as current directory",
          "new_line_content": "                f_chdrive(\"/sd\");",
          "content_same": false
        },
        {
          "line": 534,
          "old_api": null,
          "new_api": "MP_STATE_PORT",
          "old_text": null,
          "new_text": "MP_STATE_PORT(pyb_config_main)",
          "old_line_content": "    // reset config variables; they should be set by boot.py",
          "new_line_content": "    MP_STATE_PORT(pyb_config_main) = MP_OBJ_NULL;",
          "content_same": false
        },
        {
          "line": 540,
          "old_api": null,
          "new_api": "f_stat",
          "old_text": null,
          "new_text": "f_stat(boot_py, NULL)",
          "old_line_content": "        const char *boot_py = \"boot.py\";",
          "new_line_content": "        FRESULT res = f_stat(boot_py, NULL);",
          "content_same": false
        },
        {
          "line": 542,
          "old_api": null,
          "new_api": "pyexec_file",
          "old_text": null,
          "new_text": "pyexec_file(boot_py)",
          "old_line_content": "        if (res == FR_OK) {",
          "new_line_content": "            int ret = pyexec_file(boot_py);",
          "content_same": false
        },
        {
          "line": 547,
          "old_api": null,
          "new_api": "flash_error",
          "old_text": null,
          "new_text": "flash_error(4)",
          "old_line_content": "            if (!ret) {",
          "new_line_content": "                flash_error(4);",
          "content_same": false
        },
        {
          "line": 557,
          "old_api": null,
          "new_api": "led_state",
          "old_text": null,
          "new_text": "led_state(1, 0)",
          "old_line_content": "    // flash cache and so we shouldn't change its state.",
          "new_line_content": "    led_state(1, 0);",
          "content_same": false
        },
        {
          "line": 559,
          "old_api": null,
          "new_api": "led_state",
          "old_text": null,
          "new_text": "led_state(2, 0)",
          "old_line_content": "#endif",
          "new_line_content": "    led_state(2, 0);",
          "content_same": false
        },
        {
          "line": 570,
          "old_api": null,
          "new_api": "pyb_usb_dev_init",
          "old_text": null,
          "new_text": "pyb_usb_dev_init(USBD_VID, USBD_PID_CDC_MSC, USBD_MODE_CDC_MSC, NULL)",
          "old_line_content": "    if (!(pyb_usb_flags & PYB_USB_FLAG_USB_MODE_CALLED)) {",
          "new_line_content": "        pyb_usb_dev_init(USBD_VID, USBD_PID_CDC_MSC, USBD_MODE_CDC_MSC, NULL);",
          "content_same": false
        },
        {
          "line": 576,
          "old_api": null,
          "new_api": "accel_init",
          "old_text": null,
          "new_text": "accel_init()",
          "old_line_content": "    // MMA accel: init and reset",
          "new_line_content": "    accel_init();",
          "content_same": false
        },
        {
          "line": 581,
          "old_api": null,
          "new_api": "servo_init",
          "old_text": null,
          "new_text": "servo_init()",
          "old_line_content": "    // servo",
          "new_line_content": "    servo_init();",
          "content_same": false
        },
        {
          "line": 586,
          "old_api": null,
          "new_api": "dac_init",
          "old_text": null,
          "new_text": "dac_init()",
          "old_line_content": "    // DAC",
          "new_line_content": "    dac_init();",
          "content_same": false
        },
        {
          "line": 589,
          "old_api": null,
          "new_api": "mod_network_init",
          "old_text": null,
          "new_text": "mod_network_init()",
          "old_line_content": "",
          "new_line_content": "    mod_network_init();",
          "content_same": false
        },
        {
          "line": 596,
          "old_api": null,
          "new_api": "MP_STATE_PORT",
          "old_text": null,
          "new_text": "MP_STATE_PORT(pyb_config_main)",
          "old_line_content": "        const char *main_py;",
          "new_line_content": "        if (MP_STATE_PORT(pyb_config_main) == MP_OBJ_NULL) {",
          "content_same": false
        },
        {
          "line": 599,
          "old_api": null,
          "new_api": "MP_STATE_PORT",
          "old_text": null,
          "new_text": "MP_STATE_PORT(pyb_config_main)",
          "old_line_content": "        } else {",
          "new_line_content": "            main_py = mp_obj_str_get_str(MP_STATE_PORT(pyb_config_main));",
          "content_same": false
        },
        {
          "line": 601,
          "old_api": null,
          "new_api": "f_stat",
          "old_text": null,
          "new_text": "f_stat(main_py, NULL)",
          "old_line_content": "        }",
          "new_line_content": "        FRESULT res = f_stat(main_py, NULL);",
          "content_same": false
        },
        {
          "line": 603,
          "old_api": null,
          "new_api": "pyexec_file",
          "old_text": null,
          "new_text": "pyexec_file(main_py)",
          "old_line_content": "        if (res == FR_OK) {",
          "new_line_content": "            int ret = pyexec_file(main_py);",
          "content_same": false
        },
        {
          "line": 608,
          "old_api": null,
          "new_api": "flash_error",
          "old_text": null,
          "new_text": "flash_error(3)",
          "old_line_content": "            if (!ret) {",
          "new_line_content": "                flash_error(3);",
          "content_same": false
        },
        {
          "line": 617,
          "old_api": null,
          "new_api": "pyexec_raw_repl",
          "old_text": null,
          "new_text": "pyexec_raw_repl()",
          "old_line_content": "        if (pyexec_mode_kind == PYEXEC_MODE_RAW_REPL) {",
          "new_line_content": "            if (pyexec_raw_repl() != 0) {",
          "content_same": false
        },
        {
          "line": 621,
          "old_api": null,
          "new_api": "pyexec_friendly_repl",
          "old_text": null,
          "new_text": "pyexec_friendly_repl()",
          "old_line_content": "        } else {",
          "new_line_content": "            if (pyexec_friendly_repl() != 0) {",
          "content_same": false
        },
        {
          "line": 631,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\"PYB: sync filesystems\\n\")",
          "old_line_content": "",
          "new_line_content": "    printf(\"PYB: sync filesystems\\n\");",
          "content_same": false
        },
        {
          "line": 634,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\"PYB: soft reboot\\n\")",
          "old_line_content": "",
          "new_line_content": "    printf(\"PYB: soft reboot\\n\");",
          "content_same": false
        },
        {
          "line": 638,
          "old_api": null,
          "new_api": "can_deinit",
          "old_text": null,
          "new_text": "can_deinit()",
          "old_line_content": "#if MICROPY_HW_ENABLE_CAN",
          "new_line_content": "    can_deinit();",
          "content_same": false
        },
        {
          "line": 175,
          "old_api": null,
          "new_api": "pyb_flash_init_vfs",
          "old_text": null,
          "new_text": "pyb_flash_init_vfs(vfs)",
          "old_line_content": "    vfs->flags = 0;",
          "new_line_content": "    pyb_flash_init_vfs(vfs);",
          "content_same": false
        },
        {
          "line": 178,
          "old_api": null,
          "new_api": "MP_STATE_PORT",
          "old_text": null,
          "new_text": "MP_STATE_PORT(fs_user_mount)",
          "old_line_content": "    // put the flash device in slot 0 (it will be unused at this point)",
          "new_line_content": "    MP_STATE_PORT(fs_user_mount)[0] = vfs;",
          "content_same": false
        },
        {
          "line": 181,
          "old_api": null,
          "new_api": "f_mount",
          "old_text": null,
          "new_text": "f_mount(&vfs->fatfs, vfs->str, 1)",
          "old_line_content": "    // try to mount the flash",
          "new_line_content": "    FRESULT res = f_mount(&vfs->fatfs, vfs->str, 1);",
          "content_same": false
        },
        {
          "line": 187,
          "old_api": null,
          "new_api": "led_state",
          "old_text": null,
          "new_text": "led_state(PYB_LED_R2, 1)",
          "old_line_content": "        // LED on to indicate creation of LFS",
          "new_line_content": "        led_state(PYB_LED_R2, 1);",
          "content_same": false
        },
        {
          "line": 190,
          "old_api": null,
          "new_api": "f_mkfs",
          "old_text": null,
          "new_text": "f_mkfs(\"/flash\", 0, 0)",
          "old_line_content": "",
          "new_line_content": "        res = f_mkfs(\"/flash\", 0, 0);",
          "content_same": false
        },
        {
          "line": 194,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\"PYB: can't create flash filesystem\\n\")",
          "old_line_content": "        } else {",
          "new_line_content": "            printf(\"PYB: can't create flash filesystem\\n\");",
          "content_same": false
        },
        {
          "line": 200,
          "old_api": null,
          "new_api": "f_setlabel",
          "old_text": null,
          "new_text": "f_setlabel(\"/flash/pybflash\")",
          "old_line_content": "        // set label",
          "new_line_content": "        f_setlabel(\"/flash/pybflash\");",
          "content_same": false
        },
        {
          "line": 204,
          "old_api": null,
          "new_api": "f_open",
          "old_text": null,
          "new_text": "f_open(&fp, \"/flash/main.py\", FA_WRITE | FA_CREATE_ALWAYS)",
          "old_line_content": "        FIL fp;",
          "new_line_content": "        f_open(&fp, \"/flash/main.py\", FA_WRITE | FA_CREATE_ALWAYS);",
          "content_same": false
        },
        {
          "line": 206,
          "old_api": null,
          "new_api": "f_write",
          "old_text": null,
          "new_text": "f_write(&fp, fresh_main_py, sizeof(fresh_main_py) - 1 /* don't count null terminator */, &n)",
          "old_line_content": "        UINT n;",
          "new_line_content": "        f_write(&fp, fresh_main_py, sizeof(fresh_main_py) - 1 /* don't count null terminator */, &n);",
          "content_same": false
        },
        {
          "line": 208,
          "old_api": null,
          "new_api": "f_close",
          "old_text": null,
          "new_text": "f_close(&fp)",
          "old_line_content": "        // TODO check we could write n bytes",
          "new_line_content": "        f_close(&fp);",
          "content_same": false
        },
        {
          "line": 211,
          "old_api": null,
          "new_api": "f_open",
          "old_text": null,
          "new_text": "f_open(&fp, \"/flash/pybcdc.inf\", FA_WRITE | FA_CREATE_ALWAYS)",
          "old_line_content": "        // create .inf driver file",
          "new_line_content": "        f_open(&fp, \"/flash/pybcdc.inf\", FA_WRITE | FA_CREATE_ALWAYS);",
          "content_same": false
        },
        {
          "line": 216,
          "old_api": null,
          "new_api": "f_open",
          "old_text": null,
          "new_text": "f_open(&fp, \"/flash/README.txt\", FA_WRITE | FA_CREATE_ALWAYS)",
          "old_line_content": "        // create readme file",
          "new_line_content": "        f_open(&fp, \"/flash/README.txt\", FA_WRITE | FA_CREATE_ALWAYS);",
          "content_same": false
        },
        {
          "line": 221,
          "old_api": null,
          "new_api": "sys_tick_wait_at_least",
          "old_text": null,
          "new_text": "sys_tick_wait_at_least(start_tick, 200)",
          "old_line_content": "        // keep LED on for at least 200ms",
          "new_line_content": "        sys_tick_wait_at_least(start_tick, 200);",
          "content_same": false
        },
        {
          "line": 226,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\"PYB: can't mount flash\\n\")",
          "old_line_content": "    } else {",
          "new_line_content": "        printf(\"PYB: can't mount flash\\n\");",
          "content_same": false
        },
        {
          "line": 233,
          "old_api": null,
          "new_api": "f_chdrive",
          "old_text": null,
          "new_text": "f_chdrive(\"/flash\")",
          "old_line_content": "    // It is set to the internal flash filesystem by default.",
          "new_line_content": "    f_chdrive(\"/flash\");",
          "content_same": false
        },
        {
          "line": 241,
          "old_api": null,
          "new_api": "f_stat",
          "old_text": null,
          "new_text": "f_stat(\"/flash/boot.py\", &fno)",
          "old_line_content": "#endif",
          "new_line_content": "    res = f_stat(\"/flash/boot.py\", &fno);",
          "content_same": false
        },
        {
          "line": 254,
          "old_api": null,
          "new_api": "led_state",
          "old_text": null,
          "new_text": "led_state(PYB_LED_R2, 1)",
          "old_line_content": "        // LED on to indicate creation of boot.py",
          "new_line_content": "        led_state(PYB_LED_R2, 1);",
          "content_same": false
        },
        {
          "line": 258,
          "old_api": null,
          "new_api": "f_open",
          "old_text": null,
          "new_text": "f_open(&fp, \"/flash/boot.py\", FA_WRITE | FA_CREATE_ALWAYS)",
          "old_line_content": "        FIL fp;",
          "new_line_content": "        f_open(&fp, \"/flash/boot.py\", FA_WRITE | FA_CREATE_ALWAYS);",
          "content_same": false
        },
        {
          "line": 260,
          "old_api": null,
          "new_api": "f_write",
          "old_text": null,
          "new_text": "f_write(&fp, fresh_boot_py, sizeof(fresh_boot_py) - 1 /* don't count null terminator */, &n)",
          "old_line_content": "        UINT n;",
          "new_line_content": "        f_write(&fp, fresh_boot_py, sizeof(fresh_boot_py) - 1 /* don't count null terminator */, &n);",
          "content_same": false
        },
        {
          "line": 262,
          "old_api": null,
          "new_api": "f_close",
          "old_text": null,
          "new_text": "f_close(&fp)",
          "old_line_content": "        // TODO check we could write n bytes",
          "new_line_content": "        f_close(&fp);",
          "content_same": false
        },
        {
          "line": 265,
          "old_api": null,
          "new_api": "sys_tick_wait_at_least",
          "old_text": null,
          "new_text": "sys_tick_wait_at_least(start_tick, 200)",
          "old_line_content": "        // keep LED on for at least 200ms",
          "new_line_content": "        sys_tick_wait_at_least(start_tick, 200);",
          "content_same": false
        },
        {
          "line": 272,
          "old_api": null,
          "new_api": "switch_get",
          "old_text": null,
          "new_text": "switch_get()",
          "old_line_content": "#if MICROPY_HW_HAS_SWITCH",
          "new_line_content": "    if (switch_get()) {",
          "content_same": false
        },
        {
          "line": 278,
          "old_api": null,
          "new_api": "switch_get",
          "old_text": null,
          "new_text": "switch_get()",
          "old_line_content": "        for (uint i = 0; i < 3000; i++) {",
          "new_line_content": "            if (!switch_get()) {",
          "content_same": false
        },
        {
          "line": 281,
          "old_api": null,
          "new_api": "HAL_Delay",
          "old_text": null,
          "new_text": "HAL_Delay(20)",
          "old_line_content": "            }",
          "new_line_content": "            HAL_Delay(20);",
          "content_same": false
        },
        {
          "line": 286,
          "old_api": null,
          "new_api": "led_state",
          "old_text": null,
          "new_text": "led_state(2, reset_mode & 1)",
          "old_line_content": "                }",
          "new_line_content": "                led_state(2, reset_mode & 1);",
          "content_same": false
        },
        {
          "line": 293,
          "old_api": null,
          "new_api": "led_state",
          "old_text": null,
          "new_text": "led_state(2, 0)",
          "old_line_content": "        for (uint i = 0; i < 6; i++) {",
          "new_line_content": "            led_state(2, 0);",
          "content_same": false
        },
        {
          "line": 302,
          "old_api": null,
          "new_api": "HAL_Delay",
          "old_text": null,
          "new_text": "HAL_Delay(400)",
          "old_line_content": "        }",
          "new_line_content": "        HAL_Delay(400);",
          "content_same": false
        },
        {
          "line": 309,
          "old_api": null,
          "new_api": "led_state",
          "old_text": null,
          "new_text": "led_state(1, 0)",
          "old_line_content": "        for (uint i = 0; i < 10; i++) {",
          "new_line_content": "            led_state(1, 0);",
          "content_same": false
        },
        {
          "line": 311,
          "old_api": null,
          "new_api": "switch_get",
          "old_text": null,
          "new_text": "switch_get()",
          "old_line_content": "            for (uint j = 0; j < reset_mode; j++) {",
          "new_line_content": "                if (!switch_get()) {",
          "content_same": false
        },
        {
          "line": 314,
          "old_api": null,
          "new_api": "led_state",
          "old_text": null,
          "new_text": "led_state(1, 1)",
          "old_line_content": "                }",
          "new_line_content": "                led_state(1, 1);",
          "content_same": false
        },
        {
          "line": 319,
          "old_api": null,
          "new_api": "HAL_Delay",
          "old_text": null,
          "new_text": "HAL_Delay(400)",
          "old_line_content": "            }",
          "new_line_content": "            HAL_Delay(400);",
          "content_same": false
        },
        {
          "line": 330,
          "old_api": null,
          "new_api": "led_state",
          "old_text": null,
          "new_text": "led_state(1, 1)",
          "old_line_content": "            for (uint j = 0; j < reset_mode; j++) {",
          "new_line_content": "                led_state(1, 1);",
          "content_same": false
        },
        {
          "line": 335,
          "old_api": null,
          "new_api": "HAL_Delay",
          "old_text": null,
          "new_text": "HAL_Delay(400)",
          "old_line_content": "            }",
          "new_line_content": "            HAL_Delay(400);",
          "content_same": false
        },
        {
          "line": 350,
          "old_api": null,
          "new_api": "mp_stack_ctrl_init",
          "old_text": null,
          "new_text": "mp_stack_ctrl_init()",
          "old_line_content": "    // to recover from limit hit.  (Limit is measured in bytes.)",
          "new_line_content": "    mp_stack_ctrl_init();",
          "content_same": false
        },
        {
          "line": 359,
          "old_api": null,
          "new_api": "HAL_Init",
          "old_text": null,
          "new_text": "HAL_Init()",
          "old_line_content": "       */",
          "new_line_content": "    HAL_Init();",
          "content_same": false
        },
        {
          "line": 362,
          "old_api": null,
          "new_api": "SystemClock_Config",
          "old_text": null,
          "new_text": "SystemClock_Config()",
          "old_line_content": "    // set the system clock to be HSE",
          "new_line_content": "    SystemClock_Config();",
          "content_same": false
        },
        {
          "line": 365,
          "old_api": null,
          "new_api": "__GPIOA_CLK_ENABLE",
          "old_text": null,
          "new_text": "__GPIOA_CLK_ENABLE()",
          "old_line_content": "    // enable GPIO clocks",
          "new_line_content": "    __GPIOA_CLK_ENABLE();",
          "content_same": false
        },
        {
          "line": 374,
          "old_api": null,
          "new_api": "__HAL_RCC_DTCMRAMEN_CLK_ENABLE",
          "old_text": null,
          "new_text": "__HAL_RCC_DTCMRAMEN_CLK_ENABLE()",
          "old_line_content": "        // which behaves more or less like normal SRAM.",
          "new_line_content": "        __HAL_RCC_DTCMRAMEN_CLK_ENABLE();",
          "content_same": false
        },
        {
          "line": 377,
          "old_api": null,
          "new_api": "__CCMDATARAMEN_CLK_ENABLE",
          "old_text": null,
          "new_text": "__CCMDATARAMEN_CLK_ENABLE()",
          "old_line_content": "        // enable the CCM RAM",
          "new_line_content": "        __CCMDATARAMEN_CLK_ENABLE();",
          "content_same": false
        },
        {
          "line": 382,
          "old_api": null,
          "new_api": "MICROPY_BOARD_EARLY_INIT",
          "old_text": null,
          "new_text": "MICROPY_BOARD_EARLY_INIT()",
          "old_line_content": "    #if defined(MICROPY_BOARD_EARLY_INIT)",
          "new_line_content": "    MICROPY_BOARD_EARLY_INIT();",
          "content_same": false
        },
        {
          "line": 386,
          "old_api": null,
          "new_api": "pendsv_init",
          "old_text": null,
          "new_text": "pendsv_init()",
          "old_line_content": "    // basic sub-system init",
          "new_line_content": "    pendsv_init();",
          "content_same": false
        },
        {
          "line": 389,
          "old_api": null,
          "new_api": "switch_init0",
          "old_text": null,
          "new_text": "switch_init0()",
          "old_line_content": "#if MICROPY_HW_HAS_SWITCH",
          "new_line_content": "    switch_init0();",
          "content_same": false
        },
        {
          "line": 403,
          "old_api": null,
          "new_api": "led_state",
          "old_text": null,
          "new_text": "led_state(1, 0)",
          "old_line_content": "#if defined(MICROPY_HW_LED2)",
          "new_line_content": "    led_state(1, 0);",
          "content_same": false
        },
        {
          "line": 406,
          "old_api": null,
          "new_api": "led_state",
          "old_text": null,
          "new_text": "led_state(1, 1)",
          "old_line_content": "#else",
          "new_line_content": "    led_state(1, 1);",
          "content_same": false
        },
        {
          "line": 409,
          "old_api": null,
          "new_api": "led_state",
          "old_text": null,
          "new_text": "led_state(3, 0)",
          "old_line_content": "#endif",
          "new_line_content": "    led_state(3, 0);",
          "content_same": false
        },
        {
          "line": 413,
          "old_api": null,
          "new_api": "machine_init",
          "old_text": null,
          "new_text": "machine_init()",
          "old_line_content": "",
          "new_line_content": "    machine_init();",
          "content_same": false
        },
        {
          "line": 417,
          "old_api": null,
          "new_api": "rtc_init_start",
          "old_text": null,
          "new_text": "rtc_init_start(false)",
          "old_line_content": "    if (first_soft_reset) {",
          "new_line_content": "        rtc_init_start(false);",
          "content_same": false
        },
        {
          "line": 424,
          "old_api": null,
          "new_api": "sdcard_init",
          "old_text": null,
          "new_text": "sdcard_init()",
          "old_line_content": "    if (first_soft_reset) {",
          "new_line_content": "        sdcard_init();",
          "content_same": false
        },
        {
          "line": 428,
          "old_api": null,
          "new_api": "storage_init",
          "old_text": null,
          "new_text": "storage_init()",
          "old_line_content": "    if (first_soft_reset) {",
          "new_line_content": "        storage_init();",
          "content_same": false
        },
        {
          "line": 432,
          "old_api": null,
          "new_api": "gc_init",
          "old_text": null,
          "new_text": "gc_init(&_heap_start, &_heap_end)",
          "old_line_content": "    // GC init",
          "new_line_content": "    gc_init(&_heap_start, &_heap_end);",
          "content_same": false
        },
        {
          "line": 435,
          "old_api": null,
          "new_api": "mp_init",
          "old_text": null,
          "new_text": "mp_init()",
          "old_line_content": "    // Micro Python init",
          "new_line_content": "    mp_init();",
          "content_same": false
        },
        {
          "line": 443,
          "old_api": null,
          "new_api": "MP_STATE_PORT",
          "old_text": null,
          "new_text": "MP_STATE_PORT(fs_user_mount)",
          "old_line_content": "    // zero out the pointers to the mounted devices",
          "new_line_content": "    memset(MP_STATE_PORT(fs_user_mount), 0, sizeof(MP_STATE_PORT(fs_user_mount)));",
          "content_same": false
        },
        {
          "line": 450,
          "old_api": null,
          "new_api": "readline_init0",
          "old_text": null,
          "new_text": "readline_init0()",
          "old_line_content": "",
          "new_line_content": "    readline_init0();",
          "content_same": false
        },
        {
          "line": 462,
          "old_api": null,
          "new_api": "MP_OBJ_NEW_SMALL_INT",
          "old_text": null,
          "new_text": "MP_OBJ_NEW_SMALL_INT(MICROPY_HW_UART_REPL)",
          "old_line_content": "        mp_obj_t args[2] = {",
          "new_line_content": "            MP_OBJ_NEW_SMALL_INT(MICROPY_HW_UART_REPL),",
          "content_same": false
        },
        {
          "line": 465,
          "old_api": null,
          "new_api": "MP_ARRAY_SIZE",
          "old_text": null,
          "new_text": "MP_ARRAY_SIZE(args)",
          "old_line_content": "        };",
          "new_line_content": "        MP_STATE_PORT(pyb_stdio_uart) = pyb_uart_type.make_new((mp_obj_t)&pyb_uart_type, MP_ARRAY_SIZE(args), 0, args);",
          "content_same": false
        },
        {
          "line": 468,
          "old_api": null,
          "new_api": "MP_STATE_PORT",
          "old_text": null,
          "new_text": "MP_STATE_PORT(pyb_stdio_uart)",
          "old_line_content": "#else",
          "new_line_content": "    MP_STATE_PORT(pyb_stdio_uart) = NULL;",
          "content_same": false
        },
        {
          "line": 472,
          "old_api": null,
          "new_api": "can_init0",
          "old_text": null,
          "new_text": "can_init0()",
          "old_line_content": "#if MICROPY_HW_ENABLE_CAN",
          "new_line_content": "    can_init0();",
          "content_same": false
        },
        {
          "line": 476,
          "old_api": null,
          "new_api": "rng_init0",
          "old_text": null,
          "new_text": "rng_init0()",
          "old_line_content": "#if MICROPY_HW_ENABLE_RNG",
          "new_line_content": "    rng_init0();",
          "content_same": false
        },
        {
          "line": 479,
          "old_api": null,
          "new_api": "i2c_init0",
          "old_text": null,
          "new_text": "i2c_init0()",
          "old_line_content": "",
          "new_line_content": "    i2c_init0();",
          "content_same": false
        },
        {
          "line": 485,
          "old_api": null,
          "new_api": "init_flash_fs",
          "old_text": null,
          "new_text": "init_flash_fs(reset_mode)",
          "old_line_content": "    // Create it if needed, mount in on /flash, and set it as current dir.",
          "new_line_content": "    init_flash_fs(reset_mode);",
          "content_same": false
        },
        {
          "line": 489,
          "old_api": null,
          "new_api": "sdcard_is_present",
          "old_text": null,
          "new_text": "sdcard_is_present()",
          "old_line_content": "    // if an SD card is present then mount it on /sd/",
          "new_line_content": "    if (sdcard_is_present()) {",
          "content_same": false
        },
        {
          "line": 491,
          "old_api": null,
          "new_api": "m_new_obj_maybe",
          "old_text": null,
          "new_text": "m_new_obj_maybe(fs_user_mount_t)",
          "old_line_content": "        // create vfs object",
          "new_line_content": "        fs_user_mount_t *vfs = m_new_obj_maybe(fs_user_mount_t);",
          "content_same": false
        },
        {
          "line": 498,
          "old_api": null,
          "new_api": "sdcard_init_vfs",
          "old_text": null,
          "new_text": "sdcard_init_vfs(vfs)",
          "old_line_content": "        vfs->flags = FSUSER_FREE_OBJ;",
          "new_line_content": "        sdcard_init_vfs(vfs);",
          "content_same": false
        },
        {
          "line": 501,
          "old_api": null,
          "new_api": "MP_STATE_PORT",
          "old_text": null,
          "new_text": "MP_STATE_PORT(fs_user_mount)",
          "old_line_content": "        // put the sd device in slot 1 (it will be unused at this point)",
          "new_line_content": "        MP_STATE_PORT(fs_user_mount)[1] = vfs;",
          "content_same": false
        },
        {
          "line": 503,
          "old_api": null,
          "new_api": "f_mount",
          "old_text": null,
          "new_text": "f_mount(&vfs->fatfs, vfs->str, 1)",
          "old_line_content": "",
          "new_line_content": "        FRESULT res = f_mount(&vfs->fatfs, vfs->str, 1);",
          "content_same": false
        },
        {
          "line": 505,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\"PYB: can't mount SD card\\n\")",
          "old_line_content": "        if (res != FR_OK) {",
          "new_line_content": "            printf(\"PYB: can't mount SD card\\n\");",
          "content_same": false
        },
        {
          "line": 510,
          "old_api": null,
          "new_api": "MP_OBJ_NEW_QSTR",
          "old_text": null,
          "new_text": "MP_OBJ_NEW_QSTR(MP_QSTR__slash_sd)",
          "old_line_content": "            // TODO these should go before the /flash entries in the path",
          "new_line_content": "            mp_obj_list_append(mp_sys_path, MP_OBJ_NEW_QSTR(MP_QSTR__slash_sd));",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 512,
          "old_api": "MP_OBJ_NEW_QSTR",
          "new_api": null,
          "old_text": "MP_OBJ_NEW_QSTR(MP_QSTR__slash_sd_slash_lib)",
          "new_text": null,
          "old_line_content": "            mp_obj_list_append(mp_sys_path, MP_OBJ_NEW_QSTR(MP_QSTR__slash_sd_slash_lib));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 527,
          "old_api": "f_chdrive",
          "new_api": null,
          "old_text": "f_chdrive(\"/sd\")",
          "new_text": null,
          "old_line_content": "                f_chdrive(\"/sd\");",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 535,
          "old_api": "MP_STATE_PORT",
          "new_api": null,
          "old_text": "MP_STATE_PORT(pyb_config_main)",
          "new_text": null,
          "old_line_content": "    MP_STATE_PORT(pyb_config_main) = MP_OBJ_NULL;",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 541,
          "old_api": "f_stat",
          "new_api": null,
          "old_text": "f_stat(boot_py, NULL)",
          "new_text": null,
          "old_line_content": "        FRESULT res = f_stat(boot_py, NULL);",
          "new_line_content": "        if (res == FR_OK) {",
          "content_same": false
        },
        {
          "line": 543,
          "old_api": "pyexec_file",
          "new_api": null,
          "old_text": "pyexec_file(boot_py)",
          "new_text": null,
          "old_line_content": "            int ret = pyexec_file(boot_py);",
          "new_line_content": "            if (ret & PYEXEC_FORCED_EXIT) {",
          "content_same": false
        },
        {
          "line": 548,
          "old_api": "flash_error",
          "new_api": null,
          "old_text": "flash_error(4)",
          "new_text": null,
          "old_line_content": "                flash_error(4);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 558,
          "old_api": "led_state",
          "new_api": null,
          "old_text": "led_state(1, 0)",
          "new_text": null,
          "old_line_content": "    led_state(1, 0);",
          "new_line_content": "#endif",
          "content_same": false
        },
        {
          "line": 562,
          "old_api": "led_state",
          "new_api": null,
          "old_text": "led_state(4, 0)",
          "new_text": null,
          "old_line_content": "    led_state(4, 0);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 571,
          "old_api": "pyb_usb_dev_init",
          "new_api": null,
          "old_text": "pyb_usb_dev_init(USBD_VID, USBD_PID_CDC_MSC, USBD_MODE_CDC_MSC, NULL)",
          "new_text": null,
          "old_line_content": "        pyb_usb_dev_init(USBD_VID, USBD_PID_CDC_MSC, USBD_MODE_CDC_MSC, NULL);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 577,
          "old_api": "accel_init",
          "new_api": null,
          "old_text": "accel_init()",
          "new_text": null,
          "old_line_content": "    accel_init();",
          "new_line_content": "#endif",
          "content_same": false
        },
        {
          "line": 582,
          "old_api": "servo_init",
          "new_api": null,
          "old_text": "servo_init()",
          "new_text": null,
          "old_line_content": "    servo_init();",
          "new_line_content": "#endif",
          "content_same": false
        },
        {
          "line": 587,
          "old_api": "dac_init",
          "new_api": null,
          "old_text": "dac_init()",
          "new_text": null,
          "old_line_content": "    dac_init();",
          "new_line_content": "#endif",
          "content_same": false
        },
        {
          "line": 590,
          "old_api": "mod_network_init",
          "new_api": null,
          "old_text": "mod_network_init()",
          "new_text": null,
          "old_line_content": "    mod_network_init();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 597,
          "old_api": "MP_STATE_PORT",
          "new_api": null,
          "old_text": "MP_STATE_PORT(pyb_config_main)",
          "new_text": null,
          "old_line_content": "        if (MP_STATE_PORT(pyb_config_main) == MP_OBJ_NULL) {",
          "new_line_content": "            main_py = \"main.py\";",
          "content_same": false
        },
        {
          "line": 600,
          "old_api": "MP_STATE_PORT",
          "new_api": null,
          "old_text": "MP_STATE_PORT(pyb_config_main)",
          "new_text": null,
          "old_line_content": "            main_py = mp_obj_str_get_str(MP_STATE_PORT(pyb_config_main));",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 602,
          "old_api": "f_stat",
          "new_api": null,
          "old_text": "f_stat(main_py, NULL)",
          "new_text": null,
          "old_line_content": "        FRESULT res = f_stat(main_py, NULL);",
          "new_line_content": "        if (res == FR_OK) {",
          "content_same": false
        },
        {
          "line": 604,
          "old_api": "pyexec_file",
          "new_api": null,
          "old_text": "pyexec_file(main_py)",
          "new_text": null,
          "old_line_content": "            int ret = pyexec_file(main_py);",
          "new_line_content": "            if (ret & PYEXEC_FORCED_EXIT) {",
          "content_same": false
        },
        {
          "line": 609,
          "old_api": "flash_error",
          "new_api": null,
          "old_text": "flash_error(3)",
          "new_text": null,
          "old_line_content": "                flash_error(3);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 618,
          "old_api": "pyexec_raw_repl",
          "new_api": null,
          "old_text": "pyexec_raw_repl()",
          "new_text": null,
          "old_line_content": "            if (pyexec_raw_repl() != 0) {",
          "new_line_content": "                break;",
          "content_same": false
        },
        {
          "line": 622,
          "old_api": "pyexec_friendly_repl",
          "new_api": null,
          "old_text": "pyexec_friendly_repl()",
          "new_text": null,
          "old_line_content": "            if (pyexec_friendly_repl() != 0) {",
          "new_line_content": "                break;",
          "content_same": false
        },
        {
          "line": 633,
          "old_api": "storage_flush",
          "new_api": null,
          "old_text": "storage_flush()",
          "new_text": null,
          "old_line_content": "    storage_flush();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 637,
          "old_api": "uart_deinit",
          "new_api": null,
          "old_text": "uart_deinit()",
          "new_text": null,
          "old_line_content": "    uart_deinit();",
          "new_line_content": "#if MICROPY_HW_ENABLE_CAN",
          "content_same": false
        },
        {
          "line": 639,
          "old_api": "can_deinit",
          "new_api": null,
          "old_text": "can_deinit()",
          "new_text": null,
          "old_line_content": "    can_deinit();",
          "new_line_content": "#endif",
          "content_same": false
        },
        {
          "line": 176,
          "old_api": "pyb_flash_init_vfs",
          "new_api": null,
          "old_text": "pyb_flash_init_vfs(vfs)",
          "new_text": null,
          "old_line_content": "    pyb_flash_init_vfs(vfs);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 179,
          "old_api": "MP_STATE_PORT",
          "new_api": null,
          "old_text": "MP_STATE_PORT(fs_user_mount)",
          "new_text": null,
          "old_line_content": "    MP_STATE_PORT(fs_user_mount)[0] = vfs;",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 182,
          "old_api": "f_mount",
          "new_api": null,
          "old_text": "f_mount(&vfs->fatfs, vfs->str, 1)",
          "new_text": null,
          "old_line_content": "    FRESULT res = f_mount(&vfs->fatfs, vfs->str, 1);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 189,
          "old_api": "HAL_GetTick",
          "new_api": null,
          "old_text": "HAL_GetTick()",
          "new_text": null,
          "old_line_content": "        uint32_t start_tick = HAL_GetTick();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 191,
          "old_api": "f_mkfs",
          "new_api": null,
          "old_text": "f_mkfs(\"/flash\", 0, 0)",
          "new_text": null,
          "old_line_content": "        res = f_mkfs(\"/flash\", 0, 0);",
          "new_line_content": "        if (res == FR_OK) {",
          "content_same": false
        },
        {
          "line": 196,
          "old_api": "MP_STATE_PORT",
          "new_api": null,
          "old_text": "MP_STATE_PORT(fs_user_mount)",
          "new_text": null,
          "old_line_content": "            MP_STATE_PORT(fs_user_mount)[0] = NULL;",
          "new_line_content": "            return;",
          "content_same": false
        },
        {
          "line": 201,
          "old_api": "f_setlabel",
          "new_api": null,
          "old_text": "f_setlabel(\"/flash/pybflash\")",
          "new_text": null,
          "old_line_content": "        f_setlabel(\"/flash/pybflash\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 205,
          "old_api": "f_open",
          "new_api": null,
          "old_text": "f_open(&fp, \"/flash/main.py\", FA_WRITE | FA_CREATE_ALWAYS)",
          "new_text": null,
          "old_line_content": "        f_open(&fp, \"/flash/main.py\", FA_WRITE | FA_CREATE_ALWAYS);",
          "new_line_content": "        UINT n;",
          "content_same": false
        },
        {
          "line": 207,
          "old_api": "f_write",
          "new_api": null,
          "old_text": "f_write(&fp, fresh_main_py, sizeof(fresh_main_py) - 1 /* don't count null terminator */, &n)",
          "new_text": null,
          "old_line_content": "        f_write(&fp, fresh_main_py, sizeof(fresh_main_py) - 1 /* don't count null terminator */, &n);",
          "new_line_content": "        // TODO check we could write n bytes",
          "content_same": false
        },
        {
          "line": 209,
          "old_api": "f_close",
          "new_api": null,
          "old_text": "f_close(&fp)",
          "new_text": null,
          "old_line_content": "        f_close(&fp);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 214,
          "old_api": "f_close",
          "new_api": null,
          "old_text": "f_close(&fp)",
          "new_text": null,
          "old_line_content": "        f_close(&fp);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 219,
          "old_api": "f_close",
          "new_api": null,
          "old_text": "f_close(&fp)",
          "new_text": null,
          "old_line_content": "        f_close(&fp);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 223,
          "old_api": "led_state",
          "new_api": null,
          "old_text": "led_state(PYB_LED_R2, 0)",
          "new_text": null,
          "old_line_content": "        led_state(PYB_LED_R2, 0);",
          "new_line_content": "    } else if (res == FR_OK) {",
          "content_same": false
        },
        {
          "line": 228,
          "old_api": "MP_STATE_PORT",
          "new_api": null,
          "old_text": "MP_STATE_PORT(fs_user_mount)",
          "new_text": null,
          "old_line_content": "        MP_STATE_PORT(fs_user_mount)[0] = NULL;",
          "new_line_content": "        return;",
          "content_same": false
        },
        {
          "line": 234,
          "old_api": "f_chdrive",
          "new_api": null,
          "old_text": "f_chdrive(\"/flash\")",
          "new_text": null,
          "old_line_content": "    f_chdrive(\"/flash\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 242,
          "old_api": "f_stat",
          "new_api": null,
          "old_text": "f_stat(\"/flash/boot.py\", &fno)",
          "new_text": null,
          "old_line_content": "    res = f_stat(\"/flash/boot.py\", &fno);",
          "new_line_content": "    if (res == FR_OK) {",
          "content_same": false
        },
        {
          "line": 256,
          "old_api": "HAL_GetTick",
          "new_api": null,
          "old_text": "HAL_GetTick()",
          "new_text": null,
          "old_line_content": "        uint32_t start_tick = HAL_GetTick();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 259,
          "old_api": "f_open",
          "new_api": null,
          "old_text": "f_open(&fp, \"/flash/boot.py\", FA_WRITE | FA_CREATE_ALWAYS)",
          "new_text": null,
          "old_line_content": "        f_open(&fp, \"/flash/boot.py\", FA_WRITE | FA_CREATE_ALWAYS);",
          "new_line_content": "        UINT n;",
          "content_same": false
        },
        {
          "line": 261,
          "old_api": "f_write",
          "new_api": null,
          "old_text": "f_write(&fp, fresh_boot_py, sizeof(fresh_boot_py) - 1 /* don't count null terminator */, &n)",
          "new_text": null,
          "old_line_content": "        f_write(&fp, fresh_boot_py, sizeof(fresh_boot_py) - 1 /* don't count null terminator */, &n);",
          "new_line_content": "        // TODO check we could write n bytes",
          "content_same": false
        },
        {
          "line": 263,
          "old_api": "f_close",
          "new_api": null,
          "old_text": "f_close(&fp)",
          "new_text": null,
          "old_line_content": "        f_close(&fp);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 267,
          "old_api": "led_state",
          "new_api": null,
          "old_text": "led_state(PYB_LED_R2, 0)",
          "new_text": null,
          "old_line_content": "        led_state(PYB_LED_R2, 0);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 273,
          "old_api": "switch_get",
          "new_api": null,
          "old_text": "switch_get()",
          "new_text": null,
          "old_line_content": "    if (switch_get()) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 279,
          "old_api": "switch_get",
          "new_api": null,
          "old_text": "switch_get()",
          "new_text": null,
          "old_line_content": "            if (!switch_get()) {",
          "new_line_content": "                break;",
          "content_same": false
        },
        {
          "line": 282,
          "old_api": "HAL_Delay",
          "new_api": null,
          "old_text": "HAL_Delay(20)",
          "new_text": null,
          "old_line_content": "            HAL_Delay(20);",
          "new_line_content": "            if (i % 30 == 29) {",
          "content_same": false
        },
        {
          "line": 289,
          "old_api": "led_state",
          "new_api": null,
          "old_text": "led_state(4, reset_mode & 4)",
          "new_text": null,
          "old_line_content": "                led_state(4, reset_mode & 4);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 301,
          "old_api": "HAL_Delay",
          "new_api": null,
          "old_text": "HAL_Delay(50)",
          "new_text": null,
          "old_line_content": "            HAL_Delay(50);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 303,
          "old_api": "HAL_Delay",
          "new_api": null,
          "old_text": "HAL_Delay(400)",
          "new_text": null,
          "old_line_content": "        HAL_Delay(400);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 310,
          "old_api": "led_state",
          "new_api": null,
          "old_text": "led_state(1, 0)",
          "new_text": null,
          "old_line_content": "            led_state(1, 0);",
          "new_line_content": "            for (uint j = 0; j < reset_mode; j++) {",
          "content_same": false
        },
        {
          "line": 312,
          "old_api": "switch_get",
          "new_api": null,
          "old_text": "switch_get()",
          "new_text": null,
          "old_line_content": "                if (!switch_get()) {",
          "new_line_content": "                    break;",
          "content_same": false
        },
        {
          "line": 318,
          "old_api": "HAL_Delay",
          "new_api": null,
          "old_text": "HAL_Delay(200)",
          "new_text": null,
          "old_line_content": "                HAL_Delay(200);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 321,
          "old_api": "switch_get",
          "new_api": null,
          "old_text": "switch_get()",
          "new_text": null,
          "old_line_content": "            if (!switch_get()) {",
          "new_line_content": "                break;",
          "content_same": false
        },
        {
          "line": 334,
          "old_api": "HAL_Delay",
          "new_api": null,
          "old_text": "HAL_Delay(200)",
          "new_text": null,
          "old_line_content": "                HAL_Delay(200);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 336,
          "old_api": "HAL_Delay",
          "new_api": null,
          "old_text": "HAL_Delay(400)",
          "new_text": null,
          "old_line_content": "            HAL_Delay(400);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 352,
          "old_api": "mp_stack_set_limit",
          "new_api": null,
          "old_text": "mp_stack_set_limit((char*)&_ram_end - (char*)&_heap_end - 1024)",
          "new_text": null,
          "old_line_content": "    mp_stack_set_limit((char*)&_ram_end - (char*)&_heap_end - 1024);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 360,
          "old_api": "HAL_Init",
          "new_api": null,
          "old_text": "HAL_Init()",
          "new_text": null,
          "old_line_content": "    HAL_Init();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 363,
          "old_api": "SystemClock_Config",
          "new_api": null,
          "old_text": "SystemClock_Config()",
          "new_text": null,
          "old_line_content": "    SystemClock_Config();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 369,
          "old_api": "__GPIOD_CLK_ENABLE",
          "new_api": null,
          "old_text": "__GPIOD_CLK_ENABLE()",
          "new_text": null,
          "old_line_content": "    __GPIOD_CLK_ENABLE();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 375,
          "old_api": "__HAL_RCC_DTCMRAMEN_CLK_ENABLE",
          "new_api": null,
          "old_text": "__HAL_RCC_DTCMRAMEN_CLK_ENABLE()",
          "new_text": null,
          "old_line_content": "        __HAL_RCC_DTCMRAMEN_CLK_ENABLE();",
          "new_line_content": "        #else",
          "content_same": false
        },
        {
          "line": 378,
          "old_api": "__CCMDATARAMEN_CLK_ENABLE",
          "new_api": null,
          "old_text": "__CCMDATARAMEN_CLK_ENABLE()",
          "new_text": null,
          "old_line_content": "        __CCMDATARAMEN_CLK_ENABLE();",
          "new_line_content": "        #endif",
          "content_same": false
        },
        {
          "line": 383,
          "old_api": "MICROPY_BOARD_EARLY_INIT",
          "new_api": null,
          "old_text": "MICROPY_BOARD_EARLY_INIT()",
          "new_text": null,
          "old_line_content": "    MICROPY_BOARD_EARLY_INIT();",
          "new_line_content": "    #endif",
          "content_same": false
        },
        {
          "line": 388,
          "old_api": "led_init",
          "new_api": null,
          "old_text": "led_init()",
          "new_text": null,
          "old_line_content": "    led_init();",
          "new_line_content": "#if MICROPY_HW_HAS_SWITCH",
          "content_same": false
        },
        {
          "line": 390,
          "old_api": "switch_init0",
          "new_api": null,
          "old_text": "switch_init0()",
          "new_text": null,
          "old_line_content": "    switch_init0();",
          "new_line_content": "#endif",
          "content_same": false
        },
        {
          "line": 405,
          "old_api": "led_state",
          "new_api": null,
          "old_text": "led_state(2, 1)",
          "new_text": null,
          "old_line_content": "    led_state(2, 1);",
          "new_line_content": "#else",
          "content_same": false
        },
        {
          "line": 408,
          "old_api": "led_state",
          "new_api": null,
          "old_text": "led_state(2, 0)",
          "new_text": null,
          "old_line_content": "    led_state(2, 0);",
          "new_line_content": "#endif",
          "content_same": false
        },
        {
          "line": 412,
          "old_api": "update_reset_mode",
          "new_api": null,
          "old_text": "update_reset_mode(1)",
          "new_text": null,
          "old_line_content": "    uint reset_mode = update_reset_mode(1);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 414,
          "old_api": "machine_init",
          "new_api": null,
          "old_text": "machine_init()",
          "new_text": null,
          "old_line_content": "    machine_init();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 418,
          "old_api": "rtc_init_start",
          "new_api": null,
          "old_text": "rtc_init_start(false)",
          "new_text": null,
          "old_line_content": "        rtc_init_start(false);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 425,
          "old_api": "sdcard_init",
          "new_api": null,
          "old_text": "sdcard_init()",
          "new_text": null,
          "old_line_content": "        sdcard_init();",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 429,
          "old_api": "storage_init",
          "new_api": null,
          "old_text": "storage_init()",
          "new_text": null,
          "old_line_content": "        storage_init();",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 433,
          "old_api": "gc_init",
          "new_api": null,
          "old_text": "gc_init(&_heap_start, &_heap_end)",
          "new_text": null,
          "old_line_content": "    gc_init(&_heap_start, &_heap_end);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 441,
          "old_api": "mp_obj_list_init",
          "new_api": null,
          "old_text": "mp_obj_list_init(mp_sys_argv, 0)",
          "new_text": null,
          "old_line_content": "    mp_obj_list_init(mp_sys_argv, 0);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 444,
          "old_api": "MP_STATE_PORT",
          "new_api": null,
          "old_text": "MP_STATE_PORT(fs_user_mount)",
          "new_text": null,
          "old_line_content": "    memset(MP_STATE_PORT(fs_user_mount), 0, sizeof(MP_STATE_PORT(fs_user_mount)));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 455,
          "old_api": "uart_init0",
          "new_api": null,
          "old_text": "uart_init0()",
          "new_text": null,
          "old_line_content": "    uart_init0();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 464,
          "old_api": "MP_OBJ_NEW_SMALL_INT",
          "new_api": null,
          "old_text": "MP_OBJ_NEW_SMALL_INT(MICROPY_HW_UART_REPL_BAUD)",
          "new_text": null,
          "old_line_content": "            MP_OBJ_NEW_SMALL_INT(MICROPY_HW_UART_REPL_BAUD),",
          "new_line_content": "        };",
          "content_same": false
        },
        {
          "line": 466,
          "old_api": "MP_ARRAY_SIZE",
          "new_api": null,
          "old_text": "MP_ARRAY_SIZE(args)",
          "new_text": null,
          "old_line_content": "        MP_STATE_PORT(pyb_stdio_uart) = pyb_uart_type.make_new((mp_obj_t)&pyb_uart_type, MP_ARRAY_SIZE(args), 0, args);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 469,
          "old_api": "MP_STATE_PORT",
          "new_api": null,
          "old_text": "MP_STATE_PORT(pyb_stdio_uart)",
          "new_text": null,
          "old_line_content": "    MP_STATE_PORT(pyb_stdio_uart) = NULL;",
          "new_line_content": "#endif",
          "content_same": false
        },
        {
          "line": 473,
          "old_api": "can_init0",
          "new_api": null,
          "old_text": "can_init0()",
          "new_text": null,
          "old_line_content": "    can_init0();",
          "new_line_content": "#endif",
          "content_same": false
        },
        {
          "line": 477,
          "old_api": "rng_init0",
          "new_api": null,
          "old_text": "rng_init0()",
          "new_text": null,
          "old_line_content": "    rng_init0();",
          "new_line_content": "#endif",
          "content_same": false
        },
        {
          "line": 482,
          "old_api": "pyb_usb_init0",
          "new_api": null,
          "old_text": "pyb_usb_init0()",
          "new_text": null,
          "old_line_content": "    pyb_usb_init0();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 486,
          "old_api": "init_flash_fs",
          "new_api": null,
          "old_text": "init_flash_fs(reset_mode)",
          "new_text": null,
          "old_line_content": "    init_flash_fs(reset_mode);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 490,
          "old_api": "sdcard_is_present",
          "new_api": null,
          "old_text": "sdcard_is_present()",
          "new_text": null,
          "old_line_content": "    if (sdcard_is_present()) {",
          "new_line_content": "        // create vfs object",
          "content_same": false
        },
        {
          "line": 492,
          "old_api": "m_new_obj_maybe",
          "new_api": null,
          "old_text": "m_new_obj_maybe(fs_user_mount_t)",
          "new_text": null,
          "old_line_content": "        fs_user_mount_t *vfs = m_new_obj_maybe(fs_user_mount_t);",
          "new_line_content": "        if (vfs == NULL) {",
          "content_same": false
        },
        {
          "line": 499,
          "old_api": "sdcard_init_vfs",
          "new_api": null,
          "old_text": "sdcard_init_vfs(vfs)",
          "new_text": null,
          "old_line_content": "        sdcard_init_vfs(vfs);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 502,
          "old_api": "MP_STATE_PORT",
          "new_api": null,
          "old_text": "MP_STATE_PORT(fs_user_mount)",
          "new_text": null,
          "old_line_content": "        MP_STATE_PORT(fs_user_mount)[1] = vfs;",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 504,
          "old_api": "f_mount",
          "new_api": null,
          "old_text": "f_mount(&vfs->fatfs, vfs->str, 1)",
          "new_text": null,
          "old_line_content": "        FRESULT res = f_mount(&vfs->fatfs, vfs->str, 1);",
          "new_line_content": "        if (res != FR_OK) {",
          "content_same": false
        },
        {
          "line": 508,
          "old_api": "m_del_obj",
          "new_api": null,
          "old_text": "m_del_obj(fs_user_mount_t, vfs)",
          "new_text": null,
          "old_line_content": "            m_del_obj(fs_user_mount_t, vfs);",
          "new_line_content": "        } else {",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 40,
      "total_additions": 89,
      "total_deletions": 89,
      "total_api_changes": 218
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 3,
        "api_related_lines": 218,
        "non_api_lines": 3,
        "non_api_line_numbers": [
          168,
          169,
          170
        ]
      }
    },
    "api_calls_before": 182,
    "api_calls_after": 182,
    "diff_info": {
      "added_lines": 2,
      "removed_lines": 3,
      "total_diff_lines": 17
    }
  }
}