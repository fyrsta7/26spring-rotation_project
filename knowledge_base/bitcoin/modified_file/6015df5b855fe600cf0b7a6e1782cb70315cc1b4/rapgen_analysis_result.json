{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/bitcoin/modified_file/6015df5b855fe600cf0b7a6e1782cb70315cc1b4",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/bitcoin/modified_file/6015df5b855fe600cf0b7a6e1782cb70315cc1b4/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/bitcoin/modified_file/6015df5b855fe600cf0b7a6e1782cb70315cc1b4/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/bitcoin/modified_file/6015df5b855fe600cf0b7a6e1782cb70315cc1b4/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 72,
          "old_api": "SerializeHash",
          "new_api": "HasWitness",
          "old_text": "SerializeHash(*this, SER_GETHASH, 0)",
          "new_text": "HasWitness()",
          "old_line_content": "    return SerializeHash(*this, SER_GETHASH, 0);",
          "new_line_content": "    if (!HasWitness()) {",
          "content_same": false
        },
        {
          "line": 86,
          "old_api": "MoneyRange",
          "new_api": "end",
          "old_text": "MoneyRange(nValueOut)",
          "new_text": "vout.end()",
          "old_line_content": "        if (!MoneyRange(it->nValue) || !MoneyRange(nValueOut))",
          "new_line_content": "    for (std::vector<CTxOut>::const_iterator it(vout.begin()); it != vout.end(); ++it)",
          "content_same": false
        },
        {
          "line": 111,
          "old_api": "size",
          "new_api": "GetTransactionWeight",
          "old_text": "it->scriptSig.size()",
          "new_text": "GetTransactionWeight(*this)",
          "old_line_content": "        unsigned int offset = 41U + std::min(110U, (unsigned int)it->scriptSig.size());",
          "new_line_content": "        nTxSize = (GetTransactionWeight(*this) + WITNESS_SCALE_FACTOR - 1) / WITNESS_SCALE_FACTOR;",
          "content_same": false
        },
        {
          "line": 129,
          "old_api": "size",
          "new_api": "ToString",
          "old_text": "vin.size()",
          "new_text": "strprintf(\"CTransaction(hash=%s, ver=%d, vin.size=%u, vout.size=%u, nLockTime=%u)\\n\",\n        GetHash().ToString().substr(0,10),\n        nVersion,\n        vin.size(),\n        vout.size(),\n        nLockTime)",
          "old_line_content": "        vin.size(),",
          "new_line_content": "    str += strprintf(\"CTransaction(hash=%s, ver=%d, vin.size=%u, vout.size=%u, nLockTime=%u)\\n\",",
          "content_same": false
        },
        {
          "line": 130,
          "old_api": "size",
          "new_api": "ToString",
          "old_text": "vout.size()",
          "new_text": "GetHash().ToString().substr(0,10)",
          "old_line_content": "        vout.size(),",
          "new_line_content": "        GetHash().ToString().substr(0,10),",
          "content_same": false
        },
        {
          "line": 133,
          "old_api": "ToString",
          "new_api": "size",
          "old_text": "vin[i].ToString()",
          "new_text": "vout.size()",
          "old_line_content": "        str += \"    \" + vin[i].ToString() + \"\\n\";",
          "new_line_content": "        vout.size(),",
          "content_same": false
        },
        {
          "line": 135,
          "old_api": "ToString",
          "new_api": "size",
          "old_text": "vin[i].scriptWitness.ToString()",
          "new_text": "vin.size()",
          "old_line_content": "        str += \"    \" + vin[i].scriptWitness.ToString() + \"\\n\";",
          "new_line_content": "    for (unsigned int i = 0; i < vin.size(); i++)",
          "content_same": false
        },
        {
          "line": 136,
          "old_api": "size",
          "new_api": "ToString",
          "old_text": "vout.size()",
          "new_text": "vin[i].ToString()",
          "old_line_content": "    for (unsigned int i = 0; i < vout.size(); i++)",
          "new_line_content": "        str += \"    \" + vin[i].ToString() + \"\\n\";",
          "content_same": false
        },
        {
          "line": 137,
          "old_api": "ToString",
          "new_api": "size",
          "old_text": "vout[i].ToString()",
          "new_text": "vin.size()",
          "old_line_content": "        str += \"    \" + vout[i].ToString() + \"\\n\";",
          "new_line_content": "    for (unsigned int i = 0; i < vin.size(); i++)",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 97,
          "old_api": null,
          "new_api": "CalculateModifiedSize",
          "old_text": null,
          "new_text": "CalculateModifiedSize(nTxSize)",
          "old_line_content": "    return dPriorityInputs / nTxSize;",
          "new_line_content": "    nTxSize = CalculateModifiedSize(nTxSize);",
          "content_same": false
        },
        {
          "line": 73,
          "old_api": null,
          "new_api": "GetHash",
          "old_text": null,
          "new_text": "GetHash()",
          "old_line_content": "}",
          "new_line_content": "        return GetHash();",
          "content_same": false
        },
        {
          "line": 138,
          "old_api": null,
          "new_api": "ToString",
          "old_text": null,
          "new_text": "vin[i].scriptWitness.ToString()",
          "old_line_content": "    return str;",
          "new_line_content": "        str += \"    \" + vin[i].scriptWitness.ToString() + \"\\n\";",
          "content_same": false
        },
        {
          "line": 139,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "vout.size()",
          "old_line_content": "}",
          "new_line_content": "    for (unsigned int i = 0; i < vout.size(); i++)",
          "content_same": false
        },
        {
          "line": 140,
          "old_api": null,
          "new_api": "ToString",
          "old_text": null,
          "new_text": "vout[i].ToString()",
          "old_line_content": "",
          "new_line_content": "        str += \"    \" + vout[i].ToString() + \"\\n\";",
          "content_same": false
        },
        {
          "line": 75,
          "old_api": null,
          "new_api": "SerializeHash",
          "old_text": null,
          "new_text": "SerializeHash(*this, SER_GETHASH, 0)",
          "old_line_content": "/* For backward compatibility, the hash is initialized to 0. TODO: remove the need for this default constructor entirely. */",
          "new_line_content": "    return SerializeHash(*this, SER_GETHASH, 0);",
          "content_same": false
        },
        {
          "line": 80,
          "old_api": null,
          "new_api": "ComputeHash",
          "old_text": null,
          "new_text": "ComputeHash()",
          "old_line_content": "CAmount CTransaction::GetValueOut() const",
          "new_line_content": "CTransaction::CTransaction(const CMutableTransaction &tx) : nVersion(tx.nVersion), vin(tx.vin), vout(tx.vout), nLockTime(tx.nLockTime), hash(ComputeHash()) {}",
          "content_same": false
        },
        {
          "line": 81,
          "old_api": null,
          "new_api": "ComputeHash",
          "old_text": null,
          "new_text": "ComputeHash()",
          "old_line_content": "{",
          "new_line_content": "CTransaction::CTransaction(CMutableTransaction &&tx) : nVersion(tx.nVersion), vin(std::move(tx.vin)), vout(std::move(tx.vout)), nLockTime(tx.nLockTime), hash(ComputeHash()) {}",
          "content_same": false
        },
        {
          "line": 146,
          "old_api": null,
          "new_api": "::GetSerializeSize(tx, SER_NETWORK, PROTOCOL_VERSION)",
          "old_text": null,
          "new_text": "::GetSerializeSize(tx, SER_NETWORK, PROTOCOL_VERSION)",
          "old_line_content": "",
          "new_line_content": "    return ::GetSerializeSize(tx, SER_NETWORK, PROTOCOL_VERSION | SERIALIZE_TRANSACTION_NO_WITNESS) * (WITNESS_SCALE_FACTOR -1) + ::GetSerializeSize(tx, SER_NETWORK, PROTOCOL_VERSION);",
          "content_same": false
        },
        {
          "line": 112,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "vin.end()",
          "old_line_content": "        if (nTxSize > offset)",
          "new_line_content": "    for (std::vector<CTxIn>::const_iterator it(vin.begin()); it != vin.end(); ++it)",
          "content_same": false
        },
        {
          "line": 114,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "it->scriptSig.size()",
          "old_line_content": "    }",
          "new_line_content": "        unsigned int offset = 41U + std::min(110U, (unsigned int)it->scriptSig.size());",
          "content_same": false
        },
        {
          "line": 89,
          "old_api": null,
          "new_api": "MoneyRange",
          "old_text": null,
          "new_text": "MoneyRange(nValueOut)",
          "old_line_content": "    return nValueOut;",
          "new_line_content": "        if (!MoneyRange(it->nValue) || !MoneyRange(nValueOut))",
          "content_same": false
        },
        {
          "line": 90,
          "old_api": null,
          "new_api": "std::string(__func__)",
          "old_text": null,
          "new_text": "std::string(__func__)",
          "old_line_content": "}",
          "new_line_content": "            throw std::runtime_error(std::string(__func__) + \": value out of range\");",
          "content_same": false
        },
        {
          "line": 123,
          "old_api": null,
          "new_api": "::GetSerializeSize(*this, SER_NETWORK, PROTOCOL_VERSION)",
          "old_text": null,
          "new_text": "::GetSerializeSize(*this, SER_NETWORK, PROTOCOL_VERSION)",
          "old_line_content": "std::string CTransaction::ToString() const",
          "new_line_content": "    return ::GetSerializeSize(*this, SER_NETWORK, PROTOCOL_VERSION);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 134,
          "old_api": "size",
          "new_api": null,
          "old_text": "vin.size()",
          "new_text": null,
          "old_line_content": "    for (unsigned int i = 0; i < vin.size(); i++)",
          "new_line_content": "        nLockTime);",
          "content_same": false
        },
        {
          "line": 108,
          "old_api": "GetTransactionWeight",
          "new_api": null,
          "old_text": "GetTransactionWeight(*this)",
          "new_text": null,
          "old_line_content": "        nTxSize = (GetTransactionWeight(*this) + WITNESS_SCALE_FACTOR - 1) / WITNESS_SCALE_FACTOR;",
          "new_line_content": "    // Providing any more cleanup incentive than making additional inputs free would",
          "content_same": false
        },
        {
          "line": 77,
          "old_api": "ComputeHash",
          "new_api": null,
          "old_text": "ComputeHash()",
          "new_text": null,
          "old_line_content": "CTransaction::CTransaction(const CMutableTransaction &tx) : nVersion(tx.nVersion), vin(tx.vin), vout(tx.vout), nLockTime(tx.nLockTime), hash(ComputeHash()) {}",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 78,
          "old_api": "ComputeHash",
          "new_api": null,
          "old_text": "ComputeHash()",
          "new_text": null,
          "old_line_content": "CTransaction::CTransaction(CMutableTransaction &&tx) : nVersion(tx.nVersion), vin(std::move(tx.vin)), vout(std::move(tx.vout)), nLockTime(tx.nLockTime), hash(ComputeHash()) {}",
          "new_line_content": "/* For backward compatibility, the hash is initialized to 0. TODO: remove the need for this default constructor entirely. */",
          "content_same": false
        },
        {
          "line": 143,
          "old_api": "::GetSerializeSize(tx, SER_NETWORK, PROTOCOL_VERSION)",
          "new_api": null,
          "old_text": "::GetSerializeSize(tx, SER_NETWORK, PROTOCOL_VERSION)",
          "new_text": null,
          "old_line_content": "    return ::GetSerializeSize(tx, SER_NETWORK, PROTOCOL_VERSION | SERIALIZE_TRANSACTION_NO_WITNESS) * (WITNESS_SCALE_FACTOR -1) + ::GetSerializeSize(tx, SER_NETWORK, PROTOCOL_VERSION);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 109,
          "old_api": "end",
          "new_api": null,
          "old_text": "vin.end()",
          "new_text": null,
          "old_line_content": "    for (std::vector<CTxIn>::const_iterator it(vin.begin()); it != vin.end(); ++it)",
          "new_line_content": "    // risk encouraging people to create junk outputs to redeem later.",
          "content_same": false
        },
        {
          "line": 83,
          "old_api": "end",
          "new_api": null,
          "old_text": "vout.end()",
          "new_text": null,
          "old_line_content": "    for (std::vector<CTxOut>::const_iterator it(vout.begin()); it != vout.end(); ++it)",
          "new_line_content": "CAmount CTransaction::GetValueOut() const",
          "content_same": false
        },
        {
          "line": 87,
          "old_api": "std::string(__func__)",
          "new_api": null,
          "old_text": "std::string(__func__)",
          "new_text": null,
          "old_line_content": "            throw std::runtime_error(std::string(__func__) + \": value out of range\");",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 120,
          "old_api": "::GetSerializeSize(*this, SER_NETWORK, PROTOCOL_VERSION)",
          "new_api": null,
          "old_text": "::GetSerializeSize(*this, SER_NETWORK, PROTOCOL_VERSION)",
          "new_text": null,
          "old_line_content": "    return ::GetSerializeSize(*this, SER_NETWORK, PROTOCOL_VERSION);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 126,
          "old_api": "ToString",
          "new_api": null,
          "old_text": "strprintf(\"CTransaction(hash=%s, ver=%d, vin.size=%u, vout.size=%u, nLockTime=%u)\\n\",\n        GetHash().ToString().substr(0,10),\n        nVersion,\n        vin.size(),\n        vout.size(),\n        nLockTime)",
          "new_text": null,
          "old_line_content": "    str += strprintf(\"CTransaction(hash=%s, ver=%d, vin.size=%u, vout.size=%u, nLockTime=%u)\\n\",",
          "new_line_content": "std::string CTransaction::ToString() const",
          "content_same": false
        },
        {
          "line": 94,
          "old_api": "CalculateModifiedSize",
          "new_api": null,
          "old_text": "CalculateModifiedSize(nTxSize)",
          "new_text": null,
          "old_line_content": "    nTxSize = CalculateModifiedSize(nTxSize);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 127,
          "old_api": "ToString",
          "new_api": null,
          "old_text": "GetHash().ToString().substr(0,10)",
          "new_text": null,
          "old_line_content": "        GetHash().ToString().substr(0,10),",
          "new_line_content": "{",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 9,
      "total_additions": 14,
      "total_deletions": 12,
      "total_api_changes": 35
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 3,
        "api_related_lines": 35,
        "non_api_lines": 1,
        "non_api_line_numbers": [
          79
        ]
      }
    },
    "api_calls_before": 49,
    "api_calls_after": 51,
    "diff_info": {
      "added_lines": 4,
      "removed_lines": 1,
      "total_diff_lines": 25
    }
  }
}