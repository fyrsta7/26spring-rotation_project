{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/bitcoin/modified_file/a60ab0ba89289433563c4c0993904acbca8c99ff",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/bitcoin/modified_file/a60ab0ba89289433563c4c0993904acbca8c99ff/before.h",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/bitcoin/modified_file/a60ab0ba89289433563c4c0993904acbca8c99ff/after.h",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/bitcoin/modified_file/a60ab0ba89289433563c4c0993904acbca8c99ff/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": true,
    "api_changes": {
      "replacements": [
        {
          "line": 623,
          "old_api": "size",
          "new_api": "GetHash",
          "old_text": "vout.size()",
          "new_text": "GetHash()",
          "old_line_content": "        for (unsigned int i = 0; i < vout.size(); i++)",
          "new_line_content": "        uint256 hashTx = GetHash();",
          "content_same": false
        },
        {
          "line": 629,
          "old_api": "MoneyRange",
          "new_api": "GetCredit",
          "old_text": "MoneyRange(nCredit)",
          "new_text": "pwallet->GetCredit(txout)",
          "old_line_content": "                if (!MoneyRange(nCredit))",
          "new_line_content": "                nCredit += pwallet->GetCredit(txout);",
          "content_same": false
        },
        {
          "line": 630,
          "old_api": "std::runtime_error(\"CWalletTx::GetAvailableCredit() : value out of range\")",
          "new_api": "MoneyRange",
          "old_text": "std::runtime_error(\"CWalletTx::GetAvailableCredit() : value out of range\")",
          "new_text": "MoneyRange(nCredit)",
          "old_line_content": "                    throw std::runtime_error(\"CWalletTx::GetAvailableCredit() : value out of range\");",
          "new_line_content": "                if (!MoneyRange(nCredit))",
          "content_same": false
        },
        {
          "line": 837,
          "old_api": "str",
          "new_api": "end",
          "old_text": "ss.str()",
          "new_text": "_ssExtra.end()",
          "old_line_content": "                me.strComment.append(ss.str());",
          "new_line_content": "                ss.insert(ss.end(), _ssExtra.begin(), _ssExtra.end());",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 770,
          "old_api": null,
          "new_api": "SetNull",
          "old_text": null,
          "new_text": "SetNull()",
          "old_line_content": "    }",
          "new_line_content": "        SetNull();",
          "content_same": false
        },
        {
          "line": 645,
          "old_api": null,
          "new_api": "GetChange",
          "old_text": null,
          "new_text": "pwallet->GetChange(*this)",
          "old_line_content": "        fChangeCached = true;",
          "new_line_content": "        nChangeCached = pwallet->GetChange(*this);",
          "content_same": false
        },
        {
          "line": 775,
          "old_api": null,
          "new_api": "CPubKey",
          "old_text": null,
          "new_text": "CPubKey()",
          "old_line_content": "    }",
          "new_line_content": "        vchPubKey = CPubKey();",
          "content_same": false
        },
        {
          "line": 658,
          "old_api": null,
          "new_api": "GetDebit",
          "old_text": null,
          "new_text": "GetDebit()",
          "old_line_content": "    }",
          "new_line_content": "        return (GetDebit() > 0);",
          "content_same": false
        },
        {
          "line": 664,
          "old_api": null,
          "new_api": "IsFinalTx",
          "old_text": null,
          "new_text": "IsFinalTx(*this)",
          "old_line_content": "            return false;",
          "new_line_content": "        if (!IsFinalTx(*this))",
          "content_same": false
        },
        {
          "line": 666,
          "old_api": null,
          "new_api": "GetDepthInMainChain",
          "old_text": null,
          "new_text": "GetDepthInMainChain()",
          "old_line_content": "        if (nDepth >= 1)",
          "new_line_content": "        int nDepth = GetDepthInMainChain();",
          "content_same": false
        },
        {
          "line": 671,
          "old_api": null,
          "new_api": "IsFromMe",
          "old_text": null,
          "new_text": "IsFromMe()",
          "old_line_content": "            return false;",
          "new_line_content": "        if (!bSpendZeroConfChange || !IsFromMe()) // using wtx's cached debit",
          "content_same": false
        },
        {
          "line": 805,
          "old_api": null,
          "new_api": "SetNull",
          "old_text": null,
          "new_text": "SetNull()",
          "old_line_content": "    }",
          "new_line_content": "        SetNull();",
          "content_same": false
        },
        {
          "line": 678,
          "old_api": null,
          "new_api": "GetWalletTx",
          "old_text": null,
          "new_text": "pwallet->GetWalletTx(txin.prevout.hash)",
          "old_line_content": "            if (parent == NULL)",
          "new_line_content": "            const CWalletTx* parent = pwallet->GetWalletTx(txin.prevout.hash);",
          "content_same": false
        },
        {
          "line": 682,
          "old_api": null,
          "new_api": "IsMine",
          "old_text": null,
          "new_text": "pwallet->IsMine(parentOut)",
          "old_line_content": "                return false;",
          "new_line_content": "            if (!pwallet->IsMine(parentOut))",
          "content_same": false
        },
        {
          "line": 814,
          "old_api": null,
          "new_api": "clear",
          "old_text": null,
          "new_text": "strComment.clear()",
          "old_line_content": "        nOrderPos = -1;",
          "new_line_content": "        strComment.clear();",
          "content_same": false
        },
        {
          "line": 820,
          "old_api": null,
          "new_api": "const_cast<CAccountingEntry*>(this)",
          "old_text": null,
          "new_text": "const_cast<CAccountingEntry*>(this)",
          "old_line_content": "        if (!(nType & SER_GETHASH))",
          "new_line_content": "        CAccountingEntry& me = *const_cast<CAccountingEntry*>(this);",
          "content_same": false
        },
        {
          "line": 830,
          "old_api": null,
          "new_api": "WriteOrderPos",
          "old_text": null,
          "new_text": "WriteOrderPos(nOrderPos, me.mapValue)",
          "old_line_content": "",
          "new_line_content": "            WriteOrderPos(nOrderPos, me.mapValue);",
          "content_same": false
        },
        {
          "line": 832,
          "old_api": null,
          "new_api": "empty",
          "old_text": null,
          "new_text": "_ssExtra.empty()",
          "old_line_content": "            {",
          "new_line_content": "            if (!(mapValue.empty() && _ssExtra.empty()))",
          "content_same": false
        },
        {
          "line": 835,
          "old_api": null,
          "new_api": "begin",
          "old_text": null,
          "new_text": "ss.begin()",
          "old_line_content": "                ss << mapValue;",
          "new_line_content": "                ss.insert(ss.begin(), '\\0');",
          "content_same": false
        },
        {
          "line": 838,
          "old_api": null,
          "new_api": "str",
          "old_text": null,
          "new_text": "ss.str()",
          "old_line_content": "            }",
          "new_line_content": "                me.strComment.append(ss.str());",
          "content_same": false
        },
        {
          "line": 715,
          "old_api": null,
          "new_api": "c_str",
          "old_text": null,
          "new_text": "FormatMoney(tx->vout[i].nValue).c_str()",
          "old_line_content": "    }",
          "new_line_content": "        return strprintf(\"COutput(%s, %d, %d) [%s]\", tx->GetHash().ToString().c_str(), i, nDepth, FormatMoney(tx->vout[i].nValue).c_str());",
          "content_same": false
        },
        {
          "line": 844,
          "old_api": null,
          "new_api": "find",
          "old_text": null,
          "new_text": "strComment.find(\"\\0\", 0, 1)",
          "old_line_content": "        if (fRead)",
          "new_line_content": "        size_t nSepPos = strComment.find(\"\\0\", 0, 1);",
          "content_same": false
        },
        {
          "line": 847,
          "old_api": null,
          "new_api": "clear",
          "old_text": null,
          "new_text": "me.mapValue.clear()",
          "old_line_content": "            if (std::string::npos != nSepPos)",
          "new_line_content": "            me.mapValue.clear();",
          "content_same": false
        },
        {
          "line": 720,
          "old_api": null,
          "new_api": "c_str",
          "old_text": null,
          "new_text": "ToString().c_str()",
          "old_line_content": "    }",
          "new_line_content": "        LogPrintf(\"%s\\n\", ToString().c_str());",
          "content_same": false
        },
        {
          "line": 850,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "strComment.end()",
          "old_line_content": "                ss >> me.mapValue;",
          "new_line_content": "                CDataStream ss(std::vector<char>(strComment.begin() + nSepPos + 1, strComment.end()), nType, nVersion);",
          "content_same": false
        },
        {
          "line": 852,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "ss.end()",
          "old_line_content": "            }",
          "new_line_content": "                me._ssExtra = std::vector<char>(ss.begin(), ss.end());",
          "content_same": false
        },
        {
          "line": 854,
          "old_api": null,
          "new_api": "ReadOrderPos",
          "old_text": null,
          "new_text": "ReadOrderPos(me.nOrderPos, me.mapValue)",
          "old_line_content": "        }",
          "new_line_content": "            ReadOrderPos(me.nOrderPos, me.mapValue);",
          "content_same": false
        },
        {
          "line": 740,
          "old_api": null,
          "new_api": "GetTime",
          "old_text": null,
          "new_text": "GetTime()",
          "old_line_content": "        nTimeExpires = nExpires;",
          "new_line_content": "        nTimeCreated = (nExpires ? GetTime() : 0);",
          "content_same": false
        },
        {
          "line": 624,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "vout.size()",
          "old_line_content": "        {",
          "new_line_content": "        for (unsigned int i = 0; i < vout.size(); i++)",
          "content_same": false
        },
        {
          "line": 626,
          "old_api": null,
          "new_api": "IsSpent",
          "old_text": null,
          "new_text": "pwallet->IsSpent(hashTx, i)",
          "old_line_content": "            {",
          "new_line_content": "            if (!pwallet->IsSpent(hashTx, i))",
          "content_same": false
        },
        {
          "line": 631,
          "old_api": null,
          "new_api": "std::runtime_error(\"CWalletTx::GetAvailableCredit() : value out of range\")",
          "old_text": null,
          "new_text": "std::runtime_error(\"CWalletTx::GetAvailableCredit() : value out of range\")",
          "old_line_content": "            }",
          "new_line_content": "                    throw std::runtime_error(\"CWalletTx::GetAvailableCredit() : value out of range\");",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 769,
          "old_api": "SetNull",
          "new_api": null,
          "old_text": "SetNull()",
          "new_text": null,
          "old_line_content": "        SetNull();",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 644,
          "old_api": "GetChange",
          "new_api": null,
          "old_text": "pwallet->GetChange(*this)",
          "new_text": null,
          "old_line_content": "        nChangeCached = pwallet->GetChange(*this);",
          "new_line_content": "            return nChangeCached;",
          "content_same": false
        },
        {
          "line": 774,
          "old_api": "CPubKey",
          "new_api": null,
          "old_text": "CPubKey()",
          "new_text": null,
          "old_line_content": "        vchPubKey = CPubKey();",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 657,
          "old_api": "GetDebit",
          "new_api": null,
          "old_text": "GetDebit()",
          "new_text": null,
          "old_line_content": "        return (GetDebit() > 0);",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 663,
          "old_api": "IsFinalTx",
          "new_api": null,
          "old_text": "IsFinalTx(*this)",
          "new_text": null,
          "old_line_content": "        if (!IsFinalTx(*this))",
          "new_line_content": "        // Quick answer in most cases",
          "content_same": false
        },
        {
          "line": 665,
          "old_api": "GetDepthInMainChain",
          "new_api": null,
          "old_text": "GetDepthInMainChain()",
          "new_text": null,
          "old_line_content": "        int nDepth = GetDepthInMainChain();",
          "new_line_content": "            return false;",
          "content_same": false
        },
        {
          "line": 670,
          "old_api": "IsFromMe",
          "new_api": null,
          "old_text": "IsFromMe()",
          "new_text": null,
          "old_line_content": "        if (!bSpendZeroConfChange || !IsFromMe()) // using wtx's cached debit",
          "new_line_content": "            return false;",
          "content_same": false
        },
        {
          "line": 804,
          "old_api": "SetNull",
          "new_api": null,
          "old_text": "SetNull()",
          "new_text": null,
          "old_line_content": "        SetNull();",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 677,
          "old_api": "GetWalletTx",
          "new_api": null,
          "old_text": "pwallet->GetWalletTx(txin.prevout.hash)",
          "new_text": null,
          "old_line_content": "            const CWalletTx* parent = pwallet->GetWalletTx(txin.prevout.hash);",
          "new_line_content": "            // Transactions not sent by us: not trusted",
          "content_same": false
        },
        {
          "line": 681,
          "old_api": "IsMine",
          "new_api": null,
          "old_text": "pwallet->IsMine(parentOut)",
          "new_text": null,
          "old_line_content": "            if (!pwallet->IsMine(parentOut))",
          "new_line_content": "            const CTxOut& parentOut = parent->vout[txin.prevout.n];",
          "content_same": false
        },
        {
          "line": 811,
          "old_api": "clear",
          "new_api": null,
          "old_text": "strAccount.clear()",
          "new_text": null,
          "old_line_content": "        strAccount.clear();",
          "new_line_content": "        nTime = 0;",
          "content_same": false
        },
        {
          "line": 819,
          "old_api": "const_cast<CAccountingEntry*>(this)",
          "new_api": null,
          "old_text": "const_cast<CAccountingEntry*>(this)",
          "new_text": null,
          "old_line_content": "        CAccountingEntry& me = *const_cast<CAccountingEntry*>(this);",
          "new_line_content": "    (",
          "content_same": false
        },
        {
          "line": 829,
          "old_api": "WriteOrderPos",
          "new_api": null,
          "old_text": "WriteOrderPos(nOrderPos, me.mapValue)",
          "new_text": null,
          "old_line_content": "            WriteOrderPos(nOrderPos, me.mapValue);",
          "new_line_content": "        {",
          "content_same": false
        },
        {
          "line": 831,
          "old_api": "empty",
          "new_api": null,
          "old_text": "_ssExtra.empty()",
          "new_text": null,
          "old_line_content": "            if (!(mapValue.empty() && _ssExtra.empty()))",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 834,
          "old_api": "begin",
          "new_api": null,
          "old_text": "ss.begin()",
          "new_text": null,
          "old_line_content": "                ss.insert(ss.begin(), '\\0');",
          "new_line_content": "                CDataStream ss(nType, nVersion);",
          "content_same": false
        },
        {
          "line": 836,
          "old_api": "end",
          "new_api": null,
          "old_text": "_ssExtra.end()",
          "new_text": null,
          "old_line_content": "                ss.insert(ss.end(), _ssExtra.begin(), _ssExtra.end());",
          "new_line_content": "                ss << mapValue;",
          "content_same": false
        },
        {
          "line": 714,
          "old_api": "c_str",
          "new_api": null,
          "old_text": "FormatMoney(tx->vout[i].nValue).c_str()",
          "new_text": null,
          "old_line_content": "        return strprintf(\"COutput(%s, %d, %d) [%s]\", tx->GetHash().ToString().c_str(), i, nDepth, FormatMoney(tx->vout[i].nValue).c_str());",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 843,
          "old_api": "find",
          "new_api": null,
          "old_text": "strComment.find(\"\\0\", 0, 1)",
          "new_text": null,
          "old_line_content": "        size_t nSepPos = strComment.find(\"\\0\", 0, 1);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 846,
          "old_api": "clear",
          "new_api": null,
          "old_text": "me.mapValue.clear()",
          "new_text": null,
          "old_line_content": "            me.mapValue.clear();",
          "new_line_content": "        {",
          "content_same": false
        },
        {
          "line": 719,
          "old_api": "c_str",
          "new_api": null,
          "old_text": "ToString().c_str()",
          "new_text": null,
          "old_line_content": "        LogPrintf(\"%s\\n\", ToString().c_str());",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 849,
          "old_api": "end",
          "new_api": null,
          "old_text": "strComment.end()",
          "new_text": null,
          "old_line_content": "                CDataStream ss(std::vector<char>(strComment.begin() + nSepPos + 1, strComment.end()), nType, nVersion);",
          "new_line_content": "            {",
          "content_same": false
        },
        {
          "line": 851,
          "old_api": "end",
          "new_api": null,
          "old_text": "ss.end()",
          "new_text": null,
          "old_line_content": "                me._ssExtra = std::vector<char>(ss.begin(), ss.end());",
          "new_line_content": "                ss >> me.mapValue;",
          "content_same": false
        },
        {
          "line": 853,
          "old_api": "ReadOrderPos",
          "new_api": null,
          "old_text": "ReadOrderPos(me.nOrderPos, me.mapValue)",
          "new_text": null,
          "old_line_content": "            ReadOrderPos(me.nOrderPos, me.mapValue);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 739,
          "old_api": "GetTime",
          "new_api": null,
          "old_text": "GetTime()",
          "new_text": null,
          "old_line_content": "        nTimeCreated = (nExpires ? GetTime() : 0);",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 625,
          "old_api": "GetHash",
          "new_api": null,
          "old_text": "GetHash()",
          "new_text": null,
          "old_line_content": "            if (!pwallet->IsSpent(GetHash(), i))",
          "new_line_content": "        {",
          "content_same": false
        },
        {
          "line": 628,
          "old_api": "GetCredit",
          "new_api": null,
          "old_text": "pwallet->GetCredit(txout)",
          "new_text": null,
          "old_line_content": "                nCredit += pwallet->GetCredit(txout);",
          "new_line_content": "                const CTxOut &txout = vout[i];",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 4,
      "total_additions": 27,
      "total_deletions": 26,
      "total_api_changes": 57
    },
    "non_api_changes": {
      "has_non_api_changes": false,
      "evidence": {
        "total_diff_lines": 3,
        "api_related_lines": 57,
        "non_api_lines": 0,
        "non_api_line_numbers": []
      }
    },
    "api_calls_before": 111,
    "api_calls_after": 111,
    "diff_info": {
      "added_lines": 2,
      "removed_lines": 1,
      "total_diff_lines": 17
    }
  }
}