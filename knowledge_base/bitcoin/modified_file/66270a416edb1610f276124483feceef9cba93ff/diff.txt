diff --git a/modified_file.cpp b/modified_file.cpp
index 0000000..1111111 100644
--- a/modified_file.cpp
+++ b/modified_file.cpp
--- a/modified_file.cpp
+++ b/modified_file.cpp
@@ -532,24 +532,20 @@
         CCoinsViewMemPool viewMemPool(pcoinsTip, pool);

         view.SetBackend(viewMemPool);

 

-        // do we already have it?

-        for (size_t out = 0; out < tx.vout.size(); out++) {

-            COutPoint outpoint(hash, out);

-            bool had_coin_in_cache = pcoinsTip->HaveCoinInCache(outpoint);

-            if (view.HaveCoin(outpoint)) {

-                if (!had_coin_in_cache) {

-                    coins_to_uncache.push_back(outpoint);

-                }

-                return state.Invalid(false, REJECT_DUPLICATE, "txn-already-known");

-            }

-        }

-

         // do all inputs exist?

         for (const CTxIn txin : tx.vin) {

             if (!pcoinsTip->HaveCoinInCache(txin.prevout)) {

                 coins_to_uncache.push_back(txin.prevout);

             }

             if (!view.HaveCoin(txin.prevout)) {

+                // Are inputs missing because we already have the tx?

+                for (size_t out = 0; out < tx.vout.size(); out++) {

+                    // Optimistically just do efficient check of cache for outputs

+                    if (pcoinsTip->HaveCoinInCache(COutPoint(hash, out))) {

+                        return state.Invalid(false, REJECT_DUPLICATE, "txn-already-known");

+                    }

+                }

+                // Otherwise assume this might be an orphan tx for which we just haven't seen parents yet

                 if (pfMissingInputs) {

                     *pfMissingInputs = true;

                 }
