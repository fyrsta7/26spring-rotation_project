{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/timescaledb/modified_file/f2e4266aa033b2dbfaa1cf8ecccbf8e1f4a736f6",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/timescaledb/modified_file/f2e4266aa033b2dbfaa1cf8ecccbf8e1f4a736f6/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/timescaledb/modified_file/f2e4266aa033b2dbfaa1cf8ecccbf8e1f4a736f6/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/timescaledb/modified_file/f2e4266aa033b2dbfaa1cf8ecccbf8e1f4a736f6/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 220,
          "old_api": "DatumGetInt32",
          "new_api": "AttrOffsetGetAttrNumber",
          "old_text": "DatumGetInt32(value)",
          "new_text": "AttrOffsetGetAttrNumber(i)",
          "old_line_content": "\t\t\t\tstate->counter = DatumGetInt32(value);",
          "new_line_content": "\t\t\t\tvalue = slot_getattr(slot, AttrOffsetGetAttrNumber(i), &isnull);",
          "content_same": false
        },
        {
          "line": 272,
          "old_api": "ExecClearTuple",
          "new_api": "InstrCountFiltered1",
          "old_text": "ExecClearTuple(slot)",
          "new_text": "InstrCountFiltered1(node, 1)",
          "old_line_content": "\t\t\tExecClearTuple(slot);",
          "new_line_content": "\t\t\tInstrCountFiltered1(node, 1);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 259,
          "old_api": null,
          "new_api": "decompress_chunk_create_tuple",
          "old_text": null,
          "new_text": "decompress_chunk_create_tuple(state)",
          "old_line_content": "",
          "new_line_content": "\t\tTupleTableSlot *slot = decompress_chunk_create_tuple(state);",
          "content_same": false
        },
        {
          "line": 261,
          "old_api": null,
          "new_api": "TupIsNull",
          "old_text": null,
          "new_text": "TupIsNull(slot)",
          "old_line_content": "\t\t\treturn NULL;",
          "new_line_content": "\t\tif (TupIsNull(slot))",
          "content_same": false
        },
        {
          "line": 267,
          "old_api": null,
          "new_api": "ExecQual",
          "old_text": null,
          "new_text": "ExecQual(node->ss.ps.qual, econtext, false)",
          "old_line_content": "#else",
          "new_line_content": "\t\tif (node->ss.ps.qual && !ExecQual(node->ss.ps.qual, econtext, false))",
          "content_same": false
        },
        {
          "line": 396,
          "old_api": null,
          "new_api": "ExecStoreVirtualTuple",
          "old_text": null,
          "new_text": "ExecStoreVirtualTuple(slot)",
          "old_line_content": "",
          "new_line_content": "\t\tExecStoreVirtualTuple(slot);",
          "content_same": false
        },
        {
          "line": 269,
          "old_api": null,
          "new_api": "ExecQual",
          "old_text": null,
          "new_text": "ExecQual(node->ss.ps.qual, econtext)",
          "old_line_content": "#endif",
          "new_line_content": "\t\tif (node->ss.ps.qual && !ExecQual(node->ss.ps.qual, econtext))",
          "content_same": false
        },
        {
          "line": 273,
          "old_api": null,
          "new_api": "ExecClearTuple",
          "old_text": null,
          "new_text": "ExecClearTuple(slot)",
          "old_line_content": "\t\t\tcontinue;",
          "new_line_content": "\t\t\tExecClearTuple(slot);",
          "content_same": false
        },
        {
          "line": 281,
          "old_api": null,
          "new_api": "ExecProject",
          "old_text": null,
          "new_text": "ExecProject(node->ss.ps.ps_ProjInfo, &isDone)",
          "old_line_content": "",
          "new_line_content": "\t\tresultslot = ExecProject(node->ss.ps.ps_ProjInfo, &isDone);",
          "content_same": false
        },
        {
          "line": 289,
          "old_api": null,
          "new_api": "ExecProject",
          "old_text": null,
          "new_text": "ExecProject(node->ss.ps.ps_ProjInfo)",
          "old_line_content": "#endif",
          "new_line_content": "\t\treturn ExecProject(node->ss.ps.ps_ProjInfo);",
          "content_same": false
        },
        {
          "line": 297,
          "old_api": null,
          "new_api": "linitial",
          "old_text": null,
          "new_text": "linitial(node->custom_ps)",
          "old_line_content": "}",
          "new_line_content": "\tExecReScan(linitial(node->custom_ps));",
          "content_same": false
        },
        {
          "line": 303,
          "old_api": null,
          "new_api": "linitial",
          "old_text": null,
          "new_text": "linitial(node->custom_ps)",
          "old_line_content": "}",
          "new_line_content": "\tExecEndNode(linitial(node->custom_ps));",
          "content_same": false
        },
        {
          "line": 320,
          "old_api": null,
          "new_api": "linitial",
          "old_text": null,
          "new_text": "linitial(state->csstate.custom_ps)",
          "old_line_content": "",
          "new_line_content": "\t\t\tTupleTableSlot *subslot = ExecProcNode(linitial(state->csstate.custom_ps));",
          "content_same": false
        },
        {
          "line": 322,
          "old_api": null,
          "new_api": "TupIsNull",
          "old_text": null,
          "new_text": "TupIsNull(subslot)",
          "old_line_content": "\t\t\t\treturn NULL;",
          "new_line_content": "\t\t\tif (TupIsNull(subslot))",
          "content_same": false
        },
        {
          "line": 326,
          "old_api": null,
          "new_api": "initialize_batch",
          "old_text": null,
          "new_text": "initialize_batch(state, subslot)",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\t\tinitialize_batch(state, subslot);",
          "content_same": false
        },
        {
          "line": 329,
          "old_api": null,
          "new_api": "ExecClearTuple",
          "old_text": null,
          "new_text": "ExecClearTuple(slot)",
          "old_line_content": "",
          "new_line_content": "\t\tExecClearTuple(slot);",
          "content_same": false
        },
        {
          "line": 202,
          "old_api": null,
          "new_api": "PointerGetDatum",
          "old_text": null,
          "new_text": "PointerGetDatum(header)",
          "old_line_content": "\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstate->reverse)(value, column->typid);",
          "new_line_content": "\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstate->reverse)(PointerGetDatum(header),",
          "content_same": false
        },
        {
          "line": 211,
          "old_api": null,
          "new_api": "AttrOffsetGetAttrNumber",
          "old_text": null,
          "new_text": "AttrOffsetGetAttrNumber(i)",
          "old_line_content": "\t\t\t\tif (!isnull)",
          "new_line_content": "\t\t\t\tvalue = slot_getattr(slot, AttrOffsetGetAttrNumber(i), &isnull);",
          "content_same": false
        },
        {
          "line": 349,
          "old_api": null,
          "new_api": "AttrNumberGetAttrOffset",
          "old_text": null,
          "new_text": "AttrNumberGetAttrOffset(column->attno)",
          "old_line_content": "",
          "new_line_content": "\t\t\t\t\tAttrNumber attr = AttrNumberGetAttrOffset(column->attno);",
          "content_same": false
        },
        {
          "line": 221,
          "old_api": null,
          "new_api": "DatumGetInt32",
          "old_text": null,
          "new_text": "DatumGetInt32(value)",
          "old_line_content": "\t\t\t\t/* count column should never be NULL */",
          "new_line_content": "\t\t\t\tstate->counter = DatumGetInt32(value);",
          "content_same": false
        },
        {
          "line": 223,
          "old_api": null,
          "new_api": "Assert",
          "old_text": null,
          "new_text": "Assert(!isnull)",
          "old_line_content": "\t\t\t\tbreak;",
          "new_line_content": "\t\t\t\tAssert(!isnull);",
          "content_same": false
        },
        {
          "line": 354,
          "old_api": null,
          "new_api": "try_next",
          "old_text": null,
          "new_text": "column->compressed.iterator->try_next(column->compressed.iterator)",
          "old_line_content": "",
          "new_line_content": "\t\t\t\t\t\tresult = column->compressed.iterator->try_next(column->compressed.iterator);",
          "content_same": false
        },
        {
          "line": 368,
          "old_api": null,
          "new_api": "elog",
          "old_text": null,
          "new_text": "elog(ERROR, \"compressed column out of sync with batch counter\")",
          "old_line_content": "\t\t\t\t\t\t}",
          "new_line_content": "\t\t\t\t\t\t\telog(ERROR, \"compressed column out of sync with batch counter\");",
          "content_same": false
        },
        {
          "line": 246,
          "old_api": null,
          "new_api": "ExecProject",
          "old_text": null,
          "new_text": "ExecProject(node->ss.ps.ps_ProjInfo, &isDone)",
          "old_line_content": "",
          "new_line_content": "\t\tresultslot = ExecProject(node->ss.ps.ps_ProjInfo, &isDone);",
          "content_same": false
        },
        {
          "line": 381,
          "old_api": null,
          "new_api": "AttrNumberGetAttrOffset",
          "old_text": null,
          "new_text": "AttrNumberGetAttrOffset(column->attno)",
          "old_line_content": "",
          "new_line_content": "\t\t\t\t\tAttrNumber attr = AttrNumberGetAttrOffset(column->attno);",
          "content_same": false
        },
        {
          "line": 255,
          "old_api": null,
          "new_api": "ResetExprContext",
          "old_text": null,
          "new_text": "ResetExprContext(econtext)",
          "old_line_content": "",
          "new_line_content": "\tResetExprContext(econtext);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 258,
          "old_api": "decompress_chunk_create_tuple",
          "new_api": null,
          "old_text": "decompress_chunk_create_tuple(state)",
          "new_text": null,
          "old_line_content": "\t\tTupleTableSlot *slot = decompress_chunk_create_tuple(state);",
          "new_line_content": "\t{",
          "content_same": false
        },
        {
          "line": 260,
          "old_api": "TupIsNull",
          "new_api": null,
          "old_text": "TupIsNull(slot)",
          "new_text": null,
          "old_line_content": "\t\tif (TupIsNull(slot))",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 266,
          "old_api": "ExecQual",
          "new_api": null,
          "old_text": "ExecQual(node->ss.ps.qual, econtext, false)",
          "new_text": null,
          "old_line_content": "\t\tif (node->ss.ps.qual && !ExecQual(node->ss.ps.qual, econtext, false))",
          "new_line_content": "#if PG96",
          "content_same": false
        },
        {
          "line": 395,
          "old_api": "ExecStoreVirtualTuple",
          "new_api": null,
          "old_text": "ExecStoreVirtualTuple(slot)",
          "new_text": null,
          "old_line_content": "\t\tExecStoreVirtualTuple(slot);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 268,
          "old_api": "ExecQual",
          "new_api": null,
          "old_text": "ExecQual(node->ss.ps.qual, econtext)",
          "new_text": null,
          "old_line_content": "\t\tif (node->ss.ps.qual && !ExecQual(node->ss.ps.qual, econtext))",
          "new_line_content": "#else",
          "content_same": false
        },
        {
          "line": 271,
          "old_api": "InstrCountFiltered1",
          "new_api": null,
          "old_text": "InstrCountFiltered1(node, 1)",
          "new_text": null,
          "old_line_content": "\t\t\tInstrCountFiltered1(node, 1);",
          "new_line_content": "\t\t{",
          "content_same": false
        },
        {
          "line": 280,
          "old_api": "ExecProject",
          "new_api": null,
          "old_text": "ExecProject(node->ss.ps.ps_ProjInfo, &isDone)",
          "new_text": null,
          "old_line_content": "\t\tresultslot = ExecProject(node->ss.ps.ps_ProjInfo, &isDone);",
          "new_line_content": "#if PG96",
          "content_same": false
        },
        {
          "line": 288,
          "old_api": "ExecProject",
          "new_api": null,
          "old_text": "ExecProject(node->ss.ps.ps_ProjInfo)",
          "new_text": null,
          "old_line_content": "\t\treturn ExecProject(node->ss.ps.ps_ProjInfo);",
          "new_line_content": "#else",
          "content_same": false
        },
        {
          "line": 296,
          "old_api": "linitial",
          "new_api": null,
          "old_text": "linitial(node->custom_ps)",
          "new_text": null,
          "old_line_content": "\tExecReScan(linitial(node->custom_ps));",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 302,
          "old_api": "linitial",
          "new_api": null,
          "old_text": "linitial(node->custom_ps)",
          "new_text": null,
          "old_line_content": "\tExecEndNode(linitial(node->custom_ps));",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 319,
          "old_api": "linitial",
          "new_api": null,
          "old_text": "linitial(state->csstate.custom_ps)",
          "new_text": null,
          "old_line_content": "\t\t\tTupleTableSlot *subslot = ExecProcNode(linitial(state->csstate.custom_ps));",
          "new_line_content": "\t\t{",
          "content_same": false
        },
        {
          "line": 321,
          "old_api": "TupIsNull",
          "new_api": null,
          "old_text": "TupIsNull(subslot)",
          "new_text": null,
          "old_line_content": "\t\t\tif (TupIsNull(subslot))",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 325,
          "old_api": "initialize_batch",
          "new_api": null,
          "old_text": "initialize_batch(state, subslot)",
          "new_text": null,
          "old_line_content": "\t\t\tinitialize_batch(state, subslot);",
          "new_line_content": "\t\t\tbatch_done = false;",
          "content_same": false
        },
        {
          "line": 328,
          "old_api": "ExecClearTuple",
          "new_api": null,
          "old_text": "ExecClearTuple(slot)",
          "new_text": null,
          "old_line_content": "\t\tExecClearTuple(slot);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 210,
          "old_api": "AttrOffsetGetAttrNumber",
          "new_api": null,
          "old_text": "AttrOffsetGetAttrNumber(i)",
          "new_text": null,
          "old_line_content": "\t\t\t\tvalue = slot_getattr(slot, AttrOffsetGetAttrNumber(i), &isnull);",
          "new_line_content": "\t\t\tcase SEGMENTBY_COLUMN:",
          "content_same": false
        },
        {
          "line": 219,
          "old_api": "AttrOffsetGetAttrNumber",
          "new_api": null,
          "old_text": "AttrOffsetGetAttrNumber(i)",
          "new_text": null,
          "old_line_content": "\t\t\t\tvalue = slot_getattr(slot, AttrOffsetGetAttrNumber(i), &isnull);",
          "new_line_content": "\t\t\tcase COUNT_COLUMN:",
          "content_same": false
        },
        {
          "line": 348,
          "old_api": "AttrNumberGetAttrOffset",
          "new_api": null,
          "old_text": "AttrNumberGetAttrOffset(column->attno)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\tAttrNumber attr = AttrNumberGetAttrOffset(column->attno);",
          "new_line_content": "\t\t\t\t{",
          "content_same": false
        },
        {
          "line": 222,
          "old_api": "Assert",
          "new_api": null,
          "old_text": "Assert(!isnull)",
          "new_text": null,
          "old_line_content": "\t\t\t\tAssert(!isnull);",
          "new_line_content": "\t\t\t\t/* count column should never be NULL */",
          "content_same": false
        },
        {
          "line": 353,
          "old_api": "try_next",
          "new_api": null,
          "old_text": "column->compressed.iterator->try_next(column->compressed.iterator)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\t\tresult = column->compressed.iterator->try_next(column->compressed.iterator);",
          "new_line_content": "\t\t\t\t\t\tDecompressResult result;",
          "content_same": false
        },
        {
          "line": 367,
          "old_api": "elog",
          "new_api": null,
          "old_text": "elog(ERROR, \"compressed column out of sync with batch counter\")",
          "new_text": null,
          "old_line_content": "\t\t\t\t\t\t\telog(ERROR, \"compressed column out of sync with batch counter\");",
          "new_line_content": "\t\t\t\t\t\t\t */",
          "content_same": false
        },
        {
          "line": 245,
          "old_api": "ExecProject",
          "new_api": null,
          "old_text": "ExecProject(node->ss.ps.ps_ProjInfo, &isDone)",
          "new_text": null,
          "old_line_content": "\t\tresultslot = ExecProject(node->ss.ps.ps_ProjInfo, &isDone);",
          "new_line_content": "\t{",
          "content_same": false
        },
        {
          "line": 380,
          "old_api": "AttrNumberGetAttrOffset",
          "new_api": null,
          "old_text": "AttrNumberGetAttrOffset(column->attno)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\tAttrNumber attr = AttrNumberGetAttrOffset(column->attno);",
          "new_line_content": "\t\t\t\t{",
          "content_same": false
        },
        {
          "line": 254,
          "old_api": "ResetExprContext",
          "new_api": null,
          "old_text": "ResetExprContext(econtext)",
          "new_text": null,
          "old_line_content": "\tResetExprContext(econtext);",
          "new_line_content": "",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 2,
      "total_additions": 24,
      "total_deletions": 23,
      "total_api_changes": 49
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 2,
        "api_related_lines": 49,
        "non_api_lines": 1,
        "non_api_line_numbers": [
          203
        ]
      }
    },
    "api_calls_before": 60,
    "api_calls_after": 61,
    "diff_info": {
      "added_lines": 2,
      "removed_lines": 1,
      "total_diff_lines": 15
    }
  }
}