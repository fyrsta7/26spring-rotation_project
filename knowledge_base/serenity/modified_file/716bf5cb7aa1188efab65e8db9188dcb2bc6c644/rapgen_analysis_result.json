{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/serenity/modified_file/716bf5cb7aa1188efab65e8db9188dcb2bc6c644",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/serenity/modified_file/716bf5cb7aa1188efab65e8db9188dcb2bc6c644/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/serenity/modified_file/716bf5cb7aa1188efab65e8db9188dcb2bc6c644/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/serenity/modified_file/716bf5cb7aa1188efab65e8db9188dcb2bc6c644/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": true,
    "api_changes": {
      "replacements": [
        {
          "line": 5219,
          "old_api": "auto range =",
          "new_api": "auto start_po",
          "old_text": "      auto range = ",
          "new_text": "      auto start_po",
          "old_line_content": null,
          "new_line_content": "            for (; i < text_block.positions.size() - 1 && match_index.value() > text_block.positions[i + 1].start_offset; ++i)",
          "content_same": true
        },
        {
          "line": 5222,
          "old_api": "tch_start_posi",
          "new_api": "atch_end_position =",
          "old_text": "tch_start_posi",
          "new_text": "atch_end_position =",
          "old_line_content": "            auto range = create_range();",
          "new_line_content": "            auto start_position = match_index.value() - match_start_position->start_offset;",
          "content_same": false
        },
        {
          "line": 5232,
          "old_api": "append",
          "new_api": "value",
          "old_text": "    matches.append(range);\n          ",
          "new_text": "fset = match_index.value() + query.bytes_as_string_view().length() + 1;\n ",
          "old_line_content": "            auto end_position = match_index.value() + query.bytes_as_string_view().length() - match_end_position->start_offset;",
          "new_line_content": "            matches.append(Range::create(start_dom_node, start_position, end_dom_node, end_position));",
          "content_same": false
        },
        {
          "line": 5235,
          "old_api": "length",
          "new_api": "ow-declarative-shadow-roots\nbool Doc",
          "old_text": "ew().length() + 1;\n  ",
          "new_text": "ow-declarative-shadow-roots\nbool Doc",
          "old_line_content": "            matches.append(range);",
          "new_line_content": "            if (offset >= text.bytes_as_string_view().length())",
          "content_same": false
        },
        {
          "line": 5282,
          "old_api": "tive_shadow_roots",
          "new_api": "parse_html_from_a_string",
          "old_text": "tive_shadow_roots(true);\n\n    // 4. Parse HTML",
          "new_text": "HTML.\n    document->parse_html_from_a_string(html)",
          "old_line_content": "    document->set_content_type(\"text/html\"_string);",
          "new_line_content": "    document->set_allow_declarative_shadow_roots(true);",
          "content_same": false
        },
        {
          "line": 5285,
          "old_api": "parse_html_from_a_string",
          "new_api": "<DOM::Position> position)\n{\n    if (m_cu",
          "old_text": "HTML.\n    document->parse_html_from_a_string(html)",
          "new_text": "<DOM::Position> position)\n{\n    if (m_cu",
          "old_line_content": "    document->set_allow_declarative_shadow_roots(true);",
          "new_line_content": "    document->parse_html_from_a_string(html);",
          "content_same": false
        },
        {
          "line": 5296,
          "old_api": "node",
          "new_api": "if (m_cursor_position && m_cursor_",
          "old_text": "ion->node()->paintable()->set_needs",
          "new_text": "    if (m_cursor_position && m_cursor_",
          "old_line_content": "    if (m_cursor_position && m_cursor_position->equals(position))",
          "new_line_content": "    if (m_cursor_position && m_cursor_position->node()->paintable())",
          "content_same": false
        },
        {
          "line": 5304,
          "old_api": "bool Document::increment_cursor_positi",
          "new_api": "false;\n\n    reset_cursor_",
          "old_text": "bool Document::increment_cursor_positi",
          "new_text": " false;\n\n    reset_cursor_",
          "old_line_content": "    if (m_cursor_position && m_cursor_position->node()->paintable())",
          "new_line_content": "    reset_cursor_blink_cycle();",
          "content_same": false
        },
        {
          "line": 5312,
          "old_api": "_position_offset",
          "new_api": "))\n        return false;",
          "old_text": "_position_offset()\n{\n    if (!m_curso",
          "new_text": "))\n        return false;\n\n",
          "old_line_content": "    if (!m_cursor_position->increment_offset())",
          "new_line_content": "    reset_cursor_blink_cycle();",
          "content_same": false
        },
        {
          "line": 5321,
          "old_api": "cument_text",
          "new_api": "e",
          "old_text": "cument_text(Badge<EditEventHandler>)\n",
          "new_text": "e();\n\n    if (m_cursor_pos",
          "old_line_content": "    if (!m_cursor_position->decrement_offset())",
          "new_line_content": "    reset_cursor_blink_cycle();",
          "content_same": false
        },
        {
          "line": 5330,
          "old_api": ":Text&>(*m_cursor_position",
          "new_api": "_node",
          "old_text": ":Text&>(*m_cursor_position",
          "new_text": "_node({});\n    }\n}\n\nvoid ",
          "old_line_content": "    reset_cursor_blink_cycle();",
          "new_line_content": "        auto& text_node = static_cast<DOM::Text&>(*m_cursor_position->node());",
          "content_same": false
        },
        {
          "line": 5332,
          "old_api": "text_node.editable_text_",
          "new_api": "m_cursor_blink_state = true;",
          "old_text": " text_node.editable_text_",
          "new_text": "   m_cursor_blink_state = true;\n    ",
          "old_line_content": "    if (m_cursor_position && is<DOM::Text>(*m_cursor_position->node())) {",
          "new_line_content": "        if (auto* text_node_owner = text_node.editable_text_node_owner())",
          "content_same": false
        },
        {
          "line": 5333,
          "old_api": "_node",
          "new_api": "restart",
          "old_text": "_node({});\n    }\n}\n\nvoid ",
          "new_text": "_timer->restart();\n\n    if (m_cursor_po",
          "old_line_content": "        auto& text_node = static_cast<DOM::Text&>(*m_cursor_position->node());",
          "new_line_content": "            text_node_owner->did_edit_text_node({});",
          "content_same": false
        },
        {
          "line": 5343,
          "old_api": "set_needs_display",
          "new_api": "ptr",
          "old_text": "le()->set_needs_display();\n}\n\nJ",
          "new_text": "igable.ptr();\n}\n\nvoid Document::set_cached_navigable(JS::GC",
          "old_line_content": "    m_cursor_blink_timer->restart();",
          "new_line_content": "        m_cursor_position->node()->paintable()->set_needs_display();",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 5259,
          "old_api": null,
          "new_api": "put stream for parser. The encoding confiden",
          "old_text": null,
          "new_text": "put stream for parser. The encoding confiden",
          "old_line_content": "void Document::parse_html_from_a_string(StringView html)",
          "new_line_content": "    set_document_type(DOM::Document::Type::HTML);",
          "content_same": false
        },
        {
          "line": 5264,
          "old_api": null,
          "new_api": "nto the input stream.\n    // FIXME: This is to m",
          "old_text": null,
          "new_text": "nto the input stream.\n    // FIXME: This is to m",
          "old_line_content": "    // 2. Create an HTML parser parser, associated with document.",
          "new_line_content": "    auto parser = HTML::HTMLParser::create(*this, html, \"UTF-8\"sv);",
          "content_same": false
        },
        {
          "line": 5268,
          "old_api": null,
          "new_api": "ument> Document::parse_html_",
          "old_text": null,
          "new_text": "ument> Document::parse_html_",
          "old_line_content": "",
          "new_line_content": "    parser->run(\"about:blank\"sv);",
          "content_same": false
        },
        {
          "line": 5274,
          "old_api": null,
          "new_api": ", this's relevant",
          "old_text": null,
          "new_text": ", this's relevant ",
          "old_line_content": "// https://html.spec.whatwg.org/multipage/dynamic-markup-insertion.html#dom-parsehtmlunsafe",
          "new_line_content": "    auto& realm = *vm.current_realm();",
          "content_same": false
        },
        {
          "line": 5278,
          "old_api": null,
          "new_api": "dow roots to true.\n    document->set_allow_d",
          "old_text": null,
          "new_text": "dow roots to true.\n    document->set_allow_d",
          "old_line_content": "    // FIXME: 1. Let compliantHTML to the result of invoking the Get Trusted Type compliant string algorithm with TrustedHTML, this's relevant global object, html, \"Document parseHTMLUnsafe\", and \"script\".",
          "new_line_content": "    auto document = Document::create_for_fragment_parsing(realm);",
          "content_same": false
        },
        {
          "line": 5279,
          "old_api": null,
          "new_api": "tive_shadow_roots",
          "old_text": null,
          "new_text": "tive_shadow_roots(true);\n\n    // 4. Parse HTML",
          "old_line_content": "",
          "new_line_content": "    document->set_content_type(\"text/html\"_string);",
          "content_same": false
        },
        {
          "line": 5293,
          "old_api": null,
          "new_api": "node",
          "old_text": null,
          "new_text": "ion->node()->paintable()->set_needs",
          "old_line_content": "",
          "new_line_content": "    if (m_cursor_position && m_cursor_position->equals(position))",
          "content_same": false
        },
        {
          "line": 5297,
          "old_api": null,
          "new_api": "paintable",
          "old_text": null,
          "new_text": "node()->paintable())\n        m_cursor_position->node()->pai",
          "old_line_content": "        return;",
          "new_line_content": "        m_cursor_position->node()->paintable()->set_needs_display();",
          "content_same": false
        },
        {
          "line": 5301,
          "old_api": null,
          "new_api": "bool Document::increment_cursor_positi",
          "old_text": null,
          "new_text": "bool Document::increment_cursor_positi",
          "old_line_content": "",
          "new_line_content": "    if (m_cursor_position && m_cursor_position->node()->paintable())",
          "content_same": false
        },
        {
          "line": 5302,
          "old_api": null,
          "new_api": "increment_offset",
          "old_text": null,
          "new_text": ")\n{\n    if (!m_cursor_position->increment_offset())\n       ",
          "old_line_content": "    m_cursor_position = position;",
          "new_line_content": "        m_cursor_position->node()->paintable()->set_needs_display();",
          "content_same": false
        },
        {
          "line": 5309,
          "old_api": null,
          "new_api": "_position_offset",
          "old_text": null,
          "new_text": "_position_offset()\n{\n    if (!m_curso",
          "old_line_content": "",
          "new_line_content": "    if (!m_cursor_position->increment_offset())",
          "content_same": false
        },
        {
          "line": 5318,
          "old_api": null,
          "new_api": "cument_text",
          "old_text": null,
          "new_text": "cument_text(Badge<EditEventHandler>)\n",
          "old_line_content": "",
          "new_line_content": "    if (!m_cursor_position->decrement_offset())",
          "content_same": false
        },
        {
          "line": 5327,
          "old_api": null,
          "new_api": ":Text&>(*m_cursor_position",
          "old_text": null,
          "new_text": ":Text&>(*m_cursor_position",
          "old_line_content": "",
          "new_line_content": "    reset_cursor_blink_cycle();",
          "content_same": false
        },
        {
          "line": 5329,
          "old_api": null,
          "new_api": "text_node.editable_text_",
          "old_text": null,
          "new_text": " text_node.editable_text_",
          "old_line_content": "{",
          "new_line_content": "    if (m_cursor_position && is<DOM::Text>(*m_cursor_position->node())) {",
          "content_same": false
        },
        {
          "line": 5340,
          "old_api": null,
          "new_api": "set_needs_display",
          "old_text": null,
          "new_text": "le()->set_needs_display();\n}\n\nJ",
          "old_line_content": "void Document::reset_cursor_blink_cycle()",
          "new_line_content": "    m_cursor_blink_timer->restart();",
          "content_same": false
        },
        {
          "line": 5342,
          "old_api": null,
          "new_api": "nt::cached_navigable()\n{\n    return m_",
          "old_text": null,
          "new_text": "nt::cached_navigable()\n{\n    return m_",
          "old_line_content": "    m_cursor_blink_state = true;",
          "new_line_content": "    if (m_cursor_position && m_cursor_position->node()->paintable())",
          "content_same": false
        },
        {
          "line": 5348,
          "old_api": null,
          "new_api": ";\n}\n\n}",
          "old_text": null,
          "new_text": ";\n}\n\n}\n",
          "old_line_content": "",
          "new_line_content": "    return m_cached_navigable.ptr();",
          "content_same": false
        },
        {
          "line": 5353,
          "old_api": null,
          "new_api": "",
          "old_text": null,
          "new_text": "",
          "old_line_content": "",
          "new_line_content": "    m_cached_navigable = navigable.ptr();",
          "content_same": false
        },
        {
          "line": 5226,
          "old_api": null,
          "new_api": "s[i + 1];\n\n            auto& end_dom_",
          "old_text": null,
          "new_text": "s[i + 1];\n\n            auto& end_dom_",
          "old_line_content": "",
          "new_line_content": "            for (; i < text_block.positions.size() - 1 && (match_index.value() + query.bytes_as_string_view().length() > text_block.positions[i + 1].start_offset); ++i)",
          "content_same": false
        },
        {
          "line": 5230,
          "old_api": null,
          "new_api": "n, end_dom_node, end_position));",
          "old_text": null,
          "new_text": "n, end_dom_node, end_position));\n    ",
          "old_line_content": "",
          "new_line_content": "            auto end_position = match_index.value() + query.bytes_as_string_view().length() - match_end_position->start_offset;",
          "content_same": false
        },
        {
          "line": 5234,
          "old_api": null,
          "new_api": "return matches;\n}\n\n// https://d",
          "old_text": null,
          "new_text": "\n\n    return matches;\n}\n\n// https://d",
          "old_line_content": "",
          "new_line_content": "            offset = match_index.value() + query.bytes_as_string_view().length() + 1;",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 5262,
          "old_api": "put stream for parser. The encoding confiden",
          "new_api": null,
          "old_text": "put stream for parser. The encoding confiden",
          "new_text": null,
          "old_line_content": "    set_document_type(DOM::Document::Type::HTML);",
          "new_line_content": "    // 3. Place html into the input stream for parser. The encoding confidence is irrelevant.",
          "content_same": false
        },
        {
          "line": 5267,
          "old_api": "nto the input stream.\n    // FIXME: This is to m",
          "new_api": null,
          "old_text": "nto the input stream.\n    // FIXME: This is to m",
          "new_text": null,
          "old_line_content": "    auto parser = HTML::HTMLParser::create(*this, html, \"UTF-8\"sv);",
          "new_line_content": "    // FIXME: This is to match the default URL. Instead, pass in this's relevant global object's associated Document's URL.",
          "content_same": false
        },
        {
          "line": 5271,
          "old_api": "ument> Document::parse_html_",
          "new_api": null,
          "old_text": "ument> Document::parse_html_",
          "new_text": null,
          "old_line_content": "    parser->run(\"about:blank\"sv);",
          "new_line_content": "// https://html.spec.whatwg.org/multipage/dynamic-markup-insertion.html#dom-parsehtmlunsafe",
          "content_same": false
        },
        {
          "line": 5277,
          "old_api": ", this's relevant",
          "new_api": null,
          "old_text": ", this's relevant ",
          "new_text": null,
          "old_line_content": "    auto& realm = *vm.current_realm();",
          "new_line_content": "    // 2. Let document be a new Document, whose content type is \"text/html\".",
          "content_same": false
        },
        {
          "line": 5281,
          "old_api": "dow roots to true.\n    document->set_allow_d",
          "new_api": null,
          "old_text": "dow roots to true.\n    document->set_allow_d",
          "new_text": null,
          "old_line_content": "    auto document = Document::create_for_fragment_parsing(realm);",
          "new_line_content": "    // 3. Set document's allow declarative shadow roots to true.",
          "content_same": false
        },
        {
          "line": 5288,
          "old_api": "<DOM::Position> position)\n{\n    if (m_cu",
          "new_api": null,
          "old_text": "<DOM::Position> position)\n{\n    if (m_cu",
          "new_text": null,
          "old_line_content": "    document->parse_html_from_a_string(html);",
          "new_line_content": "    return document;",
          "content_same": false
        },
        {
          "line": 5299,
          "old_api": "if (m_cursor_position && m_cursor_",
          "new_api": null,
          "old_text": "    if (m_cursor_position && m_cursor_",
          "new_text": null,
          "old_line_content": "    if (m_cursor_position && m_cursor_position->node()->paintable())",
          "new_line_content": "    m_cursor_position = position;",
          "content_same": false
        },
        {
          "line": 5300,
          "old_api": "paintable",
          "new_api": null,
          "old_text": "node()->paintable())\n        m_cursor_position->node()->pai",
          "new_text": null,
          "old_line_content": "        m_cursor_position->node()->paintable()->set_needs_display();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 5305,
          "old_api": "increment_offset",
          "new_api": null,
          "old_text": ")\n{\n    if (!m_cursor_position->increment_offset())\n       ",
          "new_text": null,
          "old_line_content": "        m_cursor_position->node()->paintable()->set_needs_display();",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 5307,
          "old_api": "false;\n\n    reset_cursor_",
          "new_api": null,
          "old_text": " false;\n\n    reset_cursor_",
          "new_text": null,
          "old_line_content": "    reset_cursor_blink_cycle();",
          "new_line_content": "bool Document::increment_cursor_position_offset()",
          "content_same": false
        },
        {
          "line": 5315,
          "old_api": "))\n        return false;",
          "new_api": null,
          "old_text": "))\n        return false;\n\n",
          "new_text": null,
          "old_line_content": "    reset_cursor_blink_cycle();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 5324,
          "old_api": "e",
          "new_api": null,
          "old_text": "e();\n\n    if (m_cursor_pos",
          "new_text": null,
          "old_line_content": "    reset_cursor_blink_cycle();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 5335,
          "old_api": "m_cursor_blink_state = true;",
          "new_api": null,
          "old_text": "   m_cursor_blink_state = true;\n    ",
          "new_text": null,
          "old_line_content": "        if (auto* text_node_owner = text_node.editable_text_node_owner())",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 5336,
          "old_api": "restart",
          "new_api": null,
          "old_text": "_timer->restart();\n\n    if (m_cursor_po",
          "new_text": null,
          "old_line_content": "            text_node_owner->did_edit_text_node({});",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 5345,
          "old_api": "nt::cached_navigable()\n{\n    return m_",
          "new_api": null,
          "old_text": "nt::cached_navigable()\n{\n    return m_",
          "new_text": null,
          "old_line_content": "    if (m_cursor_position && m_cursor_position->node()->paintable())",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 5346,
          "old_api": "ptr",
          "new_api": null,
          "old_text": "igable.ptr();\n}\n\nvoid Document::set_cached_navigable(JS::GC",
          "new_text": null,
          "old_line_content": "        m_cursor_position->node()->paintable()->set_needs_display();",
          "new_line_content": "JS::GCPtr<HTML::Navigable> Document::cached_navigable()",
          "content_same": false
        },
        {
          "line": 5223,
          "old_api": "set_start",
          "new_api": null,
          "old_text": "nge->set_start(star",
          "new_text": null,
          "old_line_content": "            auto start_position = match_index.value() - match_start_position->start_offset;",
          "new_line_content": "            auto& start_dom_node = match_start_position->dom_node;",
          "content_same": false
        },
        {
          "line": 5351,
          "old_api": ";\n}\n\n}",
          "new_api": null,
          "old_text": ";\n}\n\n}\n",
          "new_text": null,
          "old_line_content": "    return m_cached_navigable.ptr();",
          "new_line_content": "void Document::set_cached_navigable(JS::GCPtr<HTML::Navigable> navigable)",
          "content_same": false
        },
        {
          "line": 5225,
          "old_api": "size",
          "new_api": null,
          "old_text": ".positions.size() - 1 && (match_index.value() + ",
          "new_text": null,
          "old_line_content": "            (void)range->set_start(start_dom_node, start_position);",
          "new_line_content": "            auto* match_end_position = match_start_position;",
          "content_same": false
        },
        {
          "line": 5228,
          "old_api": "s[i + 1];\n\n            auto& end_dom_",
          "new_api": null,
          "old_text": "s[i + 1];\n\n            auto& end_dom_",
          "new_text": null,
          "old_line_content": "            for (; i < text_block.positions.size() - 1 && (match_index.value() + query.bytes_as_string_view().length() > text_block.positions[i + 1].start_offset); ++i)",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 5356,
          "old_api": "",
          "new_api": null,
          "old_text": "",
          "new_text": null,
          "old_line_content": "    m_cached_navigable = navigable.ptr();",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 5233,
          "old_api": "value",
          "new_api": null,
          "old_text": "  offset = match_index.value() + query.byt",
          "new_text": null,
          "old_line_content": "            (void)range->set_end(end_dom_node, end_position);",
          "new_line_content": "            match_start_position = match_end_position;",
          "content_same": false
        },
        {
          "line": 5237,
          "old_api": "return matches;\n}\n\n// https://d",
          "new_api": null,
          "old_text": "\n\n    return matches;\n}\n\n// https://d",
          "new_text": null,
          "old_line_content": "            offset = match_index.value() + query.bytes_as_string_view().length() + 1;",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 5238,
          "old_api": "ow-declarative-shadow-roots\nbool Doc",
          "new_api": null,
          "old_text": "ow-declarative-shadow-roots\nbool Doc",
          "new_text": null,
          "old_line_content": "            if (offset >= text.bytes_as_string_view().length())",
          "new_line_content": "    }",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 14,
      "total_additions": 21,
      "total_deletions": 24,
      "total_api_changes": 59
    },
    "non_api_changes": {
      "has_non_api_changes": false,
      "evidence": {
        "total_diff_lines": 5,
        "api_related_lines": 59,
        "non_api_lines": 0,
        "non_api_line_numbers": []
      }
    },
    "api_calls_before": 1865,
    "api_calls_after": 1863,
    "diff_info": {
      "added_lines": 1,
      "removed_lines": 4,
      "total_diff_lines": 27
    }
  }
}