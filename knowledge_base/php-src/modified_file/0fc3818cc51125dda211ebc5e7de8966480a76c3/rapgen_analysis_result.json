{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/php-src/modified_file/0fc3818cc51125dda211ebc5e7de8966480a76c3",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/php-src/modified_file/0fc3818cc51125dda211ebc5e7de8966480a76c3/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/php-src/modified_file/0fc3818cc51125dda211ebc5e7de8966480a76c3/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/php-src/modified_file/0fc3818cc51125dda211ebc5e7de8966480a76c3/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 239,
          "old_api": "CG",
          "new_api": "EG",
          "old_text": "CG(map_ptr_last)",
          "new_text": "EG(zend_constants)",
          "old_line_content": "\t\tif (ZCSG(map_ptr_last) > CG(map_ptr_last)) {",
          "new_line_content": "\t\t\tif (!zend_hash_exists(EG(zend_constants), name)) {",
          "content_same": false
        },
        {
          "line": 240,
          "old_api": "ZCSG",
          "new_api": "ZSTR_LEN",
          "old_text": "ZCSG(map_ptr_last)",
          "new_text": "ZSTR_LEN(name)",
          "old_line_content": "\t\t\tzend_map_ptr_extend(ZCSG(map_ptr_last));",
          "new_line_content": "\t\t\t\tzend_register_long_constant(ZSTR_VAL(name), ZSTR_LEN(name), persistent_script->compiler_halt_offset, CONST_CS, 0);",
          "content_same": false
        },
        {
          "line": 246,
          "old_api": "CG",
          "new_api": "ZCSG",
          "old_text": "CG(compiled_filename)",
          "new_text": "ZCSG(map_ptr_last)",
          "old_line_content": "\t\tCG(compiled_filename) = persistent_script->script.filename;",
          "new_line_content": "\t\t\tzend_map_ptr_extend(ZCSG(map_ptr_last));",
          "content_same": false
        },
        {
          "line": 251,
          "old_api": "UNEXPECTED",
          "new_api": "CG",
          "old_text": "UNEXPECTED(!from_shared_memory)",
          "new_text": "CG(compiled_filename)",
          "old_line_content": "\tif (UNEXPECTED(!from_shared_memory)) {",
          "new_line_content": "\t\tzend_string *orig_compiled_filename = CG(compiled_filename);",
          "content_same": false
        },
        {
          "line": 252,
          "old_api": "free_persistent_script",
          "new_api": "CG",
          "old_text": "free_persistent_script(persistent_script, 0)",
          "new_text": "CG(compiled_filename)",
          "old_line_content": "\t\tfree_persistent_script(persistent_script, 0); /* free only hashes */",
          "new_line_content": "\t\tCG(compiled_filename) = persistent_script->script.filename;",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 257,
          "old_api": null,
          "new_api": "UNEXPECTED",
          "old_text": null,
          "new_text": "UNEXPECTED(!from_shared_memory)",
          "old_line_content": "",
          "new_line_content": "\tif (UNEXPECTED(!from_shared_memory)) {",
          "content_same": false
        },
        {
          "line": 258,
          "old_api": null,
          "new_api": "free_persistent_script",
          "old_text": null,
          "new_text": "free_persistent_script(persistent_script, 0)",
          "old_line_content": "/*",
          "new_line_content": "\t\tfree_persistent_script(persistent_script, 0); /* free only hashes */",
          "content_same": false
        },
        {
          "line": 311,
          "old_api": null,
          "new_api": "ADLER32_DO16",
          "old_text": null,
          "new_text": "ADLER32_DO16(buf)",
          "old_line_content": "",
          "new_line_content": "\t\t\tADLER32_DO16(buf);",
          "content_same": false
        },
        {
          "line": 323,
          "old_api": null,
          "new_api": "ADLER32_DO16",
          "old_text": null,
          "new_text": "ADLER32_DO16(buf)",
          "old_line_content": "\t\t\tdo {",
          "new_line_content": "\t\t\t\tADLER32_DO16(buf);",
          "content_same": false
        },
        {
          "line": 330,
          "old_api": null,
          "new_api": "ADLER32_DO1",
          "old_text": null,
          "new_text": "ADLER32_DO1(buf)",
          "old_line_content": "\t}",
          "new_line_content": "\t\t\t\tADLER32_DO1(buf);",
          "content_same": false
        },
        {
          "line": 204,
          "old_api": null,
          "new_api": "Z_PTR",
          "old_text": null,
          "new_text": "Z_PTR(p->val)",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\t\tt = _zend_hash_append_ptr_ex(target, p->key, Z_PTR(p->val), 1);",
          "content_same": false
        },
        {
          "line": 206,
          "old_api": null,
          "new_api": "ZSTR_HAS_CE_CACHE",
          "old_text": null,
          "new_text": "ZSTR_HAS_CE_CACHE(ce->name)",
          "old_line_content": "\ttarget->nInternalPointer = 0;",
          "new_line_content": "\t\t\t && ZSTR_HAS_CE_CACHE(ce->name)",
          "content_same": false
        },
        {
          "line": 207,
          "old_api": null,
          "new_api": "ZSTR_VAL",
          "old_text": null,
          "new_text": "ZSTR_VAL(p->key)",
          "old_line_content": "\treturn;",
          "new_line_content": "\t\t\t && ZSTR_VAL(p->key)[0]) {",
          "content_same": false
        },
        {
          "line": 208,
          "old_api": null,
          "new_api": "ZSTR_SET_CE_CACHE",
          "old_text": null,
          "new_text": "ZSTR_SET_CE_CACHE(ce->name, ce)",
          "old_line_content": "}",
          "new_line_content": "\t\t\t\tZSTR_SET_CE_CACHE(ce->name, ce);",
          "content_same": false
        },
        {
          "line": 220,
          "old_api": null,
          "new_api": "emalloc",
          "old_text": null,
          "new_text": "emalloc(sizeof(zend_op_array))",
          "old_line_content": "",
          "new_line_content": "\top_array = (zend_op_array *) emalloc(sizeof(zend_op_array));",
          "content_same": false
        },
        {
          "line": 349,
          "old_api": null,
          "new_api": "zend_adler32",
          "old_text": null,
          "new_text": "zend_adler32(checksum, mem, (unsigned char*)persistent_script - mem)",
          "old_line_content": "\tmem  += sizeof(*persistent_script);",
          "new_line_content": "\t\tchecksum = zend_adler32(checksum, mem, (unsigned char*)persistent_script - mem);",
          "content_same": false
        },
        {
          "line": 223,
          "old_api": null,
          "new_api": "zend_hash_num_elements",
          "old_text": null,
          "new_text": "zend_hash_num_elements(&persistent_script->script.function_table)",
          "old_line_content": "\t}",
          "new_line_content": "\tif (zend_hash_num_elements(&persistent_script->script.function_table) > 0) {",
          "content_same": false
        },
        {
          "line": 224,
          "old_api": null,
          "new_api": "CG",
          "old_text": null,
          "new_text": "CG(function_table)",
          "old_line_content": "",
          "new_line_content": "\t\tzend_accel_function_hash_copy(CG(function_table), &persistent_script->script.function_table);",
          "content_same": false
        },
        {
          "line": 354,
          "old_api": null,
          "new_api": "zend_adler32",
          "old_text": null,
          "new_text": "zend_adler32(checksum, mem, persistent_script_check_block_size)",
          "old_line_content": "\t}",
          "new_line_content": "\tzend_adler32(checksum, mem, persistent_script_check_block_size);",
          "content_same": false
        },
        {
          "line": 227,
          "old_api": null,
          "new_api": "zend_hash_num_elements",
          "old_text": null,
          "new_text": "zend_hash_num_elements(&persistent_script->script.class_table)",
          "old_line_content": "\t\tif (persistent_script->compiler_halt_offset != 0 &&",
          "new_line_content": "\tif (zend_hash_num_elements(&persistent_script->script.class_table) > 0) {",
          "content_same": false
        },
        {
          "line": 228,
          "old_api": null,
          "new_api": "CG",
          "old_text": null,
          "new_text": "CG(class_table)",
          "old_line_content": "\t\t    persistent_script->script.filename) {",
          "new_line_content": "\t\tzend_accel_class_hash_copy(CG(class_table), &persistent_script->script.class_table);",
          "content_same": false
        },
        {
          "line": 231,
          "old_api": null,
          "new_api": "EXPECTED",
          "old_text": null,
          "new_text": "EXPECTED(from_shared_memory)",
          "old_line_content": "",
          "new_line_content": "\tif (EXPECTED(from_shared_memory)) {",
          "content_same": false
        },
        {
          "line": 359,
          "old_api": null,
          "new_api": "zend_adler32",
          "old_text": null,
          "new_text": "zend_adler32(checksum, mem, size)",
          "old_line_content": "",
          "new_line_content": "\t\tchecksum = zend_adler32(checksum, mem, size);",
          "content_same": false
        },
        {
          "line": 238,
          "old_api": null,
          "new_api": "ZSTR_LEN",
          "old_text": null,
          "new_text": "ZSTR_LEN(persistent_script->script.filename)",
          "old_line_content": "",
          "new_line_content": "\t\t\tname = zend_mangle_property_name(haltoff, sizeof(haltoff) - 1, ZSTR_VAL(persistent_script->script.filename), ZSTR_LEN(persistent_script->script.filename), 0);",
          "content_same": false
        },
        {
          "line": 242,
          "old_api": null,
          "new_api": "zend_string_release_ex",
          "old_text": null,
          "new_text": "zend_string_release_ex(name, 0)",
          "old_line_content": "\t}",
          "new_line_content": "\t\t\tzend_string_release_ex(name, 0);",
          "content_same": false
        },
        {
          "line": 253,
          "old_api": null,
          "new_api": "zend_do_delayed_early_binding",
          "old_text": null,
          "new_text": "zend_do_delayed_early_binding(op_array, persistent_script->script.first_early_binding_opline)",
          "old_line_content": "\t}",
          "new_line_content": "\t\tzend_do_delayed_early_binding(op_array, persistent_script->script.first_early_binding_opline);",
          "content_same": false
        },
        {
          "line": 254,
          "old_api": null,
          "new_api": "CG",
          "old_text": null,
          "new_text": "CG(compiled_filename)",
          "old_line_content": "",
          "new_line_content": "\t\tCG(compiled_filename) = orig_compiled_filename;",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 248,
          "old_api": "CG",
          "new_api": null,
          "old_text": "CG(compiled_filename)",
          "new_text": null,
          "old_line_content": "\t\tCG(compiled_filename) = orig_compiled_filename;",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 225,
          "old_api": "EXPECTED",
          "new_api": null,
          "old_text": "EXPECTED(from_shared_memory)",
          "new_text": null,
          "old_line_content": "\tif (EXPECTED(from_shared_memory)) {",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 353,
          "old_api": "zend_adler32",
          "new_api": null,
          "old_text": "zend_adler32(checksum, mem, size)",
          "new_text": null,
          "old_line_content": "\t\tchecksum = zend_adler32(checksum, mem, size);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 324,
          "old_api": "ADLER32_DO1",
          "new_api": null,
          "old_text": "ADLER32_DO1(buf)",
          "new_text": null,
          "old_line_content": "\t\t\t\tADLER32_DO1(buf);",
          "new_line_content": "\t\t\t\tbuf += 16;",
          "content_same": false
        },
        {
          "line": 232,
          "old_api": "ZSTR_LEN",
          "new_api": null,
          "old_text": "ZSTR_LEN(persistent_script->script.filename)",
          "new_text": null,
          "old_line_content": "\t\t\tname = zend_mangle_property_name(haltoff, sizeof(haltoff) - 1, ZSTR_VAL(persistent_script->script.filename), ZSTR_LEN(persistent_script->script.filename), 0);",
          "new_line_content": "\t\t/* Register __COMPILER_HALT_OFFSET__ constant */",
          "content_same": false
        },
        {
          "line": 233,
          "old_api": "EG",
          "new_api": null,
          "old_text": "EG(zend_constants)",
          "new_text": null,
          "old_line_content": "\t\t\tif (!zend_hash_exists(EG(zend_constants), name)) {",
          "new_line_content": "\t\tif (persistent_script->compiler_halt_offset != 0 &&",
          "content_same": false
        },
        {
          "line": 234,
          "old_api": "ZSTR_LEN",
          "new_api": null,
          "old_text": "ZSTR_LEN(name)",
          "new_text": null,
          "old_line_content": "\t\t\t\tzend_register_long_constant(ZSTR_VAL(name), ZSTR_LEN(name), persistent_script->compiler_halt_offset, CONST_CS, 0);",
          "new_line_content": "\t\t    persistent_script->script.filename) {",
          "content_same": false
        },
        {
          "line": 236,
          "old_api": "zend_string_release_ex",
          "new_api": null,
          "old_text": "zend_string_release_ex(name, 0)",
          "new_text": null,
          "old_line_content": "\t\t\tzend_string_release_ex(name, 0);",
          "new_line_content": "\t\t\tstatic const char haltoff[] = \"__COMPILER_HALT_OFFSET__\";",
          "content_same": false
        },
        {
          "line": 305,
          "old_api": "ADLER32_DO16",
          "new_api": null,
          "old_text": "ADLER32_DO16(buf)",
          "new_text": null,
          "old_line_content": "\t\t\tADLER32_DO16(buf);",
          "new_line_content": "\tunsigned char *end;",
          "content_same": false
        },
        {
          "line": 214,
          "old_api": "emalloc",
          "new_api": null,
          "old_text": "emalloc(sizeof(zend_op_array))",
          "new_text": null,
          "old_line_content": "\top_array = (zend_op_array *) emalloc(sizeof(zend_op_array));",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 343,
          "old_api": "zend_adler32",
          "new_api": null,
          "old_text": "zend_adler32(checksum, mem, (unsigned char*)persistent_script - mem)",
          "new_text": null,
          "old_line_content": "\t\tchecksum = zend_adler32(checksum, mem, (unsigned char*)persistent_script - mem);",
          "new_line_content": "\tunsigned char *mem = (unsigned char*)persistent_script->mem;",
          "content_same": false
        },
        {
          "line": 221,
          "old_api": "zend_hash_num_elements",
          "new_api": null,
          "old_text": "zend_hash_num_elements(&persistent_script->script.class_table)",
          "new_text": null,
          "old_line_content": "\tif (zend_hash_num_elements(&persistent_script->script.class_table) > 0) {",
          "new_line_content": "\t*op_array = persistent_script->script.main_op_array;",
          "content_same": false
        },
        {
          "line": 217,
          "old_api": "zend_hash_num_elements",
          "new_api": null,
          "old_text": "zend_hash_num_elements(&persistent_script->script.function_table)",
          "new_text": null,
          "old_line_content": "\tif (zend_hash_num_elements(&persistent_script->script.function_table) > 0) {",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 218,
          "old_api": "CG",
          "new_api": null,
          "old_text": "CG(function_table)",
          "new_text": null,
          "old_line_content": "\t\tzend_accel_function_hash_copy(CG(function_table), &persistent_script->script.function_table);",
          "new_line_content": "\tzend_op_array *op_array;",
          "content_same": false
        },
        {
          "line": 247,
          "old_api": "zend_do_delayed_early_binding",
          "new_api": null,
          "old_text": "zend_do_delayed_early_binding(op_array, persistent_script->script.first_early_binding_opline)",
          "new_text": null,
          "old_line_content": "\t\tzend_do_delayed_early_binding(op_array, persistent_script->script.first_early_binding_opline);",
          "new_line_content": "\t\t}",
          "content_same": false
        },
        {
          "line": 348,
          "old_api": "zend_adler32",
          "new_api": null,
          "old_text": "zend_adler32(checksum, mem, persistent_script_check_block_size)",
          "new_text": null,
          "old_line_content": "\tzend_adler32(checksum, mem, persistent_script_check_block_size);",
          "new_line_content": "\tif (mem < (unsigned char*)persistent_script) {",
          "content_same": false
        },
        {
          "line": 317,
          "old_api": "ADLER32_DO16",
          "new_api": null,
          "old_text": "ADLER32_DO16(buf)",
          "new_text": null,
          "old_line_content": "\t\t\t\tADLER32_DO16(buf);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 222,
          "old_api": "CG",
          "new_api": null,
          "old_text": "CG(class_table)",
          "new_text": null,
          "old_line_content": "\t\tzend_accel_class_hash_copy(CG(class_table), &persistent_script->script.class_table);",
          "new_line_content": "",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 5,
      "total_additions": 22,
      "total_deletions": 18,
      "total_api_changes": 45
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 6,
        "api_related_lines": 45,
        "non_api_lines": 3,
        "non_api_line_numbers": [
          209,
          203,
          205
        ]
      }
    },
    "api_calls_before": 97,
    "api_calls_after": 101,
    "diff_info": {
      "added_lines": 6,
      "removed_lines": 0,
      "total_diff_lines": 19
    }
  }
}