{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/php-src/modified_file/32cd373dfd4e5b5710929c534f960694853a02e0",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/php-src/modified_file/32cd373dfd4e5b5710929c534f960694853a02e0/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/php-src/modified_file/32cd373dfd4e5b5710929c534f960694853a02e0/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/php-src/modified_file/32cd373dfd4e5b5710929c534f960694853a02e0/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 1071,
          "old_api": "PACKET_READ",
          "new_api": "DBG_INF",
          "old_text": "PACKET_READ(conn, &result_packet)",
          "new_text": "DBG_INF(\"empty password fast path\")",
          "old_line_content": "\tif (FAIL == PACKET_READ(conn, &result_packet)) {",
          "new_line_content": "\t\tDBG_INF(\"empty password fast path\");",
          "content_same": false
        },
        {
          "line": 1084,
          "old_api": "DBG_INF",
          "new_api": "DBG_ERR_FMT",
          "old_text": "DBG_INF(\"auth switch response\")",
          "new_text": "DBG_ERR_FMT(\"ERROR:%u [SQLSTATE:%s] %s\", result_packet.error_no, result_packet.sqlstate, result_packet.error)",
          "old_line_content": "\t\t\tDBG_INF(\"auth switch response\");",
          "new_line_content": "\t\t\t\tDBG_ERR_FMT(\"ERROR:%u [SQLSTATE:%s] %s\", result_packet.error_no, result_packet.sqlstate, result_packet.error);",
          "content_same": false
        },
        {
          "line": 1089,
          "old_api": "DBG_RETURN",
          "new_api": "DBG_INF",
          "old_text": "DBG_RETURN(FAIL)",
          "new_text": "DBG_INF(\"auth switch response\")",
          "old_line_content": "\t\t\tDBG_RETURN(FAIL);",
          "new_line_content": "\t\t\tDBG_INF(\"auth switch response\");",
          "content_same": false
        },
        {
          "line": 1094,
          "old_api": "is_secure_transport",
          "new_api": "DBG_RETURN",
          "old_text": "is_secure_transport(conn)",
          "new_text": "DBG_RETURN(FAIL)",
          "old_line_content": "\t\t\tif (is_secure_transport(conn)) {",
          "new_line_content": "\t\t\tDBG_RETURN(FAIL);",
          "content_same": false
        },
        {
          "line": 1103,
          "old_api": "efree",
          "new_api": "PACKET_WRITE",
          "old_text": "efree(result_packet.password)",
          "new_text": "PACKET_WRITE(conn, &result_packet)",
          "old_line_content": "\t\t\t\tefree(result_packet.password);",
          "new_line_content": "\t\t\t\tPACKET_WRITE(conn, &result_packet);",
          "content_same": false
        },
        {
          "line": 1105,
          "old_api": "DBG_RETURN",
          "new_api": "DBG_INF",
          "old_text": "DBG_RETURN(PASS)",
          "new_text": "DBG_INF(\"fast path failed, doing full auth via insecure transport\")",
          "old_line_content": "\t\t\tDBG_RETURN(PASS);",
          "new_line_content": "\t\t\t\tDBG_INF(\"fast path failed, doing full auth via insecure transport\");",
          "content_same": false
        },
        {
          "line": 1110,
          "old_api": "php_error_docref",
          "new_api": "DBG_RETURN",
          "old_text": "php_error_docref(NULL, E_WARNING, \"Unexpected server response while doing caching_sha2 auth: %i\", result_packet.response_code)",
          "new_text": "DBG_RETURN(PASS)",
          "old_line_content": "\t\t\tphp_error_docref(NULL, E_WARNING, \"Unexpected server response while doing caching_sha2 auth: %i\", result_packet.response_code);",
          "new_line_content": "\t\t\tDBG_RETURN(PASS);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 1152,
          "old_api": null,
          "new_api": "ysqlnd_plugin_register_ex",
          "old_text": null,
          "new_text": "ysqlnd_plugin_register_ex((struct st_mysqlnd_plugin_header *) &mysqlnd_pam_authentication_plugin);",
          "old_line_content": "}",
          "new_line_content": "\tmysqlnd_plugin_register_ex((struct st_mysqlnd_plugin_header *) &mysqlnd_pam_authentication_plugin);",
          "content_same": false
        },
        {
          "line": 1154,
          "old_api": null,
          "new_api": "ysqlnd_plugin_register_ex",
          "old_text": null,
          "new_text": "ysqlnd_plugin_register_ex((struct st_mysqlnd_plugin_header *) &mysqlnd_caching_sha2_auth_plugin);",
          "old_line_content": "",
          "new_line_content": "\tmysqlnd_plugin_register_ex((struct st_mysqlnd_plugin_header *) &mysqlnd_caching_sha2_auth_plugin);",
          "content_same": false
        },
        {
          "line": 1155,
          "old_api": null,
          "new_api": "ysqlnd_plugin_register_ex",
          "old_text": null,
          "new_text": "ysqlnd_plugin_register_ex((struct st_mysqlnd_plugin_header *) &mysqlnd_sha256_authentication_plugin);",
          "old_line_content": "",
          "new_line_content": "\tmysqlnd_plugin_register_ex((struct st_mysqlnd_plugin_header *) &mysqlnd_sha256_authentication_plugin);",
          "content_same": false
        },
        {
          "line": 1096,
          "old_api": null,
          "new_api": "DBG_INF",
          "old_text": null,
          "new_text": "DBG_INF(\"fast path succeeded\")",
          "old_line_content": "\t\t\t\tresult_packet.password = (zend_uchar *)passwd;",
          "new_line_content": "\t\t\tDBG_INF(\"fast path succeeded\");",
          "content_same": false
        },
        {
          "line": 1097,
          "old_api": null,
          "new_api": "DBG_RETURN",
          "old_text": null,
          "new_text": "DBG_RETURN(PASS)",
          "old_line_content": "\t\t\t\tresult_packet.password_len = passwd_len + 1;",
          "new_line_content": "\t\t\tDBG_RETURN(PASS);",
          "content_same": false
        },
        {
          "line": 1115,
          "old_api": null,
          "new_api": "php_error_docref",
          "old_text": null,
          "new_text": "php_error_docref(NULL, E_WARNING, \"Unexpected server response while doing caching_sha2 auth: %i\", result_packet.response_code)",
          "old_line_content": "/* }}} */",
          "new_line_content": "\t\t\tphp_error_docref(NULL, E_WARNING, \"Unexpected server response while doing caching_sha2 auth: %i\", result_packet.response_code);",
          "content_same": false
        },
        {
          "line": 1099,
          "old_api": null,
          "new_api": "is_secure_transport",
          "old_text": null,
          "new_text": "is_secure_transport(conn)",
          "old_line_content": "\t\t\t} else {",
          "new_line_content": "\t\t\tif (is_secure_transport(conn)) {",
          "content_same": false
        },
        {
          "line": 1106,
          "old_api": null,
          "new_api": "mysqlnd_caching_sha2_get_and_use_key",
          "old_text": null,
          "new_text": "mysqlnd_caching_sha2_get_and_use_key(conn, auth_plugin_data, auth_plugin_data_len, &result_packet.password, passwd, passwd_len)",
          "old_line_content": "\t\tcase 2:",
          "new_line_content": "\t\t\t\tresult_packet.password_len = mysqlnd_caching_sha2_get_and_use_key(conn, auth_plugin_data, auth_plugin_data_len, &result_packet.password, passwd, passwd_len);",
          "content_same": false
        },
        {
          "line": 1075,
          "old_api": null,
          "new_api": "init_cached_sha2_result_packet",
          "old_text": null,
          "new_text": "conn->payload_decoder_factory->m.init_cached_sha2_result_packet(&result_packet)",
          "old_line_content": "\tswitch (result_packet.response_code) {",
          "new_line_content": "\tconn->payload_decoder_factory->m.init_cached_sha2_result_packet(&result_packet);",
          "content_same": false
        },
        {
          "line": 1076,
          "old_api": null,
          "new_api": "PACKET_READ",
          "old_text": null,
          "new_text": "PACKET_READ(conn, &result_packet)",
          "old_line_content": "\t\tcase 0xFF:",
          "new_line_content": "\tif (FAIL == PACKET_READ(conn, &result_packet)) {",
          "content_same": false
        },
        {
          "line": 1077,
          "old_api": null,
          "new_api": "DBG_RETURN",
          "old_text": null,
          "new_text": "DBG_RETURN(PASS)",
          "old_line_content": "\t\t\tif (result_packet.sqlstate[0]) {",
          "new_line_content": "\t\tDBG_RETURN(PASS);",
          "content_same": false
        },
        {
          "line": 1107,
          "old_api": null,
          "new_api": "PACKET_WRITE",
          "old_text": null,
          "new_text": "PACKET_WRITE(conn, &result_packet)",
          "old_line_content": "\t\t\t// The server tried to send a key, which we didn't expect",
          "new_line_content": "\t\t\t\tPACKET_WRITE(conn, &result_packet);",
          "content_same": false
        },
        {
          "line": 1108,
          "old_api": null,
          "new_api": "efree",
          "old_text": null,
          "new_text": "efree(result_packet.password)",
          "old_line_content": "\t\t\t// fall-through",
          "new_line_content": "\t\t\t\tefree(result_packet.password);",
          "content_same": false
        },
        {
          "line": 1118,
          "old_api": null,
          "new_api": "DBG_RETURN",
          "old_text": null,
          "new_text": "DBG_RETURN(PASS)",
          "old_line_content": "{",
          "new_line_content": "\tDBG_RETURN(PASS);",
          "content_same": false
        },
        {
          "line": 1083,
          "old_api": null,
          "new_api": "strlcpy",
          "old_text": null,
          "new_text": "strlcpy(conn->error_info->sqlstate, result_packet.sqlstate, sizeof(conn->error_info->sqlstate))",
          "old_line_content": "\t\tcase 0xFE:",
          "new_line_content": "\t\t\t\tstrlcpy(conn->error_info->sqlstate, result_packet.sqlstate, sizeof(conn->error_info->sqlstate));",
          "content_same": false
        },
        {
          "line": 1151,
          "old_api": null,
          "new_api": "ysqlnd_plugin_register_ex",
          "old_text": null,
          "new_text": "ysqlnd_plugin_register_ex((struct st_mysqlnd_plugin_header *) &mysqlnd_native_auth_plugin);",
          "old_line_content": "#endif",
          "new_line_content": "\tmysqlnd_plugin_register_ex((struct st_mysqlnd_plugin_header *) &mysqlnd_native_auth_plugin);",
          "content_same": false
        },
        {
          "line": 1086,
          "old_api": null,
          "new_api": "SET_CLIENT_ERROR",
          "old_text": null,
          "new_text": "SET_CLIENT_ERROR(conn->error_info, result_packet.error_no, UNKNOWN_SQLSTATE, result_packet.error)",
          "old_line_content": "\t\t\t*new_auth_protocol_len = result_packet.new_auth_protocol_len;",
          "new_line_content": "\t\t\tSET_CLIENT_ERROR(conn->error_info, result_packet.error_no, UNKNOWN_SQLSTATE, result_packet.error);",
          "content_same": false
        },
        {
          "line": 1087,
          "old_api": null,
          "new_api": "DBG_RETURN",
          "old_text": null,
          "new_text": "DBG_RETURN(FAIL)",
          "old_line_content": "\t\t\t*new_auth_protocol_data = result_packet.new_auth_protocol_data;",
          "new_line_content": "\t\t\tDBG_RETURN(FAIL);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 1113,
          "old_api": "DBG_RETURN",
          "new_api": null,
          "old_text": "DBG_RETURN(PASS)",
          "new_text": null,
          "old_line_content": "\tDBG_RETURN(PASS);",
          "new_line_content": "\t\t\t// fall-through",
          "content_same": false
        },
        {
          "line": 1091,
          "old_api": "DBG_INF",
          "new_api": null,
          "old_text": "DBG_INF(\"fast path succeeded\")",
          "new_text": null,
          "old_line_content": "\t\t\tDBG_INF(\"fast path succeeded\");",
          "new_line_content": "\t\t\t*new_auth_protocol_len = result_packet.new_auth_protocol_len;",
          "content_same": false
        },
        {
          "line": 1092,
          "old_api": "DBG_RETURN",
          "new_api": null,
          "old_text": "DBG_RETURN(PASS)",
          "new_text": null,
          "old_line_content": "\t\t\tDBG_RETURN(PASS);",
          "new_line_content": "\t\t\t*new_auth_protocol_data = result_packet.new_auth_protocol_data;",
          "content_same": false
        },
        {
          "line": 1146,
          "old_api": "ysqlnd_plugin_register_ex",
          "new_api": null,
          "old_text": "ysqlnd_plugin_register_ex((struct st_mysqlnd_plugin_header *) &mysqlnd_native_auth_plugin);",
          "new_text": null,
          "old_line_content": "\tmysqlnd_plugin_register_ex((struct st_mysqlnd_plugin_header *) &mysqlnd_native_auth_plugin);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1095,
          "old_api": "DBG_INF",
          "new_api": null,
          "old_text": "DBG_INF(\"fast path failed, doing full auth via secure transport\")",
          "new_text": null,
          "old_line_content": "\t\t\t\tDBG_INF(\"fast path failed, doing full auth via secure transport\");",
          "new_line_content": "\t\tcase 3:",
          "content_same": false
        },
        {
          "line": 1098,
          "old_api": "PACKET_WRITE",
          "new_api": null,
          "old_text": "PACKET_WRITE(conn, &result_packet)",
          "new_text": null,
          "old_line_content": "\t\t\t\tPACKET_WRITE(conn, &result_packet);",
          "new_line_content": "\t\tcase 4:",
          "content_same": false
        },
        {
          "line": 1069,
          "old_api": "init_cached_sha2_result_packet",
          "new_api": null,
          "old_text": "conn->payload_decoder_factory->m.init_cached_sha2_result_packet(&result_packet)",
          "new_text": null,
          "old_line_content": "\tconn->payload_decoder_factory->m.init_cached_sha2_result_packet(&result_packet);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1101,
          "old_api": "mysqlnd_caching_sha2_get_and_use_key",
          "new_api": null,
          "old_text": "mysqlnd_caching_sha2_get_and_use_key(conn, auth_plugin_data, auth_plugin_data_len, &result_packet.password, passwd, passwd_len)",
          "new_text": null,
          "old_line_content": "\t\t\t\tresult_packet.password_len = mysqlnd_caching_sha2_get_and_use_key(conn, auth_plugin_data, auth_plugin_data_len, &result_packet.password, passwd, passwd_len);",
          "new_line_content": "\t\t\t\tresult_packet.password = (zend_uchar *)passwd;",
          "content_same": false
        },
        {
          "line": 1102,
          "old_api": "PACKET_WRITE",
          "new_api": null,
          "old_text": "PACKET_WRITE(conn, &result_packet)",
          "new_text": null,
          "old_line_content": "\t\t\t\tPACKET_WRITE(conn, &result_packet);",
          "new_line_content": "\t\t\t\tresult_packet.password_len = passwd_len + 1;",
          "content_same": false
        },
        {
          "line": 1078,
          "old_api": "strlcpy",
          "new_api": null,
          "old_text": "strlcpy(conn->error_info->sqlstate, result_packet.sqlstate, sizeof(conn->error_info->sqlstate))",
          "new_text": null,
          "old_line_content": "\t\t\t\tstrlcpy(conn->error_info->sqlstate, result_packet.sqlstate, sizeof(conn->error_info->sqlstate));",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 1079,
          "old_api": "DBG_ERR_FMT",
          "new_api": null,
          "old_text": "DBG_ERR_FMT(\"ERROR:%u [SQLSTATE:%s] %s\", result_packet.error_no, result_packet.sqlstate, result_packet.error)",
          "new_text": null,
          "old_line_content": "\t\t\t\tDBG_ERR_FMT(\"ERROR:%u [SQLSTATE:%s] %s\", result_packet.error_no, result_packet.sqlstate, result_packet.error);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1081,
          "old_api": "SET_CLIENT_ERROR",
          "new_api": null,
          "old_text": "SET_CLIENT_ERROR(conn->error_info, result_packet.error_no, UNKNOWN_SQLSTATE, result_packet.error)",
          "new_text": null,
          "old_line_content": "\t\t\tSET_CLIENT_ERROR(conn->error_info, result_packet.error_no, UNKNOWN_SQLSTATE, result_packet.error);",
          "new_line_content": "\t\tcase 0xFF:",
          "content_same": false
        },
        {
          "line": 1082,
          "old_api": "DBG_RETURN",
          "new_api": null,
          "old_text": "DBG_RETURN(FAIL)",
          "new_text": null,
          "old_line_content": "\t\t\tDBG_RETURN(FAIL);",
          "new_line_content": "\t\t\tif (result_packet.sqlstate[0]) {",
          "content_same": false
        },
        {
          "line": 1147,
          "old_api": "ysqlnd_plugin_register_ex",
          "new_api": null,
          "old_text": "ysqlnd_plugin_register_ex((struct st_mysqlnd_plugin_header *) &mysqlnd_pam_authentication_plugin);",
          "new_text": null,
          "old_line_content": "\tmysqlnd_plugin_register_ex((struct st_mysqlnd_plugin_header *) &mysqlnd_pam_authentication_plugin);",
          "new_line_content": "/* {{{ mysqlnd_register_builtin_authentication_plugins */",
          "content_same": false
        },
        {
          "line": 1149,
          "old_api": "ysqlnd_plugin_register_ex",
          "new_api": null,
          "old_text": "ysqlnd_plugin_register_ex((struct st_mysqlnd_plugin_header *) &mysqlnd_caching_sha2_auth_plugin);",
          "new_text": null,
          "old_line_content": "\tmysqlnd_plugin_register_ex((struct st_mysqlnd_plugin_header *) &mysqlnd_caching_sha2_auth_plugin);",
          "new_line_content": "mysqlnd_register_builtin_authentication_plugins(void)",
          "content_same": false
        },
        {
          "line": 1150,
          "old_api": "ysqlnd_plugin_register_ex",
          "new_api": null,
          "old_text": "ysqlnd_plugin_register_ex((struct st_mysqlnd_plugin_header *) &mysqlnd_sha256_authentication_plugin);",
          "new_text": null,
          "old_line_content": "\tmysqlnd_plugin_register_ex((struct st_mysqlnd_plugin_header *) &mysqlnd_sha256_authentication_plugin);",
          "new_line_content": "{",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 7,
      "total_additions": 18,
      "total_deletions": 16,
      "total_api_changes": 41
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 7,
        "api_related_lines": 41,
        "non_api_lines": 4,
        "non_api_line_numbers": [
          1072,
          1073,
          1074,
          1070
        ]
      }
    },
    "api_calls_before": 285,
    "api_calls_after": 287,
    "diff_info": {
      "added_lines": 6,
      "removed_lines": 1,
      "total_diff_lines": 20
    }
  }
}