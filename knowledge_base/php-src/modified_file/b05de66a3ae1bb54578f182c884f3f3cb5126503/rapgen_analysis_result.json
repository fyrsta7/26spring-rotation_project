{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/php-src/modified_file/b05de66a3ae1bb54578f182c884f3f3cb5126503",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/php-src/modified_file/b05de66a3ae1bb54578f182c884f3f3cb5126503/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/php-src/modified_file/b05de66a3ae1bb54578f182c884f3f3cb5126503/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/php-src/modified_file/b05de66a3ae1bb54578f182c884f3f3cb5126503/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 80,
          "old_api": "xmlStrcat",
          "new_api": "smart_str_appends",
          "old_text": "xmlStrcat(wholetext, node->content)",
          "new_text": "smart_str_appends(&str, (const char *) node->content)",
          "old_line_content": "\t\twholetext = xmlStrcat(wholetext, node->content);",
          "new_line_content": "\t\tsmart_str_appends(&str, (const char *) node->content);",
          "content_same": false
        },
        {
          "line": 113,
          "old_api": "RETURN_THROWS",
          "new_api": "zend_argument_value_error",
          "old_text": "RETURN_THROWS()",
          "new_text": "zend_argument_value_error(1, \"must be greater than or equal to 0\")",
          "old_line_content": "\t\tRETURN_THROWS();",
          "new_line_content": "\t\tzend_argument_value_error(1, \"must be greater than or equal to 0\");",
          "content_same": false
        },
        {
          "line": 118,
          "old_api": "zend_argument_value_error",
          "new_api": "xmlUTF8Strlen",
          "old_text": "zend_argument_value_error(1, \"must be greater than or equal to 0\")",
          "new_text": "xmlUTF8Strlen(cur)",
          "old_line_content": "\t\tzend_argument_value_error(1, \"must be greater than or equal to 0\");",
          "new_line_content": "\tlength = xmlUTF8Strlen(cur);",
          "content_same": false
        },
        {
          "line": 122,
          "old_api": "php_dom_get_content_or_empty",
          "new_api": "php_dom_throw_error",
          "old_text": "php_dom_get_content_or_empty(node)",
          "new_text": "php_dom_throw_error(INDEX_SIZE_ERR, /* strict */ true)",
          "old_line_content": "\tconst xmlChar *cur = php_dom_get_content_or_empty(node);",
          "new_line_content": "\t\t\tphp_dom_throw_error(INDEX_SIZE_ERR, /* strict */ true);",
          "content_same": false
        },
        {
          "line": 127,
          "old_api": "php_dom_throw_error",
          "new_api": "xmlUTF8Strndup",
          "old_text": "php_dom_throw_error(INDEX_SIZE_ERR, /* strict */ true)",
          "new_text": "xmlUTF8Strndup(cur, (int)offset)",
          "old_line_content": "\t\t\tphp_dom_throw_error(INDEX_SIZE_ERR, /* strict */ true);",
          "new_line_content": "\tfirst = xmlUTF8Strndup(cur, (int)offset);",
          "content_same": false
        },
        {
          "line": 133,
          "old_api": "xmlUTF8Strsub",
          "new_api": "xmlFree",
          "old_text": "xmlUTF8Strsub(cur, (int)offset, (int)(length - offset))",
          "new_text": "xmlFree(first)",
          "old_line_content": "\tsecond = xmlUTF8Strsub(cur, (int)offset, (int)(length - offset));",
          "new_line_content": "\txmlFree(first);",
          "content_same": false
        },
        {
          "line": 138,
          "old_api": "xmlFree",
          "new_api": "RETURN_THROWS",
          "old_text": "xmlFree(first)",
          "new_text": "RETURN_THROWS()",
          "old_line_content": "\txmlFree(first);",
          "new_line_content": "\t\tRETURN_THROWS();",
          "content_same": false
        },
        {
          "line": 143,
          "old_api": "RETURN_THROWS",
          "new_api": "xmlAddNextSibling",
          "old_text": "RETURN_THROWS()",
          "new_text": "xmlAddNextSibling(node, nnode)",
          "old_line_content": "\t\tRETURN_THROWS();",
          "new_line_content": "\t\txmlAddNextSibling(node, nnode);",
          "content_same": false
        },
        {
          "line": 166,
          "old_api": "zend_parse_parameters_none",
          "new_api": "xmlIsBlankNode",
          "old_text": "zend_parse_parameters_none()",
          "new_text": "xmlIsBlankNode(node)",
          "old_line_content": "\tif (zend_parse_parameters_none() == FAILURE) {",
          "new_line_content": "\tif (xmlIsBlankNode(node)) {",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 128,
          "old_api": null,
          "new_api": "xmlUTF8Strsub",
          "old_text": null,
          "new_text": "xmlUTF8Strsub(cur, (int)offset, (int)(length - offset))",
          "old_line_content": "\t\t}",
          "new_line_content": "\tsecond = xmlUTF8Strsub(cur, (int)offset, (int)(length - offset));",
          "content_same": false
        },
        {
          "line": 161,
          "old_api": null,
          "new_api": "zend_parse_parameters_none",
          "old_text": null,
          "new_text": "zend_parse_parameters_none()",
          "old_line_content": "\tzval       *id;",
          "new_line_content": "\tif (zend_parse_parameters_none() == FAILURE) {",
          "content_same": false
        },
        {
          "line": 130,
          "old_api": null,
          "new_api": "xmlNodeSetContent",
          "old_text": null,
          "new_text": "xmlNodeSetContent(node, first)",
          "old_line_content": "\t}",
          "new_line_content": "\txmlNodeSetContent(node, first);",
          "content_same": false
        },
        {
          "line": 131,
          "old_api": null,
          "new_api": "xmlNewDocText",
          "old_text": null,
          "new_text": "xmlNewDocText(node->doc, second)",
          "old_line_content": "",
          "new_line_content": "\tnnode = xmlNewDocText(node->doc, second);",
          "content_same": false
        },
        {
          "line": 162,
          "old_api": null,
          "new_api": "RETURN_THROWS",
          "old_text": null,
          "new_text": "RETURN_THROWS()",
          "old_line_content": "\txmlNodePtr  node;",
          "new_line_content": "\t\tRETURN_THROWS();",
          "content_same": false
        },
        {
          "line": 164,
          "old_api": null,
          "new_api": "DOM_GET_OBJ",
          "old_text": null,
          "new_text": "DOM_GET_OBJ(node, id, xmlNodePtr, intern)",
          "old_line_content": "",
          "new_line_content": "\tDOM_GET_OBJ(node, id, xmlNodePtr, intern);",
          "content_same": false
        },
        {
          "line": 134,
          "old_api": null,
          "new_api": "xmlFree",
          "old_text": null,
          "new_text": "xmlFree(second)",
          "old_line_content": "",
          "new_line_content": "\txmlFree(second);",
          "content_same": false
        },
        {
          "line": 137,
          "old_api": null,
          "new_api": "php_dom_throw_error",
          "old_text": null,
          "new_text": "php_dom_throw_error(INVALID_STATE_ERR, /* strict */ true)",
          "old_line_content": "",
          "new_line_content": "\t\tphp_dom_throw_error(INVALID_STATE_ERR, /* strict */ true);",
          "content_same": false
        },
        {
          "line": 107,
          "old_api": null,
          "new_api": "ZEND_NUM_ARGS",
          "old_text": null,
          "new_text": "ZEND_NUM_ARGS()",
          "old_line_content": "\tzend_long        offset;",
          "new_line_content": "\tif (zend_parse_parameters(ZEND_NUM_ARGS(), \"l\", &offset) == FAILURE) {",
          "content_same": false
        },
        {
          "line": 108,
          "old_api": null,
          "new_api": "RETURN_THROWS",
          "old_text": null,
          "new_text": "RETURN_THROWS()",
          "old_line_content": "\tint         length;",
          "new_line_content": "\t\tRETURN_THROWS();",
          "content_same": false
        },
        {
          "line": 110,
          "old_api": null,
          "new_api": "DOM_GET_OBJ",
          "old_text": null,
          "new_text": "DOM_GET_OBJ(node, id, xmlNodePtr, intern)",
          "old_line_content": "",
          "new_line_content": "\tDOM_GET_OBJ(node, id, xmlNodePtr, intern);",
          "content_same": false
        },
        {
          "line": 114,
          "old_api": null,
          "new_api": "RETURN_THROWS",
          "old_text": null,
          "new_text": "RETURN_THROWS()",
          "old_line_content": "\t}",
          "new_line_content": "\t\tRETURN_THROWS();",
          "content_same": false
        },
        {
          "line": 147,
          "old_api": null,
          "new_api": "php_dom_create_object",
          "old_text": null,
          "new_text": "php_dom_create_object(nnode, return_value, intern)",
          "old_line_content": "\t\tnnode->type = XML_ELEMENT_NODE;",
          "new_line_content": "\tphp_dom_create_object(nnode, return_value, intern);",
          "content_same": false
        },
        {
          "line": 84,
          "old_api": null,
          "new_api": "smart_str_extract",
          "old_text": null,
          "new_text": "smart_str_extract(&str)",
          "old_line_content": "\tif (wholetext != NULL) {",
          "new_line_content": "\tZVAL_STR(retval, smart_str_extract(&str));",
          "content_same": false
        },
        {
          "line": 117,
          "old_api": null,
          "new_api": "php_dom_get_content_or_empty",
          "old_text": null,
          "new_text": "php_dom_get_content_or_empty(node)",
          "old_line_content": "\tif (offset < 0) {",
          "new_line_content": "\tconst xmlChar *cur = php_dom_get_content_or_empty(node);",
          "content_same": false
        },
        {
          "line": 120,
          "old_api": null,
          "new_api": "ZEND_LONG_INT_OVFL",
          "old_text": null,
          "new_text": "ZEND_LONG_INT_OVFL(offset)",
          "old_line_content": "\t}",
          "new_line_content": "\tif (ZEND_LONG_INT_OVFL(offset) || (int)offset > length) {",
          "content_same": false
        },
        {
          "line": 121,
          "old_api": null,
          "new_api": "php_dom_follow_spec_intern",
          "old_text": null,
          "new_text": "php_dom_follow_spec_intern(intern)",
          "old_line_content": "",
          "new_line_content": "\t\tif (php_dom_follow_spec_intern(intern)) {",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 132,
          "old_api": "xmlUTF8Strndup",
          "new_api": null,
          "old_text": "xmlUTF8Strndup(cur, (int)offset)",
          "new_text": null,
          "old_line_content": "\tfirst = xmlUTF8Strndup(cur, (int)offset);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 135,
          "old_api": "xmlNodeSetContent",
          "new_api": null,
          "old_text": "xmlNodeSetContent(node, first)",
          "new_text": null,
          "old_line_content": "\txmlNodeSetContent(node, first);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 136,
          "old_api": "xmlNewDocText",
          "new_api": null,
          "old_text": "xmlNewDocText(node->doc, second)",
          "new_text": null,
          "old_line_content": "\tnnode = xmlNewDocText(node->doc, second);",
          "new_line_content": "\tif (nnode == NULL) {",
          "content_same": false
        },
        {
          "line": 139,
          "old_api": "xmlFree",
          "new_api": null,
          "old_text": "xmlFree(second)",
          "new_text": null,
          "old_line_content": "\txmlFree(second);",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 142,
          "old_api": "php_dom_throw_error",
          "new_api": null,
          "old_text": "php_dom_throw_error(INVALID_STATE_ERR, /* strict */ true)",
          "new_text": null,
          "old_line_content": "\t\tphp_dom_throw_error(INVALID_STATE_ERR, /* strict */ true);",
          "new_line_content": "\t\tnnode->type = XML_ELEMENT_NODE;",
          "content_same": false
        },
        {
          "line": 148,
          "old_api": "xmlAddNextSibling",
          "new_api": null,
          "old_text": "xmlAddNextSibling(node, nnode)",
          "new_text": null,
          "old_line_content": "\t\txmlAddNextSibling(node, nnode);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 152,
          "old_api": "php_dom_create_object",
          "new_api": null,
          "old_text": "php_dom_create_object(nnode, return_value, intern)",
          "new_text": null,
          "old_line_content": "\tphp_dom_create_object(nnode, return_value, intern);",
          "new_line_content": "Since: DOM Level 3",
          "content_same": false
        },
        {
          "line": 167,
          "old_api": "RETURN_THROWS",
          "new_api": null,
          "old_text": "RETURN_THROWS()",
          "new_text": null,
          "old_line_content": "\t\tRETURN_THROWS();",
          "new_line_content": "\t\tRETURN_TRUE;",
          "content_same": false
        },
        {
          "line": 169,
          "old_api": "DOM_GET_OBJ",
          "new_api": null,
          "old_text": "DOM_GET_OBJ(node, id, xmlNodePtr, intern)",
          "new_text": null,
          "old_line_content": "\tDOM_GET_OBJ(node, id, xmlNodePtr, intern);",
          "new_line_content": "\t\tRETURN_FALSE;",
          "content_same": false
        },
        {
          "line": 171,
          "old_api": "xmlIsBlankNode",
          "new_api": null,
          "old_text": "xmlIsBlankNode(node)",
          "new_text": null,
          "old_line_content": "\tif (xmlIsBlankNode(node)) {",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 85,
          "old_api": "ZVAL_STRING",
          "new_api": null,
          "old_text": "ZVAL_STRING(retval, (char *) wholetext)",
          "new_text": null,
          "old_line_content": "\t\tZVAL_STRING(retval, (char *) wholetext);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 86,
          "old_api": "xmlFree",
          "new_api": null,
          "old_text": "xmlFree(wholetext)",
          "new_text": null,
          "old_line_content": "\t\txmlFree(wholetext);",
          "new_line_content": "\treturn SUCCESS;",
          "content_same": false
        },
        {
          "line": 88,
          "old_api": "ZVAL_EMPTY_STRING",
          "new_api": null,
          "old_text": "ZVAL_EMPTY_STRING(retval)",
          "new_text": null,
          "old_line_content": "\t\tZVAL_EMPTY_STRING(retval);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 112,
          "old_api": "ZEND_NUM_ARGS",
          "new_api": null,
          "old_text": "ZEND_NUM_ARGS()",
          "new_text": null,
          "old_line_content": "\tif (zend_parse_parameters(ZEND_NUM_ARGS(), \"l\", &offset) == FAILURE) {",
          "new_line_content": "\tif (offset < 0) {",
          "content_same": false
        },
        {
          "line": 115,
          "old_api": "DOM_GET_OBJ",
          "new_api": null,
          "old_text": "DOM_GET_OBJ(node, id, xmlNodePtr, intern)",
          "new_text": null,
          "old_line_content": "\tDOM_GET_OBJ(node, id, xmlNodePtr, intern);",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 119,
          "old_api": "RETURN_THROWS",
          "new_api": null,
          "old_text": "RETURN_THROWS()",
          "new_text": null,
          "old_line_content": "\t\tRETURN_THROWS();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 123,
          "old_api": "xmlUTF8Strlen",
          "new_api": null,
          "old_text": "xmlUTF8Strlen(cur)",
          "new_text": null,
          "old_line_content": "\tlength = xmlUTF8Strlen(cur);",
          "new_line_content": "\t\t}",
          "content_same": false
        },
        {
          "line": 125,
          "old_api": "ZEND_LONG_INT_OVFL",
          "new_api": null,
          "old_text": "ZEND_LONG_INT_OVFL(offset)",
          "new_text": null,
          "old_line_content": "\tif (ZEND_LONG_INT_OVFL(offset) || (int)offset > length) {",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 126,
          "old_api": "php_dom_follow_spec_intern",
          "new_api": null,
          "old_text": "php_dom_follow_spec_intern(intern)",
          "new_text": null,
          "old_line_content": "\t\tif (php_dom_follow_spec_intern(intern)) {",
          "new_line_content": "",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 9,
      "total_additions": 17,
      "total_deletions": 19,
      "total_api_changes": 45
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 8,
        "api_related_lines": 45,
        "non_api_lines": 3,
        "non_api_line_numbers": [
          89,
          87,
          71
        ]
      }
    },
    "api_calls_before": 40,
    "api_calls_after": 39,
    "diff_info": {
      "added_lines": 3,
      "removed_lines": 8,
      "total_diff_lines": 33
    }
  }
}