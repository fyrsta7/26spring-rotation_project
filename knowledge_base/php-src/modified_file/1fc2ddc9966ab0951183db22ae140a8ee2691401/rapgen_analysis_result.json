{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/php-src/modified_file/1fc2ddc9966ab0951183db22ae140a8ee2691401",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/php-src/modified_file/1fc2ddc9966ab0951183db22ae140a8ee2691401/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/php-src/modified_file/1fc2ddc9966ab0951183db22ae140a8ee2691401/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/php-src/modified_file/1fc2ddc9966ab0951183db22ae140a8ee2691401/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 439,
          "old_api": "d_string_free",
          "new_api": "generate",
          "old_text": "d_string_free(retval);\n\t",
          "new_text": "ine.algo->generate(engine.state);\n\t",
          "old_line_content": "\t\t\t\tzend_string_free(retval);",
          "new_line_content": "\t\t\tphp_random_result result = engine.algo->generate(engine.state);",
          "content_same": false
        },
        {
          "line": 440,
          "old_api": "URN_THROWS",
          "new_api": "exception)) {",
          "old_text": "URN_THROWS();\n\t",
          "new_text": "exception)) {",
          "old_line_content": "\t\t\t\tRETURN_THROWS();",
          "new_line_content": "\t\t\tif (EG(exception)) {",
          "content_same": false
        },
        {
          "line": 481,
          "old_api": "RY_ADDREF",
          "new_api": "D_PARSE_PARAMETERS_NONE",
          "old_text": "RY_ADDREF(t);\n\t",
          "new_text": "D_PARSE_PARAMETERS_NONE();\n\n",
          "old_line_content": "\tZ_TRY_ADDREF(t);",
          "new_line_content": "\tZEND_PARSE_PARAMETERS_NONE();",
          "content_same": false
        },
        {
          "line": 499,
          "old_api": "d_hash_num_elements",
          "new_api": "ARAM_ARRAY_HT",
          "old_text": "d_hash_num_elements(d) !=",
          "new_text": "ARAM_ARRAY_HT(d);\n\t",
          "old_line_content": "\tif (zend_hash_num_elements(d) != 1) {",
          "new_line_content": "\t\tZ_PARAM_ARRAY_HT(d);",
          "content_same": false
        },
        {
          "line": 500,
          "old_api": "d_throw_exception",
          "new_api": "D_PARSE_PARAMETERS_END",
          "old_text": "d_throw_exception(NULL, \"Invalid serialization data for Random\\\\Randomizer object\", 0);\n\t",
          "new_text": "D_PARSE_PARAMETERS_END();\n\n",
          "old_line_content": "\t\tzend_throw_exception(NULL, \"Invalid serialization data for Random\\\\Randomizer object\", 0);",
          "new_line_content": "\tZEND_PARSE_PARAMETERS_END();",
          "content_same": false
        },
        {
          "line": 504,
          "old_api": "d_hash_index_find",
          "new_api": "d_throw_exception",
          "old_text": "d_hash_index_find(d, 0);\n\t",
          "new_text": "d_throw_exception(NULL, \"Invalid serialization data for Random\\\\Randomizer object\", 0);\n\t",
          "old_line_content": "\tmembers_zv = zend_hash_index_find(d, 0);",
          "new_line_content": "\t\tzend_throw_exception(NULL, \"Invalid serialization data for Random\\\\Randomizer object\", 0);",
          "content_same": false
        },
        {
          "line": 505,
          "old_api": "YPE_P",
          "new_api": "URN_THROWS",
          "old_text": "YPE_P(members_zv) !=",
          "new_text": "URN_THROWS();\n\t",
          "old_line_content": "\tif (!members_zv || Z_TYPE_P(members_zv) != IS_ARRAY) {",
          "new_line_content": "\t\tRETURN_THROWS();",
          "content_same": false
        },
        {
          "line": 509,
          "old_api": "RRVAL_P",
          "new_api": "YPE_P",
          "old_text": "RRVAL_P(members_zv));\n",
          "new_text": "YPE_P(members_zv) !=",
          "old_line_content": "\tobject_properties_load(&randomizer->std, Z_ARRVAL_P(members_zv));",
          "new_line_content": "\tif (!members_zv || Z_TYPE_P(members_zv) != IS_ARRAY) {",
          "content_same": false
        },
        {
          "line": 510,
          "old_api": "exception)) {",
          "new_api": "d_throw_exception",
          "old_text": "exception)) {",
          "new_text": "d_throw_exception(NULL, \"Invalid serialization data for Random\\\\Randomizer object\", 0);\n\t",
          "old_line_content": "\tif (EG(exception)) {",
          "new_line_content": "\t\tzend_throw_exception(NULL, \"Invalid serialization data for Random\\\\Randomizer object\", 0);",
          "content_same": false
        },
        {
          "line": 511,
          "old_api": "d_throw_exception",
          "new_api": "URN_THROWS",
          "old_text": "d_throw_exception(NULL, \"Invalid serialization data for Random\\\\Randomizer object\", 0);\n\t",
          "new_text": "URN_THROWS();\n\t",
          "old_line_content": "\t\tzend_throw_exception(NULL, \"Invalid serialization data for Random\\\\Randomizer object\", 0);",
          "new_line_content": "\t\tRETURN_THROWS();",
          "content_same": false
        },
        {
          "line": 515,
          "old_api": "len",
          "new_api": "d_throw_exception",
          "old_text": "len(\"engine\"), 1",
          "new_text": "d_throw_exception(NULL, \"Invalid serialization data for Random\\\\Randomizer object\", 0);\n\t",
          "old_line_content": "\tzengine = zend_read_property(randomizer->std.ce, &randomizer->std, \"engine\", strlen(\"engine\"), 1, NULL);",
          "new_line_content": "\t\tzend_throw_exception(NULL, \"Invalid serialization data for Random\\\\Randomizer object\", 0);",
          "content_same": false
        },
        {
          "line": 516,
          "old_api": "BJCE_P",
          "new_api": "URN_THROWS",
          "old_text": "BJCE_P(zengine), r",
          "new_text": "URN_THROWS();\n\t",
          "old_line_content": "\tif (Z_TYPE_P(zengine) != IS_OBJECT || !instanceof_function(Z_OBJCE_P(zengine), random_ce_Random_Engine)) {",
          "new_line_content": "\t\tRETURN_THROWS();",
          "content_same": false
        },
        {
          "line": 521,
          "old_api": "BJ_P",
          "new_api": "d_throw_exception",
          "old_text": "BJ_P(zengine));\n",
          "new_text": "d_throw_exception(NULL, \"Invalid serialization data for Random\\\\Randomizer object\", 0);\n\t",
          "old_line_content": "\trandomizer_common_init(randomizer, Z_OBJ_P(zengine));",
          "new_line_content": "\t\tzend_throw_exception(NULL, \"Invalid serialization data for Random\\\\Randomizer object\", 0);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 513,
          "old_api": null,
          "new_api": "RRVAL_P",
          "old_text": null,
          "new_text": "RRVAL_P(members_zv));\n",
          "old_line_content": "\t}",
          "new_line_content": "\tobject_properties_load(&randomizer->std, Z_ARRVAL_P(members_zv));",
          "content_same": false
        },
        {
          "line": 514,
          "old_api": null,
          "new_api": "exception)) {",
          "old_text": null,
          "new_text": "exception)) {",
          "old_line_content": "",
          "new_line_content": "\tif (EG(exception)) {",
          "content_same": false
        },
        {
          "line": 519,
          "old_api": null,
          "new_api": "len",
          "old_text": null,
          "new_text": "len(\"engine\"), 1",
          "old_line_content": "\t}",
          "new_line_content": "\tzengine = zend_read_property(randomizer->std.ce, &randomizer->std, \"engine\", strlen(\"engine\"), 1, NULL);",
          "content_same": false
        },
        {
          "line": 520,
          "old_api": null,
          "new_api": "BJCE_P",
          "old_text": null,
          "new_text": "BJCE_P(zengine), r",
          "old_line_content": "",
          "new_line_content": "\tif (Z_TYPE_P(zengine) != IS_OBJECT || !instanceof_function(Z_OBJCE_P(zengine), random_ce_Random_Engine)) {",
          "content_same": false
        },
        {
          "line": 522,
          "old_api": null,
          "new_api": "URN_THROWS",
          "old_text": null,
          "new_text": "URN_THROWS();\n\t",
          "old_line_content": "}",
          "new_line_content": "\t\tRETURN_THROWS();",
          "content_same": false
        },
        {
          "line": 525,
          "old_api": null,
          "new_api": "BJ_P",
          "old_text": null,
          "new_text": "BJ_P(zengine));\n",
          "old_line_content": "",
          "new_line_content": "\trandomizer_common_init(randomizer, Z_OBJ_P(zengine));",
          "content_same": false
        },
        {
          "line": 441,
          "old_api": null,
          "new_api": "d_string_free",
          "old_text": null,
          "new_text": "d_string_free(retval);\n\t",
          "old_line_content": "\t\t\t}",
          "new_line_content": "\t\t\t\tzend_string_free(retval);",
          "content_same": false
        },
        {
          "line": 442,
          "old_api": null,
          "new_api": "URN_THROWS",
          "old_text": null,
          "new_text": "URN_THROWS();\n\t",
          "old_line_content": "",
          "new_line_content": "\t\t\t\tRETURN_THROWS();",
          "content_same": false
        },
        {
          "line": 452,
          "old_api": null,
          "new_api": "d_string_free",
          "old_text": null,
          "new_text": "d_string_free(retval);\n\t",
          "old_line_content": "",
          "new_line_content": "\t\t\t\t\t\tzend_string_free(retval);",
          "content_same": false
        },
        {
          "line": 453,
          "old_api": null,
          "new_api": "d_throw_error",
          "old_text": null,
          "new_text": "d_throw_error(random_ce_Random_BrokenRandomEngineError, \"Failed to generate an acceptable random number in %d attempts\", PHP_RANDOM_RANGE_ATTEMPTS);\n\t",
          "old_line_content": "\t\t\t\t\tcontinue;",
          "new_line_content": "\t\t\t\t\t\tzend_throw_error(random_ce_Random_BrokenRandomEngineError, \"Failed to generate an acceptable random number in %d attempts\", PHP_RANDOM_RANGE_ATTEMPTS);",
          "content_same": false
        },
        {
          "line": 454,
          "old_api": null,
          "new_api": "URN_THROWS",
          "old_text": null,
          "new_text": "URN_THROWS();\n\t",
          "old_line_content": "\t\t\t\t}",
          "new_line_content": "\t\t\t\t\t\tRETURN_THROWS();",
          "content_same": false
        },
        {
          "line": 462,
          "old_api": null,
          "new_api": "R_VAL",
          "old_text": null,
          "new_text": "R_VAL(source)[of",
          "old_line_content": "\t\t\t}",
          "new_line_content": "\t\t\t\tZSTR_VAL(retval)[total_size++] = ZSTR_VAL(source)[offset];",
          "content_same": false
        },
        {
          "line": 470,
          "old_api": null,
          "new_api": "R_VAL",
          "old_text": null,
          "new_text": "R_VAL(retval)[le",
          "old_line_content": "",
          "new_line_content": "\tZSTR_VAL(retval)[length] = '\\0';",
          "content_same": false
        },
        {
          "line": 471,
          "old_api": null,
          "new_api": "URN_STR",
          "old_text": null,
          "new_text": "URN_STR(retval);\n}",
          "old_line_content": "/* {{{ Random\\Randomizer::__serialize() */",
          "new_line_content": "\tRETURN_STR(retval);",
          "content_same": false
        },
        {
          "line": 478,
          "old_api": null,
          "new_api": "ANDOM_RANDOMIZER_P",
          "old_text": null,
          "new_text": "ANDOM_RANDOMIZER_P(ZEND_THIS);\n\t",
          "old_line_content": "",
          "new_line_content": "\tphp_random_randomizer *randomizer = Z_RANDOM_RANDOMIZER_P(ZEND_THIS);",
          "content_same": false
        },
        {
          "line": 483,
          "old_api": null,
          "new_api": "ay_init",
          "old_text": null,
          "new_text": "ay_init(return_value);\n\t",
          "old_line_content": "}",
          "new_line_content": "\tarray_init(return_value);",
          "content_same": false
        },
        {
          "line": 484,
          "old_api": null,
          "new_api": "d_std_get_properties",
          "old_text": null,
          "new_text": "d_std_get_properties(&randomizer->std));\n",
          "old_line_content": "/* }}} */",
          "new_line_content": "\tZVAL_ARR(&t, zend_std_get_properties(&randomizer->std));",
          "content_same": false
        },
        {
          "line": 485,
          "old_api": null,
          "new_api": "RY_ADDREF",
          "old_text": null,
          "new_text": "RY_ADDREF(t);\n\t",
          "old_line_content": "",
          "new_line_content": "\tZ_TRY_ADDREF(t);",
          "content_same": false
        },
        {
          "line": 486,
          "old_api": null,
          "new_api": "RRVAL_P",
          "old_text": null,
          "new_text": "RRVAL_P(return_value), &",
          "old_line_content": "/* {{{ Random\\Randomizer::__unserialize() */",
          "new_line_content": "\tzend_hash_next_index_insert(Z_ARRVAL_P(return_value), &t);",
          "content_same": false
        },
        {
          "line": 493,
          "old_api": null,
          "new_api": "ANDOM_RANDOMIZER_P",
          "old_text": null,
          "new_text": "ANDOM_RANDOMIZER_P(ZEND_THIS);\n\t",
          "old_line_content": "",
          "new_line_content": "\tphp_random_randomizer *randomizer = Z_RANDOM_RANDOMIZER_P(ZEND_THIS);",
          "content_same": false
        },
        {
          "line": 498,
          "old_api": null,
          "new_api": "D_PARSE_PARAMETERS_START",
          "old_text": null,
          "new_text": "D_PARSE_PARAMETERS_START(1, 1)\n\t\t",
          "old_line_content": "\t/* Verify the expected number of elements, this implicitly ensures that no additional elements are present. */",
          "new_line_content": "\tZEND_PARSE_PARAMETERS_START(1, 1)",
          "content_same": false
        },
        {
          "line": 503,
          "old_api": null,
          "new_api": "d_hash_num_elements",
          "old_text": null,
          "new_text": "d_hash_num_elements(d) !=",
          "old_line_content": "",
          "new_line_content": "\tif (zend_hash_num_elements(d) != 1) {",
          "content_same": false
        },
        {
          "line": 508,
          "old_api": null,
          "new_api": "d_hash_index_find",
          "old_text": null,
          "new_text": "d_hash_index_find(d, 0);\n\t",
          "old_line_content": "\t}",
          "new_line_content": "\tmembers_zv = zend_hash_index_find(d, 0);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 512,
          "old_api": "URN_THROWS",
          "new_api": null,
          "old_text": "URN_THROWS();\n\t",
          "new_text": null,
          "old_line_content": "\t\tRETURN_THROWS();",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 517,
          "old_api": "d_throw_exception",
          "new_api": null,
          "old_text": "d_throw_exception(NULL, \"Invalid serialization data for Random\\\\Randomizer object\", 0);\n\t",
          "new_text": null,
          "old_line_content": "\t\tzend_throw_exception(NULL, \"Invalid serialization data for Random\\\\Randomizer object\", 0);",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 518,
          "old_api": "URN_THROWS",
          "new_api": null,
          "old_text": "URN_THROWS();\n\t",
          "new_text": null,
          "old_line_content": "\t\tRETURN_THROWS();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 437,
          "old_api": "generate",
          "new_api": null,
          "old_text": "ine.algo->generate(engine.state);\n\t",
          "new_text": null,
          "old_line_content": "\t\t\tphp_random_result result = engine.algo->generate(engine.state);",
          "new_line_content": "\t\tint failures = 0;",
          "content_same": false
        },
        {
          "line": 438,
          "old_api": "exception)) {",
          "new_api": null,
          "old_text": "exception)) {",
          "new_text": null,
          "old_line_content": "\t\t\tif (EG(exception)) {",
          "new_line_content": "\t\twhile (total_size < length) {",
          "content_same": false
        },
        {
          "line": 448,
          "old_api": "d_string_free",
          "new_api": null,
          "old_text": "d_string_free(retval);\n\t",
          "new_text": null,
          "old_line_content": "\t\t\t\t\t\tzend_string_free(retval);",
          "new_line_content": "\t\t\t\toffsets >>= 8;",
          "content_same": false
        },
        {
          "line": 449,
          "old_api": "d_throw_error",
          "new_api": null,
          "old_text": "d_throw_error(random_ce_Random_BrokenRandomEngineError, \"Failed to generate an acceptable random number in %d attempts\", PHP_RANDOM_RANGE_ATTEMPTS);\n\t",
          "new_text": null,
          "old_line_content": "\t\t\t\t\t\tzend_throw_error(random_ce_Random_BrokenRandomEngineError, \"Failed to generate an acceptable random number in %d attempts\", PHP_RANDOM_RANGE_ATTEMPTS);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 450,
          "old_api": "URN_THROWS",
          "new_api": null,
          "old_text": "URN_THROWS();\n\t",
          "new_text": null,
          "old_line_content": "\t\t\t\t\t\tRETURN_THROWS();",
          "new_line_content": "\t\t\t\tif (offset > max_offset) {",
          "content_same": false
        },
        {
          "line": 458,
          "old_api": "R_VAL",
          "new_api": null,
          "old_text": "R_VAL(source)[of",
          "new_text": null,
          "old_line_content": "\t\t\t\tZSTR_VAL(retval)[total_size++] = ZSTR_VAL(source)[offset];",
          "new_line_content": "\t\t\t\t}",
          "content_same": false
        },
        {
          "line": 466,
          "old_api": "R_VAL",
          "new_api": null,
          "old_text": "R_VAL(retval)[le",
          "new_text": null,
          "old_line_content": "\tZSTR_VAL(retval)[length] = '\\0';",
          "new_line_content": "\t\t\t}",
          "content_same": false
        },
        {
          "line": 467,
          "old_api": "URN_STR",
          "new_api": null,
          "old_text": "URN_STR(retval);\n}",
          "new_text": null,
          "old_line_content": "\tRETURN_STR(retval);",
          "new_line_content": "\t\t}",
          "content_same": false
        },
        {
          "line": 474,
          "old_api": "ANDOM_RANDOMIZER_P",
          "new_api": null,
          "old_text": "ANDOM_RANDOMIZER_P(ZEND_THIS);\n\t",
          "new_text": null,
          "old_line_content": "\tphp_random_randomizer *randomizer = Z_RANDOM_RANDOMIZER_P(ZEND_THIS);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 477,
          "old_api": "D_PARSE_PARAMETERS_NONE",
          "new_api": null,
          "old_text": "D_PARSE_PARAMETERS_NONE();\n\n",
          "new_text": null,
          "old_line_content": "\tZEND_PARSE_PARAMETERS_NONE();",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 479,
          "old_api": "ay_init",
          "new_api": null,
          "old_text": "ay_init(return_value);\n\t",
          "new_text": null,
          "old_line_content": "\tarray_init(return_value);",
          "new_line_content": "\tzval t;",
          "content_same": false
        },
        {
          "line": 480,
          "old_api": "d_std_get_properties",
          "new_api": null,
          "old_text": "d_std_get_properties(&randomizer->std));\n",
          "new_text": null,
          "old_line_content": "\tZVAL_ARR(&t, zend_std_get_properties(&randomizer->std));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 482,
          "old_api": "RRVAL_P",
          "new_api": null,
          "old_text": "RRVAL_P(return_value), &",
          "new_text": null,
          "old_line_content": "\tzend_hash_next_index_insert(Z_ARRVAL_P(return_value), &t);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 489,
          "old_api": "ANDOM_RANDOMIZER_P",
          "new_api": null,
          "old_text": "ANDOM_RANDOMIZER_P(ZEND_THIS);\n\t",
          "new_text": null,
          "old_line_content": "\tphp_random_randomizer *randomizer = Z_RANDOM_RANDOMIZER_P(ZEND_THIS);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 494,
          "old_api": "D_PARSE_PARAMETERS_START",
          "new_api": null,
          "old_text": "D_PARSE_PARAMETERS_START(1, 1)\n\t\t",
          "new_text": null,
          "old_line_content": "\tZEND_PARSE_PARAMETERS_START(1, 1)",
          "new_line_content": "\tHashTable *d;",
          "content_same": false
        },
        {
          "line": 495,
          "old_api": "ARAM_ARRAY_HT",
          "new_api": null,
          "old_text": "ARAM_ARRAY_HT(d);\n\t",
          "new_text": null,
          "old_line_content": "\t\tZ_PARAM_ARRAY_HT(d);",
          "new_line_content": "\tzval *members_zv;",
          "content_same": false
        },
        {
          "line": 496,
          "old_api": "D_PARSE_PARAMETERS_END",
          "new_api": null,
          "old_text": "D_PARSE_PARAMETERS_END();\n\n",
          "new_text": null,
          "old_line_content": "\tZEND_PARSE_PARAMETERS_END();",
          "new_line_content": "\tzval *zengine;",
          "content_same": false
        },
        {
          "line": 501,
          "old_api": "URN_THROWS",
          "new_api": null,
          "old_text": "URN_THROWS();\n\t",
          "new_text": null,
          "old_line_content": "\t\tRETURN_THROWS();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 506,
          "old_api": "d_throw_exception",
          "new_api": null,
          "old_text": "d_throw_exception(NULL, \"Invalid serialization data for Random\\\\Randomizer object\", 0);\n\t",
          "new_text": null,
          "old_line_content": "\t\tzend_throw_exception(NULL, \"Invalid serialization data for Random\\\\Randomizer object\", 0);",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 507,
          "old_api": "URN_THROWS",
          "new_api": null,
          "old_text": "URN_THROWS();\n\t",
          "new_text": null,
          "old_line_content": "\t\tRETURN_THROWS();",
          "new_line_content": "",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 13,
      "total_additions": 23,
      "total_deletions": 23,
      "total_api_changes": 59
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 6,
        "api_related_lines": 59,
        "non_api_lines": 5,
        "non_api_line_numbers": [
          434,
          435,
          444,
          445,
          447
        ]
      }
    },
    "api_calls_before": 197,
    "api_calls_after": 197,
    "diff_info": {
      "added_lines": 5,
      "removed_lines": 1,
      "total_diff_lines": 26
    }
  }
}