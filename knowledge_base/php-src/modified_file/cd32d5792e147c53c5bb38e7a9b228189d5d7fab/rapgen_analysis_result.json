{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/php-src/modified_file/cd32d5792e147c53c5bb38e7a9b228189d5d7fab",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/php-src/modified_file/cd32d5792e147c53c5bb38e7a9b228189d5d7fab/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/php-src/modified_file/cd32d5792e147c53c5bb38e7a9b228189d5d7fab/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/php-src/modified_file/cd32d5792e147c53c5bb38e7a9b228189d5d7fab/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 103,
          "old_api": "printf",
          "new_api": "timelib_is_leap",
          "old_text": "printf(\"month=%lld (%d)\\n\", i, months[i])",
          "new_text": "timelib_is_leap(cur_year)",
          "old_line_content": "\t\tTIMELIB_DEBUG(printf(\"month=%lld (%d)\\n\", i, months[i]););",
          "new_line_content": "\tmonths = timelib_is_leap(cur_year) ? month_tab_leap : month_tab;",
          "content_same": false
        },
        {
          "line": 161,
          "old_api": "timelib_unixtime2gmt",
          "new_api": "timelib_time_offset_dtor",
          "old_text": "timelib_unixtime2gmt(tm, tm->sse)",
          "new_text": "timelib_time_offset_dtor(gmt_offset)",
          "old_line_content": "\t\t\ttimelib_unixtime2gmt(tm, tm->sse);",
          "new_line_content": "\t\t\ttimelib_time_offset_dtor(gmt_offset);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 257,
          "old_api": null,
          "new_api": "timelib_unixtime2local",
          "old_text": null,
          "new_text": "timelib_unixtime2local(t, t->sse)",
          "old_line_content": "\t}",
          "new_line_content": "\t\ttimelib_unixtime2local(t, t->sse);",
          "content_same": false
        },
        {
          "line": 260,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\"Converting from local time to GMT time\\n\")",
          "old_line_content": "",
          "new_line_content": "\t\tTIMELIB_DEBUG(printf(\"Converting from local time to GMT time\\n\"););",
          "content_same": false
        },
        {
          "line": 262,
          "old_api": null,
          "new_api": "timelib_unixtime2gmt",
          "old_text": null,
          "new_text": "timelib_unixtime2gmt(t, t->sse)",
          "old_line_content": "",
          "new_line_content": "\t\ttimelib_unixtime2gmt(t, t->sse);",
          "content_same": false
        },
        {
          "line": 149,
          "old_api": null,
          "new_api": "timelib_unixtime2gmt",
          "old_text": null,
          "new_text": "timelib_unixtime2gmt(tm, tm->sse - (tm->z * 60))",
          "old_line_content": "",
          "new_line_content": "\t\t\ttimelib_unixtime2gmt(tm, tm->sse - (tm->z * 60));",
          "content_same": false
        },
        {
          "line": 159,
          "old_api": null,
          "new_api": "timelib_get_time_zone_info",
          "old_text": null,
          "new_text": "timelib_get_time_zone_info(tm->sse, tm->tz_info)",
          "old_line_content": "",
          "new_line_content": "\t\t\tgmt_offset = timelib_get_time_zone_info(tm->sse, tm->tz_info);",
          "content_same": false
        },
        {
          "line": 160,
          "old_api": null,
          "new_api": "timelib_unixtime2gmt",
          "old_text": null,
          "new_text": "timelib_unixtime2gmt(tm, tm->sse + gmt_offset->offset)",
          "old_line_content": "\t\tdefault:",
          "new_line_content": "\t\t\ttimelib_unixtime2gmt(tm, tm->sse + gmt_offset->offset);",
          "content_same": false
        },
        {
          "line": 167,
          "old_api": null,
          "new_api": "timelib_unixtime2gmt",
          "old_text": null,
          "new_text": "timelib_unixtime2gmt(tm, tm->sse)",
          "old_line_content": "\ttm->have_zone = 1;",
          "new_line_content": "\t\t\ttimelib_unixtime2gmt(tm, tm->sse);",
          "content_same": false
        },
        {
          "line": 187,
          "old_api": null,
          "new_api": "timelib_unixtime2gmt",
          "old_text": null,
          "new_text": "timelib_unixtime2gmt(tm, ts - (tm->z * 60))",
          "old_line_content": "",
          "new_line_content": "\t\t\ttimelib_unixtime2gmt(tm, ts - (tm->z * 60));",
          "content_same": false
        },
        {
          "line": 66,
          "old_api": null,
          "new_api": "timelib_is_leap",
          "old_text": null,
          "new_text": "timelib_is_leap(cur_year)",
          "old_line_content": "\t} else {",
          "new_line_content": "\t\t\tif (timelib_is_leap(cur_year)) {",
          "content_same": false
        },
        {
          "line": 195,
          "old_api": null,
          "new_api": "timelib_get_time_zone_info",
          "old_text": null,
          "new_text": "timelib_get_time_zone_info(ts, tz)",
          "old_line_content": "\t\t\ttm->z = gmt_offset->offset;",
          "new_line_content": "\t\t\tgmt_offset = timelib_get_time_zone_info(ts, tz);",
          "content_same": false
        },
        {
          "line": 196,
          "old_api": null,
          "new_api": "timelib_unixtime2gmt",
          "old_text": null,
          "new_text": "timelib_unixtime2gmt(tm, ts + gmt_offset->offset)",
          "old_line_content": "\t\t\ttm->tz_info = tz;",
          "new_line_content": "\t\t\ttimelib_unixtime2gmt(tm, ts + gmt_offset->offset);",
          "content_same": false
        },
        {
          "line": 204,
          "old_api": null,
          "new_api": "timelib_time_tz_abbr_update",
          "old_text": null,
          "new_text": "timelib_time_tz_abbr_update(tm, gmt_offset->abbr)",
          "old_line_content": "\t\t\ttm->have_zone = 0;",
          "new_line_content": "\t\t\ttimelib_time_tz_abbr_update(tm, gmt_offset->abbr);",
          "content_same": false
        },
        {
          "line": 205,
          "old_api": null,
          "new_api": "timelib_time_offset_dtor",
          "old_text": null,
          "new_text": "timelib_time_offset_dtor(gmt_offset)",
          "old_line_content": "\t\t\treturn;",
          "new_line_content": "\t\t\ttimelib_time_offset_dtor(gmt_offset);",
          "content_same": false
        },
        {
          "line": 87,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\"tmp_days=%lld, year=%lld\\n\", tmp_days, cur_year)",
          "old_line_content": "\t\t\t\t\ttmp_days += DAYS_PER_LYEAR;",
          "new_line_content": "\t\t\t\tTIMELIB_DEBUG(printf(\"tmp_days=%lld, year=%lld\\n\", tmp_days, cur_year););",
          "content_same": false
        },
        {
          "line": 91,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\"tmp_days=%lld, year=%lld\\n\", tmp_days, cur_year)",
          "old_line_content": "\t\t\t}",
          "new_line_content": "\t\t\t\tTIMELIB_DEBUG(printf(\"tmp_days=%lld, year=%lld\\n\", tmp_days, cur_year););",
          "content_same": false
        },
        {
          "line": 92,
          "old_api": null,
          "new_api": "timelib_is_leap",
          "old_text": null,
          "new_text": "timelib_is_leap(cur_year)",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\t\t\tif (timelib_is_leap(cur_year)) {",
          "content_same": false
        },
        {
          "line": 222,
          "old_api": null,
          "new_api": "timelib_get_time_zone_info",
          "old_text": null,
          "new_text": "timelib_get_time_zone_info(t->sse, tz)",
          "old_line_content": "\t}",
          "new_line_content": "\tgmt_offset = timelib_get_time_zone_info(t->sse, tz);",
          "content_same": false
        },
        {
          "line": 121,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\" hour=%lld, minute=%lld, second=%lld\\n\", hours, minutes, seconds)",
          "old_line_content": "\ttm->i = minutes;",
          "new_line_content": "\tTIMELIB_DEBUG(printf(\" hour=%lld, minute=%lld, second=%lld\\n\", hours, minutes, seconds););",
          "content_same": false
        },
        {
          "line": 101,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\"tmp_days=%lld, year=%lld\\n\", tmp_days, cur_year)",
          "old_line_content": "\ti = 11;",
          "new_line_content": "\tTIMELIB_DEBUG(printf(\"tmp_days=%lld, year=%lld\\n\", tmp_days, cur_year););",
          "content_same": false
        },
        {
          "line": 104,
          "old_api": null,
          "new_api": "timelib_is_leap",
          "old_text": null,
          "new_text": "timelib_is_leap(cur_year)",
          "old_line_content": "\t\tif (tmp_days > months[i]) {",
          "new_line_content": "\tif (timelib_is_leap(cur_year) && cur_year < 1970) {",
          "content_same": false
        },
        {
          "line": 233,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free(t->tz_abbr)",
          "old_line_content": "\tt->zone_type = TIMELIB_ZONETYPE_ID;",
          "new_line_content": "\t\tfree(t->tz_abbr);",
          "content_same": false
        },
        {
          "line": 235,
          "old_api": null,
          "new_api": "strdup",
          "old_text": null,
          "new_text": "strdup(gmt_offset->abbr)",
          "old_line_content": "",
          "new_line_content": "\tt->tz_abbr = strdup(gmt_offset->abbr);",
          "content_same": false
        },
        {
          "line": 236,
          "old_api": null,
          "new_api": "timelib_time_offset_dtor",
          "old_text": null,
          "new_text": "timelib_time_offset_dtor(gmt_offset)",
          "old_line_content": "/* Converts the time stored in the struct to localtime if localtime = true,",
          "new_line_content": "\ttimelib_time_offset_dtor(gmt_offset);",
          "content_same": false
        },
        {
          "line": 249,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\"Converting from GMT time to local time\\n\")",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\tTIMELIB_DEBUG(printf(\"Converting from GMT time to local time\\n\"););",
          "content_same": false
        },
        {
          "line": 253,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\"E: No timezone configured, can't switch to local time\\n\")",
          "old_line_content": "\t\t/* Converting from local time to GMT time */",
          "new_line_content": "\t\t\tTIMELIB_DEBUG(printf(\"E: No timezone configured, can't switch to local time\\n\"););",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 256,
          "old_api": "timelib_unixtime2gmt",
          "new_api": null,
          "old_text": "timelib_unixtime2gmt(t, t->sse)",
          "new_text": null,
          "old_line_content": "\t\ttimelib_unixtime2gmt(t, t->sse);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 143,
          "old_api": "timelib_unixtime2gmt",
          "new_api": null,
          "old_text": "timelib_unixtime2gmt(tm, tm->sse - (tm->z * 60))",
          "new_text": null,
          "old_line_content": "\t\t\ttimelib_unixtime2gmt(tm, tm->sse - (tm->z * 60));",
          "new_line_content": "\tswitch (tm->zone_type) {",
          "content_same": false
        },
        {
          "line": 153,
          "old_api": "timelib_get_time_zone_info",
          "new_api": null,
          "old_text": "timelib_get_time_zone_info(tm->sse, tm->tz_info)",
          "new_text": null,
          "old_line_content": "\t\t\tgmt_offset = timelib_get_time_zone_info(tm->sse, tm->tz_info);",
          "new_line_content": "\t\t\tgoto cleanup;",
          "content_same": false
        },
        {
          "line": 154,
          "old_api": "timelib_unixtime2gmt",
          "new_api": null,
          "old_text": "timelib_unixtime2gmt(tm, tm->sse + gmt_offset->offset)",
          "new_text": null,
          "old_line_content": "\t\t\ttimelib_unixtime2gmt(tm, tm->sse + gmt_offset->offset);",
          "new_line_content": "\t\t}",
          "content_same": false
        },
        {
          "line": 155,
          "old_api": "timelib_time_offset_dtor",
          "new_api": null,
          "old_text": "timelib_time_offset_dtor(gmt_offset)",
          "new_text": null,
          "old_line_content": "\t\t\ttimelib_time_offset_dtor(gmt_offset);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 181,
          "old_api": "timelib_unixtime2gmt",
          "new_api": null,
          "old_text": "timelib_unixtime2gmt(tm, ts - (tm->z * 60))",
          "new_text": null,
          "old_line_content": "\t\t\ttimelib_unixtime2gmt(tm, ts - (tm->z * 60));",
          "new_line_content": "\tswitch (tm->zone_type) {",
          "content_same": false
        },
        {
          "line": 60,
          "old_api": "timelib_is_leap",
          "new_api": null,
          "old_text": "timelib_is_leap(cur_year)",
          "new_text": null,
          "old_line_content": "\t\t\tif (timelib_is_leap(cur_year)) {",
          "new_line_content": "\t\t\tcur_year += YEARS_PER_LYEAR_PERIOD * (tmp_days / DAYS_PER_LYEAR_PERIOD);",
          "content_same": false
        },
        {
          "line": 189,
          "old_api": "timelib_get_time_zone_info",
          "new_api": null,
          "old_text": "timelib_get_time_zone_info(ts, tz)",
          "new_text": null,
          "old_line_content": "\t\t\tgmt_offset = timelib_get_time_zone_info(ts, tz);",
          "new_line_content": "\t\t\ttm->z = z;",
          "content_same": false
        },
        {
          "line": 190,
          "old_api": "timelib_unixtime2gmt",
          "new_api": null,
          "old_text": "timelib_unixtime2gmt(tm, ts + gmt_offset->offset)",
          "new_text": null,
          "old_line_content": "\t\t\ttimelib_unixtime2gmt(tm, ts + gmt_offset->offset);",
          "new_line_content": "\t\t\ttm->dst = dst;",
          "content_same": false
        },
        {
          "line": 198,
          "old_api": "timelib_time_tz_abbr_update",
          "new_api": null,
          "old_text": "timelib_time_tz_abbr_update(tm, gmt_offset->abbr)",
          "new_text": null,
          "old_line_content": "\t\t\ttimelib_time_tz_abbr_update(tm, gmt_offset->abbr);",
          "new_line_content": "\t\t\t/* we need to reset the sse here as unixtime2gmt modifies it */",
          "content_same": false
        },
        {
          "line": 199,
          "old_api": "timelib_time_offset_dtor",
          "new_api": null,
          "old_text": "timelib_time_offset_dtor(gmt_offset)",
          "new_text": null,
          "old_line_content": "\t\t\ttimelib_time_offset_dtor(gmt_offset);",
          "new_line_content": "\t\t\ttm->sse = ts; ",
          "content_same": false
        },
        {
          "line": 81,
          "old_api": "printf",
          "new_api": null,
          "old_text": "printf(\"tmp_days=%lld, year=%lld\\n\", tmp_days, cur_year)",
          "new_text": null,
          "old_line_content": "\t\t\t\tTIMELIB_DEBUG(printf(\"tmp_days=%lld, year=%lld\\n\", tmp_days, cur_year););",
          "new_line_content": "\t\t}",
          "content_same": false
        },
        {
          "line": 85,
          "old_api": "printf",
          "new_api": null,
          "old_text": "printf(\"tmp_days=%lld, year=%lld\\n\", tmp_days, cur_year)",
          "new_text": null,
          "old_line_content": "\t\t\t\tTIMELIB_DEBUG(printf(\"tmp_days=%lld, year=%lld\\n\", tmp_days, cur_year););",
          "new_line_content": "\t\t\tif (tmp_days < -1460970) {",
          "content_same": false
        },
        {
          "line": 86,
          "old_api": "timelib_is_leap",
          "new_api": null,
          "old_text": "timelib_is_leap(cur_year)",
          "new_text": null,
          "old_line_content": "\t\t\t\tif (timelib_is_leap(cur_year)) {",
          "new_line_content": "\t\t\t\tcur_year -= 4000;",
          "content_same": false
        },
        {
          "line": 216,
          "old_api": "timelib_get_time_zone_info",
          "new_api": null,
          "old_text": "timelib_get_time_zone_info(t->sse, tz)",
          "new_text": null,
          "old_line_content": "\tgmt_offset = timelib_get_time_zone_info(t->sse, tz);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 95,
          "old_api": "printf",
          "new_api": null,
          "old_text": "printf(\"tmp_days=%lld, year=%lld\\n\", tmp_days, cur_year)",
          "new_text": null,
          "old_line_content": "\tTIMELIB_DEBUG(printf(\"tmp_days=%lld, year=%lld\\n\", tmp_days, cur_year););",
          "new_line_content": "\t\t\t\t\ttmp_days += DAYS_PER_YEAR;",
          "content_same": false
        },
        {
          "line": 97,
          "old_api": "timelib_is_leap",
          "new_api": null,
          "old_text": "timelib_is_leap(cur_year)",
          "new_text": null,
          "old_line_content": "\tmonths = timelib_is_leap(cur_year) ? month_tab_leap : month_tab;",
          "new_line_content": "\t\t\t}",
          "content_same": false
        },
        {
          "line": 98,
          "old_api": "timelib_is_leap",
          "new_api": null,
          "old_text": "timelib_is_leap(cur_year)",
          "new_text": null,
          "old_line_content": "\tif (timelib_is_leap(cur_year) && cur_year < 1970) {",
          "new_line_content": "\t\t}",
          "content_same": false
        },
        {
          "line": 227,
          "old_api": "free",
          "new_api": null,
          "old_text": "free(t->tz_abbr)",
          "new_text": null,
          "old_line_content": "\t\tfree(t->tz_abbr);",
          "new_line_content": "\t\texit(1);",
          "content_same": false
        },
        {
          "line": 229,
          "old_api": "strdup",
          "new_api": null,
          "old_text": "strdup(gmt_offset->abbr)",
          "new_text": null,
          "old_line_content": "\tt->tz_abbr = strdup(gmt_offset->abbr);",
          "new_line_content": "*/",
          "content_same": false
        },
        {
          "line": 230,
          "old_api": "timelib_time_offset_dtor",
          "new_api": null,
          "old_text": "timelib_time_offset_dtor(gmt_offset)",
          "new_text": null,
          "old_line_content": "\ttimelib_time_offset_dtor(gmt_offset);",
          "new_line_content": "\tt->dst = gmt_offset->is_dst;",
          "content_same": false
        },
        {
          "line": 243,
          "old_api": "printf",
          "new_api": null,
          "old_text": "printf(\"Converting from GMT time to local time\\n\")",
          "new_text": null,
          "old_line_content": "\t\tTIMELIB_DEBUG(printf(\"Converting from GMT time to local time\\n\"););",
          "new_line_content": " * otherwise it converts it to gmttime. This is only done when necessary",
          "content_same": false
        },
        {
          "line": 247,
          "old_api": "printf",
          "new_api": null,
          "old_text": "printf(\"E: No timezone configured, can't switch to local time\\n\")",
          "new_text": null,
          "old_line_content": "\t\t\tTIMELIB_DEBUG(printf(\"E: No timezone configured, can't switch to local time\\n\"););",
          "new_line_content": "\tif (localtime) {",
          "content_same": false
        },
        {
          "line": 251,
          "old_api": "timelib_unixtime2local",
          "new_api": null,
          "old_text": "timelib_unixtime2local(t, t->sse)",
          "new_text": null,
          "old_line_content": "\t\ttimelib_unixtime2local(t, t->sse);",
          "new_line_content": "\t\t/* Check if TZ is set */",
          "content_same": false
        },
        {
          "line": 254,
          "old_api": "printf",
          "new_api": null,
          "old_text": "printf(\"Converting from local time to GMT time\\n\")",
          "new_text": null,
          "old_line_content": "\t\tTIMELIB_DEBUG(printf(\"Converting from local time to GMT time\\n\"););",
          "new_line_content": "\t\t\treturn -1;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 2,
      "total_additions": 25,
      "total_deletions": 25,
      "total_api_changes": 52
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 6,
        "api_related_lines": 52,
        "non_api_lines": 5,
        "non_api_line_numbers": [
          58,
          59,
          61,
          62,
          63
        ]
      }
    },
    "api_calls_before": 40,
    "api_calls_after": 40,
    "diff_info": {
      "added_lines": 6,
      "removed_lines": 0,
      "total_diff_lines": 18
    }
  }
}