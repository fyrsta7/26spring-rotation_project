{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/php-src/modified_file/092ad3e4624f86a43648e6afb1c22ae7e3406699",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/php-src/modified_file/092ad3e4624f86a43648e6afb1c22ae7e3406699/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/php-src/modified_file/092ad3e4624f86a43648e6afb1c22ae7e3406699/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/php-src/modified_file/092ad3e4624f86a43648e6afb1c22ae7e3406699/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 319,
          "old_api": "MB_CONVERT_BUF_ENSURE",
          "new_api": "mb_convert_buf_add",
          "old_text": "MB_CONVERT_BUF_ENSURE(buf, out, limit, len + 2)",
          "new_text": "mb_convert_buf_add(out, w & 0xFF)",
          "old_line_content": "\t\t\tMB_CONVERT_BUF_ENSURE(buf, out, limit, len + 2);",
          "new_line_content": "\t\t\tout = mb_convert_buf_add(out, w & 0xFF);",
          "content_same": false
        },
        {
          "line": 322,
          "old_api": "MB_CONVERT_BUF_ENSURE",
          "new_api": "mb_convert_buf_add2",
          "old_text": "MB_CONVERT_BUF_ENSURE(buf, out, limit, len + 3)",
          "new_text": "mb_convert_buf_add2(out, ((w >> 6) & 0x1F) | 0xC0, (w & 0x3F) | 0x80)",
          "old_line_content": "\t\t\tMB_CONVERT_BUF_ENSURE(buf, out, limit, len + 3);",
          "new_line_content": "\t\t\tout = mb_convert_buf_add2(out, ((w >> 6) & 0x1F) | 0xC0, (w & 0x3F) | 0x80);",
          "content_same": false
        },
        {
          "line": 325,
          "old_api": "MB_CONVERT_BUF_ENSURE",
          "new_api": "mb_convert_buf_add3",
          "old_text": "MB_CONVERT_BUF_ENSURE(buf, out, limit, len + 4)",
          "new_text": "mb_convert_buf_add3(out, ((w >> 12) & 0xF) | 0xE0, ((w >> 6) & 0x3F) | 0x80, (w & 0x3F) | 0x80)",
          "old_line_content": "\t\t\tMB_CONVERT_BUF_ENSURE(buf, out, limit, len + 4);",
          "new_line_content": "\t\t\tout = mb_convert_buf_add3(out, ((w >> 12) & 0xF) | 0xE0, ((w >> 6) & 0x3F) | 0x80, (w & 0x3F) | 0x80);",
          "content_same": false
        },
        {
          "line": 328,
          "old_api": "MB_CONVERT_ERROR",
          "new_api": "mb_convert_buf_add4",
          "old_text": "MB_CONVERT_ERROR(buf, out, limit, w, mb_wchar_to_utf8)",
          "new_text": "mb_convert_buf_add4(out, ((w >> 18) & 0x7) | 0xF0, ((w >> 12) & 0x3F) | 0x80, ((w >> 6) & 0x3F) | 0x80, (w & 0x3F) | 0x80)",
          "old_line_content": "\t\t\tMB_CONVERT_ERROR(buf, out, limit, w, mb_wchar_to_utf8);",
          "new_line_content": "\t\t\tout = mb_convert_buf_add4(out, ((w >> 18) & 0x7) | 0xF0, ((w >> 12) & 0x3F) | 0x80, ((w >> 6) & 0x3F) | 0x80, (w & 0x3F) | 0x80);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 321,
          "old_api": null,
          "new_api": "MB_CONVERT_BUF_ENSURE",
          "old_text": null,
          "new_text": "MB_CONVERT_BUF_ENSURE(buf, out, limit, len + 2)",
          "old_line_content": "\t\t} else if (w < 0x10000) {",
          "new_line_content": "\t\t\tMB_CONVERT_BUF_ENSURE(buf, out, limit, len + 2);",
          "content_same": false
        },
        {
          "line": 324,
          "old_api": null,
          "new_api": "MB_CONVERT_BUF_ENSURE",
          "old_text": null,
          "new_text": "MB_CONVERT_BUF_ENSURE(buf, out, limit, len + 3)",
          "old_line_content": "\t\t} else if (w < 0x110000) {",
          "new_line_content": "\t\t\tMB_CONVERT_BUF_ENSURE(buf, out, limit, len + 3);",
          "content_same": false
        },
        {
          "line": 327,
          "old_api": null,
          "new_api": "MB_CONVERT_BUF_ENSURE",
          "old_text": null,
          "new_text": "MB_CONVERT_BUF_ENSURE(buf, out, limit, len + 4)",
          "old_line_content": "\t\t} else {",
          "new_line_content": "\t\t\tMB_CONVERT_BUF_ENSURE(buf, out, limit, len + 4);",
          "content_same": false
        },
        {
          "line": 330,
          "old_api": null,
          "new_api": "MB_CONVERT_ERROR",
          "old_text": null,
          "new_text": "MB_CONVERT_ERROR(buf, out, limit, w, mb_wchar_to_utf8)",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\t\tMB_CONVERT_ERROR(buf, out, limit, w, mb_wchar_to_utf8);",
          "content_same": false
        },
        {
          "line": 331,
          "old_api": null,
          "new_api": "MB_CONVERT_BUF_ENSURE",
          "old_text": null,
          "new_text": "MB_CONVERT_BUF_ENSURE(buf, out, limit, len)",
          "old_line_content": "\t}",
          "new_line_content": "\t\t\tMB_CONVERT_BUF_ENSURE(buf, out, limit, len);",
          "content_same": false
        },
        {
          "line": 335,
          "old_api": null,
          "new_api": "MB_CONVERT_BUF_STORE",
          "old_text": null,
          "new_text": "MB_CONVERT_BUF_STORE(buf, out, limit)",
          "old_line_content": "",
          "new_line_content": "\tMB_CONVERT_BUF_STORE(buf, out, limit);",
          "content_same": false
        },
        {
          "line": 254,
          "old_api": null,
          "new_api": "ZEND_ASSERT",
          "old_text": null,
          "new_text": "ZEND_ASSERT(decoded >= 0x800)",
          "old_line_content": "\t\t\t\t\t*out++ = decoded;",
          "new_line_content": "\t\t\t\t\tZEND_ASSERT(decoded >= 0x800); /* Not an overlong code unit */",
          "content_same": false
        },
        {
          "line": 313,
          "old_api": null,
          "new_api": "MB_CONVERT_BUF_LOAD",
          "old_text": null,
          "new_text": "MB_CONVERT_BUF_LOAD(buf, out, limit)",
          "old_line_content": "",
          "new_line_content": "\tMB_CONVERT_BUF_LOAD(buf, out, limit);",
          "content_same": false
        },
        {
          "line": 314,
          "old_api": null,
          "new_api": "MB_CONVERT_BUF_ENSURE",
          "old_text": null,
          "new_text": "MB_CONVERT_BUF_ENSURE(buf, out, limit, len)",
          "old_line_content": "\twhile (len--) {",
          "new_line_content": "\tMB_CONVERT_BUF_ENSURE(buf, out, limit, len);",
          "content_same": false
        },
        {
          "line": 286,
          "old_api": null,
          "new_api": "ZEND_ASSERT",
          "old_text": null,
          "new_text": "ZEND_ASSERT(decoded >= 0x10000)",
          "old_line_content": "\t\t\t\t}",
          "new_line_content": "\t\t\t\t\tZEND_ASSERT(decoded >= 0x10000); /* Not an overlong code unit */",
          "content_same": false
        },
        {
          "line": 255,
          "old_api": null,
          "new_api": "ZEND_ASSERT",
          "old_text": null,
          "new_text": "ZEND_ASSERT(decoded < 0xD800 || decoded > 0xDFFF)",
          "old_line_content": "\t\t\t\t}",
          "new_line_content": "\t\t\t\t\tZEND_ASSERT(decoded < 0xD800 || decoded > 0xDFFF); /* U+D800-DFFF are reserved, illegal code points */",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 320,
          "old_api": "mb_convert_buf_add2",
          "new_api": null,
          "old_text": "mb_convert_buf_add2(out, ((w >> 6) & 0x1F) | 0xC0, (w & 0x3F) | 0x80)",
          "new_text": null,
          "old_line_content": "\t\t\tout = mb_convert_buf_add2(out, ((w >> 6) & 0x1F) | 0xC0, (w & 0x3F) | 0x80);",
          "new_line_content": "\t\t} else if (w < 0x800) {",
          "content_same": false
        },
        {
          "line": 323,
          "old_api": "mb_convert_buf_add3",
          "new_api": null,
          "old_text": "mb_convert_buf_add3(out, ((w >> 12) & 0xF) | 0xE0, ((w >> 6) & 0x3F) | 0x80, (w & 0x3F) | 0x80)",
          "new_text": null,
          "old_line_content": "\t\t\tout = mb_convert_buf_add3(out, ((w >> 12) & 0xF) | 0xE0, ((w >> 6) & 0x3F) | 0x80, (w & 0x3F) | 0x80);",
          "new_line_content": "\t\t} else if (w < 0x10000) {",
          "content_same": false
        },
        {
          "line": 326,
          "old_api": "mb_convert_buf_add4",
          "new_api": null,
          "old_text": "mb_convert_buf_add4(out, ((w >> 18) & 0x7) | 0xF0, ((w >> 12) & 0x3F) | 0x80, ((w >> 6) & 0x3F) | 0x80, (w & 0x3F) | 0x80)",
          "new_text": null,
          "old_line_content": "\t\t\tout = mb_convert_buf_add4(out, ((w >> 18) & 0x7) | 0xF0, ((w >> 12) & 0x3F) | 0x80, ((w >> 6) & 0x3F) | 0x80, (w & 0x3F) | 0x80);",
          "new_line_content": "\t\t} else if (w < 0x110000) {",
          "content_same": false
        },
        {
          "line": 329,
          "old_api": "MB_CONVERT_BUF_ENSURE",
          "new_api": null,
          "old_text": "MB_CONVERT_BUF_ENSURE(buf, out, limit, len)",
          "new_text": null,
          "old_line_content": "\t\t\tMB_CONVERT_BUF_ENSURE(buf, out, limit, len);",
          "new_line_content": "\t\t} else {",
          "content_same": false
        },
        {
          "line": 333,
          "old_api": "MB_CONVERT_BUF_STORE",
          "new_api": null,
          "old_text": "MB_CONVERT_BUF_STORE(buf, out, limit)",
          "new_text": null,
          "old_line_content": "\tMB_CONVERT_BUF_STORE(buf, out, limit);",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 252,
          "old_api": "ZEND_ASSERT",
          "new_api": null,
          "old_text": "ZEND_ASSERT(decoded >= 0x800)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\tZEND_ASSERT(decoded >= 0x800); /* Not an overlong code unit */",
          "new_line_content": "\t\t\t\t} else {",
          "content_same": false
        },
        {
          "line": 311,
          "old_api": "MB_CONVERT_BUF_LOAD",
          "new_api": null,
          "old_text": "MB_CONVERT_BUF_LOAD(buf, out, limit)",
          "new_text": null,
          "old_line_content": "\tMB_CONVERT_BUF_LOAD(buf, out, limit);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 312,
          "old_api": "MB_CONVERT_BUF_ENSURE",
          "new_api": null,
          "old_text": "MB_CONVERT_BUF_ENSURE(buf, out, limit, len)",
          "new_text": null,
          "old_line_content": "\tMB_CONVERT_BUF_ENSURE(buf, out, limit, len);",
          "new_line_content": "\tunsigned char *out, *limit;",
          "content_same": false
        },
        {
          "line": 253,
          "old_api": "ZEND_ASSERT",
          "new_api": null,
          "old_text": "ZEND_ASSERT(decoded < 0xD800 || decoded > 0xDFFF)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\tZEND_ASSERT(decoded < 0xD800 || decoded > 0xDFFF); /* U+D800-DFFF are reserved, illegal code points */",
          "new_line_content": "\t\t\t\t\tuint32_t decoded = ((c & 0xF) << 12) | ((c2 & 0x3F) << 6) | (c3 & 0x3F);",
          "content_same": false
        },
        {
          "line": 284,
          "old_api": "ZEND_ASSERT",
          "new_api": null,
          "old_text": "ZEND_ASSERT(decoded >= 0x10000)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\tZEND_ASSERT(decoded >= 0x10000); /* Not an overlong code unit */",
          "new_line_content": "\t\t\t\t} else {",
          "content_same": false
        },
        {
          "line": 317,
          "old_api": "mb_convert_buf_add",
          "new_api": null,
          "old_text": "mb_convert_buf_add(out, w & 0xFF)",
          "new_text": null,
          "old_line_content": "\t\t\tout = mb_convert_buf_add(out, w & 0xFF);",
          "new_line_content": "\t\tuint32_t w = *in++;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 4,
      "total_additions": 11,
      "total_deletions": 11,
      "total_api_changes": 26
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 7,
        "api_related_lines": 26,
        "non_api_lines": 7,
        "non_api_line_numbers": [
          228,
          229,
          230,
          265,
          267,
          240,
          242
        ]
      }
    },
    "api_calls_before": 56,
    "api_calls_after": 56,
    "diff_info": {
      "added_lines": 5,
      "removed_lines": 3,
      "total_diff_lines": 34
    }
  }
}