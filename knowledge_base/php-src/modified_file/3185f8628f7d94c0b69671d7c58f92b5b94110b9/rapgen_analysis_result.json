{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/php-src/modified_file/3185f8628f7d94c0b69671d7c58f92b5b94110b9",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/php-src/modified_file/3185f8628f7d94c0b69671d7c58f92b5b94110b9/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/php-src/modified_file/3185f8628f7d94c0b69671d7c58f92b5b94110b9/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/php-src/modified_file/3185f8628f7d94c0b69671d7c58f92b5b94110b9/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 782,
          "old_api": "zend_ssa_unlink_use_chain",
          "new_api": "can_elide_return_type_check",
          "old_text": "zend_ssa_unlink_use_chain(ssa, op_1, orig_var)",
          "new_text": "can_elide_return_type_check(op_array, ssa, &ssa->ops[op_1])",
          "old_line_content": "\t\t\t\tif (zend_ssa_unlink_use_chain(ssa, op_1, orig_var)) {",
          "new_line_content": "\t\t\t && can_elide_return_type_check(op_array, ssa, &ssa->ops[op_1])) {",
          "content_same": false
        },
        {
          "line": 801,
          "old_api": "RETURN_VALUE_USED",
          "new_api": "MAKE_NOP",
          "old_text": "RETURN_VALUE_USED(opline)",
          "new_text": "MAKE_NOP(opline)",
          "old_line_content": "\t\t\t && !RETURN_VALUE_USED(opline)",
          "new_line_content": "\t\t\t\t\tMAKE_NOP(opline);",
          "content_same": false
        },
        {
          "line": 854,
          "old_api": "zend_arena_release",
          "new_api": "zend_arena_checkpoint",
          "old_text": "zend_arena_release(&ctx->arena, checkpoint)",
          "new_text": "zend_arena_checkpoint(ctx->arena)",
          "old_line_content": "\t\tzend_arena_release(&ctx->arena, checkpoint);",
          "new_line_content": "\tvoid *checkpoint = zend_arena_checkpoint(ctx->arena);",
          "content_same": false
        },
        {
          "line": 858,
          "old_api": "zend_dfa_optimize_op_array",
          "new_api": "zend_dfa_analyze_op_array",
          "old_text": "zend_dfa_optimize_op_array(op_array, ctx, &ssa, NULL)",
          "new_text": "zend_dfa_analyze_op_array(op_array, ctx, &ssa, &flags)",
          "old_line_content": "\tzend_dfa_optimize_op_array(op_array, ctx, &ssa, NULL);",
          "new_line_content": "\tif (zend_dfa_analyze_op_array(op_array, ctx, &ssa, &flags) != SUCCESS) {",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 768,
          "old_api": null,
          "new_api": "CT_CONSTANT_EX",
          "old_text": null,
          "new_text": "CT_CONSTANT_EX(op_array, opline->op2.constant)",
          "old_line_content": "",
          "new_line_content": "\t\t\t && Z_LVAL_P(CT_CONSTANT_EX(op_array, opline->op2.constant)) == 1",
          "content_same": false
        },
        {
          "line": 775,
          "old_api": null,
          "new_api": "SET_UNUSED",
          "old_text": null,
          "new_text": "SET_UNUSED(opline->op2)",
          "old_line_content": "\t\t\t && ssa->ops[op_1].op1_use_chain == -1",
          "new_line_content": "\t\t\t\tSET_UNUSED(opline->op2);",
          "content_same": false
        },
        {
          "line": 653,
          "old_api": null,
          "new_api": "OP1_INFO",
          "old_text": null,
          "new_text": "OP1_INFO()",
          "old_line_content": "\t\t\t}",
          "new_line_content": "\t\t\t\t\tif (!(OP1_INFO() & MAY_BE_OBJECT)",
          "content_same": false
        },
        {
          "line": 654,
          "old_api": null,
          "new_api": "OP2_INFO",
          "old_text": null,
          "new_text": "OP2_INFO()",
          "old_line_content": "",
          "new_line_content": "\t\t\t\t\t && !(OP2_INFO() & MAY_BE_OBJECT)) {",
          "content_same": false
        },
        {
          "line": 787,
          "old_api": null,
          "new_api": "zend_ssa_unlink_use_chain",
          "old_text": null,
          "new_text": "zend_ssa_unlink_use_chain(ssa, op_1, orig_var)",
          "old_line_content": "\t\t\t\t\tssa->ops[ret].op1_use_chain = ssa->vars[orig_var].use_chain;",
          "new_line_content": "\t\t\t\tif (zend_ssa_unlink_use_chain(ssa, op_1, orig_var)) {",
          "content_same": false
        },
        {
          "line": 667,
          "old_api": null,
          "new_api": "RETURN_VALUE_USED",
          "old_text": null,
          "new_text": "RETURN_VALUE_USED(opline)",
          "old_line_content": "\t\t\t\t && !(ssa->var_info[orig_var].type & (MAY_BE_STRING|MAY_BE_ARRAY|MAY_BE_OBJECT|MAY_BE_RESOURCE|MAY_BE_REF))",
          "new_line_content": "\t\t\t && !RETURN_VALUE_USED(opline)",
          "content_same": false
        },
        {
          "line": 806,
          "old_api": null,
          "new_api": "RETURN_VALUE_USED",
          "old_text": null,
          "new_text": "RETURN_VALUE_USED(opline)",
          "old_line_content": "\t\t\t  || opline->opcode == ZEND_ASSIGN_MUL",
          "new_line_content": "\t\t\t && !RETURN_VALUE_USED(opline)",
          "content_same": false
        },
        {
          "line": 687,
          "old_api": null,
          "new_api": "opline_supports_assign_contraction",
          "old_text": null,
          "new_text": "opline_supports_assign_contraction(\n\t\t\t\t\t\t ssa, &op_array->opcodes[ssa->vars[src_var].definition],\n\t\t\t\t\t\t src_var, opline->op1.var)",
          "old_line_content": "\t\t\t\t\t\tint op_2 = ssa->vars[src_var].definition;",
          "new_line_content": "\t\t\t\t\t && opline_supports_assign_contraction(",
          "content_same": false
        },
        {
          "line": 697,
          "old_api": null,
          "new_api": "zend_ssa_unlink_use_chain",
          "old_text": null,
          "new_text": "zend_ssa_unlink_use_chain(ssa, op_1, orig_var)",
          "old_line_content": "\t\t\t\t\t\t\tssa->vars[src_var].definition = -1;",
          "new_line_content": "\t\t\t\t\t\tif (zend_ssa_unlink_use_chain(ssa, op_1, orig_var)) {",
          "content_same": false
        },
        {
          "line": 836,
          "old_api": null,
          "new_api": "ssa_verify_integrity",
          "old_text": null,
          "new_text": "ssa_verify_integrity(op_array, ssa, \"after dfa\")",
          "old_line_content": "#if ZEND_DEBUG_DFA",
          "new_line_content": "\t\tssa_verify_integrity(op_array, ssa, \"after dfa\");",
          "content_same": false
        },
        {
          "line": 840,
          "old_api": null,
          "new_api": "zend_ssa_remove_nops",
          "old_text": null,
          "new_text": "zend_ssa_remove_nops(op_array, ssa)",
          "old_line_content": "\t}",
          "new_line_content": "\t\t\tzend_ssa_remove_nops(op_array, ssa);",
          "content_same": false
        },
        {
          "line": 713,
          "old_api": null,
          "new_api": "MAKE_NOP",
          "old_text": null,
          "new_text": "MAKE_NOP(opline)",
          "old_line_content": "\t\t\t\t\t     && ssa->ops[op_1].op2_use >= 0",
          "new_line_content": "\t\t\t\t\t\t\tMAKE_NOP(opline);",
          "content_same": false
        },
        {
          "line": 842,
          "old_api": null,
          "new_api": "ssa_verify_integrity",
          "old_text": null,
          "new_text": "ssa_verify_integrity(op_array, ssa, \"after nop\")",
          "old_line_content": "\tif (ctx->debug_level & ZEND_DUMP_AFTER_DFA_PASS) {",
          "new_line_content": "\t\t\tssa_verify_integrity(op_array, ssa, \"after nop\");",
          "content_same": false
        },
        {
          "line": 848,
          "old_api": null,
          "new_api": "zend_dump_op_array",
          "old_text": null,
          "new_text": "zend_dump_op_array(op_array, ZEND_DUMP_SSA, \"after dfa pass\", ssa)",
          "old_line_content": "{",
          "new_line_content": "\t\tzend_dump_op_array(op_array, ZEND_DUMP_SSA, \"after dfa pass\", ssa);",
          "content_same": false
        },
        {
          "line": 725,
          "old_api": null,
          "new_api": "zend_ssa_unlink_use_chain",
          "old_text": null,
          "new_text": "zend_ssa_unlink_use_chain(ssa, op_1, orig_var)",
          "old_line_content": "\t\t\t\t\t\t/* Reconstruct SSA */",
          "new_line_content": "\t\t\t\t\t\t\tzend_ssa_unlink_use_chain(ssa, op_1, orig_var);",
          "content_same": false
        },
        {
          "line": 859,
          "old_api": null,
          "new_api": "zend_arena_release",
          "old_text": null,
          "new_text": "zend_arena_release(&ctx->arena, checkpoint)",
          "old_line_content": "",
          "new_line_content": "\t\tzend_arena_release(&ctx->arena, checkpoint);",
          "content_same": false
        },
        {
          "line": 863,
          "old_api": null,
          "new_api": "zend_dfa_optimize_op_array",
          "old_text": null,
          "new_text": "zend_dfa_optimize_op_array(op_array, ctx, &ssa, NULL)",
          "old_line_content": "",
          "new_line_content": "\tzend_dfa_optimize_op_array(op_array, ctx, &ssa, NULL);",
          "content_same": false
        },
        {
          "line": 866,
          "old_api": null,
          "new_api": "zend_arena_release",
          "old_text": null,
          "new_text": "zend_arena_release(&ctx->arena, checkpoint)",
          "old_line_content": " * tab-width: 4",
          "new_line_content": "\tzend_arena_release(&ctx->arena, checkpoint);",
          "content_same": false
        },
        {
          "line": 753,
          "old_api": null,
          "new_api": "CT_CONSTANT_EX",
          "old_text": null,
          "new_text": "CT_CONSTANT_EX(op_array, opline->op2.constant)",
          "old_line_content": "// op_1: ASSIGN_ADD #?.CV [undef,null,int,foat] ->#v.CV, int(1) => PRE_INC #?.CV ->#v.CV",
          "new_line_content": "\t\t\t && Z_TYPE_P(CT_CONSTANT_EX(op_array, opline->op2.constant)) == IS_LONG",
          "content_same": false
        },
        {
          "line": 754,
          "old_api": null,
          "new_api": "CT_CONSTANT_EX",
          "old_text": null,
          "new_text": "CT_CONSTANT_EX(op_array, opline->op2.constant)",
          "old_line_content": "",
          "new_line_content": "\t\t\t && Z_LVAL_P(CT_CONSTANT_EX(op_array, opline->op2.constant)) == 1",
          "content_same": false
        },
        {
          "line": 761,
          "old_api": null,
          "new_api": "SET_UNUSED",
          "old_text": null,
          "new_text": "SET_UNUSED(opline->op2)",
          "old_line_content": "\t\t\t && opline->op2_type == IS_CONST",
          "new_line_content": "\t\t\t\tSET_UNUSED(opline->op2);",
          "content_same": false
        },
        {
          "line": 767,
          "old_api": null,
          "new_api": "CT_CONSTANT_EX",
          "old_text": null,
          "new_text": "CT_CONSTANT_EX(op_array, opline->op2.constant)",
          "old_line_content": "// op_1: ASSIGN_SUB #?.CV [undef,null,int,foat] -> #v.CV, int(1) => PRE_DEC #?.CV ->#v.CV",
          "new_line_content": "\t\t\t && Z_TYPE_P(CT_CONSTANT_EX(op_array, opline->op2.constant)) == IS_LONG",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 770,
          "old_api": "SET_UNUSED",
          "new_api": null,
          "old_text": "SET_UNUSED(opline->op2)",
          "new_text": null,
          "old_line_content": "\t\t\t\tSET_UNUSED(opline->op2);",
          "new_line_content": "\t\t\t && !(ssa->var_info[ssa->ops[op_1].op1_use].type & (MAY_BE_FALSE|MAY_BE_TRUE|MAY_BE_STRING|MAY_BE_ARRAY|MAY_BE_OBJECT|MAY_BE_RESOURCE|MAY_BE_REF))) {",
          "content_same": false
        },
        {
          "line": 777,
          "old_api": "can_elide_return_type_check",
          "new_api": null,
          "old_text": "can_elide_return_type_check(op_array, ssa, &ssa->ops[op_1])",
          "new_text": null,
          "old_line_content": "\t\t\t && can_elide_return_type_check(op_array, ssa, &ssa->ops[op_1])) {",
          "new_line_content": "\t\t\t} else if (opline->opcode == ZEND_VERIFY_RETURN_TYPE",
          "content_same": false
        },
        {
          "line": 662,
          "old_api": "RETURN_VALUE_USED",
          "new_api": null,
          "old_text": "RETURN_VALUE_USED(opline)",
          "new_text": null,
          "old_line_content": "\t\t\t && !RETURN_VALUE_USED(opline)",
          "new_line_content": "\t\t\t\tcontinue;",
          "content_same": false
        },
        {
          "line": 796,
          "old_api": "MAKE_NOP",
          "new_api": null,
          "old_text": "MAKE_NOP(opline)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\tMAKE_NOP(opline);",
          "new_line_content": "\t\t\t\t\tssa->vars[v].use_chain = -1;",
          "content_same": false
        },
        {
          "line": 682,
          "old_api": "opline_supports_assign_contraction",
          "new_api": null,
          "old_text": "opline_supports_assign_contraction(\n\t\t\t\t\t\t ssa, &op_array->opcodes[ssa->vars[src_var].definition],\n\t\t\t\t\t\t src_var, opline->op1.var)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\t && opline_supports_assign_contraction(",
          "new_line_content": "\t\t\t\t\t && ssa->ops[ssa->vars[src_var].definition].result_use < 0",
          "content_same": false
        },
        {
          "line": 692,
          "old_api": "zend_ssa_unlink_use_chain",
          "new_api": null,
          "old_text": "zend_ssa_unlink_use_chain(ssa, op_1, orig_var)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\t\tif (zend_ssa_unlink_use_chain(ssa, op_1, orig_var)) {",
          "new_line_content": "\t\t\t\t\t\tint op_2 = ssa->vars[src_var].definition;",
          "content_same": false
        },
        {
          "line": 831,
          "old_api": "ssa_verify_integrity",
          "new_api": null,
          "old_text": "ssa_verify_integrity(op_array, ssa, \"after dfa\")",
          "new_text": null,
          "old_line_content": "\t\tssa_verify_integrity(op_array, ssa, \"after dfa\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 835,
          "old_api": "zend_ssa_remove_nops",
          "new_api": null,
          "old_text": "zend_ssa_remove_nops(op_array, ssa)",
          "new_text": null,
          "old_line_content": "\t\t\tzend_ssa_remove_nops(op_array, ssa);",
          "new_line_content": "#if ZEND_DEBUG_DFA",
          "content_same": false
        },
        {
          "line": 708,
          "old_api": "MAKE_NOP",
          "new_api": null,
          "old_text": "MAKE_NOP(opline)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\t\t\tMAKE_NOP(opline);",
          "new_line_content": "\t\t\t\t\t\t\tssa->ops[op_1].op1_use_chain = -1;",
          "content_same": false
        },
        {
          "line": 837,
          "old_api": "ssa_verify_integrity",
          "new_api": null,
          "old_text": "ssa_verify_integrity(op_array, ssa, \"after nop\")",
          "new_text": null,
          "old_line_content": "\t\t\tssa_verify_integrity(op_array, ssa, \"after nop\");",
          "new_line_content": "#endif",
          "content_same": false
        },
        {
          "line": 843,
          "old_api": "zend_dump_op_array",
          "new_api": null,
          "old_text": "zend_dump_op_array(op_array, ZEND_DUMP_SSA, \"after dfa pass\", ssa)",
          "new_text": null,
          "old_line_content": "\t\tzend_dump_op_array(op_array, ZEND_DUMP_SSA, \"after dfa pass\", ssa);",
          "new_line_content": "#endif",
          "content_same": false
        },
        {
          "line": 720,
          "old_api": "zend_ssa_unlink_use_chain",
          "new_api": null,
          "old_text": "zend_ssa_unlink_use_chain(ssa, op_1, orig_var)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\t\t\tzend_ssa_unlink_use_chain(ssa, op_1, orig_var);",
          "new_line_content": "\t\t\t\t\t) {",
          "content_same": false
        },
        {
          "line": 849,
          "old_api": "zend_arena_checkpoint",
          "new_api": null,
          "old_text": "zend_arena_checkpoint(ctx->arena)",
          "new_text": null,
          "old_line_content": "\tvoid *checkpoint = zend_arena_checkpoint(ctx->arena);",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 853,
          "old_api": "zend_dfa_analyze_op_array",
          "new_api": null,
          "old_text": "zend_dfa_analyze_op_array(op_array, ctx, &ssa, &flags)",
          "new_text": null,
          "old_line_content": "\tif (zend_dfa_analyze_op_array(op_array, ctx, &ssa, &flags) != SUCCESS) {",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 861,
          "old_api": "zend_arena_release",
          "new_api": null,
          "old_text": "zend_arena_release(&ctx->arena, checkpoint)",
          "new_text": null,
          "old_line_content": "\tzend_arena_release(&ctx->arena, checkpoint);",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 748,
          "old_api": "CT_CONSTANT_EX",
          "new_api": null,
          "old_text": "CT_CONSTANT_EX(op_array, opline->op2.constant)",
          "new_text": null,
          "old_line_content": "\t\t\t && Z_TYPE_P(CT_CONSTANT_EX(op_array, opline->op2.constant)) == IS_LONG",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 749,
          "old_api": "CT_CONSTANT_EX",
          "new_api": null,
          "old_text": "CT_CONSTANT_EX(op_array, opline->op2.constant)",
          "new_text": null,
          "old_line_content": "\t\t\t && Z_LVAL_P(CT_CONSTANT_EX(op_array, opline->op2.constant)) == 1",
          "new_line_content": "\t\t\t} else if (opline->opcode == ZEND_ASSIGN_ADD",
          "content_same": false
        },
        {
          "line": 756,
          "old_api": "SET_UNUSED",
          "new_api": null,
          "old_text": "SET_UNUSED(opline->op2)",
          "new_text": null,
          "old_line_content": "\t\t\t\tSET_UNUSED(opline->op2);",
          "new_line_content": "\t\t\t && !(ssa->var_info[ssa->ops[op_1].op1_use].type & (MAY_BE_FALSE|MAY_BE_TRUE|MAY_BE_STRING|MAY_BE_ARRAY|MAY_BE_OBJECT|MAY_BE_RESOURCE|MAY_BE_REF))) {",
          "content_same": false
        },
        {
          "line": 762,
          "old_api": "CT_CONSTANT_EX",
          "new_api": null,
          "old_text": "CT_CONSTANT_EX(op_array, opline->op2.constant)",
          "new_text": null,
          "old_line_content": "\t\t\t && Z_TYPE_P(CT_CONSTANT_EX(op_array, opline->op2.constant)) == IS_LONG",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 763,
          "old_api": "CT_CONSTANT_EX",
          "new_api": null,
          "old_text": "CT_CONSTANT_EX(op_array, opline->op2.constant)",
          "new_text": null,
          "old_line_content": "\t\t\t && Z_LVAL_P(CT_CONSTANT_EX(op_array, opline->op2.constant)) == 1",
          "new_line_content": "\t\t\t} else if (opline->opcode == ZEND_ASSIGN_SUB",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 4,
      "total_additions": 22,
      "total_deletions": 20,
      "total_api_changes": 46
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 5,
        "api_related_lines": 46,
        "non_api_lines": 3,
        "non_api_line_numbers": [
          656,
          652,
          655
        ]
      }
    },
    "api_calls_before": 136,
    "api_calls_after": 138,
    "diff_info": {
      "added_lines": 5,
      "removed_lines": 0,
      "total_diff_lines": 17
    }
  }
}