{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/php-src/modified_file/9c283850fb36dd4fe71bf9c5699cef28da09b501",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/php-src/modified_file/9c283850fb36dd4fe71bf9c5699cef28da09b501/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/php-src/modified_file/9c283850fb36dd4fe71bf9c5699cef28da09b501/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/php-src/modified_file/9c283850fb36dd4fe71bf9c5699cef28da09b501/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 461,
          "old_api": "MB_CONVERT_BUF_STORE",
          "new_api": "MB_CONVERT_BUF_ENSURE",
          "old_text": "MB_CONVERT_BUF_STORE(buf, out, limit)",
          "new_text": "MB_CONVERT_BUF_ENSURE(buf, out, limit, len)",
          "old_line_content": "\tMB_CONVERT_BUF_STORE(buf, out, limit);",
          "new_line_content": "\t\t\t\tMB_CONVERT_BUF_ENSURE(buf, out, limit, len);",
          "content_same": false
        },
        {
          "line": 643,
          "old_api": "MB_CONVERT_BUF_STORE",
          "new_api": "MB_CONVERT_BUF_ENSURE",
          "old_text": "MB_CONVERT_BUF_STORE(buf, out, limit)",
          "new_text": "MB_CONVERT_BUF_ENSURE(buf, out, limit, len)",
          "old_line_content": "\tMB_CONVERT_BUF_STORE(buf, out, limit);",
          "new_line_content": "\t\t\t\tMB_CONVERT_BUF_ENSURE(buf, out, limit, len);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 640,
          "old_api": null,
          "new_api": "mb_convert_buf_add",
          "old_text": null,
          "new_text": "mb_convert_buf_add(out, 0)",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\t\t\tout = mb_convert_buf_add(out, 0);",
          "content_same": false
        },
        {
          "line": 642,
          "old_api": null,
          "new_api": "MB_CONVERT_ERROR",
          "old_text": null,
          "new_text": "MB_CONVERT_ERROR(buf, out, limit, w, mb_wchar_to_big5)",
          "old_line_content": "",
          "new_line_content": "\t\t\t\tMB_CONVERT_ERROR(buf, out, limit, w, mb_wchar_to_big5);",
          "content_same": false
        },
        {
          "line": 471,
          "old_api": null,
          "new_api": "MB_CONVERT_BUF_STORE",
          "old_text": null,
          "new_text": "MB_CONVERT_BUF_STORE(buf, out, limit)",
          "old_line_content": "",
          "new_line_content": "\tMB_CONVERT_BUF_STORE(buf, out, limit);",
          "content_same": false
        },
        {
          "line": 646,
          "old_api": null,
          "new_api": "mb_convert_buf_add",
          "old_text": null,
          "new_text": "mb_convert_buf_add(out, s)",
          "old_line_content": "",
          "new_line_content": "\t\t\tout = mb_convert_buf_add(out, s);",
          "content_same": false
        },
        {
          "line": 648,
          "old_api": null,
          "new_api": "MB_CONVERT_BUF_ENSURE",
          "old_text": null,
          "new_text": "MB_CONVERT_BUF_ENSURE(buf, out, limit, len + 2)",
          "old_line_content": "",
          "new_line_content": "\t\t\tMB_CONVERT_BUF_ENSURE(buf, out, limit, len + 2);",
          "content_same": false
        },
        {
          "line": 649,
          "old_api": null,
          "new_api": "mb_convert_buf_add2",
          "old_text": null,
          "new_text": "mb_convert_buf_add2(out, (s >> 8) & 0xFF, s & 0xFF)",
          "old_line_content": "",
          "new_line_content": "\t\t\tout = mb_convert_buf_add2(out, (s >> 8) & 0xFF, s & 0xFF);",
          "content_same": false
        },
        {
          "line": 458,
          "old_api": null,
          "new_api": "mb_convert_buf_add",
          "old_text": null,
          "new_text": "mb_convert_buf_add(out, 0)",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\t\t\tout = mb_convert_buf_add(out, 0);",
          "content_same": false
        },
        {
          "line": 460,
          "old_api": null,
          "new_api": "MB_CONVERT_ERROR",
          "old_text": null,
          "new_text": "MB_CONVERT_ERROR(buf, out, limit, w, mb_wchar_to_big5)",
          "old_line_content": "",
          "new_line_content": "\t\t\t\tMB_CONVERT_ERROR(buf, out, limit, w, mb_wchar_to_big5);",
          "content_same": false
        },
        {
          "line": 653,
          "old_api": null,
          "new_api": "MB_CONVERT_BUF_STORE",
          "old_text": null,
          "new_text": "MB_CONVERT_BUF_STORE(buf, out, limit)",
          "old_line_content": "",
          "new_line_content": "\tMB_CONVERT_BUF_STORE(buf, out, limit);",
          "content_same": false
        },
        {
          "line": 492,
          "old_api": null,
          "new_api": "is_in_cp950_pua",
          "old_text": null,
          "new_text": "is_in_cp950_pua(c, c2)",
          "old_line_content": "\t\t\t\t\tif ((cp950_pua_tbl[k][2] & 0xFF) == 0x40) {",
          "new_line_content": "\t\t\t\tif (is_in_cp950_pua(c, c2)) {",
          "content_same": false
        },
        {
          "line": 464,
          "old_api": null,
          "new_api": "mb_convert_buf_add",
          "old_text": null,
          "new_text": "mb_convert_buf_add(out, s)",
          "old_line_content": "static size_t mb_cp950_to_wchar(unsigned char **in, size_t *in_len, uint32_t *buf, size_t bufsize, unsigned int *state)",
          "new_line_content": "\t\t\tout = mb_convert_buf_add(out, s);",
          "content_same": false
        },
        {
          "line": 466,
          "old_api": null,
          "new_api": "MB_CONVERT_BUF_ENSURE",
          "old_text": null,
          "new_text": "MB_CONVERT_BUF_ENSURE(buf, out, limit, len + 2)",
          "old_line_content": "\tunsigned char *p = *in, *e = p + *in_len;",
          "new_line_content": "\t\t\tMB_CONVERT_BUF_ENSURE(buf, out, limit, len + 2);",
          "content_same": false
        },
        {
          "line": 435,
          "old_api": null,
          "new_api": "MB_CONVERT_BUF_LOAD",
          "old_text": null,
          "new_text": "MB_CONVERT_BUF_LOAD(buf, out, limit)",
          "old_line_content": "\t\t\ts = ucs_a2_big5_table[w - ucs_a2_big5_table_min];",
          "new_line_content": "\tMB_CONVERT_BUF_LOAD(buf, out, limit);",
          "content_same": false
        },
        {
          "line": 436,
          "old_api": null,
          "new_api": "MB_CONVERT_BUF_ENSURE",
          "old_text": null,
          "new_text": "MB_CONVERT_BUF_ENSURE(buf, out, limit, len)",
          "old_line_content": "\t\t} else if (w >= ucs_a3_big5_table_min && w < ucs_a3_big5_table_max) {",
          "new_line_content": "\tMB_CONVERT_BUF_ENSURE(buf, out, limit, len);",
          "content_same": false
        },
        {
          "line": 467,
          "old_api": null,
          "new_api": "mb_convert_buf_add2",
          "old_text": null,
          "new_text": "mb_convert_buf_add2(out, (s >> 8) & 0xFF, s & 0xFF)",
          "old_line_content": "\tuint32_t *out = buf, *limit = buf + bufsize;",
          "new_line_content": "\t\t\tout = mb_convert_buf_add2(out, (s >> 8) & 0xFF, s & 0xFF);",
          "content_same": false
        },
        {
          "line": 566,
          "old_api": null,
          "new_api": "MB_CONVERT_BUF_LOAD",
          "old_text": null,
          "new_text": "MB_CONVERT_BUF_LOAD(buf, out, limit)",
          "old_line_content": "\t\t\ts = ucs_a2_big5_table[w - ucs_a2_big5_table_min];",
          "new_line_content": "\tMB_CONVERT_BUF_LOAD(buf, out, limit);",
          "content_same": false
        },
        {
          "line": 567,
          "old_api": null,
          "new_api": "MB_CONVERT_BUF_ENSURE",
          "old_text": null,
          "new_text": "MB_CONVERT_BUF_ENSURE(buf, out, limit, len)",
          "old_line_content": "\t\t} else if (w >= ucs_a3_big5_table_min && w < ucs_a3_big5_table_max) {",
          "new_line_content": "\tMB_CONVERT_BUF_ENSURE(buf, out, limit, len);",
          "content_same": false
        },
        {
          "line": 408,
          "old_api": null,
          "new_api": "ZEND_ASSERT",
          "old_text": null,
          "new_text": "ZEND_ASSERT(w < big5_ucs_table_size)",
          "old_line_content": "\t\t\t\t*out++ = w;",
          "new_line_content": "\t\t\t\tZEND_ASSERT(w < big5_ucs_table_size);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 448,
          "old_api": "mb_convert_buf_add",
          "new_api": null,
          "old_text": "mb_convert_buf_add(out, 0)",
          "new_text": null,
          "old_line_content": "\t\t\t\tout = mb_convert_buf_add(out, 0);",
          "new_line_content": "\t\t} else if (w >= ucs_i_big5_table_min && w < ucs_i_big5_table_max) {",
          "content_same": false
        },
        {
          "line": 450,
          "old_api": "MB_CONVERT_ERROR",
          "new_api": null,
          "old_text": "MB_CONVERT_ERROR(buf, out, limit, w, mb_wchar_to_big5)",
          "new_text": null,
          "old_line_content": "\t\t\t\tMB_CONVERT_ERROR(buf, out, limit, w, mb_wchar_to_big5);",
          "new_line_content": "\t\t} else if (w >= ucs_r1_big5_table_min && w < ucs_r1_big5_table_max) {",
          "content_same": false
        },
        {
          "line": 451,
          "old_api": "MB_CONVERT_BUF_ENSURE",
          "new_api": null,
          "old_text": "MB_CONVERT_BUF_ENSURE(buf, out, limit, len)",
          "new_text": null,
          "old_line_content": "\t\t\t\tMB_CONVERT_BUF_ENSURE(buf, out, limit, len);",
          "new_line_content": "\t\t\ts = ucs_r1_big5_table[w - ucs_r1_big5_table_min];",
          "content_same": false
        },
        {
          "line": 482,
          "old_api": "is_in_cp950_pua",
          "new_api": null,
          "old_text": "is_in_cp950_pua(c, c2)",
          "new_text": null,
          "old_line_content": "\t\t\t\tif (is_in_cp950_pua(c, c2)) {",
          "new_line_content": "\t\tif (c <= 0x7F) {",
          "content_same": false
        },
        {
          "line": 454,
          "old_api": "mb_convert_buf_add",
          "new_api": null,
          "old_text": "mb_convert_buf_add(out, s)",
          "new_text": null,
          "old_line_content": "\t\t\tout = mb_convert_buf_add(out, s);",
          "new_line_content": "\t\t}",
          "content_same": false
        },
        {
          "line": 456,
          "old_api": "MB_CONVERT_BUF_ENSURE",
          "new_api": null,
          "old_text": "MB_CONVERT_BUF_ENSURE(buf, out, limit, len + 2)",
          "new_text": null,
          "old_line_content": "\t\t\tMB_CONVERT_BUF_ENSURE(buf, out, limit, len + 2);",
          "new_line_content": "\t\tif (!s) {",
          "content_same": false
        },
        {
          "line": 425,
          "old_api": "MB_CONVERT_BUF_LOAD",
          "new_api": null,
          "old_text": "MB_CONVERT_BUF_LOAD(buf, out, limit)",
          "new_text": null,
          "old_line_content": "\tMB_CONVERT_BUF_LOAD(buf, out, limit);",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 426,
          "old_api": "MB_CONVERT_BUF_ENSURE",
          "new_api": null,
          "old_text": "MB_CONVERT_BUF_ENSURE(buf, out, limit, len)",
          "new_text": null,
          "old_line_content": "\tMB_CONVERT_BUF_ENSURE(buf, out, limit, len);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 457,
          "old_api": "mb_convert_buf_add2",
          "new_api": null,
          "old_text": "mb_convert_buf_add2(out, (s >> 8) & 0xFF, s & 0xFF)",
          "new_text": null,
          "old_line_content": "\t\t\tout = mb_convert_buf_add2(out, (s >> 8) & 0xFF, s & 0xFF);",
          "new_line_content": "\t\t\tif (w == 0) {",
          "content_same": false
        },
        {
          "line": 556,
          "old_api": "MB_CONVERT_BUF_LOAD",
          "new_api": null,
          "old_text": "MB_CONVERT_BUF_LOAD(buf, out, limit)",
          "new_text": null,
          "old_line_content": "\tMB_CONVERT_BUF_LOAD(buf, out, limit);",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 557,
          "old_api": "MB_CONVERT_BUF_ENSURE",
          "new_api": null,
          "old_text": "MB_CONVERT_BUF_ENSURE(buf, out, limit, len)",
          "new_text": null,
          "old_line_content": "\tMB_CONVERT_BUF_ENSURE(buf, out, limit, len);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 404,
          "old_api": "ZEND_ASSERT",
          "new_api": null,
          "old_text": "ZEND_ASSERT(w < big5_ucs_table_size)",
          "new_text": null,
          "old_line_content": "\t\t\t\tZEND_ASSERT(w < big5_ucs_table_size);",
          "new_line_content": "\t\t\tunsigned char c2 = *p++;",
          "content_same": false
        },
        {
          "line": 630,
          "old_api": "mb_convert_buf_add",
          "new_api": null,
          "old_text": "mb_convert_buf_add(out, 0)",
          "new_text": null,
          "old_line_content": "\t\t\t\tout = mb_convert_buf_add(out, 0);",
          "new_line_content": "\t\t} else if (w == 0xFFE1) {",
          "content_same": false
        },
        {
          "line": 632,
          "old_api": "MB_CONVERT_ERROR",
          "new_api": null,
          "old_text": "MB_CONVERT_ERROR(buf, out, limit, w, mb_wchar_to_big5)",
          "new_text": null,
          "old_line_content": "\t\t\t\tMB_CONVERT_ERROR(buf, out, limit, w, mb_wchar_to_big5);",
          "new_line_content": "\t\t} else if (w == 0xFFE3) {",
          "content_same": false
        },
        {
          "line": 633,
          "old_api": "MB_CONVERT_BUF_ENSURE",
          "new_api": null,
          "old_text": "MB_CONVERT_BUF_ENSURE(buf, out, limit, len)",
          "new_text": null,
          "old_line_content": "\t\t\t\tMB_CONVERT_BUF_ENSURE(buf, out, limit, len);",
          "new_line_content": "\t\t\ts = 0xA1C3;",
          "content_same": false
        },
        {
          "line": 636,
          "old_api": "mb_convert_buf_add",
          "new_api": null,
          "old_text": "mb_convert_buf_add(out, s)",
          "new_text": null,
          "old_line_content": "\t\t\tout = mb_convert_buf_add(out, s);",
          "new_line_content": "\t\t}",
          "content_same": false
        },
        {
          "line": 638,
          "old_api": "MB_CONVERT_BUF_ENSURE",
          "new_api": null,
          "old_text": "MB_CONVERT_BUF_ENSURE(buf, out, limit, len + 2)",
          "new_text": null,
          "old_line_content": "\t\t\tMB_CONVERT_BUF_ENSURE(buf, out, limit, len + 2);",
          "new_line_content": "\t\tif (!s) {",
          "content_same": false
        },
        {
          "line": 639,
          "old_api": "mb_convert_buf_add2",
          "new_api": null,
          "old_text": "mb_convert_buf_add2(out, (s >> 8) & 0xFF, s & 0xFF)",
          "new_text": null,
          "old_line_content": "\t\t\tout = mb_convert_buf_add2(out, (s >> 8) & 0xFF, s & 0xFF);",
          "new_line_content": "\t\t\tif (w == 0) {",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 2,
      "total_additions": 18,
      "total_deletions": 18,
      "total_api_changes": 38
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 14,
        "api_related_lines": 38,
        "non_api_lines": 12,
        "non_api_line_numbers": [
          417,
          421,
          422,
          423,
          424,
          394,
          395,
          427,
          399,
          401,
          402,
          403
        ]
      }
    },
    "api_calls_before": 41,
    "api_calls_after": 41,
    "diff_info": {
      "added_lines": 12,
      "removed_lines": 2,
      "total_diff_lines": 38
    }
  }
}