{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/php-src/modified_file/68185bafbe2c7ab025703917d259c4c19ce456eb",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/php-src/modified_file/68185bafbe2c7ab025703917d259c4c19ce456eb/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/php-src/modified_file/68185bafbe2c7ab025703917d259c4c19ce456eb/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/php-src/modified_file/68185bafbe2c7ab025703917d259c4c19ce456eb/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": true,
    "api_changes": {
      "replacements": [
        {
          "line": 668,
          "old_api": "_mm_stream_si128",
          "new_api": "_mm_store_si128",
          "old_text": "_mm_stream_si128(dqdest + 1, xmm1)",
          "new_text": "_mm_store_si128(dqdest + 0, xmm0)",
          "old_line_content": "\t\t_mm_stream_si128(dqdest + 1, xmm1);",
          "new_line_content": "\t\t_mm_store_si128(dqdest + 0, xmm0);",
          "content_same": false
        },
        {
          "line": 669,
          "old_api": "_mm_stream_si128",
          "new_api": "_mm_store_si128",
          "old_text": "_mm_stream_si128(dqdest + 2, xmm2)",
          "new_text": "_mm_store_si128(dqdest + 1, xmm1)",
          "old_line_content": "\t\t_mm_stream_si128(dqdest + 2, xmm2);",
          "new_line_content": "\t\t_mm_store_si128(dqdest + 1, xmm1);",
          "content_same": false
        },
        {
          "line": 670,
          "old_api": "_mm_stream_si128",
          "new_api": "_mm_store_si128",
          "old_text": "_mm_stream_si128(dqdest\t+ 3, xmm3)",
          "new_text": "_mm_store_si128(dqdest + 2, xmm2)",
          "old_line_content": "\t\t_mm_stream_si128(dqdest\t+ 3, xmm3);",
          "new_line_content": "\t\t_mm_store_si128(dqdest + 2, xmm2);",
          "content_same": false
        },
        {
          "line": 684,
          "old_api": "ZCG",
          "new_api": "EXPECTED",
          "old_text": "ZCG(bind_hash)",
          "new_text": "EXPECTED(from_shared_memory)",
          "old_line_content": "\t\tzend_hash_init(&ZCG(bind_hash), 10, NULL, NULL, 0);",
          "new_line_content": "\tif (EXPECTED(from_shared_memory)) {",
          "content_same": false
        },
        {
          "line": 688,
          "old_api": "EXPECTED",
          "new_api": "ZCG",
          "old_text": "EXPECTED(persistent_script->arena_size)",
          "new_text": "ZCG(arena_mem)",
          "old_line_content": "\t\tif (EXPECTED(persistent_script->arena_size)) {",
          "new_line_content": "\t\tZCG(arena_mem) = NULL;",
          "content_same": false
        },
        {
          "line": 692,
          "old_api": "ZCG",
          "new_api": "CG",
          "old_text": "ZCG(arena_mem)",
          "new_text": "CG(arena)",
          "old_line_content": "\t\t\tZCG(arena_mem) = (void*)(((zend_uintptr_t)ZCG(arena_mem) + 63L) & ~63L);",
          "new_line_content": "\t\t\tZCG(arena_mem) = zend_arena_alloc(&CG(arena), persistent_script->arena_size + 64);",
          "content_same": false
        },
        {
          "line": 696,
          "old_api": "ZCG",
          "new_api": "CG",
          "old_text": "ZCG(arena_mem)",
          "new_text": "CG(arena)",
          "old_line_content": "\t\t\tmemcpy(ZCG(arena_mem), persistent_script->arena_mem, persistent_script->arena_size);",
          "new_line_content": "\t\t\tZCG(arena_mem) = zend_arena_alloc(&CG(arena), persistent_script->arena_size);",
          "content_same": false
        },
        {
          "line": 702,
          "old_api": "CG",
          "new_api": "zend_hash_num_elements",
          "old_text": "CG(class_table)",
          "new_text": "zend_hash_num_elements(&persistent_script->class_table)",
          "old_line_content": "\t\t\tzend_accel_class_hash_copy(CG(class_table), &persistent_script->class_table, (unique_copy_ctor_func_t) zend_class_copy_ctor);",
          "new_line_content": "\t\tif (zend_hash_num_elements(&persistent_script->class_table) > 0) {",
          "content_same": false
        },
        {
          "line": 707,
          "old_api": "CG",
          "new_api": "zend_hash_num_elements",
          "old_text": "CG(function_table)",
          "new_text": "zend_hash_num_elements(&persistent_script->function_table)",
          "old_line_content": "\t\t\tzend_accel_function_hash_copy_from_shm(CG(function_table), &persistent_script->function_table);",
          "new_line_content": "\t\tif (zend_hash_num_elements(&persistent_script->function_table) > 0) {",
          "content_same": false
        },
        {
          "line": 717,
          "old_api": "EG",
          "new_api": "ZSTR_LEN",
          "old_text": "EG(zend_constants)",
          "new_text": "ZSTR_LEN(persistent_script->full_path)",
          "old_line_content": "\t\t\tif (!zend_hash_exists(EG(zend_constants), name)) {",
          "new_line_content": "\t\t\tname = zend_mangle_property_name(haltoff, sizeof(haltoff) - 1, ZSTR_VAL(persistent_script->full_path), ZSTR_LEN(persistent_script->full_path), 0);",
          "content_same": false
        },
        {
          "line": 718,
          "old_api": "ZSTR_LEN",
          "new_api": "EG",
          "old_text": "ZSTR_LEN(name)",
          "new_text": "EG(zend_constants)",
          "old_line_content": "\t\t\t\tzend_register_long_constant(ZSTR_VAL(name), ZSTR_LEN(name), persistent_script->compiler_halt_offset, CONST_CS, 0);",
          "new_line_content": "\t\t\tif (!zend_hash_exists(EG(zend_constants), name)) {",
          "content_same": false
        },
        {
          "line": 727,
          "old_api": "CG",
          "new_api": "zend_hash_num_elements",
          "old_text": "CG(function_table)",
          "new_text": "zend_hash_num_elements(&persistent_script->function_table)",
          "old_line_content": "\t\t\tzend_accel_function_hash_copy(CG(function_table), &persistent_script->function_table);",
          "new_line_content": "\t\tif (zend_hash_num_elements(&persistent_script->function_table) > 0) {",
          "content_same": false
        },
        {
          "line": 730,
          "old_api": "CG",
          "new_api": "zend_hash_num_elements",
          "old_text": "CG(class_table)",
          "new_text": "zend_hash_num_elements(&persistent_script->class_table)",
          "old_line_content": "\t\t\tzend_accel_class_hash_copy(CG(class_table), &persistent_script->class_table, NULL);",
          "new_line_content": "\t\tif (zend_hash_num_elements(&persistent_script->class_table) > 0) {",
          "content_same": false
        },
        {
          "line": 737,
          "old_api": "zend_do_delayed_early_binding",
          "new_api": "CG",
          "old_text": "zend_do_delayed_early_binding(op_array)",
          "new_text": "CG(compiled_filename)",
          "old_line_content": "\t\tzend_do_delayed_early_binding(op_array);",
          "new_line_content": "\t\tCG(compiled_filename) = persistent_script->full_path;",
          "content_same": false
        },
        {
          "line": 738,
          "old_api": "CG",
          "new_api": "zend_do_delayed_early_binding",
          "old_text": "CG(compiled_filename)",
          "new_text": "zend_do_delayed_early_binding(op_array)",
          "old_line_content": "\t\tCG(compiled_filename) = orig_compiled_filename;",
          "new_line_content": "\t\tzend_do_delayed_early_binding(op_array);",
          "content_same": false
        },
        {
          "line": 742,
          "old_api": "free_persistent_script",
          "new_api": "UNEXPECTED",
          "old_text": "free_persistent_script(persistent_script, 0)",
          "new_text": "UNEXPECTED(!from_shared_memory)",
          "old_line_content": "\t\tfree_persistent_script(persistent_script, 0); /* free only hashes */",
          "new_line_content": "\tif (UNEXPECTED(!from_shared_memory)) {",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 661,
          "old_api": null,
          "new_api": "_mm_prefetch",
          "old_text": null,
          "new_text": "_mm_prefetch(dqdest + 4, _MM_HINT_T0)",
          "old_line_content": "",
          "new_line_content": "\t\t_mm_prefetch(dqdest + 4, _MM_HINT_T0);",
          "content_same": false
        },
        {
          "line": 666,
          "old_api": null,
          "new_api": "_mm_load_si128",
          "old_text": null,
          "new_text": "_mm_load_si128(dqsrc + 3)",
          "old_line_content": "\t\tdqsrc  += 4;",
          "new_line_content": "\t\t__m128i xmm3 = _mm_load_si128(dqsrc + 3);",
          "content_same": false
        },
        {
          "line": 796,
          "old_api": null,
          "new_api": "ADLER32_DO16",
          "old_text": null,
          "new_text": "ADLER32_DO16(buf)",
          "old_line_content": "\t\t\tbuf += 16;",
          "new_line_content": "\t\t\tADLER32_DO16(buf);",
          "content_same": false
        },
        {
          "line": 671,
          "old_api": null,
          "new_api": "_mm_store_si128",
          "old_text": null,
          "new_text": "_mm_store_si128(dqdest + 3, xmm3)",
          "old_line_content": "\t\tdqdest += 4;",
          "new_line_content": "\t\t_mm_store_si128(dqdest + 3, xmm3);",
          "content_same": false
        },
        {
          "line": 808,
          "old_api": null,
          "new_api": "ADLER32_DO16",
          "old_text": null,
          "new_text": "ADLER32_DO16(buf)",
          "old_line_content": "\t\t\t\tbuf += 16;",
          "new_line_content": "\t\t\t\tADLER32_DO16(buf);",
          "content_same": false
        },
        {
          "line": 681,
          "old_api": null,
          "new_api": "emalloc",
          "old_text": null,
          "new_text": "emalloc(sizeof(zend_op_array))",
          "old_line_content": "\t*op_array = persistent_script->main_op_array;",
          "new_line_content": "\top_array = (zend_op_array *) emalloc(sizeof(zend_op_array));",
          "content_same": false
        },
        {
          "line": 685,
          "old_api": null,
          "new_api": "ZCG",
          "old_text": null,
          "new_text": "ZCG(bind_hash)",
          "old_line_content": "",
          "new_line_content": "\t\tzend_hash_init(&ZCG(bind_hash), 10, NULL, NULL, 0);",
          "content_same": false
        },
        {
          "line": 815,
          "old_api": null,
          "new_api": "ADLER32_DO1",
          "old_text": null,
          "new_text": "ADLER32_DO1(buf)",
          "old_line_content": "\t\t\t\tbuf++;",
          "new_line_content": "\t\t\t\tADLER32_DO1(buf);",
          "content_same": false
        },
        {
          "line": 689,
          "old_api": null,
          "new_api": "EXPECTED",
          "old_text": null,
          "new_text": "EXPECTED(persistent_script->arena_size)",
          "old_line_content": "#ifdef __SSE2__",
          "new_line_content": "\t\tif (EXPECTED(persistent_script->arena_size)) {",
          "content_same": false
        },
        {
          "line": 694,
          "old_api": null,
          "new_api": "ZCG",
          "old_text": null,
          "new_text": "ZCG(arena_mem)",
          "old_line_content": "#else",
          "new_line_content": "\t\t\tfast_memcpy(ZCG(arena_mem), persistent_script->arena_mem, persistent_script->arena_size);",
          "content_same": false
        },
        {
          "line": 697,
          "old_api": null,
          "new_api": "ZCG",
          "old_text": null,
          "new_text": "ZCG(arena_mem)",
          "old_line_content": "#endif",
          "new_line_content": "\t\t\tmemcpy(ZCG(arena_mem), persistent_script->arena_mem, persistent_script->arena_size);",
          "content_same": false
        },
        {
          "line": 703,
          "old_api": null,
          "new_api": "CG",
          "old_text": null,
          "new_text": "CG(class_table)",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\t\tzend_accel_class_hash_copy(CG(class_table), &persistent_script->class_table, (unique_copy_ctor_func_t) zend_class_copy_ctor);",
          "content_same": false
        },
        {
          "line": 834,
          "old_api": null,
          "new_api": "zend_adler32",
          "old_text": null,
          "new_text": "zend_adler32(checksum, mem, (signed char*)persistent_script - mem)",
          "old_line_content": "\t\tsize -= (signed char*)persistent_script - mem;",
          "new_line_content": "\t\tchecksum = zend_adler32(checksum, mem, (signed char*)persistent_script - mem);",
          "content_same": false
        },
        {
          "line": 708,
          "old_api": null,
          "new_api": "CG",
          "old_text": null,
          "new_text": "CG(function_table)",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\t\tzend_accel_function_hash_copy_from_shm(CG(function_table), &persistent_script->function_table);",
          "content_same": false
        },
        {
          "line": 839,
          "old_api": null,
          "new_api": "zend_adler32",
          "old_text": null,
          "new_text": "zend_adler32(checksum, mem, persistent_script_check_block_size)",
          "old_line_content": "\tmem  += sizeof(*persistent_script);",
          "new_line_content": "\tzend_adler32(checksum, mem, persistent_script_check_block_size);",
          "content_same": false
        },
        {
          "line": 844,
          "old_api": null,
          "new_api": "zend_adler32",
          "old_text": null,
          "new_text": "zend_adler32(checksum, mem, size)",
          "old_line_content": "\t}",
          "new_line_content": "\t\tchecksum = zend_adler32(checksum, mem, size);",
          "content_same": false
        },
        {
          "line": 719,
          "old_api": null,
          "new_api": "ZSTR_LEN",
          "old_text": null,
          "new_text": "ZSTR_LEN(name)",
          "old_line_content": "\t\t\t}",
          "new_line_content": "\t\t\t\tzend_register_long_constant(ZSTR_VAL(name), ZSTR_LEN(name), persistent_script->compiler_halt_offset, CONST_CS, 0);",
          "content_same": false
        },
        {
          "line": 721,
          "old_api": null,
          "new_api": "zend_string_release",
          "old_text": null,
          "new_text": "zend_string_release(name)",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\t\tzend_string_release(name);",
          "content_same": false
        },
        {
          "line": 725,
          "old_api": null,
          "new_api": "ZCG",
          "old_text": null,
          "new_text": "ZCG(current_persistent_script)",
          "old_line_content": "\t} else /* if (!from_shared_memory) */ {",
          "new_line_content": "\t\tZCG(current_persistent_script) = NULL;",
          "content_same": false
        },
        {
          "line": 728,
          "old_api": null,
          "new_api": "CG",
          "old_text": null,
          "new_text": "CG(function_table)",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\t\tzend_accel_function_hash_copy(CG(function_table), &persistent_script->function_table);",
          "content_same": false
        },
        {
          "line": 731,
          "old_api": null,
          "new_api": "CG",
          "old_text": null,
          "new_text": "CG(class_table)",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\t\tzend_accel_class_hash_copy(CG(class_table), &persistent_script->class_table, NULL);",
          "content_same": false
        },
        {
          "line": 739,
          "old_api": null,
          "new_api": "CG",
          "old_text": null,
          "new_text": "CG(compiled_filename)",
          "old_line_content": "\t}",
          "new_line_content": "\t\tCG(compiled_filename) = orig_compiled_filename;",
          "content_same": false
        },
        {
          "line": 743,
          "old_api": null,
          "new_api": "free_persistent_script",
          "old_text": null,
          "new_text": "free_persistent_script(persistent_script, 0)",
          "old_line_content": "\t}",
          "new_line_content": "\t\tfree_persistent_script(persistent_script, 0); /* free only hashes */",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 662,
          "old_api": "_mm_load_si128",
          "new_api": null,
          "old_text": "_mm_load_si128(dqsrc + 0)",
          "new_text": null,
          "old_line_content": "\t\t__m128i xmm0 = _mm_load_si128(dqsrc + 0);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 795,
          "old_api": "ADLER32_DO16",
          "new_api": null,
          "old_text": "ADLER32_DO16(buf)",
          "new_text": null,
          "old_line_content": "\t\t\tADLER32_DO16(buf);",
          "new_line_content": "\t\tdo {",
          "content_same": false
        },
        {
          "line": 667,
          "old_api": "_mm_stream_si128",
          "new_api": null,
          "old_text": "_mm_stream_si128(dqdest + 0, xmm0)",
          "new_text": null,
          "old_line_content": "\t\t_mm_stream_si128(dqdest + 0, xmm0);",
          "new_line_content": "\t\tdqsrc  += 4;",
          "content_same": false
        },
        {
          "line": 807,
          "old_api": "ADLER32_DO16",
          "new_api": null,
          "old_text": "ADLER32_DO16(buf)",
          "new_text": null,
          "old_line_content": "\t\t\t\tADLER32_DO16(buf);",
          "new_line_content": "\t\t\tdo {",
          "content_same": false
        },
        {
          "line": 680,
          "old_api": "emalloc",
          "new_api": null,
          "old_text": "emalloc(sizeof(zend_op_array))",
          "new_text": null,
          "old_line_content": "\top_array = (zend_op_array *) emalloc(sizeof(zend_op_array));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 683,
          "old_api": "EXPECTED",
          "new_api": null,
          "old_text": "EXPECTED(from_shared_memory)",
          "new_text": null,
          "old_line_content": "\tif (EXPECTED(from_shared_memory)) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 686,
          "old_api": "ZCG",
          "new_api": null,
          "old_text": "ZCG(current_persistent_script)",
          "new_text": null,
          "old_line_content": "\t\tZCG(current_persistent_script) = persistent_script;",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 814,
          "old_api": "ADLER32_DO1",
          "new_api": null,
          "old_text": "ADLER32_DO1(buf)",
          "new_text": null,
          "old_line_content": "\t\t\t\tADLER32_DO1(buf);",
          "new_line_content": "\t\t\tdo {",
          "content_same": false
        },
        {
          "line": 691,
          "old_api": "CG",
          "new_api": null,
          "old_text": "CG(arena)",
          "new_text": null,
          "old_line_content": "\t\t\tZCG(arena_mem) = zend_arena_alloc(&CG(arena), persistent_script->arena_size + 64);",
          "new_line_content": "\t\t\t/* Target address must be aligned to 64-byte boundary */",
          "content_same": false
        },
        {
          "line": 695,
          "old_api": "CG",
          "new_api": null,
          "old_text": "CG(arena)",
          "new_text": null,
          "old_line_content": "\t\t\tZCG(arena_mem) = zend_arena_alloc(&CG(arena), persistent_script->arena_size);",
          "new_line_content": "#else",
          "content_same": false
        },
        {
          "line": 701,
          "old_api": "zend_hash_num_elements",
          "new_api": null,
          "old_text": "zend_hash_num_elements(&persistent_script->class_table)",
          "new_text": null,
          "old_line_content": "\t\tif (zend_hash_num_elements(&persistent_script->class_table) > 0) {",
          "new_line_content": "\t\t/* Copy all the necessary stuff from shared memory to regular memory, and protect the shared script */",
          "content_same": false
        },
        {
          "line": 833,
          "old_api": "zend_adler32",
          "new_api": null,
          "old_text": "zend_adler32(checksum, mem, (signed char*)persistent_script - mem)",
          "new_text": null,
          "old_line_content": "\t\tchecksum = zend_adler32(checksum, mem, (signed char*)persistent_script - mem);",
          "new_line_content": "\tif (mem < (signed char*)persistent_script) {",
          "content_same": false
        },
        {
          "line": 706,
          "old_api": "zend_hash_num_elements",
          "new_api": null,
          "old_text": "zend_hash_num_elements(&persistent_script->function_table)",
          "new_text": null,
          "old_line_content": "\t\tif (zend_hash_num_elements(&persistent_script->function_table) > 0) {",
          "new_line_content": "\t\t   classes - which depend on pre-bind class entries existent in the class table */",
          "content_same": false
        },
        {
          "line": 838,
          "old_api": "zend_adler32",
          "new_api": null,
          "old_text": "zend_adler32(checksum, mem, persistent_script_check_block_size)",
          "new_text": null,
          "old_line_content": "\tzend_adler32(checksum, mem, persistent_script_check_block_size);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 843,
          "old_api": "zend_adler32",
          "new_api": null,
          "old_text": "zend_adler32(checksum, mem, size)",
          "new_text": null,
          "old_line_content": "\t\tchecksum = zend_adler32(checksum, mem, size);",
          "new_line_content": "\tif (size > 0) {",
          "content_same": false
        },
        {
          "line": 716,
          "old_api": "ZSTR_LEN",
          "new_api": null,
          "old_text": "ZSTR_LEN(persistent_script->full_path)",
          "new_text": null,
          "old_line_content": "\t\t\tname = zend_mangle_property_name(haltoff, sizeof(haltoff) - 1, ZSTR_VAL(persistent_script->full_path), ZSTR_LEN(persistent_script->full_path), 0);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 720,
          "old_api": "zend_string_release",
          "new_api": null,
          "old_text": "zend_string_release(name)",
          "new_text": null,
          "old_line_content": "\t\t\tzend_string_release(name);",
          "new_line_content": "\t\t\t}",
          "content_same": false
        },
        {
          "line": 723,
          "old_api": "ZCG",
          "new_api": null,
          "old_text": "ZCG(bind_hash)",
          "new_text": null,
          "old_line_content": "\t\tzend_hash_destroy(&ZCG(bind_hash));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 726,
          "old_api": "zend_hash_num_elements",
          "new_api": null,
          "old_text": "zend_hash_num_elements(&persistent_script->function_table)",
          "new_text": null,
          "old_line_content": "\t\tif (zend_hash_num_elements(&persistent_script->function_table) > 0) {",
          "new_line_content": "\t} else /* if (!from_shared_memory) */ {",
          "content_same": false
        },
        {
          "line": 729,
          "old_api": "zend_hash_num_elements",
          "new_api": null,
          "old_text": "zend_hash_num_elements(&persistent_script->class_table)",
          "new_text": null,
          "old_line_content": "\t\tif (zend_hash_num_elements(&persistent_script->class_table) > 0) {",
          "new_line_content": "\t\t}",
          "content_same": false
        },
        {
          "line": 735,
          "old_api": "CG",
          "new_api": null,
          "old_text": "CG(compiled_filename)",
          "new_text": null,
          "old_line_content": "\t\tzend_string *orig_compiled_filename = CG(compiled_filename);",
          "new_line_content": "\tif (op_array->early_binding != (uint32_t)-1) {",
          "content_same": false
        },
        {
          "line": 741,
          "old_api": "UNEXPECTED",
          "new_api": null,
          "old_text": "UNEXPECTED(!from_shared_memory)",
          "new_text": null,
          "old_line_content": "\tif (UNEXPECTED(!from_shared_memory)) {",
          "new_line_content": "",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 16,
      "total_additions": 23,
      "total_deletions": 22,
      "total_api_changes": 61
    },
    "non_api_changes": {
      "has_non_api_changes": false,
      "evidence": {
        "total_diff_lines": 6,
        "api_related_lines": 61,
        "non_api_lines": 0,
        "non_api_line_numbers": []
      }
    },
    "api_calls_before": 291,
    "api_calls_after": 292,
    "diff_info": {
      "added_lines": 5,
      "removed_lines": 4,
      "total_diff_lines": 27
    }
  }
}