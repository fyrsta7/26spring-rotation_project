{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/php-src/modified_file/315ea609da2fd315bb76cb1275d152cfdaff607f",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/php-src/modified_file/315ea609da2fd315bb76cb1275d152cfdaff607f/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/php-src/modified_file/315ea609da2fd315bb76cb1275d152cfdaff607f/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/php-src/modified_file/315ea609da2fd315bb76cb1275d152cfdaff607f/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 136,
          "old_api": "CRT_CONSTANT_EX",
          "new_api": "RETURN_VALUE_USED",
          "old_text": "CRT_CONSTANT_EX(&func->op_array, &func->op_array.opcodes[i], func->op_array.opcodes[i].op2)",
          "new_text": "RETURN_VALUE_USED(opline)",
          "old_line_content": "\t\t\t\t\tif (Z_TYPE_P(CRT_CONSTANT_EX(&func->op_array, &func->op_array.opcodes[i], func->op_array.opcodes[i].op2)) == IS_CONSTANT_AST) {",
          "new_line_content": "\t\t\tif (RETURN_VALUE_USED(opline)) {",
          "content_same": false
        },
        {
          "line": 143,
          "old_api": "RETURN_VALUE_USED",
          "new_api": "SET_UNUSED",
          "old_text": "RETURN_VALUE_USED(opline)",
          "new_text": "SET_UNUSED(opline->op2)",
          "old_line_content": "\t\t\tif (RETURN_VALUE_USED(opline)) {",
          "new_line_content": "\t\t\t\tSET_UNUSED(opline->op2);",
          "content_same": false
        },
        {
          "line": 207,
          "old_api": "zend_vm_calc_used_stack",
          "new_api": "literal_dtor",
          "old_text": "zend_vm_calc_used_stack(fcall->extended_value, call_stack[call].func)",
          "new_text": "literal_dtor(&op_array->literals[fcall->op2.constant])",
          "old_line_content": "\t\t\t\t\t\tfcall->op1.num = zend_vm_calc_used_stack(fcall->extended_value, call_stack[call].func);",
          "new_line_content": "\t\t\t\t\t\tliteral_dtor(&op_array->literals[fcall->op2.constant]);",
          "content_same": false
        },
        {
          "line": 208,
          "old_api": "ZEND_OP2_LITERAL",
          "new_api": "literal_dtor",
          "old_text": "ZEND_OP2_LITERAL(fcall)",
          "new_text": "literal_dtor(&op_array->literals[fcall->op2.constant + 2])",
          "old_line_content": "\t\t\t\t\t\tliteral_dtor(&ZEND_OP2_LITERAL(fcall));",
          "new_line_content": "\t\t\t\t\t\tliteral_dtor(&op_array->literals[fcall->op2.constant + 2]);",
          "content_same": false
        },
        {
          "line": 278,
          "old_api": "MAKE_NOP",
          "new_api": "ARG_SHOULD_BE_SENT_BY_REF",
          "old_text": "MAKE_NOP(opline)",
          "new_text": "ARG_SHOULD_BE_SENT_BY_REF(call_stack[call - 1].func, opline->op2.num)",
          "old_line_content": "\t\t\t\t\tMAKE_NOP(opline);",
          "new_line_content": "\t\t\t\t\tif (ARG_SHOULD_BE_SENT_BY_REF(call_stack[call - 1].func, opline->op2.num)) {",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 129,
          "old_api": null,
          "new_api": "CRT_CONSTANT_EX",
          "old_text": null,
          "new_text": "CRT_CONSTANT_EX(&func->op_array, &func->op_array.opcodes[i], func->op_array.opcodes[i].op2)",
          "old_line_content": "\t\t\t}",
          "new_line_content": "\t\t\t\t\tif (Z_TYPE_P(CRT_CONSTANT_EX(&func->op_array, &func->op_array.opcodes[i], func->op_array.opcodes[i].op2)) == IS_CONSTANT_AST) {",
          "content_same": false
        },
        {
          "line": 260,
          "old_api": null,
          "new_api": "ARG_MUST_BE_SENT_BY_REF",
          "old_text": null,
          "new_text": "ARG_MUST_BE_SENT_BY_REF(call_stack[call - 1].func, opline->op2.num)",
          "old_line_content": "\t\t\t\t\t\t\topline->opcode = ZEND_FETCH_STATIC_PROP_R;",
          "new_line_content": "\t\t\t\t\tif (ARG_MUST_BE_SENT_BY_REF(call_stack[call - 1].func, opline->op2.num)) {",
          "content_same": false
        },
        {
          "line": 139,
          "old_api": null,
          "new_api": "CRT_CONSTANT_EX",
          "old_text": null,
          "new_text": "CRT_CONSTANT_EX(&func->op_array, ret_opline, ret_opline->op1)",
          "old_line_content": "\t\t\t\t\ti++;",
          "new_line_content": "\t\t\t\tZVAL_COPY(&zv, CRT_CONSTANT_EX(&func->op_array, ret_opline, ret_opline->op1));",
          "content_same": false
        },
        {
          "line": 142,
          "old_api": null,
          "new_api": "zend_optimizer_add_literal",
          "old_text": null,
          "new_text": "zend_optimizer_add_literal(op_array, &zv)",
          "old_line_content": "",
          "new_line_content": "\t\t\t\topline->op1.constant = zend_optimizer_add_literal(op_array, &zv);",
          "content_same": false
        },
        {
          "line": 271,
          "old_api": null,
          "new_api": "MAKE_NOP",
          "old_text": null,
          "new_text": "MAKE_NOP(opline)",
          "old_line_content": "\t\t\t\t\t\topline->opcode = ZEND_SEND_VAL;",
          "new_line_content": "\t\t\t\t\tMAKE_NOP(opline);",
          "content_same": false
        },
        {
          "line": 145,
          "old_api": null,
          "new_api": "MAKE_NOP",
          "old_text": null,
          "new_text": "MAKE_NOP(opline)",
          "old_line_content": "",
          "new_line_content": "\t\t\t\tMAKE_NOP(opline);",
          "content_same": false
        },
        {
          "line": 148,
          "old_api": null,
          "new_api": "zend_delete_call_instructions",
          "old_text": null,
          "new_text": "zend_delete_call_instructions(opline-1)",
          "old_line_content": "\t\t\t\topline->op1_type = IS_CONST;",
          "new_line_content": "\t\t\tzend_delete_call_instructions(opline-1);",
          "content_same": false
        },
        {
          "line": 287,
          "old_api": null,
          "new_api": "ARG_MUST_BE_SENT_BY_REF",
          "old_text": null,
          "new_text": "ARG_MUST_BE_SENT_BY_REF(call_stack[call - 1].func, opline->op2.num)",
          "old_line_content": "\t\t\t\t\t} else {",
          "new_line_content": "\t\t\t\t\tif (ARG_MUST_BE_SENT_BY_REF(call_stack[call - 1].func, opline->op2.num)) {",
          "content_same": false
        },
        {
          "line": 289,
          "old_api": null,
          "new_api": "ARG_MAY_BE_SENT_BY_REF",
          "old_text": null,
          "new_text": "ARG_MAY_BE_SENT_BY_REF(call_stack[call - 1].func, opline->op2.num)",
          "old_line_content": "\t\t\t\t\t}",
          "new_line_content": "\t\t\t\t\t} else if (ARG_MAY_BE_SENT_BY_REF(call_stack[call - 1].func, opline->op2.num)) {",
          "content_same": false
        },
        {
          "line": 165,
          "old_api": null,
          "new_api": "zend_arena_checkpoint",
          "old_text": null,
          "new_text": "zend_arena_checkpoint(ctx->arena)",
          "old_line_content": "\tvoid *checkpoint;",
          "new_line_content": "\tcheckpoint = zend_arena_checkpoint(ctx->arena);",
          "content_same": false
        },
        {
          "line": 166,
          "old_api": null,
          "new_api": "zend_arena_calloc",
          "old_text": null,
          "new_text": "zend_arena_calloc(&ctx->arena, op_array->last / 2, sizeof(optimizer_call_info))",
          "old_line_content": "\toptimizer_call_info *call_stack;",
          "new_line_content": "\tcall_stack = zend_arena_calloc(&ctx->arena, op_array->last / 2, sizeof(optimizer_call_info));",
          "content_same": false
        },
        {
          "line": 177,
          "old_api": null,
          "new_api": "zend_optimizer_get_called_func",
          "old_text": null,
          "new_text": "zend_optimizer_get_called_func(\n\t\t\t\t\tctx->script, op_array, opline, &call_stack[call].is_prototype)",
          "old_line_content": "\t\t\tcase ZEND_INIT_NS_FCALL_BY_NAME:",
          "new_line_content": "\t\t\t\tcall_stack[call].func = zend_optimizer_get_called_func(",
          "content_same": false
        },
        {
          "line": 307,
          "old_api": null,
          "new_api": "zend_arena_release",
          "old_text": null,
          "new_text": "zend_arena_release(&ctx->arena, checkpoint)",
          "old_line_content": "\t\t\t\tbreak;",
          "new_line_content": "\tzend_arena_release(&ctx->arena, checkpoint);",
          "content_same": false
        },
        {
          "line": 200,
          "old_api": null,
          "new_api": "zend_vm_calc_used_stack",
          "old_text": null,
          "new_text": "zend_vm_calc_used_stack(fcall->extended_value, call_stack[call].func)",
          "old_line_content": "\t\t\t\tif (call_stack[call].func && call_stack[call].opline) {",
          "new_line_content": "\t\t\t\t\t\tfcall->op1.num = zend_vm_calc_used_stack(fcall->extended_value, call_stack[call].func);",
          "content_same": false
        },
        {
          "line": 201,
          "old_api": null,
          "new_api": "ZEND_OP2_LITERAL",
          "old_text": null,
          "new_text": "ZEND_OP2_LITERAL(fcall)",
          "old_line_content": "\t\t\t\t\tzend_op *fcall = call_stack[call].opline;",
          "new_line_content": "\t\t\t\t\t\tliteral_dtor(&ZEND_OP2_LITERAL(fcall));",
          "content_same": false
        },
        {
          "line": 203,
          "old_api": null,
          "new_api": "zend_get_call_op",
          "old_text": null,
          "new_text": "zend_get_call_op(fcall, call_stack[call].func)",
          "old_line_content": "\t\t\t\t\tif (fcall->opcode == ZEND_INIT_FCALL) {",
          "new_line_content": "\t\t\t\t\t\topline->opcode = zend_get_call_op(fcall, call_stack[call].func);",
          "content_same": false
        },
        {
          "line": 206,
          "old_api": null,
          "new_api": "zend_vm_calc_used_stack",
          "old_text": null,
          "new_text": "zend_vm_calc_used_stack(fcall->extended_value, call_stack[call].func)",
          "old_line_content": "\t\t\t\t\t\tfcall->opcode = ZEND_INIT_FCALL;",
          "new_line_content": "\t\t\t\t\t\tfcall->op1.num = zend_vm_calc_used_stack(fcall->extended_value, call_stack[call].func);",
          "content_same": false
        },
        {
          "line": 216,
          "old_api": null,
          "new_api": "ZEND_UNREACHABLE",
          "old_text": null,
          "new_text": "ZEND_UNREACHABLE()",
          "old_line_content": "\t\t\t\t\t\tfcall->op2.constant = fcall->op2.constant + 1;",
          "new_line_content": "\t\t\t\t\t\tZEND_UNREACHABLE();",
          "content_same": false
        },
        {
          "line": 221,
          "old_api": null,
          "new_api": "zend_try_inline_call",
          "old_text": null,
          "new_text": "zend_try_inline_call(op_array, fcall, opline, call_stack[call].func)",
          "old_line_content": "\t\t\t\t\t\t/* We don't have specialized opcodes for this, do nothing */",
          "new_line_content": "\t\t\t\t\t\tzend_try_inline_call(op_array, fcall, opline, call_stack[call].func);",
          "content_same": false
        },
        {
          "line": 234,
          "old_api": null,
          "new_api": "ZEND_ASSERT",
          "old_text": null,
          "new_text": "ZEND_ASSERT(call_stack[call - 1].func_arg_num != (uint32_t)-1)",
          "old_line_content": "\t\t\t\tcall_stack[call].func_arg_num = (uint32_t)-1;",
          "new_line_content": "\t\t\t\t\tZEND_ASSERT(call_stack[call - 1].func_arg_num != (uint32_t)-1);",
          "content_same": false
        },
        {
          "line": 235,
          "old_api": null,
          "new_api": "ARG_SHOULD_BE_SENT_BY_REF",
          "old_text": null,
          "new_text": "ARG_SHOULD_BE_SENT_BY_REF(call_stack[call - 1].func, call_stack[call - 1].func_arg_num)",
          "old_line_content": "\t\t\t\tbreak;",
          "new_line_content": "\t\t\t\t\tif (ARG_SHOULD_BE_SENT_BY_REF(call_stack[call - 1].func, call_stack[call - 1].func_arg_num)) {",
          "content_same": false
        },
        {
          "line": 119,
          "old_api": null,
          "new_api": "ZEND_ARG_SEND_MODE",
          "old_text": null,
          "new_text": "ZEND_ARG_SEND_MODE(&func->op_array.arg_info[i])",
          "old_line_content": "\t\t\t\t */",
          "new_line_content": "\t\t\t\tif (ZEND_ARG_SEND_MODE(&func->op_array.arg_info[i])) {",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 267,
          "old_api": "ARG_MUST_BE_SENT_BY_REF",
          "new_api": null,
          "old_text": "ARG_MUST_BE_SENT_BY_REF(call_stack[call - 1].func, opline->op2.num)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\tif (ARG_MUST_BE_SENT_BY_REF(call_stack[call - 1].func, opline->op2.num)) {",
          "new_line_content": "\t\t\t\tbreak;",
          "content_same": false
        },
        {
          "line": 146,
          "old_api": "CRT_CONSTANT_EX",
          "new_api": null,
          "old_text": "CRT_CONSTANT_EX(&func->op_array, ret_opline, ret_opline->op1)",
          "new_text": null,
          "old_line_content": "\t\t\t\tZVAL_COPY(&zv, CRT_CONSTANT_EX(&func->op_array, ret_opline, ret_opline->op1));",
          "new_line_content": "\t\t\t}",
          "content_same": false
        },
        {
          "line": 149,
          "old_api": "zend_optimizer_add_literal",
          "new_api": null,
          "old_text": "zend_optimizer_add_literal(op_array, &zv)",
          "new_text": null,
          "old_line_content": "\t\t\t\topline->op1.constant = zend_optimizer_add_literal(op_array, &zv);",
          "new_line_content": "\t\t}",
          "content_same": false
        },
        {
          "line": 150,
          "old_api": "SET_UNUSED",
          "new_api": null,
          "old_text": "SET_UNUSED(opline->op2)",
          "new_text": null,
          "old_line_content": "\t\t\t\tSET_UNUSED(opline->op2);",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 152,
          "old_api": "MAKE_NOP",
          "new_api": null,
          "old_text": "MAKE_NOP(opline)",
          "new_text": null,
          "old_line_content": "\t\t\t\tMAKE_NOP(opline);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 155,
          "old_api": "zend_delete_call_instructions",
          "new_api": null,
          "old_text": "zend_delete_call_instructions(opline-1)",
          "new_text": null,
          "old_line_content": "\t\t\tzend_delete_call_instructions(opline-1);",
          "new_line_content": "\tzend_op *opline = op_array->opcodes;",
          "content_same": false
        },
        {
          "line": 285,
          "old_api": "ARG_SHOULD_BE_SENT_BY_REF",
          "new_api": null,
          "old_text": "ARG_SHOULD_BE_SENT_BY_REF(call_stack[call - 1].func, opline->op2.num)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\tif (ARG_SHOULD_BE_SENT_BY_REF(call_stack[call - 1].func, opline->op2.num)) {",
          "new_line_content": "\t\t\tcase ZEND_SEND_VAR_NO_REF_EX:",
          "content_same": false
        },
        {
          "line": 294,
          "old_api": "ARG_MUST_BE_SENT_BY_REF",
          "new_api": null,
          "old_text": "ARG_MUST_BE_SENT_BY_REF(call_stack[call - 1].func, opline->op2.num)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\tif (ARG_MUST_BE_SENT_BY_REF(call_stack[call - 1].func, opline->op2.num)) {",
          "new_line_content": "\t\t\t\t}",
          "content_same": false
        },
        {
          "line": 296,
          "old_api": "ARG_MAY_BE_SENT_BY_REF",
          "new_api": null,
          "old_text": "ARG_MAY_BE_SENT_BY_REF(call_stack[call - 1].func, opline->op2.num)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\t} else if (ARG_MAY_BE_SENT_BY_REF(call_stack[call - 1].func, opline->op2.num)) {",
          "new_line_content": "\t\t\tcase ZEND_SEND_UNPACK:",
          "content_same": false
        },
        {
          "line": 172,
          "old_api": "zend_arena_checkpoint",
          "new_api": null,
          "old_text": "zend_arena_checkpoint(ctx->arena)",
          "new_text": null,
          "old_line_content": "\tcheckpoint = zend_arena_checkpoint(ctx->arena);",
          "new_line_content": "\t\t\tcase ZEND_INIT_METHOD_CALL:",
          "content_same": false
        },
        {
          "line": 173,
          "old_api": "zend_arena_calloc",
          "new_api": null,
          "old_text": "zend_arena_calloc(&ctx->arena, op_array->last / 2, sizeof(optimizer_call_info))",
          "new_text": null,
          "old_line_content": "\tcall_stack = zend_arena_calloc(&ctx->arena, op_array->last / 2, sizeof(optimizer_call_info));",
          "new_line_content": "\t\t\tcase ZEND_INIT_FCALL:",
          "content_same": false
        },
        {
          "line": 184,
          "old_api": "zend_optimizer_get_called_func",
          "new_api": null,
          "old_text": "zend_optimizer_get_called_func(\n\t\t\t\t\tctx->script, op_array, opline, &call_stack[call].is_prototype)",
          "new_text": null,
          "old_line_content": "\t\t\t\tcall_stack[call].func = zend_optimizer_get_called_func(",
          "new_line_content": "\t\t\t\tcall_stack[call].opline = opline;",
          "content_same": false
        },
        {
          "line": 314,
          "old_api": "zend_arena_release",
          "new_api": null,
          "old_text": "zend_arena_release(&ctx->arena, checkpoint)",
          "new_text": null,
          "old_line_content": "\tzend_arena_release(&ctx->arena, checkpoint);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 213,
          "old_api": "zend_vm_calc_used_stack",
          "new_api": null,
          "old_text": "zend_vm_calc_used_stack(fcall->extended_value, call_stack[call].func)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\t\tfcall->op1.num = zend_vm_calc_used_stack(fcall->extended_value, call_stack[call].func);",
          "new_line_content": "\t\t\t\t\t\t\t|| fcall->opcode == ZEND_NEW) {",
          "content_same": false
        },
        {
          "line": 214,
          "old_api": "literal_dtor",
          "new_api": null,
          "old_text": "literal_dtor(&op_array->literals[fcall->op2.constant])",
          "new_text": null,
          "old_line_content": "\t\t\t\t\t\tliteral_dtor(&op_array->literals[fcall->op2.constant]);",
          "new_line_content": "\t\t\t\t\t\t/* We don't have specialized opcodes for this, do nothing */",
          "content_same": false
        },
        {
          "line": 215,
          "old_api": "literal_dtor",
          "new_api": null,
          "old_text": "literal_dtor(&op_array->literals[fcall->op2.constant + 2])",
          "new_text": null,
          "old_line_content": "\t\t\t\t\t\tliteral_dtor(&op_array->literals[fcall->op2.constant + 2]);",
          "new_line_content": "\t\t\t\t\t} else {",
          "content_same": false
        },
        {
          "line": 217,
          "old_api": "zend_get_call_op",
          "new_api": null,
          "old_text": "zend_get_call_op(fcall, call_stack[call].func)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\t\topline->opcode = zend_get_call_op(fcall, call_stack[call].func);",
          "new_line_content": "\t\t\t\t\t}",
          "content_same": false
        },
        {
          "line": 223,
          "old_api": "ZEND_UNREACHABLE",
          "new_api": null,
          "old_text": "ZEND_UNREACHABLE()",
          "new_text": null,
          "old_line_content": "\t\t\t\t\t\tZEND_UNREACHABLE();",
          "new_line_content": "\t\t\t\t}",
          "content_same": false
        },
        {
          "line": 228,
          "old_api": "zend_try_inline_call",
          "new_api": null,
          "old_text": "zend_try_inline_call(op_array, fcall, opline, call_stack[call].func)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\t\tzend_try_inline_call(op_array, fcall, opline, call_stack[call].func);",
          "new_line_content": "\t\t\t\tbreak;",
          "content_same": false
        },
        {
          "line": 241,
          "old_api": "ZEND_ASSERT",
          "new_api": null,
          "old_text": "ZEND_ASSERT(call_stack[call - 1].func_arg_num != (uint32_t)-1)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\tZEND_ASSERT(call_stack[call - 1].func_arg_num != (uint32_t)-1);",
          "new_line_content": "\t\t\t\t\t} else {",
          "content_same": false
        },
        {
          "line": 242,
          "old_api": "ARG_SHOULD_BE_SENT_BY_REF",
          "new_api": null,
          "old_text": "ARG_SHOULD_BE_SENT_BY_REF(call_stack[call - 1].func, call_stack[call - 1].func_arg_num)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\tif (ARG_SHOULD_BE_SENT_BY_REF(call_stack[call - 1].func, call_stack[call - 1].func_arg_num)) {",
          "new_line_content": "\t\t\t\t\t\tif (opline->opcode == ZEND_FETCH_DIM_FUNC_ARG",
          "content_same": false
        },
        {
          "line": 126,
          "old_api": "ZEND_ARG_SEND_MODE",
          "new_api": null,
          "old_text": "ZEND_ARG_SEND_MODE(&func->op_array.arg_info[i])",
          "new_text": null,
          "old_line_content": "\t\t\t\tif (ZEND_ARG_SEND_MODE(&func->op_array.arg_info[i])) {",
          "new_line_content": "\t\t\t\ti = fcall->extended_value;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 5,
      "total_additions": 22,
      "total_deletions": 22,
      "total_api_changes": 49
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 7,
        "api_related_lines": 49,
        "non_api_lines": 6,
        "non_api_line_numbers": [
          116,
          117,
          118,
          120,
          121,
          122
        ]
      }
    },
    "api_calls_before": 33,
    "api_calls_after": 33,
    "diff_info": {
      "added_lines": 0,
      "removed_lines": 7,
      "total_diff_lines": 19
    }
  }
}