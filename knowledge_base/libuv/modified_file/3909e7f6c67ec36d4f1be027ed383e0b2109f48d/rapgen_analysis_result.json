{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/libuv/modified_file/3909e7f6c67ec36d4f1be027ed383e0b2109f48d",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/libuv/modified_file/3909e7f6c67ec36d4f1be027ed383e0b2109f48d/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/libuv/modified_file/3909e7f6c67ec36d4f1be027ed383e0b2109f48d/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/libuv/modified_file/3909e7f6c67ec36d4f1be027ed383e0b2109f48d/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 317,
          "old_api": "CAST",
          "new_api": "QUEUE_INIT",
          "old_text": "CAST(&handle->loop->inotify_watchers)",
          "new_text": "QUEUE_INIT(&w->watchers)",
          "old_line_content": "  RB_INSERT(watcher_root, CAST(&handle->loop->inotify_watchers), w);",
          "new_line_content": "  QUEUE_INIT(&w->watchers);",
          "content_same": false
        },
        {
          "line": 344,
          "old_api": "maybe_free_watcher_list",
          "new_api": "QUEUE_REMOVE",
          "old_text": "maybe_free_watcher_list(w, handle->loop)",
          "new_text": "QUEUE_REMOVE(&handle->watchers)",
          "old_line_content": "  maybe_free_watcher_list(w, handle->loop);",
          "new_line_content": "  QUEUE_REMOVE(&handle->watchers);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 289,
          "old_api": null,
          "new_api": "init_inotify",
          "old_text": null,
          "new_text": "init_inotify(handle->loop)",
          "old_line_content": "  if (err)",
          "new_line_content": "  err = init_inotify(handle->loop);",
          "content_same": false
        },
        {
          "line": 322,
          "old_api": null,
          "new_api": "uv__handle_start",
          "old_text": null,
          "new_text": "uv__handle_start(handle)",
          "old_line_content": "  handle->path = w->path;",
          "new_line_content": "  uv__handle_start(handle);",
          "content_same": false
        },
        {
          "line": 323,
          "old_api": null,
          "new_api": "QUEUE_INSERT_TAIL",
          "old_text": null,
          "new_text": "QUEUE_INSERT_TAIL(&w->watchers, &handle->watchers)",
          "old_line_content": "  handle->cb = cb;",
          "new_line_content": "  QUEUE_INSERT_TAIL(&w->watchers, &handle->watchers);",
          "content_same": false
        },
        {
          "line": 353,
          "old_api": null,
          "new_api": "uv_fs_event_stop",
          "old_text": null,
          "new_text": "uv_fs_event_stop(handle)",
          "old_line_content": "",
          "new_line_content": "  uv_fs_event_stop(handle);",
          "content_same": false
        },
        {
          "line": 302,
          "old_api": null,
          "new_api": "uv__inotify_add_watch",
          "old_text": null,
          "new_text": "uv__inotify_add_watch(handle->loop->inotify_fd, path, events)",
          "old_line_content": "  if (wd == -1)",
          "new_line_content": "  wd = uv__inotify_add_watch(handle->loop->inotify_fd, path, events);",
          "content_same": false
        },
        {
          "line": 335,
          "old_api": null,
          "new_api": "uv__is_active",
          "old_text": null,
          "new_text": "uv__is_active(handle)",
          "old_line_content": "",
          "new_line_content": "  if (!uv__is_active(handle))",
          "content_same": false
        },
        {
          "line": 304,
          "old_api": null,
          "new_api": "UV__ERR",
          "old_text": null,
          "new_text": "UV__ERR(errno)",
          "old_line_content": "",
          "new_line_content": "    return UV__ERR(errno);",
          "content_same": false
        },
        {
          "line": 306,
          "old_api": null,
          "new_api": "find_watcher",
          "old_text": null,
          "new_text": "find_watcher(handle->loop, wd)",
          "old_line_content": "  if (w)",
          "new_line_content": "  w = find_watcher(handle->loop, wd);",
          "content_same": false
        },
        {
          "line": 338,
          "old_api": null,
          "new_api": "find_watcher",
          "old_text": null,
          "new_text": "find_watcher(handle->loop, handle->wd)",
          "old_line_content": "",
          "new_line_content": "  w = find_watcher(handle->loop, handle->wd);",
          "content_same": false
        },
        {
          "line": 339,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(w != NULL)",
          "old_line_content": "  handle->wd = -1;",
          "new_line_content": "  assert(w != NULL);",
          "content_same": false
        },
        {
          "line": 343,
          "old_api": null,
          "new_api": "uv__handle_stop",
          "old_text": null,
          "new_text": "uv__handle_stop(handle)",
          "old_line_content": "",
          "new_line_content": "  uv__handle_stop(handle);",
          "content_same": false
        },
        {
          "line": 310,
          "old_api": null,
          "new_api": "strlen",
          "old_text": null,
          "new_text": "strlen(path)",
          "old_line_content": "  if (w == NULL)",
          "new_line_content": "  len = strlen(path) + 1;",
          "content_same": false
        },
        {
          "line": 311,
          "old_api": null,
          "new_api": "uv__malloc",
          "old_text": null,
          "new_text": "uv__malloc(sizeof(*w) + len)",
          "old_line_content": "    return UV_ENOMEM;",
          "new_line_content": "  w = uv__malloc(sizeof(*w) + len);",
          "content_same": false
        },
        {
          "line": 346,
          "old_api": null,
          "new_api": "maybe_free_watcher_list",
          "old_text": null,
          "new_text": "maybe_free_watcher_list(w, handle->loop)",
          "old_line_content": "  return 0;",
          "new_line_content": "  maybe_free_watcher_list(w, handle->loop);",
          "content_same": false
        },
        {
          "line": 316,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(w + 1, path, len)",
          "old_line_content": "  w->iterating = 0;",
          "new_line_content": "  w->path = memcpy(w + 1, path, len);",
          "content_same": false
        },
        {
          "line": 286,
          "old_api": null,
          "new_api": "uv__is_active",
          "old_text": null,
          "new_text": "uv__is_active(handle)",
          "old_line_content": "    return UV_EINVAL;",
          "new_line_content": "  if (uv__is_active(handle))",
          "content_same": false
        },
        {
          "line": 319,
          "old_api": null,
          "new_api": "CAST",
          "old_text": null,
          "new_text": "CAST(&handle->loop->inotify_watchers)",
          "old_line_content": "no_insert:",
          "new_line_content": "  RB_INSERT(watcher_root, CAST(&handle->loop->inotify_watchers), w);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 288,
          "old_api": "init_inotify",
          "new_api": null,
          "old_text": "init_inotify(handle->loop)",
          "new_text": null,
          "old_line_content": "  err = init_inotify(handle->loop);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 320,
          "old_api": "uv__handle_start",
          "new_api": null,
          "old_text": "uv__handle_start(handle)",
          "new_text": null,
          "old_line_content": "  uv__handle_start(handle);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 321,
          "old_api": "QUEUE_INSERT_TAIL",
          "new_api": null,
          "old_text": "QUEUE_INSERT_TAIL(&w->watchers, &handle->watchers)",
          "new_text": null,
          "old_line_content": "  QUEUE_INSERT_TAIL(&w->watchers, &handle->watchers);",
          "new_line_content": "no_insert:",
          "content_same": false
        },
        {
          "line": 301,
          "old_api": "uv__inotify_add_watch",
          "new_api": null,
          "old_text": "uv__inotify_add_watch(handle->loop->inotify_fd, path, events)",
          "new_text": null,
          "old_line_content": "  wd = uv__inotify_add_watch(handle->loop->inotify_fd, path, events);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 333,
          "old_api": "uv__is_active",
          "new_api": null,
          "old_text": "uv__is_active(handle)",
          "new_text": null,
          "old_line_content": "  if (!uv__is_active(handle))",
          "new_line_content": "  struct watcher_list* w;",
          "content_same": false
        },
        {
          "line": 303,
          "old_api": "UV__ERR",
          "new_api": null,
          "old_text": "UV__ERR(errno)",
          "new_text": null,
          "old_line_content": "    return UV__ERR(errno);",
          "new_line_content": "  if (wd == -1)",
          "content_same": false
        },
        {
          "line": 336,
          "old_api": "find_watcher",
          "new_api": null,
          "old_text": "find_watcher(handle->loop, handle->wd)",
          "new_text": null,
          "old_line_content": "  w = find_watcher(handle->loop, handle->wd);",
          "new_line_content": "    return 0;",
          "content_same": false
        },
        {
          "line": 305,
          "old_api": "find_watcher",
          "new_api": null,
          "old_text": "find_watcher(handle->loop, wd)",
          "new_text": null,
          "old_line_content": "  w = find_watcher(handle->loop, wd);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 337,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(w != NULL)",
          "new_text": null,
          "old_line_content": "  assert(w != NULL);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 309,
          "old_api": "strlen",
          "new_api": null,
          "old_text": "strlen(path)",
          "new_text": null,
          "old_line_content": "  w = uv__malloc(sizeof(*w) + strlen(path) + 1);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 341,
          "old_api": "uv__handle_stop",
          "new_api": null,
          "old_text": "uv__handle_stop(handle)",
          "new_text": null,
          "old_line_content": "  uv__handle_stop(handle);",
          "new_line_content": "  handle->wd = -1;",
          "content_same": false
        },
        {
          "line": 342,
          "old_api": "QUEUE_REMOVE",
          "new_api": null,
          "old_text": "QUEUE_REMOVE(&handle->watchers)",
          "new_text": null,
          "old_line_content": "  QUEUE_REMOVE(&handle->watchers);",
          "new_line_content": "  handle->path = NULL;",
          "content_same": false
        },
        {
          "line": 314,
          "old_api": "strcpy",
          "new_api": null,
          "old_text": "strcpy((char*)(w + 1), path)",
          "new_text": null,
          "old_line_content": "  w->path = strcpy((char*)(w + 1), path);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 315,
          "old_api": "QUEUE_INIT",
          "new_api": null,
          "old_text": "QUEUE_INIT(&w->watchers)",
          "new_text": null,
          "old_line_content": "  QUEUE_INIT(&w->watchers);",
          "new_line_content": "  w->wd = wd;",
          "content_same": false
        },
        {
          "line": 285,
          "old_api": "uv__is_active",
          "new_api": null,
          "old_text": "uv__is_active(handle)",
          "new_text": null,
          "old_line_content": "  if (uv__is_active(handle))",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 351,
          "old_api": "uv_fs_event_stop",
          "new_api": null,
          "old_text": "uv_fs_event_stop(handle)",
          "new_text": null,
          "old_line_content": "  uv_fs_event_stop(handle);",
          "new_line_content": "",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 2,
      "total_additions": 17,
      "total_deletions": 16,
      "total_api_changes": 35
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 6,
        "api_related_lines": 35,
        "non_api_lines": 1,
        "non_api_line_numbers": [
          281
        ]
      }
    },
    "api_calls_before": 71,
    "api_calls_after": 71,
    "diff_info": {
      "added_lines": 4,
      "removed_lines": 2,
      "total_diff_lines": 29
    }
  }
}