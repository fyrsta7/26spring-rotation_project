{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/libuv/modified_file/f6a02fbe763aec5d290aa9d9509aeec5348c7792",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/libuv/modified_file/f6a02fbe763aec5d290aa9d9509aeec5348c7792/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/libuv/modified_file/f6a02fbe763aec5d290aa9d9509aeec5348c7792/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/libuv/modified_file/f6a02fbe763aec5d290aa9d9509aeec5348c7792/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 478,
          "old_api": "fcntl",
          "new_api": "ioctl",
          "old_text": "fcntl(fd, F_GETFL)",
          "new_text": "ioctl(fd, FIONBIO, &set)",
          "old_line_content": "    r = fcntl(fd, F_GETFL);",
          "new_line_content": "    r = ioctl(fd, FIONBIO, &set);",
          "content_same": false
        },
        {
          "line": 619,
          "old_api": "ev_io_init",
          "new_api": "ev_userdata",
          "old_text": "ev_io_init(&handle->io_watcher, uv__io_rw, fd, events & (EV_READ|EV_WRITE))",
          "new_text": "ev_userdata(ev)",
          "old_line_content": "  ev_io_init(&handle->io_watcher, uv__io_rw, fd, events & (EV_READ|EV_WRITE));",
          "new_line_content": "  uv_loop_t* loop = ev_userdata(ev);",
          "content_same": false
        },
        {
          "line": 620,
          "old_api": "uv__io_set_cb",
          "new_api": "container_of",
          "old_text": "uv__io_set_cb(handle, cb)",
          "new_text": "container_of(w, uv__io_t, io_watcher)",
          "old_line_content": "  uv__io_set_cb(handle, cb);",
          "new_line_content": "  uv__io_t* handle = container_of(w, uv__io_t, io_watcher);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 644,
          "old_api": null,
          "new_api": "ev_io_stop",
          "old_text": null,
          "new_text": "ev_io_stop(loop->ev, &handle->io_watcher)",
          "old_line_content": "",
          "new_line_content": "  ev_io_stop(loop->ev, &handle->io_watcher);",
          "content_same": false
        },
        {
          "line": 520,
          "old_api": null,
          "new_api": "fcntl",
          "old_text": null,
          "new_text": "fcntl(fd, F_GETFD)",
          "old_line_content": "  else",
          "new_line_content": "    r = fcntl(fd, F_GETFD);",
          "content_same": false
        },
        {
          "line": 649,
          "old_api": null,
          "new_api": "ev_feed_event",
          "old_text": null,
          "new_text": "ev_feed_event(loop->ev, &handle->io_watcher, event)",
          "old_line_content": "",
          "new_line_content": "  ev_feed_event(loop->ev, &handle->io_watcher, event);",
          "content_same": false
        },
        {
          "line": 654,
          "old_api": null,
          "new_api": "ev_is_active",
          "old_text": null,
          "new_text": "ev_is_active(&handle->io_watcher)",
          "old_line_content": "",
          "new_line_content": "  return ev_is_active(&handle->io_watcher);",
          "content_same": false
        },
        {
          "line": 533,
          "old_api": null,
          "new_api": "fcntl",
          "old_text": null,
          "new_text": "fcntl(fd, F_SETFD, flags)",
          "old_line_content": " * between the call to dup() and fcntl(FD_CLOEXEC).",
          "new_line_content": "    r = fcntl(fd, F_SETFD, flags);",
          "content_same": false
        },
        {
          "line": 544,
          "old_api": null,
          "new_api": "dup",
          "old_text": null,
          "new_text": "dup(fd)",
          "old_line_content": "  }",
          "new_line_content": "  fd = dup(fd);",
          "content_same": false
        },
        {
          "line": 549,
          "old_api": null,
          "new_api": "uv__cloexec",
          "old_text": null,
          "new_text": "uv__cloexec(fd, 1)",
          "old_line_content": "",
          "new_line_content": "  if (uv__cloexec(fd, 1)) {",
          "content_same": false
        },
        {
          "line": 550,
          "old_api": null,
          "new_api": "close",
          "old_text": null,
          "new_text": "close(fd)",
          "old_line_content": "/* TODO move to uv-common.c? */",
          "new_line_content": "    SAVE_ERRNO(close(fd));",
          "content_same": false
        },
        {
          "line": 434,
          "old_api": null,
          "new_api": "uv__accept4",
          "old_text": null,
          "new_text": "uv__accept4(sockfd,\n                         NULL,\n                         NULL,\n                         UV__SOCK_NONBLOCK|UV__SOCK_CLOEXEC)",
          "old_line_content": "    if (peerfd != -1)",
          "new_line_content": "    peerfd = uv__accept4(sockfd,",
          "content_same": false
        },
        {
          "line": 578,
          "old_api": null,
          "new_api": "uv__new_artificial_error",
          "old_text": null,
          "new_text": "uv__new_artificial_error(UV_EINVAL)",
          "old_line_content": "}",
          "new_line_content": "    return uv__new_artificial_error(UV_EINVAL);",
          "content_same": false
        },
        {
          "line": 452,
          "old_api": null,
          "new_api": "accept",
          "old_text": null,
          "new_text": "accept(sockfd, NULL, NULL)",
          "old_line_content": "",
          "new_line_content": "    peerfd = accept(sockfd, NULL, NULL);",
          "content_same": false
        },
        {
          "line": 581,
          "old_api": null,
          "new_api": "getcwd",
          "old_text": null,
          "new_text": "getcwd(buffer, size)",
          "old_line_content": "uv_err_t uv_chdir(const char* dir) {",
          "new_line_content": "  if (getcwd(buffer, size)) {",
          "content_same": false
        },
        {
          "line": 584,
          "old_api": null,
          "new_api": "uv__new_sys_error",
          "old_text": null,
          "new_text": "uv__new_sys_error(errno)",
          "old_line_content": "  } else {",
          "new_line_content": "    return uv__new_sys_error(errno);",
          "content_same": false
        },
        {
          "line": 461,
          "old_api": null,
          "new_api": "uv__nonblock",
          "old_text": null,
          "new_text": "uv__nonblock(peerfd, 1)",
          "old_line_content": "  return peerfd;",
          "new_line_content": "    if (uv__cloexec(peerfd, 1) || uv__nonblock(peerfd, 1)) {",
          "content_same": false
        },
        {
          "line": 590,
          "old_api": null,
          "new_api": "chdir",
          "old_text": null,
          "new_text": "chdir(dir)",
          "old_line_content": "void uv_disable_stdio_inheritance(void) {",
          "new_line_content": "  if (chdir(dir) == 0) {",
          "content_same": false
        },
        {
          "line": 462,
          "old_api": null,
          "new_api": "close",
          "old_text": null,
          "new_text": "close(peerfd)",
          "old_line_content": "}",
          "new_line_content": "      close(peerfd);",
          "content_same": false
        },
        {
          "line": 593,
          "old_api": null,
          "new_api": "uv__new_sys_error",
          "old_text": null,
          "new_text": "uv__new_sys_error(errno)",
          "old_line_content": "  /* Set the CLOEXEC flag on all open descriptors. Unconditionally try the",
          "new_line_content": "    return uv__new_sys_error(errno);",
          "content_same": false
        },
        {
          "line": 605,
          "old_api": null,
          "new_api": "uv__cloexec",
          "old_text": null,
          "new_text": "uv__cloexec(fd, 1)",
          "old_line_content": "  handle->io_watcher.data = u.data;",
          "new_line_content": "    if (uv__cloexec(fd, 1) && fd > 15)",
          "content_same": false
        },
        {
          "line": 486,
          "old_api": null,
          "new_api": "fcntl",
          "old_text": null,
          "new_text": "fcntl(fd, F_GETFL)",
          "old_line_content": "  else",
          "new_line_content": "    r = fcntl(fd, F_GETFL);",
          "content_same": false
        },
        {
          "line": 622,
          "old_api": null,
          "new_api": "cb",
          "old_text": null,
          "new_text": "u.cb(loop, handle, events & (EV_READ|EV_WRITE|EV_ERROR))",
          "old_line_content": "",
          "new_line_content": "  u.cb(loop, handle, events & (EV_READ|EV_WRITE|EV_ERROR));",
          "content_same": false
        },
        {
          "line": 498,
          "old_api": null,
          "new_api": "fcntl",
          "old_text": null,
          "new_text": "fcntl(fd, F_SETFL, flags)",
          "old_line_content": "int uv__cloexec(int fd, int set) {",
          "new_line_content": "    r = fcntl(fd, F_SETFL, flags);",
          "content_same": false
        },
        {
          "line": 627,
          "old_api": null,
          "new_api": "ev_io_init",
          "old_text": null,
          "new_text": "ev_io_init(&handle->io_watcher, uv__io_rw, fd, events & (EV_READ|EV_WRITE))",
          "old_line_content": "}",
          "new_line_content": "  ev_io_init(&handle->io_watcher, uv__io_rw, fd, events & (EV_READ|EV_WRITE));",
          "content_same": false
        },
        {
          "line": 628,
          "old_api": null,
          "new_api": "uv__io_set_cb",
          "old_text": null,
          "new_text": "uv__io_set_cb(handle, cb)",
          "old_line_content": "",
          "new_line_content": "  uv__io_set_cb(handle, cb);",
          "content_same": false
        },
        {
          "line": 633,
          "old_api": null,
          "new_api": "ev_io_set",
          "old_text": null,
          "new_text": "ev_io_set(&handle->io_watcher, fd, events)",
          "old_line_content": "",
          "new_line_content": "  ev_io_set(&handle->io_watcher, fd, events);",
          "content_same": false
        },
        {
          "line": 634,
          "old_api": null,
          "new_api": "uv__io_set_cb",
          "old_text": null,
          "new_text": "uv__io_set_cb(handle, cb)",
          "old_line_content": "",
          "new_line_content": "  uv__io_set_cb(handle, cb);",
          "content_same": false
        },
        {
          "line": 639,
          "old_api": null,
          "new_api": "ev_io_start",
          "old_text": null,
          "new_text": "ev_io_start(loop->ev, &handle->io_watcher)",
          "old_line_content": "",
          "new_line_content": "  ev_io_start(loop->ev, &handle->io_watcher);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 512,
          "old_api": "fcntl",
          "new_api": null,
          "old_text": "fcntl(fd, F_GETFD)",
          "new_text": null,
          "old_line_content": "    r = fcntl(fd, F_GETFD);",
          "new_line_content": "   * syscall. CHECKME: That's probably true for other Unices as well.",
          "content_same": false
        },
        {
          "line": 641,
          "old_api": "ev_feed_event",
          "new_api": null,
          "old_text": "ev_feed_event(loop->ev, &handle->io_watcher, event)",
          "new_text": null,
          "old_line_content": "  ev_feed_event(loop->ev, &handle->io_watcher, event);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 646,
          "old_api": "ev_is_active",
          "new_api": null,
          "old_text": "ev_is_active(&handle->io_watcher)",
          "new_text": null,
          "old_line_content": "  return ev_is_active(&handle->io_watcher);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 525,
          "old_api": "fcntl",
          "new_api": null,
          "old_text": "fcntl(fd, F_SETFD, flags)",
          "new_text": null,
          "old_line_content": "    r = fcntl(fd, F_SETFD, flags);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 536,
          "old_api": "dup",
          "new_api": null,
          "old_text": "dup(fd)",
          "new_text": null,
          "old_line_content": "  fd = dup(fd);",
          "new_line_content": "  return r;",
          "content_same": false
        },
        {
          "line": 541,
          "old_api": "uv__cloexec",
          "new_api": null,
          "old_text": "uv__cloexec(fd, 1)",
          "new_text": null,
          "old_line_content": "  if (uv__cloexec(fd, 1)) {",
          "new_line_content": " * between the call to dup() and fcntl(FD_CLOEXEC).",
          "content_same": false
        },
        {
          "line": 542,
          "old_api": "close",
          "new_api": null,
          "old_text": "close(fd)",
          "new_text": null,
          "old_line_content": "    SAVE_ERRNO(close(fd));",
          "new_line_content": " */",
          "content_same": false
        },
        {
          "line": 429,
          "old_api": "uv__accept4",
          "new_api": null,
          "old_text": "uv__accept4(sockfd,\n                         NULL,\n                         NULL,\n                         UV__SOCK_NONBLOCK|UV__SOCK_CLOEXEC)",
          "new_text": null,
          "old_line_content": "    peerfd = uv__accept4(sockfd,",
          "new_line_content": "    static int no_accept4;",
          "content_same": false
        },
        {
          "line": 570,
          "old_api": "uv__new_artificial_error",
          "new_api": null,
          "old_text": "uv__new_artificial_error(UV_EINVAL)",
          "new_text": null,
          "old_line_content": "    return uv__new_artificial_error(UV_EINVAL);",
          "new_line_content": "  *dst = '\\0';",
          "content_same": false
        },
        {
          "line": 444,
          "old_api": "accept",
          "new_api": null,
          "old_text": "accept(sockfd, NULL, NULL)",
          "new_text": null,
          "old_line_content": "    peerfd = accept(sockfd, NULL, NULL);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 573,
          "old_api": "getcwd",
          "new_api": null,
          "old_text": "getcwd(buffer, size)",
          "new_text": null,
          "old_line_content": "  if (getcwd(buffer, size)) {",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 576,
          "old_api": "uv__new_sys_error",
          "new_api": null,
          "old_text": "uv__new_sys_error(errno)",
          "new_text": null,
          "old_line_content": "    return uv__new_sys_error(errno);",
          "new_line_content": "uv_err_t uv_cwd(char* buffer, size_t size) {",
          "content_same": false
        },
        {
          "line": 453,
          "old_api": "uv__nonblock",
          "new_api": null,
          "old_text": "uv__nonblock(peerfd, 1)",
          "new_text": null,
          "old_line_content": "    if (uv__cloexec(peerfd, 1) || uv__nonblock(peerfd, 1)) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 582,
          "old_api": "chdir",
          "new_api": null,
          "old_text": "chdir(dir)",
          "new_text": null,
          "old_line_content": "  if (chdir(dir) == 0) {",
          "new_line_content": "    return uv_ok_;",
          "content_same": false
        },
        {
          "line": 454,
          "old_api": "close",
          "new_api": null,
          "old_text": "close(peerfd)",
          "new_text": null,
          "old_line_content": "      close(peerfd);",
          "new_line_content": "    if (peerfd == -1) {",
          "content_same": false
        },
        {
          "line": 585,
          "old_api": "uv__new_sys_error",
          "new_api": null,
          "old_text": "uv__new_sys_error(errno)",
          "new_text": null,
          "old_line_content": "    return uv__new_sys_error(errno);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 597,
          "old_api": "uv__cloexec",
          "new_api": null,
          "old_text": "uv__cloexec(fd, 1)",
          "new_text": null,
          "old_line_content": "    if (uv__cloexec(fd, 1) && fd > 15)",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 470,
          "old_api": "ioctl",
          "new_api": null,
          "old_text": "ioctl(fd, FIONBIO, &set)",
          "new_text": null,
          "old_line_content": "    r = ioctl(fd, FIONBIO, &set);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 611,
          "old_api": "ev_userdata",
          "new_api": null,
          "old_text": "ev_userdata(ev)",
          "new_text": null,
          "old_line_content": "  uv_loop_t* loop = ev_userdata(ev);",
          "new_line_content": "  union { void* data; uv__io_cb cb; } u;",
          "content_same": false
        },
        {
          "line": 612,
          "old_api": "container_of",
          "new_api": null,
          "old_text": "container_of(w, uv__io_t, io_watcher)",
          "new_text": null,
          "old_line_content": "  uv__io_t* handle = container_of(w, uv__io_t, io_watcher);",
          "new_line_content": "  u.cb = cb;",
          "content_same": false
        },
        {
          "line": 614,
          "old_api": "cb",
          "new_api": null,
          "old_text": "u.cb(loop, handle, events & (EV_READ|EV_WRITE|EV_ERROR))",
          "new_text": null,
          "old_line_content": "  u.cb(loop, handle, events & (EV_READ|EV_WRITE|EV_ERROR));",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 490,
          "old_api": "fcntl",
          "new_api": null,
          "old_text": "fcntl(fd, F_SETFL, flags)",
          "new_text": null,
          "old_line_content": "    r = fcntl(fd, F_SETFL, flags);",
          "new_line_content": "    return -1;",
          "content_same": false
        },
        {
          "line": 625,
          "old_api": "ev_io_set",
          "new_api": null,
          "old_text": "ev_io_set(&handle->io_watcher, fd, events)",
          "new_text": null,
          "old_line_content": "  ev_io_set(&handle->io_watcher, fd, events);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 626,
          "old_api": "uv__io_set_cb",
          "new_api": null,
          "old_text": "uv__io_set_cb(handle, cb)",
          "new_text": null,
          "old_line_content": "  uv__io_set_cb(handle, cb);",
          "new_line_content": "void uv__io_init(uv__io_t* handle, uv__io_cb cb, int fd, int events) {",
          "content_same": false
        },
        {
          "line": 631,
          "old_api": "ev_io_start",
          "new_api": null,
          "old_text": "ev_io_start(loop->ev, &handle->io_watcher)",
          "new_text": null,
          "old_line_content": "  ev_io_start(loop->ev, &handle->io_watcher);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 636,
          "old_api": "ev_io_stop",
          "new_api": null,
          "old_text": "ev_io_stop(loop->ev, &handle->io_watcher)",
          "new_text": null,
          "old_line_content": "  ev_io_stop(loop->ev, &handle->io_watcher);",
          "new_line_content": "",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 3,
      "total_additions": 26,
      "total_deletions": 26,
      "total_api_changes": 55
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 8,
        "api_related_lines": 55,
        "non_api_lines": 7,
        "non_api_line_numbers": [
          448,
          449,
          430,
          431,
          432,
          433,
          447
        ]
      }
    },
    "api_calls_before": 113,
    "api_calls_after": 113,
    "diff_info": {
      "added_lines": 8,
      "removed_lines": 0,
      "total_diff_lines": 27
    }
  }
}