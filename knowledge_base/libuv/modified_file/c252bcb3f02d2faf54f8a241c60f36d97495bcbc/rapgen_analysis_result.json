{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/libuv/modified_file/c252bcb3f02d2faf54f8a241c60f36d97495bcbc",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/libuv/modified_file/c252bcb3f02d2faf54f8a241c60f36d97495bcbc/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/libuv/modified_file/c252bcb3f02d2faf54f8a241c60f36d97495bcbc/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/libuv/modified_file/c252bcb3f02d2faf54f8a241c60f36d97495bcbc/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 207,
          "old_api": "req_alloc",
          "new_api": "uv_write",
          "old_text": "req_alloc()",
          "new_text": "uv_write(req, stream, &buf, 1, write_cb)",
          "old_line_content": "    req = (uv_write_t*) req_alloc();",
          "new_line_content": "  r = uv_write(req, stream, &buf, 1, write_cb);",
          "content_same": false
        },
        {
          "line": 208,
          "old_api": "uv_write",
          "new_api": "ASSERT",
          "old_text": "uv_write(req, stream, &buf, 1, write_cb)",
          "new_text": "ASSERT(r == 0)",
          "old_line_content": "    r = uv_write(req, stream, &buf, 1, write_cb);",
          "new_line_content": "  ASSERT(r == 0);",
          "content_same": false
        },
        {
          "line": 221,
          "old_api": "req_free",
          "new_api": "maybe_connect_some",
          "old_text": "req_free((uv_req_t*) req)",
          "new_text": "maybe_connect_some()",
          "old_line_content": "  req_free((uv_req_t*) req);",
          "new_line_content": "  maybe_connect_some();",
          "content_same": false
        },
        {
          "line": 248,
          "old_api": "ASSERT",
          "new_api": "req_alloc",
          "old_text": "ASSERT(r == 0)",
          "new_text": "req_alloc()",
          "old_line_content": "      ASSERT(r == 0);",
          "new_line_content": "      req = (uv_connect_t*) req_alloc();",
          "content_same": false
        },
        {
          "line": 250,
          "old_api": "req_alloc",
          "new_api": "ASSERT",
          "old_text": "req_alloc()",
          "new_text": "ASSERT(r == 0)",
          "old_line_content": "      req = (uv_connect_t*) req_alloc();",
          "new_line_content": "      ASSERT(r == 0);",
          "content_same": false
        },
        {
          "line": 257,
          "old_api": "ASSERT",
          "new_api": "req_alloc",
          "old_text": "ASSERT(r == 0)",
          "new_text": "req_alloc()",
          "old_line_content": "      ASSERT(r == 0);",
          "new_line_content": "      req = (uv_connect_t*) req_alloc();",
          "content_same": false
        },
        {
          "line": 274,
          "old_api": "malloc",
          "new_api": "ASSERT",
          "old_text": "malloc(sizeof(uv_tcp_t))",
          "new_text": "ASSERT(r == 0)",
          "old_line_content": "    stream = (uv_stream_t*)malloc(sizeof(uv_tcp_t));",
          "new_line_content": "    ASSERT(r == 0);",
          "content_same": false
        },
        {
          "line": 276,
          "old_api": "ASSERT",
          "new_api": "malloc",
          "old_text": "ASSERT(r == 0)",
          "new_text": "malloc(sizeof(uv_pipe_t))",
          "old_line_content": "    ASSERT(r == 0);",
          "new_line_content": "    stream = (uv_stream_t*)malloc(sizeof(uv_pipe_t));",
          "content_same": false
        },
        {
          "line": 278,
          "old_api": "malloc",
          "new_api": "ASSERT",
          "old_text": "malloc(sizeof(uv_pipe_t))",
          "new_text": "ASSERT(r == 0)",
          "old_line_content": "    stream = (uv_stream_t*)malloc(sizeof(uv_pipe_t));",
          "new_line_content": "    ASSERT(r == 0);",
          "content_same": false
        },
        {
          "line": 284,
          "old_api": "ASSERT",
          "new_api": "uv_read_start",
          "old_text": "ASSERT(r == 0)",
          "new_text": "uv_read_start(stream, buf_alloc, read_cb)",
          "old_line_content": "  ASSERT(r == 0);",
          "new_line_content": "  r = uv_read_start(stream, buf_alloc, read_cb);",
          "content_same": false
        },
        {
          "line": 371,
          "old_api": "uv_default_loop",
          "new_api": "uv_ip4_addr",
          "old_text": "uv_default_loop()",
          "new_text": "uv_ip4_addr(\"0.0.0.0\", TEST_PORT)",
          "old_line_content": "  loop = uv_default_loop();",
          "new_line_content": "  listen_addr = uv_ip4_addr(\"0.0.0.0\", TEST_PORT);",
          "content_same": false
        },
        {
          "line": 377,
          "old_api": "uv_tcp_init",
          "new_api": "uv_tcp_bind",
          "old_text": "uv_tcp_init(loop, &tcpServer)",
          "new_text": "uv_tcp_bind(&tcpServer, listen_addr)",
          "old_line_content": "  r = uv_tcp_init(loop, &tcpServer);",
          "new_line_content": "  r = uv_tcp_bind(&tcpServer, listen_addr);",
          "content_same": false
        },
        {
          "line": 379,
          "old_api": "uv_tcp_bind",
          "new_api": "uv_listen",
          "old_text": "uv_tcp_bind(&tcpServer, listen_addr)",
          "new_text": "uv_listen((uv_stream_t*)&tcpServer, MAX_WRITE_HANDLES, connection_cb)",
          "old_line_content": "  r = uv_tcp_bind(&tcpServer, listen_addr);",
          "new_line_content": "  r = uv_listen((uv_stream_t*)&tcpServer, MAX_WRITE_HANDLES, connection_cb);",
          "content_same": false
        },
        {
          "line": 382,
          "old_api": "ASSERT",
          "new_api": "uv_run",
          "old_text": "ASSERT(r == 0)",
          "new_text": "uv_run(loop)",
          "old_line_content": "  ASSERT(r == 0);",
          "new_line_content": "  uv_run(loop);",
          "content_same": false
        },
        {
          "line": 398,
          "old_api": "uv_pipe_init",
          "new_api": "uv_pipe_bind",
          "old_text": "uv_pipe_init(loop, &pipeServer, 0)",
          "new_text": "uv_pipe_bind(&pipeServer, TEST_PIPENAME)",
          "old_line_content": "  r = uv_pipe_init(loop, &pipeServer, 0);",
          "new_line_content": "  r = uv_pipe_bind(&pipeServer, TEST_PIPENAME);",
          "content_same": false
        },
        {
          "line": 400,
          "old_api": "uv_pipe_bind",
          "new_api": "uv_listen",
          "old_text": "uv_pipe_bind(&pipeServer, TEST_PIPENAME)",
          "new_text": "uv_listen((uv_stream_t*)&pipeServer, MAX_WRITE_HANDLES, connection_cb)",
          "old_line_content": "  r = uv_pipe_bind(&pipeServer, TEST_PIPENAME);",
          "new_line_content": "  r = uv_listen((uv_stream_t*)&pipeServer, MAX_WRITE_HANDLES, connection_cb);",
          "content_same": false
        },
        {
          "line": 403,
          "old_api": "ASSERT",
          "new_api": "uv_run",
          "old_text": "ASSERT(r == 0)",
          "new_text": "uv_run(loop)",
          "old_line_content": "  ASSERT(r == 0);",
          "new_line_content": "  uv_run(loop);",
          "content_same": false
        },
        {
          "line": 405,
          "old_api": "uv_run",
          "new_api": "MAKE_VALGRIND_HAPPY",
          "old_text": "uv_run(loop)",
          "new_text": "MAKE_VALGRIND_HAPPY()",
          "old_line_content": "  uv_run(loop);",
          "new_line_content": "  MAKE_VALGRIND_HAPPY();",
          "content_same": false
        },
        {
          "line": 417,
          "old_api": "uv_default_loop",
          "new_api": "uv_ip4_addr",
          "old_text": "uv_default_loop()",
          "new_text": "uv_ip4_addr(\"127.0.0.1\", TEST_PORT)",
          "old_line_content": "  loop = uv_default_loop();",
          "new_line_content": "  connect_addr = uv_ip4_addr(\"127.0.0.1\", TEST_PORT);",
          "content_same": false
        },
        {
          "line": 422,
          "old_api": "maybe_connect_some",
          "new_api": "uv_run",
          "old_text": "maybe_connect_some()",
          "new_text": "uv_run(loop)",
          "old_line_content": "  maybe_connect_some();",
          "new_line_content": "  uv_run(loop);",
          "content_same": false
        },
        {
          "line": 424,
          "old_api": "uv_run",
          "new_api": "MAKE_VALGRIND_HAPPY",
          "old_text": "uv_run(loop)",
          "new_text": "MAKE_VALGRIND_HAPPY()",
          "old_line_content": "  uv_run(loop);",
          "new_line_content": "  MAKE_VALGRIND_HAPPY();",
          "content_same": false
        },
        {
          "line": 438,
          "old_api": "maybe_connect_some",
          "new_api": "uv_run",
          "old_text": "maybe_connect_some()",
          "new_text": "uv_run(loop)",
          "old_line_content": "  maybe_connect_some();",
          "new_line_content": "  uv_run(loop);",
          "content_same": false
        },
        {
          "line": 440,
          "old_api": "uv_run",
          "new_api": "MAKE_VALGRIND_HAPPY",
          "old_text": "uv_run(loop)",
          "new_text": "MAKE_VALGRIND_HAPPY()",
          "old_line_content": "  uv_run(loop);",
          "new_line_content": "  MAKE_VALGRIND_HAPPY();",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 258,
          "old_api": null,
          "new_api": "uv_pipe_connect",
          "old_text": null,
          "new_text": "uv_pipe_connect(req, pipe, TEST_PIPENAME, connect_cb)",
          "old_line_content": "",
          "new_line_content": "      uv_pipe_connect(req, pipe, TEST_PIPENAME, connect_cb);",
          "content_same": false
        },
        {
          "line": 392,
          "old_api": null,
          "new_api": "uv_default_loop",
          "old_text": null,
          "new_text": "uv_default_loop()",
          "old_line_content": "  type = PIPE;",
          "new_line_content": "  loop = uv_default_loop();",
          "content_same": false
        },
        {
          "line": 268,
          "old_api": null,
          "new_api": "ASSERT",
          "old_text": null,
          "new_text": "ASSERT(server == s)",
          "old_line_content": "  int r;",
          "new_line_content": "  ASSERT(server == s);",
          "content_same": false
        },
        {
          "line": 269,
          "old_api": null,
          "new_api": "ASSERT",
          "old_text": null,
          "new_text": "ASSERT(status == 0)",
          "old_line_content": "",
          "new_line_content": "  ASSERT(status == 0);",
          "content_same": false
        },
        {
          "line": 396,
          "old_api": null,
          "new_api": "uv_pipe_init",
          "old_text": null,
          "new_text": "uv_pipe_init(loop, &pipeServer, 0)",
          "old_line_content": "  /* Server */",
          "new_line_content": "  r = uv_pipe_init(loop, &pipeServer, 0);",
          "content_same": false
        },
        {
          "line": 397,
          "old_api": null,
          "new_api": "ASSERT",
          "old_text": null,
          "new_text": "ASSERT(r == 0)",
          "old_line_content": "  server = (uv_stream_t*)&pipeServer;",
          "new_line_content": "  ASSERT(r == 0);",
          "content_same": false
        },
        {
          "line": 272,
          "old_api": null,
          "new_api": "malloc",
          "old_text": null,
          "new_text": "malloc(sizeof(uv_tcp_t))",
          "old_line_content": "",
          "new_line_content": "    stream = (uv_stream_t*)malloc(sizeof(uv_tcp_t));",
          "content_same": false
        },
        {
          "line": 273,
          "old_api": null,
          "new_api": "uv_tcp_init",
          "old_text": null,
          "new_text": "uv_tcp_init(loop, (uv_tcp_t*)stream)",
          "old_line_content": "  if (type == TCP) {",
          "new_line_content": "    r = uv_tcp_init(loop, (uv_tcp_t*)stream);",
          "content_same": false
        },
        {
          "line": 277,
          "old_api": null,
          "new_api": "uv_pipe_init",
          "old_text": null,
          "new_text": "uv_pipe_init(loop, (uv_pipe_t*)stream, 0)",
          "old_line_content": "  } else {",
          "new_line_content": "    r = uv_pipe_init(loop, (uv_pipe_t*)stream, 0);",
          "content_same": false
        },
        {
          "line": 281,
          "old_api": null,
          "new_api": "uv_accept",
          "old_text": null,
          "new_text": "uv_accept(s, stream)",
          "old_line_content": "  }",
          "new_line_content": "  r = uv_accept(s, stream);",
          "content_same": false
        },
        {
          "line": 282,
          "old_api": null,
          "new_api": "ASSERT",
          "old_text": null,
          "new_text": "ASSERT(r == 0)",
          "old_line_content": "",
          "new_line_content": "  ASSERT(r == 0);",
          "content_same": false
        },
        {
          "line": 411,
          "old_api": null,
          "new_api": "ASSERT",
          "old_text": null,
          "new_text": "ASSERT(n <= MAX_WRITE_HANDLES)",
          "old_line_content": "",
          "new_line_content": "  ASSERT(n <= MAX_WRITE_HANDLES);",
          "content_same": false
        },
        {
          "line": 285,
          "old_api": null,
          "new_api": "ASSERT",
          "old_text": null,
          "new_text": "ASSERT(r == 0)",
          "old_line_content": "",
          "new_line_content": "  ASSERT(r == 0);",
          "content_same": false
        },
        {
          "line": 415,
          "old_api": null,
          "new_api": "uv_default_loop",
          "old_text": null,
          "new_text": "uv_default_loop()",
          "old_line_content": "  type = TCP;",
          "new_line_content": "  loop = uv_default_loop();",
          "content_same": false
        },
        {
          "line": 420,
          "old_api": null,
          "new_api": "maybe_connect_some",
          "old_text": null,
          "new_text": "maybe_connect_some()",
          "old_line_content": "",
          "new_line_content": "  maybe_connect_some();",
          "content_same": false
        },
        {
          "line": 429,
          "old_api": null,
          "new_api": "ASSERT",
          "old_text": null,
          "new_text": "ASSERT(n <= MAX_WRITE_HANDLES)",
          "old_line_content": "",
          "new_line_content": "  ASSERT(n <= MAX_WRITE_HANDLES);",
          "content_same": false
        },
        {
          "line": 433,
          "old_api": null,
          "new_api": "uv_default_loop",
          "old_text": null,
          "new_text": "uv_default_loop()",
          "old_line_content": "  type = PIPE;",
          "new_line_content": "  loop = uv_default_loop();",
          "content_same": false
        },
        {
          "line": 436,
          "old_api": null,
          "new_api": "maybe_connect_some",
          "old_text": null,
          "new_text": "maybe_connect_some()",
          "old_line_content": "",
          "new_line_content": "  maybe_connect_some();",
          "content_same": false
        },
        {
          "line": 314,
          "old_api": null,
          "new_api": "malloc",
          "old_text": null,
          "new_text": "malloc(sizeof *req)",
          "old_line_content": "  }",
          "new_line_content": "  req = (req_list_t*) malloc(sizeof *req);",
          "content_same": false
        },
        {
          "line": 445,
          "old_api": null,
          "new_api": "tcp_pump",
          "old_text": null,
          "new_text": "tcp_pump(100)",
          "old_line_content": "",
          "new_line_content": "  tcp_pump(100);",
          "content_same": false
        },
        {
          "line": 451,
          "old_api": null,
          "new_api": "tcp_pump",
          "old_text": null,
          "new_text": "tcp_pump(1)",
          "old_line_content": "",
          "new_line_content": "  tcp_pump(1);",
          "content_same": false
        },
        {
          "line": 457,
          "old_api": null,
          "new_api": "pipe_pump",
          "old_text": null,
          "new_text": "pipe_pump(100)",
          "old_line_content": "",
          "new_line_content": "  pipe_pump(100);",
          "content_same": false
        },
        {
          "line": 206,
          "old_api": null,
          "new_api": "req_alloc",
          "old_text": null,
          "new_text": "req_alloc()",
          "old_line_content": "  while (stream->write_queue_size == 0) {",
          "new_line_content": "  req = (uv_write_t*) req_alloc();",
          "content_same": false
        },
        {
          "line": 463,
          "old_api": null,
          "new_api": "pipe_pump",
          "old_text": null,
          "new_text": "pipe_pump(1)",
          "old_line_content": "",
          "new_line_content": "  pipe_pump(1);",
          "content_same": false
        },
        {
          "line": 215,
          "old_api": null,
          "new_api": "uv_last_error",
          "old_text": null,
          "new_text": "uv_last_error(loop)",
          "old_line_content": "  int i;",
          "new_line_content": "  if (status) LOG(uv_strerror(uv_last_error(loop)));",
          "content_same": false
        },
        {
          "line": 216,
          "old_api": null,
          "new_api": "ASSERT",
          "old_text": null,
          "new_text": "ASSERT(status == 0)",
          "old_line_content": "",
          "new_line_content": "  ASSERT(status == 0);",
          "content_same": false
        },
        {
          "line": 219,
          "old_api": null,
          "new_api": "req_free",
          "old_text": null,
          "new_text": "req_free((uv_req_t*) req)",
          "old_line_content": "",
          "new_line_content": "  req_free((uv_req_t*) req);",
          "content_same": false
        },
        {
          "line": 349,
          "old_api": null,
          "new_api": "malloc",
          "old_text": null,
          "new_text": "malloc(size + sizeof *buf)",
          "old_line_content": "  }",
          "new_line_content": "  buf = (buf_list_t*) malloc(size + sizeof *buf);",
          "content_same": false
        },
        {
          "line": 224,
          "old_api": null,
          "new_api": "start_stats_collection",
          "old_text": null,
          "new_text": "start_stats_collection()",
          "old_line_content": "",
          "new_line_content": "    start_stats_collection();",
          "content_same": false
        },
        {
          "line": 228,
          "old_api": null,
          "new_api": "do_write",
          "old_text": null,
          "new_text": "do_write(type == TCP ? (uv_stream_t*)&tcp_write_handles[i] : (uv_stream_t*)&pipe_write_handles[i])",
          "old_line_content": "    /* Yay! start writing */",
          "new_line_content": "      do_write(type == TCP ? (uv_stream_t*)&tcp_write_handles[i] : (uv_stream_t*)&pipe_write_handles[i]);",
          "content_same": false
        },
        {
          "line": 369,
          "old_api": null,
          "new_api": "uv_default_loop",
          "old_text": null,
          "new_text": "uv_default_loop()",
          "old_line_content": "",
          "new_line_content": "  loop = uv_default_loop();",
          "content_same": false
        },
        {
          "line": 245,
          "old_api": null,
          "new_api": "uv_tcp_init",
          "old_text": null,
          "new_text": "uv_tcp_init(loop, tcp)",
          "old_line_content": "      tcp = &tcp_write_handles[max_connect_socket++];",
          "new_line_content": "      r = uv_tcp_init(loop, tcp);",
          "content_same": false
        },
        {
          "line": 246,
          "old_api": null,
          "new_api": "ASSERT",
          "old_text": null,
          "new_text": "ASSERT(r == 0)",
          "old_line_content": "",
          "new_line_content": "      ASSERT(r == 0);",
          "content_same": false
        },
        {
          "line": 375,
          "old_api": null,
          "new_api": "uv_tcp_init",
          "old_text": null,
          "new_text": "uv_tcp_init(loop, &tcpServer)",
          "old_line_content": "  /* Server */",
          "new_line_content": "  r = uv_tcp_init(loop, &tcpServer);",
          "content_same": false
        },
        {
          "line": 376,
          "old_api": null,
          "new_api": "ASSERT",
          "old_text": null,
          "new_text": "ASSERT(r == 0)",
          "old_line_content": "  server = (uv_stream_t*)&tcpServer;",
          "new_line_content": "  ASSERT(r == 0);",
          "content_same": false
        },
        {
          "line": 249,
          "old_api": null,
          "new_api": "uv_tcp_connect",
          "old_text": null,
          "new_text": "uv_tcp_connect(req, tcp, connect_addr, connect_cb)",
          "old_line_content": "",
          "new_line_content": "      r = uv_tcp_connect(req, tcp, connect_addr, connect_cb);",
          "content_same": false
        },
        {
          "line": 254,
          "old_api": null,
          "new_api": "uv_pipe_init",
          "old_text": null,
          "new_text": "uv_pipe_init(loop, pipe, 0)",
          "old_line_content": "      pipe = &pipe_write_handles[max_connect_socket++];",
          "new_line_content": "      r = uv_pipe_init(loop, pipe, 0);",
          "content_same": false
        },
        {
          "line": 255,
          "old_api": null,
          "new_api": "ASSERT",
          "old_text": null,
          "new_text": "ASSERT(r == 0)",
          "old_line_content": "",
          "new_line_content": "      ASSERT(r == 0);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 256,
          "old_api": "uv_pipe_init",
          "new_api": null,
          "old_text": "uv_pipe_init(loop, pipe, 0)",
          "new_text": null,
          "old_line_content": "      r = uv_pipe_init(loop, pipe, 0);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 384,
          "old_api": "uv_run",
          "new_api": null,
          "old_text": "uv_run(loop)",
          "new_text": null,
          "old_line_content": "  uv_run(loop);",
          "new_line_content": "  return 0;",
          "content_same": false
        },
        {
          "line": 259,
          "old_api": "req_alloc",
          "new_api": null,
          "old_text": "req_alloc()",
          "new_text": null,
          "old_line_content": "      req = (uv_connect_t*) req_alloc();",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 260,
          "old_api": "uv_pipe_connect",
          "new_api": null,
          "old_text": "uv_pipe_connect(req, pipe, TEST_PIPENAME, connect_cb)",
          "new_text": null,
          "old_line_content": "      uv_pipe_connect(req, pipe, TEST_PIPENAME, connect_cb);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 394,
          "old_api": "uv_default_loop",
          "new_api": null,
          "old_text": "uv_default_loop()",
          "new_text": null,
          "old_line_content": "  loop = uv_default_loop();",
          "new_line_content": "  /* Server */",
          "content_same": false
        },
        {
          "line": 270,
          "old_api": "ASSERT",
          "new_api": null,
          "old_text": "ASSERT(server == s)",
          "new_text": null,
          "old_line_content": "  ASSERT(server == s);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 271,
          "old_api": "ASSERT",
          "new_api": null,
          "old_text": "ASSERT(status == 0)",
          "new_text": null,
          "old_line_content": "  ASSERT(status == 0);",
          "new_line_content": "  if (type == TCP) {",
          "content_same": false
        },
        {
          "line": 402,
          "old_api": "uv_listen",
          "new_api": null,
          "old_text": "uv_listen((uv_stream_t*)&pipeServer, MAX_WRITE_HANDLES, connection_cb)",
          "new_text": null,
          "old_line_content": "  r = uv_listen((uv_stream_t*)&pipeServer, MAX_WRITE_HANDLES, connection_cb);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 275,
          "old_api": "uv_tcp_init",
          "new_api": null,
          "old_text": "uv_tcp_init(loop, (uv_tcp_t*)stream)",
          "new_text": null,
          "old_line_content": "    r = uv_tcp_init(loop, (uv_tcp_t*)stream);",
          "new_line_content": "  } else {",
          "content_same": false
        },
        {
          "line": 279,
          "old_api": "uv_pipe_init",
          "new_api": null,
          "old_text": "uv_pipe_init(loop, (uv_pipe_t*)stream, 0)",
          "new_text": null,
          "old_line_content": "    r = uv_pipe_init(loop, (uv_pipe_t*)stream, 0);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 280,
          "old_api": "ASSERT",
          "new_api": null,
          "old_text": "ASSERT(r == 0)",
          "new_text": null,
          "old_line_content": "    ASSERT(r == 0);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 407,
          "old_api": "MAKE_VALGRIND_HAPPY",
          "new_api": null,
          "old_text": "MAKE_VALGRIND_HAPPY()",
          "new_text": null,
          "old_line_content": "  MAKE_VALGRIND_HAPPY();",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 283,
          "old_api": "uv_accept",
          "new_api": null,
          "old_text": "uv_accept(s, stream)",
          "new_text": null,
          "old_line_content": "  r = uv_accept(s, stream);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 413,
          "old_api": "ASSERT",
          "new_api": null,
          "old_text": "ASSERT(n <= MAX_WRITE_HANDLES)",
          "new_text": null,
          "old_line_content": "  ASSERT(n <= MAX_WRITE_HANDLES);",
          "new_line_content": "  type = TCP;",
          "content_same": false
        },
        {
          "line": 286,
          "old_api": "uv_read_start",
          "new_api": null,
          "old_text": "uv_read_start(stream, buf_alloc, read_cb)",
          "new_text": null,
          "old_line_content": "  r = uv_read_start(stream, buf_alloc, read_cb);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 287,
          "old_api": "ASSERT",
          "new_api": null,
          "old_text": "ASSERT(r == 0)",
          "new_text": null,
          "old_line_content": "  ASSERT(r == 0);",
          "new_line_content": "  read_sockets++;",
          "content_same": false
        },
        {
          "line": 419,
          "old_api": "uv_ip4_addr",
          "new_api": null,
          "old_text": "uv_ip4_addr(\"127.0.0.1\", TEST_PORT)",
          "new_text": null,
          "old_line_content": "  connect_addr = uv_ip4_addr(\"127.0.0.1\", TEST_PORT);",
          "new_line_content": "  /* Start making connections */",
          "content_same": false
        },
        {
          "line": 426,
          "old_api": "MAKE_VALGRIND_HAPPY",
          "new_api": null,
          "old_text": "MAKE_VALGRIND_HAPPY()",
          "new_text": null,
          "old_line_content": "  MAKE_VALGRIND_HAPPY();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 431,
          "old_api": "ASSERT",
          "new_api": null,
          "old_text": "ASSERT(n <= MAX_WRITE_HANDLES)",
          "new_text": null,
          "old_line_content": "  ASSERT(n <= MAX_WRITE_HANDLES);",
          "new_line_content": "  type = PIPE;",
          "content_same": false
        },
        {
          "line": 435,
          "old_api": "uv_default_loop",
          "new_api": null,
          "old_text": "uv_default_loop()",
          "new_text": null,
          "old_line_content": "  loop = uv_default_loop();",
          "new_line_content": "  /* Start making connections */",
          "content_same": false
        },
        {
          "line": 442,
          "old_api": "MAKE_VALGRIND_HAPPY",
          "new_api": null,
          "old_text": "MAKE_VALGRIND_HAPPY()",
          "new_text": null,
          "old_line_content": "  MAKE_VALGRIND_HAPPY();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 316,
          "old_api": "malloc",
          "new_api": null,
          "old_text": "malloc(sizeof *req)",
          "new_text": null,
          "old_line_content": "  req = (req_list_t*) malloc(sizeof *req);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 447,
          "old_api": "tcp_pump",
          "new_api": null,
          "old_text": "tcp_pump(100)",
          "new_text": null,
          "old_line_content": "  tcp_pump(100);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 453,
          "old_api": "tcp_pump",
          "new_api": null,
          "old_text": "tcp_pump(1)",
          "new_text": null,
          "old_line_content": "  tcp_pump(1);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 459,
          "old_api": "pipe_pump",
          "new_api": null,
          "old_text": "pipe_pump(100)",
          "new_text": null,
          "old_line_content": "  pipe_pump(100);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 209,
          "old_api": "ASSERT",
          "new_api": null,
          "old_text": "ASSERT(r == 0)",
          "new_text": null,
          "old_line_content": "    ASSERT(r == 0);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 465,
          "old_api": "pipe_pump",
          "new_api": null,
          "old_text": "pipe_pump(1)",
          "new_text": null,
          "old_line_content": "  pipe_pump(1);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 217,
          "old_api": "uv_last_error",
          "new_api": null,
          "old_text": "uv_last_error(loop)",
          "new_text": null,
          "old_line_content": "  if (status) LOG(uv_strerror(uv_last_error(loop)));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 218,
          "old_api": "ASSERT",
          "new_api": null,
          "old_text": "ASSERT(status == 0)",
          "new_text": null,
          "old_line_content": "  ASSERT(status == 0);",
          "new_line_content": "  write_sockets++;",
          "content_same": false
        },
        {
          "line": 223,
          "old_api": "maybe_connect_some",
          "new_api": null,
          "old_text": "maybe_connect_some()",
          "new_text": null,
          "old_line_content": "  maybe_connect_some();",
          "new_line_content": "  if (write_sockets == TARGET_CONNECTIONS) {",
          "content_same": false
        },
        {
          "line": 351,
          "old_api": "malloc",
          "new_api": null,
          "old_text": "malloc(size + sizeof *buf)",
          "new_text": null,
          "old_line_content": "  buf = (buf_list_t*) malloc(size + sizeof *buf);",
          "new_line_content": "  buf->uv_buf_t.base = ((char*) buf) + sizeof *buf;",
          "content_same": false
        },
        {
          "line": 226,
          "old_api": "start_stats_collection",
          "new_api": null,
          "old_text": "start_stats_collection()",
          "new_text": null,
          "old_line_content": "    start_stats_collection();",
          "new_line_content": "    /* Yay! start writing */",
          "content_same": false
        },
        {
          "line": 230,
          "old_api": "do_write",
          "new_api": null,
          "old_text": "do_write(type == TCP ? (uv_stream_t*)&tcp_write_handles[i] : (uv_stream_t*)&pipe_write_handles[i])",
          "new_text": null,
          "old_line_content": "      do_write(type == TCP ? (uv_stream_t*)&tcp_write_handles[i] : (uv_stream_t*)&pipe_write_handles[i]);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 373,
          "old_api": "uv_ip4_addr",
          "new_api": null,
          "old_text": "uv_ip4_addr(\"0.0.0.0\", TEST_PORT)",
          "new_text": null,
          "old_line_content": "  listen_addr = uv_ip4_addr(\"0.0.0.0\", TEST_PORT);",
          "new_line_content": "  /* Server */",
          "content_same": false
        },
        {
          "line": 247,
          "old_api": "uv_tcp_init",
          "new_api": null,
          "old_text": "uv_tcp_init(loop, tcp)",
          "new_text": null,
          "old_line_content": "      r = uv_tcp_init(loop, tcp);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 251,
          "old_api": "uv_tcp_connect",
          "new_api": null,
          "old_text": "uv_tcp_connect(req, tcp, connect_addr, connect_cb)",
          "new_text": null,
          "old_line_content": "      r = uv_tcp_connect(req, tcp, connect_addr, connect_cb);",
          "new_line_content": "    } else {",
          "content_same": false
        },
        {
          "line": 252,
          "old_api": "ASSERT",
          "new_api": null,
          "old_text": "ASSERT(r == 0)",
          "new_text": null,
          "old_line_content": "      ASSERT(r == 0);",
          "new_line_content": "      pipe = &pipe_write_handles[max_connect_socket++];",
          "content_same": false
        },
        {
          "line": 381,
          "old_api": "uv_listen",
          "new_api": null,
          "old_text": "uv_listen((uv_stream_t*)&tcpServer, MAX_WRITE_HANDLES, connection_cb)",
          "new_text": null,
          "old_line_content": "  r = uv_listen((uv_stream_t*)&tcpServer, MAX_WRITE_HANDLES, connection_cb);",
          "new_line_content": "",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 23,
      "total_additions": 38,
      "total_deletions": 38,
      "total_api_changes": 99
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 5,
        "api_related_lines": 99,
        "non_api_lines": 1,
        "non_api_line_numbers": [
          210
        ]
      }
    },
    "api_calls_before": 98,
    "api_calls_after": 98,
    "diff_info": {
      "added_lines": 3,
      "removed_lines": 5,
      "total_diff_lines": 20
    }
  }
}