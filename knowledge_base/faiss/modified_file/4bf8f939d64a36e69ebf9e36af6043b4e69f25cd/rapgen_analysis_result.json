{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/faiss/modified_file/4bf8f939d64a36e69ebf9e36af6043b4e69f25cd",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/faiss/modified_file/4bf8f939d64a36e69ebf9e36af6043b4e69f25cd/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/faiss/modified_file/4bf8f939d64a36e69ebf9e36af6043b4e69f25cd/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/faiss/modified_file/4bf8f939d64a36e69ebf9e36af6043b4e69f25cd/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 118,
          "old_api": "getmillisecs",
          "new_api": "is_similarity_metric",
          "old_text": "getmillisecs()",
          "new_text": "is_similarity_metric(storage->metric_type)",
          "old_line_content": "    double t0 = getmillisecs();",
          "new_line_content": "    if (is_similarity_metric(storage->metric_type)) {",
          "content_same": false
        },
        {
          "line": 151,
          "old_api": "size",
          "new_api": "printf",
          "old_text": "hist.size()",
          "new_text": "printf(\"  max_level = %d\\n\", max_level)",
          "old_line_content": "            while (pt_level >= hist.size())",
          "new_line_content": "        printf(\"  max_level = %d\\n\", max_level);",
          "content_same": false
        },
        {
          "line": 187,
          "old_api": "rand_int",
          "new_api": "InterruptCallback::get_period_hint(\n            max_level * index_hnsw.d * hnsw.efConstruction)",
          "old_text": "rng2.rand_int(i1 - j)",
          "new_text": "InterruptCallback::get_period_hint(\n            max_level * index_hnsw.d * hnsw.efConstruction)",
          "old_line_content": "                std::swap(order[j], order[j + rng2.rand_int(i1 - j)]);",
          "new_line_content": "    idx_t check_period = InterruptCallback::get_period_hint(",
          "content_same": false
        },
        {
          "line": 297,
          "old_api": "std::min(i0 + check_period, n)",
          "new_api": "FAISS_THROW_IF_NOT_MSG",
          "old_text": "std::min(i0 + check_period, n)",
          "new_text": "FAISS_THROW_IF_NOT_MSG(\n            storage,\n            \"Please use IndexHNSWFlat (or variants) instead of IndexHNSW directly\")",
          "old_line_content": "        idx_t i1 = std::min(i0 + check_period, n);",
          "new_line_content": "    FAISS_THROW_IF_NOT_MSG(",
          "content_same": false
        },
        {
          "line": 327,
          "old_api": "compute_distances",
          "new_api": "set_query",
          "old_text": "reconstruct_from_neighbors->compute_distances(\n                            k_reorder, idxi, x + i * d, simi)",
          "new_text": "dis->set_query(x + i * d)",
          "old_line_content": "                    nreorder += reconstruct_from_neighbors->compute_distances(",
          "new_line_content": "                dis->set_query(x + i * d);",
          "content_same": false
        },
        {
          "line": 354,
          "old_api": "FAISS_THROW_IF_NOT",
          "new_api": "InterruptCallback::check()",
          "old_text": "FAISS_THROW_IF_NOT(is_trained)",
          "new_text": "InterruptCallback::check()",
          "old_line_content": "    FAISS_THROW_IF_NOT(is_trained);",
          "new_line_content": "        InterruptCallback::check();",
          "content_same": false
        },
        {
          "line": 364,
          "old_api": "reset",
          "new_api": "combine",
          "old_text": "storage->reset()",
          "new_text": "hnsw_stats.combine({n1, n2, n3, ndis, nreorder})",
          "old_line_content": "    storage->reset();",
          "new_line_content": "    hnsw_stats.combine({n1, n2, n3, ndis, nreorder});",
          "content_same": false
        },
        {
          "line": 381,
          "old_api": "neighbor_range",
          "new_api": "reset",
          "old_text": "hnsw.neighbor_range(i, 0, &begin, &end)",
          "new_text": "storage->reset()",
          "old_line_content": "            hnsw.neighbor_range(i, 0, &begin, &end);",
          "new_line_content": "    storage->reset();",
          "content_same": false
        },
        {
          "line": 435,
          "old_api": "set_query",
          "new_api": "FAISS_THROW_IF_NOT",
          "old_text": "qdis->set_query(x + i * d)",
          "new_text": "FAISS_THROW_IF_NOT(k > 0)",
          "old_line_content": "            qdis->set_query(x + i * d);",
          "new_line_content": "    FAISS_THROW_IF_NOT(k > 0);",
          "content_same": false
        },
        {
          "line": 436,
          "old_api": "maxheap_heapify",
          "new_api": "FAISS_THROW_IF_NOT",
          "old_text": "maxheap_heapify(k, simi, idxi)",
          "new_text": "FAISS_THROW_IF_NOT(nprobe > 0)",
          "old_line_content": "            maxheap_heapify(k, simi, idxi);",
          "new_line_content": "    FAISS_THROW_IF_NOT(nprobe > 0);",
          "content_same": false
        },
        {
          "line": 438,
          "old_api": "search_level_0",
          "new_api": "size",
          "old_text": "hnsw.search_level_0(\n                    *qdis.get(),\n                    k,\n                    idxi,\n                    simi,\n                    nprobe,\n                    nearest + i * nprobe,\n                    nearest_d + i * nprobe,\n                    search_type,\n                    search_stats,\n                    vt)",
          "new_text": "hnsw.levels.size()",
          "old_line_content": "            hnsw.search_level_0(",
          "new_line_content": "    storage_idx_t ntotal = hnsw.levels.size();",
          "content_same": false
        },
        {
          "line": 468,
          "old_api": "data",
          "new_api": "maxheap_reorder",
          "old_text": "vec.data()",
          "new_text": "maxheap_reorder(k, simi, idxi)",
          "old_line_content": "        storage->reconstruct(i, vec.data());",
          "new_line_content": "            maxheap_reorder(k, simi, idxi);",
          "content_same": false
        },
        {
          "line": 479,
          "old_api": "emplace",
          "new_api": "nb_neighbors",
          "old_text": "initial_list.emplace(D[i * k + j], v1)",
          "new_text": "hnsw.nb_neighbors(0)",
          "old_line_content": "            initial_list.emplace(D[i * k + j], v1);",
          "new_line_content": "    int dest_size = hnsw.nb_neighbors(0);",
          "content_same": false
        },
        {
          "line": 483,
          "old_api": "HNSW::shrink_neighbor_list(*qdis, initial_list, shrunk_list, dest_size)",
          "new_api": "storage_distance_computer",
          "old_text": "HNSW::shrink_neighbor_list(*qdis, initial_list, shrunk_list, dest_size)",
          "new_text": "storage_distance_computer(storage)",
          "old_line_content": "        HNSW::shrink_neighbor_list(*qdis, initial_list, shrunk_list, dest_size);",
          "new_line_content": "        DistanceComputer* qdis = storage_distance_computer(storage);",
          "content_same": false
        },
        {
          "line": 486,
          "old_api": "neighbor_range",
          "new_api": "data",
          "old_text": "hnsw.neighbor_range(i, 0, &begin, &end)",
          "new_text": "vec.data()",
          "old_line_content": "        hnsw.neighbor_range(i, 0, &begin, &end);",
          "new_line_content": "        qdis->set_query(vec.data());",
          "content_same": false
        },
        {
          "line": 503,
          "old_api": "omp_init_lock",
          "new_api": "neighbor_range",
          "old_text": "omp_init_lock(&locks[i])",
          "new_text": "hnsw.neighbor_range(i, 0, &begin, &end)",
          "old_line_content": "        omp_init_lock(&locks[i]);",
          "new_line_content": "        hnsw.neighbor_range(i, 0, &begin, &end);",
          "content_same": false
        },
        {
          "line": 520,
          "old_api": "add_links_starting_from",
          "new_api": "omp_init_lock",
          "old_text": "hnsw.add_links_starting_from(\n                    *dis, pt_id, nearest, (*dis)(nearest), 0, locks.data(), vt)",
          "new_text": "omp_init_lock(&locks[i])",
          "old_line_content": "            hnsw.add_links_starting_from(",
          "new_line_content": "        omp_init_lock(&locks[i]);",
          "content_same": false
        },
        {
          "line": 534,
          "old_api": "omp_destroy_lock",
          "new_api": "data",
          "old_text": "omp_destroy_lock(&locks[i])",
          "new_text": "vec.data()",
          "old_line_content": "        omp_destroy_lock(&locks[i]);",
          "new_line_content": "            storage->reconstruct(pt_id, vec.data());",
          "content_same": false
        },
        {
          "line": 538,
          "old_api": "nb_neighbors",
          "new_api": "data",
          "old_text": "hnsw.nb_neighbors(0)",
          "new_text": "locks.data()",
          "old_line_content": "    int M = hnsw.nb_neighbors(0);",
          "new_line_content": "                    *dis, pt_id, nearest, (*dis)(nearest), 0, locks.data(), vt);",
          "content_same": false
        },
        {
          "line": 551,
          "old_api": "neighbor_range",
          "new_api": "omp_destroy_lock",
          "old_text": "hnsw.neighbor_range(i, 0, &begin, &end)",
          "new_text": "omp_destroy_lock(&locks[i])",
          "old_line_content": "            hnsw.neighbor_range(i, 0, &begin, &end);",
          "new_line_content": "        omp_destroy_lock(&locks[i]);",
          "content_same": false
        },
        {
          "line": 626,
          "old_api": "FAISS_ASSERT",
          "new_api": "dynamic_cast<IndexFlatCodes*>(storage)",
          "old_text": "FAISS_ASSERT(k <= 256)",
          "new_text": "dynamic_cast<IndexFlatCodes*>(storage)",
          "old_line_content": "    FAISS_ASSERT(k <= 256);",
          "new_line_content": "    auto flat_storage = dynamic_cast<IndexFlatCodes*>(storage);",
          "content_same": false
        },
        {
          "line": 630,
          "old_api": "FAISS_ASSERT",
          "new_api": "permute_entries",
          "old_text": "FAISS_ASSERT(d % nsq == 0)",
          "new_text": "hnsw.permute_entries(perm)",
          "old_line_content": "    FAISS_ASSERT(d % nsq == 0);",
          "new_line_content": "    hnsw.permute_entries(perm);",
          "content_same": false
        },
        {
          "line": 663,
          "old_api": "reconstruct",
          "new_api": "data",
          "old_text": "index.storage->reconstruct(ji, tmp)",
          "new_text": "codebook.data()",
          "old_line_content": "            index.storage->reconstruct(ji, tmp);",
          "new_line_content": "            beta = codebook.data();",
          "content_same": false
        },
        {
          "line": 798,
          "old_api": "get",
          "new_api": "reconstruct",
          "old_text": "tmp1.get()",
          "new_text": "index.storage->reconstruct(i, tmp1)",
          "old_line_content": "    float* tmp2 = tmp1.get() + d * (M + 1);",
          "new_line_content": "    index.storage->reconstruct(i, tmp1);",
          "content_same": false
        },
        {
          "line": 1018,
          "old_api": "get",
          "new_api": "FAISS_THROW_IF_NOT_MSG",
          "old_text": "index_ivfpq->quantizer->search(\n                n, x, nprobe, coarse_dis.get(), coarse_assign.get())",
          "new_text": "FAISS_THROW_IF_NOT_MSG(\n            !params, \"search params not supported for this index\")",
          "old_line_content": "        index_ivfpq->quantizer->search(",
          "new_line_content": "    FAISS_THROW_IF_NOT_MSG(",
          "content_same": false
        },
        {
          "line": 1021,
          "old_api": "get",
          "new_api": "dynamic_cast<const Index2Layer*>(storage)",
          "old_text": "index_ivfpq->search_preassigned(\n                n,\n                x,\n                k,\n                coarse_assign.get(),\n                coarse_dis.get(),\n                distances,\n                labels,\n                false)",
          "new_text": "dynamic_cast<const Index2Layer*>(storage)",
          "old_line_content": "        index_ivfpq->search_preassigned(",
          "new_line_content": "    if (dynamic_cast<const Index2Layer*>(storage)) {",
          "content_same": false
        },
        {
          "line": 1069,
          "old_api": "maxheap_heapify",
          "new_api": "get_list_size",
          "old_text": "maxheap_heapify(k, simi, idxi, simi, idxi, k)",
          "new_text": "index_ivfpq->get_list_size(key)",
          "old_line_content": "                maxheap_heapify(k, simi, idxi, simi, idxi, k);",
          "new_line_content": "                    size_t list_length = index_ivfpq->get_list_size(key);",
          "content_same": false
        },
        {
          "line": 1089,
          "old_api": "advance",
          "new_api": "search_from_candidates_2",
          "old_text": "vt.advance()",
          "new_text": "search_from_candidates_2(\n                        hnsw,\n                        *dis,\n                        k,\n                        idxi,\n                        simi,\n                        candidates,\n                        vt,\n                        search_stats,\n                        0,\n                        k)",
          "old_line_content": "                vt.advance();",
          "new_line_content": "                search_from_candidates_2(",
          "content_same": false
        },
        {
          "line": 1113,
          "old_api": "precompute_table",
          "new_api": "combine",
          "old_text": "index_ivfpq->precompute_table()",
          "new_text": "hnsw_stats.combine({n1, n2, n3, ndis, nreorder})",
          "old_line_content": "    index_ivfpq->precompute_table();",
          "new_line_content": "        hnsw_stats.combine({n1, n2, n3, ndis, nreorder});",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 1028,
          "old_api": null,
          "new_api": "dynamic_cast<const IndexIVFPQ*>(storage)",
          "old_text": null,
          "new_text": "dynamic_cast<const IndexIVFPQ*>(storage)",
          "old_line_content": "                labels,",
          "new_line_content": "                dynamic_cast<const IndexIVFPQ*>(storage);",
          "content_same": false
        },
        {
          "line": 1035,
          "old_api": null,
          "new_api": "get",
          "old_text": null,
          "new_text": "index_ivfpq->quantizer->search(\n                n, x, nprobe, coarse_dis.get(), coarse_assign.get())",
          "old_line_content": "                    storage_distance_computer(storage));",
          "new_line_content": "        index_ivfpq->quantizer->search(",
          "content_same": false
        },
        {
          "line": 1036,
          "old_api": null,
          "new_api": "get",
          "old_text": null,
          "new_text": "coarse_assign.get()",
          "old_line_content": "",
          "new_line_content": "                n, x, nprobe, coarse_dis.get(), coarse_assign.get());",
          "content_same": false
        },
        {
          "line": 1038,
          "old_api": null,
          "new_api": "get",
          "old_text": null,
          "new_text": "index_ivfpq->search_preassigned(\n                n,\n                x,\n                k,\n                coarse_assign.get(),\n                coarse_dis.get(),\n                distances,\n                labels,\n                false)",
          "old_line_content": "            MinimaxHeap candidates(candidates_size);",
          "new_line_content": "        index_ivfpq->search_preassigned(",
          "content_same": false
        },
        {
          "line": 1042,
          "old_api": null,
          "new_api": "get",
          "old_text": null,
          "new_text": "coarse_assign.get()",
          "old_line_content": "                idx_t* idxi = labels + i * k;",
          "new_line_content": "                coarse_assign.get(),",
          "content_same": false
        },
        {
          "line": 1043,
          "old_api": null,
          "new_api": "get",
          "old_text": null,
          "new_text": "coarse_dis.get()",
          "old_line_content": "                float* simi = distances + i * k;",
          "new_line_content": "                coarse_dis.get(),",
          "content_same": false
        },
        {
          "line": 535,
          "old_api": null,
          "new_api": "data",
          "old_text": null,
          "new_text": "vec.data()",
          "old_line_content": "}",
          "new_line_content": "            dis->set_query(vec.data());",
          "content_same": false
        },
        {
          "line": 537,
          "old_api": null,
          "new_api": "add_links_starting_from",
          "old_text": null,
          "new_text": "hnsw.add_links_starting_from(\n                    *dis, pt_id, nearest, (*dis)(nearest), 0, locks.data(), vt)",
          "old_line_content": "void IndexHNSW::reorder_links() {",
          "new_line_content": "            hnsw.add_links_starting_from(",
          "content_same": false
        },
        {
          "line": 541,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\"  %d / %d\\r\", i, n)",
          "old_line_content": "    {",
          "new_line_content": "                printf(\"  %d / %d\\r\", i, n);",
          "content_same": false
        },
        {
          "line": 542,
          "old_api": null,
          "new_api": "fflush",
          "old_text": null,
          "new_text": "fflush(stdout)",
          "old_line_content": "        std::vector<float> distances(M);",
          "new_line_content": "                fflush(stdout);",
          "content_same": false
        },
        {
          "line": 547,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\"\\n\")",
          "old_line_content": "",
          "new_line_content": "        printf(\"\\n\");",
          "content_same": false
        },
        {
          "line": 1061,
          "old_api": null,
          "new_api": "set_query",
          "old_text": null,
          "new_text": "dis->set_query(x + i * d)",
          "old_line_content": "",
          "new_line_content": "                dis->set_query(x + i * d);",
          "content_same": false
        },
        {
          "line": 555,
          "old_api": null,
          "new_api": "nb_neighbors",
          "old_text": null,
          "new_text": "hnsw.nb_neighbors(0)",
          "old_line_content": "                if (nj < 0) {",
          "new_line_content": "    int M = hnsw.nb_neighbors(0);",
          "content_same": false
        },
        {
          "line": 1070,
          "old_api": null,
          "new_api": "get_ids",
          "old_text": null,
          "new_text": "index_ivfpq->invlists->get_ids(key)",
          "old_line_content": "",
          "new_line_content": "                    const idx_t* ids = index_ivfpq->invlists->get_ids(key);",
          "content_same": false
        },
        {
          "line": 1073,
          "old_api": null,
          "new_api": "set",
          "old_text": null,
          "new_text": "vt.set(ids[jj])",
          "old_line_content": "                        hnsw,",
          "new_line_content": "                        vt.set(ids[jj]);",
          "content_same": false
        },
        {
          "line": 1077,
          "old_api": null,
          "new_api": "clear",
          "old_text": null,
          "new_text": "candidates.clear()",
          "old_line_content": "                        simi,",
          "new_line_content": "                candidates.clear();",
          "content_same": false
        },
        {
          "line": 568,
          "old_api": null,
          "new_api": "neighbor_range",
          "old_text": null,
          "new_text": "hnsw.neighbor_range(i, 0, &begin, &end)",
          "old_line_content": "    }",
          "new_line_content": "            hnsw.neighbor_range(i, 0, &begin, &end);",
          "content_same": false
        },
        {
          "line": 1082,
          "old_api": null,
          "new_api": "push",
          "old_text": null,
          "new_text": "candidates.push(idxi[j], simi[j])",
          "old_line_content": "                        k);",
          "new_line_content": "                    candidates.push(idxi[j], simi[j]);",
          "content_same": false
        },
        {
          "line": 1086,
          "old_api": null,
          "new_api": "maxheap_heapify",
          "old_text": null,
          "new_text": "maxheap_heapify(k, simi, idxi, simi, idxi, k)",
          "old_line_content": "                ndis += search_stats.ndis;",
          "new_line_content": "                maxheap_heapify(k, simi, idxi, simi, idxi, k);",
          "content_same": false
        },
        {
          "line": 576,
          "old_api": null,
          "new_api": "symmetric_dis",
          "old_text": null,
          "new_text": "dis->symmetric_dis(i, nj)",
          "old_line_content": "    for (size_t i = 0; i < ntotal; i++) {",
          "new_line_content": "                distances[j - begin] = dis->symmetric_dis(i, nj);",
          "content_same": false
        },
        {
          "line": 580,
          "old_api": null,
          "new_api": "data",
          "old_text": null,
          "new_text": "order.data()",
          "old_line_content": "            storage_idx_t ni = hnsw.neighbors[j];",
          "new_line_content": "            fvec_argsort(end - begin, distances.data(), order.data());",
          "content_same": false
        },
        {
          "line": 589,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\"search for singletons\\n\")",
          "old_line_content": "        if (!seen[i]) {",
          "new_line_content": "    printf(\"search for singletons\\n\");",
          "content_same": false
        },
        {
          "line": 1106,
          "old_api": null,
          "new_api": "advance",
          "old_text": null,
          "new_text": "vt.advance()",
          "old_line_content": "            storage2l->q1.quantizer,",
          "new_line_content": "                vt.advance();",
          "content_same": false
        },
        {
          "line": 595,
          "old_api": null,
          "new_api": "neighbor_range",
          "old_text": null,
          "new_text": "hnsw.neighbor_range(i, 0, &begin, &end)",
          "old_line_content": "    }",
          "new_line_content": "        hnsw.neighbor_range(i, 0, &begin, &end);",
          "content_same": false
        },
        {
          "line": 1107,
          "old_api": null,
          "new_api": "advance",
          "old_text": null,
          "new_text": "vt.advance()",
          "old_line_content": "            d,",
          "new_line_content": "                vt.advance();",
          "content_same": false
        },
        {
          "line": 1109,
          "old_api": null,
          "new_api": "maxheap_reorder",
          "old_text": null,
          "new_text": "maxheap_reorder(k, simi, idxi)",
          "old_line_content": "            storage2l->pq.M,",
          "new_line_content": "                maxheap_reorder(k, simi, idxi);",
          "content_same": false
        },
        {
          "line": 1118,
          "old_api": null,
          "new_api": "dynamic_cast<Index2Layer*>(storage)",
          "old_text": null,
          "new_text": "dynamic_cast<Index2Layer*>(storage)",
          "old_line_content": "    storage = index_ivfpq;",
          "new_line_content": "    Index2Layer* storage2l = dynamic_cast<Index2Layer*>(storage);",
          "content_same": false
        },
        {
          "line": 607,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "singletons.push_back(i)",
          "old_line_content": "",
          "new_line_content": "            singletons.push_back(i);",
          "content_same": false
        },
        {
          "line": 1120,
          "old_api": null,
          "new_api": "FAISS_THROW_IF_NOT",
          "old_text": null,
          "new_text": "FAISS_THROW_IF_NOT(storage2l)",
          "old_line_content": "}",
          "new_line_content": "    FAISS_THROW_IF_NOT(storage2l);",
          "content_same": false
        },
        {
          "line": 99,
          "old_api": null,
          "new_api": "distances_batch_4",
          "old_text": null,
          "new_text": "basedis->distances_batch_4(\n                idx0, idx1, idx2, idx3, dis0, dis1, dis2, dis3)",
          "old_line_content": "",
          "new_line_content": "        basedis->distances_batch_4(",
          "content_same": false
        },
        {
          "line": 614,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\"  Found %d / %\" PRId64 \" singletons (%d appear in a level above)\\n\",\n           n_sing,\n           ntotal,\n           n_sing_l1)",
          "old_line_content": "}",
          "new_line_content": "    printf(\"  Found %d / %\" PRId64 \" singletons (%d appear in a level above)\\n\",",
          "content_same": false
        },
        {
          "line": 1130,
          "old_api": null,
          "new_api": "precompute_table",
          "old_text": null,
          "new_text": "index_ivfpq->precompute_table()",
          "old_line_content": "",
          "new_line_content": "    index_ivfpq->precompute_table();",
          "content_same": false
        },
        {
          "line": 619,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "singletons.size()",
          "old_line_content": "",
          "new_line_content": "    std::vector<float> recons(singletons.size() * d);",
          "content_same": false
        },
        {
          "line": 620,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "singletons.size()",
          "old_line_content": "ReconstructFromNeighbors::ReconstructFromNeighbors(",
          "new_line_content": "    for (int i = 0; i < singletons.size(); i++) {",
          "content_same": false
        },
        {
          "line": 109,
          "old_api": null,
          "new_api": "symmetric_dis",
          "old_text": null,
          "new_text": "basedis->symmetric_dis(i, j)",
          "old_line_content": "        IndexHNSW& index_hnsw,",
          "new_line_content": "        return -basedis->symmetric_dis(i, j);",
          "content_same": false
        },
        {
          "line": 621,
          "old_api": null,
          "new_api": "FAISS_ASSERT",
          "old_text": null,
          "new_text": "FAISS_ASSERT(!\"not implemented\")",
          "old_line_content": "        const IndexHNSW& index,",
          "new_line_content": "        FAISS_ASSERT(!\"not implemented\");",
          "content_same": false
        },
        {
          "line": 1132,
          "old_api": null,
          "new_api": "transfer_to_IVFPQ",
          "old_text": null,
          "new_text": "storage2l->transfer_to_IVFPQ(*index_ivfpq)",
          "old_line_content": "",
          "new_line_content": "    storage2l->transfer_to_IVFPQ(*index_ivfpq);",
          "content_same": false
        },
        {
          "line": 1133,
          "old_api": null,
          "new_api": "make_direct_map",
          "old_text": null,
          "new_text": "index_ivfpq->make_direct_map(true)",
          "old_line_content": "",
          "new_line_content": "    index_ivfpq->make_direct_map(true);",
          "content_same": false
        },
        {
          "line": 627,
          "old_api": null,
          "new_api": "FAISS_THROW_IF_NOT_MSG",
          "old_text": null,
          "new_text": "FAISS_THROW_IF_NOT_MSG(\n            flat_storage, \"don't know how to permute this index\")",
          "old_line_content": "    code_size = k == 1 ? 0 : nsq;",
          "new_line_content": "    FAISS_THROW_IF_NOT_MSG(",
          "content_same": false
        },
        {
          "line": 629,
          "old_api": null,
          "new_api": "permute_entries",
          "old_text": null,
          "new_text": "flat_storage->permute_entries(perm)",
          "old_line_content": "    d = index.d;",
          "new_line_content": "    flat_storage->permute_entries(perm);",
          "content_same": false
        },
        {
          "line": 119,
          "old_api": null,
          "new_api": "get_distance_computer",
          "old_text": null,
          "new_text": "storage->get_distance_computer()",
          "old_line_content": "    if (verbose) {",
          "new_line_content": "        return new NegativeDistanceComputer(storage->get_distance_computer());",
          "content_same": false
        },
        {
          "line": 121,
          "old_api": null,
          "new_api": "get_distance_computer",
          "old_text": null,
          "new_text": "storage->get_distance_computer()",
          "old_line_content": "               \"(preset_levels=%d)\\n\",",
          "new_line_content": "        return storage->get_distance_computer();",
          "content_same": false
        },
        {
          "line": 642,
          "old_api": null,
          "new_api": "nb_neighbors",
          "old_text": null,
          "new_text": "index.hnsw.nb_neighbors(0)",
          "old_line_content": "",
          "new_line_content": "    M = index.hnsw.nb_neighbors(0);",
          "content_same": false
        },
        {
          "line": 643,
          "old_api": null,
          "new_api": "FAISS_ASSERT",
          "old_text": null,
          "new_text": "FAISS_ASSERT(k <= 256)",
          "old_line_content": "    if (k == 1 || nsq == 1) {",
          "new_line_content": "    FAISS_ASSERT(k <= 256);",
          "content_same": false
        },
        {
          "line": 135,
          "old_api": null,
          "new_api": "getmillisecs",
          "old_text": null,
          "new_text": "getmillisecs()",
          "old_line_content": "    }",
          "new_line_content": "    double t0 = getmillisecs();",
          "content_same": false
        },
        {
          "line": 647,
          "old_api": null,
          "new_api": "FAISS_ASSERT",
          "old_text": null,
          "new_text": "FAISS_ASSERT(d % nsq == 0)",
          "old_line_content": "        } else {",
          "new_line_content": "    FAISS_ASSERT(d % nsq == 0);",
          "content_same": false
        },
        {
          "line": 137,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\"hnsw_add_vertices: adding %zd elements on top of %zd \"\n               \"(preset_levels=%d)\\n\",\n               n,\n               n0,\n               int(preset_levels))",
          "old_line_content": "    std::vector<omp_lock_t> locks(ntotal);",
          "new_line_content": "        printf(\"hnsw_add_vertices: adding %zd elements on top of %zd \"",
          "content_same": false
        },
        {
          "line": 658,
          "old_api": null,
          "new_api": "neighbor_range",
          "old_text": null,
          "new_text": "hnsw.neighbor_range(i, 0, &begin, &end)",
          "old_line_content": "        for (size_t j = begin; j < end; j++) {",
          "new_line_content": "    hnsw.neighbor_range(i, 0, &begin, &end);",
          "content_same": false
        },
        {
          "line": 148,
          "old_api": null,
          "new_api": "prepare_level_tab",
          "old_text": null,
          "new_text": "hnsw.prepare_level_tab(n, preset_levels)",
          "old_line_content": "        for (int i = 0; i < n; i++) {",
          "new_line_content": "    int max_level = hnsw.prepare_level_tab(n, preset_levels);",
          "content_same": false
        },
        {
          "line": 666,
          "old_api": null,
          "new_api": "data",
          "old_text": null,
          "new_text": "codebook.data()",
          "old_line_content": "        }",
          "new_line_content": "            beta = codebook.data() + idx * (M + 1);",
          "content_same": false
        },
        {
          "line": 156,
          "old_api": null,
          "new_api": "omp_init_lock",
          "old_text": null,
          "new_text": "omp_init_lock(&locks[i])",
          "old_line_content": "        // accumulate",
          "new_line_content": "        omp_init_lock(&locks[i]);",
          "content_same": false
        },
        {
          "line": 670,
          "old_api": null,
          "new_api": "reconstruct",
          "old_text": null,
          "new_text": "index.storage->reconstruct(i, tmp)",
          "old_line_content": "",
          "new_line_content": "        index.storage->reconstruct(i, tmp);",
          "content_same": false
        },
        {
          "line": 168,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "hist.size()",
          "old_line_content": "    }",
          "new_line_content": "            while (pt_level >= hist.size())",
          "content_same": false
        },
        {
          "line": 169,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "hist.push_back(0)",
          "old_line_content": "",
          "new_line_content": "                hist.push_back(0);",
          "content_same": false
        },
        {
          "line": 680,
          "old_api": null,
          "new_api": "reconstruct",
          "old_text": null,
          "new_text": "index.storage->reconstruct(ji, tmp)",
          "old_line_content": "            x[l] = w0 * tmp[l];",
          "new_line_content": "            index.storage->reconstruct(ji, tmp);",
          "content_same": false
        },
        {
          "line": 174,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "hist.size()",
          "old_line_content": "        RandomGenerator rng2(789);",
          "new_line_content": "        std::vector<int> offsets(hist.size() + 1, 0);",
          "content_same": false
        },
        {
          "line": 175,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "hist.size()",
          "old_line_content": "",
          "new_line_content": "        for (int i = 0; i < hist.size() - 1; i++) {",
          "content_same": false
        },
        {
          "line": 688,
          "old_api": null,
          "new_api": "data",
          "old_text": null,
          "new_text": "codebook.data()",
          "old_line_content": "            if (ji < 0)",
          "new_line_content": "        const float* beta0 = codebook.data() + idx0 * (M + 1);",
          "content_same": false
        },
        {
          "line": 689,
          "old_api": null,
          "new_api": "data",
          "old_text": null,
          "new_text": "codebook.data()",
          "old_line_content": "                ji = i;",
          "new_line_content": "        const float* beta1 = codebook.data() + (idx1 + k) * (M + 1);",
          "content_same": false
        },
        {
          "line": 691,
          "old_api": null,
          "new_api": "reconstruct",
          "old_text": null,
          "new_text": "index.storage->reconstruct(i, tmp)",
          "old_line_content": "            float w;",
          "new_line_content": "        index.storage->reconstruct(i, tmp);",
          "content_same": false
        },
        {
          "line": 195,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "hist.size()",
          "old_line_content": "                std::unique_ptr<DistanceComputer> dis(",
          "new_line_content": "        for (int pt_level = hist.size() - 1; pt_level >= 0; pt_level--) {",
          "content_same": false
        },
        {
          "line": 707,
          "old_api": null,
          "new_api": "reconstruct",
          "old_text": null,
          "new_text": "index.storage->reconstruct(ji, tmp)",
          "old_line_content": "                b += (M + 1) * k;",
          "new_line_content": "            index.storage->reconstruct(ji, tmp);",
          "content_same": false
        },
        {
          "line": 199,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\"Adding %d elements at level %d\\n\", i1 - i0, pt_level)",
          "old_line_content": "                size_t counter = 0;",
          "new_line_content": "                printf(\"Adding %d elements at level %d\\n\", i1 - i0, pt_level);",
          "content_same": false
        },
        {
          "line": 204,
          "old_api": null,
          "new_api": "rand_int",
          "old_text": null,
          "new_text": "rng2.rand_int(i1 - j)",
          "old_line_content": "#pragma omp for schedule(static)",
          "new_line_content": "                std::swap(order[j], order[j + rng2.rand_int(i1 - j)]);",
          "content_same": false
        },
        {
          "line": 720,
          "old_api": null,
          "new_api": "data",
          "old_text": null,
          "new_text": "codebook.data()",
          "old_line_content": "                d0 = d1;",
          "new_line_content": "            const float* b = codebook.data();",
          "content_same": false
        },
        {
          "line": 213,
          "old_api": null,
          "new_api": "storage_distance_computer",
          "old_text": null,
          "new_text": "storage_distance_computer(index_hnsw.storage)",
          "old_line_content": "",
          "new_line_content": "                        storage_distance_computer(index_hnsw.storage));",
          "content_same": false
        },
        {
          "line": 215,
          "old_api": null,
          "new_api": "omp_get_thread_num",
          "old_text": null,
          "new_text": "omp_get_thread_num()",
          "old_line_content": "",
          "new_line_content": "                        verbose && omp_get_thread_num() == 0 ? 0 : -1;",
          "content_same": false
        },
        {
          "line": 728,
          "old_api": null,
          "new_api": "reconstruct",
          "old_text": null,
          "new_text": "index.storage->reconstruct(i, tmp)",
          "old_line_content": "",
          "new_line_content": "        index.storage->reconstruct(i, tmp);",
          "content_same": false
        },
        {
          "line": 224,
          "old_api": null,
          "new_api": "set_query",
          "old_text": null,
          "new_text": "dis->set_query(x + (pt_id - n0) * d)",
          "old_line_content": "                        }",
          "new_line_content": "                    dis->set_query(x + (pt_id - n0) * d);",
          "content_same": false
        },
        {
          "line": 231,
          "old_api": null,
          "new_api": "add_with_locks",
          "old_text": null,
          "new_text": "hnsw.add_with_locks(*dis, pt_level, pt_id, locks, vt)",
          "old_line_content": "            }",
          "new_line_content": "                    hnsw.add_with_locks(*dis, pt_level, pt_id, locks, vt);",
          "content_same": false
        },
        {
          "line": 746,
          "old_api": null,
          "new_api": "reconstruct",
          "old_text": null,
          "new_text": "index.storage->reconstruct(ji, tmp)",
          "old_line_content": "        float* x) const {",
          "new_line_content": "            index.storage->reconstruct(ji, tmp);",
          "content_same": false
        },
        {
          "line": 235,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\"  %d / %d\\r\", i - i0, i1 - i0)",
          "old_line_content": "    }",
          "new_line_content": "                        printf(\"  %d / %d\\r\", i - i0, i1 - i0);",
          "content_same": false
        },
        {
          "line": 236,
          "old_api": null,
          "new_api": "fflush",
          "old_text": null,
          "new_text": "fflush(stdout)",
          "old_line_content": "    if (verbose) {",
          "new_line_content": "                        fflush(stdout);",
          "content_same": false
        },
        {
          "line": 239,
          "old_api": null,
          "new_api": "InterruptCallback::is_interrupted()",
          "old_text": null,
          "new_text": "InterruptCallback::is_interrupted()",
          "old_line_content": "",
          "new_line_content": "                        if (InterruptCallback::is_interrupted()) {",
          "content_same": false
        },
        {
          "line": 247,
          "old_api": null,
          "new_api": "FAISS_THROW_MSG",
          "old_text": null,
          "new_text": "FAISS_THROW_MSG(\"computation interrupted\")",
          "old_line_content": "/**************************************************************",
          "new_line_content": "                FAISS_THROW_MSG(\"computation interrupted\");",
          "content_same": false
        },
        {
          "line": 251,
          "old_api": null,
          "new_api": "FAISS_ASSERT",
          "old_text": null,
          "new_text": "FAISS_ASSERT(i1 == 0)",
          "old_line_content": "IndexHNSW::IndexHNSW(int d, int M, MetricType metric)",
          "new_line_content": "        FAISS_ASSERT(i1 == 0);",
          "content_same": false
        },
        {
          "line": 254,
          "old_api": null,
          "new_api": "getmillisecs",
          "old_text": null,
          "new_text": "getmillisecs()",
          "old_line_content": "IndexHNSW::IndexHNSW(Index* storage, int M)",
          "new_line_content": "        printf(\"Done in %.3f ms\\n\", getmillisecs() - t0);",
          "content_same": false
        },
        {
          "line": 769,
          "old_api": null,
          "new_api": "data",
          "old_text": null,
          "new_text": "tmp.data()",
          "old_line_content": "        ncomp++;",
          "new_line_content": "            reconstruct(n0 + i, x + i * index.d, tmp.data());",
          "content_same": false
        },
        {
          "line": 258,
          "old_api": null,
          "new_api": "omp_destroy_lock",
          "old_text": null,
          "new_text": "omp_destroy_lock(&locks[i])",
          "old_line_content": "    if (own_fields) {",
          "new_line_content": "        omp_destroy_lock(&locks[i]);",
          "content_same": false
        },
        {
          "line": 784,
          "old_api": null,
          "new_api": "data",
          "old_text": null,
          "new_text": "tmp.data()",
          "old_line_content": "        storage_idx_t ji = hnsw.neighbors[j];",
          "new_line_content": "        reconstruct(shortlist[i], tmp.data(), tmp.data() + index.d);",
          "content_same": false
        },
        {
          "line": 785,
          "old_api": null,
          "new_api": "data",
          "old_text": null,
          "new_text": "tmp.data()",
          "old_line_content": "        if (ji < 0)",
          "new_line_content": "        distances[i] = fvec_L2sqr(query, tmp.data(), index.d);",
          "content_same": false
        },
        {
          "line": 281,
          "old_api": null,
          "new_api": "FAISS_THROW_IF_NOT_MSG",
          "old_text": null,
          "new_text": "FAISS_THROW_IF_NOT_MSG(\n            storage,\n            \"Please use IndexHNSWFlat (or variants) instead of IndexHNSW directly\")",
          "old_line_content": "            storage,",
          "new_line_content": "    FAISS_THROW_IF_NOT_MSG(",
          "content_same": false
        },
        {
          "line": 795,
          "old_api": null,
          "new_api": "neighbor_range",
          "old_text": null,
          "new_text": "hnsw.neighbor_range(i, 0, &begin, &end)",
          "old_line_content": "        uint8_t* code) const {",
          "new_line_content": "    hnsw.neighbor_range(i, 0, &begin, &end);",
          "content_same": false
        },
        {
          "line": 285,
          "old_api": null,
          "new_api": "train",
          "old_text": null,
          "new_text": "storage->train(n, x)",
          "old_line_content": "    int efSearch = hnsw.efSearch;",
          "new_line_content": "    storage->train(n, x);",
          "content_same": false
        },
        {
          "line": 804,
          "old_api": null,
          "new_api": "reconstruct",
          "old_text": null,
          "new_text": "index.storage->reconstruct(ji, tmp1 + (j - begin + 1) * d)",
          "old_line_content": "        int d0 = sq * dsub;",
          "new_line_content": "        index.storage->reconstruct(ji, tmp1 + (j - begin + 1) * d);",
          "content_same": false
        },
        {
          "line": 296,
          "old_api": null,
          "new_api": "FAISS_THROW_IF_NOT",
          "old_text": null,
          "new_text": "FAISS_THROW_IF_NOT(k > 0)",
          "old_line_content": "    for (idx_t i0 = 0; i0 < n; i0 += check_period) {",
          "new_line_content": "    FAISS_THROW_IF_NOT(k > 0);",
          "content_same": false
        },
        {
          "line": 815,
          "old_api": null,
          "new_api": "get",
          "old_text": null,
          "new_text": "tmp1.get()",
          "old_line_content": "                   &m1,",
          "new_line_content": "    float* tmp2 = tmp1.get() + d * (M + 1);",
          "content_same": false
        },
        {
          "line": 304,
          "old_api": null,
          "new_api": "dynamic_cast<const SearchParametersHNSW*>(params_in)",
          "old_text": null,
          "new_text": "dynamic_cast<const SearchParametersHNSW*>(params_in)",
          "old_line_content": "                    storage_distance_computer(storage));",
          "new_line_content": "        params = dynamic_cast<const SearchParametersHNSW*>(params_in);",
          "content_same": false
        },
        {
          "line": 305,
          "old_api": null,
          "new_api": "FAISS_THROW_IF_NOT_MSG",
          "old_text": null,
          "new_text": "FAISS_THROW_IF_NOT_MSG(params, \"params type invalid\")",
          "old_line_content": "",
          "new_line_content": "        FAISS_THROW_IF_NOT_MSG(params, \"params type invalid\");",
          "content_same": false
        },
        {
          "line": 818,
          "old_api": null,
          "new_api": "get",
          "old_text": null,
          "new_text": "tmp1.get()",
          "old_line_content": "                   &di,",
          "new_line_content": "    get_neighbor_table(i, tmp1.get());",
          "content_same": false
        },
        {
          "line": 311,
          "old_api": null,
          "new_api": "InterruptCallback::get_period_hint(hnsw.max_level * d * efSearch)",
          "old_text": null,
          "new_text": "InterruptCallback::get_period_hint(hnsw.max_level * d * efSearch)",
          "old_line_content": "",
          "new_line_content": "            InterruptCallback::get_period_hint(hnsw.max_level * d * efSearch);",
          "content_same": false
        },
        {
          "line": 314,
          "old_api": null,
          "new_api": "std::min(i0 + check_period, n)",
          "old_text": null,
          "new_text": "std::min(i0 + check_period, n)",
          "old_line_content": "                n1 += stats.n1;",
          "new_line_content": "        idx_t i1 = std::min(i0 + check_period, n);",
          "content_same": false
        },
        {
          "line": 828,
          "old_api": null,
          "new_api": "get",
          "old_text": null,
          "new_text": "sgemm_(\"N\",\n                   \"N\",\n                   &dsubi,\n                   &ki,\n                   &m1,\n                   &one,\n                   tmp1.get() + d0,\n                   &di,\n                   codebook.data() + sq * (m1 * k),\n                   &m1,\n                   &zero,\n                   tmp2,\n                   &dsubi)",
          "old_line_content": "        for (size_t j = 0; j < k; j++) {",
          "new_line_content": "            sgemm_(\"N\",",
          "content_same": false
        },
        {
          "line": 834,
          "old_api": null,
          "new_api": "get",
          "old_text": null,
          "new_text": "tmp1.get()",
          "old_line_content": "        }",
          "new_line_content": "                   tmp1.get() + d0,",
          "content_same": false
        },
        {
          "line": 836,
          "old_api": null,
          "new_api": "data",
          "old_text": null,
          "new_text": "codebook.data()",
          "old_line_content": "    }",
          "new_line_content": "                   codebook.data() + sq * (m1 * k),",
          "content_same": false
        },
        {
          "line": 329,
          "old_api": null,
          "new_api": "maxheap_heapify",
          "old_text": null,
          "new_text": "maxheap_heapify(k, simi, idxi)",
          "old_line_content": "",
          "new_line_content": "                maxheap_heapify(k, simi, idxi);",
          "content_same": false
        },
        {
          "line": 330,
          "old_api": null,
          "new_api": "search",
          "old_text": null,
          "new_text": "hnsw.search(*dis, k, idxi, simi, vt, params)",
          "old_line_content": "                    // sort top k_reorder",
          "new_line_content": "                HNSWStats stats = hnsw.search(*dis, k, idxi, simi, vt, params);",
          "content_same": false
        },
        {
          "line": 846,
          "old_api": null,
          "new_api": "fvec_L2sqr",
          "old_text": null,
          "new_text": "fvec_L2sqr(x + d0, tmp2 + j * dsub, dsub)",
          "old_line_content": "    for (int i = 0; i < n; i++) {",
          "new_line_content": "            float dis = fvec_L2sqr(x + d0, tmp2 + j * dsub, dsub);",
          "content_same": false
        },
        {
          "line": 336,
          "old_api": null,
          "new_api": "maxheap_reorder",
          "old_text": null,
          "new_text": "maxheap_reorder(k, simi, idxi)",
          "old_line_content": "        }",
          "new_line_content": "                maxheap_reorder(k, simi, idxi);",
          "content_same": false
        },
        {
          "line": 344,
          "old_api": null,
          "new_api": "compute_distances",
          "old_text": null,
          "new_text": "reconstruct_from_neighbors->compute_distances(\n                            k_reorder, idxi, x + i * d, simi)",
          "old_line_content": "        }",
          "new_line_content": "                    nreorder += reconstruct_from_neighbors->compute_distances(",
          "content_same": false
        },
        {
          "line": 348,
          "old_api": null,
          "new_api": "maxheap_heapify",
          "old_text": null,
          "new_text": "maxheap_heapify(\n                            k_reorder, simi, idxi, simi, idxi, k_reorder)",
          "old_line_content": "}",
          "new_line_content": "                    maxheap_heapify(",
          "content_same": false
        },
        {
          "line": 861,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "codes.size()",
          "old_line_content": "    is_trained = true;",
          "new_line_content": "    codes.resize(codes.size() + code_size * n);",
          "content_same": false
        },
        {
          "line": 350,
          "old_api": null,
          "new_api": "maxheap_reorder",
          "old_text": null,
          "new_text": "maxheap_reorder(k_reorder, simi, idxi)",
          "old_line_content": "void IndexHNSW::add(idx_t n, const float* x) {",
          "new_line_content": "                    maxheap_reorder(k_reorder, simi, idxi);",
          "content_same": false
        },
        {
          "line": 864,
          "old_api": null,
          "new_api": "data",
          "old_text": null,
          "new_text": "estimate_code(\n                x + i * index.d,\n                ntotal + i,\n                codes.data() + (ntotal + i) * code_size)",
          "old_line_content": "IndexHNSWFlat::IndexHNSWFlat(int d, int M, MetricType metric)",
          "new_line_content": "        estimate_code(",
          "content_same": false
        },
        {
          "line": 867,
          "old_api": null,
          "new_api": "data",
          "old_text": null,
          "new_text": "codes.data()",
          "old_line_content": "                                        : new IndexFlat(d, metric),",
          "new_line_content": "                codes.data() + (ntotal + i) * code_size);",
          "content_same": false
        },
        {
          "line": 357,
          "old_api": null,
          "new_api": "is_similarity_metric",
          "old_text": null,
          "new_text": "is_similarity_metric(metric_type)",
          "old_line_content": "    ntotal = storage->ntotal;",
          "new_line_content": "    if (is_similarity_metric(metric_type)) {",
          "content_same": false
        },
        {
          "line": 870,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "codes.size()",
          "old_line_content": "    is_trained = true;",
          "new_line_content": "    FAISS_ASSERT(codes.size() == ntotal * code_size);",
          "content_same": false
        },
        {
          "line": 368,
          "old_api": null,
          "new_api": "FAISS_THROW_IF_NOT_MSG",
          "old_text": null,
          "new_text": "FAISS_THROW_IF_NOT_MSG(\n            storage,\n            \"Please use IndexHNSWFlat (or variants) instead of IndexHNSW directly\")",
          "old_line_content": "void IndexHNSW::reconstruct(idx_t key, float* recons) const {",
          "new_line_content": "    FAISS_THROW_IF_NOT_MSG(",
          "content_same": false
        },
        {
          "line": 371,
          "old_api": null,
          "new_api": "FAISS_THROW_IF_NOT",
          "old_text": null,
          "new_text": "FAISS_THROW_IF_NOT(is_trained)",
          "old_line_content": "",
          "new_line_content": "    FAISS_THROW_IF_NOT(is_trained);",
          "content_same": false
        },
        {
          "line": 373,
          "old_api": null,
          "new_api": "add",
          "old_text": null,
          "new_text": "storage->add(n, x)",
          "old_line_content": "#pragma omp parallel",
          "new_line_content": "    storage->add(n, x);",
          "content_same": false
        },
        {
          "line": 376,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "hnsw.levels.size()",
          "old_line_content": "                storage_distance_computer(storage));",
          "new_line_content": "    hnsw_add_vertices(*this, n0, n, x, verbose, hnsw.levels.size() == ntotal);",
          "content_same": false
        },
        {
          "line": 380,
          "old_api": null,
          "new_api": "reset",
          "old_text": null,
          "new_text": "hnsw.reset()",
          "old_line_content": "            size_t begin, end;",
          "new_line_content": "    hnsw.reset();",
          "content_same": false
        },
        {
          "line": 386,
          "old_api": null,
          "new_api": "reconstruct",
          "old_text": null,
          "new_text": "storage->reconstruct(key, recons)",
          "old_line_content": "                int v1 = hnsw.neighbors[j];",
          "new_line_content": "    storage->reconstruct(key, recons);",
          "content_same": false
        },
        {
          "line": 903,
          "old_api": null,
          "new_api": "IndexHNSW::train(n, x)",
          "old_text": null,
          "new_text": "IndexHNSW::train(n, x)",
          "old_line_content": "",
          "new_line_content": "    IndexHNSW::train(n, x);",
          "content_same": false
        },
        {
          "line": 904,
          "old_api": null,
          "new_api": "compute_sdc_table",
          "old_text": null,
          "new_text": "dynamic_cast<IndexPQ*>(storage))->pq.compute_sdc_table()",
          "old_line_content": "IndexHNSWSQ::IndexHNSWSQ() = default;",
          "new_line_content": "    (dynamic_cast<IndexPQ*>(storage))->pq.compute_sdc_table();",
          "content_same": false
        },
        {
          "line": 398,
          "old_api": null,
          "new_api": "neighbor_range",
          "old_text": null,
          "new_text": "hnsw.neighbor_range(i, 0, &begin, &end)",
          "old_line_content": "            for (size_t j = begin; j < end; j++) {",
          "new_line_content": "            hnsw.neighbor_range(i, 0, &begin, &end);",
          "content_same": false
        },
        {
          "line": 406,
          "old_api": null,
          "new_api": "symmetric_dis",
          "old_text": null,
          "new_text": "dis->symmetric_dis(i, v1)",
          "old_line_content": "}",
          "new_line_content": "                initial_list.emplace(dis->symmetric_dis(i, v1), v1);",
          "content_same": false
        },
        {
          "line": 412,
          "old_api": null,
          "new_api": "HNSW::shrink_neighbor_list(\n                    *dis, initial_list, shrunk_list, new_size)",
          "old_text": null,
          "new_text": "HNSW::shrink_neighbor_list(\n                    *dis, initial_list, shrunk_list, new_size)",
          "old_line_content": "        const storage_idx_t* nearest,",
          "new_line_content": "            HNSW::shrink_neighbor_list(",
          "content_same": false
        },
        {
          "line": 416,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "shrunk_list.size()",
          "old_line_content": "        int nprobe,",
          "new_line_content": "                if (j - begin < shrunk_list.size())",
          "content_same": false
        },
        {
          "line": 957,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "candidates.size()",
          "old_line_content": "            if (v1 < 0)",
          "new_line_content": "    for (int i = 0; i < candidates.size(); i++) {",
          "content_same": false
        },
        {
          "line": 959,
          "old_api": null,
          "new_api": "FAISS_ASSERT",
          "old_text": null,
          "new_text": "FAISS_ASSERT(v1 >= 0)",
          "old_line_content": "            if (vt.visited[v1] == vt.visno + 1) {",
          "new_line_content": "        FAISS_ASSERT(v1 >= 0);",
          "content_same": false
        },
        {
          "line": 452,
          "old_api": null,
          "new_api": "set_query",
          "old_text": null,
          "new_text": "qdis->set_query(x + i * d)",
          "old_line_content": "        }",
          "new_line_content": "            qdis->set_query(x + i * d);",
          "content_same": false
        },
        {
          "line": 453,
          "old_api": null,
          "new_api": "maxheap_heapify",
          "old_text": null,
          "new_text": "maxheap_heapify(k, simi, idxi)",
          "old_line_content": "#pragma omp critical",
          "new_line_content": "            maxheap_heapify(k, simi, idxi);",
          "content_same": false
        },
        {
          "line": 965,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "candidates.size()",
          "old_line_content": "",
          "new_line_content": "    while (candidates.size() > 0) {",
          "content_same": false
        },
        {
          "line": 455,
          "old_api": null,
          "new_api": "search_level_0",
          "old_text": null,
          "new_text": "hnsw.search_level_0(\n                    *qdis.get(),\n                    k,\n                    idxi,\n                    simi,\n                    nprobe,\n                    nearest + i * nprobe,\n                    nearest_d + i * nprobe,\n                    search_type,\n                    search_stats,\n                    vt)",
          "old_line_content": "    }",
          "new_line_content": "            hnsw.search_level_0(",
          "content_same": false
        },
        {
          "line": 456,
          "old_api": null,
          "new_api": "get",
          "old_text": null,
          "new_text": "qdis.get()",
          "old_line_content": "}",
          "new_line_content": "                    *qdis.get(),",
          "content_same": false
        },
        {
          "line": 967,
          "old_api": null,
          "new_api": "pop_min",
          "old_text": null,
          "new_text": "candidates.pop_min(&d0)",
          "old_line_content": "                if (vt.visited[v1] < vt.visno) {",
          "new_line_content": "        int v0 = candidates.pop_min(&d0);",
          "content_same": false
        },
        {
          "line": 970,
          "old_api": null,
          "new_api": "neighbor_range",
          "old_text": null,
          "new_text": "hnsw.neighbor_range(v0, level, &begin, &end)",
          "old_line_content": "                    } else if (d < D[0]) {",
          "new_line_content": "        hnsw.neighbor_range(v0, level, &begin, &end);",
          "content_same": false
        },
        {
          "line": 467,
          "old_api": null,
          "new_api": "advance",
          "old_text": null,
          "new_text": "vt.advance()",
          "old_line_content": "        std::vector<float> vec(d);",
          "new_line_content": "            vt.advance();",
          "content_same": false
        },
        {
          "line": 980,
          "old_api": null,
          "new_api": "qdis",
          "old_text": null,
          "new_text": "qdis(v1)",
          "old_line_content": "            break;",
          "new_line_content": "                float d = qdis(v1);",
          "content_same": false
        },
        {
          "line": 981,
          "old_api": null,
          "new_api": "push",
          "old_text": null,
          "new_text": "candidates.push(v1, d)",
          "old_line_content": "        }",
          "new_line_content": "                candidates.push(v1, d);",
          "content_same": false
        },
        {
          "line": 471,
          "old_api": null,
          "new_api": "combine",
          "old_text": null,
          "new_text": "hnsw_stats.combine(search_stats)",
          "old_line_content": "        std::priority_queue<NodeDistFarther> initial_list;",
          "new_line_content": "        { hnsw_stats.combine(search_stats); }",
          "content_same": false
        },
        {
          "line": 986,
          "old_api": null,
          "new_api": "faiss::maxheap_push(++nres, D, I, d, v1)",
          "old_text": null,
          "new_text": "faiss::maxheap_push(++nres, D, I, d, v1)",
          "old_line_content": "        stats.n2++;",
          "new_line_content": "                        faiss::maxheap_push(++nres, D, I, d, v1);",
          "content_same": false
        },
        {
          "line": 988,
          "old_api": null,
          "new_api": "faiss::maxheap_replace_top(nres, D, I, d, v1)",
          "old_text": null,
          "new_text": "faiss::maxheap_replace_top(nres, D, I, d, v1)",
          "old_line_content": "    return nres;",
          "new_line_content": "                        faiss::maxheap_replace_top(nres, D, I, d, v1);",
          "content_same": false
        },
        {
          "line": 485,
          "old_api": null,
          "new_api": "data",
          "old_text": null,
          "new_text": "vec.data()",
          "old_line_content": "        size_t begin, end;",
          "new_line_content": "        storage->reconstruct(i, vec.data());",
          "content_same": false
        },
        {
          "line": 1002,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "candidates.size()",
          "old_line_content": "            !params, \"search params not supported for this index\");",
          "new_line_content": "    if (candidates.size() == 0)",
          "content_same": false
        },
        {
          "line": 496,
          "old_api": null,
          "new_api": "emplace",
          "old_text": null,
          "new_text": "initial_list.emplace(D[i * k + j], v1)",
          "old_line_content": "",
          "new_line_content": "            initial_list.emplace(D[i * k + j], v1);",
          "content_same": false
        },
        {
          "line": 500,
          "old_api": null,
          "new_api": "HNSW::shrink_neighbor_list(*qdis, initial_list, shrunk_list, dest_size)",
          "old_text": null,
          "new_text": "HNSW::shrink_neighbor_list(*qdis, initial_list, shrunk_list, dest_size)",
          "old_line_content": "        const storage_idx_t* nearests) {",
          "new_line_content": "        HNSW::shrink_neighbor_list(*qdis, initial_list, shrunk_list, dest_size);",
          "content_same": false
        },
        {
          "line": 1017,
          "old_api": null,
          "new_api": "FAISS_THROW_IF_NOT",
          "old_text": null,
          "new_text": "FAISS_THROW_IF_NOT(k > 0)",
          "old_line_content": "",
          "new_line_content": "    FAISS_THROW_IF_NOT(k > 0);",
          "content_same": false
        },
        {
          "line": 506,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "shrunk_list.size()",
          "old_line_content": "    {",
          "new_line_content": "            if (j - begin < shrunk_list.size())",
          "content_same": false
        },
        {
          "line": 1022,
          "old_api": null,
          "new_api": "IndexHNSW::search(n, x, k, distances, labels)",
          "old_text": null,
          "new_text": "IndexHNSW::search(n, x, k, distances, labels)",
          "old_line_content": "                n,",
          "new_line_content": "        IndexHNSW::search(n, x, k, distances, labels);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 1025,
          "old_api": "get",
          "new_api": null,
          "old_text": "coarse_assign.get()",
          "new_text": null,
          "old_line_content": "                coarse_assign.get(),",
          "new_line_content": "        size_t n1 = 0, n2 = 0, n3 = 0, ndis = 0, nreorder = 0;",
          "content_same": false
        },
        {
          "line": 1026,
          "old_api": "get",
          "new_api": null,
          "old_text": "coarse_dis.get()",
          "new_text": null,
          "old_line_content": "                coarse_dis.get(),",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 517,
          "old_api": "data",
          "new_api": null,
          "old_text": "vec.data()",
          "new_text": null,
          "old_line_content": "            storage->reconstruct(pt_id, vec.data());",
          "new_line_content": "        const storage_idx_t* nearests) {",
          "content_same": false
        },
        {
          "line": 518,
          "old_api": "data",
          "new_api": null,
          "old_text": "vec.data()",
          "new_text": null,
          "old_line_content": "            dis->set_query(vec.data());",
          "new_line_content": "    std::vector<omp_lock_t> locks(ntotal);",
          "content_same": false
        },
        {
          "line": 521,
          "old_api": "data",
          "new_api": null,
          "old_text": "locks.data()",
          "new_text": null,
          "old_line_content": "                    *dis, pt_id, nearest, (*dis)(nearest), 0, locks.data(), vt);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 524,
          "old_api": "printf",
          "new_api": null,
          "old_text": "printf(\"  %d / %d\\r\", i, n)",
          "new_text": null,
          "old_line_content": "                printf(\"  %d / %d\\r\", i, n);",
          "new_line_content": "        VisitedTable vt(ntotal);",
          "content_same": false
        },
        {
          "line": 525,
          "old_api": "fflush",
          "new_api": null,
          "old_text": "fflush(stdout)",
          "new_text": null,
          "old_line_content": "                fflush(stdout);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 530,
          "old_api": "printf",
          "new_api": null,
          "old_text": "printf(\"\\n\")",
          "new_text": null,
          "old_line_content": "        printf(\"\\n\");",
          "new_line_content": "#pragma omp for schedule(dynamic)",
          "content_same": false
        },
        {
          "line": 1044,
          "old_api": "set_query",
          "new_api": null,
          "old_text": "dis->set_query(x + i * d)",
          "new_text": null,
          "old_line_content": "                dis->set_query(x + i * d);",
          "new_line_content": "                distances,",
          "content_same": false
        },
        {
          "line": 1052,
          "old_api": "get_list_size",
          "new_api": null,
          "old_text": "index_ivfpq->get_list_size(key)",
          "new_text": null,
          "old_line_content": "                    size_t list_length = index_ivfpq->get_list_size(key);",
          "new_line_content": "                    storage_distance_computer(storage));",
          "content_same": false
        },
        {
          "line": 1053,
          "old_api": "get_ids",
          "new_api": null,
          "old_text": "index_ivfpq->invlists->get_ids(key)",
          "new_text": null,
          "old_line_content": "                    const idx_t* ids = index_ivfpq->invlists->get_ids(key);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1056,
          "old_api": "set",
          "new_api": null,
          "old_text": "vt.set(ids[jj])",
          "new_text": null,
          "old_line_content": "                        vt.set(ids[jj]);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1060,
          "old_api": "clear",
          "new_api": null,
          "old_text": "candidates.clear()",
          "new_text": null,
          "old_line_content": "                candidates.clear();",
          "new_line_content": "                float* simi = distances + i * k;",
          "content_same": false
        },
        {
          "line": 1065,
          "old_api": "push",
          "new_api": null,
          "old_text": "candidates.push(idxi[j], simi[j])",
          "new_text": null,
          "old_line_content": "                    candidates.push(idxi[j], simi[j]);",
          "new_line_content": "                for (int j = 0; j < nprobe; j++) {",
          "content_same": false
        },
        {
          "line": 559,
          "old_api": "symmetric_dis",
          "new_api": null,
          "old_text": "dis->symmetric_dis(i, nj)",
          "new_text": null,
          "old_line_content": "                distances[j - begin] = dis->symmetric_dis(i, nj);",
          "new_line_content": "        std::vector<float> distances(M);",
          "content_same": false
        },
        {
          "line": 1072,
          "old_api": "search_from_candidates_2",
          "new_api": null,
          "old_text": "search_from_candidates_2(\n                        hnsw,\n                        *dis,\n                        k,\n                        idxi,\n                        simi,\n                        candidates,\n                        vt,\n                        search_stats,\n                        0,\n                        k)",
          "new_text": null,
          "old_line_content": "                search_from_candidates_2(",
          "new_line_content": "                    for (int jj = 0; jj < list_length; jj++) {",
          "content_same": false
        },
        {
          "line": 563,
          "old_api": "data",
          "new_api": null,
          "old_text": "order.data()",
          "new_text": null,
          "old_line_content": "            fvec_argsort(end - begin, distances.data(), order.data());",
          "new_line_content": "                storage_distance_computer(storage));",
          "content_same": false
        },
        {
          "line": 572,
          "old_api": "printf",
          "new_api": null,
          "old_text": "printf(\"search for singletons\\n\")",
          "new_text": null,
          "old_line_content": "    printf(\"search for singletons\\n\");",
          "new_line_content": "                if (nj < 0) {",
          "content_same": false
        },
        {
          "line": 578,
          "old_api": "neighbor_range",
          "new_api": null,
          "old_text": "hnsw.neighbor_range(i, 0, &begin, &end)",
          "new_text": null,
          "old_line_content": "        hnsw.neighbor_range(i, 0, &begin, &end);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 1090,
          "old_api": "advance",
          "new_api": null,
          "old_text": "vt.advance()",
          "new_text": null,
          "old_line_content": "                vt.advance();",
          "new_line_content": "                        hnsw,",
          "content_same": false
        },
        {
          "line": 1092,
          "old_api": "maxheap_reorder",
          "new_api": null,
          "old_text": "maxheap_reorder(k, simi, idxi)",
          "new_text": null,
          "old_line_content": "                maxheap_reorder(k, simi, idxi);",
          "new_line_content": "                        k,",
          "content_same": false
        },
        {
          "line": 1096,
          "old_api": "combine",
          "new_api": null,
          "old_text": "hnsw_stats.combine({n1, n2, n3, ndis, nreorder})",
          "new_text": null,
          "old_line_content": "        hnsw_stats.combine({n1, n2, n3, ndis, nreorder});",
          "new_line_content": "                        vt,",
          "content_same": false
        },
        {
          "line": 1101,
          "old_api": "dynamic_cast<Index2Layer*>(storage)",
          "new_api": null,
          "old_text": "dynamic_cast<Index2Layer*>(storage)",
          "new_text": null,
          "old_line_content": "    Index2Layer* storage2l = dynamic_cast<Index2Layer*>(storage);",
          "new_line_content": "                n2 += search_stats.n2;",
          "content_same": false
        },
        {
          "line": 590,
          "old_api": "push_back",
          "new_api": null,
          "old_text": "singletons.push_back(i)",
          "new_text": null,
          "old_line_content": "            singletons.push_back(i);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1103,
          "old_api": "FAISS_THROW_IF_NOT",
          "new_api": null,
          "old_text": "FAISS_THROW_IF_NOT(storage2l)",
          "new_text": null,
          "old_line_content": "    FAISS_THROW_IF_NOT(storage2l);",
          "new_line_content": "                ndis += search_stats.ndis;",
          "content_same": false
        },
        {
          "line": 597,
          "old_api": "printf",
          "new_api": null,
          "old_text": "printf(\"  Found %d / %\" PRId64 \" singletons (%d appear in a level above)\\n\",\n           n_sing,\n           ntotal,\n           n_sing_l1)",
          "new_text": null,
          "old_line_content": "    printf(\"  Found %d / %\" PRId64 \" singletons (%d appear in a level above)\\n\",",
          "new_line_content": "            storage_idx_t ni = hnsw.neighbors[j];",
          "content_same": false
        },
        {
          "line": 602,
          "old_api": "size",
          "new_api": null,
          "old_text": "singletons.size()",
          "new_text": null,
          "old_line_content": "    std::vector<float> recons(singletons.size() * d);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 603,
          "old_api": "size",
          "new_api": null,
          "old_text": "singletons.size()",
          "new_text": null,
          "old_line_content": "    for (int i = 0; i < singletons.size(); i++) {",
          "new_line_content": "    int n_sing = 0, n_sing_l1 = 0;",
          "content_same": false
        },
        {
          "line": 92,
          "old_api": "symmetric_dis",
          "new_api": null,
          "old_text": "basedis->symmetric_dis(i, j)",
          "new_text": null,
          "old_line_content": "        return -basedis->symmetric_dis(i, j);",
          "new_line_content": "            const idx_t idx1,",
          "content_same": false
        },
        {
          "line": 604,
          "old_api": "FAISS_ASSERT",
          "new_api": null,
          "old_text": "FAISS_ASSERT(!\"not implemented\")",
          "new_text": null,
          "old_line_content": "        FAISS_ASSERT(!\"not implemented\");",
          "new_line_content": "    std::vector<storage_idx_t> singletons;",
          "content_same": false
        },
        {
          "line": 1115,
          "old_api": "transfer_to_IVFPQ",
          "new_api": null,
          "old_text": "storage2l->transfer_to_IVFPQ(*index_ivfpq)",
          "new_text": null,
          "old_line_content": "    storage2l->transfer_to_IVFPQ(*index_ivfpq);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 1116,
          "old_api": "make_direct_map",
          "new_api": null,
          "old_text": "index_ivfpq->make_direct_map(true)",
          "new_text": null,
          "old_line_content": "    index_ivfpq->make_direct_map(true);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 609,
          "old_api": "dynamic_cast<IndexFlatCodes*>(storage)",
          "new_api": null,
          "old_text": "dynamic_cast<IndexFlatCodes*>(storage)",
          "new_text": null,
          "old_line_content": "    auto flat_storage = dynamic_cast<IndexFlatCodes*>(storage);",
          "new_line_content": "            if (hnsw.levels[i] > 1)",
          "content_same": false
        },
        {
          "line": 610,
          "old_api": "FAISS_THROW_IF_NOT_MSG",
          "new_api": null,
          "old_text": "FAISS_THROW_IF_NOT_MSG(\n            flat_storage, \"don't know how to permute this index\")",
          "new_text": null,
          "old_line_content": "    FAISS_THROW_IF_NOT_MSG(",
          "new_line_content": "                n_sing_l1++;",
          "content_same": false
        },
        {
          "line": 612,
          "old_api": "permute_entries",
          "new_api": null,
          "old_text": "flat_storage->permute_entries(perm)",
          "new_text": null,
          "old_line_content": "    flat_storage->permute_entries(perm);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 101,
          "old_api": "is_similarity_metric",
          "new_api": null,
          "old_text": "is_similarity_metric(storage->metric_type)",
          "new_text": null,
          "old_line_content": "    if (is_similarity_metric(storage->metric_type)) {",
          "new_line_content": "        dis0 = -dis0;",
          "content_same": false
        },
        {
          "line": 102,
          "old_api": "get_distance_computer",
          "new_api": null,
          "old_text": "storage->get_distance_computer()",
          "new_text": null,
          "old_line_content": "        return new NegativeDistanceComputer(storage->get_distance_computer());",
          "new_line_content": "        dis1 = -dis1;",
          "content_same": false
        },
        {
          "line": 613,
          "old_api": "permute_entries",
          "new_api": null,
          "old_text": "hnsw.permute_entries(perm)",
          "new_text": null,
          "old_line_content": "    hnsw.permute_entries(perm);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 104,
          "old_api": "get_distance_computer",
          "new_api": null,
          "old_text": "storage->get_distance_computer()",
          "new_text": null,
          "old_line_content": "        return storage->get_distance_computer();",
          "new_line_content": "        dis3 = -dis3;",
          "content_same": false
        },
        {
          "line": 625,
          "old_api": "nb_neighbors",
          "new_api": null,
          "old_text": "index.hnsw.nb_neighbors(0)",
          "new_text": null,
          "old_line_content": "    M = index.hnsw.nb_neighbors(0);",
          "new_line_content": "void IndexHNSW::permute_entries(const idx_t* perm) {",
          "content_same": false
        },
        {
          "line": 120,
          "old_api": "printf",
          "new_api": null,
          "old_text": "printf(\"hnsw_add_vertices: adding %zd elements on top of %zd \"\n               \"(preset_levels=%d)\\n\",\n               n,\n               n0,\n               int(preset_levels))",
          "new_text": null,
          "old_line_content": "        printf(\"hnsw_add_vertices: adding %zd elements on top of %zd \"",
          "new_line_content": "    } else {",
          "content_same": false
        },
        {
          "line": 641,
          "old_api": "neighbor_range",
          "new_api": null,
          "old_text": "hnsw.neighbor_range(i, 0, &begin, &end)",
          "new_text": null,
          "old_line_content": "    hnsw.neighbor_range(i, 0, &begin, &end);",
          "new_line_content": "        : index(index), k(k), nsq(nsq) {",
          "content_same": false
        },
        {
          "line": 131,
          "old_api": "prepare_level_tab",
          "new_api": null,
          "old_text": "hnsw.prepare_level_tab(n, preset_levels)",
          "new_text": null,
          "old_line_content": "    int max_level = hnsw.prepare_level_tab(n, preset_levels);",
          "new_line_content": "        bool preset_levels = false) {",
          "content_same": false
        },
        {
          "line": 134,
          "old_api": "printf",
          "new_api": null,
          "old_text": "printf(\"  max_level = %d\\n\", max_level)",
          "new_text": null,
          "old_line_content": "        printf(\"  max_level = %d\\n\", max_level);",
          "new_line_content": "    size_t ntotal = n0 + n;",
          "content_same": false
        },
        {
          "line": 646,
          "old_api": "data",
          "new_api": null,
          "old_text": "codebook.data()",
          "new_text": null,
          "old_line_content": "            beta = codebook.data();",
          "new_line_content": "    d = index.d;",
          "content_same": false
        },
        {
          "line": 649,
          "old_api": "data",
          "new_api": null,
          "old_text": "codebook.data()",
          "new_text": null,
          "old_line_content": "            beta = codebook.data() + idx * (M + 1);",
          "new_line_content": "    k_reorder = -1;",
          "content_same": false
        },
        {
          "line": 139,
          "old_api": "omp_init_lock",
          "new_api": null,
          "old_text": "omp_init_lock(&locks[i])",
          "new_text": null,
          "old_line_content": "        omp_init_lock(&locks[i]);",
          "new_line_content": "               n,",
          "content_same": false
        },
        {
          "line": 653,
          "old_api": "reconstruct",
          "new_api": null,
          "old_text": "index.storage->reconstruct(i, tmp)",
          "new_text": null,
          "old_line_content": "        index.storage->reconstruct(i, tmp);",
          "new_line_content": "        storage_idx_t i,",
          "content_same": false
        },
        {
          "line": 152,
          "old_api": "push_back",
          "new_api": null,
          "old_text": "hist.push_back(0)",
          "new_text": null,
          "old_line_content": "                hist.push_back(0);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 157,
          "old_api": "size",
          "new_api": null,
          "old_text": "hist.size()",
          "new_text": null,
          "old_line_content": "        std::vector<int> offsets(hist.size() + 1, 0);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 158,
          "old_api": "size",
          "new_api": null,
          "old_text": "hist.size()",
          "new_text": null,
          "old_line_content": "        for (int i = 0; i < hist.size() - 1; i++) {",
          "new_line_content": "    // add vectors from highest to lowest level",
          "content_same": false
        },
        {
          "line": 671,
          "old_api": "data",
          "new_api": null,
          "old_text": "codebook.data()",
          "new_text": null,
          "old_line_content": "        const float* beta0 = codebook.data() + idx0 * (M + 1);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 672,
          "old_api": "data",
          "new_api": null,
          "old_text": "codebook.data()",
          "new_text": null,
          "old_line_content": "        const float* beta1 = codebook.data() + (idx1 + k) * (M + 1);",
          "new_line_content": "        for (int l = 0; l < d; l++)",
          "content_same": false
        },
        {
          "line": 674,
          "old_api": "reconstruct",
          "new_api": null,
          "old_text": "index.storage->reconstruct(i, tmp)",
          "new_text": null,
          "old_line_content": "        index.storage->reconstruct(i, tmp);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 170,
          "old_api": "InterruptCallback::get_period_hint(\n            max_level * index_hnsw.d * hnsw.efConstruction)",
          "new_api": null,
          "old_text": "InterruptCallback::get_period_hint(\n            max_level * index_hnsw.d * hnsw.efConstruction)",
          "new_text": null,
          "old_line_content": "    idx_t check_period = InterruptCallback::get_period_hint(",
          "new_line_content": "            hist[pt_level]++;",
          "content_same": false
        },
        {
          "line": 178,
          "old_api": "size",
          "new_api": null,
          "old_text": "hist.size()",
          "new_text": null,
          "old_line_content": "        for (int pt_level = hist.size() - 1; pt_level >= 0; pt_level--) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 690,
          "old_api": "reconstruct",
          "new_api": null,
          "old_text": "index.storage->reconstruct(ji, tmp)",
          "new_text": null,
          "old_line_content": "            index.storage->reconstruct(ji, tmp);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 182,
          "old_api": "printf",
          "new_api": null,
          "old_text": "printf(\"Adding %d elements at level %d\\n\", i1 - i0, pt_level)",
          "new_text": null,
          "old_line_content": "                printf(\"Adding %d elements at level %d\\n\", i1 - i0, pt_level);",
          "new_line_content": "            int pt_level = hnsw.levels[pt_id] - 1;",
          "content_same": false
        },
        {
          "line": 703,
          "old_api": "data",
          "new_api": null,
          "old_text": "codebook.data()",
          "new_text": null,
          "old_line_content": "            const float* b = codebook.data();",
          "new_line_content": "        for (size_t j = begin; j < end; j++) {",
          "content_same": false
        },
        {
          "line": 196,
          "old_api": "storage_distance_computer",
          "new_api": null,
          "old_text": "storage_distance_computer(index_hnsw.storage)",
          "new_text": null,
          "old_line_content": "                        storage_distance_computer(index_hnsw.storage));",
          "new_line_content": "            int i0 = i1 - hist[pt_level];",
          "content_same": false
        },
        {
          "line": 198,
          "old_api": "omp_get_thread_num",
          "new_api": null,
          "old_text": "omp_get_thread_num()",
          "new_text": null,
          "old_line_content": "                        verbose && omp_get_thread_num() == 0 ? 0 : -1;",
          "new_line_content": "            if (verbose) {",
          "content_same": false
        },
        {
          "line": 711,
          "old_api": "reconstruct",
          "new_api": null,
          "old_text": "index.storage->reconstruct(i, tmp)",
          "new_text": null,
          "old_line_content": "        index.storage->reconstruct(i, tmp);",
          "new_line_content": "                x[l] += w * tmp[l];",
          "content_same": false
        },
        {
          "line": 207,
          "old_api": "set_query",
          "new_api": null,
          "old_text": "dis->set_query(x + (pt_id - n0) * d)",
          "new_text": null,
          "old_line_content": "                    dis->set_query(x + (pt_id - n0) * d);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 214,
          "old_api": "add_with_locks",
          "new_api": null,
          "old_text": "hnsw.add_with_locks(*dis, pt_level, pt_id, locks, vt)",
          "new_text": null,
          "old_line_content": "                    hnsw.add_with_locks(*dis, pt_level, pt_id, locks, vt);",
          "new_line_content": "                int prev_display =",
          "content_same": false
        },
        {
          "line": 729,
          "old_api": "reconstruct",
          "new_api": null,
          "old_text": "index.storage->reconstruct(ji, tmp)",
          "new_text": null,
          "old_line_content": "            index.storage->reconstruct(ji, tmp);",
          "new_line_content": "        {",
          "content_same": false
        },
        {
          "line": 218,
          "old_api": "printf",
          "new_api": null,
          "old_text": "printf(\"  %d / %d\\r\", i - i0, i1 - i0)",
          "new_text": null,
          "old_line_content": "                        printf(\"  %d / %d\\r\", i - i0, i1 - i0);",
          "new_line_content": "                // here we should do schedule(dynamic) but this segfaults for",
          "content_same": false
        },
        {
          "line": 219,
          "old_api": "fflush",
          "new_api": null,
          "old_text": "fflush(stdout)",
          "new_text": null,
          "old_line_content": "                        fflush(stdout);",
          "new_line_content": "                // some versions of LLVM. The performance impact should not be",
          "content_same": false
        },
        {
          "line": 222,
          "old_api": "InterruptCallback::is_interrupted()",
          "new_api": null,
          "old_text": "InterruptCallback::is_interrupted()",
          "new_text": null,
          "old_line_content": "                        if (InterruptCallback::is_interrupted()) {",
          "new_line_content": "                for (int i = i0; i < i1; i++) {",
          "content_same": false
        },
        {
          "line": 230,
          "old_api": "FAISS_THROW_MSG",
          "new_api": null,
          "old_text": "FAISS_THROW_MSG(\"computation interrupted\")",
          "new_text": null,
          "old_line_content": "                FAISS_THROW_MSG(\"computation interrupted\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 234,
          "old_api": "FAISS_ASSERT",
          "new_api": null,
          "old_text": "FAISS_ASSERT(i1 == 0)",
          "new_text": null,
          "old_line_content": "        FAISS_ASSERT(i1 == 0);",
          "new_line_content": "                        prev_display = i - i0;",
          "content_same": false
        },
        {
          "line": 237,
          "old_api": "getmillisecs",
          "new_api": null,
          "old_text": "getmillisecs()",
          "new_text": null,
          "old_line_content": "        printf(\"Done in %.3f ms\\n\", getmillisecs() - t0);",
          "new_line_content": "                    }",
          "content_same": false
        },
        {
          "line": 752,
          "old_api": "data",
          "new_api": null,
          "old_text": "tmp.data()",
          "new_text": null,
          "old_line_content": "            reconstruct(n0 + i, x + i * index.d, tmp.data());",
          "new_line_content": "                    x[l] += w * tmp[l];",
          "content_same": false
        },
        {
          "line": 241,
          "old_api": "omp_destroy_lock",
          "new_api": null,
          "old_text": "omp_destroy_lock(&locks[i])",
          "new_text": null,
          "old_line_content": "        omp_destroy_lock(&locks[i]);",
          "new_line_content": "                        }",
          "content_same": false
        },
        {
          "line": 767,
          "old_api": "data",
          "new_api": null,
          "old_text": "tmp.data()",
          "new_text": null,
          "old_line_content": "        reconstruct(shortlist[i], tmp.data(), tmp.data() + index.d);",
          "new_line_content": "#pragma omp for",
          "content_same": false
        },
        {
          "line": 768,
          "old_api": "data",
          "new_api": null,
          "old_text": "tmp.data()",
          "new_text": null,
          "old_line_content": "        distances[i] = fvec_L2sqr(query, tmp.data(), index.d);",
          "new_line_content": "        for (storage_idx_t i = 0; i < ni; i++) {",
          "content_same": false
        },
        {
          "line": 264,
          "old_api": "FAISS_THROW_IF_NOT_MSG",
          "new_api": null,
          "old_text": "FAISS_THROW_IF_NOT_MSG(\n            storage,\n            \"Please use IndexHNSWFlat (or variants) instead of IndexHNSW directly\")",
          "new_text": null,
          "old_line_content": "    FAISS_THROW_IF_NOT_MSG(",
          "new_line_content": "/**************************************************************",
          "content_same": false
        },
        {
          "line": 778,
          "old_api": "neighbor_range",
          "new_api": null,
          "old_text": "hnsw.neighbor_range(i, 0, &begin, &end)",
          "new_text": null,
          "old_line_content": "    hnsw.neighbor_range(i, 0, &begin, &end);",
          "new_line_content": "        float* distances) const {",
          "content_same": false
        },
        {
          "line": 268,
          "old_api": "train",
          "new_api": null,
          "old_text": "storage->train(n, x)",
          "new_text": null,
          "old_line_content": "    storage->train(n, x);",
          "new_line_content": "IndexHNSW::IndexHNSW(int d, int M, MetricType metric)",
          "content_same": false
        },
        {
          "line": 781,
          "old_api": "reconstruct",
          "new_api": null,
          "old_text": "index.storage->reconstruct(i, tmp1)",
          "new_text": null,
          "old_line_content": "    index.storage->reconstruct(i, tmp1);",
          "new_line_content": "    for (int i = 0; i < n; i++) {",
          "content_same": false
        },
        {
          "line": 787,
          "old_api": "reconstruct",
          "new_api": null,
          "old_text": "index.storage->reconstruct(ji, tmp1 + (j - begin + 1) * d)",
          "new_text": null,
          "old_line_content": "        index.storage->reconstruct(ji, tmp1 + (j - begin + 1) * d);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 279,
          "old_api": "FAISS_THROW_IF_NOT",
          "new_api": null,
          "old_text": "FAISS_THROW_IF_NOT(k > 0)",
          "new_text": null,
          "old_line_content": "    FAISS_THROW_IF_NOT(k > 0);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 280,
          "old_api": "FAISS_THROW_IF_NOT_MSG",
          "new_api": null,
          "old_text": "FAISS_THROW_IF_NOT_MSG(\n            storage,\n            \"Please use IndexHNSWFlat (or variants) instead of IndexHNSW directly\")",
          "new_text": null,
          "old_line_content": "    FAISS_THROW_IF_NOT_MSG(",
          "new_line_content": "void IndexHNSW::train(idx_t n, const float* x) {",
          "content_same": false
        },
        {
          "line": 287,
          "old_api": "dynamic_cast<const SearchParametersHNSW*>(params_in)",
          "new_api": null,
          "old_text": "dynamic_cast<const SearchParametersHNSW*>(params_in)",
          "new_text": null,
          "old_line_content": "        params = dynamic_cast<const SearchParametersHNSW*>(params_in);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 288,
          "old_api": "FAISS_THROW_IF_NOT_MSG",
          "new_api": null,
          "old_text": "FAISS_THROW_IF_NOT_MSG(params, \"params type invalid\")",
          "new_text": null,
          "old_line_content": "        FAISS_THROW_IF_NOT_MSG(params, \"params type invalid\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 801,
          "old_api": "get",
          "new_api": null,
          "old_text": "tmp1.get()",
          "new_text": null,
          "old_line_content": "    get_neighbor_table(i, tmp1.get());",
          "new_line_content": "        storage_idx_t ji = hnsw.neighbors[j];",
          "content_same": false
        },
        {
          "line": 294,
          "old_api": "InterruptCallback::get_period_hint(hnsw.max_level * d * efSearch)",
          "new_api": null,
          "old_text": "InterruptCallback::get_period_hint(hnsw.max_level * d * efSearch)",
          "new_text": null,
          "old_line_content": "            InterruptCallback::get_period_hint(hnsw.max_level * d * efSearch);",
          "new_line_content": "        idx_t* labels,",
          "content_same": false
        },
        {
          "line": 811,
          "old_api": "get",
          "new_api": null,
          "old_text": "sgemm_(\"N\",\n                   \"N\",\n                   &dsubi,\n                   &ki,\n                   &m1,\n                   &one,\n                   tmp1.get() + d0,\n                   &di,\n                   codebook.data() + sq * (m1 * k),\n                   &m1,\n                   &zero,\n                   tmp2,\n                   &dsubi)",
          "new_text": null,
          "old_line_content": "            sgemm_(\"N\",",
          "new_line_content": "        storage_idx_t i,",
          "content_same": false
        },
        {
          "line": 817,
          "old_api": "get",
          "new_api": null,
          "old_text": "tmp1.get()",
          "new_text": null,
          "old_line_content": "                   tmp1.get() + d0,",
          "new_line_content": "    // collect coordinates of base",
          "content_same": false
        },
        {
          "line": 819,
          "old_api": "data",
          "new_api": null,
          "old_text": "codebook.data()",
          "new_text": null,
          "old_line_content": "                   codebook.data() + sq * (m1 * k),",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 310,
          "old_api": "set_query",
          "new_api": null,
          "old_text": "dis->set_query(x + i * d)",
          "new_text": null,
          "old_line_content": "                dis->set_query(x + i * d);",
          "new_line_content": "    idx_t check_period =",
          "content_same": false
        },
        {
          "line": 312,
          "old_api": "maxheap_heapify",
          "new_api": null,
          "old_text": "maxheap_heapify(k, simi, idxi)",
          "new_text": null,
          "old_line_content": "                maxheap_heapify(k, simi, idxi);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 313,
          "old_api": "search",
          "new_api": null,
          "old_text": "hnsw.search(*dis, k, idxi, simi, vt, params)",
          "new_text": null,
          "old_line_content": "                HNSWStats stats = hnsw.search(*dis, k, idxi, simi, vt, params);",
          "new_line_content": "    for (idx_t i0 = 0; i0 < n; i0 += check_period) {",
          "content_same": false
        },
        {
          "line": 829,
          "old_api": "fvec_L2sqr",
          "new_api": null,
          "old_text": "fvec_L2sqr(x + d0, tmp2 + j * dsub, dsub)",
          "new_text": null,
          "old_line_content": "            float dis = fvec_L2sqr(x + d0, tmp2 + j * dsub, dsub);",
          "new_line_content": "                   \"N\",",
          "content_same": false
        },
        {
          "line": 319,
          "old_api": "maxheap_reorder",
          "new_api": null,
          "old_text": "maxheap_reorder(k, simi, idxi)",
          "new_text": null,
          "old_line_content": "                maxheap_reorder(k, simi, idxi);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 331,
          "old_api": "maxheap_heapify",
          "new_api": null,
          "old_text": "maxheap_heapify(\n                            k_reorder, simi, idxi, simi, idxi, k_reorder)",
          "new_text": null,
          "old_line_content": "                    maxheap_heapify(",
          "new_line_content": "                n1 += stats.n1;",
          "content_same": false
        },
        {
          "line": 844,
          "old_api": "size",
          "new_api": null,
          "old_text": "codes.size()",
          "new_text": null,
          "old_line_content": "    codes.resize(codes.size() + code_size * n);",
          "new_line_content": "        int argmin = -1;",
          "content_same": false
        },
        {
          "line": 333,
          "old_api": "maxheap_reorder",
          "new_api": null,
          "old_text": "maxheap_reorder(k_reorder, simi, idxi)",
          "new_text": null,
          "old_line_content": "                    maxheap_reorder(k_reorder, simi, idxi);",
          "new_line_content": "                n3 += stats.n3;",
          "content_same": false
        },
        {
          "line": 847,
          "old_api": "data",
          "new_api": null,
          "old_text": "estimate_code(\n                x + i * index.d,\n                ntotal + i,\n                codes.data() + (ntotal + i) * code_size)",
          "new_text": null,
          "old_line_content": "        estimate_code(",
          "new_line_content": "            if (dis < min) {",
          "content_same": false
        },
        {
          "line": 337,
          "old_api": "InterruptCallback::check()",
          "new_api": null,
          "old_text": "InterruptCallback::check()",
          "new_text": null,
          "old_line_content": "        InterruptCallback::check();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 850,
          "old_api": "data",
          "new_api": null,
          "old_text": "codes.data()",
          "new_text": null,
          "old_line_content": "                codes.data() + (ntotal + i) * code_size);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 340,
          "old_api": "is_similarity_metric",
          "new_api": null,
          "old_text": "is_similarity_metric(metric_type)",
          "new_text": null,
          "old_line_content": "    if (is_similarity_metric(metric_type)) {",
          "new_line_content": "                    int k_reorder = reconstruct_from_neighbors->k_reorder;",
          "content_same": false
        },
        {
          "line": 853,
          "old_api": "size",
          "new_api": null,
          "old_text": "codes.size()",
          "new_text": null,
          "old_line_content": "    FAISS_ASSERT(codes.size() == ntotal * code_size);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 347,
          "old_api": "combine",
          "new_api": null,
          "old_text": "hnsw_stats.combine({n1, n2, n3, ndis, nreorder})",
          "new_text": null,
          "old_line_content": "    hnsw_stats.combine({n1, n2, n3, ndis, nreorder});",
          "new_line_content": "                    // sort top k_reorder",
          "content_same": false
        },
        {
          "line": 351,
          "old_api": "FAISS_THROW_IF_NOT_MSG",
          "new_api": null,
          "old_text": "FAISS_THROW_IF_NOT_MSG(\n            storage,\n            \"Please use IndexHNSWFlat (or variants) instead of IndexHNSW directly\")",
          "new_text": null,
          "old_line_content": "    FAISS_THROW_IF_NOT_MSG(",
          "new_line_content": "                }",
          "content_same": false
        },
        {
          "line": 356,
          "old_api": "add",
          "new_api": null,
          "old_text": "storage->add(n, x)",
          "new_text": null,
          "old_line_content": "    storage->add(n, x);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 359,
          "old_api": "size",
          "new_api": null,
          "old_text": "hnsw.levels.size()",
          "new_text": null,
          "old_line_content": "    hnsw_add_vertices(*this, n0, n, x, verbose, hnsw.levels.size() == ntotal);",
          "new_line_content": "        for (size_t i = 0; i < k * n; i++) {",
          "content_same": false
        },
        {
          "line": 363,
          "old_api": "reset",
          "new_api": null,
          "old_text": "hnsw.reset()",
          "new_text": null,
          "old_line_content": "    hnsw.reset();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 369,
          "old_api": "reconstruct",
          "new_api": null,
          "old_text": "storage->reconstruct(key, recons)",
          "new_text": null,
          "old_line_content": "    storage->reconstruct(key, recons);",
          "new_line_content": "            storage,",
          "content_same": false
        },
        {
          "line": 886,
          "old_api": "IndexHNSW::train(n, x)",
          "new_api": null,
          "old_text": "IndexHNSW::train(n, x)",
          "new_text": null,
          "old_line_content": "    IndexHNSW::train(n, x);",
          "new_line_content": "    own_fields = true;",
          "content_same": false
        },
        {
          "line": 887,
          "old_api": "compute_sdc_table",
          "new_api": null,
          "old_text": "dynamic_cast<IndexPQ*>(storage))->pq.compute_sdc_table()",
          "new_text": null,
          "old_line_content": "    (dynamic_cast<IndexPQ*>(storage))->pq.compute_sdc_table();",
          "new_line_content": "    is_trained = true;",
          "content_same": false
        },
        {
          "line": 389,
          "old_api": "symmetric_dis",
          "new_api": null,
          "old_text": "dis->symmetric_dis(i, v1)",
          "new_text": null,
          "old_line_content": "                initial_list.emplace(dis->symmetric_dis(i, v1), v1);",
          "new_line_content": "void IndexHNSW::shrink_level_0_neighbors(int new_size) {",
          "content_same": false
        },
        {
          "line": 395,
          "old_api": "HNSW::shrink_neighbor_list(\n                    *dis, initial_list, shrunk_list, new_size)",
          "new_api": null,
          "old_text": "HNSW::shrink_neighbor_list(\n                    *dis, initial_list, shrunk_list, new_size)",
          "new_text": null,
          "old_line_content": "            HNSW::shrink_neighbor_list(",
          "new_line_content": "#pragma omp for",
          "content_same": false
        },
        {
          "line": 399,
          "old_api": "size",
          "new_api": null,
          "old_text": "shrunk_list.size()",
          "new_text": null,
          "old_line_content": "                if (j - begin < shrunk_list.size())",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 418,
          "old_api": "FAISS_THROW_IF_NOT",
          "new_api": null,
          "old_text": "FAISS_THROW_IF_NOT(k > 0)",
          "new_text": null,
          "old_line_content": "    FAISS_THROW_IF_NOT(k > 0);",
          "new_line_content": "                else",
          "content_same": false
        },
        {
          "line": 419,
          "old_api": "FAISS_THROW_IF_NOT",
          "new_api": null,
          "old_text": "FAISS_THROW_IF_NOT(nprobe > 0)",
          "new_text": null,
          "old_line_content": "    FAISS_THROW_IF_NOT(nprobe > 0);",
          "new_line_content": "                    hnsw.neighbors[j] = -1;",
          "content_same": false
        },
        {
          "line": 421,
          "old_api": "size",
          "new_api": null,
          "old_text": "hnsw.levels.size()",
          "new_text": null,
          "old_line_content": "    storage_idx_t ntotal = hnsw.levels.size();",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 940,
          "old_api": "size",
          "new_api": null,
          "old_text": "candidates.size()",
          "new_text": null,
          "old_line_content": "    for (int i = 0; i < candidates.size(); i++) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 942,
          "old_api": "FAISS_ASSERT",
          "new_api": null,
          "old_text": "FAISS_ASSERT(v1 >= 0)",
          "new_text": null,
          "old_line_content": "        FAISS_ASSERT(v1 >= 0);",
          "new_line_content": "// visno -> is in result list",
          "content_same": false
        },
        {
          "line": 948,
          "old_api": "size",
          "new_api": null,
          "old_text": "candidates.size()",
          "new_text": null,
          "old_line_content": "    while (candidates.size() > 0) {",
          "new_line_content": "        idx_t* I,",
          "content_same": false
        },
        {
          "line": 950,
          "old_api": "pop_min",
          "new_api": null,
          "old_text": "candidates.pop_min(&d0)",
          "new_text": null,
          "old_line_content": "        int v0 = candidates.pop_min(&d0);",
          "new_line_content": "        MinimaxHeap& candidates,",
          "content_same": false
        },
        {
          "line": 439,
          "old_api": "get",
          "new_api": null,
          "old_text": "qdis.get()",
          "new_text": null,
          "old_line_content": "                    *qdis.get(),",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 953,
          "old_api": "neighbor_range",
          "new_api": null,
          "old_text": "hnsw.neighbor_range(v0, level, &begin, &end)",
          "new_text": null,
          "old_line_content": "        hnsw.neighbor_range(v0, level, &begin, &end);",
          "new_line_content": "        int level,",
          "content_same": false
        },
        {
          "line": 450,
          "old_api": "advance",
          "new_api": null,
          "old_text": "vt.advance()",
          "new_text": null,
          "old_line_content": "            vt.advance();",
          "new_line_content": "            float* simi = distances + i * k;",
          "content_same": false
        },
        {
          "line": 451,
          "old_api": "maxheap_reorder",
          "new_api": null,
          "old_text": "maxheap_reorder(k, simi, idxi)",
          "new_text": null,
          "old_line_content": "            maxheap_reorder(k, simi, idxi);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 963,
          "old_api": "qdis",
          "new_api": null,
          "old_text": "qdis(v1)",
          "new_text": null,
          "old_line_content": "                float d = qdis(v1);",
          "new_line_content": "    int nstep = 0;",
          "content_same": false
        },
        {
          "line": 964,
          "old_api": "push",
          "new_api": null,
          "old_text": "candidates.push(v1, d)",
          "new_text": null,
          "old_line_content": "                candidates.push(v1, d);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 454,
          "old_api": "combine",
          "new_api": null,
          "old_text": "hnsw_stats.combine(search_stats)",
          "new_text": null,
          "old_line_content": "        { hnsw_stats.combine(search_stats); }",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 969,
          "old_api": "faiss::maxheap_push(++nres, D, I, d, v1)",
          "new_api": null,
          "old_text": "faiss::maxheap_push(++nres, D, I, d, v1)",
          "new_text": null,
          "old_line_content": "                        faiss::maxheap_push(++nres, D, I, d, v1);",
          "new_line_content": "        size_t begin, end;",
          "content_same": false
        },
        {
          "line": 971,
          "old_api": "faiss::maxheap_replace_top(nres, D, I, d, v1)",
          "new_api": null,
          "old_text": "faiss::maxheap_replace_top(nres, D, I, d, v1)",
          "new_text": null,
          "old_line_content": "                        faiss::maxheap_replace_top(nres, D, I, d, v1);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 462,
          "old_api": "nb_neighbors",
          "new_api": null,
          "old_text": "hnsw.nb_neighbors(0)",
          "new_text": null,
          "old_line_content": "    int dest_size = hnsw.nb_neighbors(0);",
          "new_line_content": "                    nearest_d + i * nprobe,",
          "content_same": false
        },
        {
          "line": 466,
          "old_api": "storage_distance_computer",
          "new_api": null,
          "old_text": "storage_distance_computer(storage)",
          "new_text": null,
          "old_line_content": "        DistanceComputer* qdis = storage_distance_computer(storage);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 469,
          "old_api": "data",
          "new_api": null,
          "old_text": "vec.data()",
          "new_text": null,
          "old_line_content": "        qdis->set_query(vec.data());",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 985,
          "old_api": "size",
          "new_api": null,
          "old_text": "candidates.size()",
          "new_text": null,
          "old_line_content": "    if (candidates.size() == 0)",
          "new_line_content": "                    if (nres < k) {",
          "content_same": false
        },
        {
          "line": 1000,
          "old_api": "FAISS_THROW_IF_NOT",
          "new_api": null,
          "old_text": "FAISS_THROW_IF_NOT(k > 0)",
          "new_text": null,
          "old_line_content": "    FAISS_THROW_IF_NOT(k > 0);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 489,
          "old_api": "size",
          "new_api": null,
          "old_text": "shrunk_list.size()",
          "new_text": null,
          "old_line_content": "            if (j - begin < shrunk_list.size())",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1001,
          "old_api": "FAISS_THROW_IF_NOT_MSG",
          "new_api": null,
          "old_text": "FAISS_THROW_IF_NOT_MSG(\n            !params, \"search params not supported for this index\")",
          "new_text": null,
          "old_line_content": "    FAISS_THROW_IF_NOT_MSG(",
          "new_line_content": "    stats.n1++;",
          "content_same": false
        },
        {
          "line": 1004,
          "old_api": "dynamic_cast<const Index2Layer*>(storage)",
          "new_api": null,
          "old_text": "dynamic_cast<const Index2Layer*>(storage)",
          "new_text": null,
          "old_line_content": "    if (dynamic_cast<const Index2Layer*>(storage)) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1005,
          "old_api": "IndexHNSW::search(n, x, k, distances, labels)",
          "new_api": null,
          "old_text": "IndexHNSW::search(n, x, k, distances, labels)",
          "new_text": null,
          "old_line_content": "        IndexHNSW::search(n, x, k, distances, labels);",
          "new_line_content": "    return nres;",
          "content_same": false
        },
        {
          "line": 1011,
          "old_api": "dynamic_cast<const IndexIVFPQ*>(storage)",
          "new_api": null,
          "old_text": "dynamic_cast<const IndexIVFPQ*>(storage)",
          "new_text": null,
          "old_line_content": "                dynamic_cast<const IndexIVFPQ*>(storage);",
          "new_line_content": "        idx_t n,",
          "content_same": false
        },
        {
          "line": 1019,
          "old_api": "get",
          "new_api": null,
          "old_text": "coarse_assign.get()",
          "new_text": null,
          "old_line_content": "                n, x, nprobe, coarse_dis.get(), coarse_assign.get());",
          "new_line_content": "            !params, \"search params not supported for this index\");",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 29,
      "total_additions": 141,
      "total_deletions": 140,
      "total_api_changes": 310
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 17,
        "api_related_lines": 310,
        "non_api_lines": 12,
        "non_api_line_numbers": [
          96,
          97,
          98,
          100,
          103,
          105,
          106,
          90,
          91,
          93,
          94,
          95
        ]
      }
    },
    "api_calls_before": 192,
    "api_calls_after": 193,
    "diff_info": {
      "added_lines": 17,
      "removed_lines": 0,
      "total_diff_lines": 29
    }
  }
}