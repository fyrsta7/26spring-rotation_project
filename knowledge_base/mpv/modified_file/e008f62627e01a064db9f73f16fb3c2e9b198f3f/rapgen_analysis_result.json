{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/e008f62627e01a064db9f73f16fb3c2e9b198f3f",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/e008f62627e01a064db9f73f16fb3c2e9b198f3f/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/e008f62627e01a064db9f73f16fb3c2e9b198f3f/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/e008f62627e01a064db9f73f16fb3c2e9b198f3f/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 218,
          "old_api": "malloc",
          "new_api": "memcpy",
          "old_text": "malloc(2 * this->stride * this->height)",
          "new_text": "memcpy(aimage, this->aimage + this->stride * first_y, this->image_size)",
          "old_line_content": "  image = malloc(2 * this->stride * this->height);",
          "new_line_content": "    memcpy(aimage, this->aimage + this->stride * first_y, this->image_size);",
          "content_same": false
        },
        {
          "line": 223,
          "old_api": "memcpy",
          "new_api": "mp_msg",
          "old_text": "memcpy(aimage, this->aimage + this->stride * first_y, this->image_size)",
          "new_text": "mp_msg(MSGT_SPUDEC, MSGL_FATAL, \"Fatal: update_spu: malloc requested %d bytes\\n\", 2 * this->stride * this->height)",
          "old_line_content": "    memcpy(aimage, this->aimage + this->stride * first_y, this->image_size);",
          "new_line_content": "    mp_msg(MSGT_SPUDEC, MSGL_FATAL, \"Fatal: update_spu: malloc requested %d bytes\\n\", 2 * this->stride * this->height);",
          "content_same": false
        },
        {
          "line": 315,
          "old_api": "next_line",
          "new_api": "spudec_cut_image",
          "old_text": "next_line(packet)",
          "new_text": "spudec_cut_image(this)",
          "old_line_content": "      next_line(packet);",
          "new_line_content": "  spudec_cut_image(this);",
          "content_same": false
        },
        {
          "line": 384,
          "old_api": "get_be16",
          "new_api": "mp_msg",
          "old_text": "get_be16(this->packet + start_off)",
          "new_text": "mp_msg(MSGT_SPUDEC,MSGL_DBG2, \"cmd=%d  \",type)",
          "old_line_content": "    date = get_be16(this->packet + start_off) * 1024;",
          "new_line_content": "      mp_msg(MSGT_SPUDEC,MSGL_DBG2, \"cmd=%d  \",type);",
          "content_same": false
        },
        {
          "line": 537,
          "old_api": "get_be16",
          "new_api": "malloc",
          "old_text": "get_be16(packet)",
          "new_text": "malloc(len2)",
          "old_line_content": "    unsigned int len2 = get_be16(packet);",
          "new_line_content": "      spu->packet = malloc(len2);",
          "content_same": false
        },
        {
          "line": 574,
          "old_api": "get_be16",
          "new_api": "spudec_decode",
          "old_text": "get_be16(spu->packet+x+2)",
          "new_text": "spudec_decode(spu, pts100)",
          "old_line_content": "      y=get_be16(spu->packet+x+2); // next control pointer",
          "new_line_content": "\tspudec_decode(spu, pts100);",
          "content_same": false
        },
        {
          "line": 579,
          "old_api": "spudec_decode",
          "new_api": "mp_msg",
          "old_text": "spudec_decode(spu, pts100)",
          "new_text": "mp_msg(MSGT_SPUDEC,MSGL_WARN,\"SPUtest: broken packet!!!!! y=%d < x=%d\\n\",y,x)",
          "old_line_content": "\tspudec_decode(spu, pts100);",
          "new_line_content": "\tmp_msg(MSGT_SPUDEC,MSGL_WARN,\"SPUtest: broken packet!!!!! y=%d < x=%d\\n\",y,x);",
          "content_same": false
        },
        {
          "line": 617,
          "old_api": "spudec_dequeue_packet",
          "new_api": "spudec_process_data",
          "old_text": "spudec_dequeue_packet(spu)",
          "new_text": "spudec_process_data(spu, packet)",
          "old_line_content": "    packet_t *packet = spudec_dequeue_packet(spu);",
          "new_line_content": "    spudec_process_data(spu, packet);",
          "content_same": false
        },
        {
          "line": 776,
          "old_api": "sws_normalizeVec",
          "new_api": "sws_getContext",
          "old_text": "sws_normalizeVec(filter.lumH, 1.0)",
          "new_text": "sws_getContext(sw, sh, PIX_FMT_GRAY8, dw, dh, PIX_FMT_GRAY8, SWS_GAUSS, &filter, NULL, NULL)",
          "old_line_content": "\t\tsws_normalizeVec(filter.lumH, 1.0);",
          "new_line_content": "\tctx=sws_getContext(sw, sh, PIX_FMT_GRAY8, dw, dh, PIX_FMT_GRAY8, SWS_GAUSS, &filter, NULL, NULL);",
          "content_same": false
        },
        {
          "line": 781,
          "old_api": "sws_getContext",
          "new_api": "sws_freeContext",
          "old_text": "sws_getContext(sw, sh, PIX_FMT_GRAY8, dw, dh, PIX_FMT_GRAY8, SWS_GAUSS, &filter, NULL, NULL)",
          "new_text": "sws_freeContext(ctx)",
          "old_line_content": "\tctx=sws_getContext(sw, sh, PIX_FMT_GRAY8, dw, dh, PIX_FMT_GRAY8, SWS_GAUSS, &filter, NULL, NULL);",
          "new_line_content": "\tsws_freeContext(ctx);",
          "content_same": false
        },
        {
          "line": 842,
          "old_api": "sws_spu_image",
          "new_api": "calloc",
          "old_text": "sws_spu_image(spu->scaled_image, spu->scaled_aimage,\n\t\t  spu->scaled_width, spu->scaled_height, spu->scaled_stride,\n\t\t  spu->image, spu->aimage, spu->width, spu->height, spu->stride)",
          "new_text": "calloc(spu->scaled_width, sizeof(scale_pixel))",
          "old_line_content": "\t  sws_spu_image(spu->scaled_image, spu->scaled_aimage,",
          "new_line_content": "\t  table_x = calloc(spu->scaled_width, sizeof(scale_pixel));",
          "content_same": false
        },
        {
          "line": 847,
          "old_api": "calloc",
          "new_api": "scale_table",
          "old_text": "calloc(spu->scaled_width, sizeof(scale_pixel))",
          "new_text": "scale_table(0, 0, spu->width - 1, spu->scaled_width - 1, table_x)",
          "old_line_content": "\t  table_x = calloc(spu->scaled_width, sizeof(scale_pixel));",
          "new_line_content": "\t  scale_table(0, 0, spu->width - 1, spu->scaled_width - 1, table_x);",
          "content_same": false
        },
        {
          "line": 848,
          "old_api": "calloc",
          "new_api": "scale_table",
          "old_text": "calloc(spu->scaled_height, sizeof(scale_pixel))",
          "new_text": "scale_table(0, 0, spu->height - 1, spu->scaled_height - 1, table_y)",
          "old_line_content": "\t  table_y = calloc(spu->scaled_height, sizeof(scale_pixel));",
          "new_line_content": "\t  scale_table(0, 0, spu->height - 1, spu->scaled_height - 1, table_y);",
          "content_same": false
        },
        {
          "line": 852,
          "old_api": "scale_table",
          "new_api": "free",
          "old_text": "scale_table(0, 0, spu->width - 1, spu->scaled_width - 1, table_x)",
          "new_text": "free(table_x)",
          "old_line_content": "\t  scale_table(0, 0, spu->width - 1, spu->scaled_width - 1, table_x);",
          "new_line_content": "\t  free(table_x);",
          "content_same": false
        },
        {
          "line": 853,
          "old_api": "scale_table",
          "new_api": "free",
          "old_text": "scale_table(0, 0, spu->height - 1, spu->scaled_height - 1, table_y)",
          "new_text": "free(table_y)",
          "old_line_content": "\t  scale_table(0, 0, spu->height - 1, spu->scaled_height - 1, table_y);",
          "new_line_content": "\t  free(table_y);",
          "content_same": false
        },
        {
          "line": 964,
          "old_api": "floor",
          "new_api": "FFMIN",
          "old_text": "floor(unscaled_y_bottom)",
          "new_text": "FFMIN(unscaled_x_right, unscaled_x + 1.0)",
          "old_line_content": "\t\t? unscaled_y_bottom - floor(unscaled_y_bottom)",
          "new_line_content": "\t\tconst unsigned int left_right_column = FFMIN(unscaled_x_right, unscaled_x + 1.0);",
          "content_same": false
        },
        {
          "line": 1146,
          "old_api": "AV_RB32",
          "new_api": "malloc",
          "old_text": "AV_RB32(extradata + i*4)",
          "new_text": "malloc(extradata_len+1)",
          "old_line_content": "      pal[i] = AV_RB32(extradata + i*4);",
          "new_line_content": "  if (!(ptr = buffer = malloc(extradata_len+1)))",
          "content_same": false
        },
        {
          "line": 1153,
          "old_api": "memcpy",
          "new_api": "sscanf",
          "old_text": "memcpy(buffer, extradata, extradata_len)",
          "new_text": "sscanf(ptr, \"palette: %x, %x, %x, %x, %x, %x, %x, %x,\"\n                            \" %x, %x, %x, %x, %x, %x, %x, %x\",\n               &pal[ 0], &pal[ 1], &pal[ 2], &pal[ 3],\n               &pal[ 4], &pal[ 5], &pal[ 6], &pal[ 7],\n               &pal[ 8], &pal[ 9], &pal[10], &pal[11],\n               &pal[12], &pal[13], &pal[14], &pal[15])",
          "old_line_content": "  memcpy(buffer, extradata, extradata_len);",
          "new_line_content": "    if (sscanf(ptr, \"palette: %x, %x, %x, %x, %x, %x, %x, %x,\"",
          "content_same": false
        },
        {
          "line": 1165,
          "old_api": "vobsub_palette_to_yuv",
          "new_api": "sscanf",
          "old_text": "vobsub_palette_to_yuv(pal[i])",
          "new_text": "sscanf(ptr, \"custom colors: ON, tridx: %x, colors: %x, %x, %x, %x\",\n               &tridx, cuspal+0, cuspal+1, cuspal+2, cuspal+3)",
          "old_line_content": "        pal[i] = vobsub_palette_to_yuv(pal[i]);",
          "new_line_content": "    if (sscanf(ptr, \"custom colors: ON, tridx: %x, colors: %x, %x, %x, %x\",",
          "content_same": false
        },
        {
          "line": 1168,
          "old_api": "strncasecmp",
          "new_api": "vobsub_rgb_to_yuv",
          "old_text": "strncasecmp(ptr, \"forced subs: on\", 15)",
          "new_text": "vobsub_rgb_to_yuv(cuspal[i])",
          "old_line_content": "    if (!strncasecmp(ptr, \"forced subs: on\", 15))",
          "new_line_content": "        cuspal[i] = vobsub_rgb_to_yuv(cuspal[i]);",
          "content_same": false
        },
        {
          "line": 1181,
          "old_api": "free",
          "new_api": "calloc",
          "old_text": "free(buffer)",
          "new_text": "calloc(1, sizeof(spudec_handle_t))",
          "old_line_content": "  free(buffer);",
          "new_line_content": "  spudec_handle_t *this = calloc(1, sizeof(spudec_handle_t));",
          "content_same": false
        },
        {
          "line": 1186,
          "old_api": "calloc",
          "new_api": "memcpy",
          "old_text": "calloc(1, sizeof(spudec_handle_t))",
          "new_text": "memcpy(this->global_palette, palette, sizeof(this->global_palette))",
          "old_line_content": "  spudec_handle_t *this = calloc(1, sizeof(spudec_handle_t));",
          "new_line_content": "      memcpy(this->global_palette, palette, sizeof(this->global_palette));",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 521,
          "old_api": null,
          "new_api": "mp_msg",
          "old_text": null,
          "new_text": "mp_msg(MSGT_SPUDEC,MSGL_WARN,\"SPUasm: packet too short\\n\")",
          "old_line_content": "void spudec_assemble(void *this, unsigned char *packet, unsigned int len, int pts100)",
          "new_line_content": "      mp_msg(MSGT_SPUDEC,MSGL_WARN,\"SPUasm: packet too short\\n\");",
          "content_same": false
        },
        {
          "line": 1033,
          "old_api": null,
          "new_api": "canon_alpha",
          "old_text": null,
          "new_text": "canon_alpha(spu->aimage[base])",
          "old_line_content": "\t\t/* 6: center right part */",
          "new_line_content": "\t\t    tmp = right /* * 1.0 */ * canon_alpha(spu->aimage[base]);",
          "content_same": false
        },
        {
          "line": 1041,
          "old_api": null,
          "new_api": "canon_alpha",
          "old_text": null,
          "new_text": "canon_alpha(spu->aimage[base])",
          "old_line_content": "\t\t  }",
          "new_line_content": "\t\t  tmp = left * bottom * canon_alpha(spu->aimage[base]);",
          "content_same": false
        },
        {
          "line": 532,
          "old_api": null,
          "new_api": "get_be16",
          "old_text": null,
          "new_text": "get_be16(packet)",
          "old_line_content": "    spu->packet_offset = 0;",
          "new_line_content": "    unsigned int len2 = get_be16(packet);",
          "content_same": false
        },
        {
          "line": 536,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free(spu->packet)",
          "old_line_content": "  if (spu->packet_offset == 0) {",
          "new_line_content": "\tfree(spu->packet);",
          "content_same": false
        },
        {
          "line": 1050,
          "old_api": null,
          "new_api": "canon_alpha",
          "old_text": null,
          "new_text": "canon_alpha(spu->aimage[base + walkx])",
          "old_line_content": "\t\t/* 8: bottom center part */",
          "new_line_content": "\t\t    tmp = /* 1.0 * */ bottom * canon_alpha(spu->aimage[base + walkx]);",
          "content_same": false
        },
        {
          "line": 543,
          "old_api": null,
          "new_api": "mp_msg",
          "old_text": null,
          "new_text": "mp_msg(MSGT_SPUDEC,MSGL_WARN,\"SPUasm: invalid frag len / len2: %d / %d \\n\", len, len2)",
          "old_line_content": "      spu->packet_reserve = spu->packet != NULL ? len2 : 0;",
          "new_line_content": "\tmp_msg(MSGT_SPUDEC,MSGL_WARN,\"SPUasm: invalid frag len / len2: %d / %d \\n\", len, len2);",
          "content_same": false
        },
        {
          "line": 546,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(spu->packet, packet, len)",
          "old_line_content": "      spu->packet_size = len2;",
          "new_line_content": "      memcpy(spu->packet, packet, len);",
          "content_same": false
        },
        {
          "line": 1058,
          "old_api": null,
          "new_api": "canon_alpha",
          "old_text": null,
          "new_text": "canon_alpha(spu->aimage[base])",
          "old_line_content": "\t\t  }",
          "new_line_content": "\t\t  tmp = right * bottom * canon_alpha(spu->aimage[base]);",
          "content_same": false
        },
        {
          "line": 553,
          "old_api": null,
          "new_api": "mp_msg",
          "old_text": null,
          "new_text": "mp_msg(MSGT_SPUDEC,MSGL_WARN,\"SPUasm: invalid fragment\\n\")",
          "old_line_content": "      spu->packet_pts = pts100;",
          "new_line_content": "      mp_msg(MSGT_SPUDEC,MSGL_WARN,\"SPUasm: invalid fragment\\n\");",
          "content_same": false
        },
        {
          "line": 557,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(spu->packet + spu->packet_offset, packet, len)",
          "old_line_content": "    if (spu->packet_size < spu->packet_offset + len){",
          "new_line_content": "      memcpy(spu->packet + spu->packet_offset, packet, len);",
          "content_same": false
        },
        {
          "line": 1079,
          "old_api": null,
          "new_api": "memset",
          "old_text": null,
          "new_text": "memset(spu->scaled_aimage + y * spu->scaled_stride + spu->scaled_width, 0,\n\t\t     spu->scaled_stride - spu->scaled_width)",
          "old_line_content": "\t  }",
          "new_line_content": "\t      memset(spu->scaled_aimage + y * spu->scaled_stride + spu->scaled_width, 0,",
          "content_same": false
        },
        {
          "line": 569,
          "old_api": null,
          "new_api": "get_be16",
          "old_text": null,
          "new_text": "get_be16(spu->packet+x+2)",
          "old_line_content": "  // [cb] packet_size is padded to be even -> may be one byte too long",
          "new_line_content": "      y=get_be16(spu->packet+x+2); // next control pointer",
          "content_same": false
        },
        {
          "line": 570,
          "old_api": null,
          "new_api": "mp_msg",
          "old_text": null,
          "new_text": "mp_msg(MSGT_SPUDEC,MSGL_DBG2,\"SPUtest: x=%d y=%d off=%d size=%d\\n\",x,y,spu->packet_offset,spu->packet_size)",
          "old_line_content": "  if ((spu->packet_offset == spu->packet_size) ||",
          "new_line_content": "      mp_msg(MSGT_SPUDEC,MSGL_DBG2,\"SPUtest: x=%d y=%d off=%d size=%d\\n\",x,y,spu->packet_offset,spu->packet_size);",
          "content_same": false
        },
        {
          "line": 573,
          "old_api": null,
          "new_api": "mp_msg",
          "old_text": null,
          "new_text": "mp_msg(MSGT_SPUDEC,MSGL_DBG2,\"SPUgot: off=%d  size=%d \\n\",spu->packet_offset,spu->packet_size)",
          "old_line_content": "    while(x+4<=spu->packet_offset){",
          "new_line_content": "\tmp_msg(MSGT_SPUDEC,MSGL_DBG2,\"SPUgot: off=%d  size=%d \\n\",spu->packet_offset,spu->packet_size);",
          "content_same": false
        },
        {
          "line": 590,
          "old_api": null,
          "new_api": "spudec_decode",
          "old_text": null,
          "new_text": "spudec_decode(spu, pts100)",
          "old_line_content": "    // [cb] packet is done; start new packet",
          "new_line_content": "    spudec_decode(spu, pts100);",
          "content_same": false
        },
        {
          "line": 1102,
          "old_api": null,
          "new_api": "draw_alpha",
          "old_text": null,
          "new_text": "draw_alpha(spu->scaled_start_col, spu->scaled_start_row, spu->scaled_width, spu->scaled_height,\n\t\t   spu->scaled_image, spu->scaled_aimage, spu->scaled_stride)",
          "old_line_content": "\t  break;",
          "new_line_content": "\tdraw_alpha(spu->scaled_start_col, spu->scaled_start_row, spu->scaled_width, spu->scaled_height,",
          "content_same": false
        },
        {
          "line": 1110,
          "old_api": null,
          "new_api": "mp_msg",
          "old_text": null,
          "new_text": "mp_msg(MSGT_SPUDEC,MSGL_DBG2,\"SPU not displayed: start_pts=%d  end_pts=%d  now_pts=%d\\n\",\n        spu->start_pts, spu->end_pts, spu->now_pts)",
          "old_line_content": "      }",
          "new_line_content": "    mp_msg(MSGT_SPUDEC,MSGL_DBG2,\"SPU not displayed: start_pts=%d  end_pts=%d  now_pts=%d\\n\",",
          "content_same": false
        },
        {
          "line": 600,
          "old_api": null,
          "new_api": "spudec_dequeue_packet",
          "old_text": null,
          "new_text": "spudec_dequeue_packet(spu)",
          "old_line_content": "",
          "new_line_content": "    spudec_free_packet(spudec_dequeue_packet(spu));",
          "content_same": false
        },
        {
          "line": 1119,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(spu->global_palette, palette, sizeof(spu->global_palette))",
          "old_line_content": "",
          "new_line_content": "    memcpy(spu->global_palette, palette, sizeof(spu->global_palette));",
          "content_same": false
        },
        {
          "line": 1121,
          "old_api": null,
          "new_api": "control",
          "old_text": null,
          "new_text": "spu->hw_spu->control(VOCTRL_SET_SPU_PALETTE,spu->global_palette)",
          "old_line_content": "{",
          "new_line_content": "      spu->hw_spu->control(VOCTRL_SET_SPU_PALETTE,spu->global_palette);",
          "content_same": false
        },
        {
          "line": 612,
          "old_api": null,
          "new_api": "spudec_dequeue_packet",
          "old_text": null,
          "new_text": "spudec_dequeue_packet(spu)",
          "old_line_content": "{",
          "new_line_content": "    packet_t *packet = spudec_dequeue_packet(spu);",
          "content_same": false
        },
        {
          "line": 616,
          "old_api": null,
          "new_api": "compute_palette",
          "old_text": null,
          "new_text": "compute_palette(spu, packet)",
          "old_line_content": "  while (spu->queue_head != NULL && pts100 >= spu->queue_head->start_pts) {",
          "new_line_content": "      compute_palette(spu, packet);",
          "content_same": false
        },
        {
          "line": 618,
          "old_api": null,
          "new_api": "spudec_free_packet",
          "old_text": null,
          "new_text": "spudec_free_packet(packet)",
          "old_line_content": "    spu->start_pts = packet->start_pts;",
          "new_line_content": "    spudec_free_packet(packet);",
          "content_same": false
        },
        {
          "line": 1141,
          "old_api": null,
          "new_api": "AV_RB32",
          "old_text": null,
          "new_text": "AV_RB32(extradata + i*4)",
          "old_line_content": "  unsigned int tridx;",
          "new_line_content": "      pal[i] = AV_RB32(extradata + i*4);",
          "content_same": false
        },
        {
          "line": 1148,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(buffer, extradata, extradata_len)",
          "old_line_content": "    return;",
          "new_line_content": "  memcpy(buffer, extradata, extradata_len);",
          "content_same": false
        },
        {
          "line": 636,
          "old_api": null,
          "new_api": "mp_msg",
          "old_text": null,
          "new_text": "mp_msg(MSGT_SPUDEC,MSGL_DBG2,\"SPU: Display only forced subs now %s\\n\", flag ? \"enabled\": \"disabled\")",
          "old_line_content": "",
          "new_line_content": "      mp_msg(MSGT_SPUDEC,MSGL_DBG2,\"SPU: Display only forced subs now %s\\n\", flag ? \"enabled\": \"disabled\");",
          "content_same": false
        },
        {
          "line": 1152,
          "old_api": null,
          "new_api": "sscanf",
          "old_text": null,
          "new_text": "sscanf(ptr, \"size: %dx%d\", &this->orig_frame_width, &this->orig_frame_height)",
          "old_line_content": "    return;",
          "new_line_content": "    sscanf(ptr, \"size: %dx%d\", &this->orig_frame_width, &this->orig_frame_height);",
          "content_same": false
        },
        {
          "line": 645,
          "old_api": null,
          "new_api": "draw_alpha",
          "old_text": null,
          "new_text": "draw_alpha(spu->start_col, spu->start_row, spu->width, spu->height,\n\t\t   spu->image, spu->aimage, spu->stride)",
          "old_line_content": "void spudec_draw(void *this, void (*draw_alpha)(int x0,int y0, int w,int h, unsigned char* src, unsigned char *srca, int stride))",
          "new_line_content": "\tdraw_alpha(spu->start_col, spu->start_row, spu->width, spu->height,",
          "content_same": false
        },
        {
          "line": 1160,
          "old_api": null,
          "new_api": "vobsub_palette_to_yuv",
          "old_text": null,
          "new_text": "vobsub_palette_to_yuv(pal[i])",
          "old_line_content": "               &pal[ 0], &pal[ 1], &pal[ 2], &pal[ 3],",
          "new_line_content": "        pal[i] = vobsub_palette_to_yuv(pal[i]);",
          "content_same": false
        },
        {
          "line": 1163,
          "old_api": null,
          "new_api": "strncasecmp",
          "old_text": null,
          "new_text": "strncasecmp(ptr, \"forced subs: on\", 15)",
          "old_line_content": "               &pal[12], &pal[13], &pal[14], &pal[15]) == 16) {",
          "new_line_content": "    if (!strncasecmp(ptr, \"forced subs: on\", 15))",
          "content_same": false
        },
        {
          "line": 1174,
          "old_api": null,
          "new_api": "strchr",
          "old_text": null,
          "new_text": "strchr(ptr,'\\n')",
          "old_line_content": "        if (tridx & (1 << (12-4*i)))",
          "new_line_content": "  } while ((ptr=strchr(ptr,'\\n')) && *++ptr);",
          "content_same": false
        },
        {
          "line": 1176,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free(buffer)",
          "old_line_content": "      }",
          "new_line_content": "  free(buffer);",
          "content_same": false
        },
        {
          "line": 1190,
          "old_api": null,
          "new_api": "spudec_parse_extradata",
          "old_text": null,
          "new_text": "spudec_parse_extradata(this, extradata, extradata_len)",
          "old_line_content": "    if (palette)",
          "new_line_content": "      spudec_parse_extradata(this, extradata, extradata_len);",
          "content_same": false
        },
        {
          "line": 1200,
          "old_api": null,
          "new_api": "mp_msg",
          "old_text": null,
          "new_text": "mp_msg(MSGT_SPUDEC,MSGL_FATAL, \"FATAL: spudec_init: calloc\")",
          "old_line_content": "      this->orig_frame_height = 480;",
          "new_line_content": "    mp_msg(MSGT_SPUDEC,MSGL_FATAL, \"FATAL: spudec_init: calloc\");",
          "content_same": false
        },
        {
          "line": 1206,
          "old_api": null,
          "new_api": "spudec_new_scaled",
          "old_text": null,
          "new_text": "spudec_new_scaled(palette, 0, 0, NULL, 0)",
          "old_line_content": "  return this;",
          "new_line_content": "    return spudec_new_scaled(palette, 0, 0, NULL, 0);",
          "content_same": false
        },
        {
          "line": 1214,
          "old_api": null,
          "new_api": "spudec_dequeue_packet",
          "old_text": null,
          "new_text": "spudec_dequeue_packet(spu)",
          "old_line_content": "void spudec_free(void *this)",
          "new_line_content": "      spudec_free_packet(spudec_dequeue_packet(spu));",
          "content_same": false
        },
        {
          "line": 1216,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free(spu->packet)",
          "old_line_content": "  spudec_handle_t *spu = (spudec_handle_t*)this;",
          "new_line_content": "      free(spu->packet);",
          "content_same": false
        },
        {
          "line": 1218,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free(spu->scaled_image)",
          "old_line_content": "    while (spu->queue_head)",
          "new_line_content": "\tfree(spu->scaled_image);",
          "content_same": false
        },
        {
          "line": 1220,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free(spu->image)",
          "old_line_content": "    if (spu->packet)",
          "new_line_content": "      free(spu->image);",
          "content_same": false
        },
        {
          "line": 1231,
          "old_api": null,
          "new_api": "control",
          "old_text": null,
          "new_text": "hw_spu->control(VOCTRL_SET_SPU_PALETTE,spu->global_palette)",
          "old_line_content": "{",
          "new_line_content": "  hw_spu->control(VOCTRL_SET_SPU_PALETTE,spu->global_palette);",
          "content_same": false
        },
        {
          "line": 720,
          "old_api": null,
          "new_api": "FFMIN",
          "old_text": null,
          "new_text": "FFMIN(src >> 16, end_src - 1)",
          "old_line_content": "  if (delta_src == 0 || delta_tar == 0) {",
          "new_line_content": "    table[t].position= FFMIN(src >> 16, end_src - 1);",
          "content_same": false
        },
        {
          "line": 213,
          "old_api": null,
          "new_api": "malloc",
          "old_text": null,
          "new_text": "malloc(2 * this->stride * this->height)",
          "old_line_content": "\t  return;",
          "new_line_content": "  image = malloc(2 * this->stride * this->height);",
          "content_same": false
        },
        {
          "line": 217,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(image, this->image + this->stride * first_y, this->image_size)",
          "old_line_content": "",
          "new_line_content": "    memcpy(image, this->image + this->stride * first_y, this->image_size);",
          "content_same": false
        },
        {
          "line": 219,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free(this->image)",
          "old_line_content": "  if(image){",
          "new_line_content": "    free(this->image);",
          "content_same": false
        },
        {
          "line": 734,
          "old_api": null,
          "new_api": "canon_alpha",
          "old_text": null,
          "new_text": "canon_alpha(spu->aimage[base])",
          "old_line_content": "  int alpha[4];",
          "new_line_content": "  alpha[0] = canon_alpha(spu->aimage[base]);",
          "content_same": false
        },
        {
          "line": 735,
          "old_api": null,
          "new_api": "canon_alpha",
          "old_text": null,
          "new_text": "canon_alpha(spu->aimage[base + 1])",
          "old_line_content": "  int color[4];",
          "new_line_content": "  alpha[1] = canon_alpha(spu->aimage[base + 1]);",
          "content_same": false
        },
        {
          "line": 736,
          "old_api": null,
          "new_api": "canon_alpha",
          "old_text": null,
          "new_text": "canon_alpha(spu->aimage[base + spu->stride])",
          "old_line_content": "  unsigned int scale[4];",
          "new_line_content": "  alpha[2] = canon_alpha(spu->aimage[base + spu->stride]);",
          "content_same": false
        },
        {
          "line": 737,
          "old_api": null,
          "new_api": "canon_alpha",
          "old_text": null,
          "new_text": "canon_alpha(spu->aimage[base + spu->stride + 1])",
          "old_line_content": "  int base = table_y[y].position * spu->stride + table_x[x].position;",
          "new_line_content": "  alpha[3] = canon_alpha(spu->aimage[base + spu->stride + 1]);",
          "content_same": false
        },
        {
          "line": 752,
          "old_api": null,
          "new_api": "FFMIN",
          "old_text": null,
          "new_text": "FFMIN(spu->scaled_image[scaled], spu->scaled_aimage[scaled])",
          "old_line_content": "  scale[3] = (table_x[x].right_down * table_y[y].right_down >> 16) * alpha[3];",
          "new_line_content": "    spu->scaled_image[scaled] = FFMIN(spu->scaled_image[scaled], spu->scaled_aimage[scaled]);",
          "content_same": false
        },
        {
          "line": 242,
          "old_api": null,
          "new_api": "mkalpha",
          "old_text": null,
          "new_text": "mkalpha(packet->alpha[i])",
          "old_line_content": "  this->end_row = packet->end_row;",
          "new_line_content": "    alpha[i] = mkalpha(packet->alpha[i]);",
          "content_same": false
        },
        {
          "line": 767,
          "old_api": null,
          "new_api": "sws_freeVec",
          "old_text": null,
          "new_text": "sws_freeVec(filter.lumH)",
          "old_line_content": "\tstatic SwsFilter filter;",
          "new_line_content": "\tif (!firsttime && oldvar != spu_gaussvar) sws_freeVec(filter.lumH);",
          "content_same": false
        },
        {
          "line": 770,
          "old_api": null,
          "new_api": "sws_getGaussianVec",
          "old_text": null,
          "new_text": "sws_getGaussianVec(spu_gaussvar, 3.0)",
          "old_line_content": "\tint i;",
          "new_line_content": "\t\t\tfilter.chrH = filter.chrV = sws_getGaussianVec(spu_gaussvar, 3.0);",
          "content_same": false
        },
        {
          "line": 771,
          "old_api": null,
          "new_api": "sws_normalizeVec",
          "old_text": null,
          "new_text": "sws_normalizeVec(filter.lumH, 1.0)",
          "old_line_content": "",
          "new_line_content": "\t\tsws_normalizeVec(filter.lumH, 1.0);",
          "content_same": false
        },
        {
          "line": 261,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free(this->image)",
          "old_line_content": "    }",
          "new_line_content": "      free(this->image);",
          "content_same": false
        },
        {
          "line": 264,
          "old_api": null,
          "new_api": "malloc",
          "old_text": null,
          "new_text": "malloc(2 * this->stride * this->height)",
          "old_line_content": "  if (this->image_size < this->stride * this->height) {",
          "new_line_content": "    this->image = malloc(2 * this->stride * this->height);",
          "content_same": false
        },
        {
          "line": 777,
          "old_api": null,
          "new_api": "sws_scale",
          "old_text": null,
          "new_text": "sws_scale(ctx,&s1,&ss,0,sh,&d1,&ds)",
          "old_line_content": "\t\tfirsttime = 0;",
          "new_line_content": "\tsws_scale(ctx,&s1,&ss,0,sh,&d1,&ds);",
          "content_same": false
        },
        {
          "line": 779,
          "old_api": null,
          "new_api": "sws_scale",
          "old_text": null,
          "new_text": "sws_scale(ctx,&s2,&ss,0,sh,&d2,&ds)",
          "old_line_content": "\t}",
          "new_line_content": "\tsws_scale(ctx,&s2,&ss,0,sh,&d2,&ds);",
          "content_same": false
        },
        {
          "line": 276,
          "old_api": null,
          "new_api": "memset",
          "old_text": null,
          "new_text": "memset(this->aimage + y * this->stride + this->width, 0, this->stride - this->width)",
          "old_line_content": "    return;",
          "new_line_content": "      memset(this->aimage + y * this->stride + this->width, 0, this->stride - this->width);",
          "content_same": false
        },
        {
          "line": 278,
          "old_api": null,
          "new_api": "memset",
          "old_text": null,
          "new_text": "memset(this->image + y * this->stride + this->width, 0, this->stride - this->width)",
          "old_line_content": "  /* Kludge: draw_alpha needs width multiple of 8. */",
          "new_line_content": "      memset(this->image + y * this->stride + this->width, 0, this->stride - this->width);",
          "content_same": false
        },
        {
          "line": 289,
          "old_api": null,
          "new_api": "get_nibble",
          "old_text": null,
          "new_text": "get_nibble(packet)",
          "old_line_content": "  while (packet->current_nibble[0] < i",
          "new_line_content": "    rle = get_nibble(packet);",
          "content_same": false
        },
        {
          "line": 801,
          "old_api": null,
          "new_api": "draw_alpha",
          "old_text": null,
          "new_text": "draw_alpha(spu->start_col, spu->start_row, spu->width, spu->height,\n\t\t   spu->image, spu->aimage, spu->stride)",
          "old_line_content": "",
          "new_line_content": "\tdraw_alpha(spu->start_col, spu->start_row, spu->width, spu->height,",
          "content_same": false
        },
        {
          "line": 291,
          "old_api": null,
          "new_api": "get_nibble",
          "old_text": null,
          "new_text": "get_nibble(packet)",
          "old_line_content": "\t && y < this->height) {",
          "new_line_content": "      rle = (rle << 4) | get_nibble(packet);",
          "content_same": false
        },
        {
          "line": 293,
          "old_api": null,
          "new_api": "get_nibble",
          "old_text": null,
          "new_text": "get_nibble(packet)",
          "old_line_content": "    unsigned int rle = 0;",
          "new_line_content": "\trle = (rle << 4) | get_nibble(packet);",
          "content_same": false
        },
        {
          "line": 295,
          "old_api": null,
          "new_api": "get_nibble",
          "old_text": null,
          "new_text": "get_nibble(packet)",
          "old_line_content": "    if (rle < 0x04) {",
          "new_line_content": "\t  rle = (rle << 4) | get_nibble(packet);",
          "content_same": false
        },
        {
          "line": 306,
          "old_api": null,
          "new_api": "memset",
          "old_text": null,
          "new_text": "memset(this->image + y * this->stride + x, cmap[color], len)",
          "old_line_content": "    color = 3 - (rle & 0x3);",
          "new_line_content": "    memset(this->image + y * this->stride + x, cmap[color], len);",
          "content_same": false
        },
        {
          "line": 307,
          "old_api": null,
          "new_api": "memset",
          "old_text": null,
          "new_text": "memset(this->aimage + y * this->stride + x, alpha[color], len)",
          "old_line_content": "    len = rle >> 2;",
          "new_line_content": "    memset(this->aimage + y * this->stride + x, alpha[color], len);",
          "content_same": false
        },
        {
          "line": 821,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free(spu->scaled_image)",
          "old_line_content": "\tspu->scaled_height = spu->height * scaley / 0x100;",
          "new_line_content": "\t    free(spu->scaled_image);",
          "content_same": false
        },
        {
          "line": 310,
          "old_api": null,
          "new_api": "next_line",
          "old_text": null,
          "new_text": "next_line(packet)",
          "old_line_content": "    /* FIXME have to use palette and alpha map*/",
          "new_line_content": "      next_line(packet);",
          "content_same": false
        },
        {
          "line": 824,
          "old_api": null,
          "new_api": "malloc",
          "old_text": null,
          "new_text": "malloc(2 * spu->scaled_stride * spu->scaled_height)",
          "old_line_content": "\tif (spu->scaled_image_size < spu->scaled_stride * spu->scaled_height) {",
          "new_line_content": "\t  spu->scaled_image = malloc(2 * spu->scaled_stride * spu->scaled_height);",
          "content_same": false
        },
        {
          "line": 837,
          "old_api": null,
          "new_api": "sws_spu_image",
          "old_text": null,
          "new_text": "sws_spu_image(spu->scaled_image, spu->scaled_aimage,\n\t\t  spu->scaled_width, spu->scaled_height, spu->scaled_stride,\n\t\t  spu->image, spu->aimage, spu->width, spu->height, spu->stride)",
          "old_line_content": "\t  if (spu->scaled_width <= 1 || spu->scaled_height <= 1) {",
          "new_line_content": "\t  sws_spu_image(spu->scaled_image, spu->scaled_aimage,",
          "content_same": false
        },
        {
          "line": 330,
          "old_api": null,
          "new_api": "memset",
          "old_text": null,
          "new_text": "memset(used, 0, sizeof(used))",
          "old_line_content": "*/",
          "new_line_content": "  memset(used, 0, sizeof(used));",
          "content_same": false
        },
        {
          "line": 843,
          "old_api": null,
          "new_api": "calloc",
          "old_text": null,
          "new_text": "calloc(spu->scaled_height, sizeof(scale_pixel))",
          "old_line_content": "\t\t  spu->scaled_width, spu->scaled_height, spu->scaled_stride,",
          "new_line_content": "\t  table_y = calloc(spu->scaled_height, sizeof(scale_pixel));",
          "content_same": false
        },
        {
          "line": 845,
          "old_api": null,
          "new_api": "mp_msg",
          "old_text": null,
          "new_text": "mp_msg(MSGT_SPUDEC, MSGL_FATAL, \"Fatal: spudec_draw_scaled: calloc failed\\n\")",
          "old_line_content": "\t  break;",
          "new_line_content": "\t    mp_msg(MSGT_SPUDEC, MSGL_FATAL, \"Fatal: spudec_draw_scaled: calloc failed\\n\");",
          "content_same": false
        },
        {
          "line": 851,
          "old_api": null,
          "new_api": "scale_image",
          "old_text": null,
          "new_text": "scale_image(x, y, table_x, table_y, spu)",
          "old_line_content": "\t  }",
          "new_line_content": "\t      scale_image(x, y, table_x, table_y, spu);",
          "content_same": false
        },
        {
          "line": 344,
          "old_api": null,
          "new_api": "memset",
          "old_text": null,
          "new_text": "memset(used, 0, sizeof(used))",
          "old_line_content": "    step = 0;",
          "new_line_content": "  memset(used, 0, sizeof(used));",
          "content_same": false
        },
        {
          "line": 375,
          "old_api": null,
          "new_api": "get_be16",
          "old_text": null,
          "new_text": "get_be16(this->packet + 2)",
          "old_line_content": "  unsigned int end_row = 0;",
          "new_line_content": "  control_start = get_be16(this->packet + 2);",
          "content_same": false
        },
        {
          "line": 888,
          "old_api": null,
          "new_api": "canon_alpha",
          "old_text": null,
          "new_text": "canon_alpha(spu->aimage[base])",
          "old_line_content": "\t\tif (unscaled_right >= spu->width)",
          "new_line_content": "\t\t    tmp = canon_alpha(spu->aimage[base]);",
          "content_same": false
        },
        {
          "line": 379,
          "old_api": null,
          "new_api": "get_be16",
          "old_text": null,
          "new_text": "get_be16(this->packet + start_off)",
          "old_line_content": "",
          "new_line_content": "    date = get_be16(this->packet + start_off) * 1024;",
          "content_same": false
        },
        {
          "line": 381,
          "old_api": null,
          "new_api": "mp_msg",
          "old_text": null,
          "new_text": "mp_msg(MSGT_SPUDEC,MSGL_DBG2, \"date=%d\\n\", date)",
          "old_line_content": "  next_off = control_start;",
          "new_line_content": "    mp_msg(MSGT_SPUDEC,MSGL_DBG2, \"date=%d\\n\", date);",
          "content_same": false
        },
        {
          "line": 388,
          "old_api": null,
          "new_api": "mp_msg",
          "old_text": null,
          "new_text": "mp_msg(MSGT_SPUDEC,MSGL_DBG2,\"Menu ID\\n\")",
          "old_line_content": "    for (type = this->packet[off++]; type != 0xff; type = this->packet[off++]) {",
          "new_line_content": "\tmp_msg(MSGT_SPUDEC,MSGL_DBG2,\"Menu ID\\n\");",
          "content_same": false
        },
        {
          "line": 397,
          "old_api": null,
          "new_api": "mp_msg",
          "old_text": null,
          "new_text": "mp_msg(MSGT_SPUDEC,MSGL_DBG2,\"Start display!\\n\")",
          "old_line_content": "\tdisplay = 1;",
          "new_line_content": "\tmp_msg(MSGT_SPUDEC,MSGL_DBG2,\"Start display!\\n\");",
          "content_same": false
        },
        {
          "line": 405,
          "old_api": null,
          "new_api": "mp_msg",
          "old_text": null,
          "new_text": "mp_msg(MSGT_SPUDEC,MSGL_DBG2,\"Stop display!\\n\")",
          "old_line_content": "\tdisplay = 1;",
          "new_line_content": "\tmp_msg(MSGT_SPUDEC,MSGL_DBG2,\"Stop display!\\n\");",
          "content_same": false
        },
        {
          "line": 414,
          "old_api": null,
          "new_api": "mp_msg",
          "old_text": null,
          "new_text": "mp_msg(MSGT_SPUDEC,MSGL_DBG2,\"Palette %d, %d, %d, %d\\n\",\n\t       this->palette[0], this->palette[1], this->palette[2], this->palette[3])",
          "old_line_content": "\t/* Palette */",
          "new_line_content": "\tmp_msg(MSGT_SPUDEC,MSGL_DBG2,\"Palette %d, %d, %d, %d\\n\",",
          "content_same": false
        },
        {
          "line": 424,
          "old_api": null,
          "new_api": "mp_msg",
          "old_text": null,
          "new_text": "mp_msg(MSGT_SPUDEC,MSGL_DBG2,\"Alpha %d, %d, %d, %d\\n\",\n\t       this->alpha[0], this->alpha[1], this->alpha[2], this->alpha[3])",
          "old_line_content": "\t/* Alpha */",
          "new_line_content": "\tmp_msg(MSGT_SPUDEC,MSGL_DBG2,\"Alpha %d, %d, %d, %d\\n\",",
          "content_same": false
        },
        {
          "line": 430,
          "old_api": null,
          "new_api": "get_be24",
          "old_text": null,
          "new_text": "get_be24(this->packet + off)",
          "old_line_content": "\t       this->alpha[0], this->alpha[1], this->alpha[2], this->alpha[3]);",
          "new_line_content": "\ta = get_be24(this->packet + off);",
          "content_same": false
        },
        {
          "line": 431,
          "old_api": null,
          "new_api": "get_be24",
          "old_text": null,
          "new_text": "get_be24(this->packet + off + 3)",
          "old_line_content": "\toff+=2;",
          "new_line_content": "\tb = get_be24(this->packet + off + 3);",
          "content_same": false
        },
        {
          "line": 439,
          "old_api": null,
          "new_api": "mp_msg",
          "old_text": null,
          "new_text": "mp_msg(MSGT_SPUDEC,MSGL_DBG2,\"Coords  col: %d - %d  row: %d - %d  (%dx%d)\\n\",\n\t       start_col, end_col, start_row, end_row,\n\t       width, height)",
          "old_line_content": "\twidth = (end_col < start_col) ? 0 : end_col - start_col + 1;",
          "new_line_content": "\tmp_msg(MSGT_SPUDEC,MSGL_DBG2,\"Coords  col: %d - %d  row: %d - %d  (%dx%d)\\n\",",
          "content_same": false
        },
        {
          "line": 953,
          "old_api": null,
          "new_api": "FFMIN",
          "old_text": null,
          "new_text": "FFMIN(unscaled_y_bottom, unscaled_y + 1.0)",
          "old_line_content": "\t    const double inv_scalex = (double) 0x100 / scalex;",
          "new_line_content": "\t      const unsigned int top_low_row = FFMIN(unscaled_y_bottom, unscaled_y + 1.0);",
          "content_same": false
        },
        {
          "line": 446,
          "old_api": null,
          "new_api": "get_be16",
          "old_text": null,
          "new_text": "get_be16(this->packet + off)",
          "old_line_content": "\t       width, height);",
          "new_line_content": "\tcurrent_nibble[0] = 2 * get_be16(this->packet + off);",
          "content_same": false
        },
        {
          "line": 447,
          "old_api": null,
          "new_api": "get_be16",
          "old_text": null,
          "new_text": "get_be16(this->packet + off + 2)",
          "old_line_content": "\toff+=6;",
          "new_line_content": "\tcurrent_nibble[1] = 2 * get_be16(this->packet + off + 2);",
          "content_same": false
        },
        {
          "line": 448,
          "old_api": null,
          "new_api": "mp_msg",
          "old_text": null,
          "new_text": "mp_msg(MSGT_SPUDEC,MSGL_DBG2,\"Graphic offset 1: %d  offset 2: %d\\n\",\n\t       current_nibble[0] / 2, current_nibble[1] / 2)",
          "old_line_content": "\tbreak;",
          "new_line_content": "\tmp_msg(MSGT_SPUDEC,MSGL_DBG2,\"Graphic offset 1: %d  offset 2: %d\\n\",",
          "content_same": false
        },
        {
          "line": 959,
          "old_api": null,
          "new_api": "floor",
          "old_text": null,
          "new_text": "floor(unscaled_y_bottom)",
          "old_line_content": "\t      const double top = top_low_row - unscaled_y;",
          "new_line_content": "\t\t? unscaled_y_bottom - floor(unscaled_y_bottom)",
          "content_same": false
        },
        {
          "line": 454,
          "old_api": null,
          "new_api": "mp_msg",
          "old_text": null,
          "new_text": "mp_msg(MSGT_SPUDEC,MSGL_DBG2,\"Done!\\n\")",
          "old_line_content": "\t       current_nibble[0] / 2, current_nibble[1] / 2);",
          "new_line_content": "\tmp_msg(MSGT_SPUDEC,MSGL_DBG2,\"Done!\\n\");",
          "content_same": false
        },
        {
          "line": 458,
          "old_api": null,
          "new_api": "mp_msg",
          "old_text": null,
          "new_text": "mp_msg(MSGT_SPUDEC,MSGL_WARN,\"spudec: Error determining control type 0x%02x.  Skipping %d bytes.\\n\",\n\t       type, next_off - off)",
          "old_line_content": "\t/* All done, bye-bye */",
          "new_line_content": "\tmp_msg(MSGT_SPUDEC,MSGL_WARN,\"spudec: Error determining control type 0x%02x.  Skipping %d bytes.\\n\",",
          "content_same": false
        },
        {
          "line": 970,
          "old_api": null,
          "new_api": "floor",
          "old_text": null,
          "new_text": "floor(unscaled_x_right)",
          "old_line_content": "\t\tconst double left = left_right_column - unscaled_x;",
          "new_line_content": "\t\t  ? unscaled_x_right - floor(unscaled_x_right)",
          "content_same": false
        },
        {
          "line": 467,
          "old_api": null,
          "new_api": "get_be16",
          "old_text": null,
          "new_text": "get_be16(this->packet + next_off)",
          "old_line_content": "    }",
          "new_line_content": "      end_pts = get_be16(this->packet + next_off) * 1024;",
          "content_same": false
        },
        {
          "line": 471,
          "old_api": null,
          "new_api": "calloc",
          "old_text": null,
          "new_text": "calloc(1, sizeof(packet_t))",
          "old_line_content": "    if (end_pts == UINT_MAX && start_off != next_off) {",
          "new_line_content": "      packet_t *packet = calloc(1, sizeof(packet_t));",
          "content_same": false
        },
        {
          "line": 985,
          "old_api": null,
          "new_api": "canon_alpha",
          "old_text": null,
          "new_text": "canon_alpha(spu->aimage[base + (unsigned int) unscaled_x])",
          "old_line_content": "\t\t  transformed alpha = sum(surface * alpha) / sum(surface)",
          "new_line_content": "\t\ttmp = left * top * canon_alpha(spu->aimage[base + (unsigned int) unscaled_x]);",
          "content_same": false
        },
        {
          "line": 993,
          "old_api": null,
          "new_api": "canon_alpha",
          "old_text": null,
          "new_text": "canon_alpha(spu->aimage[base])",
          "old_line_content": "\t\t/* 2: top center part */",
          "new_line_content": "\t\t    tmp = /* 1.0 * */ top * canon_alpha(spu->aimage[base]);",
          "content_same": false
        },
        {
          "line": 489,
          "old_api": null,
          "new_api": "malloc",
          "old_text": null,
          "new_text": "malloc(this->packet_size)",
          "old_line_content": "      packet->control_start = control_start;",
          "new_line_content": "      packet->packet = malloc(this->packet_size);",
          "content_same": false
        },
        {
          "line": 490,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(packet->packet, this->packet, this->packet_size)",
          "old_line_content": "      for (i=0; i<4; i++) {",
          "new_line_content": "      memcpy(packet->packet, this->packet, this->packet_size);",
          "content_same": false
        },
        {
          "line": 491,
          "old_api": null,
          "new_api": "spudec_queue_packet",
          "old_text": null,
          "new_text": "spudec_queue_packet(this, packet)",
          "old_line_content": "\tpacket->alpha[i] = this->alpha[i];",
          "new_line_content": "      spudec_queue_packet(this, packet);",
          "content_same": false
        },
        {
          "line": 1001,
          "old_api": null,
          "new_api": "canon_alpha",
          "old_text": null,
          "new_text": "canon_alpha(spu->aimage[base])",
          "old_line_content": "\t\t  }",
          "new_line_content": "\t\t  tmp = right * top * canon_alpha(spu->aimage[base]);",
          "content_same": false
        },
        {
          "line": 1010,
          "old_api": null,
          "new_api": "canon_alpha",
          "old_text": null,
          "new_text": "canon_alpha(spu->aimage[base])",
          "old_line_content": "\t\t/* 4: center left part */",
          "new_line_content": "\t\t    tmp = left /* * 1.0 */ * canon_alpha(spu->aimage[base]);",
          "content_same": false
        },
        {
          "line": 499,
          "old_api": null,
          "new_api": "spudec_process_control",
          "old_text": null,
          "new_text": "spudec_process_control(this, pts100)",
          "old_line_content": "}",
          "new_line_content": "    spudec_process_control(this, pts100);",
          "content_same": false
        },
        {
          "line": 506,
          "old_api": null,
          "new_api": "draw_frame",
          "old_text": null,
          "new_text": "this->hw_spu->draw_frame((uint8_t**)&pkg)",
          "old_line_content": "    static vo_mpegpes_t packet = { NULL, 0, 0x20, 0 };",
          "new_line_content": "    this->hw_spu->draw_frame((uint8_t**)&pkg);",
          "content_same": false
        },
        {
          "line": 1022,
          "old_api": null,
          "new_api": "canon_alpha",
          "old_text": null,
          "new_text": "canon_alpha(spu->aimage[base + walkx])",
          "old_line_content": "\t\t  unsigned int walky;",
          "new_line_content": "\t\t      tmp = /* 1.0 * 1.0 * */ canon_alpha(spu->aimage[base + walkx]);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 1027,
          "old_api": "canon_alpha",
          "new_api": null,
          "old_text": "canon_alpha(spu->aimage[base + walkx])",
          "new_text": null,
          "old_line_content": "\t\t      tmp = /* 1.0 * 1.0 * */ canon_alpha(spu->aimage[base + walkx]);",
          "new_line_content": "\t\t}",
          "content_same": false
        },
        {
          "line": 526,
          "old_api": "mp_msg",
          "new_api": null,
          "old_text": "mp_msg(MSGT_SPUDEC,MSGL_WARN,\"SPUasm: packet too short\\n\")",
          "new_text": null,
          "old_line_content": "      mp_msg(MSGT_SPUDEC,MSGL_WARN,\"SPUasm: packet too short\\n\");",
          "new_line_content": "    // [cb] too long since last fragment: force new packet",
          "content_same": false
        },
        {
          "line": 1038,
          "old_api": "canon_alpha",
          "new_api": null,
          "old_text": "canon_alpha(spu->aimage[base])",
          "new_text": null,
          "old_line_content": "\t\t    tmp = right /* * 1.0 */ * canon_alpha(spu->aimage[base]);",
          "new_line_content": "\t\t/* 7: bottom left part */",
          "content_same": false
        },
        {
          "line": 1046,
          "old_api": "canon_alpha",
          "new_api": null,
          "old_text": "canon_alpha(spu->aimage[base])",
          "new_text": null,
          "old_line_content": "\t\t  tmp = left * bottom * canon_alpha(spu->aimage[base]);",
          "new_line_content": "\t\tif (width > 0 && bottom > 0.0) {",
          "content_same": false
        },
        {
          "line": 541,
          "old_api": "free",
          "new_api": null,
          "old_text": "free(spu->packet)",
          "new_text": null,
          "old_line_content": "\tfree(spu->packet);",
          "new_line_content": "      spu->packet_size = len2;",
          "content_same": false
        },
        {
          "line": 542,
          "old_api": "malloc",
          "new_api": null,
          "old_text": "malloc(len2)",
          "new_text": null,
          "old_line_content": "      spu->packet = malloc(len2);",
          "new_line_content": "      if (len > len2) {",
          "content_same": false
        },
        {
          "line": 1055,
          "old_api": "canon_alpha",
          "new_api": null,
          "old_text": "canon_alpha(spu->aimage[base + walkx])",
          "new_text": null,
          "old_line_content": "\t\t    tmp = /* 1.0 * */ bottom * canon_alpha(spu->aimage[base + walkx]);",
          "new_line_content": "\t\t/* 9: bottom right part */",
          "content_same": false
        },
        {
          "line": 548,
          "old_api": "mp_msg",
          "new_api": null,
          "old_text": "mp_msg(MSGT_SPUDEC,MSGL_WARN,\"SPUasm: invalid frag len / len2: %d / %d \\n\", len, len2)",
          "new_text": null,
          "old_line_content": "\tmp_msg(MSGT_SPUDEC,MSGL_WARN,\"SPUasm: invalid frag len / len2: %d / %d \\n\", len, len2);",
          "new_line_content": "      spu->packet_pts = pts100;",
          "content_same": false
        },
        {
          "line": 551,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(spu->packet, packet, len)",
          "new_text": null,
          "old_line_content": "      memcpy(spu->packet, packet, len);",
          "new_line_content": "    // Continue current fragment",
          "content_same": false
        },
        {
          "line": 1063,
          "old_api": "canon_alpha",
          "new_api": null,
          "old_text": "canon_alpha(spu->aimage[base])",
          "new_text": null,
          "old_line_content": "\t\t  tmp = right * bottom * canon_alpha(spu->aimage[base]);",
          "new_line_content": "\t\tbase = spu->scaled_stride * y + x;",
          "content_same": false
        },
        {
          "line": 558,
          "old_api": "mp_msg",
          "new_api": null,
          "old_text": "mp_msg(MSGT_SPUDEC,MSGL_WARN,\"SPUasm: invalid fragment\\n\")",
          "new_text": null,
          "old_line_content": "      mp_msg(MSGT_SPUDEC,MSGL_WARN,\"SPUasm: invalid fragment\\n\");",
          "new_line_content": "      spu->packet_offset += len;",
          "content_same": false
        },
        {
          "line": 562,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(spu->packet + spu->packet_offset, packet, len)",
          "new_text": null,
          "old_line_content": "      memcpy(spu->packet + spu->packet_offset, packet, len);",
          "new_line_content": "  // check if we have a complete packet (unfortunatelly packet_size is bad",
          "content_same": false
        },
        {
          "line": 1084,
          "old_api": "memset",
          "new_api": null,
          "old_text": "memset(spu->scaled_aimage + y * spu->scaled_stride + spu->scaled_width, 0,\n\t\t     spu->scaled_stride - spu->scaled_width)",
          "new_text": null,
          "old_line_content": "\t      memset(spu->scaled_aimage + y * spu->scaled_stride + spu->scaled_width, 0,",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 575,
          "old_api": "mp_msg",
          "new_api": null,
          "old_text": "mp_msg(MSGT_SPUDEC,MSGL_DBG2,\"SPUtest: x=%d y=%d off=%d size=%d\\n\",x,y,spu->packet_offset,spu->packet_size)",
          "new_text": null,
          "old_line_content": "      mp_msg(MSGT_SPUDEC,MSGL_DBG2,\"SPUtest: x=%d y=%d off=%d size=%d\\n\",x,y,spu->packet_offset,spu->packet_size);",
          "new_line_content": "\tspu->packet_offset = 0;",
          "content_same": false
        },
        {
          "line": 578,
          "old_api": "mp_msg",
          "new_api": null,
          "old_text": "mp_msg(MSGT_SPUDEC,MSGL_DBG2,\"SPUgot: off=%d  size=%d \\n\",spu->packet_offset,spu->packet_size)",
          "new_text": null,
          "old_line_content": "\tmp_msg(MSGT_SPUDEC,MSGL_DBG2,\"SPUgot: off=%d  size=%d \\n\",spu->packet_offset,spu->packet_size);",
          "new_line_content": "      if(y<=x || y>=spu->packet_size){ // invalid?",
          "content_same": false
        },
        {
          "line": 584,
          "old_api": "mp_msg",
          "new_api": null,
          "old_text": "mp_msg(MSGT_SPUDEC,MSGL_WARN,\"SPUtest: broken packet!!!!! y=%d < x=%d\\n\",y,x)",
          "new_text": null,
          "old_line_content": "\tmp_msg(MSGT_SPUDEC,MSGL_WARN,\"SPUtest: broken packet!!!!! y=%d < x=%d\\n\",y,x);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 595,
          "old_api": "spudec_decode",
          "new_api": null,
          "old_text": "spudec_decode(spu, pts100)",
          "new_text": null,
          "old_line_content": "    spudec_decode(spu, pts100);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1107,
          "old_api": "draw_alpha",
          "new_api": null,
          "old_text": "draw_alpha(spu->scaled_start_col, spu->scaled_start_row, spu->scaled_width, spu->scaled_height,\n\t\t   spu->scaled_image, spu->scaled_aimage, spu->scaled_stride)",
          "new_text": null,
          "old_line_content": "\tdraw_alpha(spu->scaled_start_col, spu->scaled_start_row, spu->scaled_width, spu->scaled_height,",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 1115,
          "old_api": "mp_msg",
          "new_api": null,
          "old_text": "mp_msg(MSGT_SPUDEC,MSGL_DBG2,\"SPU not displayed: start_pts=%d  end_pts=%d  now_pts=%d\\n\",\n        spu->start_pts, spu->end_pts, spu->now_pts)",
          "new_text": null,
          "old_line_content": "    mp_msg(MSGT_SPUDEC,MSGL_DBG2,\"SPU not displayed: start_pts=%d  end_pts=%d  now_pts=%d\\n\",",
          "new_line_content": "void spudec_update_palette(void * this, unsigned int *palette)",
          "content_same": false
        },
        {
          "line": 605,
          "old_api": "spudec_dequeue_packet",
          "new_api": null,
          "old_text": "spudec_dequeue_packet(spu)",
          "new_text": null,
          "old_line_content": "    spudec_free_packet(spudec_dequeue_packet(spu));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1124,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(spu->global_palette, palette, sizeof(spu->global_palette))",
          "new_text": null,
          "old_line_content": "    memcpy(spu->global_palette, palette, sizeof(spu->global_palette));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1126,
          "old_api": "control",
          "new_api": null,
          "old_text": "spu->hw_spu->control(VOCTRL_SET_SPU_PALETTE,spu->global_palette)",
          "new_text": null,
          "old_line_content": "      spu->hw_spu->control(VOCTRL_SET_SPU_PALETTE,spu->global_palette);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 621,
          "old_api": "compute_palette",
          "new_api": null,
          "old_text": "compute_palette(spu, packet)",
          "new_text": null,
          "old_line_content": "      compute_palette(spu, packet);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 622,
          "old_api": "spudec_process_data",
          "new_api": null,
          "old_text": "spudec_process_data(spu, packet)",
          "new_text": null,
          "old_line_content": "    spudec_process_data(spu, packet);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 623,
          "old_api": "spudec_free_packet",
          "new_api": null,
          "old_text": "spudec_free_packet(packet)",
          "new_text": null,
          "old_line_content": "    spudec_free_packet(packet);",
          "new_line_content": "int spudec_visible(void *this){",
          "content_same": false
        },
        {
          "line": 1151,
          "old_api": "malloc",
          "new_api": null,
          "old_text": "malloc(extradata_len+1)",
          "new_text": null,
          "old_line_content": "  if (!(ptr = buffer = malloc(extradata_len+1)))",
          "new_line_content": "  do {",
          "content_same": false
        },
        {
          "line": 641,
          "old_api": "mp_msg",
          "new_api": null,
          "old_text": "mp_msg(MSGT_SPUDEC,MSGL_DBG2,\"SPU: Display only forced subs now %s\\n\", flag ? \"enabled\": \"disabled\")",
          "new_text": null,
          "old_line_content": "      mp_msg(MSGT_SPUDEC,MSGL_DBG2,\"SPU: Display only forced subs now %s\\n\", flag ? \"enabled\": \"disabled\");",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 1157,
          "old_api": "sscanf",
          "new_api": null,
          "old_text": "sscanf(ptr, \"size: %dx%d\", &this->orig_frame_width, &this->orig_frame_height)",
          "new_text": null,
          "old_line_content": "    sscanf(ptr, \"size: %dx%d\", &this->orig_frame_width, &this->orig_frame_height);",
          "new_line_content": "               &pal[ 8], &pal[ 9], &pal[10], &pal[11],",
          "content_same": false
        },
        {
          "line": 1158,
          "old_api": "sscanf",
          "new_api": null,
          "old_text": "sscanf(ptr, \"palette: %x, %x, %x, %x, %x, %x, %x, %x,\"\n                            \" %x, %x, %x, %x, %x, %x, %x, %x\",\n               &pal[ 0], &pal[ 1], &pal[ 2], &pal[ 3],\n               &pal[ 4], &pal[ 5], &pal[ 6], &pal[ 7],\n               &pal[ 8], &pal[ 9], &pal[10], &pal[11],\n               &pal[12], &pal[13], &pal[14], &pal[15])",
          "new_text": null,
          "old_line_content": "    if (sscanf(ptr, \"palette: %x, %x, %x, %x, %x, %x, %x, %x,\"",
          "new_line_content": "               &pal[12], &pal[13], &pal[14], &pal[15]) == 16) {",
          "content_same": false
        },
        {
          "line": 650,
          "old_api": "draw_alpha",
          "new_api": null,
          "old_text": "draw_alpha(spu->start_col, spu->start_row, spu->width, spu->height,\n\t\t   spu->image, spu->aimage, spu->stride)",
          "new_text": null,
          "old_line_content": "\tdraw_alpha(spu->start_col, spu->start_row, spu->width, spu->height,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1170,
          "old_api": "sscanf",
          "new_api": null,
          "old_text": "sscanf(ptr, \"custom colors: ON, tridx: %x, colors: %x, %x, %x, %x\",\n               &tridx, cuspal+0, cuspal+1, cuspal+2, cuspal+3)",
          "new_text": null,
          "old_line_content": "    if (sscanf(ptr, \"custom colors: ON, tridx: %x, colors: %x, %x, %x, %x\",",
          "new_line_content": "          cuspal[i] |= 1 << 31;",
          "content_same": false
        },
        {
          "line": 1173,
          "old_api": "vobsub_rgb_to_yuv",
          "new_api": null,
          "old_text": "vobsub_rgb_to_yuv(cuspal[i])",
          "new_text": null,
          "old_line_content": "        cuspal[i] = vobsub_rgb_to_yuv(cuspal[i]);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1179,
          "old_api": "strchr",
          "new_api": null,
          "old_text": "strchr(ptr,'\\n')",
          "new_text": null,
          "old_line_content": "  } while ((ptr=strchr(ptr,'\\n')) && *++ptr);",
          "new_line_content": "void *spudec_new_scaled(unsigned int *palette, unsigned int frame_width, unsigned int frame_height, uint8_t *extradata, int extradata_len)",
          "content_same": false
        },
        {
          "line": 1191,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(this->global_palette, palette, sizeof(this->global_palette))",
          "new_text": null,
          "old_line_content": "      memcpy(this->global_palette, palette, sizeof(this->global_palette));",
          "new_line_content": "    /* XXX Although the video frame is some size, the SPU frame is",
          "content_same": false
        },
        {
          "line": 1195,
          "old_api": "spudec_parse_extradata",
          "new_api": null,
          "old_text": "spudec_parse_extradata(this, extradata, extradata_len)",
          "new_text": null,
          "old_line_content": "      spudec_parse_extradata(this, extradata, extradata_len);",
          "new_line_content": "      this->orig_frame_height = 480;",
          "content_same": false
        },
        {
          "line": 1205,
          "old_api": "mp_msg",
          "new_api": null,
          "old_text": "mp_msg(MSGT_SPUDEC,MSGL_FATAL, \"FATAL: spudec_init: calloc\")",
          "new_text": null,
          "old_line_content": "    mp_msg(MSGT_SPUDEC,MSGL_FATAL, \"FATAL: spudec_init: calloc\");",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 1211,
          "old_api": "spudec_new_scaled",
          "new_api": null,
          "old_text": "spudec_new_scaled(palette, 0, 0, NULL, 0)",
          "new_text": null,
          "old_line_content": "    return spudec_new_scaled(palette, 0, 0, NULL, 0);",
          "new_line_content": "  spudec_handle_t *spu = (spudec_handle_t*)this;",
          "content_same": false
        },
        {
          "line": 1219,
          "old_api": "spudec_dequeue_packet",
          "new_api": null,
          "old_text": "spudec_dequeue_packet(spu)",
          "new_text": null,
          "old_line_content": "      spudec_free_packet(spudec_dequeue_packet(spu));",
          "new_line_content": "    if (spu->image)",
          "content_same": false
        },
        {
          "line": 1223,
          "old_api": "free",
          "new_api": null,
          "old_text": "free(spu->scaled_image)",
          "new_text": null,
          "old_line_content": "\tfree(spu->scaled_image);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 1225,
          "old_api": "free",
          "new_api": null,
          "old_text": "free(spu->image)",
          "new_text": null,
          "old_line_content": "      free(spu->image);",
          "new_line_content": "void spudec_set_hw_spu(void *this, const vo_functions_t *hw_spu)",
          "content_same": false
        },
        {
          "line": 1226,
          "old_api": "free",
          "new_api": null,
          "old_text": "free(spu)",
          "new_text": null,
          "old_line_content": "    free(spu);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 1236,
          "old_api": "control",
          "new_api": null,
          "old_text": "hw_spu->control(VOCTRL_SET_SPU_PALETTE,spu->global_palette)",
          "new_text": null,
          "old_line_content": "  hw_spu->control(VOCTRL_SET_SPU_PALETTE,spu->global_palette);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 725,
          "old_api": "FFMIN",
          "new_api": null,
          "old_text": "FFMIN(src >> 16, end_src - 1)",
          "new_text": null,
          "old_line_content": "    table[t].position= FFMIN(src >> 16, end_src - 1);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 222,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(image, this->image + this->stride * first_y, this->image_size)",
          "new_text": null,
          "old_line_content": "    memcpy(image, this->image + this->stride * first_y, this->image_size);",
          "new_line_content": "  } else {",
          "content_same": false
        },
        {
          "line": 224,
          "old_api": "free",
          "new_api": null,
          "old_text": "free(this->image)",
          "new_text": null,
          "old_line_content": "    free(this->image);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 739,
          "old_api": "canon_alpha",
          "new_api": null,
          "old_text": "canon_alpha(spu->aimage[base])",
          "new_text": null,
          "old_line_content": "  alpha[0] = canon_alpha(spu->aimage[base]);",
          "new_line_content": "  color[1] = spu->image[base + 1];",
          "content_same": false
        },
        {
          "line": 228,
          "old_api": "mp_msg",
          "new_api": null,
          "old_text": "mp_msg(MSGT_SPUDEC, MSGL_FATAL, \"Fatal: update_spu: malloc requested %d bytes\\n\", 2 * this->stride * this->height)",
          "new_text": null,
          "old_line_content": "    mp_msg(MSGT_SPUDEC, MSGL_FATAL, \"Fatal: update_spu: malloc requested %d bytes\\n\", 2 * this->stride * this->height);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 740,
          "old_api": "canon_alpha",
          "new_api": null,
          "old_text": "canon_alpha(spu->aimage[base + 1])",
          "new_text": null,
          "old_line_content": "  alpha[1] = canon_alpha(spu->aimage[base + 1]);",
          "new_line_content": "  color[2] = spu->image[base + spu->stride];",
          "content_same": false
        },
        {
          "line": 741,
          "old_api": "canon_alpha",
          "new_api": null,
          "old_text": "canon_alpha(spu->aimage[base + spu->stride])",
          "new_text": null,
          "old_line_content": "  alpha[2] = canon_alpha(spu->aimage[base + spu->stride]);",
          "new_line_content": "  color[3] = spu->image[base + spu->stride + 1];",
          "content_same": false
        },
        {
          "line": 742,
          "old_api": "canon_alpha",
          "new_api": null,
          "old_text": "canon_alpha(spu->aimage[base + spu->stride + 1])",
          "new_text": null,
          "old_line_content": "  alpha[3] = canon_alpha(spu->aimage[base + spu->stride + 1]);",
          "new_line_content": "  scale[0] = (table_x[x].left_up * table_y[y].left_up >> 16) * alpha[0];",
          "content_same": false
        },
        {
          "line": 757,
          "old_api": "FFMIN",
          "new_api": null,
          "old_text": "FFMIN(spu->scaled_image[scaled], spu->scaled_aimage[scaled])",
          "new_text": null,
          "old_line_content": "    spu->scaled_image[scaled] = FFMIN(spu->scaled_image[scaled], spu->scaled_aimage[scaled]);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 247,
          "old_api": "mkalpha",
          "new_api": null,
          "old_text": "mkalpha(packet->alpha[i])",
          "new_text": null,
          "old_line_content": "    alpha[i] = mkalpha(packet->alpha[i]);",
          "new_line_content": "    else if (this->custom){",
          "content_same": false
        },
        {
          "line": 772,
          "old_api": "sws_freeVec",
          "new_api": null,
          "old_text": "sws_freeVec(filter.lumH)",
          "new_text": null,
          "old_line_content": "\tif (!firsttime && oldvar != spu_gaussvar) sws_freeVec(filter.lumH);",
          "new_line_content": "\t\tfirsttime = 0;",
          "content_same": false
        },
        {
          "line": 775,
          "old_api": "sws_getGaussianVec",
          "new_api": null,
          "old_text": "sws_getGaussianVec(spu_gaussvar, 3.0)",
          "new_text": null,
          "old_line_content": "\t\t\tfilter.chrH = filter.chrV = sws_getGaussianVec(spu_gaussvar, 3.0);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 266,
          "old_api": "free",
          "new_api": null,
          "old_text": "free(this->image)",
          "new_text": null,
          "old_line_content": "      free(this->image);",
          "new_line_content": "      this->image_size = this->stride * this->height;",
          "content_same": false
        },
        {
          "line": 269,
          "old_api": "malloc",
          "new_api": null,
          "old_text": "malloc(2 * this->stride * this->height)",
          "new_text": null,
          "old_line_content": "    this->image = malloc(2 * this->stride * this->height);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 782,
          "old_api": "sws_scale",
          "new_api": null,
          "old_text": "sws_scale(ctx,&s1,&ss,0,sh,&d1,&ds)",
          "new_text": null,
          "old_line_content": "\tsws_scale(ctx,&s1,&ss,0,sh,&d1,&ds);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 784,
          "old_api": "sws_scale",
          "new_api": null,
          "old_text": "sws_scale(ctx,&s2,&ss,0,sh,&d2,&ds)",
          "new_text": null,
          "old_line_content": "\tsws_scale(ctx,&s2,&ss,0,sh,&d2,&ds);",
          "new_line_content": "void spudec_draw_scaled(void *me, unsigned int dxs, unsigned int dys, void (*draw_alpha)(int x0,int y0, int w,int h, unsigned char* src, unsigned char *srca, int stride))",
          "content_same": false
        },
        {
          "line": 786,
          "old_api": "sws_freeContext",
          "new_api": null,
          "old_text": "sws_freeContext(ctx)",
          "new_text": null,
          "old_line_content": "\tsws_freeContext(ctx);",
          "new_line_content": "  spudec_handle_t *spu = (spudec_handle_t *)me;",
          "content_same": false
        },
        {
          "line": 281,
          "old_api": "memset",
          "new_api": null,
          "old_text": "memset(this->aimage + y * this->stride + this->width, 0, this->stride - this->width)",
          "new_text": null,
          "old_line_content": "      memset(this->aimage + y * this->stride + this->width, 0, this->stride - this->width);",
          "new_line_content": "  i = packet->current_nibble[1];",
          "content_same": false
        },
        {
          "line": 283,
          "old_api": "memset",
          "new_api": null,
          "old_text": "memset(this->image + y * this->stride + this->width, 0, this->stride - this->width)",
          "new_text": null,
          "old_line_content": "      memset(this->image + y * this->stride + this->width, 0, this->stride - this->width);",
          "new_line_content": "  y = 0;",
          "content_same": false
        },
        {
          "line": 294,
          "old_api": "get_nibble",
          "new_api": null,
          "old_text": "get_nibble(packet)",
          "new_text": null,
          "old_line_content": "    rle = get_nibble(packet);",
          "new_line_content": "\tif (rle < 0x040) {",
          "content_same": false
        },
        {
          "line": 806,
          "old_api": "draw_alpha",
          "new_api": null,
          "old_text": "draw_alpha(spu->start_col, spu->start_row, spu->width, spu->height,\n\t\t   spu->image, spu->aimage, spu->stride)",
          "new_text": null,
          "old_line_content": "\tdraw_alpha(spu->start_col, spu->start_row, spu->width, spu->height,",
          "new_line_content": "    else {",
          "content_same": false
        },
        {
          "line": 296,
          "old_api": "get_nibble",
          "new_api": null,
          "old_text": "get_nibble(packet)",
          "new_text": null,
          "old_line_content": "      rle = (rle << 4) | get_nibble(packet);",
          "new_line_content": "\t  if (rle < 0x0004)",
          "content_same": false
        },
        {
          "line": 298,
          "old_api": "get_nibble",
          "new_api": null,
          "old_text": "get_nibble(packet)",
          "new_text": null,
          "old_line_content": "\trle = (rle << 4) | get_nibble(packet);",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 300,
          "old_api": "get_nibble",
          "new_api": null,
          "old_text": "get_nibble(packet)",
          "new_text": null,
          "old_line_content": "\t  rle = (rle << 4) | get_nibble(packet);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 311,
          "old_api": "memset",
          "new_api": null,
          "old_text": "memset(this->image + y * this->stride + x, cmap[color], len)",
          "new_text": null,
          "old_line_content": "    memset(this->image + y * this->stride + x, cmap[color], len);",
          "new_line_content": "      x = 0;",
          "content_same": false
        },
        {
          "line": 312,
          "old_api": "memset",
          "new_api": null,
          "old_text": "memset(this->aimage + y * this->stride + x, alpha[color], len)",
          "new_text": null,
          "old_line_content": "    memset(this->aimage + y * this->stride + x, alpha[color], len);",
          "new_line_content": "      ++y;",
          "content_same": false
        },
        {
          "line": 826,
          "old_api": "free",
          "new_api": null,
          "old_text": "free(spu->scaled_image)",
          "new_text": null,
          "old_line_content": "\t    free(spu->scaled_image);",
          "new_line_content": "\t    spu->scaled_image_size = spu->scaled_stride * spu->scaled_height;",
          "content_same": false
        },
        {
          "line": 829,
          "old_api": "malloc",
          "new_api": null,
          "old_text": "malloc(2 * spu->scaled_stride * spu->scaled_height)",
          "new_text": null,
          "old_line_content": "\t  spu->scaled_image = malloc(2 * spu->scaled_stride * spu->scaled_height);",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 320,
          "old_api": "spudec_cut_image",
          "new_api": null,
          "old_text": "spudec_cut_image(this)",
          "new_text": null,
          "old_line_content": "  spudec_cut_image(this);",
          "new_line_content": "  This function tries to create a usable palette.",
          "content_same": false
        },
        {
          "line": 335,
          "old_api": "memset",
          "new_api": null,
          "old_text": "memset(used, 0, sizeof(used))",
          "new_text": null,
          "old_line_content": "  memset(used, 0, sizeof(used));",
          "new_line_content": "    if (used[i]) cused++;",
          "content_same": false
        },
        {
          "line": 850,
          "old_api": "mp_msg",
          "new_api": null,
          "old_text": "mp_msg(MSGT_SPUDEC, MSGL_FATAL, \"Fatal: spudec_draw_scaled: calloc failed\\n\")",
          "new_text": null,
          "old_line_content": "\t    mp_msg(MSGT_SPUDEC, MSGL_FATAL, \"Fatal: spudec_draw_scaled: calloc failed\\n\");",
          "new_line_content": "\t    for (x = 0; x < spu->scaled_width; x++)",
          "content_same": false
        },
        {
          "line": 856,
          "old_api": "scale_image",
          "new_api": null,
          "old_text": "scale_image(x, y, table_x, table_y, spu)",
          "new_text": null,
          "old_line_content": "\t      scale_image(x, y, table_x, table_y, spu);",
          "new_line_content": "\t  /* no antialiasing */",
          "content_same": false
        },
        {
          "line": 857,
          "old_api": "free",
          "new_api": null,
          "old_text": "free(table_x)",
          "new_text": null,
          "old_line_content": "\t  free(table_x);",
          "new_line_content": "\t  for (y = 0; y < spu->scaled_height; ++y) {",
          "content_same": false
        },
        {
          "line": 858,
          "old_api": "free",
          "new_api": null,
          "old_text": "free(table_y)",
          "new_text": null,
          "old_line_content": "\t  free(table_y);",
          "new_line_content": "\t    int unscaled_y = y * 0x100 / scaley;",
          "content_same": false
        },
        {
          "line": 349,
          "old_api": "memset",
          "new_api": null,
          "old_text": "memset(used, 0, sizeof(used))",
          "new_text": null,
          "old_line_content": "  memset(used, 0, sizeof(used));",
          "new_line_content": "       this->global_palette[color] = start<<16;",
          "content_same": false
        },
        {
          "line": 893,
          "old_api": "canon_alpha",
          "new_api": null,
          "old_text": "canon_alpha(spu->aimage[base])",
          "new_text": null,
          "old_line_content": "\t\t    tmp = canon_alpha(spu->aimage[base]);",
          "new_line_content": "\t\tspu->scaled_image[base] = alpha ? color / alpha : 0;",
          "content_same": false
        },
        {
          "line": 385,
          "old_api": "get_be16",
          "new_api": null,
          "old_text": "get_be16(this->packet + start_off + 2)",
          "new_text": null,
          "old_line_content": "    next_off = get_be16(this->packet + start_off + 2);",
          "new_line_content": "      switch(type) {",
          "content_same": false
        },
        {
          "line": 386,
          "old_api": "mp_msg",
          "new_api": null,
          "old_text": "mp_msg(MSGT_SPUDEC,MSGL_DBG2, \"date=%d\\n\", date)",
          "new_text": null,
          "old_line_content": "    mp_msg(MSGT_SPUDEC,MSGL_DBG2, \"date=%d\\n\", date);",
          "new_line_content": "      case 0x00:",
          "content_same": false
        },
        {
          "line": 389,
          "old_api": "mp_msg",
          "new_api": null,
          "old_text": "mp_msg(MSGT_SPUDEC,MSGL_DBG2, \"cmd=%d  \",type)",
          "new_text": null,
          "old_line_content": "      mp_msg(MSGT_SPUDEC,MSGL_DBG2, \"cmd=%d  \",type);",
          "new_line_content": "        /* shouldn't a Menu ID type force display start? */",
          "content_same": false
        },
        {
          "line": 393,
          "old_api": "mp_msg",
          "new_api": null,
          "old_text": "mp_msg(MSGT_SPUDEC,MSGL_DBG2,\"Menu ID\\n\")",
          "new_text": null,
          "old_line_content": "\tmp_msg(MSGT_SPUDEC,MSGL_DBG2,\"Menu ID\\n\");",
          "new_line_content": "\tthis->is_forced_sub=~0; // current subtitle is forced",
          "content_same": false
        },
        {
          "line": 402,
          "old_api": "mp_msg",
          "new_api": null,
          "old_text": "mp_msg(MSGT_SPUDEC,MSGL_DBG2,\"Start display!\\n\")",
          "new_text": null,
          "old_line_content": "\tmp_msg(MSGT_SPUDEC,MSGL_DBG2,\"Start display!\\n\");",
          "new_line_content": "\tbreak;",
          "content_same": false
        },
        {
          "line": 410,
          "old_api": "mp_msg",
          "new_api": null,
          "old_text": "mp_msg(MSGT_SPUDEC,MSGL_DBG2,\"Stop display!\\n\")",
          "new_text": null,
          "old_line_content": "\tmp_msg(MSGT_SPUDEC,MSGL_DBG2,\"Stop display!\\n\");",
          "new_line_content": "\tthis->palette[0] = this->packet[off] >> 4;",
          "content_same": false
        },
        {
          "line": 419,
          "old_api": "mp_msg",
          "new_api": null,
          "old_text": "mp_msg(MSGT_SPUDEC,MSGL_DBG2,\"Palette %d, %d, %d, %d\\n\",\n\t       this->palette[0], this->palette[1], this->palette[2], this->palette[3])",
          "new_text": null,
          "old_line_content": "\tmp_msg(MSGT_SPUDEC,MSGL_DBG2,\"Palette %d, %d, %d, %d\\n\",",
          "new_line_content": "\t/* Alpha */",
          "content_same": false
        },
        {
          "line": 429,
          "old_api": "mp_msg",
          "new_api": null,
          "old_text": "mp_msg(MSGT_SPUDEC,MSGL_DBG2,\"Alpha %d, %d, %d, %d\\n\",\n\t       this->alpha[0], this->alpha[1], this->alpha[2], this->alpha[3])",
          "new_text": null,
          "old_line_content": "\tmp_msg(MSGT_SPUDEC,MSGL_DBG2,\"Alpha %d, %d, %d, %d\\n\",",
          "new_line_content": "\t/* Co-ords */",
          "content_same": false
        },
        {
          "line": 435,
          "old_api": "get_be24",
          "new_api": null,
          "old_text": "get_be24(this->packet + off)",
          "new_text": null,
          "old_line_content": "\ta = get_be24(this->packet + off);",
          "new_line_content": "\tstride = (width + 7) & ~7; /* Kludge: draw_alpha needs width multiple of 8 */",
          "content_same": false
        },
        {
          "line": 436,
          "old_api": "get_be24",
          "new_api": null,
          "old_text": "get_be24(this->packet + off + 3)",
          "new_text": null,
          "old_line_content": "\tb = get_be24(this->packet + off + 3);",
          "new_line_content": "\tstart_row = b >> 12;",
          "content_same": false
        },
        {
          "line": 444,
          "old_api": "mp_msg",
          "new_api": null,
          "old_text": "mp_msg(MSGT_SPUDEC,MSGL_DBG2,\"Coords  col: %d - %d  row: %d - %d  (%dx%d)\\n\",\n\t       start_col, end_col, start_row, end_row,\n\t       width, height)",
          "new_text": null,
          "old_line_content": "\tmp_msg(MSGT_SPUDEC,MSGL_DBG2,\"Coords  col: %d - %d  row: %d - %d  (%dx%d)\\n\",",
          "new_line_content": "      case 0x06:",
          "content_same": false
        },
        {
          "line": 958,
          "old_api": "FFMIN",
          "new_api": null,
          "old_text": "FFMIN(unscaled_y_bottom, unscaled_y + 1.0)",
          "new_text": null,
          "old_line_content": "\t      const unsigned int top_low_row = FFMIN(unscaled_y_bottom, unscaled_y + 1.0);",
          "new_line_content": "\t      const double bottom = unscaled_y_bottom > top_low_row",
          "content_same": false
        },
        {
          "line": 451,
          "old_api": "get_be16",
          "new_api": null,
          "old_text": "get_be16(this->packet + off)",
          "new_text": null,
          "old_line_content": "\tcurrent_nibble[0] = 2 * get_be16(this->packet + off);",
          "new_line_content": "\tbreak;",
          "content_same": false
        },
        {
          "line": 452,
          "old_api": "get_be16",
          "new_api": null,
          "old_text": "get_be16(this->packet + off + 2)",
          "new_text": null,
          "old_line_content": "\tcurrent_nibble[1] = 2 * get_be16(this->packet + off + 2);",
          "new_line_content": "      case 0xff:",
          "content_same": false
        },
        {
          "line": 453,
          "old_api": "mp_msg",
          "new_api": null,
          "old_text": "mp_msg(MSGT_SPUDEC,MSGL_DBG2,\"Graphic offset 1: %d  offset 2: %d\\n\",\n\t       current_nibble[0] / 2, current_nibble[1] / 2)",
          "new_text": null,
          "old_line_content": "\tmp_msg(MSGT_SPUDEC,MSGL_DBG2,\"Graphic offset 1: %d  offset 2: %d\\n\",",
          "new_line_content": "\t/* All done, bye-bye */",
          "content_same": false
        },
        {
          "line": 969,
          "old_api": "FFMIN",
          "new_api": null,
          "old_text": "FFMIN(unscaled_x_right, unscaled_x + 1.0)",
          "new_text": null,
          "old_line_content": "\t\tconst unsigned int left_right_column = FFMIN(unscaled_x_right, unscaled_x + 1.0);",
          "new_line_content": "\t\tconst double right = unscaled_x_right > left_right_column",
          "content_same": false
        },
        {
          "line": 459,
          "old_api": "mp_msg",
          "new_api": null,
          "old_text": "mp_msg(MSGT_SPUDEC,MSGL_DBG2,\"Done!\\n\")",
          "new_text": null,
          "old_line_content": "\tmp_msg(MSGT_SPUDEC,MSGL_DBG2,\"Done!\\n\");",
          "new_line_content": "\t       type, next_off - off);",
          "content_same": false
        },
        {
          "line": 463,
          "old_api": "mp_msg",
          "new_api": null,
          "old_text": "mp_msg(MSGT_SPUDEC,MSGL_WARN,\"spudec: Error determining control type 0x%02x.  Skipping %d bytes.\\n\",\n\t       type, next_off - off)",
          "new_text": null,
          "old_line_content": "\tmp_msg(MSGT_SPUDEC,MSGL_WARN,\"spudec: Error determining control type 0x%02x.  Skipping %d bytes.\\n\",",
          "new_line_content": "  next_control:",
          "content_same": false
        },
        {
          "line": 975,
          "old_api": "floor",
          "new_api": null,
          "old_text": "floor(unscaled_x_right)",
          "new_text": null,
          "old_line_content": "\t\t  ? unscaled_x_right - floor(unscaled_x_right)",
          "new_line_content": "\t\tunsigned int base;",
          "content_same": false
        },
        {
          "line": 472,
          "old_api": "get_be16",
          "new_api": null,
          "old_text": "get_be16(this->packet + next_off)",
          "new_text": null,
          "old_line_content": "      end_pts = get_be16(this->packet + next_off) * 1024;",
          "new_line_content": "      int i;",
          "content_same": false
        },
        {
          "line": 476,
          "old_api": "calloc",
          "new_api": null,
          "old_text": "calloc(1, sizeof(packet_t))",
          "new_text": null,
          "old_line_content": "      packet_t *packet = calloc(1, sizeof(packet_t));",
          "new_line_content": "      packet->current_nibble[1] = current_nibble[1];",
          "content_same": false
        },
        {
          "line": 990,
          "old_api": "canon_alpha",
          "new_api": null,
          "old_text": "canon_alpha(spu->aimage[base + (unsigned int) unscaled_x])",
          "new_text": null,
          "old_line_content": "\t\ttmp = left * top * canon_alpha(spu->aimage[base + (unsigned int) unscaled_x]);",
          "new_line_content": "\t\t  unsigned int walkx;",
          "content_same": false
        },
        {
          "line": 998,
          "old_api": "canon_alpha",
          "new_api": null,
          "old_text": "canon_alpha(spu->aimage[base])",
          "new_text": null,
          "old_line_content": "\t\t    tmp = /* 1.0 * */ top * canon_alpha(spu->aimage[base]);",
          "new_line_content": "\t\t/* 3: top right part */",
          "content_same": false
        },
        {
          "line": 494,
          "old_api": "malloc",
          "new_api": null,
          "old_text": "malloc(this->packet_size)",
          "new_text": null,
          "old_line_content": "      packet->packet = malloc(this->packet_size);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 495,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(packet->packet, this->packet, this->packet_size)",
          "new_text": null,
          "old_line_content": "      memcpy(packet->packet, this->packet, this->packet_size);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 496,
          "old_api": "spudec_queue_packet",
          "new_api": null,
          "old_text": "spudec_queue_packet(this, packet)",
          "new_text": null,
          "old_line_content": "      spudec_queue_packet(this, packet);",
          "new_line_content": "static void spudec_decode(spudec_handle_t *this, int pts100)",
          "content_same": false
        },
        {
          "line": 1006,
          "old_api": "canon_alpha",
          "new_api": null,
          "old_text": "canon_alpha(spu->aimage[base])",
          "new_text": null,
          "old_line_content": "\t\t  tmp = right * top * canon_alpha(spu->aimage[base]);",
          "new_line_content": "\t\tif (height > 0) {",
          "content_same": false
        },
        {
          "line": 1015,
          "old_api": "canon_alpha",
          "new_api": null,
          "old_text": "canon_alpha(spu->aimage[base])",
          "new_text": null,
          "old_line_content": "\t\t    tmp = left /* * 1.0 */ * canon_alpha(spu->aimage[base]);",
          "new_line_content": "\t\t/* 5: center part */",
          "content_same": false
        },
        {
          "line": 504,
          "old_api": "spudec_process_control",
          "new_api": null,
          "old_text": "spudec_process_control(this, pts100)",
          "new_text": null,
          "old_line_content": "    spudec_process_control(this, pts100);",
          "new_line_content": "    packet.size = this->packet_size;",
          "content_same": false
        },
        {
          "line": 511,
          "old_api": "draw_frame",
          "new_api": null,
          "old_text": "this->hw_spu->draw_frame((uint8_t**)&pkg)",
          "new_text": null,
          "old_line_content": "    this->hw_spu->draw_frame((uint8_t**)&pkg);",
          "new_line_content": "{",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 22,
      "total_additions": 108,
      "total_deletions": 108,
      "total_api_changes": 238
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 8,
        "api_related_lines": 238,
        "non_api_lines": 8,
        "non_api_line_numbers": [
          178,
          179,
          180,
          181,
          182,
          183,
          184,
          185
        ]
      }
    },
    "api_calls_before": 138,
    "api_calls_after": 138,
    "diff_info": {
      "added_lines": 3,
      "removed_lines": 8,
      "total_diff_lines": 23
    }
  }
}