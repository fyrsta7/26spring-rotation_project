{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/5e4ff93c817c287ddee4ae266d0e14ddca3d0dc4",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/5e4ff93c817c287ddee4ae266d0e14ddca3d0dc4/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/5e4ff93c817c287ddee4ae266d0e14ddca3d0dc4/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/5e4ff93c817c287ddee4ae266d0e14ddca3d0dc4/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 188,
          "old_api": "copy_mpi",
          "new_api": "alloc_mpi",
          "old_text": "copy_mpi(pause_mpi,mpi)",
          "new_text": "alloc_mpi(mpi->w,mpi->h,mpi->imgfmt)",
          "old_line_content": "    copy_mpi(pause_mpi,mpi);",
          "new_line_content": "      pause_mpi = alloc_mpi(mpi->w,mpi->h,mpi->imgfmt);",
          "content_same": false
        },
        {
          "line": 189,
          "old_api": "mp_input_parse_cmd",
          "new_api": "copy_mpi",
          "old_text": "mp_input_parse_cmd(\"pause\")",
          "new_text": "copy_mpi(pause_mpi,mpi)",
          "old_line_content": "    mp_input_queue_cmd(mp_input_parse_cmd(\"pause\"));",
          "new_line_content": "    copy_mpi(pause_mpi,mpi);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 257,
          "old_api": null,
          "new_api": "mp_input_add_cmd_filter",
          "old_text": null,
          "new_text": "mp_input_add_cmd_filter((mp_input_cmd_filter)cmd_filter,st_priv)",
          "old_line_content": "  \"menu\",",
          "new_line_content": "    mp_input_add_cmd_filter((mp_input_cmd_filter)cmd_filter,st_priv);",
          "content_same": false
        },
        {
          "line": 226,
          "old_api": null,
          "new_api": "vf_next_put_image",
          "old_text": null,
          "new_text": "vf_next_put_image(vf,dmpi)",
          "old_line_content": "    force_load_font = 0;",
          "new_line_content": "  return vf_next_put_image(vf,dmpi);",
          "content_same": false
        },
        {
          "line": 232,
          "old_api": null,
          "new_api": "free_mp_image",
          "old_text": null,
          "new_text": "free_mp_image(pause_mpi)",
          "old_line_content": "static int open(vf_instance_t *vf, char* args){",
          "new_line_content": "       free_mp_image(pause_mpi);",
          "content_same": false
        },
        {
          "line": 204,
          "old_api": null,
          "new_api": "vf_get_image",
          "old_text": null,
          "new_text": "vf_get_image(vf->next,mpi->imgfmt,\n\t\t\tMP_IMGTYPE_TEMP, MP_IMGFLAG_ACCEPT_STRIDE,\n\t\t\tmpi->w,mpi->h)",
          "old_line_content": "\t\t\tMP_IMGTYPE_TEMP, MP_IMGFLAG_ACCEPT_STRIDE,",
          "new_line_content": "    dmpi = vf_get_image(vf->next,mpi->imgfmt,",
          "content_same": false
        },
        {
          "line": 173,
          "old_api": null,
          "new_api": "menu_close",
          "old_text": null,
          "new_text": "menu_close(m)",
          "old_line_content": "  }",
          "new_line_content": "    menu_close(m);",
          "content_same": false
        },
        {
          "line": 207,
          "old_api": null,
          "new_api": "copy_mpi",
          "old_text": null,
          "new_text": "copy_mpi(dmpi,mpi)",
          "old_line_content": "  }",
          "new_line_content": "    copy_mpi(dmpi,mpi);",
          "content_same": false
        },
        {
          "line": 209,
          "old_api": null,
          "new_api": "menu_draw",
          "old_text": null,
          "new_text": "menu_draw(vf->priv->current,dmpi)",
          "old_line_content": "",
          "new_line_content": "  menu_draw(vf->priv->current,dmpi);",
          "content_same": false
        },
        {
          "line": 243,
          "old_api": null,
          "new_api": "load_font",
          "old_text": null,
          "new_text": "load_font(width,height)",
          "old_line_content": "",
          "new_line_content": "    load_font(width,height);",
          "content_same": false
        },
        {
          "line": 214,
          "old_api": null,
          "new_api": "vf_get_image",
          "old_text": null,
          "new_text": "vf_get_image(vf->next,mpi->imgfmt,\n\t\t\tMP_IMGTYPE_EXPORT, MP_IMGFLAG_ACCEPT_STRIDE,\n\t\t\tmpi->w,mpi->h)",
          "old_line_content": "     vf->priv=NULL;",
          "new_line_content": "    dmpi = vf_get_image(vf->next,mpi->imgfmt,",
          "content_same": false
        },
        {
          "line": 246,
          "old_api": null,
          "new_api": "vf_next_config",
          "old_text": null,
          "new_text": "vf_next_config(vf,width,height,d_width,d_height,flags,outfmt)",
          "old_line_content": "  vf->get_image = get_image;",
          "new_line_content": "  return vf_next_config(vf,width,height,d_width,d_height,flags,outfmt);",
          "content_same": false
        },
        {
          "line": 184,
          "old_api": null,
          "new_api": "free_mp_image",
          "old_text": null,
          "new_text": "free_mp_image(pause_mpi)",
          "old_line_content": "      pause_mpi = NULL;",
          "new_line_content": "      free_mp_image(pause_mpi);",
          "content_same": false
        },
        {
          "line": 250,
          "old_api": null,
          "new_api": "calloc",
          "old_text": null,
          "new_text": "calloc(1,sizeof(struct vf_priv_s))",
          "old_line_content": "",
          "new_line_content": "    st_priv = calloc(1,sizeof(struct vf_priv_s));",
          "content_same": false
        },
        {
          "line": 251,
          "old_api": null,
          "new_api": "menu_open",
          "old_text": null,
          "new_text": "menu_open(args)",
          "old_line_content": "  return 1;",
          "new_line_content": "    st_priv->root = st_priv->current = menu_open(args);",
          "content_same": false
        },
        {
          "line": 253,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free(st_priv)",
          "old_line_content": "",
          "new_line_content": "      free(st_priv);",
          "content_same": false
        },
        {
          "line": 190,
          "old_api": null,
          "new_api": "mp_input_parse_cmd",
          "old_text": null,
          "new_text": "mp_input_parse_cmd(\"pause\")",
          "old_line_content": "    go2pause = 2;",
          "new_line_content": "    mp_input_queue_cmd(mp_input_parse_cmd(\"pause\"));",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 227,
          "old_api": "load_font",
          "new_api": null,
          "old_text": "load_font(width,height)",
          "new_text": null,
          "old_line_content": "    load_font(width,height);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 230,
          "old_api": "vf_next_config",
          "new_api": null,
          "old_text": "vf_next_config(vf,width,height,d_width,d_height,flags,outfmt)",
          "new_text": null,
          "old_line_content": "  return vf_next_config(vf,width,height,d_width,d_height,flags,outfmt);",
          "new_line_content": "     vf->priv=NULL;",
          "content_same": false
        },
        {
          "line": 234,
          "old_api": "calloc",
          "new_api": null,
          "old_text": "calloc(1,sizeof(struct vf_priv_s))",
          "new_text": null,
          "old_line_content": "    st_priv = calloc(1,sizeof(struct vf_priv_s));",
          "new_line_content": "     }",
          "content_same": false
        },
        {
          "line": 203,
          "old_api": "vf_get_image",
          "new_api": null,
          "old_text": "vf_get_image(vf->next,mpi->imgfmt,\n\t\t\tMP_IMGTYPE_TEMP, MP_IMGFLAG_ACCEPT_STRIDE,\n\t\t\tmpi->w,mpi->h)",
          "new_text": null,
          "old_line_content": "    dmpi = vf_get_image(vf->next,mpi->imgfmt,",
          "new_line_content": "  else {",
          "content_same": false
        },
        {
          "line": 172,
          "old_api": "menu_close",
          "new_api": null,
          "old_text": "menu_close(m)",
          "new_text": null,
          "old_line_content": "    menu_close(m);",
          "new_line_content": "    vf->priv->current = m->parent ? m->parent :  vf->priv->root;",
          "content_same": false
        },
        {
          "line": 235,
          "old_api": "menu_open",
          "new_api": null,
          "old_text": "menu_open(args)",
          "new_text": null,
          "old_line_content": "    st_priv->root = st_priv->current = menu_open(args);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 206,
          "old_api": "copy_mpi",
          "new_api": null,
          "old_text": "copy_mpi(dmpi,mpi)",
          "new_text": null,
          "old_line_content": "    copy_mpi(dmpi,mpi);",
          "new_line_content": "\t\t\tmpi->w,mpi->h);",
          "content_same": false
        },
        {
          "line": 237,
          "old_api": "free",
          "new_api": null,
          "old_text": "free(st_priv)",
          "new_text": null,
          "old_line_content": "      free(st_priv);",
          "new_line_content": "static int config(struct vf_instance_s* vf, int width, int height, int d_width, int d_height,",
          "content_same": false
        },
        {
          "line": 208,
          "old_api": "menu_draw",
          "new_api": null,
          "old_text": "menu_draw(vf->priv->current,dmpi)",
          "new_text": null,
          "old_line_content": "  menu_draw(vf->priv->current,dmpi);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 241,
          "old_api": "mp_input_add_cmd_filter",
          "new_api": null,
          "old_text": "mp_input_add_cmd_filter((mp_input_cmd_filter)cmd_filter,st_priv)",
          "new_text": null,
          "old_line_content": "    mp_input_add_cmd_filter((mp_input_cmd_filter)cmd_filter,st_priv);",
          "new_line_content": "  if (force_load_font) {",
          "content_same": false
        },
        {
          "line": 210,
          "old_api": "vf_next_put_image",
          "new_api": null,
          "old_text": "vf_next_put_image(vf,dmpi)",
          "new_text": null,
          "old_line_content": "  return vf_next_put_image(vf,dmpi);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 183,
          "old_api": "free_mp_image",
          "new_api": null,
          "old_text": "free_mp_image(pause_mpi)",
          "new_text": null,
          "old_line_content": "      free_mp_image(pause_mpi);",
          "new_line_content": "\t\t     mpi->imgfmt != pause_mpi->imgfmt)) {",
          "content_same": false
        },
        {
          "line": 216,
          "old_api": "free_mp_image",
          "new_api": null,
          "old_text": "free_mp_image(pause_mpi)",
          "new_text": null,
          "old_line_content": "       free_mp_image(pause_mpi);",
          "new_line_content": "\t\t\tmpi->w,mpi->h);",
          "content_same": false
        },
        {
          "line": 187,
          "old_api": "alloc_mpi",
          "new_api": null,
          "old_text": "alloc_mpi(mpi->w,mpi->h,mpi->imgfmt)",
          "new_text": null,
          "old_line_content": "      pause_mpi = alloc_mpi(mpi->w,mpi->h,mpi->imgfmt);",
          "new_line_content": "    if(!pause_mpi)",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 2,
      "total_additions": 15,
      "total_deletions": 14,
      "total_api_changes": 31
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 16,
        "api_related_lines": 31,
        "non_api_lines": 14,
        "non_api_line_numbers": [
          224,
          225,
          168,
          211,
          212,
          213,
          215,
          217,
          218,
          219,
          220,
          221,
          222,
          223
        ]
      }
    },
    "api_calls_before": 43,
    "api_calls_after": 44,
    "diff_info": {
      "added_lines": 16,
      "removed_lines": 0,
      "total_diff_lines": 35
    }
  }
}