{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/c0ca5f1a37a8e779337503d90e7ed2f0257d61f1",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/c0ca5f1a37a8e779337503d90e7ed2f0257d61f1/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/c0ca5f1a37a8e779337503d90e7ed2f0257d61f1/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/c0ca5f1a37a8e779337503d90e7ed2f0257d61f1/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 490,
          "old_api": "w_thread_loop_get_loop",
          "new_api": "w_context_new",
          "old_text": "w_thread_loop_get_loop(p->loop),",
          "new_text": "w_context_new(\n            pw_thread_loop_get_loop(p->loop),\n            pw_properties_new(PW_KEY_CONFIG_NAME, \"client-rt.conf\", NULL),\n            0);",
          "old_line_content": "    context = pw_context_new(pw_thread_loop_get_loop(p->loop), NULL, 0);",
          "new_line_content": "    context = pw_context_new(",
          "content_same": false
        },
        {
          "line": 499,
          "old_api": "P_MSG",
          "new_api": "w_properties_new",
          "old_text": "P_MSG(ao, ao->probing ? MSGL_V : MSGL_ERR,\n               \"Could not connect to context '%s': %s\\n\",\n               p->options.remote, strerror(errno));",
          "new_text": "w_properties_new(PW_KEY_REMOTE_NAME, p->options.remote, NULL),",
          "old_line_content": "        MP_MSG(ao, ao->probing ? MSGL_V : MSGL_ERR,",
          "new_line_content": "            pw_properties_new(PW_KEY_REMOTE_NAME, p->options.remote, NULL),",
          "content_same": false
        },
        {
          "line": 502,
          "old_api": "w_context_destroy",
          "new_api": "P_MSG",
          "old_text": "w_context_destroy(context);",
          "new_text": "P_MSG(ao, ao->probing ? MSGL_V : MSGL_ERR,\n               \"Could not connect to context '%s': %s\\n\",\n               p->options.remote, strerror(errno));",
          "old_line_content": "        pw_context_destroy(context);",
          "new_line_content": "        MP_MSG(ao, ao->probing ? MSGL_V : MSGL_ERR,",
          "content_same": false
        },
        {
          "line": 509,
          "old_api": "w_thread_loop_unlock",
          "new_api": "w_core_add_listener",
          "old_text": "w_thread_loop_unlock(p->loop);",
          "new_text": "w_core_add_listener(p->core, &p->core_listener, &core_events, ao) ",
          "old_line_content": "    pw_thread_loop_unlock(p->loop);",
          "new_line_content": "    if (pw_core_add_listener(p->core, &p->core_listener, &core_events, ao) < 0)",
          "content_same": false
        },
        {
          "line": 512,
          "old_api": "P_VERBOSE",
          "new_api": "w_thread_loop_unlock",
          "old_text": "P_VERBOSE(ao, \"PipeWire does not have any audio sinks, skipping\\n\");",
          "new_text": "w_thread_loop_unlock(p->loop);",
          "old_line_content": "        MP_VERBOSE(ao, \"PipeWire does not have any audio sinks, skipping\\n\");",
          "new_line_content": "    pw_thread_loop_unlock(p->loop);",
          "content_same": false
        },
        {
          "line": 571,
          "old_api": "f_fmt_to_pw",
          "new_api": "w_properties_setf",
          "old_text": "f_fmt_to_pw(ao, ao->format);",
          "new_text": "w_properties_setf(props, PW_KEY_NODE_LATENCY, \"%d/%d\", ao->device_buffer, ao->samplerate);",
          "old_line_content": "    enum spa_audio_format spa_format = af_fmt_to_pw(ao, ao->format);",
          "new_line_content": "    pw_properties_setf(props, PW_KEY_NODE_LATENCY, \"%d/%d\", ao->device_buffer, ao->samplerate);",
          "content_same": false
        },
        {
          "line": 598,
          "old_api": "w_thread_loop_lock",
          "new_api": "f_fmt_to_bytes",
          "old_text": "w_thread_loop_lock(p->loop);",
          "new_text": "f_fmt_to_bytes(ao->format);",
          "old_line_content": "    pw_thread_loop_lock(p->loop);",
          "new_line_content": "        ao->sstride = ao->channels.num * af_fmt_to_bytes(ao->format);",
          "content_same": false
        },
        {
          "line": 644,
          "old_api": "w_thread_loop_unlock",
          "new_api": "w_thread_loop_lock",
          "old_text": "w_thread_loop_unlock(p->loop);",
          "new_text": "w_thread_loop_lock(p->loop);",
          "old_line_content": "    pw_thread_loop_unlock(p->loop);",
          "new_line_content": "    pw_thread_loop_lock(p->loop);",
          "content_same": false
        },
        {
          "line": 690,
          "old_api": "p_volume_to_spa_volume",
          "new_api": "w_stream_set_control",
          "old_text": "p_volume_to_spa_volume(*vol);",
          "new_text": "w_stream_set_control(\n                                    p->stream, SPA_PROP_channelVolumes, n, values, 0))",
          "old_line_content": "                        float value = mp_volume_to_spa_volume(*vol);",
          "new_line_content": "                        ret = CONTROL_RET(pw_stream_set_control(",
          "content_same": false
        },
        {
          "line": 763,
          "old_api": "w_thread_loop_lock",
          "new_api": "s_sink_node",
          "old_text": "w_thread_loop_lock(priv->loop);",
          "new_text": "s_sink_node(type, props))",
          "old_line_content": "    pw_thread_loop_lock(priv->loop);",
          "new_line_content": "    if (!is_sink_node(type, props))",
          "content_same": false
        },
        {
          "line": 766,
          "old_api": "pa_list_init",
          "new_api": "w_thread_loop_lock",
          "old_text": "pa_list_init(&item->node);",
          "new_text": "w_thread_loop_lock(priv->loop);",
          "old_line_content": "    spa_list_init(&item->node);",
          "new_line_content": "    pw_thread_loop_lock(priv->loop);",
          "content_same": false
        },
        {
          "line": 767,
          "old_api": "pa_list_append",
          "new_api": "alloc",
          "old_text": "pa_list_append(&priv->hotplug.sinks, &item->node);",
          "new_text": "alloc(ao, struct id_list);",
          "old_line_content": "    spa_list_append(&priv->hotplug.sinks, &item->node);",
          "new_line_content": "    struct id_list *item = talloc(ao, struct id_list);",
          "content_same": false
        },
        {
          "line": 770,
          "old_api": "o_hotplug_event",
          "new_api": "pa_list_append",
          "old_text": "o_hotplug_event(ao);",
          "new_text": "pa_list_append(&priv->hotplug.sinks, &item->node);",
          "old_line_content": "    ao_hotplug_event(ao);",
          "new_line_content": "    spa_list_append(&priv->hotplug.sinks, &item->node);",
          "content_same": false
        },
        {
          "line": 785,
          "old_api": "pa_list_remove",
          "new_api": "pa_list_for_each",
          "old_text": "pa_list_remove(&e->node);",
          "new_text": "pa_list_for_each(e, &priv->hotplug.sinks, node) ",
          "old_line_content": "            spa_list_remove(&e->node);",
          "new_line_content": "    spa_list_for_each(e, &priv->hotplug.sinks, node) {",
          "content_same": false
        },
        {
          "line": 794,
          "old_api": "o_hotplug_event",
          "new_api": "w_thread_loop_unlock",
          "old_text": "o_hotplug_event(ao);",
          "new_text": "w_thread_loop_unlock(priv->loop);",
          "old_line_content": "        ao_hotplug_event(ao);",
          "new_line_content": "    pw_thread_loop_unlock(priv->loop);",
          "content_same": false
        },
        {
          "line": 814,
          "old_api": "pa_list_init",
          "new_api": "w_thread_loop_lock",
          "old_text": "pa_list_init(&priv->hotplug.sinks);",
          "new_text": "w_thread_loop_lock(priv->loop);",
          "old_line_content": "    spa_list_init(&priv->hotplug.sinks);",
          "new_line_content": "    pw_thread_loop_lock(priv->loop);",
          "content_same": false
        },
        {
          "line": 816,
          "old_api": "w_core_get_registry",
          "new_api": "pa_zero",
          "old_text": "w_core_get_registry(priv->core, PW_VERSION_REGISTRY, 0);",
          "new_text": "pa_zero(priv->hotplug);",
          "old_line_content": "    priv->hotplug.registry = pw_core_get_registry(priv->core, PW_VERSION_REGISTRY, 0);",
          "new_line_content": "    spa_zero(priv->hotplug);",
          "content_same": false
        },
        {
          "line": 843,
          "old_api": "w_proxy_destroy",
          "new_api": "w_thread_loop_lock",
          "old_text": "w_proxy_destroy((struct pw_proxy *)priv->hotplug.registry);",
          "new_text": "w_thread_loop_lock(priv->loop);",
          "old_line_content": "    pw_proxy_destroy((struct pw_proxy *)priv->hotplug.registry);",
          "new_line_content": "    pw_thread_loop_lock(priv->loop);",
          "content_same": false
        },
        {
          "line": 845,
          "old_api": "w_thread_loop_unlock",
          "new_api": "pa_hook_remove",
          "old_text": "w_thread_loop_unlock(priv->loop);",
          "new_text": "pa_hook_remove(&priv->hotplug.registry_listener);",
          "old_line_content": "    pw_thread_loop_unlock(priv->loop);",
          "new_line_content": "    spa_hook_remove(&priv->hotplug.registry_listener);",
          "content_same": false
        },
        {
          "line": 846,
          "old_api": "ninit",
          "new_api": "w_proxy_destroy",
          "old_text": "ninit(ao);",
          "new_text": "w_proxy_destroy((struct pw_proxy *)priv->hotplug.registry);",
          "old_line_content": "    uninit(ao);",
          "new_line_content": "    pw_proxy_destroy((struct pw_proxy *)priv->hotplug.registry);",
          "content_same": false
        },
        {
          "line": 854,
          "old_api": "P_WARN",
          "new_api": "o_device_list_add",
          "old_text": "P_WARN(ao, \"Could not list devices, list may be incomplete\\n\");",
          "new_text": "o_device_list_add(list, ao, &(struct ao_device_desc){});",
          "old_line_content": "        MP_WARN(ao, \"Could not list devices, list may be incomplete\\n\");",
          "new_line_content": "    ao_device_list_add(list, ao, &(struct ao_device_desc){});",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 769,
          "old_api": null,
          "new_api": "pa_list_init",
          "old_text": null,
          "new_text": "pa_list_init(&item->node);",
          "old_line_content": "",
          "new_line_content": "    spa_list_init(&item->node);",
          "content_same": false
        },
        {
          "line": 514,
          "old_api": null,
          "new_api": "ession_has_sinks",
          "old_text": null,
          "new_text": "ession_has_sinks(ao))",
          "old_line_content": "    }",
          "new_line_content": "    if (!session_has_sinks(ao)) {",
          "content_same": false
        },
        {
          "line": 515,
          "old_api": null,
          "new_api": "P_VERBOSE",
          "old_text": null,
          "new_text": "P_VERBOSE(ao, \"PipeWire does not have any audio sinks, skipping\\n\");",
          "old_line_content": "",
          "new_line_content": "        MP_VERBOSE(ao, \"PipeWire does not have any audio sinks, skipping\\n\");",
          "content_same": false
        },
        {
          "line": 771,
          "old_api": null,
          "new_api": "w_thread_loop_unlock",
          "old_text": null,
          "new_text": "w_thread_loop_unlock(priv->loop);",
          "old_line_content": "}",
          "new_line_content": "    pw_thread_loop_unlock(priv->loop);",
          "content_same": false
        },
        {
          "line": 645,
          "old_api": null,
          "new_api": "w_stream_set_active",
          "old_text": null,
          "new_text": "w_stream_set_active(p->stream, false);",
          "old_line_content": "}",
          "new_line_content": "    pw_stream_set_active(p->stream, false);",
          "content_same": false
        },
        {
          "line": 646,
          "old_api": null,
          "new_api": "w_stream_flush",
          "old_text": null,
          "new_text": "w_stream_flush(p->stream, false);",
          "old_line_content": "",
          "new_line_content": "    pw_stream_flush(p->stream, false);",
          "content_same": false
        },
        {
          "line": 647,
          "old_api": null,
          "new_api": "w_thread_loop_unlock",
          "old_text": null,
          "new_text": "w_thread_loop_unlock(p->loop);",
          "old_line_content": "static void start(struct ao *ao)",
          "new_line_content": "    pw_thread_loop_unlock(p->loop);",
          "content_same": false
        },
        {
          "line": 773,
          "old_api": null,
          "new_api": "o_hotplug_event",
          "old_text": null,
          "new_text": "o_hotplug_event(ao);",
          "old_line_content": "static void hotplug_registry_global_remove_cb(void *data, uint32_t id)",
          "new_line_content": "    ao_hotplug_event(ao);",
          "content_same": false
        },
        {
          "line": 522,
          "old_api": null,
          "new_api": "w_thread_loop_unlock",
          "old_text": null,
          "new_text": "w_thread_loop_unlock(p->loop);",
          "old_line_content": "",
          "new_line_content": "    pw_thread_loop_unlock(p->loop);",
          "content_same": false
        },
        {
          "line": 653,
          "old_api": null,
          "new_api": "w_thread_loop_lock",
          "old_text": null,
          "new_text": "w_thread_loop_lock(p->loop);",
          "old_line_content": "}",
          "new_line_content": "    pw_thread_loop_lock(p->loop);",
          "content_same": false
        },
        {
          "line": 654,
          "old_api": null,
          "new_api": "w_stream_set_active",
          "old_text": null,
          "new_text": "w_stream_set_active(p->stream, true);",
          "old_line_content": "",
          "new_line_content": "    pw_stream_set_active(p->stream, true);",
          "content_same": false
        },
        {
          "line": 655,
          "old_api": null,
          "new_api": "w_thread_loop_unlock",
          "old_text": null,
          "new_text": "w_thread_loop_unlock(p->loop);",
          "old_line_content": "#define CONTROL_RET(r) (!r ? CONTROL_OK : CONTROL_ERROR)",
          "new_line_content": "    pw_thread_loop_unlock(p->loop);",
          "content_same": false
        },
        {
          "line": 784,
          "old_api": null,
          "new_api": "w_thread_loop_lock",
          "old_text": null,
          "new_text": "w_thread_loop_lock(priv->loop);",
          "old_line_content": "            removed_sink = true;",
          "new_line_content": "    pw_thread_loop_lock(priv->loop);",
          "content_same": false
        },
        {
          "line": 532,
          "old_api": null,
          "new_api": "w_thread_loop_get_time",
          "old_text": null,
          "new_text": "w_thread_loop_get_time(p->loop, &abstime, 50 * SPA_NSEC_PER_MSEC);",
          "old_line_content": "        return;",
          "new_line_content": "    r = pw_thread_loop_get_time(p->loop, &abstime, 50 * SPA_NSEC_PER_MSEC);",
          "content_same": false
        },
        {
          "line": 788,
          "old_api": null,
          "new_api": "pa_list_remove",
          "old_text": null,
          "new_text": "pa_list_remove(&e->node);",
          "old_line_content": "        }",
          "new_line_content": "            spa_list_remove(&e->node);",
          "content_same": false
        },
        {
          "line": 534,
          "old_api": null,
          "new_api": "pa_strerror",
          "old_text": null,
          "new_text": "pa_strerror(r))",
          "old_line_content": "",
          "new_line_content": "        MP_WARN(ao, \"Could not get timeout for initialization: %s\\n\", spa_strerror(r));",
          "content_same": false
        },
        {
          "line": 789,
          "old_api": null,
          "new_api": "alloc_free",
          "old_text": null,
          "new_text": "alloc_free(e);",
          "old_line_content": "    }",
          "new_line_content": "            talloc_free(e);",
          "content_same": false
        },
        {
          "line": 539,
          "old_api": null,
          "new_api": "w_thread_loop_timed_wait_full",
          "old_text": null,
          "new_text": "w_thread_loop_timed_wait_full(p->loop, &abstime);",
          "old_line_content": "            return;",
          "new_line_content": "        r = pw_thread_loop_timed_wait_full(p->loop, &abstime);",
          "content_same": false
        },
        {
          "line": 667,
          "old_api": null,
          "new_api": "pa_volume_to_mp_volume",
          "old_text": null,
          "new_text": "pa_volume_to_mp_volume(p->volume);",
          "old_line_content": "        case AOCONTROL_GET_MUTE: {",
          "new_line_content": "            *vol = spa_volume_to_mp_volume(p->volume);",
          "content_same": false
        },
        {
          "line": 541,
          "old_api": null,
          "new_api": "pa_strerror",
          "old_text": null,
          "new_text": "pa_strerror(r))",
          "old_line_content": "    }",
          "new_line_content": "            MP_WARN(ao, \"Could not wait for initialization: %s\\n\", spa_strerror(r));",
          "content_same": false
        },
        {
          "line": 797,
          "old_api": null,
          "new_api": "o_hotplug_event",
          "old_text": null,
          "new_text": "o_hotplug_event(ao);",
          "old_line_content": "static const struct pw_registry_events hotplug_registry_events = {",
          "new_line_content": "        ao_hotplug_event(ao);",
          "content_same": false
        },
        {
          "line": 551,
          "old_api": null,
          "new_api": "PA_POD_BUILDER_INIT",
          "old_text": null,
          "new_text": "PA_POD_BUILDER_INIT(buffer, sizeof(buffer));",
          "old_line_content": "        PW_KEY_MEDIA_TYPE, \"Audio\",",
          "new_line_content": "    struct spa_pod_builder b = SPA_POD_BUILDER_INIT(buffer, sizeof(buffer));",
          "content_same": false
        },
        {
          "line": 553,
          "old_api": null,
          "new_api": "w_properties_new",
          "old_text": null,
          "new_text": "w_properties_new(\n        PW_KEY_MEDIA_TYPE, \"Audio\",\n        PW_KEY_MEDIA_CATEGORY, \"Playback\",\n        PW_KEY_NODE_NAME, ao->client_name,\n        PW_KEY_NODE_DESCRIPTION, ao->client_name,\n        PW_KEY_APP_NAME, ao->client_name,\n        PW_KEY_APP_ID, ao->client_name,\n        PW_KEY_APP_ICON_NAME, ao->client_name,\n        PW_KEY_NODE_ALWAYS_PROCESS, \"true\",\n        PW_KEY_TARGET_OBJECT, ao->device,\n        NULL\n    );",
          "old_line_content": "        PW_KEY_NODE_NAME, ao->client_name,",
          "new_line_content": "    struct pw_properties *props = pw_properties_new(",
          "content_same": false
        },
        {
          "line": 681,
          "old_api": null,
          "new_api": "w_thread_loop_lock",
          "old_text": null,
          "new_text": "w_thread_loop_lock(p->loop);",
          "old_line_content": "                    float *vol = arg;",
          "new_line_content": "            pw_thread_loop_lock(p->loop);",
          "content_same": false
        },
        {
          "line": 810,
          "old_api": null,
          "new_api": "ipewire_init_boilerplate",
          "old_text": null,
          "new_text": "ipewire_init_boilerplate(ao);",
          "old_line_content": "",
          "new_line_content": "    int res = pipewire_init_boilerplate(ao);",
          "content_same": false
        },
        {
          "line": 689,
          "old_api": null,
          "new_api": "p_volume_to_spa_volume",
          "old_text": null,
          "new_text": "p_volume_to_spa_volume(*vol);",
          "old_line_content": "                    } else {",
          "new_line_content": "                            values[i] = mp_volume_to_spa_volume(*vol);",
          "content_same": false
        },
        {
          "line": 817,
          "old_api": null,
          "new_api": "pa_list_init",
          "old_text": null,
          "new_text": "pa_list_init(&priv->hotplug.sinks);",
          "old_line_content": "    if (!priv->hotplug.registry)",
          "new_line_content": "    spa_list_init(&priv->hotplug.sinks);",
          "content_same": false
        },
        {
          "line": 819,
          "old_api": null,
          "new_api": "w_core_get_registry",
          "old_text": null,
          "new_text": "w_core_get_registry(priv->core, PW_VERSION_REGISTRY, 0);",
          "old_line_content": "",
          "new_line_content": "    priv->hotplug.registry = pw_core_get_registry(priv->core, PW_VERSION_REGISTRY, 0);",
          "content_same": false
        },
        {
          "line": 693,
          "old_api": null,
          "new_api": "p_volume_to_spa_volume",
          "old_text": null,
          "new_text": "p_volume_to_spa_volume(*vol);",
          "old_line_content": "                    }",
          "new_line_content": "                        float value = mp_volume_to_spa_volume(*vol);",
          "content_same": false
        },
        {
          "line": 566,
          "old_api": null,
          "new_api": "ipewire_init_boilerplate",
          "old_text": null,
          "new_text": "ipewire_init_boilerplate(ao) ",
          "old_line_content": "    ao->device_buffer = p->options.buffer_msec * ao->samplerate / 1000;",
          "new_line_content": "    if (pipewire_init_boilerplate(ao) < 0)",
          "content_same": false
        },
        {
          "line": 694,
          "old_api": null,
          "new_api": "w_stream_set_control",
          "old_text": null,
          "new_text": "w_stream_set_control(\n                                    p->stream, SPA_PROP_volume, 1, &value, 0))",
          "old_line_content": "                    break;",
          "new_line_content": "                        ret = CONTROL_RET(pw_stream_set_control(",
          "content_same": false
        },
        {
          "line": 823,
          "old_api": null,
          "new_api": "w_registry_add_listener",
          "old_text": null,
          "new_text": "w_registry_add_listener(priv->hotplug.registry, &priv->hotplug.registry_listener, &hotplug_registry_events, ao) ",
          "old_line_content": "    }",
          "new_line_content": "    if (pw_registry_add_listener(priv->hotplug.registry, &priv->hotplug.registry_listener, &hotplug_registry_events, ao) < 0) {",
          "content_same": false
        },
        {
          "line": 824,
          "old_api": null,
          "new_api": "w_proxy_destroy",
          "old_text": null,
          "new_text": "w_proxy_destroy((struct pw_proxy *)priv->hotplug.registry);",
          "old_line_content": "",
          "new_line_content": "        pw_proxy_destroy((struct pw_proxy *)priv->hotplug.registry);",
          "content_same": false
        },
        {
          "line": 572,
          "old_api": null,
          "new_api": "w_properties_setf",
          "old_text": null,
          "new_text": "w_properties_setf(props, PW_KEY_NODE_RATE, \"1/%d\", ao->samplerate);",
          "old_line_content": "    if (spa_format == SPA_AUDIO_FORMAT_UNKNOWN) {",
          "new_line_content": "    pw_properties_setf(props, PW_KEY_NODE_RATE, \"1/%d\", ao->samplerate);",
          "content_same": false
        },
        {
          "line": 828,
          "old_api": null,
          "new_api": "w_thread_loop_unlock",
          "old_text": null,
          "new_text": "w_thread_loop_unlock(priv->loop);",
          "old_line_content": "",
          "new_line_content": "    pw_thread_loop_unlock(priv->loop);",
          "content_same": false
        },
        {
          "line": 574,
          "old_api": null,
          "new_api": "f_fmt_to_pw",
          "old_text": null,
          "new_text": "f_fmt_to_pw(ao, ao->format);",
          "old_line_content": "        spa_format = SPA_AUDIO_FORMAT_F32P;",
          "new_line_content": "    enum spa_audio_format spa_format = af_fmt_to_pw(ao, ao->format);",
          "content_same": false
        },
        {
          "line": 702,
          "old_api": null,
          "new_api": "w_stream_set_control",
          "old_text": null,
          "new_text": "w_stream_set_control(p->stream, SPA_PROP_mute, 1, &value, 0))",
          "old_line_content": "                case AOCONTROL_UPDATE_STREAM_TITLE: {",
          "new_line_content": "                    ret = CONTROL_RET(pw_stream_set_control(p->stream, SPA_PROP_mute, 1, &value, 0));",
          "content_same": false
        },
        {
          "line": 833,
          "old_api": null,
          "new_api": "w_thread_loop_unlock",
          "old_text": null,
          "new_text": "w_thread_loop_unlock(priv->loop);",
          "old_line_content": "    return -1;",
          "new_line_content": "    pw_thread_loop_unlock(priv->loop);",
          "content_same": false
        },
        {
          "line": 835,
          "old_api": null,
          "new_api": "ninit",
          "old_text": null,
          "new_text": "ninit(ao);",
          "old_line_content": "",
          "new_line_content": "    uninit(ao);",
          "content_same": false
        },
        {
          "line": 708,
          "old_api": null,
          "new_api": "PA_DICT_ITEM_INIT",
          "old_text": null,
          "new_text": "PA_DICT_ITEM_INIT(PW_KEY_MEDIA_NAME, title);",
          "old_line_content": "                }",
          "new_line_content": "                    items[0] = SPA_DICT_ITEM_INIT(PW_KEY_MEDIA_NAME, title);",
          "content_same": false
        },
        {
          "line": 709,
          "old_api": null,
          "new_api": "P_ARRAY_SIZE",
          "old_text": null,
          "new_text": "P_ARRAY_SIZE(items))",
          "old_line_content": "                case AOCONTROL_UPDATE_MEDIA_ROLE: {",
          "new_line_content": "                    ret = CONTROL_RET(pw_stream_update_properties(p->stream, &SPA_DICT_INIT(items, MP_ARRAY_SIZE(items))));",
          "content_same": false
        },
        {
          "line": 587,
          "old_api": null,
          "new_api": "p_speaker_id_to_spa",
          "old_text": null,
          "new_text": "p_speaker_id_to_spa(ao, ao->channels.speaker[i]);",
          "old_line_content": "    if (!params[0])",
          "new_line_content": "        audio_info.position[i] = mp_speaker_id_to_spa(ao, ao->channels.speaker[i]);",
          "content_same": false
        },
        {
          "line": 589,
          "old_api": null,
          "new_api": "pa_format_audio_raw_build",
          "old_text": null,
          "new_text": "pa_format_audio_raw_build(&b, SPA_PARAM_EnumFormat, &audio_info);",
          "old_line_content": "",
          "new_line_content": "    params[0] = spa_format_audio_raw_build(&b, SPA_PARAM_EnumFormat, &audio_info);",
          "content_same": false
        },
        {
          "line": 848,
          "old_api": null,
          "new_api": "w_thread_loop_unlock",
          "old_text": null,
          "new_text": "w_thread_loop_unlock(priv->loop);",
          "old_line_content": "",
          "new_line_content": "    pw_thread_loop_unlock(priv->loop);",
          "content_same": false
        },
        {
          "line": 593,
          "old_api": null,
          "new_api": "f_fmt_is_planar",
          "old_text": null,
          "new_text": "f_fmt_is_planar(ao->format))",
          "old_line_content": "    } else {",
          "new_line_content": "    if (af_fmt_is_planar(ao->format)) {",
          "content_same": false
        },
        {
          "line": 849,
          "old_api": null,
          "new_api": "ninit",
          "old_text": null,
          "new_text": "ninit(ao);",
          "old_line_content": "static void list_devs(struct ao *ao, struct ao_device_list *list)",
          "new_line_content": "    uninit(ao);",
          "content_same": false
        },
        {
          "line": 724,
          "old_api": null,
          "new_api": "P_WARN",
          "old_text": null,
          "new_text": "P_WARN(ao, \"Unknown media role %d\\n\", *role);",
          "old_line_content": "                    }",
          "new_line_content": "                            MP_WARN(ao, \"Unknown media role %d\\n\", *role);",
          "content_same": false
        },
        {
          "line": 728,
          "old_api": null,
          "new_api": "PA_DICT_ITEM_INIT",
          "old_text": null,
          "new_text": "PA_DICT_ITEM_INIT(PW_KEY_MEDIA_ROLE, role_str);",
          "old_line_content": "                }",
          "new_line_content": "                    items[0] = SPA_DICT_ITEM_INIT(PW_KEY_MEDIA_ROLE, role_str);",
          "content_same": false
        },
        {
          "line": 601,
          "old_api": null,
          "new_api": "w_thread_loop_lock",
          "old_text": null,
          "new_text": "w_thread_loop_lock(p->loop);",
          "old_line_content": "    if (p->stream == NULL) {",
          "new_line_content": "    pw_thread_loop_lock(p->loop);",
          "content_same": false
        },
        {
          "line": 729,
          "old_api": null,
          "new_api": "P_ARRAY_SIZE",
          "old_text": null,
          "new_text": "P_ARRAY_SIZE(items))",
          "old_line_content": "                default:",
          "new_line_content": "                    ret = CONTROL_RET(pw_stream_update_properties(p->stream, &SPA_DICT_INIT(items, MP_ARRAY_SIZE(items))));",
          "content_same": false
        },
        {
          "line": 603,
          "old_api": null,
          "new_api": "w_stream_new",
          "old_text": null,
          "new_text": "w_stream_new(p->core, \"audio-src\", props);",
          "old_line_content": "        goto error;",
          "new_line_content": "    p->stream = pw_stream_new(p->core, \"audio-src\", props);",
          "content_same": false
        },
        {
          "line": 856,
          "old_api": null,
          "new_api": "or_each_sink",
          "old_text": null,
          "new_text": "or_each_sink(ao, add_device_to_list, list) ",
          "old_line_content": "",
          "new_line_content": "    if (for_each_sink(ao, add_device_to_list, list) < 0)",
          "content_same": false
        },
        {
          "line": 605,
          "old_api": null,
          "new_api": "w_thread_loop_unlock",
          "old_text": null,
          "new_text": "w_thread_loop_unlock(p->loop);",
          "old_line_content": "",
          "new_line_content": "        pw_thread_loop_unlock(p->loop);",
          "content_same": false
        },
        {
          "line": 857,
          "old_api": null,
          "new_api": "P_WARN",
          "old_text": null,
          "new_text": "P_WARN(ao, \"Could not list devices, list may be incomplete\\n\");",
          "old_line_content": "#define OPT_BASE_STRUCT struct priv",
          "new_line_content": "        MP_WARN(ao, \"Could not list devices, list may be incomplete\\n\");",
          "content_same": false
        },
        {
          "line": 735,
          "old_api": null,
          "new_api": "w_thread_loop_unlock",
          "old_text": null,
          "new_text": "w_thread_loop_unlock(p->loop);",
          "old_line_content": "        default:",
          "new_line_content": "            pw_thread_loop_unlock(p->loop);",
          "content_same": false
        },
        {
          "line": 609,
          "old_api": null,
          "new_api": "w_stream_add_listener",
          "old_text": null,
          "new_text": "w_stream_add_listener(p->stream, &p->stream_listener, &stream_events, ao);",
          "old_line_content": "                                 PW_STREAM_FLAG_INACTIVE |",
          "new_line_content": "    pw_stream_add_listener(p->stream, &p->stream_listener, &stream_events, ao);",
          "content_same": false
        },
        {
          "line": 504,
          "old_api": null,
          "new_api": "trerror",
          "old_text": null,
          "new_text": "trerror(errno))",
          "old_line_content": "    }",
          "new_line_content": "               p->options.remote, strerror(errno));",
          "content_same": false
        },
        {
          "line": 746,
          "old_api": null,
          "new_api": "pa_dict_lookup",
          "old_text": null,
          "new_text": "pa_dict_lookup(props, PW_KEY_NODE_NAME);",
          "old_line_content": "        return;",
          "new_line_content": "    const char *name = spa_dict_lookup(props, PW_KEY_NODE_NAME);",
          "content_same": false
        },
        {
          "line": 619,
          "old_api": null,
          "new_api": "w_stream_connect",
          "old_text": null,
          "new_text": "w_stream_connect(p->stream,\n                    PW_DIRECTION_OUTPUT, PW_ID_ANY, flags, params, 1) ",
          "old_line_content": "        goto error;",
          "new_line_content": "    if (pw_stream_connect(p->stream,",
          "content_same": false
        },
        {
          "line": 491,
          "old_api": null,
          "new_api": "w_thread_loop_get_loop",
          "old_text": null,
          "new_text": "w_thread_loop_get_loop(p->loop),",
          "old_line_content": "    if (!context)",
          "new_line_content": "            pw_thread_loop_get_loop(p->loop),",
          "content_same": false
        },
        {
          "line": 621,
          "old_api": null,
          "new_api": "w_thread_loop_unlock",
          "old_text": null,
          "new_text": "w_thread_loop_unlock(p->loop);",
          "old_line_content": "",
          "new_line_content": "        pw_thread_loop_unlock(p->loop);",
          "content_same": false
        },
        {
          "line": 492,
          "old_api": null,
          "new_api": "w_properties_new",
          "old_text": null,
          "new_text": "w_properties_new(PW_KEY_CONFIG_NAME, \"client-rt.conf\", NULL),",
          "old_line_content": "        goto error;",
          "new_line_content": "            pw_properties_new(PW_KEY_CONFIG_NAME, \"client-rt.conf\", NULL),",
          "content_same": false
        },
        {
          "line": 751,
          "old_api": null,
          "new_api": "pa_dict_lookup",
          "old_text": null,
          "new_text": "pa_dict_lookup(props, PW_KEY_NODE_DESCRIPTION);",
          "old_line_content": "}",
          "new_line_content": "    const char *description = spa_dict_lookup(props, PW_KEY_NODE_DESCRIPTION);",
          "content_same": false
        },
        {
          "line": 505,
          "old_api": null,
          "new_api": "w_context_destroy",
          "old_text": null,
          "new_text": "w_context_destroy(context);",
          "old_line_content": "",
          "new_line_content": "        pw_context_destroy(context);",
          "content_same": false
        },
        {
          "line": 625,
          "old_api": null,
          "new_api": "ait_for_init_done",
          "old_text": null,
          "new_text": "ait_for_init_done(ao);",
          "old_line_content": "",
          "new_line_content": "    wait_for_init_done(ao);",
          "content_same": false
        },
        {
          "line": 753,
          "old_api": null,
          "new_api": "o_device_list_add",
          "old_text": null,
          "new_text": "o_device_list_add(list, ao, &(struct ao_device_desc){name, description});",
          "old_line_content": "static void hotplug_registry_global_cb(void *data, uint32_t id,",
          "new_line_content": "    ao_device_list_add(list, ao, &(struct ao_device_desc){name, description});",
          "content_same": false
        },
        {
          "line": 627,
          "old_api": null,
          "new_api": "w_thread_loop_unlock",
          "old_text": null,
          "new_text": "w_thread_loop_unlock(p->loop);",
          "old_line_content": "        goto error;",
          "new_line_content": "    pw_thread_loop_unlock(p->loop);",
          "content_same": false
        },
        {
          "line": 497,
          "old_api": null,
          "new_api": "w_context_connect",
          "old_text": null,
          "new_text": "w_context_connect(\n            context,\n            pw_properties_new(PW_KEY_REMOTE_NAME, p->options.remote, NULL),\n            0);",
          "old_line_content": "            0);",
          "new_line_content": "    p->core = pw_context_connect(",
          "content_same": false
        },
        {
          "line": 888,
          "old_api": null,
          "new_api": "_RANGE",
          "old_text": null,
          "new_text": "_RANGE(1, 2000)}",
          "old_line_content": "            {\"channel\", VOLUME_MODE_CHANNEL}, {\"global\", VOLUME_MODE_GLOBAL})},",
          "new_line_content": "        {\"buffer\", OPT_INT(options.buffer_msec), M_RANGE(1, 2000)},",
          "content_same": false
        },
        {
          "line": 889,
          "old_api": null,
          "new_api": "PT_STRING",
          "old_text": null,
          "new_text": "PT_STRING(options.remote) ",
          "old_line_content": "        {0}",
          "new_line_content": "        {\"remote\", OPT_STRING(options.remote) },",
          "content_same": false
        },
        {
          "line": 890,
          "old_api": null,
          "new_api": "PT_CHOICE",
          "old_text": null,
          "new_text": "PT_CHOICE(options.volume_mode,\n            {\"channel\", VOLUME_MODE_CHANNEL}, {\"global\", VOLUME_MODE_GLOBAL})}",
          "old_line_content": "    },",
          "new_line_content": "        {\"volume-mode\", OPT_CHOICE(options.volume_mode,",
          "content_same": false
        },
        {
          "line": 635,
          "old_api": null,
          "new_api": "w_properties_free",
          "old_text": null,
          "new_text": "w_properties_free(props);",
          "old_line_content": "    return -1;",
          "new_line_content": "    pw_properties_free(props);",
          "content_same": false
        },
        {
          "line": 637,
          "old_api": null,
          "new_api": "ninit",
          "old_text": null,
          "new_text": "ninit(ao);",
          "old_line_content": "",
          "new_line_content": "    uninit(ao);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 768,
          "old_api": "w_thread_loop_unlock",
          "new_api": null,
          "old_text": "w_thread_loop_unlock(priv->loop);",
          "new_text": null,
          "old_line_content": "    pw_thread_loop_unlock(priv->loop);",
          "new_line_content": "    item->id = id;",
          "content_same": false
        },
        {
          "line": 641,
          "old_api": "w_thread_loop_lock",
          "new_api": null,
          "old_text": "w_thread_loop_lock(p->loop);",
          "new_text": null,
          "old_line_content": "    pw_thread_loop_lock(p->loop);",
          "new_line_content": "static void reset(struct ao *ao)",
          "content_same": false
        },
        {
          "line": 642,
          "old_api": "w_stream_set_active",
          "new_api": null,
          "old_text": "w_stream_set_active(p->stream, false);",
          "new_text": null,
          "old_line_content": "    pw_stream_set_active(p->stream, false);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 643,
          "old_api": "w_stream_flush",
          "new_api": null,
          "old_text": "w_stream_flush(p->stream, false);",
          "new_text": null,
          "old_line_content": "    pw_stream_flush(p->stream, false);",
          "new_line_content": "    struct priv *p = ao->priv;",
          "content_same": false
        },
        {
          "line": 519,
          "old_api": "w_thread_loop_unlock",
          "new_api": null,
          "old_text": "w_thread_loop_unlock(p->loop);",
          "new_text": null,
          "old_line_content": "    pw_thread_loop_unlock(p->loop);",
          "new_line_content": "    return 0;",
          "content_same": false
        },
        {
          "line": 650,
          "old_api": "w_thread_loop_lock",
          "new_api": null,
          "old_text": "w_thread_loop_lock(p->loop);",
          "new_text": null,
          "old_line_content": "    pw_thread_loop_lock(p->loop);",
          "new_line_content": "static void start(struct ao *ao)",
          "content_same": false
        },
        {
          "line": 651,
          "old_api": "w_stream_set_active",
          "new_api": null,
          "old_text": "w_stream_set_active(p->stream, true);",
          "new_text": null,
          "old_line_content": "    pw_stream_set_active(p->stream, true);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 652,
          "old_api": "w_thread_loop_unlock",
          "new_api": null,
          "old_text": "w_thread_loop_unlock(p->loop);",
          "new_text": null,
          "old_line_content": "    pw_thread_loop_unlock(p->loop);",
          "new_line_content": "    struct priv *p = ao->priv;",
          "content_same": false
        },
        {
          "line": 781,
          "old_api": "w_thread_loop_lock",
          "new_api": null,
          "old_text": "w_thread_loop_lock(priv->loop);",
          "new_text": null,
          "old_line_content": "    pw_thread_loop_lock(priv->loop);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 782,
          "old_api": "pa_list_for_each",
          "new_api": null,
          "old_text": "pa_list_for_each(e, &priv->hotplug.sinks, node) ",
          "new_text": null,
          "old_line_content": "    spa_list_for_each(e, &priv->hotplug.sinks, node) {",
          "new_line_content": "    struct id_list *e;",
          "content_same": false
        },
        {
          "line": 529,
          "old_api": "w_thread_loop_get_time",
          "new_api": null,
          "old_text": "w_thread_loop_get_time(p->loop, &abstime, 50 * SPA_NSEC_PER_MSEC);",
          "new_text": null,
          "old_line_content": "    r = pw_thread_loop_get_time(p->loop, &abstime, 50 * SPA_NSEC_PER_MSEC);",
          "new_line_content": "    struct timespec abstime;",
          "content_same": false
        },
        {
          "line": 786,
          "old_api": "alloc_free",
          "new_api": null,
          "old_text": "alloc_free(e);",
          "new_text": null,
          "old_line_content": "            talloc_free(e);",
          "new_line_content": "        if (e->id == id) {",
          "content_same": false
        },
        {
          "line": 531,
          "old_api": "pa_strerror",
          "new_api": null,
          "old_text": "pa_strerror(r))",
          "new_text": null,
          "old_line_content": "        MP_WARN(ao, \"Could not get timeout for initialization: %s\\n\", spa_strerror(r));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 791,
          "old_api": "w_thread_loop_unlock",
          "new_api": null,
          "old_text": "w_thread_loop_unlock(priv->loop);",
          "new_text": null,
          "old_line_content": "    pw_thread_loop_unlock(priv->loop);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 536,
          "old_api": "w_thread_loop_timed_wait_full",
          "new_api": null,
          "old_text": "w_thread_loop_timed_wait_full(p->loop, &abstime);",
          "new_text": null,
          "old_line_content": "        r = pw_thread_loop_timed_wait_full(p->loop, &abstime);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 664,
          "old_api": "pa_volume_to_mp_volume",
          "new_api": null,
          "old_text": "pa_volume_to_mp_volume(p->volume);",
          "new_text": null,
          "old_line_content": "            *vol = spa_volume_to_mp_volume(p->volume);",
          "new_line_content": "    switch (cmd) {",
          "content_same": false
        },
        {
          "line": 538,
          "old_api": "pa_strerror",
          "new_api": null,
          "old_text": "pa_strerror(r))",
          "new_text": null,
          "old_line_content": "            MP_WARN(ao, \"Could not wait for initialization: %s\\n\", spa_strerror(r));",
          "new_line_content": "    while (p->init_state == INIT_STATE_NONE) {",
          "content_same": false
        },
        {
          "line": 548,
          "old_api": "PA_POD_BUILDER_INIT",
          "new_api": null,
          "old_text": "PA_POD_BUILDER_INIT(buffer, sizeof(buffer));",
          "new_text": null,
          "old_line_content": "    struct spa_pod_builder b = SPA_POD_BUILDER_INIT(buffer, sizeof(buffer));",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 550,
          "old_api": "w_properties_new",
          "new_api": null,
          "old_text": "w_properties_new(\n        PW_KEY_MEDIA_TYPE, \"Audio\",\n        PW_KEY_MEDIA_CATEGORY, \"Playback\",\n        PW_KEY_NODE_NAME, ao->client_name,\n        PW_KEY_NODE_DESCRIPTION, ao->client_name,\n        PW_KEY_APP_NAME, ao->client_name,\n        PW_KEY_APP_ID, ao->client_name,\n        PW_KEY_APP_ICON_NAME, ao->client_name,\n        PW_KEY_NODE_ALWAYS_PROCESS, \"true\",\n        PW_KEY_TARGET_OBJECT, ao->device,\n        NULL\n    );",
          "new_text": null,
          "old_line_content": "    struct pw_properties *props = pw_properties_new(",
          "new_line_content": "    uint8_t buffer[1024];",
          "content_same": false
        },
        {
          "line": 678,
          "old_api": "w_thread_loop_lock",
          "new_api": null,
          "old_text": "w_thread_loop_lock(p->loop);",
          "new_text": null,
          "old_line_content": "            pw_thread_loop_lock(p->loop);",
          "new_line_content": "        case AOCONTROL_UPDATE_MEDIA_ROLE: {",
          "content_same": false
        },
        {
          "line": 807,
          "old_api": "ipewire_init_boilerplate",
          "new_api": null,
          "old_text": "ipewire_init_boilerplate(ao);",
          "new_text": null,
          "old_line_content": "    int res = pipewire_init_boilerplate(ao);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 811,
          "old_api": "w_thread_loop_lock",
          "new_api": null,
          "old_text": "w_thread_loop_lock(priv->loop);",
          "new_text": null,
          "old_line_content": "    pw_thread_loop_lock(priv->loop);",
          "new_line_content": "    if (res)",
          "content_same": false
        },
        {
          "line": 813,
          "old_api": "pa_zero",
          "new_api": null,
          "old_text": "pa_zero(priv->hotplug);",
          "new_text": null,
          "old_line_content": "    spa_zero(priv->hotplug);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 686,
          "old_api": "p_volume_to_spa_volume",
          "new_api": null,
          "old_text": "p_volume_to_spa_volume(*vol);",
          "new_text": null,
          "old_line_content": "                            values[i] = mp_volume_to_spa_volume(*vol);",
          "new_line_content": "                    if (p->options.volume_mode == VOLUME_MODE_CHANNEL) {",
          "content_same": false
        },
        {
          "line": 687,
          "old_api": "w_stream_set_control",
          "new_api": null,
          "old_text": "w_stream_set_control(\n                                    p->stream, SPA_PROP_channelVolumes, n, values, 0))",
          "new_text": null,
          "old_line_content": "                        ret = CONTROL_RET(pw_stream_set_control(",
          "new_line_content": "                        float values[MP_NUM_CHANNELS] = {0};",
          "content_same": false
        },
        {
          "line": 563,
          "old_api": "ipewire_init_boilerplate",
          "new_api": null,
          "old_text": "ipewire_init_boilerplate(ao) ",
          "new_text": null,
          "old_line_content": "    if (pipewire_init_boilerplate(ao) < 0)",
          "new_line_content": "        NULL",
          "content_same": false
        },
        {
          "line": 691,
          "old_api": "w_stream_set_control",
          "new_api": null,
          "old_text": "w_stream_set_control(\n                                    p->stream, SPA_PROP_volume, 1, &value, 0))",
          "new_text": null,
          "old_line_content": "                        ret = CONTROL_RET(pw_stream_set_control(",
          "new_line_content": "                                    p->stream, SPA_PROP_channelVolumes, n, values, 0));",
          "content_same": false
        },
        {
          "line": 820,
          "old_api": "w_registry_add_listener",
          "new_api": null,
          "old_text": "w_registry_add_listener(priv->hotplug.registry, &priv->hotplug.registry_listener, &hotplug_registry_events, ao) ",
          "new_text": null,
          "old_line_content": "    if (pw_registry_add_listener(priv->hotplug.registry, &priv->hotplug.registry_listener, &hotplug_registry_events, ao) < 0) {",
          "new_line_content": "    if (!priv->hotplug.registry)",
          "content_same": false
        },
        {
          "line": 821,
          "old_api": "w_proxy_destroy",
          "new_api": null,
          "old_text": "w_proxy_destroy((struct pw_proxy *)priv->hotplug.registry);",
          "new_text": null,
          "old_line_content": "        pw_proxy_destroy((struct pw_proxy *)priv->hotplug.registry);",
          "new_line_content": "        goto error;",
          "content_same": false
        },
        {
          "line": 568,
          "old_api": "w_properties_setf",
          "new_api": null,
          "old_text": "w_properties_setf(props, PW_KEY_NODE_LATENCY, \"%d/%d\", ao->device_buffer, ao->samplerate);",
          "new_text": null,
          "old_line_content": "    pw_properties_setf(props, PW_KEY_NODE_LATENCY, \"%d/%d\", ao->device_buffer, ao->samplerate);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 569,
          "old_api": "w_properties_setf",
          "new_api": null,
          "old_text": "w_properties_setf(props, PW_KEY_NODE_RATE, \"1/%d\", ao->samplerate);",
          "new_text": null,
          "old_line_content": "    pw_properties_setf(props, PW_KEY_NODE_RATE, \"1/%d\", ao->samplerate);",
          "new_line_content": "    ao->device_buffer = p->options.buffer_msec * ao->samplerate / 1000;",
          "content_same": false
        },
        {
          "line": 825,
          "old_api": "w_thread_loop_unlock",
          "new_api": null,
          "old_text": "w_thread_loop_unlock(priv->loop);",
          "new_text": null,
          "old_line_content": "    pw_thread_loop_unlock(priv->loop);",
          "new_line_content": "        goto error;",
          "content_same": false
        },
        {
          "line": 699,
          "old_api": "w_stream_set_control",
          "new_api": null,
          "old_text": "w_stream_set_control(p->stream, SPA_PROP_mute, 1, &value, 0))",
          "new_text": null,
          "old_line_content": "                    ret = CONTROL_RET(pw_stream_set_control(p->stream, SPA_PROP_mute, 1, &value, 0));",
          "new_line_content": "                case AOCONTROL_SET_MUTE: {",
          "content_same": false
        },
        {
          "line": 830,
          "old_api": "w_thread_loop_unlock",
          "new_api": null,
          "old_text": "w_thread_loop_unlock(priv->loop);",
          "new_text": null,
          "old_line_content": "    pw_thread_loop_unlock(priv->loop);",
          "new_line_content": "    return res;",
          "content_same": false
        },
        {
          "line": 832,
          "old_api": "ninit",
          "new_api": null,
          "old_text": "ninit(ao);",
          "new_text": null,
          "old_line_content": "    uninit(ao);",
          "new_line_content": "error:",
          "content_same": false
        },
        {
          "line": 705,
          "old_api": "PA_DICT_ITEM_INIT",
          "new_api": null,
          "old_text": "PA_DICT_ITEM_INIT(PW_KEY_MEDIA_NAME, title);",
          "new_text": null,
          "old_line_content": "                    items[0] = SPA_DICT_ITEM_INIT(PW_KEY_MEDIA_NAME, title);",
          "new_line_content": "                case AOCONTROL_UPDATE_STREAM_TITLE: {",
          "content_same": false
        },
        {
          "line": 706,
          "old_api": "P_ARRAY_SIZE",
          "new_api": null,
          "old_text": "P_ARRAY_SIZE(items))",
          "new_text": null,
          "old_line_content": "                    ret = CONTROL_RET(pw_stream_update_properties(p->stream, &SPA_DICT_INIT(items, MP_ARRAY_SIZE(items))));",
          "new_line_content": "                    char *title = arg;",
          "content_same": false
        },
        {
          "line": 584,
          "old_api": "p_speaker_id_to_spa",
          "new_api": null,
          "old_text": "p_speaker_id_to_spa(ao, ao->channels.speaker[i]);",
          "new_text": null,
          "old_line_content": "        audio_info.position[i] = mp_speaker_id_to_spa(ao, ao->channels.speaker[i]);",
          "new_line_content": "    };",
          "content_same": false
        },
        {
          "line": 840,
          "old_api": "w_thread_loop_lock",
          "new_api": null,
          "old_text": "w_thread_loop_lock(priv->loop);",
          "new_text": null,
          "old_line_content": "    pw_thread_loop_lock(priv->loop);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 586,
          "old_api": "pa_format_audio_raw_build",
          "new_api": null,
          "old_text": "pa_format_audio_raw_build(&b, SPA_PARAM_EnumFormat, &audio_info);",
          "new_text": null,
          "old_line_content": "    params[0] = spa_format_audio_raw_build(&b, SPA_PARAM_EnumFormat, &audio_info);",
          "new_line_content": "    for (int i = 0; i < ao->channels.num; i++)",
          "content_same": false
        },
        {
          "line": 842,
          "old_api": "pa_hook_remove",
          "new_api": null,
          "old_text": "pa_hook_remove(&priv->hotplug.registry_listener);",
          "new_text": null,
          "old_line_content": "    spa_hook_remove(&priv->hotplug.registry_listener);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 590,
          "old_api": "f_fmt_is_planar",
          "new_api": null,
          "old_text": "f_fmt_is_planar(ao->format))",
          "new_text": null,
          "old_line_content": "    if (af_fmt_is_planar(ao->format)) {",
          "new_line_content": "    if (!params[0])",
          "content_same": false
        },
        {
          "line": 592,
          "old_api": "f_fmt_to_bytes",
          "new_api": null,
          "old_text": "f_fmt_to_bytes(ao->format);",
          "new_text": null,
          "old_line_content": "        ao->sstride = af_fmt_to_bytes(ao->format);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 721,
          "old_api": "P_WARN",
          "new_api": null,
          "old_text": "P_WARN(ao, \"Unknown media role %d\\n\", *role);",
          "new_text": null,
          "old_line_content": "                            MP_WARN(ao, \"Unknown media role %d\\n\", *role);",
          "new_line_content": "                            role_str = \"Music\";",
          "content_same": false
        },
        {
          "line": 851,
          "old_api": "o_device_list_add",
          "new_api": null,
          "old_text": "o_device_list_add(list, ao, &(struct ao_device_desc){});",
          "new_text": null,
          "old_line_content": "    ao_device_list_add(list, ao, &(struct ao_device_desc){});",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 725,
          "old_api": "PA_DICT_ITEM_INIT",
          "new_api": null,
          "old_text": "PA_DICT_ITEM_INIT(PW_KEY_MEDIA_ROLE, role_str);",
          "new_text": null,
          "old_line_content": "                    items[0] = SPA_DICT_ITEM_INIT(PW_KEY_MEDIA_ROLE, role_str);",
          "new_line_content": "                            role_str = \"\";",
          "content_same": false
        },
        {
          "line": 726,
          "old_api": "P_ARRAY_SIZE",
          "new_api": null,
          "old_text": "P_ARRAY_SIZE(items))",
          "new_text": null,
          "old_line_content": "                    ret = CONTROL_RET(pw_stream_update_properties(p->stream, &SPA_DICT_INIT(items, MP_ARRAY_SIZE(items))));",
          "new_line_content": "                            break;",
          "content_same": false
        },
        {
          "line": 853,
          "old_api": "or_each_sink",
          "new_api": null,
          "old_text": "or_each_sink(ao, add_device_to_list, list) ",
          "new_text": null,
          "old_line_content": "    if (for_each_sink(ao, add_device_to_list, list) < 0)",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 600,
          "old_api": "w_stream_new",
          "new_api": null,
          "old_text": "w_stream_new(p->core, \"audio-src\", props);",
          "new_text": null,
          "old_line_content": "    p->stream = pw_stream_new(p->core, \"audio-src\", props);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 602,
          "old_api": "w_thread_loop_unlock",
          "new_api": null,
          "old_text": "w_thread_loop_unlock(p->loop);",
          "new_text": null,
          "old_line_content": "        pw_thread_loop_unlock(p->loop);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 732,
          "old_api": "w_thread_loop_unlock",
          "new_api": null,
          "old_text": "w_thread_loop_unlock(p->loop);",
          "new_text": null,
          "old_line_content": "            pw_thread_loop_unlock(p->loop);",
          "new_line_content": "                default:",
          "content_same": false
        },
        {
          "line": 606,
          "old_api": "w_stream_add_listener",
          "new_api": null,
          "old_text": "w_stream_add_listener(p->stream, &p->stream_listener, &stream_events, ao);",
          "new_text": null,
          "old_line_content": "    pw_stream_add_listener(p->stream, &p->stream_listener, &stream_events, ao);",
          "new_line_content": "        goto error;",
          "content_same": false
        },
        {
          "line": 743,
          "old_api": "pa_dict_lookup",
          "new_api": null,
          "old_text": "pa_dict_lookup(props, PW_KEY_NODE_NAME);",
          "new_text": null,
          "old_line_content": "    const char *name = spa_dict_lookup(props, PW_KEY_NODE_NAME);",
          "new_line_content": "static void add_device_to_list(struct ao *ao, uint32_t id, const struct spa_dict *props, void *ctx)",
          "content_same": false
        },
        {
          "line": 616,
          "old_api": "w_stream_connect",
          "new_api": null,
          "old_text": "w_stream_connect(p->stream,\n                    PW_DIRECTION_OUTPUT, PW_ID_ANY, flags, params, 1) ",
          "new_text": null,
          "old_line_content": "    if (pw_stream_connect(p->stream,",
          "new_line_content": "    if (ao->init_flags & AO_INIT_EXCLUSIVE)",
          "content_same": false
        },
        {
          "line": 618,
          "old_api": "w_thread_loop_unlock",
          "new_api": null,
          "old_text": "w_thread_loop_unlock(p->loop);",
          "new_text": null,
          "old_line_content": "        pw_thread_loop_unlock(p->loop);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 748,
          "old_api": "pa_dict_lookup",
          "new_api": null,
          "old_text": "pa_dict_lookup(props, PW_KEY_NODE_DESCRIPTION);",
          "new_text": null,
          "old_line_content": "    const char *description = spa_dict_lookup(props, PW_KEY_NODE_DESCRIPTION);",
          "new_line_content": "    if (!name)",
          "content_same": false
        },
        {
          "line": 622,
          "old_api": "ait_for_init_done",
          "new_api": null,
          "old_text": "ait_for_init_done(ao);",
          "new_text": null,
          "old_line_content": "    wait_for_init_done(ao);",
          "new_line_content": "        goto error;",
          "content_same": false
        },
        {
          "line": 750,
          "old_api": "o_device_list_add",
          "new_api": null,
          "old_text": "o_device_list_add(list, ao, &(struct ao_device_desc){name, description});",
          "new_text": null,
          "old_line_content": "    ao_device_list_add(list, ao, &(struct ao_device_desc){name, description});",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 624,
          "old_api": "w_thread_loop_unlock",
          "new_api": null,
          "old_text": "w_thread_loop_unlock(p->loop);",
          "new_text": null,
          "old_line_content": "    pw_thread_loop_unlock(p->loop);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 760,
          "old_api": "s_sink_node",
          "new_api": null,
          "old_text": "s_sink_node(type, props))",
          "new_text": null,
          "old_line_content": "    if (!is_sink_node(type, props))",
          "new_line_content": "    struct ao *ao = data;",
          "content_same": false
        },
        {
          "line": 494,
          "old_api": "w_context_connect",
          "new_api": null,
          "old_text": "w_context_connect(\n            context,\n            pw_properties_new(PW_KEY_REMOTE_NAME, p->options.remote, NULL),\n            0);",
          "new_text": null,
          "old_line_content": "    p->core = pw_context_connect(",
          "new_line_content": "    if (!context)",
          "content_same": false
        },
        {
          "line": 496,
          "old_api": "w_properties_new",
          "new_api": null,
          "old_text": "w_properties_new(PW_KEY_REMOTE_NAME, p->options.remote, NULL),",
          "new_text": null,
          "old_line_content": "            pw_properties_new(PW_KEY_REMOTE_NAME, p->options.remote, NULL),",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 506,
          "old_api": "w_core_add_listener",
          "new_api": null,
          "old_text": "w_core_add_listener(p->core, &p->core_listener, &core_events, ao) ",
          "new_text": null,
          "old_line_content": "    if (pw_core_add_listener(p->core, &p->core_listener, &core_events, ao) < 0)",
          "new_line_content": "        goto error;",
          "content_same": false
        },
        {
          "line": 885,
          "old_api": "_RANGE",
          "new_api": null,
          "old_text": "_RANGE(1, 2000)}",
          "new_text": null,
          "old_line_content": "        {\"buffer\", OPT_INT(options.buffer_msec), M_RANGE(1, 2000)},",
          "new_line_content": "    },",
          "content_same": false
        },
        {
          "line": 886,
          "old_api": "PT_STRING",
          "new_api": null,
          "old_text": "PT_STRING(options.remote) ",
          "new_text": null,
          "old_line_content": "        {\"remote\", OPT_STRING(options.remote) },",
          "new_line_content": "    .options_prefix = \"pipewire\",",
          "content_same": false
        },
        {
          "line": 887,
          "old_api": "PT_CHOICE",
          "new_api": null,
          "old_text": "PT_CHOICE(options.volume_mode,\n            {\"channel\", VOLUME_MODE_CHANNEL}, {\"global\", VOLUME_MODE_GLOBAL})}",
          "new_text": null,
          "old_line_content": "        {\"volume-mode\", OPT_CHOICE(options.volume_mode,",
          "new_line_content": "    .options = (const struct m_option[]) {",
          "content_same": false
        },
        {
          "line": 632,
          "old_api": "w_properties_free",
          "new_api": null,
          "old_text": "w_properties_free(props);",
          "new_text": null,
          "old_line_content": "    pw_properties_free(props);",
          "new_line_content": "    return 0;",
          "content_same": false
        },
        {
          "line": 501,
          "old_api": "trerror",
          "new_api": null,
          "old_text": "trerror(errno))",
          "new_text": null,
          "old_line_content": "               p->options.remote, strerror(errno));",
          "new_line_content": "    if (!p->core) {",
          "content_same": false
        },
        {
          "line": 634,
          "old_api": "ninit",
          "new_api": null,
          "old_text": "ninit(ao);",
          "new_text": null,
          "old_line_content": "    uninit(ao);",
          "new_line_content": "error_props:",
          "content_same": false
        },
        {
          "line": 764,
          "old_api": "alloc",
          "new_api": null,
          "old_text": "alloc(ao, struct id_list);",
          "new_text": null,
          "old_line_content": "    struct id_list *item = talloc(ao, struct id_list);",
          "new_line_content": "        return;",
          "content_same": false
        },
        {
          "line": 511,
          "old_api": "ession_has_sinks",
          "new_api": null,
          "old_text": "ession_has_sinks(ao))",
          "new_text": null,
          "old_line_content": "    if (!session_has_sinks(ao)) {",
          "new_line_content": "",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 21,
      "total_additions": 73,
      "total_deletions": 71,
      "total_api_changes": 165
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 4,
        "api_related_lines": 165,
        "non_api_lines": 1,
        "non_api_line_numbers": [
          493
        ]
      }
    },
    "api_calls_before": 179,
    "api_calls_after": 180,
    "diff_info": {
      "added_lines": 4,
      "removed_lines": 1,
      "total_diff_lines": 17
    }
  }
}