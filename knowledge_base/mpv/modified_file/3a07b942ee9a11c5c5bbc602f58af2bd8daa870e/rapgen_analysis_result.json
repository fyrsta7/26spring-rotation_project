{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/3a07b942ee9a11c5c5bbc602f58af2bd8daa870e",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/3a07b942ee9a11c5c5bbc602f58af2bd8daa870e/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/3a07b942ee9a11c5c5bbc602f58af2bd8daa870e/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/3a07b942ee9a11c5c5bbc602f58af2bd8daa870e/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 835,
          "old_api": "dvb_get_channels",
          "new_api": "get_path",
          "old_text": "dvb_get_channels(conf_file, type)",
          "new_text": "get_path(\"channels.conf\")",
          "old_line_content": "\t\tlist = dvb_get_channels(conf_file, type);",
          "new_line_content": "\t\t\tconf_file = get_path(\"channels.conf\");",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 793,
          "old_api": null,
          "new_api": "malloc",
          "old_text": null,
          "new_text": "malloc(sizeof(dvb_config_t))",
          "old_line_content": "\t\treturn NULL;",
          "new_line_content": "\tconf = (dvb_config_t*) malloc(sizeof(dvb_config_t));",
          "content_same": false
        },
        {
          "line": 802,
          "old_api": null,
          "new_api": "sprintf",
          "old_text": null,
          "new_text": "sprintf(filename, \"/dev/dvb/adapter%d/frontend0\", i)",
          "old_line_content": "\t\tif(fd < 0)",
          "new_line_content": "\t\tsprintf(filename, \"/dev/dvb/adapter%d/frontend0\", i);",
          "content_same": false
        },
        {
          "line": 803,
          "old_api": null,
          "new_api": "open",
          "old_text": null,
          "new_text": "open(filename, O_RDWR | O_NONBLOCK)",
          "old_line_content": "\t\t{",
          "new_line_content": "\t\tfd = open(filename, O_RDWR | O_NONBLOCK);",
          "content_same": false
        },
        {
          "line": 806,
          "old_api": null,
          "new_api": "mp_msg",
          "old_text": null,
          "new_text": "mp_msg(MSGT_DEMUX, MSGL_V, \"DVB_CONFIG, can't open device %s, skipping\\n\", filename)",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\t\tmp_msg(MSGT_DEMUX, MSGL_V, \"DVB_CONFIG, can't open device %s, skipping\\n\", filename);",
          "content_same": false
        },
        {
          "line": 810,
          "old_api": null,
          "new_api": "dvb_get_tuner_type",
          "old_text": null,
          "new_text": "dvb_get_tuner_type(fd)",
          "old_line_content": "\t\tif(type != TUNER_SAT && type != TUNER_TER && type != TUNER_CBL && type != TUNER_ATSC)",
          "new_line_content": "\t\ttype = dvb_get_tuner_type(fd);",
          "content_same": false
        },
        {
          "line": 811,
          "old_api": null,
          "new_api": "close",
          "old_text": null,
          "new_text": "close(fd)",
          "old_line_content": "\t\t{",
          "new_line_content": "\t\tclose(fd);",
          "content_same": false
        },
        {
          "line": 814,
          "old_api": null,
          "new_api": "mp_msg",
          "old_text": null,
          "new_text": "mp_msg(MSGT_DEMUX, MSGL_V, \"DVB_CONFIG, can't detect tuner type of card %d, skipping\\n\", i)",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\t\tmp_msg(MSGT_DEMUX, MSGL_V, \"DVB_CONFIG, can't detect tuner type of card %d, skipping\\n\", i);",
          "content_same": false
        },
        {
          "line": 821,
          "old_api": null,
          "new_api": "get_path",
          "old_text": null,
          "new_text": "get_path(\"channels.conf.ter\")",
          "old_line_content": "\t\t\t\tcase TUNER_CBL:",
          "new_line_content": "\t\t\t\tconf_file = get_path(\"channels.conf.ter\");",
          "content_same": false
        },
        {
          "line": 824,
          "old_api": null,
          "new_api": "get_path",
          "old_text": null,
          "new_text": "get_path(\"channels.conf.cbl\")",
          "old_line_content": "\t\t\t\tcase TUNER_SAT:",
          "new_line_content": "\t\t\t\tconf_file = get_path(\"channels.conf.cbl\");",
          "content_same": false
        },
        {
          "line": 827,
          "old_api": null,
          "new_api": "get_path",
          "old_text": null,
          "new_text": "get_path(\"channels.conf.sat\")",
          "old_line_content": "\t\t\t\tcase TUNER_ATSC:",
          "new_line_content": "\t\t\t\tconf_file = get_path(\"channels.conf.sat\");",
          "content_same": false
        },
        {
          "line": 830,
          "old_api": null,
          "new_api": "get_path",
          "old_text": null,
          "new_text": "get_path(\"channels.conf.atsc\")",
          "old_line_content": "\t\t\t}",
          "new_line_content": "\t\t\t\tconf_file = get_path(\"channels.conf.atsc\");",
          "content_same": false
        },
        {
          "line": 834,
          "old_api": null,
          "new_api": "access",
          "old_text": null,
          "new_text": "access(conf_file, F_OK | R_OK)",
          "old_line_content": "",
          "new_line_content": "\t\tif((access(conf_file, F_OK | R_OK) != 0))",
          "content_same": false
        },
        {
          "line": 837,
          "old_api": null,
          "new_api": "dvb_get_channels",
          "old_text": null,
          "new_text": "dvb_get_channels(conf_file, type)",
          "old_line_content": "\t\t\tcontinue;",
          "new_line_content": "\t\tlist = dvb_get_channels(conf_file, type);",
          "content_same": false
        },
        {
          "line": 842,
          "old_api": null,
          "new_api": "realloc",
          "old_text": null,
          "new_text": "realloc(conf->cards, size)",
          "old_line_content": "\t\tif(tmp == NULL)",
          "new_line_content": "\t\ttmp = realloc(conf->cards, size);",
          "content_same": false
        },
        {
          "line": 846,
          "old_api": null,
          "new_api": "fprintf",
          "old_text": null,
          "new_text": "fprintf(stderr, \"DVB_CONFIG, can't realloc %d bytes, skipping\\n\", size)",
          "old_line_content": "\t}",
          "new_line_content": "\t\t\tfprintf(stderr, \"DVB_CONFIG, can't realloc %d bytes, skipping\\n\", size);",
          "content_same": false
        },
        {
          "line": 851,
          "old_api": null,
          "new_api": "malloc",
          "old_text": null,
          "new_text": "malloc(20)",
          "old_line_content": "\t{",
          "new_line_content": "\t\tname = (char*) malloc(20);",
          "content_same": false
        },
        {
          "line": 854,
          "old_api": null,
          "new_api": "fprintf",
          "old_text": null,
          "new_text": "fprintf(stderr, \"DVB_CONFIG, can't realloc 20 bytes, skipping\\n\")",
          "old_line_content": "\t}",
          "new_line_content": "\t\t\tfprintf(stderr, \"DVB_CONFIG, can't realloc 20 bytes, skipping\\n\");",
          "content_same": false
        },
        {
          "line": 862,
          "old_api": null,
          "new_api": "sprintf",
          "old_text": null,
          "new_text": "sprintf(name, \"DVB-%c card n. %d\", type==TUNER_TER ? 'T' : (type==TUNER_CBL ? 'C' : 'S'), conf->count+1)",
          "old_line_content": "\t\tconf->count++;",
          "new_line_content": "\t\tsprintf(name, \"DVB-%c card n. %d\", type==TUNER_TER ? 'T' : (type==TUNER_CBL ? 'C' : 'S'), conf->count+1);",
          "content_same": false
        },
        {
          "line": 869,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free(conf)",
          "old_line_content": "\t}",
          "new_line_content": "\t\tfree(conf);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 791,
          "old_api": "malloc",
          "new_api": null,
          "old_text": "malloc(sizeof(dvb_config_t))",
          "new_text": null,
          "old_line_content": "\tconf = (dvb_config_t*) malloc(sizeof(dvb_config_t));",
          "new_line_content": "\t\treturn dvb_config;",
          "content_same": false
        },
        {
          "line": 800,
          "old_api": "sprintf",
          "new_api": null,
          "old_text": "sprintf(filename, \"/dev/dvb/adapter%d/frontend0\", i)",
          "new_text": null,
          "old_line_content": "\t\tsprintf(filename, \"/dev/dvb/adapter%d/frontend0\", i);",
          "new_line_content": "\tfor(i=0; i<MAX_CARDS; i++)",
          "content_same": false
        },
        {
          "line": 801,
          "old_api": "open",
          "new_api": null,
          "old_text": "open(filename, O_RDWR | O_NONBLOCK)",
          "new_text": null,
          "old_line_content": "\t\tfd = open(filename, O_RDWR | O_NONBLOCK);",
          "new_line_content": "\t{",
          "content_same": false
        },
        {
          "line": 804,
          "old_api": "mp_msg",
          "new_api": null,
          "old_text": "mp_msg(MSGT_DEMUX, MSGL_V, \"DVB_CONFIG, can't open device %s, skipping\\n\", filename)",
          "new_text": null,
          "old_line_content": "\t\t\tmp_msg(MSGT_DEMUX, MSGL_V, \"DVB_CONFIG, can't open device %s, skipping\\n\", filename);",
          "new_line_content": "\t\tif(fd < 0)",
          "content_same": false
        },
        {
          "line": 808,
          "old_api": "dvb_get_tuner_type",
          "new_api": null,
          "old_text": "dvb_get_tuner_type(fd)",
          "new_text": null,
          "old_line_content": "\t\ttype = dvb_get_tuner_type(fd);",
          "new_line_content": "\t\t}",
          "content_same": false
        },
        {
          "line": 809,
          "old_api": "close",
          "new_api": null,
          "old_text": "close(fd)",
          "new_text": null,
          "old_line_content": "\t\tclose(fd);",
          "new_line_content": "\t\t\t",
          "content_same": false
        },
        {
          "line": 812,
          "old_api": "mp_msg",
          "new_api": null,
          "old_text": "mp_msg(MSGT_DEMUX, MSGL_V, \"DVB_CONFIG, can't detect tuner type of card %d, skipping\\n\", i)",
          "new_text": null,
          "old_line_content": "\t\t\tmp_msg(MSGT_DEMUX, MSGL_V, \"DVB_CONFIG, can't detect tuner type of card %d, skipping\\n\", i);",
          "new_line_content": "\t\tif(type != TUNER_SAT && type != TUNER_TER && type != TUNER_CBL && type != TUNER_ATSC)",
          "content_same": false
        },
        {
          "line": 819,
          "old_api": "get_path",
          "new_api": null,
          "old_text": "get_path(\"channels.conf.ter\")",
          "new_text": null,
          "old_line_content": "\t\t\t\tconf_file = get_path(\"channels.conf.ter\");",
          "new_line_content": "\t\t\t{",
          "content_same": false
        },
        {
          "line": 822,
          "old_api": "get_path",
          "new_api": null,
          "old_text": "get_path(\"channels.conf.cbl\")",
          "new_text": null,
          "old_line_content": "\t\t\t\tconf_file = get_path(\"channels.conf.cbl\");",
          "new_line_content": "\t\t\t\t\tbreak;",
          "content_same": false
        },
        {
          "line": 825,
          "old_api": "get_path",
          "new_api": null,
          "old_text": "get_path(\"channels.conf.sat\")",
          "new_text": null,
          "old_line_content": "\t\t\t\tconf_file = get_path(\"channels.conf.sat\");",
          "new_line_content": "\t\t\t\t\tbreak;",
          "content_same": false
        },
        {
          "line": 828,
          "old_api": "get_path",
          "new_api": null,
          "old_text": "get_path(\"channels.conf.atsc\")",
          "new_text": null,
          "old_line_content": "\t\t\t\tconf_file = get_path(\"channels.conf.atsc\");",
          "new_line_content": "\t\t\t\t\tbreak;",
          "content_same": false
        },
        {
          "line": 832,
          "old_api": "access",
          "new_api": null,
          "old_text": "access(conf_file, F_OK | R_OK)",
          "new_text": null,
          "old_line_content": "\t\tif((access(conf_file, F_OK | R_OK) != 0))",
          "new_line_content": "\t\t\t}",
          "content_same": false
        },
        {
          "line": 833,
          "old_api": "get_path",
          "new_api": null,
          "old_text": "get_path(\"channels.conf\")",
          "new_text": null,
          "old_line_content": "\t\t\tconf_file = get_path(\"channels.conf\");",
          "new_line_content": "\t\t",
          "content_same": false
        },
        {
          "line": 840,
          "old_api": "realloc",
          "new_api": null,
          "old_text": "realloc(conf->cards, size)",
          "new_text": null,
          "old_line_content": "\t\ttmp = realloc(conf->cards, size);",
          "new_line_content": "\t\t",
          "content_same": false
        },
        {
          "line": 844,
          "old_api": "fprintf",
          "new_api": null,
          "old_text": "fprintf(stderr, \"DVB_CONFIG, can't realloc %d bytes, skipping\\n\", size)",
          "new_text": null,
          "old_line_content": "\t\t\tfprintf(stderr, \"DVB_CONFIG, can't realloc %d bytes, skipping\\n\", size);",
          "new_line_content": "\t\tif(tmp == NULL)",
          "content_same": false
        },
        {
          "line": 849,
          "old_api": "malloc",
          "new_api": null,
          "old_text": "malloc(20)",
          "new_text": null,
          "old_line_content": "\t\tname = (char*) malloc(20);",
          "new_line_content": "\t\tcards = tmp;",
          "content_same": false
        },
        {
          "line": 852,
          "old_api": "fprintf",
          "new_api": null,
          "old_text": "fprintf(stderr, \"DVB_CONFIG, can't realloc 20 bytes, skipping\\n\")",
          "new_text": null,
          "old_line_content": "\t\t\tfprintf(stderr, \"DVB_CONFIG, can't realloc 20 bytes, skipping\\n\");",
          "new_line_content": "\t\tif(name==NULL)",
          "content_same": false
        },
        {
          "line": 860,
          "old_api": "sprintf",
          "new_api": null,
          "old_text": "sprintf(name, \"DVB-%c card n. %d\", type==TUNER_TER ? 'T' : (type==TUNER_CBL ? 'C' : 'S'), conf->count+1)",
          "new_text": null,
          "old_line_content": "\t\tsprintf(name, \"DVB-%c card n. %d\", type==TUNER_TER ? 'T' : (type==TUNER_CBL ? 'C' : 'S'), conf->count+1);",
          "new_line_content": "\t\tconf->cards[conf->count].list = list;",
          "content_same": false
        },
        {
          "line": 867,
          "old_api": "free",
          "new_api": null,
          "old_text": "free(conf)",
          "new_text": null,
          "old_line_content": "\t\tfree(conf);",
          "new_line_content": "\tif(conf->count == 0)",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 1,
      "total_additions": 19,
      "total_deletions": 19,
      "total_api_changes": 39
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 2,
        "api_related_lines": 39,
        "non_api_lines": 2,
        "non_api_line_numbers": [
          776,
          775
        ]
      }
    },
    "api_calls_before": 167,
    "api_calls_after": 167,
    "diff_info": {
      "added_lines": 2,
      "removed_lines": 0,
      "total_diff_lines": 14
    }
  }
}