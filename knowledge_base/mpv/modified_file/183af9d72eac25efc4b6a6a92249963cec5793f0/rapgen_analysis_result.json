{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/183af9d72eac25efc4b6a6a92249963cec5793f0",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/183af9d72eac25efc4b6a6a92249963cec5793f0/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/183af9d72eac25efc4b6a6a92249963cec5793f0/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/183af9d72eac25efc4b6a6a92249963cec5793f0/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 798,
          "old_api": "MP_ARRAY_SIZE",
          "new_api": "vo_get_num_req_frames",
          "old_text": "MP_ARRAY_SIZE(mpctx->next_frames)",
          "new_text": "vo_get_num_req_frames(mpctx->video_out)",
          "old_line_content": "    return MPCLAMP(req, 2, MP_ARRAY_SIZE(mpctx->next_frames) - 1);",
          "new_line_content": "    int req = vo_get_num_req_frames(mpctx->video_out);",
          "content_same": false
        },
        {
          "line": 811,
          "old_api": "assert",
          "new_api": "MP_ARRAY_SIZE",
          "old_text": "assert(frame)",
          "new_text": "MP_ARRAY_SIZE(mpctx->next_frames)",
          "old_line_content": "    assert(frame);",
          "new_line_content": "    assert(mpctx->num_next_frames < MP_ARRAY_SIZE(mpctx->next_frames));",
          "content_same": false
        },
        {
          "line": 960,
          "old_api": "MP_WARN",
          "new_api": "fabs",
          "old_text": "MP_WARN(mpctx, \"%s\", av_desync_help_text)",
          "new_text": "fabs(mpctx->last_av_difference)",
          "old_line_content": "        MP_WARN(mpctx, \"%s\", av_desync_help_text);",
          "new_line_content": "    if (fabs(mpctx->last_av_difference) > 0.5 && !mpctx->drop_message_shown) {",
          "content_same": false
        },
        {
          "line": 1010,
          "old_api": "fabs",
          "new_api": "rint",
          "old_text": "fabs(scale - 1)",
          "new_text": "rint(ratio * factor)",
          "old_line_content": "        double dev = fabs(scale - 1);",
          "new_line_content": "        double scale = ratio * factor / rint(ratio * factor);",
          "content_same": false
        },
        {
          "line": 1038,
          "old_api": "af_fmt_is_pcm",
          "new_api": "ao_get_format",
          "old_text": "af_fmt_is_pcm(out_format.format)",
          "new_text": "ao_get_format(mpctx->ao_chain->ao, &out_format)",
          "old_line_content": "        return !af_fmt_is_pcm(out_format.format);",
          "new_line_content": "        ao_get_format(mpctx->ao_chain->ao, &out_format);",
          "content_same": false
        },
        {
          "line": 1113,
          "old_api": "isnormal",
          "new_api": "compute_audio_drift",
          "old_text": "isnormal(drift)",
          "new_text": "compute_audio_drift(mpctx, vsync)",
          "old_line_content": "            if (isnormal(drift)) {",
          "new_line_content": "            double drift = compute_audio_drift(mpctx, vsync);",
          "content_same": false
        },
        {
          "line": 1351,
          "old_api": "MP_TRACE",
          "new_api": "video_output_image",
          "old_text": "MP_TRACE(mpctx, \"video_output_image: %d\\n\", r)",
          "new_text": "video_output_image(mpctx)",
          "old_line_content": "    MP_TRACE(mpctx, \"video_output_image: %d\\n\", r);",
          "new_line_content": "    int r = video_output_image(mpctx);",
          "content_same": false
        },
        {
          "line": 1378,
          "old_api": "mp_set_timeout",
          "new_api": "get_relative_time",
          "old_text": "mp_set_timeout(mpctx, mpctx->time_frame)",
          "new_text": "get_relative_time(mpctx)",
          "old_line_content": "            mp_set_timeout(mpctx, mpctx->time_frame);",
          "new_line_content": "            mpctx->time_frame -= get_relative_time(mpctx);",
          "content_same": false
        },
        {
          "line": 1409,
          "old_api": "snprintf",
          "new_api": "mp_image_params_get_dsize",
          "old_text": "snprintf(extra, sizeof(extra), \" => %dx%d\", d_w, d_h)",
          "new_text": "mp_image_params_get_dsize(&p, &d_w, &d_h)",
          "old_line_content": "            snprintf(extra, sizeof(extra), \" => %dx%d\", d_w, d_h);",
          "new_line_content": "            mp_image_params_get_dsize(&p, &d_w, &d_h);",
          "content_same": false
        },
        {
          "line": 1412,
          "old_api": "vo_format_name",
          "new_api": "MP_INFO",
          "old_text": "vo_format_name(p.imgfmt)",
          "new_text": "MP_INFO(mpctx, \"VO: [%s] %dx%d%s %s\\n\",\n                info->name, p.w, p.h, extra, vo_format_name(p.imgfmt))",
          "old_line_content": "                info->name, p.w, p.h, extra, vo_format_name(p.imgfmt));",
          "new_line_content": "        MP_INFO(mpctx, \"VO: [%s] %dx%d%s %s\\n\",",
          "content_same": false
        },
        {
          "line": 1413,
          "old_api": "MP_VERBOSE",
          "new_api": "vo_format_name",
          "old_text": "MP_VERBOSE(mpctx, \"VO: Description: %s\\n\", info->description)",
          "new_text": "vo_format_name(p.imgfmt)",
          "old_line_content": "        MP_VERBOSE(mpctx, \"VO: Description: %s\\n\", info->description);",
          "new_line_content": "                info->name, p.w, p.h, extra, vo_format_name(p.imgfmt));",
          "content_same": false
        },
        {
          "line": 1424,
          "old_api": "update_avsync_before_frame",
          "new_api": "get_relative_time",
          "old_text": "update_avsync_before_frame(mpctx)",
          "new_text": "get_relative_time(mpctx)",
          "old_line_content": "    update_avsync_before_frame(mpctx);",
          "new_line_content": "    mpctx->time_frame -= get_relative_time(mpctx);",
          "content_same": false
        },
        {
          "line": 1427,
          "old_api": "MP_VERBOSE",
          "new_api": "update_subtitles",
          "old_text": "MP_VERBOSE(mpctx, \"Video frame delayed due waiting on subtitles.\\n\")",
          "new_text": "update_subtitles(mpctx, mpctx->next_frames[0]->pts)",
          "old_line_content": "        MP_VERBOSE(mpctx, \"Video frame delayed due waiting on subtitles.\\n\");",
          "new_line_content": "    if (!update_subtitles(mpctx, mpctx->next_frames[0]->pts)) {",
          "content_same": false
        },
        {
          "line": 1432,
          "old_api": "mp_time_us",
          "new_api": "MPMAX",
          "old_text": "mp_time_us()",
          "new_text": "MPMAX(mpctx->time_frame, -1)",
          "old_line_content": "    int64_t pts = mp_time_us() + (int64_t)(time_frame * 1e6);",
          "new_line_content": "    double time_frame = MPMAX(mpctx->time_frame, -1);",
          "content_same": false
        },
        {
          "line": 1438,
          "old_api": "video_feed_async_filter",
          "new_api": "vo_is_ready_for_frame",
          "old_text": "video_feed_async_filter(mpctx)",
          "new_text": "vo_is_ready_for_frame(vo, mpctx->display_sync_active ? -1 : pts)",
          "old_line_content": "        if (video_feed_async_filter(mpctx) < 0)",
          "new_line_content": "    if (!vo_is_ready_for_frame(vo, mpctx->display_sync_active ? -1 : pts)) {",
          "content_same": false
        },
        {
          "line": 1456,
          "old_api": "assert",
          "new_api": "vo_get_num_req_frames",
          "old_text": "assert(req >= 1 && req <= VO_MAX_REQ_FRAMES)",
          "new_text": "vo_get_num_req_frames(mpctx->video_out)",
          "old_line_content": "    assert(req >= 1 && req <= VO_MAX_REQ_FRAMES);",
          "new_line_content": "    int req = vo_get_num_req_frames(mpctx->video_out);",
          "content_same": false
        },
        {
          "line": 1500,
          "old_api": "MP_VERBOSE",
          "new_api": "vo_wait_frame",
          "old_text": "MP_VERBOSE(mpctx, \"first video frame after restart shown\\n\")",
          "new_text": "vo_wait_frame(vo)",
          "old_line_content": "        MP_VERBOSE(mpctx, \"first video frame after restart shown\\n\");",
          "new_line_content": "        vo_wait_frame(vo);",
          "content_same": false
        },
        {
          "line": 1526,
          "old_api": "uninit_video_chain",
          "new_api": "MP_FATAL",
          "old_text": "uninit_video_chain(mpctx)",
          "new_text": "MP_FATAL(mpctx, \"Could not initialize video chain.\\n\")",
          "old_line_content": "    uninit_video_chain(mpctx);",
          "new_line_content": "    MP_FATAL(mpctx, \"Could not initialize video chain.\\n\");",
          "content_same": false
        },
        {
          "line": 1527,
          "old_api": "error_on_track",
          "new_api": "uninit_video_chain",
          "old_text": "error_on_track(mpctx, track)",
          "new_text": "uninit_video_chain(mpctx)",
          "old_line_content": "    error_on_track(mpctx, track);",
          "new_line_content": "    uninit_video_chain(mpctx);",
          "content_same": false
        },
        {
          "line": 1528,
          "old_api": "handle_force_window",
          "new_api": "error_on_track",
          "old_text": "handle_force_window(mpctx, true)",
          "new_text": "error_on_track(mpctx, track)",
          "old_line_content": "    handle_force_window(mpctx, true);",
          "new_line_content": "    error_on_track(mpctx, track);",
          "content_same": false
        },
        {
          "line": 1529,
          "old_api": "mp_wakeup_core",
          "new_api": "handle_force_window",
          "old_text": "mp_wakeup_core(mpctx)",
          "new_text": "handle_force_window(mpctx, true)",
          "old_line_content": "    mp_wakeup_core(mpctx);",
          "new_line_content": "    handle_force_window(mpctx, true);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 1028,
          "old_api": null,
          "new_api": "calc_best_speed",
          "old_text": null,
          "new_text": "calc_best_speed(vsync, dur / mpctx->opts->playback_speed)",
          "old_line_content": "        num++;",
          "new_line_content": "        total += calc_best_speed(vsync, dur / mpctx->opts->playback_speed);",
          "content_same": false
        },
        {
          "line": 1039,
          "old_api": null,
          "new_api": "af_fmt_is_pcm",
          "old_text": null,
          "new_text": "af_fmt_is_pcm(out_format.format)",
          "old_line_content": "    }",
          "new_line_content": "        return !af_fmt_is_pcm(out_format.format);",
          "content_same": false
        },
        {
          "line": 1098,
          "old_api": null,
          "new_api": "fabs",
          "old_text": null,
          "new_text": "fabs(av_diff)",
          "old_line_content": "        new = av_diff >= 0 ? 1 : -1;",
          "new_line_content": "    if (fabs(av_diff) > max_drift)",
          "content_same": false
        },
        {
          "line": 1104,
          "old_api": null,
          "new_api": "MP_VERBOSE",
          "old_text": null,
          "new_text": "MP_VERBOSE(mpctx, \"Change display sync audio drift: %d\\n\", new)",
          "old_line_content": "        mpctx->display_sync_drift_dir = new;",
          "new_line_content": "            MP_VERBOSE(mpctx, \"Change display sync audio drift: %d\\n\", new);",
          "content_same": false
        },
        {
          "line": 1114,
          "old_api": null,
          "new_api": "isnormal",
          "old_text": null,
          "new_text": "isnormal(drift)",
          "old_line_content": "                // other = will be multiplied with audio_factor for final speed",
          "new_line_content": "            if (isnormal(drift)) {",
          "content_same": false
        },
        {
          "line": 1118,
          "old_api": null,
          "new_api": "MP_VERBOSE",
          "old_text": null,
          "new_text": "MP_VERBOSE(mpctx, \"Compensation factor: %f\\n\", audio_factor)",
          "old_line_content": "            }",
          "new_line_content": "                MP_VERBOSE(mpctx, \"Compensation factor: %f\\n\", audio_factor);",
          "content_same": false
        },
        {
          "line": 1122,
          "old_api": null,
          "new_api": "MPCLAMP",
          "old_text": null,
          "new_text": "MPCLAMP(audio_factor, 1 - max_correct, 1 + max_correct)",
          "old_line_content": "        mpctx->speed_factor_a = audio_factor * mpctx->speed_factor_v;",
          "new_line_content": "        audio_factor = MPCLAMP(audio_factor, 1 - max_correct, 1 + max_correct);",
          "content_same": false
        },
        {
          "line": 1142,
          "old_api": null,
          "new_api": "VS_IS_DISP",
          "old_text": null,
          "new_text": "VS_IS_DISP(mode)",
          "old_line_content": "        return;",
          "new_line_content": "    if (!VS_IS_DISP(mode) || mpctx->display_sync_broken)",
          "content_same": false
        },
        {
          "line": 1150,
          "old_api": null,
          "new_api": "using_spdif_passthrough",
          "old_text": null,
          "new_text": "using_spdif_passthrough(mpctx)",
          "old_line_content": "        return;",
          "new_line_content": "    if (resample && using_spdif_passthrough(mpctx))",
          "content_same": false
        },
        {
          "line": 1153,
          "old_api": null,
          "new_api": "vo_get_vsync_interval",
          "old_text": null,
          "new_text": "vo_get_vsync_interval(vo)",
          "old_line_content": "    if (vsync <= 0)",
          "new_line_content": "    double vsync = vo_get_vsync_interval(vo) / 1e6;",
          "content_same": false
        },
        {
          "line": 1157,
          "old_api": null,
          "new_api": "MPMAX",
          "old_text": null,
          "new_text": "MPMAX(0, mpctx->past_frames[0].approx_duration)",
          "old_line_content": "    adjusted_duration /= opts->playback_speed;",
          "new_line_content": "    double adjusted_duration = MPMAX(0, mpctx->past_frames[0].approx_duration);",
          "content_same": false
        },
        {
          "line": 1164,
          "old_api": null,
          "new_api": "find_best_speed",
          "old_text": null,
          "new_text": "find_best_speed(mpctx, vsync)",
          "old_line_content": "        // If it doesn't work, play at normal speed.",
          "new_line_content": "        double best = find_best_speed(mpctx, vsync);",
          "content_same": false
        },
        {
          "line": 1166,
          "old_api": null,
          "new_api": "fabs",
          "old_text": null,
          "new_text": "fabs(best - 1.0)",
          "old_line_content": "            mpctx->speed_factor_v = best;",
          "new_line_content": "        if (fabs(best - 1.0) <= opts->sync_max_video_change / 100)",
          "content_same": false
        },
        {
          "line": 1171,
          "old_api": null,
          "new_api": "fabs",
          "old_text": null,
          "new_text": "fabs(av_diff)",
          "old_line_content": "        mpctx->display_sync_broken = true;",
          "new_line_content": "    if (fabs(av_diff) > 0.5) {",
          "content_same": false
        },
        {
          "line": 1182,
          "old_api": null,
          "new_api": "lrint",
          "old_text": null,
          "new_text": "lrint(ratio)",
          "old_line_content": "    double prev_error = mpctx->display_sync_error;",
          "new_line_content": "    int num_vsyncs = MPMAX(lrint(ratio), 0);",
          "content_same": false
        },
        {
          "line": 1186,
          "old_api": null,
          "new_api": "MP_DBG",
          "old_text": null,
          "new_text": "MP_DBG(mpctx, \"s=%f vsyncs=%d dur=%f ratio=%f err=%.20f (%f/%f)\\n\",\n           mpctx->speed_factor_v, num_vsyncs, adjusted_duration, ratio,\n           mpctx->display_sync_error, mpctx->display_sync_error / vsync,\n           mpctx->display_sync_error / frame_duration)",
          "old_line_content": "           mpctx->speed_factor_v, num_vsyncs, adjusted_duration, ratio,",
          "new_line_content": "    MP_DBG(mpctx, \"s=%f vsyncs=%d dur=%f ratio=%f err=%.20f (%f/%f)\\n\",",
          "content_same": false
        },
        {
          "line": 1191,
          "old_api": null,
          "new_api": "MP_STATS",
          "old_text": null,
          "new_text": "MP_STATS(mpctx, \"value %f avdiff\", av_diff)",
          "old_line_content": "",
          "new_line_content": "    MP_STATS(mpctx, \"value %f avdiff\", av_diff);",
          "content_same": false
        },
        {
          "line": 1198,
          "old_api": null,
          "new_api": "fabs",
          "old_text": null,
          "new_text": "fabs(av_diff)",
          "old_line_content": "        drop_repeat = -av_diff / vsync; // round towards 0",
          "new_line_content": "    if (drop && fabs(av_diff) >= 0.020 && fabs(av_diff) / vsync >= 1)",
          "content_same": false
        },
        {
          "line": 1204,
          "old_api": null,
          "new_api": "MPCLAMP",
          "old_text": null,
          "new_text": "MPCLAMP(drop_repeat, -num_vsyncs, num_vsyncs * 10)",
          "old_line_content": "    num_vsyncs += drop_repeat;",
          "new_line_content": "    drop_repeat = MPCLAMP(drop_repeat, -num_vsyncs, num_vsyncs * 10);",
          "content_same": false
        },
        {
          "line": 1213,
          "old_api": null,
          "new_api": "vo_get_delay",
          "old_text": null,
          "new_text": "vo_get_delay(vo)",
          "old_line_content": "",
          "new_line_content": "    double time_left = vo_get_delay(vo);",
          "content_same": false
        },
        {
          "line": 1224,
          "old_api": null,
          "new_api": "vo_discard_timing_info",
          "old_text": null,
          "new_text": "vo_discard_timing_info(vo)",
          "old_line_content": "        time_left = 0;",
          "new_line_content": "        vo_discard_timing_info(vo);",
          "content_same": false
        },
        {
          "line": 1230,
          "old_api": null,
          "new_api": "MP_STATS",
          "old_text": null,
          "new_text": "MP_STATS(mpctx, \"mistimed\")",
          "old_line_content": "    }",
          "new_line_content": "        MP_STATS(mpctx, \"mistimed\");",
          "content_same": false
        },
        {
          "line": 1234,
          "old_api": null,
          "new_api": "update_av_diff",
          "old_text": null,
          "new_text": "update_av_diff(mpctx, time_left * opts->playback_speed)",
          "old_line_content": "",
          "new_line_content": "    update_av_diff(mpctx, time_left * opts->playback_speed);",
          "content_same": false
        },
        {
          "line": 1240,
          "old_api": null,
          "new_api": "adjust_audio_resample_speed",
          "old_text": null,
          "new_text": "adjust_audio_resample_speed(mpctx, vsync)",
          "old_line_content": "    } else {",
          "new_line_content": "        adjust_audio_resample_speed(mpctx, vsync);",
          "content_same": false
        },
        {
          "line": 732,
          "old_api": null,
          "new_api": "fabs",
          "old_text": null,
          "new_text": "fabs(av_delay)",
          "old_line_content": "    double max_change = opts->default_max_pts_correction >= 0 ?",
          "new_line_content": "    double factor = fabs(av_delay) < 0.3 ? 0.1 : 0.4;",
          "content_same": false
        },
        {
          "line": 1255,
          "old_api": null,
          "new_api": "update_playback_speed",
          "old_text": null,
          "new_text": "update_playback_speed(mpctx)",
          "old_line_content": "",
          "new_line_content": "    update_playback_speed(mpctx);",
          "content_same": false
        },
        {
          "line": 1258,
          "old_api": null,
          "new_api": "MP_STATS",
          "old_text": null,
          "new_text": "MP_STATS(mpctx, \"value %f vspeed\", mpctx->speed_factor_v - 1)",
          "old_line_content": "}",
          "new_line_content": "    MP_STATS(mpctx, \"value %f vspeed\", mpctx->speed_factor_v - 1);",
          "content_same": false
        },
        {
          "line": 751,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(mpctx->num_next_frames >= 1)",
          "old_line_content": "",
          "new_line_content": "    assert(mpctx->num_next_frames >= 1);",
          "content_same": false
        },
        {
          "line": 1263,
          "old_api": null,
          "new_api": "handle_display_sync_frame",
          "old_text": null,
          "new_text": "handle_display_sync_frame(mpctx, frame)",
          "old_line_content": "",
          "new_line_content": "    handle_display_sync_frame(mpctx, frame);",
          "content_same": false
        },
        {
          "line": 1268,
          "old_api": null,
          "new_api": "MP_VERBOSE",
          "old_text": null,
          "new_text": "MP_VERBOSE(mpctx, \"Video sync mode %s.\\n\",\n                   mpctx->display_sync_active ? \"enabled\" : \"disabled\")",
          "old_line_content": "                   mpctx->display_sync_active ? \"enabled\" : \"disabled\");",
          "new_line_content": "        MP_VERBOSE(mpctx, \"Video sync mode %s.\\n\",",
          "content_same": false
        },
        {
          "line": 760,
          "old_api": null,
          "new_api": "MP_WARN",
          "old_text": null,
          "new_text": "MP_WARN(mpctx, \"Invalid video timestamp: %f -> %f\\n\",\n                    mpctx->video_pts, pts)",
          "old_line_content": "                    mpctx->video_pts, pts);",
          "new_line_content": "            MP_WARN(mpctx, \"Invalid video timestamp: %f -> %f\\n\",",
          "content_same": false
        },
        {
          "line": 1275,
          "old_api": null,
          "new_api": "update_playback_speed",
          "old_text": null,
          "new_text": "update_playback_speed(mpctx)",
          "old_line_content": "",
          "new_line_content": "        update_playback_speed(mpctx);",
          "content_same": false
        },
        {
          "line": 1277,
          "old_api": null,
          "new_api": "update_av_diff",
          "old_text": null,
          "new_text": "update_av_diff(mpctx, mpctx->time_frame > 0 ?\n            mpctx->time_frame * mpctx->video_speed : 0)",
          "old_line_content": "            mpctx->time_frame * mpctx->video_speed : 0);",
          "new_line_content": "        update_av_diff(mpctx, mpctx->time_frame > 0 ?",
          "content_same": false
        },
        {
          "line": 768,
          "old_api": null,
          "new_api": "adjust_sync",
          "old_text": null,
          "new_text": "adjust_sync(mpctx, pts, frame_time)",
          "old_line_content": "    }",
          "new_line_content": "        adjust_sync(mpctx, pts, frame_time);",
          "content_same": false
        },
        {
          "line": 773,
          "old_api": null,
          "new_api": "MP_TRACE",
          "old_text": null,
          "new_text": "MP_TRACE(mpctx, \"frametime=%5.3f\\n\", frame_time)",
          "old_line_content": "}",
          "new_line_content": "    MP_TRACE(mpctx, \"frametime=%5.3f\\n\", frame_time);",
          "content_same": false
        },
        {
          "line": 1285,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(mpctx->num_past_frames >= 1 && mpctx->num_next_frames >= 1)",
          "old_line_content": "",
          "new_line_content": "    assert(mpctx->num_past_frames >= 1 && mpctx->num_next_frames >= 1);",
          "content_same": false
        },
        {
          "line": 781,
          "old_api": null,
          "new_api": "talloc_free",
          "old_text": null,
          "new_text": "talloc_free(mpctx->next_frames[0])",
          "old_line_content": "    for (int n = 0; n < mpctx->num_next_frames - 1; n++)",
          "new_line_content": "    talloc_free(mpctx->next_frames[0]);",
          "content_same": false
        },
        {
          "line": 1310,
          "old_api": null,
          "new_api": "fabs",
          "old_text": null,
          "new_text": "fabs(dur - duration)",
          "old_line_content": "            break;",
          "new_line_content": "        if (dur <= 0 || fabs(dur - duration) >= tolerance)",
          "content_same": false
        },
        {
          "line": 799,
          "old_api": null,
          "new_api": "MP_ARRAY_SIZE",
          "old_text": null,
          "new_text": "MP_ARRAY_SIZE(mpctx->next_frames)",
          "old_line_content": "}",
          "new_line_content": "    return MPCLAMP(req, 2, MP_ARRAY_SIZE(mpctx->next_frames) - 1);",
          "content_same": false
        },
        {
          "line": 805,
          "old_api": null,
          "new_api": "get_req_frames",
          "old_text": null,
          "new_text": "get_req_frames(mpctx, false)",
          "old_line_content": "}",
          "new_line_content": "    return mpctx->num_next_frames < get_req_frames(mpctx, false);",
          "content_same": false
        },
        {
          "line": 1322,
          "old_api": null,
          "new_api": "fabs",
          "old_text": null,
          "new_text": "fabs(total - demux_duration * num_dur)",
          "old_line_content": "        {",
          "new_line_content": "            fabs(total - demux_duration * num_dur) < tolerance && num_dur >= 16)",
          "content_same": false
        },
        {
          "line": 812,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(frame)",
          "old_line_content": "    mpctx->next_frames[mpctx->num_next_frames++] = frame;",
          "new_line_content": "    assert(frame);",
          "content_same": false
        },
        {
          "line": 815,
          "old_api": null,
          "new_api": "handle_new_frame",
          "old_text": null,
          "new_text": "handle_new_frame(mpctx)",
          "old_line_content": "}",
          "new_line_content": "        handle_new_frame(mpctx);",
          "content_same": false
        },
        {
          "line": 1332,
          "old_api": null,
          "new_api": "MPMAX",
          "old_text": null,
          "new_text": "MPMAX(0, approx_duration)",
          "old_line_content": "}",
          "new_line_content": "    MP_STATS(mpctx, \"value %f frame-duration-approx\", MPMAX(0, approx_duration));",
          "content_same": false
        },
        {
          "line": 822,
          "old_api": null,
          "new_api": "get_req_frames",
          "old_text": null,
          "new_text": "get_req_frames(mpctx, eof)",
          "old_line_content": "}",
          "new_line_content": "    return mpctx->num_next_frames >= get_req_frames(mpctx, eof);",
          "content_same": false
        },
        {
          "line": 833,
          "old_api": null,
          "new_api": "vo_has_frame",
          "old_text": null,
          "new_text": "vo_has_frame(mpctx->video_out)",
          "old_line_content": "            return VD_EOF;",
          "new_line_content": "        if (vo_has_frame(mpctx->video_out))",
          "content_same": false
        },
        {
          "line": 838,
          "old_api": null,
          "new_api": "have_new_frame",
          "old_text": null,
          "new_text": "have_new_frame(mpctx, false)",
          "old_line_content": "        return VD_NEW_FRAME;",
          "new_line_content": "    if (have_new_frame(mpctx, false))",
          "content_same": false
        },
        {
          "line": 1352,
          "old_api": null,
          "new_api": "MP_TRACE",
          "old_text": null,
          "new_text": "MP_TRACE(mpctx, \"video_output_image: %d\\n\", r)",
          "old_line_content": "",
          "new_line_content": "    MP_TRACE(mpctx, \"video_output_image: %d\\n\", r);",
          "content_same": false
        },
        {
          "line": 843,
          "old_api": null,
          "new_api": "needs_new_frame",
          "old_text": null,
          "new_text": "needs_new_frame(mpctx)",
          "old_line_content": "        // Filter a new frame.",
          "new_line_content": "    if (needs_new_frame(mpctx)) {",
          "content_same": false
        },
        {
          "line": 845,
          "old_api": null,
          "new_api": "video_decode_and_filter",
          "old_text": null,
          "new_text": "video_decode_and_filter(mpctx)",
          "old_line_content": "        if (r < 0)",
          "new_line_content": "        r = video_decode_and_filter(mpctx);",
          "content_same": false
        },
        {
          "line": 848,
          "old_api": null,
          "new_api": "vf_read_output_frame",
          "old_text": null,
          "new_text": "vf_read_output_frame(vo_c->vf)",
          "old_line_content": "        if (img) {",
          "new_line_content": "        struct mp_image *img = vf_read_output_frame(vo_c->vf);",
          "content_same": false
        },
        {
          "line": 850,
          "old_api": null,
          "new_api": "get_play_end_pts",
          "old_text": null,
          "new_text": "get_play_end_pts(mpctx)",
          "old_line_content": "            if ((endpts != MP_NOPTS_VALUE && img->pts >= endpts) ||",
          "new_line_content": "            double endpts = get_play_end_pts(mpctx);",
          "content_same": false
        },
        {
          "line": 854,
          "old_api": null,
          "new_api": "vf_unread_output_frame",
          "old_text": null,
          "new_text": "vf_unread_output_frame(vo_c->vf, img)",
          "old_line_content": "                img = NULL;",
          "new_line_content": "                vf_unread_output_frame(vo_c->vf, img);",
          "content_same": false
        },
        {
          "line": 1366,
          "old_api": null,
          "new_api": "get_relative_time",
          "old_text": null,
          "new_text": "get_relative_time(mpctx)",
          "old_line_content": "            if (mpctx->num_past_frames == 1 && mpctx->past_frames[0].pts == 0 &&",
          "new_line_content": "            get_relative_time(mpctx);",
          "content_same": false
        },
        {
          "line": 858,
          "old_api": null,
          "new_api": "mp_image_setrefp",
          "old_text": null,
          "new_text": "mp_image_setrefp(&mpctx->saved_frame, img)",
          "old_line_content": "            } else if (hrseek && img->pts < mpctx->hrseek_pts - .005) {",
          "new_line_content": "                mp_image_setrefp(&mpctx->saved_frame, img);",
          "content_same": false
        },
        {
          "line": 1370,
          "old_api": null,
          "new_api": "MP_VERBOSE",
          "old_text": null,
          "new_text": "MP_VERBOSE(mpctx, \"assuming this is an image\\n\")",
          "old_line_content": "                mpctx->time_frame += opts->image_display_duration;",
          "new_line_content": "                MP_VERBOSE(mpctx, \"assuming this is an image\\n\");",
          "content_same": false
        },
        {
          "line": 862,
          "old_api": null,
          "new_api": "mp_image_setrefp",
          "old_text": null,
          "new_text": "mp_image_setrefp(&mpctx->saved_frame, img)",
          "old_line_content": "            } else if (mpctx->video_status == STATUS_SYNCING &&",
          "new_line_content": "                    mp_image_setrefp(&mpctx->saved_frame, img);",
          "content_same": false
        },
        {
          "line": 1379,
          "old_api": null,
          "new_api": "mp_set_timeout",
          "old_text": null,
          "new_text": "mp_set_timeout(mpctx, mpctx->time_frame)",
          "old_line_content": "            if (mpctx->time_frame <= 0) {",
          "new_line_content": "            mp_set_timeout(mpctx, mpctx->time_frame);",
          "content_same": false
        },
        {
          "line": 1381,
          "old_api": null,
          "new_api": "MP_VERBOSE",
          "old_text": null,
          "new_text": "MP_VERBOSE(mpctx, \"video EOF reached\\n\")",
          "old_line_content": "                mpctx->video_status = STATUS_EOF;",
          "new_line_content": "                MP_VERBOSE(mpctx, \"video EOF reached\\n\");",
          "content_same": false
        },
        {
          "line": 871,
          "old_api": null,
          "new_api": "add_new_frame",
          "old_text": null,
          "new_text": "add_new_frame(mpctx, mpctx->saved_frame)",
          "old_line_content": "                        mpctx->saved_frame = NULL;",
          "new_line_content": "                        add_new_frame(mpctx, mpctx->saved_frame);",
          "content_same": false
        },
        {
          "line": 874,
          "old_api": null,
          "new_api": "MP_WARN",
          "old_text": null,
          "new_text": "MP_WARN(mpctx, \"Backstep failed.\\n\")",
          "old_line_content": "                    }",
          "new_line_content": "                        MP_WARN(mpctx, \"Backstep failed.\\n\");",
          "content_same": false
        },
        {
          "line": 1386,
          "old_api": null,
          "new_api": "MP_DBG",
          "old_text": null,
          "new_text": "MP_DBG(mpctx, \"video EOF (status=%d)\\n\", mpctx->video_status)",
          "old_line_content": "        return;",
          "new_line_content": "        MP_DBG(mpctx, \"video EOF (status=%d)\\n\", mpctx->video_status);",
          "content_same": false
        },
        {
          "line": 878,
          "old_api": null,
          "new_api": "add_new_frame",
          "old_text": null,
          "new_text": "add_new_frame(mpctx, img)",
          "old_line_content": "                img = NULL;",
          "new_line_content": "                add_new_frame(mpctx, img);",
          "content_same": false
        },
        {
          "line": 881,
          "old_api": null,
          "new_api": "talloc_free",
          "old_text": null,
          "new_text": "talloc_free(img)",
          "old_line_content": "        }",
          "new_line_content": "            talloc_free(img);",
          "content_same": false
        },
        {
          "line": 1394,
          "old_api": null,
          "new_api": "mp_wakeup_core",
          "old_text": null,
          "new_text": "mp_wakeup_core(mpctx)",
          "old_line_content": "        return;",
          "new_line_content": "        mp_wakeup_core(mpctx); // Decode more in next iteration.",
          "content_same": false
        },
        {
          "line": 887,
          "old_api": null,
          "new_api": "add_new_frame",
          "old_text": null,
          "new_text": "add_new_frame(mpctx, mpctx->saved_frame)",
          "old_line_content": "        mpctx->saved_frame = NULL;",
          "new_line_content": "        add_new_frame(mpctx, mpctx->saved_frame);",
          "content_same": false
        },
        {
          "line": 1400,
          "old_api": null,
          "new_api": "mp_image_params_equal",
          "old_text": null,
          "new_text": "mp_image_params_equal(&p, vo->params)",
          "old_line_content": "        // Changing config deletes the current frame; wait until it's finished.",
          "new_line_content": "    if (!vo->params || !mp_image_params_equal(&p, vo->params)) {",
          "content_same": false
        },
        {
          "line": 1402,
          "old_api": null,
          "new_api": "vo_still_displaying",
          "old_text": null,
          "new_text": "vo_still_displaying(vo)",
          "old_line_content": "            return;",
          "new_line_content": "        if (vo_still_displaying(vo))",
          "content_same": false
        },
        {
          "line": 892,
          "old_api": null,
          "new_api": "have_new_frame",
          "old_text": null,
          "new_text": "have_new_frame(mpctx, r <= 0)",
          "old_line_content": "}",
          "new_line_content": "    return have_new_frame(mpctx, r <= 0) ? VD_NEW_FRAME : r;",
          "content_same": false
        },
        {
          "line": 1410,
          "old_api": null,
          "new_api": "snprintf",
          "old_text": null,
          "new_text": "snprintf(extra, sizeof(extra), \" => %dx%d\", d_w, d_h)",
          "old_line_content": "        }",
          "new_line_content": "            snprintf(extra, sizeof(extra), \" => %dx%d\", d_w, d_h);",
          "content_same": false
        },
        {
          "line": 1414,
          "old_api": null,
          "new_api": "MP_VERBOSE",
          "old_text": null,
          "new_text": "MP_VERBOSE(mpctx, \"VO: Description: %s\\n\", info->description)",
          "old_line_content": "",
          "new_line_content": "        MP_VERBOSE(mpctx, \"VO: Description: %s\\n\", info->description);",
          "content_same": false
        },
        {
          "line": 1416,
          "old_api": null,
          "new_api": "vo_reconfig",
          "old_text": null,
          "new_text": "vo_reconfig(vo, &p)",
          "old_line_content": "        if (vo_r < 0) {",
          "new_line_content": "        int vo_r = vo_reconfig(vo, &p);",
          "content_same": false
        },
        {
          "line": 909,
          "old_api": null,
          "new_api": "ao_untimed",
          "old_text": null,
          "new_text": "ao_untimed(mpctx->ao)",
          "old_line_content": "    {",
          "new_line_content": "               !ao_untimed(mpctx->ao))",
          "content_same": false
        },
        {
          "line": 1421,
          "old_api": null,
          "new_api": "init_vo",
          "old_text": null,
          "new_text": "init_vo(mpctx)",
          "old_line_content": "    }",
          "new_line_content": "        init_vo(mpctx);",
          "content_same": false
        },
        {
          "line": 911,
          "old_api": null,
          "new_api": "ao_get_delay",
          "old_text": null,
          "new_text": "ao_get_delay(mpctx->ao)",
          "old_line_content": "",
          "new_line_content": "        double buffered_audio = ao_get_delay(mpctx->ao);",
          "content_same": false
        },
        {
          "line": 1425,
          "old_api": null,
          "new_api": "update_avsync_before_frame",
          "old_text": null,
          "new_text": "update_avsync_before_frame(mpctx)",
          "old_line_content": "",
          "new_line_content": "    update_avsync_before_frame(mpctx);",
          "content_same": false
        },
        {
          "line": 916,
          "old_api": null,
          "new_api": "MP_STATS",
          "old_text": null,
          "new_text": "MP_STATS(mpctx, \"value %f audio-diff\", difference)",
          "old_line_content": "",
          "new_line_content": "        MP_STATS(mpctx, \"value %f audio-diff\", difference);",
          "content_same": false
        },
        {
          "line": 1428,
          "old_api": null,
          "new_api": "MP_VERBOSE",
          "old_text": null,
          "new_text": "MP_VERBOSE(mpctx, \"Video frame delayed due waiting on subtitles.\\n\")",
          "old_line_content": "        return;",
          "new_line_content": "        MP_VERBOSE(mpctx, \"Video frame delayed due waiting on subtitles.\\n\");",
          "content_same": false
        },
        {
          "line": 1433,
          "old_api": null,
          "new_api": "mp_time_us",
          "old_text": null,
          "new_text": "mp_time_us()",
          "old_line_content": "",
          "new_line_content": "    int64_t pts = mp_time_us() + (int64_t)(time_frame * 1e6);",
          "content_same": false
        },
        {
          "line": 1439,
          "old_api": null,
          "new_api": "video_feed_async_filter",
          "old_text": null,
          "new_text": "video_feed_async_filter(mpctx)",
          "old_line_content": "            goto error;",
          "new_line_content": "        if (video_feed_async_filter(mpctx) < 0)",
          "content_same": false
        },
        {
          "line": 1444,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(mpctx->num_next_frames >= 1)",
          "old_line_content": "",
          "new_line_content": "    assert(mpctx->num_next_frames >= 1);",
          "content_same": false
        },
        {
          "line": 1448,
          "old_api": null,
          "new_api": "MP_TARRAY_INSERT_AT",
          "old_text": null,
          "new_text": "MP_TARRAY_INSERT_AT(mpctx, mpctx->past_frames, mpctx->num_past_frames, 0,\n                        (struct frame_info){0})",
          "old_line_content": "                        (struct frame_info){0});",
          "new_line_content": "    MP_TARRAY_INSERT_AT(mpctx, mpctx->past_frames, mpctx->num_past_frames, 0,",
          "content_same": false
        },
        {
          "line": 1454,
          "old_api": null,
          "new_api": "calculate_frame_duration",
          "old_text": null,
          "new_text": "calculate_frame_duration(mpctx)",
          "old_line_content": "",
          "new_line_content": "    calculate_frame_duration(mpctx);",
          "content_same": false
        },
        {
          "line": 1457,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(req >= 1 && req <= VO_MAX_REQ_FRAMES)",
          "old_line_content": "    struct vo_frame dummy = {",
          "new_line_content": "    assert(req >= 1 && req <= VO_MAX_REQ_FRAMES);",
          "content_same": false
        },
        {
          "line": 1462,
          "old_api": null,
          "new_api": "MPMIN",
          "old_text": null,
          "new_text": "MPMIN(mpctx->num_next_frames, req)",
          "old_line_content": "        .num_vsyncs = 1,",
          "new_line_content": "        .num_frames = MPMIN(mpctx->num_next_frames, req),",
          "content_same": false
        },
        {
          "line": 954,
          "old_api": null,
          "new_api": "playing_audio_pts",
          "old_text": null,
          "new_text": "playing_audio_pts(mpctx)",
          "old_line_content": "    if (a_pos != MP_NOPTS_VALUE && mpctx->video_pts != MP_NOPTS_VALUE) {",
          "new_line_content": "    double a_pos = playing_audio_pts(mpctx);",
          "content_same": false
        },
        {
          "line": 1467,
          "old_api": null,
          "new_api": "vo_frame_ref",
          "old_text": null,
          "new_text": "vo_frame_ref(&dummy)",
          "old_line_content": "",
          "new_line_content": "    struct vo_frame *frame = vo_frame_ref(&dummy);",
          "content_same": false
        },
        {
          "line": 961,
          "old_api": null,
          "new_api": "MP_WARN",
          "old_text": null,
          "new_text": "MP_WARN(mpctx, \"%s\", av_desync_help_text)",
          "old_line_content": "        mpctx->drop_message_shown = true;",
          "new_line_content": "        MP_WARN(mpctx, \"%s\", av_desync_help_text);",
          "content_same": false
        },
        {
          "line": 1477,
          "old_api": null,
          "new_api": "MPCLAMP",
          "old_text": null,
          "new_text": "MPCLAMP(diff, 0, 10)",
          "old_line_content": "    }",
          "new_line_content": "        frame->duration = MPCLAMP(diff, 0, 10) * 1e6;",
          "content_same": false
        },
        {
          "line": 1483,
          "old_api": null,
          "new_api": "shift_frames",
          "old_text": null,
          "new_text": "shift_frames(mpctx)",
          "old_line_content": "",
          "new_line_content": "    shift_frames(mpctx);",
          "content_same": false
        },
        {
          "line": 972,
          "old_api": null,
          "new_api": "video_set_colors",
          "old_text": null,
          "new_text": "video_set_colors(vo_c, \"gamma\", opts->gamma_gamma)",
          "old_line_content": "    if (opts->gamma_brightness != 0)",
          "new_line_content": "        video_set_colors(vo_c, \"gamma\", opts->gamma_gamma);",
          "content_same": false
        },
        {
          "line": 1485,
          "old_api": null,
          "new_api": "schedule_frame",
          "old_text": null,
          "new_text": "schedule_frame(mpctx, frame)",
          "old_line_content": "",
          "new_line_content": "    schedule_frame(mpctx, frame);",
          "content_same": false
        },
        {
          "line": 974,
          "old_api": null,
          "new_api": "video_set_colors",
          "old_text": null,
          "new_text": "video_set_colors(vo_c, \"brightness\", opts->gamma_brightness)",
          "old_line_content": "    if (opts->gamma_contrast != 0)",
          "new_line_content": "        video_set_colors(vo_c, \"brightness\", opts->gamma_brightness);",
          "content_same": false
        },
        {
          "line": 976,
          "old_api": null,
          "new_api": "video_set_colors",
          "old_text": null,
          "new_text": "video_set_colors(vo_c, \"contrast\", opts->gamma_contrast)",
          "old_line_content": "    if (opts->gamma_saturation != 0)",
          "new_line_content": "        video_set_colors(vo_c, \"contrast\", opts->gamma_contrast);",
          "content_same": false
        },
        {
          "line": 1488,
          "old_api": null,
          "new_api": "update_osd_msg",
          "old_text": null,
          "new_text": "update_osd_msg(mpctx)",
          "old_line_content": "",
          "new_line_content": "    update_osd_msg(mpctx);",
          "content_same": false
        },
        {
          "line": 978,
          "old_api": null,
          "new_api": "video_set_colors",
          "old_text": null,
          "new_text": "video_set_colors(vo_c, \"saturation\", opts->gamma_saturation)",
          "old_line_content": "    if (opts->gamma_hue != 0)",
          "new_line_content": "        video_set_colors(vo_c, \"saturation\", opts->gamma_saturation);",
          "content_same": false
        },
        {
          "line": 1490,
          "old_api": null,
          "new_api": "vo_queue_frame",
          "old_text": null,
          "new_text": "vo_queue_frame(vo, frame)",
          "old_line_content": "",
          "new_line_content": "    vo_queue_frame(vo, frame);",
          "content_same": false
        },
        {
          "line": 981,
          "old_api": null,
          "new_api": "video_set_colors",
          "old_text": null,
          "new_text": "video_set_colors(vo_c, \"output-levels\", opts->video_output_levels)",
          "old_line_content": "",
          "new_line_content": "    video_set_colors(vo_c, \"output-levels\", opts->video_output_levels);",
          "content_same": false
        },
        {
          "line": 1494,
          "old_api": null,
          "new_api": "handle_new_frame",
          "old_text": null,
          "new_text": "handle_new_frame(mpctx)",
          "old_line_content": "",
          "new_line_content": "        handle_new_frame(mpctx);",
          "content_same": false
        },
        {
          "line": 983,
          "old_api": null,
          "new_api": "mp_notify",
          "old_text": null,
          "new_text": "mp_notify(mpctx, MPV_EVENT_VIDEO_RECONFIG, NULL)",
          "old_line_content": "}",
          "new_line_content": "    mp_notify(mpctx, MPV_EVENT_VIDEO_RECONFIG, NULL);",
          "content_same": false
        },
        {
          "line": 1501,
          "old_api": null,
          "new_api": "MP_VERBOSE",
          "old_text": null,
          "new_text": "MP_VERBOSE(mpctx, \"first video frame after restart shown\\n\")",
          "old_line_content": "    }",
          "new_line_content": "        MP_VERBOSE(mpctx, \"first video frame after restart shown\\n\");",
          "content_same": false
        },
        {
          "line": 1503,
          "old_api": null,
          "new_api": "screenshot_flip",
          "old_text": null,
          "new_text": "screenshot_flip(mpctx)",
          "old_line_content": "",
          "new_line_content": "    screenshot_flip(mpctx);",
          "content_same": false
        },
        {
          "line": 1505,
          "old_api": null,
          "new_api": "mp_notify",
          "old_text": null,
          "new_text": "mp_notify(mpctx, MPV_EVENT_TICK, NULL)",
          "old_line_content": "",
          "new_line_content": "    mp_notify(mpctx, MPV_EVENT_TICK, NULL);",
          "content_same": false
        },
        {
          "line": 1514,
          "old_api": null,
          "new_api": "pause_player",
          "old_text": null,
          "new_text": "pause_player(mpctx)",
          "old_line_content": "        }",
          "new_line_content": "                pause_player(mpctx);",
          "content_same": false
        },
        {
          "line": 1522,
          "old_api": null,
          "new_api": "mp_wakeup_core",
          "old_text": null,
          "new_text": "mp_wakeup_core(mpctx)",
          "old_line_content": "    return;",
          "new_line_content": "    mp_wakeup_core(mpctx);",
          "content_same": false
        },
        {
          "line": 1011,
          "old_api": null,
          "new_api": "fabs",
          "old_text": null,
          "new_text": "fabs(scale - 1)",
          "old_line_content": "        if (dev < best_dev) {",
          "new_line_content": "        double dev = fabs(scale - 1);",
          "content_same": false
        },
        {
          "line": 1530,
          "old_api": null,
          "new_api": "mp_wakeup_core",
          "old_text": null,
          "new_text": "mp_wakeup_core(mpctx)",
          "old_line_content": "}",
          "new_line_content": "    mp_wakeup_core(mpctx);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 1027,
          "old_api": "calc_best_speed",
          "new_api": null,
          "old_text": "calc_best_speed(vsync, dur / mpctx->opts->playback_speed)",
          "new_text": null,
          "old_line_content": "        total += calc_best_speed(vsync, dur / mpctx->opts->playback_speed);",
          "new_line_content": "            continue;",
          "content_same": false
        },
        {
          "line": 1037,
          "old_api": "ao_get_format",
          "new_api": null,
          "old_text": "ao_get_format(mpctx->ao_chain->ao, &out_format)",
          "new_text": null,
          "old_line_content": "        ao_get_format(mpctx->ao_chain->ao, &out_format);",
          "new_line_content": "        struct mp_audio out_format = {0};",
          "content_same": false
        },
        {
          "line": 1097,
          "old_api": "fabs",
          "new_api": null,
          "old_text": "fabs(av_diff)",
          "new_text": null,
          "old_line_content": "    if (fabs(av_diff) > max_drift)",
          "new_line_content": "        new = 0;",
          "content_same": false
        },
        {
          "line": 1103,
          "old_api": "MP_VERBOSE",
          "new_api": null,
          "old_text": "MP_VERBOSE(mpctx, \"Change display sync audio drift: %d\\n\", new)",
          "new_text": null,
          "old_line_content": "            MP_VERBOSE(mpctx, \"Change display sync audio drift: %d\\n\", new);",
          "new_line_content": "        if (change)",
          "content_same": false
        },
        {
          "line": 1112,
          "old_api": "compute_audio_drift",
          "new_api": null,
          "old_text": "compute_audio_drift(mpctx, vsync)",
          "new_text": null,
          "old_line_content": "            double drift = compute_audio_drift(mpctx, vsync);",
          "new_line_content": "            // which compensates the general drift we're getting.",
          "content_same": false
        },
        {
          "line": 1117,
          "old_api": "MP_VERBOSE",
          "new_api": null,
          "old_text": "MP_VERBOSE(mpctx, \"Compensation factor: %f\\n\", audio_factor)",
          "new_text": null,
          "old_line_content": "                MP_VERBOSE(mpctx, \"Compensation factor: %f\\n\", audio_factor);",
          "new_line_content": "                audio_factor = (mpctx->audio_speed - drift) / other;",
          "content_same": false
        },
        {
          "line": 1121,
          "old_api": "MPCLAMP",
          "new_api": null,
          "old_text": "MPCLAMP(audio_factor, 1 - max_correct, 1 + max_correct)",
          "new_text": null,
          "old_line_content": "        audio_factor = MPCLAMP(audio_factor, 1 - max_correct, 1 + max_correct);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1141,
          "old_api": "VS_IS_DISP",
          "new_api": null,
          "old_text": "VS_IS_DISP(mode)",
          "new_text": null,
          "old_line_content": "    if (!VS_IS_DISP(mode) || mpctx->display_sync_broken)",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1149,
          "old_api": "using_spdif_passthrough",
          "new_api": null,
          "old_text": "using_spdif_passthrough(mpctx)",
          "new_text": null,
          "old_line_content": "    if (resample && using_spdif_passthrough(mpctx))",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1152,
          "old_api": "vo_get_vsync_interval",
          "new_api": null,
          "old_text": "vo_get_vsync_interval(vo)",
          "new_text": null,
          "old_line_content": "    double vsync = vo_get_vsync_interval(vo) / 1e6;",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1156,
          "old_api": "MPMAX",
          "new_api": null,
          "old_text": "MPMAX(0, mpctx->past_frames[0].approx_duration)",
          "new_text": null,
          "old_line_content": "    double adjusted_duration = MPMAX(0, mpctx->past_frames[0].approx_duration);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1163,
          "old_api": "find_best_speed",
          "new_api": null,
          "old_text": "find_best_speed(mpctx, vsync)",
          "new_text": null,
          "old_line_content": "        double best = find_best_speed(mpctx, vsync);",
          "new_line_content": "    if (mode != VS_DISP_VDROP) {",
          "content_same": false
        },
        {
          "line": 1165,
          "old_api": "fabs",
          "new_api": null,
          "old_text": "fabs(best - 1.0)",
          "new_text": null,
          "old_line_content": "        if (fabs(best - 1.0) <= opts->sync_max_video_change / 100)",
          "new_line_content": "        // If it doesn't work, play at normal speed.",
          "content_same": false
        },
        {
          "line": 1170,
          "old_api": "fabs",
          "new_api": null,
          "old_text": "fabs(av_diff)",
          "new_text": null,
          "old_line_content": "    if (fabs(av_diff) > 0.5) {",
          "new_line_content": "    double av_diff = mpctx->last_av_difference;",
          "content_same": false
        },
        {
          "line": 1181,
          "old_api": "lrint",
          "new_api": null,
          "old_text": "lrint(ratio)",
          "new_text": null,
          "old_line_content": "    int num_vsyncs = MPMAX(lrint(ratio), 0);",
          "new_line_content": "    double ratio = (frame_duration + mpctx->display_sync_error) / vsync;",
          "content_same": false
        },
        {
          "line": 1185,
          "old_api": "MP_DBG",
          "new_api": null,
          "old_text": "MP_DBG(mpctx, \"s=%f vsyncs=%d dur=%f ratio=%f err=%.20f (%f/%f)\\n\",\n           mpctx->speed_factor_v, num_vsyncs, adjusted_duration, ratio,\n           mpctx->display_sync_error, mpctx->display_sync_error / vsync,\n           mpctx->display_sync_error / frame_duration)",
          "new_text": null,
          "old_line_content": "    MP_DBG(mpctx, \"s=%f vsyncs=%d dur=%f ratio=%f err=%.20f (%f/%f)\\n\",",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1190,
          "old_api": "MP_STATS",
          "new_api": null,
          "old_text": "MP_STATS(mpctx, \"value %f avdiff\", av_diff)",
          "new_text": null,
          "old_line_content": "    MP_STATS(mpctx, \"value %f avdiff\", av_diff);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1197,
          "old_api": "fabs",
          "new_api": null,
          "old_text": "fabs(av_diff)",
          "new_text": null,
          "old_line_content": "    if (drop && fabs(av_diff) >= 0.020 && fabs(av_diff) / vsync >= 1)",
          "new_line_content": "    // Tolerate some desync to avoid frame dropping due to jitter.",
          "content_same": false
        },
        {
          "line": 1203,
          "old_api": "MPCLAMP",
          "new_api": null,
          "old_text": "MPCLAMP(drop_repeat, -num_vsyncs, num_vsyncs * 10)",
          "new_text": null,
          "old_line_content": "    drop_repeat = MPCLAMP(drop_repeat, -num_vsyncs, num_vsyncs * 10);",
          "new_line_content": "    // corner cases or exceptional situations cause too much havoc.",
          "content_same": false
        },
        {
          "line": 1212,
          "old_api": "vo_get_delay",
          "new_api": null,
          "old_text": "vo_get_delay(vo)",
          "new_text": null,
          "old_line_content": "    double time_left = vo_get_delay(vo);",
          "new_line_content": "    // value below. This is used to estimate A/V drift.",
          "content_same": false
        },
        {
          "line": 1223,
          "old_api": "vo_discard_timing_info",
          "new_api": null,
          "old_text": "vo_discard_timing_info(vo)",
          "new_text": null,
          "old_line_content": "        vo_discard_timing_info(vo);",
          "new_line_content": "    if (mpctx->num_past_frames == 2 && time_left < 0) {",
          "content_same": false
        },
        {
          "line": 1229,
          "old_api": "MP_STATS",
          "new_api": null,
          "old_text": "MP_STATS(mpctx, \"mistimed\")",
          "new_text": null,
          "old_line_content": "        MP_STATS(mpctx, \"mistimed\");",
          "new_line_content": "        mpctx->mistimed_frames_total += 1;",
          "content_same": false
        },
        {
          "line": 1233,
          "old_api": "update_av_diff",
          "new_api": null,
          "old_text": "update_av_diff(mpctx, time_left * opts->playback_speed)",
          "new_text": null,
          "old_line_content": "    update_av_diff(mpctx, time_left * opts->playback_speed);",
          "new_line_content": "    mpctx->total_avsync_change = 0;",
          "content_same": false
        },
        {
          "line": 1239,
          "old_api": "adjust_audio_resample_speed",
          "new_api": null,
          "old_text": "adjust_audio_resample_speed(mpctx, vsync)",
          "new_text": null,
          "old_line_content": "        adjust_audio_resample_speed(mpctx, vsync);",
          "new_line_content": "    if (resample) {",
          "content_same": false
        },
        {
          "line": 1254,
          "old_api": "update_playback_speed",
          "new_api": null,
          "old_text": "update_playback_speed(mpctx)",
          "new_text": null,
          "old_line_content": "    update_playback_speed(mpctx);",
          "new_line_content": "    mpctx->display_sync_active = true;",
          "content_same": false
        },
        {
          "line": 1256,
          "old_api": "MP_STATS",
          "new_api": null,
          "old_text": "MP_STATS(mpctx, \"value %f aspeed\", mpctx->speed_factor_a - 1)",
          "new_text": null,
          "old_line_content": "    MP_STATS(mpctx, \"value %f aspeed\", mpctx->speed_factor_a - 1);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 750,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(mpctx->num_next_frames >= 1)",
          "new_text": null,
          "old_line_content": "    assert(mpctx->num_next_frames >= 1);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 1262,
          "old_api": "handle_display_sync_frame",
          "new_api": null,
          "old_text": "handle_display_sync_frame(mpctx, frame)",
          "new_text": null,
          "old_line_content": "    handle_display_sync_frame(mpctx, frame);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 1267,
          "old_api": "MP_VERBOSE",
          "new_api": null,
          "old_text": "MP_VERBOSE(mpctx, \"Video sync mode %s.\\n\",\n                   mpctx->display_sync_active ? \"enabled\" : \"disabled\")",
          "new_text": null,
          "old_line_content": "        MP_VERBOSE(mpctx, \"Video sync mode %s.\\n\",",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 759,
          "old_api": "MP_WARN",
          "new_api": null,
          "old_text": "MP_WARN(mpctx, \"Invalid video timestamp: %f -> %f\\n\",\n                    mpctx->video_pts, pts)",
          "new_text": null,
          "old_line_content": "            MP_WARN(mpctx, \"Invalid video timestamp: %f -> %f\\n\",",
          "new_line_content": "            // Assume a discontinuity.",
          "content_same": false
        },
        {
          "line": 1274,
          "old_api": "update_playback_speed",
          "new_api": null,
          "old_text": "update_playback_speed(mpctx)",
          "new_text": null,
          "old_line_content": "        update_playback_speed(mpctx);",
          "new_line_content": "        mpctx->speed_factor_v = 1.0;",
          "content_same": false
        },
        {
          "line": 1276,
          "old_api": "update_av_diff",
          "new_api": null,
          "old_text": "update_av_diff(mpctx, mpctx->time_frame > 0 ?\n            mpctx->time_frame * mpctx->video_speed : 0)",
          "new_text": null,
          "old_line_content": "        update_av_diff(mpctx, mpctx->time_frame > 0 ?",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 767,
          "old_api": "adjust_sync",
          "new_api": null,
          "old_text": "adjust_sync(mpctx, pts, frame_time)",
          "new_text": null,
          "old_line_content": "        adjust_sync(mpctx, pts, frame_time);",
          "new_line_content": "        mpctx->time_frame += frame_time / mpctx->video_speed;",
          "content_same": false
        },
        {
          "line": 772,
          "old_api": "MP_TRACE",
          "new_api": null,
          "old_text": "MP_TRACE(mpctx, \"frametime=%5.3f\\n\", frame_time)",
          "new_text": null,
          "old_line_content": "    MP_TRACE(mpctx, \"frametime=%5.3f\\n\", frame_time);",
          "new_line_content": "        mpctx->dropped_frames_start = d_video->dropped_frames;",
          "content_same": false
        },
        {
          "line": 1284,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(mpctx->num_past_frames >= 1 && mpctx->num_next_frames >= 1)",
          "new_text": null,
          "old_line_content": "    assert(mpctx->num_past_frames >= 1 && mpctx->num_next_frames >= 1);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 780,
          "old_api": "talloc_free",
          "new_api": null,
          "old_text": "talloc_free(mpctx->next_frames[0])",
          "new_text": null,
          "old_line_content": "    talloc_free(mpctx->next_frames[0]);",
          "new_line_content": "        return;",
          "content_same": false
        },
        {
          "line": 797,
          "old_api": "vo_get_num_req_frames",
          "new_api": null,
          "old_text": "vo_get_num_req_frames(mpctx->video_out)",
          "new_text": null,
          "old_line_content": "    int req = vo_get_num_req_frames(mpctx->video_out);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1309,
          "old_api": "fabs",
          "new_api": null,
          "old_text": "fabs(dur - duration)",
          "new_text": null,
          "old_line_content": "        if (dur <= 0 || fabs(dur - duration) >= tolerance)",
          "new_line_content": "        double dur = mpctx->past_frames[n].duration;",
          "content_same": false
        },
        {
          "line": 804,
          "old_api": "get_req_frames",
          "new_api": null,
          "old_text": "get_req_frames(mpctx, false)",
          "new_text": null,
          "old_line_content": "    return mpctx->num_next_frames < get_req_frames(mpctx, false);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 1320,
          "old_api": "fabs",
          "new_api": null,
          "old_text": "fabs(duration - demux_duration)",
          "new_text": null,
          "old_line_content": "        if (fabs(duration - demux_duration) < tolerance &&",
          "new_line_content": "        // could literally not add up (e.g. if demuxer FPS is rounded itself).",
          "content_same": false
        },
        {
          "line": 810,
          "old_api": "MP_ARRAY_SIZE",
          "new_api": null,
          "old_text": "MP_ARRAY_SIZE(mpctx->next_frames)",
          "new_text": null,
          "old_line_content": "    assert(mpctx->num_next_frames < MP_ARRAY_SIZE(mpctx->next_frames));",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 814,
          "old_api": "handle_new_frame",
          "new_api": null,
          "old_text": "handle_new_frame(mpctx)",
          "new_text": null,
          "old_line_content": "        handle_new_frame(mpctx);",
          "new_line_content": "    if (mpctx->num_next_frames == 1)",
          "content_same": false
        },
        {
          "line": 1330,
          "old_api": "MPMAX",
          "new_api": null,
          "old_text": "MPMAX(0, duration)",
          "new_text": null,
          "old_line_content": "    MP_STATS(mpctx, \"value %f frame-duration\", MPMAX(0, duration));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 821,
          "old_api": "get_req_frames",
          "new_api": null,
          "old_text": "get_req_frames(mpctx, eof)",
          "new_text": null,
          "old_line_content": "    return mpctx->num_next_frames >= get_req_frames(mpctx, eof);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 832,
          "old_api": "vo_has_frame",
          "new_api": null,
          "old_text": "vo_has_frame(mpctx->video_out)",
          "new_text": null,
          "old_line_content": "        if (vo_has_frame(mpctx->video_out))",
          "new_line_content": "    if (vo_c->is_coverart) {",
          "content_same": false
        },
        {
          "line": 837,
          "old_api": "have_new_frame",
          "new_api": null,
          "old_text": "have_new_frame(mpctx, false)",
          "new_text": null,
          "old_line_content": "    if (have_new_frame(mpctx, false))",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1350,
          "old_api": "video_output_image",
          "new_api": null,
          "old_text": "video_output_image(mpctx)",
          "new_text": null,
          "old_line_content": "    int r = video_output_image(mpctx);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 842,
          "old_api": "needs_new_frame",
          "new_api": null,
          "old_text": "needs_new_frame(mpctx)",
          "new_text": null,
          "old_line_content": "    if (needs_new_frame(mpctx)) {",
          "new_line_content": "    int r = VD_PROGRESS;",
          "content_same": false
        },
        {
          "line": 844,
          "old_api": "video_decode_and_filter",
          "new_api": null,
          "old_text": "video_decode_and_filter(mpctx)",
          "new_text": null,
          "old_line_content": "        r = video_decode_and_filter(mpctx);",
          "new_line_content": "        // Filter a new frame.",
          "content_same": false
        },
        {
          "line": 847,
          "old_api": "vf_read_output_frame",
          "new_api": null,
          "old_text": "vf_read_output_frame(vo_c->vf)",
          "new_text": null,
          "old_line_content": "        struct mp_image *img = vf_read_output_frame(vo_c->vf);",
          "new_line_content": "            return r; // error",
          "content_same": false
        },
        {
          "line": 849,
          "old_api": "get_play_end_pts",
          "new_api": null,
          "old_text": "get_play_end_pts(mpctx)",
          "new_text": null,
          "old_line_content": "            double endpts = get_play_end_pts(mpctx);",
          "new_line_content": "        if (img) {",
          "content_same": false
        },
        {
          "line": 853,
          "old_api": "vf_unread_output_frame",
          "new_api": null,
          "old_text": "vf_unread_output_frame(vo_c->vf, img)",
          "new_text": null,
          "old_line_content": "                vf_unread_output_frame(vo_c->vf, img);",
          "new_line_content": "            {",
          "content_same": false
        },
        {
          "line": 1365,
          "old_api": "get_relative_time",
          "new_api": null,
          "old_text": "get_relative_time(mpctx)",
          "new_text": null,
          "old_line_content": "            get_relative_time(mpctx);",
          "new_line_content": "            mpctx->video_status = STATUS_DRAINING;",
          "content_same": false
        },
        {
          "line": 857,
          "old_api": "mp_image_setrefp",
          "new_api": null,
          "old_text": "mp_image_setrefp(&mpctx->saved_frame, img)",
          "new_text": null,
          "old_line_content": "                mp_image_setrefp(&mpctx->saved_frame, img);",
          "new_line_content": "            } else if (hrseek && mpctx->hrseek_lastframe) {",
          "content_same": false
        },
        {
          "line": 1369,
          "old_api": "MP_VERBOSE",
          "new_api": null,
          "old_text": "MP_VERBOSE(mpctx, \"assuming this is an image\\n\")",
          "new_text": null,
          "old_line_content": "                MP_VERBOSE(mpctx, \"assuming this is an image\\n\");",
          "new_line_content": "            {",
          "content_same": false
        },
        {
          "line": 861,
          "old_api": "mp_image_setrefp",
          "new_api": null,
          "old_text": "mp_image_setrefp(&mpctx->saved_frame, img)",
          "new_text": null,
          "old_line_content": "                    mp_image_setrefp(&mpctx->saved_frame, img);",
          "new_line_content": "                if (mpctx->hrseek_backstep)",
          "content_same": false
        },
        {
          "line": 1377,
          "old_api": "get_relative_time",
          "new_api": null,
          "old_text": "get_relative_time(mpctx)",
          "new_text": null,
          "old_line_content": "            mpctx->time_frame -= get_relative_time(mpctx);",
          "new_line_content": "        if (mpctx->video_status == STATUS_DRAINING) {",
          "content_same": false
        },
        {
          "line": 1380,
          "old_api": "MP_VERBOSE",
          "new_api": null,
          "old_text": "MP_VERBOSE(mpctx, \"video EOF reached\\n\")",
          "new_text": null,
          "old_line_content": "                MP_VERBOSE(mpctx, \"video EOF reached\\n\");",
          "new_line_content": "            if (mpctx->time_frame <= 0) {",
          "content_same": false
        },
        {
          "line": 870,
          "old_api": "add_new_frame",
          "new_api": null,
          "old_text": "add_new_frame(mpctx, mpctx->saved_frame)",
          "new_text": null,
          "old_line_content": "                        add_new_frame(mpctx, mpctx->saved_frame);",
          "new_line_content": "                    if (mpctx->saved_frame) {",
          "content_same": false
        },
        {
          "line": 873,
          "old_api": "MP_WARN",
          "new_api": null,
          "old_text": "MP_WARN(mpctx, \"Backstep failed.\\n\")",
          "new_text": null,
          "old_line_content": "                        MP_WARN(mpctx, \"Backstep failed.\\n\");",
          "new_line_content": "                    } else {",
          "content_same": false
        },
        {
          "line": 1385,
          "old_api": "MP_DBG",
          "new_api": null,
          "old_text": "MP_DBG(mpctx, \"video EOF (status=%d)\\n\", mpctx->video_status)",
          "new_text": null,
          "old_line_content": "        MP_DBG(mpctx, \"video EOF (status=%d)\\n\", mpctx->video_status);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 877,
          "old_api": "add_new_frame",
          "new_api": null,
          "old_text": "add_new_frame(mpctx, img)",
          "new_text": null,
          "old_line_content": "                add_new_frame(mpctx, img);",
          "new_line_content": "                }",
          "content_same": false
        },
        {
          "line": 880,
          "old_api": "talloc_free",
          "new_api": null,
          "old_text": "talloc_free(img)",
          "new_text": null,
          "old_line_content": "            talloc_free(img);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 1393,
          "old_api": "mp_wakeup_core",
          "new_api": null,
          "old_text": "mp_wakeup_core(mpctx)",
          "new_text": null,
          "old_line_content": "        mp_wakeup_core(mpctx); // Decode more in next iteration.",
          "new_line_content": "    if (r != VD_NEW_FRAME) {",
          "content_same": false
        },
        {
          "line": 886,
          "old_api": "add_new_frame",
          "new_api": null,
          "old_text": "add_new_frame(mpctx, mpctx->saved_frame)",
          "new_text": null,
          "old_line_content": "        add_new_frame(mpctx, mpctx->saved_frame);",
          "new_line_content": "    if (r <= 0 && hrseek && mpctx->hrseek_lastframe && mpctx->saved_frame) {",
          "content_same": false
        },
        {
          "line": 1399,
          "old_api": "mp_image_params_equal",
          "new_api": null,
          "old_text": "mp_image_params_equal(&p, vo->params)",
          "new_text": null,
          "old_line_content": "    if (!vo->params || !mp_image_params_equal(&p, vo->params)) {",
          "new_line_content": "    struct mp_image_params p = mpctx->next_frames[0]->params;",
          "content_same": false
        },
        {
          "line": 1401,
          "old_api": "vo_still_displaying",
          "new_api": null,
          "old_text": "vo_still_displaying(vo)",
          "new_text": null,
          "old_line_content": "        if (vo_still_displaying(vo))",
          "new_line_content": "        // Changing config deletes the current frame; wait until it's finished.",
          "content_same": false
        },
        {
          "line": 891,
          "old_api": "have_new_frame",
          "new_api": null,
          "old_text": "have_new_frame(mpctx, r <= 0)",
          "new_text": null,
          "old_line_content": "    return have_new_frame(mpctx, r <= 0) ? VD_NEW_FRAME : r;",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1408,
          "old_api": "mp_image_params_get_dsize",
          "new_api": null,
          "old_text": "mp_image_params_get_dsize(&p, &d_w, &d_h)",
          "new_text": null,
          "old_line_content": "            mp_image_params_get_dsize(&p, &d_w, &d_h);",
          "new_line_content": "            int d_w, d_h;",
          "content_same": false
        },
        {
          "line": 1411,
          "old_api": "MP_INFO",
          "new_api": null,
          "old_text": "MP_INFO(mpctx, \"VO: [%s] %dx%d%s %s\\n\",\n                info->name, p.w, p.h, extra, vo_format_name(p.imgfmt))",
          "new_text": null,
          "old_line_content": "        MP_INFO(mpctx, \"VO: [%s] %dx%d%s %s\\n\",",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 1415,
          "old_api": "vo_reconfig",
          "new_api": null,
          "old_text": "vo_reconfig(vo, &p)",
          "new_text": null,
          "old_line_content": "        int vo_r = vo_reconfig(vo, &p);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 908,
          "old_api": "ao_untimed",
          "new_api": null,
          "old_text": "ao_untimed(mpctx->ao)",
          "new_text": null,
          "old_line_content": "               !ao_untimed(mpctx->ao))",
          "new_line_content": "               mpctx->video_status == STATUS_PLAYING &&",
          "content_same": false
        },
        {
          "line": 1420,
          "old_api": "init_vo",
          "new_api": null,
          "old_text": "init_vo(mpctx)",
          "new_text": null,
          "old_line_content": "        init_vo(mpctx);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 910,
          "old_api": "ao_get_delay",
          "new_api": null,
          "old_text": "ao_get_delay(mpctx->ao)",
          "new_text": null,
          "old_line_content": "        double buffered_audio = ao_get_delay(mpctx->ao);",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 1423,
          "old_api": "get_relative_time",
          "new_api": null,
          "old_text": "get_relative_time(mpctx)",
          "new_text": null,
          "old_line_content": "    mpctx->time_frame -= get_relative_time(mpctx);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1426,
          "old_api": "update_subtitles",
          "new_api": null,
          "old_text": "update_subtitles(mpctx, mpctx->next_frames[0]->pts)",
          "new_text": null,
          "old_line_content": "    if (!update_subtitles(mpctx, mpctx->next_frames[0]->pts)) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 915,
          "old_api": "MP_STATS",
          "new_api": null,
          "old_text": "MP_STATS(mpctx, \"value %f audio-diff\", difference)",
          "new_text": null,
          "old_line_content": "        MP_STATS(mpctx, \"value %f audio-diff\", difference);",
          "new_line_content": "        double difference = buffered_audio - predicted;",
          "content_same": false
        },
        {
          "line": 1431,
          "old_api": "MPMAX",
          "new_api": null,
          "old_text": "MPMAX(mpctx->time_frame, -1)",
          "new_text": null,
          "old_line_content": "    double time_frame = MPMAX(mpctx->time_frame, -1);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1437,
          "old_api": "vo_is_ready_for_frame",
          "new_api": null,
          "old_text": "vo_is_ready_for_frame(vo, mpctx->display_sync_active ? -1 : pts)",
          "new_text": null,
          "old_line_content": "    if (!vo_is_ready_for_frame(vo, mpctx->display_sync_active ? -1 : pts)) {",
          "new_line_content": "    //      wrong waiting mode)",
          "content_same": false
        },
        {
          "line": 1443,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(mpctx->num_next_frames >= 1)",
          "new_text": null,
          "old_line_content": "    assert(mpctx->num_next_frames >= 1);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1447,
          "old_api": "MP_TARRAY_INSERT_AT",
          "new_api": null,
          "old_text": "MP_TARRAY_INSERT_AT(mpctx, mpctx->past_frames, mpctx->num_past_frames, 0,\n                        (struct frame_info){0})",
          "new_text": null,
          "old_line_content": "    MP_TARRAY_INSERT_AT(mpctx, mpctx->past_frames, mpctx->num_past_frames, 0,",
          "new_line_content": "        mpctx->num_past_frames--;",
          "content_same": false
        },
        {
          "line": 1453,
          "old_api": "calculate_frame_duration",
          "new_api": null,
          "old_text": "calculate_frame_duration(mpctx)",
          "new_text": null,
          "old_line_content": "    calculate_frame_duration(mpctx);",
          "new_line_content": "    };",
          "content_same": false
        },
        {
          "line": 1455,
          "old_api": "vo_get_num_req_frames",
          "new_api": null,
          "old_text": "vo_get_num_req_frames(mpctx->video_out)",
          "new_text": null,
          "old_line_content": "    int req = vo_get_num_req_frames(mpctx->video_out);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1461,
          "old_api": "MPMIN",
          "new_api": null,
          "old_text": "MPMIN(mpctx->num_next_frames, req)",
          "new_text": null,
          "old_line_content": "        .num_frames = MPMIN(mpctx->num_next_frames, req),",
          "new_line_content": "        .still = mpctx->step_frames > 0,",
          "content_same": false
        },
        {
          "line": 953,
          "old_api": "playing_audio_pts",
          "new_api": null,
          "old_text": "playing_audio_pts(mpctx)",
          "new_text": null,
          "old_line_content": "    double a_pos = playing_audio_pts(mpctx);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1466,
          "old_api": "vo_frame_ref",
          "new_api": null,
          "old_text": "vo_frame_ref(&dummy)",
          "new_text": null,
          "old_line_content": "    struct vo_frame *frame = vo_frame_ref(&dummy);",
          "new_line_content": "        dummy.frames[n] = mpctx->next_frames[n];",
          "content_same": false
        },
        {
          "line": 959,
          "old_api": "fabs",
          "new_api": null,
          "old_text": "fabs(mpctx->last_av_difference)",
          "new_text": null,
          "old_line_content": "    if (fabs(mpctx->last_av_difference) > 0.5 && !mpctx->drop_message_shown) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1476,
          "old_api": "MPCLAMP",
          "new_api": null,
          "old_text": "MPCLAMP(diff, 0, 10)",
          "new_text": null,
          "old_line_content": "        frame->duration = MPCLAMP(diff, 0, 10) * 1e6;",
          "new_line_content": "            diff += mpctx->time_frame;",
          "content_same": false
        },
        {
          "line": 1482,
          "old_api": "shift_frames",
          "new_api": null,
          "old_text": "shift_frames(mpctx)",
          "new_text": null,
          "old_line_content": "    shift_frames(mpctx);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 971,
          "old_api": "video_set_colors",
          "new_api": null,
          "old_text": "video_set_colors(vo_c, \"gamma\", opts->gamma_gamma)",
          "new_text": null,
          "old_line_content": "        video_set_colors(vo_c, \"gamma\", opts->gamma_gamma);",
          "new_line_content": "    if (opts->gamma_gamma != 0)",
          "content_same": false
        },
        {
          "line": 1484,
          "old_api": "schedule_frame",
          "new_api": null,
          "old_text": "schedule_frame(mpctx, frame)",
          "new_text": null,
          "old_line_content": "    schedule_frame(mpctx, frame);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 973,
          "old_api": "video_set_colors",
          "new_api": null,
          "old_text": "video_set_colors(vo_c, \"brightness\", opts->gamma_brightness)",
          "new_text": null,
          "old_line_content": "        video_set_colors(vo_c, \"brightness\", opts->gamma_brightness);",
          "new_line_content": "    if (opts->gamma_brightness != 0)",
          "content_same": false
        },
        {
          "line": 975,
          "old_api": "video_set_colors",
          "new_api": null,
          "old_text": "video_set_colors(vo_c, \"contrast\", opts->gamma_contrast)",
          "new_text": null,
          "old_line_content": "        video_set_colors(vo_c, \"contrast\", opts->gamma_contrast);",
          "new_line_content": "    if (opts->gamma_contrast != 0)",
          "content_same": false
        },
        {
          "line": 1487,
          "old_api": "update_osd_msg",
          "new_api": null,
          "old_text": "update_osd_msg(mpctx)",
          "new_text": null,
          "old_line_content": "    update_osd_msg(mpctx);",
          "new_line_content": "    mpctx->osd_force_update = true;",
          "content_same": false
        },
        {
          "line": 977,
          "old_api": "video_set_colors",
          "new_api": null,
          "old_text": "video_set_colors(vo_c, \"saturation\", opts->gamma_saturation)",
          "new_text": null,
          "old_line_content": "        video_set_colors(vo_c, \"saturation\", opts->gamma_saturation);",
          "new_line_content": "    if (opts->gamma_saturation != 0)",
          "content_same": false
        },
        {
          "line": 1489,
          "old_api": "vo_queue_frame",
          "new_api": null,
          "old_text": "vo_queue_frame(vo, frame)",
          "new_text": null,
          "old_line_content": "    vo_queue_frame(vo, frame);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 979,
          "old_api": "video_set_colors",
          "new_api": null,
          "old_text": "video_set_colors(vo_c, \"hue\", opts->gamma_hue)",
          "new_text": null,
          "old_line_content": "        video_set_colors(vo_c, \"hue\", opts->gamma_hue);",
          "new_line_content": "    if (opts->gamma_hue != 0)",
          "content_same": false
        },
        {
          "line": 1493,
          "old_api": "handle_new_frame",
          "new_api": null,
          "old_text": "handle_new_frame(mpctx)",
          "new_text": null,
          "old_line_content": "        handle_new_frame(mpctx);",
          "new_line_content": "    if (mpctx->num_next_frames >= 1)",
          "content_same": false
        },
        {
          "line": 982,
          "old_api": "mp_notify",
          "new_api": null,
          "old_text": "mp_notify(mpctx, MPV_EVENT_VIDEO_RECONFIG, NULL)",
          "new_text": null,
          "old_line_content": "    mp_notify(mpctx, MPV_EVENT_VIDEO_RECONFIG, NULL);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1499,
          "old_api": "vo_wait_frame",
          "new_api": null,
          "old_text": "vo_wait_frame(vo)",
          "new_text": null,
          "old_line_content": "        vo_wait_frame(vo);",
          "new_line_content": "        // After a seek, make sure to wait until the first frame is visible.",
          "content_same": false
        },
        {
          "line": 1502,
          "old_api": "screenshot_flip",
          "new_api": null,
          "old_text": "screenshot_flip(mpctx)",
          "new_text": null,
          "old_line_content": "    screenshot_flip(mpctx);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1504,
          "old_api": "mp_notify",
          "new_api": null,
          "old_text": "mp_notify(mpctx, MPV_EVENT_TICK, NULL)",
          "new_text": null,
          "old_line_content": "    mp_notify(mpctx, MPV_EVENT_TICK, NULL);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1513,
          "old_api": "pause_player",
          "new_api": null,
          "old_text": "pause_player(mpctx)",
          "new_text": null,
          "old_line_content": "                pause_player(mpctx);",
          "new_line_content": "            if (!mpctx->step_frames && !opts->pause)",
          "content_same": false
        },
        {
          "line": 1009,
          "old_api": "rint",
          "new_api": null,
          "old_text": "rint(ratio * factor)",
          "new_text": null,
          "old_line_content": "        double scale = ratio * factor / rint(ratio * factor);",
          "new_line_content": "    for (int factor = 1; factor <= 5; factor++) {",
          "content_same": false
        },
        {
          "line": 1521,
          "old_api": "mp_wakeup_core",
          "new_api": null,
          "old_text": "mp_wakeup_core(mpctx)",
          "new_text": null,
          "old_line_content": "    mp_wakeup_core(mpctx);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1525,
          "old_api": "MP_FATAL",
          "new_api": null,
          "old_text": "MP_FATAL(mpctx, \"Could not initialize video chain.\\n\")",
          "new_text": null,
          "old_line_content": "    MP_FATAL(mpctx, \"Could not initialize video chain.\\n\");",
          "new_line_content": "error:",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 21,
      "total_additions": 107,
      "total_deletions": 106,
      "total_api_changes": 234
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 3,
        "api_related_lines": 234,
        "non_api_lines": 2,
        "non_api_line_numbers": [
          733,
          734
        ]
      }
    },
    "api_calls_before": 269,
    "api_calls_after": 270,
    "diff_info": {
      "added_lines": 2,
      "removed_lines": 1,
      "total_diff_lines": 16
    }
  }
}