{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/1a54339705f71a67faa900a125d467ba121e3ae6",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/1a54339705f71a67faa900a125d467ba121e3ae6/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/1a54339705f71a67faa900a125d467ba121e3ae6/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/1a54339705f71a67faa900a125d467ba121e3ae6/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 4035,
          "old_api": "stream_get_size",
          "new_api": "pthread_mutex_unlock",
          "old_text": "stream_get_size(stream)",
          "new_text": "pthread_mutex_unlock(&in->lock)",
          "old_line_content": "        stream_size = stream_get_size(stream);",
          "new_line_content": "    pthread_mutex_unlock(&in->lock);",
          "content_same": false
        },
        {
          "line": 4041,
          "old_api": "pthread_mutex_lock",
          "new_api": "stream_control",
          "old_text": "pthread_mutex_lock(&in->lock)",
          "new_text": "stream_control(stream, STREAM_CTRL_GET_METADATA, &stream_metadata)",
          "old_line_content": "    pthread_mutex_lock(&in->lock);",
          "new_line_content": "        stream_control(stream, STREAM_CTRL_GET_METADATA, &stream_metadata);",
          "content_same": false
        },
        {
          "line": 4046,
          "old_api": "talloc_free",
          "new_api": "pthread_mutex_lock",
          "old_text": "talloc_free(stream_metadata)",
          "new_text": "pthread_mutex_lock(&in->lock)",
          "old_line_content": "        talloc_free(stream_metadata);",
          "new_line_content": "    pthread_mutex_lock(&in->lock);",
          "content_same": false
        },
        {
          "line": 4051,
          "old_api": "mp_time_us",
          "new_api": "add_timed_metadata",
          "old_text": "mp_time_us()",
          "new_text": "add_timed_metadata(in, stream_metadata, NULL, MP_NOPTS_VALUE)",
          "old_line_content": "    int64_t now = mp_time_us();",
          "new_line_content": "        add_timed_metadata(in, stream_metadata, NULL, MP_NOPTS_VALUE);",
          "content_same": false
        },
        {
          "line": 4109,
          "old_api": "adjust_cache_seek_target",
          "new_api": "mp_recorder_mark_discontinuity",
          "old_text": "adjust_cache_seek_target(in, r, &pts, &flags)",
          "new_text": "mp_recorder_mark_discontinuity(in->dumper)",
          "old_line_content": "        adjust_cache_seek_target(in, r, &pts, &flags);",
          "new_line_content": "        mp_recorder_mark_discontinuity(in->dumper);",
          "content_same": false
        },
        {
          "line": 4204,
          "old_api": "pthread_mutex_lock",
          "new_api": "assert",
          "old_text": "pthread_mutex_lock(&in->lock)",
          "new_text": "assert(demuxer == in->d_user)",
          "old_line_content": "    pthread_mutex_lock(&in->lock);",
          "new_line_content": "    assert(demuxer == in->d_user);",
          "content_same": false
        },
        {
          "line": 4280,
          "old_api": "MP_PTS_OR_DEF",
          "new_api": "find_seek_target",
          "old_text": "MP_PTS_OR_DEF(dp->dts, dp->pts)",
          "new_text": "find_seek_target(q, pts, flags)",
          "old_line_content": "                        double pdts = MP_PTS_OR_DEF(dp->dts, dp->pts);",
          "new_line_content": "            struct demux_packet *dp = find_seek_target(q, pts, flags);",
          "content_same": false
        },
        {
          "line": 4392,
          "old_api": "get_foward_buffered_bytes",
          "new_api": "MP_PTS_MAX",
          "old_text": "get_foward_buffered_bytes(ds)",
          "new_text": "MP_PTS_MAX(r->ts_reader, ds->base_ts)",
          "old_line_content": "        r->fw_bytes += get_foward_buffered_bytes(ds);",
          "new_line_content": "            r->ts_reader = MP_PTS_MAX(r->ts_reader, ds->base_ts);",
          "content_same": false
        },
        {
          "line": 4396,
          "old_api": "MP_ADD_PTS",
          "new_api": "get_foward_buffered_bytes",
          "old_text": "MP_ADD_PTS(r->ts_reader, in->ts_offset)",
          "new_text": "get_foward_buffered_bytes(ds)",
          "old_line_content": "    r->ts_reader = MP_ADD_PTS(r->ts_reader, in->ts_offset);",
          "new_line_content": "        r->fw_bytes += get_foward_buffered_bytes(ds);",
          "content_same": false
        },
        {
          "line": 4496,
          "old_api": "visit_meta",
          "new_api": "mp_charset_is_utf8",
          "old_text": "visit_meta(demuxer, &data, visit_detect)",
          "new_text": "mp_charset_is_utf8(cp)",
          "old_line_content": "    visit_meta(demuxer, &data, visit_detect);",
          "new_line_content": "    if (!cp || mp_charset_is_utf8(cp))",
          "content_same": false
        },
        {
          "line": 4499,
          "old_api": "mp_charset_is_utf8",
          "new_api": "talloc_strdup",
          "old_text": "mp_charset_is_utf8(in->meta_charset)",
          "new_text": "talloc_strdup(NULL, \"\")",
          "old_line_content": "    if (in->meta_charset && !mp_charset_is_utf8(in->meta_charset)) {",
          "new_line_content": "    char *data = talloc_strdup(NULL, \"\");",
          "content_same": false
        },
        {
          "line": 4500,
          "old_api": "MP_INFO",
          "new_api": "visit_meta",
          "old_text": "MP_INFO(demuxer, \"Using tag charset: %s\\n\", in->meta_charset)",
          "new_text": "visit_meta(demuxer, &data, visit_detect)",
          "old_line_content": "        MP_INFO(demuxer, \"Using tag charset: %s\\n\", in->meta_charset);",
          "new_line_content": "    visit_meta(demuxer, &data, visit_detect);",
          "content_same": false
        },
        {
          "line": 4504,
          "old_api": "talloc_free",
          "new_api": "MP_INFO",
          "old_text": "talloc_free(data)",
          "new_text": "MP_INFO(demuxer, \"Using tag charset: %s\\n\", in->meta_charset)",
          "old_line_content": "    talloc_free(data);",
          "new_line_content": "        MP_INFO(demuxer, \"Using tag charset: %s\\n\", in->meta_charset);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 4096,
          "old_api": null,
          "new_api": "MP_ARRAY_SIZE",
          "old_text": null,
          "new_text": "MP_ARRAY_SIZE(ranges)",
          "old_line_content": "    for (int n = 0; n < num_ranges; n++) {",
          "new_line_content": "    for (int n = 0; n < MPMIN(MP_ARRAY_SIZE(ranges), in->num_ranges); n++)",
          "content_same": false
        },
        {
          "line": 4352,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(demuxer == in->d_user)",
          "old_line_content": "    for (int n = 0; n < STREAM_TYPE_COUNT; n++)",
          "new_line_content": "    assert(demuxer == in->d_user);",
          "content_same": false
        },
        {
          "line": 4098,
          "old_api": null,
          "new_api": "qsort",
          "old_text": null,
          "new_text": "qsort(ranges, num_ranges, sizeof(ranges[0]), range_time_compare)",
          "old_line_content": "        if (r->seek_start == MP_NOPTS_VALUE)",
          "new_line_content": "    qsort(ranges, num_ranges, sizeof(ranges[0]), range_time_compare);",
          "content_same": false
        },
        {
          "line": 4226,
          "old_api": null,
          "new_api": "dump_cache",
          "old_text": null,
          "new_text": "dump_cache(in, start, end)",
          "old_line_content": "",
          "new_line_content": "        dump_cache(in, start, end);",
          "content_same": false
        },
        {
          "line": 4354,
          "old_api": null,
          "new_api": "pthread_mutex_lock",
          "old_text": null,
          "new_text": "pthread_mutex_lock(&in->lock)",
          "old_line_content": "    for (int n = 0; n < in->num_streams; n++) {",
          "new_line_content": "    pthread_mutex_lock(&in->lock);",
          "content_same": false
        },
        {
          "line": 4229,
          "old_api": null,
          "new_api": "pthread_mutex_unlock",
          "old_text": null,
          "new_text": "pthread_mutex_unlock(&in->lock)",
          "old_line_content": "",
          "new_line_content": "    pthread_mutex_unlock(&in->lock);",
          "content_same": false
        },
        {
          "line": 4480,
          "old_api": null,
          "new_api": "mp_iconv_to_utf8",
          "old_text": null,
          "new_text": "mp_iconv_to_utf8(in->log, data, in->meta_charset,\n                                 MP_ICONV_VERBOSE)",
          "old_line_content": "        // (The old string might not be an alloc, but if it is, it's a talloc",
          "new_line_content": "    bstr conv = mp_iconv_to_utf8(in->log, data, in->meta_charset,",
          "content_same": false
        },
        {
          "line": 4487,
          "old_api": null,
          "new_api": "talloc_steal",
          "old_text": null,
          "new_text": "talloc_steal(ta, *s)",
          "old_line_content": "static void demux_convert_tags_charset(struct demuxer *demuxer)",
          "new_line_content": "        talloc_steal(ta, *s);",
          "content_same": false
        },
        {
          "line": 4361,
          "old_api": null,
          "new_api": "MPMAX",
          "old_text": null,
          "new_text": "MPMAX(0, rates[ds->type])",
          "old_line_content": "}",
          "new_line_content": "            rates[ds->type] = MPMAX(0, rates[ds->type]) + ds->bitrate;",
          "content_same": false
        },
        {
          "line": 4364,
          "old_api": null,
          "new_api": "pthread_mutex_unlock",
          "old_text": null,
          "new_text": "pthread_mutex_unlock(&in->lock)",
          "old_line_content": "{",
          "new_line_content": "    pthread_mutex_unlock(&in->lock);",
          "content_same": false
        },
        {
          "line": 4238,
          "old_api": null,
          "new_api": "pthread_mutex_lock",
          "old_text": null,
          "new_text": "pthread_mutex_lock(&in->lock)",
          "old_line_content": "}",
          "new_line_content": "    pthread_mutex_lock(&in->lock);",
          "content_same": false
        },
        {
          "line": 4240,
          "old_api": null,
          "new_api": "pthread_mutex_unlock",
          "old_text": null,
          "new_text": "pthread_mutex_unlock(&in->lock)",
          "old_line_content": "// Return what range demux_cache_dump_set() would (probably) yield. This is a",
          "new_line_content": "    pthread_mutex_unlock(&in->lock);",
          "content_same": false
        },
        {
          "line": 4113,
          "old_api": null,
          "new_api": "adjust_cache_seek_target",
          "old_text": null,
          "new_text": "adjust_cache_seek_target(in, r, &pts, &flags)",
          "old_line_content": "            struct demux_stream *ds = q->ds;",
          "new_line_content": "        adjust_cache_seek_target(in, r, &pts, &flags);",
          "content_same": false
        },
        {
          "line": 4370,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(demuxer == in->d_user)",
          "old_line_content": "    *r = (struct demux_reader_state){",
          "new_line_content": "    assert(demuxer == in->d_user);",
          "content_same": false
        },
        {
          "line": 4372,
          "old_api": null,
          "new_api": "pthread_mutex_lock",
          "old_text": null,
          "new_text": "pthread_mutex_lock(&in->lock)",
          "old_line_content": "        .ts_reader = MP_NOPTS_VALUE,",
          "new_line_content": "    pthread_mutex_lock(&in->lock);",
          "content_same": false
        },
        {
          "line": 4502,
          "old_api": null,
          "new_api": "bstr0",
          "old_text": null,
          "new_text": "bstr0(data)",
          "old_line_content": "    }",
          "new_line_content": "    in->meta_charset = (char *)mp_charset_guess(in, in->log, bstr0(data), cp, 0);",
          "content_same": false
        },
        {
          "line": 4119,
          "old_api": null,
          "new_api": "find_seek_target",
          "old_text": null,
          "new_text": "find_seek_target(q, pts, flags)",
          "old_line_content": "        // everything more complex.",
          "new_line_content": "            ds->dump_pos = find_seek_target(q, pts, flags);",
          "content_same": false
        },
        {
          "line": 4503,
          "old_api": null,
          "new_api": "mp_charset_is_utf8",
          "old_text": null,
          "new_text": "mp_charset_is_utf8(in->meta_charset)",
          "old_line_content": "",
          "new_line_content": "    if (in->meta_charset && !mp_charset_is_utf8(in->meta_charset)) {",
          "content_same": false
        },
        {
          "line": 4505,
          "old_api": null,
          "new_api": "visit_meta",
          "old_text": null,
          "new_text": "visit_meta(demuxer, demuxer, visit_convert)",
          "old_line_content": "}",
          "new_line_content": "        visit_meta(demuxer, demuxer, visit_convert);",
          "content_same": false
        },
        {
          "line": 4508,
          "old_api": null,
          "new_api": "talloc_free",
          "old_text": null,
          "new_text": "talloc_free(data)",
          "old_line_content": "{",
          "new_line_content": "    talloc_free(data);",
          "content_same": false
        },
        {
          "line": 4253,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(demuxer == in->d_user)",
          "old_line_content": "        return pts;",
          "new_line_content": "    assert(demuxer == in->d_user);",
          "content_same": false
        },
        {
          "line": 4385,
          "old_api": null,
          "new_api": "demux_cache_get_size",
          "old_text": null,
          "new_text": "demux_cache_get_size(in->cache)",
          "old_line_content": "        struct demux_stream *ds = in->streams[n]->ds;",
          "new_line_content": "        .file_cache_bytes = in->cache ? demux_cache_get_size(in->cache) : -1,",
          "content_same": false
        },
        {
          "line": 4259,
          "old_api": null,
          "new_api": "pthread_mutex_lock",
          "old_text": null,
          "new_text": "pthread_mutex_lock(&in->lock)",
          "old_line_content": "    // (When determining the end, look before the keyframe at pts, so subtract",
          "new_line_content": "    pthread_mutex_lock(&in->lock);",
          "content_same": false
        },
        {
          "line": 4261,
          "old_api": null,
          "new_api": "MP_ADD_PTS",
          "old_text": null,
          "new_text": "MP_ADD_PTS(pts, -in->ts_offset)",
          "old_line_content": "    double seek_pts = for_end ? pts - 0.001 : pts;",
          "new_line_content": "    pts = MP_ADD_PTS(pts, -in->ts_offset);",
          "content_same": false
        },
        {
          "line": 4134,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(dp->stream == ds->index)",
          "old_line_content": "                // Check for stream EOF. Note that we don't try to EOF",
          "new_line_content": "                assert(dp->stream == ds->index);",
          "content_same": false
        },
        {
          "line": 4136,
          "old_api": null,
          "new_api": "MP_PTS_OR_DEF",
          "old_text": null,
          "new_text": "MP_PTS_OR_DEF(dp->dts, dp->pts)",
          "old_line_content": "                // to finish than audio, so the output file will have no",
          "new_line_content": "                double pdts = MP_PTS_OR_DEF(dp->dts, dp->pts);",
          "content_same": false
        },
        {
          "line": 4393,
          "old_api": null,
          "new_api": "MP_PTS_MAX",
          "old_text": null,
          "new_text": "MP_PTS_MAX(r->ts_end, ds->queue->last_ts)",
          "old_line_content": "    }",
          "new_line_content": "            r->ts_end = MP_PTS_MAX(r->ts_end, ds->queue->last_ts);",
          "content_same": false
        },
        {
          "line": 4267,
          "old_api": null,
          "new_api": "find_cache_seek_range",
          "old_text": null,
          "new_text": "find_cache_seek_range(in, seek_pts, flags)",
          "old_line_content": "",
          "new_line_content": "    struct demux_cached_range *r = find_cache_seek_range(in, seek_pts, flags);",
          "content_same": false
        },
        {
          "line": 4270,
          "old_api": null,
          "new_api": "adjust_cache_seek_target",
          "old_text": null,
          "new_text": "adjust_cache_seek_target(in, r, &pts, &flags)",
          "old_line_content": "            t[n] = MP_NOPTS_VALUE;",
          "new_line_content": "            adjust_cache_seek_target(in, r, &pts, &flags);",
          "content_same": false
        },
        {
          "line": 4400,
          "old_api": null,
          "new_api": "MP_ADD_PTS",
          "old_text": null,
          "new_text": "MP_ADD_PTS(r->ts_reader, in->ts_offset)",
          "old_line_content": "    if (in->seeking || !any_packets)",
          "new_line_content": "    r->ts_reader = MP_ADD_PTS(r->ts_reader, in->ts_offset);",
          "content_same": false
        },
        {
          "line": 4401,
          "old_api": null,
          "new_api": "MP_ADD_PTS",
          "old_text": null,
          "new_text": "MP_ADD_PTS(r->ts_end, in->ts_offset)",
          "old_line_content": "        r->ts_duration = 0;",
          "new_line_content": "    r->ts_end = MP_ADD_PTS(r->ts_end, in->ts_offset);",
          "content_same": false
        },
        {
          "line": 4406,
          "old_api": null,
          "new_api": "MPMIN",
          "old_text": null,
          "new_text": "MPMIN(in->num_ranges, MAX_SEEK_RANGES)",
          "old_line_content": "                (struct demux_seek_range){",
          "new_line_content": "    for (int n = 0; n < MPMIN(in->num_ranges, MAX_SEEK_RANGES); n++) {",
          "content_same": false
        },
        {
          "line": 4411,
          "old_api": null,
          "new_api": "MP_ADD_PTS",
          "old_text": null,
          "new_text": "MP_ADD_PTS(range->seek_start, in->ts_offset)",
          "old_line_content": "            r->eof_cached |= range->is_eof;",
          "new_line_content": "                    .start = MP_ADD_PTS(range->seek_start, in->ts_offset),",
          "content_same": false
        },
        {
          "line": 4284,
          "old_api": null,
          "new_api": "MP_PTS_OR_DEF",
          "old_text": null,
          "new_text": "MP_PTS_OR_DEF(dp->dts, dp->pts)",
          "old_line_content": "",
          "new_line_content": "                        double pdts = MP_PTS_OR_DEF(dp->dts, dp->pts);",
          "content_same": false
        },
        {
          "line": 4412,
          "old_api": null,
          "new_api": "MP_ADD_PTS",
          "old_text": null,
          "new_text": "MP_ADD_PTS(range->seek_end, in->ts_offset)",
          "old_line_content": "        }",
          "new_line_content": "                    .end = MP_ADD_PTS(range->seek_end, in->ts_offset),",
          "content_same": false
        },
        {
          "line": 4030,
          "old_api": null,
          "new_api": "mp_time_us",
          "old_text": null,
          "new_text": "mp_time_us()",
          "old_line_content": "    // Don't lock while querying the stream.",
          "new_line_content": "    int64_t now = mp_time_us();",
          "content_same": false
        },
        {
          "line": 4289,
          "old_api": null,
          "new_api": "MP_PTS_MAX",
          "old_text": null,
          "new_text": "MP_PTS_MAX(t[ds->type], pdts)",
          "old_line_content": "                } else {",
          "new_line_content": "                        t[ds->type] = MP_PTS_MAX(t[ds->type], pdts);",
          "content_same": false
        },
        {
          "line": 4163,
          "old_api": null,
          "new_api": "read_packet_from_cache",
          "old_text": null,
          "new_text": "read_packet_from_cache(in, next)",
          "old_line_content": "            }",
          "new_line_content": "            struct demux_packet *dp = read_packet_from_cache(in, next);",
          "content_same": false
        },
        {
          "line": 4419,
          "old_api": null,
          "new_api": "pthread_mutex_unlock",
          "old_text": null,
          "new_text": "pthread_mutex_unlock(&in->lock)",
          "old_line_content": "{",
          "new_line_content": "    pthread_mutex_unlock(&in->lock);",
          "content_same": false
        },
        {
          "line": 4295,
          "old_api": null,
          "new_api": "compute_keyframe_times",
          "old_text": null,
          "new_text": "compute_keyframe_times(dp, &start, NULL)",
          "old_line_content": "            }",
          "new_line_content": "                    compute_keyframe_times(dp, &start, NULL);",
          "content_same": false
        },
        {
          "line": 4296,
          "old_api": null,
          "new_api": "MP_PTS_MAX",
          "old_text": null,
          "new_text": "MP_PTS_MAX(start, r->seek_start)",
          "old_line_content": "        }",
          "new_line_content": "                    start = MP_PTS_MAX(start, r->seek_start);",
          "content_same": false
        },
        {
          "line": 4169,
          "old_api": null,
          "new_api": "write_dump_packet",
          "old_text": null,
          "new_text": "write_dump_packet(in, dp)",
          "old_line_content": "",
          "new_line_content": "            write_dump_packet(in, dp);",
          "content_same": false
        },
        {
          "line": 4297,
          "old_api": null,
          "new_api": "MP_PTS_MAX",
          "old_text": null,
          "new_text": "MP_PTS_MAX(t[ds->type], start)",
          "old_line_content": "",
          "new_line_content": "                    t[ds->type] = MP_PTS_MAX(t[ds->type], start);",
          "content_same": false
        },
        {
          "line": 4171,
          "old_api": null,
          "new_api": "talloc_free",
          "old_text": null,
          "new_text": "talloc_free(dp)",
          "old_line_content": "            break;",
          "new_line_content": "            talloc_free(dp);",
          "content_same": false
        },
        {
          "line": 4424,
          "old_api": null,
          "new_api": "mp_cancel_test",
          "old_text": null,
          "new_text": "mp_cancel_test(demuxer->cancel)",
          "old_line_content": "{",
          "new_line_content": "    return mp_cancel_test(demuxer->cancel);",
          "content_same": false
        },
        {
          "line": 4429,
          "old_api": null,
          "new_api": "talloc_array",
          "old_text": null,
          "new_text": "talloc_array(NULL, struct demux_chapter, num)",
          "old_line_content": "    }",
          "new_line_content": "    struct demux_chapter *new = talloc_array(NULL, struct demux_chapter, num);",
          "content_same": false
        },
        {
          "line": 4040,
          "old_api": null,
          "new_api": "stream_get_size",
          "old_text": null,
          "new_text": "stream_get_size(stream)",
          "old_line_content": "",
          "new_line_content": "            stream_size = stream_get_size(stream);",
          "content_same": false
        },
        {
          "line": 4044,
          "old_api": null,
          "new_api": "update_bytes_read",
          "old_text": null,
          "new_text": "update_bytes_read(in)",
          "old_line_content": "    if (stream_metadata) {",
          "new_line_content": "    update_bytes_read(in);",
          "content_same": false
        },
        {
          "line": 4432,
          "old_api": null,
          "new_api": "mp_tags_dup",
          "old_text": null,
          "new_text": "mp_tags_dup(new, new[n].metadata)",
          "old_line_content": "",
          "new_line_content": "        new[n].metadata = mp_tags_dup(new, new[n].metadata);",
          "content_same": false
        },
        {
          "line": 4052,
          "old_api": null,
          "new_api": "talloc_free",
          "old_text": null,
          "new_text": "talloc_free(stream_metadata)",
          "old_line_content": "    int64_t diff = now - in->last_speed_query;",
          "new_line_content": "        talloc_free(stream_metadata);",
          "content_same": false
        },
        {
          "line": 4185,
          "old_api": null,
          "new_api": "mp_recorder_mark_discontinuity",
          "old_text": null,
          "new_text": "mp_recorder_mark_discontinuity(in->dumper)",
          "old_line_content": "    if (end != MP_NOPTS_VALUE || in->dumper_status != CONTROL_OK)",
          "new_line_content": "        mp_recorder_mark_discontinuity(in->dumper);",
          "content_same": false
        },
        {
          "line": 4314,
          "old_api": null,
          "new_api": "MP_ADD_PTS",
          "old_text": null,
          "new_text": "MP_ADD_PTS(res, in->ts_offset)",
          "old_line_content": "    return res;",
          "new_line_content": "    res = MP_ADD_PTS(res, in->ts_offset);",
          "content_same": false
        },
        {
          "line": 4441,
          "old_api": null,
          "new_api": "visit",
          "old_text": null,
          "new_text": "visit(ctx, tags, &tags->values[n])",
          "old_line_content": "                       void (*visit)(void *ctx, void *ta, char **s))",
          "new_line_content": "        visit(ctx, tags, &tags->values[n]);",
          "content_same": false
        },
        {
          "line": 4316,
          "old_api": null,
          "new_api": "pthread_mutex_unlock",
          "old_text": null,
          "new_text": "pthread_mutex_unlock(&in->lock)",
          "old_line_content": "",
          "new_line_content": "    pthread_mutex_unlock(&in->lock);",
          "content_same": false
        },
        {
          "line": 4190,
          "old_api": null,
          "new_api": "dumper_close",
          "old_text": null,
          "new_text": "dumper_close(in)",
          "old_line_content": "// active, so calling this aborts the previous dumping. Passing file==NULL",
          "new_line_content": "        dumper_close(in);",
          "content_same": false
        },
        {
          "line": 4452,
          "old_api": null,
          "new_api": "visit",
          "old_text": null,
          "new_text": "visit(ctx, sh, &sh->title)",
          "old_line_content": "    for (int n = 0; n < demuxer->num_chapters; n++)",
          "new_line_content": "        visit(ctx, sh, &sh->title);",
          "content_same": false
        },
        {
          "line": 4327,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(demuxer == in->d_thread)",
          "old_line_content": "",
          "new_line_content": "    assert(demuxer == in->d_thread);",
          "content_same": false
        },
        {
          "line": 4071,
          "old_api": null,
          "new_api": "mp_recorder_destroy",
          "old_text": null,
          "new_text": "mp_recorder_destroy(in->dumper)",
          "old_line_content": "}",
          "new_line_content": "        mp_recorder_destroy(in->dumper);",
          "content_same": false
        },
        {
          "line": 4457,
          "old_api": null,
          "new_api": "visit_tags",
          "old_text": null,
          "new_text": "visit_tags(ctx, visit, demuxer->chapters[n].metadata)",
          "old_line_content": "",
          "new_line_content": "        visit_tags(ctx, visit, demuxer->chapters[n].metadata);",
          "content_same": false
        },
        {
          "line": 4459,
          "old_api": null,
          "new_api": "visit_tags",
          "old_text": null,
          "new_text": "visit_tags(ctx, visit, demuxer->metadata)",
          "old_line_content": "static void visit_detect(void *ctx, void *ta, char **s)",
          "new_line_content": "    visit_tags(ctx, visit, demuxer->metadata);",
          "content_same": false
        },
        {
          "line": 4208,
          "old_api": null,
          "new_api": "pthread_mutex_lock",
          "old_text": null,
          "new_text": "pthread_mutex_lock(&in->lock)",
          "old_line_content": "",
          "new_line_content": "    pthread_mutex_lock(&in->lock);",
          "content_same": false
        },
        {
          "line": 4210,
          "old_api": null,
          "new_api": "MP_ADD_PTS",
          "old_text": null,
          "new_text": "MP_ADD_PTS(start, -in->ts_offset)",
          "old_line_content": "",
          "new_line_content": "    start = MP_ADD_PTS(start, -in->ts_offset);",
          "content_same": false
        },
        {
          "line": 4211,
          "old_api": null,
          "new_api": "MP_ADD_PTS",
          "old_text": null,
          "new_text": "MP_ADD_PTS(end, -in->ts_offset)",
          "old_line_content": "    if (file && file[0] && start != MP_NOPTS_VALUE) {",
          "new_line_content": "    end = MP_ADD_PTS(end, -in->ts_offset);",
          "content_same": false
        },
        {
          "line": 4340,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(!in->threading)",
          "old_line_content": "    int64_t res = in->hack_unbuffered_read_bytes;",
          "new_line_content": "    assert(!in->threading);",
          "content_same": false
        },
        {
          "line": 4213,
          "old_api": null,
          "new_api": "dumper_close",
          "old_text": null,
          "new_text": "dumper_close(in)",
          "old_line_content": "",
          "new_line_content": "    dumper_close(in);",
          "content_same": false
        },
        {
          "line": 4342,
          "old_api": null,
          "new_api": "update_bytes_read",
          "old_text": null,
          "new_text": "update_bytes_read(in)",
          "old_line_content": "    return res;",
          "new_line_content": "    update_bytes_read(in);",
          "content_same": false
        },
        {
          "line": 4468,
          "old_api": null,
          "new_api": "talloc_asprintf_append_buffer",
          "old_text": null,
          "new_text": "talloc_asprintf_append_buffer(*all, \"%s\\n\", *s)",
          "old_line_content": "{",
          "new_line_content": "        *all = talloc_asprintf_append_buffer(*all, \"%s\\n\", *s);",
          "content_same": false
        },
        {
          "line": 4218,
          "old_api": null,
          "new_api": "recorder_create",
          "old_text": null,
          "new_text": "recorder_create(in, file)",
          "old_line_content": "        // General idea: iterate over all cache ranges, dump what intersects.",
          "new_line_content": "        in->dumper = recorder_create(in, file);",
          "content_same": false
        },
        {
          "line": 4479,
          "old_api": null,
          "new_api": "bstr0",
          "old_text": null,
          "new_text": "bstr0(*s)",
          "old_line_content": "        char *ns = conv.start; // 0-termination is guaranteed",
          "new_line_content": "    bstr data = bstr0(*s);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 4225,
          "old_api": "pthread_mutex_unlock",
          "new_api": null,
          "old_text": "pthread_mutex_unlock(&in->lock)",
          "new_text": null,
          "old_line_content": "    pthread_mutex_unlock(&in->lock);",
          "new_line_content": "        // current range is not the last range).",
          "content_same": false
        },
        {
          "line": 4483,
          "old_api": "talloc_steal",
          "new_api": null,
          "old_text": "talloc_steal(ta, *s)",
          "new_text": null,
          "old_line_content": "        talloc_steal(ta, *s);",
          "new_line_content": "        char *ns = conv.start; // 0-termination is guaranteed",
          "content_same": false
        },
        {
          "line": 4357,
          "old_api": "MPMAX",
          "new_api": null,
          "old_text": "MPMAX(0, rates[ds->type])",
          "new_text": null,
          "old_line_content": "            rates[ds->type] = MPMAX(0, rates[ds->type]) + ds->bitrate;",
          "new_line_content": "        rates[n] = -1;",
          "content_same": false
        },
        {
          "line": 4360,
          "old_api": "pthread_mutex_unlock",
          "new_api": null,
          "old_text": "pthread_mutex_unlock(&in->lock)",
          "new_text": null,
          "old_line_content": "    pthread_mutex_unlock(&in->lock);",
          "new_line_content": "        if (ds->selected && ds->bitrate >= 0)",
          "content_same": false
        },
        {
          "line": 4105,
          "old_api": "mp_recorder_mark_discontinuity",
          "new_api": null,
          "old_text": "mp_recorder_mark_discontinuity(in->dumper)",
          "new_text": null,
          "old_line_content": "        mp_recorder_mark_discontinuity(in->dumper);",
          "new_line_content": "            continue;",
          "content_same": false
        },
        {
          "line": 4234,
          "old_api": "pthread_mutex_lock",
          "new_api": null,
          "old_text": "pthread_mutex_lock(&in->lock)",
          "new_text": null,
          "old_line_content": "    pthread_mutex_lock(&in->lock);",
          "new_line_content": "// Returns one of CONTROL_*. CONTROL_TRUE means dumping is in progress.",
          "content_same": false
        },
        {
          "line": 4236,
          "old_api": "pthread_mutex_unlock",
          "new_api": null,
          "old_text": "pthread_mutex_unlock(&in->lock)",
          "new_text": null,
          "old_line_content": "    pthread_mutex_unlock(&in->lock);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 4492,
          "old_api": "mp_charset_is_utf8",
          "new_api": null,
          "old_text": "mp_charset_is_utf8(cp)",
          "new_text": null,
          "old_line_content": "    if (!cp || mp_charset_is_utf8(cp))",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 4366,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(demuxer == in->d_user)",
          "new_text": null,
          "old_line_content": "    assert(demuxer == in->d_user);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 4495,
          "old_api": "talloc_strdup",
          "new_api": null,
          "old_text": "talloc_strdup(NULL, \"\")",
          "new_text": null,
          "old_line_content": "    char *data = talloc_strdup(NULL, \"\");",
          "new_line_content": "    char *cp = in->opts->meta_cp;",
          "content_same": false
        },
        {
          "line": 4368,
          "old_api": "pthread_mutex_lock",
          "new_api": null,
          "old_text": "pthread_mutex_lock(&in->lock)",
          "new_text": null,
          "old_line_content": "    pthread_mutex_lock(&in->lock);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 4498,
          "old_api": "bstr0",
          "new_api": null,
          "old_text": "bstr0(data)",
          "new_text": null,
          "old_line_content": "    in->meta_charset = (char *)mp_charset_guess(in, in->log, bstr0(data), cp, 0);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 4115,
          "old_api": "find_seek_target",
          "new_api": null,
          "old_text": "find_seek_target(q, pts, flags)",
          "new_text": null,
          "old_line_content": "            ds->dump_pos = find_seek_target(q, pts, flags);",
          "new_line_content": "        for (int i = 0; i < r->num_streams; i++) {",
          "content_same": false
        },
        {
          "line": 4501,
          "old_api": "visit_meta",
          "new_api": null,
          "old_text": "visit_meta(demuxer, demuxer, visit_convert)",
          "new_text": null,
          "old_line_content": "        visit_meta(demuxer, demuxer, visit_convert);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 4249,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(demuxer == in->d_user)",
          "new_text": null,
          "old_line_content": "    assert(demuxer == in->d_user);",
          "new_line_content": "double demux_probe_cache_dump_target(struct demuxer *demuxer, double pts,",
          "content_same": false
        },
        {
          "line": 4381,
          "old_api": "demux_cache_get_size",
          "new_api": null,
          "old_text": "demux_cache_get_size(in->cache)",
          "new_text": null,
          "old_line_content": "        .file_cache_bytes = in->cache ? demux_cache_get_size(in->cache) : -1,",
          "new_line_content": "        .low_level_seeks = in->low_level_seeks,",
          "content_same": false
        },
        {
          "line": 4255,
          "old_api": "pthread_mutex_lock",
          "new_api": null,
          "old_text": "pthread_mutex_lock(&in->lock)",
          "new_text": null,
          "old_line_content": "    pthread_mutex_lock(&in->lock);",
          "new_line_content": "    double res = MP_NOPTS_VALUE;",
          "content_same": false
        },
        {
          "line": 4257,
          "old_api": "MP_ADD_PTS",
          "new_api": null,
          "old_text": "MP_ADD_PTS(pts, -in->ts_offset)",
          "new_text": null,
          "old_line_content": "    pts = MP_ADD_PTS(pts, -in->ts_offset);",
          "new_line_content": "        return pts;",
          "content_same": false
        },
        {
          "line": 4130,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(dp->stream == ds->index)",
          "new_text": null,
          "old_line_content": "                assert(dp->stream == ds->index);",
          "new_line_content": "                struct demux_packet *dp = ds->dump_pos;",
          "content_same": false
        },
        {
          "line": 4132,
          "old_api": "MP_PTS_OR_DEF",
          "new_api": null,
          "old_text": "MP_PTS_OR_DEF(dp->dts, dp->pts)",
          "new_text": null,
          "old_line_content": "                double pdts = MP_PTS_OR_DEF(dp->dts, dp->pts);",
          "new_line_content": "                if (!dp)",
          "content_same": false
        },
        {
          "line": 4388,
          "old_api": "MP_PTS_MAX",
          "new_api": null,
          "old_text": "MP_PTS_MAX(r->ts_reader, ds->base_ts)",
          "new_text": null,
          "old_line_content": "            r->ts_reader = MP_PTS_MAX(r->ts_reader, ds->base_ts);",
          "new_line_content": "    for (int n = 0; n < in->num_streams; n++) {",
          "content_same": false
        },
        {
          "line": 4389,
          "old_api": "MP_PTS_MAX",
          "new_api": null,
          "old_text": "MP_PTS_MAX(r->ts_end, ds->queue->last_ts)",
          "new_text": null,
          "old_line_content": "            r->ts_end = MP_PTS_MAX(r->ts_end, ds->queue->last_ts);",
          "new_line_content": "        struct demux_stream *ds = in->streams[n]->ds;",
          "content_same": false
        },
        {
          "line": 4263,
          "old_api": "find_cache_seek_range",
          "new_api": null,
          "old_text": "find_cache_seek_range(in, seek_pts, flags)",
          "new_text": null,
          "old_line_content": "    struct demux_cached_range *r = find_cache_seek_range(in, seek_pts, flags);",
          "new_line_content": "    // (When determining the end, look before the keyframe at pts, so subtract",
          "content_same": false
        },
        {
          "line": 4266,
          "old_api": "adjust_cache_seek_target",
          "new_api": null,
          "old_text": "adjust_cache_seek_target(in, r, &pts, &flags)",
          "new_text": null,
          "old_line_content": "            adjust_cache_seek_target(in, r, &pts, &flags);",
          "new_line_content": "    int flags = 0;",
          "content_same": false
        },
        {
          "line": 4397,
          "old_api": "MP_ADD_PTS",
          "new_api": null,
          "old_text": "MP_ADD_PTS(r->ts_end, in->ts_offset)",
          "new_text": null,
          "old_line_content": "    r->ts_end = MP_ADD_PTS(r->ts_end, in->ts_offset);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 4402,
          "old_api": "MPMIN",
          "new_api": null,
          "old_text": "MPMIN(in->num_ranges, MAX_SEEK_RANGES)",
          "new_text": null,
          "old_line_content": "    for (int n = 0; n < MPMIN(in->num_ranges, MAX_SEEK_RANGES); n++) {",
          "new_line_content": "    if (r->ts_reader != MP_NOPTS_VALUE && r->ts_reader <= r->ts_end)",
          "content_same": false
        },
        {
          "line": 4276,
          "old_api": "find_seek_target",
          "new_api": null,
          "old_text": "find_seek_target(q, pts, flags)",
          "new_text": null,
          "old_line_content": "            struct demux_packet *dp = find_seek_target(q, pts, flags);",
          "new_line_content": "        for (int n = 0; n < in->num_streams; n++) {",
          "content_same": false
        },
        {
          "line": 4407,
          "old_api": "MP_ADD_PTS",
          "new_api": null,
          "old_text": "MP_ADD_PTS(range->seek_start, in->ts_offset)",
          "new_text": null,
          "old_line_content": "                    .start = MP_ADD_PTS(range->seek_start, in->ts_offset),",
          "new_line_content": "        struct demux_cached_range *range = in->ranges[n];",
          "content_same": false
        },
        {
          "line": 4408,
          "old_api": "MP_ADD_PTS",
          "new_api": null,
          "old_text": "MP_ADD_PTS(range->seek_end, in->ts_offset)",
          "new_text": null,
          "old_line_content": "                    .end = MP_ADD_PTS(range->seek_end, in->ts_offset),",
          "new_line_content": "        if (range->seek_start != MP_NOPTS_VALUE) {",
          "content_same": false
        },
        {
          "line": 4285,
          "old_api": "MP_PTS_MAX",
          "new_api": null,
          "old_text": "MP_PTS_MAX(t[ds->type], pdts)",
          "new_text": null,
          "old_line_content": "                        t[ds->type] = MP_PTS_MAX(t[ds->type], pdts);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 4159,
          "old_api": "read_packet_from_cache",
          "new_api": null,
          "old_text": "read_packet_from_cache(in, next)",
          "new_text": null,
          "old_line_content": "            struct demux_packet *dp = read_packet_from_cache(in, next);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 4415,
          "old_api": "pthread_mutex_unlock",
          "new_api": null,
          "old_text": "pthread_mutex_unlock(&in->lock)",
          "new_text": null,
          "old_line_content": "    pthread_mutex_unlock(&in->lock);",
          "new_line_content": "            r->eof_cached |= range->is_eof;",
          "content_same": false
        },
        {
          "line": 4031,
          "old_api": "pthread_mutex_unlock",
          "new_api": null,
          "old_text": "pthread_mutex_unlock(&in->lock)",
          "new_text": null,
          "old_line_content": "    pthread_mutex_unlock(&in->lock);",
          "new_line_content": "    int64_t diff = now - in->last_speed_query;",
          "content_same": false
        },
        {
          "line": 4291,
          "old_api": "compute_keyframe_times",
          "new_api": null,
          "old_text": "compute_keyframe_times(dp, &start, NULL)",
          "new_text": null,
          "old_line_content": "                    compute_keyframe_times(dp, &start, NULL);",
          "new_line_content": "                        dp = dp->next;",
          "content_same": false
        },
        {
          "line": 4292,
          "old_api": "MP_PTS_MAX",
          "new_api": null,
          "old_text": "MP_PTS_MAX(start, r->seek_start)",
          "new_text": null,
          "old_line_content": "                    start = MP_PTS_MAX(start, r->seek_start);",
          "new_line_content": "                    }",
          "content_same": false
        },
        {
          "line": 4165,
          "old_api": "write_dump_packet",
          "new_api": null,
          "old_text": "write_dump_packet(in, dp)",
          "new_text": null,
          "old_line_content": "            write_dump_packet(in, dp);",
          "new_line_content": "                in->dumper_status = CONTROL_ERROR;",
          "content_same": false
        },
        {
          "line": 4293,
          "old_api": "MP_PTS_MAX",
          "new_api": null,
          "old_text": "MP_PTS_MAX(t[ds->type], start)",
          "new_text": null,
          "old_line_content": "                    t[ds->type] = MP_PTS_MAX(t[ds->type], start);",
          "new_line_content": "                } else {",
          "content_same": false
        },
        {
          "line": 4167,
          "old_api": "talloc_free",
          "new_api": null,
          "old_text": "talloc_free(dp)",
          "new_text": null,
          "old_line_content": "            talloc_free(dp);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 4420,
          "old_api": "mp_cancel_test",
          "new_api": null,
          "old_text": "mp_cancel_test(demuxer->cancel)",
          "new_text": null,
          "old_line_content": "    return mp_cancel_test(demuxer->cancel);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 4425,
          "old_api": "talloc_array",
          "new_api": null,
          "old_text": "talloc_array(NULL, struct demux_chapter, num)",
          "new_text": null,
          "old_line_content": "    struct demux_chapter *new = talloc_array(NULL, struct demux_chapter, num);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 4036,
          "old_api": "stream_control",
          "new_api": null,
          "old_text": "stream_control(stream, STREAM_CTRL_GET_METADATA, &stream_metadata)",
          "new_text": null,
          "old_line_content": "        stream_control(stream, STREAM_CTRL_GET_METADATA, &stream_metadata);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 4039,
          "old_api": "update_bytes_read",
          "new_api": null,
          "old_text": "update_bytes_read(in)",
          "new_text": null,
          "old_line_content": "    update_bytes_read(in);",
          "new_line_content": "        if (do_update)",
          "content_same": false
        },
        {
          "line": 4428,
          "old_api": "mp_tags_dup",
          "new_api": null,
          "old_text": "mp_tags_dup(new, new[n].metadata)",
          "new_text": null,
          "old_line_content": "        new[n].metadata = mp_tags_dup(new, new[n].metadata);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 4045,
          "old_api": "add_timed_metadata",
          "new_api": null,
          "old_text": "add_timed_metadata(in, stream_metadata, NULL, MP_NOPTS_VALUE)",
          "new_text": null,
          "old_line_content": "        add_timed_metadata(in, stream_metadata, NULL, MP_NOPTS_VALUE);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 4181,
          "old_api": "mp_recorder_mark_discontinuity",
          "new_api": null,
          "old_text": "mp_recorder_mark_discontinuity(in->dumper)",
          "new_text": null,
          "old_line_content": "        mp_recorder_mark_discontinuity(in->dumper);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 4310,
          "old_api": "MP_ADD_PTS",
          "new_api": null,
          "old_text": "MP_ADD_PTS(res, in->ts_offset)",
          "new_text": null,
          "old_line_content": "    res = MP_ADD_PTS(res, in->ts_offset);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 4437,
          "old_api": "visit",
          "new_api": null,
          "old_text": "visit(ctx, tags, &tags->values[n])",
          "new_text": null,
          "old_line_content": "        visit(ctx, tags, &tags->values[n]);",
          "new_line_content": "static void visit_tags(void *ctx, void (*visit)(void *ctx, void *ta, char **s),",
          "content_same": false
        },
        {
          "line": 4312,
          "old_api": "pthread_mutex_unlock",
          "new_api": null,
          "old_text": "pthread_mutex_unlock(&in->lock)",
          "new_text": null,
          "old_line_content": "    pthread_mutex_unlock(&in->lock);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 4186,
          "old_api": "dumper_close",
          "new_api": null,
          "old_text": "dumper_close(in)",
          "new_text": null,
          "old_line_content": "        dumper_close(in);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 4448,
          "old_api": "visit",
          "new_api": null,
          "old_text": "visit(ctx, sh, &sh->title)",
          "new_text": null,
          "old_line_content": "        visit(ctx, sh, &sh->title);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 4449,
          "old_api": "visit_tags",
          "new_api": null,
          "old_text": "visit_tags(ctx, visit, sh->tags)",
          "new_text": null,
          "old_line_content": "        visit_tags(ctx, visit, sh->tags);",
          "new_line_content": "    for (int n = 0; n < in->num_streams; n++) {",
          "content_same": false
        },
        {
          "line": 4323,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(demuxer == in->d_thread)",
          "new_text": null,
          "old_line_content": "    assert(demuxer == in->d_thread);",
          "new_line_content": "// demux.c itself).",
          "content_same": false
        },
        {
          "line": 4067,
          "old_api": "mp_recorder_destroy",
          "new_api": null,
          "old_text": "mp_recorder_destroy(in->dumper)",
          "new_text": null,
          "old_line_content": "        mp_recorder_destroy(in->dumper);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 4455,
          "old_api": "visit_tags",
          "new_api": null,
          "old_text": "visit_tags(ctx, visit, demuxer->metadata)",
          "new_text": null,
          "old_line_content": "    visit_tags(ctx, visit, demuxer->metadata);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 4200,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(demuxer == in->d_user)",
          "new_text": null,
          "old_line_content": "    assert(demuxer == in->d_user);",
          "new_line_content": "bool demux_cache_dump_set(struct demuxer *demuxer, double start, double end,",
          "content_same": false
        },
        {
          "line": 4206,
          "old_api": "MP_ADD_PTS",
          "new_api": null,
          "old_text": "MP_ADD_PTS(start, -in->ts_offset)",
          "new_text": null,
          "old_line_content": "    start = MP_ADD_PTS(start, -in->ts_offset);",
          "new_line_content": "    bool res = false;",
          "content_same": false
        },
        {
          "line": 4207,
          "old_api": "MP_ADD_PTS",
          "new_api": null,
          "old_text": "MP_ADD_PTS(end, -in->ts_offset)",
          "new_text": null,
          "old_line_content": "    end = MP_ADD_PTS(end, -in->ts_offset);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 4336,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(!in->threading)",
          "new_text": null,
          "old_line_content": "    assert(!in->threading);",
          "new_line_content": "    struct demux_internal *in = demuxer->in;",
          "content_same": false
        },
        {
          "line": 4209,
          "old_api": "dumper_close",
          "new_api": null,
          "old_text": "dumper_close(in)",
          "new_text": null,
          "old_line_content": "    dumper_close(in);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 4338,
          "old_api": "update_bytes_read",
          "new_api": null,
          "old_text": "update_bytes_read(in)",
          "new_text": null,
          "old_line_content": "    update_bytes_read(in);",
          "new_line_content": "    // Required because demuxer==in->d_user, and we access in->d_thread.",
          "content_same": false
        },
        {
          "line": 4464,
          "old_api": "talloc_asprintf_append_buffer",
          "new_api": null,
          "old_text": "talloc_asprintf_append_buffer(*all, \"%s\\n\", *s)",
          "new_text": null,
          "old_line_content": "        *all = talloc_asprintf_append_buffer(*all, \"%s\\n\", *s);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 4348,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(demuxer == in->d_user)",
          "new_text": null,
          "old_line_content": "    assert(demuxer == in->d_user);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 4214,
          "old_api": "recorder_create",
          "new_api": null,
          "old_text": "recorder_create(in, file)",
          "new_text": null,
          "old_line_content": "        in->dumper = recorder_create(in, file);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 4094,
          "old_api": "qsort",
          "new_api": null,
          "old_text": "qsort(ranges, num_ranges, sizeof(ranges[0]), range_time_compare)",
          "new_text": null,
          "old_line_content": "    qsort(ranges, num_ranges, sizeof(ranges[0]), range_time_compare);",
          "new_line_content": "    struct demux_cached_range *ranges[MAX_SEEK_RANGES];",
          "content_same": false
        },
        {
          "line": 4476,
          "old_api": "mp_iconv_to_utf8",
          "new_api": null,
          "old_text": "mp_iconv_to_utf8(in->log, data, in->meta_charset,\n                                 MP_ICONV_VERBOSE)",
          "new_text": null,
          "old_line_content": "    bstr conv = mp_iconv_to_utf8(in->log, data, in->meta_charset,",
          "new_line_content": "    if (!*s)",
          "content_same": false
        },
        {
          "line": 4222,
          "old_api": "dump_cache",
          "new_api": null,
          "old_text": "dump_cache(in, start, end)",
          "new_text": null,
          "old_line_content": "        dump_cache(in, start, end);",
          "new_line_content": "        // General idea: iterate over all cache ranges, dump what intersects.",
          "content_same": false
        },
        {
          "line": 4475,
          "old_api": "bstr0",
          "new_api": null,
          "old_text": "bstr0(*s)",
          "new_text": null,
          "old_line_content": "    bstr data = bstr0(*s);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 4092,
          "old_api": "MP_ARRAY_SIZE",
          "new_api": null,
          "old_text": "MP_ARRAY_SIZE(ranges)",
          "new_text": null,
          "old_line_content": "    for (int n = 0; n < MPMIN(MP_ARRAY_SIZE(ranges), in->num_ranges); n++)",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 4350,
          "old_api": "pthread_mutex_lock",
          "new_api": null,
          "old_text": "pthread_mutex_lock(&in->lock)",
          "new_text": null,
          "old_line_content": "    pthread_mutex_lock(&in->lock);",
          "new_line_content": "{",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 13,
      "total_additions": 69,
      "total_deletions": 69,
      "total_api_changes": 151
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 14,
        "api_related_lines": 151,
        "non_api_lines": 7,
        "non_api_line_numbers": [
          4032,
          4033,
          4043,
          4048,
          4049,
          4053,
          4057
        ]
      }
    },
    "api_calls_before": 645,
    "api_calls_after": 645,
    "diff_info": {
      "added_lines": 9,
      "removed_lines": 5,
      "total_diff_lines": 45
    }
  }
}