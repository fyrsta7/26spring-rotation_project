{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/5895d6c24fa3b66230fe1f5177af7f65b4c6a706",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/5895d6c24fa3b66230fe1f5177af7f65b4c6a706/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/5895d6c24fa3b66230fe1f5177af7f65b4c6a706/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/5895d6c24fa3b66230fe1f5177af7f65b4c6a706/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 435,
          "old_api": "l_surface_commit",
          "new_api": "uffer_get_front",
          "old_text": "l_surface_commit(wl->window.surface);",
          "new_text": "uffer_get_front(p);",
          "old_line_content": "    wl_surface_commit(wl->window.surface);",
          "new_line_content": "    struct buffer *buf = buffer_get_front(p);",
          "content_same": false
        },
        {
          "line": 489,
          "old_api": "sd_draw_on_image",
          "new_api": "p_sws_scale",
          "old_text": "sd_draw_on_image(osd, p->osd, osd->vo_pts, 0, &img);",
          "new_text": "p_sws_scale(p->sws, &img, &src);",
          "old_line_content": "    osd_draw_on_image(osd, p->osd, osd->vo_pts, 0, &img);",
          "new_line_content": "    mp_sws_scale(p->sws, &img, &src);",
          "content_same": false
        },
        {
          "line": 499,
          "old_api": "rame_handle_redraw",
          "new_api": "sd_draw_on_image",
          "old_text": "rame_handle_redraw(p, NULL, 0);",
          "new_text": "sd_draw_on_image(osd, p->osd, osd->vo_pts, 0, &img);",
          "old_line_content": "        frame_handle_redraw(p, NULL, 0);",
          "new_line_content": "    osd_draw_on_image(osd, p->osd, osd->vo_pts, 0, &img);",
          "content_same": false
        },
        {
          "line": 509,
          "old_api": "p_sws_supported_format",
          "new_api": "rame_handle_redraw",
          "old_text": "p_sws_supported_format(format))",
          "new_text": "rame_handle_redraw(p, NULL, 0);",
          "old_line_content": "    if (mp_sws_supported_format(format))",
          "new_line_content": "        frame_handle_redraw(p, NULL, 0);",
          "content_same": false
        },
        {
          "line": 569,
          "old_api": "P_ERR",
          "new_api": "estroy_shm_buffer",
          "old_text": "P_ERR(vo, \"could not initalise backend\\n\");",
          "new_text": "estroy_shm_buffer(&p->buffers[i]);",
          "old_line_content": "        MP_ERR(vo, \"could not initalise backend\\n\");",
          "new_line_content": "        destroy_shm_buffer(&p->buffers[i]);",
          "content_same": false
        },
        {
          "line": 602,
          "old_api": "v_clipf",
          "new_api": "esize",
          "old_text": "v_clipf(c[1], dst->y0, dst->y1) ",
          "new_text": "esize(p);",
          "old_line_content": "        c[1] = av_clipf(c[1], dst->y0, dst->y1) - dst->y0;",
          "new_line_content": "        resize(p);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 519,
          "old_api": null,
          "new_api": "p_sws_supported_format",
          "old_text": null,
          "new_text": "p_sws_supported_format(format))",
          "old_line_content": "    p->width = vo->dwidth;",
          "new_line_content": "    if (mp_sws_supported_format(format))",
          "content_same": false
        },
        {
          "line": 650,
          "old_api": null,
          "new_api": "PT_FLAG",
          "old_text": null,
          "new_text": "PT_FLAG(\"alpha\", enable_alpha, 0),",
          "old_line_content": "",
          "new_line_content": "        OPT_FLAG(\"alpha\", enable_alpha, 0),",
          "content_same": false
        },
        {
          "line": 651,
          "old_api": null,
          "new_api": "PT_FLAG",
          "old_text": null,
          "new_text": "PT_FLAG(\"default-format\", use_default, 0),",
          "old_line_content": "",
          "new_line_content": "        OPT_FLAG(\"default-format\", use_default, 0),",
          "content_same": false
        },
        {
          "line": 400,
          "old_api": null,
          "new_api": "l_compositor_create_region",
          "old_text": null,
          "new_text": "l_compositor_create_region(wl->display.compositor);",
          "old_line_content": "",
          "new_line_content": "            wl_compositor_create_region(wl->display.compositor);",
          "content_same": false
        },
        {
          "line": 401,
          "old_api": null,
          "new_api": "l_region_add",
          "old_text": null,
          "new_text": "l_region_add(opaque, 0, 0, p->dst_w, p->dst_h);",
          "old_line_content": "    p->wl->window.events = 0;",
          "new_line_content": "        wl_region_add(opaque, 0, 0, p->dst_w, p->dst_h);",
          "content_same": false
        },
        {
          "line": 402,
          "old_api": null,
          "new_api": "l_surface_set_opaque_region",
          "old_text": null,
          "new_text": "l_surface_set_opaque_region(wl->window.surface, opaque);",
          "old_line_content": "    p->vo->want_redraw = true;",
          "new_line_content": "        wl_surface_set_opaque_region(wl->window.surface, opaque);",
          "content_same": false
        },
        {
          "line": 403,
          "old_api": null,
          "new_api": "l_region_destroy",
          "old_text": null,
          "new_text": "l_region_destroy(opaque);",
          "old_line_content": "    return true;",
          "new_line_content": "        wl_region_destroy(opaque);",
          "content_same": false
        },
        {
          "line": 407,
          "old_api": null,
          "new_api": "l_surface_attach",
          "old_text": null,
          "new_text": "l_surface_attach(wl->window.surface, p->front_buffer->wlbuf, x, y);",
          "old_line_content": "/* wayland listeners */",
          "new_line_content": "    wl_surface_attach(wl->window.surface, p->front_buffer->wlbuf, x, y);",
          "content_same": false
        },
        {
          "line": 408,
          "old_api": null,
          "new_api": "l_surface_damage",
          "old_text": null,
          "new_text": "l_surface_damage(wl->window.surface, 0, 0, p->dst_w, p->dst_h);",
          "old_line_content": "",
          "new_line_content": "    wl_surface_damage(wl->window.surface, 0, 0, p->dst_w, p->dst_h);",
          "content_same": false
        },
        {
          "line": 409,
          "old_api": null,
          "new_api": "l_surface_commit",
          "old_text": null,
          "new_text": "l_surface_commit(wl->window.surface);",
          "old_line_content": "static void buffer_handle_release(void *data, struct wl_buffer *buffer)",
          "new_line_content": "    wl_surface_commit(wl->window.surface);",
          "content_same": false
        },
        {
          "line": 552,
          "old_api": null,
          "new_api": "p_imgfmt_get_desc",
          "old_text": null,
          "new_text": "p_imgfmt_get_desc(p->pref_format->mp_fmt).",
          "old_line_content": "    return 0;",
          "new_line_content": "    p->bytes_per_pixel = mp_imgfmt_get_desc(p->pref_format->mp_fmt).bytes[0];",
          "content_same": false
        },
        {
          "line": 553,
          "old_api": null,
          "new_api": "P_VERBOSE",
          "old_text": null,
          "new_text": "P_VERBOSE(vo, \"bytes per pixel: %d\\n\", p->bytes_per_pixel);",
          "old_line_content": "}",
          "new_line_content": "    MP_VERBOSE(vo, \"bytes per pixel: %d\\n\", p->bytes_per_pixel);",
          "content_same": false
        },
        {
          "line": 555,
          "old_api": null,
          "new_api": "einit_shm_buffers",
          "old_text": null,
          "new_text": "einit_shm_buffers(p, p->width, p->height))",
          "old_line_content": "static void uninit(struct vo *vo)",
          "new_line_content": "    if (!reinit_shm_buffers(p, p->width, p->height)) {",
          "content_same": false
        },
        {
          "line": 556,
          "old_api": null,
          "new_api": "P_ERR",
          "old_text": null,
          "new_text": "P_ERR(vo, \"failed to initialise buffers\\n\");",
          "old_line_content": "{",
          "new_line_content": "        MP_ERR(vo, \"failed to initialise buffers\\n\");",
          "content_same": false
        },
        {
          "line": 560,
          "old_api": null,
          "new_api": "o_wayland_config",
          "old_text": null,
          "new_text": "o_wayland_config(vo, vo->dwidth, vo->dheight, flags);",
          "old_line_content": "",
          "new_line_content": "    vo_wayland_config(vo, vo->dwidth, vo->dheight, flags);",
          "content_same": false
        },
        {
          "line": 437,
          "old_api": null,
          "new_api": "l_surface_attach",
          "old_text": null,
          "new_text": "l_surface_attach(wl->window.surface, buf->wlbuf, 0, 0);",
          "old_line_content": "}",
          "new_line_content": "    wl_surface_attach(wl->window.surface, buf->wlbuf, 0, 0);",
          "content_same": false
        },
        {
          "line": 438,
          "old_api": null,
          "new_api": "l_surface_damage",
          "old_text": null,
          "new_text": "l_surface_damage(wl->window.surface, 0, 0, p->dst_w, p->dst_h);",
          "old_line_content": "",
          "new_line_content": "    wl_surface_damage(wl->window.surface, 0, 0, p->dst_w, p->dst_h);",
          "content_same": false
        },
        {
          "line": 441,
          "old_api": null,
          "new_api": "l_callback_destroy",
          "old_text": null,
          "new_text": "l_callback_destroy(callback);",
          "old_line_content": "};",
          "new_line_content": "        wl_callback_destroy(callback);",
          "content_same": false
        },
        {
          "line": 571,
          "old_api": null,
          "new_api": "o_wayland_uninit",
          "old_text": null,
          "new_text": "o_wayland_uninit(vo);",
          "old_line_content": "    }",
          "new_line_content": "    vo_wayland_uninit(vo);",
          "content_same": false
        },
        {
          "line": 443,
          "old_api": null,
          "new_api": "l_surface_frame",
          "old_text": null,
          "new_text": "l_surface_frame(wl->window.surface);",
          "old_line_content": "static void shm_handle_format(void *data,",
          "new_line_content": "    p->redraw_callback = wl_surface_frame(wl->window.surface);",
          "content_same": false
        },
        {
          "line": 444,
          "old_api": null,
          "new_api": "l_callback_add_listener",
          "old_text": null,
          "new_text": "l_callback_add_listener(p->redraw_callback, &frame_listener, p);",
          "old_line_content": "                              struct wl_shm *wl_shm,",
          "new_line_content": "    wl_callback_add_listener(p->redraw_callback, &frame_listener, p);",
          "content_same": false
        },
        {
          "line": 445,
          "old_api": null,
          "new_api": "l_surface_commit",
          "old_text": null,
          "new_text": "l_surface_commit(wl->window.surface);",
          "old_line_content": "                              uint32_t format)",
          "new_line_content": "    wl_surface_commit(wl->window.surface);",
          "content_same": false
        },
        {
          "line": 446,
          "old_api": null,
          "new_api": "uffer_finalise_front",
          "old_text": null,
          "new_text": "uffer_finalise_front(p);",
          "old_line_content": "{",
          "new_line_content": "    buffer_finalise_front(p);",
          "content_same": false
        },
        {
          "line": 578,
          "old_api": null,
          "new_api": "o_wayland_init",
          "old_text": null,
          "new_text": "o_wayland_init(vo))",
          "old_line_content": "    p->back_buffer = &p->buffers[0];",
          "new_line_content": "    if (!vo_wayland_init(vo)) {",
          "content_same": false
        },
        {
          "line": 579,
          "old_api": null,
          "new_api": "P_ERR",
          "old_text": null,
          "new_text": "P_ERR(vo, \"could not initalise backend\\n\");",
          "old_line_content": "",
          "new_line_content": "        MP_ERR(vo, \"could not initalise backend\\n\");",
          "content_same": false
        },
        {
          "line": 585,
          "old_api": null,
          "new_api": "p_sws_alloc",
          "old_text": null,
          "new_text": "p_sws_alloc(vo);",
          "old_line_content": "static int control(struct vo *vo, uint32_t request, void *data)",
          "new_line_content": "    p->sws = mp_sws_alloc(vo);",
          "content_same": false
        },
        {
          "line": 460,
          "old_api": null,
          "new_api": "P_INFO",
          "old_text": null,
          "new_text": "P_INFO(p->vo, \"format %s supported by hw\\n\",\n                    mp_imgfmt_to_name(fmttable[i].mp_fmt));",
          "old_line_content": "",
          "new_line_content": "            MP_INFO(p->vo, \"format %s supported by hw\\n\",",
          "content_same": false
        },
        {
          "line": 461,
          "old_api": null,
          "new_api": "p_imgfmt_to_name",
          "old_text": null,
          "new_text": "p_imgfmt_to_name(fmttable[i].mp_fmt))",
          "old_line_content": "",
          "new_line_content": "                    mp_imgfmt_to_name(fmttable[i].mp_fmt));",
          "content_same": false
        },
        {
          "line": 590,
          "old_api": null,
          "new_api": "l_shm_add_listener",
          "old_text": null,
          "new_text": "l_shm_add_listener(p->wl->display.shm, &shm_listener, p);",
          "old_line_content": "        return VO_TRUE;",
          "new_line_content": "    wl_shm_add_listener(p->wl->display.shm, &shm_listener, p);",
          "content_same": false
        },
        {
          "line": 591,
          "old_api": null,
          "new_api": "l_display_dispatch",
          "old_text": null,
          "new_text": "l_display_dispatch(p->wl->display.display);",
          "old_line_content": "    case VOCTRL_SET_PANSCAN:",
          "new_line_content": "    wl_display_dispatch(p->wl->display.display);",
          "content_same": false
        },
        {
          "line": 605,
          "old_api": null,
          "new_api": "edraw_frame",
          "old_text": null,
          "new_text": "edraw_frame(p);",
          "old_line_content": "    case VOCTRL_SCREENSHOT:",
          "new_line_content": "        return redraw_frame(p);",
          "content_same": false
        },
        {
          "line": 477,
          "old_api": null,
          "new_api": "uffer_get_back",
          "old_text": null,
          "new_text": "uffer_get_back(p);",
          "old_line_content": "",
          "new_line_content": "    struct buffer *buf = buffer_get_back(p);",
          "content_same": false
        },
        {
          "line": 611,
          "old_api": null,
          "new_api": "v_clipf",
          "old_text": null,
          "new_text": "v_clipf(c[0], dst->x0, dst->x1) ",
          "old_line_content": "    }",
          "new_line_content": "        c[0] = av_clipf(c[0], dst->x0, dst->x1) - dst->x0;",
          "content_same": false
        },
        {
          "line": 612,
          "old_api": null,
          "new_api": "v_clipf",
          "old_text": null,
          "new_text": "v_clipf(c[1], dst->y0, dst->y1) ",
          "old_line_content": "    int events = 0;",
          "new_line_content": "        c[1] = av_clipf(c[1], dst->y0, dst->y1) - dst->y0;",
          "content_same": false
        },
        {
          "line": 484,
          "old_api": null,
          "new_api": "P_ALIGN_DOWN",
          "old_text": null,
          "new_text": "P_ALIGN_DOWN(src_rc.x0, src.fmt.align_x);",
          "old_line_content": "",
          "new_line_content": "    src_rc.x0 = MP_ALIGN_DOWN(src_rc.x0, src.fmt.align_x);",
          "content_same": false
        },
        {
          "line": 485,
          "old_api": null,
          "new_api": "P_ALIGN_DOWN",
          "old_text": null,
          "new_text": "P_ALIGN_DOWN(src_rc.y0, src.fmt.align_y);",
          "old_line_content": "static void draw_osd(struct vo *vo, struct osd_state *osd)",
          "new_line_content": "    src_rc.y0 = MP_ALIGN_DOWN(src_rc.y0, src.fmt.align_y);",
          "content_same": false
        },
        {
          "line": 486,
          "old_api": null,
          "new_api": "p_image_crop_rc",
          "old_text": null,
          "new_text": "p_image_crop_rc(&src, src_rc);",
          "old_line_content": "{",
          "new_line_content": "    mp_image_crop_rc(&src, src_rc);",
          "content_same": false
        },
        {
          "line": 618,
          "old_api": null,
          "new_api": "et_screenshot",
          "old_text": null,
          "new_text": "et_screenshot(p);",
          "old_line_content": "",
          "new_line_content": "        args->out_image = get_screenshot(p);",
          "content_same": false
        },
        {
          "line": 491,
          "old_api": null,
          "new_api": "p_image_setrefp",
          "old_text": null,
          "new_text": "p_image_setrefp(&p->original_image, mpi);",
          "old_line_content": "",
          "new_line_content": "    mp_image_setrefp(&p->original_image, mpi);",
          "content_same": false
        },
        {
          "line": 492,
          "old_api": null,
          "new_api": "uffer_finalise_back",
          "old_text": null,
          "new_text": "uffer_finalise_back(p);",
          "old_line_content": "static void flip_page(struct vo *vo)",
          "new_line_content": "    buffer_finalise_back(p);",
          "content_same": false
        },
        {
          "line": 623,
          "old_api": null,
          "new_api": "o_wayland_control",
          "old_text": null,
          "new_text": "o_wayland_control(vo, &events, request, data);",
          "old_line_content": "const struct vo_driver video_out_wayland = {",
          "new_line_content": "    int r = vo_wayland_control(vo, &events, request, data);",
          "content_same": false
        },
        {
          "line": 498,
          "old_api": null,
          "new_api": "uffer_get_mp_image",
          "old_text": null,
          "new_text": "uffer_get_mp_image(p, p->back_buffer);",
          "old_line_content": "    if (!p->redraw_callback)",
          "new_line_content": "    struct mp_image img = buffer_get_mp_image(p, p->back_buffer);",
          "content_same": false
        },
        {
          "line": 627,
          "old_api": null,
          "new_api": "esize",
          "old_text": null,
          "new_text": "esize(p);",
          "old_line_content": "        \"Alexander Preisinger <alexander.preisinger@gmail.com>\",",
          "new_line_content": "        resize(p);",
          "content_same": false
        },
        {
          "line": 506,
          "old_api": null,
          "new_api": "uffer_swap",
          "old_text": null,
          "new_text": "uffer_swap(p);",
          "old_line_content": "            return VFCAP_CSP_SUPPORTED_BY_HW | VFCAP_CSP_SUPPORTED;",
          "new_line_content": "    buffer_swap(p);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 640,
          "old_api": "PT_FLAG",
          "new_api": null,
          "old_text": "PT_FLAG(\"alpha\", enable_alpha, 0),",
          "new_text": null,
          "old_line_content": "        OPT_FLAG(\"alpha\", enable_alpha, 0),",
          "new_line_content": "    .priv_size = sizeof(struct priv),",
          "content_same": false
        },
        {
          "line": 641,
          "old_api": "PT_FLAG",
          "new_api": null,
          "old_text": "PT_FLAG(\"default-format\", use_default, 0),",
          "new_text": null,
          "old_line_content": "        OPT_FLAG(\"default-format\", use_default, 0),",
          "new_line_content": "    .preinit = preinit,",
          "content_same": false
        },
        {
          "line": 397,
          "old_api": "l_surface_attach",
          "new_api": null,
          "old_text": "l_surface_attach(wl->window.surface, p->front_buffer->wlbuf, x, y);",
          "new_text": null,
          "old_line_content": "    wl_surface_attach(wl->window.surface, p->front_buffer->wlbuf, x, y);",
          "new_line_content": "    // the compositor to optimize the drawing of the window",
          "content_same": false
        },
        {
          "line": 398,
          "old_api": "l_surface_damage",
          "new_api": null,
          "old_text": "l_surface_damage(wl->window.surface, 0, 0, p->dst_w, p->dst_h);",
          "new_text": null,
          "old_line_content": "    wl_surface_damage(wl->window.surface, 0, 0, p->dst_w, p->dst_h);",
          "new_line_content": "    if (!p->enable_alpha) {",
          "content_same": false
        },
        {
          "line": 399,
          "old_api": "l_surface_commit",
          "new_api": null,
          "old_text": "l_surface_commit(wl->window.surface);",
          "new_text": null,
          "old_line_content": "    wl_surface_commit(wl->window.surface);",
          "new_line_content": "        struct wl_region *opaque =",
          "content_same": false
        },
        {
          "line": 542,
          "old_api": "p_imgfmt_get_desc",
          "new_api": null,
          "old_text": "p_imgfmt_get_desc(p->pref_format->mp_fmt).",
          "new_text": null,
          "old_line_content": "    p->bytes_per_pixel = mp_imgfmt_get_desc(p->pref_format->mp_fmt).bytes[0];",
          "new_line_content": "        if (fmttable[i].hw_support)",
          "content_same": false
        },
        {
          "line": 543,
          "old_api": "P_VERBOSE",
          "new_api": null,
          "old_text": "P_VERBOSE(vo, \"bytes per pixel: %d\\n\", p->bytes_per_pixel);",
          "new_text": null,
          "old_line_content": "    MP_VERBOSE(vo, \"bytes per pixel: %d\\n\", p->bytes_per_pixel);",
          "new_line_content": "            p->pref_format = &fmttable[i];",
          "content_same": false
        },
        {
          "line": 545,
          "old_api": "einit_shm_buffers",
          "new_api": null,
          "old_text": "einit_shm_buffers(p, p->width, p->height))",
          "new_text": null,
          "old_line_content": "    if (!reinit_shm_buffers(p, p->width, p->height)) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 546,
          "old_api": "P_ERR",
          "new_api": null,
          "old_text": "P_ERR(vo, \"failed to initialise buffers\\n\");",
          "new_text": null,
          "old_line_content": "        MP_ERR(vo, \"failed to initialise buffers\\n\");",
          "new_line_content": "    if (p->use_default)",
          "content_same": false
        },
        {
          "line": 550,
          "old_api": "o_wayland_config",
          "new_api": null,
          "old_text": "o_wayland_config(vo, vo->dwidth, vo->dheight, flags);",
          "new_text": null,
          "old_line_content": "    vo_wayland_config(vo, vo->dwidth, vo->dheight, flags);",
          "new_line_content": "        p->pref_format = &fmttable[DEFAULT_ALPHA_FORMAT_ENTRY];",
          "content_same": false
        },
        {
          "line": 425,
          "old_api": "uffer_get_front",
          "new_api": null,
          "old_text": "uffer_get_front(p);",
          "new_text": null,
          "old_line_content": "    struct buffer *buf = buffer_get_front(p);",
          "new_line_content": "static const struct wl_buffer_listener buffer_listener = {",
          "content_same": false
        },
        {
          "line": 427,
          "old_api": "l_surface_attach",
          "new_api": null,
          "old_text": "l_surface_attach(wl->window.surface, buf->wlbuf, 0, 0);",
          "new_text": null,
          "old_line_content": "    wl_surface_attach(wl->window.surface, buf->wlbuf, 0, 0);",
          "new_line_content": "};",
          "content_same": false
        },
        {
          "line": 428,
          "old_api": "l_surface_damage",
          "new_api": null,
          "old_text": "l_surface_damage(wl->window.surface, 0, 0, p->dst_w, p->dst_h);",
          "new_text": null,
          "old_line_content": "    wl_surface_damage(wl->window.surface, 0, 0, p->dst_w, p->dst_h);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 559,
          "old_api": "estroy_shm_buffer",
          "new_api": null,
          "old_text": "estroy_shm_buffer(&p->buffers[i]);",
          "new_text": null,
          "old_line_content": "        destroy_shm_buffer(&p->buffers[i]);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 431,
          "old_api": "l_callback_destroy",
          "new_api": null,
          "old_text": "l_callback_destroy(callback);",
          "new_text": null,
          "old_line_content": "        wl_callback_destroy(callback);",
          "new_line_content": "                                uint32_t time)",
          "content_same": false
        },
        {
          "line": 561,
          "old_api": "o_wayland_uninit",
          "new_api": null,
          "old_text": "o_wayland_uninit(vo);",
          "new_text": null,
          "old_line_content": "    vo_wayland_uninit(vo);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 433,
          "old_api": "l_surface_frame",
          "new_api": null,
          "old_text": "l_surface_frame(wl->window.surface);",
          "new_text": null,
          "old_line_content": "    p->redraw_callback = wl_surface_frame(wl->window.surface);",
          "new_line_content": "    struct priv *p = data;",
          "content_same": false
        },
        {
          "line": 434,
          "old_api": "l_callback_add_listener",
          "new_api": null,
          "old_text": "l_callback_add_listener(p->redraw_callback, &frame_listener, p);",
          "new_text": null,
          "old_line_content": "    wl_callback_add_listener(p->redraw_callback, &frame_listener, p);",
          "new_line_content": "    struct vo_wayland_state *wl = p->wl;",
          "content_same": false
        },
        {
          "line": 436,
          "old_api": "uffer_finalise_front",
          "new_api": null,
          "old_text": "uffer_finalise_front(p);",
          "new_text": null,
          "old_line_content": "    buffer_finalise_front(p);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 568,
          "old_api": "o_wayland_init",
          "new_api": null,
          "old_text": "o_wayland_init(vo))",
          "new_text": null,
          "old_line_content": "    if (!vo_wayland_init(vo)) {",
          "new_line_content": "    for (int i = 0; i < MAX_BUFFERS; ++i)",
          "content_same": false
        },
        {
          "line": 575,
          "old_api": "p_sws_alloc",
          "new_api": null,
          "old_text": "p_sws_alloc(vo);",
          "new_text": null,
          "old_line_content": "    p->sws = mp_sws_alloc(vo);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 450,
          "old_api": "P_INFO",
          "new_api": null,
          "old_text": "P_INFO(p->vo, \"format %s supported by hw\\n\",\n                    mp_imgfmt_to_name(fmttable[i].mp_fmt));",
          "new_text": null,
          "old_line_content": "            MP_INFO(p->vo, \"format %s supported by hw\\n\",",
          "new_line_content": "    frame_handle_redraw",
          "content_same": false
        },
        {
          "line": 451,
          "old_api": "p_imgfmt_to_name",
          "new_api": null,
          "old_text": "p_imgfmt_to_name(fmttable[i].mp_fmt))",
          "new_text": null,
          "old_line_content": "                    mp_imgfmt_to_name(fmttable[i].mp_fmt));",
          "new_line_content": "};",
          "content_same": false
        },
        {
          "line": 580,
          "old_api": "l_shm_add_listener",
          "new_api": null,
          "old_text": "l_shm_add_listener(p->wl->display.shm, &shm_listener, p);",
          "new_text": null,
          "old_line_content": "    wl_shm_add_listener(p->wl->display.shm, &shm_listener, p);",
          "new_line_content": "        return -1;",
          "content_same": false
        },
        {
          "line": 581,
          "old_api": "l_display_dispatch",
          "new_api": null,
          "old_text": "l_display_dispatch(p->wl->display.display);",
          "new_text": null,
          "old_line_content": "    wl_display_dispatch(p->wl->display.display);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 592,
          "old_api": "esize",
          "new_api": null,
          "old_text": "esize(p);",
          "new_text": null,
          "old_line_content": "        resize(p);",
          "new_line_content": "    return 0;",
          "content_same": false
        },
        {
          "line": 595,
          "old_api": "edraw_frame",
          "new_api": null,
          "old_text": "edraw_frame(p);",
          "new_text": null,
          "old_line_content": "        return redraw_frame(p);",
          "new_line_content": "static int control(struct vo *vo, uint32_t request, void *data)",
          "content_same": false
        },
        {
          "line": 467,
          "old_api": "uffer_get_back",
          "new_api": null,
          "old_text": "uffer_get_back(p);",
          "new_text": null,
          "old_line_content": "    struct buffer *buf = buffer_get_back(p);",
          "new_line_content": "static const struct wl_shm_listener shm_listener = {",
          "content_same": false
        },
        {
          "line": 601,
          "old_api": "v_clipf",
          "new_api": null,
          "old_text": "v_clipf(c[0], dst->x0, dst->x1) ",
          "new_text": null,
          "old_line_content": "        c[0] = av_clipf(c[0], dst->x0, dst->x1) - dst->x0;",
          "new_line_content": "    case VOCTRL_SET_PANSCAN:",
          "content_same": false
        },
        {
          "line": 474,
          "old_api": "P_ALIGN_DOWN",
          "new_api": null,
          "old_text": "P_ALIGN_DOWN(src_rc.x0, src.fmt.align_x);",
          "new_text": null,
          "old_line_content": "    src_rc.x0 = MP_ALIGN_DOWN(src_rc.x0, src.fmt.align_x);",
          "new_line_content": "static void draw_image(struct vo *vo, mp_image_t *mpi)",
          "content_same": false
        },
        {
          "line": 475,
          "old_api": "P_ALIGN_DOWN",
          "new_api": null,
          "old_text": "P_ALIGN_DOWN(src_rc.y0, src.fmt.align_y);",
          "new_text": null,
          "old_line_content": "    src_rc.y0 = MP_ALIGN_DOWN(src_rc.y0, src.fmt.align_y);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 476,
          "old_api": "p_image_crop_rc",
          "new_api": null,
          "old_text": "p_image_crop_rc(&src, src_rc);",
          "new_text": null,
          "old_line_content": "    mp_image_crop_rc(&src, src_rc);",
          "new_line_content": "    struct priv *p = vo->priv;",
          "content_same": false
        },
        {
          "line": 478,
          "old_api": "uffer_get_mp_image",
          "new_api": null,
          "old_text": "uffer_get_mp_image(p, buf);",
          "new_text": null,
          "old_line_content": "    struct mp_image img = buffer_get_mp_image(p, buf);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 479,
          "old_api": "p_sws_scale",
          "new_api": null,
          "old_text": "p_sws_scale(p->sws, &img, &src);",
          "new_text": null,
          "old_line_content": "    mp_sws_scale(p->sws, &img, &src);",
          "new_line_content": "    if (!buf)",
          "content_same": false
        },
        {
          "line": 608,
          "old_api": "et_screenshot",
          "new_api": null,
          "old_text": "et_screenshot(p);",
          "new_text": null,
          "old_line_content": "        args->out_image = get_screenshot(p);",
          "new_line_content": "        // OSD is rendered into the scaled image",
          "content_same": false
        },
        {
          "line": 481,
          "old_api": "p_image_setrefp",
          "new_api": null,
          "old_text": "p_image_setrefp(&p->original_image, mpi);",
          "new_text": null,
          "old_line_content": "    mp_image_setrefp(&p->original_image, mpi);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 482,
          "old_api": "uffer_finalise_back",
          "new_api": null,
          "old_text": "uffer_finalise_back(p);",
          "new_text": null,
          "old_line_content": "    buffer_finalise_back(p);",
          "new_line_content": "    struct mp_image src = *mpi;",
          "content_same": false
        },
        {
          "line": 613,
          "old_api": "o_wayland_control",
          "new_api": null,
          "old_text": "o_wayland_control(vo, &events, request, data);",
          "new_text": null,
          "old_line_content": "    int r = vo_wayland_control(vo, &events, request, data);",
          "new_line_content": "        return VO_TRUE;",
          "content_same": false
        },
        {
          "line": 617,
          "old_api": "esize",
          "new_api": null,
          "old_text": "esize(p);",
          "new_text": null,
          "old_line_content": "        resize(p);",
          "new_line_content": "        struct voctrl_screenshot_args *args = data;",
          "content_same": false
        },
        {
          "line": 496,
          "old_api": "uffer_swap",
          "new_api": null,
          "old_text": "uffer_swap(p);",
          "new_text": null,
          "old_line_content": "    buffer_swap(p);",
          "new_line_content": "{",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 6,
      "total_additions": 44,
      "total_deletions": 40,
      "total_api_changes": 90
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 10,
        "api_related_lines": 90,
        "non_api_lines": 3,
        "non_api_line_numbers": [
          404,
          396,
          405
        ]
      }
    },
    "api_calls_before": 89,
    "api_calls_after": 93,
    "diff_info": {
      "added_lines": 10,
      "removed_lines": 0,
      "total_diff_lines": 22
    }
  }
}