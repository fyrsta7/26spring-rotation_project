{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/2485b899c303f60a837baaaf704a3c8eb631ed9b",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/2485b899c303f60a837baaaf704a3c8eb631ed9b/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/2485b899c303f60a837baaaf704a3c8eb631ed9b/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/2485b899c303f60a837baaaf704a3c8eb631ed9b/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 2216,
          "old_api": "recompute_buffers",
          "new_api": "PTS_OR_DEF",
          "old_text": "recompute_buffers(ds)",
          "new_text": "PTS_OR_DEF(ds->reader_head->pts, ds->reader_head->dts)",
          "old_line_content": "        recompute_buffers(ds);",
          "new_line_content": "            ds->base_ts = PTS_OR_DEF(ds->reader_head->pts, ds->reader_head->dts);",
          "content_same": false
        },
        {
          "line": 2271,
          "old_api": "switch_current_range",
          "new_api": "add_missing_streams",
          "old_text": "switch_current_range(in, range)",
          "new_text": "add_missing_streams(in, range)",
          "old_line_content": "    switch_current_range(in, range);",
          "new_line_content": "    add_missing_streams(in, range);",
          "content_same": false
        },
        {
          "line": 2289,
          "old_api": "MP_VERBOSE",
          "new_api": "pthread_mutex_lock",
          "old_text": "MP_VERBOSE(in, \"queuing seek to %f%s\\n\", seek_pts,\n               in->seeking ? \" (cascade)\" : \"\")",
          "new_text": "pthread_mutex_lock(&in->lock)",
          "old_line_content": "    MP_VERBOSE(in, \"queuing seek to %f%s\\n\", seek_pts,",
          "new_line_content": "    pthread_mutex_lock(&in->lock);",
          "content_same": false
        },
        {
          "line": 2295,
          "old_api": "clear_reader_state",
          "new_api": "MP_ADD_PTS",
          "old_text": "clear_reader_state(in)",
          "new_text": "MP_ADD_PTS(seek_pts, -in->ts_offset)",
          "old_line_content": "    clear_reader_state(in);",
          "new_line_content": "        seek_pts = MP_ADD_PTS(seek_pts, -in->ts_offset);",
          "content_same": false
        },
        {
          "line": 2313,
          "old_api": "pthread_cond_signal",
          "new_api": "execute_seek",
          "old_text": "pthread_cond_signal(&in->wakeup)",
          "new_text": "execute_seek(in)",
          "old_line_content": "    pthread_cond_signal(&in->wakeup);",
          "new_line_content": "        execute_seek(in);",
          "content_same": false
        },
        {
          "line": 2324,
          "old_api": "demux_get_stream",
          "new_api": "demux_get_num_stream",
          "old_text": "demux_get_stream(d, n)",
          "new_text": "demux_get_num_stream(d)",
          "old_line_content": "        struct sh_stream *s = demux_get_stream(d, n);",
          "new_line_content": "    int num = demux_get_num_stream(d);",
          "content_same": false
        },
        {
          "line": 2404,
          "old_api": "pthread_cond_signal",
          "new_api": "MP_ADD_PTS",
          "old_text": "pthread_cond_signal(&in->wakeup)",
          "new_text": "MP_ADD_PTS(ref_pts, -in->ts_offset)",
          "old_line_content": "            pthread_cond_signal(&in->wakeup);",
          "new_line_content": "            initiate_refresh_seek(in, ds, MP_ADD_PTS(ref_pts, -in->ts_offset));",
          "content_same": false
        },
        {
          "line": 2406,
          "old_api": "execute_trackswitch",
          "new_api": "pthread_cond_signal",
          "old_text": "execute_trackswitch(in)",
          "new_text": "pthread_cond_signal(&in->wakeup)",
          "old_line_content": "            execute_trackswitch(in);",
          "new_line_content": "            pthread_cond_signal(&in->wakeup);",
          "content_same": false
        },
        {
          "line": 2429,
          "old_api": "pthread_mutex_unlock",
          "new_api": "pthread_mutex_lock",
          "old_text": "pthread_mutex_unlock(&stream->ds->in->lock)",
          "new_text": "pthread_mutex_lock(&stream->ds->in->lock)",
          "old_line_content": "    pthread_mutex_unlock(&stream->ds->in->lock);",
          "new_line_content": "    pthread_mutex_lock(&stream->ds->in->lock);",
          "content_same": false
        },
        {
          "line": 2444,
          "old_api": "talloc_memdup",
          "new_api": "talloc_strdup",
          "old_text": "talloc_memdup(demuxer->attachments, data, data_size)",
          "new_text": "talloc_strdup(demuxer->attachments, name)",
          "old_line_content": "    att->data = talloc_memdup(demuxer->attachments, data, data_size);",
          "new_line_content": "    att->name = talloc_strdup(demuxer->attachments, name);",
          "content_same": false
        },
        {
          "line": 2494,
          "old_api": "stream_control",
          "new_api": "stream_get_size",
          "old_text": "stream_control(stream, STREAM_CTRL_GET_CACHE_INFO, &stream_cache_info)",
          "new_text": "stream_get_size(stream)",
          "old_line_content": "    stream_control(stream, STREAM_CTRL_GET_CACHE_INFO, &stream_cache_info);",
          "new_line_content": "    int64_t stream_size = stream_get_size(stream);",
          "content_same": false
        },
        {
          "line": 2496,
          "old_api": "pthread_mutex_lock",
          "new_api": "stream_control",
          "old_text": "pthread_mutex_lock(&in->lock)",
          "new_text": "stream_control(stream, STREAM_CTRL_GET_CACHE_INFO, &stream_cache_info)",
          "old_line_content": "    pthread_mutex_lock(&in->lock);",
          "new_line_content": "    stream_control(stream, STREAM_CTRL_GET_CACHE_INFO, &stream_cache_info);",
          "content_same": false
        },
        {
          "line": 2630,
          "old_api": "control",
          "new_api": "MP_VERBOSE",
          "old_text": "demuxer->desc->control(demuxer->in->d_thread, cmd, arg)",
          "new_text": "MP_VERBOSE(demuxer, \"blocking for DEMUXER_CTRL %d\\n\", cmd)",
          "old_line_content": "            r = demuxer->desc->control(demuxer->in->d_thread, cmd, arg);",
          "new_line_content": "            MP_VERBOSE(demuxer, \"blocking for DEMUXER_CTRL %d\\n\", cmd);",
          "content_same": false
        },
        {
          "line": 2644,
          "old_api": "pthread_mutex_unlock",
          "new_api": "pthread_mutex_lock",
          "old_text": "pthread_mutex_unlock(&in->lock)",
          "new_text": "pthread_mutex_lock(&in->lock)",
          "old_line_content": "        pthread_mutex_unlock(&in->lock);",
          "new_line_content": "        pthread_mutex_lock(&in->lock);",
          "content_same": false
        },
        {
          "line": 2655,
          "old_api": "pthread_cond_wait",
          "new_api": "pthread_mutex_lock",
          "old_text": "pthread_cond_wait(&in->wakeup, &in->lock)",
          "new_text": "pthread_mutex_lock(&in->lock)",
          "old_line_content": "            pthread_cond_wait(&in->wakeup, &in->lock);",
          "new_line_content": "        pthread_mutex_lock(&in->lock);",
          "content_same": false
        },
        {
          "line": 2660,
          "old_api": "pthread_cond_wait",
          "new_api": "pthread_cond_signal",
          "old_text": "pthread_cond_wait(&in->wakeup, &in->lock)",
          "new_text": "pthread_cond_signal(&in->wakeup)",
          "old_line_content": "            pthread_cond_wait(&in->wakeup, &in->lock);",
          "new_line_content": "        pthread_cond_signal(&in->wakeup);",
          "content_same": false
        },
        {
          "line": 2663,
          "old_api": "thread_demux_control",
          "new_api": "pthread_mutex_unlock",
          "old_text": "thread_demux_control(&args)",
          "new_text": "pthread_mutex_unlock(&in->lock)",
          "old_line_content": "        thread_demux_control(&args);",
          "new_line_content": "        pthread_mutex_unlock(&in->lock);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 2304,
          "old_api": null,
          "new_api": "try_seek_cache",
          "old_text": null,
          "new_text": "try_seek_cache(in, seek_pts, flags)",
          "old_line_content": "",
          "new_line_content": "    if (!try_seek_cache(in, seek_pts, flags)) {",
          "content_same": false
        },
        {
          "line": 2305,
          "old_api": null,
          "new_api": "switch_to_fresh_cache_range",
          "old_text": null,
          "new_text": "switch_to_fresh_cache_range(in)",
          "old_line_content": "        in->seeking = true;",
          "new_line_content": "        switch_to_fresh_cache_range(in);",
          "content_same": false
        },
        {
          "line": 2688,
          "old_api": null,
          "new_api": "mp_tags_dup",
          "old_text": null,
          "new_text": "mp_tags_dup(new, new[n].metadata)",
          "old_line_content": "    return new;",
          "new_line_content": "        new[n].metadata = mp_tags_dup(new, new[n].metadata);",
          "content_same": false
        },
        {
          "line": 2439,
          "old_api": null,
          "new_api": "talloc_realloc",
          "old_text": null,
          "new_text": "talloc_realloc(demuxer, demuxer->attachments,\n                                              struct demux_attachment,\n                                              demuxer->num_attachments + 32)",
          "old_line_content": "                                              demuxer->num_attachments + 32);",
          "new_line_content": "        demuxer->attachments = talloc_realloc(demuxer, demuxer->attachments,",
          "content_same": false
        },
        {
          "line": 2315,
          "old_api": null,
          "new_api": "pthread_cond_signal",
          "old_text": null,
          "new_text": "pthread_cond_signal(&in->wakeup)",
          "old_line_content": "",
          "new_line_content": "    pthread_cond_signal(&in->wakeup);",
          "content_same": false
        },
        {
          "line": 2316,
          "old_api": null,
          "new_api": "pthread_mutex_unlock",
          "old_text": null,
          "new_text": "pthread_mutex_unlock(&in->lock)",
          "old_line_content": "    return 1;",
          "new_line_content": "    pthread_mutex_unlock(&in->lock);",
          "content_same": false
        },
        {
          "line": 2445,
          "old_api": null,
          "new_api": "talloc_strdup",
          "old_text": null,
          "new_text": "talloc_strdup(demuxer->attachments, type)",
          "old_line_content": "    att->data_size = data_size;",
          "new_line_content": "    att->type = talloc_strdup(demuxer->attachments, type);",
          "content_same": false
        },
        {
          "line": 2446,
          "old_api": null,
          "new_api": "talloc_memdup",
          "old_text": null,
          "new_text": "talloc_memdup(demuxer->attachments, data, data_size)",
          "old_line_content": "",
          "new_line_content": "    att->data = talloc_memdup(demuxer->attachments, data, data_size);",
          "content_same": false
        },
        {
          "line": 2191,
          "old_api": null,
          "new_api": "find_seek_target",
          "old_text": null,
          "new_text": "find_seek_target(queue, pts, flags)",
          "old_line_content": "                    double target_pts = target->kf_seek_pts;",
          "new_line_content": "                struct demux_packet *target = find_seek_target(queue, pts, flags);",
          "content_same": false
        },
        {
          "line": 2575,
          "old_api": null,
          "new_api": "MP_PTS_MAX",
          "old_text": null,
          "new_text": "MP_PTS_MAX(r->ts_reader, ds->base_ts)",
          "old_line_content": "                any_packets |= !!ds->queue->head;",
          "new_line_content": "                r->ts_reader = MP_PTS_MAX(r->ts_reader, ds->base_ts);",
          "content_same": false
        },
        {
          "line": 2576,
          "old_api": null,
          "new_api": "MP_PTS_MAX",
          "old_text": null,
          "new_text": "MP_PTS_MAX(r->ts_end, ds->queue->last_ts)",
          "old_line_content": "            }",
          "new_line_content": "                r->ts_end = MP_PTS_MAX(r->ts_end, ds->queue->last_ts);",
          "content_same": false
        },
        {
          "line": 2195,
          "old_api": null,
          "new_api": "MP_VERBOSE",
          "old_text": null,
          "new_text": "MP_VERBOSE(in, \"adjust seek target %f -> %f\\n\",\n                                   pts, target_pts)",
          "old_line_content": "                        // (We assume the find_seek_target() will return the",
          "new_line_content": "                        MP_VERBOSE(in, \"adjust seek target %f -> %f\\n\",",
          "content_same": false
        },
        {
          "line": 2326,
          "old_api": null,
          "new_api": "demux_get_stream",
          "old_text": null,
          "new_text": "demux_get_stream(d, n)",
          "old_line_content": "            return s;",
          "new_line_content": "        struct sh_stream *s = demux_get_stream(d, n);",
          "content_same": false
        },
        {
          "line": 2582,
          "old_api": null,
          "new_api": "MP_ADD_PTS",
          "old_text": null,
          "new_text": "MP_ADD_PTS(r->ts_reader, in->ts_offset)",
          "old_line_content": "        if (r->ts_reader != MP_NOPTS_VALUE && r->ts_reader <= r->ts_end)",
          "new_line_content": "        r->ts_reader = MP_ADD_PTS(r->ts_reader, in->ts_offset);",
          "content_same": false
        },
        {
          "line": 2583,
          "old_api": null,
          "new_api": "MP_ADD_PTS",
          "old_text": null,
          "new_text": "MP_ADD_PTS(r->ts_end, in->ts_offset)",
          "old_line_content": "            r->ts_duration = r->ts_end - r->ts_reader;",
          "new_line_content": "        r->ts_end = MP_ADD_PTS(r->ts_end, in->ts_offset);",
          "content_same": false
        },
        {
          "line": 2588,
          "old_api": null,
          "new_api": "MPMIN",
          "old_text": null,
          "new_text": "MPMIN(in->num_ranges, MAX_SEEK_RANGES)",
          "old_line_content": "            if (range->seek_start != MP_NOPTS_VALUE) {",
          "new_line_content": "        for (int n = 0; n < MPMIN(in->num_ranges, MAX_SEEK_RANGES); n++) {",
          "content_same": false
        },
        {
          "line": 2169,
          "old_api": null,
          "new_api": "MP_VERBOSE",
          "old_text": null,
          "new_text": "MP_VERBOSE(in, \"...using this range for in-cache seek.\\n\")",
          "old_line_content": "                break;",
          "new_line_content": "                MP_VERBOSE(in, \"...using this range for in-cache seek.\\n\");",
          "content_same": false
        },
        {
          "line": 2466,
          "old_api": null,
          "new_api": "qsort",
          "old_text": null,
          "new_text": "qsort(demuxer->chapters, demuxer->num_chapters,\n          sizeof(struct demux_chapter), chapter_compare)",
          "old_line_content": "}",
          "new_line_content": "    qsort(demuxer->chapters, demuxer->num_chapters,",
          "content_same": false
        },
        {
          "line": 2593,
          "old_api": null,
          "new_api": "MP_ADD_PTS",
          "old_text": null,
          "new_text": "MP_ADD_PTS(range->seek_start, in->ts_offset)",
          "old_line_content": "                    };",
          "new_line_content": "                        .start = MP_ADD_PTS(range->seek_start, in->ts_offset),",
          "content_same": false
        },
        {
          "line": 2212,
          "old_api": null,
          "new_api": "find_seek_target",
          "old_text": null,
          "new_text": "find_seek_target(queue, pts, flags)",
          "old_line_content": "        ds->skip_to_keyframe = !target;",
          "new_line_content": "        struct demux_packet *target = find_seek_target(queue, pts, flags);",
          "content_same": false
        },
        {
          "line": 2594,
          "old_api": null,
          "new_api": "MP_ADD_PTS",
          "old_text": null,
          "new_text": "MP_ADD_PTS(range->seek_end, in->ts_offset)",
          "old_line_content": "            }",
          "new_line_content": "                        .end = MP_ADD_PTS(range->seek_end, in->ts_offset),",
          "content_same": false
        },
        {
          "line": 2218,
          "old_api": null,
          "new_api": "recompute_buffers",
          "old_text": null,
          "new_text": "recompute_buffers(ds)",
          "old_line_content": "",
          "new_line_content": "        recompute_buffers(ds);",
          "content_same": false
        },
        {
          "line": 2476,
          "old_api": null,
          "new_api": "talloc_zero",
          "old_text": null,
          "new_text": "talloc_zero(demuxer, struct mp_tags)",
          "old_line_content": "    };",
          "new_line_content": "        .metadata = talloc_zero(demuxer, struct mp_tags),",
          "content_same": false
        },
        {
          "line": 2221,
          "old_api": null,
          "new_api": "MP_VERBOSE",
          "old_text": null,
          "new_text": "MP_VERBOSE(in, \"seeking stream %d (%s) to \",\n                   n, stream_type_name(ds->type))",
          "old_line_content": "",
          "new_line_content": "        MP_VERBOSE(in, \"seeking stream %d (%s) to \",",
          "content_same": false
        },
        {
          "line": 2222,
          "old_api": null,
          "new_api": "stream_type_name",
          "old_text": null,
          "new_text": "stream_type_name(ds->type)",
          "old_line_content": "        if (target) {",
          "new_line_content": "                   n, stream_type_name(ds->type));",
          "content_same": false
        },
        {
          "line": 2479,
          "old_api": null,
          "new_api": "mp_tags_set_str",
          "old_text": null,
          "new_text": "mp_tags_set_str(new.metadata, \"TITLE\", name)",
          "old_line_content": "    return demuxer->num_chapters - 1;",
          "new_line_content": "    mp_tags_set_str(new.metadata, \"TITLE\", name);",
          "content_same": false
        },
        {
          "line": 2480,
          "old_api": null,
          "new_api": "MP_TARRAY_APPEND",
          "old_text": null,
          "new_text": "MP_TARRAY_APPEND(demuxer, demuxer->chapters, demuxer->num_chapters, new)",
          "old_line_content": "}",
          "new_line_content": "    MP_TARRAY_APPEND(demuxer, demuxer->chapters, demuxer->num_chapters, new);",
          "content_same": false
        },
        {
          "line": 2227,
          "old_api": null,
          "new_api": "MP_VERBOSE",
          "old_text": null,
          "new_text": "MP_VERBOSE(in, \"nothing\\n\")",
          "old_line_content": "    }",
          "new_line_content": "            MP_VERBOSE(in, \"nothing\\n\");",
          "content_same": false
        },
        {
          "line": 2355,
          "old_api": null,
          "new_api": "MP_PTS_MIN",
          "old_text": null,
          "new_text": "MP_PTS_MIN(start_ts, ds->base_ts)",
          "old_line_content": "        // If there were no other streams selected, we can use a normal seek.",
          "new_line_content": "            start_ts = MP_PTS_MIN(start_ts, ds->base_ts);",
          "content_same": false
        },
        {
          "line": 2234,
          "old_api": null,
          "new_api": "switch_current_range",
          "old_text": null,
          "new_text": "switch_current_range(in, range)",
          "old_line_content": "        in->seeking = true;",
          "new_line_content": "        switch_current_range(in, range);",
          "content_same": false
        },
        {
          "line": 2495,
          "old_api": null,
          "new_api": "stream_control",
          "old_text": null,
          "new_text": "stream_control(stream, STREAM_CTRL_GET_METADATA, &stream_metadata)",
          "old_line_content": "",
          "new_line_content": "    stream_control(stream, STREAM_CTRL_GET_METADATA, &stream_metadata);",
          "content_same": false
        },
        {
          "line": 2368,
          "old_api": null,
          "new_api": "MP_VERBOSE",
          "old_text": null,
          "new_text": "MP_VERBOSE(in, \"can't issue refresh seek\\n\")",
          "old_line_content": "        }",
          "new_line_content": "            MP_VERBOSE(in, \"can't issue refresh seek\\n\");",
          "content_same": false
        },
        {
          "line": 2623,
          "old_api": null,
          "new_api": "MP_VERBOSE",
          "old_text": null,
          "new_text": "MP_VERBOSE(demuxer, \"blocking for STREAM_CTRL %d\\n\", c->ctrl)",
          "old_line_content": "        if (c->res != STREAM_UNSUPPORTED)",
          "new_line_content": "            MP_VERBOSE(demuxer, \"blocking for STREAM_CTRL %d\\n\", c->ctrl);",
          "content_same": false
        },
        {
          "line": 2498,
          "old_api": null,
          "new_api": "pthread_mutex_lock",
          "old_text": null,
          "new_text": "pthread_mutex_lock(&in->lock)",
          "old_line_content": "    in->stream_cache_info = stream_cache_info;",
          "new_line_content": "    pthread_mutex_lock(&in->lock);",
          "content_same": false
        },
        {
          "line": 2624,
          "old_api": null,
          "new_api": "stream_control",
          "old_text": null,
          "new_text": "stream_control(demuxer->stream, c->ctrl, c->arg)",
          "old_line_content": "            r = CONTROL_OK;",
          "new_line_content": "        c->res = stream_control(demuxer->stream, c->ctrl, c->arg);",
          "content_same": false
        },
        {
          "line": 2685,
          "old_api": null,
          "new_api": "talloc_array",
          "old_text": null,
          "new_text": "talloc_array(NULL, struct demux_chapter, num)",
          "old_line_content": "        new[n] = c[n];",
          "new_line_content": "    struct demux_chapter *new = talloc_array(NULL, struct demux_chapter, num);",
          "content_same": false
        },
        {
          "line": 2502,
          "old_api": null,
          "new_api": "talloc_free",
          "old_text": null,
          "new_text": "talloc_free(in->stream_metadata)",
          "old_line_content": "        in->d_buffer->events |= DEMUX_EVENT_METADATA;",
          "new_line_content": "        talloc_free(in->stream_metadata);",
          "content_same": false
        },
        {
          "line": 2503,
          "old_api": null,
          "new_api": "talloc_steal",
          "old_text": null,
          "new_text": "talloc_steal(in, stream_metadata)",
          "old_line_content": "    }",
          "new_line_content": "        in->stream_metadata = talloc_steal(in, stream_metadata);",
          "content_same": false
        },
        {
          "line": 2632,
          "old_api": null,
          "new_api": "control",
          "old_text": null,
          "new_text": "demuxer->desc->control(demuxer->in->d_thread, cmd, arg)",
          "old_line_content": "",
          "new_line_content": "            r = demuxer->desc->control(demuxer->in->d_thread, cmd, arg);",
          "content_same": false
        },
        {
          "line": 2250,
          "old_api": null,
          "new_api": "MP_VERBOSE",
          "old_text": null,
          "new_text": "MP_VERBOSE(in, \"resuming demuxer to end of cached range\\n\")",
          "old_line_content": "",
          "new_line_content": "        MP_VERBOSE(in, \"resuming demuxer to end of cached range\\n\");",
          "content_same": false
        },
        {
          "line": 2506,
          "old_api": null,
          "new_api": "pthread_mutex_unlock",
          "old_text": null,
          "new_text": "pthread_mutex_unlock(&in->lock)",
          "old_line_content": "",
          "new_line_content": "    pthread_mutex_unlock(&in->lock);",
          "content_same": false
        },
        {
          "line": 2383,
          "old_api": null,
          "new_api": "MP_VERBOSE",
          "old_text": null,
          "new_text": "MP_VERBOSE(in, \"refresh seek to %f\\n\", start_ts)",
          "old_line_content": "    in->seek_flags = SEEK_HR;",
          "new_line_content": "    MP_VERBOSE(in, \"refresh seek to %f\\n\", start_ts);",
          "content_same": false
        },
        {
          "line": 2641,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(demuxer == in->d_user)",
          "old_line_content": "    if (in->threading) {",
          "new_line_content": "    assert(demuxer == in->d_user);",
          "content_same": false
        },
        {
          "line": 2515,
          "old_api": null,
          "new_api": "pthread_cond_signal",
          "old_text": null,
          "new_text": "pthread_cond_signal(&in->wakeup)",
          "old_line_content": "",
          "new_line_content": "        pthread_cond_signal(&in->wakeup);",
          "content_same": false
        },
        {
          "line": 2261,
          "old_api": null,
          "new_api": "clear_cached_range",
          "old_text": null,
          "new_text": "clear_cached_range(in, in->current_range)",
          "old_line_content": "    }",
          "new_line_content": "        clear_cached_range(in, in->current_range);",
          "content_same": false
        },
        {
          "line": 2645,
          "old_api": null,
          "new_api": "cached_demux_control",
          "old_text": null,
          "new_text": "cached_demux_control(in, cmd, arg)",
          "old_line_content": "        if (cr != CONTROL_UNKNOWN)",
          "new_line_content": "        int cr = cached_demux_control(in, cmd, arg);",
          "content_same": false
        },
        {
          "line": 2646,
          "old_api": null,
          "new_api": "pthread_mutex_unlock",
          "old_text": null,
          "new_text": "pthread_mutex_unlock(&in->lock)",
          "old_line_content": "            return cr;",
          "new_line_content": "        pthread_mutex_unlock(&in->lock);",
          "content_same": false
        },
        {
          "line": 2265,
          "old_api": null,
          "new_api": "talloc_ptrtype",
          "old_text": null,
          "new_text": "talloc_ptrtype(in, range)",
          "old_line_content": "        .seek_start = MP_NOPTS_VALUE,",
          "new_line_content": "    struct demux_cached_range *range = talloc_ptrtype(in, range);",
          "content_same": false
        },
        {
          "line": 2397,
          "old_api": null,
          "new_api": "pthread_mutex_lock",
          "old_text": null,
          "new_text": "pthread_mutex_lock(&in->lock)",
          "old_line_content": "    if (ds->selected != selected) {",
          "new_line_content": "    pthread_mutex_lock(&in->lock);",
          "content_same": false
        },
        {
          "line": 2270,
          "old_api": null,
          "new_api": "MP_TARRAY_APPEND",
          "old_text": null,
          "new_text": "MP_TARRAY_APPEND(in, in->ranges, in->num_ranges, range)",
          "old_line_content": "",
          "new_line_content": "    MP_TARRAY_APPEND(in, in->ranges, in->num_ranges, range);",
          "content_same": false
        },
        {
          "line": 2654,
          "old_api": null,
          "new_api": "MP_VERBOSE",
          "old_text": null,
          "new_text": "MP_VERBOSE(in, \"blocking on demuxer thread\\n\")",
          "old_line_content": "        while (in->run_fn)",
          "new_line_content": "        MP_VERBOSE(in, \"blocking on demuxer thread\\n\");",
          "content_same": false
        },
        {
          "line": 2273,
          "old_api": null,
          "new_api": "switch_current_range",
          "old_text": null,
          "new_text": "switch_current_range(in, range)",
          "old_line_content": "",
          "new_line_content": "    switch_current_range(in, range);",
          "content_same": false
        },
        {
          "line": 2401,
          "old_api": null,
          "new_api": "update_stream_selection_state",
          "old_text": null,
          "new_text": "update_stream_selection_state(in, ds)",
          "old_line_content": "        if (ds->selected && !in->initial_state)",
          "new_line_content": "        update_stream_selection_state(in, ds);",
          "content_same": false
        },
        {
          "line": 2657,
          "old_api": null,
          "new_api": "pthread_cond_wait",
          "old_text": null,
          "new_text": "pthread_cond_wait(&in->wakeup, &in->lock)",
          "old_line_content": "        in->run_fn_arg = &args;",
          "new_line_content": "            pthread_cond_wait(&in->wakeup, &in->lock);",
          "content_same": false
        },
        {
          "line": 2532,
          "old_api": null,
          "new_api": "talloc_strdup",
          "old_text": null,
          "new_text": "talloc_strdup(NULL, in->stream_base_filename)",
          "old_line_content": "    }",
          "new_line_content": "        *(char **)arg = talloc_strdup(NULL, in->stream_base_filename);",
          "content_same": false
        },
        {
          "line": 2662,
          "old_api": null,
          "new_api": "pthread_cond_wait",
          "old_text": null,
          "new_text": "pthread_cond_wait(&in->wakeup, &in->lock)",
          "old_line_content": "    } else {",
          "new_line_content": "            pthread_cond_wait(&in->wakeup, &in->lock);",
          "content_same": false
        },
        {
          "line": 2279,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(demuxer == in->d_user)",
          "old_line_content": "    if (!demuxer->seekable) {",
          "new_line_content": "    assert(demuxer == in->d_user);",
          "content_same": false
        },
        {
          "line": 2408,
          "old_api": null,
          "new_api": "execute_trackswitch",
          "old_text": null,
          "new_text": "execute_trackswitch(in)",
          "old_line_content": "    }",
          "new_line_content": "            execute_trackswitch(in);",
          "content_same": false
        },
        {
          "line": 2665,
          "old_api": null,
          "new_api": "thread_demux_control",
          "old_text": null,
          "new_text": "thread_demux_control(&args)",
          "old_line_content": "",
          "new_line_content": "        thread_demux_control(&args);",
          "content_same": false
        },
        {
          "line": 2282,
          "old_api": null,
          "new_api": "MP_WARN",
          "old_text": null,
          "new_text": "MP_WARN(demuxer, \"Cannot seek in this file.\\n\")",
          "old_line_content": "    }",
          "new_line_content": "        MP_WARN(demuxer, \"Cannot seek in this file.\\n\");",
          "content_same": false
        },
        {
          "line": 2411,
          "old_api": null,
          "new_api": "pthread_mutex_unlock",
          "old_text": null,
          "new_text": "pthread_mutex_unlock(&in->lock)",
          "old_line_content": "",
          "new_line_content": "    pthread_mutex_unlock(&in->lock);",
          "content_same": false
        },
        {
          "line": 2416,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(!demuxer->in->threading)",
          "old_line_content": "}",
          "new_line_content": "    assert(!demuxer->in->threading); // laziness",
          "content_same": false
        },
        {
          "line": 2544,
          "old_api": null,
          "new_api": "cached_stream_control",
          "old_text": null,
          "new_text": "cached_stream_control(in, c->ctrl, c->arg)",
          "old_line_content": "            break;",
          "new_line_content": "        int r = cached_stream_control(in, c->ctrl, c->arg);",
          "content_same": false
        },
        {
          "line": 2674,
          "old_api": null,
          "new_api": "demux_control",
          "old_text": null,
          "new_text": "demux_control(demuxer, DEMUXER_CTRL_STREAM_CTRL, &c)",
          "old_line_content": "}",
          "new_line_content": "    demux_control(demuxer, DEMUXER_CTRL_STREAM_CTRL, &c);",
          "content_same": false
        },
        {
          "line": 2291,
          "old_api": null,
          "new_api": "MP_VERBOSE",
          "old_text": null,
          "new_text": "MP_VERBOSE(in, \"queuing seek to %f%s\\n\", seek_pts,\n               in->seeking ? \" (cascade)\" : \"\")",
          "old_line_content": "",
          "new_line_content": "    MP_VERBOSE(in, \"queuing seek to %f%s\\n\", seek_pts,",
          "content_same": false
        },
        {
          "line": 2165,
          "old_api": null,
          "new_api": "MP_VERBOSE",
          "old_text": null,
          "new_text": "MP_VERBOSE(in, \"cached range %d: %f <-> %f\\n\",\n                       n, r->seek_start, r->seek_end)",
          "old_line_content": "",
          "new_line_content": "            MP_VERBOSE(in, \"cached range %d: %f <-> %f\\n\",",
          "content_same": false
        },
        {
          "line": 2680,
          "old_api": null,
          "new_api": "mp_cancel_test",
          "old_text": null,
          "new_text": "mp_cancel_test(demuxer->stream->cancel)",
          "old_line_content": "",
          "new_line_content": "    return mp_cancel_test(demuxer->stream->cancel);",
          "content_same": false
        },
        {
          "line": 2297,
          "old_api": null,
          "new_api": "clear_reader_state",
          "old_text": null,
          "new_text": "clear_reader_state(in)",
          "old_line_content": "    in->eof = false;",
          "new_line_content": "    clear_reader_state(in);",
          "content_same": false
        },
        {
          "line": 2557,
          "old_api": null,
          "new_api": "MPMAX",
          "old_text": null,
          "new_text": "MPMAX(0, rates[ds->type])",
          "old_line_content": "        return CONTROL_OK;",
          "new_line_content": "                rates[ds->type] = MPMAX(0, rates[ds->type]) + ds->bitrate;",
          "content_same": false
        },
        {
          "line": 2431,
          "old_api": null,
          "new_api": "pthread_mutex_unlock",
          "old_text": null,
          "new_text": "pthread_mutex_unlock(&stream->ds->in->lock)",
          "old_line_content": "}",
          "new_line_content": "    pthread_mutex_unlock(&stream->ds->in->lock);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 2437,
          "old_api": "talloc_realloc",
          "new_api": null,
          "old_text": "talloc_realloc(demuxer, demuxer->attachments,\n                                              struct demux_attachment,\n                                              demuxer->num_attachments + 32)",
          "new_text": null,
          "old_line_content": "        demuxer->attachments = talloc_realloc(demuxer, demuxer->attachments,",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 2311,
          "old_api": "execute_seek",
          "new_api": null,
          "old_text": "execute_seek(in)",
          "new_text": null,
          "old_line_content": "        execute_seek(in);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2314,
          "old_api": "pthread_mutex_unlock",
          "new_api": null,
          "old_text": "pthread_mutex_unlock(&in->lock)",
          "new_text": null,
          "old_line_content": "    pthread_mutex_unlock(&in->lock);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2442,
          "old_api": "talloc_strdup",
          "new_api": null,
          "old_text": "talloc_strdup(demuxer->attachments, name)",
          "new_text": null,
          "old_line_content": "    att->name = talloc_strdup(demuxer->attachments, name);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2443,
          "old_api": "talloc_strdup",
          "new_api": null,
          "old_text": "talloc_strdup(demuxer->attachments, type)",
          "new_text": null,
          "old_line_content": "    att->type = talloc_strdup(demuxer->attachments, type);",
          "new_line_content": "    struct demux_attachment *att = &demuxer->attachments[demuxer->num_attachments];",
          "content_same": false
        },
        {
          "line": 2189,
          "old_api": "find_seek_target",
          "new_api": null,
          "old_text": "find_seek_target(queue, pts, flags)",
          "new_text": null,
          "old_line_content": "                struct demux_packet *target = find_seek_target(queue, pts, flags);",
          "new_line_content": "            struct demux_queue *queue = range->streams[n];",
          "content_same": false
        },
        {
          "line": 2573,
          "old_api": "MP_PTS_MAX",
          "new_api": null,
          "old_text": "MP_PTS_MAX(r->ts_reader, ds->base_ts)",
          "new_text": null,
          "old_line_content": "                r->ts_reader = MP_PTS_MAX(r->ts_reader, ds->base_ts);",
          "new_line_content": "            {",
          "content_same": false
        },
        {
          "line": 2574,
          "old_api": "MP_PTS_MAX",
          "new_api": null,
          "old_text": "MP_PTS_MAX(r->ts_end, ds->queue->last_ts)",
          "new_text": null,
          "old_line_content": "                r->ts_end = MP_PTS_MAX(r->ts_end, ds->queue->last_ts);",
          "new_line_content": "                r->underrun |= !ds->reader_head && !ds->eof;",
          "content_same": false
        },
        {
          "line": 2193,
          "old_api": "MP_VERBOSE",
          "new_api": null,
          "old_text": "MP_VERBOSE(in, \"adjust seek target %f -> %f\\n\",\n                                   pts, target_pts)",
          "new_text": null,
          "old_line_content": "                        MP_VERBOSE(in, \"adjust seek target %f -> %f\\n\",",
          "new_line_content": "                    double target_pts = target->kf_seek_pts;",
          "content_same": false
        },
        {
          "line": 2322,
          "old_api": "demux_get_num_stream",
          "new_api": null,
          "old_text": "demux_get_num_stream(d)",
          "new_text": null,
          "old_line_content": "    int num = demux_get_num_stream(d);",
          "new_line_content": "                                               enum stream_type t, int id)",
          "content_same": false
        },
        {
          "line": 2580,
          "old_api": "MP_ADD_PTS",
          "new_api": null,
          "old_text": "MP_ADD_PTS(r->ts_reader, in->ts_offset)",
          "new_text": null,
          "old_line_content": "        r->ts_reader = MP_ADD_PTS(r->ts_reader, in->ts_offset);",
          "new_line_content": "        r->idle = (in->idle && !r->underrun) || r->eof;",
          "content_same": false
        },
        {
          "line": 2581,
          "old_api": "MP_ADD_PTS",
          "new_api": null,
          "old_text": "MP_ADD_PTS(r->ts_end, in->ts_offset)",
          "new_text": null,
          "old_line_content": "        r->ts_end = MP_ADD_PTS(r->ts_end, in->ts_offset);",
          "new_line_content": "        r->underrun &= !r->idle;",
          "content_same": false
        },
        {
          "line": 2586,
          "old_api": "MPMIN",
          "new_api": null,
          "old_text": "MPMIN(in->num_ranges, MAX_SEEK_RANGES)",
          "new_text": null,
          "old_line_content": "        for (int n = 0; n < MPMIN(in->num_ranges, MAX_SEEK_RANGES); n++) {",
          "new_line_content": "        if (in->seeking || !any_packets)",
          "content_same": false
        },
        {
          "line": 2591,
          "old_api": "MP_ADD_PTS",
          "new_api": null,
          "old_text": "MP_ADD_PTS(range->seek_start, in->ts_offset)",
          "new_text": null,
          "old_line_content": "                        .start = MP_ADD_PTS(range->seek_start, in->ts_offset),",
          "new_line_content": "                r->seek_ranges[r->num_seek_ranges++] =",
          "content_same": false
        },
        {
          "line": 2464,
          "old_api": "qsort",
          "new_api": null,
          "old_text": "qsort(demuxer->chapters, demuxer->num_chapters,\n          sizeof(struct demux_chapter), chapter_compare)",
          "new_text": null,
          "old_line_content": "    qsort(demuxer->chapters, demuxer->num_chapters,",
          "new_line_content": "static void demuxer_sort_chapters(demuxer_t *demuxer)",
          "content_same": false
        },
        {
          "line": 2592,
          "old_api": "MP_ADD_PTS",
          "new_api": null,
          "old_text": "MP_ADD_PTS(range->seek_end, in->ts_offset)",
          "new_text": null,
          "old_line_content": "                        .end = MP_ADD_PTS(range->seek_end, in->ts_offset),",
          "new_line_content": "                    (struct demux_seek_range){",
          "content_same": false
        },
        {
          "line": 2210,
          "old_api": "find_seek_target",
          "new_api": null,
          "old_text": "find_seek_target(queue, pts, flags)",
          "new_text": null,
          "old_line_content": "        struct demux_packet *target = find_seek_target(queue, pts, flags);",
          "new_line_content": "        struct demux_queue *queue = range->streams[n];",
          "content_same": false
        },
        {
          "line": 2214,
          "old_api": "PTS_OR_DEF",
          "new_api": null,
          "old_text": "PTS_OR_DEF(ds->reader_head->pts, ds->reader_head->dts)",
          "new_text": null,
          "old_line_content": "            ds->base_ts = PTS_OR_DEF(ds->reader_head->pts, ds->reader_head->dts);",
          "new_line_content": "        ds->skip_to_keyframe = !target;",
          "content_same": false
        },
        {
          "line": 2474,
          "old_api": "talloc_zero",
          "new_api": null,
          "old_text": "talloc_zero(demuxer, struct mp_tags)",
          "new_text": null,
          "old_line_content": "        .metadata = talloc_zero(demuxer, struct mp_tags),",
          "new_line_content": "        .original_index = demuxer->num_chapters,",
          "content_same": false
        },
        {
          "line": 2219,
          "old_api": "MP_VERBOSE",
          "new_api": null,
          "old_text": "MP_VERBOSE(in, \"seeking stream %d (%s) to \",\n                   n, stream_type_name(ds->type))",
          "new_text": null,
          "old_line_content": "        MP_VERBOSE(in, \"seeking stream %d (%s) to \",",
          "new_line_content": "        in->fw_bytes += ds->fw_bytes;",
          "content_same": false
        },
        {
          "line": 2220,
          "old_api": "stream_type_name",
          "new_api": null,
          "old_text": "stream_type_name(ds->type)",
          "new_text": null,
          "old_line_content": "                   n, stream_type_name(ds->type));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2477,
          "old_api": "mp_tags_set_str",
          "new_api": null,
          "old_text": "mp_tags_set_str(new.metadata, \"TITLE\", name)",
          "new_text": null,
          "old_line_content": "    mp_tags_set_str(new.metadata, \"TITLE\", name);",
          "new_line_content": "        .demuxer_id = demuxer_id,",
          "content_same": false
        },
        {
          "line": 2478,
          "old_api": "MP_TARRAY_APPEND",
          "new_api": null,
          "old_text": "MP_TARRAY_APPEND(demuxer, demuxer->chapters, demuxer->num_chapters, new)",
          "new_text": null,
          "old_line_content": "    MP_TARRAY_APPEND(demuxer, demuxer->chapters, demuxer->num_chapters, new);",
          "new_line_content": "    };",
          "content_same": false
        },
        {
          "line": 2223,
          "old_api": "MP_VERBOSE",
          "new_api": null,
          "old_text": "MP_VERBOSE(in, \"packet %f/%f\\n\", target->pts, target->dts)",
          "new_text": null,
          "old_line_content": "            MP_VERBOSE(in, \"packet %f/%f\\n\", target->pts, target->dts);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2353,
          "old_api": "MP_PTS_MIN",
          "new_api": null,
          "old_text": "MP_PTS_MIN(start_ts, ds->base_ts)",
          "new_text": null,
          "old_line_content": "            start_ts = MP_PTS_MIN(start_ts, ds->base_ts);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2555,
          "old_api": "MPMAX",
          "new_api": null,
          "old_text": "MPMAX(0, rates[ds->type])",
          "new_text": null,
          "old_line_content": "                rates[ds->type] = MPMAX(0, rates[ds->type]) + ds->bitrate;",
          "new_line_content": "            struct demux_stream *ds = in->streams[n]->ds;",
          "content_same": false
        },
        {
          "line": 2232,
          "old_api": "switch_current_range",
          "new_api": null,
          "old_text": "switch_current_range(in, range)",
          "new_text": null,
          "old_line_content": "        switch_current_range(in, range);",
          "new_line_content": "    // there as well, because reader and demuxer queue must be the same.",
          "content_same": false
        },
        {
          "line": 2683,
          "old_api": "talloc_array",
          "new_api": null,
          "old_text": "talloc_array(NULL, struct demux_chapter, num)",
          "new_text": null,
          "old_line_content": "    struct demux_chapter *new = talloc_array(NULL, struct demux_chapter, num);",
          "new_line_content": "struct demux_chapter *demux_copy_chapter_data(struct demux_chapter *c, int num)",
          "content_same": false
        },
        {
          "line": 2492,
          "old_api": "stream_get_size",
          "new_api": null,
          "old_text": "stream_get_size(stream)",
          "new_text": null,
          "old_line_content": "    int64_t stream_size = stream_get_size(stream);",
          "new_line_content": "    struct stream_cache_info stream_cache_info = {.size = -1};",
          "content_same": false
        },
        {
          "line": 2493,
          "old_api": "stream_control",
          "new_api": null,
          "old_text": "stream_control(stream, STREAM_CTRL_GET_METADATA, &stream_metadata)",
          "new_text": null,
          "old_line_content": "    stream_control(stream, STREAM_CTRL_GET_METADATA, &stream_metadata);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2366,
          "old_api": "MP_VERBOSE",
          "new_api": null,
          "old_text": "MP_VERBOSE(in, \"can't issue refresh seek\\n\")",
          "new_text": null,
          "old_line_content": "            MP_VERBOSE(in, \"can't issue refresh seek\\n\");",
          "new_line_content": "    if (!normal_seek) {",
          "content_same": false
        },
        {
          "line": 2621,
          "old_api": "MP_VERBOSE",
          "new_api": null,
          "old_text": "MP_VERBOSE(demuxer, \"blocking for STREAM_CTRL %d\\n\", c->ctrl)",
          "new_text": null,
          "old_line_content": "            MP_VERBOSE(demuxer, \"blocking for STREAM_CTRL %d\\n\", c->ctrl);",
          "new_line_content": "        struct demux_ctrl_stream_ctrl *c = arg;",
          "content_same": false
        },
        {
          "line": 2622,
          "old_api": "stream_control",
          "new_api": null,
          "old_text": "stream_control(demuxer->stream, c->ctrl, c->arg)",
          "new_text": null,
          "old_line_content": "        c->res = stream_control(demuxer->stream, c->ctrl, c->arg);",
          "new_line_content": "        if (in->threading)",
          "content_same": false
        },
        {
          "line": 2500,
          "old_api": "talloc_free",
          "new_api": null,
          "old_text": "talloc_free(in->stream_metadata)",
          "new_text": null,
          "old_line_content": "        talloc_free(in->stream_metadata);",
          "new_line_content": "    in->stream_cache_info = stream_cache_info;",
          "content_same": false
        },
        {
          "line": 2501,
          "old_api": "talloc_steal",
          "new_api": null,
          "old_text": "talloc_steal(in, stream_metadata)",
          "new_text": null,
          "old_line_content": "        in->stream_metadata = talloc_steal(in, stream_metadata);",
          "new_line_content": "    if (stream_metadata) {",
          "content_same": false
        },
        {
          "line": 2628,
          "old_api": "MP_VERBOSE",
          "new_api": null,
          "old_text": "MP_VERBOSE(demuxer, \"blocking for DEMUXER_CTRL %d\\n\", cmd)",
          "new_text": null,
          "old_line_content": "            MP_VERBOSE(demuxer, \"blocking for DEMUXER_CTRL %d\\n\", cmd);",
          "new_line_content": "    if (r != CONTROL_OK) {",
          "content_same": false
        },
        {
          "line": 2248,
          "old_api": "MP_VERBOSE",
          "new_api": null,
          "old_text": "MP_VERBOSE(in, \"resuming demuxer to end of cached range\\n\")",
          "new_text": null,
          "old_line_content": "        MP_VERBOSE(in, \"resuming demuxer to end of cached range\\n\");",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 2504,
          "old_api": "pthread_mutex_unlock",
          "new_api": null,
          "old_text": "pthread_mutex_unlock(&in->lock)",
          "new_text": null,
          "old_line_content": "    pthread_mutex_unlock(&in->lock);",
          "new_line_content": "        in->d_buffer->events |= DEMUX_EVENT_METADATA;",
          "content_same": false
        },
        {
          "line": 2686,
          "old_api": "mp_tags_dup",
          "new_api": null,
          "old_text": "mp_tags_dup(new, new[n].metadata)",
          "new_text": null,
          "old_line_content": "        new[n].metadata = mp_tags_dup(new, new[n].metadata);",
          "new_line_content": "    for (int n = 0; n < num; n++) {",
          "content_same": false
        },
        {
          "line": 2381,
          "old_api": "MP_VERBOSE",
          "new_api": null,
          "old_text": "MP_VERBOSE(in, \"refresh seek to %f\\n\", start_ts)",
          "new_text": null,
          "old_line_content": "    MP_VERBOSE(in, \"refresh seek to %f\\n\", start_ts);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 2639,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(demuxer == in->d_user)",
          "new_text": null,
          "old_line_content": "    assert(demuxer == in->d_user);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 2513,
          "old_api": "pthread_cond_signal",
          "new_api": null,
          "old_text": "pthread_cond_signal(&in->wakeup)",
          "new_text": null,
          "old_line_content": "        pthread_cond_signal(&in->wakeup);",
          "new_line_content": "    if (in->stream_cache_info.size >= 0) {",
          "content_same": false
        },
        {
          "line": 2642,
          "old_api": "pthread_mutex_lock",
          "new_api": null,
          "old_text": "pthread_mutex_lock(&in->lock)",
          "new_text": null,
          "old_line_content": "        pthread_mutex_lock(&in->lock);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2259,
          "old_api": "clear_cached_range",
          "new_api": null,
          "old_text": "clear_cached_range(in, in->current_range)",
          "new_text": null,
          "old_line_content": "        clear_cached_range(in, in->current_range);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 2643,
          "old_api": "cached_demux_control",
          "new_api": null,
          "old_text": "cached_demux_control(in, cmd, arg)",
          "new_text": null,
          "old_line_content": "        int cr = cached_demux_control(in, cmd, arg);",
          "new_line_content": "    if (in->threading) {",
          "content_same": false
        },
        {
          "line": 2263,
          "old_api": "talloc_ptrtype",
          "new_api": null,
          "old_text": "talloc_ptrtype(in, range)",
          "new_text": null,
          "old_line_content": "    struct demux_cached_range *range = talloc_ptrtype(in, range);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 2395,
          "old_api": "pthread_mutex_lock",
          "new_api": null,
          "old_text": "pthread_mutex_lock(&in->lock)",
          "new_text": null,
          "old_line_content": "    pthread_mutex_lock(&in->lock);",
          "new_line_content": "    struct demux_internal *in = demuxer->in;",
          "content_same": false
        },
        {
          "line": 2268,
          "old_api": "MP_TARRAY_APPEND",
          "new_api": null,
          "old_text": "MP_TARRAY_APPEND(in, in->ranges, in->num_ranges, range)",
          "new_text": null,
          "old_line_content": "    MP_TARRAY_APPEND(in, in->ranges, in->num_ranges, range);",
          "new_line_content": "        .seek_end = MP_NOPTS_VALUE,",
          "content_same": false
        },
        {
          "line": 2269,
          "old_api": "add_missing_streams",
          "new_api": null,
          "old_text": "add_missing_streams(in, range)",
          "new_text": null,
          "old_line_content": "    add_missing_streams(in, range);",
          "new_line_content": "    };",
          "content_same": false
        },
        {
          "line": 2652,
          "old_api": "MP_VERBOSE",
          "new_api": null,
          "old_text": "MP_VERBOSE(in, \"blocking on demuxer thread\\n\")",
          "new_text": null,
          "old_line_content": "        MP_VERBOSE(in, \"blocking on demuxer thread\\n\");",
          "new_line_content": "    struct demux_control_args args = {demuxer, cmd, arg, &r};",
          "content_same": false
        },
        {
          "line": 2399,
          "old_api": "update_stream_selection_state",
          "new_api": null,
          "old_text": "update_stream_selection_state(in, ds)",
          "new_text": null,
          "old_line_content": "        update_stream_selection_state(in, ds);",
          "new_line_content": "    if (ds->selected != selected) {",
          "content_same": false
        },
        {
          "line": 2653,
          "old_api": "pthread_mutex_lock",
          "new_api": null,
          "old_text": "pthread_mutex_lock(&in->lock)",
          "new_text": null,
          "old_line_content": "        pthread_mutex_lock(&in->lock);",
          "new_line_content": "    if (in->threading) {",
          "content_same": false
        },
        {
          "line": 2402,
          "old_api": "MP_ADD_PTS",
          "new_api": null,
          "old_text": "MP_ADD_PTS(ref_pts, -in->ts_offset)",
          "new_text": null,
          "old_line_content": "            initiate_refresh_seek(in, ds, MP_ADD_PTS(ref_pts, -in->ts_offset));",
          "new_line_content": "        in->tracks_switched = true;",
          "content_same": false
        },
        {
          "line": 2530,
          "old_api": "talloc_strdup",
          "new_api": null,
          "old_text": "talloc_strdup(NULL, in->stream_base_filename)",
          "new_text": null,
          "old_line_content": "        *(char **)arg = talloc_strdup(NULL, in->stream_base_filename);",
          "new_line_content": "        if (!in->stream_base_filename)",
          "content_same": false
        },
        {
          "line": 2658,
          "old_api": "pthread_cond_signal",
          "new_api": null,
          "old_text": "pthread_cond_signal(&in->wakeup)",
          "new_text": null,
          "old_line_content": "        pthread_cond_signal(&in->wakeup);",
          "new_line_content": "        in->run_fn = thread_demux_control;",
          "content_same": false
        },
        {
          "line": 2277,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(demuxer == in->d_user)",
          "new_text": null,
          "old_line_content": "    assert(demuxer == in->d_user);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 2661,
          "old_api": "pthread_mutex_unlock",
          "new_api": null,
          "old_text": "pthread_mutex_unlock(&in->lock)",
          "new_text": null,
          "old_line_content": "        pthread_mutex_unlock(&in->lock);",
          "new_line_content": "        while (in->run_fn)",
          "content_same": false
        },
        {
          "line": 2280,
          "old_api": "MP_WARN",
          "new_api": null,
          "old_text": "MP_WARN(demuxer, \"Cannot seek in this file.\\n\")",
          "new_text": null,
          "old_line_content": "        MP_WARN(demuxer, \"Cannot seek in this file.\\n\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2409,
          "old_api": "pthread_mutex_unlock",
          "new_api": null,
          "old_text": "pthread_mutex_unlock(&in->lock)",
          "new_text": null,
          "old_line_content": "    pthread_mutex_unlock(&in->lock);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 2414,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(!demuxer->in->threading)",
          "new_text": null,
          "old_line_content": "    assert(!demuxer->in->threading); // laziness",
          "new_line_content": "void demux_set_stream_autoselect(struct demuxer *demuxer, bool autoselect)",
          "content_same": false
        },
        {
          "line": 2287,
          "old_api": "pthread_mutex_lock",
          "new_api": null,
          "old_text": "pthread_mutex_lock(&in->lock)",
          "new_text": null,
          "old_line_content": "    pthread_mutex_lock(&in->lock);",
          "new_line_content": "        return 0;",
          "content_same": false
        },
        {
          "line": 2542,
          "old_api": "cached_stream_control",
          "new_api": null,
          "old_text": "cached_stream_control(in, c->ctrl, c->arg)",
          "new_text": null,
          "old_line_content": "        int r = cached_stream_control(in, c->ctrl, c->arg);",
          "new_line_content": "    case DEMUXER_CTRL_STREAM_CTRL: {",
          "content_same": false
        },
        {
          "line": 2672,
          "old_api": "demux_control",
          "new_api": null,
          "old_text": "demux_control(demuxer, DEMUXER_CTRL_STREAM_CTRL, &c)",
          "new_text": null,
          "old_line_content": "    demux_control(demuxer, DEMUXER_CTRL_STREAM_CTRL, &c);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 2163,
          "old_api": "MP_VERBOSE",
          "new_api": null,
          "old_text": "MP_VERBOSE(in, \"cached range %d: %f <-> %f\\n\",\n                       n, r->seek_start, r->seek_end)",
          "new_text": null,
          "old_line_content": "            MP_VERBOSE(in, \"cached range %d: %f <-> %f\\n\",",
          "new_line_content": "        struct demux_cached_range *r = in->ranges[n];",
          "content_same": false
        },
        {
          "line": 2293,
          "old_api": "MP_ADD_PTS",
          "new_api": null,
          "old_text": "MP_ADD_PTS(seek_pts, -in->ts_offset)",
          "new_text": null,
          "old_line_content": "        seek_pts = MP_ADD_PTS(seek_pts, -in->ts_offset);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2678,
          "old_api": "mp_cancel_test",
          "new_api": null,
          "old_text": "mp_cancel_test(demuxer->stream->cancel)",
          "new_text": null,
          "old_line_content": "    return mp_cancel_test(demuxer->stream->cancel);",
          "new_line_content": "bool demux_cancel_test(struct demuxer *demuxer)",
          "content_same": false
        },
        {
          "line": 2167,
          "old_api": "MP_VERBOSE",
          "new_api": null,
          "old_text": "MP_VERBOSE(in, \"...using this range for in-cache seek.\\n\")",
          "new_text": null,
          "old_line_content": "                MP_VERBOSE(in, \"...using this range for in-cache seek.\\n\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2427,
          "old_api": "pthread_mutex_lock",
          "new_api": null,
          "old_text": "pthread_mutex_lock(&stream->ds->in->lock)",
          "new_text": null,
          "old_line_content": "    pthread_mutex_lock(&stream->ds->in->lock);",
          "new_line_content": "        return false;",
          "content_same": false
        },
        {
          "line": 2302,
          "old_api": "try_seek_cache",
          "new_api": null,
          "old_text": "try_seek_cache(in, seek_pts, flags)",
          "new_text": null,
          "old_line_content": "    if (!try_seek_cache(in, seek_pts, flags)) {",
          "new_line_content": "    in->reading = false;",
          "content_same": false
        },
        {
          "line": 2303,
          "old_api": "switch_to_fresh_cache_range",
          "new_api": null,
          "old_text": "switch_to_fresh_cache_range(in)",
          "new_text": null,
          "old_line_content": "        switch_to_fresh_cache_range(in);",
          "new_line_content": "",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 17,
      "total_additions": 70,
      "total_deletions": 70,
      "total_api_changes": 157
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 3,
        "api_related_lines": 157,
        "non_api_lines": 3,
        "non_api_line_numbers": [
          2144,
          2134,
          2143
        ]
      }
    },
    "api_calls_before": 432,
    "api_calls_after": 432,
    "diff_info": {
      "added_lines": 3,
      "removed_lines": 1,
      "total_diff_lines": 23
    }
  }
}