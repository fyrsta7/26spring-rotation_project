{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/56e0f7fe9e735af2df4c016990cbd803f6a9ef0c",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/56e0f7fe9e735af2df4c016990cbd803f6a9ef0c/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/56e0f7fe9e735af2df4c016990cbd803f6a9ef0c/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/56e0f7fe9e735af2df4c016990cbd803f6a9ef0c/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 1193,
          "old_api": "calloc",
          "new_api": "free",
          "old_text": "calloc(1, sizeof(spudec_handle_t))",
          "new_text": "free(buffer)",
          "old_line_content": "  spudec_handle_t *this = calloc(1, sizeof(spudec_handle_t));",
          "new_line_content": "  free(buffer);",
          "content_same": false
        },
        {
          "line": 1198,
          "old_api": "memcpy",
          "new_api": "calloc",
          "old_text": "memcpy(this->global_palette, palette, sizeof(this->global_palette))",
          "new_text": "calloc(1, sizeof(spudec_handle_t))",
          "old_line_content": "      memcpy(this->global_palette, palette, sizeof(this->global_palette));",
          "new_line_content": "  spudec_handle_t *this = calloc(1, sizeof(spudec_handle_t));",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 1166,
          "old_api": null,
          "new_api": "strncmp",
          "old_text": null,
          "new_text": "strncmp(ptr, \"size: \", 6)",
          "old_line_content": "                            \" %x, %x, %x, %x, %x, %x, %x, %x\",",
          "new_line_content": "    if (!strncmp(ptr, \"size: \", 6))",
          "content_same": false
        },
        {
          "line": 1167,
          "old_api": null,
          "new_api": "sscanf",
          "old_text": null,
          "new_text": "sscanf(ptr + 6, \"%dx%d\", &this->orig_frame_width, &this->orig_frame_height)",
          "old_line_content": "               &pal[ 0], &pal[ 1], &pal[ 2], &pal[ 3],",
          "new_line_content": "        sscanf(ptr + 6, \"%dx%d\", &this->orig_frame_width, &this->orig_frame_height);",
          "content_same": false
        },
        {
          "line": 1168,
          "old_api": null,
          "new_api": "strncmp",
          "old_text": null,
          "new_text": "strncmp(ptr, \"palette: \", 9)",
          "old_line_content": "               &pal[ 4], &pal[ 5], &pal[ 6], &pal[ 7],",
          "new_line_content": "    if (!strncmp(ptr, \"palette: \", 9) &&",
          "content_same": false
        },
        {
          "line": 1169,
          "old_api": null,
          "new_api": "sscanf",
          "old_text": null,
          "new_text": "sscanf(ptr + 9, \"%x, %x, %x, %x, %x, %x, %x, %x, \"\n                        \"%x, %x, %x, %x, %x, %x, %x, %x\",\n               &pal[ 0], &pal[ 1], &pal[ 2], &pal[ 3],\n               &pal[ 4], &pal[ 5], &pal[ 6], &pal[ 7],\n               &pal[ 8], &pal[ 9], &pal[10], &pal[11],\n               &pal[12], &pal[13], &pal[14], &pal[15])",
          "old_line_content": "               &pal[ 8], &pal[ 9], &pal[10], &pal[11],",
          "new_line_content": "        sscanf(ptr + 9, \"%x, %x, %x, %x, %x, %x, %x, %x, \"",
          "content_same": false
        },
        {
          "line": 1176,
          "old_api": null,
          "new_api": "vobsub_palette_to_yuv",
          "old_text": null,
          "new_text": "vobsub_palette_to_yuv(pal[i])",
          "old_line_content": "      this->forced_subs_only = 1;",
          "new_line_content": "        pal[i] = vobsub_palette_to_yuv(pal[i]);",
          "content_same": false
        },
        {
          "line": 1179,
          "old_api": null,
          "new_api": "strncasecmp",
          "old_text": null,
          "new_text": "strncasecmp(ptr, \"forced subs: on\", 15)",
          "old_line_content": "      for (i=0; i<4; i++) {",
          "new_line_content": "    if (!strncasecmp(ptr, \"forced subs: on\", 15))",
          "content_same": false
        },
        {
          "line": 1181,
          "old_api": null,
          "new_api": "strncmp",
          "old_text": null,
          "new_text": "strncmp(ptr, \"custom colors: ON, tridx: \", 26)",
          "old_line_content": "        if (tridx & (1 << (12-4*i)))",
          "new_line_content": "    if (!strncmp(ptr, \"custom colors: ON, tridx: \", 26) &&",
          "content_same": false
        },
        {
          "line": 1182,
          "old_api": null,
          "new_api": "sscanf",
          "old_text": null,
          "new_text": "sscanf(ptr + 26, \"%x, colors: %x, %x, %x, %x\",\n               &tridx, cuspal+0, cuspal+1, cuspal+2, cuspal+3)",
          "old_line_content": "          cuspal[i] |= 1 << 31;",
          "new_line_content": "        sscanf(ptr + 26, \"%x, colors: %x, %x, %x, %x\",",
          "content_same": false
        },
        {
          "line": 1185,
          "old_api": null,
          "new_api": "vobsub_rgb_to_yuv",
          "old_text": null,
          "new_text": "vobsub_rgb_to_yuv(cuspal[i])",
          "old_line_content": "    }",
          "new_line_content": "        cuspal[i] = vobsub_rgb_to_yuv(cuspal[i]);",
          "content_same": false
        },
        {
          "line": 1191,
          "old_api": null,
          "new_api": "strchr",
          "old_text": null,
          "new_text": "strchr(ptr,'\\n')",
          "old_line_content": "void *spudec_new_scaled(unsigned int *palette, unsigned int frame_width, unsigned int frame_height, uint8_t *extradata, int extradata_len)",
          "new_line_content": "  } while ((ptr=strchr(ptr,'\\n')) && *++ptr);",
          "content_same": false
        },
        {
          "line": 1203,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(this->global_palette, palette, sizeof(this->global_palette))",
          "old_line_content": "    /* XXX Although the video frame is some size, the SPU frame is",
          "new_line_content": "      memcpy(this->global_palette, palette, sizeof(this->global_palette));",
          "content_same": false
        },
        {
          "line": 1207,
          "old_api": null,
          "new_api": "spudec_parse_extradata",
          "old_text": null,
          "new_text": "spudec_parse_extradata(this, extradata, extradata_len)",
          "old_line_content": "      this->orig_frame_height = 480;",
          "new_line_content": "      spudec_parse_extradata(this, extradata, extradata_len);",
          "content_same": false
        },
        {
          "line": 1217,
          "old_api": null,
          "new_api": "mp_msg",
          "old_text": null,
          "new_text": "mp_msg(MSGT_SPUDEC,MSGL_FATAL, \"FATAL: spudec_init: calloc\")",
          "old_line_content": "{",
          "new_line_content": "    mp_msg(MSGT_SPUDEC,MSGL_FATAL, \"FATAL: spudec_init: calloc\");",
          "content_same": false
        },
        {
          "line": 1223,
          "old_api": null,
          "new_api": "spudec_new_scaled",
          "old_text": null,
          "new_text": "spudec_new_scaled(palette, 0, 0, NULL, 0)",
          "old_line_content": "  spudec_handle_t *spu = (spudec_handle_t*)this;",
          "new_line_content": "    return spudec_new_scaled(palette, 0, 0, NULL, 0);",
          "content_same": false
        },
        {
          "line": 1231,
          "old_api": null,
          "new_api": "spudec_dequeue_packet",
          "old_text": null,
          "new_text": "spudec_dequeue_packet(spu)",
          "old_line_content": "    if (spu->image)",
          "new_line_content": "      spudec_free_packet(spudec_dequeue_packet(spu));",
          "content_same": false
        },
        {
          "line": 1235,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free(spu->scaled_image)",
          "old_line_content": "}",
          "new_line_content": "\tfree(spu->scaled_image);",
          "content_same": false
        },
        {
          "line": 1237,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free(spu->image)",
          "old_line_content": "void spudec_set_hw_spu(void *this, const vo_functions_t *hw_spu)",
          "new_line_content": "      free(spu->image);",
          "content_same": false
        },
        {
          "line": 1238,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free(spu)",
          "old_line_content": "{",
          "new_line_content": "    free(spu);",
          "content_same": false
        },
        {
          "line": 1248,
          "old_api": null,
          "new_api": "control",
          "old_text": null,
          "new_text": "hw_spu->control(VOCTRL_SET_SPU_PALETTE,spu->global_palette)",
          "old_line_content": "",
          "new_line_content": "  hw_spu->control(VOCTRL_SET_SPU_PALETTE,spu->global_palette);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 1186,
          "old_api": "strchr",
          "new_api": null,
          "old_text": "strchr(ptr,'\\n')",
          "new_text": null,
          "old_line_content": "  } while ((ptr=strchr(ptr,'\\n')) && *++ptr);",
          "new_line_content": "        if (tridx & (1 << (12-4*i)))",
          "content_same": false
        },
        {
          "line": 1218,
          "old_api": "spudec_new_scaled",
          "new_api": null,
          "old_text": "spudec_new_scaled(palette, 0, 0, NULL, 0)",
          "new_text": null,
          "old_line_content": "    return spudec_new_scaled(palette, 0, 0, NULL, 0);",
          "new_line_content": "  return this;",
          "content_same": false
        },
        {
          "line": 1188,
          "old_api": "free",
          "new_api": null,
          "old_text": "free(buffer)",
          "new_text": null,
          "old_line_content": "  free(buffer);",
          "new_line_content": "      }",
          "content_same": false
        },
        {
          "line": 1226,
          "old_api": "spudec_dequeue_packet",
          "new_api": null,
          "old_text": "spudec_dequeue_packet(spu)",
          "new_text": null,
          "old_line_content": "      spudec_free_packet(spudec_dequeue_packet(spu));",
          "new_line_content": "void spudec_free(void *this)",
          "content_same": false
        },
        {
          "line": 1164,
          "old_api": "sscanf",
          "new_api": null,
          "old_text": "sscanf(ptr, \"size: %dx%d\", &this->orig_frame_width, &this->orig_frame_height)",
          "new_text": null,
          "old_line_content": "    sscanf(ptr, \"size: %dx%d\", &this->orig_frame_width, &this->orig_frame_height);",
          "new_line_content": "    if (*ptr == '#')",
          "content_same": false
        },
        {
          "line": 1165,
          "old_api": "sscanf",
          "new_api": null,
          "old_text": "sscanf(ptr, \"palette: %x, %x, %x, %x, %x, %x, %x, %x,\"\n                            \" %x, %x, %x, %x, %x, %x, %x, %x\",\n               &pal[ 0], &pal[ 1], &pal[ 2], &pal[ 3],\n               &pal[ 4], &pal[ 5], &pal[ 6], &pal[ 7],\n               &pal[ 8], &pal[ 9], &pal[10], &pal[11],\n               &pal[12], &pal[13], &pal[14], &pal[15])",
          "new_text": null,
          "old_line_content": "    if (sscanf(ptr, \"palette: %x, %x, %x, %x, %x, %x, %x, %x,\"",
          "new_line_content": "        continue;",
          "content_same": false
        },
        {
          "line": 1228,
          "old_api": "free",
          "new_api": null,
          "old_text": "free(spu->packet)",
          "new_text": null,
          "old_line_content": "      free(spu->packet);",
          "new_line_content": "  spudec_handle_t *spu = (spudec_handle_t*)this;",
          "content_same": false
        },
        {
          "line": 1230,
          "old_api": "free",
          "new_api": null,
          "old_text": "free(spu->scaled_image)",
          "new_text": null,
          "old_line_content": "\tfree(spu->scaled_image);",
          "new_line_content": "    while (spu->queue_head)",
          "content_same": false
        },
        {
          "line": 1232,
          "old_api": "free",
          "new_api": null,
          "old_text": "free(spu->image)",
          "new_text": null,
          "old_line_content": "      free(spu->image);",
          "new_line_content": "    if (spu->packet)",
          "content_same": false
        },
        {
          "line": 1202,
          "old_api": "spudec_parse_extradata",
          "new_api": null,
          "old_text": "spudec_parse_extradata(this, extradata, extradata_len)",
          "new_text": null,
          "old_line_content": "      spudec_parse_extradata(this, extradata, extradata_len);",
          "new_line_content": "    if (palette)",
          "content_same": false
        },
        {
          "line": 1212,
          "old_api": "mp_msg",
          "new_api": null,
          "old_text": "mp_msg(MSGT_SPUDEC,MSGL_FATAL, \"FATAL: spudec_init: calloc\")",
          "new_text": null,
          "old_line_content": "    mp_msg(MSGT_SPUDEC,MSGL_FATAL, \"FATAL: spudec_init: calloc\");",
          "new_line_content": "      this->orig_frame_height = 480;",
          "content_same": false
        },
        {
          "line": 1172,
          "old_api": "vobsub_palette_to_yuv",
          "new_api": null,
          "old_text": "vobsub_palette_to_yuv(pal[i])",
          "new_text": null,
          "old_line_content": "        pal[i] = vobsub_palette_to_yuv(pal[i]);",
          "new_line_content": "               &pal[ 4], &pal[ 5], &pal[ 6], &pal[ 7],",
          "content_same": false
        },
        {
          "line": 1175,
          "old_api": "strncasecmp",
          "new_api": null,
          "old_text": "strncasecmp(ptr, \"forced subs: on\", 15)",
          "new_text": null,
          "old_line_content": "    if (!strncasecmp(ptr, \"forced subs: on\", 15))",
          "new_line_content": "      for (i=0; i<16; i++)",
          "content_same": false
        },
        {
          "line": 1177,
          "old_api": "sscanf",
          "new_api": null,
          "old_text": "sscanf(ptr, \"custom colors: ON, tridx: %x, colors: %x, %x, %x, %x\",\n               &tridx, cuspal+0, cuspal+1, cuspal+2, cuspal+3)",
          "new_text": null,
          "old_line_content": "    if (sscanf(ptr, \"custom colors: ON, tridx: %x, colors: %x, %x, %x, %x\",",
          "new_line_content": "      this->auto_palette = 0;",
          "content_same": false
        },
        {
          "line": 1243,
          "old_api": "control",
          "new_api": null,
          "old_text": "hw_spu->control(VOCTRL_SET_SPU_PALETTE,spu->global_palette)",
          "new_text": null,
          "old_line_content": "  hw_spu->control(VOCTRL_SET_SPU_PALETTE,spu->global_palette);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 1180,
          "old_api": "vobsub_rgb_to_yuv",
          "new_api": null,
          "old_text": "vobsub_rgb_to_yuv(cuspal[i])",
          "new_text": null,
          "old_line_content": "        cuspal[i] = vobsub_rgb_to_yuv(cuspal[i]);",
          "new_line_content": "      this->forced_subs_only = 1;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 2,
      "total_additions": 19,
      "total_deletions": 16,
      "total_api_changes": 37
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 10,
        "api_related_lines": 37,
        "non_api_lines": 1,
        "non_api_line_numbers": [
          1170
        ]
      }
    },
    "api_calls_before": 142,
    "api_calls_after": 145,
    "diff_info": {
      "added_lines": 9,
      "removed_lines": 4,
      "total_diff_lines": 32
    }
  }
}