{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/c10fb4ce9fcd3dbbf69741eb8499c4cfabbf5412",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/c10fb4ce9fcd3dbbf69741eb8499c4cfabbf5412/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/c10fb4ce9fcd3dbbf69741eb8499c4cfabbf5412/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/c10fb4ce9fcd3dbbf69741eb8499c4cfabbf5412/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 816,
          "old_api": "allback_add_listener",
          "new_api": "allback_destroy",
          "old_text": "allback_add_listener(wl->frame.callback, &frame_listener, wl);\n  ",
          "new_text": "allback_destroy(callback);\n\n ",
          "old_line_content": "    wl_callback_add_listener(wl->frame.callback, &frame_listener, wl);",
          "new_line_content": "        wl_callback_destroy(callback);",
          "content_same": false
        },
        {
          "line": 863,
          "old_api": "hm_destroy",
          "new_api": "ist_for_each_safe",
          "old_text": "hm_destroy(wl->display.shm);\n\n ",
          "new_text": "ist_for_each_safe(output, tmp, &wl->display.output_list, link) {\n ",
          "old_line_content": "        wl_shm_destroy(wl->display.shm);",
          "new_line_content": "    wl_list_for_each_safe(output, tmp, &wl->display.output_list, link) {",
          "content_same": false
        },
        {
          "line": 872,
          "old_api": "ompositor_destroy",
          "new_api": "hm_destroy",
          "old_text": "ompositor_destroy(wl->display.compositor);\n\n ",
          "new_text": "hm_destroy(wl->display.shm);\n\n ",
          "old_line_content": "        wl_compositor_destroy(wl->display.compositor);",
          "new_line_content": "        wl_shm_destroy(wl->display.shm);",
          "content_same": false
        },
        {
          "line": 875,
          "old_api": "egistry_destroy",
          "new_api": "hell_destroy",
          "old_text": "egistry_destroy(wl->display.registry);\n\n ",
          "new_text": "hell_destroy(wl->display.shell);\n\n ",
          "old_line_content": "        wl_registry_destroy(wl->display.registry);",
          "new_line_content": "        wl_shell_destroy(wl->display.shell);",
          "content_same": false
        },
        {
          "line": 878,
          "old_api": "isplay_flush",
          "new_api": "ubcompositor_destroy",
          "old_text": "isplay_flush(wl->display.display);\n  ",
          "new_text": "ubcompositor_destroy(wl->display.subcomp);\n\n ",
          "old_line_content": "        wl_display_flush(wl->display.display);",
          "new_line_content": "        wl_subcompositor_destroy(wl->display.subcomp);",
          "content_same": false
        },
        {
          "line": 888,
          "old_api": "urface_add_listener",
          "new_api": "isplay_disconnect",
          "old_text": "urface_add_listener(wl->window.video_surface,\n                            &surface_listener, wl);\n\n ",
          "new_text": "isplay_disconnect(wl->display.display);\n  ",
          "old_line_content": "    wl_surface_add_listener(wl->window.video_surface,",
          "new_line_content": "        wl_display_disconnect(wl->display.display);",
          "content_same": false
        },
        {
          "line": 926,
          "old_api": "RR",
          "new_api": "urface_destroy",
          "old_text": "RR(wl->vo, \"no shm interface available\\n\");\n  ",
          "new_text": "urface_destroy(wl->window.video_surface);\n\n ",
          "old_line_content": "        MP_ERR(wl->vo, \"no shm interface available\\n\");",
          "new_line_content": "        wl_surface_destroy(wl->window.video_surface);",
          "content_same": false
        },
        {
          "line": 946,
          "old_api": "ursor_theme_destroy",
          "new_api": "ursor_theme_get_cursor",
          "old_text": "ursor_theme_destroy(wl->cursor.theme);\n\n ",
          "new_text": "ursor_theme_get_cursor(wl->cursor.theme,\n                                                           \"left_ptr\");\n\n ",
          "old_line_content": "        wl_cursor_theme_destroy(wl->cursor.theme);",
          "new_line_content": "    wl->cursor.default_cursor = wl_cursor_theme_get_cursor(wl->cursor.theme,",
          "content_same": false
        },
        {
          "line": 978,
          "old_api": "ointer_destroy",
          "new_api": "eyboard_destroy",
          "old_text": "ointer_destroy(wl->input.pointer);\n\n ",
          "new_text": "eyboard_destroy(wl->input.keyboard);\n  ",
          "old_line_content": "        wl_pointer_destroy(wl->input.pointer);",
          "new_line_content": "        wl_keyboard_destroy(wl->input.keyboard);",
          "content_same": false
        },
        {
          "line": 984,
          "old_api": "ata_device_manager_destroy",
          "new_api": "context_unref",
          "old_text": "ata_device_manager_destroy(wl->input.devman);\n\n ",
          "new_text": "context_unref(wl->input.xkb.context);\n\n ",
          "old_line_content": "        wl_data_device_manager_destroy(wl->input.devman);",
          "new_line_content": "        xkb_context_unref(wl->input.xkb.context);",
          "content_same": false
        },
        {
          "line": 987,
          "old_api": "eat_destroy",
          "new_api": "ointer_destroy",
          "old_text": "eat_destroy(wl->input.seat);\n}\n",
          "new_text": "ointer_destroy(wl->input.pointer);\n\n ",
          "old_line_content": "        wl_seat_destroy(wl->input.seat);",
          "new_line_content": "        wl_pointer_destroy(wl->input.pointer);",
          "content_same": false
        },
        {
          "line": 1003,
          "old_api": "te_window",
          "new_api": "oc_zero",
          "old_text": "te_window(wl)\n   ",
          "new_text": "oc_zero(NULL, struct vo_wayland_state);\n  ",
          "old_line_content": "        || !create_window(wl)",
          "new_line_content": "    vo->wayland = talloc_zero(NULL, struct vo_wayland_state);",
          "content_same": false
        },
        {
          "line": 1006,
          "old_api": "ayland_uninit",
          "new_api": "og_new",
          "old_text": "ayland_uninit(vo);\n  ",
          "new_text": "og_new(wl, vo->log, \"wayland\");\n\n ",
          "old_line_content": "        vo_wayland_uninit(vo);",
          "new_line_content": "    wl->log = mp_log_new(wl, vo->log, \"wayland\");",
          "content_same": false
        },
        {
          "line": 1012,
          "old_api": "isplay_roundtrip",
          "new_api": "te_window",
          "old_text": "isplay_roundtrip(wl->display.display);\n\n ",
          "new_text": "te_window(wl)\n   ",
          "old_line_content": "    wl_display_roundtrip(wl->display.display);",
          "new_line_content": "        || !create_window(wl)",
          "content_same": false
        },
        {
          "line": 1015,
          "old_api": "ist_for_each",
          "new_api": "ayland_uninit",
          "old_text": "ist_for_each(o, &wl->display.output_list, link) {\n ",
          "new_text": "ayland_uninit(vo);\n  ",
          "old_line_content": "    wl_list_for_each(o, &wl->display.output_list, link) {",
          "new_line_content": "        vo_wayland_uninit(vo);",
          "content_same": false
        },
        {
          "line": 1045,
          "old_api": "BG",
          "new_api": "roy_display",
          "old_text": "BG(wl, \"going ontop\\n\");\n  ",
          "new_text": "roy_display(wl);\n  ",
          "old_line_content": "    MP_DBG(wl, \"going ontop\\n\");",
          "new_line_content": "    destroy_display(wl);",
          "content_same": false
        },
        {
          "line": 1047,
          "old_api": "ow_set_toplevel",
          "new_api": "oc_free",
          "old_text": "ow_set_toplevel(wl);\n  ",
          "new_text": "oc_free(wl);\n  ",
          "old_line_content": "    window_set_toplevel(wl);",
          "new_line_content": "    talloc_free(wl);",
          "content_same": false
        },
        {
          "line": 1073,
          "old_api": "dule_resize",
          "new_api": "hell_surface_set_fullscreen",
          "old_text": "dule_resize(wl, 0, wl->window.p_width, wl->window.p_height);\n  ",
          "new_text": "hell_surface_set_fullscreen(wl->window.shell_surface,\n                WL_SHELL_SURFACE_FULLSCREEN_METHOD_DEFAULT,\n                0, fs_output);\n  ",
          "old_line_content": "        schedule_resize(wl, 0, wl->window.p_width, wl->window.p_height);",
          "new_line_content": "        wl_shell_surface_set_fullscreen(wl->window.shell_surface,",
          "content_same": false
        },
        {
          "line": 1082,
          "old_api": "isplay_dispatch_pending",
          "new_api": "dule_resize",
          "old_text": "isplay_dispatch_pending(dp);\n  ",
          "new_text": "dule_resize(wl, 0, wl->window.p_width, wl->window.p_height);\n  ",
          "old_line_content": "    wl_display_dispatch_pending(dp);",
          "new_line_content": "        schedule_resize(wl, 0, wl->window.p_width, wl->window.p_height);",
          "content_same": false
        },
        {
          "line": 1126,
          "old_api": "oc",
          "new_api": "(&fd, 1, 0) > 0",
          "old_text": "oc(to_read);\n  ",
          "new_text": "(&fd, 1, 0) > 0",
          "old_line_content": "                char *buffer = malloc(to_read);",
          "new_line_content": "        if (poll(&fd, 1, 0) > 0) {",
          "content_same": false
        },
        {
          "line": 1253,
          "old_api": "ow_set_title",
          "new_api": "_cursor",
          "old_text": "ow_set_title(wl, (char*) arg);\n  ",
          "new_text": "_cursor(wl);\n  ",
          "old_line_content": "        window_set_title(wl, (char*) arg);",
          "new_line_content": "                show_cursor(wl);",
          "content_same": false
        },
        {
          "line": 1286,
          "old_api": "ayland_fullscreen",
          "new_api": "pply_window_geometry",
          "old_text": "ayland_fullscreen(vo);\n  ",
          "new_text": "pply_window_geometry(vo, &geo);\n\n ",
          "old_line_content": "        vo_wayland_fullscreen(vo);",
          "new_line_content": "    vo_apply_window_geometry(vo, &geo);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 1024,
          "old_api": null,
          "new_api": "ist_for_each",
          "old_text": null,
          "new_text": "ist_for_each(o, &wl->display.output_list, link) {\n ",
          "old_line_content": "    }",
          "new_line_content": "    wl_list_for_each(o, &wl->display.output_list, link) {",
          "content_same": false
        },
        {
          "line": 1025,
          "old_api": null,
          "new_api": "ERBOSE",
          "old_text": null,
          "new_text": "ERBOSE(wl, \"output received:\\n\"\n                       \"\\tvendor: %s\\n\"\n                       \"\\tmodel: %s\\n\"\n                       \"\\tw: %d, h: %d\\n\"\n                       \"\\tHz: %d\\n\",\n                       o->make, o->model,\n                       o->width, o->height,\n                       o->refresh_rate / 1000);\n  ",
          "old_line_content": "",
          "new_line_content": "        MP_VERBOSE(wl, \"output received:\\n\"",
          "content_same": false
        },
        {
          "line": 1043,
          "old_api": null,
          "new_api": "roy_cursor",
          "old_text": null,
          "new_text": "roy_cursor(wl);\n  ",
          "old_line_content": "{",
          "new_line_content": "    destroy_cursor(wl);",
          "content_same": false
        },
        {
          "line": 1044,
          "old_api": null,
          "new_api": "roy_window",
          "old_text": null,
          "new_text": "roy_window(wl);\n  ",
          "old_line_content": "    struct vo_wayland_state *wl = vo->wayland;",
          "new_line_content": "    destroy_window(wl);",
          "content_same": false
        },
        {
          "line": 1046,
          "old_api": null,
          "new_api": "roy_input",
          "old_text": null,
          "new_text": "roy_input(wl);\n  ",
          "old_line_content": "    vo->opts->ontop = 1;",
          "new_line_content": "    destroy_input(wl);",
          "content_same": false
        },
        {
          "line": 1054,
          "old_api": null,
          "new_api": "BG",
          "old_text": null,
          "new_text": "BG(wl, \"going ontop\\n\");\n  ",
          "old_line_content": "    if (!wl->display.shell)",
          "new_line_content": "    MP_DBG(wl, \"going ontop\\n\");",
          "content_same": false
        },
        {
          "line": 1056,
          "old_api": null,
          "new_api": "ow_set_toplevel",
          "old_text": null,
          "new_text": "ow_set_toplevel(wl);\n  ",
          "old_line_content": "",
          "new_line_content": "    window_set_toplevel(wl);",
          "content_same": false
        },
        {
          "line": 1057,
          "old_api": null,
          "new_api": "dule_resize",
          "old_text": null,
          "new_text": "dule_resize(wl, 0, wl->window.width, wl->window.height);\n}\n",
          "old_line_content": "    struct wl_output *fs_output = wl->display.fs_output;",
          "new_line_content": "    schedule_resize(wl, 0, wl->window.width, wl->window.height);",
          "content_same": false
        },
        {
          "line": 1069,
          "old_api": null,
          "new_api": "BG",
          "old_text": null,
          "new_text": "BG(wl, \"going fullscreen\\n\");\n  ",
          "old_line_content": "    else {",
          "new_line_content": "        MP_DBG(wl, \"going fullscreen\\n\");",
          "content_same": false
        },
        {
          "line": 1079,
          "old_api": null,
          "new_api": "BG",
          "old_text": null,
          "new_text": "BG(wl, \"leaving fullscreen\\n\");\n  ",
          "old_line_content": "    struct vo_wayland_state *wl = vo->wayland;",
          "new_line_content": "        MP_DBG(wl, \"leaving fullscreen\\n\");",
          "content_same": false
        },
        {
          "line": 1081,
          "old_api": null,
          "new_api": "ow_set_toplevel",
          "old_text": null,
          "new_text": "ow_set_toplevel(wl);\n  ",
          "old_line_content": "",
          "new_line_content": "        window_set_toplevel(wl);",
          "content_same": false
        },
        {
          "line": 1091,
          "old_api": null,
          "new_api": "isplay_dispatch_pending",
          "old_text": null,
          "new_text": "isplay_dispatch_pending(dp);\n  ",
          "old_line_content": "    /* wl_display_dispatch is blocking",
          "new_line_content": "    wl_display_dispatch_pending(dp);",
          "content_same": false
        },
        {
          "line": 1092,
          "old_api": null,
          "new_api": "isplay_flush",
          "old_text": null,
          "new_text": "isplay_flush(dp);\n\n ",
          "old_line_content": "     * wl_dipslay_dispatch_pending is non-blocking but does not read from the fd",
          "new_line_content": "    wl_display_flush(dp);",
          "content_same": false
        },
        {
          "line": 1105,
          "old_api": null,
          "new_api": "(&fd, 1, 0) > 0",
          "old_text": null,
          "new_text": "(&fd, 1, 0) > 0",
          "old_line_content": "        if (fd.revents & POLLOUT)",
          "new_line_content": "    if (poll(&fd, 1, 0) > 0) {",
          "content_same": false
        },
        {
          "line": 1107,
          "old_api": null,
          "new_api": "ATAL",
          "old_text": null,
          "new_text": "ATAL(wl, \"error occurred on the display fd: \"\n                         \"closing file descriptor\\n\");\n  ",
          "old_line_content": "    }",
          "new_line_content": "            MP_FATAL(wl, \"error occurred on the display fd: \"",
          "content_same": false
        },
        {
          "line": 1109,
          "old_api": null,
          "new_api": "e",
          "old_text": null,
          "new_text": "e(wl->display.display_fd);\n  ",
          "old_line_content": "    /* If drag & drop was ended poll the file descriptor from the offer if",
          "new_line_content": "            close(wl->display.display_fd);",
          "content_same": false
        },
        {
          "line": 1110,
          "old_api": null,
          "new_api": "nput_put_key",
          "old_text": null,
          "new_text": "nput_put_key(vo->input_ctx, MP_KEY_CLOSE_WIN);\n  ",
          "old_line_content": "     * there is data to read.",
          "new_line_content": "            mp_input_put_key(vo->input_ctx, MP_KEY_CLOSE_WIN);",
          "content_same": false
        },
        {
          "line": 1113,
          "old_api": null,
          "new_api": "isplay_dispatch",
          "old_text": null,
          "new_text": "isplay_dispatch(dp);\n  ",
          "old_line_content": "    if (wl->input.dnd_fd != -1) {",
          "new_line_content": "            wl_display_dispatch(dp);",
          "content_same": false
        },
        {
          "line": 1115,
          "old_api": null,
          "new_api": "isplay_flush",
          "old_text": null,
          "new_text": "isplay_flush(dp);\n  ",
          "old_line_content": "        fd.events = POLLIN | POLLHUP | POLLERR;",
          "new_line_content": "            wl_display_flush(dp);",
          "content_same": false
        },
        {
          "line": 1128,
          "old_api": null,
          "new_api": "RR",
          "old_text": null,
          "new_text": "RR(wl, \"error occured on the drag&drop fd\\n\");\n  ",
          "old_line_content": "                size_t str_len = 0;",
          "new_line_content": "                MP_ERR(wl, \"error occured on the drag&drop fd\\n\");",
          "content_same": false
        },
        {
          "line": 1129,
          "old_api": null,
          "new_api": "e",
          "old_text": null,
          "new_text": "e(wl->input.dnd_fd);\n  ",
          "old_line_content": "                int has_read = 0;",
          "new_line_content": "                close(wl->input.dnd_fd);",
          "content_same": false
        },
        {
          "line": 1135,
          "old_api": null,
          "new_api": "oc",
          "old_text": null,
          "new_text": "oc(to_read);\n  ",
          "old_line_content": "                    if (buffer_len + to_read < buffer_len) {",
          "new_line_content": "                char *buffer = malloc(to_read);",
          "content_same": false
        },
        {
          "line": 1143,
          "old_api": null,
          "new_api": "(fd.fd, buffer+str_len, to_read))) {",
          "old_text": null,
          "new_text": "(fd.fd, buffer+str_len, to_read))) {",
          "old_line_content": "                    if (!ptr)",
          "new_line_content": "                while (0 < (has_read = read(fd.fd, buffer+str_len, to_read))) {",
          "content_same": false
        },
        {
          "line": 1145,
          "old_api": null,
          "new_api": "RR",
          "old_text": null,
          "new_text": "RR(wl, \"Integer overflow while reading from fd\\n\");\n  ",
          "old_line_content": "                    buffer = ptr;",
          "new_line_content": "                        MP_ERR(wl, \"Integer overflow while reading from fd\\n\");",
          "content_same": false
        },
        {
          "line": 1151,
          "old_api": null,
          "new_api": "loc",
          "old_text": null,
          "new_text": "loc(buffer, buffer_len);\n  ",
          "old_line_content": "                                                file_list);",
          "new_line_content": "                    void *ptr = realloc(buffer, buffer_len);",
          "content_same": false
        },
        {
          "line": 1158,
          "old_api": null,
          "new_api": "0",
          "old_text": null,
          "new_text": "0(buffer);\n  ",
          "old_line_content": "",
          "new_line_content": "                        struct bstr file_list = bstr0(buffer);",
          "content_same": false
        },
        {
          "line": 1159,
          "old_api": null,
          "new_api": "vent_drop_mime_data",
          "old_text": null,
          "new_text": "vent_drop_mime_data(vo->input_ctx, \"text/uri-list\",\n                                                file_list);\n  ",
          "old_line_content": "            if (fd.revents & POLLHUP) {",
          "new_line_content": "                        mp_event_drop_mime_data(vo->input_ctx, \"text/uri-list\",",
          "content_same": false
        },
        {
          "line": 1165,
          "old_api": null,
          "new_api": "(buffer);",
          "old_text": null,
          "new_text": "(buffer);\n  ",
          "old_line_content": "",
          "new_line_content": "                free(buffer);",
          "content_same": false
        },
        {
          "line": 1169,
          "old_api": null,
          "new_api": "e",
          "old_text": null,
          "new_text": "e(wl->input.dnd_fd);\n  ",
          "old_line_content": "",
          "new_line_content": "                close(wl->input.dnd_fd);",
          "content_same": false
        },
        {
          "line": 1193,
          "old_api": null,
          "new_api": "ist_for_each_reverse",
          "old_text": null,
          "new_text": "ist_for_each_reverse(output, &wl->display.output_list, link) {\n ",
          "old_line_content": "    }",
          "new_line_content": "        wl_list_for_each_reverse(output, &wl->display.output_list, link) {",
          "content_same": false
        },
        {
          "line": 1225,
          "old_api": null,
          "new_api": "isplay_dispatch_pending",
          "old_text": null,
          "new_text": "isplay_dispatch_pending(wl->display.display);\n\n ",
          "old_line_content": "        return VO_TRUE;",
          "new_line_content": "    wl_display_dispatch_pending(wl->display.display);",
          "content_same": false
        },
        {
          "line": 1229,
          "old_api": null,
          "new_api": "ayland_check_events",
          "old_text": null,
          "new_text": "ayland_check_events(vo);\n  ",
          "old_line_content": "    case VOCTRL_GET_UNFS_WINDOW_SIZE: {",
          "new_line_content": "        *events |= vo_wayland_check_events(vo);",
          "content_same": false
        },
        {
          "line": 1233,
          "old_api": null,
          "new_api": "ayland_fullscreen",
          "old_text": null,
          "new_text": "ayland_fullscreen(vo);\n  ",
          "old_line_content": "        return VO_TRUE;",
          "new_line_content": "        vo_wayland_fullscreen(vo);",
          "content_same": false
        },
        {
          "line": 1236,
          "old_api": null,
          "new_api": "ayland_ontop",
          "old_text": null,
          "new_text": "ayland_ontop(vo);\n  ",
          "old_line_content": "        int *s = arg;",
          "new_line_content": "        vo_wayland_ontop(vo);",
          "content_same": false
        },
        {
          "line": 1247,
          "old_api": null,
          "new_api": "dule_resize",
          "old_text": null,
          "new_text": "dule_resize(wl, 0, s[0], s[1]);\n  ",
          "old_line_content": "            if (wl->cursor.visible)",
          "new_line_content": "            schedule_resize(wl, 0, s[0], s[1]);",
          "content_same": false
        },
        {
          "line": 1257,
          "old_api": null,
          "new_api": "_cursor",
          "old_text": null,
          "new_text": "_cursor(wl);\n  ",
          "old_line_content": "            break;",
          "new_line_content": "                hide_cursor(wl);",
          "content_same": false
        },
        {
          "line": 1262,
          "old_api": null,
          "new_api": "ow_set_title",
          "old_text": null,
          "new_text": "ow_set_title(wl, (char*) arg);\n  ",
          "old_line_content": "        return VO_TRUE;",
          "new_line_content": "        window_set_title(wl, (char*) arg);",
          "content_same": false
        },
        {
          "line": 1282,
          "old_api": null,
          "new_api": "ayland_update_screeninfo",
          "old_text": null,
          "new_text": "ayland_update_screeninfo(vo, &screenrc);\n\n ",
          "old_line_content": "",
          "new_line_content": "    vo_wayland_update_screeninfo(vo, &screenrc);",
          "content_same": false
        },
        {
          "line": 1285,
          "old_api": null,
          "new_api": "alc_window_geometry",
          "old_text": null,
          "new_text": "alc_window_geometry(vo, &screenrc, &geo);\n  ",
          "old_line_content": "        wl->window.height = vo->dheight;",
          "new_line_content": "    vo_calc_window_geometry(vo, &screenrc, &geo);",
          "content_same": false
        },
        {
          "line": 1290,
          "old_api": null,
          "new_api": "X",
          "old_text": null,
          "new_text": "X(vo->dheight, 1);\n\n ",
          "old_line_content": "}",
          "new_line_content": "    wl->window.aspect = vo->dwidth / (float) MPMAX(vo->dheight, 1);",
          "content_same": false
        },
        {
          "line": 1295,
          "old_api": null,
          "new_api": "ayland_fullscreen",
          "old_text": null,
          "new_text": "ayland_fullscreen(vo);\n  ",
          "old_line_content": "",
          "new_line_content": "        vo_wayland_fullscreen(vo);",
          "content_same": false
        },
        {
          "line": 799,
          "old_api": null,
          "new_api": "ompositor_create_region",
          "old_text": null,
          "new_text": "ompositor_create_region(wl->display.compositor);\n\n ",
          "old_line_content": "",
          "new_line_content": "    struct wl_region *region = wl_compositor_create_region(wl->display.compositor);",
          "content_same": false
        },
        {
          "line": 802,
          "old_api": null,
          "new_api": "egion_add",
          "old_text": null,
          "new_text": "egion_add(region, x, y, width, height);\n  ",
          "old_line_content": "                           uint32_t time)",
          "new_line_content": "        wl_region_add(region, x, y, width, height);",
          "content_same": false
        },
        {
          "line": 803,
          "old_api": null,
          "new_api": "urface_set_opaque_region",
          "old_text": null,
          "new_text": "urface_set_opaque_region(wl->window.video_surface, region);\n  ",
          "old_line_content": "{",
          "new_line_content": "        wl_surface_set_opaque_region(wl->window.video_surface, region);",
          "content_same": false
        },
        {
          "line": 804,
          "old_api": null,
          "new_api": "urface_commit",
          "old_text": null,
          "new_text": "urface_commit(wl->window.video_surface);\n  ",
          "old_line_content": "    struct vo_wayland_state *wl = data;",
          "new_line_content": "        wl_surface_commit(wl->window.video_surface);",
          "content_same": false
        },
        {
          "line": 805,
          "old_api": null,
          "new_api": "egion_destroy",
          "old_text": null,
          "new_text": "egion_destroy(region);\n  ",
          "old_line_content": "",
          "new_line_content": "        wl_region_destroy(region);",
          "content_same": false
        },
        {
          "line": 818,
          "old_api": null,
          "new_api": "urface_frame",
          "old_text": null,
          "new_text": "urface_frame(wl->window.video_surface);\n\n ",
          "old_line_content": "}",
          "new_line_content": "    wl->frame.callback = wl_surface_frame(wl->window.video_surface);",
          "content_same": false
        },
        {
          "line": 821,
          "old_api": null,
          "new_api": "RR",
          "old_text": null,
          "new_text": "RR(wl, \"wl_surface_frame failed\\n\");\n  ",
          "old_line_content": "    frame_callback",
          "new_line_content": "        MP_ERR(wl, \"wl_surface_frame failed\\n\");",
          "content_same": false
        },
        {
          "line": 825,
          "old_api": null,
          "new_api": "allback_add_listener",
          "old_text": null,
          "new_text": "allback_add_listener(wl->frame.callback, &frame_listener, wl);\n  ",
          "old_line_content": "{",
          "new_line_content": "    wl_callback_add_listener(wl->frame.callback, &frame_listener, wl);",
          "content_same": false
        },
        {
          "line": 835,
          "old_api": null,
          "new_api": "nv",
          "old_text": null,
          "new_text": "nv(\"XDG_RUNTIME_DIR\"))\n  ",
          "old_line_content": "",
          "new_line_content": "    if (wl->vo->probing && !getenv(\"XDG_RUNTIME_DIR\"))",
          "content_same": false
        },
        {
          "line": 838,
          "old_api": null,
          "new_api": "isplay_connect",
          "old_text": null,
          "new_text": "isplay_connect(NULL);\n\n ",
          "old_line_content": "",
          "new_line_content": "    wl->display.display = wl_display_connect(NULL);",
          "content_same": false
        },
        {
          "line": 841,
          "old_api": null,
          "new_api": "SG",
          "old_text": null,
          "new_text": "SG(wl, wl->vo->probing ? MSGL_V : MSGL_ERR,\n               \"failed to connect to a wayland server: \"\n               \"check if a wayland compositor is running\\n\");\n\n ",
          "old_line_content": "",
          "new_line_content": "        MP_MSG(wl, wl->vo->probing ? MSGL_V : MSGL_ERR,",
          "content_same": false
        },
        {
          "line": 848,
          "old_api": null,
          "new_api": "isplay_get_registry",
          "old_text": null,
          "new_text": "isplay_get_registry(wl->display.display);\n  ",
          "old_line_content": "",
          "new_line_content": "    wl->display.registry = wl_display_get_registry(wl->display.display);",
          "content_same": false
        },
        {
          "line": 849,
          "old_api": null,
          "new_api": "egistry_add_listener",
          "old_text": null,
          "new_text": "egistry_add_listener(wl->display.registry, &registry_listener, wl);\n\n ",
          "old_line_content": "static void destroy_display (struct vo_wayland_state *wl)",
          "new_line_content": "    wl_registry_add_listener(wl->display.registry, &registry_listener, wl);",
          "content_same": false
        },
        {
          "line": 851,
          "old_api": null,
          "new_api": "isplay_roundtrip",
          "old_text": null,
          "new_text": "isplay_roundtrip(wl->display.display);\n\n ",
          "old_line_content": "    struct vo_wayland_output *output = NULL;",
          "new_line_content": "    wl_display_roundtrip(wl->display.display);",
          "content_same": false
        },
        {
          "line": 853,
          "old_api": null,
          "new_api": "isplay_get_fd",
          "old_text": null,
          "new_text": "isplay_get_fd(wl->display.display);\n\n ",
          "old_line_content": "",
          "new_line_content": "    wl->display.display_fd = wl_display_get_fd(wl->display.display);",
          "content_same": false
        },
        {
          "line": 865,
          "old_api": null,
          "new_api": "utput_destroy",
          "old_text": null,
          "new_text": "utput_destroy(output->output);\n  ",
          "old_line_content": "    if (wl->display.shell)",
          "new_line_content": "            wl_output_destroy(output->output);",
          "content_same": false
        },
        {
          "line": 867,
          "old_api": null,
          "new_api": "ist_remove",
          "old_text": null,
          "new_text": "ist_remove(&output->link);\n  ",
          "old_line_content": "",
          "new_line_content": "            wl_list_remove(&output->link);",
          "content_same": false
        },
        {
          "line": 881,
          "old_api": null,
          "new_api": "ompositor_destroy",
          "old_text": null,
          "new_text": "ompositor_destroy(wl->display.compositor);\n\n ",
          "old_line_content": "}",
          "new_line_content": "        wl_compositor_destroy(wl->display.compositor);",
          "content_same": false
        },
        {
          "line": 884,
          "old_api": null,
          "new_api": "egistry_destroy",
          "old_text": null,
          "new_text": "egistry_destroy(wl->display.registry);\n\n ",
          "old_line_content": "{",
          "new_line_content": "        wl_registry_destroy(wl->display.registry);",
          "content_same": false
        },
        {
          "line": 887,
          "old_api": null,
          "new_api": "isplay_flush",
          "old_text": null,
          "new_text": "isplay_flush(wl->display.display);\n  ",
          "old_line_content": "",
          "new_line_content": "        wl_display_flush(wl->display.display);",
          "content_same": false
        },
        {
          "line": 895,
          "old_api": null,
          "new_api": "ompositor_create_surface",
          "old_text": null,
          "new_text": "ompositor_create_surface(wl->display.compositor);\n\n ",
          "old_line_content": "        if (!wl->window.shell_surface) {",
          "new_line_content": "        wl_compositor_create_surface(wl->display.compositor);",
          "content_same": false
        },
        {
          "line": 897,
          "old_api": null,
          "new_api": "urface_add_listener",
          "old_text": null,
          "new_text": "urface_add_listener(wl->window.video_surface,\n                            &surface_listener, wl);\n\n ",
          "old_line_content": "            return false;",
          "new_line_content": "    wl_surface_add_listener(wl->window.video_surface,",
          "content_same": false
        },
        {
          "line": 901,
          "old_api": null,
          "new_api": "hell_get_shell_surface",
          "old_text": null,
          "new_text": "hell_get_shell_surface(wl->display.shell,\n                                                              wl->window.video_surface);\n\n ",
          "old_line_content": "                                      &shell_surface_listener, wl);",
          "new_line_content": "        wl->window.shell_surface = wl_shell_get_shell_surface(wl->display.shell,",
          "content_same": false
        },
        {
          "line": 905,
          "old_api": null,
          "new_api": "RR",
          "old_text": null,
          "new_text": "RR(wl, \"creating shell surface failed\\n\");\n  ",
          "old_line_content": "    }",
          "new_line_content": "            MP_ERR(wl, \"creating shell surface failed\\n\");",
          "content_same": false
        },
        {
          "line": 909,
          "old_api": null,
          "new_api": "hell_surface_add_listener",
          "old_text": null,
          "new_text": "hell_surface_add_listener(wl->window.shell_surface,\n                                      &shell_surface_listener, wl);\n\n ",
          "old_line_content": "}",
          "new_line_content": "        wl_shell_surface_add_listener(wl->window.shell_surface,",
          "content_same": false
        },
        {
          "line": 912,
          "old_api": null,
          "new_api": "hell_surface_set_toplevel",
          "old_text": null,
          "new_text": "hell_surface_set_toplevel(wl->window.shell_surface);\n  ",
          "old_line_content": "{",
          "new_line_content": "        wl_shell_surface_set_toplevel(wl->window.shell_surface);",
          "content_same": false
        },
        {
          "line": 913,
          "old_api": null,
          "new_api": "hell_surface_set_class",
          "old_text": null,
          "new_text": "hell_surface_set_class(wl->window.shell_surface, \"mpv\");\n  ",
          "old_line_content": "    if (wl->window.shell_surface)",
          "new_line_content": "        wl_shell_surface_set_class(wl->window.shell_surface, \"mpv\");",
          "content_same": false
        },
        {
          "line": 916,
          "old_api": null,
          "new_api": "e_callback",
          "old_text": null,
          "new_text": "e_callback(wl, NULL, 0);\n  ",
          "old_line_content": "    if (wl->window.video_surface)",
          "new_line_content": "    frame_callback(wl, NULL, 0);",
          "content_same": false
        },
        {
          "line": 923,
          "old_api": null,
          "new_api": "hell_surface_destroy",
          "old_text": null,
          "new_text": "hell_surface_destroy(wl->window.shell_surface);\n\n ",
          "old_line_content": "static bool create_cursor (struct vo_wayland_state *wl)",
          "new_line_content": "        wl_shell_surface_destroy(wl->window.shell_surface);",
          "content_same": false
        },
        {
          "line": 929,
          "old_api": null,
          "new_api": "allback_destroy",
          "old_text": null,
          "new_text": "allback_destroy(wl->frame.callback);\n}\n",
          "old_line_content": "",
          "new_line_content": "        wl_callback_destroy(wl->frame.callback);",
          "content_same": false
        },
        {
          "line": 935,
          "old_api": null,
          "new_api": "RR",
          "old_text": null,
          "new_text": "RR(wl->vo, \"no shm interface available\\n\");\n  ",
          "old_line_content": "",
          "new_line_content": "        MP_ERR(wl->vo, \"no shm interface available\\n\");",
          "content_same": false
        },
        {
          "line": 940,
          "old_api": null,
          "new_api": "ompositor_create_surface",
          "old_text": null,
          "new_text": "ompositor_create_surface(wl->display.compositor);\n\n ",
          "old_line_content": "    return true;",
          "new_line_content": "        wl_compositor_create_surface(wl->display.compositor);",
          "content_same": false
        },
        {
          "line": 945,
          "old_api": null,
          "new_api": "ursor_theme_load",
          "old_text": null,
          "new_text": "ursor_theme_load(NULL, 32, wl->display.shm);\n  ",
          "old_line_content": "    if (wl->cursor.theme)",
          "new_line_content": "    wl->cursor.theme = wl_cursor_theme_load(NULL, 32, wl->display.shm);",
          "content_same": false
        },
        {
          "line": 955,
          "old_api": null,
          "new_api": "ursor_theme_destroy",
          "old_text": null,
          "new_text": "ursor_theme_destroy(wl->cursor.theme);\n\n ",
          "old_line_content": "",
          "new_line_content": "        wl_cursor_theme_destroy(wl->cursor.theme);",
          "content_same": false
        },
        {
          "line": 958,
          "old_api": null,
          "new_api": "urface_destroy",
          "old_text": null,
          "new_text": "urface_destroy(wl->cursor.surface);\n}\n",
          "old_line_content": "        return false;",
          "new_line_content": "        wl_surface_destroy(wl->cursor.surface);",
          "content_same": false
        },
        {
          "line": 963,
          "old_api": null,
          "new_api": "context_new",
          "old_text": null,
          "new_text": "context_new(0);\n\n ",
          "old_line_content": "    return true;",
          "new_line_content": "    wl->input.xkb.context = xkb_context_new(0);",
          "content_same": false
        },
        {
          "line": 966,
          "old_api": null,
          "new_api": "RR",
          "old_text": null,
          "new_text": "RR(wl, \"failed to initialize input: check xkbcommon\\n\");\n  ",
          "old_line_content": "static void destroy_input (struct vo_wayland_state *wl)",
          "new_line_content": "        MP_ERR(wl, \"failed to initialize input: check xkbcommon\\n\");",
          "content_same": false
        },
        {
          "line": 979,
          "old_api": null,
          "new_api": "keymap_unref",
          "old_text": null,
          "new_text": "keymap_unref(wl->input.xkb.keymap);\n  ",
          "old_line_content": "",
          "new_line_content": "        xkb_keymap_unref(wl->input.xkb.keymap);",
          "content_same": false
        },
        {
          "line": 980,
          "old_api": null,
          "new_api": "state_unref",
          "old_text": null,
          "new_text": "state_unref(wl->input.xkb.state);\n  ",
          "old_line_content": "    if (wl->input.datadev)",
          "new_line_content": "        xkb_state_unref(wl->input.xkb.state);",
          "content_same": false
        },
        {
          "line": 990,
          "old_api": null,
          "new_api": "ata_device_destroy",
          "old_text": null,
          "new_text": "ata_device_destroy(wl->input.datadev);\n\n ",
          "old_line_content": "/*** mplayer2 interface ***/",
          "new_line_content": "        wl_data_device_destroy(wl->input.datadev);",
          "content_same": false
        },
        {
          "line": 993,
          "old_api": null,
          "new_api": "ata_device_manager_destroy",
          "old_text": null,
          "new_text": "ata_device_manager_destroy(wl->input.devman);\n\n ",
          "old_line_content": "{",
          "new_line_content": "        wl_data_device_manager_destroy(wl->input.devman);",
          "content_same": false
        },
        {
          "line": 996,
          "old_api": null,
          "new_api": "eat_destroy",
          "old_text": null,
          "new_text": "eat_destroy(wl->input.seat);\n}\n",
          "old_line_content": "    wl->vo = vo;",
          "new_line_content": "        wl_seat_destroy(wl->input.seat);",
          "content_same": false
        },
        {
          "line": 1008,
          "old_api": null,
          "new_api": "ist_init",
          "old_text": null,
          "new_text": "ist_init(&wl->display.output_list);\n\n ",
          "old_line_content": "    }",
          "new_line_content": "    wl_list_init(&wl->display.output_list);",
          "content_same": false
        },
        {
          "line": 1010,
          "old_api": null,
          "new_api": "te_input",
          "old_text": null,
          "new_text": "te_input(wl)\n   ",
          "old_line_content": "    // create_display's roundtrip only adds the interfaces",
          "new_line_content": "    if (!create_input(wl)",
          "content_same": false
        },
        {
          "line": 1011,
          "old_api": null,
          "new_api": "te_display",
          "old_text": null,
          "new_text": "te_display(wl)\n   ",
          "old_line_content": "    // the second roundtrip receives output modes, geometry and more ...",
          "new_line_content": "        || !create_display(wl)",
          "content_same": false
        },
        {
          "line": 1013,
          "old_api": null,
          "new_api": "te_cursor",
          "old_text": null,
          "new_text": "te_cursor(wl))\n  ",
          "old_line_content": "",
          "new_line_content": "        || !create_cursor(wl))",
          "content_same": false
        },
        {
          "line": 1021,
          "old_api": null,
          "new_api": "isplay_roundtrip",
          "old_text": null,
          "new_text": "isplay_roundtrip(wl->display.display);\n\n ",
          "old_line_content": "                       o->make, o->model,",
          "new_line_content": "    wl_display_roundtrip(wl->display.display);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 1034,
          "old_api": "roy_cursor",
          "new_api": null,
          "old_text": "roy_cursor(wl);\n  ",
          "new_text": null,
          "old_line_content": "    destroy_cursor(wl);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1035,
          "old_api": "roy_window",
          "new_api": null,
          "old_text": "roy_window(wl);\n  ",
          "new_text": null,
          "old_line_content": "    destroy_window(wl);",
          "new_line_content": "    vo->event_fd = wl->display.display_fd;",
          "content_same": false
        },
        {
          "line": 1036,
          "old_api": "roy_display",
          "new_api": null,
          "old_text": "roy_display(wl);\n  ",
          "new_text": null,
          "old_line_content": "    destroy_display(wl);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1037,
          "old_api": "roy_input",
          "new_api": null,
          "old_text": "roy_input(wl);\n  ",
          "new_text": null,
          "old_line_content": "    destroy_input(wl);",
          "new_line_content": "    return true;",
          "content_same": false
        },
        {
          "line": 1038,
          "old_api": "oc_free",
          "new_api": null,
          "old_text": "oc_free(wl);\n  ",
          "new_text": null,
          "old_line_content": "    talloc_free(wl);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 1048,
          "old_api": "dule_resize",
          "new_api": null,
          "old_text": "dule_resize(wl, 0, wl->window.width, wl->window.height);\n}\n",
          "new_text": null,
          "old_line_content": "    schedule_resize(wl, 0, wl->window.width, wl->window.height);",
          "new_line_content": "    vo->wayland = NULL;",
          "content_same": false
        },
        {
          "line": 1060,
          "old_api": "BG",
          "new_api": null,
          "old_text": "BG(wl, \"going fullscreen\\n\");\n  ",
          "new_text": null,
          "old_line_content": "        MP_DBG(wl, \"going fullscreen\\n\");",
          "new_line_content": "static void vo_wayland_fullscreen (struct vo *vo)",
          "content_same": false
        },
        {
          "line": 1064,
          "old_api": "hell_surface_set_fullscreen",
          "new_api": null,
          "old_text": "hell_surface_set_fullscreen(wl->window.shell_surface,\n                WL_SHELL_SURFACE_FULLSCREEN_METHOD_DEFAULT,\n                0, fs_output);\n  ",
          "new_text": null,
          "old_line_content": "        wl_shell_surface_set_fullscreen(wl->window.shell_surface,",
          "new_line_content": "        return;",
          "content_same": false
        },
        {
          "line": 1070,
          "old_api": "BG",
          "new_api": null,
          "old_text": "BG(wl, \"leaving fullscreen\\n\");\n  ",
          "new_text": null,
          "old_line_content": "        MP_DBG(wl, \"leaving fullscreen\\n\");",
          "new_line_content": "        wl->window.is_fullscreen = true;",
          "content_same": false
        },
        {
          "line": 1072,
          "old_api": "ow_set_toplevel",
          "new_api": null,
          "old_text": "ow_set_toplevel(wl);\n  ",
          "new_text": null,
          "old_line_content": "        window_set_toplevel(wl);",
          "new_line_content": "        wl->window.p_height = wl->window.height;",
          "content_same": false
        },
        {
          "line": 1083,
          "old_api": "isplay_flush",
          "new_api": null,
          "old_text": "isplay_flush(dp);\n\n ",
          "new_text": null,
          "old_line_content": "    wl_display_flush(dp);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1096,
          "old_api": "(&fd, 1, 0) > 0",
          "new_api": null,
          "old_text": "(&fd, 1, 0) > 0",
          "new_text": null,
          "old_line_content": "    if (poll(&fd, 1, 0) > 0) {",
          "new_line_content": "        POLLIN | POLLOUT | POLLERR | POLLHUP,",
          "content_same": false
        },
        {
          "line": 1098,
          "old_api": "ATAL",
          "new_api": null,
          "old_text": "ATAL(wl, \"error occurred on the display fd: \"\n                         \"closing file descriptor\\n\");\n  ",
          "new_text": null,
          "old_line_content": "            MP_FATAL(wl, \"error occurred on the display fd: \"",
          "new_line_content": "    };",
          "content_same": false
        },
        {
          "line": 1100,
          "old_api": "e",
          "new_api": null,
          "old_text": "e(wl->display.display_fd);\n  ",
          "new_text": null,
          "old_line_content": "            close(wl->display.display_fd);",
          "new_line_content": "    /* wl_display_dispatch is blocking",
          "content_same": false
        },
        {
          "line": 1101,
          "old_api": "nput_put_key",
          "new_api": null,
          "old_text": "nput_put_key(vo->input_ctx, MP_KEY_CLOSE_WIN);\n  ",
          "new_text": null,
          "old_line_content": "            mp_input_put_key(vo->input_ctx, MP_KEY_CLOSE_WIN);",
          "new_line_content": "     * wl_dipslay_dispatch_pending is non-blocking but does not read from the fd",
          "content_same": false
        },
        {
          "line": 1104,
          "old_api": "isplay_dispatch",
          "new_api": null,
          "old_text": "isplay_dispatch(dp);\n  ",
          "new_text": null,
          "old_line_content": "            wl_display_dispatch(dp);",
          "new_line_content": "     * are events to read from the file descriptor through poll */",
          "content_same": false
        },
        {
          "line": 1106,
          "old_api": "isplay_flush",
          "new_api": null,
          "old_text": "isplay_flush(dp);\n  ",
          "new_text": null,
          "old_line_content": "            wl_display_flush(dp);",
          "new_line_content": "        if (fd.revents & POLLERR || fd.revents & POLLHUP) {",
          "content_same": false
        },
        {
          "line": 1117,
          "old_api": "(&fd, 1, 0) > 0",
          "new_api": null,
          "old_text": "(&fd, 1, 0) > 0",
          "new_text": null,
          "old_line_content": "        if (poll(&fd, 1, 0) > 0) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1119,
          "old_api": "RR",
          "new_api": null,
          "old_text": "RR(wl, \"error occured on the drag&drop fd\\n\");\n  ",
          "new_text": null,
          "old_line_content": "                MP_ERR(wl, \"error occured on the drag&drop fd\\n\");",
          "new_line_content": "     * there is data to read.",
          "content_same": false
        },
        {
          "line": 1120,
          "old_api": "e",
          "new_api": null,
          "old_text": "e(wl->input.dnd_fd);\n  ",
          "new_text": null,
          "old_line_content": "                close(wl->input.dnd_fd);",
          "new_line_content": "     * We only accept the mime type text/uri-list.",
          "content_same": false
        },
        {
          "line": 1134,
          "old_api": "(fd.fd, buffer+str_len, to_read))) {",
          "new_api": null,
          "old_text": "(fd.fd, buffer+str_len, to_read))) {",
          "new_text": null,
          "old_line_content": "                while (0 < (has_read = read(fd.fd, buffer+str_len, to_read))) {",
          "new_line_content": "                int const to_read = 2048;",
          "content_same": false
        },
        {
          "line": 1136,
          "old_api": "RR",
          "new_api": null,
          "old_text": "RR(wl, \"Integer overflow while reading from fd\\n\");\n  ",
          "new_text": null,
          "old_line_content": "                        MP_ERR(wl, \"Integer overflow while reading from fd\\n\");",
          "new_line_content": "                size_t buffer_len = to_read;",
          "content_same": false
        },
        {
          "line": 1142,
          "old_api": "loc",
          "new_api": null,
          "old_text": "loc(buffer, buffer_len);\n  ",
          "new_text": null,
          "old_line_content": "                    void *ptr = realloc(buffer, buffer_len);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1149,
          "old_api": "0",
          "new_api": null,
          "old_text": "0(buffer);\n  ",
          "new_text": null,
          "old_line_content": "                        struct bstr file_list = bstr0(buffer);",
          "new_line_content": "                    str_len += has_read;",
          "content_same": false
        },
        {
          "line": 1150,
          "old_api": "vent_drop_mime_data",
          "new_api": null,
          "old_text": "vent_drop_mime_data(vo->input_ctx, \"text/uri-list\",\n                                                file_list);\n  ",
          "new_text": null,
          "old_line_content": "                        mp_event_drop_mime_data(vo->input_ctx, \"text/uri-list\",",
          "new_line_content": "                    buffer_len += to_read;",
          "content_same": false
        },
        {
          "line": 1156,
          "old_api": "(buffer);",
          "new_api": null,
          "old_text": "(buffer);\n  ",
          "new_text": null,
          "old_line_content": "                free(buffer);",
          "new_line_content": "                    if (has_read < to_read) {",
          "content_same": false
        },
        {
          "line": 1160,
          "old_api": "e",
          "new_api": null,
          "old_text": "e(wl->input.dnd_fd);\n  ",
          "new_text": null,
          "old_line_content": "                close(wl->input.dnd_fd);",
          "new_line_content": "                                                file_list);",
          "content_same": false
        },
        {
          "line": 1184,
          "old_api": "ist_for_each_reverse",
          "new_api": null,
          "old_text": "ist_for_each_reverse(output, &wl->display.output_list, link) {\n ",
          "new_text": null,
          "old_line_content": "        wl_list_for_each_reverse(output, &wl->display.output_list, link) {",
          "new_line_content": "    *screenrc = (struct mp_rect){0};",
          "content_same": false
        },
        {
          "line": 1216,
          "old_api": "isplay_dispatch_pending",
          "new_api": null,
          "old_text": "isplay_dispatch_pending(wl->display.display);\n\n ",
          "new_text": null,
          "old_line_content": "    wl_display_dispatch_pending(wl->display.display);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1220,
          "old_api": "ayland_check_events",
          "new_api": null,
          "old_text": "ayland_check_events(vo);\n  ",
          "new_text": null,
          "old_line_content": "        *events |= vo_wayland_check_events(vo);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 1224,
          "old_api": "ayland_fullscreen",
          "new_api": null,
          "old_text": "ayland_fullscreen(vo);\n  ",
          "new_text": null,
          "old_line_content": "        vo_wayland_fullscreen(vo);",
          "new_line_content": "    struct vo_wayland_state *wl = vo->wayland;",
          "content_same": false
        },
        {
          "line": 1227,
          "old_api": "ayland_ontop",
          "new_api": null,
          "old_text": "ayland_ontop(vo);\n  ",
          "new_text": null,
          "old_line_content": "        vo_wayland_ontop(vo);",
          "new_line_content": "    switch (request) {",
          "content_same": false
        },
        {
          "line": 1238,
          "old_api": "dule_resize",
          "new_api": null,
          "old_text": "dule_resize(wl, 0, s[0], s[1]);\n  ",
          "new_text": null,
          "old_line_content": "            schedule_resize(wl, 0, s[0], s[1]);",
          "new_line_content": "    case VOCTRL_GET_UNFS_WINDOW_SIZE: {",
          "content_same": false
        },
        {
          "line": 1244,
          "old_api": "_cursor",
          "new_api": null,
          "old_text": "_cursor(wl);\n  ",
          "new_text": null,
          "old_line_content": "                show_cursor(wl);",
          "new_line_content": "    case VOCTRL_SET_UNFS_WINDOW_SIZE: {",
          "content_same": false
        },
        {
          "line": 1248,
          "old_api": "_cursor",
          "new_api": null,
          "old_text": "_cursor(wl);\n  ",
          "new_text": null,
          "old_line_content": "                hide_cursor(wl);",
          "new_line_content": "        return VO_TRUE;",
          "content_same": false
        },
        {
          "line": 1273,
          "old_api": "ayland_update_screeninfo",
          "new_api": null,
          "old_text": "ayland_update_screeninfo(vo, &screenrc);\n\n ",
          "new_text": null,
          "old_line_content": "    vo_wayland_update_screeninfo(vo, &screenrc);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1276,
          "old_api": "alc_window_geometry",
          "new_api": null,
          "old_text": "alc_window_geometry(vo, &screenrc, &geo);\n  ",
          "new_text": null,
          "old_line_content": "    vo_calc_window_geometry(vo, &screenrc, &geo);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1277,
          "old_api": "pply_window_geometry",
          "new_api": null,
          "old_text": "pply_window_geometry(vo, &geo);\n\n ",
          "new_text": null,
          "old_line_content": "    vo_apply_window_geometry(vo, &geo);",
          "new_line_content": "bool vo_wayland_config (struct vo *vo, uint32_t flags)",
          "content_same": false
        },
        {
          "line": 1281,
          "old_api": "X",
          "new_api": null,
          "old_text": "X(vo->dheight, 1);\n\n ",
          "new_text": null,
          "old_line_content": "    wl->window.aspect = vo->dwidth / (float) MPMAX(vo->dheight, 1);",
          "new_line_content": "    struct mp_rect screenrc;",
          "content_same": false
        },
        {
          "line": 807,
          "old_api": "allback_destroy",
          "new_api": null,
          "old_text": "allback_destroy(callback);\n\n ",
          "new_text": null,
          "old_line_content": "        wl_callback_destroy(callback);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 809,
          "old_api": "urface_frame",
          "new_api": null,
          "old_text": "urface_frame(wl->window.video_surface);\n\n ",
          "new_text": null,
          "old_line_content": "    wl->frame.callback = wl_surface_frame(wl->window.video_surface);",
          "new_line_content": "static void frame_callback(void *data,",
          "content_same": false
        },
        {
          "line": 812,
          "old_api": "RR",
          "new_api": null,
          "old_text": "RR(wl, \"wl_surface_frame failed\\n\");\n  ",
          "new_text": null,
          "old_line_content": "        MP_ERR(wl, \"wl_surface_frame failed\\n\");",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 826,
          "old_api": "nv",
          "new_api": null,
          "old_text": "nv(\"XDG_RUNTIME_DIR\"))\n  ",
          "new_text": null,
          "old_line_content": "    if (wl->vo->probing && !getenv(\"XDG_RUNTIME_DIR\"))",
          "new_line_content": "    wl->frame.pending = true;",
          "content_same": false
        },
        {
          "line": 829,
          "old_api": "isplay_connect",
          "new_api": null,
          "old_text": "isplay_connect(NULL);\n\n ",
          "new_text": null,
          "old_line_content": "    wl->display.display = wl_display_connect(NULL);",
          "new_line_content": "static const struct wl_callback_listener frame_listener = {",
          "content_same": false
        },
        {
          "line": 832,
          "old_api": "SG",
          "new_api": null,
          "old_text": "SG(wl, wl->vo->probing ? MSGL_V : MSGL_ERR,\n               \"failed to connect to a wayland server: \"\n               \"check if a wayland compositor is running\\n\");\n\n ",
          "new_text": null,
          "old_line_content": "        MP_MSG(wl, wl->vo->probing ? MSGL_V : MSGL_ERR,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 839,
          "old_api": "isplay_get_registry",
          "new_api": null,
          "old_text": "isplay_get_registry(wl->display.display);\n  ",
          "new_text": null,
          "old_line_content": "    wl->display.registry = wl_display_get_registry(wl->display.display);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 840,
          "old_api": "egistry_add_listener",
          "new_api": null,
          "old_text": "egistry_add_listener(wl->display.registry, &registry_listener, wl);\n\n ",
          "new_text": null,
          "old_line_content": "    wl_registry_add_listener(wl->display.registry, &registry_listener, wl);",
          "new_line_content": "    if (!wl->display.display) {",
          "content_same": false
        },
        {
          "line": 842,
          "old_api": "isplay_roundtrip",
          "new_api": null,
          "old_text": "isplay_roundtrip(wl->display.display);\n\n ",
          "new_text": null,
          "old_line_content": "    wl_display_roundtrip(wl->display.display);",
          "new_line_content": "               \"failed to connect to a wayland server: \"",
          "content_same": false
        },
        {
          "line": 844,
          "old_api": "isplay_get_fd",
          "new_api": null,
          "old_text": "isplay_get_fd(wl->display.display);\n\n ",
          "new_text": null,
          "old_line_content": "    wl->display.display_fd = wl_display_get_fd(wl->display.display);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 854,
          "old_api": "ist_for_each_safe",
          "new_api": null,
          "old_text": "ist_for_each_safe(output, tmp, &wl->display.output_list, link) {\n ",
          "new_text": null,
          "old_line_content": "    wl_list_for_each_safe(output, tmp, &wl->display.output_list, link) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 856,
          "old_api": "utput_destroy",
          "new_api": null,
          "old_text": "utput_destroy(output->output);\n  ",
          "new_text": null,
          "old_line_content": "            wl_output_destroy(output->output);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 858,
          "old_api": "ist_remove",
          "new_api": null,
          "old_text": "ist_remove(&output->link);\n  ",
          "new_text": null,
          "old_line_content": "            wl_list_remove(&output->link);",
          "new_line_content": "static void destroy_display (struct vo_wayland_state *wl)",
          "content_same": false
        },
        {
          "line": 866,
          "old_api": "hell_destroy",
          "new_api": null,
          "old_text": "hell_destroy(wl->display.shell);\n\n ",
          "new_text": null,
          "old_line_content": "        wl_shell_destroy(wl->display.shell);",
          "new_line_content": "            output->output = NULL;",
          "content_same": false
        },
        {
          "line": 869,
          "old_api": "ubcompositor_destroy",
          "new_api": null,
          "old_text": "ubcompositor_destroy(wl->display.subcomp);\n\n ",
          "new_text": null,
          "old_line_content": "        wl_subcompositor_destroy(wl->display.subcomp);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 879,
          "old_api": "isplay_disconnect",
          "new_api": null,
          "old_text": "isplay_disconnect(wl->display.display);\n  ",
          "new_text": null,
          "old_line_content": "        wl_display_disconnect(wl->display.display);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 886,
          "old_api": "ompositor_create_surface",
          "new_api": null,
          "old_text": "ompositor_create_surface(wl->display.compositor);\n\n ",
          "new_text": null,
          "old_line_content": "        wl_compositor_create_surface(wl->display.compositor);",
          "new_line_content": "    if (wl->display.display) {",
          "content_same": false
        },
        {
          "line": 892,
          "old_api": "hell_get_shell_surface",
          "new_api": null,
          "old_text": "hell_get_shell_surface(wl->display.shell,\n                                                              wl->window.video_surface);\n\n ",
          "new_text": null,
          "old_line_content": "        wl->window.shell_surface = wl_shell_get_shell_surface(wl->display.shell,",
          "new_line_content": "static bool create_window (struct vo_wayland_state *wl)",
          "content_same": false
        },
        {
          "line": 896,
          "old_api": "RR",
          "new_api": null,
          "old_text": "RR(wl, \"creating shell surface failed\\n\");\n  ",
          "new_text": null,
          "old_line_content": "            MP_ERR(wl, \"creating shell surface failed\\n\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 900,
          "old_api": "hell_surface_add_listener",
          "new_api": null,
          "old_text": "hell_surface_add_listener(wl->window.shell_surface,\n                                      &shell_surface_listener, wl);\n\n ",
          "new_text": null,
          "old_line_content": "        wl_shell_surface_add_listener(wl->window.shell_surface,",
          "new_line_content": "    if (wl->display.shell) {",
          "content_same": false
        },
        {
          "line": 903,
          "old_api": "hell_surface_set_toplevel",
          "new_api": null,
          "old_text": "hell_surface_set_toplevel(wl->window.shell_surface);\n  ",
          "new_text": null,
          "old_line_content": "        wl_shell_surface_set_toplevel(wl->window.shell_surface);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 904,
          "old_api": "hell_surface_set_class",
          "new_api": null,
          "old_text": "hell_surface_set_class(wl->window.shell_surface, \"mpv\");\n  ",
          "new_text": null,
          "old_line_content": "        wl_shell_surface_set_class(wl->window.shell_surface, \"mpv\");",
          "new_line_content": "        if (!wl->window.shell_surface) {",
          "content_same": false
        },
        {
          "line": 907,
          "old_api": "e_callback",
          "new_api": null,
          "old_text": "e_callback(wl, NULL, 0);\n  ",
          "new_text": null,
          "old_line_content": "    frame_callback(wl, NULL, 0);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 914,
          "old_api": "hell_surface_destroy",
          "new_api": null,
          "old_text": "hell_surface_destroy(wl->window.shell_surface);\n\n ",
          "new_text": null,
          "old_line_content": "        wl_shell_surface_destroy(wl->window.shell_surface);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 917,
          "old_api": "urface_destroy",
          "new_api": null,
          "old_text": "urface_destroy(wl->window.video_surface);\n\n ",
          "new_text": null,
          "old_line_content": "        wl_surface_destroy(wl->window.video_surface);",
          "new_line_content": "    return true;",
          "content_same": false
        },
        {
          "line": 920,
          "old_api": "allback_destroy",
          "new_api": null,
          "old_text": "allback_destroy(wl->frame.callback);\n}\n",
          "new_text": null,
          "old_line_content": "        wl_callback_destroy(wl->frame.callback);",
          "new_line_content": "static void destroy_window (struct vo_wayland_state *wl)",
          "content_same": false
        },
        {
          "line": 931,
          "old_api": "ompositor_create_surface",
          "new_api": null,
          "old_text": "ompositor_create_surface(wl->display.compositor);\n\n ",
          "new_text": null,
          "old_line_content": "        wl_compositor_create_surface(wl->display.compositor);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 936,
          "old_api": "ursor_theme_load",
          "new_api": null,
          "old_text": "ursor_theme_load(NULL, 32, wl->display.shm);\n  ",
          "new_text": null,
          "old_line_content": "    wl->cursor.theme = wl_cursor_theme_load(NULL, 32, wl->display.shm);",
          "new_line_content": "        return false;",
          "content_same": false
        },
        {
          "line": 937,
          "old_api": "ursor_theme_get_cursor",
          "new_api": null,
          "old_text": "ursor_theme_get_cursor(wl->cursor.theme,\n                                                           \"left_ptr\");\n\n ",
          "new_text": null,
          "old_line_content": "    wl->cursor.default_cursor = wl_cursor_theme_get_cursor(wl->cursor.theme,",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 949,
          "old_api": "urface_destroy",
          "new_api": null,
          "old_text": "urface_destroy(wl->cursor.surface);\n}\n",
          "new_text": null,
          "old_line_content": "        wl_surface_destroy(wl->cursor.surface);",
          "new_line_content": "    return true;",
          "content_same": false
        },
        {
          "line": 954,
          "old_api": "context_new",
          "new_api": null,
          "old_text": "context_new(0);\n\n ",
          "new_text": null,
          "old_line_content": "    wl->input.xkb.context = xkb_context_new(0);",
          "new_line_content": "    if (wl->cursor.theme)",
          "content_same": false
        },
        {
          "line": 957,
          "old_api": "RR",
          "new_api": null,
          "old_text": "RR(wl, \"failed to initialize input: check xkbcommon\\n\");\n  ",
          "new_text": null,
          "old_line_content": "        MP_ERR(wl, \"failed to initialize input: check xkbcommon\\n\");",
          "new_line_content": "    if (wl->cursor.surface)",
          "content_same": false
        },
        {
          "line": 969,
          "old_api": "eyboard_destroy",
          "new_api": null,
          "old_text": "eyboard_destroy(wl->input.keyboard);\n  ",
          "new_text": null,
          "old_line_content": "        wl_keyboard_destroy(wl->input.keyboard);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 970,
          "old_api": "keymap_unref",
          "new_api": null,
          "old_text": "keymap_unref(wl->input.xkb.keymap);\n  ",
          "new_text": null,
          "old_line_content": "        xkb_keymap_unref(wl->input.xkb.keymap);",
          "new_line_content": "    wl->input.dnd_fd = -1;",
          "content_same": false
        },
        {
          "line": 971,
          "old_api": "state_unref",
          "new_api": null,
          "old_text": "state_unref(wl->input.xkb.state);\n  ",
          "new_text": null,
          "old_line_content": "        xkb_state_unref(wl->input.xkb.state);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 975,
          "old_api": "context_unref",
          "new_api": null,
          "old_text": "context_unref(wl->input.xkb.context);\n\n ",
          "new_text": null,
          "old_line_content": "        xkb_context_unref(wl->input.xkb.context);",
          "new_line_content": "static void destroy_input (struct vo_wayland_state *wl)",
          "content_same": false
        },
        {
          "line": 981,
          "old_api": "ata_device_destroy",
          "new_api": null,
          "old_text": "ata_device_destroy(wl->input.datadev);\n\n ",
          "new_text": null,
          "old_line_content": "        wl_data_device_destroy(wl->input.datadev);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 994,
          "old_api": "oc_zero",
          "new_api": null,
          "old_text": "oc_zero(NULL, struct vo_wayland_state);\n  ",
          "new_text": null,
          "old_line_content": "    vo->wayland = talloc_zero(NULL, struct vo_wayland_state);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 997,
          "old_api": "og_new",
          "new_api": null,
          "old_text": "og_new(wl, vo->log, \"wayland\");\n\n ",
          "new_text": null,
          "old_line_content": "    wl->log = mp_log_new(wl, vo->log, \"wayland\");",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 999,
          "old_api": "ist_init",
          "new_api": null,
          "old_text": "ist_init(&wl->display.output_list);\n\n ",
          "new_text": null,
          "old_line_content": "    wl_list_init(&wl->display.output_list);",
          "new_line_content": "/*** mplayer2 interface ***/",
          "content_same": false
        },
        {
          "line": 1001,
          "old_api": "te_input",
          "new_api": null,
          "old_text": "te_input(wl)\n   ",
          "new_text": null,
          "old_line_content": "    if (!create_input(wl)",
          "new_line_content": "int vo_wayland_init (struct vo *vo)",
          "content_same": false
        },
        {
          "line": 1002,
          "old_api": "te_display",
          "new_api": null,
          "old_text": "te_display(wl)\n   ",
          "new_text": null,
          "old_line_content": "        || !create_display(wl)",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 1004,
          "old_api": "te_cursor",
          "new_api": null,
          "old_text": "te_cursor(wl))\n  ",
          "new_text": null,
          "old_line_content": "        || !create_cursor(wl))",
          "new_line_content": "    struct vo_wayland_state *wl = vo->wayland;",
          "content_same": false
        },
        {
          "line": 1016,
          "old_api": "ERBOSE",
          "new_api": null,
          "old_text": "ERBOSE(wl, \"output received:\\n\"\n                       \"\\tvendor: %s\\n\"\n                       \"\\tmodel: %s\\n\"\n                       \"\\tw: %d, h: %d\\n\"\n                       \"\\tHz: %d\\n\",\n                       o->make, o->model,\n                       o->width, o->height,\n                       o->refresh_rate / 1000);\n  ",
          "new_text": null,
          "old_line_content": "        MP_VERBOSE(wl, \"output received:\\n\"",
          "new_line_content": "        return false;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 22,
      "total_additions": 88,
      "total_deletions": 83,
      "total_api_changes": 193
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 9,
        "api_related_lines": 193,
        "non_api_lines": 4,
        "non_api_line_numbers": [
          800,
          801,
          806,
          798
        ]
      }
    },
    "api_calls_before": 200,
    "api_calls_after": 205,
    "diff_info": {
      "added_lines": 9,
      "removed_lines": 0,
      "total_diff_lines": 21
    }
  }
}