{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/7ff4a27eb600dc01d20547880056c13d6cf3e9e7",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/7ff4a27eb600dc01d20547880056c13d6cf3e9e7/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/7ff4a27eb600dc01d20547880056c13d6cf3e9e7/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/7ff4a27eb600dc01d20547880056c13d6cf3e9e7/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 80,
          "old_api": "js_newstate",
          "new_api": "talloc_zero",
          "old_text": "js_newstate(0, 0, JS_STRICT)",
          "new_text": "talloc_zero(ft, struct priv)",
          "old_line_content": "    p->J = js_newstate(0, 0, JS_STRICT);",
          "new_line_content": "    struct priv *p = talloc_zero(ft, struct priv);",
          "content_same": false
        },
        {
          "line": 85,
          "old_api": "talloc_set_destructor",
          "new_api": "MP_ERR",
          "old_text": "talloc_set_destructor(p, destruct_priv)",
          "new_text": "MP_ERR(ft, \"jsre: VM init error\\n\")",
          "old_line_content": "    talloc_set_destructor(p, destruct_priv);",
          "new_line_content": "        MP_ERR(ft, \"jsre: VM init error\\n\");",
          "content_same": false
        },
        {
          "line": 93,
          "old_api": "js_pop",
          "new_api": "p_regcomp",
          "old_text": "js_pop(p->J, 1)",
          "new_text": "p_regcomp(p->J, p->num_regexes, item, JS_REGEXP_I | JS_REGEXP_M)",
          "old_line_content": "            js_pop(p->J, 1);",
          "new_line_content": "        int err = p_regcomp(p->J, p->num_regexes, item, JS_REGEXP_I | JS_REGEXP_M);",
          "content_same": false
        },
        {
          "line": 118,
          "old_api": "p_regexec",
          "new_api": "strlen",
          "old_text": "p_regexec(p->J, n, text, &found)",
          "new_text": "strlen(text)",
          "old_line_content": "        int found, err = p_regexec(p->J, n, text, &found);",
          "new_line_content": "        sd_ass_to_plaintext(text, strlen(text), text);",
          "content_same": false
        },
        {
          "line": 121,
          "old_api": "MP_MSG",
          "new_api": "p_regexec",
          "old_text": "MP_MSG(ft, level, \"jsre: regex %d => drop: '%s'\\n\", n, text)",
          "new_text": "p_regexec(p->J, n, text, &found)",
          "old_line_content": "            MP_MSG(ft, level, \"jsre: regex %d => drop: '%s'\\n\", n, text);",
          "new_line_content": "        int found, err = p_regexec(p->J, n, text, &found);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 128,
          "old_api": null,
          "new_api": "get_err",
          "old_text": null,
          "new_text": "get_err(p->J)",
          "old_line_content": "    }",
          "new_line_content": "            MP_WARN(ft, \"jsre: test regex %d: %s.\\n\", n, get_err(p->J));",
          "content_same": false
        },
        {
          "line": 129,
          "old_api": null,
          "new_api": "js_pop",
          "old_text": null,
          "new_text": "js_pop(p->J, 1)",
          "old_line_content": "",
          "new_line_content": "            js_pop(p->J, 1);",
          "content_same": false
        },
        {
          "line": 96,
          "old_api": null,
          "new_api": "js_pop",
          "old_text": null,
          "new_text": "js_pop(p->J, 1)",
          "old_line_content": "",
          "new_line_content": "            js_pop(p->J, 1);",
          "content_same": false
        },
        {
          "line": 133,
          "old_api": null,
          "new_api": "talloc_free",
          "old_text": null,
          "new_text": "talloc_free(text)",
          "old_line_content": "",
          "new_line_content": "    talloc_free(text);",
          "content_same": false
        },
        {
          "line": 106,
          "old_api": null,
          "new_api": "sd_ass_fmt_offset",
          "old_text": null,
          "new_text": "sd_ass_fmt_offset(ft->event_format)",
          "old_line_content": "",
          "new_line_content": "    p->offset = sd_ass_fmt_offset(ft->event_format);",
          "content_same": false
        },
        {
          "line": 114,
          "old_api": null,
          "new_api": "sd_ass_pkt_text",
          "old_text": null,
          "new_text": "sd_ass_pkt_text(ft, pkt, p->offset)",
          "old_line_content": "    if (ft->opts->rf_plain)",
          "new_line_content": "    char *text = bstrto0(NULL, sd_ass_pkt_text(ft, pkt, p->offset));",
          "content_same": false
        },
        {
          "line": 83,
          "old_api": null,
          "new_api": "js_newstate",
          "old_text": null,
          "new_text": "js_newstate(0, 0, JS_STRICT)",
          "old_line_content": "        return false;",
          "new_line_content": "    p->J = js_newstate(0, 0, JS_STRICT);",
          "content_same": false
        },
        {
          "line": 88,
          "old_api": null,
          "new_api": "talloc_set_destructor",
          "old_text": null,
          "new_text": "talloc_set_destructor(p, destruct_priv)",
          "old_line_content": "        char *item = ft->opts->jsre_items[n];",
          "new_line_content": "    talloc_set_destructor(p, destruct_priv);",
          "content_same": false
        },
        {
          "line": 124,
          "old_api": null,
          "new_api": "MP_MSG",
          "old_text": null,
          "new_text": "MP_MSG(ft, level, \"jsre: regex %d => drop: '%s'\\n\", n, text)",
          "old_line_content": "        } else if (err) {",
          "new_line_content": "            MP_MSG(ft, level, \"jsre: regex %d => drop: '%s'\\n\", n, text);",
          "content_same": false
        },
        {
          "line": 95,
          "old_api": null,
          "new_api": "get_err",
          "old_text": null,
          "new_text": "get_err(p->J)",
          "old_line_content": "        }",
          "new_line_content": "            MP_ERR(ft, \"jsre: %s -- '%s'\\n\", get_err(p->J), item);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 130,
          "old_api": "talloc_free",
          "new_api": null,
          "old_text": "talloc_free(text)",
          "new_text": null,
          "old_line_content": "    talloc_free(text);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 103,
          "old_api": "sd_ass_fmt_offset",
          "new_api": null,
          "old_text": "sd_ass_fmt_offset(ft->event_format)",
          "new_text": null,
          "old_line_content": "    p->offset = sd_ass_fmt_offset(ft->event_format);",
          "new_line_content": "    if (!p->num_regexes)",
          "content_same": false
        },
        {
          "line": 77,
          "old_api": "talloc_zero",
          "new_api": null,
          "old_text": "talloc_zero(ft, struct priv)",
          "new_text": null,
          "old_line_content": "    struct priv *p = talloc_zero(ft, struct priv);",
          "new_line_content": "    if (!(ft->opts->jsre_items && ft->opts->jsre_items[0]))",
          "content_same": false
        },
        {
          "line": 111,
          "old_api": "sd_ass_pkt_text",
          "new_api": null,
          "old_text": "sd_ass_pkt_text(ft, pkt, p->offset)",
          "new_text": null,
          "old_line_content": "    char *text = bstrto0(NULL, sd_ass_pkt_text(ft, pkt, p->offset));",
          "new_line_content": "                                      struct demux_packet *pkt)",
          "content_same": false
        },
        {
          "line": 82,
          "old_api": "MP_ERR",
          "new_api": null,
          "old_text": "MP_ERR(ft, \"jsre: VM init error\\n\")",
          "new_text": null,
          "old_line_content": "        MP_ERR(ft, \"jsre: VM init error\\n\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 115,
          "old_api": "strlen",
          "new_api": null,
          "old_text": "strlen(text)",
          "new_text": null,
          "old_line_content": "        sd_ass_to_plaintext(text, strlen(text), text);",
          "new_line_content": "    bool drop = false;",
          "content_same": false
        },
        {
          "line": 90,
          "old_api": "p_regcomp",
          "new_api": null,
          "old_text": "p_regcomp(p->J, p->num_regexes, item, JS_REGEXP_I | JS_REGEXP_M)",
          "new_text": null,
          "old_line_content": "        int err = p_regcomp(p->J, p->num_regexes, item, JS_REGEXP_I | JS_REGEXP_M);",
          "new_line_content": "    for (int n = 0; ft->opts->jsre_items[n]; n++) {",
          "content_same": false
        },
        {
          "line": 92,
          "old_api": "get_err",
          "new_api": null,
          "old_text": "get_err(p->J)",
          "new_text": null,
          "old_line_content": "            MP_ERR(ft, \"jsre: %s -- '%s'\\n\", get_err(p->J), item);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 125,
          "old_api": "get_err",
          "new_api": null,
          "old_text": "get_err(p->J)",
          "new_text": null,
          "old_line_content": "            MP_WARN(ft, \"jsre: test regex %d: %s.\\n\", n, get_err(p->J));",
          "new_line_content": "            drop = true;",
          "content_same": false
        },
        {
          "line": 126,
          "old_api": "js_pop",
          "new_api": null,
          "old_text": "js_pop(p->J, 1)",
          "new_text": null,
          "old_line_content": "            js_pop(p->J, 1);",
          "new_line_content": "            break;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 5,
      "total_additions": 10,
      "total_deletions": 10,
      "total_api_changes": 25
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 5,
        "api_related_lines": 25,
        "non_api_lines": 3,
        "non_api_line_numbers": [
          87,
          78,
          79
        ]
      }
    },
    "api_calls_before": 40,
    "api_calls_after": 40,
    "diff_info": {
      "added_lines": 4,
      "removed_lines": 1,
      "total_diff_lines": 24
    }
  }
}