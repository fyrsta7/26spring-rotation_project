{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/f9084c7bcea608be641f00123257a57b9f1e4ccc",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/f9084c7bcea608be641f00123257a57b9f1e4ccc/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/f9084c7bcea608be641f00123257a57b9f1e4ccc/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/f9084c7bcea608be641f00123257a57b9f1e4ccc/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 409,
          "old_api": "abort",
          "new_api": "MPMAX",
          "old_text": "abort()",
          "new_text": "MPMAX(avail, 1)",
          "old_line_content": "        abort();",
          "new_line_content": "    size = vsnprintf(dest, MPMAX(avail, 1), fmt, copy);",
          "content_same": false
        },
        {
          "line": 424,
          "old_api": "bstr_cut",
          "new_api": "bstr_splice",
          "old_text": "bstr_cut(s, -suffix.len)",
          "new_text": "bstr_splice(s, 0, prefix.len)",
          "old_line_content": "    struct bstr end = bstr_cut(s, -suffix.len);",
          "new_line_content": "    struct bstr start = bstr_splice(s, 0, prefix.len);",
          "content_same": false
        },
        {
          "line": 430,
          "old_api": "bstrrchr",
          "new_api": "bstr_cut",
          "old_text": "bstrrchr(str, '.')",
          "new_text": "bstr_cut(s, -suffix.len)",
          "old_line_content": "    int dotpos = bstrrchr(str, '.');",
          "new_line_content": "    struct bstr end = bstr_cut(s, -suffix.len);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 416,
          "old_api": null,
          "new_api": "resize_append",
          "old_text": null,
          "new_text": "resize_append(talloc_ctx, s, size + 1)",
          "old_line_content": "bool bstr_case_startswith(struct bstr s, struct bstr prefix)",
          "new_line_content": "        resize_append(talloc_ctx, s, size + 1);",
          "content_same": false
        },
        {
          "line": 417,
          "old_api": null,
          "new_api": "vsnprintf",
          "old_text": null,
          "new_text": "vsnprintf(s->start + s->len, size + 1, fmt, ap)",
          "old_line_content": "{",
          "new_line_content": "        vsnprintf(s->start + s->len, size + 1, fmt, ap);",
          "content_same": false
        },
        {
          "line": 431,
          "old_api": null,
          "new_api": "bstrcasecmp",
          "old_text": null,
          "new_text": "bstrcasecmp(end, suffix)",
          "old_line_content": "    if (dotpos < 0)",
          "new_line_content": "    return end.len == suffix.len && bstrcasecmp(end, suffix) == 0;",
          "content_same": false
        },
        {
          "line": 404,
          "old_api": null,
          "new_api": "talloc_get_size",
          "old_text": null,
          "new_text": "talloc_get_size(s->start)",
          "old_line_content": "    char c;",
          "new_line_content": "    size_t avail = talloc_get_size(s->start) - s->len;",
          "content_same": false
        },
        {
          "line": 436,
          "old_api": null,
          "new_api": "bstrrchr",
          "old_text": null,
          "new_text": "bstrrchr(str, '.')",
          "old_line_content": "struct bstr bstr_get_ext(struct bstr s)",
          "new_line_content": "    int dotpos = bstrrchr(str, '.');",
          "content_same": false
        },
        {
          "line": 410,
          "old_api": null,
          "new_api": "va_end",
          "old_text": null,
          "new_text": "va_end(copy)",
          "old_line_content": "",
          "new_line_content": "    va_end(copy);",
          "content_same": false
        },
        {
          "line": 444,
          "old_api": null,
          "new_api": "bstrrchr",
          "old_text": null,
          "new_text": "bstrrchr(s, '.')",
          "old_line_content": "",
          "new_line_content": "    int dotpos = bstrrchr(s, '.');",
          "content_same": false
        },
        {
          "line": 413,
          "old_api": null,
          "new_api": "abort",
          "old_text": null,
          "new_text": "abort()",
          "old_line_content": "    s->len += size;",
          "new_line_content": "        abort();",
          "content_same": false
        },
        {
          "line": 447,
          "old_api": null,
          "new_api": "bstr_splice",
          "old_text": null,
          "new_text": "bstr_splice(s, dotpos + 1, s.len)",
          "old_line_content": "",
          "new_line_content": "    return bstr_splice(s, dotpos + 1, s.len);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 418,
          "old_api": "bstr_splice",
          "new_api": null,
          "old_text": "bstr_splice(s, 0, prefix.len)",
          "new_text": null,
          "old_line_content": "    struct bstr start = bstr_splice(s, 0, prefix.len);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 419,
          "old_api": "bstrcasecmp",
          "new_api": null,
          "old_text": "bstrcasecmp(start, prefix)",
          "new_text": null,
          "old_line_content": "    return start.len == prefix.len && bstrcasecmp(start, prefix) == 0;",
          "new_line_content": "    s->len += size;",
          "content_same": false
        },
        {
          "line": 405,
          "old_api": "vsnprintf",
          "new_api": null,
          "old_text": "vsnprintf(&c, 1, fmt, copy)",
          "new_text": null,
          "old_line_content": "    size = vsnprintf(&c, 1, fmt, copy);",
          "new_line_content": "    char *dest = s->start ? s->start + s->len : NULL;",
          "content_same": false
        },
        {
          "line": 406,
          "old_api": "va_end",
          "new_api": null,
          "old_text": "va_end(copy)",
          "new_text": null,
          "old_line_content": "    va_end(copy);",
          "new_line_content": "    char c;",
          "content_same": false
        },
        {
          "line": 438,
          "old_api": "bstrrchr",
          "new_api": null,
          "old_text": "bstrrchr(s, '.')",
          "new_text": null,
          "old_line_content": "    int dotpos = bstrrchr(s, '.');",
          "new_line_content": "        return str;",
          "content_same": false
        },
        {
          "line": 441,
          "old_api": "bstr_splice",
          "new_api": null,
          "old_text": "bstr_splice(s, dotpos + 1, s.len)",
          "new_text": null,
          "old_line_content": "    return bstr_splice(s, dotpos + 1, s.len);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 411,
          "old_api": "resize_append",
          "new_api": null,
          "old_text": "resize_append(talloc_ctx, s, size + 1)",
          "new_text": null,
          "old_line_content": "    resize_append(talloc_ctx, s, size + 1);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 412,
          "old_api": "vsnprintf",
          "new_api": null,
          "old_text": "vsnprintf(s->start + s->len, size + 1, fmt, ap)",
          "new_text": null,
          "old_line_content": "    vsnprintf(s->start + s->len, size + 1, fmt, ap);",
          "new_line_content": "    if (size < 0)",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 3,
      "total_additions": 9,
      "total_deletions": 8,
      "total_api_changes": 20
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 11,
        "api_related_lines": 20,
        "non_api_lines": 3,
        "non_api_line_numbers": [
          408,
          415,
          407
        ]
      }
    },
    "api_calls_before": 81,
    "api_calls_after": 83,
    "diff_info": {
      "added_lines": 9,
      "removed_lines": 3,
      "total_diff_lines": 30
    }
  }
}