{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/449d9725c91af467b154817dfd0603d80ba7f00b",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/449d9725c91af467b154817dfd0603d80ba7f00b/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/449d9725c91af467b154817dfd0603d80ba7f00b/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/449d9725c91af467b154817dfd0603d80ba7f00b/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 182,
          "old_api": "open_f",
          "new_api": "close_f",
          "old_text": "open_f(s)",
          "new_text": "close_f(s)",
          "old_line_content": "        return open_f(s);",
          "new_line_content": "        close_f(s);",
          "content_same": false
        },
        {
          "line": 205,
          "old_api": "av_dict_set",
          "new_api": "mp_get_config_group",
          "old_text": "av_dict_set(dict, \"user_agent\", opts->useragent, 0)",
          "new_text": "mp_get_config_group(temp, global, &stream_lavf_conf)",
          "old_line_content": "        av_dict_set(dict, \"user_agent\", opts->useragent, 0);",
          "new_line_content": "        mp_get_config_group(temp, global, &stream_lavf_conf);",
          "content_same": false
        },
        {
          "line": 209,
          "old_api": "mp_get_user_path",
          "new_api": "av_dict_set",
          "old_text": "mp_get_user_path(temp, global, file)",
          "new_text": "av_dict_set(dict, \"user_agent\", opts->useragent, 0)",
          "old_line_content": "            file = mp_get_user_path(temp, global, file);",
          "new_line_content": "        av_dict_set(dict, \"user_agent\", opts->useragent, 0);",
          "content_same": false
        },
        {
          "line": 214,
          "old_api": "av_dict_set",
          "new_api": "cookies_lavf",
          "old_text": "av_dict_set(dict, \"tls_verify\", opts->tls_verify ? \"1\" : \"0\", 0)",
          "new_text": "cookies_lavf(temp, log, file)",
          "old_line_content": "    av_dict_set(dict, \"tls_verify\", opts->tls_verify ? \"1\" : \"0\", 0);",
          "new_line_content": "        char *cookies = cookies_lavf(temp, log, file);",
          "content_same": false
        },
        {
          "line": 232,
          "old_api": "strlen",
          "new_api": "talloc_asprintf_append",
          "old_text": "strlen(cust_headers)",
          "new_text": "talloc_asprintf_append(cust_headers, \"%s\\r\\n\",\n                                                  opts->http_header_fields[n])",
          "old_line_content": "    if (strlen(cust_headers))",
          "new_line_content": "            cust_headers = talloc_asprintf_append(cust_headers, \"%s\\r\\n\",",
          "content_same": false
        },
        {
          "line": 238,
          "old_api": "snprintf",
          "new_api": "av_dict_set",
          "old_text": "snprintf(buf, sizeof(buf), \"%lld\", (long long)(opts->timeout * 1e6))",
          "new_text": "av_dict_set(dict, \"icy\", \"1\", 0)",
          "old_line_content": "        snprintf(buf, sizeof(buf), \"%lld\", (long long)(opts->timeout * 1e6));",
          "new_line_content": "    av_dict_set(dict, \"icy\", \"1\", 0);",
          "content_same": false
        },
        {
          "line": 242,
          "old_api": "mp_set_avdict",
          "new_api": "snprintf",
          "old_text": "mp_set_avdict(dict, opts->avopts)",
          "new_text": "snprintf(buf, sizeof(buf), \"%lld\", (long long)(opts->timeout * 1e6))",
          "old_line_content": "    mp_set_avdict(dict, opts->avopts);",
          "new_line_content": "        snprintf(buf, sizeof(buf), \"%lld\", (long long)(opts->timeout * 1e6));",
          "content_same": false
        },
        {
          "line": 280,
          "old_api": "strlen",
          "new_api": "MP_ERR",
          "old_text": "strlen(prefix[i])",
          "new_text": "MP_ERR(stream, \"No URL\\n\")",
          "old_line_content": "        if (!strncmp(filename, prefix[i], strlen(prefix[i])))",
          "new_line_content": "        MP_ERR(stream, \"No URL\\n\");",
          "content_same": false
        },
        {
          "line": 300,
          "old_api": "BSTR_P",
          "new_api": "bstr0",
          "old_text": "BSTR_P(b_filename)",
          "new_text": "bstr0(filename)",
          "old_line_content": "        filename = talloc_asprintf(temp, \"mmsh://%.*s\", BSTR_P(b_filename));",
          "new_line_content": "    bstr b_filename = bstr0(filename);",
          "content_same": false
        },
        {
          "line": 316,
          "old_api": "av_dict_set",
          "new_api": "strncmp",
          "old_text": "av_dict_set(&dict, \"timeout\", \"0\", 0)",
          "new_text": "strncmp(filename, \"rtmp\", 4)",
          "old_line_content": "        av_dict_set(&dict, \"timeout\", \"0\", 0);",
          "new_line_content": "    if (strncmp(filename, \"rtmp\", 4) == 0) {",
          "content_same": false
        },
        {
          "line": 331,
          "old_api": "av_opt_get",
          "new_api": "mp_avdict_print_unset",
          "old_text": "av_opt_get(avio, \"mime_type\", AV_OPT_SEARCH_CHILDREN, &mt)",
          "new_text": "mp_avdict_print_unset(stream->log, MSGL_V, dict)",
          "old_line_content": "        if (av_opt_get(avio, \"mime_type\", AV_OPT_SEARCH_CHILDREN, &mt) >= 0) {",
          "new_line_content": "    mp_avdict_print_unset(stream->log, MSGL_V, dict);",
          "content_same": false
        },
        {
          "line": 383,
          "old_api": "talloc_zero",
          "new_api": "bstr0",
          "old_text": "talloc_zero(NULL, struct mp_tags)",
          "new_text": "bstr0(icy_packet)",
          "old_line_content": "    res = talloc_zero(NULL, struct mp_tags);",
          "new_line_content": "    bstr packet = bstr0(icy_packet);",
          "content_same": false
        },
        {
          "line": 387,
          "old_api": "bstr_getline",
          "new_api": "talloc_zero",
          "old_text": "bstr_getline(header, &header)",
          "new_text": "talloc_zero(NULL, struct mp_tags)",
          "old_line_content": "        bstr line = bstr_strip_linebreaks(bstr_getline(header, &header));",
          "new_line_content": "    res = talloc_zero(NULL, struct mp_tags);",
          "content_same": false
        },
        {
          "line": 389,
          "old_api": "bstr_split_tok",
          "new_api": "bstr0",
          "old_text": "bstr_split_tok(line, \": \", &name, &val)",
          "new_text": "bstr0(icy_header)",
          "old_line_content": "        if (bstr_split_tok(line, \": \", &name, &val))",
          "new_line_content": "    bstr header = bstr0(icy_header);",
          "content_same": false
        },
        {
          "line": 393,
          "old_api": "bstr0",
          "new_api": "bstr_split_tok",
          "old_text": "bstr0(\"StreamTitle='\")",
          "new_text": "bstr_split_tok(line, \": \", &name, &val)",
          "old_line_content": "    bstr head = bstr0(\"StreamTitle='\");",
          "new_line_content": "        if (bstr_split_tok(line, \": \", &name, &val))",
          "content_same": false
        },
        {
          "line": 394,
          "old_api": "bstr_find",
          "new_api": "mp_tags_set_bstr",
          "old_text": "bstr_find(packet, head)",
          "new_text": "mp_tags_set_bstr(res, name, val)",
          "old_line_content": "    int i = bstr_find(packet, head);",
          "new_line_content": "            mp_tags_set_bstr(res, name, val);",
          "content_same": false
        },
        {
          "line": 398,
          "old_api": "bstr_splice",
          "new_api": "bstr_find",
          "old_text": "bstr_splice(packet, 0, end)",
          "new_text": "bstr_find(packet, head)",
          "old_line_content": "        packet = bstr_splice(packet, 0, end);",
          "new_line_content": "    int i = bstr_find(packet, head);",
          "content_same": false
        },
        {
          "line": 402,
          "old_api": "av_opt_set",
          "new_api": "bstr_splice",
          "old_text": "av_opt_set(avio, \"icy_metadata_packet\", \"-\", AV_OPT_SEARCH_CHILDREN)",
          "new_text": "bstr_splice(packet, 0, end)",
          "old_line_content": "    av_opt_set(avio, \"icy_metadata_packet\", \"-\", AV_OPT_SEARCH_CHILDREN);",
          "new_line_content": "        packet = bstr_splice(packet, 0, end);",
          "content_same": false
        },
        {
          "line": 406,
          "old_api": "av_free",
          "new_api": "av_opt_set",
          "old_text": "av_free(icy_packet)",
          "new_text": "av_opt_set(avio, \"icy_metadata_packet\", \"-\", AV_OPT_SEARCH_CHILDREN)",
          "old_line_content": "    av_free(icy_packet);",
          "new_line_content": "    av_opt_set(avio, \"icy_metadata_packet\", \"-\", AV_OPT_SEARCH_CHILDREN);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 256,
          "old_api": null,
          "new_api": "bstr0",
          "old_text": null,
          "new_text": "bstr0(filename)",
          "old_line_content": "            // Also don't double-scape, so include '%'.",
          "new_line_content": "    bstr proto = mp_split_proto(bstr0(filename), NULL);",
          "content_same": false
        },
        {
          "line": 384,
          "old_api": null,
          "new_api": "bstr_equals0",
          "old_text": null,
          "new_text": "bstr_equals0(packet, \"-\")",
          "old_line_content": "",
          "new_line_content": "    if (bstr_equals0(packet, \"-\"))",
          "content_same": false
        },
        {
          "line": 258,
          "old_api": null,
          "new_api": "bstr_equals0",
          "old_text": null,
          "new_text": "bstr_equals0(proto, http_like[n])",
          "old_line_content": "    }",
          "new_line_content": "        if (bstr_equals0(proto, http_like[n]))",
          "content_same": false
        },
        {
          "line": 133,
          "old_api": null,
          "new_api": "avio_size",
          "old_text": null,
          "new_text": "avio_size(avio)",
          "old_line_content": "        }",
          "new_line_content": "        size = avio_size(avio);",
          "content_same": false
        },
        {
          "line": 261,
          "old_api": null,
          "new_api": "mp_url_escape",
          "old_text": null,
          "new_text": "mp_url_escape(ta_parent, filename, \":/?#[]@!$&'()*+,;=%\")",
          "old_line_content": "",
          "new_line_content": "            return mp_url_escape(ta_parent, filename, \":/?#[]@!$&'()*+,;=%\");",
          "content_same": false
        },
        {
          "line": 391,
          "old_api": null,
          "new_api": "bstr_getline",
          "old_text": null,
          "new_text": "bstr_getline(header, &header)",
          "old_line_content": "    }",
          "new_line_content": "        bstr line = bstr_strip_linebreaks(bstr_getline(header, &header));",
          "content_same": false
        },
        {
          "line": 141,
          "old_api": null,
          "new_api": "avio_seek_time",
          "old_text": null,
          "new_text": "avio_seek_time(avio, c->stream_index, c->timestamp, c->flags)",
          "old_line_content": "        }",
          "new_line_content": "        int64_t r = avio_seek_time(avio, c->stream_index, c->timestamp, c->flags);",
          "content_same": false
        },
        {
          "line": 143,
          "old_api": null,
          "new_api": "stream_drop_buffers",
          "old_text": null,
          "new_text": "stream_drop_buffers(s)",
          "old_line_content": "    }",
          "new_line_content": "            stream_drop_buffers(s);",
          "content_same": false
        },
        {
          "line": 271,
          "old_api": null,
          "new_api": "talloc_new",
          "old_text": null,
          "new_text": "talloc_new(NULL)",
          "old_line_content": "",
          "new_line_content": "    void *temp = talloc_new(NULL);",
          "content_same": false
        },
        {
          "line": 400,
          "old_api": null,
          "new_api": "bstr_cut",
          "old_text": null,
          "new_text": "bstr_cut(packet, i + head.len)",
          "old_line_content": "    }",
          "new_line_content": "        packet = bstr_cut(packet, i + head.len);",
          "content_same": false
        },
        {
          "line": 401,
          "old_api": null,
          "new_api": "bstr0",
          "old_text": null,
          "new_text": "bstr0(\"\\';\")",
          "old_line_content": "",
          "new_line_content": "        int end = bstr_find(packet, bstr0(\"\\';\"));",
          "content_same": false
        },
        {
          "line": 403,
          "old_api": null,
          "new_api": "bstr0",
          "old_text": null,
          "new_text": "bstr0(\"icy-title\")",
          "old_line_content": "",
          "new_line_content": "        mp_tags_set_bstr(res, bstr0(\"icy-title\"), packet);",
          "content_same": false
        },
        {
          "line": 409,
          "old_api": null,
          "new_api": "av_free",
          "old_text": null,
          "new_text": "av_free(icy_header)",
          "old_line_content": "",
          "new_line_content": "    av_free(icy_header);",
          "content_same": false
        },
        {
          "line": 410,
          "old_api": null,
          "new_api": "av_free",
          "old_text": null,
          "new_text": "av_free(icy_packet)",
          "old_line_content": "static const char *const http_like[] =",
          "new_line_content": "    av_free(icy_packet);",
          "content_same": false
        },
        {
          "line": 284,
          "old_api": null,
          "new_api": "strlen",
          "old_text": null,
          "new_text": "strlen(prefix[i])",
          "old_line_content": "         * stream layer. demux_lavf will do all the real work. Note",
          "new_line_content": "        if (!strncmp(filename, prefix[i], strlen(prefix[i])))",
          "content_same": false
        },
        {
          "line": 285,
          "old_api": null,
          "new_api": "strlen",
          "old_text": null,
          "new_text": "strlen(prefix[i])",
          "old_line_content": "         * that libavformat doesn't even provide a protocol entry for",
          "new_line_content": "            filename += strlen(prefix[i]);",
          "content_same": false
        },
        {
          "line": 286,
          "old_api": null,
          "new_api": "strncmp",
          "old_text": null,
          "new_text": "strncmp(filename, \"rtsp:\", 5)",
          "old_line_content": "         * this (the rtsp demuxer's probe function checks for a \"rtsp:\"",
          "new_line_content": "    if (!strncmp(filename, \"rtsp:\", 5)) {",
          "content_same": false
        },
        {
          "line": 159,
          "old_api": null,
          "new_api": "child_next",
          "old_text": null,
          "new_text": "avio->av_class->child_next(avio, NULL)",
          "old_line_content": "        }",
          "new_line_content": "            void *child = avio->av_class->child_next(avio, NULL);",
          "content_same": false
        },
        {
          "line": 162,
          "old_api": null,
          "new_api": "item_name",
          "old_text": null,
          "new_text": "cl->item_name(child)",
          "old_line_content": "        for (int n = 0; has_read_seek[n]; n++) {",
          "new_line_content": "                proto = cl->item_name(child);",
          "content_same": false
        },
        {
          "line": 167,
          "old_api": null,
          "new_api": "strcmp",
          "old_text": null,
          "new_text": "strcmp(proto, has_read_seek[n])",
          "old_line_content": "    }",
          "new_line_content": "            if (avio->read_seek && proto && strcmp(proto, has_read_seek[n]) == 0)",
          "content_same": false
        },
        {
          "line": 295,
          "old_api": null,
          "new_api": "talloc_free",
          "old_text": null,
          "new_text": "talloc_free(temp)",
          "old_line_content": "    // Replace \"mms://\" with \"mmsh://\", so that most mms:// URLs just work.",
          "new_line_content": "        talloc_free(temp);",
          "content_same": false
        },
        {
          "line": 173,
          "old_api": null,
          "new_api": "read_icy",
          "old_text": null,
          "new_text": "read_icy(s)",
          "old_line_content": "    }",
          "new_line_content": "        *(struct mp_tags **)arg = read_icy(s);",
          "content_same": false
        },
        {
          "line": 301,
          "old_api": null,
          "new_api": "bstr_eatstart0",
          "old_text": null,
          "new_text": "bstr_eatstart0(&b_filename, \"mms://\")",
          "old_line_content": "    }",
          "new_line_content": "    if (bstr_eatstart0(&b_filename, \"mms://\") ||",
          "content_same": false
        },
        {
          "line": 302,
          "old_api": null,
          "new_api": "bstr_eatstart0",
          "old_text": null,
          "new_text": "bstr_eatstart0(&b_filename, \"mmshttp://\")",
          "old_line_content": "",
          "new_line_content": "        bstr_eatstart0(&b_filename, \"mmshttp://\"))",
          "content_same": false
        },
        {
          "line": 304,
          "old_api": null,
          "new_api": "BSTR_P",
          "old_text": null,
          "new_text": "BSTR_P(b_filename)",
          "old_line_content": "",
          "new_line_content": "        filename = talloc_asprintf(temp, \"mmsh://%.*s\", BSTR_P(b_filename));",
          "content_same": false
        },
        {
          "line": 307,
          "old_api": null,
          "new_api": "mp_setup_av_network_options",
          "old_text": null,
          "new_text": "mp_setup_av_network_options(&dict, stream->global, stream->log)",
          "old_line_content": "        .opaque = stream,",
          "new_line_content": "    mp_setup_av_network_options(&dict, stream->global, stream->log);",
          "content_same": false
        },
        {
          "line": 184,
          "old_api": null,
          "new_api": "stream_drop_buffers",
          "old_text": null,
          "new_text": "stream_drop_buffers(s)",
          "old_line_content": "    }",
          "new_line_content": "        stream_drop_buffers(s);",
          "content_same": false
        },
        {
          "line": 186,
          "old_api": null,
          "new_api": "open_f",
          "old_text": null,
          "new_text": "open_f(s)",
          "old_line_content": "}",
          "new_line_content": "        return open_f(s);",
          "content_same": false
        },
        {
          "line": 314,
          "old_api": null,
          "new_api": "normalize_url",
          "old_text": null,
          "new_text": "normalize_url(stream, filename)",
          "old_line_content": "        stream->lavf_type = \"flv\";",
          "new_line_content": "    filename = normalize_url(stream, filename);",
          "content_same": false
        },
        {
          "line": 320,
          "old_api": null,
          "new_api": "av_dict_set",
          "old_text": null,
          "new_text": "av_dict_set(&dict, \"timeout\", \"0\", 0)",
          "old_line_content": "    if (err < 0) {",
          "new_line_content": "        av_dict_set(&dict, \"timeout\", \"0\", 0);",
          "content_same": false
        },
        {
          "line": 195,
          "old_api": null,
          "new_api": "mp_cancel_test",
          "old_text": null,
          "new_text": "mp_cancel_test(stream->cancel)",
          "old_line_content": "",
          "new_line_content": "    return mp_cancel_test(stream->cancel);",
          "content_same": false
        },
        {
          "line": 323,
          "old_api": null,
          "new_api": "avio_open2",
          "old_text": null,
          "new_text": "avio_open2(&avio, filename, flags, &cb, &dict)",
          "old_line_content": "                   \" ffmpeg/Libav is compiled with networking support.\\n\");",
          "new_line_content": "    int err = avio_open2(&avio, filename, flags, &cb, &dict);",
          "content_same": false
        },
        {
          "line": 326,
          "old_api": null,
          "new_api": "MP_ERR",
          "old_text": null,
          "new_text": "MP_ERR(stream, \"Protocol not found. Make sure\"\n                   \" ffmpeg/Libav is compiled with networking support.\\n\")",
          "old_line_content": "",
          "new_line_content": "            MP_ERR(stream, \"Protocol not found. Make sure\"",
          "content_same": false
        },
        {
          "line": 203,
          "old_api": null,
          "new_api": "talloc_new",
          "old_text": null,
          "new_text": "talloc_new(NULL)",
          "old_line_content": "    // HTTP specific options (other protocols ignore them)",
          "new_line_content": "    void *temp = talloc_new(NULL);",
          "content_same": false
        },
        {
          "line": 335,
          "old_api": null,
          "new_api": "av_opt_get",
          "old_text": null,
          "new_text": "av_opt_get(avio, \"mime_type\", AV_OPT_SEARCH_CHILDREN, &mt)",
          "old_line_content": "    }",
          "new_line_content": "        if (av_opt_get(avio, \"mime_type\", AV_OPT_SEARCH_CHILDREN, &mt) >= 0) {",
          "content_same": false
        },
        {
          "line": 336,
          "old_api": null,
          "new_api": "talloc_strdup",
          "old_text": null,
          "new_text": "talloc_strdup(stream, mt)",
          "old_line_content": "",
          "new_line_content": "            stream->mime_type = talloc_strdup(stream, mt);",
          "content_same": false
        },
        {
          "line": 337,
          "old_api": null,
          "new_api": "av_free",
          "old_text": null,
          "new_text": "av_free(mt)",
          "old_line_content": "    stream->priv = avio;",
          "new_line_content": "            av_free(mt);",
          "content_same": false
        },
        {
          "line": 83,
          "old_api": null,
          "new_api": "avio_read_partial",
          "old_text": null,
          "new_text": "avio_read_partial(avio, buffer, max_len)",
          "old_line_content": "    return (r <= 0) ? -1 : r;",
          "new_line_content": "    int r = avio_read_partial(avio, buffer, max_len);",
          "content_same": false
        },
        {
          "line": 85,
          "old_api": null,
          "new_api": "avio_read",
          "old_text": null,
          "new_text": "avio_read(avio, buffer, max_len)",
          "old_line_content": "",
          "new_line_content": "    int r = avio_read(avio, buffer, max_len);",
          "content_same": false
        },
        {
          "line": 213,
          "old_api": null,
          "new_api": "mp_get_user_path",
          "old_text": null,
          "new_text": "mp_get_user_path(temp, global, file)",
          "old_line_content": "    }",
          "new_line_content": "            file = mp_get_user_path(temp, global, file);",
          "content_same": false
        },
        {
          "line": 222,
          "old_api": null,
          "new_api": "av_dict_set",
          "old_text": null,
          "new_text": "av_dict_set(dict, \"cert_file\", opts->tls_cert_file, 0)",
          "old_line_content": "    if (opts->referrer) {",
          "new_line_content": "        av_dict_set(dict, \"cert_file\", opts->tls_cert_file, 0);",
          "content_same": false
        },
        {
          "line": 95,
          "old_api": null,
          "new_api": "avio_write",
          "old_text": null,
          "new_text": "avio_write(avio, buffer, len)",
          "old_line_content": "    return len;",
          "new_line_content": "    avio_write(avio, buffer, len);",
          "content_same": false
        },
        {
          "line": 96,
          "old_api": null,
          "new_api": "avio_flush",
          "old_text": null,
          "new_text": "avio_flush(avio)",
          "old_line_content": "}",
          "new_line_content": "    avio_flush(avio);",
          "content_same": false
        },
        {
          "line": 224,
          "old_api": null,
          "new_api": "av_dict_set",
          "old_text": null,
          "new_text": "av_dict_set(dict, \"key_file\", opts->tls_key_file, 0)",
          "old_line_content": "                                              opts->referrer);",
          "new_line_content": "        av_dict_set(dict, \"key_file\", opts->tls_key_file, 0);",
          "content_same": false
        },
        {
          "line": 225,
          "old_api": null,
          "new_api": "talloc_strdup",
          "old_text": null,
          "new_text": "talloc_strdup(temp, \"\")",
          "old_line_content": "    }",
          "new_line_content": "    char *cust_headers = talloc_strdup(temp, \"\");",
          "content_same": false
        },
        {
          "line": 227,
          "old_api": null,
          "new_api": "talloc_asprintf_append",
          "old_text": null,
          "new_text": "talloc_asprintf_append(cust_headers, \"Referer: %s\\r\\n\",\n                                              opts->referrer)",
          "old_line_content": "        for (int n = 0; opts->http_header_fields[n]; n++) {",
          "new_line_content": "        cust_headers = talloc_asprintf_append(cust_headers, \"Referer: %s\\r\\n\",",
          "content_same": false
        },
        {
          "line": 353,
          "old_api": null,
          "new_api": "av_dict_free",
          "old_text": null,
          "new_text": "av_dict_free(&dict)",
          "old_line_content": "",
          "new_line_content": "    av_dict_free(&dict);",
          "content_same": false
        },
        {
          "line": 354,
          "old_api": null,
          "new_api": "talloc_free",
          "old_text": null,
          "new_text": "talloc_free(temp)",
          "old_line_content": "static struct mp_tags *read_icy(stream_t *s)",
          "new_line_content": "    talloc_free(temp);",
          "content_same": false
        },
        {
          "line": 107,
          "old_api": null,
          "new_api": "avio_seek",
          "old_text": null,
          "new_text": "avio_seek(avio, newpos, SEEK_SET)",
          "old_line_content": "}",
          "new_line_content": "    if (avio_seek(avio, newpos, SEEK_SET) < 0) {",
          "content_same": false
        },
        {
          "line": 236,
          "old_api": null,
          "new_api": "strlen",
          "old_text": null,
          "new_text": "strlen(cust_headers)",
          "old_line_content": "    if (opts->timeout > 0) {",
          "new_line_content": "    if (strlen(cust_headers))",
          "content_same": false
        },
        {
          "line": 237,
          "old_api": null,
          "new_api": "av_dict_set",
          "old_text": null,
          "new_text": "av_dict_set(dict, \"headers\", cust_headers, 0)",
          "old_line_content": "        char buf[80];",
          "new_line_content": "        av_dict_set(dict, \"headers\", cust_headers, 0);",
          "content_same": false
        },
        {
          "line": 366,
          "old_api": null,
          "new_api": "av_opt_get",
          "old_text": null,
          "new_text": "av_opt_get(avio, \"icy_metadata_headers\", AV_OPT_SEARCH_CHILDREN,\n                   &icy_header)",
          "old_line_content": "    uint8_t *icy_packet;",
          "new_line_content": "    if (av_opt_get(avio, \"icy_metadata_headers\", AV_OPT_SEARCH_CHILDREN,",
          "content_same": false
        },
        {
          "line": 243,
          "old_api": null,
          "new_api": "av_dict_set",
          "old_text": null,
          "new_text": "av_dict_set(dict, \"timeout\", buf, 0)",
          "old_line_content": "",
          "new_line_content": "        av_dict_set(dict, \"timeout\", buf, 0);",
          "content_same": false
        },
        {
          "line": 371,
          "old_api": null,
          "new_api": "av_opt_get",
          "old_text": null,
          "new_text": "av_opt_get(avio, \"icy_metadata_packet\", AV_OPT_SEARCH_CHILDREN,\n                   &icy_packet)",
          "old_line_content": "    // Send a metadata update only 1. on start, and 2. on a new metadata packet.",
          "new_line_content": "    if (av_opt_get(avio, \"icy_metadata_packet\", AV_OPT_SEARCH_CHILDREN,",
          "content_same": false
        },
        {
          "line": 246,
          "old_api": null,
          "new_api": "mp_set_avdict",
          "old_text": null,
          "new_text": "mp_set_avdict(dict, opts->avopts)",
          "old_line_content": "",
          "new_line_content": "    mp_set_avdict(dict, opts->avopts);",
          "content_same": false
        },
        {
          "line": 248,
          "old_api": null,
          "new_api": "talloc_free",
          "old_text": null,
          "new_text": "talloc_free(temp)",
          "old_line_content": "// libavformat's http protocol does not do this, and a patch to add this",
          "new_line_content": "    talloc_free(temp);",
          "content_same": false
        },
        {
          "line": 122,
          "old_api": null,
          "new_api": "avio_close",
          "old_text": null,
          "new_text": "avio_close(avio)",
          "old_line_content": "{",
          "new_line_content": "        avio_close(avio);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 129,
          "old_api": "avio_size",
          "new_api": null,
          "old_text": "avio_size(avio)",
          "new_text": null,
          "old_line_content": "        size = avio_size(avio);",
          "new_line_content": "        return -1;",
          "content_same": false
        },
        {
          "line": 257,
          "old_api": "mp_url_escape",
          "new_api": null,
          "old_text": "mp_url_escape(ta_parent, filename, \":/?#[]@!$&'()*+,;=%\")",
          "new_text": null,
          "old_line_content": "            return mp_url_escape(ta_parent, filename, \":/?#[]@!$&'()*+,;=%\");",
          "new_line_content": "    for (int n = 0; http_like[n]; n++) {",
          "content_same": false
        },
        {
          "line": 385,
          "old_api": "bstr0",
          "new_api": null,
          "old_text": "bstr0(icy_header)",
          "new_text": null,
          "old_line_content": "    bstr header = bstr0(icy_header);",
          "new_line_content": "        goto done;",
          "content_same": false
        },
        {
          "line": 390,
          "old_api": "mp_tags_set_bstr",
          "new_api": null,
          "old_text": "mp_tags_set_bstr(res, name, val)",
          "new_text": null,
          "old_line_content": "            mp_tags_set_bstr(res, name, val);",
          "new_line_content": "    while (header.len) {",
          "content_same": false
        },
        {
          "line": 137,
          "old_api": "avio_seek_time",
          "new_api": null,
          "old_text": "avio_seek_time(avio, c->stream_index, c->timestamp, c->flags)",
          "new_text": null,
          "old_line_content": "        int64_t r = avio_seek_time(avio, c->stream_index, c->timestamp, c->flags);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 139,
          "old_api": "stream_drop_buffers",
          "new_api": null,
          "old_text": "stream_drop_buffers(s)",
          "new_text": null,
          "old_line_content": "            stream_drop_buffers(s);",
          "new_line_content": "    case STREAM_CTRL_AVSEEK: {",
          "content_same": false
        },
        {
          "line": 267,
          "old_api": "talloc_new",
          "new_api": null,
          "old_text": "talloc_new(NULL)",
          "new_text": null,
          "old_line_content": "    void *temp = talloc_new(NULL);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 396,
          "old_api": "bstr_cut",
          "new_api": null,
          "old_text": "bstr_cut(packet, i + head.len)",
          "new_text": null,
          "old_line_content": "        packet = bstr_cut(packet, i + head.len);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 399,
          "old_api": "bstr0",
          "new_api": null,
          "old_text": "bstr0(\"icy-title\")",
          "new_text": null,
          "old_line_content": "        mp_tags_set_bstr(res, bstr0(\"icy-title\"), packet);",
          "new_line_content": "    if (i >= 0) {",
          "content_same": false
        },
        {
          "line": 276,
          "old_api": "MP_ERR",
          "new_api": null,
          "old_text": "MP_ERR(stream, \"No URL\\n\")",
          "new_text": null,
          "old_line_content": "        MP_ERR(stream, \"No URL\\n\");",
          "new_line_content": "    int flags = stream->mode == STREAM_WRITE ? AVIO_FLAG_WRITE : AVIO_FLAG_READ;",
          "content_same": false
        },
        {
          "line": 405,
          "old_api": "av_free",
          "new_api": null,
          "old_text": "av_free(icy_header)",
          "new_text": null,
          "old_line_content": "    av_free(icy_header);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 281,
          "old_api": "strlen",
          "new_api": null,
          "old_text": "strlen(prefix[i])",
          "new_text": null,
          "old_line_content": "            filename += strlen(prefix[i]);",
          "new_line_content": "        goto out;",
          "content_same": false
        },
        {
          "line": 282,
          "old_api": "strncmp",
          "new_api": null,
          "old_text": "strncmp(filename, \"rtsp:\", 5)",
          "new_text": null,
          "old_line_content": "    if (!strncmp(filename, \"rtsp:\", 5)) {",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 155,
          "old_api": "child_next",
          "new_api": null,
          "old_text": "avio->av_class->child_next(avio, NULL)",
          "new_text": null,
          "old_line_content": "            void *child = avio->av_class->child_next(avio, NULL);",
          "new_line_content": "        const char *proto = NULL;",
          "content_same": false
        },
        {
          "line": 158,
          "old_api": "item_name",
          "new_api": null,
          "old_text": "cl->item_name(child)",
          "new_text": null,
          "old_line_content": "                proto = cl->item_name(child);",
          "new_line_content": "            // which holds the name of the actual protocol implementation.",
          "content_same": false
        },
        {
          "line": 163,
          "old_api": "strcmp",
          "new_api": null,
          "old_text": "strcmp(proto, has_read_seek[n])",
          "new_text": null,
          "old_line_content": "            if (avio->read_seek && proto && strcmp(proto, has_read_seek[n]) == 0)",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 291,
          "old_api": "talloc_free",
          "new_api": null,
          "old_text": "talloc_free(temp)",
          "new_text": null,
          "old_line_content": "        talloc_free(temp);",
          "new_line_content": "         * filename prefix), so it has to be handled specially here.",
          "content_same": false
        },
        {
          "line": 296,
          "old_api": "bstr0",
          "new_api": null,
          "old_text": "bstr0(filename)",
          "new_text": null,
          "old_line_content": "    bstr b_filename = bstr0(filename);",
          "new_line_content": "        return STREAM_OK;",
          "content_same": false
        },
        {
          "line": 169,
          "old_api": "read_icy",
          "new_api": null,
          "old_text": "read_icy(s)",
          "new_text": null,
          "old_line_content": "        *(struct mp_tags **)arg = read_icy(s);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 297,
          "old_api": "bstr_eatstart0",
          "new_api": null,
          "old_text": "bstr_eatstart0(&b_filename, \"mms://\")",
          "new_text": null,
          "old_line_content": "    if (bstr_eatstart0(&b_filename, \"mms://\") ||",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 298,
          "old_api": "bstr_eatstart0",
          "new_api": null,
          "old_text": "bstr_eatstart0(&b_filename, \"mmshttp://\")",
          "new_text": null,
          "old_line_content": "        bstr_eatstart0(&b_filename, \"mmshttp://\"))",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 303,
          "old_api": "mp_setup_av_network_options",
          "new_api": null,
          "old_text": "mp_setup_av_network_options(&dict, stream->global, stream->log)",
          "new_text": null,
          "old_line_content": "    mp_setup_av_network_options(&dict, stream->global, stream->log);",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 178,
          "old_api": "close_f",
          "new_api": null,
          "old_text": "close_f(s)",
          "new_text": null,
          "old_line_content": "        close_f(s);",
          "new_line_content": "    case STREAM_CTRL_RECONNECT: {",
          "content_same": false
        },
        {
          "line": 180,
          "old_api": "stream_drop_buffers",
          "new_api": null,
          "old_text": "stream_drop_buffers(s)",
          "new_text": null,
          "old_line_content": "        stream_drop_buffers(s);",
          "new_line_content": "            break; // don't bother with this",
          "content_same": false
        },
        {
          "line": 310,
          "old_api": "normalize_url",
          "new_api": null,
          "old_text": "normalize_url(stream, filename)",
          "new_text": null,
          "old_line_content": "    filename = normalize_url(stream, filename);",
          "new_line_content": "        .callback = interrupt_cb,",
          "content_same": false
        },
        {
          "line": 312,
          "old_api": "strncmp",
          "new_api": null,
          "old_text": "strncmp(filename, \"rtmp\", 4)",
          "new_text": null,
          "old_line_content": "    if (strncmp(filename, \"rtmp\", 4) == 0) {",
          "new_line_content": "    };",
          "content_same": false
        },
        {
          "line": 191,
          "old_api": "mp_cancel_test",
          "new_api": null,
          "old_text": "mp_cancel_test(stream->cancel)",
          "new_text": null,
          "old_line_content": "    return mp_cancel_test(stream->cancel);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 319,
          "old_api": "avio_open2",
          "new_api": null,
          "old_text": "avio_open2(&avio, filename, flags, &cb, &dict)",
          "new_text": null,
          "old_line_content": "    int err = avio_open2(&avio, filename, flags, &cb, &dict);",
          "new_line_content": "        // Setting timeout enables listen mode - force it to disabled.",
          "content_same": false
        },
        {
          "line": 322,
          "old_api": "MP_ERR",
          "new_api": null,
          "old_text": "MP_ERR(stream, \"Protocol not found. Make sure\"\n                   \" ffmpeg/Libav is compiled with networking support.\\n\")",
          "new_text": null,
          "old_line_content": "            MP_ERR(stream, \"Protocol not found. Make sure\"",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 199,
          "old_api": "talloc_new",
          "new_api": null,
          "old_text": "talloc_new(NULL)",
          "new_text": null,
          "old_line_content": "    void *temp = talloc_new(NULL);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 327,
          "old_api": "mp_avdict_print_unset",
          "new_api": null,
          "old_text": "mp_avdict_print_unset(stream->log, MSGL_V, dict)",
          "new_text": null,
          "old_line_content": "    mp_avdict_print_unset(stream->log, MSGL_V, dict);",
          "new_line_content": "                   \" ffmpeg/Libav is compiled with networking support.\\n\");",
          "content_same": false
        },
        {
          "line": 201,
          "old_api": "mp_get_config_group",
          "new_api": null,
          "old_text": "mp_get_config_group(temp, global, &stream_lavf_conf)",
          "new_text": null,
          "old_line_content": "        mp_get_config_group(temp, global, &stream_lavf_conf);",
          "new_line_content": "                                 struct mp_log *log)",
          "content_same": false
        },
        {
          "line": 332,
          "old_api": "talloc_strdup",
          "new_api": null,
          "old_text": "talloc_strdup(stream, mt)",
          "new_text": null,
          "old_line_content": "            stream->mime_type = talloc_strdup(stream, mt);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 333,
          "old_api": "av_free",
          "new_api": null,
          "old_text": "av_free(mt)",
          "new_text": null,
          "old_line_content": "            av_free(mt);",
          "new_line_content": "    if (avio->av_class) {",
          "content_same": false
        },
        {
          "line": 82,
          "old_api": "avio_read",
          "new_api": null,
          "old_text": "avio_read(avio, buffer, max_len)",
          "new_text": null,
          "old_line_content": "    int r = avio_read(avio, buffer, max_len);",
          "new_line_content": "#if LIBAVFORMAT_VERSION_MICRO >= 100 && LIBAVFORMAT_VERSION_INT >= AV_VERSION_INT(57, 81, 100)",
          "content_same": false
        },
        {
          "line": 210,
          "old_api": "cookies_lavf",
          "new_api": null,
          "old_text": "cookies_lavf(temp, log, file)",
          "new_text": null,
          "old_line_content": "        char *cookies = cookies_lavf(temp, log, file);",
          "new_line_content": "    if (opts->cookies_enabled) {",
          "content_same": false
        },
        {
          "line": 212,
          "old_api": "av_dict_set",
          "new_api": null,
          "old_text": "av_dict_set(dict, \"cookies\", cookies, 0)",
          "new_text": null,
          "old_line_content": "            av_dict_set(dict, \"cookies\", cookies, 0);",
          "new_line_content": "        if (file && file[0])",
          "content_same": false
        },
        {
          "line": 91,
          "old_api": "avio_write",
          "new_api": null,
          "old_text": "avio_write(avio, buffer, len)",
          "new_text": null,
          "old_line_content": "    avio_write(avio, buffer, len);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 92,
          "old_api": "avio_flush",
          "new_api": null,
          "old_text": "avio_flush(avio)",
          "new_text": null,
          "old_line_content": "    avio_flush(avio);",
          "new_line_content": "    AVIOContext *avio = s->priv;",
          "content_same": false
        },
        {
          "line": 221,
          "old_api": "talloc_strdup",
          "new_api": null,
          "old_text": "talloc_strdup(temp, \"\")",
          "new_text": null,
          "old_line_content": "    char *cust_headers = talloc_strdup(temp, \"\");",
          "new_line_content": "    if (opts->tls_cert_file)",
          "content_same": false
        },
        {
          "line": 349,
          "old_api": "av_dict_free",
          "new_api": null,
          "old_text": "av_dict_free(&dict)",
          "new_text": null,
          "old_line_content": "    av_dict_free(&dict);",
          "new_line_content": "    stream->streaming = true;",
          "content_same": false
        },
        {
          "line": 223,
          "old_api": "talloc_asprintf_append",
          "new_api": null,
          "old_text": "talloc_asprintf_append(cust_headers, \"Referer: %s\\r\\n\",\n                                              opts->referrer)",
          "new_text": null,
          "old_line_content": "        cust_headers = talloc_asprintf_append(cust_headers, \"Referer: %s\\r\\n\",",
          "new_line_content": "    if (opts->tls_key_file)",
          "content_same": false
        },
        {
          "line": 350,
          "old_api": "talloc_free",
          "new_api": null,
          "old_text": "talloc_free(temp)",
          "new_text": null,
          "old_line_content": "    talloc_free(temp);",
          "new_line_content": "    res = STREAM_OK;",
          "content_same": false
        },
        {
          "line": 228,
          "old_api": "talloc_asprintf_append",
          "new_api": null,
          "old_text": "talloc_asprintf_append(cust_headers, \"%s\\r\\n\",\n                                                  opts->http_header_fields[n])",
          "new_text": null,
          "old_line_content": "            cust_headers = talloc_asprintf_append(cust_headers, \"%s\\r\\n\",",
          "new_line_content": "                                              opts->referrer);",
          "content_same": false
        },
        {
          "line": 103,
          "old_api": "avio_seek",
          "new_api": null,
          "old_text": "avio_seek(avio, newpos, SEEK_SET)",
          "new_text": null,
          "old_line_content": "    if (avio_seek(avio, newpos, SEEK_SET) < 0) {",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 233,
          "old_api": "av_dict_set",
          "new_api": null,
          "old_text": "av_dict_set(dict, \"headers\", cust_headers, 0)",
          "new_text": null,
          "old_line_content": "        av_dict_set(dict, \"headers\", cust_headers, 0);",
          "new_line_content": "                                                  opts->http_header_fields[n]);",
          "content_same": false
        },
        {
          "line": 234,
          "old_api": "av_dict_set",
          "new_api": null,
          "old_text": "av_dict_set(dict, \"icy\", \"1\", 0)",
          "new_text": null,
          "old_line_content": "    av_dict_set(dict, \"icy\", \"1\", 0);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 362,
          "old_api": "av_opt_get",
          "new_api": null,
          "old_text": "av_opt_get(avio, \"icy_metadata_headers\", AV_OPT_SEARCH_CHILDREN,\n                   &icy_header)",
          "new_text": null,
          "old_line_content": "    if (av_opt_get(avio, \"icy_metadata_headers\", AV_OPT_SEARCH_CHILDREN,",
          "new_line_content": "    if (!avio->av_class)",
          "content_same": false
        },
        {
          "line": 239,
          "old_api": "av_dict_set",
          "new_api": null,
          "old_text": "av_dict_set(dict, \"timeout\", buf, 0)",
          "new_text": null,
          "old_line_content": "        av_dict_set(dict, \"timeout\", buf, 0);",
          "new_line_content": "    // So far, every known protocol uses microseconds for this",
          "content_same": false
        },
        {
          "line": 367,
          "old_api": "av_opt_get",
          "new_api": null,
          "old_text": "av_opt_get(avio, \"icy_metadata_packet\", AV_OPT_SEARCH_CHILDREN,\n                   &icy_packet)",
          "new_text": null,
          "old_line_content": "    if (av_opt_get(avio, \"icy_metadata_packet\", AV_OPT_SEARCH_CHILDREN,",
          "new_line_content": "                   &icy_header) < 0)",
          "content_same": false
        },
        {
          "line": 244,
          "old_api": "talloc_free",
          "new_api": null,
          "old_text": "talloc_free(temp)",
          "new_text": null,
          "old_line_content": "    talloc_free(temp);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 118,
          "old_api": "avio_close",
          "new_api": null,
          "old_text": "avio_close(avio)",
          "new_text": null,
          "old_line_content": "        avio_close(avio);",
          "new_line_content": "     * avio_close() could return an error, but we have no way to return that",
          "content_same": false
        },
        {
          "line": 380,
          "old_api": "bstr_equals0",
          "new_api": null,
          "old_text": "bstr_equals0(packet, \"-\")",
          "new_text": null,
          "old_line_content": "    if (bstr_equals0(packet, \"-\"))",
          "new_line_content": "    if ((!icy_header || !icy_header[0]) && (!icy_packet || !icy_packet[0]))",
          "content_same": false
        },
        {
          "line": 379,
          "old_api": "bstr0",
          "new_api": null,
          "old_text": "bstr0(icy_packet)",
          "new_text": null,
          "old_line_content": "    bstr packet = bstr0(icy_packet);",
          "new_line_content": "    struct mp_tags *res = NULL;",
          "content_same": false
        },
        {
          "line": 252,
          "old_api": "bstr0",
          "new_api": null,
          "old_text": "bstr0(filename)",
          "new_text": null,
          "old_line_content": "    bstr proto = mp_split_proto(bstr0(filename), NULL);",
          "new_line_content": "// libavformat's http protocol does not do this, and a patch to add this",
          "content_same": false
        },
        {
          "line": 254,
          "old_api": "bstr_equals0",
          "new_api": null,
          "old_text": "bstr_equals0(proto, http_like[n])",
          "new_text": null,
          "old_line_content": "        if (bstr_equals0(proto, http_like[n]))",
          "new_line_content": "static char *normalize_url(void *ta_parent, const char *filename)",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 19,
      "total_additions": 57,
      "total_deletions": 56,
      "total_api_changes": 132
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 4,
        "api_related_lines": 132,
        "non_api_lines": 2,
        "non_api_line_numbers": [
          84,
          86
        ]
      }
    },
    "api_calls_before": 96,
    "api_calls_after": 97,
    "diff_info": {
      "added_lines": 4,
      "removed_lines": 0,
      "total_diff_lines": 17
    }
  }
}