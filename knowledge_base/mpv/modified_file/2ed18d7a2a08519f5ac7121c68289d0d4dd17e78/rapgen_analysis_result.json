{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/2ed18d7a2a08519f5ac7121c68289d0d4dd17e78",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/2ed18d7a2a08519f5ac7121c68289d0d4dd17e78/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/2ed18d7a2a08519f5ac7121c68289d0d4dd17e78/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mpv/modified_file/2ed18d7a2a08519f5ac7121c68289d0d4dd17e78/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 219,
          "old_api": "set_osd_subtitle",
          "new_api": "sub_add_text",
          "old_text": "set_osd_subtitle(&subs)",
          "new_text": "sub_add_text(&subs, packet, len, endpts)",
          "old_line_content": "                set_osd_subtitle(&subs);",
          "new_line_content": "                sub_add_text(&subs, packet, len, endpts);",
          "content_same": false
        },
        {
          "line": 225,
          "old_api": "set_osd_subtitle",
          "new_api": "sub_clear_text",
          "old_text": "set_osd_subtitle(&subs)",
          "new_text": "sub_clear_text(&subs, curpts)",
          "old_line_content": "            set_osd_subtitle(&subs);",
          "new_line_content": "        if (sub_clear_text(&subs, curpts))",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 226,
          "old_api": null,
          "new_api": "set_osd_subtitle",
          "old_text": null,
          "new_text": "set_osd_subtitle(&subs)",
          "old_line_content": "    }",
          "new_line_content": "            set_osd_subtitle(&subs);",
          "content_same": false
        },
        {
          "line": 255,
          "old_api": null,
          "new_api": "teletext_control",
          "old_text": null,
          "new_text": "teletext_control(demuxer->teletext,TV_VBI_CONTROL_MARK_UNCHANGED,NULL)",
          "old_line_content": "}",
          "new_line_content": "    teletext_control(demuxer->teletext,TV_VBI_CONTROL_MARK_UNCHANGED,NULL);",
          "content_same": false
        },
        {
          "line": 261,
          "old_api": null,
          "new_api": "demuxer_audio_track_by_lang",
          "old_text": null,
          "new_text": "demuxer_audio_track_by_lang(demuxer, audio_lang)",
          "old_line_content": "    if (audio_id == -1)",
          "new_line_content": "        audio_id = demuxer_audio_track_by_lang(demuxer, audio_lang);",
          "content_same": false
        },
        {
          "line": 199,
          "old_api": null,
          "new_api": "sub_clear_text",
          "old_text": null,
          "new_text": "sub_clear_text(&tmp_subs, MP_NOPTS_VALUE)",
          "old_line_content": "                    }",
          "new_line_content": "                        sub_clear_text(&tmp_subs, MP_NOPTS_VALUE);",
          "content_same": false
        },
        {
          "line": 263,
          "old_api": null,
          "new_api": "demuxer_default_audio_track",
          "old_text": null,
          "new_text": "demuxer_default_audio_track(demuxer)",
          "old_line_content": "    if (audio_id != -1) // -1 (automatic) is the default behaviour of demuxers",
          "new_line_content": "        audio_id = demuxer_default_audio_track(demuxer);",
          "content_same": false
        },
        {
          "line": 265,
          "old_api": null,
          "new_api": "demuxer_switch_audio",
          "old_text": null,
          "new_text": "demuxer_switch_audio(demuxer, audio_id)",
          "old_line_content": "    if (audio_id == -2) { // some demuxers don't yet know how to switch to no sound",
          "new_line_content": "        demuxer_switch_audio(demuxer, audio_id);",
          "content_same": false
        },
        {
          "line": 207,
          "old_api": null,
          "new_api": "sub_clear_text",
          "old_text": null,
          "new_text": "sub_clear_text(&subs, MP_NOPTS_VALUE)",
          "old_line_content": "                if (type == 'a') { // ssa/ass subs without libass => convert to plaintext",
          "new_line_content": "                    sub_clear_text(&subs, MP_NOPTS_VALUE);",
          "content_same": false
        },
        {
          "line": 239,
          "old_api": null,
          "new_api": "teletext_control",
          "old_text": null,
          "new_text": "teletext_control(demuxer->teletext,TV_VBI_CONTROL_IS_CHANGED,&page_changed)",
          "old_line_content": "        page_changed=1;",
          "new_line_content": "    if(teletext_control(demuxer->teletext,TV_VBI_CONTROL_IS_CHANGED,&page_changed)!=VBI_CONTROL_TRUE)",
          "content_same": false
        },
        {
          "line": 245,
          "old_api": null,
          "new_api": "teletext_control",
          "old_text": null,
          "new_text": "teletext_control(demuxer->teletext,TV_VBI_CONTROL_GET_VBIPAGE,&vo_osd_teletext_page)",
          "old_line_content": "        vo_osd_teletext_page=NULL;",
          "new_line_content": "    if(teletext_control(demuxer->teletext,TV_VBI_CONTROL_GET_VBIPAGE,&vo_osd_teletext_page)!=VBI_CONTROL_TRUE)",
          "content_same": false
        },
        {
          "line": 247,
          "old_api": null,
          "new_api": "teletext_control",
          "old_text": null,
          "new_text": "teletext_control(demuxer->teletext,TV_VBI_CONTROL_GET_HALF_PAGE,&vo_osd_teletext_half)",
          "old_line_content": "        vo_osd_teletext_half=0;",
          "new_line_content": "    if(teletext_control(demuxer->teletext,TV_VBI_CONTROL_GET_HALF_PAGE,&vo_osd_teletext_half)!=VBI_CONTROL_TRUE)",
          "content_same": false
        },
        {
          "line": 249,
          "old_api": null,
          "new_api": "teletext_control",
          "old_text": null,
          "new_text": "teletext_control(demuxer->teletext,TV_VBI_CONTROL_GET_MODE,&vo_osd_teletext_mode)",
          "old_line_content": "        vo_osd_teletext_mode=0;",
          "new_line_content": "    if(teletext_control(demuxer->teletext,TV_VBI_CONTROL_GET_MODE,&vo_osd_teletext_mode)!=VBI_CONTROL_TRUE)",
          "content_same": false
        },
        {
          "line": 251,
          "old_api": null,
          "new_api": "teletext_control",
          "old_text": null,
          "new_text": "teletext_control(demuxer->teletext,TV_VBI_CONTROL_GET_FORMAT,&vo_osd_teletext_format)",
          "old_line_content": "        vo_osd_teletext_format=0;",
          "new_line_content": "    if(teletext_control(demuxer->teletext,TV_VBI_CONTROL_GET_FORMAT,&vo_osd_teletext_format)!=VBI_CONTROL_TRUE)",
          "content_same": false
        },
        {
          "line": 220,
          "old_api": null,
          "new_api": "set_osd_subtitle",
          "old_text": null,
          "new_text": "set_osd_subtitle(&subs)",
          "old_line_content": "            }",
          "new_line_content": "                set_osd_subtitle(&subs);",
          "content_same": false
        },
        {
          "line": 253,
          "old_api": null,
          "new_api": "vo_osd_changed",
          "old_text": null,
          "new_text": "vo_osd_changed(OSDTYPE_TELETEXT)",
          "old_line_content": "",
          "new_line_content": "    vo_osd_changed(OSDTYPE_TELETEXT);",
          "content_same": false
        },
        {
          "line": 223,
          "old_api": null,
          "new_api": "ds_get_next_pts",
          "old_text": null,
          "new_text": "ds_get_next_pts(d_dvdsub)",
          "old_line_content": "        }",
          "new_line_content": "                ds_get_next_pts(d_dvdsub);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 224,
          "old_api": "sub_clear_text",
          "new_api": null,
          "old_text": "sub_clear_text(&subs, curpts)",
          "new_text": null,
          "old_line_content": "        if (sub_clear_text(&subs, curpts))",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 194,
          "old_api": "sub_clear_text",
          "new_api": null,
          "old_text": "sub_clear_text(&subs, MP_NOPTS_VALUE)",
          "new_text": null,
          "old_line_content": "                        sub_clear_text(&subs, MP_NOPTS_VALUE);",
          "new_line_content": "                        if (endpts == MP_NOPTS_VALUE) endpts = subpts + 3;",
          "content_same": false
        },
        {
          "line": 260,
          "old_api": "demuxer_audio_track_by_lang",
          "new_api": null,
          "old_text": "demuxer_audio_track_by_lang(demuxer, audio_lang)",
          "new_text": null,
          "old_line_content": "        audio_id = demuxer_audio_track_by_lang(demuxer, audio_lang);",
          "new_line_content": "    if (audio_id == -1 && audio_lang)",
          "content_same": false
        },
        {
          "line": 262,
          "old_api": "demuxer_default_audio_track",
          "new_api": null,
          "old_text": "demuxer_default_audio_track(demuxer)",
          "new_text": null,
          "old_line_content": "        audio_id = demuxer_default_audio_track(demuxer);",
          "new_line_content": "    if (audio_id == -1)",
          "content_same": false
        },
        {
          "line": 264,
          "old_api": "demuxer_switch_audio",
          "new_api": null,
          "old_text": "demuxer_switch_audio(demuxer, audio_id)",
          "new_text": null,
          "old_line_content": "        demuxer_switch_audio(demuxer, audio_id);",
          "new_line_content": "    if (audio_id != -1) // -1 (automatic) is the default behaviour of demuxers",
          "content_same": false
        },
        {
          "line": 250,
          "old_api": "teletext_control",
          "new_api": null,
          "old_text": "teletext_control(demuxer->teletext,TV_VBI_CONTROL_GET_FORMAT,&vo_osd_teletext_format)",
          "new_text": null,
          "old_line_content": "    if(teletext_control(demuxer->teletext,TV_VBI_CONTROL_GET_FORMAT,&vo_osd_teletext_format)!=VBI_CONTROL_TRUE)",
          "new_line_content": "        vo_osd_teletext_mode=0;",
          "content_same": false
        },
        {
          "line": 206,
          "old_api": "sub_clear_text",
          "new_api": null,
          "old_text": "sub_clear_text(&subs, MP_NOPTS_VALUE)",
          "new_text": null,
          "old_line_content": "                    sub_clear_text(&subs, MP_NOPTS_VALUE);",
          "new_line_content": "                if (endpts == MP_NOPTS_VALUE)",
          "content_same": false
        },
        {
          "line": 238,
          "old_api": "teletext_control",
          "new_api": null,
          "old_text": "teletext_control(demuxer->teletext,TV_VBI_CONTROL_IS_CHANGED,&page_changed)",
          "new_text": null,
          "old_line_content": "    if(teletext_control(demuxer->teletext,TV_VBI_CONTROL_IS_CHANGED,&page_changed)!=VBI_CONTROL_TRUE)",
          "new_line_content": "    //Also forcing page update when such ioctl is not supported or call error occured",
          "content_same": false
        },
        {
          "line": 244,
          "old_api": "teletext_control",
          "new_api": null,
          "old_text": "teletext_control(demuxer->teletext,TV_VBI_CONTROL_GET_VBIPAGE,&vo_osd_teletext_page)",
          "new_text": null,
          "old_line_content": "    if(teletext_control(demuxer->teletext,TV_VBI_CONTROL_GET_VBIPAGE,&vo_osd_teletext_page)!=VBI_CONTROL_TRUE)",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 246,
          "old_api": "teletext_control",
          "new_api": null,
          "old_text": "teletext_control(demuxer->teletext,TV_VBI_CONTROL_GET_HALF_PAGE,&vo_osd_teletext_half)",
          "new_text": null,
          "old_line_content": "    if(teletext_control(demuxer->teletext,TV_VBI_CONTROL_GET_HALF_PAGE,&vo_osd_teletext_half)!=VBI_CONTROL_TRUE)",
          "new_line_content": "        vo_osd_teletext_page=NULL;",
          "content_same": false
        },
        {
          "line": 254,
          "old_api": "teletext_control",
          "new_api": null,
          "old_text": "teletext_control(demuxer->teletext,TV_VBI_CONTROL_MARK_UNCHANGED,NULL)",
          "new_text": null,
          "old_line_content": "    teletext_control(demuxer->teletext,TV_VBI_CONTROL_MARK_UNCHANGED,NULL);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 248,
          "old_api": "teletext_control",
          "new_api": null,
          "old_text": "teletext_control(demuxer->teletext,TV_VBI_CONTROL_GET_MODE,&vo_osd_teletext_mode)",
          "new_text": null,
          "old_line_content": "    if(teletext_control(demuxer->teletext,TV_VBI_CONTROL_GET_MODE,&vo_osd_teletext_mode)!=VBI_CONTROL_TRUE)",
          "new_line_content": "        vo_osd_teletext_half=0;",
          "content_same": false
        },
        {
          "line": 218,
          "old_api": "sub_add_text",
          "new_api": null,
          "old_text": "sub_add_text(&subs, packet, len, endpts)",
          "new_text": null,
          "old_line_content": "                sub_add_text(&subs, packet, len, endpts);",
          "new_line_content": "                }",
          "content_same": false
        },
        {
          "line": 252,
          "old_api": "vo_osd_changed",
          "new_api": null,
          "old_text": "vo_osd_changed(OSDTYPE_TELETEXT)",
          "new_text": null,
          "old_line_content": "    vo_osd_changed(OSDTYPE_TELETEXT);",
          "new_line_content": "        vo_osd_teletext_format=0;",
          "content_same": false
        },
        {
          "line": 222,
          "old_api": "ds_get_next_pts",
          "new_api": null,
          "old_text": "ds_get_next_pts(d_dvdsub)",
          "new_text": null,
          "old_line_content": "                ds_get_next_pts(d_dvdsub);",
          "new_line_content": "            if (d_dvdsub->non_interleaved)",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 2,
      "total_additions": 15,
      "total_deletions": 15,
      "total_api_changes": 32
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 7,
        "api_related_lines": 32,
        "non_api_lines": 5,
        "non_api_line_numbers": [
          193,
          195,
          196,
          197,
          198
        ]
      }
    },
    "api_calls_before": 54,
    "api_calls_after": 54,
    "diff_info": {
      "added_lines": 6,
      "removed_lines": 5,
      "total_diff_lines": 24
    }
  }
}