{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/vlc/modified_file/87e9c403dece6d0c347d7314402f1919cb36b859",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/vlc/modified_file/87e9c403dece6d0c347d7314402f1919cb36b859/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/vlc/modified_file/87e9c403dece6d0c347d7314402f1919cb36b859/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/vlc/modified_file/87e9c403dece6d0c347d7314402f1919cb36b859/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 348,
          "old_api": "__MIN",
          "new_api": "vlc_GetCPUCount",
          "old_text": "__MIN( i_thread_count, 16 )",
          "new_text": "vlc_GetCPUCount()",
          "old_line_content": "    i_thread_count = __MIN( i_thread_count, 16 );",
          "new_line_content": "        i_thread_count = vlc_GetCPUCount();",
          "content_same": false
        },
        {
          "line": 431,
          "old_api": "vlc_sem_destroy",
          "new_api": "ffmpeg_OpenCodec",
          "old_text": "vlc_sem_destroy( &p_sys->sem_mt )",
          "new_text": "ffmpeg_OpenCodec( p_dec )",
          "old_line_content": "        vlc_sem_destroy( &p_sys->sem_mt );",
          "new_line_content": "    if( ffmpeg_OpenCodec( p_dec ) < 0 )",
          "content_same": false
        },
        {
          "line": 459,
          "old_api": "msg_Err",
          "new_api": "ffmpeg_InitCodec",
          "old_text": "msg_Err( p_dec, \"cannot open codec (%s)\", p_sys->psz_namecodec )",
          "new_text": "ffmpeg_InitCodec( p_dec )",
          "old_line_content": "                msg_Err( p_dec, \"cannot open codec (%s)\", p_sys->psz_namecodec );",
          "new_line_content": "        ffmpeg_InitCodec( p_dec );",
          "content_same": false
        },
        {
          "line": 496,
          "old_api": "msg_Err",
          "new_api": "INT64_C",
          "old_text": "msg_Err( p_dec, \"more than 5 seconds of late video -> \"\n                     \"dropping frame (computer too slow ?)\" )",
          "new_text": "INT64_C(5000000)",
          "old_line_content": "            msg_Err( p_dec, \"more than 5 seconds of late video -> \"",
          "new_line_content": "        (mdate() - p_sys->i_late_frames_start > INT64_C(5000000)) )",
          "content_same": false
        },
        {
          "line": 500,
          "old_api": "block_Release",
          "new_api": "msg_Err",
          "old_text": "block_Release( p_block )",
          "new_text": "msg_Err( p_dec, \"more than 5 seconds of late video -> \"\n                     \"dropping frame (computer too slow ?)\" )",
          "old_line_content": "        block_Release( p_block );",
          "new_line_content": "            msg_Err( p_dec, \"more than 5 seconds of late video -> \"",
          "content_same": false
        },
        {
          "line": 802,
          "old_api": "block_Release",
          "new_api": "decoder_DeletePicture",
          "old_text": "block_Release( p_block )",
          "new_text": "decoder_DeletePicture( p_dec, p_pic )",
          "old_line_content": "    block_Release( p_block );",
          "new_line_content": "            decoder_DeletePicture( p_dec, p_pic );",
          "content_same": false
        },
        {
          "line": 820,
          "old_api": "avcodec_flush_buffers",
          "new_api": "post_mt",
          "old_text": "avcodec_flush_buffers( p_sys->p_context )",
          "new_text": "post_mt( p_sys )",
          "old_line_content": "        avcodec_flush_buffers( p_sys->p_context );",
          "new_line_content": "    post_mt( p_sys );",
          "content_same": false
        },
        {
          "line": 824,
          "old_api": "av_free",
          "new_api": "avcodec_flush_buffers",
          "old_text": "av_free( p_sys->p_ff_pic )",
          "new_text": "avcodec_flush_buffers( p_sys->p_context )",
          "old_line_content": "    if( p_sys->p_ff_pic ) av_free( p_sys->p_ff_pic );",
          "new_line_content": "        avcodec_flush_buffers( p_sys->p_context );",
          "content_same": false
        },
        {
          "line": 828,
          "old_api": "vlc_va_Delete",
          "new_api": "av_free",
          "old_text": "vlc_va_Delete( p_sys->p_va )",
          "new_text": "av_free( p_sys->p_ff_pic )",
          "old_line_content": "        vlc_va_Delete( p_sys->p_va );",
          "new_line_content": "    if( p_sys->p_ff_pic ) av_free( p_sys->p_ff_pic );",
          "content_same": false
        },
        {
          "line": 854,
          "old_api": "memcpy",
          "new_api": "malloc",
          "old_text": "memcpy( &p[0],  \"SVQ3\", 4 )",
          "new_text": "malloc( p_sys->p_context->extradata_size )",
          "old_line_content": "        memcpy( &p[0],  \"SVQ3\", 4 );",
          "new_line_content": "            malloc( p_sys->p_context->extradata_size );",
          "content_same": false
        },
        {
          "line": 860,
          "old_api": "strncmp",
          "new_api": "memcpy",
          "old_text": "strncmp( (char*)&p[0x56], \"SMI \", 4 )",
          "new_text": "memcpy( &p[12], p_dec->fmt_in.p_extra, i_size )",
          "old_line_content": "            strncmp( (char*)&p[0x56], \"SMI \", 4 ) )",
          "new_line_content": "        memcpy( &p[12], p_dec->fmt_in.p_extra, i_size );",
          "content_same": false
        },
        {
          "line": 928,
          "old_api": "vlc_memcpy",
          "new_api": "__MIN",
          "old_text": "vlc_memcpy( p_dst, p_src, i_size )",
          "new_text": "__MIN( i_src_stride, i_dst_stride )",
          "old_line_content": "                vlc_memcpy( p_dst, p_src, i_size );",
          "new_line_content": "            i_size = __MIN( i_src_stride, i_dst_stride );",
          "content_same": false
        },
        {
          "line": 967,
          "old_api": "msg_Err",
          "new_api": "vlc_va_Setup",
          "old_text": "msg_Err( p_dec, \"vlc_va_Setup failed\" )",
          "new_text": "vlc_va_Setup( p_sys->p_va,\n                          &p_context->hwaccel_context, &p_dec->fmt_out.video.i_chroma,\n                          p_context->width, p_context->height )",
          "old_line_content": "            msg_Err( p_dec, \"vlc_va_Setup failed\" );",
          "new_line_content": "        if( vlc_va_Setup( p_sys->p_va,",
          "content_same": false
        },
        {
          "line": 971,
          "old_api": "assert",
          "new_api": "msg_Err",
          "old_text": "assert(0)",
          "new_text": "msg_Err( p_dec, \"vlc_va_Setup failed\" )",
          "old_line_content": "        assert(0);",
          "new_line_content": "            msg_Err( p_dec, \"vlc_va_Setup failed\" );",
          "content_same": false
        },
        {
          "line": 1080,
          "old_api": "avcodec_default_get_buffer",
          "new_api": "msg_Warn",
          "old_text": "avcodec_default_get_buffer( p_context, p_ff_pic )",
          "new_text": "msg_Warn( p_dec, \"disabling direct rendering\" )",
          "old_line_content": "    return avcodec_default_get_buffer( p_context, p_ff_pic );",
          "new_line_content": "        msg_Warn( p_dec, \"disabling direct rendering\" );",
          "content_same": false
        },
        {
          "line": 1157,
          "old_api": "msg_Dbg",
          "new_api": "msg_Warn",
          "old_text": "msg_Dbg( p_dec, \"Trying VA API\" )",
          "new_text": "msg_Warn( p_dec, \"Ignoring VA API\" )",
          "old_line_content": "            msg_Dbg( p_dec, \"Trying VA API\" );",
          "new_line_content": "                msg_Warn( p_dec, \"Ignoring VA API\" );",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 526,
          "old_api": null,
          "new_api": "block_Release",
          "old_text": null,
          "new_text": "block_Release( p_block )",
          "old_line_content": "    else",
          "new_line_content": "            block_Release( p_block );",
          "content_same": false
        },
        {
          "line": 1047,
          "old_api": null,
          "new_api": "decoder_DeletePicture",
          "old_text": null,
          "new_text": "decoder_DeletePicture( p_dec, p_pic )",
          "old_line_content": "    if( p_sys->i_direct_rendering_used != 1 )",
          "new_line_content": "        decoder_DeletePicture( p_dec, p_pic );",
          "content_same": false
        },
        {
          "line": 1053,
          "old_api": null,
          "new_api": "msg_Dbg",
          "old_text": null,
          "new_text": "msg_Dbg( p_dec, \"using direct rendering\" )",
          "old_line_content": "    p_context->draw_horiz_band = NULL;",
          "new_line_content": "        msg_Dbg( p_dec, \"using direct rendering\" );",
          "content_same": false
        },
        {
          "line": 552,
          "old_api": null,
          "new_api": "__MAX",
          "old_text": null,
          "new_text": "__MAX( p_context->skip_frame,\n                                                  AVDISCARD_NONREF )",
          "old_line_content": "",
          "new_line_content": "            p_context->skip_frame = __MAX( p_context->skip_frame,",
          "content_same": false
        },
        {
          "line": 1074,
          "old_api": null,
          "new_api": "post_mt",
          "old_text": null,
          "new_text": "post_mt( p_sys )",
          "old_line_content": "    if( p_sys->i_direct_rendering_used != 0 )",
          "new_line_content": "    post_mt( p_sys );",
          "content_same": false
        },
        {
          "line": 566,
          "old_api": null,
          "new_api": "block_Realloc",
          "old_text": null,
          "new_text": "block_Realloc( p_block, 0,\n                            p_block->i_buffer + FF_INPUT_BUFFER_PADDING_SIZE )",
          "old_line_content": "        p_block->i_buffer -= FF_INPUT_BUFFER_PADDING_SIZE;",
          "new_line_content": "        p_block = block_Realloc( p_block, 0,",
          "content_same": false
        },
        {
          "line": 1083,
          "old_api": null,
          "new_api": "post_mt",
          "old_text": null,
          "new_text": "post_mt( p_sys )",
          "old_line_content": "{",
          "new_line_content": "    post_mt( p_sys );",
          "content_same": false
        },
        {
          "line": 1084,
          "old_api": null,
          "new_api": "avcodec_default_get_buffer",
          "old_text": null,
          "new_text": "avcodec_default_get_buffer( p_context, p_ff_pic )",
          "old_line_content": "    p_ff_pic->reordered_opaque = p_context->reordered_opaque;",
          "new_line_content": "    return avcodec_default_get_buffer( p_context, p_ff_pic );",
          "content_same": false
        },
        {
          "line": 572,
          "old_api": null,
          "new_api": "memset",
          "old_text": null,
          "new_text": "memset( p_block->p_buffer + p_block->i_buffer, 0,\n                FF_INPUT_BUFFER_PADDING_SIZE )",
          "old_line_content": "    while( p_block->i_buffer > 0 || p_sys->b_flush )",
          "new_line_content": "        memset( p_block->p_buffer + p_block->i_buffer, 0,",
          "content_same": false
        },
        {
          "line": 1091,
          "old_api": null,
          "new_api": "avcodec_default_reget_buffer",
          "old_text": null,
          "new_text": "avcodec_default_reget_buffer( p_context, p_ff_pic )",
          "old_line_content": "                                    AVFrame *p_ff_pic )",
          "new_line_content": "    return avcodec_default_reget_buffer( p_context, p_ff_pic );",
          "content_same": false
        },
        {
          "line": 1102,
          "old_api": null,
          "new_api": "vlc_va_Release",
          "old_text": null,
          "new_text": "vlc_va_Release( p_sys->p_va, p_ff_pic )",
          "old_line_content": "        /* We can end up here without the AVFrame being allocated by",
          "new_line_content": "        vlc_va_Release( p_sys->p_va, p_ff_pic );",
          "content_same": false
        },
        {
          "line": 595,
          "old_api": null,
          "new_api": "post_mt",
          "old_text": null,
          "new_text": "post_mt( p_sys )",
          "old_line_content": "        pkt.size = p_block->i_buffer;",
          "new_line_content": "        post_mt( p_sys );",
          "content_same": false
        },
        {
          "line": 597,
          "old_api": null,
          "new_api": "av_init_packet",
          "old_text": null,
          "new_text": "av_init_packet( &pkt )",
          "old_line_content": "                                       &b_gotpicture, &pkt );",
          "new_line_content": "        av_init_packet( &pkt );",
          "content_same": false
        },
        {
          "line": 1111,
          "old_api": null,
          "new_api": "avcodec_default_release_buffer",
          "old_text": null,
          "new_text": "avcodec_default_release_buffer( p_context, p_ff_pic )",
          "old_line_content": "        picture_t *p_pic = (picture_t*)p_ff_pic->opaque;",
          "new_line_content": "            avcodec_default_release_buffer( p_context, p_ff_pic );",
          "content_same": false
        },
        {
          "line": 600,
          "old_api": null,
          "new_api": "avcodec_decode_video2",
          "old_text": null,
          "new_text": "avcodec_decode_video2( p_context, p_sys->p_ff_pic,\n                                       &b_gotpicture, &pkt )",
          "old_line_content": "            p_context->width > 0 && p_context->height > 0 )",
          "new_line_content": "        i_used = avcodec_decode_video2( p_context, p_sys->p_ff_pic,",
          "content_same": false
        },
        {
          "line": 1117,
          "old_api": null,
          "new_api": "decoder_UnlinkPicture",
          "old_text": null,
          "new_text": "decoder_UnlinkPicture( p_dec, p_pic )",
          "old_line_content": "}",
          "new_line_content": "        decoder_UnlinkPicture( p_dec, p_pic );",
          "content_same": false
        },
        {
          "line": 610,
          "old_api": null,
          "new_api": "avcodec_decode_video2",
          "old_text": null,
          "new_text": "avcodec_decode_video2( p_context, p_sys->p_ff_pic,\n                                           &b_gotpicture, &pkt )",
          "old_line_content": "",
          "new_line_content": "            i_used = avcodec_decode_video2( p_context, p_sys->p_ff_pic,",
          "content_same": false
        },
        {
          "line": 613,
          "old_api": null,
          "new_api": "wait_mt",
          "old_text": null,
          "new_text": "wait_mt( p_sys )",
          "old_line_content": "",
          "new_line_content": "        wait_mt( p_sys );",
          "content_same": false
        },
        {
          "line": 1132,
          "old_api": null,
          "new_api": "vlc_va_Delete",
          "old_text": null,
          "new_text": "vlc_va_Delete( p_sys->p_va )",
          "old_line_content": "    /* Try too look for a supported hw acceleration */",
          "new_line_content": "        vlc_va_Delete( p_sys->p_va );",
          "content_same": false
        },
        {
          "line": 624,
          "old_api": null,
          "new_api": "msg_Warn",
          "old_text": null,
          "new_text": "msg_Warn( p_dec, \"cannot decode one frame (%zu bytes)\",\n                          p_block->i_buffer )",
          "old_line_content": "        }",
          "new_line_content": "                msg_Warn( p_dec, \"cannot decode one frame (%zu bytes)\",",
          "content_same": false
        },
        {
          "line": 626,
          "old_api": null,
          "new_api": "block_Release",
          "old_text": null,
          "new_text": "block_Release( p_block )",
          "old_line_content": "                 p_context->thread_count > 1 )",
          "new_line_content": "            block_Release( p_block );",
          "content_same": false
        },
        {
          "line": 1150,
          "old_api": null,
          "new_api": "msg_Dbg",
          "old_text": null,
          "new_text": "msg_Dbg( p_dec, \"Available decoder output format %d (%s)\", pi_fmt[i], ppsz_name[pi_fmt[i]] ?: \"Unknown\" )",
          "old_line_content": "        {",
          "new_line_content": "        msg_Dbg( p_dec, \"Available decoder output format %d (%s)\", pi_fmt[i], ppsz_name[pi_fmt[i]] ?: \"Unknown\" );",
          "content_same": false
        },
        {
          "line": 1155,
          "old_api": null,
          "new_api": "var_InheritBool",
          "old_text": null,
          "new_text": "var_InheritBool( p_dec, \"xlib\" )",
          "old_line_content": "            }",
          "new_line_content": "            if( !var_InheritBool( p_dec, \"xlib\" ) )",
          "content_same": false
        },
        {
          "line": 1161,
          "old_api": null,
          "new_api": "msg_Dbg",
          "old_text": null,
          "new_text": "msg_Dbg( p_dec, \"Trying VA API\" )",
          "old_line_content": "#else",
          "new_line_content": "            msg_Dbg( p_dec, \"Trying VA API\" );",
          "content_same": false
        },
        {
          "line": 1162,
          "old_api": null,
          "new_api": "VLC_OBJECT",
          "old_text": null,
          "new_text": "VLC_OBJECT(p_dec)",
          "old_line_content": "            continue;",
          "new_line_content": "            p_sys->p_va = vlc_va_NewVaapi( VLC_OBJECT(p_dec), p_sys->i_codec_id );",
          "content_same": false
        },
        {
          "line": 1164,
          "old_api": null,
          "new_api": "msg_Warn",
          "old_text": null,
          "new_text": "msg_Warn( p_dec, \"Failed to open VA API\" )",
          "old_line_content": "        }",
          "new_line_content": "                msg_Warn( p_dec, \"Failed to open VA API\" );",
          "content_same": false
        },
        {
          "line": 1172,
          "old_api": null,
          "new_api": "msg_Dbg",
          "old_text": null,
          "new_text": "msg_Dbg( p_dec, \"Trying DXVA2\" )",
          "old_line_content": "        }",
          "new_line_content": "            msg_Dbg( p_dec, \"Trying DXVA2\" );",
          "content_same": false
        },
        {
          "line": 1173,
          "old_api": null,
          "new_api": "VLC_OBJECT",
          "old_text": null,
          "new_text": "VLC_OBJECT(p_dec)",
          "old_line_content": "#endif",
          "new_line_content": "            p_sys->p_va = vlc_va_NewDxva2( VLC_OBJECT(p_dec), p_sys->i_codec_id );",
          "content_same": false
        },
        {
          "line": 1175,
          "old_api": null,
          "new_api": "msg_Warn",
          "old_text": null,
          "new_text": "msg_Warn( p_dec, \"Failed to open DXVA2\" )",
          "old_line_content": "        if( p_sys->p_va &&",
          "new_line_content": "                msg_Warn( p_dec, \"Failed to open DXVA2\" );",
          "content_same": false
        },
        {
          "line": 1184,
          "old_api": null,
          "new_api": "vlc_va_Setup",
          "old_text": null,
          "new_text": "vlc_va_Setup( p_sys->p_va,\n                              &p_context->hwaccel_context,\n                              &p_dec->fmt_out.video.i_chroma,\n                              p_context->width, p_context->height )",
          "old_line_content": "            {",
          "new_line_content": "            if( vlc_va_Setup( p_sys->p_va,",
          "content_same": false
        },
        {
          "line": 1189,
          "old_api": null,
          "new_api": "msg_Err",
          "old_text": null,
          "new_text": "msg_Err( p_dec, \"vlc_va_Setup failed\" )",
          "old_line_content": "        }",
          "new_line_content": "                msg_Err( p_dec, \"vlc_va_Setup failed\" );",
          "content_same": false
        },
        {
          "line": 1190,
          "old_api": null,
          "new_api": "vlc_va_Delete",
          "old_text": null,
          "new_text": "vlc_va_Delete( p_sys->p_va )",
          "old_line_content": "",
          "new_line_content": "                vlc_va_Delete( p_sys->p_va );",
          "content_same": false
        },
        {
          "line": 1198,
          "old_api": null,
          "new_api": "msg_Info",
          "old_text": null,
          "new_text": "msg_Info( p_dec, \"Using %s for hardware decoding.\", p_sys->p_va->description )",
          "old_line_content": "             */",
          "new_line_content": "                msg_Info( p_dec, \"Using %s for hardware decoding.\", p_sys->p_va->description );",
          "content_same": false
        },
        {
          "line": 692,
          "old_api": null,
          "new_api": "INT64_C",
          "old_text": null,
          "new_text": "INT64_C(1000000)",
          "old_line_content": "            }",
          "new_line_content": "                p_sys->i_pts += INT64_C(1000000) *",
          "content_same": false
        },
        {
          "line": 1210,
          "old_api": null,
          "new_api": "avcodec_default_get_format",
          "old_text": null,
          "new_text": "avcodec_default_get_format( p_context, pi_fmt )",
          "old_line_content": "",
          "new_line_content": "    return avcodec_default_get_format( p_context, pi_fmt );",
          "content_same": false
        },
        {
          "line": 703,
          "old_api": null,
          "new_api": "INT64_C",
          "old_text": null,
          "new_text": "INT64_C(1000000)",
          "old_line_content": "            }",
          "new_line_content": "                p_sys->i_pts += INT64_C(1000000) *",
          "content_same": false
        },
        {
          "line": 713,
          "old_api": null,
          "new_api": "decoder_GetDisplayDate",
          "old_text": null,
          "new_text": "decoder_GetDisplayDate( p_dec, i_pts )",
          "old_line_content": "            p_sys->i_late_frames++;",
          "new_line_content": "            i_display_date = decoder_GetDisplayDate( p_dec, i_pts );",
          "content_same": false
        },
        {
          "line": 719,
          "old_api": null,
          "new_api": "mdate",
          "old_text": null,
          "new_text": "mdate()",
          "old_line_content": "            p_sys->i_late_frames = 0;",
          "new_line_content": "                p_sys->i_late_frames_start = mdate();",
          "content_same": false
        },
        {
          "line": 732,
          "old_api": null,
          "new_api": "ffmpeg_NewPictBuf",
          "old_text": null,
          "new_text": "ffmpeg_NewPictBuf( p_dec, p_context )",
          "old_line_content": "                return NULL;",
          "new_line_content": "            p_pic = ffmpeg_NewPictBuf( p_dec, p_context );",
          "content_same": false
        },
        {
          "line": 735,
          "old_api": null,
          "new_api": "block_Release",
          "old_text": null,
          "new_text": "block_Release( p_block )",
          "old_line_content": "            /* Fill p_picture_t from AVVideoFrame and do chroma conversion",
          "new_line_content": "                block_Release( p_block );",
          "content_same": false
        },
        {
          "line": 741,
          "old_api": null,
          "new_api": "ffmpeg_CopyPicture",
          "old_text": null,
          "new_text": "ffmpeg_CopyPicture( p_dec, p_pic, p_sys->p_ff_pic )",
          "old_line_content": "            p_pic = (picture_t *)p_sys->p_ff_pic->opaque;",
          "new_line_content": "            ffmpeg_CopyPicture( p_dec, p_pic, p_sys->p_ff_pic );",
          "content_same": false
        },
        {
          "line": 746,
          "old_api": null,
          "new_api": "decoder_LinkPicture",
          "old_text": null,
          "new_text": "decoder_LinkPicture( p_dec, p_pic )",
          "old_line_content": "        {",
          "new_line_content": "            decoder_LinkPicture( p_dec, p_pic );",
          "content_same": false
        },
        {
          "line": 782,
          "old_api": null,
          "new_api": "malloc",
          "old_text": null,
          "new_text": "malloc( p_pic->i_qstride * i_mb_h )",
          "old_line_content": "            {",
          "new_line_content": "            p_pic->p_q = malloc( p_pic->i_qstride * i_mb_h );",
          "content_same": false
        },
        {
          "line": 783,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy( p_pic->p_q, p_sys->p_ff_pic->qscale_table,\n                    p_pic->i_qstride * i_mb_h )",
          "old_line_content": "                case FF_QSCALE_TYPE_MPEG1:",
          "new_line_content": "            memcpy( p_pic->p_q, p_sys->p_ff_pic->qscale_table,",
          "content_same": false
        },
        {
          "line": 806,
          "old_api": null,
          "new_api": "block_Release",
          "old_text": null,
          "new_text": "block_Release( p_block )",
          "old_line_content": "/*****************************************************************************",
          "new_line_content": "    block_Release( p_block );",
          "content_same": false
        },
        {
          "line": 826,
          "old_api": null,
          "new_api": "wait_mt",
          "old_text": null,
          "new_text": "wait_mt( p_sys )",
          "old_line_content": "    if( p_sys->p_va )",
          "new_line_content": "    wait_mt( p_sys );",
          "content_same": false
        },
        {
          "line": 832,
          "old_api": null,
          "new_api": "vlc_va_Delete",
          "old_text": null,
          "new_text": "vlc_va_Delete( p_sys->p_va )",
          "old_line_content": "}",
          "new_line_content": "        vlc_va_Delete( p_sys->p_va );",
          "content_same": false
        },
        {
          "line": 835,
          "old_api": null,
          "new_api": "vlc_sem_destroy",
          "old_text": null,
          "new_text": "vlc_sem_destroy( &p_sys->sem_mt )",
          "old_line_content": " * ffmpeg_InitCodec: setup codec extra initialization data for ffmpeg",
          "new_line_content": "    vlc_sem_destroy( &p_sys->sem_mt );",
          "content_same": false
        },
        {
          "line": 858,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy( &p[0],  \"SVQ3\", 4 )",
          "old_line_content": "        /* Now remove all atoms before the SMI one */",
          "new_line_content": "        memcpy( &p[0],  \"SVQ3\", 4 );",
          "content_same": false
        },
        {
          "line": 859,
          "old_api": null,
          "new_api": "memset",
          "old_text": null,
          "new_text": "memset( &p[4], 0, 8 )",
          "old_line_content": "        if( p_sys->p_context->extradata_size > 0x5a &&",
          "new_line_content": "        memset( &p[4], 0, 8 );",
          "content_same": false
        },
        {
          "line": 352,
          "old_api": null,
          "new_api": "__MIN",
          "old_text": null,
          "new_text": "__MIN( i_thread_count, 16 )",
          "old_line_content": "",
          "new_line_content": "    i_thread_count = __MIN( i_thread_count, 16 );",
          "content_same": false
        },
        {
          "line": 353,
          "old_api": null,
          "new_api": "msg_Dbg",
          "old_text": null,
          "new_text": "msg_Dbg( p_dec, \"allowing %d thread(s) for decoding\", i_thread_count )",
          "old_line_content": "#ifdef HAVE_AVCODEC_VA",
          "new_line_content": "    msg_Dbg( p_dec, \"allowing %d thread(s) for decoding\", i_thread_count );",
          "content_same": false
        },
        {
          "line": 864,
          "old_api": null,
          "new_api": "strncmp",
          "old_text": null,
          "new_text": "strncmp( (char*)&p[0x56], \"SMI \", 4 )",
          "old_line_content": "            while( psz < &p[p_sys->p_context->extradata_size - 8] )",
          "new_line_content": "            strncmp( (char*)&p[0x56], \"SMI \", 4 ) )",
          "content_same": false
        },
        {
          "line": 358,
          "old_api": null,
          "new_api": "var_CreateGetBool",
          "old_text": null,
          "new_text": "var_CreateGetBool( p_dec, \"ffmpeg-hw\" )",
          "old_line_content": "         i_codec_id == CODEC_ID_H264 ||",
          "new_line_content": "    const bool b_use_hw = var_CreateGetBool( p_dec, \"ffmpeg-hw\" );",
          "content_same": false
        },
        {
          "line": 870,
          "old_api": null,
          "new_api": "GetDWBE",
          "old_text": null,
          "new_text": "GetDWBE( psz )",
          "old_line_content": "                    break;",
          "new_line_content": "                int i_size = GetDWBE( psz );",
          "content_same": false
        },
        {
          "line": 876,
          "old_api": null,
          "new_api": "strncmp",
          "old_text": null,
          "new_text": "strncmp( (char*)&psz[4], \"SMI \", 4 )",
          "old_line_content": "                    break;",
          "new_line_content": "                if( !strncmp( (char*)&psz[4], \"SMI \", 4 ) )",
          "content_same": false
        },
        {
          "line": 878,
          "old_api": null,
          "new_api": "memmove",
          "old_text": null,
          "new_text": "memmove( &p[0x52], psz,\n                             &p[p_sys->p_context->extradata_size] - psz )",
          "old_line_content": "",
          "new_line_content": "                    memmove( &p[0x52], psz,",
          "content_same": false
        },
        {
          "line": 368,
          "old_api": null,
          "new_api": "msg_Warn",
          "old_text": null,
          "new_text": "msg_Warn( p_dec, \"threaded frame decoding is not compatible with ffmpeg-hw, disabled\" )",
          "old_line_content": "        p_sys->p_context->get_format = ffmpeg_GetFormat;",
          "new_line_content": "            msg_Warn( p_dec, \"threaded frame decoding is not compatible with ffmpeg-hw, disabled\" );",
          "content_same": false
        },
        {
          "line": 891,
          "old_api": null,
          "new_api": "malloc",
          "old_text": null,
          "new_text": "malloc( i_size + FF_INPUT_BUFFER_PADDING_SIZE )",
          "old_line_content": "                    p_dec->fmt_in.p_extra, i_size );",
          "new_line_content": "            malloc( i_size + FF_INPUT_BUFFER_PADDING_SIZE );",
          "content_same": false
        },
        {
          "line": 894,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy( p_sys->p_context->extradata,\n                    p_dec->fmt_in.p_extra, i_size )",
          "old_line_content": "        }",
          "new_line_content": "            memcpy( p_sys->p_context->extradata,",
          "content_same": false
        },
        {
          "line": 896,
          "old_api": null,
          "new_api": "memset",
          "old_text": null,
          "new_text": "memset( &((uint8_t*)p_sys->p_context->extradata)[i_size],\n                    0, FF_INPUT_BUFFER_PADDING_SIZE )",
          "old_line_content": "}",
          "new_line_content": "            memset( &((uint8_t*)p_sys->p_context->extradata)[i_size],",
          "content_same": false
        },
        {
          "line": 390,
          "old_api": null,
          "new_api": "GetVlcChroma",
          "old_text": null,
          "new_text": "GetVlcChroma( &p_dec->fmt_out.video, p_context->pix_fmt )",
          "old_line_content": "    }",
          "new_line_content": "    if( GetVlcChroma( &p_dec->fmt_out.video, p_context->pix_fmt ) != VLC_SUCCESS )",
          "content_same": false
        },
        {
          "line": 398,
          "old_api": null,
          "new_api": "memset",
          "old_text": null,
          "new_text": "memset( &p_sys->palette, 0, sizeof(p_sys->palette) )",
          "old_line_content": "",
          "new_line_content": "    memset( &p_sys->palette, 0, sizeof(p_sys->palette) );",
          "content_same": false
        },
        {
          "line": 913,
          "old_api": null,
          "new_api": "vlc_va_Extract",
          "old_text": null,
          "new_text": "vlc_va_Extract( p_sys->p_va, p_pic, p_ff_pic )",
          "old_line_content": "        int i_plane, i_size, i_line;",
          "new_line_content": "        vlc_va_Extract( p_sys->p_va, p_pic, p_ff_pic );",
          "content_same": false
        },
        {
          "line": 403,
          "old_api": null,
          "new_api": "__MIN",
          "old_text": null,
          "new_text": "__MIN( AVPALETTE_COUNT, p_dec->fmt_in.video.p_palette->i_entries )",
          "old_line_content": "                uint8_t a[4];",
          "new_line_content": "        for( int i = 0; i < __MIN( AVPALETTE_COUNT, p_dec->fmt_in.video.p_palette->i_entries ); i++ )",
          "content_same": false
        },
        {
          "line": 915,
          "old_api": null,
          "new_api": "TestFfmpegChroma",
          "old_text": null,
          "new_text": "TestFfmpegChroma( p_sys->p_context->pix_fmt, -1 )",
          "old_line_content": "        int i_src_stride, i_dst_stride;",
          "new_line_content": "    else if( TestFfmpegChroma( p_sys->p_context->pix_fmt, -1 ) == VLC_SUCCESS )",
          "content_same": false
        },
        {
          "line": 418,
          "old_api": null,
          "new_api": "malloc",
          "old_text": null,
          "new_text": "malloc( sizeof(video_palette_t) )",
          "old_line_content": "    else if( p_sys->i_codec_id != CODEC_ID_MSVIDEO1 && p_sys->i_codec_id != CODEC_ID_CINEPAK )",
          "new_line_content": "        p_dec->fmt_out.video.p_palette = malloc( sizeof(video_palette_t) );",
          "content_same": false
        },
        {
          "line": 932,
          "old_api": null,
          "new_api": "vlc_memcpy",
          "old_text": null,
          "new_text": "vlc_memcpy( p_dst, p_src, i_size )",
          "old_line_content": "        }",
          "new_line_content": "                vlc_memcpy( p_dst, p_src, i_size );",
          "content_same": false
        },
        {
          "line": 428,
          "old_api": null,
          "new_api": "ffmpeg_InitCodec",
          "old_text": null,
          "new_text": "ffmpeg_InitCodec( p_dec )",
          "old_line_content": "    {",
          "new_line_content": "    ffmpeg_InitCodec( p_dec );",
          "content_same": false
        },
        {
          "line": 940,
          "old_api": null,
          "new_api": "msg_Err",
          "old_text": null,
          "new_text": "msg_Err( p_dec, \"don't know how to convert chroma %i\",\n                 p_sys->p_context->pix_fmt )",
          "old_line_content": "}",
          "new_line_content": "        msg_Err( p_dec, \"don't know how to convert chroma %i\",",
          "content_same": false
        },
        {
          "line": 433,
          "old_api": null,
          "new_api": "msg_Err",
          "old_text": null,
          "new_text": "msg_Err( p_dec, \"cannot open codec (%s)\", p_sys->psz_namecodec )",
          "old_line_content": "        return VLC_EGENERIC;",
          "new_line_content": "        msg_Err( p_dec, \"cannot open codec (%s)\", p_sys->psz_namecodec );",
          "content_same": false
        },
        {
          "line": 434,
          "old_api": null,
          "new_api": "av_free",
          "old_text": null,
          "new_text": "av_free( p_sys->p_ff_pic )",
          "old_line_content": "    }",
          "new_line_content": "        av_free( p_sys->p_ff_pic );",
          "content_same": false
        },
        {
          "line": 435,
          "old_api": null,
          "new_api": "vlc_sem_destroy",
          "old_text": null,
          "new_text": "vlc_sem_destroy( &p_sys->sem_mt )",
          "old_line_content": "",
          "new_line_content": "        vlc_sem_destroy( &p_sys->sem_mt );",
          "content_same": false
        },
        {
          "line": 436,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free( p_sys )",
          "old_line_content": "    return VLC_SUCCESS;",
          "new_line_content": "        free( p_sys );",
          "content_same": false
        },
        {
          "line": 462,
          "old_api": null,
          "new_api": "ffmpeg_OpenCodec",
          "old_text": null,
          "new_text": "ffmpeg_OpenCodec( p_dec )",
          "old_line_content": "",
          "new_line_content": "            if( ffmpeg_OpenCodec( p_dec ) )",
          "content_same": false
        },
        {
          "line": 463,
          "old_api": null,
          "new_api": "msg_Err",
          "old_text": null,
          "new_text": "msg_Err( p_dec, \"cannot open codec (%s)\", p_sys->psz_namecodec )",
          "old_line_content": "    p_block = *pp_block;",
          "new_line_content": "                msg_Err( p_dec, \"cannot open codec (%s)\", p_sys->psz_namecodec );",
          "content_same": false
        },
        {
          "line": 975,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(0)",
          "old_line_content": "        p_ff_pic->type = FF_BUFFER_TYPE_USER;",
          "new_line_content": "        assert(0);",
          "content_same": false
        },
        {
          "line": 470,
          "old_api": null,
          "new_api": "block_Release",
          "old_text": null,
          "new_text": "block_Release( p_block )",
          "old_line_content": "    if( p_block->i_flags & (BLOCK_FLAG_DISCONTINUITY|BLOCK_FLAG_CORRUPTED) )",
          "new_line_content": "        block_Release( p_block );",
          "content_same": false
        },
        {
          "line": 983,
          "old_api": null,
          "new_api": "vlc_va_Get",
          "old_text": null,
          "new_text": "vlc_va_Get( p_sys->p_va, p_ff_pic )",
          "old_line_content": "        }",
          "new_line_content": "        if( vlc_va_Get( p_sys->p_va, p_ff_pic ) )",
          "content_same": false
        },
        {
          "line": 985,
          "old_api": null,
          "new_api": "msg_Err",
          "old_text": null,
          "new_text": "msg_Err( p_dec, \"VaGrabSurface failed\" )",
          "old_line_content": "    }",
          "new_line_content": "            msg_Err( p_dec, \"VaGrabSurface failed\" );",
          "content_same": false
        },
        {
          "line": 481,
          "old_api": null,
          "new_api": "avcodec_flush_buffers",
          "old_text": null,
          "new_text": "avcodec_flush_buffers( p_context )",
          "old_line_content": "    }",
          "new_line_content": "            avcodec_flush_buffers( p_context );",
          "content_same": false
        },
        {
          "line": 993,
          "old_api": null,
          "new_api": "avcodec_default_get_buffer",
          "old_text": null,
          "new_text": "avcodec_default_get_buffer( p_context, p_ff_pic )",
          "old_line_content": "    /* Some codecs set pix_fmt only after the 1st frame has been decoded,",
          "new_line_content": "        return avcodec_default_get_buffer( p_context, p_ff_pic );",
          "content_same": false
        },
        {
          "line": 483,
          "old_api": null,
          "new_api": "block_Release",
          "old_text": null,
          "new_text": "block_Release( p_block )",
          "old_line_content": "    if( p_block->i_flags & BLOCK_FLAG_PREROLL )",
          "new_line_content": "        block_Release( p_block );",
          "content_same": false
        },
        {
          "line": 996,
          "old_api": null,
          "new_api": "wait_mt",
          "old_text": null,
          "new_text": "wait_mt( p_sys )",
          "old_line_content": "    int i_width = p_context->width;",
          "new_line_content": "    wait_mt( p_sys );",
          "content_same": false
        },
        {
          "line": 1002,
          "old_api": null,
          "new_api": "avcodec_align_dimensions",
          "old_text": null,
          "new_text": "avcodec_align_dimensions( p_context, &i_width, &i_height )",
          "old_line_content": "        goto no_dr;",
          "new_line_content": "    avcodec_align_dimensions( p_context, &i_width, &i_height );",
          "content_same": false
        },
        {
          "line": 1004,
          "old_api": null,
          "new_api": "GetVlcChroma",
          "old_text": null,
          "new_text": "GetVlcChroma( &p_dec->fmt_out.video, p_context->pix_fmt )",
          "old_line_content": "    p_dec->fmt_out.i_codec = p_dec->fmt_out.video.i_chroma;",
          "new_line_content": "    if( GetVlcChroma( &p_dec->fmt_out.video, p_context->pix_fmt ) != VLC_SUCCESS ||",
          "content_same": false
        },
        {
          "line": 1011,
          "old_api": null,
          "new_api": "ffmpeg_NewPictBuf",
          "old_text": null,
          "new_text": "ffmpeg_NewPictBuf( p_dec, p_context )",
          "old_line_content": "    if( p_pic->p[0].i_pitch / p_pic->p[0].i_pixel_pitch < i_width ||",
          "new_line_content": "    p_pic = ffmpeg_NewPictBuf( p_dec, p_context );",
          "content_same": false
        },
        {
          "line": 504,
          "old_api": null,
          "new_api": "block_Release",
          "old_text": null,
          "new_text": "block_Release( p_block )",
          "old_line_content": "",
          "new_line_content": "        block_Release( p_block );",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 522,
          "old_api": "block_Release",
          "new_api": null,
          "old_text": "block_Release( p_block )",
          "new_text": null,
          "old_line_content": "            block_Release( p_block );",
          "new_line_content": "        {",
          "content_same": false
        },
        {
          "line": 1043,
          "old_api": "decoder_DeletePicture",
          "new_api": null,
          "old_text": "decoder_DeletePicture( p_dec, p_pic )",
          "new_text": null,
          "old_line_content": "        decoder_DeletePicture( p_dec, p_pic );",
          "new_line_content": "            b_compatible = false;",
          "content_same": false
        },
        {
          "line": 1049,
          "old_api": "msg_Dbg",
          "new_api": null,
          "old_text": "msg_Dbg( p_dec, \"using direct rendering\" )",
          "new_text": null,
          "old_line_content": "        msg_Dbg( p_dec, \"using direct rendering\" );",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 548,
          "old_api": "__MAX",
          "new_api": null,
          "old_text": "__MAX( p_context->skip_frame,\n                                                  AVDISCARD_NONREF )",
          "new_text": null,
          "old_line_content": "            p_context->skip_frame = __MAX( p_context->skip_frame,",
          "new_line_content": "        /* It creates broken picture",
          "content_same": false
        },
        {
          "line": 1070,
          "old_api": "post_mt",
          "new_api": null,
          "old_text": "post_mt( p_sys )",
          "new_text": null,
          "old_line_content": "    post_mt( p_sys );",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 562,
          "old_api": "block_Realloc",
          "new_api": null,
          "old_text": "block_Realloc( p_block, 0,\n                            p_block->i_buffer + FF_INPUT_BUFFER_PADDING_SIZE )",
          "new_text": null,
          "old_line_content": "        p_block = block_Realloc( p_block, 0,",
          "new_line_content": "    if( p_block->i_buffer > 0 )",
          "content_same": false
        },
        {
          "line": 1076,
          "old_api": "msg_Warn",
          "new_api": null,
          "old_text": "msg_Warn( p_dec, \"disabling direct rendering\" )",
          "new_text": null,
          "old_line_content": "        msg_Warn( p_dec, \"disabling direct rendering\" );",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1079,
          "old_api": "post_mt",
          "new_api": null,
          "old_text": "post_mt( p_sys )",
          "new_text": null,
          "old_line_content": "    post_mt( p_sys );",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 568,
          "old_api": "memset",
          "new_api": null,
          "old_text": "memset( p_block->p_buffer + p_block->i_buffer, 0,\n                FF_INPUT_BUFFER_PADDING_SIZE )",
          "new_text": null,
          "old_line_content": "        memset( p_block->p_buffer + p_block->i_buffer, 0,",
          "new_line_content": "        if( !p_block )",
          "content_same": false
        },
        {
          "line": 1087,
          "old_api": "avcodec_default_reget_buffer",
          "new_api": null,
          "old_text": "avcodec_default_reget_buffer( p_context, p_ff_pic )",
          "new_text": null,
          "old_line_content": "    return avcodec_default_reget_buffer( p_context, p_ff_pic );",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 1098,
          "old_api": "vlc_va_Release",
          "new_api": null,
          "old_text": "vlc_va_Release( p_sys->p_va, p_ff_pic )",
          "new_text": null,
          "old_line_content": "        vlc_va_Release( p_sys->p_va, p_ff_pic );",
          "new_line_content": "    decoder_sys_t *p_sys = p_dec->p_sys;",
          "content_same": false
        },
        {
          "line": 591,
          "old_api": "post_mt",
          "new_api": null,
          "old_text": "post_mt( p_sys )",
          "new_text": null,
          "old_line_content": "        post_mt( p_sys );",
          "new_line_content": "        /* Make sure we don't reuse the same timestamps twice */",
          "content_same": false
        },
        {
          "line": 593,
          "old_api": "av_init_packet",
          "new_api": null,
          "old_text": "av_init_packet( &pkt )",
          "new_text": null,
          "old_line_content": "        av_init_packet( &pkt );",
          "new_line_content": "        p_block->i_dts = VLC_TS_INVALID;",
          "content_same": false
        },
        {
          "line": 1107,
          "old_api": "avcodec_default_release_buffer",
          "new_api": null,
          "old_text": "avcodec_default_release_buffer( p_context, p_ff_pic )",
          "new_text": null,
          "old_line_content": "            avcodec_default_release_buffer( p_context, p_ff_pic );",
          "new_line_content": "         * avcodec_default_get_buffer() if VA is used and the frame is",
          "content_same": false
        },
        {
          "line": 596,
          "old_api": "avcodec_decode_video2",
          "new_api": null,
          "old_text": "avcodec_decode_video2( p_context, p_sys->p_ff_pic,\n                                       &b_gotpicture, &pkt )",
          "new_text": null,
          "old_line_content": "        i_used = avcodec_decode_video2( p_context, p_sys->p_ff_pic,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1113,
          "old_api": "decoder_UnlinkPicture",
          "new_api": null,
          "old_text": "decoder_UnlinkPicture( p_dec, p_pic )",
          "new_text": null,
          "old_line_content": "        decoder_UnlinkPicture( p_dec, p_pic );",
          "new_line_content": "    else",
          "content_same": false
        },
        {
          "line": 606,
          "old_api": "avcodec_decode_video2",
          "new_api": null,
          "old_text": "avcodec_decode_video2( p_context, p_sys->p_ff_pic,\n                                           &b_gotpicture, &pkt )",
          "new_text": null,
          "old_line_content": "            i_used = avcodec_decode_video2( p_context, p_sys->p_ff_pic,",
          "new_line_content": "            /* Reparse it to not drop the I frame */",
          "content_same": false
        },
        {
          "line": 609,
          "old_api": "wait_mt",
          "new_api": null,
          "old_text": "wait_mt( p_sys )",
          "new_text": null,
          "old_line_content": "        wait_mt( p_sys );",
          "new_line_content": "                p_context->skip_frame = p_sys->i_skip_frame;",
          "content_same": false
        },
        {
          "line": 1128,
          "old_api": "vlc_va_Delete",
          "new_api": null,
          "old_text": "vlc_va_Delete( p_sys->p_va )",
          "new_text": null,
          "old_line_content": "        vlc_va_Delete( p_sys->p_va );",
          "new_line_content": "    decoder_sys_t *p_sys = p_dec->p_sys;",
          "content_same": false
        },
        {
          "line": 620,
          "old_api": "msg_Warn",
          "new_api": null,
          "old_text": "msg_Warn( p_dec, \"cannot decode one frame (%zu bytes)\",\n                          p_block->i_buffer )",
          "new_text": null,
          "old_line_content": "                msg_Warn( p_dec, \"cannot decode one frame (%zu bytes)\",",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 622,
          "old_api": "block_Release",
          "new_api": null,
          "old_text": "block_Release( p_block )",
          "new_text": null,
          "old_line_content": "            block_Release( p_block );",
          "new_line_content": "        {",
          "content_same": false
        },
        {
          "line": 1146,
          "old_api": "msg_Dbg",
          "new_api": null,
          "old_text": "msg_Dbg( p_dec, \"Available decoder output format %d (%s)\", pi_fmt[i], ppsz_name[pi_fmt[i]] ?: \"Unknown\" )",
          "new_text": null,
          "old_line_content": "        msg_Dbg( p_dec, \"Available decoder output format %d (%s)\", pi_fmt[i], ppsz_name[pi_fmt[i]] ?: \"Unknown\" );",
          "new_line_content": "#endif",
          "content_same": false
        },
        {
          "line": 1151,
          "old_api": "var_InheritBool",
          "new_api": null,
          "old_text": "var_InheritBool( p_dec, \"xlib\" )",
          "new_text": null,
          "old_line_content": "            if( !var_InheritBool( p_dec, \"xlib\" ) )",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1153,
          "old_api": "msg_Warn",
          "new_api": null,
          "old_text": "msg_Warn( p_dec, \"Ignoring VA API\" )",
          "new_text": null,
          "old_line_content": "                msg_Warn( p_dec, \"Ignoring VA API\" );",
          "new_line_content": "        if( pi_fmt[i] == PIX_FMT_VAAPI_VLD )",
          "content_same": false
        },
        {
          "line": 1158,
          "old_api": "VLC_OBJECT",
          "new_api": null,
          "old_text": "VLC_OBJECT(p_dec)",
          "new_text": null,
          "old_line_content": "            p_sys->p_va = vlc_va_NewVaapi( VLC_OBJECT(p_dec), p_sys->i_codec_id );",
          "new_line_content": "                continue;",
          "content_same": false
        },
        {
          "line": 1160,
          "old_api": "msg_Warn",
          "new_api": null,
          "old_text": "msg_Warn( p_dec, \"Failed to open VA API\" )",
          "new_text": null,
          "old_line_content": "                msg_Warn( p_dec, \"Failed to open VA API\" );",
          "new_line_content": "#ifdef HAVE_AVCODEC_VAAPI",
          "content_same": false
        },
        {
          "line": 1168,
          "old_api": "msg_Dbg",
          "new_api": null,
          "old_text": "msg_Dbg( p_dec, \"Trying DXVA2\" )",
          "new_text": null,
          "old_line_content": "            msg_Dbg( p_dec, \"Trying DXVA2\" );",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 1169,
          "old_api": "VLC_OBJECT",
          "new_api": null,
          "old_text": "VLC_OBJECT(p_dec)",
          "new_text": null,
          "old_line_content": "            p_sys->p_va = vlc_va_NewDxva2( VLC_OBJECT(p_dec), p_sys->i_codec_id );",
          "new_line_content": "#ifdef HAVE_AVCODEC_DXVA2",
          "content_same": false
        },
        {
          "line": 1171,
          "old_api": "msg_Warn",
          "new_api": null,
          "old_text": "msg_Warn( p_dec, \"Failed to open DXVA2\" )",
          "new_text": null,
          "old_line_content": "                msg_Warn( p_dec, \"Failed to open DXVA2\" );",
          "new_line_content": "        {",
          "content_same": false
        },
        {
          "line": 1180,
          "old_api": "vlc_va_Setup",
          "new_api": null,
          "old_text": "vlc_va_Setup( p_sys->p_va,\n                              &p_context->hwaccel_context,\n                              &p_dec->fmt_out.video.i_chroma,\n                              p_context->width, p_context->height )",
          "new_text": null,
          "old_line_content": "            if( vlc_va_Setup( p_sys->p_va,",
          "new_line_content": "            p_context->width > 0 && p_context->height > 0 )",
          "content_same": false
        },
        {
          "line": 1185,
          "old_api": "msg_Err",
          "new_api": null,
          "old_text": "msg_Err( p_dec, \"vlc_va_Setup failed\" )",
          "new_text": null,
          "old_line_content": "                msg_Err( p_dec, \"vlc_va_Setup failed\" );",
          "new_line_content": "                              &p_context->hwaccel_context,",
          "content_same": false
        },
        {
          "line": 1186,
          "old_api": "vlc_va_Delete",
          "new_api": null,
          "old_text": "vlc_va_Delete( p_sys->p_va )",
          "new_text": null,
          "old_line_content": "                vlc_va_Delete( p_sys->p_va );",
          "new_line_content": "                              &p_dec->fmt_out.video.i_chroma,",
          "content_same": false
        },
        {
          "line": 1194,
          "old_api": "msg_Info",
          "new_api": null,
          "old_text": "msg_Info( p_dec, \"Using %s for hardware decoding.\", p_sys->p_va->description )",
          "new_text": null,
          "old_line_content": "                msg_Info( p_dec, \"Using %s for hardware decoding.\", p_sys->p_va->description );",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 688,
          "old_api": "INT64_C",
          "new_api": null,
          "old_text": "INT64_C(1000000)",
          "new_text": null,
          "old_line_content": "                p_sys->i_pts += INT64_C(1000000) *",
          "new_line_content": "            /* interpolate the next PTS */",
          "content_same": false
        },
        {
          "line": 1206,
          "old_api": "avcodec_default_get_format",
          "new_api": null,
          "old_text": "avcodec_default_get_format( p_context, pi_fmt )",
          "new_text": null,
          "old_line_content": "    return avcodec_default_get_format( p_context, pi_fmt );",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 699,
          "old_api": "INT64_C",
          "new_api": null,
          "old_text": "INT64_C(1000000)",
          "new_text": null,
          "old_line_content": "                p_sys->i_pts += INT64_C(1000000) *",
          "new_line_content": "                int i_tick = p_context->ticks_per_frame;",
          "content_same": false
        },
        {
          "line": 709,
          "old_api": "decoder_GetDisplayDate",
          "new_api": null,
          "old_text": "decoder_GetDisplayDate( p_dec, i_pts )",
          "new_text": null,
          "old_line_content": "            i_display_date = decoder_GetDisplayDate( p_dec, i_pts );",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 711,
          "old_api": "mdate",
          "new_api": null,
          "old_text": "mdate()",
          "new_text": null,
          "old_line_content": "        if( i_display_date > 0 && i_display_date <= mdate() )",
          "new_line_content": "        mtime_t i_display_date = 0;",
          "content_same": false
        },
        {
          "line": 728,
          "old_api": "ffmpeg_NewPictBuf",
          "new_api": null,
          "old_text": "ffmpeg_NewPictBuf( p_dec, p_context )",
          "new_text": null,
          "old_line_content": "            p_pic = ffmpeg_NewPictBuf( p_dec, p_context );",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 731,
          "old_api": "block_Release",
          "new_api": null,
          "old_text": "block_Release( p_block )",
          "new_text": null,
          "old_line_content": "                block_Release( p_block );",
          "new_line_content": "            /* Get a new picture */",
          "content_same": false
        },
        {
          "line": 737,
          "old_api": "ffmpeg_CopyPicture",
          "new_api": null,
          "old_text": "ffmpeg_CopyPicture( p_dec, p_pic, p_sys->p_ff_pic )",
          "new_text": null,
          "old_line_content": "            ffmpeg_CopyPicture( p_dec, p_pic, p_sys->p_ff_pic );",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 742,
          "old_api": "decoder_LinkPicture",
          "new_api": null,
          "old_text": "decoder_LinkPicture( p_dec, p_pic )",
          "new_text": null,
          "old_line_content": "            decoder_LinkPicture( p_dec, p_pic );",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 778,
          "old_api": "malloc",
          "new_api": null,
          "old_text": "malloc( p_pic->i_qstride * i_mb_h )",
          "new_text": null,
          "old_line_content": "            p_pic->p_q = malloc( p_pic->i_qstride * i_mb_h );",
          "new_line_content": "            p_pic->b_top_field_first = p_sys->p_ff_pic->top_field_first;",
          "content_same": false
        },
        {
          "line": 779,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy( p_pic->p_q, p_sys->p_ff_pic->qscale_table,\n                    p_pic->i_qstride * i_mb_h )",
          "new_text": null,
          "old_line_content": "            memcpy( p_pic->p_q, p_sys->p_ff_pic->qscale_table,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 798,
          "old_api": "decoder_DeletePicture",
          "new_api": null,
          "old_text": "decoder_DeletePicture( p_dec, p_pic )",
          "new_text": null,
          "old_line_content": "            decoder_DeletePicture( p_dec, p_pic );",
          "new_line_content": "            return p_pic;",
          "content_same": false
        },
        {
          "line": 816,
          "old_api": "post_mt",
          "new_api": null,
          "old_text": "post_mt( p_sys )",
          "new_text": null,
          "old_line_content": "    post_mt( p_sys );",
          "new_line_content": "void EndVideoDec( decoder_t *p_dec )",
          "content_same": false
        },
        {
          "line": 822,
          "old_api": "wait_mt",
          "new_api": null,
          "old_text": "wait_mt( p_sys )",
          "new_text": null,
          "old_line_content": "    wait_mt( p_sys );",
          "new_line_content": "    /* do not flush buffers if codec hasn't been opened (theora/vorbis/VC1) */",
          "content_same": false
        },
        {
          "line": 831,
          "old_api": "vlc_sem_destroy",
          "new_api": null,
          "old_text": "vlc_sem_destroy( &p_sys->sem_mt )",
          "new_text": null,
          "old_line_content": "    vlc_sem_destroy( &p_sys->sem_mt );",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 850,
          "old_api": "malloc",
          "new_api": null,
          "old_text": "malloc( p_sys->p_context->extradata_size )",
          "new_text": null,
          "old_line_content": "            malloc( p_sys->p_context->extradata_size );",
          "new_line_content": "        uint8_t *p;",
          "content_same": false
        },
        {
          "line": 855,
          "old_api": "memset",
          "new_api": null,
          "old_text": "memset( &p[4], 0, 8 )",
          "new_text": null,
          "old_line_content": "        memset( &p[4], 0, 8 );",
          "new_line_content": "        if( !p )",
          "content_same": false
        },
        {
          "line": 856,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy( &p[12], p_dec->fmt_in.p_extra, i_size )",
          "new_text": null,
          "old_line_content": "        memcpy( &p[12], p_dec->fmt_in.p_extra, i_size );",
          "new_line_content": "            return;",
          "content_same": false
        },
        {
          "line": 347,
          "old_api": "vlc_GetCPUCount",
          "new_api": null,
          "old_text": "vlc_GetCPUCount()",
          "new_text": null,
          "old_line_content": "        i_thread_count = vlc_GetCPUCount();",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 349,
          "old_api": "msg_Dbg",
          "new_api": null,
          "old_text": "msg_Dbg( p_dec, \"allowing %d thread(s) for decoding\", i_thread_count )",
          "new_text": null,
          "old_line_content": "    msg_Dbg( p_dec, \"allowing %d thread(s) for decoding\", i_thread_count );",
          "new_line_content": "        if( i_thread_count > 1 )",
          "content_same": false
        },
        {
          "line": 354,
          "old_api": "var_CreateGetBool",
          "new_api": null,
          "old_text": "var_CreateGetBool( p_dec, \"ffmpeg-hw\" )",
          "new_text": null,
          "old_line_content": "    const bool b_use_hw = var_CreateGetBool( p_dec, \"ffmpeg-hw\" );",
          "new_line_content": "    p_sys->p_context->thread_count = i_thread_count;",
          "content_same": false
        },
        {
          "line": 866,
          "old_api": "GetDWBE",
          "new_api": null,
          "old_text": "GetDWBE( psz )",
          "new_text": null,
          "old_line_content": "                int i_size = GetDWBE( psz );",
          "new_line_content": "            uint8_t *psz = &p[0x52];",
          "content_same": false
        },
        {
          "line": 872,
          "old_api": "strncmp",
          "new_api": null,
          "old_text": "strncmp( (char*)&psz[4], \"SMI \", 4 )",
          "new_text": null,
          "old_line_content": "                if( !strncmp( (char*)&psz[4], \"SMI \", 4 ) )",
          "new_line_content": "                {",
          "content_same": false
        },
        {
          "line": 874,
          "old_api": "memmove",
          "new_api": null,
          "old_text": "memmove( &p[0x52], psz,\n                             &p[p_sys->p_context->extradata_size] - psz )",
          "new_text": null,
          "old_line_content": "                    memmove( &p[0x52], psz,",
          "new_line_content": "                    break;",
          "content_same": false
        },
        {
          "line": 364,
          "old_api": "msg_Warn",
          "new_api": null,
          "old_text": "msg_Warn( p_dec, \"threaded frame decoding is not compatible with ffmpeg-hw, disabled\" )",
          "new_text": null,
          "old_line_content": "            msg_Warn( p_dec, \"threaded frame decoding is not compatible with ffmpeg-hw, disabled\" );",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 887,
          "old_api": "malloc",
          "new_api": null,
          "old_text": "malloc( i_size + FF_INPUT_BUFFER_PADDING_SIZE )",
          "new_text": null,
          "old_line_content": "            malloc( i_size + FF_INPUT_BUFFER_PADDING_SIZE );",
          "new_line_content": "    else",
          "content_same": false
        },
        {
          "line": 890,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy( p_sys->p_context->extradata,\n                    p_dec->fmt_in.p_extra, i_size )",
          "new_text": null,
          "old_line_content": "            memcpy( p_sys->p_context->extradata,",
          "new_line_content": "        p_sys->p_context->extradata =",
          "content_same": false
        },
        {
          "line": 892,
          "old_api": "memset",
          "new_api": null,
          "old_text": "memset( &((uint8_t*)p_sys->p_context->extradata)[i_size],\n                    0, FF_INPUT_BUFFER_PADDING_SIZE )",
          "new_text": null,
          "old_line_content": "            memset( &((uint8_t*)p_sys->p_context->extradata)[i_size],",
          "new_line_content": "        if( p_sys->p_context->extradata )",
          "content_same": false
        },
        {
          "line": 386,
          "old_api": "GetVlcChroma",
          "new_api": null,
          "old_text": "GetVlcChroma( &p_dec->fmt_out.video, p_context->pix_fmt )",
          "new_text": null,
          "old_line_content": "    if( GetVlcChroma( &p_dec->fmt_out.video, p_context->pix_fmt ) != VLC_SUCCESS )",
          "new_line_content": "    p_sys->i_late_frames = 0;",
          "content_same": false
        },
        {
          "line": 394,
          "old_api": "memset",
          "new_api": null,
          "old_text": "memset( &p_sys->palette, 0, sizeof(p_sys->palette) )",
          "new_text": null,
          "old_line_content": "    memset( &p_sys->palette, 0, sizeof(p_sys->palette) );",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 909,
          "old_api": "vlc_va_Extract",
          "new_api": null,
          "old_text": "vlc_va_Extract( p_sys->p_va, p_pic, p_ff_pic )",
          "new_text": null,
          "old_line_content": "        vlc_va_Extract( p_sys->p_va, p_pic, p_ff_pic );",
          "new_line_content": "    decoder_sys_t *p_sys = p_dec->p_sys;",
          "content_same": false
        },
        {
          "line": 399,
          "old_api": "__MIN",
          "new_api": null,
          "old_text": "__MIN( AVPALETTE_COUNT, p_dec->fmt_in.video.p_palette->i_entries )",
          "new_text": null,
          "old_line_content": "        for( int i = 0; i < __MIN( AVPALETTE_COUNT, p_dec->fmt_in.video.p_palette->i_entries ); i++ )",
          "new_line_content": "    if( p_dec->fmt_in.video.p_palette )",
          "content_same": false
        },
        {
          "line": 911,
          "old_api": "TestFfmpegChroma",
          "new_api": null,
          "old_text": "TestFfmpegChroma( p_sys->p_context->pix_fmt, -1 )",
          "new_text": null,
          "old_line_content": "    else if( TestFfmpegChroma( p_sys->p_context->pix_fmt, -1 ) == VLC_SUCCESS )",
          "new_line_content": "    if( p_sys->p_va )",
          "content_same": false
        },
        {
          "line": 924,
          "old_api": "__MIN",
          "new_api": null,
          "old_text": "__MIN( i_src_stride, i_dst_stride )",
          "new_text": null,
          "old_line_content": "            i_size = __MIN( i_src_stride, i_dst_stride );",
          "new_line_content": "            p_dst = p_pic->p[i_plane].p_pixels;",
          "content_same": false
        },
        {
          "line": 414,
          "old_api": "malloc",
          "new_api": null,
          "old_text": "malloc( sizeof(video_palette_t) )",
          "new_text": null,
          "old_line_content": "        p_dec->fmt_out.video.p_palette = malloc( sizeof(video_palette_t) );",
          "new_line_content": "            p_sys->palette.palette[i] = c.u;",
          "content_same": false
        },
        {
          "line": 424,
          "old_api": "ffmpeg_InitCodec",
          "new_api": null,
          "old_text": "ffmpeg_InitCodec( p_dec )",
          "new_text": null,
          "old_line_content": "    ffmpeg_InitCodec( p_dec );",
          "new_line_content": "        p_sys->p_context->palctrl = &p_sys->palette;",
          "content_same": false
        },
        {
          "line": 936,
          "old_api": "msg_Err",
          "new_api": null,
          "old_text": "msg_Err( p_dec, \"don't know how to convert chroma %i\",\n                 p_sys->p_context->pix_fmt )",
          "new_text": null,
          "old_line_content": "        msg_Err( p_dec, \"don't know how to convert chroma %i\",",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 427,
          "old_api": "ffmpeg_OpenCodec",
          "new_api": null,
          "old_text": "ffmpeg_OpenCodec( p_dec )",
          "new_text": null,
          "old_line_content": "    if( ffmpeg_OpenCodec( p_dec ) < 0 )",
          "new_line_content": "    /* ***** init this codec with special data ***** */",
          "content_same": false
        },
        {
          "line": 429,
          "old_api": "msg_Err",
          "new_api": null,
          "old_text": "msg_Err( p_dec, \"cannot open codec (%s)\", p_sys->psz_namecodec )",
          "new_text": null,
          "old_line_content": "        msg_Err( p_dec, \"cannot open codec (%s)\", p_sys->psz_namecodec );",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 430,
          "old_api": "av_free",
          "new_api": null,
          "old_text": "av_free( p_sys->p_ff_pic )",
          "new_text": null,
          "old_line_content": "        av_free( p_sys->p_ff_pic );",
          "new_line_content": "    /* ***** Open the codec ***** */",
          "content_same": false
        },
        {
          "line": 432,
          "old_api": "free",
          "new_api": null,
          "old_text": "free( p_sys )",
          "new_text": null,
          "old_line_content": "        free( p_sys );",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 963,
          "old_api": "vlc_va_Setup",
          "new_api": null,
          "old_text": "vlc_va_Setup( p_sys->p_va,\n                          &p_context->hwaccel_context, &p_dec->fmt_out.video.i_chroma,\n                          p_context->width, p_context->height )",
          "new_text": null,
          "old_line_content": "        if( vlc_va_Setup( p_sys->p_va,",
          "new_line_content": "    if( p_sys->p_va )",
          "content_same": false
        },
        {
          "line": 455,
          "old_api": "ffmpeg_InitCodec",
          "new_api": null,
          "old_text": "ffmpeg_InitCodec( p_dec )",
          "new_text": null,
          "old_line_content": "        ffmpeg_InitCodec( p_dec );",
          "new_line_content": "        return NULL;",
          "content_same": false
        },
        {
          "line": 458,
          "old_api": "ffmpeg_OpenCodec",
          "new_api": null,
          "old_text": "ffmpeg_OpenCodec( p_dec )",
          "new_text": null,
          "old_line_content": "            if( ffmpeg_OpenCodec( p_dec ) )",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 466,
          "old_api": "block_Release",
          "new_api": null,
          "old_text": "block_Release( p_block )",
          "new_text": null,
          "old_line_content": "        block_Release( p_block );",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 979,
          "old_api": "vlc_va_Get",
          "new_api": null,
          "old_text": "vlc_va_Get( p_sys->p_va, p_ff_pic )",
          "new_text": null,
          "old_line_content": "        if( vlc_va_Get( p_sys->p_va, p_ff_pic ) )",
          "new_line_content": "        p_ff_pic->type = FF_BUFFER_TYPE_USER;",
          "content_same": false
        },
        {
          "line": 981,
          "old_api": "msg_Err",
          "new_api": null,
          "old_text": "msg_Err( p_dec, \"VaGrabSurface failed\" )",
          "new_text": null,
          "old_line_content": "            msg_Err( p_dec, \"VaGrabSurface failed\" );",
          "new_line_content": "        p_ff_pic->age = 256*256*256*64; // FIXME FIXME from ffmpeg",
          "content_same": false
        },
        {
          "line": 477,
          "old_api": "avcodec_flush_buffers",
          "new_api": null,
          "old_text": "avcodec_flush_buffers( p_context )",
          "new_text": null,
          "old_line_content": "            avcodec_flush_buffers( p_context );",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 989,
          "old_api": "avcodec_default_get_buffer",
          "new_api": null,
          "old_text": "avcodec_default_get_buffer( p_context, p_ff_pic )",
          "new_text": null,
          "old_line_content": "        return avcodec_default_get_buffer( p_context, p_ff_pic );",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 479,
          "old_api": "block_Release",
          "new_api": null,
          "old_text": "block_Release( p_block )",
          "new_text": null,
          "old_line_content": "        block_Release( p_block );",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 992,
          "old_api": "wait_mt",
          "new_api": null,
          "old_text": "wait_mt( p_sys )",
          "new_text": null,
          "old_line_content": "    wait_mt( p_sys );",
          "new_line_content": "        /* Not much to do in indirect rendering mode. */",
          "content_same": false
        },
        {
          "line": 998,
          "old_api": "avcodec_align_dimensions",
          "new_api": null,
          "old_text": "avcodec_align_dimensions( p_context, &i_width, &i_height )",
          "new_text": null,
          "old_line_content": "    avcodec_align_dimensions( p_context, &i_width, &i_height );",
          "new_line_content": "     * so we need to check for direct rendering again. */",
          "content_same": false
        },
        {
          "line": 1000,
          "old_api": "GetVlcChroma",
          "new_api": null,
          "old_text": "GetVlcChroma( &p_dec->fmt_out.video, p_context->pix_fmt )",
          "new_text": null,
          "old_line_content": "    if( GetVlcChroma( &p_dec->fmt_out.video, p_context->pix_fmt ) != VLC_SUCCESS ||",
          "new_line_content": "    int i_width = p_context->width;",
          "content_same": false
        },
        {
          "line": 492,
          "old_api": "INT64_C",
          "new_api": null,
          "old_text": "INT64_C(5000000)",
          "new_text": null,
          "old_line_content": "        (mdate() - p_sys->i_late_frames_start > INT64_C(5000000)) )",
          "new_line_content": "        p_sys->i_late_frames = 0;",
          "content_same": false
        },
        {
          "line": 1007,
          "old_api": "ffmpeg_NewPictBuf",
          "new_api": null,
          "old_text": "ffmpeg_NewPictBuf( p_dec, p_context )",
          "new_text": null,
          "old_line_content": "    p_pic = ffmpeg_NewPictBuf( p_dec, p_context );",
          "new_line_content": "",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 16,
      "total_additions": 88,
      "total_deletions": 88,
      "total_api_changes": 192
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 4,
        "api_related_lines": 192,
        "non_api_lines": 2,
        "non_api_line_numbers": [
          350,
          351
        ]
      }
    },
    "api_calls_before": 130,
    "api_calls_after": 130,
    "diff_info": {
      "added_lines": 4,
      "removed_lines": 0,
      "total_diff_lines": 17
    }
  }
}