{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/vlc/modified_file/d21a42d7e92cd9243776f3f9bbfd4c5de34df51d",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/vlc/modified_file/d21a42d7e92cd9243776f3f9bbfd4c5de34df51d/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/vlc/modified_file/d21a42d7e92cd9243776f3f9bbfd4c5de34df51d/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/vlc/modified_file/d21a42d7e92cd9243776f3f9bbfd4c5de34df51d/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 538,
          "old_api": "vlc_uri_decode_duplicate",
          "new_api": "protocol_is_smb",
          "old_text": "vlc_uri_decode_duplicate(p_url->psz_path)",
          "new_text": "protocol_is_smb(p_url)",
          "old_line_content": "     && (psz_path =  vlc_uri_decode_duplicate(p_url->psz_path)) != NULL)",
          "new_line_content": "        if (protocol_is_smb(p_url))",
          "content_same": false
        },
        {
          "line": 581,
          "old_api": "vlc_keystore_store",
          "new_api": "free",
          "old_text": "vlc_keystore_store(p_keystore, ppsz_values, p_password,\n                                    -1, psz_label)",
          "new_text": "free(psz_path)",
          "old_line_content": "    bool b_ret = vlc_keystore_store(p_keystore, ppsz_values, p_password,",
          "new_line_content": "    free(psz_path);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 520,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(p_credential->p_keystore != NULL)",
          "old_line_content": "    if (p_credential->b_store)",
          "new_line_content": "        assert(p_credential->p_keystore != NULL);",
          "content_same": false
        },
        {
          "line": 526,
          "old_api": null,
          "new_api": "get_memory_keystore",
          "old_text": null,
          "new_text": "get_memory_keystore(p_parent)",
          "old_line_content": "    else",
          "new_line_content": "        p_keystore = get_memory_keystore(p_parent);",
          "content_same": false
        },
        {
          "line": 534,
          "old_api": null,
          "new_api": "protocol_store_path",
          "old_text": null,
          "new_text": "protocol_store_path(p_url)",
          "old_line_content": "    const vlc_url_t *p_url = p_credential->p_url;",
          "new_line_content": "    if (protocol_store_path(p_url)",
          "content_same": false
        },
        {
          "line": 535,
          "old_api": null,
          "new_api": "vlc_uri_decode_duplicate",
          "old_text": null,
          "new_text": "vlc_uri_decode_duplicate(p_url->psz_path)",
          "old_line_content": "",
          "new_line_content": "     && (psz_path =  vlc_uri_decode_duplicate(p_url->psz_path)) != NULL)",
          "content_same": false
        },
        {
          "line": 542,
          "old_api": null,
          "new_api": "strchr",
          "old_text": null,
          "new_text": "strchr(psz_path + 1, '/')",
          "old_line_content": "        {",
          "new_line_content": "            p_slash = strchr(psz_path + 1, '/');",
          "content_same": false
        },
        {
          "line": 548,
          "old_api": null,
          "new_api": "strrchr",
          "old_text": null,
          "new_text": "strrchr(psz_path + 1, '/')",
          "old_line_content": "        {",
          "new_line_content": "            p_slash = strrchr(psz_path + 1, '/');",
          "content_same": false
        },
        {
          "line": 563,
          "old_api": null,
          "new_api": "protocol_set_port",
          "old_text": null,
          "new_text": "protocol_set_port(p_url, psz_port)",
          "old_line_content": "    ppsz_values[KEY_AUTHTYPE] = p_credential->psz_authtype;",
          "new_line_content": "    if (protocol_set_port(p_url, psz_port))",
          "content_same": false
        },
        {
          "line": 567,
          "old_api": null,
          "new_api": "asprintf",
          "old_text": null,
          "new_text": "asprintf(&psz_label, \"LibVLC password for %s://%s%s\",\n                 p_url->psz_protocol, p_url->psz_host,\n                 psz_path ? psz_path : \"\")",
          "old_line_content": "        ppsz_values[KEY_PORT] = psz_port;",
          "new_line_content": "    if (asprintf(&psz_label, \"LibVLC password for %s://%s%s\",",
          "content_same": false
        },
        {
          "line": 443,
          "old_api": null,
          "new_api": "get_memory_keystore",
          "old_text": null,
          "new_text": "get_memory_keystore(p_parent)",
          "old_line_content": "            if (!psz_dialog_title || !psz_dialog_fmt)",
          "new_line_content": "            vlc_keystore *p_keystore = get_memory_keystore(p_parent);",
          "content_same": false
        },
        {
          "line": 571,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free(psz_path)",
          "old_line_content": "                 p_url->psz_protocol, p_url->psz_host,",
          "new_line_content": "        free(psz_path);",
          "content_same": false
        },
        {
          "line": 445,
          "old_api": null,
          "new_api": "credential_find_keystore",
          "old_text": null,
          "new_text": "credential_find_keystore(p_credential, p_keystore)",
          "old_line_content": "",
          "new_line_content": "                credential_find_keystore(p_credential, p_keystore);",
          "content_same": false
        },
        {
          "line": 578,
          "old_api": null,
          "new_api": "vlc_keystore_store",
          "old_text": null,
          "new_text": "vlc_keystore_store(p_keystore, ppsz_values, p_password,\n                                    -1, psz_label)",
          "old_line_content": "    const uint8_t *p_password = (const uint8_t *)",
          "new_line_content": "    bool b_ret = vlc_keystore_store(p_keystore, ppsz_values, p_password,",
          "content_same": false
        },
        {
          "line": 580,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free(psz_label)",
          "old_line_content": "",
          "new_line_content": "    free(psz_label);",
          "content_same": false
        },
        {
          "line": 455,
          "old_api": null,
          "new_api": "vlc_keystore_create",
          "old_text": null,
          "new_text": "vlc_keystore_create(p_parent)",
          "old_line_content": "                return false;",
          "new_line_content": "                p_credential->p_keystore = vlc_keystore_create(p_parent);",
          "content_same": false
        },
        {
          "line": 457,
          "old_api": null,
          "new_api": "credential_find_keystore",
          "old_text": null,
          "new_text": "credential_find_keystore(p_credential, p_credential->p_keystore)",
          "old_line_content": "            if (p_credential->p_keystore == NULL)",
          "new_line_content": "                credential_find_keystore(p_credential, p_credential->p_keystore);",
          "content_same": false
        },
        {
          "line": 469,
          "old_api": null,
          "new_api": "va_start",
          "old_text": null,
          "new_text": "va_start(ap, psz_dialog_fmt)",
          "old_line_content": "            char *psz_dialog_username = NULL;",
          "new_line_content": "            va_start(ap, psz_dialog_fmt);",
          "content_same": false
        },
        {
          "line": 473,
          "old_api": null,
          "new_api": "vlc_dialog_wait_login_va",
          "old_text": null,
          "new_text": "vlc_dialog_wait_login_va(p_parent,\n                                         &psz_dialog_username,\n                                         &psz_dialog_password, p_store,\n                                         p_credential->psz_username,\n                                         psz_dialog_title, psz_dialog_fmt, ap)",
          "old_line_content": "            bool *p_store = p_credential->p_keystore != NULL ?",
          "new_line_content": "                vlc_dialog_wait_login_va(p_parent,",
          "content_same": false
        },
        {
          "line": 478,
          "old_api": null,
          "new_api": "va_end",
          "old_text": null,
          "new_text": "va_end(ap)",
          "old_line_content": "                                         &psz_dialog_password, p_store,",
          "new_line_content": "            va_end(ap);",
          "content_same": false
        },
        {
          "line": 483,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free(p_credential->psz_dialog_username)",
          "old_line_content": "            /* Free previous dialog strings after vlc_dialog_wait_login_va call",
          "new_line_content": "            free(p_credential->psz_dialog_username);",
          "content_same": false
        },
        {
          "line": 484,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free(p_credential->psz_dialog_password)",
          "old_line_content": "             * since p_credential->psz_username (default username) can be a",
          "new_line_content": "            free(p_credential->psz_dialog_password);",
          "content_same": false
        },
        {
          "line": 497,
          "old_api": null,
          "new_api": "protocol_is_smb",
          "old_text": null,
          "new_text": "protocol_is_smb(p_url)",
          "old_line_content": "            p_credential->psz_username = p_credential->psz_dialog_username;",
          "new_line_content": "            if (protocol_is_smb(p_url))",
          "content_same": false
        },
        {
          "line": 498,
          "old_api": null,
          "new_api": "smb_split_domain",
          "old_text": null,
          "new_text": "smb_split_domain(p_credential)",
          "old_line_content": "            p_credential->psz_password = p_credential->psz_dialog_password;",
          "new_line_content": "                smb_split_domain(p_credential);",
          "content_same": false
        },
        {
          "line": 503,
          "old_api": null,
          "new_api": "is_credential_valid",
          "old_text": null,
          "new_text": "is_credential_valid(p_credential)",
          "old_line_content": "            break;",
          "new_line_content": "    return is_credential_valid(p_credential);",
          "content_same": false
        },
        {
          "line": 510,
          "old_api": null,
          "new_api": "is_credential_valid",
          "old_text": null,
          "new_text": "is_credential_valid(p_credential)",
          "old_line_content": "bool",
          "new_line_content": "    if (!is_credential_valid(p_credential))",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 513,
          "old_api": "is_credential_valid",
          "new_api": null,
          "old_text": "is_credential_valid(p_credential)",
          "new_text": null,
          "old_line_content": "    if (!is_credential_valid(p_credential))",
          "new_line_content": "    if (p_credential->b_from_keystore)",
          "content_same": false
        },
        {
          "line": 523,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(p_credential->p_keystore != NULL)",
          "new_text": null,
          "old_line_content": "        assert(p_credential->p_keystore != NULL);",
          "new_line_content": "    else",
          "content_same": false
        },
        {
          "line": 529,
          "old_api": "get_memory_keystore",
          "new_api": null,
          "old_text": "get_memory_keystore(p_parent)",
          "new_text": null,
          "old_line_content": "        p_keystore = get_memory_keystore(p_parent);",
          "new_line_content": "        return false;",
          "content_same": false
        },
        {
          "line": 537,
          "old_api": "protocol_store_path",
          "new_api": null,
          "old_text": "protocol_store_path(p_url)",
          "new_text": null,
          "old_line_content": "    if (protocol_store_path(p_url)",
          "new_line_content": "        char *p_slash;",
          "content_same": false
        },
        {
          "line": 541,
          "old_api": "protocol_is_smb",
          "new_api": null,
          "old_text": "protocol_is_smb(p_url)",
          "new_text": null,
          "old_line_content": "        if (protocol_is_smb(p_url))",
          "new_line_content": "             * not the path) */",
          "content_same": false
        },
        {
          "line": 545,
          "old_api": "strchr",
          "new_api": null,
          "old_text": "strchr(psz_path + 1, '/')",
          "new_text": null,
          "old_line_content": "            p_slash = strchr(psz_path + 1, '/');",
          "new_line_content": "        {",
          "content_same": false
        },
        {
          "line": 551,
          "old_api": "strrchr",
          "new_api": null,
          "old_text": "strrchr(psz_path + 1, '/')",
          "new_text": null,
          "old_line_content": "            p_slash = strrchr(psz_path + 1, '/');",
          "new_line_content": "            *p_slash = '\\0';",
          "content_same": false
        },
        {
          "line": 566,
          "old_api": "protocol_set_port",
          "new_api": null,
          "old_text": "protocol_set_port(p_url, psz_port)",
          "new_text": null,
          "old_line_content": "    if (protocol_set_port(p_url, psz_port))",
          "new_line_content": "    char *psz_label;",
          "content_same": false
        },
        {
          "line": 570,
          "old_api": "asprintf",
          "new_api": null,
          "old_text": "asprintf(&psz_label, \"LibVLC password for %s://%s%s\",\n                 p_url->psz_protocol, p_url->psz_host,\n                 psz_path ? psz_path : \"\")",
          "new_text": null,
          "old_line_content": "    if (asprintf(&psz_label, \"LibVLC password for %s://%s%s\",",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 446,
          "old_api": "get_memory_keystore",
          "new_api": null,
          "old_text": "get_memory_keystore(p_parent)",
          "new_text": null,
          "old_line_content": "            vlc_keystore *p_keystore = get_memory_keystore(p_parent);",
          "new_line_content": "            p_credential->i_get_order++;",
          "content_same": false
        },
        {
          "line": 574,
          "old_api": "free",
          "new_api": null,
          "old_text": "free(psz_path)",
          "new_text": null,
          "old_line_content": "        free(psz_path);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 448,
          "old_api": "credential_find_keystore",
          "new_api": null,
          "old_text": "credential_find_keystore(p_credential, p_keystore)",
          "new_text": null,
          "old_line_content": "                credential_find_keystore(p_credential, p_keystore);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 583,
          "old_api": "free",
          "new_api": null,
          "old_text": "free(psz_label)",
          "new_text": null,
          "old_line_content": "    free(psz_label);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 584,
          "old_api": "free",
          "new_api": null,
          "old_text": "free(psz_path)",
          "new_text": null,
          "old_line_content": "    free(psz_path);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 458,
          "old_api": "vlc_keystore_create",
          "new_api": null,
          "old_text": "vlc_keystore_create(p_parent)",
          "new_text": null,
          "old_line_content": "                p_credential->p_keystore = vlc_keystore_create(p_parent);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 460,
          "old_api": "credential_find_keystore",
          "new_api": null,
          "old_text": "credential_find_keystore(p_credential, p_credential->p_keystore)",
          "new_text": null,
          "old_line_content": "                credential_find_keystore(p_credential, p_credential->p_keystore);",
          "new_line_content": "            break;",
          "content_same": false
        },
        {
          "line": 472,
          "old_api": "va_start",
          "new_api": null,
          "old_text": "va_start(ap, psz_dialog_fmt)",
          "new_text": null,
          "old_line_content": "            va_start(ap, psz_dialog_fmt);",
          "new_line_content": "            int i_ret =",
          "content_same": false
        },
        {
          "line": 476,
          "old_api": "vlc_dialog_wait_login_va",
          "new_api": null,
          "old_text": "vlc_dialog_wait_login_va(p_parent,\n                                         &psz_dialog_username,\n                                         &psz_dialog_password, p_store,\n                                         p_credential->psz_username,\n                                         psz_dialog_title, psz_dialog_fmt, ap)",
          "new_text": null,
          "old_line_content": "                vlc_dialog_wait_login_va(p_parent,",
          "new_line_content": "                                         p_credential->psz_username,",
          "content_same": false
        },
        {
          "line": 481,
          "old_api": "va_end",
          "new_api": null,
          "old_text": "va_end(ap)",
          "new_text": null,
          "old_line_content": "            va_end(ap);",
          "new_line_content": "             * since p_credential->psz_username (default username) can be a",
          "content_same": false
        },
        {
          "line": 486,
          "old_api": "free",
          "new_api": null,
          "old_text": "free(p_credential->psz_dialog_username)",
          "new_text": null,
          "old_line_content": "            free(p_credential->psz_dialog_username);",
          "new_line_content": "            p_credential->psz_dialog_password = psz_dialog_password;",
          "content_same": false
        },
        {
          "line": 487,
          "old_api": "free",
          "new_api": null,
          "old_text": "free(p_credential->psz_dialog_password)",
          "new_text": null,
          "old_line_content": "            free(p_credential->psz_dialog_password);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 500,
          "old_api": "protocol_is_smb",
          "new_api": null,
          "old_text": "protocol_is_smb(p_url)",
          "new_text": null,
          "old_line_content": "            if (protocol_is_smb(p_url))",
          "new_line_content": "            break;",
          "content_same": false
        },
        {
          "line": 501,
          "old_api": "smb_split_domain",
          "new_api": null,
          "old_text": "smb_split_domain(p_credential)",
          "new_text": null,
          "old_line_content": "                smb_split_domain(p_credential);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 506,
          "old_api": "is_credential_valid",
          "new_api": null,
          "old_text": "is_credential_valid(p_credential)",
          "new_text": null,
          "old_line_content": "    return is_credential_valid(p_credential);",
          "new_line_content": "#undef vlc_credential_store",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 2,
      "total_additions": 24,
      "total_deletions": 24,
      "total_api_changes": 50
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 3,
        "api_related_lines": 50,
        "non_api_lines": 1,
        "non_api_line_numbers": [
          444
        ]
      }
    },
    "api_calls_before": 99,
    "api_calls_after": 99,
    "diff_info": {
      "added_lines": 0,
      "removed_lines": 3,
      "total_diff_lines": 15
    }
  }
}