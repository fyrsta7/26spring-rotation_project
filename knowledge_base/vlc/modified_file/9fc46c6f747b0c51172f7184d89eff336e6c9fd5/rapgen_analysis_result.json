{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/vlc/modified_file/9fc46c6f747b0c51172f7184d89eff336e6c9fd5",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/vlc/modified_file/9fc46c6f747b0c51172f7184d89eff336e6c9fd5/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/vlc/modified_file/9fc46c6f747b0c51172f7184d89eff336e6c9fd5/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/vlc/modified_file/9fc46c6f747b0c51172f7184d89eff336e6c9fd5/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 1728,
          "old_api": "video_format_Clean",
          "new_api": "video_format_Copy",
          "old_text": "video_format_Clean(fmtp)",
          "new_text": "video_format_Copy(fmtp, &fmt)",
          "old_line_content": "    video_format_Clean(fmtp);",
          "new_line_content": "    video_format_Copy(fmtp, &fmt);",
          "content_same": false
        },
        {
          "line": 1743,
          "old_api": "Direct3D9Close",
          "new_api": "Direct3D9Destroy",
          "old_text": "Direct3D9Close(vd)",
          "new_text": "Direct3D9Destroy(sys)",
          "old_line_content": "    Direct3D9Close(vd);",
          "new_line_content": "    Direct3D9Destroy(sys);",
          "content_same": false
        },
        {
          "line": 1744,
          "old_api": "CommonClean",
          "new_api": "free",
          "old_text": "CommonClean(vd)",
          "new_text": "free(vd->sys)",
          "old_line_content": "    CommonClean(vd);",
          "new_line_content": "    free(vd->sys);",
          "content_same": false
        },
        {
          "line": 1756,
          "old_api": "vlc_mutex_destroy",
          "new_api": "Direct3D9Close",
          "old_text": "vlc_mutex_destroy(&vd->sys->lock)",
          "new_text": "Direct3D9Close(vd)",
          "old_line_content": "    vlc_mutex_destroy(&vd->sys->lock);",
          "new_line_content": "    Direct3D9Close(vd);",
          "content_same": false
        },
        {
          "line": 1758,
          "old_api": "Direct3D9Close",
          "new_api": "CommonClean",
          "old_text": "Direct3D9Close(vd)",
          "new_text": "CommonClean(vd)",
          "old_line_content": "    Direct3D9Close(vd);",
          "new_line_content": "    CommonClean(vd);",
          "content_same": false
        },
        {
          "line": 1760,
          "old_api": "CommonClean",
          "new_api": "Direct3D9Destroy",
          "old_text": "CommonClean(vd)",
          "new_text": "Direct3D9Destroy(vd->sys)",
          "old_line_content": "    CommonClean(vd);",
          "new_line_content": "    Direct3D9Destroy(vd->sys);",
          "content_same": false
        },
        {
          "line": 1762,
          "old_api": "Direct3D9Destroy",
          "new_api": "free",
          "old_text": "Direct3D9Destroy(vd->sys)",
          "new_text": "free(vd->sys)",
          "old_line_content": "    Direct3D9Destroy(vd->sys);",
          "new_line_content": "    free(vd->sys);",
          "content_same": false
        },
        {
          "line": 1803,
          "old_api": "DXUnlockObjectsNV",
          "new_api": "msg_Warn",
          "old_text": "priv->vt.DXUnlockObjectsNV(priv->gl_handle_d3d, 1, &priv->gl_render)",
          "new_text": "msg_Warn(tc->gl, \"DXUnlockObjectsNV failed\")",
          "old_line_content": "    if (!priv->vt.DXUnlockObjectsNV(priv->gl_handle_d3d, 1, &priv->gl_render))",
          "new_line_content": "        msg_Warn(tc->gl, \"DXUnlockObjectsNV failed\");",
          "content_same": false
        },
        {
          "line": 1815,
          "old_api": "IDirect3DDevice9Ex_StretchRect",
          "new_api": "FAILED",
          "old_text": "IDirect3DDevice9Ex_StretchRect(priv->d3d_dev.devex, picsys->surface,\n                                        &rect, priv->dx_render, NULL, D3DTEXF_NONE)",
          "new_text": "FAILED(hr)",
          "old_line_content": "    hr = IDirect3DDevice9Ex_StretchRect(priv->d3d_dev.devex, picsys->surface,",
          "new_line_content": "    if (FAILED(hr))",
          "content_same": false
        },
        {
          "line": 1817,
          "old_api": "FAILED",
          "new_api": "msg_Warn",
          "old_text": "FAILED(hr)",
          "new_text": "msg_Warn(tc->gl, \"IDirect3DDevice9Ex_StretchRect failed\")",
          "old_line_content": "    if (FAILED(hr))",
          "new_line_content": "        msg_Warn(tc->gl, \"IDirect3DDevice9Ex_StretchRect failed\");",
          "content_same": false
        },
        {
          "line": 1823,
          "old_api": "DXLockObjectsNV",
          "new_api": "msg_Warn",
          "old_text": "priv->vt.DXLockObjectsNV(priv->gl_handle_d3d, 1, &priv->gl_render)",
          "new_text": "msg_Warn(tc->gl, \"DXLockObjectsNV failed\")",
          "old_line_content": "    if (!priv->vt.DXLockObjectsNV(priv->gl_handle_d3d, 1, &priv->gl_render))",
          "new_line_content": "        msg_Warn(tc->gl, \"DXLockObjectsNV failed\");",
          "content_same": false
        },
        {
          "line": 1858,
          "old_api": "DXLockObjectsNV",
          "new_api": "msg_Warn",
          "old_text": "priv->vt.DXLockObjectsNV(priv->gl_handle_d3d, 1, &priv->gl_render)",
          "new_text": "msg_Warn(tc->gl, \"DXLockObjectsNV failed\")",
          "old_line_content": "    if (!priv->vt.DXLockObjectsNV(priv->gl_handle_d3d, 1, &priv->gl_render))",
          "new_line_content": "        msg_Warn(tc->gl, \"DXLockObjectsNV failed\");",
          "content_same": false
        },
        {
          "line": 1887,
          "old_api": "IDirect3DSurface9_Release",
          "new_api": "D3D9_ReleaseDevice",
          "old_text": "IDirect3DSurface9_Release(priv->dx_render)",
          "new_text": "D3D9_ReleaseDevice(&priv->d3d_dev)",
          "old_line_content": "        IDirect3DSurface9_Release(priv->dx_render);",
          "new_line_content": "    D3D9_ReleaseDevice(&priv->d3d_dev);",
          "content_same": false
        },
        {
          "line": 1889,
          "old_api": "D3D9_ReleaseDevice",
          "new_api": "free",
          "old_text": "D3D9_ReleaseDevice(&priv->d3d_dev)",
          "new_text": "free(tc->priv)",
          "old_line_content": "    D3D9_ReleaseDevice(&priv->d3d_dev);",
          "new_line_content": "    free(tc->priv);",
          "content_same": false
        },
        {
          "line": 1906,
          "old_api": "getExtensionsString",
          "new_api": "vlc_gl_StrHasToken",
          "old_text": "tc->gl->wgl.getExtensionsString(tc->gl)",
          "new_text": "vlc_gl_StrHasToken(wglExt, \"WGL_NV_DX_interop\")",
          "old_line_content": "    const char *wglExt = tc->gl->wgl.getExtensionsString(tc->gl);",
          "new_line_content": "    if (wglExt == NULL || !vlc_gl_StrHasToken(wglExt, \"WGL_NV_DX_interop\"))",
          "content_same": false
        },
        {
          "line": 1926,
          "old_api": "LOAD_EXT",
          "new_api": "calloc",
          "old_text": "LOAD_EXT(DXUnlockObjectsNV, PFNWGLDXUNLOCKOBJECTSNVPROC)",
          "new_text": "calloc(1, sizeof(struct glpriv))",
          "old_line_content": "    LOAD_EXT(DXUnlockObjectsNV, PFNWGLDXUNLOCKOBJECTSNVPROC);",
          "new_line_content": "    struct glpriv *priv = calloc(1, sizeof(struct glpriv));",
          "content_same": false
        },
        {
          "line": 1955,
          "old_api": "FAILED",
          "new_api": "msg_Warn",
          "old_text": "FAILED(hr)",
          "new_text": "msg_Warn(obj, \"IDirect3DDevice9_CreateOffscreenPlainSurface failed\")",
          "old_line_content": "    if (FAILED(hr))",
          "new_line_content": "        msg_Warn(obj, \"IDirect3DDevice9_CreateOffscreenPlainSurface failed\");",
          "content_same": false
        },
        {
          "line": 1962,
          "old_api": "DXSetResourceShareHandleNV",
          "new_api": "DXOpenDeviceNV",
          "old_text": "priv->vt.DXSetResourceShareHandleNV(priv->dx_render, shared_handle)",
          "new_text": "priv->vt.DXOpenDeviceNV(priv->d3d_dev.dev)",
          "old_line_content": "        priv->vt.DXSetResourceShareHandleNV(priv->dx_render, shared_handle);",
          "new_line_content": "    priv->gl_handle_d3d = priv->vt.DXOpenDeviceNV(priv->d3d_dev.dev);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 1793,
          "old_api": null,
          "new_api": "VLC_UNUSED",
          "old_text": null,
          "new_text": "VLC_UNUSED(plane_offset)",
          "old_line_content": "             picture_t *pic, const size_t *plane_offset)",
          "new_line_content": "    VLC_UNUSED(textures); VLC_UNUSED(tex_width); VLC_UNUSED(tex_height); VLC_UNUSED(plane_offset);",
          "content_same": false
        },
        {
          "line": 1797,
          "old_api": null,
          "new_api": "ActivePictureSys",
          "old_text": null,
          "new_text": "ActivePictureSys(pic)",
          "old_line_content": "    HRESULT hr;",
          "new_line_content": "    picture_sys_t *picsys = ActivePictureSys(pic);",
          "content_same": false
        },
        {
          "line": 1798,
          "old_api": null,
          "new_api": "unlikely",
          "old_text": null,
          "new_text": "unlikely(!picsys || !priv->gl_render)",
          "old_line_content": "",
          "new_line_content": "    if (unlikely(!picsys || !priv->gl_render))",
          "content_same": false
        },
        {
          "line": 1801,
          "old_api": null,
          "new_api": "DXUnlockObjectsNV",
          "old_text": null,
          "new_text": "priv->vt.DXUnlockObjectsNV(priv->gl_handle_d3d, 1, &priv->gl_render)",
          "old_line_content": "        return VLC_EGENERIC;",
          "new_line_content": "    if (!priv->vt.DXUnlockObjectsNV(priv->gl_handle_d3d, 1, &priv->gl_render))",
          "content_same": false
        },
        {
          "line": 1932,
          "old_api": null,
          "new_api": "D3D9_Create",
          "old_text": null,
          "new_text": "D3D9_Create(obj, &priv->hd3d)",
          "old_line_content": "    priv->vt = vt;",
          "new_line_content": "    if (D3D9_Create(obj, &priv->hd3d) != VLC_SUCCESS)",
          "content_same": false
        },
        {
          "line": 1937,
          "old_api": null,
          "new_api": "msg_Warn",
          "old_text": null,
          "new_text": "msg_Warn(obj, \"DX/GL interrop only working on d3d9x\")",
          "old_line_content": "    if (!priv->hd3d.use_ex)",
          "new_line_content": "        msg_Warn(obj, \"DX/GL interrop only working on d3d9x\");",
          "content_same": false
        },
        {
          "line": 1813,
          "old_api": null,
          "new_api": "IDirect3DDevice9Ex_StretchRect",
          "old_text": null,
          "new_text": "IDirect3DDevice9Ex_StretchRect(priv->d3d_dev.devex, picsys->surface,\n                                        &rect, priv->dx_render, NULL, D3DTEXF_NONE)",
          "old_line_content": "        .bottom = pic->format.i_visible_height",
          "new_line_content": "    hr = IDirect3DDevice9Ex_StretchRect(priv->d3d_dev.devex, picsys->surface,",
          "content_same": false
        },
        {
          "line": 1941,
          "old_api": null,
          "new_api": "D3D9_CreateDevice",
          "old_text": null,
          "new_text": "D3D9_CreateDevice(obj, &priv->hd3d, tc->gl->surface->handle.hwnd,\n                                 &tc->fmt, &priv->d3d_dev)",
          "old_line_content": "    }",
          "new_line_content": "    if (FAILED(D3D9_CreateDevice(obj, &priv->hd3d, tc->gl->surface->handle.hwnd,",
          "content_same": false
        },
        {
          "line": 1947,
          "old_api": null,
          "new_api": "IDirect3DDevice9Ex_CreateRenderTarget",
          "old_text": null,
          "new_text": "IDirect3DDevice9Ex_CreateRenderTarget(priv->d3d_dev.devex,\n                                               tc->fmt.i_visible_width,\n                                               tc->fmt.i_visible_height,\n                                               D3DFMT_X8R8G8B8,\n                                               D3DMULTISAMPLE_NONE, 0, FALSE,\n                                               &priv->dx_render, &shared_handle)",
          "old_line_content": "    HRESULT hr;",
          "new_line_content": "    hr = IDirect3DDevice9Ex_CreateRenderTarget(priv->d3d_dev.devex,",
          "content_same": false
        },
        {
          "line": 1821,
          "old_api": null,
          "new_api": "DXLockObjectsNV",
          "old_text": null,
          "new_text": "priv->vt.DXLockObjectsNV(priv->gl_handle_d3d, 1, &priv->gl_render)",
          "old_line_content": "    }",
          "new_line_content": "    if (!priv->vt.DXLockObjectsNV(priv->gl_handle_d3d, 1, &priv->gl_render))",
          "content_same": false
        },
        {
          "line": 1824,
          "old_api": null,
          "new_api": "DXUnregisterObjectNV",
          "old_text": null,
          "new_text": "priv->vt.DXUnregisterObjectNV(priv->gl_handle_d3d, priv->gl_render)",
          "old_line_content": "    {",
          "new_line_content": "        priv->vt.DXUnregisterObjectNV(priv->gl_handle_d3d, priv->gl_render);",
          "content_same": false
        },
        {
          "line": 1953,
          "old_api": null,
          "new_api": "FAILED",
          "old_text": null,
          "new_text": "FAILED(hr)",
          "old_line_content": "                                               D3DMULTISAMPLE_NONE, 0, FALSE,",
          "new_line_content": "    if (FAILED(hr))",
          "content_same": false
        },
        {
          "line": 1704,
          "old_api": null,
          "new_api": "is_d3d9_opaque",
          "old_text": null,
          "new_text": "is_d3d9_opaque(fmt.i_chroma)",
          "old_line_content": "    vout_display_info_t info = vd->info;",
          "new_line_content": "    vd->info.is_slow = !is_d3d9_opaque(fmt.i_chroma);",
          "content_same": false
        },
        {
          "line": 1960,
          "old_api": null,
          "new_api": "DXSetResourceShareHandleNV",
          "old_text": null,
          "new_text": "priv->vt.DXSetResourceShareHandleNV(priv->dx_render, shared_handle)",
          "old_line_content": "",
          "new_line_content": "        priv->vt.DXSetResourceShareHandleNV(priv->dx_render, shared_handle);",
          "content_same": false
        },
        {
          "line": 1706,
          "old_api": null,
          "new_api": "is_d3d9_opaque",
          "old_text": null,
          "new_text": "is_d3d9_opaque(fmt.i_chroma)",
          "old_line_content": "    info.has_double_click = true;",
          "new_line_content": "    vd->info.has_pictures_invalid = !is_d3d9_opaque(fmt.i_chroma);",
          "content_same": false
        },
        {
          "line": 1836,
          "old_api": null,
          "new_api": "VLC_OBJECT",
          "old_text": null,
          "new_text": "VLC_OBJECT(tc->gl)",
          "old_line_content": "{",
          "new_line_content": "    return Direct3D9CreatePicturePool(VLC_OBJECT(tc->gl), &priv->d3d_dev, NULL,",
          "content_same": false
        },
        {
          "line": 1965,
          "old_api": null,
          "new_api": "GetLastError",
          "old_text": null,
          "new_text": "GetLastError()",
          "old_line_content": "    if (!priv->gl_handle_d3d)",
          "new_line_content": "        msg_Warn(obj, \"DXOpenDeviceNV failed: %lu\", GetLastError());",
          "content_same": false
        },
        {
          "line": 1844,
          "old_api": null,
          "new_api": "VLC_UNUSED",
          "old_text": null,
          "new_text": "VLC_UNUSED(tex_height)",
          "old_line_content": "                       const GLsizei *tex_width, const GLsizei *tex_height)",
          "new_line_content": "    VLC_UNUSED(tex_width); VLC_UNUSED(tex_height);",
          "content_same": false
        },
        {
          "line": 1973,
          "old_api": null,
          "new_api": "opengl_fragment_shader_init",
          "old_text": null,
          "new_text": "opengl_fragment_shader_init(tc, GL_TEXTURE_2D, VLC_CODEC_RGB32,\n                                              COLOR_SPACE_UNDEF)",
          "old_line_content": "    tc->pf_allocate_textures = GLConvAllocateTextures;",
          "new_line_content": "    tc->fshader = opengl_fragment_shader_init(tc, GL_TEXTURE_2D, VLC_CODEC_RGB32,",
          "content_same": false
        },
        {
          "line": 1848,
          "old_api": null,
          "new_api": "DXRegisterObjectNV",
          "old_text": null,
          "new_text": "priv->vt.DXRegisterObjectNV(priv->gl_handle_d3d, priv->dx_render,\n                                    textures[0], GL_TEXTURE_2D, WGL_ACCESS_WRITE_DISCARD_NV)",
          "old_line_content": "",
          "new_line_content": "        priv->vt.DXRegisterObjectNV(priv->gl_handle_d3d, priv->dx_render,",
          "content_same": false
        },
        {
          "line": 1852,
          "old_api": null,
          "new_api": "GetLastError",
          "old_text": null,
          "new_text": "GetLastError()",
          "old_line_content": "    if (!priv->gl_render)",
          "new_line_content": "        msg_Warn(tc->gl, \"DXRegisterObjectNV failed: %lu\", GetLastError());",
          "content_same": false
        },
        {
          "line": 1981,
          "old_api": null,
          "new_api": "GLConvClose",
          "old_text": null,
          "new_text": "GLConvClose(obj)",
          "old_line_content": "",
          "new_line_content": "    GLConvClose(obj);",
          "content_same": false
        },
        {
          "line": 1727,
          "old_api": null,
          "new_api": "video_format_Clean",
          "old_text": null,
          "new_text": "video_format_Clean(fmtp)",
          "old_line_content": "    /* Setup vout_display now that everything is fine */",
          "new_line_content": "    video_format_Clean(fmtp);",
          "content_same": false
        },
        {
          "line": 1856,
          "old_api": null,
          "new_api": "DXLockObjectsNV",
          "old_text": null,
          "new_text": "priv->vt.DXLockObjectsNV(priv->gl_handle_d3d, 1, &priv->gl_render)",
          "old_line_content": "    }",
          "new_line_content": "    if (!priv->vt.DXLockObjectsNV(priv->gl_handle_d3d, 1, &priv->gl_render))",
          "content_same": false
        },
        {
          "line": 1859,
          "old_api": null,
          "new_api": "DXUnregisterObjectNV",
          "old_text": null,
          "new_text": "priv->vt.DXUnregisterObjectNV(priv->gl_handle_d3d, priv->gl_render)",
          "old_line_content": "    {",
          "new_line_content": "        priv->vt.DXUnregisterObjectNV(priv->gl_handle_d3d, priv->gl_render);",
          "content_same": false
        },
        {
          "line": 1737,
          "old_api": null,
          "new_api": "vout_display_SendEventFullscreen",
          "old_text": null,
          "new_text": "vout_display_SendEventFullscreen(vd, false)",
          "old_line_content": "    /* Fix state in case of desktop mode */",
          "new_line_content": "        vout_display_SendEventFullscreen(vd, false);",
          "content_same": false
        },
        {
          "line": 1741,
          "old_api": null,
          "new_api": "Direct3D9Close",
          "old_text": null,
          "new_text": "Direct3D9Close(vd)",
          "old_line_content": "    return VLC_SUCCESS;",
          "new_line_content": "    Direct3D9Close(vd);",
          "content_same": false
        },
        {
          "line": 1742,
          "old_api": null,
          "new_api": "CommonClean",
          "old_text": null,
          "new_text": "CommonClean(vd)",
          "old_line_content": "error:",
          "new_line_content": "    CommonClean(vd);",
          "content_same": false
        },
        {
          "line": 1877,
          "old_api": null,
          "new_api": "DXUnlockObjectsNV",
          "old_text": null,
          "new_text": "priv->vt.DXUnlockObjectsNV(priv->gl_handle_d3d, 1, &priv->gl_render)",
          "old_line_content": "        if (priv->gl_render)",
          "new_line_content": "            priv->vt.DXUnlockObjectsNV(priv->gl_handle_d3d, 1, &priv->gl_render);",
          "content_same": false
        },
        {
          "line": 1878,
          "old_api": null,
          "new_api": "DXUnregisterObjectNV",
          "old_text": null,
          "new_text": "priv->vt.DXUnregisterObjectNV(priv->gl_handle_d3d, priv->gl_render)",
          "old_line_content": "        {",
          "new_line_content": "            priv->vt.DXUnregisterObjectNV(priv->gl_handle_d3d, priv->gl_render);",
          "content_same": false
        },
        {
          "line": 1753,
          "old_api": null,
          "new_api": "var_DelCallback",
          "old_text": null,
          "new_text": "var_DelCallback(vd, \"video-wallpaper\", DesktopCallback, NULL)",
          "old_line_content": "static void Close(vout_display_t *vd)",
          "new_line_content": "    var_DelCallback(vd, \"video-wallpaper\", DesktopCallback, NULL);",
          "content_same": false
        },
        {
          "line": 1754,
          "old_api": null,
          "new_api": "vlc_mutex_destroy",
          "old_text": null,
          "new_text": "vlc_mutex_destroy(&vd->sys->lock)",
          "old_line_content": "{",
          "new_line_content": "    vlc_mutex_destroy(&vd->sys->lock);",
          "content_same": false
        },
        {
          "line": 1881,
          "old_api": null,
          "new_api": "DXCloseDeviceNV",
          "old_text": null,
          "new_text": "priv->vt.DXCloseDeviceNV(priv->gl_handle_d3d)",
          "old_line_content": "        }",
          "new_line_content": "        priv->vt.DXCloseDeviceNV(priv->gl_handle_d3d);",
          "content_same": false
        },
        {
          "line": 1885,
          "old_api": null,
          "new_api": "IDirect3DSurface9_Release",
          "old_text": null,
          "new_text": "IDirect3DSurface9_Release(priv->dx_render)",
          "old_line_content": "",
          "new_line_content": "        IDirect3DSurface9_Release(priv->dx_render);",
          "content_same": false
        },
        {
          "line": 1888,
          "old_api": null,
          "new_api": "D3D9_Destroy",
          "old_text": null,
          "new_text": "D3D9_Destroy(&priv->hd3d)",
          "old_line_content": "",
          "new_line_content": "    D3D9_Destroy(&priv->hd3d);",
          "content_same": false
        },
        {
          "line": 1904,
          "old_api": null,
          "new_api": "getExtensionsString",
          "old_text": null,
          "new_text": "tc->gl->wgl.getExtensionsString(tc->gl)",
          "old_line_content": "        return VLC_EGENERIC;",
          "new_line_content": "    const char *wglExt = tc->gl->wgl.getExtensionsString(tc->gl);",
          "content_same": false
        },
        {
          "line": 1918,
          "old_api": null,
          "new_api": "LOAD_EXT",
          "old_text": null,
          "new_text": "LOAD_EXT(DXSetResourceShareHandleNV, PFNWGLDXSETRESOURCESHAREHANDLENVPROC)",
          "old_line_content": "} while(0)",
          "new_line_content": "    LOAD_EXT(DXSetResourceShareHandleNV, PFNWGLDXSETRESOURCESHAREHANDLENVPROC);",
          "content_same": false
        },
        {
          "line": 1919,
          "old_api": null,
          "new_api": "LOAD_EXT",
          "old_text": null,
          "new_text": "LOAD_EXT(DXOpenDeviceNV, PFNWGLDXOPENDEVICENVPROC)",
          "old_line_content": "",
          "new_line_content": "    LOAD_EXT(DXOpenDeviceNV, PFNWGLDXOPENDEVICENVPROC);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 1795,
          "old_api": "VLC_UNUSED",
          "new_api": null,
          "old_text": "VLC_UNUSED(plane_offset)",
          "new_text": null,
          "old_line_content": "    VLC_UNUSED(textures); VLC_UNUSED(tex_width); VLC_UNUSED(tex_height); VLC_UNUSED(plane_offset);",
          "new_line_content": "    HRESULT hr;",
          "content_same": false
        },
        {
          "line": 1925,
          "old_api": "LOAD_EXT",
          "new_api": null,
          "old_text": "LOAD_EXT(DXLockObjectsNV, PFNWGLDXLOCKOBJECTSNVPROC)",
          "new_text": null,
          "old_line_content": "    LOAD_EXT(DXLockObjectsNV, PFNWGLDXLOCKOBJECTSNVPROC);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1799,
          "old_api": "ActivePictureSys",
          "new_api": null,
          "old_text": "ActivePictureSys(pic)",
          "new_text": null,
          "old_line_content": "    picture_sys_t *picsys = ActivePictureSys(pic);",
          "new_line_content": "        return VLC_EGENERIC;",
          "content_same": false
        },
        {
          "line": 1800,
          "old_api": "unlikely",
          "new_api": null,
          "old_text": "unlikely(!picsys || !priv->gl_render)",
          "new_text": null,
          "old_line_content": "    if (unlikely(!picsys || !priv->gl_render))",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1928,
          "old_api": "calloc",
          "new_api": null,
          "old_text": "calloc(1, sizeof(struct glpriv))",
          "new_text": null,
          "old_line_content": "    struct glpriv *priv = calloc(1, sizeof(struct glpriv));",
          "new_line_content": "        return VLC_ENOMEM;",
          "content_same": false
        },
        {
          "line": 1805,
          "old_api": "msg_Warn",
          "new_api": null,
          "old_text": "msg_Warn(tc->gl, \"DXUnlockObjectsNV failed\")",
          "new_text": null,
          "old_line_content": "        msg_Warn(tc->gl, \"DXUnlockObjectsNV failed\");",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1934,
          "old_api": "D3D9_Create",
          "new_api": null,
          "old_text": "D3D9_Create(obj, &priv->hd3d)",
          "new_text": null,
          "old_line_content": "    if (D3D9_Create(obj, &priv->hd3d) != VLC_SUCCESS)",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1939,
          "old_api": "msg_Warn",
          "new_api": null,
          "old_text": "msg_Warn(obj, \"DX/GL interrop only working on d3d9x\")",
          "new_text": null,
          "old_line_content": "        msg_Warn(obj, \"DX/GL interrop only working on d3d9x\");",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1943,
          "old_api": "D3D9_CreateDevice",
          "new_api": null,
          "old_text": "D3D9_CreateDevice(obj, &priv->hd3d, tc->gl->surface->handle.hwnd,\n                                 &tc->fmt, &priv->d3d_dev)",
          "new_text": null,
          "old_line_content": "    if (FAILED(D3D9_CreateDevice(obj, &priv->hd3d, tc->gl->surface->handle.hwnd,",
          "new_line_content": "        goto error;",
          "content_same": false
        },
        {
          "line": 1819,
          "old_api": "msg_Warn",
          "new_api": null,
          "old_text": "msg_Warn(tc->gl, \"IDirect3DDevice9Ex_StretchRect failed\")",
          "new_text": null,
          "old_line_content": "        msg_Warn(tc->gl, \"IDirect3DDevice9Ex_StretchRect failed\");",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1949,
          "old_api": "IDirect3DDevice9Ex_CreateRenderTarget",
          "new_api": null,
          "old_text": "IDirect3DDevice9Ex_CreateRenderTarget(priv->d3d_dev.devex,\n                                               tc->fmt.i_visible_width,\n                                               tc->fmt.i_visible_height,\n                                               D3DFMT_X8R8G8B8,\n                                               D3DMULTISAMPLE_NONE, 0, FALSE,\n                                               &priv->dx_render, &shared_handle)",
          "new_text": null,
          "old_line_content": "    hr = IDirect3DDevice9Ex_CreateRenderTarget(priv->d3d_dev.devex,",
          "new_line_content": "                                               tc->fmt.i_visible_height,",
          "content_same": false
        },
        {
          "line": 1825,
          "old_api": "msg_Warn",
          "new_api": null,
          "old_text": "msg_Warn(tc->gl, \"DXLockObjectsNV failed\")",
          "new_text": null,
          "old_line_content": "        msg_Warn(tc->gl, \"DXLockObjectsNV failed\");",
          "new_line_content": "        priv->gl_render = NULL;",
          "content_same": false
        },
        {
          "line": 1826,
          "old_api": "DXUnregisterObjectNV",
          "new_api": null,
          "old_text": "priv->vt.DXUnregisterObjectNV(priv->gl_handle_d3d, priv->gl_render)",
          "new_text": null,
          "old_line_content": "        priv->vt.DXUnregisterObjectNV(priv->gl_handle_d3d, priv->gl_render);",
          "new_line_content": "        return VLC_EGENERIC;",
          "content_same": false
        },
        {
          "line": 1957,
          "old_api": "msg_Warn",
          "new_api": null,
          "old_text": "msg_Warn(obj, \"IDirect3DDevice9_CreateOffscreenPlainSurface failed\")",
          "new_text": null,
          "old_line_content": "        msg_Warn(obj, \"IDirect3DDevice9_CreateOffscreenPlainSurface failed\");",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1705,
          "old_api": "is_d3d9_opaque",
          "new_api": null,
          "old_text": "is_d3d9_opaque(fmt.i_chroma)",
          "new_text": null,
          "old_line_content": "    info.is_slow = !is_d3d9_opaque(fmt.i_chroma);",
          "new_line_content": "    vd->info.has_double_click = true;",
          "content_same": false
        },
        {
          "line": 1707,
          "old_api": "is_d3d9_opaque",
          "new_api": null,
          "old_text": "is_d3d9_opaque(fmt.i_chroma)",
          "new_text": null,
          "old_line_content": "    info.has_pictures_invalid = !is_d3d9_opaque(fmt.i_chroma);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1964,
          "old_api": "DXOpenDeviceNV",
          "new_api": null,
          "old_text": "priv->vt.DXOpenDeviceNV(priv->d3d_dev.dev)",
          "new_text": null,
          "old_line_content": "    priv->gl_handle_d3d = priv->vt.DXOpenDeviceNV(priv->d3d_dev.dev);",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 1838,
          "old_api": "VLC_OBJECT",
          "new_api": null,
          "old_text": "VLC_OBJECT(tc->gl)",
          "new_text": null,
          "old_line_content": "    return Direct3D9CreatePicturePool(VLC_OBJECT(tc->gl), &priv->d3d_dev, NULL,",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 1967,
          "old_api": "GetLastError",
          "new_api": null,
          "old_text": "GetLastError()",
          "new_text": null,
          "old_line_content": "        msg_Warn(obj, \"DXOpenDeviceNV failed: %lu\", GetLastError());",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1846,
          "old_api": "VLC_UNUSED",
          "new_api": null,
          "old_text": "VLC_UNUSED(tex_height)",
          "new_text": null,
          "old_line_content": "    VLC_UNUSED(tex_width); VLC_UNUSED(tex_height);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1975,
          "old_api": "opengl_fragment_shader_init",
          "new_api": null,
          "old_text": "opengl_fragment_shader_init(tc, GL_TEXTURE_2D, VLC_CODEC_RGB32,\n                                              COLOR_SPACE_UNDEF)",
          "new_text": null,
          "old_line_content": "    tc->fshader = opengl_fragment_shader_init(tc, GL_TEXTURE_2D, VLC_CODEC_RGB32,",
          "new_line_content": "    if (tc->fshader == 0)",
          "content_same": false
        },
        {
          "line": 1850,
          "old_api": "DXRegisterObjectNV",
          "new_api": null,
          "old_text": "priv->vt.DXRegisterObjectNV(priv->gl_handle_d3d, priv->dx_render,\n                                    textures[0], GL_TEXTURE_2D, WGL_ACCESS_WRITE_DISCARD_NV)",
          "new_text": null,
          "old_line_content": "        priv->vt.DXRegisterObjectNV(priv->gl_handle_d3d, priv->dx_render,",
          "new_line_content": "    if (!priv->gl_render)",
          "content_same": false
        },
        {
          "line": 1854,
          "old_api": "GetLastError",
          "new_api": null,
          "old_text": "GetLastError()",
          "new_text": null,
          "old_line_content": "        msg_Warn(tc->gl, \"DXRegisterObjectNV failed: %lu\", GetLastError());",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1983,
          "old_api": "GLConvClose",
          "new_api": null,
          "old_text": "GLConvClose(obj)",
          "new_text": null,
          "old_line_content": "    GLConvClose(obj);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 1729,
          "old_api": "video_format_Copy",
          "new_api": null,
          "old_text": "video_format_Copy(fmtp, &fmt)",
          "new_text": null,
          "old_line_content": "    video_format_Copy(fmtp, &fmt);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1860,
          "old_api": "msg_Warn",
          "new_api": null,
          "old_text": "msg_Warn(tc->gl, \"DXLockObjectsNV failed\")",
          "new_text": null,
          "old_line_content": "        msg_Warn(tc->gl, \"DXLockObjectsNV failed\");",
          "new_line_content": "        priv->gl_render = NULL;",
          "content_same": false
        },
        {
          "line": 1861,
          "old_api": "DXUnregisterObjectNV",
          "new_api": null,
          "old_text": "priv->vt.DXUnregisterObjectNV(priv->gl_handle_d3d, priv->gl_render)",
          "new_text": null,
          "old_line_content": "        priv->vt.DXUnregisterObjectNV(priv->gl_handle_d3d, priv->gl_render);",
          "new_line_content": "        return VLC_EGENERIC;",
          "content_same": false
        },
        {
          "line": 1739,
          "old_api": "vout_display_SendEventFullscreen",
          "new_api": null,
          "old_text": "vout_display_SendEventFullscreen(vd, false)",
          "new_text": null,
          "old_line_content": "        vout_display_SendEventFullscreen(vd, false);",
          "new_line_content": "    return VLC_SUCCESS;",
          "content_same": false
        },
        {
          "line": 1745,
          "old_api": "Direct3D9Destroy",
          "new_api": null,
          "old_text": "Direct3D9Destroy(sys)",
          "new_text": null,
          "old_line_content": "    Direct3D9Destroy(sys);",
          "new_line_content": "    return VLC_EGENERIC;",
          "content_same": false
        },
        {
          "line": 1746,
          "old_api": "free",
          "new_api": null,
          "old_text": "free(vd->sys)",
          "new_text": null,
          "old_line_content": "    free(vd->sys);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 1879,
          "old_api": "DXUnlockObjectsNV",
          "new_api": null,
          "old_text": "priv->vt.DXUnlockObjectsNV(priv->gl_handle_d3d, 1, &priv->gl_render)",
          "new_text": null,
          "old_line_content": "            priv->vt.DXUnlockObjectsNV(priv->gl_handle_d3d, 1, &priv->gl_render);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 1880,
          "old_api": "DXUnregisterObjectNV",
          "new_api": null,
          "old_text": "priv->vt.DXUnregisterObjectNV(priv->gl_handle_d3d, priv->gl_render)",
          "new_text": null,
          "old_line_content": "            priv->vt.DXUnregisterObjectNV(priv->gl_handle_d3d, priv->gl_render);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1755,
          "old_api": "var_DelCallback",
          "new_api": null,
          "old_text": "var_DelCallback(vd, \"video-wallpaper\", DesktopCallback, NULL)",
          "new_text": null,
          "old_line_content": "    var_DelCallback(vd, \"video-wallpaper\", DesktopCallback, NULL);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1883,
          "old_api": "DXCloseDeviceNV",
          "new_api": null,
          "old_text": "priv->vt.DXCloseDeviceNV(priv->gl_handle_d3d)",
          "new_text": null,
          "old_line_content": "        priv->vt.DXCloseDeviceNV(priv->gl_handle_d3d);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1890,
          "old_api": "D3D9_Destroy",
          "new_api": null,
          "old_text": "D3D9_Destroy(&priv->hd3d)",
          "new_text": null,
          "old_line_content": "    D3D9_Destroy(&priv->hd3d);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 1891,
          "old_api": "free",
          "new_api": null,
          "old_text": "free(tc->priv)",
          "new_text": null,
          "old_line_content": "    free(tc->priv);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1764,
          "old_api": "free",
          "new_api": null,
          "old_text": "free(vd->sys)",
          "new_text": null,
          "old_line_content": "    free(vd->sys);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1908,
          "old_api": "vlc_gl_StrHasToken",
          "new_api": null,
          "old_text": "vlc_gl_StrHasToken(wglExt, \"WGL_NV_DX_interop\")",
          "new_text": null,
          "old_line_content": "    if (wglExt == NULL || !vlc_gl_StrHasToken(wglExt, \"WGL_NV_DX_interop\"))",
          "new_line_content": "",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 18,
      "total_additions": 38,
      "total_deletions": 38,
      "total_api_changes": 94
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 9,
        "api_related_lines": 94,
        "non_api_lines": 4,
        "non_api_line_numbers": [
          1730,
          1715,
          1717,
          1703
        ]
      }
    },
    "api_calls_before": 401,
    "api_calls_after": 401,
    "diff_info": {
      "added_lines": 7,
      "removed_lines": 9,
      "total_diff_lines": 45
    }
  }
}