{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/vlc/modified_file/37fba57c23f1f763ef2f7e9687a3d6ca3150254d",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/vlc/modified_file/37fba57c23f1f763ef2f7e9687a3d6ca3150254d/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/vlc/modified_file/37fba57c23f1f763ef2f7e9687a3d6ca3150254d/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/vlc/modified_file/37fba57c23f1f763ef2f7e9687a3d6ca3150254d/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 144,
          "old_api": "add_overflow",
          "new_api": "unlikely",
          "old_text": "add_overflow(height, 2 * i_ratio_h, &height)",
          "new_text": "unlikely(height > INT_MAX)",
          "old_line_content": "    if (unlikely(add_overflow(height, 2 * i_ratio_h, &height)))",
          "new_line_content": "    if (unlikely(width > INT_MAX) || unlikely(height > INT_MAX))",
          "content_same": false
        },
        {
          "line": 193,
          "old_api": "video_format_CopyCrop",
          "new_api": "unlikely",
          "old_text": "video_format_CopyCrop( &fmt, p_fmt )",
          "new_text": "unlikely(priv == NULL)",
          "old_line_content": "        video_format_CopyCrop( &fmt, p_fmt );",
          "new_line_content": "    if( unlikely(priv == NULL) )",
          "content_same": false
        },
        {
          "line": 202,
          "old_api": "memset",
          "new_api": "picture_Setup",
          "old_text": "memset( p_picture, 0, sizeof( *p_picture ) )",
          "new_text": "picture_Setup( p_picture, &fmt )",
          "old_line_content": "    memset( p_picture, 0, sizeof( *p_picture ) );",
          "new_line_content": "    if( picture_Setup( p_picture, &fmt ) )",
          "content_same": false
        },
        {
          "line": 208,
          "old_api": "free",
          "new_api": "atomic_init",
          "old_text": "free( p_picture )",
          "new_text": "atomic_init( &priv->gc.refs, 1 )",
          "old_line_content": "        free( p_picture );",
          "new_line_content": "    atomic_init( &priv->gc.refs, 1 );",
          "content_same": false
        },
        {
          "line": 268,
          "old_api": "add_overflow",
          "new_api": "unlikely",
          "old_text": "add_overflow(pic_size, plane_sizes[i], &pic_size)",
          "new_text": "unlikely(pic_size >= PICTURE_SW_SIZE_MAX)",
          "old_line_content": "         || unlikely(add_overflow(pic_size, plane_sizes[i], &pic_size)))",
          "new_line_content": "    if (unlikely(pic_size >= PICTURE_SW_SIZE_MAX))",
          "content_same": false
        },
        {
          "line": 296,
          "old_api": "video_format_Init",
          "new_api": "picture_NewFromFormat",
          "old_text": "video_format_Init( &fmt, 0 )",
          "new_text": "picture_NewFromFormat( &fmt )",
          "old_line_content": "    video_format_Init( &fmt, 0 );",
          "new_line_content": "    return picture_NewFromFormat( &fmt );",
          "content_same": false
        },
        {
          "line": 323,
          "old_api": "assert",
          "new_api": "PictureDestroyContext",
          "old_text": "assert( refs != 0 )",
          "new_text": "PictureDestroyContext( p_picture )",
          "old_line_content": "    assert( refs != 0 );",
          "new_line_content": "    PictureDestroyContext( p_picture );",
          "content_same": false
        },
        {
          "line": 360,
          "old_api": "assert",
          "new_api": "memcpy",
          "old_text": "assert( p_out )",
          "new_text": "memcpy( p_out, p_in, i_width )",
          "old_line_content": "        assert( p_out );",
          "new_line_content": "            memcpy( p_out, p_in, i_width );",
          "content_same": false
        },
        {
          "line": 497,
          "old_api": "image_HandlerCreate",
          "new_api": "image_Write",
          "old_text": "image_HandlerCreate( p_obj )",
          "new_text": "image_Write( p_image, p_picture, &fmt_in, &fmt_out )",
          "old_line_content": "    image_handler_t *p_image = image_HandlerCreate( p_obj );",
          "new_line_content": "    block_t *p_block = image_Write( p_image, p_picture, &fmt_in, &fmt_out );",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 385,
          "old_api": null,
          "new_api": "copy",
          "old_text": null,
          "new_text": "p_src->context->copy( p_src->context )",
          "old_line_content": "",
          "new_line_content": "        p_dst->context = p_src->context->copy( p_src->context );",
          "content_same": false
        },
        {
          "line": 390,
          "old_api": null,
          "new_api": "picture_CopyPixels",
          "old_text": null,
          "new_text": "picture_CopyPixels( p_dst, p_src )",
          "old_line_content": "}",
          "new_line_content": "    picture_CopyPixels( p_dst, p_src );",
          "content_same": false
        },
        {
          "line": 391,
          "old_api": null,
          "new_api": "picture_CopyProperties",
          "old_text": null,
          "new_text": "picture_CopyProperties( p_dst, p_src )",
          "old_line_content": "",
          "new_line_content": "    picture_CopyProperties( p_dst, p_src );",
          "content_same": false
        },
        {
          "line": 264,
          "old_api": null,
          "new_api": "add_overflow",
          "old_text": null,
          "new_text": "add_overflow(pic_size, plane_sizes[i], &pic_size)",
          "old_line_content": "    {",
          "new_line_content": "         || unlikely(add_overflow(pic_size, plane_sizes[i], &pic_size)))",
          "content_same": false
        },
        {
          "line": 263,
          "old_api": null,
          "new_api": "mul_overflow",
          "old_text": null,
          "new_text": "mul_overflow(p->i_pitch, p->i_lines, &plane_sizes[i])",
          "old_line_content": "    for (int i = 0; i < pic->i_planes; i++)",
          "new_line_content": "        if (unlikely(mul_overflow(p->i_pitch, p->i_lines, &plane_sizes[i]))",
          "content_same": false
        },
        {
          "line": 398,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free(clone)",
          "old_line_content": "static void picture_DestroyClone(picture_t *clone)",
          "new_line_content": "    free(clone);",
          "content_same": false
        },
        {
          "line": 271,
          "old_api": null,
          "new_api": "aligned_alloc",
          "old_text": null,
          "new_text": "aligned_alloc(16, pic_size)",
          "old_line_content": "",
          "new_line_content": "    uint8_t *buf = aligned_alloc(16, pic_size);",
          "content_same": false
        },
        {
          "line": 399,
          "old_api": null,
          "new_api": "picture_Release",
          "old_text": null,
          "new_text": "picture_Release(picture)",
          "old_line_content": "{",
          "new_line_content": "    picture_Release(picture);",
          "content_same": false
        },
        {
          "line": 154,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(h->den >= h->num)",
          "old_line_content": "        const vlc_rational_t *h = &p_dsc->p[i].h;",
          "new_line_content": "        assert(h->den >= h->num);",
          "content_same": false
        },
        {
          "line": 155,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(w->den >= w->num)",
          "old_line_content": "        const vlc_rational_t *w = &p_dsc->p[i].w;",
          "new_line_content": "        assert(w->den >= w->num);",
          "content_same": false
        },
        {
          "line": 284,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free(pic)",
          "old_line_content": "    }",
          "new_line_content": "    free(pic);",
          "content_same": false
        },
        {
          "line": 416,
          "old_api": null,
          "new_api": "picture_NewFromResource",
          "old_text": null,
          "new_text": "picture_NewFromResource(&picture->format, &res)",
          "old_line_content": "        res.p[i].i_lines = picture->p[i].i_lines;",
          "new_line_content": "    picture_t *clone = picture_NewFromResource(&picture->format, &res);",
          "content_same": false
        },
        {
          "line": 417,
          "old_api": null,
          "new_api": "likely",
          "old_text": null,
          "new_text": "likely(clone != NULL)",
          "old_line_content": "        res.p[i].i_pitch = picture->p[i].i_pitch;",
          "new_line_content": "    if (likely(clone != NULL)) {",
          "content_same": false
        },
        {
          "line": 419,
          "old_api": null,
          "new_api": "picture_Hold",
          "old_text": null,
          "new_text": "picture_Hold(picture)",
          "old_line_content": "",
          "new_line_content": "        picture_Hold(picture);",
          "content_same": false
        },
        {
          "line": 292,
          "old_api": null,
          "new_api": "video_format_Init",
          "old_text": null,
          "new_text": "video_format_Init( &fmt, 0 )",
          "old_line_content": "picture_t *picture_New( vlc_fourcc_t i_chroma, int i_width, int i_height, int i_sar_num, int i_sar_den )",
          "new_line_content": "    video_format_Init( &fmt, 0 );",
          "content_same": false
        },
        {
          "line": 165,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert( (p->i_pitch % 16) == 0 )",
          "old_line_content": "        p->i_visible_pitch = (fmt->i_visible_width + (w->den - 1)) / w->den * w->num",
          "new_line_content": "        assert( (p->i_pitch % 16) == 0 );",
          "content_same": false
        },
        {
          "line": 293,
          "old_api": null,
          "new_api": "video_format_Setup",
          "old_text": null,
          "new_text": "video_format_Setup( &fmt, i_chroma, i_width, i_height,\n                        i_width, i_height, i_sar_num, i_sar_den )",
          "old_line_content": "{",
          "new_line_content": "    video_format_Setup( &fmt, i_chroma, i_width, i_height,",
          "content_same": false
        },
        {
          "line": 422,
          "old_api": null,
          "new_api": "copy",
          "old_text": null,
          "new_text": "picture->context->copy(picture->context)",
          "old_line_content": "        ((picture_priv_t *)clone)->gc.opaque = picture;",
          "new_line_content": "            clone->context = picture->context->copy(picture->context);",
          "content_same": false
        },
        {
          "line": 176,
          "old_api": null,
          "new_api": "restrict",
          "old_text": null,
          "new_text": "restrict",
          "old_line_content": "/*****************************************************************************",
          "new_line_content": "static picture_priv_t *picture_NewPrivate(const video_format_t *restrict p_fmt)",
          "content_same": false
        },
        {
          "line": 305,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert( p_picture != NULL )",
          "old_line_content": " *****************************************************************************/",
          "new_line_content": "    assert( p_picture != NULL );",
          "content_same": false
        },
        {
          "line": 308,
          "old_api": null,
          "new_api": "atomic_fetch_add",
          "old_text": null,
          "new_text": "atomic_fetch_add( &priv->gc.refs, 1 )",
          "old_line_content": "{",
          "new_line_content": "    uintptr_t refs = atomic_fetch_add( &priv->gc.refs, 1 );",
          "content_same": false
        },
        {
          "line": 181,
          "old_api": null,
          "new_api": "video_format_Setup",
          "old_text": null,
          "new_text": "video_format_Setup( &fmt, p_fmt->i_chroma,\n                              p_fmt->i_width, p_fmt->i_height,\n                              p_fmt->i_visible_width, p_fmt->i_visible_height,\n                              p_fmt->i_sar_num, p_fmt->i_sar_den )",
          "old_line_content": "{",
          "new_line_content": "    video_format_Setup( &fmt, p_fmt->i_chroma,",
          "content_same": false
        },
        {
          "line": 315,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert( p_picture != NULL )",
          "old_line_content": "}",
          "new_line_content": "    assert( p_picture != NULL );",
          "content_same": false
        },
        {
          "line": 189,
          "old_api": null,
          "new_api": "video_format_CopyCrop",
          "old_text": null,
          "new_text": "video_format_CopyCrop( &fmt, p_fmt )",
          "old_line_content": "    if( p_fmt->i_x_offset < p_fmt->i_width &&",
          "new_line_content": "        video_format_CopyCrop( &fmt, p_fmt );",
          "content_same": false
        },
        {
          "line": 318,
          "old_api": null,
          "new_api": "atomic_fetch_sub",
          "old_text": null,
          "new_text": "atomic_fetch_sub( &priv->gc.refs, 1 )",
          "old_line_content": "{",
          "new_line_content": "    uintptr_t refs = atomic_fetch_sub( &priv->gc.refs, 1 );",
          "content_same": false
        },
        {
          "line": 447,
          "old_api": null,
          "new_api": "memset",
          "old_text": null,
          "new_text": "memset( &fmt_out, 0, sizeof(fmt_out) )",
          "old_line_content": "    }",
          "new_line_content": "    memset( &fmt_out, 0, sizeof(fmt_out) );",
          "content_same": false
        },
        {
          "line": 192,
          "old_api": null,
          "new_api": "malloc",
          "old_text": null,
          "new_text": "malloc( sizeof (*priv) )",
          "old_line_content": "        p_fmt->i_visible_height > 0 && p_fmt->i_y_offset + p_fmt->i_visible_height <= p_fmt->i_height )",
          "new_line_content": "    picture_priv_t *priv = malloc( sizeof (*priv) );",
          "content_same": false
        },
        {
          "line": 324,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert( priv->gc.destroy != NULL )",
          "old_line_content": "    if( refs > 1 )",
          "new_line_content": "    assert( priv->gc.destroy != NULL );",
          "content_same": false
        },
        {
          "line": 325,
          "old_api": null,
          "new_api": "destroy",
          "old_text": null,
          "new_text": "priv->gc.destroy( p_picture )",
          "old_line_content": "        return;",
          "new_line_content": "    priv->gc.destroy( p_picture );",
          "content_same": false
        },
        {
          "line": 198,
          "old_api": null,
          "new_api": "memset",
          "old_text": null,
          "new_text": "memset( p_picture, 0, sizeof( *p_picture ) )",
          "old_line_content": "        return NULL;",
          "new_line_content": "    memset( p_picture, 0, sizeof( *p_picture ) );",
          "content_same": false
        },
        {
          "line": 204,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free( p_picture )",
          "old_line_content": "",
          "new_line_content": "        free( p_picture );",
          "content_same": false
        },
        {
          "line": 333,
          "old_api": null,
          "new_api": "__MIN",
          "old_text": null,
          "new_text": "__MIN( p_dst->i_visible_pitch,\n                                     p_src->i_visible_pitch )",
          "old_line_content": " *",
          "new_line_content": "    const unsigned i_width  = __MIN( p_dst->i_visible_pitch,",
          "content_same": false
        },
        {
          "line": 335,
          "old_api": null,
          "new_api": "__MIN",
          "old_text": null,
          "new_text": "__MIN( p_dst->i_visible_lines,\n                                     p_src->i_visible_lines )",
          "old_line_content": "void plane_CopyPixels( plane_t *p_dst, const plane_t *p_src )",
          "new_line_content": "    const unsigned i_height = __MIN( p_dst->i_visible_lines,",
          "content_same": false
        },
        {
          "line": 216,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(p_resource != NULL)",
          "old_line_content": "}",
          "new_line_content": "    assert(p_resource != NULL);",
          "content_same": false
        },
        {
          "line": 218,
          "old_api": null,
          "new_api": "picture_NewPrivate",
          "old_text": null,
          "new_text": "picture_NewPrivate(p_fmt)",
          "old_line_content": "picture_t *picture_NewFromResource( const video_format_t *p_fmt, const picture_resource_t *p_resource )",
          "new_line_content": "    picture_priv_t *priv = picture_NewPrivate(p_fmt);",
          "content_same": false
        },
        {
          "line": 219,
          "old_api": null,
          "new_api": "unlikely",
          "old_text": null,
          "new_text": "unlikely(priv == NULL)",
          "old_line_content": "{",
          "new_line_content": "    if (unlikely(priv == NULL))",
          "content_same": false
        },
        {
          "line": 346,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy( p_dst->p_pixels, p_src->p_pixels,\n                    p_src->i_pitch * i_height )",
          "old_line_content": "    if( p_src->i_pitch == p_dst->i_pitch  &&",
          "new_line_content": "        memcpy( p_dst->p_pixels, p_src->p_pixels,",
          "content_same": false
        },
        {
          "line": 355,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert( p_in )",
          "old_line_content": "        /* We need to proceed line by line */",
          "new_line_content": "        assert( p_in );",
          "content_same": false
        },
        {
          "line": 356,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert( p_out )",
          "old_line_content": "        uint8_t *p_in = p_src->p_pixels;",
          "new_line_content": "        assert( p_out );",
          "content_same": false
        },
        {
          "line": 493,
          "old_api": null,
          "new_api": "image_HandlerCreate",
          "old_text": null,
          "new_text": "image_HandlerCreate( p_obj )",
          "old_line_content": "        fmt_out.i_width  = i_width * fmt_out.i_height",
          "new_line_content": "    image_handler_t *p_image = image_HandlerCreate( p_obj );",
          "content_same": false
        },
        {
          "line": 243,
          "old_api": null,
          "new_api": "restrict",
          "old_text": null,
          "new_text": "restrict",
          "old_line_content": "}",
          "new_line_content": "picture_t *picture_NewFromFormat(const video_format_t *restrict fmt)",
          "content_same": false
        },
        {
          "line": 499,
          "old_api": null,
          "new_api": "image_HandlerDelete",
          "old_text": null,
          "new_text": "image_HandlerDelete( p_image )",
          "old_line_content": "        return VLC_ENOMEM;",
          "new_line_content": "    image_HandlerDelete( p_image );",
          "content_same": false
        },
        {
          "line": 245,
          "old_api": null,
          "new_api": "picture_NewPrivate",
          "old_text": null,
          "new_text": "picture_NewPrivate(fmt)",
          "old_line_content": "#define PICTURE_SW_SIZE_MAX (UINT32_C(1) << 28) /* 256MB: 8K * 8K * 4*/",
          "new_line_content": "    picture_priv_t *priv = picture_NewPrivate(fmt);",
          "content_same": false
        },
        {
          "line": 246,
          "old_api": null,
          "new_api": "unlikely",
          "old_text": null,
          "new_text": "unlikely(priv == NULL)",
          "old_line_content": "",
          "new_line_content": "    if (unlikely(priv == NULL))",
          "content_same": false
        },
        {
          "line": 380,
          "old_api": null,
          "new_api": "plane_CopyPixels",
          "old_text": null,
          "new_text": "plane_CopyPixels( p_dst->p+i, p_src->p+i )",
          "old_line_content": "",
          "new_line_content": "        plane_CopyPixels( p_dst->p+i, p_src->p+i );",
          "content_same": false
        },
        {
          "line": 382,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert( p_dst->context == NULL )",
          "old_line_content": "{",
          "new_line_content": "    assert( p_dst->context == NULL );",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 384,
          "old_api": "plane_CopyPixels",
          "new_api": null,
          "old_text": "plane_CopyPixels( p_dst->p+i, p_src->p+i )",
          "new_text": null,
          "old_line_content": "        plane_CopyPixels( p_dst->p+i, p_src->p+i );",
          "new_line_content": "    if( p_src->context != NULL )",
          "content_same": false
        },
        {
          "line": 386,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert( p_dst->context == NULL )",
          "new_text": null,
          "old_line_content": "    assert( p_dst->context == NULL );",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 389,
          "old_api": "copy",
          "new_api": null,
          "old_text": "p_src->context->copy( p_src->context )",
          "new_text": null,
          "old_line_content": "        p_dst->context = p_src->context->copy( p_src->context );",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 394,
          "old_api": "picture_CopyPixels",
          "new_api": null,
          "old_text": "picture_CopyPixels( p_dst, p_src )",
          "new_text": null,
          "old_line_content": "    picture_CopyPixels( p_dst, p_src );",
          "new_line_content": "static void picture_DestroyClone(picture_t *clone)",
          "content_same": false
        },
        {
          "line": 267,
          "old_api": "mul_overflow",
          "new_api": null,
          "old_text": "mul_overflow(p->i_pitch, p->i_lines, &plane_sizes[i])",
          "new_text": null,
          "old_line_content": "        if (unlikely(mul_overflow(p->i_pitch, p->i_lines, &plane_sizes[i]))",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 395,
          "old_api": "picture_CopyProperties",
          "new_api": null,
          "old_text": "picture_CopyProperties( p_dst, p_src )",
          "new_text": null,
          "old_line_content": "    picture_CopyProperties( p_dst, p_src );",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 402,
          "old_api": "free",
          "new_api": null,
          "old_text": "free(clone)",
          "new_text": null,
          "old_line_content": "    free(clone);",
          "new_line_content": "picture_t *picture_Clone(picture_t *picture)",
          "content_same": false
        },
        {
          "line": 275,
          "old_api": "aligned_alloc",
          "new_api": null,
          "old_text": "aligned_alloc(16, pic_size)",
          "new_text": null,
          "old_line_content": "    uint8_t *buf = aligned_alloc(16, pic_size);",
          "new_line_content": "    /* Fill the p_pixels field for each plane */",
          "content_same": false
        },
        {
          "line": 148,
          "old_api": "unlikely",
          "new_api": null,
          "old_text": "unlikely(height > INT_MAX)",
          "new_text": null,
          "old_line_content": "    if (unlikely(width > INT_MAX) || unlikely(height > INT_MAX))",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 276,
          "old_api": "unlikely",
          "new_api": null,
          "old_text": "unlikely(buf == NULL)",
          "new_text": null,
          "old_line_content": "    if (unlikely(buf == NULL))",
          "new_line_content": "    for (int i = 0; i < pic->i_planes; i++)",
          "content_same": false
        },
        {
          "line": 403,
          "old_api": "picture_Release",
          "new_api": null,
          "old_text": "picture_Release(picture)",
          "new_text": null,
          "old_line_content": "    picture_Release(picture);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 158,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(h->den >= h->num)",
          "new_text": null,
          "old_line_content": "        assert(h->den >= h->num);",
          "new_line_content": "        p->i_visible_lines = (fmt->i_visible_height + (h->den - 1)) / h->den * h->num;",
          "content_same": false
        },
        {
          "line": 159,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(w->den >= w->num)",
          "new_text": null,
          "old_line_content": "        assert(w->den >= w->num);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 288,
          "old_api": "free",
          "new_api": null,
          "old_text": "free(pic)",
          "new_text": null,
          "old_line_content": "    free(pic);",
          "new_line_content": "picture_t *picture_New( vlc_fourcc_t i_chroma, int i_width, int i_height, int i_sar_num, int i_sar_den )",
          "content_same": false
        },
        {
          "line": 420,
          "old_api": "picture_NewFromResource",
          "new_api": null,
          "old_text": "picture_NewFromResource(&picture->format, &res)",
          "new_text": null,
          "old_line_content": "    picture_t *clone = picture_NewFromResource(&picture->format, &res);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 421,
          "old_api": "likely",
          "new_api": null,
          "old_text": "likely(clone != NULL)",
          "new_text": null,
          "old_line_content": "    if (likely(clone != NULL)) {",
          "new_line_content": "        if (picture->context != NULL)",
          "content_same": false
        },
        {
          "line": 423,
          "old_api": "picture_Hold",
          "new_api": null,
          "old_text": "picture_Hold(picture)",
          "new_text": null,
          "old_line_content": "        picture_Hold(picture);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 169,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert( (p->i_pitch % 16) == 0 )",
          "new_text": null,
          "old_line_content": "        assert( (p->i_pitch % 16) == 0 );",
          "new_line_content": "    return VLC_SUCCESS;",
          "content_same": false
        },
        {
          "line": 297,
          "old_api": "video_format_Setup",
          "new_api": null,
          "old_text": "video_format_Setup( &fmt, i_chroma, i_width, i_height,\n                        i_width, i_height, i_sar_num, i_sar_den )",
          "new_text": null,
          "old_line_content": "    video_format_Setup( &fmt, i_chroma, i_width, i_height,",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 426,
          "old_api": "copy",
          "new_api": null,
          "old_text": "picture->context->copy(picture->context)",
          "new_text": null,
          "old_line_content": "            clone->context = picture->context->copy(picture->context);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 300,
          "old_api": "picture_NewFromFormat",
          "new_api": null,
          "old_text": "picture_NewFromFormat( &fmt )",
          "new_text": null,
          "old_line_content": "    return picture_NewFromFormat( &fmt );",
          "new_line_content": " *",
          "content_same": false
        },
        {
          "line": 180,
          "old_api": "restrict",
          "new_api": null,
          "old_text": "restrict",
          "new_text": null,
          "old_line_content": "static picture_priv_t *picture_NewPrivate(const video_format_t *restrict p_fmt)",
          "new_line_content": "    /* It is needed to be sure all information are filled */",
          "content_same": false
        },
        {
          "line": 312,
          "old_api": "atomic_fetch_add",
          "new_api": null,
          "old_text": "atomic_fetch_add( &priv->gc.refs, 1 )",
          "new_text": null,
          "old_line_content": "    uintptr_t refs = atomic_fetch_add( &priv->gc.refs, 1 );",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 185,
          "old_api": "video_format_Setup",
          "new_api": null,
          "old_text": "video_format_Setup( &fmt, p_fmt->i_chroma,\n                              p_fmt->i_width, p_fmt->i_height,\n                              p_fmt->i_visible_width, p_fmt->i_visible_height,\n                              p_fmt->i_sar_num, p_fmt->i_sar_den )",
          "new_text": null,
          "old_line_content": "    video_format_Setup( &fmt, p_fmt->i_chroma,",
          "new_line_content": "    if( p_fmt->i_x_offset < p_fmt->i_width &&",
          "content_same": false
        },
        {
          "line": 313,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert( refs > 0 )",
          "new_text": null,
          "old_line_content": "    assert( refs > 0 );",
          "new_line_content": "void picture_Release( picture_t *p_picture )",
          "content_same": false
        },
        {
          "line": 322,
          "old_api": "atomic_fetch_sub",
          "new_api": null,
          "old_text": "atomic_fetch_sub( &priv->gc.refs, 1 )",
          "new_text": null,
          "old_line_content": "    uintptr_t refs = atomic_fetch_sub( &priv->gc.refs, 1 );",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 451,
          "old_api": "memset",
          "new_api": null,
          "old_text": "memset( &fmt_out, 0, sizeof(fmt_out) )",
          "new_text": null,
          "old_line_content": "    memset( &fmt_out, 0, sizeof(fmt_out) );",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 196,
          "old_api": "malloc",
          "new_api": null,
          "old_text": "malloc( sizeof (*priv) )",
          "new_text": null,
          "old_line_content": "    picture_priv_t *priv = malloc( sizeof (*priv) );",
          "new_line_content": "    picture_t *p_picture = &priv->picture;",
          "content_same": false
        },
        {
          "line": 197,
          "old_api": "unlikely",
          "new_api": null,
          "old_text": "unlikely(priv == NULL)",
          "new_text": null,
          "old_line_content": "    if( unlikely(priv == NULL) )",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 327,
          "old_api": "PictureDestroyContext",
          "new_api": null,
          "old_text": "PictureDestroyContext( p_picture )",
          "new_text": null,
          "old_line_content": "    PictureDestroyContext( p_picture );",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 328,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert( priv->gc.destroy != NULL )",
          "new_text": null,
          "old_line_content": "    assert( priv->gc.destroy != NULL );",
          "new_line_content": "/*****************************************************************************",
          "content_same": false
        },
        {
          "line": 329,
          "old_api": "destroy",
          "new_api": null,
          "old_text": "priv->gc.destroy( p_picture )",
          "new_text": null,
          "old_line_content": "    priv->gc.destroy( p_picture );",
          "new_line_content": " *",
          "content_same": false
        },
        {
          "line": 206,
          "old_api": "picture_Setup",
          "new_api": null,
          "old_text": "picture_Setup( p_picture, &fmt )",
          "new_text": null,
          "old_line_content": "    if( picture_Setup( p_picture, &fmt ) )",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 337,
          "old_api": "__MIN",
          "new_api": null,
          "old_text": "__MIN( p_dst->i_visible_pitch,\n                                     p_src->i_visible_pitch )",
          "new_text": null,
          "old_line_content": "    const unsigned i_width  = __MIN( p_dst->i_visible_pitch,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 339,
          "old_api": "__MIN",
          "new_api": null,
          "old_text": "__MIN( p_dst->i_visible_lines,\n                                     p_src->i_visible_lines )",
          "new_text": null,
          "old_line_content": "    const unsigned i_height = __MIN( p_dst->i_visible_lines,",
          "new_line_content": "       1) Makes field plane_t's work correctly (see the deinterlacer module)",
          "content_same": false
        },
        {
          "line": 212,
          "old_api": "atomic_init",
          "new_api": null,
          "old_text": "atomic_init( &priv->gc.refs, 1 )",
          "new_text": null,
          "old_line_content": "    atomic_init( &priv->gc.refs, 1 );",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 247,
          "old_api": "restrict",
          "new_api": null,
          "old_text": "restrict",
          "new_text": null,
          "old_line_content": "picture_t *picture_NewFromFormat(const video_format_t *restrict fmt)",
          "new_line_content": "        return NULL;",
          "content_same": false
        },
        {
          "line": 220,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(p_resource != NULL)",
          "new_text": null,
          "old_line_content": "    assert(p_resource != NULL);",
          "new_line_content": "        return NULL;",
          "content_same": false
        },
        {
          "line": 222,
          "old_api": "picture_NewPrivate",
          "new_api": null,
          "old_text": "picture_NewPrivate(p_fmt)",
          "new_text": null,
          "old_line_content": "    picture_priv_t *priv = picture_NewPrivate(p_fmt);",
          "new_line_content": "    picture_t *p_picture = &priv->picture;",
          "content_same": false
        },
        {
          "line": 223,
          "old_api": "unlikely",
          "new_api": null,
          "old_text": "unlikely(priv == NULL)",
          "new_text": null,
          "old_line_content": "    if (unlikely(priv == NULL))",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 350,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy( p_dst->p_pixels, p_src->p_pixels,\n                    p_src->i_pitch * i_height )",
          "new_text": null,
          "old_line_content": "        memcpy( p_dst->p_pixels, p_src->p_pixels,",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 359,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert( p_in )",
          "new_text": null,
          "old_line_content": "        assert( p_in );",
          "new_line_content": "        {",
          "content_same": false
        },
        {
          "line": 364,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy( p_out, p_in, i_width )",
          "new_text": null,
          "old_line_content": "            memcpy( p_out, p_in, i_width );",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 501,
          "old_api": "image_Write",
          "new_api": null,
          "old_text": "image_Write( p_image, p_picture, &fmt_in, &fmt_out )",
          "new_text": null,
          "old_line_content": "    block_t *p_block = image_Write( p_image, p_picture, &fmt_in, &fmt_out );",
          "new_line_content": "    if( !p_block )",
          "content_same": false
        },
        {
          "line": 503,
          "old_api": "image_HandlerDelete",
          "new_api": null,
          "old_text": "image_HandlerDelete( p_image )",
          "new_text": null,
          "old_line_content": "    image_HandlerDelete( p_image );",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 249,
          "old_api": "picture_NewPrivate",
          "new_api": null,
          "old_text": "picture_NewPrivate(fmt)",
          "new_text": null,
          "old_line_content": "    picture_priv_t *priv = picture_NewPrivate(fmt);",
          "new_line_content": "    priv->gc.destroy = picture_Destroy;",
          "content_same": false
        },
        {
          "line": 250,
          "old_api": "unlikely",
          "new_api": null,
          "old_text": "unlikely(priv == NULL)",
          "new_text": null,
          "old_line_content": "    if (unlikely(priv == NULL))",
          "new_line_content": "",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 9,
      "total_additions": 46,
      "total_deletions": 47,
      "total_api_changes": 102
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 4,
        "api_related_lines": 102,
        "non_api_lines": 3,
        "non_api_line_numbers": [
          145,
          146,
          143
        ]
      }
    },
    "api_calls_before": 80,
    "api_calls_after": 78,
    "diff_info": {
      "added_lines": 0,
      "removed_lines": 4,
      "total_diff_lines": 16
    }
  }
}