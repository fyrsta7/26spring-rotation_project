{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/vlc/modified_file/71148dd9141b229f48a987ec653a89c2b3566af8",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/vlc/modified_file/71148dd9141b229f48a987ec653a89c2b3566af8/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/vlc/modified_file/71148dd9141b229f48a987ec653a89c2b3566af8/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/vlc/modified_file/71148dd9141b229f48a987ec653a89c2b3566af8/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 235,
          "old_api": "msg_Warn",
          "new_api": "avcodec_decode_audio",
          "old_text": "msg_Warn( p_dec, \"cannot decode one frame (%d bytes)\",\n                      p_block->i_buffer )",
          "new_text": "avcodec_decode_audio( p_sys->p_context,\n                                   (int16_t*)p_sys->p_output, &i_output,\n                                   p_block->p_buffer, p_block->i_buffer )",
          "old_line_content": "            msg_Warn( p_dec, \"cannot decode one frame (%d bytes)\",",
          "new_line_content": "    i_used = avcodec_decode_audio( p_sys->p_context,",
          "content_same": false
        },
        {
          "line": 260,
          "old_api": "aout_DateSet",
          "new_api": "block_Release",
          "old_text": "aout_DateSet( &p_sys->end_date, p_block->i_pts )",
          "new_text": "block_Release( p_block )",
          "old_line_content": "        aout_DateSet( &p_sys->end_date, p_block->i_pts );",
          "new_line_content": "        block_Release( p_block );",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 288,
          "old_api": null,
          "new_api": "SplitBuffer",
          "old_text": null,
          "new_text": "SplitBuffer( p_dec )",
          "old_line_content": " *****************************************************************************/",
          "new_line_content": "    p_buffer = SplitBuffer( p_dec );",
          "content_same": false
        },
        {
          "line": 289,
          "old_api": null,
          "new_api": "block_Release",
          "old_text": null,
          "new_text": "block_Release( p_block )",
          "old_line_content": "void E_(EndAudioDec)( decoder_t *p_dec )",
          "new_line_content": "    if( !p_buffer ) block_Release( p_block );",
          "content_same": false
        },
        {
          "line": 258,
          "old_api": null,
          "new_api": "msg_Warn",
          "old_text": null,
          "new_text": "msg_Warn( p_dec, \"invalid channels count %d\",\n                  p_sys->p_context->channels )",
          "old_line_content": "    {",
          "new_line_content": "        msg_Warn( p_dec, \"invalid channels count %d\",",
          "content_same": false
        },
        {
          "line": 225,
          "old_api": null,
          "new_api": "block_Release",
          "old_text": null,
          "new_text": "block_Release( p_block )",
          "old_line_content": "        return NULL;",
          "new_line_content": "        block_Release( p_block );",
          "content_same": false
        },
        {
          "line": 232,
          "old_api": null,
          "new_api": "realloc",
          "old_text": null,
          "new_text": "realloc(p_sys->p_output, p_block->i_buffer)",
          "old_line_content": "    if( i_used < 0 || i_output < 0 )",
          "new_line_content": "        p_sys->p_output = realloc(p_sys->p_output, p_block->i_buffer);",
          "content_same": false
        },
        {
          "line": 266,
          "old_api": null,
          "new_api": "aout_DateInit",
          "old_text": null,
          "new_text": "aout_DateInit( &p_sys->end_date, p_sys->p_context->sample_rate )",
          "old_line_content": "    p_dec->fmt_out.audio.i_original_channels =",
          "new_line_content": "        aout_DateInit( &p_sys->end_date, p_sys->p_context->sample_rate );",
          "content_same": false
        },
        {
          "line": 267,
          "old_api": null,
          "new_api": "aout_DateSet",
          "old_text": null,
          "new_text": "aout_DateSet( &p_sys->end_date, p_block->i_pts )",
          "old_line_content": "        p_dec->fmt_out.audio.i_physical_channels =",
          "new_line_content": "        aout_DateSet( &p_sys->end_date, p_block->i_pts );",
          "content_same": false
        },
        {
          "line": 300,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free( p_sys->p_output )",
          "old_line_content": "",
          "new_line_content": "    if( p_sys->p_output ) free( p_sys->p_output );",
          "content_same": false
        },
        {
          "line": 242,
          "old_api": null,
          "new_api": "msg_Warn",
          "old_text": null,
          "new_text": "msg_Warn( p_dec, \"cannot decode one frame (%d bytes)\",\n                      p_block->i_buffer )",
          "old_line_content": "    {",
          "new_line_content": "            msg_Warn( p_dec, \"cannot decode one frame (%d bytes)\",",
          "content_same": false
        },
        {
          "line": 245,
          "old_api": null,
          "new_api": "block_Release",
          "old_text": null,
          "new_text": "block_Release( p_block )",
          "old_line_content": "",
          "new_line_content": "        block_Release( p_block );",
          "content_same": false
        },
        {
          "line": 278,
          "old_api": null,
          "new_api": "aout_DateGet",
          "old_text": null,
          "new_text": "aout_DateGet( &p_sys->end_date )",
          "old_line_content": "    p_sys->i_samples = i_output / 2 / p_sys->p_context->channels;",
          "new_line_content": "        p_block->i_pts != aout_DateGet( &p_sys->end_date ) )",
          "content_same": false
        },
        {
          "line": 280,
          "old_api": null,
          "new_api": "aout_DateSet",
          "old_text": null,
          "new_text": "aout_DateSet( &p_sys->end_date, p_block->i_pts )",
          "old_line_content": "",
          "new_line_content": "        aout_DateSet( &p_sys->end_date, p_block->i_pts );",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 224,
          "old_api": "block_Release",
          "new_api": null,
          "old_text": "block_Release( p_block )",
          "new_text": null,
          "old_line_content": "        block_Release( p_block );",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 259,
          "old_api": "aout_DateInit",
          "new_api": null,
          "old_text": "aout_DateInit( &p_sys->end_date, p_sys->p_context->sample_rate )",
          "new_text": null,
          "old_line_content": "        aout_DateInit( &p_sys->end_date, p_sys->p_context->sample_rate );",
          "new_line_content": "                  p_sys->p_context->channels );",
          "content_same": false
        },
        {
          "line": 228,
          "old_api": "avcodec_decode_audio",
          "new_api": null,
          "old_text": "avcodec_decode_audio( p_sys->p_context,\n                                   (int16_t*)p_sys->p_output, &i_output,\n                                   p_block->p_buffer, p_block->i_buffer )",
          "new_text": null,
          "old_line_content": "    i_used = avcodec_decode_audio( p_sys->p_context,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 293,
          "old_api": "free",
          "new_api": null,
          "old_text": "free( p_sys->p_output )",
          "new_text": null,
          "old_line_content": "    if( p_sys->p_output ) free( p_sys->p_output );",
          "new_line_content": "/*****************************************************************************",
          "content_same": false
        },
        {
          "line": 238,
          "old_api": "block_Release",
          "new_api": null,
          "old_text": "block_Release( p_block )",
          "new_text": null,
          "old_line_content": "        block_Release( p_block );",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 271,
          "old_api": "aout_DateGet",
          "new_api": null,
          "old_text": "aout_DateGet( &p_sys->end_date )",
          "new_text": null,
          "old_line_content": "        p_block->i_pts != aout_DateGet( &p_sys->end_date ) )",
          "new_line_content": "    p_dec->fmt_out.audio.i_rate     = p_sys->p_context->sample_rate;",
          "content_same": false
        },
        {
          "line": 273,
          "old_api": "aout_DateSet",
          "new_api": null,
          "old_text": "aout_DateSet( &p_sys->end_date, p_block->i_pts )",
          "new_text": null,
          "old_line_content": "        aout_DateSet( &p_sys->end_date, p_block->i_pts );",
          "new_line_content": "    p_dec->fmt_out.audio.i_original_channels =",
          "content_same": false
        },
        {
          "line": 281,
          "old_api": "SplitBuffer",
          "new_api": null,
          "old_text": "SplitBuffer( p_dec )",
          "new_text": null,
          "old_line_content": "    p_buffer = SplitBuffer( p_dec );",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 282,
          "old_api": "block_Release",
          "new_api": null,
          "old_text": "block_Release( p_block )",
          "new_text": null,
          "old_line_content": "    if( !p_buffer ) block_Release( p_block );",
          "new_line_content": "    p_block->i_pts = 0;",
          "content_same": false
        },
        {
          "line": 251,
          "old_api": "msg_Warn",
          "new_api": null,
          "old_text": "msg_Warn( p_dec, \"invalid channels count %d\",\n                  p_sys->p_context->channels )",
          "new_text": null,
          "old_line_content": "        msg_Warn( p_dec, \"invalid channels count %d\",",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 253,
          "old_api": "block_Release",
          "new_api": null,
          "old_text": "block_Release( p_block )",
          "new_text": null,
          "old_line_content": "        block_Release( p_block );",
          "new_line_content": "    p_block->i_buffer -= i_used;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 2,
      "total_additions": 12,
      "total_deletions": 11,
      "total_api_changes": 25
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 9,
        "api_related_lines": 25,
        "non_api_lines": 8,
        "non_api_line_numbers": [
          229,
          230,
          231,
          233,
          234,
          146,
          222,
          223
        ]
      }
    },
    "api_calls_before": 40,
    "api_calls_after": 41,
    "diff_info": {
      "added_lines": 9,
      "removed_lines": 2,
      "total_diff_lines": 35
    }
  }
}