{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/vlc/modified_file/5db6d3c820ec004f54fec9474d950746eaf3a3d0",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/vlc/modified_file/5db6d3c820ec004f54fec9474d950746eaf3a3d0/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/vlc/modified_file/5db6d3c820ec004f54fec9474d950746eaf3a3d0/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/vlc/modified_file/5db6d3c820ec004f54fec9474d950746eaf3a3d0/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 85,
          "old_api": "effectiveBlurRadius",
          "new_api": "qt_blurImage",
          "old_text": "effectiveBlurRadius()",
          "new_text": "qt_blurImage(ret, m_blurRadius, false)",
          "old_line_content": "        qt_blurImage(ret, effectiveBlurRadius(), false);",
          "new_line_content": "        qt_blurImage(ret, m_blurRadius, false);",
          "content_same": false
        },
        {
          "line": 127,
          "old_api": "isNull",
          "new_api": "rect",
          "old_text": "mask.isNull()",
          "new_text": "mask.rect()",
          "old_line_content": "        assert(!mask.isNull());",
          "new_line_content": "            path.addRoundedRect(mask.rect(), m_xRadius, m_yRadius);",
          "content_same": false
        },
        {
          "line": 157,
          "old_api": "isEmpty",
          "new_api": "queryItems",
          "old_text": "requestedSize.isEmpty()",
          "new_text": "query.queryItems()",
          "old_line_content": "        if (requestedSize.isEmpty())",
          "new_line_content": "            for (auto&& i : query.queryItems())",
          "content_same": false
        },
        {
          "line": 176,
          "old_api": "path",
          "new_api": "queryToVariantMap",
          "old_text": "url.path().toLatin1()",
          "new_text": "queryToVariantMap(query)",
          "old_line_content": "        switch (static_cast<EffectsImageProvider::Effect>(effectMetaEnum.keyToValue(url.path().toLatin1())))",
          "new_line_content": "            effect = std::make_unique<RoundedRectDropShadowEffect>(queryToVariantMap(query));",
          "content_same": false
        },
        {
          "line": 183,
          "old_api": "queryToVariantMap",
          "new_api": "generate",
          "old_text": "queryToVariantMap(query)",
          "new_text": "effect->generate(requestedSize)",
          "old_line_content": "            effect = std::make_unique<RoundedRectDropShadowEffect>(queryToVariantMap(query));",
          "new_line_content": "        return effect->generate(requestedSize);",
          "content_same": false
        },
        {
          "line": 194,
          "old_api": "size",
          "new_api": "QMetaEnum::fromType<EffectsImageProvider::Effect>()",
          "old_text": "effect.size()",
          "new_text": "QMetaEnum::fromType<EffectsImageProvider::Effect>()",
          "old_line_content": "    *size = effect.size();",
          "new_line_content": "    static const auto effectMetaEnum = QMetaEnum::fromType<EffectsImageProvider::Effect>();",
          "content_same": false
        },
        {
          "line": 207,
          "old_api": "QLatin1String",
          "new_api": "hasNext",
          "old_text": "QLatin1String(providerId)",
          "new_text": "i.hasNext()",
          "old_line_content": "    url.setAuthority(QLatin1String(providerId), QUrl::ParsingMode::StrictMode);",
          "new_line_content": "    while (i.hasNext())",
          "content_same": false
        },
        {
          "line": 209,
          "old_api": "valueToKey",
          "new_api": "next",
          "old_text": "effectMetaEnum.valueToKey(effect)",
          "new_text": "i.next()",
          "old_line_content": "    url.setPath(QString(\"/%1\").arg(effectMetaEnum.valueToKey(effect)), QUrl::ParsingMode::StrictMode);",
          "new_line_content": "        i.next();",
          "content_same": false
        },
        {
          "line": 216,
          "old_api": "next",
          "new_api": "value.canConvert<QString>()",
          "old_text": "i.next()",
          "new_text": "value.canConvert<QString>()",
          "old_line_content": "        i.next();",
          "new_line_content": "        assert(value.canConvert<QString>());",
          "content_same": false
        },
        {
          "line": 220,
          "old_api": "isNull",
          "new_api": "toString",
          "old_text": "value.isNull()",
          "new_text": "value.toString()",
          "old_line_content": "        if (!value.isValid() || value.isNull()) // if not valid, defaults are used",
          "new_line_content": "        query.addQueryItem(i.key(), QUrl::toPercentEncoding(value.toString()));",
          "content_same": false
        },
        {
          "line": 224,
          "old_api": "key",
          "new_api": "isValid",
          "old_text": "i.key().startsWith('_')",
          "new_text": "url.isValid()",
          "old_line_content": "        assert(!i.key().startsWith('_'));",
          "new_line_content": "    assert(url.isValid());",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 128,
          "old_api": null,
          "new_api": "fillPath",
          "old_text": null,
          "new_text": "painter.fillPath(path, m_color)",
          "old_line_content": "        {",
          "new_line_content": "            painter.fillPath(path, m_color);",
          "content_same": false
        },
        {
          "line": 129,
          "old_api": null,
          "new_api": "drawPath",
          "old_text": null,
          "new_text": "painter.drawPath(path)",
          "old_line_content": "            QPainter painter(&mask);",
          "new_line_content": "            painter.drawPath(path);",
          "content_same": false
        },
        {
          "line": 132,
          "old_api": null,
          "new_api": "RectDropShadowEffect::generate(mask)",
          "old_text": null,
          "new_text": "RectDropShadowEffect::generate(mask)",
          "old_line_content": "",
          "new_line_content": "        return RectDropShadowEffect::generate(mask);",
          "content_same": false
        },
        {
          "line": 144,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(size)",
          "old_line_content": "    qreal m_yRadius = 0.0;",
          "new_line_content": "    assert(size);",
          "content_same": false
        },
        {
          "line": 150,
          "old_api": null,
          "new_api": "isEmpty",
          "old_text": null,
          "new_text": "requestedSize.isEmpty()",
          "old_line_content": "{",
          "new_line_content": "        if (requestedSize.isEmpty())",
          "content_same": false
        },
        {
          "line": 153,
          "old_api": null,
          "new_api": "QMetaEnum::fromType<EffectsImageProvider::Effect>()",
          "old_text": null,
          "new_text": "QMetaEnum::fromType<EffectsImageProvider::Effect>()",
          "old_line_content": "    const auto generate = [&]() -> QImage {",
          "new_line_content": "        static const auto effectMetaEnum = QMetaEnum::fromType<EffectsImageProvider::Effect>();",
          "content_same": false
        },
        {
          "line": 159,
          "old_api": null,
          "new_api": "toLatin1",
          "old_text": null,
          "new_text": "i.second.toLatin1()",
          "old_line_content": "",
          "new_line_content": "                map.insert(i.first, QUrl::fromPercentEncoding(i.second.toLatin1()));",
          "content_same": false
        },
        {
          "line": 169,
          "old_api": null,
          "new_api": "path",
          "old_text": null,
          "new_text": "url.path().toLatin1()",
          "old_line_content": "        };",
          "new_line_content": "        switch (static_cast<EffectsImageProvider::Effect>(effectMetaEnum.keyToValue(url.path().toLatin1())))",
          "content_same": false
        },
        {
          "line": 172,
          "old_api": null,
          "new_api": "queryToVariantMap",
          "old_text": null,
          "new_text": "queryToVariantMap(query)",
          "old_line_content": "",
          "new_line_content": "            effect = std::make_unique<RectDropShadowEffect>(queryToVariantMap(query));",
          "content_same": false
        },
        {
          "line": 186,
          "old_api": null,
          "new_api": "generate",
          "old_text": null,
          "new_text": "generate()",
          "old_line_content": "        default:",
          "new_line_content": "    const auto& effect = generate();",
          "content_same": false
        },
        {
          "line": 187,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "effect.size()",
          "old_line_content": "            return {};",
          "new_line_content": "    *size = effect.size();",
          "content_same": false
        },
        {
          "line": 198,
          "old_api": null,
          "new_api": "QStringLiteral",
          "old_text": null,
          "new_text": "QStringLiteral(\"image\")",
          "old_line_content": "",
          "new_line_content": "    url.setScheme(QStringLiteral(\"image\"));",
          "content_same": false
        },
        {
          "line": 200,
          "old_api": null,
          "new_api": "QLatin1String",
          "old_text": null,
          "new_text": "QLatin1String(providerId)",
          "old_line_content": "{",
          "new_line_content": "    url.setAuthority(QLatin1String(providerId), QUrl::ParsingMode::StrictMode);",
          "content_same": false
        },
        {
          "line": 202,
          "old_api": null,
          "new_api": "valueToKey",
          "old_text": null,
          "new_text": "effectMetaEnum.valueToKey(effect)",
          "old_line_content": "",
          "new_line_content": "    url.setPath(QString(\"/%1\").arg(effectMetaEnum.valueToKey(effect)), QUrl::ParsingMode::StrictMode);",
          "content_same": false
        },
        {
          "line": 211,
          "old_api": null,
          "new_api": "value",
          "old_text": null,
          "new_text": "i.value()",
          "old_line_content": "    QUrlQuery query;",
          "new_line_content": "        const QVariant& value = i.value();",
          "content_same": false
        },
        {
          "line": 213,
          "old_api": null,
          "new_api": "isNull",
          "old_text": null,
          "new_text": "value.isNull()",
          "old_line_content": "    QMapIterator<QString, QVariant> i(properties);",
          "new_line_content": "        if (!value.isValid() || value.isNull()) // if not valid, defaults are used",
          "content_same": false
        },
        {
          "line": 217,
          "old_api": null,
          "new_api": "key",
          "old_text": null,
          "new_text": "i.key().startsWith('_')",
          "old_line_content": "",
          "new_line_content": "        assert(!i.key().startsWith('_'));",
          "content_same": false
        },
        {
          "line": 222,
          "old_api": null,
          "new_api": "setQuery",
          "old_text": null,
          "new_text": "url.setQuery(query)",
          "old_line_content": "",
          "new_line_content": "    url.setQuery(query);",
          "content_same": false
        },
        {
          "line": 107,
          "old_api": null,
          "new_api": "explicit",
          "old_text": null,
          "new_text": "explicit",
          "old_line_content": "        return 2.5 * (m_blurRadius + 1);",
          "new_line_content": "    explicit RoundedRectDropShadowEffect(const QVariantMap& settings)",
          "content_same": false
        },
        {
          "line": 109,
          "old_api": null,
          "new_api": "toReal",
          "old_text": null,
          "new_text": "settings[\"xRadius\"].toReal()",
          "old_line_content": "};",
          "new_line_content": "        , m_xRadius(settings[\"xRadius\"].toReal())",
          "content_same": false
        },
        {
          "line": 110,
          "old_api": null,
          "new_api": "toReal",
          "old_text": null,
          "new_text": "settings[\"yRadius\"].toReal()",
          "old_line_content": "",
          "new_line_content": "        , m_yRadius(settings[\"yRadius\"].toReal())",
          "content_same": false
        },
        {
          "line": 115,
          "old_api": null,
          "new_api": "qFuzzyIsNull",
          "old_text": null,
          "new_text": "qFuzzyIsNull(m_yRadius)",
          "old_line_content": "        : RectDropShadowEffect(settings)",
          "new_line_content": "        assert(!(qFuzzyIsNull(m_xRadius) && qFuzzyIsNull(m_yRadius))); // use RectDropShadowEffect instead",
          "content_same": false
        },
        {
          "line": 118,
          "old_api": null,
          "new_api": "fill",
          "old_text": null,
          "new_text": "mask.fill(Qt::transparent)",
          "old_line_content": "    { }",
          "new_line_content": "        mask.fill(Qt::transparent);",
          "content_same": false
        },
        {
          "line": 120,
          "old_api": null,
          "new_api": "isNull",
          "old_text": null,
          "new_text": "mask.isNull()",
          "old_line_content": "    QImage generate(const QSize& size) const override",
          "new_line_content": "        assert(!mask.isNull());",
          "content_same": false
        },
        {
          "line": 123,
          "old_api": null,
          "new_api": "setRenderHint",
          "old_text": null,
          "new_text": "painter.setRenderHint(QPainter::Antialiasing)",
          "old_line_content": "",
          "new_line_content": "            painter.setRenderHint(QPainter::Antialiasing);",
          "content_same": false
        },
        {
          "line": 124,
          "old_api": null,
          "new_api": "setPen",
          "old_text": null,
          "new_text": "painter.setPen(m_color)",
          "old_line_content": "        QImage mask(size, QImage::Format_ARGB32_Premultiplied);",
          "new_line_content": "            painter.setPen(m_color);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 130,
          "old_api": "setRenderHint",
          "new_api": null,
          "old_text": "painter.setRenderHint(QPainter::Antialiasing)",
          "new_text": null,
          "old_line_content": "            painter.setRenderHint(QPainter::Antialiasing);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 131,
          "old_api": "setPen",
          "new_api": null,
          "old_text": "painter.setPen(m_color)",
          "new_text": null,
          "old_line_content": "            painter.setPen(m_color);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 134,
          "old_api": "rect",
          "new_api": null,
          "old_text": "mask.rect()",
          "new_text": null,
          "old_line_content": "            path.addRoundedRect(mask.rect(), m_xRadius, m_yRadius);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 135,
          "old_api": "fillPath",
          "new_api": null,
          "old_text": "painter.fillPath(path, m_color)",
          "new_text": null,
          "old_line_content": "            painter.fillPath(path, m_color);",
          "new_line_content": "protected:",
          "content_same": false
        },
        {
          "line": 136,
          "old_api": "drawPath",
          "new_api": null,
          "old_text": "painter.drawPath(path)",
          "new_text": null,
          "old_line_content": "            painter.drawPath(path);",
          "new_line_content": "    qreal m_xRadius = 0.0;",
          "content_same": false
        },
        {
          "line": 139,
          "old_api": "RectDropShadowEffect::generate(mask)",
          "new_api": null,
          "old_text": "RectDropShadowEffect::generate(mask)",
          "new_text": null,
          "old_line_content": "        return RectDropShadowEffect::generate(mask);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 151,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(size)",
          "new_text": null,
          "old_line_content": "    assert(size);",
          "new_line_content": "            return {};",
          "content_same": false
        },
        {
          "line": 160,
          "old_api": "QMetaEnum::fromType<EffectsImageProvider::Effect>()",
          "new_api": null,
          "old_text": "QMetaEnum::fromType<EffectsImageProvider::Effect>()",
          "new_text": null,
          "old_line_content": "        static const auto effectMetaEnum = QMetaEnum::fromType<EffectsImageProvider::Effect>();",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 164,
          "old_api": "queryItems",
          "new_api": null,
          "old_text": "query.queryItems()",
          "new_text": null,
          "old_line_content": "            for (auto&& i : query.queryItems())",
          "new_line_content": "        QUrl url(id, QUrl::ParsingMode::StrictMode);",
          "content_same": false
        },
        {
          "line": 166,
          "old_api": "toLatin1",
          "new_api": null,
          "old_text": "i.second.toLatin1()",
          "new_text": null,
          "old_line_content": "                map.insert(i.first, QUrl::fromPercentEncoding(i.second.toLatin1()));",
          "new_line_content": "        const QUrlQuery query(url);",
          "content_same": false
        },
        {
          "line": 179,
          "old_api": "queryToVariantMap",
          "new_api": null,
          "old_text": "queryToVariantMap(query)",
          "new_text": null,
          "old_line_content": "            effect = std::make_unique<RectDropShadowEffect>(queryToVariantMap(query));",
          "new_line_content": "        default:",
          "content_same": false
        },
        {
          "line": 190,
          "old_api": "generate",
          "new_api": null,
          "old_text": "effect->generate(requestedSize)",
          "new_text": null,
          "old_line_content": "        return effect->generate(requestedSize);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 193,
          "old_api": "generate",
          "new_api": null,
          "old_text": "generate()",
          "new_text": null,
          "old_line_content": "    const auto& effect = generate();",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 201,
          "old_api": "QMetaEnum::fromType<EffectsImageProvider::Effect>()",
          "new_api": null,
          "old_text": "QMetaEnum::fromType<EffectsImageProvider::Effect>()",
          "new_text": null,
          "old_line_content": "    static const auto effectMetaEnum = QMetaEnum::fromType<EffectsImageProvider::Effect>();",
          "new_line_content": "    // image://{id}/{effectType} -> image://effects/DropShadow",
          "content_same": false
        },
        {
          "line": 205,
          "old_api": "QStringLiteral",
          "new_api": null,
          "old_text": "QStringLiteral(\"image\")",
          "new_text": null,
          "old_line_content": "    url.setScheme(QStringLiteral(\"image\"));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 80,
          "old_api": "effectiveBlurRadius",
          "new_api": null,
          "old_text": "effectiveBlurRadius()",
          "new_text": null,
          "old_line_content": "            const auto radius = effectiveBlurRadius();",
          "new_line_content": "            const auto radius = m_blurRadius;",
          "content_same": false
        },
        {
          "line": 214,
          "old_api": "hasNext",
          "new_api": null,
          "old_text": "i.hasNext()",
          "new_text": null,
          "old_line_content": "    while (i.hasNext())",
          "new_line_content": "            continue;",
          "content_same": false
        },
        {
          "line": 218,
          "old_api": "value",
          "new_api": null,
          "old_text": "i.value()",
          "new_text": null,
          "old_line_content": "        const QVariant& value = i.value();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 93,
          "old_api": "effectiveBlurRadius",
          "new_api": null,
          "old_text": "effectiveBlurRadius()",
          "new_text": null,
          "old_line_content": "        const qreal radius = 2 * effectiveBlurRadius();",
          "new_line_content": "        const qreal diameter = m_blurRadius * 2;",
          "content_same": false
        },
        {
          "line": 223,
          "old_api": "value.canConvert<QString>()",
          "new_api": null,
          "old_text": "value.canConvert<QString>()",
          "new_text": null,
          "old_line_content": "        assert(value.canConvert<QString>());",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 227,
          "old_api": "toString",
          "new_api": null,
          "old_text": "value.toString()",
          "new_text": null,
          "old_line_content": "        query.addQueryItem(i.key(), QUrl::toPercentEncoding(value.toString()));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 229,
          "old_api": "setQuery",
          "new_api": null,
          "old_text": "url.setQuery(query)",
          "new_text": null,
          "old_line_content": "    url.setQuery(query);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 231,
          "old_api": "isValid",
          "new_api": null,
          "old_text": "url.isValid()",
          "new_text": null,
          "old_line_content": "    assert(url.isValid());",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 104,
          "old_api": "constexpr",
          "new_api": null,
          "old_text": "constexpr",
          "new_text": null,
          "old_line_content": "    constexpr qreal effectiveBlurRadius() const",
          "new_line_content": "class RoundedRectDropShadowEffect : public RectDropShadowEffect",
          "content_same": false
        },
        {
          "line": 114,
          "old_api": "explicit",
          "new_api": null,
          "old_text": "explicit",
          "new_text": null,
          "old_line_content": "    explicit RoundedRectDropShadowEffect(const QVariantMap& settings)",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 116,
          "old_api": "toReal",
          "new_api": null,
          "old_text": "settings[\"xRadius\"].toReal()",
          "new_text": null,
          "old_line_content": "        , m_xRadius(settings[\"xRadius\"].toReal())",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 117,
          "old_api": "toReal",
          "new_api": null,
          "old_text": "settings[\"yRadius\"].toReal()",
          "new_text": null,
          "old_line_content": "        , m_yRadius(settings[\"yRadius\"].toReal())",
          "new_line_content": "        QImage mask(size, QImage::Format_ARGB32_Premultiplied);",
          "content_same": false
        },
        {
          "line": 122,
          "old_api": "qFuzzyIsNull",
          "new_api": null,
          "old_text": "qFuzzyIsNull(m_yRadius)",
          "new_text": null,
          "old_line_content": "        assert(!(qFuzzyIsNull(m_xRadius) && qFuzzyIsNull(m_yRadius))); // use RectDropShadowEffect instead",
          "new_line_content": "            QPainter painter(&mask);",
          "content_same": false
        },
        {
          "line": 125,
          "old_api": "fill",
          "new_api": null,
          "old_text": "mask.fill(Qt::transparent)",
          "new_text": null,
          "old_line_content": "        mask.fill(Qt::transparent);",
          "new_line_content": "",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 11,
      "total_additions": 26,
      "total_deletions": 29,
      "total_api_changes": 66
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 11,
        "api_related_lines": 66,
        "non_api_lines": 6,
        "non_api_line_numbers": [
          102,
          103,
          105,
          106,
          108,
          94
        ]
      }
    },
    "api_calls_before": 85,
    "api_calls_after": 81,
    "diff_info": {
      "added_lines": 4,
      "removed_lines": 11,
      "total_diff_lines": 45
    }
  }
}