{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/vlc/modified_file/11ddc8cbf5ab3c879db2c14c8d7d3b44a2ada323",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/vlc/modified_file/11ddc8cbf5ab3c879db2c14c8d7d3b44a2ada323/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/vlc/modified_file/11ddc8cbf5ab3c879db2c14c8d7d3b44a2ada323/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/vlc/modified_file/11ddc8cbf5ab3c879db2c14c8d7d3b44a2ada323/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 1717,
          "old_api": "IDirect3DVertexBuffer9_Unlock",
          "new_api": "IDirect3DVertexBuffer9_Lock",
          "old_text": "IDirect3DVertexBuffer9_Unlock(d3dvtc)",
          "new_text": "IDirect3DVertexBuffer9_Lock(d3dvtc, 0, 0, &vertex, D3DLOCK_DISCARD)",
          "old_line_content": "    hr = IDirect3DVertexBuffer9_Unlock(d3dvtc);",
          "new_line_content": "    hr = IDirect3DVertexBuffer9_Lock(d3dvtc, 0, 0, &vertex, D3DLOCK_DISCARD);",
          "content_same": false
        },
        {
          "line": 1745,
          "old_api": "IDirect3DDevice9_SetPixelShader",
          "new_api": "FAILED",
          "old_text": "IDirect3DDevice9_SetPixelShader(d3ddev, NULL)",
          "new_text": "FAILED(hr)",
          "old_line_content": "            hr = IDirect3DDevice9_SetPixelShader(d3ddev, NULL);",
          "new_line_content": "            if (FAILED(hr)) {",
          "content_same": false
        },
        {
          "line": 1746,
          "old_api": "FAILED",
          "new_api": "msg_Dbg",
          "old_text": "FAILED(hr)",
          "new_text": "msg_Dbg(vd, \"Failed IDirect3DDevice9_SetPixelShaderConstantF: 0x%0lx\", hr)",
          "old_line_content": "        if (FAILED(hr)) {",
          "new_line_content": "                msg_Dbg(vd, \"Failed IDirect3DDevice9_SetPixelShaderConstantF: 0x%0lx\", hr);",
          "content_same": false
        },
        {
          "line": 1753,
          "old_api": "IDirect3DDevice9_SetStreamSource",
          "new_api": "msg_Dbg",
          "old_text": "IDirect3DDevice9_SetStreamSource(d3ddev, 0, d3dvtc, 0, sizeof(CUSTOMVERTEX))",
          "new_text": "msg_Dbg(vd, \"Failed IDirect3DDevice9_SetPixelShader: 0x%0lx\", hr)",
          "old_line_content": "    hr = IDirect3DDevice9_SetStreamSource(d3ddev, 0, d3dvtc, 0, sizeof(CUSTOMVERTEX));",
          "new_line_content": "            msg_Dbg(vd, \"Failed IDirect3DDevice9_SetPixelShader: 0x%0lx\", hr);",
          "content_same": false
        },
        {
          "line": 1760,
          "old_api": "IDirect3DDevice9_SetFVF",
          "new_api": "FAILED",
          "old_text": "IDirect3DDevice9_SetFVF(d3ddev, D3DFVF_CUSTOMVERTEX)",
          "new_text": "FAILED(hr)",
          "old_line_content": "    hr = IDirect3DDevice9_SetFVF(d3ddev, D3DFVF_CUSTOMVERTEX);",
          "new_line_content": "    if (FAILED(hr)) {",
          "content_same": false
        },
        {
          "line": 1761,
          "old_api": "FAILED",
          "new_api": "msg_Dbg",
          "old_text": "FAILED(hr)",
          "new_text": "msg_Dbg(vd, \"Failed IDirect3DDevice9_SetStreamSource: 0x%0lx\", hr)",
          "old_line_content": "    if (FAILED(hr)) {",
          "new_line_content": "        msg_Dbg(vd, \"Failed IDirect3DDevice9_SetStreamSource: 0x%0lx\", hr);",
          "content_same": false
        },
        {
          "line": 1767,
          "old_api": "IDirect3DDevice9_DrawPrimitive",
          "new_api": "FAILED",
          "old_text": "IDirect3DDevice9_DrawPrimitive(d3ddev, D3DPT_TRIANGLEFAN, 0, 2)",
          "new_text": "FAILED(hr)",
          "old_line_content": "    hr = IDirect3DDevice9_DrawPrimitive(d3ddev, D3DPT_TRIANGLEFAN, 0, 2);",
          "new_line_content": "    if (FAILED(hr)) {",
          "content_same": false
        },
        {
          "line": 1768,
          "old_api": "FAILED",
          "new_api": "msg_Dbg",
          "old_text": "FAILED(hr)",
          "new_text": "msg_Dbg(vd, \"Failed IDirect3DDevice9_SetFVF: 0x%0lx\", hr)",
          "old_line_content": "    if (FAILED(hr)) {",
          "new_line_content": "        msg_Dbg(vd, \"Failed IDirect3DDevice9_SetFVF: 0x%0lx\", hr);",
          "content_same": false
        },
        {
          "line": 1808,
          "old_api": "Direct3D9RenderRegion",
          "new_api": "IDirect3DDevice9_BeginScene",
          "old_text": "Direct3D9RenderRegion(vd, picture, true)",
          "new_text": "IDirect3DDevice9_BeginScene(d3ddev)",
          "old_line_content": "    Direct3D9RenderRegion(vd, picture, true);",
          "new_line_content": "    hr = IDirect3DDevice9_BeginScene(d3ddev);",
          "content_same": false
        },
        {
          "line": 1821,
          "old_api": "IDirect3DDevice9_EndScene",
          "new_api": "Direct3D9RenderRegion",
          "old_text": "IDirect3DDevice9_EndScene(d3ddev)",
          "new_text": "Direct3D9RenderRegion(vd, r, false)",
          "old_line_content": "    hr = IDirect3DDevice9_EndScene(d3ddev);",
          "new_line_content": "            Direct3D9RenderRegion(vd, r, false);",
          "content_same": false
        },
        {
          "line": 1845,
          "old_api": "vlc_mutex_unlock",
          "new_api": "VLC_UNUSED",
          "old_text": "vlc_mutex_unlock(&sys->lock)",
          "new_text": "VLC_UNUSED(p_data)",
          "old_line_content": "    vlc_mutex_unlock(&sys->lock);",
          "new_line_content": "    VLC_UNUSED(p_data);",
          "content_same": false
        },
        {
          "line": 1866,
          "old_api": "strdup",
          "new_api": "xrealloc",
          "old_text": "strdup(SELECTED_SHADER_FILE)",
          "new_text": "xrealloc(ctx->descs, (ctx->count + num_shaders + 1) * sizeof(char *))",
          "old_line_content": "    ctx->values[ctx->count] = strdup(SELECTED_SHADER_FILE);",
          "new_line_content": "    ctx->descs = xrealloc(ctx->descs, (ctx->count + num_shaders + 1) * sizeof(char *));",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 1798,
          "old_api": null,
          "new_api": "IDirect3DDevice9_Clear",
          "old_text": null,
          "new_text": "IDirect3DDevice9_Clear(d3ddev, 0, NULL, D3DCLEAR_TARGET,\n                                  D3DCOLOR_XRGB(0, 0, 0), 1.0f, 0)",
          "old_line_content": "        sys->clear_scene = false;",
          "new_line_content": "        hr = IDirect3DDevice9_Clear(d3ddev, 0, NULL, D3DCLEAR_TARGET,",
          "content_same": false
        },
        {
          "line": 1799,
          "old_api": null,
          "new_api": "D3DCOLOR_XRGB",
          "old_text": null,
          "new_text": "D3DCOLOR_XRGB(0, 0, 0)",
          "old_line_content": "    }",
          "new_line_content": "                                  D3DCOLOR_XRGB(0, 0, 0), 1.0f, 0);",
          "content_same": false
        },
        {
          "line": 1800,
          "old_api": null,
          "new_api": "FAILED",
          "old_text": null,
          "new_text": "FAILED(hr)",
          "old_line_content": "",
          "new_line_content": "        if (FAILED(hr)) {",
          "content_same": false
        },
        {
          "line": 1673,
          "old_api": null,
          "new_api": "IDirect3DTexture9_UnlockRect",
          "old_text": null,
          "new_text": "IDirect3DTexture9_UnlockRect(d3dr->texture, 0)",
          "old_line_content": "",
          "new_line_content": "            hr = IDirect3DTexture9_UnlockRect(d3dr->texture, 0);",
          "content_same": false
        },
        {
          "line": 1674,
          "old_api": null,
          "new_api": "FAILED",
          "old_text": null,
          "new_text": "FAILED(hr)",
          "old_line_content": "        /* Map the subpicture to sys->rect_dest */",
          "new_line_content": "            if (FAILED(hr))",
          "content_same": false
        },
        {
          "line": 1675,
          "old_api": null,
          "new_api": "msg_Err",
          "old_text": null,
          "new_text": "msg_Err(vd, \"Failed to unlock the texture\")",
          "old_line_content": "        RECT src;",
          "new_line_content": "                msg_Err(vd, \"Failed to unlock the texture\");",
          "content_same": false
        },
        {
          "line": 1801,
          "old_api": null,
          "new_api": "msg_Dbg",
          "old_text": null,
          "new_text": "msg_Dbg(vd, \"Failed IDirect3DDevice9_Clear: 0x%0lx\", hr)",
          "old_line_content": "    // Begin the scene",
          "new_line_content": "            msg_Dbg(vd, \"Failed IDirect3DDevice9_Clear: 0x%0lx\", hr);",
          "content_same": false
        },
        {
          "line": 1677,
          "old_api": null,
          "new_api": "msg_Err",
          "old_text": null,
          "new_text": "msg_Err(vd, \"Failed to lock the texture\")",
          "old_line_content": "        src.right  = src.left + r->fmt.i_visible_width;",
          "new_line_content": "            msg_Err(vd, \"Failed to lock the texture\");",
          "content_same": false
        },
        {
          "line": 1809,
          "old_api": null,
          "new_api": "FAILED",
          "old_text": null,
          "new_text": "FAILED(hr)",
          "old_line_content": "",
          "new_line_content": "    if (FAILED(hr)) {",
          "content_same": false
        },
        {
          "line": 1810,
          "old_api": null,
          "new_api": "msg_Dbg",
          "old_text": null,
          "new_text": "msg_Dbg(vd, \"Failed IDirect3DDevice9_BeginScene: 0x%0lx\", hr)",
          "old_line_content": "    if (subpicture_count > 0)",
          "new_line_content": "        msg_Dbg(vd, \"Failed IDirect3DDevice9_BeginScene: 0x%0lx\", hr);",
          "content_same": false
        },
        {
          "line": 1814,
          "old_api": null,
          "new_api": "Direct3D9RenderRegion",
          "old_text": null,
          "new_text": "Direct3D9RenderRegion(vd, picture, true)",
          "old_line_content": "        if (r->texture)",
          "new_line_content": "    Direct3D9RenderRegion(vd, picture, true);",
          "content_same": false
        },
        {
          "line": 1817,
          "old_api": null,
          "new_api": "IDirect3DDevice9_SetRenderState",
          "old_text": null,
          "new_text": "IDirect3DDevice9_SetRenderState(d3ddev, D3DRS_ALPHABLENDENABLE, TRUE)",
          "old_line_content": "    if (subpicture_count > 0)",
          "new_line_content": "        IDirect3DDevice9_SetRenderState(d3ddev, D3DRS_ALPHABLENDENABLE, TRUE);",
          "content_same": false
        },
        {
          "line": 1696,
          "old_api": null,
          "new_api": "Direct3D9SetupVertices",
          "old_text": null,
          "new_text": "Direct3D9SetupVertices(d3dr->vertex,\n                              src, src, dst,\n                              subpicture->i_alpha * r->i_alpha / 255, ORIENT_NORMAL)",
          "old_line_content": "static int Direct3D9RenderRegion(vout_display_t *vd,",
          "new_line_content": "        Direct3D9SetupVertices(d3dr->vertex,",
          "content_same": false
        },
        {
          "line": 1824,
          "old_api": null,
          "new_api": "IDirect3DDevice9_SetRenderState",
          "old_text": null,
          "new_text": "IDirect3DDevice9_SetRenderState(d3ddev, D3DRS_ALPHABLENDENABLE, FALSE)",
          "old_line_content": "        return;",
          "new_line_content": "        IDirect3DDevice9_SetRenderState(d3ddev, D3DRS_ALPHABLENDENABLE, FALSE);",
          "content_same": false
        },
        {
          "line": 1827,
          "old_api": null,
          "new_api": "IDirect3DDevice9_EndScene",
          "old_text": null,
          "new_text": "IDirect3DDevice9_EndScene(d3ddev)",
          "old_line_content": "",
          "new_line_content": "    hr = IDirect3DDevice9_EndScene(d3ddev);",
          "content_same": false
        },
        {
          "line": 1828,
          "old_api": null,
          "new_api": "FAILED",
          "old_text": null,
          "new_text": "FAILED(hr)",
          "old_line_content": "/*****************************************************************************",
          "new_line_content": "    if (FAILED(hr)) {",
          "content_same": false
        },
        {
          "line": 1829,
          "old_api": null,
          "new_api": "msg_Dbg",
          "old_text": null,
          "new_text": "msg_Dbg(vd, \"Failed IDirect3DDevice9_EndScene: 0x%0lx\", hr)",
          "old_line_content": " * DesktopCallback: desktop mode variable callback",
          "new_line_content": "        msg_Dbg(vd, \"Failed IDirect3DDevice9_EndScene: 0x%0lx\", hr);",
          "content_same": false
        },
        {
          "line": 1843,
          "old_api": null,
          "new_api": "VLC_UNUSED",
          "old_text": null,
          "new_text": "VLC_UNUSED(psz_cmd)",
          "old_line_content": "    sys->ch_desktop |= ch_desktop;",
          "new_line_content": "    VLC_UNUSED(psz_cmd);",
          "content_same": false
        },
        {
          "line": 1844,
          "old_api": null,
          "new_api": "VLC_UNUSED",
          "old_text": null,
          "new_text": "VLC_UNUSED(oldval)",
          "old_line_content": "    sys->desktop_requested = newval.b_bool;",
          "new_line_content": "    VLC_UNUSED(oldval);",
          "content_same": false
        },
        {
          "line": 1847,
          "old_api": null,
          "new_api": "vlc_mutex_lock",
          "old_text": null,
          "new_text": "vlc_mutex_lock(&sys->lock)",
          "old_line_content": "}",
          "new_line_content": "    vlc_mutex_lock(&sys->lock);",
          "content_same": false
        },
        {
          "line": 1722,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(vertex, region->vertex, sizeof(region->vertex))",
          "old_line_content": "",
          "new_line_content": "    memcpy(vertex, region->vertex, sizeof(region->vertex));",
          "content_same": false
        },
        {
          "line": 1723,
          "old_api": null,
          "new_api": "IDirect3DVertexBuffer9_Unlock",
          "old_text": null,
          "new_text": "IDirect3DVertexBuffer9_Unlock(d3dvtc)",
          "old_line_content": "    // Setup our texture. Using textures introduces the texture stage states,",
          "new_line_content": "    hr = IDirect3DVertexBuffer9_Unlock(d3dvtc);",
          "content_same": false
        },
        {
          "line": 1724,
          "old_api": null,
          "new_api": "FAILED",
          "old_text": null,
          "new_text": "FAILED(hr)",
          "old_line_content": "    // which govern how textures get blended together (in the case of multiple",
          "new_line_content": "    if (FAILED(hr)) {",
          "content_same": false
        },
        {
          "line": 1725,
          "old_api": null,
          "new_api": "msg_Dbg",
          "old_text": null,
          "new_text": "msg_Dbg(vd, \"Failed IDirect3DVertexBuffer9_Unlock: 0x%0lx\", hr)",
          "old_line_content": "    // textures) and lighting information. In this case, we are modulating",
          "new_line_content": "        msg_Dbg(vd, \"Failed IDirect3DVertexBuffer9_Unlock: 0x%0lx\", hr);",
          "content_same": false
        },
        {
          "line": 1851,
          "old_api": null,
          "new_api": "vlc_mutex_unlock",
          "old_text": null,
          "new_text": "vlc_mutex_unlock(&sys->lock)",
          "old_line_content": "    char **values;",
          "new_line_content": "    vlc_mutex_unlock(&sys->lock);",
          "content_same": false
        },
        {
          "line": 1733,
          "old_api": null,
          "new_api": "IDirect3DDevice9_SetTexture",
          "old_text": null,
          "new_text": "IDirect3DDevice9_SetTexture(d3ddev, 0, (LPDIRECT3DBASETEXTURE9)d3dtex)",
          "old_line_content": "    if (sys->d3dx_shader) {",
          "new_line_content": "    hr = IDirect3DDevice9_SetTexture(d3ddev, 0, (LPDIRECT3DBASETEXTURE9)d3dtex);",
          "content_same": false
        },
        {
          "line": 1734,
          "old_api": null,
          "new_api": "FAILED",
          "old_text": null,
          "new_text": "FAILED(hr)",
          "old_line_content": "        if (use_pixel_shader)",
          "new_line_content": "    if (FAILED(hr)) {",
          "content_same": false
        },
        {
          "line": 1735,
          "old_api": null,
          "new_api": "msg_Dbg",
          "old_text": null,
          "new_text": "msg_Dbg(vd, \"Failed IDirect3DDevice9_SetTexture: 0x%0lx\", hr)",
          "old_line_content": "        {",
          "new_line_content": "        msg_Dbg(vd, \"Failed IDirect3DDevice9_SetTexture: 0x%0lx\", hr);",
          "content_same": false
        },
        {
          "line": 1865,
          "old_api": null,
          "new_api": "xrealloc",
          "old_text": null,
          "new_text": "xrealloc(ctx->values, (ctx->count + num_shaders + 1) * sizeof(char *))",
          "old_line_content": "    }",
          "new_line_content": "    ctx->values = xrealloc(ctx->values, (ctx->count + num_shaders + 1) * sizeof(char *));",
          "content_same": false
        },
        {
          "line": 1868,
          "old_api": null,
          "new_api": "strdup",
          "old_text": null,
          "new_text": "strdup(builtin_shaders[i].name)",
          "old_line_content": "    ctx->count++;",
          "new_line_content": "        ctx->values[ctx->count] = strdup(builtin_shaders[i].name);",
          "content_same": false
        },
        {
          "line": 1869,
          "old_api": null,
          "new_api": "strdup",
          "old_text": null,
          "new_text": "strdup(builtin_shaders[i].name)",
          "old_line_content": "}",
          "new_line_content": "        ctx->descs[ctx->count] = strdup(builtin_shaders[i].name);",
          "content_same": false
        },
        {
          "line": 1742,
          "old_api": null,
          "new_api": "IDirect3DDevice9_SetPixelShader",
          "old_text": null,
          "new_text": "IDirect3DDevice9_SetPixelShader(d3ddev, sys->d3dx_shader)",
          "old_line_content": "            }",
          "new_line_content": "            hr = IDirect3DDevice9_SetPixelShader(d3ddev, sys->d3dx_shader);",
          "content_same": false
        },
        {
          "line": 1744,
          "old_api": null,
          "new_api": "IDirect3DDevice9_SetPixelShaderConstantF",
          "old_text": null,
          "new_text": "IDirect3DDevice9_SetPixelShaderConstantF(d3ddev, 0, shader_data, 1)",
          "old_line_content": "        else /* Disable any existing pixel shader. */",
          "new_line_content": "            hr = IDirect3DDevice9_SetPixelShaderConstantF(d3ddev, 0, shader_data, 1);",
          "content_same": false
        },
        {
          "line": 1872,
          "old_api": null,
          "new_api": "strdup",
          "old_text": null,
          "new_text": "strdup(SELECTED_SHADER_FILE)",
          "old_line_content": "static int FindShadersCallback(vlc_object_t *object, const char *name,",
          "new_line_content": "    ctx->values[ctx->count] = strdup(SELECTED_SHADER_FILE);",
          "content_same": false
        },
        {
          "line": 1873,
          "old_api": null,
          "new_api": "strdup",
          "old_text": null,
          "new_text": "strdup(SELECTED_SHADER_FILE)",
          "old_line_content": "                               char ***values, char ***descs)",
          "new_line_content": "    ctx->descs[ctx->count] = strdup(SELECTED_SHADER_FILE);",
          "content_same": false
        },
        {
          "line": 1751,
          "old_api": null,
          "new_api": "IDirect3DDevice9_SetPixelShader",
          "old_text": null,
          "new_text": "IDirect3DDevice9_SetPixelShader(d3ddev, NULL)",
          "old_line_content": "",
          "new_line_content": "            hr = IDirect3DDevice9_SetPixelShader(d3ddev, NULL);",
          "content_same": false
        },
        {
          "line": 1752,
          "old_api": null,
          "new_api": "FAILED",
          "old_text": null,
          "new_text": "FAILED(hr)",
          "old_line_content": "    // Render the vertex buffer contents",
          "new_line_content": "        if (FAILED(hr)) {",
          "content_same": false
        },
        {
          "line": 1881,
          "old_api": null,
          "new_api": "VLC_UNUSED",
          "old_text": null,
          "new_text": "VLC_UNUSED(object)",
          "old_line_content": "",
          "new_line_content": "    VLC_UNUSED(object);",
          "content_same": false
        },
        {
          "line": 1882,
          "old_api": null,
          "new_api": "VLC_UNUSED",
          "old_text": null,
          "new_text": "VLC_UNUSED(name)",
          "old_line_content": "    *values = ctx.values;",
          "new_line_content": "    VLC_UNUSED(name);",
          "content_same": false
        },
        {
          "line": 1886,
          "old_api": null,
          "new_api": "ListShaders",
          "old_text": null,
          "new_text": "ListShaders(&ctx)",
          "old_line_content": "}",
          "new_line_content": "    ListShaders(&ctx);",
          "content_same": false
        },
        {
          "line": 1759,
          "old_api": null,
          "new_api": "IDirect3DDevice9_SetStreamSource",
          "old_text": null,
          "new_text": "IDirect3DDevice9_SetStreamSource(d3ddev, 0, d3dvtc, 0, sizeof(CUSTOMVERTEX))",
          "old_line_content": "    // we use FVF instead of vertex shader",
          "new_line_content": "    hr = IDirect3DDevice9_SetStreamSource(d3ddev, 0, d3dvtc, 0, sizeof(CUSTOMVERTEX));",
          "content_same": false
        },
        {
          "line": 1766,
          "old_api": null,
          "new_api": "IDirect3DDevice9_SetFVF",
          "old_text": null,
          "new_text": "IDirect3DDevice9_SetFVF(d3ddev, D3DFVF_CUSTOMVERTEX)",
          "old_line_content": "    // draw rectangle",
          "new_line_content": "    hr = IDirect3DDevice9_SetFVF(d3ddev, D3DFVF_CUSTOMVERTEX);",
          "content_same": false
        },
        {
          "line": 1773,
          "old_api": null,
          "new_api": "IDirect3DDevice9_DrawPrimitive",
          "old_text": null,
          "new_text": "IDirect3DDevice9_DrawPrimitive(d3ddev, D3DPT_TRIANGLEFAN, 0, 2)",
          "old_line_content": "}",
          "new_line_content": "    hr = IDirect3DDevice9_DrawPrimitive(d3ddev, D3DPT_TRIANGLEFAN, 0, 2);",
          "content_same": false
        },
        {
          "line": 1774,
          "old_api": null,
          "new_api": "FAILED",
          "old_text": null,
          "new_text": "FAILED(hr)",
          "old_line_content": "",
          "new_line_content": "    if (FAILED(hr)) {",
          "content_same": false
        },
        {
          "line": 1775,
          "old_api": null,
          "new_api": "msg_Dbg",
          "old_text": null,
          "new_text": "msg_Dbg(vd, \"Failed IDirect3DDevice9_DrawPrimitive: 0x%0lx\", hr)",
          "old_line_content": "/**",
          "new_line_content": "        msg_Dbg(vd, \"Failed IDirect3DDevice9_DrawPrimitive: 0x%0lx\", hr);",
          "content_same": false
        },
        {
          "line": 1655,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(dst_data, src_data, r->fmt.i_visible_height * dst_pitch)",
          "old_line_content": "                if (d3dr->format == D3DFMT_A8B8G8R8) {",
          "new_line_content": "                    memcpy(dst_data, src_data, r->fmt.i_visible_height * dst_pitch);",
          "content_same": false
        },
        {
          "line": 1657,
          "old_api": null,
          "new_api": "__MIN",
          "old_text": null,
          "new_text": "__MIN(dst_pitch, r->p_picture->p->i_visible_pitch)",
          "old_line_content": "                           copy_pitch);",
          "new_line_content": "                    int copy_pitch = __MIN(dst_pitch, r->p_picture->p->i_visible_pitch);",
          "content_same": false
        },
        {
          "line": 1659,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(&dst_data[y * dst_pitch], &src_data[y * src_pitch], copy_pitch)",
          "old_line_content": "                    for (int x = 0; x < copy_pitch; x += 4) {",
          "new_line_content": "                        memcpy(&dst_data[y * dst_pitch], &src_data[y * src_pitch], copy_pitch);",
          "content_same": false
        },
        {
          "line": 1663,
          "old_api": null,
          "new_api": "__MIN",
          "old_text": null,
          "new_text": "__MIN(dst_pitch, r->p_picture->p->i_visible_pitch)",
          "old_line_content": "                        dst_data[y * dst_pitch + x + 3] = src_data[y * src_pitch + x + 3];",
          "new_line_content": "                int copy_pitch = __MIN(dst_pitch, r->p_picture->p->i_visible_pitch);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 1792,
          "old_api": "IDirect3DDevice9_Clear",
          "new_api": null,
          "old_text": "IDirect3DDevice9_Clear(d3ddev, 0, NULL, D3DCLEAR_TARGET,\n                                  D3DCOLOR_XRGB(0, 0, 0), 1.0f, 0)",
          "new_text": null,
          "old_line_content": "        hr = IDirect3DDevice9_Clear(d3ddev, 0, NULL, D3DCLEAR_TARGET,",
          "new_line_content": "    vout_display_sys_t *sys = vd->sys;",
          "content_same": false
        },
        {
          "line": 1793,
          "old_api": "D3DCOLOR_XRGB",
          "new_api": null,
          "old_text": "D3DCOLOR_XRGB(0, 0, 0)",
          "new_text": null,
          "old_line_content": "                                  D3DCOLOR_XRGB(0, 0, 0), 1.0f, 0);",
          "new_line_content": "    LPDIRECT3DDEVICE9 d3ddev = sys->d3ddev;",
          "content_same": false
        },
        {
          "line": 1794,
          "old_api": "FAILED",
          "new_api": null,
          "old_text": "FAILED(hr)",
          "new_text": null,
          "old_line_content": "        if (FAILED(hr)) {",
          "new_line_content": "    HRESULT hr;",
          "content_same": false
        },
        {
          "line": 1667,
          "old_api": "IDirect3DTexture9_UnlockRect",
          "new_api": null,
          "old_text": "IDirect3DTexture9_UnlockRect(d3dr->texture, 0)",
          "new_text": null,
          "old_line_content": "            hr = IDirect3DTexture9_UnlockRect(d3dr->texture, 0);",
          "new_line_content": "                        dst_data[y * dst_pitch + x + 1] = src_data[y * src_pitch + x + 1];",
          "content_same": false
        },
        {
          "line": 1668,
          "old_api": "FAILED",
          "new_api": null,
          "old_text": "FAILED(hr)",
          "new_text": null,
          "old_line_content": "            if (FAILED(hr))",
          "new_line_content": "                        dst_data[y * dst_pitch + x + 2] = src_data[y * src_pitch + x + 0];",
          "content_same": false
        },
        {
          "line": 1669,
          "old_api": "msg_Err",
          "new_api": null,
          "old_text": "msg_Err(vd, \"Failed to unlock the texture\")",
          "new_text": null,
          "old_line_content": "                msg_Err(vd, \"Failed to unlock the texture\");",
          "new_line_content": "                        dst_data[y * dst_pitch + x + 3] = src_data[y * src_pitch + x + 3];",
          "content_same": false
        },
        {
          "line": 1795,
          "old_api": "msg_Dbg",
          "new_api": null,
          "old_text": "msg_Dbg(vd, \"Failed IDirect3DDevice9_Clear: 0x%0lx\", hr)",
          "new_text": null,
          "old_line_content": "            msg_Dbg(vd, \"Failed IDirect3DDevice9_Clear: 0x%0lx\", hr);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1671,
          "old_api": "msg_Err",
          "new_api": null,
          "old_text": "msg_Err(vd, \"Failed to lock the texture\")",
          "new_text": null,
          "old_line_content": "            msg_Err(vd, \"Failed to lock the texture\");",
          "new_line_content": "                }",
          "content_same": false
        },
        {
          "line": 1802,
          "old_api": "IDirect3DDevice9_BeginScene",
          "new_api": null,
          "old_text": "IDirect3DDevice9_BeginScene(d3ddev)",
          "new_text": null,
          "old_line_content": "    hr = IDirect3DDevice9_BeginScene(d3ddev);",
          "new_line_content": "            return;",
          "content_same": false
        },
        {
          "line": 1803,
          "old_api": "FAILED",
          "new_api": null,
          "old_text": "FAILED(hr)",
          "new_text": null,
          "old_line_content": "    if (FAILED(hr)) {",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 1804,
          "old_api": "msg_Dbg",
          "new_api": null,
          "old_text": "msg_Dbg(vd, \"Failed IDirect3DDevice9_BeginScene: 0x%0lx\", hr)",
          "new_text": null,
          "old_line_content": "        msg_Dbg(vd, \"Failed IDirect3DDevice9_BeginScene: 0x%0lx\", hr);",
          "new_line_content": "        sys->clear_scene = false;",
          "content_same": false
        },
        {
          "line": 1811,
          "old_api": "IDirect3DDevice9_SetRenderState",
          "new_api": null,
          "old_text": "IDirect3DDevice9_SetRenderState(d3ddev, D3DRS_ALPHABLENDENABLE, TRUE)",
          "new_text": null,
          "old_line_content": "        IDirect3DDevice9_SetRenderState(d3ddev, D3DRS_ALPHABLENDENABLE, TRUE);",
          "new_line_content": "        return;",
          "content_same": false
        },
        {
          "line": 1815,
          "old_api": "Direct3D9RenderRegion",
          "new_api": null,
          "old_text": "Direct3D9RenderRegion(vd, r, false)",
          "new_text": null,
          "old_line_content": "            Direct3D9RenderRegion(vd, r, false);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1690,
          "old_api": "Direct3D9SetupVertices",
          "new_api": null,
          "old_text": "Direct3D9SetupVertices(d3dr->vertex,\n                              src, src, dst,\n                              subpicture->i_alpha * r->i_alpha / 255, ORIENT_NORMAL)",
          "new_text": null,
          "old_line_content": "        Direct3D9SetupVertices(d3dr->vertex,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1818,
          "old_api": "IDirect3DDevice9_SetRenderState",
          "new_api": null,
          "old_text": "IDirect3DDevice9_SetRenderState(d3ddev, D3DRS_ALPHABLENDENABLE, FALSE)",
          "new_text": null,
          "old_line_content": "        IDirect3DDevice9_SetRenderState(d3ddev, D3DRS_ALPHABLENDENABLE, FALSE);",
          "new_line_content": "    for (int i = 0; i < subpicture_count; i++) {",
          "content_same": false
        },
        {
          "line": 1822,
          "old_api": "FAILED",
          "new_api": null,
          "old_text": "FAILED(hr)",
          "new_text": null,
          "old_line_content": "    if (FAILED(hr)) {",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1823,
          "old_api": "msg_Dbg",
          "new_api": null,
          "old_text": "msg_Dbg(vd, \"Failed IDirect3DDevice9_EndScene: 0x%0lx\", hr)",
          "new_text": null,
          "old_line_content": "        msg_Dbg(vd, \"Failed IDirect3DDevice9_EndScene: 0x%0lx\", hr);",
          "new_line_content": "    if (subpicture_count > 0)",
          "content_same": false
        },
        {
          "line": 1837,
          "old_api": "VLC_UNUSED",
          "new_api": null,
          "old_text": "VLC_UNUSED(psz_cmd)",
          "new_text": null,
          "old_line_content": "    VLC_UNUSED(psz_cmd);",
          "new_line_content": "static int DesktopCallback(vlc_object_t *object, char const *psz_cmd,",
          "content_same": false
        },
        {
          "line": 1838,
          "old_api": "VLC_UNUSED",
          "new_api": null,
          "old_text": "VLC_UNUSED(oldval)",
          "new_text": null,
          "old_line_content": "    VLC_UNUSED(oldval);",
          "new_line_content": "                            vlc_value_t oldval, vlc_value_t newval,",
          "content_same": false
        },
        {
          "line": 1711,
          "old_api": "IDirect3DVertexBuffer9_Lock",
          "new_api": null,
          "old_text": "IDirect3DVertexBuffer9_Lock(d3dvtc, 0, 0, &vertex, D3DLOCK_DISCARD)",
          "new_text": null,
          "old_line_content": "    hr = IDirect3DVertexBuffer9_Lock(d3dvtc, 0, 0, &vertex, D3DLOCK_DISCARD);",
          "new_line_content": "    LPDIRECT3DTEXTURE9      d3dtex = region->texture;",
          "content_same": false
        },
        {
          "line": 1712,
          "old_api": "FAILED",
          "new_api": null,
          "old_text": "FAILED(hr)",
          "new_text": null,
          "old_line_content": "    if (FAILED(hr)) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1713,
          "old_api": "msg_Dbg",
          "new_api": null,
          "old_text": "msg_Dbg(vd, \"Failed IDirect3DVertexBuffer9_Lock: 0x%0lx\", hr)",
          "new_text": null,
          "old_line_content": "        msg_Dbg(vd, \"Failed IDirect3DVertexBuffer9_Lock: 0x%0lx\", hr);",
          "new_line_content": "    HRESULT hr;",
          "content_same": false
        },
        {
          "line": 1839,
          "old_api": "VLC_UNUSED",
          "new_api": null,
          "old_text": "VLC_UNUSED(p_data)",
          "new_text": null,
          "old_line_content": "    VLC_UNUSED(p_data);",
          "new_line_content": "                            void *p_data)",
          "content_same": false
        },
        {
          "line": 1841,
          "old_api": "vlc_mutex_lock",
          "new_api": null,
          "old_text": "vlc_mutex_lock(&sys->lock)",
          "new_text": null,
          "old_line_content": "    vlc_mutex_lock(&sys->lock);",
          "new_line_content": "    vout_display_t *vd = (vout_display_t *)object;",
          "content_same": false
        },
        {
          "line": 1716,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(vertex, region->vertex, sizeof(region->vertex))",
          "new_text": null,
          "old_line_content": "    memcpy(vertex, region->vertex, sizeof(region->vertex));",
          "new_line_content": "    void *vertex;",
          "content_same": false
        },
        {
          "line": 1727,
          "old_api": "IDirect3DDevice9_SetTexture",
          "new_api": null,
          "old_text": "IDirect3DDevice9_SetTexture(d3ddev, 0, (LPDIRECT3DBASETEXTURE9)d3dtex)",
          "new_text": null,
          "old_line_content": "    hr = IDirect3DDevice9_SetTexture(d3ddev, 0, (LPDIRECT3DBASETEXTURE9)d3dtex);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1728,
          "old_api": "FAILED",
          "new_api": null,
          "old_text": "FAILED(hr)",
          "new_text": null,
          "old_line_content": "    if (FAILED(hr)) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1729,
          "old_api": "msg_Dbg",
          "new_api": null,
          "old_text": "msg_Dbg(vd, \"Failed IDirect3DDevice9_SetTexture: 0x%0lx\", hr)",
          "new_text": null,
          "old_line_content": "        msg_Dbg(vd, \"Failed IDirect3DDevice9_SetTexture: 0x%0lx\", hr);",
          "new_line_content": "    // Setup our texture. Using textures introduces the texture stage states,",
          "content_same": false
        },
        {
          "line": 1859,
          "old_api": "xrealloc",
          "new_api": null,
          "old_text": "xrealloc(ctx->values, (ctx->count + num_shaders + 1) * sizeof(char *))",
          "new_text": null,
          "old_line_content": "    ctx->values = xrealloc(ctx->values, (ctx->count + num_shaders + 1) * sizeof(char *));",
          "new_line_content": "    size_t count;",
          "content_same": false
        },
        {
          "line": 1860,
          "old_api": "xrealloc",
          "new_api": null,
          "old_text": "xrealloc(ctx->descs, (ctx->count + num_shaders + 1) * sizeof(char *))",
          "new_text": null,
          "old_line_content": "    ctx->descs = xrealloc(ctx->descs, (ctx->count + num_shaders + 1) * sizeof(char *));",
          "new_line_content": "} enum_context_t;",
          "content_same": false
        },
        {
          "line": 1862,
          "old_api": "strdup",
          "new_api": null,
          "old_text": "strdup(builtin_shaders[i].name)",
          "new_text": null,
          "old_line_content": "        ctx->values[ctx->count] = strdup(builtin_shaders[i].name);",
          "new_line_content": "static void ListShaders(enum_context_t *ctx)",
          "content_same": false
        },
        {
          "line": 1863,
          "old_api": "strdup",
          "new_api": null,
          "old_text": "strdup(builtin_shaders[i].name)",
          "new_text": null,
          "old_line_content": "        ctx->descs[ctx->count] = strdup(builtin_shaders[i].name);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 1736,
          "old_api": "IDirect3DDevice9_SetPixelShader",
          "new_api": null,
          "old_text": "IDirect3DDevice9_SetPixelShader(d3ddev, sys->d3dx_shader)",
          "new_text": null,
          "old_line_content": "            hr = IDirect3DDevice9_SetPixelShader(d3ddev, sys->d3dx_shader);",
          "new_line_content": "        return -1;",
          "content_same": false
        },
        {
          "line": 1738,
          "old_api": "IDirect3DDevice9_SetPixelShaderConstantF",
          "new_api": null,
          "old_text": "IDirect3DDevice9_SetPixelShaderConstantF(d3ddev, 0, shader_data, 1)",
          "new_text": null,
          "old_line_content": "            hr = IDirect3DDevice9_SetPixelShaderConstantF(d3ddev, 0, shader_data, 1);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1739,
          "old_api": "FAILED",
          "new_api": null,
          "old_text": "FAILED(hr)",
          "new_text": null,
          "old_line_content": "            if (FAILED(hr)) {",
          "new_line_content": "    if (sys->d3dx_shader) {",
          "content_same": false
        },
        {
          "line": 1740,
          "old_api": "msg_Dbg",
          "new_api": null,
          "old_text": "msg_Dbg(vd, \"Failed IDirect3DDevice9_SetPixelShaderConstantF: 0x%0lx\", hr)",
          "new_text": null,
          "old_line_content": "                msg_Dbg(vd, \"Failed IDirect3DDevice9_SetPixelShaderConstantF: 0x%0lx\", hr);",
          "new_line_content": "        if (use_pixel_shader)",
          "content_same": false
        },
        {
          "line": 1867,
          "old_api": "strdup",
          "new_api": null,
          "old_text": "strdup(SELECTED_SHADER_FILE)",
          "new_text": null,
          "old_line_content": "    ctx->descs[ctx->count] = strdup(SELECTED_SHADER_FILE);",
          "new_line_content": "    for (size_t i = 0; i < num_shaders; ++i) {",
          "content_same": false
        },
        {
          "line": 1747,
          "old_api": "msg_Dbg",
          "new_api": null,
          "old_text": "msg_Dbg(vd, \"Failed IDirect3DDevice9_SetPixelShader: 0x%0lx\", hr)",
          "new_text": null,
          "old_line_content": "            msg_Dbg(vd, \"Failed IDirect3DDevice9_SetPixelShader: 0x%0lx\", hr);",
          "new_line_content": "                return -1;",
          "content_same": false
        },
        {
          "line": 1875,
          "old_api": "VLC_UNUSED",
          "new_api": null,
          "old_text": "VLC_UNUSED(object)",
          "new_text": null,
          "old_line_content": "    VLC_UNUSED(object);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 1876,
          "old_api": "VLC_UNUSED",
          "new_api": null,
          "old_text": "VLC_UNUSED(name)",
          "new_text": null,
          "old_line_content": "    VLC_UNUSED(name);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1880,
          "old_api": "ListShaders",
          "new_api": null,
          "old_text": "ListShaders(&ctx)",
          "new_text": null,
          "old_line_content": "    ListShaders(&ctx);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 1754,
          "old_api": "FAILED",
          "new_api": null,
          "old_text": "FAILED(hr)",
          "new_text": null,
          "old_line_content": "    if (FAILED(hr)) {",
          "new_line_content": "            return -1;",
          "content_same": false
        },
        {
          "line": 1755,
          "old_api": "msg_Dbg",
          "new_api": null,
          "old_text": "msg_Dbg(vd, \"Failed IDirect3DDevice9_SetStreamSource: 0x%0lx\", hr)",
          "new_text": null,
          "old_line_content": "        msg_Dbg(vd, \"Failed IDirect3DDevice9_SetStreamSource: 0x%0lx\", hr);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 1762,
          "old_api": "msg_Dbg",
          "new_api": null,
          "old_text": "msg_Dbg(vd, \"Failed IDirect3DDevice9_SetFVF: 0x%0lx\", hr)",
          "new_text": null,
          "old_line_content": "        msg_Dbg(vd, \"Failed IDirect3DDevice9_SetFVF: 0x%0lx\", hr);",
          "new_line_content": "        return -1;",
          "content_same": false
        },
        {
          "line": 1769,
          "old_api": "msg_Dbg",
          "new_api": null,
          "old_text": "msg_Dbg(vd, \"Failed IDirect3DDevice9_DrawPrimitive: 0x%0lx\", hr)",
          "new_text": null,
          "old_line_content": "        msg_Dbg(vd, \"Failed IDirect3DDevice9_DrawPrimitive: 0x%0lx\", hr);",
          "new_line_content": "        return -1;",
          "content_same": false
        },
        {
          "line": 1654,
          "old_api": "__MIN",
          "new_api": null,
          "old_text": "__MIN(dst_pitch, r->p_picture->p->i_visible_pitch)",
          "new_text": null,
          "old_line_content": "                int copy_pitch = __MIN(dst_pitch, r->p_picture->p->i_visible_pitch);",
          "new_line_content": "                if (dst_pitch == r->p_picture->p->i_visible_pitch) {",
          "content_same": false
        },
        {
          "line": 1656,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(&dst_data[y * dst_pitch], &src_data[y * src_pitch],\n                           copy_pitch)",
          "new_text": null,
          "old_line_content": "                    memcpy(&dst_data[y * dst_pitch], &src_data[y * src_pitch],",
          "new_line_content": "                } else {",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 12,
      "total_additions": 49,
      "total_deletions": 47,
      "total_api_changes": 108
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 12,
        "api_related_lines": 108,
        "non_api_lines": 6,
        "non_api_line_numbers": [
          1664,
          1653,
          1658,
          1660,
          1661,
          1662
        ]
      }
    },
    "api_calls_before": 378,
    "api_calls_after": 380,
    "diff_info": {
      "added_lines": 11,
      "removed_lines": 5,
      "total_diff_lines": 29
    }
  }
}