{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/vlc/modified_file/083a78510ea85023f861932047d920bddb0f091d",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/vlc/modified_file/083a78510ea85023f861932047d920bddb0f091d/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/vlc/modified_file/083a78510ea85023f861932047d920bddb0f091d/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/vlc/modified_file/083a78510ea85023f861932047d920bddb0f091d/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 364,
          "old_api": "mb2_readdir",
          "new_api": "ssert",
          "old_text": "mb2_readdir(sys->smb2, sys->smb2dir))",
          "new_text": "ssert(sys->smb2dir);",
          "old_line_content": "        && (smb2dirent = smb2_readdir(sys->smb2, sys->smb2dir)) != NULL)",
          "new_line_content": "    assert(sys->smb2dir);",
          "content_same": false
        },
        {
          "line": 431,
          "old_api": "lc_smb2_mainloop",
          "new_api": "LC_SMB2_SET_ERROR",
          "old_text": "lc_smb2_mainloop(access, true);",
          "new_text": "LC_SMB2_SET_ERROR(access, \"smb2_close_async\", 1);",
          "old_line_content": "    return vlc_smb2_mainloop(access, true);",
          "new_line_content": "        VLC_SMB2_SET_ERROR(access, \"smb2_close_async\", 1);",
          "content_same": false
        },
        {
          "line": 448,
          "old_api": "lc_smb2_mainloop",
          "new_api": "mb2_disconnect_share_async",
          "old_text": "lc_smb2_mainloop(access, true);",
          "new_text": "mb2_disconnect_share_async(sys->smb2, smb2_generic_cb, access) ",
          "old_line_content": "    int ret = vlc_smb2_mainloop(access, true);",
          "new_line_content": "    if (smb2_disconnect_share_async(sys->smb2, smb2_generic_cb, access) < 0)",
          "content_same": false
        },
        {
          "line": 506,
          "old_api": "LC_SMB2_SET_ERROR",
          "new_api": "mb2_set_domain",
          "old_text": "LC_SMB2_SET_ERROR(access, \"smb2_connect_share_async\", err);",
          "new_text": "mb2_set_domain(sys->smb2, domain ? domain : \"\");",
          "old_line_content": "        VLC_SMB2_SET_ERROR(access, \"smb2_connect_share_async\", err);",
          "new_line_content": "    smb2_set_domain(sys->smb2, domain ? domain : \"\");",
          "content_same": false
        },
        {
          "line": 515,
          "old_api": "mb2_share_enum_async",
          "new_api": "lc_smb2_mainloop",
          "old_text": "mb2_share_enum_async(sys->smb2, smb2_share_enum_cb, access);",
          "new_text": "lc_smb2_mainloop(access, false) ",
          "old_line_content": "        ret = smb2_share_enum_async(sys->smb2, smb2_share_enum_cb, access);",
          "new_line_content": "    if (vlc_smb2_mainloop(access, false) != 0)",
          "content_same": false
        },
        {
          "line": 521,
          "old_api": "LC_SMB2_SET_ERROR",
          "new_api": "mb2_share_enum_async",
          "old_text": "LC_SMB2_SET_ERROR(access, \"smb2_stat_async\", 1);",
          "new_text": "mb2_share_enum_async(sys->smb2, smb2_share_enum_cb, access);",
          "old_line_content": "            VLC_SMB2_SET_ERROR(access, \"smb2_stat_async\", 1);",
          "new_line_content": "        ret = smb2_share_enum_async(sys->smb2, smb2_share_enum_cb, access);",
          "content_same": false
        },
        {
          "line": 529,
          "old_api": "mb2_open_async",
          "new_api": "lc_smb2_mainloop",
          "old_text": "mb2_open_async(sys->smb2, smb2_url->path, O_RDONLY,\n                                  smb2_open_cb, access);",
          "new_text": "lc_smb2_mainloop(access, false) ",
          "old_line_content": "            ret = smb2_open_async(sys->smb2, smb2_url->path, O_RDONLY,",
          "new_line_content": "        if (vlc_smb2_mainloop(access, false) != 0)",
          "content_same": false
        },
        {
          "line": 592,
          "old_api": "etbios_ns_destroy",
          "new_api": "etbios_ns_resolve",
          "old_text": "etbios_ns_destroy(ns);",
          "new_text": "etbios_ns_resolve(ns, host, NETBIOS_FILESERVER, &ip4_addr) ",
          "old_line_content": "    netbios_ns_destroy(ns);",
          "new_line_content": "    if (netbios_ns_resolve(ns, host, NETBIOS_FILESERVER, &ip4_addr) == 0)",
          "content_same": false
        },
        {
          "line": 619,
          "old_api": "sg_Err",
          "new_api": "lc_UrlParseFixup",
          "old_text": "sg_Err(access, \"smb2_init_context failed\");",
          "new_text": "lc_UrlParseFixup(&sys->encoded_url, access->psz_url) ",
          "old_line_content": "        msg_Err(access, \"smb2_init_context failed\");",
          "new_line_content": "    if (vlc_UrlParseFixup(&sys->encoded_url, access->psz_url) != 0)",
          "content_same": false
        },
        {
          "line": 648,
          "old_api": "mb2_parse_url",
          "new_api": "lc_uri_compose",
          "old_text": "mb2_parse_url(sys->smb2, url);",
          "new_text": "lc_uri_compose(&sys->encoded_url);",
          "old_line_content": "    smb2_url = smb2_parse_url(sys->smb2, url);",
          "new_line_content": "        url = vlc_uri_compose(&sys->encoded_url);",
          "content_same": false
        },
        {
          "line": 649,
          "old_api": "ree",
          "new_api": "lc_uri_decode",
          "old_text": "ree(url);",
          "new_text": "lc_uri_decode(url))",
          "old_line_content": "    free(url);",
          "new_line_content": "    if (!vlc_uri_decode(url))",
          "content_same": false
        },
        {
          "line": 659,
          "old_api": "lc_credential_init",
          "new_api": "sg_Err",
          "old_text": "lc_credential_init(&credential, &sys->encoded_url);",
          "new_text": "sg_Err(access, \"smb2_parse_url failed\");",
          "old_line_content": "    vlc_credential_init(&credential, &sys->encoded_url);",
          "new_line_content": "        msg_Err(access, \"smb2_parse_url failed\");",
          "content_same": false
        },
        {
          "line": 665,
          "old_api": "lc_credential_get",
          "new_api": "lc_credential_init",
          "old_text": "lc_credential_get(&credential, access, \"smb-user\", \"smb-pwd\", NULL,\n                       NULL);",
          "new_text": "lc_credential_init(&credential, &sys->encoded_url);",
          "old_line_content": "    vlc_credential_get(&credential, access, \"smb-user\", \"smb-pwd\", NULL,",
          "new_line_content": "    vlc_credential_init(&credential, &sys->encoded_url);",
          "content_same": false
        },
        {
          "line": 676,
          "old_api": "lc_smb2_open_share",
          "new_api": "LC_SMB2_STATUS_DENIED",
          "old_text": "lc_smb2_open_share(access, smb2_url, &credential);",
          "new_text": "LC_SMB2_STATUS_DENIED(sys->error_status))",
          "old_line_content": "        ret = vlc_smb2_open_share(access, smb2_url, &credential);",
          "new_line_content": "        && (!sys->error_status || VLC_SMB2_STATUS_DENIED(sys->error_status))",
          "content_same": false
        },
        {
          "line": 686,
          "old_api": "lc_dialog_display_error",
          "new_api": "lc_credential_clean",
          "old_text": "lc_dialog_display_error(access,\n                                     _(\"SMB2 operation failed\"), \"%s\", error);",
          "new_text": "lc_credential_clean(&credential);",
          "old_line_content": "            vlc_dialog_display_error(access,",
          "new_line_content": "    vlc_credential_clean(&credential);",
          "content_same": false
        },
        {
          "line": 693,
          "old_api": "ar_Create",
          "new_api": "(\"SMB2 operation failed\"),",
          "old_text": "ar_Create(access, \"smb-dialog-failed\", VLC_VAR_VOID);",
          "new_text": "(\"SMB2 operation failed\"),",
          "old_line_content": "            var_Create(access, \"smb-dialog-failed\", VLC_VAR_VOID);",
          "new_line_content": "                                     _(\"SMB2 operation failed\"), \"%s\", error);",
          "content_same": false
        },
        {
          "line": 731,
          "old_api": "lc_UrlClean",
          "new_api": "mb2_destroy_url",
          "old_text": "lc_UrlClean(&sys->encoded_url);",
          "new_text": "mb2_destroy_url(smb2_url);",
          "old_line_content": "    vlc_UrlClean(&sys->encoded_url);",
          "new_line_content": "        smb2_destroy_url(smb2_url);",
          "content_same": false
        },
        {
          "line": 756,
          "old_api": "lc_assert_unreachable",
          "new_api": "lc_smb2_close_fh",
          "old_text": "lc_assert_unreachable();",
          "new_text": "lc_smb2_close_fh(access);",
          "old_line_content": "        vlc_assert_unreachable();",
          "new_line_content": "        vlc_smb2_close_fh(access);",
          "content_same": false
        },
        {
          "line": 758,
          "old_api": "lc_smb2_disconnect_share",
          "new_api": "mb2_closedir",
          "old_text": "lc_smb2_disconnect_share(access);",
          "new_text": "mb2_closedir(sys->smb2, sys->smb2dir);",
          "old_line_content": "    vlc_smb2_disconnect_share(access);",
          "new_line_content": "        smb2_closedir(sys->smb2, sys->smb2dir);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 512,
          "old_api": null,
          "new_api": "LC_SMB2_SET_ERROR",
          "old_text": null,
          "new_text": "LC_SMB2_SET_ERROR(access, \"smb2_connect_share_async\", err);",
          "old_line_content": "",
          "new_line_content": "        VLC_SMB2_SET_ERROR(access, \"smb2_connect_share_async\", err);",
          "content_same": false
        },
        {
          "line": 525,
          "old_api": null,
          "new_api": "mb2_stat_async",
          "old_text": null,
          "new_text": "mb2_stat_async(sys->smb2, smb2_url->path, &smb2_stat,\n                            smb2_generic_cb, access) ",
          "old_line_content": "",
          "new_line_content": "        if (smb2_stat_async(sys->smb2, smb2_url->path, &smb2_stat,",
          "content_same": false
        },
        {
          "line": 527,
          "old_api": null,
          "new_api": "LC_SMB2_SET_ERROR",
          "old_text": null,
          "new_text": "LC_SMB2_SET_ERROR(access, \"smb2_stat_async\", 1);",
          "old_line_content": "        {",
          "new_line_content": "            VLC_SMB2_SET_ERROR(access, \"smb2_stat_async\", 1);",
          "content_same": false
        },
        {
          "line": 535,
          "old_api": null,
          "new_api": "mb2_open_async",
          "old_text": null,
          "new_text": "mb2_open_async(sys->smb2, smb2_url->path, O_RDONLY,\n                                  smb2_open_cb, access);",
          "old_line_content": "        else",
          "new_line_content": "            ret = smb2_open_async(sys->smb2, smb2_url->path, O_RDONLY,",
          "content_same": false
        },
        {
          "line": 539,
          "old_api": null,
          "new_api": "mb2_opendir_async",
          "old_text": null,
          "new_text": "mb2_opendir_async(sys->smb2, smb2_url->path,\n                                     smb2_opendir_cb, access);",
          "old_line_content": "            goto error;",
          "new_line_content": "            ret = smb2_opendir_async(sys->smb2, smb2_url->path,",
          "content_same": false
        },
        {
          "line": 543,
          "old_api": null,
          "new_api": "sg_Err",
          "old_text": null,
          "new_text": "sg_Err(access, \"smb2_stat_cb: file type not handled\");",
          "old_line_content": "    if (ret < 0)",
          "new_line_content": "            msg_Err(access, \"smb2_stat_cb: file type not handled\");",
          "content_same": false
        },
        {
          "line": 551,
          "old_api": null,
          "new_api": "LC_SMB2_SET_ERROR",
          "old_text": null,
          "new_text": "LC_SMB2_SET_ERROR(access, \"smb2_open*_async\", 1);",
          "old_line_content": "    return 0;",
          "new_line_content": "        VLC_SMB2_SET_ERROR(access, \"smb2_open*_async\", 1);",
          "content_same": false
        },
        {
          "line": 555,
          "old_api": null,
          "new_api": "lc_smb2_mainloop",
          "old_text": null,
          "new_text": "lc_smb2_mainloop(access, false) ",
          "old_line_content": "    return -1;",
          "new_line_content": "    if (vlc_smb2_mainloop(access, false) != 0)",
          "content_same": false
        },
        {
          "line": 560,
          "old_api": null,
          "new_api": "lc_smb2_disconnect_share",
          "old_text": null,
          "new_text": "lc_smb2_disconnect_share(access);",
          "old_line_content": "{",
          "new_line_content": "    vlc_smb2_disconnect_share(access);",
          "content_same": false
        },
        {
          "line": 574,
          "old_api": null,
          "new_api": "net_pton",
          "old_text": null,
          "new_text": "net_pton(AF_INET, host, &addr) ",
          "old_line_content": "    {",
          "new_line_content": "    if (inet_pton(AF_INET, host, &addr) == 1)",
          "content_same": false
        },
        {
          "line": 579,
          "old_api": null,
          "new_api": "lc_getaddrinfo_i11e",
          "old_text": null,
          "new_text": "lc_getaddrinfo_i11e(host, port, NULL, &info) ",
          "old_line_content": "",
          "new_line_content": "    if (vlc_getaddrinfo_i11e(host, port, NULL, &info) == 0)",
          "content_same": false
        },
        {
          "line": 581,
          "old_api": null,
          "new_api": "reeaddrinfo",
          "old_text": null,
          "new_text": "reeaddrinfo(info);",
          "old_line_content": "    char *out_host = NULL;",
          "new_line_content": "        freeaddrinfo(info);",
          "content_same": false
        },
        {
          "line": 588,
          "old_api": null,
          "new_api": "etbios_ns_new",
          "old_text": null,
          "new_text": "etbios_ns_new();",
          "old_line_content": "        char ip[] = \"xxx.xxx.xxx.xxx\";",
          "new_line_content": "    netbios_ns *ns = netbios_ns_new();",
          "content_same": false
        },
        {
          "line": 595,
          "old_api": null,
          "new_api": "net_ntop",
          "old_text": null,
          "new_text": "net_ntop(AF_INET, &ip4_addr, ip, sizeof(ip)))",
          "old_line_content": "    (void) port;",
          "new_line_content": "        if (inet_ntop(AF_INET, &ip4_addr, ip, sizeof(ip)))",
          "content_same": false
        },
        {
          "line": 596,
          "old_api": null,
          "new_api": "trdup",
          "old_text": null,
          "new_text": "trdup(ip);",
          "old_line_content": "    return NULL;",
          "new_line_content": "            out_host = strdup(ip);",
          "content_same": false
        },
        {
          "line": 598,
          "old_api": null,
          "new_api": "etbios_ns_destroy",
          "old_text": null,
          "new_text": "etbios_ns_destroy(ns);",
          "old_line_content": "}",
          "new_line_content": "    netbios_ns_destroy(ns);",
          "content_same": false
        },
        {
          "line": 610,
          "old_api": null,
          "new_api": "lc_obj_calloc",
          "old_text": null,
          "new_text": "lc_obj_calloc(p_obj, 1, sizeof (*sys));",
          "old_line_content": "    access->p_sys = sys;",
          "new_line_content": "    struct access_sys *sys = vlc_obj_calloc(p_obj, 1, sizeof (*sys));",
          "content_same": false
        },
        {
          "line": 614,
          "old_api": null,
          "new_api": "nlikely",
          "old_text": null,
          "new_text": "nlikely(sys == NULL))",
          "old_line_content": "        return VLC_ENOMEM;",
          "new_line_content": "    if (unlikely(sys == NULL))",
          "content_same": false
        },
        {
          "line": 622,
          "old_api": null,
          "new_api": "mb2_init_context",
          "old_text": null,
          "new_text": "mb2_init_context();",
          "old_line_content": "",
          "new_line_content": "    sys->smb2 = smb2_init_context();",
          "content_same": false
        },
        {
          "line": 625,
          "old_api": null,
          "new_api": "sg_Err",
          "old_text": null,
          "new_text": "sg_Err(access, \"smb2_init_context failed\");",
          "old_line_content": "    if (sys->encoded_url.psz_path == NULL)",
          "new_line_content": "        msg_Err(access, \"smb2_init_context failed\");",
          "content_same": false
        },
        {
          "line": 629,
          "old_api": null,
          "new_api": "mb2_set_security_mode",
          "old_text": null,
          "new_text": "mb2_set_security_mode(sys->smb2, SMB2_NEGOTIATE_SIGNING_ENABLED);",
          "old_line_content": "                                           sys->encoded_url.i_port);",
          "new_line_content": "    smb2_set_security_mode(sys->smb2, SMB2_NEGOTIATE_SIGNING_ENABLED);",
          "content_same": false
        },
        {
          "line": 634,
          "old_api": null,
          "new_api": "lc_smb2_resolve",
          "old_text": null,
          "new_text": "lc_smb2_resolve(access, sys->encoded_url.psz_host,\n                                           sys->encoded_url.i_port);",
          "old_line_content": "    if (resolved_host != NULL)",
          "new_line_content": "    char *resolved_host = vlc_smb2_resolve(access, sys->encoded_url.psz_host,",
          "content_same": false
        },
        {
          "line": 644,
          "old_api": null,
          "new_api": "lc_uri_compose",
          "old_text": null,
          "new_text": "lc_uri_compose(&resolved_url);",
          "old_line_content": "    {",
          "new_line_content": "        url = vlc_uri_compose(&resolved_url);",
          "content_same": false
        },
        {
          "line": 651,
          "old_api": null,
          "new_api": "ree",
          "old_text": null,
          "new_text": "ree(url);",
          "old_line_content": "    if (!smb2_url || !smb2_url->share || !smb2_url->server)",
          "new_line_content": "        free(url);",
          "content_same": false
        },
        {
          "line": 654,
          "old_api": null,
          "new_api": "mb2_parse_url",
          "old_text": null,
          "new_text": "mb2_parse_url(sys->smb2, url);",
          "old_line_content": "        goto error;",
          "new_line_content": "    smb2_url = smb2_parse_url(sys->smb2, url);",
          "content_same": false
        },
        {
          "line": 655,
          "old_api": null,
          "new_api": "ree",
          "old_text": null,
          "new_text": "ree(url);",
          "old_line_content": "    }",
          "new_line_content": "    free(url);",
          "content_same": false
        },
        {
          "line": 666,
          "old_api": null,
          "new_api": "ar_InheritString",
          "old_text": null,
          "new_text": "ar_InheritString(access, \"smb-domain\");",
          "old_line_content": "                       NULL);",
          "new_line_content": "    var_domain = var_InheritString(access, \"smb-domain\");",
          "content_same": false
        },
        {
          "line": 673,
          "old_api": null,
          "new_api": "lc_smb2_open_share",
          "old_text": null,
          "new_text": "lc_smb2_open_share(access, smb2_url, &credential);",
          "old_line_content": "                              smb2_url->server))",
          "new_line_content": "    ret = vlc_smb2_open_share(access, smb2_url, &credential);",
          "content_same": false
        },
        {
          "line": 677,
          "old_api": null,
          "new_api": "lc_credential_get",
          "old_text": null,
          "new_text": "lc_credential_get(&credential, access, \"smb-user\", \"smb-pwd\",\n                              SMB_LOGIN_DIALOG_TITLE, SMB_LOGIN_DIALOG_TEXT,\n                              smb2_url->server))",
          "old_line_content": "    }",
          "new_line_content": "        && vlc_credential_get(&credential, access, \"smb-user\", \"smb-pwd\",",
          "content_same": false
        },
        {
          "line": 682,
          "old_api": null,
          "new_api": "lc_smb2_open_share",
          "old_text": null,
          "new_text": "lc_smb2_open_share(access, smb2_url, &credential);",
          "old_line_content": "    if (ret != 0)",
          "new_line_content": "        ret = vlc_smb2_open_share(access, smb2_url, &credential);",
          "content_same": false
        },
        {
          "line": 685,
          "old_api": null,
          "new_api": "lc_credential_store",
          "old_text": null,
          "new_text": "lc_credential_store(&credential, access);",
          "old_line_content": "        if (error && *error)",
          "new_line_content": "        vlc_credential_store(&credential, access);",
          "content_same": false
        },
        {
          "line": 690,
          "old_api": null,
          "new_api": "mb2_get_error",
          "old_text": null,
          "new_text": "mb2_get_error(sys->smb2);",
          "old_line_content": "            /* Tell other smb modules (likely dsm) that we already requested",
          "new_line_content": "        const char *error = smb2_get_error(sys->smb2);",
          "content_same": false
        },
        {
          "line": 692,
          "old_api": null,
          "new_api": "lc_dialog_display_error",
          "old_text": null,
          "new_text": "lc_dialog_display_error(access,\n                                     _(\"SMB2 operation failed\"), \"%s\", error);",
          "old_line_content": "             * This avoid to show 2 login dialogs for the same access. */",
          "new_line_content": "            vlc_dialog_display_error(access,",
          "content_same": false
        },
        {
          "line": 699,
          "old_api": null,
          "new_api": "ar_Create",
          "old_text": null,
          "new_text": "ar_Create(access, \"smb-dialog-failed\", VLC_VAR_VOID);",
          "old_line_content": "    {",
          "new_line_content": "            var_Create(access, \"smb-dialog-failed\", VLC_VAR_VOID);",
          "content_same": false
        },
        {
          "line": 723,
          "old_api": null,
          "new_api": "lc_assert_unreachable",
          "old_text": null,
          "new_text": "lc_assert_unreachable();",
          "old_line_content": "error:",
          "new_line_content": "        vlc_assert_unreachable();",
          "content_same": false
        },
        {
          "line": 726,
          "old_api": null,
          "new_api": "ree",
          "old_text": null,
          "new_text": "ree(var_domain);",
          "old_line_content": "    if (sys->smb2 != NULL)",
          "new_line_content": "    free(var_domain);",
          "content_same": false
        },
        {
          "line": 734,
          "old_api": null,
          "new_api": "lc_smb2_disconnect_share",
          "old_text": null,
          "new_text": "lc_smb2_disconnect_share(access);",
          "old_line_content": "    /* Returning VLC_ETIMEOUT will stop the module probe and prevent to load",
          "new_line_content": "        vlc_smb2_disconnect_share(access);",
          "content_same": false
        },
        {
          "line": 735,
          "old_api": null,
          "new_api": "mb2_destroy_context",
          "old_text": null,
          "new_text": "mb2_destroy_context(sys->smb2);",
          "old_line_content": "     * the next smb module. The smb2 module can return this specific error in",
          "new_line_content": "        smb2_destroy_context(sys->smb2);",
          "content_same": false
        },
        {
          "line": 737,
          "old_api": null,
          "new_api": "lc_UrlClean",
          "old_text": null,
          "new_text": "lc_UrlClean(&sys->encoded_url);",
          "old_line_content": "     * (vlc_killed()). Indeed, in these cases, it is useless to try next smb",
          "new_line_content": "    vlc_UrlClean(&sys->encoded_url);",
          "content_same": false
        },
        {
          "line": 738,
          "old_api": null,
          "new_api": "ree",
          "old_text": null,
          "new_text": "ree(var_domain);",
          "old_line_content": "     * modules. */",
          "new_line_content": "    free(var_domain);",
          "content_same": false
        },
        {
          "line": 745,
          "old_api": null,
          "new_api": "lc_killed",
          "old_text": null,
          "new_text": "lc_killed() ",
          "old_line_content": "{",
          "new_line_content": "    return vlc_killed() || sys->error_status == -EIO ? VLC_ETIMEOUT",
          "content_same": false
        },
        {
          "line": 760,
          "old_api": null,
          "new_api": "mb2_free_data",
          "old_text": null,
          "new_text": "mb2_free_data(sys->smb2, sys->share_enum);",
          "old_line_content": "",
          "new_line_content": "        smb2_free_data(sys->smb2, sys->share_enum);",
          "content_same": false
        },
        {
          "line": 762,
          "old_api": null,
          "new_api": "lc_assert_unreachable",
          "old_text": null,
          "new_text": "lc_assert_unreachable();",
          "old_line_content": "}",
          "new_line_content": "        vlc_assert_unreachable();",
          "content_same": false
        },
        {
          "line": 251,
          "old_api": null,
          "new_api": "mb2_read_async",
          "old_text": null,
          "new_text": "mb2_read_async(sys->smb2, sys->smb2fh, buf, len,\n                        smb2_read_cb, access) ",
          "old_line_content": "",
          "new_line_content": "    if (smb2_read_async(sys->smb2, sys->smb2fh, buf, len,",
          "content_same": false
        },
        {
          "line": 764,
          "old_api": null,
          "new_api": "lc_smb2_disconnect_share",
          "old_text": null,
          "new_text": "lc_smb2_disconnect_share(access);",
          "old_line_content": "",
          "new_line_content": "    vlc_smb2_disconnect_share(access);",
          "content_same": false
        },
        {
          "line": 765,
          "old_api": null,
          "new_api": "mb2_destroy_context",
          "old_text": null,
          "new_text": "mb2_destroy_context(sys->smb2);",
          "old_line_content": "",
          "new_line_content": "    smb2_destroy_context(sys->smb2);",
          "content_same": false
        },
        {
          "line": 254,
          "old_api": null,
          "new_api": "LC_SMB2_SET_ERROR",
          "old_text": null,
          "new_text": "LC_SMB2_SET_ERROR(access, \"smb2_read_async\", 1);",
          "old_line_content": "",
          "new_line_content": "        VLC_SMB2_SET_ERROR(access, \"smb2_read_async\", 1);",
          "content_same": false
        },
        {
          "line": 767,
          "old_api": null,
          "new_api": "lc_UrlClean",
          "old_text": null,
          "new_text": "lc_UrlClean(&sys->encoded_url);",
          "old_line_content": "",
          "new_line_content": "    vlc_UrlClean(&sys->encoded_url);",
          "content_same": false
        },
        {
          "line": 258,
          "old_api": null,
          "new_api": "lc_smb2_mainloop",
          "old_text": null,
          "new_text": "lc_smb2_mainloop(access, false) ",
          "old_line_content": "static int",
          "new_line_content": "    if (vlc_smb2_mainloop(access, false) < 0)",
          "content_same": false
        },
        {
          "line": 272,
          "old_api": null,
          "new_api": "mb2_lseek",
          "old_text": null,
          "new_text": "mb2_lseek(sys->smb2, sys->smb2fh, i_pos, SEEK_SET, NULL) ",
          "old_line_content": "",
          "new_line_content": "    if (smb2_lseek(sys->smb2, sys->smb2fh, i_pos, SEEK_SET, NULL) < 0)",
          "content_same": false
        },
        {
          "line": 274,
          "old_api": null,
          "new_api": "LC_SMB2_SET_ERROR",
          "old_text": null,
          "new_text": "LC_SMB2_SET_ERROR(access, \"smb2_seek_async\", 1);",
          "old_line_content": "}",
          "new_line_content": "        VLC_SMB2_SET_ERROR(access, \"smb2_seek_async\", 1);",
          "content_same": false
        },
        {
          "line": 290,
          "old_api": null,
          "new_api": "a_arg",
          "old_text": null,
          "new_text": "a_arg(args, bool *) ",
          "old_line_content": "",
          "new_line_content": "            *va_arg(args, bool *) = true;",
          "content_same": false
        },
        {
          "line": 294,
          "old_api": null,
          "new_api": "a_arg",
          "old_text": null,
          "new_text": "a_arg(args, bool *) ",
          "old_line_content": "            break;",
          "new_line_content": "            *va_arg(args, bool *) = false;",
          "content_same": false
        },
        {
          "line": 299,
          "old_api": null,
          "new_api": "a_arg",
          "old_text": null,
          "new_text": "a_arg(args, bool *) ",
          "old_line_content": "            break;",
          "new_line_content": "            *va_arg(args, bool *) = true;",
          "content_same": false
        },
        {
          "line": 309,
          "old_api": null,
          "new_api": "LC_TICK_FROM_MS",
          "old_text": null,
          "new_text": "LC_TICK_FROM_MS(\n                var_InheritInteger(access, \"network-caching\"));",
          "old_line_content": "",
          "new_line_content": "            *va_arg(args, vlc_tick_t * ) = VLC_TICK_FROM_MS(",
          "content_same": false
        },
        {
          "line": 310,
          "old_api": null,
          "new_api": "ar_InheritInteger",
          "old_text": null,
          "new_text": "ar_InheritInteger(access, \"network-caching\"))",
          "old_line_content": "        default:",
          "new_line_content": "                var_InheritInteger(access, \"network-caching\"));",
          "content_same": false
        },
        {
          "line": 327,
          "old_api": null,
          "new_api": "sprintf",
          "old_text": null,
          "new_text": "sprintf(&buf, \"smb://%s%s%s%s%s%s\", url->psz_host,\n                 url->psz_path != NULL ? url->psz_path : \"\",\n                 url->psz_path != NULL && url->psz_path[0] != '\\0' &&\n                 url->psz_path[strlen(url->psz_path) - 1] != '/' ? \"/\" : \"\",\n                 file,\n                 url->psz_option != NULL ? \"?\" : \"\",\n                 url->psz_option != NULL ? url->psz_option : \"\") ",
          "old_line_content": "                 url->psz_option != NULL ? url->psz_option : \"\") == -1)",
          "new_line_content": "    if (asprintf(&buf, \"smb://%s%s%s%s%s%s\", url->psz_host,",
          "content_same": false
        },
        {
          "line": 330,
          "old_api": null,
          "new_api": "trlen",
          "old_text": null,
          "new_text": "trlen(url->psz_path) ",
          "old_line_content": "        return buf;",
          "new_line_content": "                 url->psz_path[strlen(url->psz_path) - 1] != '/' ? \"/\" : \"\",",
          "content_same": false
        },
        {
          "line": 343,
          "old_api": null,
          "new_api": "lc_uri_encode",
          "old_text": null,
          "new_text": "lc_uri_encode(name);",
          "old_line_content": "    if (url == NULL)",
          "new_line_content": "    char *name_encoded = vlc_uri_encode(name);",
          "content_same": false
        },
        {
          "line": 347,
          "old_api": null,
          "new_api": "lc_smb2_get_url",
          "old_text": null,
          "new_text": "lc_smb2_get_url(&sys->encoded_url, name_encoded);",
          "old_line_content": "                                         ITEM_NET);",
          "new_line_content": "    char *url = vlc_smb2_get_url(&sys->encoded_url, name_encoded);",
          "content_same": false
        },
        {
          "line": 352,
          "old_api": null,
          "new_api": "lc_readdir_helper_additem",
          "old_text": null,
          "new_text": "lc_readdir_helper_additem(rdh, url, NULL, name, i_type,\n                                         ITEM_NET);",
          "old_line_content": "static int",
          "new_line_content": "    int ret = vlc_readdir_helper_additem(rdh, url, NULL, name, i_type,",
          "content_same": false
        },
        {
          "line": 354,
          "old_api": null,
          "new_api": "ree",
          "old_text": null,
          "new_text": "ree(url);",
          "old_line_content": "{",
          "new_line_content": "    free(url);",
          "content_same": false
        },
        {
          "line": 367,
          "old_api": null,
          "new_api": "lc_readdir_helper_init",
          "old_text": null,
          "new_text": "lc_readdir_helper_init(&rdh, access, p_node);",
          "old_line_content": "        switch (smb2dirent->st.smb2_type)",
          "new_line_content": "    vlc_readdir_helper_init(&rdh, access, p_node);",
          "content_same": false
        },
        {
          "line": 370,
          "old_api": null,
          "new_api": "mb2_readdir",
          "old_text": null,
          "new_text": "mb2_readdir(sys->smb2, sys->smb2dir))",
          "old_line_content": "            i_type = ITEM_TYPE_FILE;",
          "new_line_content": "        && (smb2dirent = smb2_readdir(sys->smb2, sys->smb2dir)) != NULL)",
          "content_same": false
        },
        {
          "line": 385,
          "old_api": null,
          "new_api": "ddItem",
          "old_text": null,
          "new_text": "ddItem(access, &rdh, smb2dirent->name, i_type);",
          "old_line_content": "}",
          "new_line_content": "        ret = AddItem(access, &rdh, smb2dirent->name, i_type);",
          "content_same": false
        },
        {
          "line": 388,
          "old_api": null,
          "new_api": "lc_readdir_helper_finish",
          "old_text": null,
          "new_text": "lc_readdir_helper_finish(&rdh, ret == VLC_SUCCESS);",
          "old_line_content": "ShareEnum(stream_t *access, input_item_node_t *p_node)",
          "new_line_content": "    vlc_readdir_helper_finish(&rdh, ret == VLC_SUCCESS);",
          "content_same": false
        },
        {
          "line": 397,
          "old_api": null,
          "new_api": "ssert",
          "old_text": null,
          "new_text": "ssert(sys->share_enum != NULL);",
          "old_line_content": "    struct srvsvc_netsharectr *ctr = sys->share_enum->ctr;",
          "new_line_content": "    assert(sys->share_enum != NULL);",
          "content_same": false
        },
        {
          "line": 401,
          "old_api": null,
          "new_api": "lc_readdir_helper_init",
          "old_text": null,
          "new_text": "lc_readdir_helper_init(&rdh, access, p_node);",
          "old_line_content": "       struct srvsvc_netshareinfo1 *info = &ctr->ctr1.array[iinfo];",
          "new_line_content": "    vlc_readdir_helper_init(&rdh, access, p_node);",
          "content_same": false
        },
        {
          "line": 413,
          "old_api": null,
          "new_api": "ddItem",
          "old_text": null,
          "new_text": "ddItem(access, &rdh, info->name, ITEM_TYPE_DIRECTORY);",
          "old_line_content": "    return 0;",
          "new_line_content": "               ret = AddItem(access, &rdh, info->name, ITEM_TYPE_DIRECTORY);",
          "content_same": false
        },
        {
          "line": 418,
          "old_api": null,
          "new_api": "lc_readdir_helper_finish",
          "old_text": null,
          "new_text": "lc_readdir_helper_finish(&rdh, ret == VLC_SUCCESS);",
          "old_line_content": "{",
          "new_line_content": "    vlc_readdir_helper_finish(&rdh, ret == VLC_SUCCESS);",
          "content_same": false
        },
        {
          "line": 427,
          "old_api": null,
          "new_api": "ssert",
          "old_text": null,
          "new_text": "ssert(sys->smb2fh);",
          "old_line_content": "    }",
          "new_line_content": "    assert(sys->smb2fh);",
          "content_same": false
        },
        {
          "line": 429,
          "old_api": null,
          "new_api": "mb2_close_async",
          "old_text": null,
          "new_text": "mb2_close_async(sys->smb2, sys->smb2fh, smb2_generic_cb, access) ",
          "old_line_content": "    sys->smb2fh = NULL;",
          "new_line_content": "    if (smb2_close_async(sys->smb2, sys->smb2fh, smb2_generic_cb, access) < 0)",
          "content_same": false
        },
        {
          "line": 437,
          "old_api": null,
          "new_api": "lc_smb2_mainloop",
          "old_text": null,
          "new_text": "lc_smb2_mainloop(access, true);",
          "old_line_content": "    struct access_sys *sys = access->p_sys;",
          "new_line_content": "    return vlc_smb2_mainloop(access, true);",
          "content_same": false
        },
        {
          "line": 450,
          "old_api": null,
          "new_api": "LC_SMB2_SET_ERROR",
          "old_text": null,
          "new_text": "LC_SMB2_SET_ERROR(access, \"smb2_connect_share_async\", 1);",
          "old_line_content": "    return ret;",
          "new_line_content": "        VLC_SMB2_SET_ERROR(access, \"smb2_connect_share_async\", 1);",
          "content_same": false
        },
        {
          "line": 454,
          "old_api": null,
          "new_api": "lc_smb2_mainloop",
          "old_text": null,
          "new_text": "lc_smb2_mainloop(access, true);",
          "old_line_content": "smb2_opendir_cb(struct smb2_context *smb2, int status, void *data,",
          "new_line_content": "    int ret = vlc_smb2_mainloop(access, true);",
          "content_same": false
        },
        {
          "line": 463,
          "old_api": null,
          "new_api": "LC_SMB2_GENERIC_CB",
          "old_text": null,
          "new_text": "LC_SMB2_GENERIC_CB();",
          "old_line_content": "smb2_open_cb(struct smb2_context *smb2, int status, void *data,",
          "new_line_content": "    VLC_SMB2_GENERIC_CB();",
          "content_same": false
        },
        {
          "line": 472,
          "old_api": null,
          "new_api": "LC_SMB2_GENERIC_CB",
          "old_text": null,
          "new_text": "LC_SMB2_GENERIC_CB();",
          "old_line_content": "smb2_share_enum_cb(struct smb2_context *smb2, int status, void *data,",
          "new_line_content": "    VLC_SMB2_GENERIC_CB();",
          "content_same": false
        },
        {
          "line": 481,
          "old_api": null,
          "new_api": "LC_SMB2_GENERIC_CB",
          "old_text": null,
          "new_text": "LC_SMB2_GENERIC_CB();",
          "old_line_content": "vlc_smb2_open_share(stream_t *access, const struct smb2_url *smb2_url,",
          "new_line_content": "    VLC_SMB2_GENERIC_CB();",
          "content_same": false
        },
        {
          "line": 505,
          "old_api": null,
          "new_api": "mb2_set_password",
          "old_text": null,
          "new_text": "mb2_set_password(sys->smb2, password);",
          "old_line_content": "    {",
          "new_line_content": "    smb2_set_password(sys->smb2, password);",
          "content_same": false
        },
        {
          "line": 508,
          "old_api": null,
          "new_api": "mb2_connect_share_async",
          "old_text": null,
          "new_text": "mb2_connect_share_async(sys->smb2, smb2_url->server, share,\n                                       username, smb2_generic_cb, access);",
          "old_line_content": "    }",
          "new_line_content": "    int err = smb2_connect_share_async(sys->smb2, smb2_url->server, share,",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 519,
          "old_api": "mb2_stat_async",
          "new_api": null,
          "old_text": "mb2_stat_async(sys->smb2, smb2_url->path, &smb2_stat,\n                            smb2_generic_cb, access) ",
          "new_text": null,
          "old_line_content": "        if (smb2_stat_async(sys->smb2, smb2_url->path, &smb2_stat,",
          "new_line_content": "    int ret;",
          "content_same": false
        },
        {
          "line": 523,
          "old_api": "lc_smb2_mainloop",
          "new_api": null,
          "old_text": "lc_smb2_mainloop(access, false) ",
          "new_text": null,
          "old_line_content": "        if (vlc_smb2_mainloop(access, false) != 0)",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 533,
          "old_api": "mb2_opendir_async",
          "new_api": null,
          "old_text": "mb2_opendir_async(sys->smb2, smb2_url->path,\n                                     smb2_opendir_cb, access);",
          "new_text": null,
          "old_line_content": "            ret = smb2_opendir_async(sys->smb2, smb2_url->path,",
          "new_line_content": "        {",
          "content_same": false
        },
        {
          "line": 537,
          "old_api": "sg_Err",
          "new_api": null,
          "old_text": "sg_Err(access, \"smb2_stat_cb: file type not handled\");",
          "new_text": null,
          "old_line_content": "            msg_Err(access, \"smb2_stat_cb: file type not handled\");",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 545,
          "old_api": "LC_SMB2_SET_ERROR",
          "new_api": null,
          "old_text": "LC_SMB2_SET_ERROR(access, \"smb2_open*_async\", 1);",
          "new_text": null,
          "old_line_content": "        VLC_SMB2_SET_ERROR(access, \"smb2_open*_async\", 1);",
          "new_line_content": "            goto error;",
          "content_same": false
        },
        {
          "line": 549,
          "old_api": "lc_smb2_mainloop",
          "new_api": null,
          "old_text": "lc_smb2_mainloop(access, false) ",
          "new_text": null,
          "old_line_content": "    if (vlc_smb2_mainloop(access, false) != 0)",
          "new_line_content": "    if (ret < 0)",
          "content_same": false
        },
        {
          "line": 554,
          "old_api": "lc_smb2_disconnect_share",
          "new_api": null,
          "old_text": "lc_smb2_disconnect_share(access);",
          "new_text": null,
          "old_line_content": "    vlc_smb2_disconnect_share(access);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 568,
          "old_api": "net_pton",
          "new_api": null,
          "old_text": "net_pton(AF_INET, host, &addr) ",
          "new_text": null,
          "old_line_content": "    if (inet_pton(AF_INET, host, &addr) == 1)",
          "new_line_content": "    if (!host)",
          "content_same": false
        },
        {
          "line": 573,
          "old_api": "lc_getaddrinfo_i11e",
          "new_api": null,
          "old_text": "lc_getaddrinfo_i11e(host, port, NULL, &info) ",
          "new_text": null,
          "old_line_content": "    if (vlc_getaddrinfo_i11e(host, port, NULL, &info) == 0)",
          "new_line_content": "    struct in_addr addr;",
          "content_same": false
        },
        {
          "line": 575,
          "old_api": "reeaddrinfo",
          "new_api": null,
          "old_text": "reeaddrinfo(info);",
          "new_text": null,
          "old_line_content": "        freeaddrinfo(info);",
          "new_line_content": "        return NULL;",
          "content_same": false
        },
        {
          "line": 582,
          "old_api": "etbios_ns_new",
          "new_api": null,
          "old_text": "etbios_ns_new();",
          "new_text": null,
          "old_line_content": "    netbios_ns *ns = netbios_ns_new();",
          "new_line_content": "        /* Let smb2 resolve it */",
          "content_same": false
        },
        {
          "line": 586,
          "old_api": "etbios_ns_resolve",
          "new_api": null,
          "old_text": "etbios_ns_resolve(ns, host, NETBIOS_FILESERVER, &ip4_addr) ",
          "new_text": null,
          "old_line_content": "    if (netbios_ns_resolve(ns, host, NETBIOS_FILESERVER, &ip4_addr) == 0)",
          "new_line_content": "    /* Test if the host is a netbios name */",
          "content_same": false
        },
        {
          "line": 589,
          "old_api": "net_ntop",
          "new_api": null,
          "old_text": "net_ntop(AF_INET, &ip4_addr, ip, sizeof(ip)))",
          "new_text": null,
          "old_line_content": "        if (inet_ntop(AF_INET, &ip4_addr, ip, sizeof(ip)))",
          "new_line_content": "    if (!ns)",
          "content_same": false
        },
        {
          "line": 590,
          "old_api": "trdup",
          "new_api": null,
          "old_text": "trdup(ip);",
          "new_text": null,
          "old_line_content": "            out_host = strdup(ip);",
          "new_line_content": "        return NULL;",
          "content_same": false
        },
        {
          "line": 604,
          "old_api": "lc_obj_calloc",
          "new_api": null,
          "old_text": "lc_obj_calloc(p_obj, 1, sizeof (*sys));",
          "new_text": null,
          "old_line_content": "    struct access_sys *sys = vlc_obj_calloc(p_obj, 1, sizeof (*sys));",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 608,
          "old_api": "nlikely",
          "new_api": null,
          "old_text": "nlikely(sys == NULL))",
          "new_text": null,
          "old_line_content": "    if (unlikely(sys == NULL))",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 613,
          "old_api": "lc_UrlParseFixup",
          "new_api": null,
          "old_text": "lc_UrlParseFixup(&sys->encoded_url, access->psz_url) ",
          "new_text": null,
          "old_line_content": "    if (vlc_UrlParseFixup(&sys->encoded_url, access->psz_url) != 0)",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 616,
          "old_api": "mb2_init_context",
          "new_api": null,
          "old_text": "mb2_init_context();",
          "new_text": null,
          "old_line_content": "    sys->smb2 = smb2_init_context();",
          "new_line_content": "    access->p_sys = sys;",
          "content_same": false
        },
        {
          "line": 623,
          "old_api": "mb2_set_security_mode",
          "new_api": null,
          "old_text": "mb2_set_security_mode(sys->smb2, SMB2_NEGOTIATE_SIGNING_ENABLED);",
          "new_text": null,
          "old_line_content": "    smb2_set_security_mode(sys->smb2, SMB2_NEGOTIATE_SIGNING_ENABLED);",
          "new_line_content": "    if (sys->smb2 == NULL)",
          "content_same": false
        },
        {
          "line": 628,
          "old_api": "lc_smb2_resolve",
          "new_api": null,
          "old_text": "lc_smb2_resolve(access, sys->encoded_url.psz_host,\n                                           sys->encoded_url.i_port);",
          "new_text": null,
          "old_line_content": "    char *resolved_host = vlc_smb2_resolve(access, sys->encoded_url.psz_host,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 638,
          "old_api": "lc_uri_compose",
          "new_api": null,
          "old_text": "lc_uri_compose(&resolved_url);",
          "new_text": null,
          "old_line_content": "        url = vlc_uri_compose(&resolved_url);",
          "new_line_content": "     * modified sys->encoded_url (with the resolved host). */",
          "content_same": false
        },
        {
          "line": 639,
          "old_api": "ree",
          "new_api": null,
          "old_text": "ree(resolved_host);",
          "new_text": null,
          "old_line_content": "        free(resolved_host);",
          "new_line_content": "    char *url;",
          "content_same": false
        },
        {
          "line": 642,
          "old_api": "lc_uri_compose",
          "new_api": null,
          "old_text": "lc_uri_compose(&sys->encoded_url);",
          "new_text": null,
          "old_line_content": "        url = vlc_uri_compose(&sys->encoded_url);",
          "new_line_content": "        vlc_url_t resolved_url = sys->encoded_url;",
          "content_same": false
        },
        {
          "line": 643,
          "old_api": "lc_uri_decode",
          "new_api": null,
          "old_text": "lc_uri_decode(url))",
          "new_text": null,
          "old_line_content": "    if (!vlc_uri_decode(url))",
          "new_line_content": "        resolved_url.psz_host = resolved_host;",
          "content_same": false
        },
        {
          "line": 653,
          "old_api": "sg_Err",
          "new_api": null,
          "old_text": "sg_Err(access, \"smb2_parse_url failed\");",
          "new_text": null,
          "old_line_content": "        msg_Err(access, \"smb2_parse_url failed\");",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 660,
          "old_api": "ar_InheritString",
          "new_api": null,
          "old_text": "ar_InheritString(access, \"smb-domain\");",
          "new_text": null,
          "old_line_content": "    var_domain = var_InheritString(access, \"smb-domain\");",
          "new_line_content": "        goto error;",
          "content_same": false
        },
        {
          "line": 667,
          "old_api": "lc_smb2_open_share",
          "new_api": null,
          "old_text": "lc_smb2_open_share(access, smb2_url, &credential);",
          "new_text": null,
          "old_line_content": "    ret = vlc_smb2_open_share(access, smb2_url, &credential);",
          "new_line_content": "    credential.psz_realm = var_domain;",
          "content_same": false
        },
        {
          "line": 670,
          "old_api": "LC_SMB2_STATUS_DENIED",
          "new_api": null,
          "old_text": "LC_SMB2_STATUS_DENIED(sys->error_status))",
          "new_text": null,
          "old_line_content": "        && (!sys->error_status || VLC_SMB2_STATUS_DENIED(sys->error_status))",
          "new_line_content": "     * keystore/user interaction) */",
          "content_same": false
        },
        {
          "line": 679,
          "old_api": "lc_credential_store",
          "new_api": null,
          "old_text": "lc_credential_store(&credential, access);",
          "new_text": null,
          "old_line_content": "        vlc_credential_store(&credential, access);",
          "new_line_content": "                              smb2_url->server))",
          "content_same": false
        },
        {
          "line": 680,
          "old_api": "lc_credential_clean",
          "new_api": null,
          "old_text": "lc_credential_clean(&credential);",
          "new_text": null,
          "old_line_content": "    vlc_credential_clean(&credential);",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 684,
          "old_api": "mb2_get_error",
          "new_api": null,
          "old_text": "mb2_get_error(sys->smb2);",
          "new_text": null,
          "old_line_content": "        const char *error = smb2_get_error(sys->smb2);",
          "new_line_content": "    if (ret == 0)",
          "content_same": false
        },
        {
          "line": 687,
          "old_api": "(\"SMB2 operation failed\"),",
          "new_api": null,
          "old_text": "(\"SMB2 operation failed\"),",
          "new_text": null,
          "old_line_content": "                                     _(\"SMB2 operation failed\"), \"%s\", error);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 717,
          "old_api": "lc_assert_unreachable",
          "new_api": null,
          "old_text": "lc_assert_unreachable();",
          "new_text": null,
          "old_line_content": "        vlc_assert_unreachable();",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 719,
          "old_api": "mb2_destroy_url",
          "new_api": null,
          "old_text": "mb2_destroy_url(smb2_url);",
          "new_text": null,
          "old_line_content": "    smb2_destroy_url(smb2_url);",
          "new_line_content": "        access->pf_seek = NULL;",
          "content_same": false
        },
        {
          "line": 720,
          "old_api": "ree",
          "new_api": null,
          "old_text": "ree(var_domain);",
          "new_text": null,
          "old_line_content": "    free(var_domain);",
          "new_line_content": "        access->pf_control = access_vaDirectoryControlHelper;",
          "content_same": false
        },
        {
          "line": 728,
          "old_api": "lc_smb2_disconnect_share",
          "new_api": null,
          "old_text": "lc_smb2_disconnect_share(access);",
          "new_text": null,
          "old_line_content": "        vlc_smb2_disconnect_share(access);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 729,
          "old_api": "mb2_destroy_context",
          "new_api": null,
          "old_text": "mb2_destroy_context(sys->smb2);",
          "new_text": null,
          "old_line_content": "        smb2_destroy_context(sys->smb2);",
          "new_line_content": "error:",
          "content_same": false
        },
        {
          "line": 732,
          "old_api": "ree",
          "new_api": null,
          "old_text": "ree(var_domain);",
          "new_text": null,
          "old_line_content": "    free(var_domain);",
          "new_line_content": "    if (sys->smb2 != NULL)",
          "content_same": false
        },
        {
          "line": 739,
          "old_api": "lc_killed",
          "new_api": null,
          "old_text": "lc_killed() ",
          "new_text": null,
          "old_line_content": "    return vlc_killed() || sys->error_status == -EIO ? VLC_ETIMEOUT",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 750,
          "old_api": "lc_smb2_close_fh",
          "new_api": null,
          "old_text": "lc_smb2_close_fh(access);",
          "new_text": null,
          "old_line_content": "        vlc_smb2_close_fh(access);",
          "new_line_content": "Close(vlc_object_t *p_obj)",
          "content_same": false
        },
        {
          "line": 752,
          "old_api": "mb2_closedir",
          "new_api": null,
          "old_text": "mb2_closedir(sys->smb2, sys->smb2dir);",
          "new_text": null,
          "old_line_content": "        smb2_closedir(sys->smb2, sys->smb2dir);",
          "new_line_content": "    stream_t *access = (stream_t *)p_obj;",
          "content_same": false
        },
        {
          "line": 754,
          "old_api": "mb2_free_data",
          "new_api": null,
          "old_text": "mb2_free_data(sys->smb2, sys->share_enum);",
          "new_text": null,
          "old_line_content": "        smb2_free_data(sys->smb2, sys->share_enum);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 245,
          "old_api": "mb2_read_async",
          "new_api": null,
          "old_text": "mb2_read_async(sys->smb2, sys->smb2fh, buf, len,\n                        smb2_read_cb, access) ",
          "new_text": null,
          "old_line_content": "    if (smb2_read_async(sys->smb2, sys->smb2fh, buf, len,",
          "new_line_content": "     * reading the whole requested data and not when whatever data is available",
          "content_same": false
        },
        {
          "line": 759,
          "old_api": "mb2_destroy_context",
          "new_api": null,
          "old_text": "mb2_destroy_context(sys->smb2);",
          "new_text": null,
          "old_line_content": "    smb2_destroy_context(sys->smb2);",
          "new_line_content": "    else if (sys->share_enum != NULL)",
          "content_same": false
        },
        {
          "line": 248,
          "old_api": "LC_SMB2_SET_ERROR",
          "new_api": null,
          "old_text": "LC_SMB2_SET_ERROR(access, \"smb2_read_async\", 1);",
          "new_text": null,
          "old_line_content": "        VLC_SMB2_SET_ERROR(access, \"smb2_read_async\", 1);",
          "new_line_content": "        len = 262144;",
          "content_same": false
        },
        {
          "line": 761,
          "old_api": "lc_UrlClean",
          "new_api": null,
          "old_text": "lc_UrlClean(&sys->encoded_url);",
          "new_text": null,
          "old_line_content": "    vlc_UrlClean(&sys->encoded_url);",
          "new_line_content": "    else",
          "content_same": false
        },
        {
          "line": 252,
          "old_api": "lc_smb2_mainloop",
          "new_api": null,
          "old_text": "lc_smb2_mainloop(access, false) ",
          "new_text": null,
          "old_line_content": "    if (vlc_smb2_mainloop(access, false) < 0)",
          "new_line_content": "                        smb2_read_cb, access) < 0)",
          "content_same": false
        },
        {
          "line": 266,
          "old_api": "mb2_lseek",
          "new_api": null,
          "old_text": "mb2_lseek(sys->smb2, sys->smb2fh, i_pos, SEEK_SET, NULL) ",
          "new_text": null,
          "old_line_content": "    if (smb2_lseek(sys->smb2, sys->smb2fh, i_pos, SEEK_SET, NULL) < 0)",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 268,
          "old_api": "LC_SMB2_SET_ERROR",
          "new_api": null,
          "old_text": "LC_SMB2_SET_ERROR(access, \"smb2_seek_async\", 1);",
          "new_text": null,
          "old_line_content": "        VLC_SMB2_SET_ERROR(access, \"smb2_seek_async\", 1);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 284,
          "old_api": "a_arg",
          "new_api": null,
          "old_text": "a_arg(args, bool *) ",
          "new_text": null,
          "old_line_content": "            *va_arg(args, bool *) = true;",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 288,
          "old_api": "a_arg",
          "new_api": null,
          "old_text": "a_arg(args, bool *) ",
          "new_text": null,
          "old_line_content": "            *va_arg(args, bool *) = false;",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 293,
          "old_api": "a_arg",
          "new_api": null,
          "old_text": "a_arg(args, bool *) ",
          "new_text": null,
          "old_line_content": "            *va_arg(args, bool *) = true;",
          "new_line_content": "        case STREAM_CAN_FASTSEEK:",
          "content_same": false
        },
        {
          "line": 303,
          "old_api": "LC_TICK_FROM_MS",
          "new_api": null,
          "old_text": "LC_TICK_FROM_MS(\n                var_InheritInteger(access, \"network-caching\"));",
          "new_text": null,
          "old_line_content": "            *va_arg(args, vlc_tick_t * ) = VLC_TICK_FROM_MS(",
          "new_line_content": "        {",
          "content_same": false
        },
        {
          "line": 304,
          "old_api": "ar_InheritInteger",
          "new_api": null,
          "old_text": "ar_InheritInteger(access, \"network-caching\"))",
          "new_text": null,
          "old_line_content": "                var_InheritInteger(access, \"network-caching\"));",
          "new_line_content": "            *va_arg(args, uint64_t *) = sys->smb2_size;",
          "content_same": false
        },
        {
          "line": 321,
          "old_api": "sprintf",
          "new_api": null,
          "old_text": "sprintf(&buf, \"smb://%s%s%s%s%s%s\", url->psz_host,\n                 url->psz_path != NULL ? url->psz_path : \"\",\n                 url->psz_path != NULL && url->psz_path[0] != '\\0' &&\n                 url->psz_path[strlen(url->psz_path) - 1] != '/' ? \"/\" : \"\",\n                 file,\n                 url->psz_option != NULL ? \"?\" : \"\",\n                 url->psz_option != NULL ? url->psz_option : \"\") ",
          "new_text": null,
          "old_line_content": "    if (asprintf(&buf, \"smb://%s%s%s%s%s%s\", url->psz_host,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 324,
          "old_api": "trlen",
          "new_api": null,
          "old_text": "trlen(url->psz_path) ",
          "new_text": null,
          "old_line_content": "                 url->psz_path[strlen(url->psz_path) - 1] != '/' ? \"/\" : \"\",",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 337,
          "old_api": "lc_uri_encode",
          "new_api": null,
          "old_text": "lc_uri_encode(name);",
          "new_text": null,
          "old_line_content": "    char *name_encoded = vlc_uri_encode(name);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 341,
          "old_api": "lc_smb2_get_url",
          "new_api": null,
          "old_text": "lc_smb2_get_url(&sys->encoded_url, name_encoded);",
          "new_text": null,
          "old_line_content": "    char *url = vlc_smb2_get_url(&sys->encoded_url, name_encoded);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 342,
          "old_api": "ree",
          "new_api": null,
          "old_text": "ree(name_encoded);",
          "new_text": null,
          "old_line_content": "    free(name_encoded);",
          "new_line_content": "    struct access_sys *sys = access->p_sys;",
          "content_same": false
        },
        {
          "line": 346,
          "old_api": "lc_readdir_helper_additem",
          "new_api": null,
          "old_text": "lc_readdir_helper_additem(rdh, url, NULL, name, i_type,\n                                         ITEM_NET);",
          "new_text": null,
          "old_line_content": "    int ret = vlc_readdir_helper_additem(rdh, url, NULL, name, i_type,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 358,
          "old_api": "ssert",
          "new_api": null,
          "old_text": "ssert(sys->smb2dir);",
          "new_text": null,
          "old_line_content": "    assert(sys->smb2dir);",
          "new_line_content": "static int",
          "content_same": false
        },
        {
          "line": 361,
          "old_api": "lc_readdir_helper_init",
          "new_api": null,
          "old_text": "lc_readdir_helper_init(&rdh, access, p_node);",
          "new_text": null,
          "old_line_content": "    vlc_readdir_helper_init(&rdh, access, p_node);",
          "new_line_content": "    struct access_sys *sys = access->p_sys;",
          "content_same": false
        },
        {
          "line": 379,
          "old_api": "ddItem",
          "new_api": null,
          "old_text": "ddItem(access, &rdh, smb2dirent->name, i_type);",
          "new_text": null,
          "old_line_content": "        ret = AddItem(access, &rdh, smb2dirent->name, i_type);",
          "new_line_content": "            i_type = ITEM_TYPE_DIRECTORY;",
          "content_same": false
        },
        {
          "line": 382,
          "old_api": "lc_readdir_helper_finish",
          "new_api": null,
          "old_text": "lc_readdir_helper_finish(&rdh, ret == VLC_SUCCESS);",
          "new_text": null,
          "old_line_content": "    vlc_readdir_helper_finish(&rdh, ret == VLC_SUCCESS);",
          "new_line_content": "            i_type = ITEM_TYPE_UNKNOWN;",
          "content_same": false
        },
        {
          "line": 391,
          "old_api": "ssert",
          "new_api": null,
          "old_text": "ssert(sys->share_enum != NULL);",
          "new_text": null,
          "old_line_content": "    assert(sys->share_enum != NULL);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 395,
          "old_api": "lc_readdir_helper_init",
          "new_api": null,
          "old_text": "lc_readdir_helper_init(&rdh, access, p_node);",
          "new_text": null,
          "old_line_content": "    vlc_readdir_helper_init(&rdh, access, p_node);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 407,
          "old_api": "ddItem",
          "new_api": null,
          "old_text": "ddItem(access, &rdh, info->name, ITEM_TYPE_DIRECTORY);",
          "new_text": null,
          "old_line_content": "               ret = AddItem(access, &rdh, info->name, ITEM_TYPE_DIRECTORY);",
          "new_line_content": "       struct srvsvc_netshareinfo1 *info = &ctr->ctr1.array[iinfo];",
          "content_same": false
        },
        {
          "line": 412,
          "old_api": "lc_readdir_helper_finish",
          "new_api": null,
          "old_text": "lc_readdir_helper_finish(&rdh, ret == VLC_SUCCESS);",
          "new_text": null,
          "old_line_content": "    vlc_readdir_helper_finish(&rdh, ret == VLC_SUCCESS);",
          "new_line_content": "           case SHARE_TYPE_DISKTREE:",
          "content_same": false
        },
        {
          "line": 421,
          "old_api": "ssert",
          "new_api": null,
          "old_text": "ssert(sys->smb2fh);",
          "new_text": null,
          "old_line_content": "    assert(sys->smb2fh);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 423,
          "old_api": "mb2_close_async",
          "new_api": null,
          "old_text": "mb2_close_async(sys->smb2, sys->smb2fh, smb2_generic_cb, access) ",
          "new_text": null,
          "old_line_content": "    if (smb2_close_async(sys->smb2, sys->smb2fh, smb2_generic_cb, access) < 0)",
          "new_line_content": "vlc_smb2_close_fh(stream_t *access)",
          "content_same": false
        },
        {
          "line": 425,
          "old_api": "LC_SMB2_SET_ERROR",
          "new_api": null,
          "old_text": "LC_SMB2_SET_ERROR(access, \"smb2_close_async\", 1);",
          "new_text": null,
          "old_line_content": "        VLC_SMB2_SET_ERROR(access, \"smb2_close_async\", 1);",
          "new_line_content": "    struct access_sys *sys = access->p_sys;",
          "content_same": false
        },
        {
          "line": 442,
          "old_api": "mb2_disconnect_share_async",
          "new_api": null,
          "old_text": "mb2_disconnect_share_async(sys->smb2, smb2_generic_cb, access) ",
          "new_text": null,
          "old_line_content": "    if (smb2_disconnect_share_async(sys->smb2, smb2_generic_cb, access) < 0)",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 444,
          "old_api": "LC_SMB2_SET_ERROR",
          "new_api": null,
          "old_text": "LC_SMB2_SET_ERROR(access, \"smb2_connect_share_async\", 1);",
          "new_text": null,
          "old_line_content": "        VLC_SMB2_SET_ERROR(access, \"smb2_connect_share_async\", 1);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 457,
          "old_api": "LC_SMB2_GENERIC_CB",
          "new_api": null,
          "old_text": "LC_SMB2_GENERIC_CB();",
          "new_text": null,
          "old_line_content": "    VLC_SMB2_GENERIC_CB();",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 466,
          "old_api": "LC_SMB2_GENERIC_CB",
          "new_api": null,
          "old_text": "LC_SMB2_GENERIC_CB();",
          "new_text": null,
          "old_line_content": "    VLC_SMB2_GENERIC_CB();",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 475,
          "old_api": "LC_SMB2_GENERIC_CB",
          "new_api": null,
          "old_text": "LC_SMB2_GENERIC_CB();",
          "new_text": null,
          "old_line_content": "    VLC_SMB2_GENERIC_CB();",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 499,
          "old_api": "mb2_set_password",
          "new_api": null,
          "old_text": "mb2_set_password(sys->smb2, password);",
          "new_text": null,
          "old_line_content": "    smb2_set_password(sys->smb2, password);",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 500,
          "old_api": "mb2_set_domain",
          "new_api": null,
          "old_text": "mb2_set_domain(sys->smb2, domain ? domain : \"\");",
          "new_text": null,
          "old_line_content": "    smb2_set_domain(sys->smb2, domain ? domain : \"\");",
          "new_line_content": "        username = \"Guest\";",
          "content_same": false
        },
        {
          "line": 502,
          "old_api": "mb2_connect_share_async",
          "new_api": null,
          "old_text": "mb2_connect_share_async(sys->smb2, smb2_url->server, share,\n                                       username, smb2_generic_cb, access);",
          "new_text": null,
          "old_line_content": "    int err = smb2_connect_share_async(sys->smb2, smb2_url->server, share,",
          "new_line_content": "        password = NULL;",
          "content_same": false
        },
        {
          "line": 509,
          "old_api": "lc_smb2_mainloop",
          "new_api": null,
          "old_text": "lc_smb2_mainloop(access, false) ",
          "new_text": null,
          "old_line_content": "    if (vlc_smb2_mainloop(access, false) != 0)",
          "new_line_content": "                                       username, smb2_generic_cb, access);",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 19,
      "total_additions": 80,
      "total_deletions": 80,
      "total_api_changes": 179
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 6,
        "api_related_lines": 179,
        "non_api_lines": 4,
        "non_api_line_numbers": [
          249,
          244,
          246,
          247
        ]
      }
    },
    "api_calls_before": 134,
    "api_calls_after": 134,
    "diff_info": {
      "added_lines": 6,
      "removed_lines": 0,
      "total_diff_lines": 18
    }
  }
}