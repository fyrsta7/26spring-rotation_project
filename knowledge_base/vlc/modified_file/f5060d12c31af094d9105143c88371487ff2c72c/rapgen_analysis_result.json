{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/vlc/modified_file/f5060d12c31af094d9105143c88371487ff2c72c",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/vlc/modified_file/f5060d12c31af094d9105143c88371487ff2c72c/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/vlc/modified_file/f5060d12c31af094d9105143c88371487ff2c72c/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/vlc/modified_file/f5060d12c31af094d9105143c88371487ff2c72c/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 599,
          "old_api": "mdate",
          "new_api": "decoder_GetDisplayDate",
          "old_text": "mdate()",
          "new_text": "decoder_GetDisplayDate( p_dec, p_sys->i_pts )",
          "old_line_content": "                p_sys->i_late_frames_start = mdate();",
          "new_line_content": "            i_display_date = decoder_GetDisplayDate( p_dec, p_sys->i_pts );",
          "content_same": false
        },
        {
          "line": 629,
          "old_api": "ffmpeg_CopyPicture",
          "new_api": "block_Release",
          "old_text": "ffmpeg_CopyPicture( p_dec, p_pic, p_sys->p_ff_pic )",
          "new_text": "block_Release( p_block )",
          "old_line_content": "            ffmpeg_CopyPicture( p_dec, p_pic, p_sys->p_ff_pic );",
          "new_line_content": "                block_Release( p_block );",
          "content_same": false
        },
        {
          "line": 745,
          "old_api": "memcpy",
          "new_api": "malloc",
          "old_text": "memcpy( &p[12], p_dec->fmt_in.p_extra, i_size )",
          "new_text": "malloc( p_sys->p_context->extradata_size )",
          "old_line_content": "        memcpy( &p[12], p_dec->fmt_in.p_extra, i_size );",
          "new_line_content": "            malloc( p_sys->p_context->extradata_size );",
          "content_same": false
        },
        {
          "line": 749,
          "old_api": "strncmp",
          "new_api": "memcpy",
          "old_text": "strncmp( (char*)&p[0x56], \"SMI \", 4 )",
          "new_text": "memcpy( &p[0],  \"SVQ3\", 4 )",
          "old_line_content": "            strncmp( (char*)&p[0x56], \"SMI \", 4 ) )",
          "new_line_content": "        memcpy( &p[0],  \"SVQ3\", 4 );",
          "content_same": false
        },
        {
          "line": 755,
          "old_api": "GetDWBE",
          "new_api": "strncmp",
          "old_text": "GetDWBE( psz )",
          "new_text": "strncmp( (char*)&p[0x56], \"SMI \", 4 )",
          "old_line_content": "                int i_size = GetDWBE( psz );",
          "new_line_content": "            strncmp( (char*)&p[0x56], \"SMI \", 4 ) )",
          "content_same": false
        },
        {
          "line": 761,
          "old_api": "strncmp",
          "new_api": "GetDWBE",
          "old_text": "strncmp( (char*)&psz[4], \"SMI \", 4 )",
          "new_text": "GetDWBE( psz )",
          "old_line_content": "                if( !strncmp( (char*)&psz[4], \"SMI \", 4 ) )",
          "new_line_content": "                int i_size = GetDWBE( psz );",
          "content_same": false
        },
        {
          "line": 905,
          "old_api": "msg_Dbg",
          "new_api": "GetVlcChroma",
          "old_text": "msg_Dbg( p_dec, \"disabling direct rendering\" )",
          "new_text": "GetVlcChroma( &p_dec->fmt_out.video, p_context->pix_fmt )",
          "old_line_content": "        msg_Dbg( p_dec, \"disabling direct rendering\" );",
          "new_line_content": "    if( GetVlcChroma( &p_dec->fmt_out.video, p_context->pix_fmt ) != VLC_SUCCESS ||",
          "content_same": false
        },
        {
          "line": 913,
          "old_api": "ffmpeg_NewPictBuf",
          "new_api": "avcodec_default_get_buffer",
          "old_text": "ffmpeg_NewPictBuf( p_dec, p_sys->p_context )",
          "new_text": "avcodec_default_get_buffer( p_context, p_ff_pic )",
          "old_line_content": "    p_pic = ffmpeg_NewPictBuf( p_dec, p_sys->p_context );",
          "new_line_content": "        return avcodec_default_get_buffer( p_context, p_ff_pic );",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 769,
          "old_api": null,
          "new_api": "memmove",
          "old_text": null,
          "new_text": "memmove( &p[0x52], psz,\n                             &p[p_sys->p_context->extradata_size] - psz )",
          "old_line_content": "            }",
          "new_line_content": "                    memmove( &p[0x52], psz,",
          "content_same": false
        },
        {
          "line": 903,
          "old_api": null,
          "new_api": "avcodec_align_dimensions",
          "old_text": null,
          "new_text": "avcodec_align_dimensions( p_sys->p_context, &i_width, &i_height )",
          "old_line_content": "        p_context->pix_fmt == PIX_FMT_PAL8 )",
          "new_line_content": "    avcodec_align_dimensions( p_sys->p_context, &i_width, &i_height );",
          "content_same": false
        },
        {
          "line": 521,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free( p_sys->p_buffer_orig )",
          "old_line_content": "        p_sys->p_buffer = p_sys->p_buffer_orig;",
          "new_line_content": "            free( p_sys->p_buffer_orig );",
          "content_same": false
        },
        {
          "line": 524,
          "old_api": null,
          "new_api": "malloc",
          "old_text": null,
          "new_text": "malloc( p_sys->i_buffer_orig )",
          "old_line_content": "        {",
          "new_line_content": "            p_sys->p_buffer_orig = malloc( p_sys->i_buffer_orig );",
          "content_same": false
        },
        {
          "line": 653,
          "old_api": null,
          "new_api": "av_q2d",
          "old_text": null,
          "new_text": "av_q2d(p_sys->p_context->sample_aspect_ratio)",
          "old_line_content": "",
          "new_line_content": "                    * ( av_q2d(p_sys->p_context->sample_aspect_ratio)",
          "content_same": false
        },
        {
          "line": 1038,
          "old_api": null,
          "new_api": "INT64_C",
          "old_text": null,
          "new_text": "INT64_C(1000000)",
          "old_line_content": "    {",
          "new_line_content": "        p_sys->i_pts += INT64_C(1000000) *",
          "content_same": false
        },
        {
          "line": 782,
          "old_api": null,
          "new_api": "malloc",
          "old_text": null,
          "new_text": "malloc( i_size + FF_INPUT_BUFFER_PADDING_SIZE )",
          "old_line_content": "                    0, FF_INPUT_BUFFER_PADDING_SIZE );",
          "new_line_content": "            malloc( i_size + FF_INPUT_BUFFER_PADDING_SIZE );",
          "content_same": false
        },
        {
          "line": 908,
          "old_api": null,
          "new_api": "PAD",
          "old_text": null,
          "new_text": "PAD(p_sys->p_context->height,16)",
          "old_line_content": "    }",
          "new_line_content": "        PAD(p_sys->p_context->width,16) < i_width || PAD(p_sys->p_context->height,16) < i_height ||",
          "content_same": false
        },
        {
          "line": 785,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy( p_sys->p_context->extradata,\n                    p_dec->fmt_in.p_extra, i_size )",
          "old_line_content": "}",
          "new_line_content": "            memcpy( p_sys->p_context->extradata,",
          "content_same": false
        },
        {
          "line": 530,
          "old_api": null,
          "new_api": "block_Release",
          "old_text": null,
          "new_text": "block_Release( p_block )",
          "old_line_content": "                FF_INPUT_BUFFER_PADDING_SIZE );",
          "new_line_content": "            block_Release( p_block );",
          "content_same": false
        },
        {
          "line": 787,
          "old_api": null,
          "new_api": "memset",
          "old_text": null,
          "new_text": "memset( &((uint8_t*)p_sys->p_context->extradata)[i_size],\n                    0, FF_INPUT_BUFFER_PADDING_SIZE )",
          "old_line_content": "/*****************************************************************************",
          "new_line_content": "            memset( &((uint8_t*)p_sys->p_context->extradata)[i_size],",
          "content_same": false
        },
        {
          "line": 911,
          "old_api": null,
          "new_api": "msg_Dbg",
          "old_text": null,
          "new_text": "msg_Dbg( p_dec, \"disabling direct rendering\" )",
          "old_line_content": "    /* Get a new picture */",
          "new_line_content": "        msg_Dbg( p_dec, \"disabling direct rendering\" );",
          "content_same": false
        },
        {
          "line": 533,
          "old_api": null,
          "new_api": "vlc_memcpy",
          "old_text": null,
          "new_text": "vlc_memcpy( p_sys->p_buffer, p_block->p_buffer, p_block->i_buffer )",
          "old_line_content": "    }",
          "new_line_content": "        vlc_memcpy( p_sys->p_buffer, p_block->p_buffer, p_block->i_buffer );",
          "content_same": false
        },
        {
          "line": 534,
          "old_api": null,
          "new_api": "memset",
          "old_text": null,
          "new_text": "memset( p_sys->p_buffer + p_block->i_buffer, 0,\n                FF_INPUT_BUFFER_PADDING_SIZE )",
          "old_line_content": "",
          "new_line_content": "        memset( p_sys->p_buffer + p_block->i_buffer, 0,",
          "content_same": false
        },
        {
          "line": 1045,
          "old_api": null,
          "new_api": "INT64_C",
          "old_text": null,
          "new_text": "INT64_C(1000000)",
          "old_line_content": "",
          "new_line_content": "        p_sys->i_pts += INT64_C(1000000) *",
          "content_same": false
        },
        {
          "line": 895,
          "old_api": null,
          "new_api": "avcodec_default_get_buffer",
          "old_text": null,
          "new_text": "avcodec_default_get_buffer( p_context, p_ff_pic )",
          "old_line_content": "    int i_width = p_sys->p_context->width;",
          "new_line_content": "        return avcodec_default_get_buffer( p_context, p_ff_pic );",
          "content_same": false
        },
        {
          "line": 919,
          "old_api": null,
          "new_api": "ffmpeg_NewPictBuf",
          "old_text": null,
          "new_text": "ffmpeg_NewPictBuf( p_dec, p_sys->p_context )",
          "old_line_content": "    p_sys->p_context->draw_horiz_band = NULL;",
          "new_line_content": "    p_pic = ffmpeg_NewPictBuf( p_dec, p_sys->p_context );",
          "content_same": false
        },
        {
          "line": 923,
          "old_api": null,
          "new_api": "avcodec_default_get_buffer",
          "old_text": null,
          "new_text": "avcodec_default_get_buffer( p_context, p_ff_pic )",
          "old_line_content": "    p_ff_pic->data[0] = p_pic->p[0].p_pixels;",
          "new_line_content": "        return avcodec_default_get_buffer( p_context, p_ff_pic );",
          "content_same": false
        },
        {
          "line": 1023,
          "old_api": null,
          "new_api": "decoder_UnlinkPicture",
          "old_text": null,
          "new_text": "decoder_UnlinkPicture( p_dec, p_pic )",
          "old_line_content": "    decoder_sys_t *p_sys = p_dec->p_sys;",
          "new_line_content": "        decoder_UnlinkPicture( p_dec, p_pic );",
          "content_same": false
        },
        {
          "line": 672,
          "old_api": null,
          "new_api": "ffmpeg_NextPts",
          "old_text": null,
          "new_text": "ffmpeg_NextPts( p_dec )",
          "old_line_content": "                p_pic->b_force = true;",
          "new_line_content": "            ffmpeg_NextPts( p_dec );",
          "content_same": false
        },
        {
          "line": 545,
          "old_api": null,
          "new_api": "avcodec_decode_video",
          "old_text": null,
          "new_text": "avcodec_decode_video( p_sys->p_context, p_sys->p_ff_pic,\n                                       &b_gotpicture,\n                                       p_sys->i_buffer <= 0 && p_sys->b_flush ? NULL : (uint8_t*)p_sys->p_buffer, p_sys->i_buffer )",
          "old_line_content": "            p_sys->p_context->height > 0 &&",
          "new_line_content": "        i_used = avcodec_decode_video( p_sys->p_context, p_sys->p_ff_pic,",
          "content_same": false
        },
        {
          "line": 806,
          "old_api": null,
          "new_api": "msg_Warn",
          "old_text": null,
          "new_text": "msg_Warn( p_dec, \"waiting for extra data for codec %s\",\n                      p_sys->psz_namecodec )",
          "old_line_content": "    p_sys->p_context->height = p_dec->fmt_in.video.i_height;",
          "new_line_content": "            msg_Warn( p_dec, \"waiting for extra data for codec %s\",",
          "content_same": false
        },
        {
          "line": 557,
          "old_api": null,
          "new_api": "avcodec_decode_video",
          "old_text": null,
          "new_text": "avcodec_decode_video( p_sys->p_context, p_sys->p_ff_pic,\n                                           &b_gotpicture,\n                                           (uint8_t*)p_sys->p_buffer, p_sys->i_buffer )",
          "old_line_content": "        if( p_sys->b_flush )",
          "new_line_content": "            i_used = avcodec_decode_video( p_sys->p_context, p_sys->p_ff_pic,",
          "content_same": false
        },
        {
          "line": 941,
          "old_api": null,
          "new_api": "decoder_LinkPicture",
          "old_text": null,
          "new_text": "decoder_LinkPicture( p_dec, p_pic )",
          "old_line_content": "    return 0;",
          "new_line_content": "        decoder_LinkPicture( p_dec, p_pic );",
          "content_same": false
        },
        {
          "line": 687,
          "old_api": null,
          "new_api": "malloc",
          "old_text": null,
          "new_text": "malloc( p_pic->i_qstride * i_mb_h )",
          "old_line_content": "                    p_pic->i_qtype = QTYPE_MPEG1;",
          "new_line_content": "            p_pic->p_q = malloc( p_pic->i_qstride * i_mb_h );",
          "content_same": false
        },
        {
          "line": 688,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy( p_pic->p_q, p_sys->p_ff_pic->qscale_table,\n                    p_pic->i_qstride * i_mb_h )",
          "old_line_content": "                    break;",
          "new_line_content": "            memcpy( p_pic->p_q, p_sys->p_ff_pic->qscale_table,",
          "content_same": false
        },
        {
          "line": 820,
          "old_api": null,
          "new_api": "vlc_avcodec_lock",
          "old_text": null,
          "new_text": "vlc_avcodec_lock()",
          "old_line_content": "",
          "new_line_content": "    vlc_avcodec_lock();",
          "content_same": false
        },
        {
          "line": 821,
          "old_api": null,
          "new_api": "avcodec_open",
          "old_text": null,
          "new_text": "avcodec_open( p_sys->p_context, p_sys->p_codec )",
          "old_line_content": "    p_sys->b_delayed_open = false;",
          "new_line_content": "    ret = avcodec_open( p_sys->p_context, p_sys->p_codec );",
          "content_same": false
        },
        {
          "line": 822,
          "old_api": null,
          "new_api": "vlc_avcodec_unlock",
          "old_text": null,
          "new_text": "vlc_avcodec_unlock()",
          "old_line_content": "",
          "new_line_content": "    vlc_avcodec_unlock();",
          "content_same": false
        },
        {
          "line": 825,
          "old_api": null,
          "new_api": "msg_Dbg",
          "old_text": null,
          "new_text": "msg_Dbg( p_dec, \"ffmpeg codec (%s) started\", p_sys->psz_namecodec )",
          "old_line_content": "/*****************************************************************************",
          "new_line_content": "    msg_Dbg( p_dec, \"ffmpeg codec (%s) started\", p_sys->psz_namecodec );",
          "content_same": false
        },
        {
          "line": 571,
          "old_api": null,
          "new_api": "msg_Warn",
          "old_text": null,
          "new_text": "msg_Warn( p_dec, \"cannot decode one frame (%d bytes)\",\n                          p_sys->i_buffer )",
          "old_line_content": "        {",
          "new_line_content": "                msg_Warn( p_dec, \"cannot decode one frame (%d bytes)\",",
          "content_same": false
        },
        {
          "line": 573,
          "old_api": null,
          "new_api": "block_Release",
          "old_text": null,
          "new_text": "block_Release( p_block )",
          "old_line_content": "        }",
          "new_line_content": "            block_Release( p_block );",
          "content_same": false
        },
        {
          "line": 958,
          "old_api": null,
          "new_api": "avcodec_default_reget_buffer",
          "old_text": null,
          "new_text": "avcodec_default_reget_buffer( p_context, p_ff_pic )",
          "old_line_content": "",
          "new_line_content": "    i_ret = avcodec_default_reget_buffer( p_context, p_ff_pic );",
          "content_same": false
        },
        {
          "line": 707,
          "old_api": null,
          "new_api": "decoder_DeletePicture",
          "old_text": null,
          "new_text": "decoder_DeletePicture( p_dec, p_pic )",
          "old_line_content": "}",
          "new_line_content": "            decoder_DeletePicture( p_dec, p_pic );",
          "content_same": false
        },
        {
          "line": 963,
          "old_api": null,
          "new_api": "ffmpeg_SetFrameBufferPts",
          "old_text": null,
          "new_text": "ffmpeg_SetFrameBufferPts( p_dec, p_ff_pic )",
          "old_line_content": "{",
          "new_line_content": "        ffmpeg_SetFrameBufferPts( p_dec, p_ff_pic );",
          "content_same": false
        },
        {
          "line": 711,
          "old_api": null,
          "new_api": "block_Release",
          "old_text": null,
          "new_text": "block_Release( p_block )",
          "old_line_content": " *****************************************************************************",
          "new_line_content": "    block_Release( p_block );",
          "content_same": false
        },
        {
          "line": 840,
          "old_api": null,
          "new_api": "TestFfmpegChroma",
          "old_text": null,
          "new_text": "TestFfmpegChroma( p_sys->p_context->pix_fmt, -1 )",
          "old_line_content": "        for( i_plane = 0; i_plane < p_pic->i_planes; i_plane++ )",
          "new_line_content": "    if( TestFfmpegChroma( p_sys->p_context->pix_fmt, -1 ) == VLC_SUCCESS )",
          "content_same": false
        },
        {
          "line": 725,
          "old_api": null,
          "new_api": "av_free",
          "old_text": null,
          "new_text": "av_free( p_sys->p_ff_pic )",
          "old_line_content": " *****************************************************************************/",
          "new_line_content": "    if( p_sys->p_ff_pic ) av_free( p_sys->p_ff_pic );",
          "content_same": false
        },
        {
          "line": 726,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free( p_sys->p_buffer_orig )",
          "old_line_content": "static void ffmpeg_InitCodec( decoder_t *p_dec )",
          "new_line_content": "    free( p_sys->p_buffer_orig );",
          "content_same": false
        },
        {
          "line": 853,
          "old_api": null,
          "new_api": "__MIN",
          "old_text": null,
          "new_text": "__MIN( i_src_stride, i_dst_stride )",
          "old_line_content": "                p_dst += i_dst_stride;",
          "new_line_content": "            i_size = __MIN( i_src_stride, i_dst_stride );",
          "content_same": false
        },
        {
          "line": 601,
          "old_api": null,
          "new_api": "mdate",
          "old_text": null,
          "new_text": "mdate()",
          "old_line_content": "        else",
          "new_line_content": "        if( i_display_date > 0 && i_display_date <= mdate() )",
          "content_same": false
        },
        {
          "line": 857,
          "old_api": null,
          "new_api": "vlc_memcpy",
          "old_text": null,
          "new_text": "vlc_memcpy( p_dst, p_src, i_size )",
          "old_line_content": "    else",
          "new_line_content": "                vlc_memcpy( p_dst, p_src, i_size );",
          "content_same": false
        },
        {
          "line": 605,
          "old_api": null,
          "new_api": "mdate",
          "old_text": null,
          "new_text": "mdate()",
          "old_line_content": "",
          "new_line_content": "                p_sys->i_late_frames_start = mdate();",
          "content_same": false
        },
        {
          "line": 865,
          "old_api": null,
          "new_api": "msg_Err",
          "old_text": null,
          "new_text": "msg_Err( p_dec, \"don't know how to convert chroma %i\",\n                 p_sys->p_context->pix_fmt )",
          "old_line_content": "/*****************************************************************************",
          "new_line_content": "        msg_Err( p_dec, \"don't know how to convert chroma %i\",",
          "content_same": false
        },
        {
          "line": 503,
          "old_api": null,
          "new_api": "__MAX",
          "old_text": null,
          "new_text": "__MAX( p_sys->p_context->skip_frame,\n                                              AVDISCARD_NONREF )",
          "old_line_content": "     * Do the actual decoding now",
          "new_line_content": "        p_sys->p_context->skip_frame = __MAX( p_sys->p_context->skip_frame,",
          "content_same": false
        },
        {
          "line": 617,
          "old_api": null,
          "new_api": "decoder_DeletePicture",
          "old_text": null,
          "new_text": "decoder_DeletePicture( p_dec, p_pic )",
          "old_line_content": "        if( !p_sys->p_ff_pic->opaque )",
          "new_line_content": "                decoder_DeletePicture( p_dec, p_pic );",
          "content_same": false
        },
        {
          "line": 619,
          "old_api": null,
          "new_api": "ffmpeg_NextPts",
          "old_text": null,
          "new_text": "ffmpeg_NextPts( p_dec )",
          "old_line_content": "            /* Get a new picture */",
          "new_line_content": "            ffmpeg_NextPts( p_dec );",
          "content_same": false
        },
        {
          "line": 750,
          "old_api": null,
          "new_api": "memset",
          "old_text": null,
          "new_text": "memset( &p[4], 0, 8 )",
          "old_line_content": "        {",
          "new_line_content": "        memset( &p[4], 0, 8 );",
          "content_same": false
        },
        {
          "line": 751,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy( &p[12], p_dec->fmt_in.p_extra, i_size )",
          "old_line_content": "            uint8_t *psz = &p[0x52];",
          "new_line_content": "        memcpy( &p[12], p_dec->fmt_in.p_extra, i_size );",
          "content_same": false
        },
        {
          "line": 626,
          "old_api": null,
          "new_api": "ffmpeg_NewPictBuf",
          "old_text": null,
          "new_text": "ffmpeg_NewPictBuf( p_dec, p_sys->p_context )",
          "old_line_content": "",
          "new_line_content": "            p_pic = ffmpeg_NewPictBuf( p_dec, p_sys->p_context );",
          "content_same": false
        },
        {
          "line": 1010,
          "old_api": null,
          "new_api": "avcodec_default_release_buffer",
          "old_text": null,
          "new_text": "avcodec_default_release_buffer( p_context, p_ff_pic )",
          "old_line_content": "    p_ff_pic->data[0] = NULL;",
          "new_line_content": "        avcodec_default_release_buffer( p_context, p_ff_pic );",
          "content_same": false
        },
        {
          "line": 887,
          "old_api": null,
          "new_api": "ffmpeg_SetFrameBufferPts",
          "old_text": null,
          "new_text": "ffmpeg_SetFrameBufferPts( p_dec, p_ff_pic )",
          "old_line_content": "    if( !p_sys->b_direct_rendering )",
          "new_line_content": "    ffmpeg_SetFrameBufferPts( p_dec, p_ff_pic );",
          "content_same": false
        },
        {
          "line": 635,
          "old_api": null,
          "new_api": "ffmpeg_CopyPicture",
          "old_text": null,
          "new_text": "ffmpeg_CopyPicture( p_dec, p_pic, p_sys->p_ff_pic )",
          "old_line_content": "",
          "new_line_content": "            ffmpeg_CopyPicture( p_dec, p_pic, p_sys->p_ff_pic );",
          "content_same": false
        },
        {
          "line": 767,
          "old_api": null,
          "new_api": "strncmp",
          "old_text": null,
          "new_text": "strncmp( (char*)&psz[4], \"SMI \", 4 )",
          "old_line_content": "",
          "new_line_content": "                if( !strncmp( (char*)&psz[4], \"SMI \", 4 ) )",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 897,
          "old_api": "avcodec_align_dimensions",
          "new_api": null,
          "old_text": "avcodec_align_dimensions( p_sys->p_context, &i_width, &i_height )",
          "new_text": null,
          "old_line_content": "    avcodec_align_dimensions( p_sys->p_context, &i_width, &i_height );",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 899,
          "old_api": "GetVlcChroma",
          "new_api": null,
          "old_text": "GetVlcChroma( &p_dec->fmt_out.video, p_context->pix_fmt )",
          "new_text": null,
          "old_line_content": "    if( GetVlcChroma( &p_dec->fmt_out.video, p_context->pix_fmt ) != VLC_SUCCESS ||",
          "new_line_content": "     * so we need to check for direct rendering again. */",
          "content_same": false
        },
        {
          "line": 516,
          "old_api": "free",
          "new_api": null,
          "old_text": "free( p_sys->p_buffer_orig )",
          "new_text": null,
          "old_line_content": "            free( p_sys->p_buffer_orig );",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 902,
          "old_api": "PAD",
          "new_api": null,
          "old_text": "PAD(p_sys->p_context->height,16)",
          "new_text": null,
          "old_line_content": "        PAD(p_sys->p_context->width,16) < i_width || PAD(p_sys->p_context->height,16) < i_height ||",
          "new_line_content": "    int i_height = p_sys->p_context->height;",
          "content_same": false
        },
        {
          "line": 519,
          "old_api": "malloc",
          "new_api": null,
          "old_text": "malloc( p_sys->i_buffer_orig )",
          "new_text": null,
          "old_line_content": "            p_sys->p_buffer_orig = malloc( p_sys->i_buffer_orig );",
          "new_line_content": "            p_sys->i_buffer_orig )",
          "content_same": false
        },
        {
          "line": 1032,
          "old_api": "INT64_C",
          "new_api": null,
          "old_text": "INT64_C(1000000)",
          "new_text": null,
          "old_line_content": "        p_sys->i_pts += INT64_C(1000000) *",
          "new_line_content": "        return;",
          "content_same": false
        },
        {
          "line": 647,
          "old_api": "av_q2d",
          "new_api": null,
          "old_text": "av_q2d(p_sys->p_context->sample_aspect_ratio)",
          "new_text": null,
          "old_line_content": "                    * ( av_q2d(p_sys->p_context->sample_aspect_ratio)",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 776,
          "old_api": "malloc",
          "new_api": null,
          "old_text": "malloc( i_size + FF_INPUT_BUFFER_PADDING_SIZE )",
          "new_text": null,
          "old_line_content": "            malloc( i_size + FF_INPUT_BUFFER_PADDING_SIZE );",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 779,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy( p_sys->p_context->extradata,\n                    p_dec->fmt_in.p_extra, i_size )",
          "new_text": null,
          "old_line_content": "            memcpy( p_sys->p_context->extradata,",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 907,
          "old_api": "avcodec_default_get_buffer",
          "new_api": null,
          "old_text": "avcodec_default_get_buffer( p_context, p_ff_pic )",
          "new_text": null,
          "old_line_content": "        return avcodec_default_get_buffer( p_context, p_ff_pic );",
          "new_line_content": "        /* We only pad picture up to 16 */",
          "content_same": false
        },
        {
          "line": 525,
          "old_api": "block_Release",
          "new_api": null,
          "old_text": "block_Release( p_block )",
          "new_text": null,
          "old_line_content": "            block_Release( p_block );",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 781,
          "old_api": "memset",
          "new_api": null,
          "old_text": "memset( &((uint8_t*)p_sys->p_context->extradata)[i_size],\n                    0, FF_INPUT_BUFFER_PADDING_SIZE )",
          "new_text": null,
          "old_line_content": "            memset( &((uint8_t*)p_sys->p_context->extradata)[i_size],",
          "new_line_content": "        p_sys->p_context->extradata =",
          "content_same": false
        },
        {
          "line": 1039,
          "old_api": "INT64_C",
          "new_api": null,
          "old_text": "INT64_C(1000000)",
          "new_text": null,
          "old_line_content": "        p_sys->i_pts += INT64_C(1000000) *",
          "new_line_content": "            (2 + p_sys->p_ff_pic->repeat_pict) *",
          "content_same": false
        },
        {
          "line": 528,
          "old_api": "vlc_memcpy",
          "new_api": null,
          "old_text": "vlc_memcpy( p_sys->p_buffer, p_block->p_buffer, p_block->i_buffer )",
          "new_text": null,
          "old_line_content": "        vlc_memcpy( p_sys->p_buffer, p_block->p_buffer, p_block->i_buffer );",
          "new_line_content": "        if( !p_sys->p_buffer )",
          "content_same": false
        },
        {
          "line": 529,
          "old_api": "memset",
          "new_api": null,
          "old_text": "memset( p_sys->p_buffer + p_block->i_buffer, 0,\n                FF_INPUT_BUFFER_PADDING_SIZE )",
          "new_text": null,
          "old_line_content": "        memset( p_sys->p_buffer + p_block->i_buffer, 0,",
          "new_line_content": "        {",
          "content_same": false
        },
        {
          "line": 917,
          "old_api": "avcodec_default_get_buffer",
          "new_api": null,
          "old_text": "avcodec_default_get_buffer( p_context, p_ff_pic )",
          "new_text": null,
          "old_line_content": "        return avcodec_default_get_buffer( p_context, p_ff_pic );",
          "new_line_content": "    /* Get a new picture */",
          "content_same": false
        },
        {
          "line": 666,
          "old_api": "ffmpeg_NextPts",
          "new_api": null,
          "old_text": "ffmpeg_NextPts( p_dec )",
          "new_text": null,
          "old_line_content": "            ffmpeg_NextPts( p_dec );",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 540,
          "old_api": "avcodec_decode_video",
          "new_api": null,
          "old_text": "avcodec_decode_video( p_sys->p_context, p_sys->p_ff_pic,\n                                       &b_gotpicture,\n                                       p_sys->i_buffer <= 0 && p_sys->b_flush ? NULL : (uint8_t*)p_sys->p_buffer, p_sys->i_buffer )",
          "new_text": null,
          "old_line_content": "        i_used = avcodec_decode_video( p_sys->p_context, p_sys->p_ff_pic,",
          "new_line_content": "    while( p_sys->i_buffer > 0 || p_sys->b_flush )",
          "content_same": false
        },
        {
          "line": 800,
          "old_api": "msg_Warn",
          "new_api": null,
          "old_text": "msg_Warn( p_dec, \"waiting for extra data for codec %s\",\n                      p_sys->psz_namecodec )",
          "new_text": null,
          "old_line_content": "            msg_Warn( p_dec, \"waiting for extra data for codec %s\",",
          "new_line_content": "    if( p_sys->p_context->extradata_size <= 0 )",
          "content_same": false
        },
        {
          "line": 935,
          "old_api": "decoder_LinkPicture",
          "new_api": null,
          "old_text": "decoder_LinkPicture( p_dec, p_pic )",
          "new_text": null,
          "old_line_content": "        decoder_LinkPicture( p_dec, p_pic );",
          "new_line_content": "    p_ff_pic->linesize[1] = p_pic->p[1].i_pitch;",
          "content_same": false
        },
        {
          "line": 552,
          "old_api": "avcodec_decode_video",
          "new_api": null,
          "old_text": "avcodec_decode_video( p_sys->p_context, p_sys->p_ff_pic,\n                                           &b_gotpicture,\n                                           (uint8_t*)p_sys->p_buffer, p_sys->i_buffer )",
          "new_text": null,
          "old_line_content": "            i_used = avcodec_decode_video( p_sys->p_context, p_sys->p_ff_pic,",
          "new_line_content": "        {",
          "content_same": false
        },
        {
          "line": 681,
          "old_api": "malloc",
          "new_api": null,
          "old_text": "malloc( p_pic->i_qstride * i_mb_h )",
          "new_text": null,
          "old_line_content": "            p_pic->p_q = malloc( p_pic->i_qstride * i_mb_h );",
          "new_line_content": "            p_pic->i_nb_fields = 2 + p_sys->p_ff_pic->repeat_pict;",
          "content_same": false
        },
        {
          "line": 682,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy( p_pic->p_q, p_sys->p_ff_pic->qscale_table,\n                    p_pic->i_qstride * i_mb_h )",
          "new_text": null,
          "old_line_content": "            memcpy( p_pic->p_q, p_sys->p_ff_pic->qscale_table,",
          "new_line_content": "            p_pic->b_progressive = !p_sys->p_ff_pic->interlaced_frame;",
          "content_same": false
        },
        {
          "line": 814,
          "old_api": "vlc_avcodec_lock",
          "new_api": null,
          "old_text": "vlc_avcodec_lock()",
          "new_text": null,
          "old_line_content": "    vlc_avcodec_lock();",
          "new_line_content": "    p_sys->p_context->bits_per_sample = p_dec->fmt_in.video.i_bits_per_pixel;",
          "content_same": false
        },
        {
          "line": 815,
          "old_api": "avcodec_open",
          "new_api": null,
          "old_text": "avcodec_open( p_sys->p_context, p_sys->p_codec )",
          "new_text": null,
          "old_line_content": "    ret = avcodec_open( p_sys->p_context, p_sys->p_codec );",
          "new_line_content": "#else",
          "content_same": false
        },
        {
          "line": 816,
          "old_api": "vlc_avcodec_unlock",
          "new_api": null,
          "old_text": "vlc_avcodec_unlock()",
          "new_text": null,
          "old_line_content": "    vlc_avcodec_unlock();",
          "new_line_content": "    p_sys->p_context->bits_per_coded_sample = p_dec->fmt_in.video.i_bits_per_pixel;",
          "content_same": false
        },
        {
          "line": 819,
          "old_api": "msg_Dbg",
          "new_api": null,
          "old_text": "msg_Dbg( p_dec, \"ffmpeg codec (%s) started\", p_sys->psz_namecodec )",
          "new_text": null,
          "old_line_content": "    msg_Dbg( p_dec, \"ffmpeg codec (%s) started\", p_sys->psz_namecodec );",
          "new_line_content": "    int ret;",
          "content_same": false
        },
        {
          "line": 565,
          "old_api": "msg_Warn",
          "new_api": null,
          "old_text": "msg_Warn( p_dec, \"cannot decode one frame (%d bytes)\",\n                      p_sys->i_buffer )",
          "new_text": null,
          "old_line_content": "            msg_Warn( p_dec, \"cannot decode one frame (%d bytes)\",",
          "new_line_content": "        if( p_sys->i_buffer <= 0 )",
          "content_same": false
        },
        {
          "line": 567,
          "old_api": "block_Release",
          "new_api": null,
          "old_text": "block_Release( p_block )",
          "new_text": null,
          "old_line_content": "            block_Release( p_block );",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 952,
          "old_api": "avcodec_default_reget_buffer",
          "new_api": null,
          "old_text": "avcodec_default_reget_buffer( p_context, p_ff_pic )",
          "new_text": null,
          "old_line_content": "    i_ret = avcodec_default_reget_buffer( p_context, p_ff_pic );",
          "new_line_content": "    int i_ret;",
          "content_same": false
        },
        {
          "line": 701,
          "old_api": "decoder_DeletePicture",
          "new_api": null,
          "old_text": "decoder_DeletePicture( p_dec, p_pic )",
          "new_text": null,
          "old_line_content": "            decoder_DeletePicture( p_dec, p_pic );",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 957,
          "old_api": "ffmpeg_SetFrameBufferPts",
          "new_api": null,
          "old_text": "ffmpeg_SetFrameBufferPts( p_dec, p_ff_pic )",
          "new_text": null,
          "old_line_content": "        ffmpeg_SetFrameBufferPts( p_dec, p_ff_pic );",
          "new_line_content": "    /* We always use default reget function, it works perfectly fine */",
          "content_same": false
        },
        {
          "line": 705,
          "old_api": "block_Release",
          "new_api": null,
          "old_text": "block_Release( p_block )",
          "new_text": null,
          "old_line_content": "    block_Release( p_block );",
          "new_line_content": "        else",
          "content_same": false
        },
        {
          "line": 834,
          "old_api": "TestFfmpegChroma",
          "new_api": null,
          "old_text": "TestFfmpegChroma( p_sys->p_context->pix_fmt, -1 )",
          "new_text": null,
          "old_line_content": "    if( TestFfmpegChroma( p_sys->p_context->pix_fmt, -1 ) == VLC_SUCCESS )",
          "new_line_content": " *****************************************************************************/",
          "content_same": false
        },
        {
          "line": 719,
          "old_api": "av_free",
          "new_api": null,
          "old_text": "av_free( p_sys->p_ff_pic )",
          "new_text": null,
          "old_line_content": "    if( p_sys->p_ff_pic ) av_free( p_sys->p_ff_pic );",
          "new_line_content": " * initialization.",
          "content_same": false
        },
        {
          "line": 720,
          "old_api": "free",
          "new_api": null,
          "old_text": "free( p_sys->p_buffer_orig )",
          "new_text": null,
          "old_line_content": "    free( p_sys->p_buffer_orig );",
          "new_line_content": " *****************************************************************************/",
          "content_same": false
        },
        {
          "line": 593,
          "old_api": "decoder_GetDisplayDate",
          "new_api": null,
          "old_text": "decoder_GetDisplayDate( p_dec, p_sys->i_pts )",
          "new_text": null,
          "old_line_content": "            i_display_date = decoder_GetDisplayDate( p_dec, p_sys->i_pts );",
          "new_line_content": "        if( p_sys->p_ff_pic->pts )",
          "content_same": false
        },
        {
          "line": 847,
          "old_api": "__MIN",
          "new_api": null,
          "old_text": "__MIN( i_src_stride, i_dst_stride )",
          "new_text": null,
          "old_line_content": "            i_size = __MIN( i_src_stride, i_dst_stride );",
          "new_line_content": "        {",
          "content_same": false
        },
        {
          "line": 595,
          "old_api": "mdate",
          "new_api": null,
          "old_text": "mdate()",
          "new_text": null,
          "old_line_content": "        if( i_display_date > 0 && i_display_date <= mdate() )",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 851,
          "old_api": "vlc_memcpy",
          "new_api": null,
          "old_text": "vlc_memcpy( p_dst, p_src, i_size )",
          "new_text": null,
          "old_line_content": "                vlc_memcpy( p_dst, p_src, i_size );",
          "new_line_content": "            i_dst_stride = p_pic->p[i_plane].i_pitch;",
          "content_same": false
        },
        {
          "line": 859,
          "old_api": "msg_Err",
          "new_api": null,
          "old_text": "msg_Err( p_dec, \"don't know how to convert chroma %i\",\n                 p_sys->p_context->pix_fmt )",
          "new_text": null,
          "old_line_content": "        msg_Err( p_dec, \"don't know how to convert chroma %i\",",
          "new_line_content": "                p_dst += i_dst_stride;",
          "content_same": false
        },
        {
          "line": 611,
          "old_api": "decoder_DeletePicture",
          "new_api": null,
          "old_text": "decoder_DeletePicture( p_dec, p_pic )",
          "new_text": null,
          "old_line_content": "                decoder_DeletePicture( p_dec, p_pic );",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 739,
          "old_api": "malloc",
          "new_api": null,
          "old_text": "malloc( p_sys->p_context->extradata_size )",
          "new_text": null,
          "old_line_content": "            malloc( p_sys->p_context->extradata_size );",
          "new_line_content": "    if( p_sys->i_codec_id == CODEC_ID_SVQ3 )",
          "content_same": false
        },
        {
          "line": 613,
          "old_api": "ffmpeg_NextPts",
          "new_api": null,
          "old_text": "ffmpeg_NextPts( p_dec )",
          "new_text": null,
          "old_line_content": "            ffmpeg_NextPts( p_dec );",
          "new_line_content": "        {",
          "content_same": false
        },
        {
          "line": 743,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy( &p[0],  \"SVQ3\", 4 )",
          "new_text": null,
          "old_line_content": "        memcpy( &p[0],  \"SVQ3\", 4 );",
          "new_line_content": "        p_sys->p_context->extradata_size = i_size + 12;",
          "content_same": false
        },
        {
          "line": 744,
          "old_api": "memset",
          "new_api": null,
          "old_text": "memset( &p[4], 0, 8 )",
          "new_text": null,
          "old_line_content": "        memset( &p[4], 0, 8 );",
          "new_line_content": "        p = p_sys->p_context->extradata  =",
          "content_same": false
        },
        {
          "line": 620,
          "old_api": "ffmpeg_NewPictBuf",
          "new_api": null,
          "old_text": "ffmpeg_NewPictBuf( p_dec, p_sys->p_context )",
          "new_text": null,
          "old_line_content": "            p_pic = ffmpeg_NewPictBuf( p_dec, p_sys->p_context );",
          "new_line_content": "            continue;",
          "content_same": false
        },
        {
          "line": 1004,
          "old_api": "avcodec_default_release_buffer",
          "new_api": null,
          "old_text": "avcodec_default_release_buffer( p_context, p_ff_pic )",
          "new_text": null,
          "old_line_content": "        avcodec_default_release_buffer( p_context, p_ff_pic );",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 623,
          "old_api": "block_Release",
          "new_api": null,
          "old_text": "block_Release( p_block )",
          "new_text": null,
          "old_line_content": "                block_Release( p_block );",
          "new_line_content": "        if( !p_sys->p_ff_pic->opaque )",
          "content_same": false
        },
        {
          "line": 881,
          "old_api": "ffmpeg_SetFrameBufferPts",
          "new_api": null,
          "old_text": "ffmpeg_SetFrameBufferPts( p_dec, p_ff_pic )",
          "new_text": null,
          "old_line_content": "    ffmpeg_SetFrameBufferPts( p_dec, p_ff_pic );",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 889,
          "old_api": "avcodec_default_get_buffer",
          "new_api": null,
          "old_text": "avcodec_default_get_buffer( p_context, p_ff_pic )",
          "new_text": null,
          "old_line_content": "        return avcodec_default_get_buffer( p_context, p_ff_pic );",
          "new_line_content": "    /* */",
          "content_same": false
        },
        {
          "line": 763,
          "old_api": "memmove",
          "new_api": null,
          "old_text": "memmove( &p[0x52], psz,\n                             &p[p_sys->p_context->extradata_size] - psz )",
          "new_text": null,
          "old_line_content": "                    memmove( &p[0x52], psz,",
          "new_line_content": "                {",
          "content_same": false
        },
        {
          "line": 1017,
          "old_api": "decoder_UnlinkPicture",
          "new_api": null,
          "old_text": "decoder_UnlinkPicture( p_dec, p_pic )",
          "new_text": null,
          "old_line_content": "        decoder_UnlinkPicture( p_dec, p_pic );",
          "new_line_content": "    p_ff_pic->data[1] = NULL;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 8,
      "total_additions": 54,
      "total_deletions": 53,
      "total_api_changes": 115
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 10,
        "api_related_lines": 115,
        "non_api_lines": 7,
        "non_api_line_numbers": [
          501,
          502,
          566,
          504,
          505,
          570,
          572
        ]
      }
    },
    "api_calls_before": 111,
    "api_calls_after": 112,
    "diff_info": {
      "added_lines": 8,
      "removed_lines": 2,
      "total_diff_lines": 29
    }
  }
}