{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/e76ad9492e0992f9a6d821240bea2b62f27a03c8",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/e76ad9492e0992f9a6d821240bea2b62f27a03c8/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/e76ad9492e0992f9a6d821240bea2b62f27a03c8/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/e76ad9492e0992f9a6d821240bea2b62f27a03c8/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": true,
    "api_changes": {
      "replacements": [
        {
          "line": 5137,
          "old_api": "auto range =",
          "new_api": "auto start_po",
          "old_text": "      auto range = ",
          "new_text": "      auto start_po",
          "old_line_content": null,
          "new_line_content": "            for (; i < text_block.positions.size() - 1 && match_index.value() > text_block.positions[i + 1].start_offset; ++i)",
          "content_same": true
        },
        {
          "line": 5140,
          "old_api": "tch_start_posi",
          "new_api": "atch_end_position =",
          "old_text": "tch_start_posi",
          "new_text": "atch_end_position =",
          "old_line_content": "            auto range = create_range();",
          "new_line_content": "            auto start_position = match_index.value() - match_start_position->start_offset;",
          "content_same": false
        },
        {
          "line": 5150,
          "old_api": "append",
          "new_api": "value",
          "old_text": "    matches.append(range);\n          ",
          "new_text": "fset = match_index.value() + query.bytes_as_string_view().length() + 1;\n ",
          "old_line_content": "            auto end_position = match_index.value() + query.bytes_as_string_view().length() - match_end_position->start_offset;",
          "new_line_content": "            matches.append(Range::create(start_dom_node, start_position, end_dom_node, end_position));",
          "content_same": false
        },
        {
          "line": 5153,
          "old_api": "length",
          "new_api": "ow-declarative-shadow-roots\nbool Doc",
          "old_text": "ew().length() + 1;\n  ",
          "new_text": "ow-declarative-shadow-roots\nbool Doc",
          "old_line_content": "            matches.append(range);",
          "new_line_content": "            if (offset >= text.bytes_as_string_view().length())",
          "content_same": false
        },
        {
          "line": 5200,
          "old_api": "tive_shadow_roots",
          "new_api": "parse_html_from_a_string",
          "old_text": "tive_shadow_roots(true);\n\n    // 4. Parse HTML",
          "new_text": "HTML.\n    document->parse_html_from_a_string(html)",
          "old_line_content": "    document->set_content_type(\"text/html\"_string);",
          "new_line_content": "    document->set_allow_declarative_shadow_roots(true);",
          "content_same": false
        },
        {
          "line": 5203,
          "old_api": "parse_html_from_a_string",
          "new_api": "",
          "old_text": "HTML.\n    document->parse_html_from_a_string(html)",
          "new_text": "",
          "old_line_content": "    document->set_allow_declarative_shadow_roots(true);",
          "new_line_content": "    document->parse_html_from_a_string(html);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 5152,
          "old_api": null,
          "new_api": "return matches;\n}\n\n// https://d",
          "old_text": null,
          "new_text": "\n\n    return matches;\n}\n\n// https://d",
          "old_line_content": "",
          "new_line_content": "            offset = match_index.value() + query.bytes_as_string_view().length() + 1;",
          "content_same": false
        },
        {
          "line": 5186,
          "old_api": null,
          "new_api": "ument> Document::parse_html_",
          "old_text": null,
          "new_text": "ument> Document::parse_html_",
          "old_line_content": "",
          "new_line_content": "    parser->run(\"about:blank\"sv);",
          "content_same": false
        },
        {
          "line": 5192,
          "old_api": null,
          "new_api": ", this's relevant",
          "old_text": null,
          "new_text": ", this's relevant ",
          "old_line_content": "// https://html.spec.whatwg.org/multipage/dynamic-markup-insertion.html#dom-parsehtmlunsafe",
          "new_line_content": "    auto& realm = *vm.current_realm();",
          "content_same": false
        },
        {
          "line": 5196,
          "old_api": null,
          "new_api": "document->set_allow_d",
          "old_text": null,
          "new_text": "  document->set_allow_d",
          "old_line_content": "    // FIXME: 1. Let compliantHTML to the result of invoking the Get Trusted Type compliant string algorithm with TrustedHTML, this's relevant global object, html, \"Document parseHTMLUnsafe\", and \"script\".",
          "new_line_content": "    JS::NonnullGCPtr<DOM::Document> document = Document::create(realm);",
          "content_same": false
        },
        {
          "line": 5197,
          "old_api": null,
          "new_api": "tive_shadow_roots",
          "old_text": null,
          "new_text": "tive_shadow_roots(true);\n\n    // 4. Parse HTML",
          "old_line_content": "",
          "new_line_content": "    document->set_content_type(\"text/html\"_string);",
          "content_same": false
        },
        {
          "line": 5144,
          "old_api": null,
          "new_api": "s[i + 1];\n\n            auto& end_dom_",
          "old_text": null,
          "new_text": "s[i + 1];\n\n            auto& end_dom_",
          "old_line_content": "",
          "new_line_content": "            for (; i < text_block.positions.size() - 1 && (match_index.value() + query.bytes_as_string_view().length() > text_block.positions[i + 1].start_offset); ++i)",
          "content_same": false
        },
        {
          "line": 5177,
          "old_api": null,
          "new_api": "put stream for parser. The encoding confiden",
          "old_text": null,
          "new_text": "put stream for parser. The encoding confiden",
          "old_line_content": "void Document::parse_html_from_a_string(StringView html)",
          "new_line_content": "    set_document_type(DOM::Document::Type::HTML);",
          "content_same": false
        },
        {
          "line": 5148,
          "old_api": null,
          "new_api": "n, end_dom_node, end_position));",
          "old_text": null,
          "new_text": "n, end_dom_node, end_position));\n    ",
          "old_line_content": "",
          "new_line_content": "            auto end_position = match_index.value() + query.bytes_as_string_view().length() - match_end_position->start_offset;",
          "content_same": false
        },
        {
          "line": 5182,
          "old_api": null,
          "new_api": "nto the input stream.\n    // FIXME: This is to m",
          "old_text": null,
          "new_text": "nto the input stream.\n    // FIXME: This is to m",
          "old_line_content": "    // 2. Create an HTML parser parser, associated with document.",
          "new_line_content": "    auto parser = HTML::HTMLParser::create(*this, html, \"UTF-8\"sv);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 5185,
          "old_api": "nto the input stream.\n    // FIXME: This is to m",
          "new_api": null,
          "old_text": "nto the input stream.\n    // FIXME: This is to m",
          "new_text": null,
          "old_line_content": "    auto parser = HTML::HTMLParser::create(*this, html, \"UTF-8\"sv);",
          "new_line_content": "    // FIXME: This is to match the default URL. Instead, pass in this's relevant global object's associated Document's URL.",
          "content_same": false
        },
        {
          "line": 5155,
          "old_api": "return matches;\n}\n\n// https://d",
          "new_api": null,
          "old_text": "\n\n    return matches;\n}\n\n// https://d",
          "new_text": null,
          "old_line_content": "            offset = match_index.value() + query.bytes_as_string_view().length() + 1;",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 5156,
          "old_api": "ow-declarative-shadow-roots\nbool Doc",
          "new_api": null,
          "old_text": "ow-declarative-shadow-roots\nbool Doc",
          "new_text": null,
          "old_line_content": "            if (offset >= text.bytes_as_string_view().length())",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 5189,
          "old_api": "ument> Document::parse_html_",
          "new_api": null,
          "old_text": "ument> Document::parse_html_",
          "new_text": null,
          "old_line_content": "    parser->run(\"about:blank\"sv);",
          "new_line_content": "// https://html.spec.whatwg.org/multipage/dynamic-markup-insertion.html#dom-parsehtmlunsafe",
          "content_same": false
        },
        {
          "line": 5195,
          "old_api": ", this's relevant",
          "new_api": null,
          "old_text": ", this's relevant ",
          "new_text": null,
          "old_line_content": "    auto& realm = *vm.current_realm();",
          "new_line_content": "    // 2. Let document be a new Document, whose content type is \"text/html\".",
          "content_same": false
        },
        {
          "line": 5199,
          "old_api": "document->set_allow_d",
          "new_api": null,
          "old_text": "  document->set_allow_d",
          "new_text": null,
          "old_line_content": "    JS::NonnullGCPtr<DOM::Document> document = Document::create(realm);",
          "new_line_content": "    // 3. Set document's allow declarative shadow roots to true.",
          "content_same": false
        },
        {
          "line": 5141,
          "old_api": "set_start",
          "new_api": null,
          "old_text": "nge->set_start(star",
          "new_text": null,
          "old_line_content": "            auto start_position = match_index.value() - match_start_position->start_offset;",
          "new_line_content": "            auto& start_dom_node = match_start_position->dom_node;",
          "content_same": false
        },
        {
          "line": 5206,
          "old_api": "",
          "new_api": null,
          "old_text": "",
          "new_text": null,
          "old_line_content": "    document->parse_html_from_a_string(html);",
          "new_line_content": "    return document;",
          "content_same": false
        },
        {
          "line": 5143,
          "old_api": "size",
          "new_api": null,
          "old_text": ".positions.size() - 1 && (match_index.value() + ",
          "new_text": null,
          "old_line_content": "            (void)range->set_start(start_dom_node, start_position);",
          "new_line_content": "            auto* match_end_position = match_start_position;",
          "content_same": false
        },
        {
          "line": 5146,
          "old_api": "s[i + 1];\n\n            auto& end_dom_",
          "new_api": null,
          "old_text": "s[i + 1];\n\n            auto& end_dom_",
          "new_text": null,
          "old_line_content": "            for (; i < text_block.positions.size() - 1 && (match_index.value() + query.bytes_as_string_view().length() > text_block.positions[i + 1].start_offset); ++i)",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 5180,
          "old_api": "put stream for parser. The encoding confiden",
          "new_api": null,
          "old_text": "put stream for parser. The encoding confiden",
          "new_text": null,
          "old_line_content": "    set_document_type(DOM::Document::Type::HTML);",
          "new_line_content": "    // 3. Place html into the input stream for parser. The encoding confidence is irrelevant.",
          "content_same": false
        },
        {
          "line": 5151,
          "old_api": "value",
          "new_api": null,
          "old_text": "  offset = match_index.value() + query.byt",
          "new_text": null,
          "old_line_content": "            (void)range->set_end(end_dom_node, end_position);",
          "new_line_content": "            match_start_position = match_end_position;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 6,
      "total_additions": 9,
      "total_deletions": 12,
      "total_api_changes": 27
    },
    "non_api_changes": {
      "has_non_api_changes": false,
      "evidence": {
        "total_diff_lines": 5,
        "api_related_lines": 27,
        "non_api_lines": 0,
        "non_api_line_numbers": []
      }
    },
    "api_calls_before": 1807,
    "api_calls_after": 1805,
    "diff_info": {
      "added_lines": 1,
      "removed_lines": 4,
      "total_diff_lines": 27
    }
  }
}