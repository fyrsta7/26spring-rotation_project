{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/24207d3795c41b0a38c99f14ecff7fda5b32662e",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/24207d3795c41b0a38c99f14ecff7fda5b32662e/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/24207d3795c41b0a38c99f14ecff7fda5b32662e/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/24207d3795c41b0a38c99f14ecff7fda5b32662e/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": true,
    "api_changes": {
      "replacements": [
        {
          "line": 254,
          "old_api": "base",
          "new_api": "range",
          "old_text": "range.base()",
          "new_text": "*iter)->range()",
          "old_line_content": "        if ((*iter)->range().base() < range.end() && (*iter)->range().end() > range.base()) {",
          "new_line_content": "        const auto& iter_range = (*iter)->range();",
          "content_same": false
        },
        {
          "line": 255,
          "old_api": "append",
          "new_api": "base",
          "old_text": "regions.append(*iter)",
          "new_text": "range.base()",
          "old_line_content": "            regions.append(*iter);",
          "new_line_content": "        if (iter_range.base() < range.end() && iter_range.end() > range.base()) {",
          "content_same": false
        },
        {
          "line": 258,
          "old_api": "size",
          "new_api": "intersect",
          "old_text": "range.size()",
          "new_text": "iter_range.intersect(range).size()",
          "old_line_content": "            if (total_size_collected == range.size())",
          "new_line_content": "            total_size_collected += (*iter)->size() - iter_range.intersect(range).size();",
          "content_same": false
        },
        {
          "line": 279,
          "old_api": "carve",
          "new_api": "range",
          "old_text": "old_region_range.carve(desired_range)",
          "new_text": "source_region.range()",
          "old_line_content": "    auto remaining_ranges_after_unmap = old_region_range.carve(desired_range);",
          "new_line_content": "    VirtualRange old_region_range = source_region.range();",
          "content_same": false
        },
        {
          "line": 284,
          "old_api": "base",
          "new_api": "contains",
          "old_text": "old_region_range.base().get()",
          "new_text": "old_region_range.contains(new_range)",
          "old_line_content": "        size_t new_range_offset_in_vmobject = source_region.offset_in_vmobject() + (new_range.base().get() - old_region_range.base().get());",
          "new_line_content": "        VERIFY(old_region_range.contains(new_range));",
          "content_same": false
        },
        {
          "line": 285,
          "old_api": "try_allocate_split_region",
          "new_api": "base",
          "old_text": "try_allocate_split_region(source_region, new_range, new_range_offset_in_vmobject)",
          "new_text": "old_region_range.base().get()",
          "old_line_content": "        return try_allocate_split_region(source_region, new_range, new_range_offset_in_vmobject);",
          "new_line_content": "        size_t new_range_offset_in_vmobject = source_region.offset_in_vmobject() + (new_range.base().get() - old_region_range.base().get());",
          "content_same": false
        },
        {
          "line": 290,
          "old_api": "unchecked_append",
          "new_api": "try_make_replacement_region",
          "old_text": "new_regions.unchecked_append(new_region)",
          "new_text": "try_make_replacement_region(new_range)",
          "old_line_content": "        new_regions.unchecked_append(new_region);",
          "new_line_content": "        auto new_region = TRY(try_make_replacement_region(new_range));",
          "content_same": false
        },
        {
          "line": 311,
          "old_api": "is_readable",
          "new_api": "size",
          "old_text": "region.is_readable()",
          "new_text": "region.size()",
          "old_line_content": "            region.is_readable() ? 'R' : ' ',",
          "new_line_content": "        dbgln(\"{:p} -- {:p} {:p} {:c}{:c}{:c}{:c}{:c}{:c} {}\", region.vaddr().get(), region.vaddr().offset(region.size() - 1).get(), region.size(),",
          "content_same": false
        },
        {
          "line": 312,
          "old_api": "is_writable",
          "new_api": "is_readable",
          "old_text": "region.is_writable()",
          "new_text": "region.is_readable()",
          "old_line_content": "            region.is_writable() ? 'W' : ' ',",
          "new_line_content": "            region.is_readable() ? 'R' : ' ',",
          "content_same": false
        },
        {
          "line": 313,
          "old_api": "is_executable",
          "new_api": "is_writable",
          "old_text": "region.is_executable()",
          "new_text": "region.is_writable()",
          "old_line_content": "            region.is_executable() ? 'X' : ' ',",
          "new_line_content": "            region.is_writable() ? 'W' : ' ',",
          "content_same": false
        },
        {
          "line": 314,
          "old_api": "is_shared",
          "new_api": "is_executable",
          "old_text": "region.is_shared()",
          "new_text": "region.is_executable()",
          "old_line_content": "            region.is_shared() ? 'S' : ' ',",
          "new_line_content": "            region.is_executable() ? 'X' : ' ',",
          "content_same": false
        },
        {
          "line": 315,
          "old_api": "is_stack",
          "new_api": "is_shared",
          "old_text": "region.is_stack()",
          "new_text": "region.is_shared()",
          "old_line_content": "            region.is_stack() ? 'T' : ' ',",
          "new_line_content": "            region.is_shared() ? 'S' : ' ',",
          "content_same": false
        },
        {
          "line": 316,
          "old_api": "is_syscall_region",
          "new_api": "is_stack",
          "old_text": "region.is_syscall_region()",
          "new_text": "region.is_stack()",
          "old_line_content": "            region.is_syscall_region() ? 'C' : ' ',",
          "new_line_content": "            region.is_stack() ? 'T' : ' ',",
          "content_same": false
        },
        {
          "line": 317,
          "old_api": "name",
          "new_api": "is_syscall_region",
          "old_text": "region.name()",
          "new_text": "region.is_syscall_region()",
          "old_line_content": "            region.name());",
          "new_line_content": "            region.is_syscall_region() ? 'C' : ' ',",
          "content_same": false
        },
        {
          "line": 337,
          "old_api": "amount_dirty",
          "new_api": "is_shared",
          "old_text": "region->amount_dirty()",
          "new_text": "region->is_shared()",
          "old_line_content": "            amount += region->amount_dirty();",
          "new_line_content": "        if (!region->is_shared())",
          "content_same": false
        },
        {
          "line": 348,
          "old_api": "vmobject",
          "new_api": "is_inode",
          "old_text": "region->vmobject()",
          "new_text": "region->vmobject().is_inode()",
          "old_line_content": "            vmobjects.set(&static_cast<const InodeVMObject&>(region->vmobject()));",
          "new_line_content": "        if (region->vmobject().is_inode())",
          "content_same": false
        },
        {
          "line": 399,
          "old_api": "is_volatile",
          "new_api": "vmobject",
          "old_text": "vmobject.is_volatile()",
          "new_text": "region->vmobject()",
          "old_line_content": "        if (vmobject.is_purgeable() && vmobject.is_volatile())",
          "new_line_content": "        auto const& vmobject = static_cast<AnonymousVMObject const&>(region->vmobject());",
          "content_same": false
        },
        {
          "line": 400,
          "old_api": "amount_resident",
          "new_api": "is_volatile",
          "old_text": "region->amount_resident()",
          "new_text": "vmobject.is_volatile()",
          "old_line_content": "            amount += region->amount_resident();",
          "new_line_content": "        if (vmobject.is_purgeable() && vmobject.is_volatile())",
          "content_same": false
        },
        {
          "line": 413,
          "old_api": "is_volatile",
          "new_api": "vmobject",
          "old_text": "vmobject.is_volatile()",
          "new_text": "region->vmobject()",
          "old_line_content": "        if (vmobject.is_purgeable() && !vmobject.is_volatile())",
          "new_line_content": "        auto const& vmobject = static_cast<AnonymousVMObject const&>(region->vmobject());",
          "content_same": false
        },
        {
          "line": 414,
          "old_api": "amount_resident",
          "new_api": "is_volatile",
          "old_text": "region->amount_resident()",
          "new_text": "vmobject.is_volatile()",
          "old_line_content": "            amount += region->amount_resident();",
          "new_line_content": "        if (vmobject.is_purgeable() && !vmobject.is_volatile())",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 256,
          "old_api": null,
          "new_api": "append",
          "old_text": null,
          "new_text": "regions.append(*iter)",
          "old_line_content": "",
          "new_line_content": "            regions.append(*iter);",
          "content_same": false
        },
        {
          "line": 259,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "range.size()",
          "old_line_content": "                break;",
          "new_line_content": "            if (total_size_collected == range.size())",
          "content_same": false
        },
        {
          "line": 387,
          "old_api": null,
          "new_api": "amount_shared",
          "old_text": null,
          "new_text": "region->amount_shared()",
          "old_line_content": "    }",
          "new_line_content": "        amount += region->amount_shared();",
          "content_same": false
        },
        {
          "line": 269,
          "old_api": null,
          "new_api": "ptr",
          "old_text": null,
          "new_text": "region.ptr()",
          "old_line_content": "    SpinlockLocker lock(m_lock);",
          "new_line_content": "    auto* ptr = region.ptr();",
          "content_same": false
        },
        {
          "line": 397,
          "old_api": null,
          "new_api": "is_anonymous",
          "old_text": null,
          "new_text": "region->vmobject().is_anonymous()",
          "old_line_content": "            continue;",
          "new_line_content": "        if (!region->vmobject().is_anonymous())",
          "content_same": false
        },
        {
          "line": 271,
          "old_api": null,
          "new_api": "move",
          "old_text": null,
          "new_text": "move(region)",
          "old_line_content": "        return ENOMEM;",
          "new_line_content": "    if (!m_regions.try_insert(region->vaddr().get(), move(region)))",
          "content_same": false
        },
        {
          "line": 401,
          "old_api": null,
          "new_api": "amount_resident",
          "old_text": null,
          "new_text": "region->amount_resident()",
          "old_line_content": "    }",
          "new_line_content": "            amount += region->amount_resident();",
          "content_same": false
        },
        {
          "line": 280,
          "old_api": null,
          "new_api": "carve",
          "old_text": null,
          "new_text": "old_region_range.carve(desired_range)",
          "old_line_content": "",
          "new_line_content": "    auto remaining_ranges_after_unmap = old_region_range.carve(desired_range);",
          "content_same": false
        },
        {
          "line": 282,
          "old_api": null,
          "new_api": "is_empty",
          "old_text": null,
          "new_text": "remaining_ranges_after_unmap.is_empty()",
          "old_line_content": "    auto try_make_replacement_region = [&](VirtualRange const& new_range) -> KResultOr<Region*> {",
          "new_line_content": "    VERIFY(!remaining_ranges_after_unmap.is_empty());",
          "content_same": false
        },
        {
          "line": 411,
          "old_api": null,
          "new_api": "is_anonymous",
          "old_text": null,
          "new_text": "region->vmobject().is_anonymous()",
          "old_line_content": "            continue;",
          "new_line_content": "        if (!region->vmobject().is_anonymous())",
          "content_same": false
        },
        {
          "line": 286,
          "old_api": null,
          "new_api": "try_allocate_split_region",
          "old_text": null,
          "new_text": "try_allocate_split_region(source_region, new_range, new_range_offset_in_vmobject)",
          "old_line_content": "    };",
          "new_line_content": "        return try_allocate_split_region(source_region, new_range, new_range_offset_in_vmobject);",
          "content_same": false
        },
        {
          "line": 415,
          "old_api": null,
          "new_api": "amount_resident",
          "old_text": null,
          "new_text": "region->amount_resident()",
          "old_line_content": "    }",
          "new_line_content": "            amount += region->amount_resident();",
          "content_same": false
        },
        {
          "line": 291,
          "old_api": null,
          "new_api": "unchecked_append",
          "old_text": null,
          "new_text": "new_regions.unchecked_append(new_region)",
          "old_line_content": "    }",
          "new_line_content": "        new_regions.unchecked_append(new_region);",
          "content_same": false
        },
        {
          "line": 298,
          "old_api": null,
          "new_api": "dbgln",
          "old_text": null,
          "new_text": "dbgln(\"Process regions:\")",
          "old_line_content": "#if ARCH(I386)",
          "new_line_content": "    dbgln(\"Process regions:\");",
          "content_same": false
        },
        {
          "line": 304,
          "old_api": null,
          "new_api": "dbgln",
          "old_text": null,
          "new_text": "dbgln(\"BEGIN{}         END{}        SIZE{}       ACCESS NAME\",\n        addr_padding, addr_padding, addr_padding)",
          "old_line_content": "        addr_padding, addr_padding, addr_padding);",
          "new_line_content": "    dbgln(\"BEGIN{}         END{}        SIZE{}       ACCESS NAME\",",
          "content_same": false
        },
        {
          "line": 318,
          "old_api": null,
          "new_api": "name",
          "old_text": null,
          "new_text": "region.name()",
          "old_line_content": "    }",
          "new_line_content": "            region.name());",
          "content_same": false
        },
        {
          "line": 320,
          "old_api": null,
          "new_api": "dump_kernel_regions",
          "old_text": null,
          "new_text": "MM.dump_kernel_regions()",
          "old_line_content": "}",
          "new_line_content": "    MM.dump_kernel_regions();",
          "content_same": false
        },
        {
          "line": 326,
          "old_api": null,
          "new_api": "clear",
          "old_text": null,
          "new_text": "m_regions.clear()",
          "old_line_content": "}",
          "new_line_content": "    m_regions.clear();",
          "content_same": false
        },
        {
          "line": 338,
          "old_api": null,
          "new_api": "amount_dirty",
          "old_text": null,
          "new_text": "region->amount_dirty()",
          "old_line_content": "    }",
          "new_line_content": "            amount += region->amount_dirty();",
          "content_same": false
        },
        {
          "line": 349,
          "old_api": null,
          "new_api": "vmobject",
          "old_text": null,
          "new_text": "region->vmobject()",
          "old_line_content": "    }",
          "new_line_content": "            vmobjects.set(&static_cast<const InodeVMObject&>(region->vmobject()));",
          "content_same": false
        },
        {
          "line": 353,
          "old_api": null,
          "new_api": "amount_clean",
          "old_text": null,
          "new_text": "vmobject->amount_clean()",
          "old_line_content": "    return amount;",
          "new_line_content": "        amount += vmobject->amount_clean();",
          "content_same": false
        },
        {
          "line": 362,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "region->size()",
          "old_line_content": "    }",
          "new_line_content": "        amount += region->size();",
          "content_same": false
        },
        {
          "line": 373,
          "old_api": null,
          "new_api": "amount_resident",
          "old_text": null,
          "new_text": "region->amount_resident()",
          "old_line_content": "    }",
          "new_line_content": "        amount += region->amount_resident();",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 257,
          "old_api": "intersect",
          "new_api": null,
          "old_text": "*iter)->range().intersect(range).size()",
          "new_text": null,
          "old_line_content": "            total_size_collected += (*iter)->size() - (*iter)->range().intersect(range).size();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 386,
          "old_api": "amount_shared",
          "new_api": null,
          "old_text": "region->amount_shared()",
          "new_text": null,
          "old_line_content": "        amount += region->amount_shared();",
          "new_line_content": "    for (auto& region : m_regions) {",
          "content_same": false
        },
        {
          "line": 268,
          "old_api": "ptr",
          "new_api": null,
          "old_text": "region.ptr()",
          "new_text": null,
          "old_line_content": "    auto* ptr = region.ptr();",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 396,
          "old_api": "is_anonymous",
          "new_api": null,
          "old_text": "region->vmobject().is_anonymous()",
          "new_text": null,
          "old_line_content": "        if (!region->vmobject().is_anonymous())",
          "new_line_content": "    for (auto& region : m_regions) {",
          "content_same": false
        },
        {
          "line": 270,
          "old_api": "move",
          "new_api": null,
          "old_text": "move(region)",
          "new_text": null,
          "old_line_content": "    if (!m_regions.try_insert(region->vaddr().get(), move(region)))",
          "new_line_content": "    SpinlockLocker lock(m_lock);",
          "content_same": false
        },
        {
          "line": 398,
          "old_api": "vmobject",
          "new_api": null,
          "old_text": "region->vmobject()",
          "new_text": null,
          "old_line_content": "        auto const& vmobject = static_cast<AnonymousVMObject const&>(region->vmobject());",
          "new_line_content": "            continue;",
          "content_same": false
        },
        {
          "line": 278,
          "old_api": "range",
          "new_api": null,
          "old_text": "source_region.range()",
          "new_text": null,
          "old_line_content": "    VirtualRange old_region_range = source_region.range();",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 281,
          "old_api": "is_empty",
          "new_api": null,
          "old_text": "remaining_ranges_after_unmap.is_empty()",
          "new_text": null,
          "old_line_content": "    VERIFY(!remaining_ranges_after_unmap.is_empty());",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 410,
          "old_api": "is_anonymous",
          "new_api": null,
          "old_text": "region->vmobject().is_anonymous()",
          "new_text": null,
          "old_line_content": "        if (!region->vmobject().is_anonymous())",
          "new_line_content": "    for (auto& region : m_regions) {",
          "content_same": false
        },
        {
          "line": 283,
          "old_api": "contains",
          "new_api": null,
          "old_text": "old_region_range.contains(new_range)",
          "new_text": null,
          "old_line_content": "        VERIFY(old_region_range.contains(new_range));",
          "new_line_content": "    auto try_make_replacement_region = [&](VirtualRange const& new_range) -> KResultOr<Region*> {",
          "content_same": false
        },
        {
          "line": 412,
          "old_api": "vmobject",
          "new_api": null,
          "old_text": "region->vmobject()",
          "new_text": null,
          "old_line_content": "        auto const& vmobject = static_cast<AnonymousVMObject const&>(region->vmobject());",
          "new_line_content": "            continue;",
          "content_same": false
        },
        {
          "line": 289,
          "old_api": "try_make_replacement_region",
          "new_api": null,
          "old_text": "try_make_replacement_region(new_range)",
          "new_text": null,
          "old_line_content": "        auto new_region = TRY(try_make_replacement_region(new_range));",
          "new_line_content": "    for (auto& new_range : remaining_ranges_after_unmap) {",
          "content_same": false
        },
        {
          "line": 297,
          "old_api": "dbgln",
          "new_api": null,
          "old_text": "dbgln(\"Process regions:\")",
          "new_text": null,
          "old_line_content": "    dbgln(\"Process regions:\");",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 303,
          "old_api": "dbgln",
          "new_api": null,
          "old_text": "dbgln(\"BEGIN{}         END{}        SIZE{}       ACCESS NAME\",\n        addr_padding, addr_padding, addr_padding)",
          "new_text": null,
          "old_line_content": "    dbgln(\"BEGIN{}         END{}        SIZE{}       ACCESS NAME\",",
          "new_line_content": "#endif",
          "content_same": false
        },
        {
          "line": 310,
          "old_api": "size",
          "new_api": null,
          "old_text": "region.size()",
          "new_text": null,
          "old_line_content": "        dbgln(\"{:p} -- {:p} {:p} {:c}{:c}{:c}{:c}{:c}{:c} {}\", region.vaddr().get(), region.vaddr().offset(region.size() - 1).get(), region.size(),",
          "new_line_content": "        auto& region = *sorted_region;",
          "content_same": false
        },
        {
          "line": 319,
          "old_api": "dump_kernel_regions",
          "new_api": null,
          "old_text": "MM.dump_kernel_regions()",
          "new_text": null,
          "old_line_content": "    MM.dump_kernel_regions();",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 325,
          "old_api": "clear",
          "new_api": null,
          "old_text": "m_regions.clear()",
          "new_text": null,
          "old_line_content": "    m_regions.clear();",
          "new_line_content": "    SpinlockLocker lock(m_lock);",
          "content_same": false
        },
        {
          "line": 336,
          "old_api": "is_shared",
          "new_api": null,
          "old_text": "region->is_shared()",
          "new_text": null,
          "old_line_content": "        if (!region->is_shared())",
          "new_line_content": "    for (auto& region : m_regions) {",
          "content_same": false
        },
        {
          "line": 347,
          "old_api": "is_inode",
          "new_api": null,
          "old_text": "region->vmobject().is_inode()",
          "new_text": null,
          "old_line_content": "        if (region->vmobject().is_inode())",
          "new_line_content": "    for (auto& region : m_regions) {",
          "content_same": false
        },
        {
          "line": 352,
          "old_api": "amount_clean",
          "new_api": null,
          "old_text": "vmobject->amount_clean()",
          "new_text": null,
          "old_line_content": "        amount += vmobject->amount_clean();",
          "new_line_content": "    for (auto& vmobject : vmobjects)",
          "content_same": false
        },
        {
          "line": 361,
          "old_api": "size",
          "new_api": null,
          "old_text": "region->size()",
          "new_text": null,
          "old_line_content": "        amount += region->size();",
          "new_line_content": "    for (auto& region : m_regions) {",
          "content_same": false
        },
        {
          "line": 372,
          "old_api": "amount_resident",
          "new_api": null,
          "old_text": "region->amount_resident()",
          "new_text": null,
          "old_line_content": "        amount += region->amount_resident();",
          "new_line_content": "    for (auto& region : m_regions) {",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 20,
      "total_additions": 23,
      "total_deletions": 22,
      "total_api_changes": 65
    },
    "non_api_changes": {
      "has_non_api_changes": false,
      "evidence": {
        "total_diff_lines": 4,
        "api_related_lines": 65,
        "non_api_lines": 0,
        "non_api_line_numbers": []
      }
    },
    "api_calls_before": 233,
    "api_calls_after": 231,
    "diff_info": {
      "added_lines": 3,
      "removed_lines": 2,
      "total_diff_lines": 19
    }
  }
}