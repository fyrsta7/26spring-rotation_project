{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/c3167afa3a2446e7e48aa0a4c6c4cf14ec06e9ec",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/c3167afa3a2446e7e48aa0a4c6c4cf14ec06e9ec/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/c3167afa3a2446e7e48aa0a4c6c4cf14ec06e9ec/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/c3167afa3a2446e7e48aa0a4c6c4cf14ec06e9ec/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 516,
          "old_api": "write_packet",
          "new_api": "dbgln",
          "old_text": "write_packet(packet)",
          "new_text": "dbgln(\"unexpected change cipher message\")",
          "old_line_content": "            write_packet(packet);",
          "new_line_content": "            dbgln(\"unexpected change cipher message\");",
          "content_same": false
        },
        {
          "line": 537,
          "old_api": "try_disambiguate_error",
          "new_api": "enum_to_string",
          "old_text": "try_disambiguate_error()",
          "new_text": "enum_to_string((AlertDescription)code)",
          "old_line_content": "                try_disambiguate_error();",
          "new_line_content": "                dbgln(\"We were alerted of a critical error: {} ({})\", code, enum_to_string((AlertDescription)code));",
          "content_same": false
        },
        {
          "line": 548,
          "old_api": "try_disambiguate_error",
          "new_api": "dbgln",
          "old_text": "try_disambiguate_error()",
          "new_text": "dbgln(\"Server sent a close notify and we haven't agreed on a cipher suite. Treating it as a handshake failure.\")",
          "old_line_content": "                    try_disambiguate_error();",
          "new_line_content": "                    dbgln(\"Server sent a close notify and we haven't agreed on a cipher suite. Treating it as a handshake failure.\");",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 512,
          "old_api": null,
          "new_api": "handle_handshake_payload",
          "old_text": null,
          "new_text": "handle_handshake_payload(plain)",
          "old_line_content": "    case ContentType::CHANGE_CIPHER_SPEC:",
          "new_line_content": "        payload_res = handle_handshake_payload(plain);",
          "content_same": false
        },
        {
          "line": 545,
          "old_api": null,
          "new_api": "alert",
          "old_text": null,
          "new_text": "alert(AlertLevel::FATAL, AlertDescription::CLOSE_NOTIFY)",
          "old_line_content": "                    // AWS CloudFront hits this.",
          "new_line_content": "                alert(AlertLevel::FATAL, AlertDescription::CLOSE_NOTIFY);",
          "content_same": false
        },
        {
          "line": 517,
          "old_api": null,
          "new_api": "build_alert",
          "old_text": null,
          "new_text": "build_alert(true, (u8)AlertDescription::UNEXPECTED_MESSAGE)",
          "old_line_content": "            payload_res = (i8)Error::UnexpectedMessage;",
          "new_line_content": "            auto packet = build_alert(true, (u8)AlertDescription::UNEXPECTED_MESSAGE);",
          "content_same": false
        },
        {
          "line": 518,
          "old_api": null,
          "new_api": "write_packet",
          "old_text": null,
          "new_text": "write_packet(packet)",
          "old_line_content": "        } else {",
          "new_line_content": "            write_packet(packet);",
          "content_same": false
        },
        {
          "line": 550,
          "old_api": null,
          "new_api": "try_disambiguate_error",
          "old_text": null,
          "new_text": "try_disambiguate_error()",
          "old_line_content": "                m_context.close_notify = true;",
          "new_line_content": "                    try_disambiguate_error();",
          "content_same": false
        },
        {
          "line": 521,
          "old_api": null,
          "new_api": "dbgln_if",
          "old_text": null,
          "new_text": "dbgln_if(TLS_DEBUG, \"change cipher spec message\")",
          "old_line_content": "            m_context.remote_sequence_number = 0;",
          "new_line_content": "            dbgln_if(TLS_DEBUG, \"change cipher spec message\");",
          "content_same": false
        },
        {
          "line": 555,
          "old_api": null,
          "new_api": "check_connection_state",
          "old_text": null,
          "new_text": "check_connection_state(false)",
          "old_line_content": "        }",
          "new_line_content": "            check_connection_state(false);",
          "content_same": false
        },
        {
          "line": 556,
          "old_api": null,
          "new_api": "notify_client_for_app_data",
          "old_text": null,
          "new_text": "notify_client_for_app_data()",
          "old_line_content": "        break;",
          "new_line_content": "            notify_client_for_app_data(); // Give the user one more chance to observe the EOF",
          "content_same": false
        },
        {
          "line": 527,
          "old_api": null,
          "new_api": "dbgln_if",
          "old_text": null,
          "new_text": "dbgln_if(TLS_DEBUG, \"alert message of length {}\", length)",
          "old_line_content": "            if constexpr (TLS_DEBUG)",
          "new_line_content": "        dbgln_if(TLS_DEBUG, \"alert message of length {}\", length);",
          "content_same": false
        },
        {
          "line": 560,
          "old_api": null,
          "new_api": "dbgln",
          "old_text": null,
          "new_text": "dbgln(\"message not understood\")",
          "old_line_content": "    }",
          "new_line_content": "        dbgln(\"message not understood\");",
          "content_same": false
        },
        {
          "line": 530,
          "old_api": null,
          "new_api": "print_buffer",
          "old_text": null,
          "new_text": "print_buffer(plain)",
          "old_line_content": "            auto level = plain[0];",
          "new_line_content": "                print_buffer(plain);",
          "content_same": false
        },
        {
          "line": 534,
          "old_api": null,
          "new_api": "dbgln_if",
          "old_text": null,
          "new_text": "dbgln_if(TLS_DEBUG, \"Alert received with level {}, code {}\", level, code)",
          "old_line_content": "            if (level == (u8)AlertLevel::FATAL) {",
          "new_line_content": "            dbgln_if(TLS_DEBUG, \"Alert received with level {}, code {}\", level, code);",
          "content_same": false
        },
        {
          "line": 506,
          "old_api": null,
          "new_api": "notify_client_for_app_data",
          "old_text": null,
          "new_text": "notify_client_for_app_data()",
          "old_line_content": "        }",
          "new_line_content": "                notify_client_for_app_data();",
          "content_same": false
        },
        {
          "line": 539,
          "old_api": null,
          "new_api": "try_disambiguate_error",
          "old_text": null,
          "new_text": "try_disambiguate_error()",
          "old_line_content": "            }",
          "new_line_content": "                try_disambiguate_error();",
          "content_same": false
        },
        {
          "line": 511,
          "old_api": null,
          "new_api": "dbgln_if",
          "old_text": null,
          "new_text": "dbgln_if(TLS_DEBUG, \"tls handshake message\")",
          "old_line_content": "        break;",
          "new_line_content": "        dbgln_if(TLS_DEBUG, \"tls handshake message\");",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 514,
          "old_api": "dbgln",
          "new_api": null,
          "old_text": "dbgln(\"unexpected change cipher message\")",
          "new_text": null,
          "old_line_content": "            dbgln(\"unexpected change cipher message\");",
          "new_line_content": "    case ContentType::CHANGE_CIPHER_SPEC:",
          "content_same": false
        },
        {
          "line": 515,
          "old_api": "build_alert",
          "new_api": null,
          "old_text": "build_alert(true, (u8)AlertDescription::UNEXPECTED_MESSAGE)",
          "new_text": null,
          "old_line_content": "            auto packet = build_alert(true, (u8)AlertDescription::UNEXPECTED_MESSAGE);",
          "new_line_content": "        if (m_context.connection_status != ConnectionStatus::KeyExchange) {",
          "content_same": false
        },
        {
          "line": 546,
          "old_api": "dbgln",
          "new_api": null,
          "old_text": "dbgln(\"Server sent a close notify and we haven't agreed on a cipher suite. Treating it as a handshake failure.\")",
          "new_text": null,
          "old_line_content": "                    dbgln(\"Server sent a close notify and we haven't agreed on a cipher suite. Treating it as a handshake failure.\");",
          "new_line_content": "                if (!m_context.cipher_spec_set) {",
          "content_same": false
        },
        {
          "line": 519,
          "old_api": "dbgln_if",
          "new_api": null,
          "old_text": "dbgln_if(TLS_DEBUG, \"change cipher spec message\")",
          "new_text": null,
          "old_line_content": "            dbgln_if(TLS_DEBUG, \"change cipher spec message\");",
          "new_line_content": "            payload_res = (i8)Error::UnexpectedMessage;",
          "content_same": false
        },
        {
          "line": 553,
          "old_api": "check_connection_state",
          "new_api": null,
          "old_text": "check_connection_state(false)",
          "new_text": null,
          "old_line_content": "            check_connection_state(false);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 554,
          "old_api": "notify_client_for_app_data",
          "new_api": null,
          "old_text": "notify_client_for_app_data()",
          "new_text": null,
          "old_line_content": "            notify_client_for_app_data(); // Give the user one more chance to observe the EOF",
          "new_line_content": "            m_context.error_code = (Error)code;",
          "content_same": false
        },
        {
          "line": 525,
          "old_api": "dbgln_if",
          "new_api": null,
          "old_text": "dbgln_if(TLS_DEBUG, \"alert message of length {}\", length)",
          "new_text": null,
          "old_line_content": "        dbgln_if(TLS_DEBUG, \"alert message of length {}\", length);",
          "new_line_content": "        break;",
          "content_same": false
        },
        {
          "line": 558,
          "old_api": "dbgln",
          "new_api": null,
          "old_text": "dbgln(\"message not understood\")",
          "new_text": null,
          "old_line_content": "        dbgln(\"message not understood\");",
          "new_line_content": "        break;",
          "content_same": false
        },
        {
          "line": 528,
          "old_api": "print_buffer",
          "new_api": null,
          "old_text": "print_buffer(plain)",
          "new_text": null,
          "old_line_content": "                print_buffer(plain);",
          "new_line_content": "        if (length >= 2) {",
          "content_same": false
        },
        {
          "line": 532,
          "old_api": "dbgln_if",
          "new_api": null,
          "old_text": "dbgln_if(TLS_DEBUG, \"Alert received with level {}, code {}\", level, code)",
          "new_text": null,
          "old_line_content": "            dbgln_if(TLS_DEBUG, \"Alert received with level {}, code {}\", level, code);",
          "new_line_content": "            auto level = plain[0];",
          "content_same": false
        },
        {
          "line": 535,
          "old_api": "enum_to_string",
          "new_api": null,
          "old_text": "enum_to_string((AlertDescription)code)",
          "new_text": null,
          "old_line_content": "                dbgln(\"We were alerted of a critical error: {} ({})\", code, enum_to_string((AlertDescription)code));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 509,
          "old_api": "dbgln_if",
          "new_api": null,
          "old_text": "dbgln_if(TLS_DEBUG, \"tls handshake message\")",
          "new_text": null,
          "old_line_content": "        dbgln_if(TLS_DEBUG, \"tls handshake message\");",
          "new_line_content": "        break;",
          "content_same": false
        },
        {
          "line": 510,
          "old_api": "handle_handshake_payload",
          "new_api": null,
          "old_text": "handle_handshake_payload(plain)",
          "new_text": null,
          "old_line_content": "        payload_res = handle_handshake_payload(plain);",
          "new_line_content": "    case ContentType::HANDSHAKE:",
          "content_same": false
        },
        {
          "line": 543,
          "old_api": "alert",
          "new_api": null,
          "old_text": "alert(AlertLevel::FATAL, AlertDescription::CLOSE_NOTIFY)",
          "new_text": null,
          "old_line_content": "                alert(AlertLevel::FATAL, AlertDescription::CLOSE_NOTIFY);",
          "new_line_content": "            if (code == (u8)AlertDescription::CLOSE_NOTIFY) {",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 3,
      "total_additions": 15,
      "total_deletions": 14,
      "total_api_changes": 32
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 2,
        "api_related_lines": 32,
        "non_api_lines": 1,
        "non_api_line_numbers": [
          505
        ]
      }
    },
    "api_calls_before": 303,
    "api_calls_after": 304,
    "diff_info": {
      "added_lines": 2,
      "removed_lines": 0,
      "total_diff_lines": 14
    }
  }
}