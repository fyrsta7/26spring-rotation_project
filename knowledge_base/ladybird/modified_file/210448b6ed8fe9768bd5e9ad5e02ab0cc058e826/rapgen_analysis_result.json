{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/210448b6ed8fe9768bd5e9ad5e02ab0cc058e826",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/210448b6ed8fe9768bd5e9ad5e02ab0cc058e826/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/210448b6ed8fe9768bd5e9ad5e02ab0cc058e826/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/210448b6ed8fe9768bd5e9ad5e02ab0cc058e826/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 329,
          "old_api": "dbgln",
          "new_api": "strlcpy",
          "old_text": "dbgln(\"strerror_r(): Invalid error number '{}' specified and the output buffer is too small.\", errnum)",
          "new_text": "strlcpy(buf, \"unknown error\", buflen)",
          "old_line_content": "            dbgln(\"strerror_r(): Invalid error number '{}' specified and the output buffer is too small.\", errnum);",
          "new_line_content": "        auto rc = strlcpy(buf, \"unknown error\", buflen);",
          "content_same": false
        },
        {
          "line": 349,
          "old_api": "const_cast<char*>(sys_errlist[errnum])",
          "new_api": "const_cast<char*>(\"Unknown error\")",
          "old_text": "const_cast<char*>(sys_errlist[errnum])",
          "new_text": "const_cast<char*>(\"Unknown error\")",
          "old_line_content": "    return const_cast<char*>(sys_errlist[errnum]);",
          "new_line_content": "        return const_cast<char*>(\"Unknown error\");",
          "content_same": false
        },
        {
          "line": 359,
          "old_api": "const_cast<char*>(sys_siglist[signum])",
          "new_api": "const_cast<char*>(\"Unknown signal\")",
          "old_text": "const_cast<char*>(sys_siglist[signum])",
          "new_text": "const_cast<char*>(\"Unknown signal\")",
          "old_line_content": "    return const_cast<char*>(sys_siglist[signum]);",
          "new_line_content": "        return const_cast<char*>(\"Unknown signal\");",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 259,
          "old_api": null,
          "new_api": "const_cast<char*>(str)",
          "old_text": null,
          "new_text": "const_cast<char*>(str)",
          "old_line_content": "}",
          "new_line_content": "            return const_cast<char*>(str);",
          "content_same": false
        },
        {
          "line": 390,
          "old_api": null,
          "new_api": "strlen",
          "old_text": null,
          "new_text": "strlen(needle)",
          "old_line_content": "            do {",
          "new_line_content": "        size_t len = strlen(needle);",
          "content_same": false
        },
        {
          "line": 395,
          "old_api": null,
          "new_api": "toupper",
          "old_text": null,
          "new_text": "toupper(nch)",
          "old_line_content": "        --haystack;",
          "new_line_content": "            } while (toupper(hch) != toupper(nch));",
          "content_same": false
        },
        {
          "line": 396,
          "old_api": null,
          "new_api": "strncasecmp",
          "old_text": null,
          "new_text": "strncasecmp(haystack, needle, len)",
          "old_line_content": "    }",
          "new_line_content": "        } while (strncasecmp(haystack, needle, len) != 0);",
          "content_same": false
        },
        {
          "line": 270,
          "old_api": null,
          "new_api": "const_cast<char*>(cptr + i)",
          "old_text": null,
          "new_text": "const_cast<char*>(cptr + i)",
          "old_line_content": "    return nullptr;",
          "new_line_content": "            return const_cast<char*>(cptr + i);",
          "content_same": false
        },
        {
          "line": 399,
          "old_api": null,
          "new_api": "const_cast<char*>(haystack)",
          "old_text": null,
          "new_text": "const_cast<char*>(haystack)",
          "old_line_content": "",
          "new_line_content": "    return const_cast<char*>(haystack);",
          "content_same": false
        },
        {
          "line": 406,
          "old_api": null,
          "new_api": "strchr",
          "old_text": null,
          "new_text": "strchr(accept, *s++)",
          "old_line_content": "    return nullptr;",
          "new_line_content": "        if (strchr(accept, *s++))",
          "content_same": false
        },
        {
          "line": 407,
          "old_api": null,
          "new_api": "const_cast<char*>(--s)",
          "old_text": null,
          "new_text": "const_cast<char*>(--s)",
          "old_line_content": "}",
          "new_line_content": "            return const_cast<char*>(--s);",
          "content_same": false
        },
        {
          "line": 282,
          "old_api": null,
          "new_api": "const_cast<char*>(str)",
          "old_text": null,
          "new_text": "const_cast<char*>(str)",
          "old_line_content": "    return last;",
          "new_line_content": "            last = const_cast<char*>(str);",
          "content_same": false
        },
        {
          "line": 290,
          "old_api": null,
          "new_api": "strrchr",
          "old_text": null,
          "new_text": "strrchr(str, ch)",
          "old_line_content": "",
          "new_line_content": "    return strrchr(str, ch);",
          "content_same": false
        },
        {
          "line": 422,
          "old_api": null,
          "new_api": "strlen",
          "old_text": null,
          "new_text": "strlen(str)",
          "old_line_content": "",
          "new_line_content": "    size_t str_len = strlen(str);",
          "content_same": false
        },
        {
          "line": 423,
          "old_api": null,
          "new_api": "strlen",
          "old_text": null,
          "new_text": "strlen(delim)",
          "old_line_content": "    for (size_t i = 0; i < str_len; ++i) {",
          "new_line_content": "    size_t delim_len = strlen(delim);",
          "content_same": false
        },
        {
          "line": 296,
          "old_api": null,
          "new_api": "strlen",
          "old_text": null,
          "new_text": "strlen(dest)",
          "old_line_content": "    for (i = 0; src[i] != '\\0'; i++)",
          "new_line_content": "    size_t dest_length = strlen(dest);",
          "content_same": false
        },
        {
          "line": 173,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(dest, src, n)",
          "old_line_content": "    u8* pd = (u8*)dest;",
          "new_line_content": "        return memcpy(dest, src, n);",
          "content_same": false
        },
        {
          "line": 307,
          "old_api": null,
          "new_api": "strlen",
          "old_text": null,
          "new_text": "strlen(dest)",
          "old_line_content": "    for (i = 0; i < n && src[i] != '\\0'; i++)",
          "new_line_content": "    size_t dest_length = strlen(dest);",
          "content_same": false
        },
        {
          "line": 185,
          "old_api": null,
          "new_api": "AK::memmem(haystack, haystack_length, needle, needle_length)",
          "old_text": null,
          "new_text": "AK::memmem(haystack, haystack_length, needle, needle_length)",
          "old_line_content": "",
          "new_line_content": "    return const_cast<void*>(AK::memmem(haystack, haystack_length, needle, needle_length));",
          "content_same": false
        },
        {
          "line": 317,
          "old_api": null,
          "new_api": "ENUMERATE_ERRNO_CODES",
          "old_text": null,
          "new_text": "ENUMERATE_ERRNO_CODES(__ENUMERATE_ERRNO_CODE)",
          "old_line_content": "};",
          "new_line_content": "    ENUMERATE_ERRNO_CODES(__ENUMERATE_ERRNO_CODE)",
          "content_same": false
        },
        {
          "line": 320,
          "old_api": null,
          "new_api": "array_size",
          "old_text": null,
          "new_text": "array_size(sys_errlist)",
          "old_line_content": "int sys_nerr = EMAXERRNO;",
          "new_line_content": "static_assert(array_size(sys_errlist) == (EMAXERRNO + 1));",
          "content_same": false
        },
        {
          "line": 331,
          "old_api": null,
          "new_api": "dbgln",
          "old_text": null,
          "new_text": "dbgln(\"strerror_r(): Invalid error number '{}' specified and the output buffer is too small.\", errnum)",
          "old_line_content": "        return EINVAL;",
          "new_line_content": "            dbgln(\"strerror_r(): Invalid error number '{}' specified and the output buffer is too small.\", errnum);",
          "content_same": false
        },
        {
          "line": 335,
          "old_api": null,
          "new_api": "strerror",
          "old_text": null,
          "new_text": "strerror(errnum)",
          "old_line_content": "    if (rc >= buflen) {",
          "new_line_content": "    auto text = strerror(errnum);",
          "content_same": false
        },
        {
          "line": 336,
          "old_api": null,
          "new_api": "strlcpy",
          "old_text": null,
          "new_text": "strlcpy(buf, text, buflen)",
          "old_line_content": "        errno = saved_errno;",
          "new_line_content": "    auto rc = strlcpy(buf, text, buflen);",
          "content_same": false
        },
        {
          "line": 470,
          "old_api": null,
          "new_api": "strtok_r",
          "old_text": null,
          "new_text": "strtok_r(str, delim, &saved_str)",
          "old_line_content": "",
          "new_line_content": "    return strtok_r(str, delim, &saved_str);",
          "content_same": false
        },
        {
          "line": 476,
          "old_api": null,
          "new_api": "strcmp",
          "old_text": null,
          "new_text": "strcmp(s1, s2)",
          "old_line_content": "",
          "new_line_content": "    return strcmp(s1, s2);",
          "content_same": false
        },
        {
          "line": 351,
          "old_api": null,
          "new_api": "const_cast<char*>(sys_errlist[errnum])",
          "old_text": null,
          "new_text": "const_cast<char*>(sys_errlist[errnum])",
          "old_line_content": "",
          "new_line_content": "    return const_cast<char*>(sys_errlist[errnum]);",
          "content_same": false
        },
        {
          "line": 358,
          "old_api": null,
          "new_api": "dbgln",
          "old_text": null,
          "new_text": "dbgln(\"strsignal() missing string for signum={}\", signum)",
          "old_line_content": "    }",
          "new_line_content": "        dbgln(\"strsignal() missing string for signum={}\", signum);",
          "content_same": false
        },
        {
          "line": 361,
          "old_api": null,
          "new_api": "const_cast<char*>(sys_siglist[signum])",
          "old_text": null,
          "new_text": "const_cast<char*>(sys_siglist[signum])",
          "old_line_content": "",
          "new_line_content": "    return const_cast<char*>(sys_siglist[signum]);",
          "content_same": false
        },
        {
          "line": 241,
          "old_api": null,
          "new_api": "const_cast<char*>(str)",
          "old_text": null,
          "new_text": "const_cast<char*>(str)",
          "old_line_content": "            return nullptr;",
          "new_line_content": "            return const_cast<char*>(str);",
          "content_same": false
        },
        {
          "line": 497,
          "old_api": null,
          "new_api": "strcspn",
          "old_text": null,
          "new_text": "strcspn(begin, delim)",
          "old_line_content": "        *end = '\\0';",
          "new_line_content": "    auto* end = begin + strcspn(begin, delim);",
          "content_same": false
        },
        {
          "line": 371,
          "old_api": null,
          "new_api": "strlen",
          "old_text": null,
          "new_text": "strlen(needle)",
          "old_line_content": "            do {",
          "new_line_content": "        size_t len = strlen(needle);",
          "content_same": false
        },
        {
          "line": 377,
          "old_api": null,
          "new_api": "strncmp",
          "old_text": null,
          "new_text": "strncmp(haystack, needle, len)",
          "old_line_content": "    }",
          "new_line_content": "        } while (strncmp(haystack, needle, len) != 0);",
          "content_same": false
        },
        {
          "line": 250,
          "old_api": null,
          "new_api": "strchr",
          "old_text": null,
          "new_text": "strchr(str, c)",
          "old_line_content": "",
          "new_line_content": "    return strchr(str, c);",
          "content_same": false
        },
        {
          "line": 380,
          "old_api": null,
          "new_api": "const_cast<char*>(haystack)",
          "old_text": null,
          "new_text": "const_cast<char*>(haystack)",
          "old_line_content": "",
          "new_line_content": "    return const_cast<char*>(haystack);",
          "content_same": false
        },
        {
          "line": 511,
          "old_api": null,
          "new_api": "secure_zero",
          "old_text": null,
          "new_text": "secure_zero(ptr, size)",
          "old_line_content": "}",
          "new_line_content": "    secure_zero(ptr, size);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 257,
          "old_api": "const_cast<char*>(str)",
          "new_api": null,
          "old_text": "const_cast<char*>(str)",
          "new_text": null,
          "old_line_content": "            return const_cast<char*>(str);",
          "new_line_content": "    for (;; ++str) {",
          "content_same": false
        },
        {
          "line": 388,
          "old_api": "strlen",
          "new_api": null,
          "old_text": "strlen(needle)",
          "new_text": null,
          "old_line_content": "        size_t len = strlen(needle);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 393,
          "old_api": "toupper",
          "new_api": null,
          "old_text": "toupper(nch)",
          "new_text": null,
          "old_line_content": "            } while (toupper(hch) != toupper(nch));",
          "new_line_content": "                if ((hch = *haystack++) == 0)",
          "content_same": false
        },
        {
          "line": 394,
          "old_api": "strncasecmp",
          "new_api": null,
          "old_text": "strncasecmp(haystack, needle, len)",
          "new_text": null,
          "old_line_content": "        } while (strncasecmp(haystack, needle, len) != 0);",
          "new_line_content": "                    return nullptr;",
          "content_same": false
        },
        {
          "line": 268,
          "old_api": "const_cast<char*>(cptr + i)",
          "new_api": null,
          "old_text": "const_cast<char*>(cptr + i)",
          "new_text": null,
          "old_line_content": "            return const_cast<char*>(cptr + i);",
          "new_line_content": "    for (size_t i = 0; i < size; ++i) {",
          "content_same": false
        },
        {
          "line": 397,
          "old_api": "const_cast<char*>(haystack)",
          "new_api": null,
          "old_text": "const_cast<char*>(haystack)",
          "new_text": null,
          "old_line_content": "    return const_cast<char*>(haystack);",
          "new_line_content": "        --haystack;",
          "content_same": false
        },
        {
          "line": 404,
          "old_api": "strchr",
          "new_api": null,
          "old_text": "strchr(accept, *s++)",
          "new_text": null,
          "old_line_content": "        if (strchr(accept, *s++))",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 405,
          "old_api": "const_cast<char*>(--s)",
          "new_api": null,
          "old_text": "const_cast<char*>(--s)",
          "new_text": null,
          "old_line_content": "            return const_cast<char*>(--s);",
          "new_line_content": "    while (*s)",
          "content_same": false
        },
        {
          "line": 280,
          "old_api": "const_cast<char*>(str)",
          "new_api": null,
          "old_text": "const_cast<char*>(str)",
          "new_text": null,
          "old_line_content": "            last = const_cast<char*>(str);",
          "new_line_content": "    for (; (c = *str); ++str) {",
          "content_same": false
        },
        {
          "line": 288,
          "old_api": "strrchr",
          "new_api": null,
          "old_text": "strrchr(str, ch)",
          "new_text": null,
          "old_line_content": "    return strrchr(str, ch);",
          "new_line_content": "char* rindex(char const* str, int ch)",
          "content_same": false
        },
        {
          "line": 420,
          "old_api": "strlen",
          "new_api": null,
          "old_text": "strlen(str)",
          "new_text": null,
          "old_line_content": "    size_t str_len = strlen(str);",
          "new_line_content": "    size_t token_start = 0;",
          "content_same": false
        },
        {
          "line": 421,
          "old_api": "strlen",
          "new_api": null,
          "old_text": "strlen(delim)",
          "new_text": null,
          "old_line_content": "    size_t delim_len = strlen(delim);",
          "new_line_content": "    size_t token_end = 0;",
          "content_same": false
        },
        {
          "line": 294,
          "old_api": "strlen",
          "new_api": null,
          "old_text": "strlen(dest)",
          "new_text": null,
          "old_line_content": "    size_t dest_length = strlen(dest);",
          "new_line_content": "char* strcat(char* dest, char const* src)",
          "content_same": false
        },
        {
          "line": 305,
          "old_api": "strlen",
          "new_api": null,
          "old_text": "strlen(dest)",
          "new_text": null,
          "old_line_content": "    size_t dest_length = strlen(dest);",
          "new_line_content": "char* strncat(char* dest, char const* src, size_t n)",
          "content_same": false
        },
        {
          "line": 183,
          "old_api": "AK::memmem(haystack, haystack_length, needle, needle_length)",
          "new_api": null,
          "old_text": "AK::memmem(haystack, haystack_length, needle, needle_length)",
          "new_text": null,
          "old_line_content": "    return const_cast<void*>(AK::memmem(haystack, haystack_length, needle, needle_length));",
          "new_line_content": "void* memmem(void const* haystack, size_t haystack_length, void const* needle, size_t needle_length)",
          "content_same": false
        },
        {
          "line": 315,
          "old_api": "ENUMERATE_ERRNO_CODES",
          "new_api": null,
          "old_text": "ENUMERATE_ERRNO_CODES(__ENUMERATE_ERRNO_CODE)",
          "new_text": null,
          "old_line_content": "    ENUMERATE_ERRNO_CODES(__ENUMERATE_ERRNO_CODE)",
          "new_line_content": "char const* const sys_errlist[] = {",
          "content_same": false
        },
        {
          "line": 318,
          "old_api": "array_size",
          "new_api": null,
          "old_text": "array_size(sys_errlist)",
          "new_text": null,
          "old_line_content": "static_assert(array_size(sys_errlist) == (EMAXERRNO + 1));",
          "new_line_content": "#undef __ENUMERATE_ERRNO_CODE",
          "content_same": false
        },
        {
          "line": 327,
          "old_api": "strlcpy",
          "new_api": null,
          "old_text": "strlcpy(buf, \"unknown error\", buflen)",
          "new_text": null,
          "old_line_content": "        auto rc = strlcpy(buf, \"unknown error\", buflen);",
          "new_line_content": "    auto saved_errno = errno;",
          "content_same": false
        },
        {
          "line": 333,
          "old_api": "strerror",
          "new_api": null,
          "old_text": "strerror(errnum)",
          "new_text": null,
          "old_line_content": "    auto text = strerror(errnum);",
          "new_line_content": "        return EINVAL;",
          "content_same": false
        },
        {
          "line": 334,
          "old_api": "strlcpy",
          "new_api": null,
          "old_text": "strlcpy(buf, text, buflen)",
          "new_text": null,
          "old_line_content": "    auto rc = strlcpy(buf, text, buflen);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 468,
          "old_api": "strtok_r",
          "new_api": null,
          "old_text": "strtok_r(str, delim, &saved_str)",
          "new_text": null,
          "old_line_content": "    return strtok_r(str, delim, &saved_str);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 474,
          "old_api": "strcmp",
          "new_api": null,
          "old_text": "strcmp(s1, s2)",
          "new_text": null,
          "old_line_content": "    return strcmp(s1, s2);",
          "new_line_content": "int strcoll(char const* s1, char const* s2)",
          "content_same": false
        },
        {
          "line": 347,
          "old_api": "const_cast<char*>(\"Unknown error\")",
          "new_api": null,
          "old_text": "const_cast<char*>(\"Unknown error\")",
          "new_text": null,
          "old_line_content": "        return const_cast<char*>(\"Unknown error\");",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 356,
          "old_api": "dbgln",
          "new_api": null,
          "old_text": "dbgln(\"strsignal() missing string for signum={}\", signum)",
          "new_text": null,
          "old_line_content": "        dbgln(\"strsignal() missing string for signum={}\", signum);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 357,
          "old_api": "const_cast<char*>(\"Unknown signal\")",
          "new_api": null,
          "old_text": "const_cast<char*>(\"Unknown signal\")",
          "new_text": null,
          "old_line_content": "        return const_cast<char*>(\"Unknown signal\");",
          "new_line_content": "    if (signum <= 0 || signum >= NSIG || !sys_siglist[signum]) {",
          "content_same": false
        },
        {
          "line": 239,
          "old_api": "const_cast<char*>(str)",
          "new_api": null,
          "old_text": "const_cast<char*>(str)",
          "new_text": null,
          "old_line_content": "            return const_cast<char*>(str);",
          "new_line_content": "    for (;; ++str) {",
          "content_same": false
        },
        {
          "line": 495,
          "old_api": "strcspn",
          "new_api": null,
          "old_text": "strcspn(begin, delim)",
          "new_text": null,
          "old_line_content": "    auto* end = begin + strcspn(begin, delim);",
          "new_line_content": "        return nullptr;",
          "content_same": false
        },
        {
          "line": 369,
          "old_api": "strlen",
          "new_api": null,
          "old_text": "strlen(needle)",
          "new_text": null,
          "old_line_content": "        size_t len = strlen(needle);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 375,
          "old_api": "strncmp",
          "new_api": null,
          "old_text": "strncmp(haystack, needle, len)",
          "new_text": null,
          "old_line_content": "        } while (strncmp(haystack, needle, len) != 0);",
          "new_line_content": "                    return nullptr;",
          "content_same": false
        },
        {
          "line": 248,
          "old_api": "strchr",
          "new_api": null,
          "old_text": "strchr(str, c)",
          "new_text": null,
          "old_line_content": "    return strchr(str, c);",
          "new_line_content": "char* index(char const* str, int c)",
          "content_same": false
        },
        {
          "line": 378,
          "old_api": "const_cast<char*>(haystack)",
          "new_api": null,
          "old_text": "const_cast<char*>(haystack)",
          "new_text": null,
          "old_line_content": "    return const_cast<char*>(haystack);",
          "new_line_content": "        --haystack;",
          "content_same": false
        },
        {
          "line": 509,
          "old_api": "secure_zero",
          "new_api": null,
          "old_text": "secure_zero(ptr, size)",
          "new_text": null,
          "old_line_content": "    secure_zero(ptr, size);",
          "new_line_content": "void explicit_bzero(void* ptr, size_t size)",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 3,
      "total_additions": 33,
      "total_deletions": 32,
      "total_api_changes": 68
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 2,
        "api_related_lines": 68,
        "non_api_lines": 2,
        "non_api_line_numbers": [
          170,
          171
        ]
      }
    },
    "api_calls_before": 45,
    "api_calls_after": 46,
    "diff_info": {
      "added_lines": 2,
      "removed_lines": 0,
      "total_diff_lines": 14
    }
  }
}