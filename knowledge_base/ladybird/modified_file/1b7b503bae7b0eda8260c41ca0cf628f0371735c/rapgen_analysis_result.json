{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/1b7b503bae7b0eda8260c41ca0cf628f0371735c",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/1b7b503bae7b0eda8260c41ca0cf628f0371735c/before.h",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/1b7b503bae7b0eda8260c41ca0cf628f0371735c/after.h",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/1b7b503bae7b0eda8260c41ca0cf628f0371735c/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 163,
          "old_api": "value",
          "new_api": "has_any_error",
          "old_text": "m_next_byte.value()",
          "new_text": "m_stream.has_any_error()",
          "old_line_content": "                m_next_byte.value() |= ((bits >> n_written) & 1) << m_bit_offset;",
          "new_line_content": "            if (m_stream.has_any_error()) {",
          "content_same": false
        },
        {
          "line": 168,
          "old_api": "clear",
          "new_api": "has_value",
          "old_text": "m_next_byte.clear()",
          "new_text": "m_next_byte.has_value()",
          "old_line_content": "                    m_next_byte.clear();",
          "new_line_content": "            if (m_next_byte.has_value()) {",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 164,
          "old_api": null,
          "new_api": "set_fatal_error",
          "old_text": null,
          "new_text": "set_fatal_error()",
          "old_line_content": "                ++n_written;",
          "new_line_content": "                set_fatal_error();",
          "content_same": false
        },
        {
          "line": 196,
          "old_api": null,
          "new_api": "has_value",
          "old_text": null,
          "new_text": "m_next_byte.has_value()",
          "old_line_content": "",
          "new_line_content": "        if (m_next_byte.has_value()) {",
          "content_same": false
        },
        {
          "line": 197,
          "old_api": null,
          "new_api": "value",
          "old_text": null,
          "new_text": "m_next_byte.value()",
          "old_line_content": "private:",
          "new_line_content": "            if (!m_stream.write_or_error(ReadonlyBytes { &m_next_byte.value(), 1 })) {",
          "content_same": false
        },
        {
          "line": 198,
          "old_api": null,
          "new_api": "set_fatal_error",
          "old_text": null,
          "new_text": "set_fatal_error()",
          "old_line_content": "    Optional<u8> m_next_byte;",
          "new_line_content": "                set_fatal_error();",
          "content_same": false
        },
        {
          "line": 200,
          "old_api": null,
          "new_api": "clear",
          "old_text": null,
          "new_text": "m_next_byte.clear()",
          "old_line_content": "    OutputStream& m_stream;",
          "new_line_content": "            m_next_byte.clear();",
          "content_same": false
        },
        {
          "line": 169,
          "old_api": null,
          "new_api": "value",
          "old_text": null,
          "new_text": "m_next_byte.value()",
          "old_line_content": "                }",
          "new_line_content": "                m_next_byte.value() |= ((bits >> n_written) & 1) << m_bit_offset;",
          "content_same": false
        },
        {
          "line": 173,
          "old_api": null,
          "new_api": "value",
          "old_text": null,
          "new_text": "m_next_byte.value()",
          "old_line_content": "            }",
          "new_line_content": "                    m_stream << m_next_byte.value();",
          "content_same": false
        },
        {
          "line": 174,
          "old_api": null,
          "new_api": "clear",
          "old_text": null,
          "new_text": "m_next_byte.clear()",
          "old_line_content": "        }",
          "new_line_content": "                    m_next_byte.clear();",
          "content_same": false
        },
        {
          "line": 177,
          "old_api": null,
          "new_api": "u16)((bits >> n_written) & 0xFFFF)",
          "old_text": null,
          "new_text": "u16)((bits >> n_written) & 0xFFFF)",
          "old_line_content": "    void write_bit(bool bit)",
          "new_line_content": "                m_stream << (u16)((bits >> n_written) & 0xFFFF);",
          "content_same": false
        },
        {
          "line": 180,
          "old_api": null,
          "new_api": "u8)((bits >> n_written) & 0xFF)",
          "old_text": null,
          "new_text": "u8)((bits >> n_written) & 0xFF)",
          "old_line_content": "    }",
          "new_line_content": "                m_stream << (u8)((bits >> n_written) & 0xFF);",
          "content_same": false
        },
        {
          "line": 156,
          "old_api": null,
          "new_api": "has_value",
          "old_text": null,
          "new_text": "m_next_byte.has_value()",
          "old_line_content": "        while (n_written < count) {",
          "new_line_content": "        if (count == 32 && !m_next_byte.has_value()) { // fast path for aligned 32 bit writes",
          "content_same": false
        },
        {
          "line": 191,
          "old_api": null,
          "new_api": "write_bits",
          "old_text": null,
          "new_text": "write_bits(bit, 1)",
          "old_line_content": "",
          "new_line_content": "        write_bits(bit, 1);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 162,
          "old_api": "has_value",
          "new_api": null,
          "old_text": "m_next_byte.has_value()",
          "new_text": null,
          "old_line_content": "            if (m_next_byte.has_value()) {",
          "new_line_content": "        while (n_written < count) {",
          "content_same": false
        },
        {
          "line": 167,
          "old_api": "value",
          "new_api": null,
          "old_text": "m_next_byte.value()",
          "new_text": null,
          "old_line_content": "                    m_stream << m_next_byte.value();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 179,
          "old_api": "write_bits",
          "new_api": null,
          "old_text": "write_bits(bit, 1)",
          "new_text": null,
          "old_line_content": "        write_bits(bit, 1);",
          "new_line_content": "            } else if (count - n_written >= 8) { // fast path for aligned 8 bit writes",
          "content_same": false
        },
        {
          "line": 184,
          "old_api": "has_value",
          "new_api": null,
          "old_text": "m_next_byte.has_value()",
          "new_text": null,
          "old_line_content": "        if (m_next_byte.has_value()) {",
          "new_line_content": "                m_next_byte = 0;",
          "content_same": false
        },
        {
          "line": 185,
          "old_api": "value",
          "new_api": null,
          "old_text": "m_next_byte.value()",
          "new_text": null,
          "old_line_content": "            if (!m_stream.write_or_error(ReadonlyBytes { &m_next_byte.value(), 1 })) {",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 186,
          "old_api": "set_fatal_error",
          "new_api": null,
          "old_text": "set_fatal_error()",
          "new_text": null,
          "old_line_content": "                set_fatal_error();",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 188,
          "old_api": "clear",
          "new_api": null,
          "old_text": "m_next_byte.clear()",
          "new_text": null,
          "old_line_content": "            m_next_byte.clear();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 157,
          "old_api": "has_any_error",
          "new_api": null,
          "old_text": "m_stream.has_any_error()",
          "new_text": null,
          "old_line_content": "            if (m_stream.has_any_error()) {",
          "new_line_content": "            m_stream << bits;",
          "content_same": false
        },
        {
          "line": 158,
          "old_api": "set_fatal_error",
          "new_api": null,
          "old_text": "set_fatal_error()",
          "new_text": null,
          "old_line_content": "                set_fatal_error();",
          "new_line_content": "            return;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 2,
      "total_additions": 12,
      "total_deletions": 9,
      "total_api_changes": 23
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 12,
        "api_related_lines": 23,
        "non_api_lines": 6,
        "non_api_line_numbers": [
          160,
          176,
          178,
          181,
          155,
          159
        ]
      }
    },
    "api_calls_before": 46,
    "api_calls_after": 49,
    "diff_info": {
      "added_lines": 12,
      "removed_lines": 0,
      "total_diff_lines": 31
    }
  }
}