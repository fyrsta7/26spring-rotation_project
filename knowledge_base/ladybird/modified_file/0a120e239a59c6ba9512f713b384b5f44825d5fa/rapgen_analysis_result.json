{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/0a120e239a59c6ba9512f713b384b5f44825d5fa",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/0a120e239a59c6ba9512f713b384b5f44825d5fa/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/0a120e239a59c6ba9512f713b384b5f44825d5fa/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/0a120e239a59c6ba9512f713b384b5f44825d5fa/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 76,
          "old_api": "width",
          "new_api": "layers_did_change",
          "old_text": "m_reference_bitmap->width()",
          "new_text": "m_editor->layers_did_change()",
          "old_line_content": "        for (int x = 0; x < m_reference_bitmap->width(); x++) {",
          "new_line_content": "        m_editor->layers_did_change();",
          "content_same": false
        },
        {
          "line": 78,
          "old_api": "get_pixel",
          "new_api": "cleanup_resources",
          "old_text": "m_reference_bitmap->get_pixel(x, y)",
          "new_text": "cleanup_resources()",
          "old_line_content": "                m_editor->active_layer()->content_bitmap().set_pixel(x, y, m_reference_bitmap->get_pixel(x, y));",
          "new_line_content": "    cleanup_resources();",
          "content_same": false
        },
        {
          "line": 84,
          "old_api": "cleanup_resources",
          "new_api": "is_null",
          "old_text": "cleanup_resources()",
          "new_text": "m_reference_bitmap.is_null()",
          "old_line_content": "    cleanup_resources();",
          "new_line_content": "    if (m_reference_bitmap.is_null())",
          "content_same": false
        },
        {
          "line": 90,
          "old_api": "is_null",
          "new_api": "format",
          "old_text": "m_reference_bitmap.is_null()",
          "new_text": "m_editor->active_layer()->content_bitmap().format()",
          "old_line_content": "    if (m_reference_bitmap.is_null())",
          "new_line_content": "    Gfx::StorageFormat storage_format = Gfx::determine_storage_format(m_editor->active_layer()->content_bitmap().format());",
          "content_same": false
        },
        {
          "line": 93,
          "old_api": "generate_precomputed_color_correction",
          "new_api": "width",
          "old_text": "generate_precomputed_color_correction()",
          "new_text": "m_reference_bitmap->width()",
          "old_line_content": "    generate_precomputed_color_correction();",
          "new_line_content": "    for (int x = 0; x < m_reference_bitmap->width(); x++) {",
          "content_same": false
        },
        {
          "line": 101,
          "old_api": "get_pixel",
          "new_api": "red",
          "old_text": "m_reference_bitmap->get_pixel(x, y)",
          "new_text": "Color(\n                m_precomputed_color_correction[current_pixel_color.red()],\n                m_precomputed_color_correction[current_pixel_color.green()],\n                m_precomputed_color_correction[current_pixel_color.blue()],\n                current_pixel_color.alpha())",
          "old_line_content": "            current_pixel_color = m_reference_bitmap->get_pixel(x, y);",
          "new_line_content": "            auto target_color = Color(",
          "content_same": false
        },
        {
          "line": 104,
          "old_api": "alpha",
          "new_api": "blue",
          "old_text": "m_editor->active_layer()->mask_bitmap()->get_pixel(x, y).alpha()",
          "new_text": "current_pixel_color.blue()",
          "old_line_content": "            if (apply_only_on_mask && !m_editor->active_layer()->mask_bitmap()->get_pixel(x, y).alpha())",
          "new_line_content": "                m_precomputed_color_correction[current_pixel_color.blue()],",
          "content_same": false
        },
        {
          "line": 107,
          "old_api": "red",
          "new_api": "active_layer",
          "old_text": "Color(\n                m_precomputed_color_correction[current_pixel_color.red()],\n                m_precomputed_color_correction[current_pixel_color.green()],\n                m_precomputed_color_correction[current_pixel_color.blue()],\n                current_pixel_color.alpha())",
          "new_text": "m_editor->active_layer()->modify_pixel_with_editing_mask(x, y, target_color, current_pixel_color)",
          "old_line_content": "            auto target_color = Color(",
          "new_line_content": "            new_pixel_color = m_editor->active_layer()->modify_pixel_with_editing_mask(x, y, target_color, current_pixel_color);",
          "content_same": false
        },
        {
          "line": 126,
          "old_api": "active_layer",
          "new_api": "is_null",
          "old_text": "m_editor->active_layer()->did_modify_bitmap()",
          "new_text": "m_reference_bitmap.is_null()",
          "old_line_content": "    m_editor->active_layer()->did_modify_bitmap();",
          "new_line_content": "    if (m_reference_bitmap.is_null())",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 98,
          "old_api": null,
          "new_api": "alpha",
          "old_text": null,
          "new_text": "m_editor->active_layer()->mask_bitmap()->get_pixel(x, y).alpha()",
          "old_line_content": "",
          "new_line_content": "            if (apply_only_on_mask && !m_editor->active_layer()->mask_bitmap()->get_pixel(x, y).alpha())",
          "content_same": false
        },
        {
          "line": 102,
          "old_api": null,
          "new_api": "red",
          "old_text": null,
          "new_text": "current_pixel_color.red()",
          "old_line_content": "",
          "new_line_content": "                m_precomputed_color_correction[current_pixel_color.red()],",
          "content_same": false
        },
        {
          "line": 103,
          "old_api": null,
          "new_api": "green",
          "old_text": null,
          "new_text": "current_pixel_color.green()",
          "old_line_content": "            // Check if we can avoid setting pixels as nothing will change when we don't have a mask at x,y.",
          "new_line_content": "                m_precomputed_color_correction[current_pixel_color.green()],",
          "content_same": false
        },
        {
          "line": 105,
          "old_api": null,
          "new_api": "alpha",
          "old_text": null,
          "new_text": "current_pixel_color.alpha()",
          "old_line_content": "                continue;",
          "new_line_content": "                current_pixel_color.alpha());",
          "content_same": false
        },
        {
          "line": 75,
          "old_api": null,
          "new_api": "active_layer",
          "old_text": null,
          "new_text": "m_editor->active_layer()->mask_bitmap()",
          "old_line_content": "    if (m_did_change && m_reference_bitmap) {",
          "new_line_content": "        MUST(m_editor->active_layer()->set_bitmaps(m_reference_bitmap.release_nonnull(), m_editor->active_layer()->mask_bitmap()));",
          "content_same": false
        },
        {
          "line": 140,
          "old_api": null,
          "new_api": "value",
          "old_text": null,
          "new_text": "m_brightness_slider->value()",
          "old_line_content": "    if (m_reference_bitmap)",
          "new_line_content": "    int delta_brightness = m_brightness_slider->value();",
          "content_same": false
        },
        {
          "line": 141,
          "old_api": null,
          "new_api": "value",
          "old_text": null,
          "new_text": "m_contrast_slider->value()",
          "old_line_content": "        m_reference_bitmap = nullptr;",
          "new_line_content": "    float contrast_correction_factor = static_cast<float>(259 * (m_contrast_slider->value() + 255) / static_cast<float>(255 * (259 - m_contrast_slider->value())));",
          "content_same": false
        },
        {
          "line": 142,
          "old_api": null,
          "new_api": "value",
          "old_text": null,
          "new_text": "m_gamma_slider->value()",
          "old_line_content": "}",
          "new_line_content": "    float gamma_correction = 1 / (m_gamma_slider->value() / 100.0);",
          "content_same": false
        },
        {
          "line": 112,
          "old_api": null,
          "new_api": "value",
          "old_text": null,
          "new_text": "new_pixel_color.value()",
          "old_line_content": "",
          "new_line_content": "                m_editor->active_layer()->content_bitmap().scanline(y)[x] = new_pixel_color.value();",
          "content_same": false
        },
        {
          "line": 83,
          "old_api": null,
          "new_api": "ensure_reference_bitmap",
          "old_text": null,
          "new_text": "ensure_reference_bitmap()",
          "old_line_content": "",
          "new_line_content": "    (void)ensure_reference_bitmap();",
          "content_same": false
        },
        {
          "line": 115,
          "old_api": null,
          "new_api": "set_pixel",
          "old_text": null,
          "new_text": "m_editor->active_layer()->content_bitmap().set_pixel(x, y, new_pixel_color)",
          "old_line_content": "            switch (storage_format) {",
          "new_line_content": "                m_editor->active_layer()->content_bitmap().set_pixel(x, y, new_pixel_color);",
          "content_same": false
        },
        {
          "line": 149,
          "old_api": null,
          "new_api": "AK::pow<float>((m_precomputed_color_correction[color_val] / 255.0), gamma_correction)",
          "old_text": null,
          "new_text": "AK::pow<float>((m_precomputed_color_correction[color_val] / 255.0), gamma_correction)",
          "old_line_content": "",
          "new_line_content": "        m_precomputed_color_correction[color_val] = 255 * AK::pow<float>((m_precomputed_color_correction[color_val] / 255.0), gamma_correction);",
          "content_same": false
        },
        {
          "line": 87,
          "old_api": null,
          "new_api": "generate_precomputed_color_correction",
          "old_text": null,
          "new_text": "generate_precomputed_color_correction()",
          "old_line_content": "void LevelsDialog::generate_new_image()",
          "new_line_content": "    generate_precomputed_color_correction();",
          "content_same": false
        },
        {
          "line": 120,
          "old_api": null,
          "new_api": "active_layer",
          "old_text": null,
          "new_text": "m_editor->active_layer()->did_modify_bitmap()",
          "old_line_content": "            default:",
          "new_line_content": "    m_editor->active_layer()->did_modify_bitmap();",
          "content_same": false
        },
        {
          "line": 91,
          "old_api": null,
          "new_api": "active_layer",
          "old_text": null,
          "new_text": "m_editor->active_layer()->mask_type()",
          "old_line_content": "        return;",
          "new_line_content": "    auto apply_only_on_mask = m_editor->active_layer()->mask_type() == Layer::MaskType::EditingMask;",
          "content_same": false
        },
        {
          "line": 127,
          "old_api": null,
          "new_api": "clone",
          "old_text": null,
          "new_text": "m_editor->active_layer()->content_bitmap().clone()",
          "old_line_content": "    m_did_change = true;",
          "new_line_content": "        m_reference_bitmap = TRY(m_editor->active_layer()->content_bitmap().clone());",
          "content_same": false
        },
        {
          "line": 94,
          "old_api": null,
          "new_api": "height",
          "old_text": null,
          "new_text": "m_reference_bitmap->height()",
          "old_line_content": "    Color current_pixel_color;",
          "new_line_content": "        for (int y = 0; y < m_reference_bitmap->height(); y++) {",
          "content_same": false
        },
        {
          "line": 95,
          "old_api": null,
          "new_api": "get_pixel",
          "old_text": null,
          "new_text": "m_reference_bitmap->get_pixel(x, y)",
          "old_line_content": "    Color new_pixel_color;",
          "new_line_content": "            current_pixel_color = m_reference_bitmap->get_pixel(x, y);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 132,
          "old_api": "is_null",
          "new_api": null,
          "old_text": "m_reference_bitmap.is_null()",
          "new_text": null,
          "old_line_content": "    if (m_reference_bitmap.is_null())",
          "new_line_content": "void LevelsDialog::cleanup_resources()",
          "content_same": false
        },
        {
          "line": 133,
          "old_api": "clone",
          "new_api": null,
          "old_text": "m_editor->active_layer()->content_bitmap().clone()",
          "new_text": null,
          "old_line_content": "        m_reference_bitmap = TRY(m_editor->active_layer()->content_bitmap().clone());",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 146,
          "old_api": "value",
          "new_api": null,
          "old_text": "m_brightness_slider->value()",
          "new_text": null,
          "old_line_content": "    int delta_brightness = m_brightness_slider->value();",
          "new_line_content": "        m_precomputed_color_correction[color_val] = m_precomputed_color_correction[color_val] < 0 ? 0 : m_precomputed_color_correction[color_val];",
          "content_same": false
        },
        {
          "line": 147,
          "old_api": "value",
          "new_api": null,
          "old_text": "m_contrast_slider->value()",
          "new_text": null,
          "old_line_content": "    float contrast_correction_factor = static_cast<float>(259 * (m_contrast_slider->value() + 255) / static_cast<float>(255 * (259 - m_contrast_slider->value())));",
          "new_line_content": "        m_precomputed_color_correction[color_val] = m_precomputed_color_correction[color_val] > 255 ? 255 : m_precomputed_color_correction[color_val];",
          "content_same": false
        },
        {
          "line": 148,
          "old_api": "value",
          "new_api": null,
          "old_text": "m_gamma_slider->value()",
          "new_text": null,
          "old_line_content": "    float gamma_correction = 1 / (m_gamma_slider->value() / 100.0);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 155,
          "old_api": "AK::pow<float>((m_precomputed_color_correction[color_val] / 255.0), gamma_correction)",
          "new_api": null,
          "old_text": "AK::pow<float>((m_precomputed_color_correction[color_val] / 255.0), gamma_correction)",
          "new_text": null,
          "old_line_content": "        m_precomputed_color_correction[color_val] = 255 * AK::pow<float>((m_precomputed_color_correction[color_val] / 255.0), gamma_correction);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 77,
          "old_api": "height",
          "new_api": null,
          "old_text": "m_reference_bitmap->height()",
          "new_text": null,
          "old_line_content": "            for (int y = 0; y < m_reference_bitmap->height(); y++) {",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 81,
          "old_api": "layers_did_change",
          "new_api": null,
          "old_text": "m_editor->layers_did_change()",
          "new_text": null,
          "old_line_content": "        m_editor->layers_did_change();",
          "new_line_content": "void LevelsDialog::generate_new_image()",
          "content_same": false
        },
        {
          "line": 89,
          "old_api": "ensure_reference_bitmap",
          "new_api": null,
          "old_text": "ensure_reference_bitmap()",
          "new_text": null,
          "old_line_content": "    (void)ensure_reference_bitmap();",
          "new_line_content": "    Color new_pixel_color;",
          "content_same": false
        },
        {
          "line": 96,
          "old_api": "format",
          "new_api": null,
          "old_text": "m_editor->active_layer()->content_bitmap().format()",
          "new_text": null,
          "old_line_content": "    Gfx::StorageFormat storage_format = Gfx::determine_storage_format(m_editor->active_layer()->content_bitmap().format());",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 97,
          "old_api": "active_layer",
          "new_api": null,
          "old_text": "m_editor->active_layer()->mask_type()",
          "new_text": null,
          "old_line_content": "    auto apply_only_on_mask = m_editor->active_layer()->mask_type() == Layer::MaskType::EditingMask;",
          "new_line_content": "            // Check if we can avoid setting pixels as nothing will change when we don't have a mask at x,y.",
          "content_same": false
        },
        {
          "line": 99,
          "old_api": "width",
          "new_api": null,
          "old_text": "m_reference_bitmap->width()",
          "new_text": null,
          "old_line_content": "    for (int x = 0; x < m_reference_bitmap->width(); x++) {",
          "new_line_content": "                continue;",
          "content_same": false
        },
        {
          "line": 100,
          "old_api": "height",
          "new_api": null,
          "old_text": "m_reference_bitmap->height()",
          "new_text": null,
          "old_line_content": "        for (int y = 0; y < m_reference_bitmap->height(); y++) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 108,
          "old_api": "red",
          "new_api": null,
          "old_text": "current_pixel_color.red()",
          "new_text": null,
          "old_line_content": "                m_precomputed_color_correction[current_pixel_color.red()],",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 109,
          "old_api": "green",
          "new_api": null,
          "old_text": "current_pixel_color.green()",
          "new_text": null,
          "old_line_content": "                m_precomputed_color_correction[current_pixel_color.green()],",
          "new_line_content": "            switch (storage_format) {",
          "content_same": false
        },
        {
          "line": 110,
          "old_api": "blue",
          "new_api": null,
          "old_text": "current_pixel_color.blue()",
          "new_text": null,
          "old_line_content": "                m_precomputed_color_correction[current_pixel_color.blue()],",
          "new_line_content": "            case Gfx::StorageFormat::BGRx8888:",
          "content_same": false
        },
        {
          "line": 111,
          "old_api": "alpha",
          "new_api": null,
          "old_text": "current_pixel_color.alpha()",
          "new_text": null,
          "old_line_content": "                current_pixel_color.alpha());",
          "new_line_content": "            case Gfx::StorageFormat::BGRA8888:",
          "content_same": false
        },
        {
          "line": 113,
          "old_api": "active_layer",
          "new_api": null,
          "old_text": "m_editor->active_layer()->modify_pixel_with_editing_mask(x, y, target_color, current_pixel_color)",
          "new_text": null,
          "old_line_content": "            new_pixel_color = m_editor->active_layer()->modify_pixel_with_editing_mask(x, y, target_color, current_pixel_color);",
          "new_line_content": "                break;",
          "content_same": false
        },
        {
          "line": 118,
          "old_api": "value",
          "new_api": null,
          "old_text": "new_pixel_color.value()",
          "new_text": null,
          "old_line_content": "                m_editor->active_layer()->content_bitmap().scanline(y)[x] = new_pixel_color.value();",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 121,
          "old_api": "set_pixel",
          "new_api": null,
          "old_text": "m_editor->active_layer()->content_bitmap().set_pixel(x, y, new_pixel_color)",
          "new_text": null,
          "old_line_content": "                m_editor->active_layer()->content_bitmap().set_pixel(x, y, new_pixel_color);",
          "new_line_content": "    m_did_change = true;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 9,
      "total_additions": 18,
      "total_deletions": 20,
      "total_api_changes": 47
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 8,
        "api_related_lines": 47,
        "non_api_lines": 3,
        "non_api_line_numbers": [
          80,
          74,
          79
        ]
      }
    },
    "api_calls_before": 88,
    "api_calls_after": 88,
    "diff_info": {
      "added_lines": 1,
      "removed_lines": 7,
      "total_diff_lines": 23
    }
  }
}