{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/3908a49661a00e15621748dcb2b0424f29433571",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/3908a49661a00e15621748dcb2b0424f29433571/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/3908a49661a00e15621748dcb2b0424f29433571/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/3908a49661a00e15621748dcb2b0424f29433571/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 37,
          "old_api": "length",
          "new_api": "is_empty",
          "old_text": "str.length()",
          "new_text": "str.is_empty()",
          "old_line_content": "    memcpy(data() + m_length, str.characters_without_null_termination(), str.length());",
          "new_line_content": "    if (str.is_empty())",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 146,
          "old_api": null,
          "new_api": "append",
          "old_text": null,
          "new_text": "append(ch)",
          "old_line_content": "}",
          "new_line_content": "            append(ch);",
          "content_same": false
        },
        {
          "line": 26,
          "old_api": null,
          "new_api": "has_overflow",
          "old_text": null,
          "new_text": "expanded_capacity.has_overflow()",
          "old_line_content": "",
          "new_line_content": "    VERIFY(!expanded_capacity.has_overflow());",
          "content_same": false
        },
        {
          "line": 27,
          "old_api": null,
          "new_api": "value",
          "old_text": null,
          "new_text": "expanded_capacity.value()",
          "old_line_content": "StringBuilder::StringBuilder(size_t initial_capacity)",
          "new_line_content": "    m_buffer.grow(expanded_capacity.value());",
          "content_same": false
        },
        {
          "line": 31,
          "old_api": null,
          "new_api": "create_uninitialized",
          "old_text": null,
          "new_text": "create_uninitialized(initial_capacity)",
          "old_line_content": "",
          "new_line_content": "    : m_buffer(decltype(m_buffer)::create_uninitialized(initial_capacity))",
          "content_same": false
        },
        {
          "line": 39,
          "old_api": null,
          "new_api": "length",
          "old_text": null,
          "new_text": "str.length()",
          "old_line_content": "}",
          "new_line_content": "    will_append(str.length());",
          "content_same": false
        },
        {
          "line": 40,
          "old_api": null,
          "new_api": "length",
          "old_text": null,
          "new_text": "str.length()",
          "old_line_content": "",
          "new_line_content": "    memcpy(data() + m_length, str.characters_without_null_termination(), str.length());",
          "content_same": false
        },
        {
          "line": 41,
          "old_api": null,
          "new_api": "length",
          "old_text": null,
          "new_text": "str.length()",
          "old_line_content": "void StringBuilder::append(const char* characters, size_t length)",
          "new_line_content": "    m_length += str.length();",
          "content_same": false
        },
        {
          "line": 46,
          "old_api": null,
          "new_api": "append",
          "old_text": null,
          "new_text": "append(StringView { characters, length })",
          "old_line_content": "void StringBuilder::append(char ch)",
          "new_line_content": "    append(StringView { characters, length });",
          "content_same": false
        },
        {
          "line": 51,
          "old_api": null,
          "new_api": "will_append",
          "old_text": null,
          "new_text": "will_append(1)",
          "old_line_content": "}",
          "new_line_content": "    will_append(1);",
          "content_same": false
        },
        {
          "line": 52,
          "old_api": null,
          "new_api": "data",
          "old_text": null,
          "new_text": "data()",
          "old_line_content": "",
          "new_line_content": "    data()[m_length] = ch;",
          "content_same": false
        },
        {
          "line": 58,
          "old_api": null,
          "new_api": "printf_internal",
          "old_text": null,
          "new_text": "printf_internal([this](char*&, char ch) {\n        append(ch);\n    },\n        nullptr, fmt, ap)",
          "old_line_content": "        nullptr, fmt, ap);",
          "new_line_content": "    printf_internal([this](char*&, char ch) {",
          "content_same": false
        },
        {
          "line": 59,
          "old_api": null,
          "new_api": "append",
          "old_text": null,
          "new_text": "append(ch)",
          "old_line_content": "}",
          "new_line_content": "        append(ch);",
          "content_same": false
        },
        {
          "line": 66,
          "old_api": null,
          "new_api": "length",
          "old_text": null,
          "new_text": "length()",
          "old_line_content": "String StringBuilder::to_string() const",
          "new_line_content": "    return ByteBuffer::copy(data(), length());",
          "content_same": false
        },
        {
          "line": 71,
          "old_api": null,
          "new_api": "is_empty",
          "old_text": null,
          "new_text": "is_empty()",
          "old_line_content": "}",
          "new_line_content": "    if (is_empty())",
          "content_same": false
        },
        {
          "line": 72,
          "old_api": null,
          "new_api": "String::empty()",
          "old_text": null,
          "new_text": "String::empty()",
          "old_line_content": "",
          "new_line_content": "        return String::empty();",
          "content_same": false
        },
        {
          "line": 73,
          "old_api": null,
          "new_api": "length",
          "old_text": null,
          "new_text": "length()",
          "old_line_content": "String StringBuilder::build() const",
          "new_line_content": "    return String((const char*)data(), length());",
          "content_same": false
        },
        {
          "line": 78,
          "old_api": null,
          "new_api": "to_string",
          "old_text": null,
          "new_text": "to_string()",
          "old_line_content": "StringView StringBuilder::string_view() const",
          "new_line_content": "    return to_string();",
          "content_same": false
        },
        {
          "line": 83,
          "old_api": null,
          "new_api": "data",
          "old_text": null,
          "new_text": "data()",
          "old_line_content": "void StringBuilder::clear()",
          "new_line_content": "    return StringView { data(), m_length };",
          "content_same": false
        },
        {
          "line": 88,
          "old_api": null,
          "new_api": "clear",
          "old_text": null,
          "new_text": "m_buffer.clear()",
          "old_line_content": "",
          "new_line_content": "    m_buffer.clear();",
          "content_same": false
        },
        {
          "line": 100,
          "old_api": null,
          "new_api": "append",
          "old_text": null,
          "new_text": "append((char)(((code_point >> 12) & 0x0f) | 0xe0))",
          "old_line_content": "    } else if (code_point <= 0x10ffff) {",
          "new_line_content": "        append((char)(((code_point >> 12) & 0x0f) | 0xe0));",
          "content_same": false
        },
        {
          "line": 105,
          "old_api": null,
          "new_api": "append",
          "old_text": null,
          "new_text": "append((char)(((code_point >> 12) & 0x3f) | 0x80))",
          "old_line_content": "    } else {",
          "new_line_content": "        append((char)(((code_point >> 12) & 0x3f) | 0x80));",
          "content_same": false
        },
        {
          "line": 109,
          "old_api": null,
          "new_api": "append",
          "old_text": null,
          "new_text": "append(0xef)",
          "old_line_content": "    }",
          "new_line_content": "        append(0xef);",
          "content_same": false
        },
        {
          "line": 110,
          "old_api": null,
          "new_api": "append",
          "old_text": null,
          "new_text": "append(0xbf)",
          "old_line_content": "}",
          "new_line_content": "        append(0xbf);",
          "content_same": false
        },
        {
          "line": 111,
          "old_api": null,
          "new_api": "append",
          "old_text": null,
          "new_text": "append(0xbd)",
          "old_line_content": "",
          "new_line_content": "        append(0xbd);",
          "content_same": false
        },
        {
          "line": 117,
          "old_api": null,
          "new_api": "length",
          "old_text": null,
          "new_text": "utf32_view.length()",
          "old_line_content": "    }",
          "new_line_content": "    for (size_t i = 0; i < utf32_view.length(); ++i) {",
          "content_same": false
        },
        {
          "line": 118,
          "old_api": null,
          "new_api": "code_points",
          "old_text": null,
          "new_text": "utf32_view.code_points()",
          "old_line_content": "}",
          "new_line_content": "        auto code_point = utf32_view.code_points()[i];",
          "content_same": false
        },
        {
          "line": 119,
          "old_api": null,
          "new_api": "append_code_point",
          "old_text": null,
          "new_text": "append_code_point(code_point)",
          "old_line_content": "",
          "new_line_content": "        append_code_point(code_point);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 24,
          "old_api": "value",
          "new_api": null,
          "old_text": "needed_capacity.value()",
          "new_text": null,
          "old_line_content": "    m_buffer.grow(needed_capacity.value());",
          "new_line_content": "    Checked<size_t> expanded_capacity = needed_capacity;",
          "content_same": false
        },
        {
          "line": 28,
          "old_api": "create_uninitialized",
          "new_api": null,
          "old_text": "create_uninitialized(initial_capacity)",
          "new_text": null,
          "old_line_content": "    : m_buffer(decltype(m_buffer)::create_uninitialized(initial_capacity))",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 34,
          "old_api": "is_empty",
          "new_api": null,
          "old_text": "str.is_empty()",
          "new_text": null,
          "old_line_content": "    if (str.is_empty())",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 36,
          "old_api": "length",
          "new_api": null,
          "old_text": "str.length()",
          "new_text": null,
          "old_line_content": "    will_append(str.length());",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 38,
          "old_api": "length",
          "new_api": null,
          "old_text": "str.length()",
          "new_text": null,
          "old_line_content": "    m_length += str.length();",
          "new_line_content": "        return;",
          "content_same": false
        },
        {
          "line": 43,
          "old_api": "append",
          "new_api": null,
          "old_text": "append(StringView { characters, length })",
          "new_text": null,
          "old_line_content": "    append(StringView { characters, length });",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 48,
          "old_api": "will_append",
          "new_api": null,
          "old_text": "will_append(1)",
          "new_text": null,
          "old_line_content": "    will_append(1);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 49,
          "old_api": "data",
          "new_api": null,
          "old_text": "data()",
          "new_text": null,
          "old_line_content": "    data()[m_length] = ch;",
          "new_line_content": "void StringBuilder::append(char ch)",
          "content_same": false
        },
        {
          "line": 55,
          "old_api": "printf_internal",
          "new_api": null,
          "old_text": "printf_internal([this](char*&, char ch) {\n        append(ch);\n    },\n        nullptr, fmt, ap)",
          "new_text": null,
          "old_line_content": "    printf_internal([this](char*&, char ch) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 56,
          "old_api": "append",
          "new_api": null,
          "old_text": "append(ch)",
          "new_text": null,
          "old_line_content": "        append(ch);",
          "new_line_content": "void StringBuilder::appendvf(const char* fmt, va_list ap)",
          "content_same": false
        },
        {
          "line": 63,
          "old_api": "length",
          "new_api": null,
          "old_text": "length()",
          "new_text": null,
          "old_line_content": "    return ByteBuffer::copy(data(), length());",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 68,
          "old_api": "is_empty",
          "new_api": null,
          "old_text": "is_empty()",
          "new_text": null,
          "old_line_content": "    if (is_empty())",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 69,
          "old_api": "String::empty()",
          "new_api": null,
          "old_text": "String::empty()",
          "new_text": null,
          "old_line_content": "        return String::empty();",
          "new_line_content": "String StringBuilder::to_string() const",
          "content_same": false
        },
        {
          "line": 70,
          "old_api": "length",
          "new_api": null,
          "old_text": "length()",
          "new_text": null,
          "old_line_content": "    return String((const char*)data(), length());",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 75,
          "old_api": "to_string",
          "new_api": null,
          "old_text": "to_string()",
          "new_text": null,
          "old_line_content": "    return to_string();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 80,
          "old_api": "data",
          "new_api": null,
          "old_text": "data()",
          "new_text": null,
          "old_line_content": "    return StringView { data(), m_length };",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 85,
          "old_api": "clear",
          "new_api": null,
          "old_text": "m_buffer.clear()",
          "new_text": null,
          "old_line_content": "    m_buffer.clear();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 92,
          "old_api": "append",
          "new_api": null,
          "old_text": "append((char)code_point)",
          "new_text": null,
          "old_line_content": "        append((char)code_point);",
          "new_line_content": "void StringBuilder::append_code_point(u32 code_point)",
          "content_same": false
        },
        {
          "line": 94,
          "old_api": "append",
          "new_api": null,
          "old_text": "append((char)(((code_point >> 6) & 0x1f) | 0xc0))",
          "new_text": null,
          "old_line_content": "        append((char)(((code_point >> 6) & 0x1f) | 0xc0));",
          "new_line_content": "    if (code_point <= 0x7f) {",
          "content_same": false
        },
        {
          "line": 99,
          "old_api": "append",
          "new_api": null,
          "old_text": "append((char)(((code_point >> 0) & 0x3f) | 0x80))",
          "new_text": null,
          "old_line_content": "        append((char)(((code_point >> 0) & 0x3f) | 0x80));",
          "new_line_content": "    } else if (code_point <= 0xffff) {",
          "content_same": false
        },
        {
          "line": 103,
          "old_api": "append",
          "new_api": null,
          "old_text": "append((char)(((code_point >> 6) & 0x3f) | 0x80))",
          "new_text": null,
          "old_line_content": "        append((char)(((code_point >> 6) & 0x3f) | 0x80));",
          "new_line_content": "    } else if (code_point <= 0x10ffff) {",
          "content_same": false
        },
        {
          "line": 108,
          "old_api": "append",
          "new_api": null,
          "old_text": "append(0xbd)",
          "new_text": null,
          "old_line_content": "        append(0xbd);",
          "new_line_content": "    } else {",
          "content_same": false
        },
        {
          "line": 114,
          "old_api": "length",
          "new_api": null,
          "old_text": "utf32_view.length()",
          "new_text": null,
          "old_line_content": "    for (size_t i = 0; i < utf32_view.length(); ++i) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 115,
          "old_api": "code_points",
          "new_api": null,
          "old_text": "utf32_view.code_points()",
          "new_text": null,
          "old_line_content": "        auto code_point = utf32_view.code_points()[i];",
          "new_line_content": "void StringBuilder::append(const Utf32View& utf32_view)",
          "content_same": false
        },
        {
          "line": 116,
          "old_api": "append_code_point",
          "new_api": null,
          "old_text": "append_code_point(code_point)",
          "new_text": null,
          "old_line_content": "        append_code_point(code_point);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 125,
          "old_api": "append",
          "new_api": null,
          "old_text": "append(\"\\\\u001B\")",
          "new_text": null,
          "old_line_content": "            append(\"\\\\u001B\");",
          "new_line_content": "    for (auto ch : string) {",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 1,
      "total_additions": 27,
      "total_deletions": 26,
      "total_api_changes": 54
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 4,
        "api_related_lines": 54,
        "non_api_lines": 1,
        "non_api_line_numbers": [
          25
        ]
      }
    },
    "api_calls_before": 52,
    "api_calls_after": 54,
    "diff_info": {
      "added_lines": 4,
      "removed_lines": 1,
      "total_diff_lines": 17
    }
  }
}