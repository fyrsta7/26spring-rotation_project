{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/8d3d0054ed2adeddb79c00d4bd6afeee12510e2d",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/8d3d0054ed2adeddb79c00d4bd6afeee12510e2d/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/8d3d0054ed2adeddb79c00d4bd6afeee12510e2d/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/8d3d0054ed2adeddb79c00d4bd6afeee12510e2d/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": true,
    "api_changes": {
      "replacements": [
        {
          "line": 82,
          "old_api": "slice_view",
          "new_api": "data",
          "old_text": "user_key.slice_view(4, 4).data()",
          "new_text": "user_key.data()",
          "old_line_content": "    round_key[1] = get_key(user_key.slice_view(4, 4).data());",
          "new_line_content": "    round_key[0] = get_key(user_key.data());",
          "content_same": false
        },
        {
          "line": 83,
          "old_api": "slice_view",
          "new_api": "data",
          "old_text": "user_key.slice_view(8, 4).data()",
          "new_text": "user_key.data()",
          "old_line_content": "    round_key[2] = get_key(user_key.slice_view(8, 4).data());",
          "new_line_content": "    round_key[1] = get_key(user_key.data() + 4);",
          "content_same": false
        },
        {
          "line": 84,
          "old_api": "slice_view",
          "new_api": "data",
          "old_text": "user_key.slice_view(12, 4).data()",
          "new_text": "user_key.data()",
          "old_line_content": "    round_key[3] = get_key(user_key.slice_view(12, 4).data());",
          "new_line_content": "    round_key[2] = get_key(user_key.data() + 8);",
          "content_same": false
        },
        {
          "line": 107,
          "old_api": "slice_view",
          "new_api": "data",
          "old_text": "user_key.slice_view(20, 4).data()",
          "new_text": "user_key.data()",
          "old_line_content": "    round_key[5] = get_key(user_key.slice_view(20, 4).data());",
          "new_line_content": "    round_key[4] = get_key(user_key.data() + 16);",
          "content_same": false
        },
        {
          "line": 135,
          "old_api": "slice_view",
          "new_api": "data",
          "old_text": "user_key.slice_view(28, 4).data()",
          "new_text": "user_key.data()",
          "old_line_content": "    round_key[7] = get_key(user_key.slice_view(28, 4).data());",
          "new_line_content": "    round_key[6] = get_key(user_key.data() + 24);",
          "content_same": false
        },
        {
          "line": 182,
          "old_api": "swap_keys",
          "new_api": "rounds",
          "old_text": "swap_keys(round_key, i, j)",
          "new_text": "rounds()",
          "old_line_content": "        swap_keys(round_key, i, j);",
          "new_line_content": "    for (size_t i = 0, j = 4 * rounds(); i < j; i += 4, j -= 4) {",
          "content_same": false
        },
        {
          "line": 222,
          "old_api": "round_keys",
          "new_api": "key",
          "old_text": "dec_key.round_keys()",
          "new_text": "key()",
          "old_line_content": "    const auto* round_keys = dec_key.round_keys();",
          "new_line_content": "    const auto& dec_key = key();",
          "content_same": false
        },
        {
          "line": 315,
          "old_api": "round_keys",
          "new_api": "key",
          "old_text": "dec_key.round_keys()",
          "new_text": "key()",
          "old_line_content": "    const auto* round_keys = dec_key.round_keys();",
          "new_line_content": "    const auto& dec_key = key();",
          "content_same": false
        },
        {
          "line": 406,
          "old_api": "overwrite",
          "new_api": "size",
          "old_text": "m_data.overwrite(0, data, length)",
          "new_text": "m_data.size()",
          "old_line_content": "    m_data.overwrite(0, data, length);",
          "new_line_content": "    ASSERT(length <= m_data.size());",
          "content_same": false
        },
        {
          "line": 407,
          "old_api": "size",
          "new_api": "overwrite",
          "old_text": "m_data.size()",
          "new_text": "m_data.overwrite(0, data, length)",
          "old_line_content": "    if (length < m_data.size()) {",
          "new_line_content": "    m_data.overwrite(0, data, length);",
          "content_same": false
        },
        {
          "line": 408,
          "old_api": "padding_mode",
          "new_api": "size",
          "old_text": "padding_mode()",
          "new_text": "m_data.size()",
          "old_line_content": "        switch (padding_mode()) {",
          "new_line_content": "    if (length < m_data.size()) {",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 389,
          "old_api": null,
          "new_api": "put",
          "old_text": null,
          "new_text": "out.put(8, s2)",
          "old_line_content": "",
          "new_line_content": "    out.put(8, s2);",
          "content_same": false
        },
        {
          "line": 136,
          "old_api": null,
          "new_api": "data",
          "old_text": null,
          "new_text": "user_key.data()",
          "old_line_content": "    if (true) { // bits == 256",
          "new_line_content": "    round_key[7] = get_key(user_key.data() + 28);",
          "content_same": false
        },
        {
          "line": 395,
          "old_api": null,
          "new_api": "put",
          "old_text": null,
          "new_text": "out.put(12, s3)",
          "old_line_content": "    // clang-format on",
          "new_line_content": "    out.put(12, s3);",
          "content_same": false
        },
        {
          "line": 401,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "buffer.size()",
          "old_line_content": "}",
          "new_line_content": "    overwrite(buffer.data(), buffer.size());",
          "content_same": false
        },
        {
          "line": 409,
          "old_api": null,
          "new_api": "padding_mode",
          "old_text": null,
          "new_text": "padding_mode()",
          "old_line_content": "        case PaddingMode::Null:",
          "new_line_content": "        switch (padding_mode()) {",
          "content_same": false
        },
        {
          "line": 412,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "m_data.size()",
          "old_line_content": "            break;",
          "new_line_content": "            __builtin_memset(m_data.data() + length, 0, m_data.size() - length);",
          "content_same": false
        },
        {
          "line": 287,
          "old_api": null,
          "new_api": "put",
          "old_text": null,
          "new_text": "out.put(0, s0)",
          "old_line_content": "",
          "new_line_content": "    out.put(0, s0);",
          "content_same": false
        },
        {
          "line": 416,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "m_data.size()",
          "old_line_content": "            break;",
          "new_line_content": "            __builtin_memset(m_data.data() + length, m_data.size() - length, m_data.size() - length);",
          "content_same": false
        },
        {
          "line": 420,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "m_data.size()",
          "old_line_content": "            break;",
          "new_line_content": "            __builtin_memset(m_data.data() + length, m_data.size() - length - 1, m_data.size() - length);",
          "content_same": false
        },
        {
          "line": 293,
          "old_api": null,
          "new_api": "put",
          "old_text": null,
          "new_text": "out.put(4, s1)",
          "old_line_content": "",
          "new_line_content": "    out.put(4, s1);",
          "content_same": false
        },
        {
          "line": 424,
          "old_api": null,
          "new_api": "ASSERT_NOT_REACHED",
          "old_text": null,
          "new_text": "ASSERT_NOT_REACHED()",
          "old_line_content": "            break;",
          "new_line_content": "            ASSERT_NOT_REACHED();",
          "content_same": false
        },
        {
          "line": 299,
          "old_api": null,
          "new_api": "put",
          "old_text": null,
          "new_text": "out.put(8, s2)",
          "old_line_content": "",
          "new_line_content": "    out.put(8, s2);",
          "content_same": false
        },
        {
          "line": 177,
          "old_api": null,
          "new_api": "expand_encrypt_key",
          "old_text": null,
          "new_text": "expand_encrypt_key(user_key, bits)",
          "old_line_content": "",
          "new_line_content": "    expand_encrypt_key(user_key, bits);",
          "content_same": false
        },
        {
          "line": 305,
          "old_api": null,
          "new_api": "put",
          "old_text": null,
          "new_text": "out.put(12, s3)",
          "old_line_content": "    // clang-format on",
          "new_line_content": "    out.put(12, s3);",
          "content_same": false
        },
        {
          "line": 179,
          "old_api": null,
          "new_api": "round_keys",
          "old_text": null,
          "new_text": "round_keys()",
          "old_line_content": "",
          "new_line_content": "    round_key = round_keys();",
          "content_same": false
        },
        {
          "line": 186,
          "old_api": null,
          "new_api": "swap_keys",
          "old_text": null,
          "new_text": "swap_keys(round_key, i + 3, j + 3)",
          "old_line_content": "    }",
          "new_line_content": "        swap_keys(round_key, i + 3, j + 3);",
          "content_same": false
        },
        {
          "line": 316,
          "old_api": null,
          "new_api": "round_keys",
          "old_text": null,
          "new_text": "dec_key.round_keys()",
          "old_line_content": "",
          "new_line_content": "    const auto* round_keys = dec_key.round_keys();",
          "content_same": false
        },
        {
          "line": 190,
          "old_api": null,
          "new_api": "rounds",
          "old_text": null,
          "new_text": "rounds()",
          "old_line_content": "        round_key += 4;",
          "new_line_content": "    for (size_t i = 1; i < rounds(); ++i) {",
          "content_same": false
        },
        {
          "line": 321,
          "old_api": null,
          "new_api": "data",
          "old_text": null,
          "new_text": "in.data().offset_pointer(12)",
          "old_line_content": "",
          "new_line_content": "    s3 = get_key(in.data().offset_pointer(12)) ^ round_keys[3];",
          "content_same": false
        },
        {
          "line": 323,
          "old_api": null,
          "new_api": "rounds",
          "old_text": null,
          "new_text": "dec_key.rounds()",
          "old_line_content": "",
          "new_line_content": "    r = dec_key.rounds() >> 1;",
          "content_same": false
        },
        {
          "line": 70,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "user_key.size()",
          "old_line_content": "",
          "new_line_content": "    ASSERT(user_key.size() >= bits / 8);",
          "content_same": false
        },
        {
          "line": 72,
          "old_api": null,
          "new_api": "round_keys",
          "old_text": null,
          "new_text": "round_keys()",
          "old_line_content": "",
          "new_line_content": "    round_key = round_keys();",
          "content_same": false
        },
        {
          "line": 85,
          "old_api": null,
          "new_api": "data",
          "old_text": null,
          "new_text": "user_key.data()",
          "old_line_content": "    if (bits == 128) {",
          "new_line_content": "    round_key[3] = get_key(user_key.data() + 12);",
          "content_same": false
        },
        {
          "line": 223,
          "old_api": null,
          "new_api": "round_keys",
          "old_text": null,
          "new_text": "dec_key.round_keys()",
          "old_line_content": "",
          "new_line_content": "    const auto* round_keys = dec_key.round_keys();",
          "content_same": false
        },
        {
          "line": 228,
          "old_api": null,
          "new_api": "data",
          "old_text": null,
          "new_text": "in.data().offset_pointer(12)",
          "old_line_content": "",
          "new_line_content": "    s3 = get_key(in.data().offset_pointer(12)) ^ round_keys[3];",
          "content_same": false
        },
        {
          "line": 230,
          "old_api": null,
          "new_api": "rounds",
          "old_text": null,
          "new_text": "dec_key.rounds()",
          "old_line_content": "",
          "new_line_content": "    r = dec_key.rounds() >> 1;",
          "content_same": false
        },
        {
          "line": 108,
          "old_api": null,
          "new_api": "data",
          "old_text": null,
          "new_text": "user_key.data()",
          "old_line_content": "    if (bits == 192) {",
          "new_line_content": "    round_key[5] = get_key(user_key.data() + 20);",
          "content_same": false
        },
        {
          "line": 377,
          "old_api": null,
          "new_api": "put",
          "old_text": null,
          "new_text": "out.put(0, s0)",
          "old_line_content": "",
          "new_line_content": "    out.put(0, s0);",
          "content_same": false
        },
        {
          "line": 383,
          "old_api": null,
          "new_api": "put",
          "old_text": null,
          "new_text": "out.put(4, s1)",
          "old_line_content": "",
          "new_line_content": "    out.put(4, s1);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 388,
          "old_api": "put",
          "new_api": null,
          "old_text": "out.put(8, s2)",
          "new_text": null,
          "old_line_content": "    out.put(8, s2);",
          "new_line_content": "         ((u32)AESTables::Decode4[(t3      ) & 0xff]      ) ^ round_keys[2];",
          "content_same": false
        },
        {
          "line": 134,
          "old_api": "slice_view",
          "new_api": null,
          "old_text": "user_key.slice_view(24, 4).data()",
          "new_text": null,
          "old_line_content": "    round_key[6] = get_key(user_key.slice_view(24, 4).data());",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 394,
          "old_api": "put",
          "new_api": null,
          "old_text": "out.put(12, s3)",
          "new_text": null,
          "old_line_content": "    out.put(12, s3);",
          "new_line_content": "         ((u32)AESTables::Decode4[(t0      ) & 0xff]      ) ^ round_keys[3];",
          "content_same": false
        },
        {
          "line": 400,
          "old_api": "size",
          "new_api": null,
          "old_text": "buffer.size()",
          "new_text": null,
          "old_line_content": "    overwrite(buffer.data(), buffer.size());",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 405,
          "old_api": "size",
          "new_api": null,
          "old_text": "m_data.size()",
          "new_text": null,
          "old_line_content": "    ASSERT(length <= m_data.size());",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 411,
          "old_api": "size",
          "new_api": null,
          "old_text": "m_data.size()",
          "new_text": null,
          "old_line_content": "            __builtin_memset(m_data.data() + length, 0, m_data.size() - length);",
          "new_line_content": "            // fill with zeros",
          "content_same": false
        },
        {
          "line": 286,
          "old_api": "put",
          "new_api": null,
          "old_text": "out.put(0, s0)",
          "new_text": null,
          "old_line_content": "    out.put(0, s0);",
          "new_line_content": "         (AESTables::Encode1[(t3      ) & 0xff] & 0x000000ff) ^ round_keys[0];",
          "content_same": false
        },
        {
          "line": 415,
          "old_api": "size",
          "new_api": null,
          "old_text": "m_data.size()",
          "new_text": null,
          "old_line_content": "            __builtin_memset(m_data.data() + length, m_data.size() - length, m_data.size() - length);",
          "new_line_content": "            // fill with the length of the padding bytes",
          "content_same": false
        },
        {
          "line": 419,
          "old_api": "size",
          "new_api": null,
          "old_text": "m_data.size()",
          "new_text": null,
          "old_line_content": "            __builtin_memset(m_data.data() + length, m_data.size() - length - 1, m_data.size() - length);",
          "new_line_content": "            // fill with the length of the padding bytes minus one",
          "content_same": false
        },
        {
          "line": 292,
          "old_api": "put",
          "new_api": null,
          "old_text": "out.put(4, s1)",
          "new_text": null,
          "old_line_content": "    out.put(4, s1);",
          "new_line_content": "         (AESTables::Encode1[(t0      ) & 0xff] & 0x000000ff) ^ round_keys[1];",
          "content_same": false
        },
        {
          "line": 423,
          "old_api": "ASSERT_NOT_REACHED",
          "new_api": null,
          "old_text": "ASSERT_NOT_REACHED()",
          "new_text": null,
          "old_line_content": "            ASSERT_NOT_REACHED();",
          "new_line_content": "            // FIXME: We should handle the rest of the common padding modes",
          "content_same": false
        },
        {
          "line": 298,
          "old_api": "put",
          "new_api": null,
          "old_text": "out.put(8, s2)",
          "new_text": null,
          "old_line_content": "    out.put(8, s2);",
          "new_line_content": "         (AESTables::Encode1[(t1      ) & 0xff] & 0x000000ff) ^ round_keys[2];",
          "content_same": false
        },
        {
          "line": 176,
          "old_api": "expand_encrypt_key",
          "new_api": null,
          "old_text": "expand_encrypt_key(user_key, bits)",
          "new_text": null,
          "old_line_content": "    expand_encrypt_key(user_key, bits);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 304,
          "old_api": "put",
          "new_api": null,
          "old_text": "out.put(12, s3)",
          "new_text": null,
          "old_line_content": "    out.put(12, s3);",
          "new_line_content": "         (AESTables::Encode1[(t2      ) & 0xff] & 0x000000ff) ^ round_keys[3];",
          "content_same": false
        },
        {
          "line": 178,
          "old_api": "round_keys",
          "new_api": null,
          "old_text": "round_keys()",
          "new_text": null,
          "old_line_content": "    round_key = round_keys();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 181,
          "old_api": "rounds",
          "new_api": null,
          "old_text": "rounds()",
          "new_text": null,
          "old_line_content": "    for (size_t i = 0, j = 4 * rounds(); i < j; i += 4, j -= 4) {",
          "new_line_content": "    // reorder round keys",
          "content_same": false
        },
        {
          "line": 314,
          "old_api": "key",
          "new_api": null,
          "old_text": "key()",
          "new_text": null,
          "old_line_content": "    const auto& dec_key = key();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 317,
          "old_api": "data",
          "new_api": null,
          "old_text": "in.data().offset_pointer(0)",
          "new_text": null,
          "old_line_content": "    s0 = get_key(in.data().offset_pointer(0)) ^ round_keys[0];",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 189,
          "old_api": "rounds",
          "new_api": null,
          "old_text": "rounds()",
          "new_text": null,
          "old_line_content": "    for (size_t i = 1; i < rounds(); ++i) {",
          "new_line_content": "    // apply inverse mix-column to middle rounds",
          "content_same": false
        },
        {
          "line": 322,
          "old_api": "rounds",
          "new_api": null,
          "old_text": "dec_key.rounds()",
          "new_text": null,
          "old_line_content": "    r = dec_key.rounds() >> 1;",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 71,
          "old_api": "round_keys",
          "new_api": null,
          "old_text": "round_keys()",
          "new_text": null,
          "old_line_content": "    round_key = round_keys();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 81,
          "old_api": "slice_view",
          "new_api": null,
          "old_text": "user_key.slice_view(0, 4).data()",
          "new_text": null,
          "old_line_content": "    round_key[0] = get_key(user_key.slice_view(0, 4).data());",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 221,
          "old_api": "key",
          "new_api": null,
          "old_text": "key()",
          "new_text": null,
          "old_line_content": "    const auto& dec_key = key();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 224,
          "old_api": "data",
          "new_api": null,
          "old_text": "in.data().offset_pointer(0)",
          "new_text": null,
          "old_line_content": "    s0 = get_key(in.data().offset_pointer(0)) ^ round_keys[0];",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 229,
          "old_api": "rounds",
          "new_api": null,
          "old_text": "dec_key.rounds()",
          "new_text": null,
          "old_line_content": "    r = dec_key.rounds() >> 1;",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 106,
          "old_api": "slice_view",
          "new_api": null,
          "old_text": "user_key.slice_view(16, 4).data()",
          "new_text": null,
          "old_line_content": "    round_key[4] = get_key(user_key.slice_view(16, 4).data());",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 376,
          "old_api": "put",
          "new_api": null,
          "old_text": "out.put(0, s0)",
          "new_text": null,
          "old_line_content": "    out.put(0, s0);",
          "new_line_content": "         ((u32)AESTables::Decode4[(t1      ) & 0xff]      ) ^ round_keys[0];",
          "content_same": false
        },
        {
          "line": 382,
          "old_api": "put",
          "new_api": null,
          "old_text": "out.put(4, s1)",
          "new_text": null,
          "old_line_content": "    out.put(4, s1);",
          "new_line_content": "         ((u32)AESTables::Decode4[(t2      ) & 0xff]      ) ^ round_keys[1];",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 11,
      "total_additions": 29,
      "total_deletions": 28,
      "total_api_changes": 68
    },
    "non_api_changes": {
      "has_non_api_changes": false,
      "evidence": {
        "total_diff_lines": 12,
        "api_related_lines": 68,
        "non_api_lines": 0,
        "non_api_line_numbers": []
      }
    },
    "api_calls_before": 106,
    "api_calls_after": 100,
    "diff_info": {
      "added_lines": 9,
      "removed_lines": 8,
      "total_diff_lines": 50
    }
  }
}