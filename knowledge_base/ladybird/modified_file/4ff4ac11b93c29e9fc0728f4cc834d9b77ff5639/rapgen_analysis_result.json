{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/4ff4ac11b93c29e9fc0728f4cc834d9b77ff5639",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/4ff4ac11b93c29e9fc0728f4cc834d9b77ff5639/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/4ff4ac11b93c29e9fc0728f4cc834d9b77ff5639/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/4ff4ac11b93c29e9fc0728f4cc834d9b77ff5639/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 624,
          "old_api": "y::create(realm, 0));",
          "new_api": "append",
          "old_text": "y::create(realm, 0));\n ",
          "new_text": "y->indexed_properties().append(execution_context_arguments[rest_index]);\n  ",
          "old_line_content": "                    auto array = MUST(Array::create(realm, 0));",
          "new_line_content": "                        array->indexed_properties().append(execution_context_arguments[rest_index]);",
          "content_same": false
        },
        {
          "line": 626,
          "old_api": "append",
          "new_api": "is_undefined",
          "old_text": "y->indexed_properties().append(execution_context_arguments[rest_index]);\n  ",
          "new_text": "ution_context_arguments[i].is_undefined()) {\n",
          "old_line_content": "                        array->indexed_properties().append(execution_context_arguments[rest_index]);",
          "new_line_content": "                } else if (i < execution_context_arguments.size() && !execution_context_arguments[i].is_undefined()) {",
          "content_same": false
        },
        {
          "line": 631,
          "old_api": "run_and_return_frame",
          "new_api": "release_error",
          "old_text": "ytecode_interpreter().run_and_return_frame(realm, *m_default_parameter_bytecode_executables[default_parameter_index - 1], nullptr);\n  ",
          "new_text": "e_and_frame.value.release_error();\n  ",
          "old_line_content": "                    auto value_and_frame = vm.bytecode_interpreter().run_and_return_frame(realm, *m_default_parameter_bytecode_executables[default_parameter_index - 1], nullptr);",
          "new_line_content": "                        return value_and_frame.value.release_error();",
          "content_same": false
        },
        {
          "line": 633,
          "old_api": "release_error",
          "new_api": "at",
          "old_text": "e_and_frame.value.release_error();\n  ",
          "new_text": "e_and_frame.frame->registers.at(0);\n  ",
          "old_line_content": "                        return value_and_frame.value.release_error();",
          "new_line_content": "                    argument_value = value_and_frame.frame->registers.at(0);",
          "content_same": false
        },
        {
          "line": 635,
          "old_api": "at",
          "new_api": "ndefined",
          "old_text": "e_and_frame.frame->registers.at(0);\n  ",
          "new_text": "ndefined();\n  ",
          "old_line_content": "                    argument_value = value_and_frame.frame->registers.at(0);",
          "new_line_content": "                    argument_value = js_undefined();",
          "content_same": false
        },
        {
          "line": 732,
          "old_api": "ocal_variable_index",
          "new_api": "tring",
          "old_text": "ocal_variable_index()];\n ",
          "new_text": "tring(), fa",
          "old_line_content": "                        initial_value = callee_context.local_variables[id.local_variable_index()];",
          "new_line_content": "                        initial_value = MUST(environment->get_binding_value(vm, id.string(), false));",
          "content_same": false
        },
        {
          "line": 739,
          "old_api": "s_local",
          "new_api": "ocal_variable_index",
          "old_text": "s_local()) {\n",
          "new_text": "ocal_variable_index()] = ",
          "old_line_content": "                if (id.is_local()) {",
          "new_line_content": "                    callee_context.local_variables[id.local_variable_index()] = initial_value;",
          "content_same": false
        },
        {
          "line": 741,
          "old_api": "ocal_variable_index",
          "new_api": "tring",
          "old_text": "ocal_variable_index()] = ",
          "new_text": "tring(), in",
          "old_line_content": "                    callee_context.local_variables[id.local_variable_index()] = initial_value;",
          "new_line_content": "                    MUST(var_environment->initialize_binding(vm, id.string(), initial_value, Environment::InitializeBindingHint::Normal));",
          "content_same": false
        },
        {
          "line": 810,
          "old_api": "is_constant_declaration",
          "new_api": "tring",
          "old_text": "aration.is_constant_declaration()) {\n",
          "new_text": "tring(), tr",
          "old_line_content": "            if (declaration.is_constant_declaration()) {",
          "new_line_content": "                MUST(lex_environment->create_immutable_binding(vm, id.string(), true));",
          "content_same": false
        },
        {
          "line": 833,
          "old_api": "name_identifier",
          "new_api": "name",
          "old_text": "aration.name_identifier()->local_variable_index()] = ",
          "new_text": "aration.name(), fu",
          "old_line_content": "            callee_context.local_variables[declaration.name_identifier()->local_variable_index()] = function;",
          "new_line_content": "            MUST(var_environment->set_mutable_binding(vm, declaration.name(), function, false));",
          "content_same": false
        },
        {
          "line": 839,
          "old_api": "eclarativeEnvironment>(*lex_environment))",
          "new_api": "eclarativeEnvironment>(*var_environment))",
          "old_text": "eclarativeEnvironment>(*lex_environment))\n  ",
          "new_text": "eclarativeEnvironment>(*var_environment))\n  ",
          "old_line_content": "    if (is<DeclarativeEnvironment>(*lex_environment))",
          "new_line_content": "    if (is<DeclarativeEnvironment>(*var_environment))",
          "content_same": false
        },
        {
          "line": 1010,
          "old_api": "code::compile(vm, async_body, FunctionKind::Async, \"AsyncBlockStart\"sv);",
          "new_api": "release_error",
          "old_text": "code::compile(vm, async_body, FunctionKind::Async, \"AsyncBlockStart\"sv);\n  ",
          "new_text": "e_executable.release_error();\n  ",
          "old_line_content": "            auto maybe_executable = Bytecode::compile(vm, async_body, FunctionKind::Async, \"AsyncBlockStart\"sv);",
          "new_line_content": "                result = maybe_executable.release_error();",
          "content_same": false
        },
        {
          "line": 1012,
          "old_api": "release_error",
          "new_api": "value",
          "old_text": "e_executable.release_error();\n  ",
          "new_text": "e_executable.value(), nu",
          "old_line_content": "                result = maybe_executable.release_error();",
          "new_line_content": "                result = vm.bytecode_interpreter().run_and_return_frame(realm, *maybe_executable.value(), nullptr).value;",
          "content_same": false
        },
        {
          "line": 1044,
          "old_api": "type",
          "new_api": "efined",
          "old_text": "lt.type() == ",
          "new_text": "efined()));\n  ",
          "old_line_content": "        if (result.type() == Completion::Type::Normal) {",
          "new_line_content": "            MUST(call(vm, *promise_capability.resolve(), js_undefined(), js_undefined()));",
          "content_same": false
        },
        {
          "line": 1049,
          "old_api": "type",
          "new_api": "alue",
          "old_text": ".type() == Co",
          "new_text": "alue()));\n    ",
          "old_line_content": "        else if (result.type() == Completion::Type::Return) {",
          "new_line_content": "            MUST(call(vm, *promise_capability.resolve(), js_undefined(), *result.value()));",
          "content_same": false
        },
        {
          "line": 1124,
          "old_api": "is_throw_completion",
          "new_api": "throw_completion",
          "old_text": "n_result.is_throw_completion()) {\n      ",
          "new_text": "n_result.throw_completion().value()));\n      ",
          "old_line_content": "        if (declaration_result.is_throw_completion()) {",
          "new_line_content": "            MUST(call(vm, *promise_capability->reject(), js_undefined(), *declaration_result.throw_completion().value()));",
          "content_same": false
        },
        {
          "line": 1125,
          "old_api": "promise_constructor",
          "new_api": "promise",
          "old_text": "insics().promise_constructor()));\n      ",
          "new_text": "pability->promise(), {} };\n  ",
          "old_line_content": "            auto promise_capability = MUST(new_promise_capability(vm, realm.intrinsics().promise_constructor()));",
          "new_line_content": "            return Completion { Completion::Type::Return, promise_capability->promise(), {} };",
          "content_same": false
        },
        {
          "line": 1131,
          "old_api": "run_and_return_frame",
          "new_api": "ult_and_frame.frame != nullptr);\n    if (",
          "old_text": "e_interpreter().run_and_return_frame(realm, *m_bytecode_executable, nullptr);\n\n    VER",
          "new_text": "ult_and_frame.frame != nullptr);\n    if (",
          "old_line_content": "    auto result_and_frame = vm.bytecode_interpreter().run_and_return_frame(realm, *m_bytecode_executable, nullptr);",
          "new_line_content": "    VERIFY(result_and_frame.frame != nullptr);",
          "content_same": false
        },
        {
          "line": 1133,
          "old_api": "ult_and_frame.frame != nullptr);\n    if (",
          "new_api": "release_error",
          "old_text": "ult_and_frame.frame != nullptr);\n    if (",
          "new_text": "_frame.value.release_error();\n\n    aut",
          "old_line_content": "    VERIFY(result_and_frame.frame != nullptr);",
          "new_line_content": "        return result_and_frame.value.release_error();",
          "content_same": false
        },
        {
          "line": 1135,
          "old_api": "release_error",
          "new_api": "release_value",
          "old_text": "_frame.value.release_error();\n\n    aut",
          "new_text": "_frame.value.release_value();\n\n    // ",
          "old_line_content": "        return result_and_frame.value.release_error();",
          "new_line_content": "    auto result = result_and_frame.value.release_value();",
          "content_same": false
        },
        {
          "line": 1154,
          "old_api": "ionDriverWrapper::create(realm, generator_object), {} };",
          "new_api": "ind == FunctionKind::Generator);\n    retu",
          "old_text": "ionDriverWrapper::create(realm, generator_object), {} };\n\n ",
          "new_text": "ind == FunctionKind::Generator);\n    retu",
          "old_line_content": "        return { Completion::Type::Return, AsyncFunctionDriverWrapper::create(realm, generator_object), {} };",
          "new_line_content": "    VERIFY(m_kind == FunctionKind::Generator);",
          "content_same": false
        },
        {
          "line": 1163,
          "old_api": ";\n    m_na",
          "new_api": "tring::create(vm, m_name), .writabl",
          "old_text": ";\n    m_na",
          "new_text": "tring::create(vm, m_name), .writabl",
          "old_line_content": "    auto& vm = this->vm();",
          "new_line_content": "    MUST(define_property_or_throw(vm.names.name, { .value = PrimitiveString::create(vm, m_name), .writable = false, .enumerable = false, .configurable = true }));",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 1028,
          "old_api": null,
          "new_api": "op_execution_context",
          "old_text": null,
          "new_text": "op_execution_context();\n\n ",
          "old_line_content": "",
          "new_line_content": "        vm.pop_execution_context();",
          "content_same": false
        },
        {
          "line": 1036,
          "old_api": null,
          "new_api": "ptr",
          "old_text": null,
          "new_text": "ptr()), r",
          "old_line_content": "",
          "new_line_content": "            result = dispose_resources(vm, verify_cast<DeclarativeEnvironment>(env.ptr()), result);",
          "content_same": false
        },
        {
          "line": 1042,
          "old_api": null,
          "new_api": "type",
          "old_text": null,
          "new_text": "lt.type() == ",
          "old_line_content": "",
          "new_line_content": "        if (result.type() == Completion::Type::Normal) {",
          "content_same": false
        },
        {
          "line": 1047,
          "old_api": null,
          "new_api": "type",
          "old_text": null,
          "new_text": ".type() == Co",
          "old_line_content": "        }",
          "new_line_content": "        else if (result.type() == Completion::Type::Return) {",
          "content_same": false
        },
        {
          "line": 1054,
          "old_api": null,
          "new_api": "ype",
          "old_text": null,
          "new_text": "ype() == Comp",
          "old_line_content": "        else {",
          "new_line_content": "            VERIFY(result.type() == Completion::Type::Throw);",
          "content_same": false
        },
        {
          "line": 1057,
          "old_api": null,
          "new_api": "ue",
          "old_text": null,
          "new_text": "ue()));\n      ",
          "old_line_content": "",
          "new_line_content": "            MUST(call(vm, *promise_capability.reject(), js_undefined(), *result.value()));",
          "content_same": false
        },
        {
          "line": 1061,
          "old_api": null,
          "new_api": "ed",
          "old_text": null,
          "new_text": "ed();\n    });\n",
          "old_line_content": "        // j. Return unused.",
          "new_line_content": "        return js_undefined();",
          "content_same": false
        },
        {
          "line": 553,
          "old_api": null,
          "new_api": "create_mutable_binding",
          "old_text": null,
          "new_text": "vironment->create_mutable_binding(vm, parameter_name, false));",
          "old_line_content": "            // i. Perform ! env.CreateMutableBinding(paramName, false).",
          "new_line_content": "        MUST(environment->create_mutable_binding(vm, parameter_name, false));",
          "content_same": false
        },
        {
          "line": 1065,
          "old_api": null,
          "new_api": "ecution_context",
          "old_text": null,
          "new_text": "ecution_context(async_context, {});\n    if (",
          "old_line_content": "",
          "new_line_content": "    auto push_result = vm.push_execution_context(async_context, {});",
          "content_same": false
        },
        {
          "line": 1066,
          "old_api": null,
          "new_api": "is_error",
          "old_text": null,
          "new_text": "t.is_error())\n        ",
          "old_line_content": "    // 4. Push asyncContext onto the execution context stack; asyncContext is now the running execution context.",
          "new_line_content": "    if (push_result.is_error())",
          "content_same": false
        },
        {
          "line": 558,
          "old_api": null,
          "new_api": "_undefined",
          "old_text": null,
          "new_text": "_undefined(), ",
          "old_line_content": "                // 1. Perform ! env.InitializeBinding(paramName, undefined).",
          "new_line_content": "            MUST(environment->initialize_binding(vm, parameter_name, js_undefined(), Environment::InitializeBindingHint::Normal));",
          "content_same": false
        },
        {
          "line": 1070,
          "old_api": null,
          "new_api": "ed",
          "old_text": null,
          "new_text": "ed() : async_c",
          "old_line_content": "",
          "new_line_content": "    auto result = call(vm, *execution_steps, async_context.this_value.is_empty() ? js_undefined() : async_context.this_value);",
          "content_same": false
        },
        {
          "line": 1073,
          "old_api": null,
          "new_api": "_execution_context",
          "old_text": null,
          "new_text": "_execution_context() == &runni",
          "old_line_content": "",
          "new_line_content": "    VERIFY(&vm.running_execution_context() == &running_context);",
          "content_same": false
        },
        {
          "line": 1076,
          "old_api": null,
          "new_api": "is_undefined",
          "old_text": null,
          "new_text": "ue().is_undefined());\n\n    //",
          "old_line_content": "",
          "new_line_content": "    VERIFY(result.has_value() && result.value().is_undefined());",
          "content_same": false
        },
        {
          "line": 569,
          "old_api": null,
          "new_api": "running_execution_context",
          "old_text": null,
          "new_text": ".running_execution_context().a",
          "old_line_content": "        if (m_strict || !simple_parameter_list) {",
          "new_line_content": "            arguments_object = create_unmapped_arguments_object(vm, vm.running_execution_context().arguments);",
          "content_same": false
        },
        {
          "line": 576,
          "old_api": null,
          "new_api": "running_execution_context",
          "old_text": null,
          "new_text": ".running_execution_context().a",
          "old_line_content": "",
          "new_line_content": "            arguments_object = create_mapped_arguments_object(vm, *this, formal_parameters(), vm.running_execution_context().arguments, *environment);",
          "content_same": false
        },
        {
          "line": 1091,
          "old_api": null,
          "new_api": ";\n    auto",
          "old_text": null,
          "new_text": ";\n    auto",
          "old_line_content": "Completion ECMAScriptFunctionObject::ordinary_call_evaluate_body()",
          "new_line_content": "    auto& vm = this->vm();",
          "content_same": false
        },
        {
          "line": 1092,
          "old_api": null,
          "new_api": "_realm",
          "old_text": null,
          "new_text": "_realm();\n\n    // ",
          "old_line_content": "{",
          "new_line_content": "    auto& realm = *vm.current_realm();",
          "content_same": false
        },
        {
          "line": 582,
          "old_api": null,
          "new_api": "as_string",
          "old_text": null,
          "new_text": ".names.arguments.as_string(), ",
          "old_line_content": "        if (m_strict) {",
          "new_line_content": "            MUST(environment->create_immutable_binding(vm, vm.names.arguments.as_string(), false));",
          "content_same": false
        },
        {
          "line": 589,
          "old_api": null,
          "new_api": "as_string",
          "old_text": null,
          "new_text": ".names.arguments.as_string(), ",
          "old_line_content": "        else {",
          "new_line_content": "            MUST(environment->create_mutable_binding(vm, vm.names.arguments.as_string(), false));",
          "content_same": false
        },
        {
          "line": 593,
          "old_api": null,
          "new_api": "as_string",
          "old_text": null,
          "new_text": ".names.arguments.as_string(), ",
          "old_line_content": "",
          "new_line_content": "        MUST(environment->initialize_binding(vm, vm.names.arguments.as_string(), arguments_object, Environment::InitializeBindingHint::Normal));",
          "content_same": false
        },
        {
          "line": 1106,
          "old_api": null,
          "new_api": "String::formatted(\"default parameter #{} for {}\", default_parameter_index, m_name)));",
          "old_text": null,
          "new_text": "String::formatted(\"default parameter #{} for {}\", default_parameter_index, m_name)));\n      ",
          "old_line_content": "            if (!parameter.default_value)",
          "new_line_content": "            auto executable = TRY(Bytecode::compile(vm, *parameter.default_value, FunctionKind::Normal, DeprecatedString::formatted(\"default parameter #{} for {}\", default_parameter_index, m_name)));",
          "content_same": false
        },
        {
          "line": 1107,
          "old_api": null,
          "new_api": "table));",
          "old_text": null,
          "new_text": "table));\n       ",
          "old_line_content": "                continue;",
          "new_line_content": "            m_default_parameter_bytecode_executables.append(move(executable));",
          "content_same": false
        },
        {
          "line": 1111,
          "old_api": null,
          "new_api": "eclaration_instantiation",
          "old_text": null,
          "new_text": "eclaration_instantiation();\n\n    if ",
          "old_line_content": "    }",
          "new_line_content": "    auto declaration_result = function_declaration_instantiation();",
          "content_same": false
        },
        {
          "line": 1114,
          "old_api": null,
          "new_api": "is_error",
          "old_text": null,
          "new_text": "n_result.is_error())\n        ",
          "old_line_content": "",
          "new_line_content": "        if (declaration_result.is_error())",
          "content_same": false
        },
        {
          "line": 1115,
          "old_api": null,
          "new_api": "release_error",
          "old_text": null,
          "new_text": "n_result.release_error();\n    }\n\n ",
          "old_line_content": "    if (m_kind == FunctionKind::Normal || m_kind == FunctionKind::Generator || m_kind == FunctionKind::AsyncGenerator) {",
          "new_line_content": "            return declaration_result.release_error();",
          "content_same": false
        },
        {
          "line": 1119,
          "old_api": null,
          "new_api": "compile",
          "old_text": null,
          "new_text": "compile(vm, *m_ecmascript_code, m_kind, m_name));\n\n    if",
          "old_line_content": "",
          "new_line_content": "        m_bytecode_executable = TRY(Bytecode::compile(vm, *m_ecmascript_code, m_kind, m_name));",
          "content_same": false
        },
        {
          "line": 610,
          "old_api": null,
          "new_api": "unning_execution_context",
          "old_text": null,
          "new_text": "unning_execution_context().arg",
          "old_line_content": "    //     a. Perform ? IteratorBindingInitialization of formals with arguments iteratorRecord and env.",
          "new_line_content": "    auto& execution_context_arguments = vm.running_execution_context().arguments;",
          "content_same": false
        },
        {
          "line": 1122,
          "old_api": null,
          "new_api": "is_throw_completion",
          "old_text": null,
          "new_text": "n_result.is_throw_completion()) {\n      ",
          "old_line_content": "",
          "new_line_content": "        if (declaration_result.is_throw_completion()) {",
          "content_same": false
        },
        {
          "line": 1123,
          "old_api": null,
          "new_api": "promise_constructor",
          "old_text": null,
          "new_text": "insics().promise_constructor()));\n      ",
          "old_line_content": "    if (m_kind == FunctionKind::Async) {",
          "new_line_content": "            auto promise_capability = MUST(new_promise_capability(vm, realm.intrinsics().promise_constructor()));",
          "content_same": false
        },
        {
          "line": 613,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "rmal_parameters.size(); ++",
          "old_line_content": "",
          "new_line_content": "    for (size_t i = 0; i < m_formal_parameters.size(); ++i) {",
          "content_same": false
        },
        {
          "line": 1129,
          "old_api": null,
          "new_api": "run_and_return_frame",
          "old_text": null,
          "new_text": "e_interpreter().run_and_return_frame(realm, *m_bytecode_executable, nullptr);\n\n    VER",
          "old_line_content": "    }",
          "new_line_content": "    auto result_and_frame = vm.bytecode_interpreter().run_and_return_frame(realm, *m_bytecode_executable, nullptr);",
          "content_same": false
        },
        {
          "line": 618,
          "old_api": null,
          "new_api": "visit",
          "old_text": null,
          "new_text": "meter.binding.visit(\n            [&](auto const& param) -> ThrowCompletionOr<void> {\n                Value argument_value;\n                if (parameter.is_rest) {\n                    auto array = MUST(Array::create(realm, 0));\n                    for (size_t rest_index = i; rest_index < execution_context_arguments.size(); ++rest_index)\n                        array->indexed_properties().append(execution_context_arguments[rest_index]);\n                    argument_value = array;\n                } else if (i < execution_context_arguments.size() && !execution_context_arguments[i].is_undefined()) {\n                    argument_value = execution_context_arguments[i];\n                } else if (parameter.default_value) {\n                    auto value_and_frame = vm.bytecode_interpreter().run_and_return_frame(realm, *m_default_parameter_bytecode_executables[default_parameter_index - 1], nullptr);\n                    if (value_and_frame.value.is_error())\n                        return value_and_frame.value.release_error();\n                    // Resulting value is in the accumulator.\n                    argument_value = value_and_frame.frame->registers.at(0);\n                } else {\n                    argument_value = js_undefined();\n                }\n\n                Environment* used_environment = m_has_duplicates ? nullptr : environment;\n\n                if constexpr (IsSame<NonnullRefPtr<Identifier const> const&, decltype(param)>) {\n                    if (param->is_local()) {\n                        callee_context.local_variables[param->local_variable_index()] = argument_value;\n                        return {};\n                    }\n                    Reference reference = TRY(vm.resolve_binding(param->string(), used_environment));\n                    // Here the difference from hasDuplicates is important\n                    if (m_has_duplicates)\n                        return reference.put_value(vm, argument_value);\n                    return reference.initialize_referenced_binding(vm, argument_value);\n                }\n                if constexpr (IsSame<NonnullRefPtr<BindingPattern const> const&, decltype(param)>) {\n                    // Here the difference from hasDuplicates is important\n                    return vm.binding_initialization(param, argument_value, used_environment);\n                }\n            }));\n ",
          "old_line_content": "            ++default_parameter_index;",
          "new_line_content": "        TRY(parameter.binding.visit(",
          "content_same": false
        },
        {
          "line": 1132,
          "old_api": null,
          "new_api": "is_error",
          "old_text": null,
          "new_text": "_frame.value.is_error())\n        ",
          "old_line_content": "",
          "new_line_content": "    if (result_and_frame.value.is_error())",
          "content_same": false
        },
        {
          "line": 622,
          "old_api": null,
          "new_api": "y::create(realm, 0));",
          "old_text": null,
          "new_text": "y::create(realm, 0));\n ",
          "old_line_content": "                Value argument_value;",
          "new_line_content": "                    auto array = MUST(Array::create(realm, 0));",
          "content_same": false
        },
        {
          "line": 623,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "ution_context_arguments.size(); ++",
          "old_line_content": "                if (parameter.is_rest) {",
          "new_line_content": "                    for (size_t rest_index = i; rest_index < execution_context_arguments.size(); ++rest_index)",
          "content_same": false
        },
        {
          "line": 1140,
          "old_api": null,
          "new_api": "ed",
          "old_text": null,
          "new_text": "ed()), {} };\n\n",
          "old_line_content": "    // Until it does, we assume \"return\" and include the undefined fallback from the call site.",
          "new_line_content": "        return { Completion::Type::Return, result.value_or(js_undefined()), {} };",
          "content_same": false
        },
        {
          "line": 629,
          "old_api": null,
          "new_api": "run_and_return_frame",
          "old_text": null,
          "new_text": "ytecode_interpreter().run_and_return_frame(realm, *m_default_parameter_bytecode_executables[default_parameter_index - 1], nullptr);\n  ",
          "old_line_content": "                    argument_value = execution_context_arguments[i];",
          "new_line_content": "                    auto value_and_frame = vm.bytecode_interpreter().run_and_return_frame(realm, *m_default_parameter_bytecode_executables[default_parameter_index - 1], nullptr);",
          "content_same": false
        },
        {
          "line": 630,
          "old_api": null,
          "new_api": "is_error",
          "old_text": null,
          "new_text": "e_and_frame.value.is_error())\n  ",
          "old_line_content": "                } else if (parameter.default_value) {",
          "new_line_content": "                    if (value_and_frame.value.is_error())",
          "content_same": false
        },
        {
          "line": 1143,
          "old_api": null,
          "new_api": "lt_and_frame.frame)));",
          "old_text": null,
          "new_text": "lt_and_frame.frame)));\n      ",
          "old_line_content": "",
          "new_line_content": "        auto async_generator_object = TRY(AsyncGenerator::create(realm, result, this, vm.running_execution_context().copy(), move(*result_and_frame.frame)));",
          "content_same": false
        },
        {
          "line": 1147,
          "old_api": null,
          "new_api": "lt_and_frame.frame)));\n\n    /",
          "old_text": null,
          "new_text": "lt_and_frame.frame)));\n\n    /",
          "old_line_content": "    }",
          "new_line_content": "    auto generator_object = TRY(GeneratorObject::create(realm, result, this, vm.running_execution_context().copy(), move(*result_and_frame.frame)));",
          "content_same": false
        },
        {
          "line": 1152,
          "old_api": null,
          "new_api": "ionDriverWrapper::create(realm, generator_object), {} };",
          "old_text": null,
          "new_text": "ionDriverWrapper::create(realm, generator_object), {} };\n\n ",
          "old_line_content": "    //       See AwaitExpression::generate_bytecode() for the transformation.",
          "new_line_content": "        return { Completion::Type::Return, AsyncFunctionDriverWrapper::create(realm, generator_object), {} };",
          "content_same": false
        },
        {
          "line": 641,
          "old_api": null,
          "new_api": "is_local",
          "old_text": null,
          "new_text": "m->is_local()) {\n",
          "old_line_content": "",
          "new_line_content": "                    if (param->is_local()) {",
          "content_same": false
        },
        {
          "line": 642,
          "old_api": null,
          "new_api": "local_variable_index",
          "old_text": null,
          "new_text": "m->local_variable_index()] = ",
          "old_line_content": "                if constexpr (IsSame<NonnullRefPtr<Identifier const> const&, decltype(param)>) {",
          "new_line_content": "                        callee_context.local_variables[param->local_variable_index()] = argument_value;",
          "content_same": false
        },
        {
          "line": 645,
          "old_api": null,
          "new_api": "string",
          "old_text": null,
          "new_text": "m->string(), us",
          "old_line_content": "                        return {};",
          "new_line_content": "                    Reference reference = TRY(vm.resolve_binding(param->string(), used_environment));",
          "content_same": false
        },
        {
          "line": 648,
          "old_api": null,
          "new_api": "put_value",
          "old_text": null,
          "new_text": "rence.put_value(vm, argument_value);\n  ",
          "old_line_content": "                    // Here the difference from hasDuplicates is important",
          "new_line_content": "                        return reference.put_value(vm, argument_value);",
          "content_same": false
        },
        {
          "line": 649,
          "old_api": null,
          "new_api": "initialize_referenced_binding",
          "old_text": null,
          "new_text": "rence.initialize_referenced_binding(vm, argument_value);\n  ",
          "old_line_content": "                    if (m_has_duplicates)",
          "new_line_content": "                    return reference.initialize_referenced_binding(vm, argument_value);",
          "content_same": false
        },
        {
          "line": 1160,
          "old_api": null,
          "new_api": "ll",
          "old_text": null,
          "new_text": "ll());\n    aut",
          "old_line_content": "void ECMAScriptFunctionObject::set_name(DeprecatedFlyString const& name)",
          "new_line_content": "    VERIFY(!name.is_null());",
          "content_same": false
        },
        {
          "line": 1161,
          "old_api": null,
          "new_api": ";\n    m_na",
          "old_text": null,
          "new_text": ";\n    m_na",
          "old_line_content": "{",
          "new_line_content": "    auto& vm = this->vm();",
          "content_same": false
        },
        {
          "line": 653,
          "old_api": null,
          "new_api": "inding_initialization",
          "old_text": null,
          "new_text": "inding_initialization(param, argument_value, used_environment);\n  ",
          "old_line_content": "                if constexpr (IsSame<NonnullRefPtr<BindingPattern const> const&, decltype(param)>) {",
          "new_line_content": "                    return vm.binding_initialization(param, argument_value, used_environment);",
          "content_same": false
        },
        {
          "line": 677,
          "old_api": null,
          "new_api": "s_local",
          "old_text": null,
          "new_text": "s_local()) {\n",
          "old_line_content": "                //       i. If instantiatedVarNames does not contain n, then",
          "new_line_content": "                if (id.is_local()) {",
          "content_same": false
        },
        {
          "line": 678,
          "old_api": null,
          "new_api": "ndefined",
          "old_text": null,
          "new_text": "ndefined();\n  ",
          "old_line_content": "                //       1. Append n to instantiatedVarNames.",
          "new_line_content": "                    callee_context.local_variables[id.local_variable_index()] = js_undefined();",
          "content_same": false
        },
        {
          "line": 682,
          "old_api": null,
          "new_api": "tring",
          "old_text": null,
          "new_text": "tring(), fa",
          "old_line_content": "                    // 2. Perform ! env.CreateMutableBinding(n, false).",
          "new_line_content": "                    MUST(environment->create_mutable_binding(vm, id.string(), false));",
          "content_same": false
        },
        {
          "line": 683,
          "old_api": null,
          "new_api": "ndefined",
          "old_text": null,
          "new_text": "ndefined(), En",
          "old_line_content": "                    // 3. Perform ! env.InitializeBinding(n, undefined).",
          "new_line_content": "                    MUST(environment->initialize_binding(vm, id.string(), js_undefined(), Environment::InitializeBindingHint::Normal));",
          "content_same": false
        },
        {
          "line": 696,
          "old_api": null,
          "new_api": "declarative_environment",
          "old_text": null,
          "new_text": "declarative_environment(*environment);\n\n ",
          "old_line_content": "",
          "new_line_content": "        var_environment = new_declarative_environment(*environment);",
          "content_same": false
        },
        {
          "line": 717,
          "old_api": null,
          "new_api": "tring",
          "old_text": null,
          "new_text": "tring(), fa",
          "old_line_content": "",
          "new_line_content": "                MUST(var_environment->create_mutable_binding(vm, id.string(), false));",
          "content_same": false
        },
        {
          "line": 724,
          "old_api": null,
          "new_api": "ndefined",
          "old_text": null,
          "new_text": "ndefined();\n  ",
          "old_line_content": "                if (!variable_to_initialize.parameter_binding || variable_to_initialize.function_name) {",
          "new_line_content": "                    initial_value = js_undefined();",
          "content_same": false
        },
        {
          "line": 729,
          "old_api": null,
          "new_api": "s_local",
          "old_text": null,
          "new_text": "s_local()) {\n",
          "old_line_content": "                else {",
          "new_line_content": "                    if (id.is_local()) {",
          "content_same": false
        },
        {
          "line": 730,
          "old_api": null,
          "new_api": "ocal_variable_index",
          "old_text": null,
          "new_text": "ocal_variable_index()];\n ",
          "old_line_content": "                    // a. Let initialValue be ! env.GetBindingValue(n, false).",
          "new_line_content": "                        initial_value = callee_context.local_variables[id.local_variable_index()];",
          "content_same": false
        },
        {
          "line": 737,
          "old_api": null,
          "new_api": "s_local",
          "old_text": null,
          "new_text": "s_local()) {\n",
          "old_line_content": "",
          "new_line_content": "                if (id.is_local()) {",
          "content_same": false
        },
        {
          "line": 755,
          "old_api": null,
          "new_api": "create_mutable_binding",
          "old_text": null,
          "new_text": "environment->create_mutable_binding(vm, function_name, false));\n ",
          "old_line_content": "        //       an exception should not result from `for_each_function_hoistable_with_annexB_extension`.",
          "new_line_content": "            MUST(var_environment->create_mutable_binding(vm, function_name, false));",
          "content_same": false
        },
        {
          "line": 756,
          "old_api": null,
          "new_api": "ndefined",
          "old_text": null,
          "new_text": "ndefined(), En",
          "old_line_content": "        for (auto const& function_name : m_function_names_to_initialize_binding) {",
          "new_line_content": "            MUST(var_environment->initialize_binding(vm, function_name, js_undefined(), Environment::InitializeBindingHint::Normal));",
          "content_same": false
        },
        {
          "line": 767,
          "old_api": null,
          "new_api": "has_lexical_declarations",
          "old_text": null,
          "new_text": "e_body->has_lexical_declarations());\n ",
          "old_line_content": "        //               1. there is no direct call to eval() within this function",
          "new_line_content": "        bool can_elide_declarative_environment = !m_contains_direct_call_to_eval && (!scope_body || !scope_body->has_lexical_declarations());",
          "content_same": false
        },
        {
          "line": 776,
          "old_api": null,
          "new_api": "declarative_environment",
          "old_text": null,
          "new_text": "declarative_environment(*var_environment);\n  ",
          "old_line_content": "            //          lexically scoped declarations. This is not needed for strict functions because a strict direct eval always places",
          "new_line_content": "            lex_environment = new_declarative_environment(*var_environment);",
          "content_same": false
        },
        {
          "line": 794,
          "old_api": null,
          "new_api": "for_each_bound_identifier",
          "old_text": null,
          "new_text": "e_body->for_each_lexically_scoped_declaration([&](Declaration const& declaration) {\n        // NOTE: Due to the use of MUST with `create_immutable_binding` and `create_mutable_binding` below,\n        //       an exception should not result from `for_each_bound_name`.\n\n        // a. NOTE: A lexically declared name cannot be the same as a function/generator declaration, formal parameter, or a var name. Lexically declared names are only instantiated here but not initialized.\n\n        // b. For each element dn of the BoundNames of d, do\n        MUST(declaration.for_each_bound_identifier([&](auto const& id) {\n            if (id.is_local()) {\n                // NOTE: Local variables are supported only in bytecode interpreter\n                return;\n            }\n\n            // i. If IsConstantDeclaration of d is true, then\n            if (declaration.is_constant_declaration()) {\n                // 1. Perform ! lexEnv.CreateImmutableBinding(dn, true).\n                MUST(lex_environment->create_immutable_binding(vm, id.string(), true));\n            }\n            // ii. Else,\n            else {\n                // 1. Perform ! lexEnv.CreateMutableBinding(dn, false).\n                MUST(lex_environment->create_mutable_binding(vm, id.string(), false));\n            }\n        }));\n    }));\n\n",
          "old_line_content": "    // 34. For each element d of lexDeclarations, do",
          "new_line_content": "    MUST(scope_body->for_each_lexically_scoped_declaration([&](Declaration const& declaration) {",
          "content_same": false
        },
        {
          "line": 801,
          "old_api": null,
          "new_api": "for_each_bound_identifier",
          "old_text": null,
          "new_text": "aration.for_each_bound_identifier([&](auto const& id) {\n            if (id.is_local()) {\n                // NOTE: Local variables are supported only in bytecode interpreter\n                return;\n            }\n\n            // i. If IsConstantDeclaration of d is true, then\n            if (declaration.is_constant_declaration()) {\n                // 1. Perform ! lexEnv.CreateImmutableBinding(dn, true).\n                MUST(lex_environment->create_immutable_binding(vm, id.string(), true));\n            }\n            // ii. Else,\n            else {\n                // 1. Perform ! lexEnv.CreateMutableBinding(dn, false).\n                MUST(lex_environment->create_mutable_binding(vm, id.string(), false));\n            }\n        }));\n ",
          "old_line_content": "",
          "new_line_content": "        MUST(declaration.for_each_bound_identifier([&](auto const& id) {",
          "content_same": false
        },
        {
          "line": 802,
          "old_api": null,
          "new_api": "s_local",
          "old_text": null,
          "new_text": "s_local()) {\n",
          "old_line_content": "        // b. For each element dn of the BoundNames of d, do",
          "new_line_content": "            if (id.is_local()) {",
          "content_same": false
        },
        {
          "line": 808,
          "old_api": null,
          "new_api": "is_constant_declaration",
          "old_text": null,
          "new_text": "aration.is_constant_declaration()) {\n",
          "old_line_content": "",
          "new_line_content": "            if (declaration.is_constant_declaration()) {",
          "content_same": false
        },
        {
          "line": 815,
          "old_api": null,
          "new_api": "tring",
          "old_text": null,
          "new_text": "tring(), fa",
          "old_line_content": "            else {",
          "new_line_content": "                MUST(lex_environment->create_mutable_binding(vm, id.string(), false));",
          "content_same": false
        },
        {
          "line": 827,
          "old_api": null,
          "new_api": "contains_direct_call_to_eval",
          "old_text": null,
          "new_text": "aration.contains_direct_call_to_eval());\n\n",
          "old_line_content": "        // a. Let fn be the sole element of the BoundNames of f.",
          "new_line_content": "        auto function = ECMAScriptFunctionObject::create(realm, declaration.name(), declaration.source_text(), declaration.body(), declaration.parameters(), declaration.function_length(), declaration.local_variables_names(), lex_environment, private_environment, declaration.kind(), declaration.is_strict_mode(), declaration.might_need_arguments_object(), declaration.contains_direct_call_to_eval());",
          "content_same": false
        },
        {
          "line": 830,
          "old_api": null,
          "new_api": "name_identifier",
          "old_text": null,
          "new_text": "aration.name_identifier()->is_local()) {\n",
          "old_line_content": "",
          "new_line_content": "        if (declaration.name_identifier()->is_local()) {",
          "content_same": false
        },
        {
          "line": 831,
          "old_api": null,
          "new_api": "name_identifier",
          "old_text": null,
          "new_text": "aration.name_identifier()->local_variable_index()] = ",
          "old_line_content": "        // c. Perform ! varEnv.SetMutableBinding(fn, fo, false).",
          "new_line_content": "            callee_context.local_variables[declaration.name_identifier()->local_variable_index()] = function;",
          "content_same": false
        },
        {
          "line": 837,
          "old_api": null,
          "new_api": "eclarativeEnvironment>(*lex_environment))",
          "old_text": null,
          "new_text": "eclarativeEnvironment>(*lex_environment))\n  ",
          "old_line_content": "    }",
          "new_line_content": "    if (is<DeclarativeEnvironment>(*lex_environment))",
          "content_same": false
        },
        {
          "line": 838,
          "old_api": null,
          "new_api": "ptr",
          "old_text": null,
          "new_text": "environment.ptr())->s",
          "old_line_content": "",
          "new_line_content": "        static_cast<DeclarativeEnvironment*>(lex_environment.ptr())->shrink_to_fit();",
          "content_same": false
        },
        {
          "line": 849,
          "old_api": null,
          "new_api": "vm",
          "old_text": null,
          "new_text": "->vm();\n\n ",
          "old_line_content": "ThrowCompletionOr<void> ECMAScriptFunctionObject::prepare_for_ordinary_call(ExecutionContext& callee_context, Object* new_target)",
          "new_line_content": "    auto& vm = this->vm();",
          "content_same": false
        },
        {
          "line": 873,
          "old_api": null,
          "new_api": "urrent_realm",
          "old_text": null,
          "new_text": "urrent_realm();\n  ",
          "old_line_content": "    // If there's no 'current realm' either, we can't continue and crash.",
          "new_line_content": "        callee_realm = vm.current_realm();",
          "content_same": false
        },
        {
          "line": 874,
          "old_api": null,
          "new_api": "FY",
          "old_text": null,
          "new_text": "FY(callee_realm);\n\n ",
          "old_line_content": "    if (!callee_realm)",
          "new_line_content": "    VERIFY(callee_realm);",
          "content_same": false
        },
        {
          "line": 883,
          "old_api": null,
          "new_api": "function_environment",
          "old_text": null,
          "new_text": "function_environment(*this, new_target);\n\n ",
          "old_line_content": "",
          "new_line_content": "    auto local_environment = new_function_environment(*this, new_target);",
          "content_same": false
        },
        {
          "line": 898,
          "old_api": null,
          "new_api": "ush_execution_context",
          "old_text": null,
          "new_text": "ush_execution_context(callee_context, {}));\n\n",
          "old_line_content": "",
          "new_line_content": "    TRY(vm.push_execution_context(callee_context, {}));",
          "content_same": false
        },
        {
          "line": 909,
          "old_api": null,
          "new_api": "vm",
          "old_text": null,
          "new_text": "->vm();\n\n ",
          "old_line_content": "void ECMAScriptFunctionObject::ordinary_call_bind_this(ExecutionContext& callee_context, Value this_argument)",
          "new_line_content": "    auto& vm = this->vm();",
          "content_same": false
        },
        {
          "line": 926,
          "old_api": null,
          "new_api": "urrent_realm",
          "old_text": null,
          "new_text": "urrent_realm();\n  ",
          "old_line_content": "    // If there's no 'current realm' either, we can't continue and crash.",
          "new_line_content": "        callee_realm = vm.current_realm();",
          "content_same": false
        },
        {
          "line": 927,
          "old_api": null,
          "new_api": "FY",
          "old_text": null,
          "new_text": "FY(callee_realm);\n\n ",
          "old_line_content": "    if (!callee_realm)",
          "new_line_content": "    VERIFY(callee_realm);",
          "content_same": false
        },
        {
          "line": 941,
          "old_api": null,
          "new_api": "is_nullish",
          "old_text": null,
          "new_text": "_argument.is_nullish()) {\n",
          "old_line_content": "    else {",
          "new_line_content": "        if (this_argument.is_nullish()) {",
          "content_same": false
        },
        {
          "line": 944,
          "old_api": null,
          "new_api": "global_environment",
          "old_text": null,
          "new_text": "ee_realm->global_environment();\n\n ",
          "old_line_content": "            // i. Let globalEnv be calleeRealm.[[GlobalEnv]].",
          "new_line_content": "            auto& global_env = callee_realm->global_environment();",
          "content_same": false
        },
        {
          "line": 947,
          "old_api": null,
          "new_api": "global_this_value",
          "old_text": null,
          "new_text": "al_env.global_this_value();\n  ",
          "old_line_content": "",
          "new_line_content": "            this_value = &global_env.global_this_value();",
          "content_same": false
        },
        {
          "line": 952,
          "old_api": null,
          "new_api": "to_object",
          "old_text": null,
          "new_text": "_argument.to_object(vm));\n\n",
          "old_line_content": "        else {",
          "new_line_content": "            this_value = MUST(this_argument.to_object(vm));",
          "content_same": false
        },
        {
          "line": 955,
          "old_api": null,
          "new_api": "urrent_realm",
          "old_text": null,
          "new_text": "urrent_realm() == ",
          "old_line_content": "",
          "new_line_content": "            VERIFY(vm.current_realm() == callee_realm);",
          "content_same": false
        },
        {
          "line": 962,
          "old_api": null,
          "new_api": "bind_this_value",
          "old_text": null,
          "new_text": "fy_cast<FunctionEnvironment>(*local_env).bind_this_value(vm, this_value));\n\n",
          "old_line_content": "    // 8. Assert: The next step never returns an abrupt completion because localEnv.[[ThisBindingStatus]] is not initialized.",
          "new_line_content": "    MUST(verify_cast<FunctionEnvironment>(*local_env).bind_this_value(vm, this_value));",
          "content_same": false
        },
        {
          "line": 972,
          "old_api": null,
          "new_api": "unning_execution_context",
          "old_text": null,
          "new_text": "unning_execution_context();\n\n ",
          "old_line_content": "{",
          "new_line_content": "    auto& running_context = vm.running_execution_context();",
          "content_same": false
        },
        {
          "line": 975,
          "old_api": null,
          "new_api": "copy",
          "old_text": null,
          "new_text": "ing_context.copy();\n\n ",
          "old_line_content": "",
          "new_line_content": "    auto async_context = running_context.copy();",
          "content_same": false
        },
        {
          "line": 980,
          "old_api": null,
          "new_api": "c_block_start",
          "old_text": null,
          "new_text": "c_block_start(vm, async_function_body, promise_capability, async_context);\n\n ",
          "old_line_content": "",
          "new_line_content": "    async_block_start(vm, async_function_body, promise_capability, async_context);",
          "content_same": false
        },
        {
          "line": 993,
          "old_api": null,
          "new_api": "urrent_realm",
          "old_text": null,
          "new_text": "urrent_realm();\n\n ",
          "old_line_content": "    // NOTE: This function is a combination between two proposals, so does not exactly match spec steps of either.",
          "new_line_content": "    auto& realm = *vm.current_realm();",
          "content_same": false
        },
        {
          "line": 998,
          "old_api": null,
          "new_api": "unning_execution_context",
          "old_text": null,
          "new_text": "unning_execution_context();\n\n ",
          "old_line_content": "",
          "new_line_content": "    auto& running_context = vm.running_execution_context();",
          "content_same": false
        },
        {
          "line": 1001,
          "old_api": null,
          "new_api": "is_error",
          "old_text": null,
          "new_text": "veFunction::create(realm, \"\", [&realm, &async_body, &promise_capability, &async_context](auto& vm) -> ThrowCompletionOr<Value> {\n        Completion result;\n\n        // a. If asyncBody is a Parse Node, then\n        if constexpr (!IsCallableWithArguments<T, Completion>) {\n            // a. Let result be the result of evaluating asyncBody.\n            // FIXME: Cache this executable somewhere.\n            auto maybe_executable = Bytecode::compile(vm, async_body, FunctionKind::Async, \"AsyncBlockStart\"sv);\n            if (maybe_executable.is_error())\n                result = maybe_executable.release_error();\n            else\n                result = vm.bytecode_interpreter().run_and_return_frame(realm, *maybe_executable.value(), nullptr).value;\n        }\n        // b. Else,\n        else {\n            (void)realm;\n\n            // i. Assert: asyncBody is an Abstract Closure with no parameters.\n            static_assert(IsCallableWithArguments<T, Completion>);\n\n            // ii. Let result be asyncBody().\n            result = async_body();\n        }\n\n        // c. Assert: If we return here, the async function either threw an exception or performed an implicit or explicit return; all awaiting is done.\n\n        // d. Remove asyncContext from the execution context stack and restore the execution context that is at the top of the execution context stack as the running execution context.\n        vm.pop_execution_context();\n\n        // NOTE: This does not work for Array.fromAsync, likely due to conflicts between that proposal and Explicit Resource Management proposal.\n        if constexpr (!IsCallableWithArguments<T, Completion>) {\n            // e. Let env be asyncContext's LexicalEnvironment.\n            auto env = async_context.lexical_environment;\n\n            // f. Set result to DisposeResources(env, result).\n            result = dispose_resources(vm, verify_cast<DeclarativeEnvironment>(env.ptr()), result);\n        } else {\n            (void)async_context;\n        }\n\n        // g. If result.[[Type]] is normal, then\n        if (result.type() == Completion::Type::Normal) {\n            // i. Perform ! Call(promiseCapability.[[Resolve]], undefined,  undefined ).\n            MUST(call(vm, *promise_capability.resolve(), js_undefined(), js_undefined()));\n        }\n        // h. Else if result.[[Type]] is return, then\n        else if (result.type() == Completion::Type::Return) {\n            // i. Perform ! Call(promiseCapability.[[Resolve]], undefined,  result.[[Value]] ).\n            MUST(call(vm, *promise_capability.resolve(), js_undefined(), *result.value()));\n        }\n        // i. Else,\n        else {\n            // i. Assert: result.[[Type]] is throw.\n            VERIFY(result.type() == Completion::Type::Throw);\n\n            // ii. Perform ! Call(promiseCapability.[[Reject]], undefined,  result.[[Value]] ).\n            MUST(call(vm, *promise_capability.reject(), js_undefined(), *result.value()));\n        }\n        // j. Return unused.\n        // NOTE: We don't support returning an empty/optional/unused value here.\n        return js_undefined();\n    });\n\n    // ",
          "old_line_content": "",
          "new_line_content": "    auto execution_steps = NativeFunction::create(realm, \"\", [&realm, &async_body, &promise_capability, &async_context](auto& vm) -> ThrowCompletionOr<Value> {",
          "content_same": false
        },
        {
          "line": 1008,
          "old_api": null,
          "new_api": "code::compile(vm, async_body, FunctionKind::Async, \"AsyncBlockStart\"sv);",
          "old_text": null,
          "new_text": "code::compile(vm, async_body, FunctionKind::Async, \"AsyncBlockStart\"sv);\n  ",
          "old_line_content": "            // a. Let result be the result of evaluating asyncBody.",
          "new_line_content": "            auto maybe_executable = Bytecode::compile(vm, async_body, FunctionKind::Async, \"AsyncBlockStart\"sv);",
          "content_same": false
        },
        {
          "line": 1009,
          "old_api": null,
          "new_api": "is_error",
          "old_text": null,
          "new_text": "e_executable.is_error())\n  ",
          "old_line_content": "            // FIXME: Cache this executable somewhere.",
          "new_line_content": "            if (maybe_executable.is_error())",
          "content_same": false
        },
        {
          "line": 1022,
          "old_api": null,
          "new_api": "c_body",
          "old_text": null,
          "new_text": "c_body();\n  ",
          "old_line_content": "",
          "new_line_content": "            result = async_body();",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 1024,
          "old_api": "c_body",
          "new_api": null,
          "old_text": "c_body();\n  ",
          "new_text": null,
          "old_line_content": "            result = async_body();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1030,
          "old_api": "op_execution_context",
          "new_api": null,
          "old_text": "op_execution_context();\n\n ",
          "new_text": null,
          "old_line_content": "        vm.pop_execution_context();",
          "new_line_content": "        // NOTE: This does not work for Array.fromAsync, likely due to conflicts between that proposal and Explicit Resource Management proposal.",
          "content_same": false
        },
        {
          "line": 1038,
          "old_api": "ptr",
          "new_api": null,
          "old_text": "ptr()), r",
          "new_text": null,
          "old_line_content": "            result = dispose_resources(vm, verify_cast<DeclarativeEnvironment>(env.ptr()), result);",
          "new_line_content": "            (void)async_context;",
          "content_same": false
        },
        {
          "line": 1046,
          "old_api": "efined",
          "new_api": null,
          "old_text": "efined()));\n  ",
          "new_text": null,
          "old_line_content": "            MUST(call(vm, *promise_capability.resolve(), js_undefined(), js_undefined()));",
          "new_line_content": "        // h. Else if result.[[Type]] is return, then",
          "content_same": false
        },
        {
          "line": 1051,
          "old_api": "alue",
          "new_api": null,
          "old_text": "alue()));\n    ",
          "new_text": null,
          "old_line_content": "            MUST(call(vm, *promise_capability.resolve(), js_undefined(), *result.value()));",
          "new_line_content": "        // i. Else,",
          "content_same": false
        },
        {
          "line": 1056,
          "old_api": "ype",
          "new_api": null,
          "old_text": "ype() == Comp",
          "new_text": null,
          "old_line_content": "            VERIFY(result.type() == Completion::Type::Throw);",
          "new_line_content": "            // ii. Perform ! Call(promiseCapability.[[Reject]], undefined,  result.[[Value]] ).",
          "content_same": false
        },
        {
          "line": 547,
          "old_api": "has_binding",
          "new_api": null,
          "old_text": "vironment->has_binding(parameter_name));",
          "new_text": null,
          "old_line_content": "        auto already_declared = MUST(environment->has_binding(parameter_name));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1059,
          "old_api": "ue",
          "new_api": null,
          "old_text": "ue()));\n      ",
          "new_text": null,
          "old_line_content": "            MUST(call(vm, *promise_capability.reject(), js_undefined(), *result.value()));",
          "new_line_content": "        // j. Return unused.",
          "content_same": false
        },
        {
          "line": 1063,
          "old_api": "ed",
          "new_api": null,
          "old_text": "ed();\n    });\n",
          "new_text": null,
          "old_line_content": "        return js_undefined();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 554,
          "old_api": "create_mutable_binding",
          "new_api": null,
          "old_text": "vironment->create_mutable_binding(vm, parameter_name, false));",
          "new_text": null,
          "old_line_content": "            MUST(environment->create_mutable_binding(vm, parameter_name, false));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1067,
          "old_api": "ecution_context",
          "new_api": null,
          "old_text": "ecution_context(async_context, {});\n    if (",
          "new_text": null,
          "old_line_content": "    auto push_result = vm.push_execution_context(async_context, {});",
          "new_line_content": "        return;",
          "content_same": false
        },
        {
          "line": 1068,
          "old_api": "is_error",
          "new_api": null,
          "old_text": "t.is_error())\n        ",
          "new_text": null,
          "old_line_content": "    if (push_result.is_error())",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 559,
          "old_api": "_undefined",
          "new_api": null,
          "old_text": "_undefined(), ",
          "new_text": null,
          "old_line_content": "                MUST(environment->initialize_binding(vm, parameter_name, js_undefined(), Environment::InitializeBindingHint::Normal));",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 1072,
          "old_api": "ed",
          "new_api": null,
          "old_text": "ed() : async_c",
          "new_text": null,
          "old_line_content": "    auto result = call(vm, *execution_steps, async_context.this_value.is_empty() ? js_undefined() : async_context.this_value);",
          "new_line_content": "    // 6. Assert: When we return here, asyncContext has already been removed from the execution context stack and runningContext is the currently running execution context.",
          "content_same": false
        },
        {
          "line": 1075,
          "old_api": "_execution_context",
          "new_api": null,
          "old_text": "_execution_context() == &runni",
          "new_text": null,
          "old_line_content": "    VERIFY(&vm.running_execution_context() == &running_context);",
          "new_line_content": "    // 7. Assert: result is a normal completion with a value of unused. The possible sources of this value are Await or, if the async function doesn't await anything, step 3.g above.",
          "content_same": false
        },
        {
          "line": 1078,
          "old_api": "is_undefined",
          "new_api": null,
          "old_text": "ue().is_undefined());\n\n    //",
          "new_text": null,
          "old_line_content": "    VERIFY(result.has_value() && result.value().is_undefined());",
          "new_line_content": "    // 8. Return unused.",
          "content_same": false
        },
        {
          "line": 571,
          "old_api": "running_execution_context",
          "new_api": null,
          "old_text": ".running_execution_context().a",
          "new_text": null,
          "old_line_content": "            arguments_object = create_unmapped_arguments_object(vm, vm.running_execution_context().arguments);",
          "new_line_content": "        // b. Else,",
          "content_same": false
        },
        {
          "line": 578,
          "old_api": "running_execution_context",
          "new_api": null,
          "old_text": ".running_execution_context().a",
          "new_text": null,
          "old_line_content": "            arguments_object = create_mapped_arguments_object(vm, *this, formal_parameters(), vm.running_execution_context().arguments, *environment);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1093,
          "old_api": ";\n    auto",
          "new_api": null,
          "old_text": ";\n    auto",
          "new_text": null,
          "old_line_content": "    auto& vm = this->vm();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1094,
          "old_api": "_realm",
          "new_api": null,
          "old_text": "_realm();\n\n    // ",
          "new_text": null,
          "old_line_content": "    auto& realm = *vm.current_realm();",
          "new_line_content": "    // NOTE: There's a subtle ordering issue here:",
          "content_same": false
        },
        {
          "line": 584,
          "old_api": "as_string",
          "new_api": null,
          "old_text": ".names.arguments.as_string(), ",
          "new_text": null,
          "old_line_content": "            MUST(environment->create_immutable_binding(vm, vm.names.arguments.as_string(), false));",
          "new_line_content": "            // ii. NOTE: In strict mode code early errors prevent attempting to assign to this binding, so its mutability is not observable.",
          "content_same": false
        },
        {
          "line": 591,
          "old_api": "as_string",
          "new_api": null,
          "old_text": ".names.arguments.as_string(), ",
          "new_text": null,
          "old_line_content": "            MUST(environment->create_mutable_binding(vm, vm.names.arguments.as_string(), false));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 595,
          "old_api": "as_string",
          "new_api": null,
          "old_text": ".names.arguments.as_string(), ",
          "new_text": null,
          "old_line_content": "        MUST(environment->initialize_binding(vm, vm.names.arguments.as_string(), arguments_object, Environment::InitializeBindingHint::Normal));",
          "new_line_content": "        // f. Let parameterBindings be the list-concatenation of parameterNames and  \"arguments\" .",
          "content_same": false
        },
        {
          "line": 1108,
          "old_api": "String::formatted(\"default parameter #{} for {}\", default_parameter_index, m_name)));",
          "new_api": null,
          "old_text": "String::formatted(\"default parameter #{} for {}\", default_parameter_index, m_name)));\n      ",
          "new_text": null,
          "old_line_content": "            auto executable = TRY(Bytecode::compile(vm, *parameter.default_value, FunctionKind::Normal, DeprecatedString::formatted(\"default parameter #{} for {}\", default_parameter_index, m_name)));",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 1109,
          "old_api": "table));",
          "new_api": null,
          "old_text": "table));\n       ",
          "new_text": null,
          "old_line_content": "            m_default_parameter_bytecode_executables.append(move(executable));",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1113,
          "old_api": "eclaration_instantiation",
          "new_api": null,
          "old_text": "eclaration_instantiation();\n\n    if ",
          "new_text": null,
          "old_line_content": "    auto declaration_result = function_declaration_instantiation();",
          "new_line_content": "    if (m_kind == FunctionKind::Normal || m_kind == FunctionKind::Generator || m_kind == FunctionKind::AsyncGenerator) {",
          "content_same": false
        },
        {
          "line": 1116,
          "old_api": "is_error",
          "new_api": null,
          "old_text": "n_result.is_error())\n        ",
          "new_text": null,
          "old_line_content": "        if (declaration_result.is_error())",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1117,
          "old_api": "release_error",
          "new_api": null,
          "old_text": "n_result.release_error();\n    }\n\n ",
          "new_text": null,
          "old_line_content": "            return declaration_result.release_error();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1121,
          "old_api": "compile",
          "new_api": null,
          "old_text": "compile(vm, *m_ecmascript_code, m_kind, m_name));\n\n    if",
          "new_text": null,
          "old_line_content": "        m_bytecode_executable = TRY(Bytecode::compile(vm, *m_ecmascript_code, m_kind, m_name));",
          "new_line_content": "    if (m_kind == FunctionKind::Async) {",
          "content_same": false
        },
        {
          "line": 612,
          "old_api": "unning_execution_context",
          "new_api": null,
          "old_text": "unning_execution_context().arg",
          "new_text": null,
          "old_line_content": "    auto& execution_context_arguments = vm.running_execution_context().arguments;",
          "new_line_content": "    size_t default_parameter_index = 0;",
          "content_same": false
        },
        {
          "line": 1126,
          "old_api": "throw_completion",
          "new_api": null,
          "old_text": "n_result.throw_completion().value()));\n      ",
          "new_text": null,
          "old_line_content": "            MUST(call(vm, *promise_capability->reject(), js_undefined(), *declaration_result.throw_completion().value()));",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 615,
          "old_api": "size",
          "new_api": null,
          "old_text": "rmal_parameters.size(); ++",
          "new_text": null,
          "old_line_content": "    for (size_t i = 0; i < m_formal_parameters.size(); ++i) {",
          "new_line_content": "        if (parameter.default_value)",
          "content_same": false
        },
        {
          "line": 1127,
          "old_api": "promise",
          "new_api": null,
          "old_text": "pability->promise(), {} };\n  ",
          "new_text": null,
          "old_line_content": "            return Completion { Completion::Type::Return, promise_capability->promise(), {} };",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 620,
          "old_api": "visit",
          "new_api": null,
          "old_text": "meter.binding.visit(\n            [&](auto const& param) -> ThrowCompletionOr<void> {\n                Value argument_value;\n                if (parameter.is_rest) {\n                    auto array = MUST(Array::create(realm, 0));\n                    for (size_t rest_index = i; rest_index < execution_context_arguments.size(); ++rest_index)\n                        array->indexed_properties().append(execution_context_arguments[rest_index]);\n                    argument_value = array;\n                } else if (i < execution_context_arguments.size() && !execution_context_arguments[i].is_undefined()) {\n                    argument_value = execution_context_arguments[i];\n                } else if (parameter.default_value) {\n                    auto value_and_frame = vm.bytecode_interpreter().run_and_return_frame(realm, *m_default_parameter_bytecode_executables[default_parameter_index - 1], nullptr);\n                    if (value_and_frame.value.is_error())\n                        return value_and_frame.value.release_error();\n                    // Resulting value is in the accumulator.\n                    argument_value = value_and_frame.frame->registers.at(0);\n                } else {\n                    argument_value = js_undefined();\n                }\n\n                Environment* used_environment = m_has_duplicates ? nullptr : environment;\n\n                if constexpr (IsSame<NonnullRefPtr<Identifier const> const&, decltype(param)>) {\n                    if (param->is_local()) {\n                        callee_context.local_variables[param->local_variable_index()] = argument_value;\n                        return {};\n                    }\n                    Reference reference = TRY(vm.resolve_binding(param->string(), used_environment));\n                    // Here the difference from hasDuplicates is important\n                    if (m_has_duplicates)\n                        return reference.put_value(vm, argument_value);\n                    return reference.initialize_referenced_binding(vm, argument_value);\n                }\n                if constexpr (IsSame<NonnullRefPtr<BindingPattern const> const&, decltype(param)>) {\n                    // Here the difference from hasDuplicates is important\n                    return vm.binding_initialization(param, argument_value, used_environment);\n                }\n            }));\n ",
          "new_text": null,
          "old_line_content": "        TRY(parameter.binding.visit(",
          "new_line_content": "                Value argument_value;",
          "content_same": false
        },
        {
          "line": 1134,
          "old_api": "is_error",
          "new_api": null,
          "old_text": "_frame.value.is_error())\n        ",
          "new_text": null,
          "old_line_content": "    if (result_and_frame.value.is_error())",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 625,
          "old_api": "size",
          "new_api": null,
          "old_text": "ution_context_arguments.size(); ++",
          "new_text": null,
          "old_line_content": "                    for (size_t rest_index = i; rest_index < execution_context_arguments.size(); ++rest_index)",
          "new_line_content": "                    argument_value = array;",
          "content_same": false
        },
        {
          "line": 1137,
          "old_api": "release_value",
          "new_api": null,
          "old_text": "_frame.value.release_value();\n\n    // ",
          "new_text": null,
          "old_line_content": "    auto result = result_and_frame.value.release_value();",
          "new_line_content": "    // NOTE: Running the bytecode should eventually return a completion.",
          "content_same": false
        },
        {
          "line": 628,
          "old_api": "is_undefined",
          "new_api": null,
          "old_text": "ution_context_arguments[i].is_undefined()) {\n",
          "new_text": null,
          "old_line_content": "                } else if (i < execution_context_arguments.size() && !execution_context_arguments[i].is_undefined()) {",
          "new_line_content": "                } else if (parameter.default_value) {",
          "content_same": false
        },
        {
          "line": 1142,
          "old_api": "ed",
          "new_api": null,
          "old_text": "ed()), {} };\n\n",
          "new_text": null,
          "old_line_content": "        return { Completion::Type::Return, result.value_or(js_undefined()), {} };",
          "new_line_content": "    if (m_kind == FunctionKind::AsyncGenerator) {",
          "content_same": false
        },
        {
          "line": 632,
          "old_api": "is_error",
          "new_api": null,
          "old_text": "e_and_frame.value.is_error())\n  ",
          "new_text": null,
          "old_line_content": "                    if (value_and_frame.value.is_error())",
          "new_line_content": "                    // Resulting value is in the accumulator.",
          "content_same": false
        },
        {
          "line": 1145,
          "old_api": "lt_and_frame.frame)));",
          "new_api": null,
          "old_text": "lt_and_frame.frame)));\n      ",
          "new_text": null,
          "old_line_content": "        auto async_generator_object = TRY(AsyncGenerator::create(realm, result, this, vm.running_execution_context().copy(), move(*result_and_frame.frame)));",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1149,
          "old_api": "lt_and_frame.frame)));\n\n    /",
          "new_api": null,
          "old_text": "lt_and_frame.frame)));\n\n    /",
          "new_text": null,
          "old_line_content": "    auto generator_object = TRY(GeneratorObject::create(realm, result, this, vm.running_execution_context().copy(), move(*result_and_frame.frame)));",
          "new_line_content": "    // NOTE: Async functions are entirely transformed to generator functions, and wrapped in a custom driver that returns a promise",
          "content_same": false
        },
        {
          "line": 637,
          "old_api": "ndefined",
          "new_api": null,
          "old_text": "ndefined();\n  ",
          "new_text": null,
          "old_line_content": "                    argument_value = js_undefined();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 643,
          "old_api": "is_local",
          "new_api": null,
          "old_text": "m->is_local()) {\n",
          "new_text": null,
          "old_line_content": "                    if (param->is_local()) {",
          "new_line_content": "                        return {};",
          "content_same": false
        },
        {
          "line": 644,
          "old_api": "local_variable_index",
          "new_api": null,
          "old_text": "m->local_variable_index()] = ",
          "new_text": null,
          "old_line_content": "                        callee_context.local_variables[param->local_variable_index()] = argument_value;",
          "new_line_content": "                    }",
          "content_same": false
        },
        {
          "line": 1156,
          "old_api": "ind == FunctionKind::Generator);\n    retu",
          "new_api": null,
          "old_text": "ind == FunctionKind::Generator);\n    retu",
          "new_text": null,
          "old_line_content": "    VERIFY(m_kind == FunctionKind::Generator);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 647,
          "old_api": "string",
          "new_api": null,
          "old_text": "m->string(), us",
          "new_text": null,
          "old_line_content": "                    Reference reference = TRY(vm.resolve_binding(param->string(), used_environment));",
          "new_line_content": "                    if (m_has_duplicates)",
          "content_same": false
        },
        {
          "line": 650,
          "old_api": "put_value",
          "new_api": null,
          "old_text": "rence.put_value(vm, argument_value);\n  ",
          "new_text": null,
          "old_line_content": "                        return reference.put_value(vm, argument_value);",
          "new_line_content": "                }",
          "content_same": false
        },
        {
          "line": 651,
          "old_api": "initialize_referenced_binding",
          "new_api": null,
          "old_text": "rence.initialize_referenced_binding(vm, argument_value);\n  ",
          "new_text": null,
          "old_line_content": "                    return reference.initialize_referenced_binding(vm, argument_value);",
          "new_line_content": "                if constexpr (IsSame<NonnullRefPtr<BindingPattern const> const&, decltype(param)>) {",
          "content_same": false
        },
        {
          "line": 1162,
          "old_api": "ll",
          "new_api": null,
          "old_text": "ll());\n    aut",
          "new_text": null,
          "old_line_content": "    VERIFY(!name.is_null());",
          "new_line_content": "    m_name = name;",
          "content_same": false
        },
        {
          "line": 1165,
          "old_api": "tring::create(vm, m_name), .writabl",
          "new_api": null,
          "old_text": "tring::create(vm, m_name), .writabl",
          "new_text": null,
          "old_line_content": "    MUST(define_property_or_throw(vm.names.name, { .value = PrimitiveString::create(vm, m_name), .writable = false, .enumerable = false, .configurable = true }));",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 655,
          "old_api": "inding_initialization",
          "new_api": null,
          "old_text": "inding_initialization(param, argument_value, used_environment);\n  ",
          "new_text": null,
          "old_line_content": "                    return vm.binding_initialization(param, argument_value, used_environment);",
          "new_line_content": "            }));",
          "content_same": false
        },
        {
          "line": 679,
          "old_api": "s_local",
          "new_api": null,
          "old_text": "s_local()) {\n",
          "new_text": null,
          "old_line_content": "                if (id.is_local()) {",
          "new_line_content": "                } else {",
          "content_same": false
        },
        {
          "line": 680,
          "old_api": "ndefined",
          "new_api": null,
          "old_text": "ndefined();\n  ",
          "new_text": null,
          "old_line_content": "                    callee_context.local_variables[id.local_variable_index()] = js_undefined();",
          "new_line_content": "                    // 2. Perform ! env.CreateMutableBinding(n, false).",
          "content_same": false
        },
        {
          "line": 684,
          "old_api": "tring",
          "new_api": null,
          "old_text": "tring(), fa",
          "new_text": null,
          "old_line_content": "                    MUST(environment->create_mutable_binding(vm, id.string(), false));",
          "new_line_content": "                }",
          "content_same": false
        },
        {
          "line": 685,
          "old_api": "ndefined",
          "new_api": null,
          "old_text": "ndefined(), En",
          "new_text": null,
          "old_line_content": "                    MUST(environment->initialize_binding(vm, id.string(), js_undefined(), Environment::InitializeBindingHint::Normal));",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 698,
          "old_api": "declarative_environment",
          "new_api": null,
          "old_text": "declarative_environment(*environment);\n\n ",
          "new_text": null,
          "old_line_content": "        var_environment = new_declarative_environment(*environment);",
          "new_line_content": "        // c. Set the VariableEnvironment of calleeContext to varEnv.",
          "content_same": false
        },
        {
          "line": 719,
          "old_api": "tring",
          "new_api": null,
          "old_text": "tring(), fa",
          "new_text": null,
          "old_line_content": "                MUST(var_environment->create_mutable_binding(vm, id.string(), false));",
          "new_line_content": "                Value initial_value;",
          "content_same": false
        },
        {
          "line": 726,
          "old_api": "ndefined",
          "new_api": null,
          "old_text": "ndefined();\n  ",
          "new_text": null,
          "old_line_content": "                    initial_value = js_undefined();",
          "new_line_content": "                // 4. Else,",
          "content_same": false
        },
        {
          "line": 731,
          "old_api": "s_local",
          "new_api": null,
          "old_text": "s_local()) {\n",
          "new_text": null,
          "old_line_content": "                    if (id.is_local()) {",
          "new_line_content": "                    } else {",
          "content_same": false
        },
        {
          "line": 734,
          "old_api": "tring",
          "new_api": null,
          "old_text": "tring(), fa",
          "new_text": null,
          "old_line_content": "                        initial_value = MUST(environment->get_binding_value(vm, id.string(), false));",
          "new_line_content": "                }",
          "content_same": false
        },
        {
          "line": 743,
          "old_api": "tring",
          "new_api": null,
          "old_text": "tring(), in",
          "new_text": null,
          "old_line_content": "                    MUST(var_environment->initialize_binding(vm, id.string(), initial_value, Environment::InitializeBindingHint::Normal));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 757,
          "old_api": "create_mutable_binding",
          "new_api": null,
          "old_text": "environment->create_mutable_binding(vm, function_name, false));\n ",
          "new_text": null,
          "old_line_content": "            MUST(var_environment->create_mutable_binding(vm, function_name, false));",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 758,
          "old_api": "ndefined",
          "new_api": null,
          "old_text": "ndefined(), En",
          "new_text": null,
          "old_line_content": "            MUST(var_environment->initialize_binding(vm, function_name, js_undefined(), Environment::InitializeBindingHint::Normal));",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 769,
          "old_api": "has_lexical_declarations",
          "new_api": null,
          "old_text": "e_body->has_lexical_declarations());\n ",
          "new_text": null,
          "old_line_content": "        bool can_elide_declarative_environment = !m_contains_direct_call_to_eval && (!scope_body || !scope_body->has_lexical_declarations());",
          "new_line_content": "            lex_environment = var_environment;",
          "content_same": false
        },
        {
          "line": 778,
          "old_api": "declarative_environment",
          "new_api": null,
          "old_text": "declarative_environment(*var_environment);\n  ",
          "new_text": null,
          "old_line_content": "            lex_environment = new_declarative_environment(*var_environment);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 796,
          "old_api": "for_each_bound_identifier",
          "new_api": null,
          "old_text": "e_body->for_each_lexically_scoped_declaration([&](Declaration const& declaration) {\n        // NOTE: Due to the use of MUST with `create_immutable_binding` and `create_mutable_binding` below,\n        //       an exception should not result from `for_each_bound_name`.\n\n        // a. NOTE: A lexically declared name cannot be the same as a function/generator declaration, formal parameter, or a var name. Lexically declared names are only instantiated here but not initialized.\n\n        // b. For each element dn of the BoundNames of d, do\n        MUST(declaration.for_each_bound_identifier([&](auto const& id) {\n            if (id.is_local()) {\n                // NOTE: Local variables are supported only in bytecode interpreter\n                return;\n            }\n\n            // i. If IsConstantDeclaration of d is true, then\n            if (declaration.is_constant_declaration()) {\n                // 1. Perform ! lexEnv.CreateImmutableBinding(dn, true).\n                MUST(lex_environment->create_immutable_binding(vm, id.string(), true));\n            }\n            // ii. Else,\n            else {\n                // 1. Perform ! lexEnv.CreateMutableBinding(dn, false).\n                MUST(lex_environment->create_mutable_binding(vm, id.string(), false));\n            }\n        }));\n    }));\n\n",
          "new_text": null,
          "old_line_content": "    MUST(scope_body->for_each_lexically_scoped_declaration([&](Declaration const& declaration) {",
          "new_line_content": "        //       an exception should not result from `for_each_bound_name`.",
          "content_same": false
        },
        {
          "line": 803,
          "old_api": "for_each_bound_identifier",
          "new_api": null,
          "old_text": "aration.for_each_bound_identifier([&](auto const& id) {\n            if (id.is_local()) {\n                // NOTE: Local variables are supported only in bytecode interpreter\n                return;\n            }\n\n            // i. If IsConstantDeclaration of d is true, then\n            if (declaration.is_constant_declaration()) {\n                // 1. Perform ! lexEnv.CreateImmutableBinding(dn, true).\n                MUST(lex_environment->create_immutable_binding(vm, id.string(), true));\n            }\n            // ii. Else,\n            else {\n                // 1. Perform ! lexEnv.CreateMutableBinding(dn, false).\n                MUST(lex_environment->create_mutable_binding(vm, id.string(), false));\n            }\n        }));\n ",
          "new_text": null,
          "old_line_content": "        MUST(declaration.for_each_bound_identifier([&](auto const& id) {",
          "new_line_content": "                // NOTE: Local variables are supported only in bytecode interpreter",
          "content_same": false
        },
        {
          "line": 804,
          "old_api": "s_local",
          "new_api": null,
          "old_text": "s_local()) {\n",
          "new_text": null,
          "old_line_content": "            if (id.is_local()) {",
          "new_line_content": "                return;",
          "content_same": false
        },
        {
          "line": 812,
          "old_api": "tring",
          "new_api": null,
          "old_text": "tring(), tr",
          "new_text": null,
          "old_line_content": "                MUST(lex_environment->create_immutable_binding(vm, id.string(), true));",
          "new_line_content": "            // ii. Else,",
          "content_same": false
        },
        {
          "line": 817,
          "old_api": "tring",
          "new_api": null,
          "old_text": "tring(), fa",
          "new_text": null,
          "old_line_content": "                MUST(lex_environment->create_mutable_binding(vm, id.string(), false));",
          "new_line_content": "        }));",
          "content_same": false
        },
        {
          "line": 829,
          "old_api": "contains_direct_call_to_eval",
          "new_api": null,
          "old_text": "aration.contains_direct_call_to_eval());\n\n",
          "new_text": null,
          "old_line_content": "        auto function = ECMAScriptFunctionObject::create(realm, declaration.name(), declaration.source_text(), declaration.body(), declaration.parameters(), declaration.function_length(), declaration.local_variables_names(), lex_environment, private_environment, declaration.kind(), declaration.is_strict_mode(), declaration.might_need_arguments_object(), declaration.contains_direct_call_to_eval());",
          "new_line_content": "        // c. Perform ! varEnv.SetMutableBinding(fn, fo, false).",
          "content_same": false
        },
        {
          "line": 832,
          "old_api": "name_identifier",
          "new_api": null,
          "old_text": "aration.name_identifier()->is_local()) {\n",
          "new_text": null,
          "old_line_content": "        if (declaration.name_identifier()->is_local()) {",
          "new_line_content": "        } else {",
          "content_same": false
        },
        {
          "line": 835,
          "old_api": "name",
          "new_api": null,
          "old_text": "aration.name(), fu",
          "new_text": null,
          "old_line_content": "            MUST(var_environment->set_mutable_binding(vm, declaration.name(), function, false));",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 841,
          "old_api": "eclarativeEnvironment>(*var_environment))",
          "new_api": null,
          "old_text": "eclarativeEnvironment>(*var_environment))\n  ",
          "new_text": null,
          "old_line_content": "    if (is<DeclarativeEnvironment>(*var_environment))",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 842,
          "old_api": "ptr",
          "new_api": null,
          "old_text": "environment.ptr())->s",
          "new_text": null,
          "old_line_content": "        static_cast<DeclarativeEnvironment*>(var_environment.ptr())->shrink_to_fit();",
          "new_line_content": "    // 37. Return unused.",
          "content_same": false
        },
        {
          "line": 851,
          "old_api": "vm",
          "new_api": null,
          "old_text": "->vm();\n\n ",
          "new_text": null,
          "old_line_content": "    auto& vm = this->vm();",
          "new_line_content": "    // Non-standard",
          "content_same": false
        },
        {
          "line": 875,
          "old_api": "urrent_realm",
          "new_api": null,
          "old_text": "urrent_realm();\n  ",
          "new_text": null,
          "old_line_content": "        callee_realm = vm.current_realm();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 876,
          "old_api": "FY",
          "new_api": null,
          "old_text": "FY(callee_realm);\n\n ",
          "new_text": null,
          "old_line_content": "    VERIFY(callee_realm);",
          "new_line_content": "    // 5. Set the Realm of calleeContext to calleeRealm.",
          "content_same": false
        },
        {
          "line": 885,
          "old_api": "function_environment",
          "new_api": null,
          "old_text": "function_environment(*this, new_target);\n\n ",
          "new_text": null,
          "old_line_content": "    auto local_environment = new_function_environment(*this, new_target);",
          "new_line_content": "    // 8. Set the LexicalEnvironment of calleeContext to localEnv.",
          "content_same": false
        },
        {
          "line": 900,
          "old_api": "ush_execution_context",
          "new_api": null,
          "old_text": "ush_execution_context(callee_context, {}));\n\n",
          "new_text": null,
          "old_line_content": "    TRY(vm.push_execution_context(callee_context, {}));",
          "new_line_content": "    // 13. NOTE: Any exception objects produced after this point are associated with calleeRealm.",
          "content_same": false
        },
        {
          "line": 911,
          "old_api": "vm",
          "new_api": null,
          "old_text": "->vm();\n\n ",
          "new_text": null,
          "old_line_content": "    auto& vm = this->vm();",
          "new_line_content": "    // 1. Let thisMode be F.[[ThisMode]].",
          "content_same": false
        },
        {
          "line": 928,
          "old_api": "urrent_realm",
          "new_api": null,
          "old_text": "urrent_realm();\n  ",
          "new_text": null,
          "old_line_content": "        callee_realm = vm.current_realm();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 929,
          "old_api": "FY",
          "new_api": null,
          "old_text": "FY(callee_realm);\n\n ",
          "new_text": null,
          "old_line_content": "    VERIFY(callee_realm);",
          "new_line_content": "    // 4. Let localEnv be the LexicalEnvironment of calleeContext.",
          "content_same": false
        },
        {
          "line": 943,
          "old_api": "is_nullish",
          "new_api": null,
          "old_text": "_argument.is_nullish()) {\n",
          "new_text": null,
          "old_line_content": "        if (this_argument.is_nullish()) {",
          "new_line_content": "            // ii. Assert: globalEnv is a global Environment Record.",
          "content_same": false
        },
        {
          "line": 946,
          "old_api": "global_environment",
          "new_api": null,
          "old_text": "ee_realm->global_environment();\n\n ",
          "new_text": null,
          "old_line_content": "            auto& global_env = callee_realm->global_environment();",
          "new_line_content": "            // iii. Let thisValue be globalEnv.[[GlobalThisValue]].",
          "content_same": false
        },
        {
          "line": 949,
          "old_api": "global_this_value",
          "new_api": null,
          "old_text": "al_env.global_this_value();\n  ",
          "new_text": null,
          "old_line_content": "            this_value = &global_env.global_this_value();",
          "new_line_content": "        // b. Else,",
          "content_same": false
        },
        {
          "line": 954,
          "old_api": "to_object",
          "new_api": null,
          "old_text": "_argument.to_object(vm));\n\n",
          "new_text": null,
          "old_line_content": "            this_value = MUST(this_argument.to_object(vm));",
          "new_line_content": "            // ii. NOTE: ToObject produces wrapper objects using calleeRealm.",
          "content_same": false
        },
        {
          "line": 957,
          "old_api": "urrent_realm",
          "new_api": null,
          "old_text": "urrent_realm() == ",
          "new_text": null,
          "old_line_content": "            VERIFY(vm.current_realm() == callee_realm);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 964,
          "old_api": "bind_this_value",
          "new_api": null,
          "old_text": "fy_cast<FunctionEnvironment>(*local_env).bind_this_value(vm, this_value));\n\n",
          "new_text": null,
          "old_line_content": "    MUST(verify_cast<FunctionEnvironment>(*local_env).bind_this_value(vm, this_value));",
          "new_line_content": "    // 10. Return unused.",
          "content_same": false
        },
        {
          "line": 974,
          "old_api": "unning_execution_context",
          "new_api": null,
          "old_text": "unning_execution_context();\n\n ",
          "new_text": null,
          "old_line_content": "    auto& running_context = vm.running_execution_context();",
          "new_line_content": "    // 2. Let asyncContext be a copy of runningContext.",
          "content_same": false
        },
        {
          "line": 977,
          "old_api": "copy",
          "new_api": null,
          "old_text": "ing_context.copy();\n\n ",
          "new_text": null,
          "old_line_content": "    auto async_context = running_context.copy();",
          "new_line_content": "    // 3. NOTE: Copying the execution state is required for AsyncBlockStart to resume its execution. It is ill-defined to resume a currently executing context.",
          "content_same": false
        },
        {
          "line": 982,
          "old_api": "c_block_start",
          "new_api": null,
          "old_text": "c_block_start(vm, async_function_body, promise_capability, async_context);\n\n ",
          "new_text": null,
          "old_line_content": "    async_block_start(vm, async_function_body, promise_capability, async_context);",
          "new_line_content": "    // 5. Return unused.",
          "content_same": false
        },
        {
          "line": 995,
          "old_api": "urrent_realm",
          "new_api": null,
          "old_text": "urrent_realm();\n\n ",
          "new_text": null,
          "old_line_content": "    auto& realm = *vm.current_realm();",
          "new_line_content": "    // 1. Assert: promiseCapability is a PromiseCapability Record.",
          "content_same": false
        },
        {
          "line": 1000,
          "old_api": "unning_execution_context",
          "new_api": null,
          "old_text": "unning_execution_context();\n\n ",
          "new_text": null,
          "old_line_content": "    auto& running_context = vm.running_execution_context();",
          "new_line_content": "    // 3. Set the code evaluation state of asyncContext such that when evaluation is resumed for that execution context the following steps will be performed:",
          "content_same": false
        },
        {
          "line": 1003,
          "old_api": "is_error",
          "new_api": null,
          "old_text": "veFunction::create(realm, \"\", [&realm, &async_body, &promise_capability, &async_context](auto& vm) -> ThrowCompletionOr<Value> {\n        Completion result;\n\n        // a. If asyncBody is a Parse Node, then\n        if constexpr (!IsCallableWithArguments<T, Completion>) {\n            // a. Let result be the result of evaluating asyncBody.\n            // FIXME: Cache this executable somewhere.\n            auto maybe_executable = Bytecode::compile(vm, async_body, FunctionKind::Async, \"AsyncBlockStart\"sv);\n            if (maybe_executable.is_error())\n                result = maybe_executable.release_error();\n            else\n                result = vm.bytecode_interpreter().run_and_return_frame(realm, *maybe_executable.value(), nullptr).value;\n        }\n        // b. Else,\n        else {\n            (void)realm;\n\n            // i. Assert: asyncBody is an Abstract Closure with no parameters.\n            static_assert(IsCallableWithArguments<T, Completion>);\n\n            // ii. Let result be asyncBody().\n            result = async_body();\n        }\n\n        // c. Assert: If we return here, the async function either threw an exception or performed an implicit or explicit return; all awaiting is done.\n\n        // d. Remove asyncContext from the execution context stack and restore the execution context that is at the top of the execution context stack as the running execution context.\n        vm.pop_execution_context();\n\n        // NOTE: This does not work for Array.fromAsync, likely due to conflicts between that proposal and Explicit Resource Management proposal.\n        if constexpr (!IsCallableWithArguments<T, Completion>) {\n            // e. Let env be asyncContext's LexicalEnvironment.\n            auto env = async_context.lexical_environment;\n\n            // f. Set result to DisposeResources(env, result).\n            result = dispose_resources(vm, verify_cast<DeclarativeEnvironment>(env.ptr()), result);\n        } else {\n            (void)async_context;\n        }\n\n        // g. If result.[[Type]] is normal, then\n        if (result.type() == Completion::Type::Normal) {\n            // i. Perform ! Call(promiseCapability.[[Resolve]], undefined,  undefined ).\n            MUST(call(vm, *promise_capability.resolve(), js_undefined(), js_undefined()));\n        }\n        // h. Else if result.[[Type]] is return, then\n        else if (result.type() == Completion::Type::Return) {\n            // i. Perform ! Call(promiseCapability.[[Resolve]], undefined,  result.[[Value]] ).\n            MUST(call(vm, *promise_capability.resolve(), js_undefined(), *result.value()));\n        }\n        // i. Else,\n        else {\n            // i. Assert: result.[[Type]] is throw.\n            VERIFY(result.type() == Completion::Type::Throw);\n\n            // ii. Perform ! Call(promiseCapability.[[Reject]], undefined,  result.[[Value]] ).\n            MUST(call(vm, *promise_capability.reject(), js_undefined(), *result.value()));\n        }\n        // j. Return unused.\n        // NOTE: We don't support returning an empty/optional/unused value here.\n        return js_undefined();\n    });\n\n    // ",
          "new_text": null,
          "old_line_content": "    auto execution_steps = NativeFunction::create(realm, \"\", [&realm, &async_body, &promise_capability, &async_context](auto& vm) -> ThrowCompletionOr<Value> {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1011,
          "old_api": "is_error",
          "new_api": null,
          "old_text": "e_executable.is_error())\n  ",
          "new_text": null,
          "old_line_content": "            if (maybe_executable.is_error())",
          "new_line_content": "            else",
          "content_same": false
        },
        {
          "line": 1014,
          "old_api": "value",
          "new_api": null,
          "old_text": "e_executable.value(), nu",
          "new_text": null,
          "old_line_content": "                result = vm.bytecode_interpreter().run_and_return_frame(realm, *maybe_executable.value(), nullptr).value;",
          "new_line_content": "        // b. Else,",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 22,
      "total_additions": 97,
      "total_deletions": 98,
      "total_api_changes": 217
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 11,
        "api_related_lines": 217,
        "non_api_lines": 6,
        "non_api_line_numbers": [
          551,
          552,
          555,
          556,
          557,
          560
        ]
      }
    },
    "api_calls_before": 434,
    "api_calls_after": 432,
    "diff_info": {
      "added_lines": 8,
      "removed_lines": 10,
      "total_diff_lines": 34
    }
  }
}