{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/800242ed4e45021ca3a6b60d3ec0c072a41ca104",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/800242ed4e45021ca3a6b60d3ec0c072a41ca104/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/800242ed4e45021ca3a6b60d3ec0c072a41ca104/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/800242ed4e45021ca3a6b60d3ec0c072a41ca104/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 272,
          "old_api": "gettimeofday",
          "new_api": "make_weak_ptr",
          "old_text": "gettimeofday(&now, nullptr)",
          "new_text": "object.make_weak_ptr()",
          "old_line_content": "    gettimeofday(&now, nullptr);",
          "new_line_content": "    timer->owner = object.make_weak_ptr();",
          "content_same": false
        },
        {
          "line": 276,
          "old_api": "ASSERT",
          "new_api": "reload",
          "old_text": "ASSERT(timer_id)",
          "new_text": "timer->reload(now)",
          "old_line_content": "    ASSERT(timer_id);                 // FIXME: Aforementioned wraparound.",
          "new_line_content": "    timer->reload(now);",
          "content_same": false
        },
        {
          "line": 287,
          "old_api": "remove",
          "new_api": "find",
          "old_text": "s_timers->remove(it)",
          "new_text": "s_timers->find(timer_id)",
          "old_line_content": "    s_timers->remove(it);",
          "new_line_content": "    auto it = s_timers->find(timer_id);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 288,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "s_timers->end()",
          "old_line_content": "    return true;",
          "new_line_content": "    if (it == s_timers->end())",
          "content_same": false
        },
        {
          "line": 258,
          "old_api": null,
          "new_api": "is_empty",
          "old_text": null,
          "new_text": "s_timers->is_empty()",
          "old_line_content": "        auto& fire_time = it.value->fire_time;",
          "new_line_content": "    ASSERT(!s_timers->is_empty());",
          "content_same": false
        },
        {
          "line": 290,
          "old_api": null,
          "new_api": "remove",
          "old_text": null,
          "new_text": "s_timers->remove(it)",
          "old_line_content": "",
          "new_line_content": "    s_timers->remove(it);",
          "content_same": false
        },
        {
          "line": 231,
          "old_api": null,
          "new_api": "fd",
          "old_text": null,
          "new_text": "notifier->fd()",
          "old_line_content": "        }",
          "new_line_content": "        if (FD_ISSET(notifier->fd(), &rfds)) {",
          "content_same": false
        },
        {
          "line": 296,
          "old_api": null,
          "new_api": "set",
          "old_text": null,
          "new_text": "s_notifiers->set(&notifier)",
          "old_line_content": "void CEventLoop::unregister_notifier(Badge<CNotifier>, CNotifier& notifier)",
          "new_line_content": "    s_notifiers->set(&notifier);",
          "content_same": false
        },
        {
          "line": 233,
          "old_api": null,
          "new_api": "on_ready_to_read",
          "old_text": null,
          "new_text": "notifier->on_ready_to_read()",
          "old_line_content": "            if (notifier->on_ready_to_write)",
          "new_line_content": "                notifier->on_ready_to_read();",
          "content_same": false
        },
        {
          "line": 235,
          "old_api": null,
          "new_api": "fd",
          "old_text": null,
          "new_text": "notifier->fd()",
          "old_line_content": "        }",
          "new_line_content": "        if (FD_ISSET(notifier->fd(), &wfds)) {",
          "content_same": false
        },
        {
          "line": 301,
          "old_api": null,
          "new_api": "remove",
          "old_text": null,
          "new_text": "s_notifiers->remove(&notifier)",
          "old_line_content": "",
          "new_line_content": "    s_notifiers->remove(&notifier);",
          "content_same": false
        },
        {
          "line": 270,
          "old_api": null,
          "new_api": "ASSERT",
          "old_text": null,
          "new_text": "ASSERT(milliseconds >= 0)",
          "old_line_content": "    timer->interval = milliseconds;",
          "new_line_content": "    ASSERT(milliseconds >= 0);",
          "content_same": false
        },
        {
          "line": 271,
          "old_api": null,
          "new_api": "make<EventLoopTimer>()",
          "old_text": null,
          "new_text": "make<EventLoopTimer>()",
          "old_line_content": "    timeval now;",
          "new_line_content": "    auto timer = make<EventLoopTimer>();",
          "content_same": false
        },
        {
          "line": 237,
          "old_api": null,
          "new_api": "on_ready_to_write",
          "old_text": null,
          "new_text": "notifier->on_ready_to_write()",
          "old_line_content": "",
          "new_line_content": "                notifier->on_ready_to_write();",
          "content_same": false
        },
        {
          "line": 241,
          "old_api": null,
          "new_api": "process_file_descriptors_after_select",
          "old_text": null,
          "new_text": "process_file_descriptors_after_select(rfds)",
          "old_line_content": "bool CEventLoop::EventLoopTimer::has_expired(const timeval& now) const",
          "new_line_content": "    process_file_descriptors_after_select(rfds);",
          "content_same": false
        },
        {
          "line": 275,
          "old_api": null,
          "new_api": "gettimeofday",
          "old_text": null,
          "new_text": "gettimeofday(&now, nullptr)",
          "old_line_content": "    int timer_id = ++s_next_timer_id; // FIXME: This will eventually wrap around.",
          "new_line_content": "    gettimeofday(&now, nullptr);",
          "content_same": false
        },
        {
          "line": 279,
          "old_api": null,
          "new_api": "ASSERT",
          "old_text": null,
          "new_text": "ASSERT(timer_id)",
          "old_line_content": "    return timer_id;",
          "new_line_content": "    ASSERT(timer_id);                 // FIXME: Aforementioned wraparound.",
          "content_same": false
        },
        {
          "line": 281,
          "old_api": null,
          "new_api": "move",
          "old_text": null,
          "new_text": "move(timer)",
          "old_line_content": "",
          "new_line_content": "    s_timers->set(timer->timer_id, move(timer));",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 228,
          "old_api": "fd",
          "new_api": null,
          "old_text": "notifier->fd()",
          "new_text": null,
          "old_line_content": "        if (FD_ISSET(notifier->fd(), &rfds)) {",
          "new_line_content": "        return;",
          "content_same": false
        },
        {
          "line": 293,
          "old_api": "set",
          "new_api": null,
          "old_text": "s_notifiers->set(&notifier)",
          "new_text": null,
          "old_line_content": "    s_notifiers->set(&notifier);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 230,
          "old_api": "on_ready_to_read",
          "new_api": null,
          "old_text": "notifier->on_ready_to_read()",
          "new_text": null,
          "old_line_content": "                notifier->on_ready_to_read();",
          "new_line_content": "    for (auto& notifier : *s_notifiers) {",
          "content_same": false
        },
        {
          "line": 232,
          "old_api": "fd",
          "new_api": null,
          "old_text": "notifier->fd()",
          "new_text": null,
          "old_line_content": "        if (FD_ISSET(notifier->fd(), &wfds)) {",
          "new_line_content": "            if (notifier->on_ready_to_read)",
          "content_same": false
        },
        {
          "line": 298,
          "old_api": "remove",
          "new_api": null,
          "old_text": "s_notifiers->remove(&notifier)",
          "new_text": null,
          "old_line_content": "    s_notifiers->remove(&notifier);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 267,
          "old_api": "ASSERT",
          "new_api": null,
          "old_text": "ASSERT(milliseconds >= 0)",
          "new_text": null,
          "old_line_content": "    ASSERT(milliseconds >= 0);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 268,
          "old_api": "make<EventLoopTimer>()",
          "new_api": null,
          "old_text": "make<EventLoopTimer>()",
          "new_text": null,
          "old_line_content": "    auto timer = make<EventLoopTimer>();",
          "new_line_content": "int CEventLoop::register_timer(CObject& object, int milliseconds, bool should_reload)",
          "content_same": false
        },
        {
          "line": 269,
          "old_api": "make_weak_ptr",
          "new_api": null,
          "old_text": "object.make_weak_ptr()",
          "new_text": null,
          "old_line_content": "    timer->owner = object.make_weak_ptr();",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 234,
          "old_api": "on_ready_to_write",
          "new_api": null,
          "old_text": "notifier->on_ready_to_write()",
          "new_text": null,
          "old_line_content": "                notifier->on_ready_to_write();",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 238,
          "old_api": "process_file_descriptors_after_select",
          "new_api": null,
          "old_text": "process_file_descriptors_after_select(rfds)",
          "new_text": null,
          "old_line_content": "    process_file_descriptors_after_select(rfds);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 273,
          "old_api": "reload",
          "new_api": null,
          "old_text": "timer->reload(now)",
          "new_text": null,
          "old_line_content": "    timer->reload(now);",
          "new_line_content": "    timer->interval = milliseconds;",
          "content_same": false
        },
        {
          "line": 278,
          "old_api": "move",
          "new_api": null,
          "old_text": "move(timer)",
          "new_text": null,
          "old_line_content": "    s_timers->set(timer->timer_id, move(timer));",
          "new_line_content": "    int timer_id = ++s_next_timer_id; // FIXME: This will eventually wrap around.",
          "content_same": false
        },
        {
          "line": 284,
          "old_api": "find",
          "new_api": null,
          "old_text": "s_timers->find(timer_id)",
          "new_text": null,
          "old_line_content": "    auto it = s_timers->find(timer_id);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 285,
          "old_api": "end",
          "new_api": null,
          "old_text": "s_timers->end()",
          "new_text": null,
          "old_line_content": "    if (it == s_timers->end())",
          "new_line_content": "bool CEventLoop::unregister_timer(int timer_id)",
          "content_same": false
        },
        {
          "line": 255,
          "old_api": "is_empty",
          "new_api": null,
          "old_text": "s_timers->is_empty()",
          "new_text": null,
          "old_line_content": "    ASSERT(!s_timers->is_empty());",
          "new_line_content": "",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 3,
      "total_additions": 15,
      "total_deletions": 15,
      "total_api_changes": 33
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 5,
        "api_related_lines": 33,
        "non_api_lines": 4,
        "non_api_line_numbers": [
          202,
          227,
          229,
          203
        ]
      }
    },
    "api_calls_before": 96,
    "api_calls_after": 96,
    "diff_info": {
      "added_lines": 5,
      "removed_lines": 2,
      "total_diff_lines": 26
    }
  }
}