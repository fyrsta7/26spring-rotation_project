{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/e8f4ae487d228dac491a446ed548400176331ae9",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/e8f4ae487d228dac491a446ed548400176331ae9/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/e8f4ae487d228dac491a446ed548400176331ae9/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/e8f4ae487d228dac491a446ed548400176331ae9/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 263,
          "old_api": "is_empty",
          "new_api": "append",
          "old_text": "stack.is_empty()",
          "new_text": "stack.append(m_lhs)",
          "old_line_content": "    while (!stack.is_empty()) {",
          "new_line_content": "    stack.append(m_lhs);",
          "content_same": false
        },
        {
          "line": 264,
          "old_api": "take_last",
          "new_api": "is_empty",
          "old_text": "stack.take_last()",
          "new_text": "stack.is_empty()",
          "old_line_content": "        auto const* current = stack.take_last();",
          "new_line_content": "    while (!stack.is_empty()) {",
          "content_same": false
        },
        {
          "line": 335,
          "old_api": "append",
          "new_api": "length",
          "old_text": "builder.append(current_string_as_utf8)",
          "new_text": "previous_string_as_utf8.length()",
          "old_line_content": "            builder.append(current_string_as_utf8);",
          "new_line_content": "        auto high_surrogate = *Utf8View(previous_string_as_utf8.substring_view(previous_string_as_utf8.length() - 3)).begin();",
          "content_same": false
        },
        {
          "line": 345,
          "old_api": "substring_view",
          "new_api": "trim",
          "old_text": "current_string_as_utf8.substring_view(3)",
          "new_text": "builder.trim(3)",
          "old_line_content": "        builder.append(current_string_as_utf8.substring_view(3));",
          "new_line_content": "        builder.trim(3);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 265,
          "old_api": null,
          "new_api": "take_last",
          "old_text": null,
          "new_text": "stack.take_last()",
          "old_line_content": "        if (current->m_is_rope) {",
          "new_line_content": "        auto const* current = stack.take_last();",
          "content_same": false
        },
        {
          "line": 268,
          "old_api": null,
          "new_api": "append",
          "old_text": null,
          "new_text": "stack.append(current->m_lhs)",
          "old_line_content": "            continue;",
          "new_line_content": "            stack.append(current->m_lhs);",
          "content_same": false
        },
        {
          "line": 272,
          "old_api": null,
          "new_api": "has_utf8_string",
          "old_text": null,
          "new_text": "current->has_utf8_string()",
          "old_line_content": "",
          "new_line_content": "        if (current->has_utf8_string())",
          "content_same": false
        },
        {
          "line": 273,
          "old_api": null,
          "new_api": "length",
          "old_text": null,
          "new_text": "current->utf8_string_view().length()",
          "old_line_content": "    if (preference == EncodingPreference::UTF16) {",
          "new_line_content": "            approximate_length += current->utf8_string_view().length();",
          "content_same": false
        },
        {
          "line": 274,
          "old_api": null,
          "new_api": "append",
          "old_text": null,
          "new_text": "pieces.append(current)",
          "old_line_content": "        // The caller wants a UTF-16 string, so we can simply concatenate all the pieces",
          "new_line_content": "        pieces.append(current);",
          "content_same": false
        },
        {
          "line": 283,
          "old_api": null,
          "new_api": "string",
          "old_text": null,
          "new_text": "current->utf16_string().string()",
          "old_line_content": "        m_lhs = nullptr;",
          "new_line_content": "            code_units.extend(current->utf16_string().string());",
          "content_same": false
        },
        {
          "line": 285,
          "old_api": null,
          "new_api": "move",
          "old_text": null,
          "new_text": "move(code_units)",
          "old_line_content": "        return;",
          "new_line_content": "        m_utf16_string = Utf16String::create(move(code_units));",
          "content_same": false
        },
        {
          "line": 300,
          "old_api": null,
          "new_api": "utf8_string",
          "old_text": null,
          "new_text": "current->utf8_string()",
          "old_line_content": "",
          "new_line_content": "            builder.append(current->utf8_string());",
          "content_same": false
        },
        {
          "line": 306,
          "old_api": null,
          "new_api": "utf8_string_view",
          "old_text": null,
          "new_text": "current->utf8_string_view()",
          "old_line_content": "        //       of the current string, to see if they should be combined into a surrogate.",
          "new_line_content": "        auto current_string_as_utf8 = current->utf8_string_view();",
          "content_same": false
        },
        {
          "line": 307,
          "old_api": null,
          "new_api": "utf8_string_view",
          "old_text": null,
          "new_text": "previous->utf8_string_view()",
          "old_line_content": "",
          "new_line_content": "        auto previous_string_as_utf8 = previous->utf8_string_view();",
          "content_same": false
        },
        {
          "line": 313,
          "old_api": null,
          "new_api": "length",
          "old_text": null,
          "new_text": "current_string_as_utf8.length()",
          "old_line_content": "        }",
          "new_line_content": "        if ((previous_string_as_utf8.length() < 3) || (current_string_as_utf8.length() < 3)) {",
          "content_same": false
        },
        {
          "line": 314,
          "old_api": null,
          "new_api": "append",
          "old_text": null,
          "new_text": "builder.append(current_string_as_utf8)",
          "old_line_content": "",
          "new_line_content": "            builder.append(current_string_as_utf8);",
          "content_same": false
        },
        {
          "line": 320,
          "old_api": null,
          "new_api": "length",
          "old_text": null,
          "new_text": "previous_string_as_utf8.length()",
          "old_line_content": "            continue;",
          "new_line_content": "        if ((static_cast<u8>(previous_string_as_utf8[previous_string_as_utf8.length() - 3]) & 0xf0) != 0xe0) {",
          "content_same": false
        },
        {
          "line": 322,
          "old_api": null,
          "new_api": "append",
          "old_text": null,
          "new_text": "builder.append(current_string_as_utf8)",
          "old_line_content": "",
          "new_line_content": "            builder.append(current_string_as_utf8);",
          "content_same": false
        },
        {
          "line": 328,
          "old_api": null,
          "new_api": "static_cast<u8>(current_string_as_utf8[0])",
          "old_text": null,
          "new_text": "static_cast<u8>(current_string_as_utf8[0])",
          "old_line_content": "            continue;",
          "new_line_content": "        if ((static_cast<u8>(current_string_as_utf8[0]) & 0xf0) != 0xe0) {",
          "content_same": false
        },
        {
          "line": 330,
          "old_api": null,
          "new_api": "append",
          "old_text": null,
          "new_text": "builder.append(current_string_as_utf8)",
          "old_line_content": "",
          "new_line_content": "            builder.append(current_string_as_utf8);",
          "content_same": false
        },
        {
          "line": 336,
          "old_api": null,
          "new_api": "begin",
          "old_text": null,
          "new_text": "Utf8View(current_string_as_utf8).begin()",
          "old_line_content": "            previous = current;",
          "new_line_content": "        auto low_surrogate = *Utf8View(current_string_as_utf8).begin();",
          "content_same": false
        },
        {
          "line": 338,
          "old_api": null,
          "new_api": "Utf16View::is_low_surrogate(low_surrogate)",
          "old_text": null,
          "new_text": "Utf16View::is_low_surrogate(low_surrogate)",
          "old_line_content": "        }",
          "new_line_content": "        if (!Utf16View::is_high_surrogate(high_surrogate) || !Utf16View::is_low_surrogate(low_surrogate)) {",
          "content_same": false
        },
        {
          "line": 339,
          "old_api": null,
          "new_api": "append",
          "old_text": null,
          "new_text": "builder.append(current_string_as_utf8)",
          "old_line_content": "",
          "new_line_content": "            builder.append(current_string_as_utf8);",
          "content_same": false
        },
        {
          "line": 346,
          "old_api": null,
          "new_api": "Utf16View::decode_surrogate_pair(high_surrogate, low_surrogate)",
          "old_text": null,
          "new_text": "Utf16View::decode_surrogate_pair(high_surrogate, low_surrogate)",
          "old_line_content": "        previous = current;",
          "new_line_content": "        builder.append_code_point(Utf16View::decode_surrogate_pair(high_surrogate, low_surrogate));",
          "content_same": false
        },
        {
          "line": 349,
          "old_api": null,
          "new_api": "substring_view",
          "old_text": null,
          "new_text": "current_string_as_utf8.substring_view(3)",
          "old_line_content": "    // NOTE: We've already produced valid UTF-8 above, so there's no need for additional validation.",
          "new_line_content": "        builder.append(current_string_as_utf8.substring_view(3));",
          "content_same": false
        },
        {
          "line": 354,
          "old_api": null,
          "new_api": "to_string_without_validation",
          "old_text": null,
          "new_text": "builder.to_string_without_validation()",
          "old_line_content": "}",
          "new_line_content": "    m_utf8_string = builder.to_string_without_validation();",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 261,
          "old_api": "append",
          "new_api": null,
          "old_text": "stack.append(m_rhs)",
          "new_text": null,
          "old_line_content": "    stack.append(m_rhs);",
          "new_line_content": "    Vector<PrimitiveString const*> stack;",
          "content_same": false
        },
        {
          "line": 266,
          "old_api": "append",
          "new_api": null,
          "old_text": "stack.append(current->m_rhs)",
          "new_text": null,
          "old_line_content": "            stack.append(current->m_rhs);",
          "new_line_content": "        if (current->m_is_rope) {",
          "content_same": false
        },
        {
          "line": 270,
          "old_api": "append",
          "new_api": null,
          "old_text": "pieces.append(current)",
          "new_text": null,
          "old_line_content": "        pieces.append(current);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 279,
          "old_api": "string",
          "new_api": null,
          "old_text": "current->utf16_string().string()",
          "new_text": null,
          "old_line_content": "            code_units.extend(current->utf16_string().string());",
          "new_line_content": "        // into a UTF-16 code unit buffer and create a Utf16String from it.",
          "content_same": false
        },
        {
          "line": 281,
          "old_api": "move",
          "new_api": null,
          "old_text": "move(code_units)",
          "new_text": null,
          "old_line_content": "        m_utf16_string = Utf16String::create(move(code_units));",
          "new_line_content": "        Utf16Data code_units;",
          "content_same": false
        },
        {
          "line": 296,
          "old_api": "utf8_string",
          "new_api": null,
          "old_text": "current->utf8_string()",
          "new_text": null,
          "old_line_content": "            builder.append(current->utf8_string());",
          "new_line_content": "    PrimitiveString const* previous = nullptr;",
          "content_same": false
        },
        {
          "line": 302,
          "old_api": "utf8_string_view",
          "new_api": null,
          "old_text": "current->utf8_string_view()",
          "new_text": null,
          "old_line_content": "        auto current_string_as_utf8 = current->utf8_string_view();",
          "new_line_content": "            continue;",
          "content_same": false
        },
        {
          "line": 303,
          "old_api": "utf8_string_view",
          "new_api": null,
          "old_text": "previous->utf8_string_view()",
          "new_text": null,
          "old_line_content": "        auto previous_string_as_utf8 = previous->utf8_string_view();",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 309,
          "old_api": "length",
          "new_api": null,
          "old_text": "current_string_as_utf8.length()",
          "new_text": null,
          "old_line_content": "        if ((previous_string_as_utf8.length() < 3) || (current_string_as_utf8.length() < 3)) {",
          "new_line_content": "        // NOTE: Now we need to look at the end of the previous string and the start",
          "content_same": false
        },
        {
          "line": 310,
          "old_api": "append",
          "new_api": null,
          "old_text": "builder.append(current_string_as_utf8)",
          "new_text": null,
          "old_line_content": "            builder.append(current_string_as_utf8);",
          "new_line_content": "        //       of the current string, to see if they should be combined into a surrogate.",
          "content_same": false
        },
        {
          "line": 316,
          "old_api": "length",
          "new_api": null,
          "old_text": "previous_string_as_utf8.length()",
          "new_text": null,
          "old_line_content": "        if ((static_cast<u8>(previous_string_as_utf8[previous_string_as_utf8.length() - 3]) & 0xf0) != 0xe0) {",
          "new_line_content": "            continue;",
          "content_same": false
        },
        {
          "line": 318,
          "old_api": "append",
          "new_api": null,
          "old_text": "builder.append(current_string_as_utf8)",
          "new_text": null,
          "old_line_content": "            builder.append(current_string_as_utf8);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 324,
          "old_api": "static_cast<u8>(current_string_as_utf8[0])",
          "new_api": null,
          "old_text": "static_cast<u8>(current_string_as_utf8[0])",
          "new_text": null,
          "old_line_content": "        if ((static_cast<u8>(current_string_as_utf8[0]) & 0xf0) != 0xe0) {",
          "new_line_content": "            continue;",
          "content_same": false
        },
        {
          "line": 326,
          "old_api": "append",
          "new_api": null,
          "old_text": "builder.append(current_string_as_utf8)",
          "new_text": null,
          "old_line_content": "            builder.append(current_string_as_utf8);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 331,
          "old_api": "length",
          "new_api": null,
          "old_text": "previous_string_as_utf8.length()",
          "new_text": null,
          "old_line_content": "        auto high_surrogate = *Utf8View(previous_string_as_utf8.substring_view(previous_string_as_utf8.length() - 3)).begin();",
          "new_line_content": "            previous = current;",
          "content_same": false
        },
        {
          "line": 332,
          "old_api": "begin",
          "new_api": null,
          "old_text": "Utf8View(current_string_as_utf8).begin()",
          "new_text": null,
          "old_line_content": "        auto low_surrogate = *Utf8View(current_string_as_utf8).begin();",
          "new_line_content": "            continue;",
          "content_same": false
        },
        {
          "line": 334,
          "old_api": "Utf16View::is_low_surrogate(low_surrogate)",
          "new_api": null,
          "old_text": "Utf16View::is_low_surrogate(low_surrogate)",
          "new_text": null,
          "old_line_content": "        if (!Utf16View::is_high_surrogate(high_surrogate) || !Utf16View::is_low_surrogate(low_surrogate)) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 341,
          "old_api": "trim",
          "new_api": null,
          "old_text": "builder.trim(3)",
          "new_text": null,
          "old_line_content": "        builder.trim(3);",
          "new_line_content": "            continue;",
          "content_same": false
        },
        {
          "line": 342,
          "old_api": "Utf16View::decode_surrogate_pair(high_surrogate, low_surrogate)",
          "new_api": null,
          "old_text": "Utf16View::decode_surrogate_pair(high_surrogate, low_surrogate)",
          "new_text": null,
          "old_line_content": "        builder.append_code_point(Utf16View::decode_surrogate_pair(high_surrogate, low_surrogate));",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 350,
          "old_api": "to_string_without_validation",
          "new_api": null,
          "old_text": "builder.to_string_without_validation()",
          "new_text": null,
          "old_line_content": "    m_utf8_string = builder.to_string_without_validation();",
          "new_line_content": "        previous = current;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 4,
      "total_additions": 22,
      "total_deletions": 20,
      "total_api_changes": 46
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 6,
        "api_related_lines": 46,
        "non_api_lines": 4,
        "non_api_line_numbers": [
          257,
          271,
          293,
          289
        ]
      }
    },
    "api_calls_before": 154,
    "api_calls_after": 157,
    "diff_info": {
      "added_lines": 5,
      "removed_lines": 1,
      "total_diff_lines": 32
    }
  }
}