{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/006e5998c51f729a422e704c0575006c806b1b39",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/006e5998c51f729a422e704c0575006c806b1b39/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/006e5998c51f729a422e704c0575006c806b1b39/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/006e5998c51f729a422e704c0575006c806b1b39/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 299,
          "old_api": "kmalloc",
          "new_api": "memset",
          "old_text": "kmalloc(bytes_per_glyph * new_glyph_count)",
          "new_text": "memset(new_rows, (unsigned)0, bytes_per_glyph * new_glyph_count)",
          "old_line_content": "    auto* new_rows = static_cast<unsigned*>(kmalloc(bytes_per_glyph * new_glyph_count));",
          "new_line_content": "    memset(new_rows, (unsigned)0, bytes_per_glyph * new_glyph_count);",
          "content_same": false
        },
        {
          "line": 300,
          "old_api": "memset",
          "new_api": "memcpy",
          "old_text": "memset(new_rows, (unsigned)0, bytes_per_glyph * new_glyph_count)",
          "new_text": "memcpy(new_rows, m_rows, bytes_per_glyph * item_count_to_copy)",
          "old_line_content": "    memset(new_rows, (unsigned)0, bytes_per_glyph * new_glyph_count);",
          "new_line_content": "    memcpy(new_rows, m_rows, bytes_per_glyph * item_count_to_copy);",
          "content_same": false
        },
        {
          "line": 303,
          "old_api": "kmalloc",
          "new_api": "memset",
          "old_text": "kmalloc(new_glyph_count)",
          "new_text": "memset(new_widths, (u8)0, new_glyph_count)",
          "old_line_content": "    auto* new_widths = static_cast<u8*>(kmalloc(new_glyph_count));",
          "new_line_content": "    memset(new_widths, (u8)0, new_glyph_count);",
          "content_same": false
        },
        {
          "line": 304,
          "old_api": "memset",
          "new_api": "memcpy",
          "old_text": "memset(new_widths, (u8)0, new_glyph_count)",
          "new_text": "memcpy(new_widths, m_glyph_widths, item_count_to_copy)",
          "old_line_content": "    memset(new_widths, (u8)0, new_glyph_count);",
          "new_line_content": "    memcpy(new_widths, m_glyph_widths, item_count_to_copy);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 288,
          "old_api": null,
          "new_api": "glyph_count_by_type",
          "old_text": null,
          "new_text": "glyph_count_by_type(type)",
          "old_line_content": "",
          "new_line_content": "    size_t new_glyph_count = glyph_count_by_type(type);",
          "content_same": false
        },
        {
          "line": 324,
          "old_api": null,
          "new_api": "get",
          "old_text": null,
          "new_text": "Gfx::FontDatabase::the().get(m_family, m_presentation_size, 700)",
          "old_line_content": "        return *m_bold_variant;",
          "new_line_content": "    m_bold_variant = Gfx::FontDatabase::the().get(m_family, m_presentation_size, 700);",
          "content_same": false
        },
        {
          "line": 294,
          "old_api": null,
          "new_api": "min",
          "old_text": null,
          "new_text": "min(m_glyph_count, new_glyph_count)",
          "old_line_content": "",
          "new_line_content": "    int item_count_to_copy = min(m_glyph_count, new_glyph_count);",
          "content_same": false
        },
        {
          "line": 296,
          "old_api": null,
          "new_api": "glyph_height",
          "old_text": null,
          "new_text": "glyph_height()",
          "old_line_content": "",
          "new_line_content": "    size_t bytes_per_glyph = sizeof(u32) * glyph_height();",
          "content_same": false
        },
        {
          "line": 298,
          "old_api": null,
          "new_api": "kmalloc",
          "old_text": null,
          "new_text": "kmalloc(bytes_per_glyph * new_glyph_count)",
          "old_line_content": "",
          "new_line_content": "    auto* new_rows = static_cast<unsigned*>(kmalloc(bytes_per_glyph * new_glyph_count));",
          "content_same": false
        },
        {
          "line": 267,
          "old_api": null,
          "new_api": "max",
          "old_text": null,
          "new_text": "max(width, longest_width)",
          "old_line_content": "            width = 0;",
          "new_line_content": "            longest_width = max(width, longest_width);",
          "content_same": false
        },
        {
          "line": 302,
          "old_api": null,
          "new_api": "kmalloc",
          "old_text": null,
          "new_text": "kmalloc(new_glyph_count)",
          "old_line_content": "",
          "new_line_content": "    auto* new_widths = static_cast<u8*>(kmalloc(new_glyph_count));",
          "content_same": false
        },
        {
          "line": 272,
          "old_api": null,
          "new_api": "glyph_spacing",
          "old_text": null,
          "new_text": "glyph_spacing()",
          "old_line_content": "        first = false;",
          "new_line_content": "            width += glyph_spacing();",
          "content_same": false
        },
        {
          "line": 274,
          "old_api": null,
          "new_api": "glyph_or_emoji_width",
          "old_text": null,
          "new_text": "glyph_or_emoji_width(code_point)",
          "old_line_content": "        if (width > longest_width)",
          "new_line_content": "        width += glyph_or_emoji_width(code_point);",
          "content_same": false
        },
        {
          "line": 306,
          "old_api": null,
          "new_api": "kfree",
          "old_text": null,
          "new_text": "kfree(m_rows)",
          "old_line_content": "",
          "new_line_content": "    kfree(m_rows);",
          "content_same": false
        },
        {
          "line": 276,
          "old_api": null,
          "new_api": "max",
          "old_text": null,
          "new_text": "max(width, longest_width)",
          "old_line_content": "    }",
          "new_line_content": "    longest_width = max(width, longest_width);",
          "content_same": false
        },
        {
          "line": 317,
          "old_api": null,
          "new_api": "weight",
          "old_text": null,
          "new_text": "weight()",
          "old_line_content": "{",
          "new_line_content": "    return String::formatted(\"{} {} {}\", family(), presentation_size(), weight());",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 289,
          "old_api": "glyph_count_by_type",
          "new_api": null,
          "old_text": "glyph_count_by_type(type)",
          "new_text": null,
          "old_line_content": "    size_t new_glyph_count = glyph_count_by_type(type);",
          "new_line_content": "    if (new_glyph_count <= m_glyph_count) {",
          "content_same": false
        },
        {
          "line": 325,
          "old_api": "get",
          "new_api": null,
          "old_text": "Gfx::FontDatabase::the().get(m_family, m_presentation_size, 700)",
          "new_text": null,
          "old_line_content": "    m_bold_variant = Gfx::FontDatabase::the().get(m_family, m_presentation_size, 700);",
          "new_line_content": "    if (!m_bold_variant)",
          "content_same": false
        },
        {
          "line": 295,
          "old_api": "min",
          "new_api": null,
          "old_text": "min(m_glyph_count, new_glyph_count)",
          "new_text": null,
          "old_line_content": "    int item_count_to_copy = min(m_glyph_count, new_glyph_count);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 297,
          "old_api": "glyph_height",
          "new_api": null,
          "old_text": "glyph_height()",
          "new_text": null,
          "old_line_content": "    size_t bytes_per_glyph = sizeof(u32) * glyph_height();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 301,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(new_rows, m_rows, bytes_per_glyph * item_count_to_copy)",
          "new_text": null,
          "old_line_content": "    memcpy(new_rows, m_rows, bytes_per_glyph * item_count_to_copy);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 271,
          "old_api": "glyph_spacing",
          "new_api": null,
          "old_text": "glyph_spacing()",
          "new_text": null,
          "old_line_content": "            width += glyph_spacing();",
          "new_line_content": "        if (!first)",
          "content_same": false
        },
        {
          "line": 273,
          "old_api": "glyph_or_emoji_width",
          "new_api": null,
          "old_text": "glyph_or_emoji_width(code_point)",
          "new_text": null,
          "old_line_content": "        width += glyph_or_emoji_width(code_point);",
          "new_line_content": "        first = false;",
          "content_same": false
        },
        {
          "line": 305,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(new_widths, m_glyph_widths, item_count_to_copy)",
          "new_text": null,
          "old_line_content": "    memcpy(new_widths, m_glyph_widths, item_count_to_copy);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 308,
          "old_api": "kfree",
          "new_api": null,
          "old_text": "kfree(m_glyph_widths)",
          "new_text": null,
          "old_line_content": "    kfree(m_glyph_widths);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 318,
          "old_api": "weight",
          "new_api": null,
          "old_text": "weight()",
          "new_text": null,
          "old_line_content": "    return String::formatted(\"{} {} {}\", family(), presentation_size(), weight());",
          "new_line_content": "}",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 4,
      "total_additions": 12,
      "total_deletions": 10,
      "total_api_changes": 26
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 5,
        "api_related_lines": 26,
        "non_api_lines": 2,
        "non_api_line_numbers": [
          275,
          277
        ]
      }
    },
    "api_calls_before": 98,
    "api_calls_after": 100,
    "diff_info": {
      "added_lines": 2,
      "removed_lines": 3,
      "total_diff_lines": 25
    }
  }
}