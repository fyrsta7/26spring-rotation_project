{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/d5dce448ea679e40348ac77869f73374d3c89ae6",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/d5dce448ea679e40348ac77869f73374d3c89ae6/before.h",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/d5dce448ea679e40348ac77869f73374d3c89ae6/after.h",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/d5dce448ea679e40348ac77869f73374d3c89ae6/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 63,
          "old_api": "buffer",
          "new_api": "size",
          "old_text": "buffer()",
          "new_text": "bytes.size()",
          "old_line_content": "            m_buffered = m_stream.read(buffer());",
          "new_line_content": "        if (nread < bytes.size()) {",
          "content_same": false
        },
        {
          "line": 135,
          "old_api": "move",
          "new_api": "buffer",
          "old_text": "move(other.m_stream)",
          "new_text": "buffer()",
          "old_line_content": "        : m_stream(move(other.m_stream))",
          "new_line_content": "        other.buffer().copy_to(buffer());",
          "content_same": false
        },
        {
          "line": 147,
          "old_api": "has_recoverable_error",
          "new_api": "has_any_error",
          "old_text": "m_stream.has_recoverable_error()",
          "new_text": "m_stream.has_any_error()",
          "old_line_content": "    bool has_recoverable_error() const override { return m_stream.has_recoverable_error(); }",
          "new_line_content": "    bool has_any_error() const override { return m_stream.has_any_error(); }",
          "content_same": false
        },
        {
          "line": 149,
          "old_api": "has_any_error",
          "new_api": "handle_recoverable_error",
          "old_text": "m_stream.has_any_error()",
          "new_text": "m_stream.handle_recoverable_error()",
          "old_line_content": "    bool has_any_error() const override { return m_stream.has_any_error(); }",
          "new_line_content": "    bool handle_recoverable_error() override { return m_stream.handle_recoverable_error(); }",
          "content_same": false
        },
        {
          "line": 151,
          "old_api": "handle_recoverable_error",
          "new_api": "handle_any_error",
          "old_text": "m_stream.handle_recoverable_error()",
          "new_text": "m_stream.handle_any_error()",
          "old_line_content": "    bool handle_recoverable_error() override { return m_stream.handle_recoverable_error(); }",
          "new_line_content": "    bool handle_any_error() override { return m_stream.handle_any_error(); }",
          "content_same": false
        },
        {
          "line": 153,
          "old_api": "handle_any_error",
          "new_api": "set_recoverable_error",
          "old_text": "m_stream.handle_any_error()",
          "new_text": "m_stream.set_recoverable_error()",
          "old_line_content": "    bool handle_any_error() override { return m_stream.handle_any_error(); }",
          "new_line_content": "    void set_recoverable_error() const override { return m_stream.set_recoverable_error(); }",
          "content_same": false
        },
        {
          "line": 167,
          "old_api": "flush",
          "new_api": "size",
          "old_text": "flush()",
          "new_text": "bytes.size()",
          "old_line_content": "            flush();",
          "new_line_content": "            if (bytes.size() - nwritten >= Size)",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 128,
          "old_api": null,
          "new_api": "forward<Parameters>(parameters)",
          "old_text": null,
          "new_text": "forward<Parameters>(parameters)",
          "old_line_content": "    template<typename... Parameters>",
          "new_line_content": "        : m_stream(forward<Parameters>(parameters)...)",
          "content_same": false
        },
        {
          "line": 133,
          "old_api": null,
          "new_api": "move",
          "old_text": null,
          "new_text": "move(other.m_stream)",
          "old_line_content": "",
          "new_line_content": "        : m_stream(move(other.m_stream))",
          "content_same": false
        },
        {
          "line": 136,
          "old_api": null,
          "new_api": "exchange",
          "old_text": null,
          "new_text": "exchange(other.m_buffered, 0)",
          "old_line_content": "    {",
          "new_line_content": "        m_buffered = exchange(other.m_buffered, 0);",
          "content_same": false
        },
        {
          "line": 142,
          "old_api": null,
          "new_api": "flush",
          "old_text": null,
          "new_text": "flush()",
          "old_line_content": "    {",
          "new_line_content": "            flush();",
          "content_same": false
        },
        {
          "line": 145,
          "old_api": null,
          "new_api": "has_recoverable_error",
          "old_text": null,
          "new_text": "m_stream.has_recoverable_error()",
          "old_line_content": "    }",
          "new_line_content": "    bool has_recoverable_error() const override { return m_stream.has_recoverable_error(); }",
          "content_same": false
        },
        {
          "line": 146,
          "old_api": null,
          "new_api": "has_fatal_error",
          "old_text": null,
          "new_text": "m_stream.has_fatal_error()",
          "old_line_content": "",
          "new_line_content": "    bool has_fatal_error() const override { return m_stream.has_fatal_error(); }",
          "content_same": false
        },
        {
          "line": 150,
          "old_api": null,
          "new_api": "handle_fatal_error",
          "old_text": null,
          "new_text": "m_stream.handle_fatal_error()",
          "old_line_content": "",
          "new_line_content": "    bool handle_fatal_error() override { return m_stream.handle_fatal_error(); }",
          "content_same": false
        },
        {
          "line": 154,
          "old_api": null,
          "new_api": "set_fatal_error",
          "old_text": null,
          "new_text": "m_stream.set_fatal_error()",
          "old_line_content": "",
          "new_line_content": "    void set_fatal_error() const override { return m_stream.set_fatal_error(); }",
          "content_same": false
        },
        {
          "line": 158,
          "old_api": null,
          "new_api": "has_any_error",
          "old_text": null,
          "new_text": "has_any_error()",
          "old_line_content": "    size_t write(ReadonlyBytes bytes) override",
          "new_line_content": "        if (has_any_error())",
          "content_same": false
        },
        {
          "line": 161,
          "old_api": null,
          "new_api": "slice",
          "old_text": null,
          "new_text": "buffer().slice(m_buffered)",
          "old_line_content": "            return 0;",
          "new_line_content": "        auto nwritten = bytes.copy_trimmed_to(buffer().slice(m_buffered));",
          "content_same": false
        },
        {
          "line": 165,
          "old_api": null,
          "new_api": "flush",
          "old_text": null,
          "new_text": "flush()",
          "old_line_content": "",
          "new_line_content": "            flush();",
          "content_same": false
        },
        {
          "line": 168,
          "old_api": null,
          "new_api": "slice",
          "old_text": null,
          "new_text": "bytes.slice(nwritten)",
          "old_line_content": "",
          "new_line_content": "                nwritten += m_stream.write(bytes.slice(nwritten));",
          "content_same": false
        },
        {
          "line": 178,
          "old_api": null,
          "new_api": "write",
          "old_text": null,
          "new_text": "write(bytes)",
          "old_line_content": "    bool write_or_error(ReadonlyBytes bytes) override",
          "new_line_content": "        write(bytes);",
          "content_same": false
        },
        {
          "line": 184,
          "old_api": null,
          "new_api": "write_or_error",
          "old_text": null,
          "new_text": "m_stream.write_or_error({ m_buffer, m_buffered })",
          "old_line_content": "    void flush()",
          "new_line_content": "        m_stream.write_or_error({ m_buffer, m_buffered });",
          "content_same": false
        },
        {
          "line": 61,
          "old_api": null,
          "new_api": "buffer",
          "old_text": null,
          "new_text": "buffer()",
          "old_line_content": "",
          "new_line_content": "            buffer().slice(nread, m_buffered).copy_to(buffer());",
          "content_same": false
        },
        {
          "line": 64,
          "old_api": null,
          "new_api": "slice",
          "old_text": null,
          "new_text": "bytes.slice(nread)",
          "old_line_content": "",
          "new_line_content": "            nread += m_stream.read(bytes.slice(nread));",
          "content_same": false
        },
        {
          "line": 66,
          "old_api": null,
          "new_api": "buffer",
          "old_text": null,
          "new_text": "buffer()",
          "old_line_content": "                return nread;",
          "new_line_content": "            m_buffered = m_stream.read(buffer());",
          "content_same": false
        },
        {
          "line": 74,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "bytes.size()",
          "old_line_content": "    bool read_or_error(Bytes bytes) override",
          "new_line_content": "        if (read(bytes) < bytes.size()) {",
          "content_same": false
        },
        {
          "line": 75,
          "old_api": null,
          "new_api": "set_fatal_error",
          "old_text": null,
          "new_text": "set_fatal_error()",
          "old_line_content": "    {",
          "new_line_content": "            set_fatal_error();",
          "content_same": false
        },
        {
          "line": 82,
          "old_api": null,
          "new_api": "unreliable_eof",
          "old_text": null,
          "new_text": "m_stream.unreliable_eof()",
          "old_line_content": "    }",
          "new_line_content": "    bool unreliable_eof() const override { return m_buffered == 0 && m_stream.unreliable_eof(); }",
          "content_same": false
        },
        {
          "line": 89,
          "old_api": null,
          "new_api": "buffer",
          "old_text": null,
          "new_text": "buffer()",
          "old_line_content": "            return false;",
          "new_line_content": "        m_buffered = m_stream.read(buffer());",
          "content_same": false
        },
        {
          "line": 100,
          "old_api": null,
          "new_api": "min",
          "old_text": null,
          "new_text": "min(Size, count - ndiscarded)",
          "old_line_content": "            u8 dummy[Size];",
          "new_line_content": "            if (!read_or_error({ dummy, min(Size, count - ndiscarded) }))",
          "content_same": false
        },
        {
          "line": 103,
          "old_api": null,
          "new_api": "min",
          "old_text": null,
          "new_text": "min(Size, count - ndiscarded)",
          "old_line_content": "                return false;",
          "new_line_content": "            ndiscarded += min(Size, count - ndiscarded);",
          "content_same": false
        },
        {
          "line": 127,
          "old_api": null,
          "new_api": "explicit",
          "old_text": null,
          "new_text": "explicit",
          "old_line_content": "public:",
          "new_line_content": "    explicit Buffered(Parameters&&... parameters)",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 129,
          "old_api": "explicit",
          "new_api": null,
          "old_text": "explicit",
          "new_text": null,
          "old_line_content": "    explicit Buffered(Parameters&&... parameters)",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 130,
          "old_api": "forward<Parameters>(parameters)",
          "new_api": null,
          "old_text": "forward<Parameters>(parameters)",
          "new_text": null,
          "old_line_content": "        : m_stream(forward<Parameters>(parameters)...)",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 137,
          "old_api": "buffer",
          "new_api": null,
          "old_text": "buffer()",
          "new_text": null,
          "old_line_content": "        other.buffer().copy_to(buffer());",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 138,
          "old_api": "exchange",
          "new_api": null,
          "old_text": "exchange(other.m_buffered, 0)",
          "new_text": null,
          "old_line_content": "        m_buffered = exchange(other.m_buffered, 0);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 144,
          "old_api": "flush",
          "new_api": null,
          "old_text": "flush()",
          "new_text": null,
          "old_line_content": "            flush();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 148,
          "old_api": "has_fatal_error",
          "new_api": null,
          "old_text": "m_stream.has_fatal_error()",
          "new_text": null,
          "old_line_content": "    bool has_fatal_error() const override { return m_stream.has_fatal_error(); }",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 152,
          "old_api": "handle_fatal_error",
          "new_api": null,
          "old_text": "m_stream.handle_fatal_error()",
          "new_text": null,
          "old_line_content": "    bool handle_fatal_error() override { return m_stream.handle_fatal_error(); }",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 155,
          "old_api": "set_recoverable_error",
          "new_api": null,
          "old_text": "m_stream.set_recoverable_error()",
          "new_text": null,
          "old_line_content": "    void set_recoverable_error() const override { return m_stream.set_recoverable_error(); }",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 156,
          "old_api": "set_fatal_error",
          "new_api": null,
          "old_text": "m_stream.set_fatal_error()",
          "new_text": null,
          "old_line_content": "    void set_fatal_error() const override { return m_stream.set_fatal_error(); }",
          "new_line_content": "    size_t write(ReadonlyBytes bytes) override",
          "content_same": false
        },
        {
          "line": 160,
          "old_api": "has_any_error",
          "new_api": null,
          "old_text": "has_any_error()",
          "new_text": null,
          "old_line_content": "        if (has_any_error())",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 163,
          "old_api": "slice",
          "new_api": null,
          "old_text": "buffer().slice(m_buffered)",
          "new_text": null,
          "old_line_content": "        auto nwritten = bytes.copy_trimmed_to(buffer().slice(m_buffered));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 169,
          "old_api": "size",
          "new_api": null,
          "old_text": "bytes.size()",
          "new_text": null,
          "old_line_content": "            if (bytes.size() - nwritten >= Size)",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 172,
          "old_api": "slice",
          "new_api": null,
          "old_text": "bytes.slice(nwritten)",
          "new_text": null,
          "old_line_content": "            nwritten += write(bytes.slice(nwritten));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 180,
          "old_api": "write",
          "new_api": null,
          "old_text": "write(bytes)",
          "new_text": null,
          "old_line_content": "        write(bytes);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 186,
          "old_api": "write_or_error",
          "new_api": null,
          "old_text": "m_stream.write_or_error({ m_buffer, m_buffered })",
          "new_text": null,
          "old_line_content": "        m_stream.write_or_error({ m_buffer, m_buffered });",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 60,
          "old_api": "buffer",
          "new_api": null,
          "old_text": "buffer()",
          "new_text": null,
          "old_line_content": "        buffer().slice(nread, m_buffered).copy_to(buffer());",
          "new_line_content": "        if (m_buffered > 0)",
          "content_same": false
        },
        {
          "line": 62,
          "old_api": "size",
          "new_api": null,
          "old_text": "bytes.size()",
          "new_text": null,
          "old_line_content": "        if (nread < bytes.size()) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 68,
          "old_api": "slice",
          "new_api": null,
          "old_text": "bytes.slice(nread)",
          "new_text": null,
          "old_line_content": "            nread += read(bytes.slice(nread));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 76,
          "old_api": "size",
          "new_api": null,
          "old_text": "bytes.size()",
          "new_text": null,
          "old_line_content": "        if (read(bytes) < bytes.size()) {",
          "new_line_content": "            return false;",
          "content_same": false
        },
        {
          "line": 77,
          "old_api": "set_fatal_error",
          "new_api": null,
          "old_text": "set_fatal_error()",
          "new_text": null,
          "old_line_content": "            set_fatal_error();",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 84,
          "old_api": "unreliable_eof",
          "new_api": null,
          "old_text": "m_stream.unreliable_eof()",
          "new_text": null,
          "old_line_content": "    bool unreliable_eof() const override { return m_buffered == 0 && m_stream.unreliable_eof(); }",
          "new_line_content": "    bool eof() const",
          "content_same": false
        },
        {
          "line": 91,
          "old_api": "buffer",
          "new_api": null,
          "old_text": "buffer()",
          "new_text": null,
          "old_line_content": "        m_buffered = m_stream.read(buffer());",
          "new_line_content": "        return m_buffered == 0;",
          "content_same": false
        },
        {
          "line": 102,
          "old_api": "min",
          "new_api": null,
          "old_text": "min(Size, count - ndiscarded)",
          "new_text": null,
          "old_line_content": "            if (!read_or_error({ dummy, min(Size, count - ndiscarded) }))",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 105,
          "old_api": "min",
          "new_api": null,
          "old_text": "min(Size, count - ndiscarded)",
          "new_text": null,
          "old_line_content": "            ndiscarded += min(Size, count - ndiscarded);",
          "new_line_content": "",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 7,
      "total_additions": 24,
      "total_deletions": 24,
      "total_api_changes": 55
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 8,
        "api_related_lines": 55,
        "non_api_lines": 2,
        "non_api_line_numbers": [
          65,
          67
        ]
      }
    },
    "api_calls_before": 65,
    "api_calls_after": 65,
    "diff_info": {
      "added_lines": 4,
      "removed_lines": 6,
      "total_diff_lines": 25
    }
  }
}