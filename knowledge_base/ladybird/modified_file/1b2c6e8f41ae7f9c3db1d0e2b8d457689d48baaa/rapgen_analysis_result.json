{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/1b2c6e8f41ae7f9c3db1d0e2b8d457689d48baaa",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/1b2c6e8f41ae7f9c3db1d0e2b8d457689d48baaa/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/1b2c6e8f41ae7f9c3db1d0e2b8d457689d48baaa/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/1b2c6e8f41ae7f9c3db1d0e2b8d457689d48baaa/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": true,
    "api_changes": {
      "replacements": [
        {
          "line": 47,
          "old_api": "get",
          "new_api": "get_ptr",
          "old_text": "process_object.get(\"threads\").as_array()",
          "new_text": "process_object.get_ptr(\"threads\")->as_array()",
          "old_line_content": "        auto thread_array = process_object.get(\"threads\").as_array();",
          "new_line_content": "        auto& thread_array = process_object.get_ptr(\"threads\")->as_array();",
          "content_same": false
        },
        {
          "line": 48,
          "old_api": "for_each",
          "new_api": "size",
          "old_text": "thread_array.for_each([&](auto& value) {\n            auto& thread_object = value.as_object();\n            CThreadStatistics thread;\n            thread.tid = thread_object.get(\"tid\").to_u32();\n            thread.times_scheduled = thread_object.get(\"times_scheduled\").to_u32();\n            thread.name = thread_object.get(\"name\").to_string();\n            thread.state = thread_object.get(\"state\").to_string();\n            thread.ticks = thread_object.get(\"ticks\").to_u32();\n            thread.priority = thread_object.get(\"priority\").to_string();\n            thread.syscall_count = thread_object.get(\"syscall_count\").to_u32();\n            thread.inode_faults = thread_object.get(\"inode_faults\").to_u32();\n            thread.zero_faults = thread_object.get(\"zero_faults\").to_u32();\n            thread.cow_faults = thread_object.get(\"cow_faults\").to_u32();\n            thread.unix_socket_read_bytes = thread_object.get(\"unix_socket_read_bytes\").to_u32();\n            thread.unix_socket_write_bytes = thread_object.get(\"unix_socket_write_bytes\").to_u32();\n            thread.ipv4_socket_read_bytes = thread_object.get(\"ipv4_socket_read_bytes\").to_u32();\n            thread.ipv4_socket_write_bytes = thread_object.get(\"ipv4_socket_write_bytes\").to_u32();\n            thread.file_read_bytes = thread_object.get(\"file_read_bytes\").to_u32();\n            thread.file_write_bytes = thread_object.get(\"file_write_bytes\").to_u32();\n            process.threads.append(move(thread));\n        })",
          "new_text": "thread_array.size()",
          "old_line_content": "        thread_array.for_each([&](auto& value) {",
          "new_line_content": "        process.threads.ensure_capacity(thread_array.size());",
          "content_same": false
        },
        {
          "line": 49,
          "old_api": "as_object",
          "new_api": "for_each",
          "old_text": "value.as_object()",
          "new_text": "thread_array.for_each([&](auto& value) {\n            auto& thread_object = value.as_object();\n            CThreadStatistics thread;\n            thread.tid = thread_object.get(\"tid\").to_u32();\n            thread.times_scheduled = thread_object.get(\"times_scheduled\").to_u32();\n            thread.name = thread_object.get(\"name\").to_string();\n            thread.state = thread_object.get(\"state\").to_string();\n            thread.ticks = thread_object.get(\"ticks\").to_u32();\n            thread.priority = thread_object.get(\"priority\").to_string();\n            thread.syscall_count = thread_object.get(\"syscall_count\").to_u32();\n            thread.inode_faults = thread_object.get(\"inode_faults\").to_u32();\n            thread.zero_faults = thread_object.get(\"zero_faults\").to_u32();\n            thread.cow_faults = thread_object.get(\"cow_faults\").to_u32();\n            thread.unix_socket_read_bytes = thread_object.get(\"unix_socket_read_bytes\").to_u32();\n            thread.unix_socket_write_bytes = thread_object.get(\"unix_socket_write_bytes\").to_u32();\n            thread.ipv4_socket_read_bytes = thread_object.get(\"ipv4_socket_read_bytes\").to_u32();\n            thread.ipv4_socket_write_bytes = thread_object.get(\"ipv4_socket_write_bytes\").to_u32();\n            thread.file_read_bytes = thread_object.get(\"file_read_bytes\").to_u32();\n            thread.file_write_bytes = thread_object.get(\"file_write_bytes\").to_u32();\n            process.threads.append(move(thread));\n        })",
          "old_line_content": "            auto& thread_object = value.as_object();",
          "new_line_content": "        thread_array.for_each([&](auto& value) {",
          "content_same": false
        },
        {
          "line": 67,
          "old_api": "move",
          "new_api": "get",
          "old_text": "move(thread)",
          "new_text": "thread_object.get(\"file_write_bytes\").to_u32()",
          "old_line_content": "            process.threads.append(move(thread));",
          "new_line_content": "            thread.file_write_bytes = thread_object.get(\"file_write_bytes\").to_u32();",
          "content_same": false
        },
        {
          "line": 72,
          "old_api": "set",
          "new_api": "username_from_uid",
          "old_text": "map.set(process.pid, process)",
          "new_text": "username_from_uid(process.uid)",
          "old_line_content": "        map.set(process.pid, process);",
          "new_line_content": "        process.username = username_from_uid(process.uid);",
          "content_same": false
        },
        {
          "line": 81,
          "old_api": "setpwent",
          "new_api": "is_empty",
          "old_text": "setpwent()",
          "new_text": "s_usernames.is_empty()",
          "old_line_content": "        setpwent();",
          "new_line_content": "    if (s_usernames.is_empty()) {",
          "content_same": false
        },
        {
          "line": 82,
          "old_api": "getpwent",
          "new_api": "setpwent",
          "old_text": "getpwent()",
          "new_text": "setpwent()",
          "old_line_content": "        while (auto* passwd = getpwent())",
          "new_line_content": "        setpwent();",
          "content_same": false
        },
        {
          "line": 83,
          "old_api": "set",
          "new_api": "getpwent",
          "old_text": "s_usernames.set(passwd->pw_uid, passwd->pw_name)",
          "new_text": "getpwent()",
          "old_line_content": "            s_usernames.set(passwd->pw_uid, passwd->pw_name);",
          "new_line_content": "        while (auto* passwd = getpwent())",
          "content_same": false
        },
        {
          "line": 84,
          "old_api": "endpwent",
          "new_api": "set",
          "old_text": "endpwent()",
          "new_text": "s_usernames.set(passwd->pw_uid, passwd->pw_name)",
          "old_line_content": "        endpwent();",
          "new_line_content": "            s_usernames.set(passwd->pw_uid, passwd->pw_name);",
          "content_same": false
        },
        {
          "line": 88,
          "old_api": "end",
          "new_api": "find",
          "old_text": "s_usernames.end()",
          "new_text": "s_usernames.find(uid)",
          "old_line_content": "    if (it != s_usernames.end())",
          "new_line_content": "    auto it = s_usernames.find(uid);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 68,
          "old_api": null,
          "new_api": "move",
          "old_text": null,
          "new_text": "move(thread)",
          "old_line_content": "        });",
          "new_line_content": "            process.threads.append(move(thread));",
          "content_same": false
        },
        {
          "line": 73,
          "old_api": null,
          "new_api": "set",
          "old_text": null,
          "new_text": "map.set(process.pid, process)",
          "old_line_content": "    });",
          "new_line_content": "        map.set(process.pid, process);",
          "content_same": false
        },
        {
          "line": 50,
          "old_api": null,
          "new_api": "as_object",
          "old_text": null,
          "new_text": "value.as_object()",
          "old_line_content": "            CThreadStatistics thread;",
          "new_line_content": "            auto& thread_object = value.as_object();",
          "content_same": false
        },
        {
          "line": 85,
          "old_api": null,
          "new_api": "endpwent",
          "old_text": null,
          "new_text": "endpwent()",
          "old_line_content": "    }",
          "new_line_content": "        endpwent();",
          "content_same": false
        },
        {
          "line": 89,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "s_usernames.end()",
          "old_line_content": "        return (*it).value;",
          "new_line_content": "    if (it != s_usernames.end())",
          "content_same": false
        },
        {
          "line": 91,
          "old_api": null,
          "new_api": "String::number(uid)",
          "old_text": null,
          "new_text": "String::number(uid)",
          "old_line_content": "}",
          "new_line_content": "    return String::number(uid);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 71,
          "old_api": "username_from_uid",
          "new_api": null,
          "old_text": "username_from_uid(process.uid)",
          "new_text": null,
          "old_line_content": "        process.username = username_from_uid(process.uid);",
          "new_line_content": "        // and synthetic data last",
          "content_same": false
        },
        {
          "line": 80,
          "old_api": "is_empty",
          "new_api": null,
          "old_text": "s_usernames.is_empty()",
          "new_text": null,
          "old_line_content": "    if (s_usernames.is_empty()) {",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 51,
          "old_api": "get",
          "new_api": null,
          "old_text": "thread_object.get(\"tid\").to_u32()",
          "new_text": null,
          "old_line_content": "            thread.tid = thread_object.get(\"tid\").to_u32();",
          "new_line_content": "            CThreadStatistics thread;",
          "content_same": false
        },
        {
          "line": 87,
          "old_api": "find",
          "new_api": null,
          "old_text": "s_usernames.find(uid)",
          "new_text": null,
          "old_line_content": "    auto it = s_usernames.find(uid);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 90,
          "old_api": "String::number(uid)",
          "new_api": null,
          "old_text": "String::number(uid)",
          "new_text": null,
          "old_line_content": "    return String::number(uid);",
          "new_line_content": "        return (*it).value;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 10,
      "total_additions": 6,
      "total_deletions": 5,
      "total_api_changes": 21
    },
    "non_api_changes": {
      "has_non_api_changes": false,
      "evidence": {
        "total_diff_lines": 2,
        "api_related_lines": 21,
        "non_api_lines": 0,
        "non_api_line_numbers": []
      }
    },
    "api_calls_before": 95,
    "api_calls_after": 97,
    "diff_info": {
      "added_lines": 2,
      "removed_lines": 1,
      "total_diff_lines": 15
    }
  }
}