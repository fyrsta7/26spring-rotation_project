{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/3f3f3766be3ea26dab457e0886ffa04a841ffb9b",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/3f3f3766be3ea26dab457e0886ffa04a841ffb9b/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/3f3f3766be3ea26dab457e0886ffa04a841ffb9b/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ladybird/modified_file/3f3f3766be3ea26dab457e0886ffa04a841ffb9b/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 65,
          "old_api": "height",
          "new_api": "translation",
          "old_text": "mask_src.height()",
          "new_text": "page_painter.translation()",
          "old_line_content": "        for (int row = 0; row < mask_src.height(); ++row) {",
          "new_line_content": "    auto translation = page_painter.translation();",
          "content_same": false
        },
        {
          "line": 68,
          "old_api": "get_pixel",
          "new_api": "height",
          "old_text": "m_corner_bitmap->get_pixel(corner_location)",
          "new_text": "mask_src.height()",
          "old_line_content": "                auto mask_pixel = m_corner_bitmap->get_pixel(corner_location);",
          "new_line_content": "        for (int row = 0; row < mask_src.height(); ++row) {",
          "content_same": false
        },
        {
          "line": 69,
          "old_api": "alpha",
          "new_api": "width",
          "old_text": "mask_pixel.alpha()",
          "new_text": "mask_src.width()",
          "old_line_content": "                u8 mask_alpha = mask_pixel.alpha();",
          "new_line_content": "            for (int col = 0; col < mask_src.width(); ++col) {",
          "content_same": false
        },
        {
          "line": 71,
          "old_api": "alpha",
          "new_api": "y",
          "old_text": "mask_pixel.alpha()",
          "new_text": "corner_location.y()",
          "old_line_content": "                    mask_alpha = ~mask_pixel.alpha();",
          "new_line_content": "                auto mask_pixel = m_corner_bitmap->get_pixel<Gfx::StorageFormat::BGRA8888>(corner_location.x(), corner_location.y());",
          "content_same": false
        },
        {
          "line": 72,
          "old_api": "Color",
          "new_api": "alpha",
          "old_text": "Color()",
          "new_text": "mask_pixel.alpha()",
          "old_line_content": "                auto final_pixel = Color();",
          "new_line_content": "                u8 mask_alpha = mask_pixel.alpha();",
          "content_same": false
        },
        {
          "line": 74,
          "old_api": "translated",
          "new_api": "alpha",
          "old_text": "page_location.translated(col, row)",
          "new_text": "mask_pixel.alpha()",
          "old_line_content": "                    auto page_pixel = page_painter.get_pixel(page_location.translated(col, row));",
          "new_line_content": "                    mask_alpha = ~mask_pixel.alpha();",
          "content_same": false
        },
        {
          "line": 75,
          "old_api": "has_value",
          "new_api": "Color",
          "old_text": "page_pixel.has_value()",
          "new_text": "Color()",
          "old_line_content": "                    if (page_pixel.has_value())",
          "new_line_content": "                auto final_pixel = Color();",
          "content_same": false
        },
        {
          "line": 78,
          "old_api": "set_pixel",
          "new_api": "translate_by",
          "old_text": "m_corner_bitmap->set_pixel(corner_location, final_pixel)",
          "new_text": "position.translate_by(translation)",
          "old_line_content": "                m_corner_bitmap->set_pixel(corner_location, final_pixel);",
          "new_line_content": "                    position.translate_by(translation);",
          "content_same": false
        },
        {
          "line": 104,
          "old_api": "as_rect",
          "new_api": "VERIFY",
          "old_text": "m_data.corner_radii.top_right.as_rect().translated(m_data.bitmap_locations.top_right)",
          "new_text": "VERIFY(m_has_sampled)",
          "old_line_content": "        painter.blit(m_data.page_locations.top_right, *m_corner_bitmap, m_data.corner_radii.top_right.as_rect().translated(m_data.bitmap_locations.top_right));",
          "new_line_content": "    VERIFY(m_has_sampled);",
          "content_same": false
        },
        {
          "line": 119,
          "old_api": "as_corner",
          "new_api": "allocate_corner_clipper_id",
          "old_text": "border_radii.bottom_right.as_corner(context)",
          "new_text": "context.allocate_corner_clipper_id()",
          "old_line_content": "        .bottom_right = border_radii.bottom_right.as_corner(context),",
          "new_line_content": "    , m_id(context.allocate_corner_clipper_id())",
          "content_same": false
        },
        {
          "line": 125,
          "old_api": "border_rect.to_type<int>()",
          "new_api": "as_corner",
          "old_text": "border_rect.to_type<int>()",
          "new_text": "border_radii.bottom_right.as_corner(context)",
          "old_line_content": "    m_context.recording_painter().sample_under_corners(m_id, corner_radii, border_rect.to_type<int>(), corner_clip);",
          "new_line_content": "        .bottom_right = border_radii.bottom_right.as_corner(context),",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 128,
          "old_api": null,
          "new_api": "has_any_radius",
          "old_text": null,
          "new_text": "corner_radii.has_any_radius()",
          "old_line_content": "ScopedCornerRadiusClip::~ScopedCornerRadiusClip()",
          "new_line_content": "    m_has_radius = corner_radii.has_any_radius();",
          "content_same": false
        },
        {
          "line": 131,
          "old_api": null,
          "new_api": "border_rect.to_type<int>()",
          "old_text": null,
          "new_text": "border_rect.to_type<int>()",
          "old_line_content": "        return;",
          "new_line_content": "    m_context.recording_painter().sample_under_corners(m_id, corner_radii, border_rect.to_type<int>(), corner_clip);",
          "content_same": false
        },
        {
          "line": 138,
          "old_api": null,
          "new_api": "recording_painter",
          "old_text": null,
          "new_text": "m_context.recording_painter().blit_corner_clipping(m_id, m_border_rect)",
          "old_line_content": "",
          "new_line_content": "    m_context.recording_painter().blit_corner_clipping(m_id, m_border_rect);",
          "content_same": false
        },
        {
          "line": 64,
          "old_api": null,
          "new_api": "clip_rect",
          "old_text": null,
          "new_text": "page_painter.clip_rect()",
          "old_line_content": "    auto copy_page_masked = [&](Gfx::IntRect const& mask_src, Gfx::IntPoint const& page_location) {",
          "new_line_content": "    auto clip_rect = page_painter.clip_rect();",
          "content_same": false
        },
        {
          "line": 70,
          "old_api": null,
          "new_api": "location",
          "old_text": null,
          "new_text": "mask_src.location().translated(col, row)",
          "old_line_content": "                if (m_corner_clip == CornerClip::Outside)",
          "new_line_content": "                auto corner_location = mask_src.location().translated(col, row);",
          "content_same": false
        },
        {
          "line": 77,
          "old_api": null,
          "new_api": "translated",
          "old_text": null,
          "new_text": "page_location.translated(col, row)",
          "old_line_content": "                }",
          "new_line_content": "                    auto position = page_location.translated(col, row);",
          "content_same": false
        },
        {
          "line": 79,
          "old_api": null,
          "new_api": "contains",
          "old_text": null,
          "new_text": "clip_rect.contains(position)",
          "old_line_content": "            }",
          "new_line_content": "                    if (!clip_rect.contains(position))",
          "content_same": false
        },
        {
          "line": 81,
          "old_api": null,
          "new_api": "y",
          "old_text": null,
          "new_text": "position.y()",
          "old_line_content": "    };",
          "new_line_content": "                    auto page_pixel = page_painter.target()->get_pixel<Gfx::StorageFormat::BGRA8888>(position.x(), position.y());",
          "content_same": false
        },
        {
          "line": 82,
          "old_api": null,
          "new_api": "with_alpha",
          "old_text": null,
          "new_text": "page_pixel.with_alpha(mask_alpha)",
          "old_line_content": "",
          "new_line_content": "                    final_pixel = page_pixel.with_alpha(mask_alpha);",
          "content_same": false
        },
        {
          "line": 84,
          "old_api": null,
          "new_api": "y",
          "old_text": null,
          "new_text": "corner_location.y()",
          "old_line_content": "    if (m_data.corner_radii.top_left)",
          "new_line_content": "                m_corner_bitmap->set_pixel<Gfx::StorageFormat::BGRA8888>(corner_location.x(), corner_location.y(), final_pixel);",
          "content_same": false
        },
        {
          "line": 93,
          "old_api": null,
          "new_api": "as_rect",
          "old_text": null,
          "new_text": "m_data.corner_radii.top_right.as_rect().translated(m_data.bitmap_locations.top_right)",
          "old_line_content": "    m_has_sampled = true;",
          "new_line_content": "        copy_page_masked(m_data.corner_radii.top_right.as_rect().translated(m_data.bitmap_locations.top_right), m_data.page_locations.top_right);",
          "content_same": false
        },
        {
          "line": 95,
          "old_api": null,
          "new_api": "as_rect",
          "old_text": null,
          "new_text": "m_data.corner_radii.bottom_right.as_rect().translated(m_data.bitmap_locations.bottom_right)",
          "old_line_content": "",
          "new_line_content": "        copy_page_masked(m_data.corner_radii.bottom_right.as_rect().translated(m_data.bitmap_locations.bottom_right), m_data.page_locations.bottom_right);",
          "content_same": false
        },
        {
          "line": 97,
          "old_api": null,
          "new_api": "as_rect",
          "old_text": null,
          "new_text": "m_data.corner_radii.bottom_left.as_rect().translated(m_data.bitmap_locations.bottom_left)",
          "old_line_content": "{",
          "new_line_content": "        copy_page_masked(m_data.corner_radii.bottom_left.as_rect().translated(m_data.bitmap_locations.bottom_left), m_data.page_locations.bottom_left);",
          "content_same": false
        },
        {
          "line": 110,
          "old_api": null,
          "new_api": "as_rect",
          "old_text": null,
          "new_text": "m_data.corner_radii.top_right.as_rect().translated(m_data.bitmap_locations.top_right)",
          "old_line_content": "",
          "new_line_content": "        painter.blit(m_data.page_locations.top_right, *m_corner_bitmap, m_data.corner_radii.top_right.as_rect().translated(m_data.bitmap_locations.top_right));",
          "content_same": false
        },
        {
          "line": 112,
          "old_api": null,
          "new_api": "as_rect",
          "old_text": null,
          "new_text": "m_data.corner_radii.bottom_right.as_rect().translated(m_data.bitmap_locations.bottom_right)",
          "old_line_content": "    : m_context(context)",
          "new_line_content": "        painter.blit(m_data.page_locations.bottom_right, *m_corner_bitmap, m_data.corner_radii.bottom_right.as_rect().translated(m_data.bitmap_locations.bottom_right));",
          "content_same": false
        },
        {
          "line": 114,
          "old_api": null,
          "new_api": "as_rect",
          "old_text": null,
          "new_text": "m_data.corner_radii.bottom_left.as_rect().translated(m_data.bitmap_locations.bottom_left)",
          "old_line_content": "    , m_border_rect(border_rect)",
          "new_line_content": "        painter.blit(m_data.page_locations.bottom_left, *m_corner_bitmap, m_data.corner_radii.bottom_left.as_rect().translated(m_data.bitmap_locations.bottom_left));",
          "content_same": false
        },
        {
          "line": 123,
          "old_api": null,
          "new_api": "as_corner",
          "old_text": null,
          "new_text": "border_radii.top_left.as_corner(context)",
          "old_line_content": "    if (!m_has_radius)",
          "new_line_content": "        .top_left = border_radii.top_left.as_corner(context),",
          "content_same": false
        },
        {
          "line": 124,
          "old_api": null,
          "new_api": "as_corner",
          "old_text": null,
          "new_text": "border_radii.top_right.as_corner(context)",
          "old_line_content": "        return;",
          "new_line_content": "        .top_right = border_radii.top_right.as_corner(context),",
          "content_same": false
        },
        {
          "line": 126,
          "old_api": null,
          "new_api": "as_corner",
          "old_text": null,
          "new_text": "border_radii.bottom_left.as_corner(context)",
          "old_line_content": "}",
          "new_line_content": "        .bottom_left = border_radii.bottom_left.as_corner(context)",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 66,
          "old_api": "width",
          "new_api": null,
          "old_text": "mask_src.width()",
          "new_text": null,
          "old_line_content": "            for (int col = 0; col < mask_src.width(); ++col) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 67,
          "old_api": "location",
          "new_api": null,
          "old_text": "mask_src.location().translated(col, row)",
          "new_text": null,
          "old_line_content": "                auto corner_location = mask_src.location().translated(col, row);",
          "new_line_content": "    auto copy_page_masked = [&](Gfx::IntRect const& mask_src, Gfx::IntPoint const& page_location) {",
          "content_same": false
        },
        {
          "line": 132,
          "old_api": "recording_painter",
          "new_api": null,
          "old_text": "m_context.recording_painter().blit_corner_clipping(m_id, m_border_rect)",
          "new_text": null,
          "old_line_content": "    m_context.recording_painter().blit_corner_clipping(m_id, m_border_rect);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 98,
          "old_api": "VERIFY",
          "new_api": null,
          "old_text": "VERIFY(m_has_sampled)",
          "new_text": null,
          "old_line_content": "    VERIFY(m_has_sampled);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 102,
          "old_api": "as_rect",
          "new_api": null,
          "old_text": "m_data.corner_radii.top_left.as_rect().translated(m_data.bitmap_locations.top_left)",
          "new_text": null,
          "old_line_content": "        painter.blit(m_data.page_locations.top_left, *m_corner_bitmap, m_data.corner_radii.top_left.as_rect().translated(m_data.bitmap_locations.top_left));",
          "new_line_content": "void BorderRadiusCornerClipper::blit_corner_clipping(Gfx::Painter& painter)",
          "content_same": false
        },
        {
          "line": 106,
          "old_api": "as_rect",
          "new_api": null,
          "old_text": "m_data.corner_radii.bottom_right.as_rect().translated(m_data.bitmap_locations.bottom_right)",
          "new_text": null,
          "old_line_content": "        painter.blit(m_data.page_locations.bottom_right, *m_corner_bitmap, m_data.corner_radii.bottom_right.as_rect().translated(m_data.bitmap_locations.bottom_right));",
          "new_line_content": "    // Restore the corners:",
          "content_same": false
        },
        {
          "line": 76,
          "old_api": "value",
          "new_api": null,
          "old_text": "page_pixel.value().with_alpha(mask_alpha)",
          "new_text": null,
          "old_line_content": "                        final_pixel = page_pixel.value().with_alpha(mask_alpha);",
          "new_line_content": "                if (mask_alpha > 0) {",
          "content_same": false
        },
        {
          "line": 113,
          "old_api": "allocate_corner_clipper_id",
          "new_api": null,
          "old_text": "context.allocate_corner_clipper_id()",
          "new_text": null,
          "old_line_content": "    , m_id(context.allocate_corner_clipper_id())",
          "new_line_content": "    if (m_data.corner_radii.bottom_left)",
          "content_same": false
        },
        {
          "line": 85,
          "old_api": "as_rect",
          "new_api": null,
          "old_text": "m_data.corner_radii.top_left.as_rect().translated(m_data.bitmap_locations.top_left)",
          "new_text": null,
          "old_line_content": "        copy_page_masked(m_data.corner_radii.top_left.as_rect().translated(m_data.bitmap_locations.top_left), m_data.page_locations.top_left);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 117,
          "old_api": "as_corner",
          "new_api": null,
          "old_text": "border_radii.top_left.as_corner(context)",
          "new_text": null,
          "old_line_content": "        .top_left = border_radii.top_left.as_corner(context),",
          "new_line_content": "ScopedCornerRadiusClip::ScopedCornerRadiusClip(PaintContext& context, DevicePixelRect const& border_rect, BorderRadiiData const& border_radii, CornerClip corner_clip)",
          "content_same": false
        },
        {
          "line": 87,
          "old_api": "as_rect",
          "new_api": null,
          "old_text": "m_data.corner_radii.top_right.as_rect().translated(m_data.bitmap_locations.top_right)",
          "new_text": null,
          "old_line_content": "        copy_page_masked(m_data.corner_radii.top_right.as_rect().translated(m_data.bitmap_locations.top_right), m_data.page_locations.top_right);",
          "new_line_content": "    };",
          "content_same": false
        },
        {
          "line": 118,
          "old_api": "as_corner",
          "new_api": null,
          "old_text": "border_radii.top_right.as_corner(context)",
          "new_text": null,
          "old_line_content": "        .top_right = border_radii.top_right.as_corner(context),",
          "new_line_content": "    : m_context(context)",
          "content_same": false
        },
        {
          "line": 89,
          "old_api": "as_rect",
          "new_api": null,
          "old_text": "m_data.corner_radii.bottom_right.as_rect().translated(m_data.bitmap_locations.bottom_right)",
          "new_text": null,
          "old_line_content": "        copy_page_masked(m_data.corner_radii.bottom_right.as_rect().translated(m_data.bitmap_locations.bottom_right), m_data.page_locations.bottom_right);",
          "new_line_content": "    // Copy the pixels under the corner mask (using the alpha of the mask):",
          "content_same": false
        },
        {
          "line": 122,
          "old_api": "has_any_radius",
          "new_api": null,
          "old_text": "corner_radii.has_any_radius()",
          "new_text": null,
          "old_line_content": "    m_has_radius = corner_radii.has_any_radius();",
          "new_line_content": "    CornerRadii const corner_radii {",
          "content_same": false
        },
        {
          "line": 120,
          "old_api": "as_corner",
          "new_api": null,
          "old_text": "border_radii.bottom_left.as_corner(context)",
          "new_text": null,
          "old_line_content": "        .bottom_left = border_radii.bottom_left.as_corner(context)",
          "new_line_content": "    , m_border_rect(border_rect)",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 11,
      "total_additions": 19,
      "total_deletions": 15,
      "total_api_changes": 45
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 15,
        "api_related_lines": 45,
        "non_api_lines": 1,
        "non_api_line_numbers": [
          80
        ]
      }
    },
    "api_calls_before": 77,
    "api_calls_after": 86,
    "diff_info": {
      "added_lines": 11,
      "removed_lines": 5,
      "total_diff_lines": 38
    }
  }
}