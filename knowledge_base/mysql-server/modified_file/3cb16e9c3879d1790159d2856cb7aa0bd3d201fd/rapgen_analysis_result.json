{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mysql-server/modified_file/3cb16e9c3879d1790159d2856cb7aa0bd3d201fd",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mysql-server/modified_file/3cb16e9c3879d1790159d2856cb7aa0bd3d201fd/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mysql-server/modified_file/3cb16e9c3879d1790159d2856cb7aa0bd3d201fd/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mysql-server/modified_file/3cb16e9c3879d1790159d2856cb7aa0bd3d201fd/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 70,
          "old_api": "fcntl",
          "new_api": "my_win_fsync",
          "old_text": "fcntl(fd, F_FULLFSYNC, 0)",
          "new_text": "my_win_fsync(fd)",
          "old_line_content": "    if (!(res= fcntl(fd, F_FULLFSYNC, 0)))",
          "new_line_content": "    res= my_win_fsync(fd);",
          "content_same": false
        },
        {
          "line": 147,
          "old_api": "DBUG_ENTER",
          "new_api": "MYF",
          "old_text": "DBUG_ENTER(\"my_sync_dir\")",
          "new_text": "MYF(my_flags | MY_IGNORE_BADFD)",
          "old_line_content": "  DBUG_ENTER(\"my_sync_dir\");",
          "new_line_content": "    if (my_sync(dir_fd, MYF(my_flags | MY_IGNORE_BADFD)))",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 97,
          "old_api": null,
          "new_api": "my_filename",
          "old_text": null,
          "new_text": "my_filename(fd)",
          "old_line_content": "        || er == ENOTSUP",
          "new_line_content": "      my_error(EE_SYNC, MYF(0), my_filename(fd),",
          "content_same": false
        },
        {
          "line": 66,
          "old_api": null,
          "new_api": "fdatasync",
          "old_text": null,
          "new_text": "fdatasync(fd)",
          "old_line_content": "    /*",
          "new_line_content": "    res= fdatasync(fd);",
          "content_same": false
        },
        {
          "line": 98,
          "old_api": null,
          "new_api": "my_strerror",
          "old_text": null,
          "new_text": "my_strerror(errbuf, sizeof(errbuf), my_errno)",
          "old_line_content": "#endif",
          "new_line_content": "               my_errno, my_strerror(errbuf, sizeof(errbuf), my_errno));",
          "content_same": false
        },
        {
          "line": 68,
          "old_api": null,
          "new_api": "fsync",
          "old_text": null,
          "new_text": "fsync(fd)",
          "old_line_content": "      disk's cache and guarantees ordered writes).",
          "new_line_content": "    res= fsync(fd);",
          "content_same": false
        },
        {
          "line": 104,
          "old_api": null,
          "new_api": "*after_sync_wait)()",
          "old_text": null,
          "new_text": "*after_sync_wait)()",
          "old_line_content": "    else if (my_flags & MY_WME)",
          "new_line_content": "      (*after_sync_wait)();",
          "content_same": false
        },
        {
          "line": 137,
          "old_api": null,
          "new_api": "DBUG_ENTER",
          "old_text": null,
          "new_text": "DBUG_ENTER(\"my_sync_dir\")",
          "old_line_content": "                myf my_flags __attribute__((unused)))",
          "new_line_content": "  DBUG_ENTER(\"my_sync_dir\");",
          "content_same": false
        },
        {
          "line": 138,
          "old_api": null,
          "new_api": "DBUG_PRINT",
          "old_text": null,
          "new_text": "DBUG_PRINT(\"my\",(\"Dir: '%s'  my_flags: %d\", dir_name, my_flags))",
          "old_line_content": "{",
          "new_line_content": "  DBUG_PRINT(\"my\",(\"Dir: '%s'  my_flags: %d\", dir_name, my_flags));",
          "content_same": false
        },
        {
          "line": 106,
          "old_api": null,
          "new_api": "DBUG_RETURN",
          "old_text": null,
          "new_text": "DBUG_RETURN(res)",
          "old_line_content": "      char errbuf[MYSYS_STRERROR_SIZE];",
          "new_line_content": "  DBUG_RETURN(res);",
          "content_same": false
        },
        {
          "line": 145,
          "old_api": null,
          "new_api": "MYF",
          "old_text": null,
          "new_text": "MYF(my_flags)",
          "old_line_content": "  int res= 0;",
          "new_line_content": "  if ((dir_fd= my_open(correct_dir_name, O_RDONLY, MYF(my_flags))) >= 0)",
          "content_same": false
        },
        {
          "line": 179,
          "old_api": null,
          "new_api": "dirname_part",
          "old_text": null,
          "new_text": "dirname_part(dir_name, file_name, &dir_name_length)",
          "old_line_content": "  RETURN",
          "new_line_content": "  dirname_part(dir_name, file_name, &dir_name_length);",
          "content_same": false
        },
        {
          "line": 180,
          "old_api": null,
          "new_api": "my_sync_dir",
          "old_text": null,
          "new_text": "my_sync_dir(dir_name, my_flags)",
          "old_line_content": "    0 if ok, !=0 if error",
          "new_line_content": "  return my_sync_dir(dir_name, my_flags);",
          "content_same": false
        },
        {
          "line": 149,
          "old_api": null,
          "new_api": "MYF",
          "old_text": null,
          "new_text": "MYF(my_flags)",
          "old_line_content": "  /* Sometimes the path does not contain an explicit directory */",
          "new_line_content": "    if (my_close(dir_fd, MYF(my_flags)))",
          "content_same": false
        },
        {
          "line": 83,
          "old_api": null,
          "new_api": "*after_sync_wait)()",
          "old_text": null,
          "new_text": "*after_sync_wait)()",
          "old_line_content": "    res= 0;\t\t\t\t\t/* No sync (strange OS) */",
          "new_line_content": "      (*after_sync_wait)();",
          "content_same": false
        },
        {
          "line": 154,
          "old_api": null,
          "new_api": "DBUG_RETURN",
          "old_text": null,
          "new_text": "DBUG_RETURN(res)",
          "old_line_content": "  */",
          "new_line_content": "  DBUG_RETURN(res);",
          "content_same": false
        },
        {
          "line": 91,
          "old_api": null,
          "new_api": "DBUG_PRINT",
          "old_text": null,
          "new_text": "DBUG_PRINT(\"info\", (\"ignoring errno %d\", er))",
          "old_line_content": "      my_errno= -1;                             /* Unknown error */",
          "new_line_content": "      DBUG_PRINT(\"info\", (\"ignoring errno %d\", er));",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 164,
          "old_api": "DBUG_RETURN",
          "new_api": null,
          "old_text": "DBUG_RETURN(res)",
          "new_text": null,
          "old_line_content": "  DBUG_RETURN(res);",
          "new_line_content": "  SYNOPSIS",
          "content_same": false
        },
        {
          "line": 101,
          "old_api": "DBUG_PRINT",
          "new_api": null,
          "old_text": "DBUG_PRINT(\"info\", (\"ignoring errno %d\", er))",
          "new_text": null,
          "old_line_content": "      DBUG_PRINT(\"info\", (\"ignoring errno %d\", er));",
          "new_line_content": "  else",
          "content_same": false
        },
        {
          "line": 73,
          "old_api": "DBUG_PRINT",
          "new_api": null,
          "old_text": "DBUG_PRINT(\"info\",(\"fcntl(F_FULLFSYNC) failed, falling back\"))",
          "new_text": null,
          "old_line_content": "    DBUG_PRINT(\"info\",(\"fcntl(F_FULLFSYNC) failed, falling back\"));",
          "new_line_content": "    res= 0;\t\t\t\t\t/* No sync (strange OS) */",
          "content_same": false
        },
        {
          "line": 107,
          "old_api": "my_filename",
          "new_api": null,
          "old_text": "my_filename(fd)",
          "new_text": null,
          "old_line_content": "      my_error(EE_SYNC, MYF(0), my_filename(fd),",
          "new_line_content": "} /* my_sync */",
          "content_same": false
        },
        {
          "line": 76,
          "old_api": "fdatasync",
          "new_api": null,
          "old_text": "fdatasync(fd)",
          "new_text": null,
          "old_line_content": "    res= fdatasync(fd);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 108,
          "old_api": "my_strerror",
          "new_api": null,
          "old_text": "my_strerror(errbuf, sizeof(errbuf), my_errno)",
          "new_text": null,
          "old_line_content": "               my_errno, my_strerror(errbuf, sizeof(errbuf), my_errno));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 78,
          "old_api": "fsync",
          "new_api": null,
          "old_text": "fsync(fd)",
          "new_text": null,
          "old_line_content": "    res= fsync(fd);",
          "new_line_content": "  {",
          "content_same": false
        },
        {
          "line": 80,
          "old_api": "my_win_fsync",
          "new_api": null,
          "old_text": "my_win_fsync(fd)",
          "new_text": null,
          "old_line_content": "    res= my_win_fsync(fd);",
          "new_line_content": "    if (!(my_errno= er))",
          "content_same": false
        },
        {
          "line": 114,
          "old_api": "*after_sync_wait)()",
          "new_api": null,
          "old_text": "*after_sync_wait)()",
          "new_text": null,
          "old_line_content": "      (*after_sync_wait)();",
          "new_line_content": "    my_sync_dir()",
          "content_same": false
        },
        {
          "line": 148,
          "old_api": "DBUG_PRINT",
          "new_api": null,
          "old_text": "DBUG_PRINT(\"my\",(\"Dir: '%s'  my_flags: %d\", dir_name, my_flags))",
          "new_text": null,
          "old_line_content": "  DBUG_PRINT(\"my\",(\"Dir: '%s'  my_flags: %d\", dir_name, my_flags));",
          "new_line_content": "      res= 2;",
          "content_same": false
        },
        {
          "line": 93,
          "old_api": "*after_sync_wait)()",
          "new_api": null,
          "old_text": "*after_sync_wait)()",
          "new_text": null,
          "old_line_content": "      (*after_sync_wait)();",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 116,
          "old_api": "DBUG_RETURN",
          "new_api": null,
          "old_text": "DBUG_RETURN(res)",
          "new_text": null,
          "old_line_content": "  DBUG_RETURN(res);",
          "new_line_content": "    my_flags             flags (MY_WME etc)",
          "content_same": false
        },
        {
          "line": 189,
          "old_api": "dirname_part",
          "new_api": null,
          "old_text": "dirname_part(dir_name, file_name, &dir_name_length)",
          "new_text": null,
          "old_line_content": "  dirname_part(dir_name, file_name, &dir_name_length);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 155,
          "old_api": "MYF",
          "new_api": null,
          "old_text": "MYF(my_flags)",
          "new_text": null,
          "old_line_content": "  if ((dir_fd= my_open(correct_dir_name, O_RDONLY, MYF(my_flags))) >= 0)",
          "new_line_content": "#else",
          "content_same": false
        },
        {
          "line": 157,
          "old_api": "MYF",
          "new_api": null,
          "old_text": "MYF(my_flags | MY_IGNORE_BADFD)",
          "new_text": null,
          "old_line_content": "    if (my_sync(dir_fd, MYF(my_flags | MY_IGNORE_BADFD)))",
          "new_line_content": "#endif",
          "content_same": false
        },
        {
          "line": 190,
          "old_api": "my_sync_dir",
          "new_api": null,
          "old_text": "my_sync_dir(dir_name, my_flags)",
          "new_text": null,
          "old_line_content": "  return my_sync_dir(dir_name, my_flags);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 159,
          "old_api": "MYF",
          "new_api": null,
          "old_text": "MYF(my_flags)",
          "new_text": null,
          "old_line_content": "    if (my_close(dir_fd, MYF(my_flags)))",
          "new_line_content": "",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 2,
      "total_additions": 15,
      "total_deletions": 17,
      "total_api_changes": 34
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 10,
        "api_related_lines": 34,
        "non_api_lines": 6,
        "non_api_line_numbers": [
          65,
          67,
          69,
          71,
          72,
          74
        ]
      }
    },
    "api_calls_before": 27,
    "api_calls_after": 25,
    "diff_info": {
      "added_lines": 0,
      "removed_lines": 10,
      "total_diff_lines": 22
    }
  }
}