{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mysql-server/modified_file/308c8d5010bd6c5c119b171ec254a04d177032ea",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mysql-server/modified_file/308c8d5010bd6c5c119b171ec254a04d177032ea/before.h",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mysql-server/modified_file/308c8d5010bd6c5c119b171ec254a04d177032ea/after.h",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mysql-server/modified_file/308c8d5010bd6c5c119b171ec254a04d177032ea/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [],
      "additions": [
        {
          "line": 139,
          "old_api": null,
          "new_api": "count",
          "old_text": null,
          "new_text": "duration<double>(m_time_spent_in_first_row).count()",
          "old_line_content": "  } else {",
          "new_line_content": "      duration<double>(m_time_spent_in_first_row).count() * 1e3;",
          "content_same": false
        },
        {
          "line": 141,
          "old_api": null,
          "new_api": "count",
          "old_text": null,
          "new_text": "duration<double>(m_time_spent_in_first_row + m_time_spent_in_other_rows)\n          .count()",
          "old_line_content": "             \"(actual time=%.3f..%.3f rows=%lld loops=%\" PRIu64 \")\",",
          "new_line_content": "      duration<double>(m_time_spent_in_first_row + m_time_spent_in_other_rows)",
          "content_same": false
        },
        {
          "line": 146,
          "old_api": null,
          "new_api": "snprintf",
          "old_text": null,
          "new_text": "snprintf(buf, sizeof(buf), \"(never executed)\")",
          "old_line_content": "  return buf;",
          "new_line_content": "    snprintf(buf, sizeof(buf), \"(never executed)\");",
          "content_same": false
        },
        {
          "line": 148,
          "old_api": null,
          "new_api": "snprintf",
          "old_text": null,
          "new_text": "snprintf(buf, sizeof(buf),\n             \"(actual time=%.3f..%.3f rows=%lld loops=%\" PRIu64 \")\",\n             first_row_ms / m_num_init_calls, last_row_ms / m_num_init_calls,\n             llrintf(static_cast<double>(m_num_rows) / m_num_init_calls),\n             m_num_init_calls)",
          "old_line_content": "",
          "new_line_content": "    snprintf(buf, sizeof(buf),",
          "content_same": false
        },
        {
          "line": 151,
          "old_api": null,
          "new_api": "static_cast<double>(m_num_rows)",
          "old_text": null,
          "new_text": "static_cast<double>(m_num_rows)",
          "old_line_content": "//",
          "new_line_content": "             llrintf(static_cast<double>(m_num_rows) / m_num_init_calls),",
          "content_same": false
        },
        {
          "line": 167,
          "old_api": null,
          "new_api": "unique_ptr_destroy_only<RowIterator>(\n        new (thd->mem_root)\n            TimingIterator<RealIterator>(thd, std::forward<Args>(args)...))",
          "old_text": null,
          "new_text": "unique_ptr_destroy_only<RowIterator>(\n        new (thd->mem_root)\n            TimingIterator<RealIterator>(thd, std::forward<Args>(args)...))",
          "old_line_content": "",
          "new_line_content": "    return unique_ptr_destroy_only<RowIterator>(",
          "content_same": false
        },
        {
          "line": 169,
          "old_api": null,
          "new_api": "std::forward<Args>(args)",
          "old_text": null,
          "new_text": "std::forward<Args>(args)",
          "old_line_content": "",
          "new_line_content": "            TimingIterator<RealIterator>(thd, std::forward<Args>(args)...));",
          "content_same": false
        },
        {
          "line": 171,
          "old_api": null,
          "new_api": "unique_ptr_destroy_only<RowIterator>(\n        new (thd->mem_root) RealIterator(thd, std::forward<Args>(args)...))",
          "old_text": null,
          "new_text": "unique_ptr_destroy_only<RowIterator>(\n        new (thd->mem_root) RealIterator(thd, std::forward<Args>(args)...))",
          "old_line_content": "",
          "new_line_content": "    return unique_ptr_destroy_only<RowIterator>(",
          "content_same": false
        },
        {
          "line": 172,
          "old_api": null,
          "new_api": "std::forward<Args>(args)",
          "old_text": null,
          "new_text": "std::forward<Args>(args)",
          "old_line_content": "",
          "new_line_content": "        new (thd->mem_root) RealIterator(thd, std::forward<Args>(args)...));",
          "content_same": false
        },
        {
          "line": 87,
          "old_api": null,
          "new_api": "clock_gettime",
          "old_text": null,
          "new_text": "clock_gettime(CLOCK_MONOTONIC, &tp)",
          "old_line_content": "",
          "new_line_content": "    clock_gettime(CLOCK_MONOTONIC, &tp);",
          "content_same": false
        },
        {
          "line": 88,
          "old_api": null,
          "new_api": "steady_clock::time_point(\n        steady_clock::duration(std::chrono::seconds(tp.tv_sec) +\n                               std::chrono::nanoseconds(tp.tv_nsec)))",
          "old_text": null,
          "new_text": "steady_clock::time_point(\n        steady_clock::duration(std::chrono::seconds(tp.tv_sec) +\n                               std::chrono::nanoseconds(tp.tv_nsec)))",
          "old_line_content": "  // These are at the same offset for all TimingIterator specializations,",
          "new_line_content": "    return steady_clock::time_point(",
          "content_same": false
        },
        {
          "line": 89,
          "old_api": null,
          "new_api": "std::chrono::seconds(tp.tv_sec)",
          "old_text": null,
          "new_text": "std::chrono::seconds(tp.tv_sec)",
          "old_line_content": "  // in the hope that the linker can manage to fold all the TimingString()",
          "new_line_content": "        steady_clock::duration(std::chrono::seconds(tp.tv_sec) +",
          "content_same": false
        },
        {
          "line": 90,
          "old_api": null,
          "new_api": "std::chrono::nanoseconds(tp.tv_nsec)",
          "old_text": null,
          "new_text": "std::chrono::nanoseconds(tp.tv_nsec)",
          "old_line_content": "  // implementations into one.",
          "new_line_content": "                               std::chrono::nanoseconds(tp.tv_nsec)));",
          "content_same": false
        },
        {
          "line": 92,
          "old_api": null,
          "new_api": "steady_clock::now()",
          "old_text": null,
          "new_text": "steady_clock::now()",
          "old_line_content": "  uint64_t m_num_init_calls = 0;",
          "new_line_content": "    return steady_clock::now();",
          "content_same": false
        },
        {
          "line": 111,
          "old_api": null,
          "new_api": "now",
          "old_text": null,
          "new_text": "now()",
          "old_line_content": "template <class RealIterator>",
          "new_line_content": "  steady_clock::time_point start = now();",
          "content_same": false
        },
        {
          "line": 112,
          "old_api": null,
          "new_api": "Init",
          "old_text": null,
          "new_text": "m_iterator.Init()",
          "old_line_content": "int TimingIterator<RealIterator>::Read() {",
          "new_line_content": "  bool err = m_iterator.Init();",
          "content_same": false
        },
        {
          "line": 121,
          "old_api": null,
          "new_api": "now",
          "old_text": null,
          "new_text": "now()",
          "old_line_content": "  }",
          "new_line_content": "  steady_clock::time_point start = now();",
          "content_same": false
        },
        {
          "line": 122,
          "old_api": null,
          "new_api": "Read",
          "old_text": null,
          "new_text": "m_iterator.Read()",
          "old_line_content": "  if (err == 0) {",
          "new_line_content": "  int err = m_iterator.Read();",
          "content_same": false
        },
        {
          "line": 123,
          "old_api": null,
          "new_api": "now",
          "old_text": null,
          "new_text": "now()",
          "old_line_content": "    ++m_num_rows;",
          "new_line_content": "  steady_clock::time_point end = now();",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 161,
          "old_api": "std::forward<Args>(args)",
          "new_api": null,
          "old_text": "std::forward<Args>(args)",
          "new_text": null,
          "old_line_content": "            TimingIterator<RealIterator>(thd, std::forward<Args>(args)...));",
          "new_line_content": "// so that it collects timing information. For this reason, nearly all",
          "content_same": false
        },
        {
          "line": 131,
          "old_api": "count",
          "new_api": null,
          "old_text": "duration<double>(m_time_spent_in_first_row).count()",
          "new_text": null,
          "old_line_content": "      duration<double>(m_time_spent_in_first_row).count() * 1e3;",
          "new_line_content": "    ++m_num_rows;",
          "content_same": false
        },
        {
          "line": 163,
          "old_api": "unique_ptr_destroy_only<RowIterator>(\n        new (thd->mem_root) RealIterator(thd, std::forward<Args>(args)...))",
          "new_api": null,
          "old_text": "unique_ptr_destroy_only<RowIterator>(\n        new (thd->mem_root) RealIterator(thd, std::forward<Args>(args)...))",
          "new_text": null,
          "old_line_content": "    return unique_ptr_destroy_only<RowIterator>(",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 133,
          "old_api": "count",
          "new_api": null,
          "old_text": "duration<double>(m_time_spent_in_first_row + m_time_spent_in_other_rows)\n          .count()",
          "new_text": null,
          "old_line_content": "      duration<double>(m_time_spent_in_first_row + m_time_spent_in_other_rows)",
          "new_line_content": "  return err;",
          "content_same": false
        },
        {
          "line": 164,
          "old_api": "std::forward<Args>(args)",
          "new_api": null,
          "old_text": "std::forward<Args>(args)",
          "new_text": null,
          "old_line_content": "        new (thd->mem_root) RealIterator(thd, std::forward<Args>(args)...));",
          "new_line_content": "template <class RealIterator, class... Args>",
          "content_same": false
        },
        {
          "line": 103,
          "old_api": "now",
          "new_api": null,
          "old_text": "now()",
          "new_text": null,
          "old_line_content": "  steady_clock::time_point start = now();",
          "new_line_content": "  bool m_first_row;",
          "content_same": false
        },
        {
          "line": 104,
          "old_api": "Init",
          "new_api": null,
          "old_text": "m_iterator.Init()",
          "new_text": null,
          "old_line_content": "  bool err = m_iterator.Init();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 105,
          "old_api": "now",
          "new_api": null,
          "old_text": "now()",
          "new_text": null,
          "old_line_content": "  steady_clock::time_point end = now();",
          "new_line_content": "  RealIterator m_iterator;",
          "content_same": false
        },
        {
          "line": 138,
          "old_api": "snprintf",
          "new_api": null,
          "old_text": "snprintf(buf, sizeof(buf), \"(never executed)\")",
          "new_text": null,
          "old_line_content": "    snprintf(buf, sizeof(buf), \"(never executed)\");",
          "new_line_content": "  double first_row_ms =",
          "content_same": false
        },
        {
          "line": 140,
          "old_api": "snprintf",
          "new_api": null,
          "old_text": "snprintf(buf, sizeof(buf),\n             \"(actual time=%.3f..%.3f rows=%lld loops=%\" PRIu64 \")\",\n             first_row_ms / m_num_init_calls, last_row_ms / m_num_init_calls,\n             llrintf(static_cast<double>(m_num_rows) / m_num_init_calls),\n             m_num_init_calls)",
          "new_text": null,
          "old_line_content": "    snprintf(buf, sizeof(buf),",
          "new_line_content": "  double last_row_ms =",
          "content_same": false
        },
        {
          "line": 143,
          "old_api": "static_cast<double>(m_num_rows)",
          "new_api": null,
          "old_text": "static_cast<double>(m_num_rows)",
          "new_text": null,
          "old_line_content": "             llrintf(static_cast<double>(m_num_rows) / m_num_init_calls),",
          "new_line_content": "      1e3;",
          "content_same": false
        },
        {
          "line": 114,
          "old_api": "Read",
          "new_api": null,
          "old_text": "m_iterator.Read()",
          "new_text": null,
          "old_line_content": "  int err = m_iterator.Read();",
          "new_line_content": "  m_time_spent_in_first_row += end - start;",
          "content_same": false
        },
        {
          "line": 115,
          "old_api": "now",
          "new_api": null,
          "old_text": "now()",
          "new_text": null,
          "old_line_content": "  steady_clock::time_point end = now();",
          "new_line_content": "  m_first_row = true;",
          "content_same": false
        },
        {
          "line": 84,
          "old_api": "steady_clock::now()",
          "new_api": null,
          "old_text": "steady_clock::now()",
          "new_text": null,
          "old_line_content": "    return steady_clock::now();",
          "new_line_content": "    // Work around very slow libstdc++ implementations of std::chrono",
          "content_same": false
        },
        {
          "line": 159,
          "old_api": "unique_ptr_destroy_only<RowIterator>(\n        new (thd->mem_root)\n            TimingIterator<RealIterator>(thd, std::forward<Args>(args)...))",
          "new_api": null,
          "old_text": "unique_ptr_destroy_only<RowIterator>(\n        new (thd->mem_root)\n            TimingIterator<RealIterator>(thd, std::forward<Args>(args)...))",
          "new_text": null,
          "old_line_content": "    return unique_ptr_destroy_only<RowIterator>(",
          "new_line_content": "//",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 0,
      "total_additions": 19,
      "total_deletions": 15,
      "total_api_changes": 34
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 8,
        "api_related_lines": 34,
        "non_api_lines": 3,
        "non_api_line_numbers": [
          83,
          85,
          86
        ]
      }
    },
    "api_calls_before": 28,
    "api_calls_after": 33,
    "diff_info": {
      "added_lines": 8,
      "removed_lines": 0,
      "total_diff_lines": 20
    }
  }
}