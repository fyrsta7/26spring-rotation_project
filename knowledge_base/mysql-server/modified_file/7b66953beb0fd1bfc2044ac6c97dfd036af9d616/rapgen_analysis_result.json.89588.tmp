{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mysql-server/modified_file/7b66953beb0fd1bfc2044ac6c97dfd036af9d616",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mysql-server/modified_file/7b66953beb0fd1bfc2044ac6c97dfd036af9d616/before.cc",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mysql-server/modified_file/7b66953beb0fd1bfc2044ac6c97dfd036af9d616/after.cc",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mysql-server/modified_file/7b66953beb0fd1bfc2044ac6c97dfd036af9d616/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [],
      "additions": [],
      "deletions": [
        {
          "line": 2052,
          "api": "srv_active_wake_master_thread",
          "text": "srv_active_wake_master_thread()",
          "line_content": "\t\tsrv_active_wake_master_thread();"
        },
        {
          "line": 2056,
          "api": "UT_LIST_GET_FIRST",
          "text": "UT_LIST_GET_FIRST(trx->trx_savepoints)",
          "line_content": "\ttrx_named_savept_t*\tsavep = UT_LIST_GET_FIRST(trx->trx_savepoints);"
        },
        {
          "line": 2058,
          "api": "trx_roll_savepoints_free",
          "text": "trx_roll_savepoints_free(trx, savep)",
          "line_content": "\ttrx_roll_savepoints_free(trx, savep);"
        },
        {
          "line": 2061,
          "api": "trx_finalize_for_fts",
          "text": "trx_finalize_for_fts(trx, trx->undo_no != 0)",
          "line_content": "                trx_finalize_for_fts(trx, trx->undo_no != 0);"
        },
        {
          "line": 2064,
          "api": "trx_mutex_enter",
          "text": "trx_mutex_enter(trx)",
          "line_content": "\ttrx_mutex_enter(trx);"
        },
        {
          "line": 2083,
          "api": "assert_trx_is_free",
          "text": "assert_trx_is_free(trx)",
          "line_content": "\tassert_trx_is_free(trx);"
        },
        {
          "line": 2085,
          "api": "trx_init",
          "text": "trx_init(trx)",
          "line_content": "\ttrx_init(trx);"
        },
        {
          "line": 2087,
          "api": "trx_mutex_exit",
          "text": "trx_mutex_exit(trx)",
          "line_content": "\ttrx_mutex_exit(trx);"
        },
        {
          "line": 2089,
          "api": "ut_a",
          "text": "ut_a(trx->error_state == DB_SUCCESS)",
          "line_content": "\tut_a(trx->error_state == DB_SUCCESS);"
        },
        {
          "line": 2101,
          "api": "assert_trx_nonlocking_or_in_list",
          "text": "assert_trx_nonlocking_or_in_list(trx)",
          "line_content": "\tassert_trx_nonlocking_or_in_list(trx);"
        },
        {
          "line": 2102,
          "api": "trx_state_eq",
          "text": "trx_state_eq(trx, TRX_STATE_COMMITTED_IN_MEMORY)",
          "line_content": "\tut_ad(!trx_state_eq(trx, TRX_STATE_COMMITTED_IN_MEMORY));"
        },
        {
          "line": 2103,
          "api": "is_active",
          "text": "mtr->is_active()",
          "line_content": "\tut_ad(!mtr || mtr->is_active());"
        },
        {
          "line": 2104,
          "api": "trx_is_rseg_updated",
          "text": "trx_is_rseg_updated(trx)",
          "line_content": "\tut_ad(!mtr == !(trx_is_rseg_updated(trx)));"
        },
        {
          "line": 2110,
          "api": "trx_is_autocommit_non_locking",
          "text": "trx_is_autocommit_non_locking(trx)",
          "line_content": "\t\tut_a(!trx_is_autocommit_non_locking(trx));"
        },
        {
          "line": 2112,
          "api": "fts_commit",
          "text": "fts_commit(trx)",
          "line_content": "\t\terror = fts_commit(trx);"
        },
        {
          "line": 2132,
          "api": "set_sync",
          "text": "mtr->set_sync()",
          "line_content": "\t\tmtr->set_sync();"
        },
        {
          "line": 2134,
          "api": "trx_write_serialisation_history",
          "text": "trx_write_serialisation_history(trx, mtr)",
          "line_content": "\t\tserialised = trx_write_serialisation_history(trx, mtr);"
        },
        {
          "line": 98,
          "api": "ut_strlcpy",
          "text": "ut_strlcpy(trx->detailed_error, msg, MAX_DETAILED_ERROR_LEN)",
          "line_content": "\tut_strlcpy(trx->detailed_error, msg, MAX_DETAILED_ERROR_LEN);"
        },
        {
          "line": 2154,
          "api": "mtr_commit",
          "text": "mtr_commit(mtr)",
          "line_content": "\t\tmtr_commit(mtr);"
        },
        {
          "line": 2156,
          "api": "DBUG_EXECUTE_IF",
          "text": "DBUG_EXECUTE_IF(\"ib_crash_during_trx_commit_in_mem\",\n\t\t\t\tif (trx_is_rseg_updated(trx)) {\n\t\t\t\t\tlog_make_checkpoint_at(LSN_MAX, TRUE);\n\t\t\t\t\tDBUG_SUICIDE();\n\t\t\t\t})",
          "line_content": "\t\tDBUG_EXECUTE_IF(\"ib_crash_during_trx_commit_in_mem\","
        },
        {
          "line": 110,
          "api": "os_file_read_string",
          "text": "os_file_read_string(file, trx->detailed_error, MAX_DETAILED_ERROR_LEN)",
          "line_content": "\tos_file_read_string(file, trx->detailed_error, MAX_DETAILED_ERROR_LEN);"
        },
        {
          "line": 2158,
          "api": "log_make_checkpoint_at",
          "text": "log_make_checkpoint_at(LSN_MAX, TRUE)",
          "line_content": "\t\t\t\t\tlog_make_checkpoint_at(LSN_MAX, TRUE);"
        },
        {
          "line": 2159,
          "api": "DBUG_SUICIDE",
          "text": "DBUG_SUICIDE()",
          "line_content": "\t\t\t\t\tDBUG_SUICIDE();"
        },
        {
          "line": 2175,
          "api": "trx_is_redo_rseg_updated",
          "text": "trx_is_redo_rseg_updated(trx)",
          "line_content": "\tif (trx->mysql_thd != NULL && trx_is_redo_rseg_updated(trx)) {"
        },
        {
          "line": 2176,
          "api": "DEBUG_SYNC_C",
          "text": "DEBUG_SYNC_C(\"before_trx_state_committed_in_memory\")",
          "line_content": "\t\tDEBUG_SYNC_C(\"before_trx_state_committed_in_memory\");"
        },
        {
          "line": 2180,
          "api": "trx_commit_in_memory",
          "text": "trx_commit_in_memory(trx, mtr, serialised)",
          "line_content": "\ttrx_commit_in_memory(trx, mtr, serialised);"
        },
        {
          "line": 2193,
          "api": "DBUG_EXECUTE_IF",
          "text": "DBUG_EXECUTE_IF(\"ib_trx_commit_crash_before_trx_commit_start\",\n\t\t\tDBUG_SUICIDE();)",
          "line_content": "\tDBUG_EXECUTE_IF(\"ib_trx_commit_crash_before_trx_commit_start\","
        },
        {
          "line": 2194,
          "api": "DBUG_SUICIDE",
          "text": "DBUG_SUICIDE()",
          "line_content": "\t\t\tDBUG_SUICIDE(););"
        },
        {
          "line": 2196,
          "api": "trx_is_rseg_updated",
          "text": "trx_is_rseg_updated(trx)",
          "line_content": "\tif (trx_is_rseg_updated(trx)) {"
        },
        {
          "line": 2198,
          "api": "mtr_start_sync",
          "text": "mtr_start_sync(mtr)",
          "line_content": "\t\tmtr_start_sync(mtr);"
        },
        {
          "line": 2204,
          "api": "trx_commit_low",
          "text": "trx_commit_low(trx, mtr)",
          "line_content": "\ttrx_commit_low(trx, mtr);"
        },
        {
          "line": 2216,
          "api": "ut_ad",
          "text": "ut_ad(trx->is_recovered)",
          "line_content": "\tut_ad(trx->is_recovered);"
        },
        {
          "line": 172,
          "api": "ut_d",
          "text": "ut_d(trx->start_file = 0)",
          "line_content": "\tut_d(trx->start_file = 0);"
        },
        {
          "line": 174,
          "api": "ut_d",
          "text": "ut_d(trx->start_line = 0)",
          "line_content": "\tut_d(trx->start_line = 0);"
        },
        {
          "line": 2223,
          "api": "trx_undo_insert_cleanup",
          "text": "trx_undo_insert_cleanup(&trx->rsegs.m_redo, false)",
          "line_content": "\t\ttrx_undo_insert_cleanup(&trx->rsegs.m_redo, false);"
        },
        {
          "line": 2226,
          "api": "memset",
          "text": "memset(&trx->rsegs, 0x0, sizeof(trx->rsegs))",
          "line_content": "\tmemset(&trx->rsegs, 0x0, sizeof(trx->rsegs));"
        },
        {
          "line": 182,
          "api": "MVCC::is_view_active(trx->read_view)",
          "text": "MVCC::is_view_active(trx->read_view)",
          "line_content": "\tut_ad(!MVCC::is_view_active(trx->read_view));"
        },
        {
          "line": 2231,
          "api": "trx_sys_mutex_enter",
          "text": "trx_sys_mutex_enter()",
          "line_content": "\ttrx_sys_mutex_enter();"
        },
        {
          "line": 2233,
          "api": "ut_a",
          "text": "ut_a(!trx->read_only)",
          "line_content": "\tut_a(!trx->read_only);"
        },
        {
          "line": 2235,
          "api": "UT_LIST_REMOVE",
          "text": "UT_LIST_REMOVE(trx_sys->rw_trx_list, trx)",
          "line_content": "\tUT_LIST_REMOVE(trx_sys->rw_trx_list, trx);"
        },
        {
          "line": 2237,
          "api": "ut_d",
          "text": "ut_d(trx->in_rw_trx_list = FALSE)",
          "line_content": "\tut_d(trx->in_rw_trx_list = FALSE);"
        },
        {
          "line": 2239,
          "api": "trx_sys_mutex_exit",
          "text": "trx_sys_mutex_exit()",
          "line_content": "\ttrx_sys_mutex_exit();"
        },
        {
          "line": 192,
          "api": "TrxInInnoDB::is_async_rollback(trx)",
          "text": "TrxInInnoDB::is_async_rollback(trx)",
          "line_content": "\tif (!TrxInInnoDB::is_async_rollback(trx)) {"
        },
        {
          "line": 195,
          "api": "os_compare_and_swap_thread_id",
          "text": "os_compare_and_swap_thread_id(&trx->killed_by, thread_id, 0)",
          "line_content": "\t\tos_compare_and_swap_thread_id(&trx->killed_by, thread_id, 0);"
        },
        {
          "line": 2244,
          "api": "ut_ad",
          "text": "ut_ad(trx->is_recovered)",
          "line_content": "\tut_ad(trx->is_recovered);"
        },
        {
          "line": 2245,
          "api": "ut_ad",
          "text": "ut_ad(!trx->in_rw_trx_list)",
          "line_content": "\tut_ad(!trx->in_rw_trx_list);"
        },
        {
          "line": 2246,
          "api": "ut_ad",
          "text": "ut_ad(!trx->in_mysql_trx_list)",
          "line_content": "\tut_ad(!trx->in_mysql_trx_list);"
        },
        {
          "line": 207,
          "api": "clear",
          "text": "trx->hit_list.clear()",
          "line_content": "\ttrx->hit_list.clear();"
        },
        {
          "line": 2260,
          "api": "ut_ad",
          "text": "ut_ad(trx->state == TRX_STATE_ACTIVE)",
          "line_content": "\tut_ad(trx->state == TRX_STATE_ACTIVE);"
        },
        {
          "line": 2264,
          "api": "ut_ad",
          "text": "ut_ad(trx->read_view == NULL)",
          "line_content": "\t\tut_ad(trx->read_view == NULL);"
        },
        {
          "line": 2267,
          "api": "MVCC::is_view_active(trx->read_view)",
          "text": "MVCC::is_view_active(trx->read_view)",
          "line_content": "\t} else if (!MVCC::is_view_active(trx->read_view)) {"
        },
        {
          "line": 2268,
          "api": "view_open",
          "text": "trx_sys->mvcc->view_open(trx->read_view, trx)",
          "line_content": "\t\ttrx_sys->mvcc->view_open(trx->read_view, trx);"
        },
        {
          "line": 238,
          "api": "trx_init",
          "text": "trx_init(trx)",
          "line_content": "\t\ttrx_init(trx);"
        },
        {
          "line": 2290,
          "api": "trx_start_low",
          "text": "trx_start_low(trx, true)",
          "line_content": "\t\ttrx_start_low(trx, true);"
        },
        {
          "line": 244,
          "api": "xid_t",
          "text": "xid_t()",
          "line_content": "\t\ttrx->xid = UT_NEW_NOKEY(xid_t());"
        },
        {
          "line": 246,
          "api": "reinterpret_cast<char*>(\n\t\t\tut_zalloc_nokey(MAX_DETAILED_ERROR_LEN))",
          "text": "reinterpret_cast<char*>(\n\t\t\tut_zalloc_nokey(MAX_DETAILED_ERROR_LEN))",
          "line_content": "\t\ttrx->detailed_error = reinterpret_cast<char*>("
        },
        {
          "line": 247,
          "api": "ut_zalloc_nokey",
          "text": "ut_zalloc_nokey(MAX_DETAILED_ERROR_LEN)",
          "line_content": "\t\t\tut_zalloc_nokey(MAX_DETAILED_ERROR_LEN));"
        },
        {
          "line": 249,
          "api": "mem_heap_create_typed",
          "text": "mem_heap_create_typed(\n\t\t\t1024, MEM_HEAP_FOR_LOCK_HEAP)",
          "line_content": "\t\ttrx->lock.lock_heap = mem_heap_create_typed("
        },
        {
          "line": 252,
          "api": "lock_trx_lock_list_init",
          "text": "lock_trx_lock_list_init(&trx->lock.trx_locks)",
          "line_content": "\t\tlock_trx_lock_list_init(&trx->lock.trx_locks);"
        },
        {
          "line": 2301,
          "api": "ut_a",
          "text": "ut_a(trx->lock.wait_thr != NULL)",
          "line_content": "\t\t\tut_a(trx->lock.wait_thr != NULL);"
        },
        {
          "line": 254,
          "api": "UT_LIST_INIT",
          "text": "UT_LIST_INIT(\n\t\t\ttrx->trx_savepoints,\n\t\t\t&trx_named_savept_t::trx_savepoints)",
          "line_content": "\t\tUT_LIST_INIT("
        },
        {
          "line": 258,
          "api": "mutex_create",
          "text": "mutex_create(LATCH_ID_TRX, &trx->mutex)",
          "line_content": "\t\tmutex_create(LATCH_ID_TRX, &trx->mutex);"
        },
        {
          "line": 259,
          "api": "mutex_create",
          "text": "mutex_create(LATCH_ID_TRX_UNDO, &trx->undo_mutex)",
          "line_content": "\t\tmutex_create(LATCH_ID_TRX_UNDO, &trx->undo_mutex);"
        },
        {
          "line": 2308,
          "api": "ut_a",
          "text": "ut_a(trx->lock.n_active_thrs == 1)",
          "line_content": "\t\tut_a(trx->lock.n_active_thrs == 1);"
        },
        {
          "line": 261,
          "api": "lock_trx_alloc_locks",
          "text": "lock_trx_alloc_locks(trx)",
          "line_content": "\t\tlock_trx_alloc_locks(trx);"
        },
        {
          "line": 268,
          "api": "ut_a",
          "text": "ut_a(trx->magic_n == TRX_MAGIC_N)",
          "line_content": "\t\tut_a(trx->magic_n == TRX_MAGIC_N);"
        },
        {
          "line": 269,
          "api": "ut_ad",
          "text": "ut_ad(!trx->in_rw_trx_list)",
          "line_content": "\t\tut_ad(!trx->in_rw_trx_list);"
        },
        {
          "line": 270,
          "api": "ut_ad",
          "text": "ut_ad(!trx->in_mysql_trx_list)",
          "line_content": "\t\tut_ad(!trx->in_mysql_trx_list);"
        },
        {
          "line": 272,
          "api": "ut_a",
          "text": "ut_a(trx->lock.wait_lock == NULL)",
          "line_content": "\t\tut_a(trx->lock.wait_lock == NULL);"
        },
        {
          "line": 273,
          "api": "ut_a",
          "text": "ut_a(trx->lock.wait_thr == NULL)",
          "line_content": "\t\tut_a(trx->lock.wait_thr == NULL);"
        },
        {
          "line": 275,
          "api": "ut_a",
          "text": "ut_a(!trx->has_search_latch)",
          "line_content": "\t\tut_a(!trx->has_search_latch);"
        },
        {
          "line": 277,
          "api": "ut_a",
          "text": "ut_a(trx->dict_operation_lock_mode == 0)",
          "line_content": "\t\tut_a(trx->dict_operation_lock_mode == 0);"
        },
        {
          "line": 280,
          "api": "mem_heap_free",
          "text": "mem_heap_free(trx->lock.lock_heap)",
          "line_content": "\t\t\tmem_heap_free(trx->lock.lock_heap);"
        },
        {
          "line": 2328,
          "api": "mem_heap_alloc",
          "text": "mem_heap_alloc(heap, sizeof(*node))",
          "line_content": "\tnode = static_cast<commit_node_t*>(mem_heap_alloc(heap, sizeof(*node)));"
        },
        {
          "line": 284,
          "api": "UT_LIST_GET_LEN",
          "text": "UT_LIST_GET_LEN(trx->lock.trx_locks)",
          "line_content": "\t\tut_a(UT_LIST_GET_LEN(trx->lock.trx_locks) == 0);"
        },
        {
          "line"