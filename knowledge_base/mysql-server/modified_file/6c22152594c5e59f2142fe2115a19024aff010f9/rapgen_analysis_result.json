{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mysql-server/modified_file/6c22152594c5e59f2142fe2115a19024aff010f9",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mysql-server/modified_file/6c22152594c5e59f2142fe2115a19024aff010f9/before.h",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mysql-server/modified_file/6c22152594c5e59f2142fe2115a19024aff010f9/after.h",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mysql-server/modified_file/6c22152594c5e59f2142fe2115a19024aff010f9/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 592,
          "old_api": "my_isascii",
          "new_api": "length",
          "old_text": "my_isascii(*c)",
          "new_text": "length()",
          "old_line_content": "      if (!my_isascii(*c)) return false;",
          "new_line_content": "    if (length() == 0) return true;",
          "content_same": false
        },
        {
          "line": 609,
          "old_api": "length",
          "new_api": "swap",
          "old_text": "str.length()",
          "new_text": "a.swap(b)",
          "old_line_content": "  return std::string(str.ptr(), str.length());",
          "new_line_content": "static inline void swap(String &a, String &b) noexcept { a.swap(b); }",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 576,
          "old_api": null,
          "new_api": "mem_realloc_exp",
          "old_text": null,
          "new_text": "mem_realloc_exp(new_length + step_alloc)",
          "old_line_content": "    m_length += arg_length;",
          "new_line_content": "        mem_realloc_exp(new_length + step_alloc))",
          "content_same": false
        },
        {
          "line": 578,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(m_ptr + m_length, s, arg_length)",
          "old_line_content": "  }",
          "new_line_content": "    memcpy(m_ptr + m_length, s, arg_length);",
          "content_same": false
        },
        {
          "line": 643,
          "old_api": null,
          "new_api": "scan",
          "old_text": null,
          "new_text": "cs->cset->scan(cs, str, end, MY_SEQ_SPACES)",
          "old_line_content": "inline LEX_CSTRING to_lex_cstring(const LEX_STRING &s) {",
          "new_line_content": "  return str + cs->cset->scan(cs, str, end, MY_SEQ_SPACES) == end;",
          "content_same": false
        },
        {
          "line": 612,
          "old_api": null,
          "new_api": "length",
          "old_text": null,
          "new_text": "str.length()",
          "old_line_content": "/**",
          "new_line_content": "  return std::string(str.ptr(), str.length());",
          "content_same": false
        },
        {
          "line": 555,
          "old_api": null,
          "new_api": "mem_realloc",
          "old_text": null,
          "new_text": "mem_realloc(m_length + space_needed)",
          "old_line_content": "  }",
          "new_line_content": "      return mem_realloc(m_length + space_needed);",
          "content_same": false
        },
        {
          "line": 652,
          "old_api": null,
          "new_api": "const_cast<char *>(s.str)",
          "old_text": null,
          "new_text": "const_cast<char *>(s.str)",
          "old_line_content": "",
          "new_line_content": "  LEX_STRING str = {const_cast<char *>(s.str), s.length};",
          "content_same": false
        },
        {
          "line": 657,
          "old_api": null,
          "new_api": "strlen",
          "old_text": null,
          "new_text": "strlen(s)",
          "old_line_content": "",
          "new_line_content": "  LEX_CSTRING cstr = {s, s != nullptr ? strlen(s) : 0};",
          "content_same": false
        },
        {
          "line": 593,
          "old_api": null,
          "new_api": "charset",
          "old_text": null,
          "new_text": "charset()",
          "old_line_content": "    }",
          "new_line_content": "    if (charset()->mbminlen > 1) return false;",
          "content_same": false
        },
        {
          "line": 594,
          "old_api": null,
          "new_api": "length",
          "old_text": null,
          "new_text": "length()",
          "old_line_content": "    return true;",
          "new_line_content": "    for (const char *c = ptr(), *end = c + length(); c < end; c++) {",
          "content_same": false
        },
        {
          "line": 595,
          "old_api": null,
          "new_api": "my_isascii",
          "old_text": null,
          "new_text": "my_isascii(*c)",
          "old_line_content": "  }",
          "new_line_content": "      if (!my_isascii(*c)) return false;",
          "content_same": false
        },
        {
          "line": 566,
          "old_api": null,
          "new_api": "mem_realloc",
          "old_text": null,
          "new_text": "mem_realloc(new_length + step_alloc)",
          "old_line_content": "    m_length += arg_length;",
          "new_line_content": "      if (mem_realloc(new_length + step_alloc)) return nullptr;",
          "content_same": false
        },
        {
          "line": 631,
          "old_api": null,
          "new_api": "length",
          "old_text": null,
          "new_text": "length(0)",
          "old_line_content": "  }",
          "new_line_content": "  StringBuffer() : String(buff, buff_sz, &my_charset_bin) { length(0); }",
          "content_same": false
        },
        {
          "line": 632,
          "old_api": null,
          "new_api": "explicit",
          "old_text": null,
          "new_text": "explicit",
          "old_line_content": "  StringBuffer(const char *str, size_t length, const CHARSET_INFO *cs)",
          "new_line_content": "  explicit StringBuffer(const CHARSET_INFO *cs) : String(buff, buff_sz, cs) {",
          "content_same": false
        },
        {
          "line": 633,
          "old_api": null,
          "new_api": "length",
          "old_text": null,
          "new_text": "length(0)",
          "old_line_content": "      : String(buff, buff_sz, cs) {",
          "new_line_content": "    length(0);",
          "content_same": false
        },
        {
          "line": 637,
          "old_api": null,
          "new_api": "set",
          "old_text": null,
          "new_text": "set(str, length, cs)",
          "old_line_content": "",
          "new_line_content": "    set(str, length, cs);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 640,
          "old_api": "scan",
          "new_api": null,
          "old_text": "cs->cset->scan(cs, str, end, MY_SEQ_SPACES)",
          "new_text": null,
          "old_line_content": "  return str + cs->cset->scan(cs, str, end, MY_SEQ_SPACES) == end;",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 649,
          "old_api": "const_cast<char *>(s.str)",
          "new_api": null,
          "old_text": "const_cast<char *>(s.str)",
          "new_text": null,
          "old_line_content": "  LEX_STRING str = {const_cast<char *>(s.str), s.length};",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 554,
          "old_api": "mem_realloc",
          "new_api": null,
          "old_text": "mem_realloc(m_length + space_needed)",
          "new_text": null,
          "old_line_content": "    return mem_realloc(m_length + space_needed);",
          "new_line_content": "    if (m_alloced_length < m_length + space_needed) {",
          "content_same": false
        },
        {
          "line": 589,
          "old_api": "length",
          "new_api": null,
          "old_text": "length()",
          "new_text": null,
          "old_line_content": "    if (length() == 0) return true;",
          "new_line_content": "            m_ptr < s->m_ptr + s->m_length);",
          "content_same": false
        },
        {
          "line": 654,
          "old_api": "strlen",
          "new_api": null,
          "old_text": "strlen(s)",
          "new_text": null,
          "old_line_content": "  LEX_CSTRING cstr = {s, s != nullptr ? strlen(s) : 0};",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 590,
          "old_api": "charset",
          "new_api": null,
          "old_text": "charset()",
          "new_text": null,
          "old_line_content": "    if (charset()->mbminlen > 1) return false;",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 591,
          "old_api": "length",
          "new_api": null,
          "old_text": "length()",
          "new_text": null,
          "old_line_content": "    for (const char *c = ptr(), *end = c + length(); c < end; c++) {",
          "new_line_content": "  bool is_ascii() const {",
          "content_same": false
        },
        {
          "line": 563,
          "old_api": "mem_realloc",
          "new_api": null,
          "old_text": "mem_realloc(new_length + step_alloc)",
          "new_text": null,
          "old_line_content": "      if (mem_realloc(new_length + step_alloc)) return nullptr;",
          "new_line_content": "  char *prep_append(size_t arg_length, size_t step_alloc) {",
          "content_same": false
        },
        {
          "line": 628,
          "old_api": "length",
          "new_api": null,
          "old_text": "length(0)",
          "new_text": null,
          "old_line_content": "  StringBuffer() : String(buff, buff_sz, &my_charset_bin) { length(0); }",
          "new_line_content": "  char buff[buff_sz];",
          "content_same": false
        },
        {
          "line": 629,
          "old_api": "explicit",
          "new_api": null,
          "old_text": "explicit",
          "new_text": null,
          "old_line_content": "  explicit StringBuffer(const CHARSET_INFO *cs) : String(buff, buff_sz, cs) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 630,
          "old_api": "length",
          "new_api": null,
          "old_text": "length(0)",
          "new_text": null,
          "old_line_content": "    length(0);",
          "new_line_content": " public:",
          "content_same": false
        },
        {
          "line": 634,
          "old_api": "set",
          "new_api": null,
          "old_text": "set(str, length, cs)",
          "new_text": null,
          "old_line_content": "    set(str, length, cs);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 573,
          "old_api": "mem_realloc_exp",
          "new_api": null,
          "old_text": "mem_realloc_exp(new_length + step_alloc)",
          "new_text": null,
          "old_line_content": "        mem_realloc_exp(new_length + step_alloc))",
          "new_line_content": "  bool append(const char *s, size_t arg_length, size_t step_alloc) {",
          "content_same": false
        },
        {
          "line": 606,
          "old_api": "swap",
          "new_api": null,
          "old_text": "a.swap(b)",
          "new_text": null,
          "old_line_content": "static inline void swap(String &a, String &b) noexcept { a.swap(b); }",
          "new_line_content": "  char *dup(MEM_ROOT *root) const;",
          "content_same": false
        },
        {
          "line": 575,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(m_ptr + m_length, s, arg_length)",
          "new_text": null,
          "old_line_content": "    memcpy(m_ptr + m_length, s, arg_length);",
          "new_line_content": "    if (new_length > m_alloced_length &&",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 2,
      "total_additions": 15,
      "total_deletions": 15,
      "total_api_changes": 32
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 4,
        "api_related_lines": 32,
        "non_api_lines": 2,
        "non_api_line_numbers": [
          556,
          557
        ]
      }
    },
    "api_calls_before": 89,
    "api_calls_after": 89,
    "diff_info": {
      "added_lines": 4,
      "removed_lines": 1,
      "total_diff_lines": 17
    }
  }
}