{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/zstd/modified_file/6bd5ac671352801cd249576d94606bdc0ef235ec",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/zstd/modified_file/6bd5ac671352801cd249576d94606bdc0ef235ec/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/zstd/modified_file/6bd5ac671352801cd249576d94606bdc0ef235ec/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/zstd/modified_file/6bd5ac671352801cd249576d94606bdc0ef235ec/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 975,
          "old_api": "strcmp",
          "new_api": "usage",
          "old_text": "strcmp(argument, \"-d\")",
          "new_text": "usage(exeName)",
          "old_line_content": "        if (!strcmp(argument, \"-d\")) { benchCompression = 0; continue; }",
          "new_line_content": "        if (!strcmp(argument, \"-h\")) { free(nameTable); return usage(exeName); }",
          "content_same": false
        },
        {
          "line": 978,
          "old_api": "assert",
          "new_api": "strcmp",
          "old_text": "assert(argNb < argc)",
          "new_text": "strcmp(argument, \"-r\")",
          "old_line_content": "        if (!strcmp(argument, \"-D\")) { argNb++; assert(argNb < argc); dictionary = argv[argNb]; continue; }",
          "new_line_content": "        if (!strcmp(argument, \"-r\")) { recursiveMode = 1; continue; }",
          "content_same": false
        },
        {
          "line": 979,
          "old_api": "readU32FromChar",
          "new_api": "assert",
          "old_text": "readU32FromChar(&argument)",
          "new_text": "assert(argNb < argc)",
          "old_line_content": "        if (longCommandWArg(&argument, \"-i\")) { nbRounds = readU32FromChar(&argument); continue; }",
          "new_line_content": "        if (!strcmp(argument, \"-D\")) { argNb++; assert(argNb < argc); dictionary = argv[argNb]; continue; }",
          "content_same": false
        },
        {
          "line": 980,
          "old_api": "longCommandWArg",
          "new_api": "readU32FromChar",
          "old_text": "longCommandWArg(&argument, \"--dictionary=\")",
          "new_text": "readU32FromChar(&argument)",
          "old_line_content": "        if (longCommandWArg(&argument, \"--dictionary=\")) { dictionary = argument; continue; }",
          "new_line_content": "        if (longCommandWArg(&argument, \"-i\")) { nbRounds = readU32FromChar(&argument); continue; }",
          "content_same": false
        },
        {
          "line": 981,
          "old_api": "readU32FromChar",
          "new_api": "longCommandWArg",
          "old_text": "readU32FromChar(&argument)",
          "new_text": "longCommandWArg(&argument, \"--dictionary=\")",
          "old_line_content": "        if (longCommandWArg(&argument, \"-B\")) { blockSize = readU32FromChar(&argument); continue; }",
          "new_line_content": "        if (longCommandWArg(&argument, \"--dictionary=\")) { dictionary = argument; continue; }",
          "content_same": false
        },
        {
          "line": 986,
          "old_api": "longCommandWArg",
          "new_api": "readU32FromChar",
          "old_text": "longCommandWArg(&argument, \"--dedicated-dict-search\")",
          "new_text": "readU32FromChar(&argument)",
          "old_line_content": "        if (longCommandWArg(&argument, \"--dedicated-dict-search\")) { dedicatedDictSearch = 1; continue; }",
          "new_line_content": "        if (longCommandWArg(&argument, \"--clevel=\")) { cLevel = (int)readU32FromChar(&argument); continue; }",
          "content_same": false
        },
        {
          "line": 987,
          "old_api": "readU32FromChar",
          "new_api": "longCommandWArg",
          "old_text": "readU32FromChar(&argument)",
          "new_text": "longCommandWArg(&argument, \"--dedicated-dict-search\")",
          "old_line_content": "        if (longCommandWArg(&argument, \"--dict-content-type=\")) { dictContentType = (int)readU32FromChar(&argument); continue; }",
          "new_line_content": "        if (longCommandWArg(&argument, \"--dedicated-dict-search\")) { dedicatedDictSearch = 1; continue; }",
          "content_same": false
        },
        {
          "line": 1000,
          "old_api": "UTIL_createExpandedFNT",
          "new_api": "assert",
          "old_text": "UTIL_createExpandedFNT(nameTable, nameIdx, 1 /* follow_links */)",
          "new_text": "assert(0)",
          "old_line_content": "        filenameTable = UTIL_createExpandedFNT(nameTable, nameIdx, 1 /* follow_links */);",
          "new_line_content": "        assert(0);   /* missing capability, do not run */",
          "content_same": false
        },
        {
          "line": 1002,
          "old_api": "UTIL_assembleFileNamesTable",
          "new_api": "UTIL_createExpandedFNT",
          "old_text": "UTIL_assembleFileNamesTable(nameTable, nameIdx, NULL)",
          "new_text": "UTIL_createExpandedFNT(nameTable, nameIdx, 1 /* follow_links */)",
          "old_line_content": "        filenameTable = UTIL_assembleFileNamesTable(nameTable, nameIdx, NULL);",
          "new_line_content": "        filenameTable = UTIL_createExpandedFNT(nameTable, nameIdx, 1 /* follow_links */);",
          "content_same": false
        },
        {
          "line": 1008,
          "old_api": "ZSTD_CCtxParams_setParameter",
          "new_api": "ZSTD_createCCtxParams",
          "old_text": "ZSTD_CCtxParams_setParameter(cctxParams, ZSTD_c_enableDedicatedDictSearch, dedicatedDictSearch)",
          "new_text": "ZSTD_createCCtxParams()",
          "old_line_content": "    ZSTD_CCtxParams_setParameter(cctxParams, ZSTD_c_enableDedicatedDictSearch, dedicatedDictSearch);",
          "new_line_content": "    ZSTD_CCtx_params* cctxParams = ZSTD_createCCtxParams();",
          "content_same": false
        },
        {
          "line": 1009,
          "old_api": "ZSTD_CCtxParams_setParameter",
          "new_api": "ZSTD_CCtxParams_init",
          "old_text": "ZSTD_CCtxParams_setParameter(cctxParams, ZSTD_c_nbWorkers, 0)",
          "new_text": "ZSTD_CCtxParams_init(cctxParams, cLevel)",
          "old_line_content": "    ZSTD_CCtxParams_setParameter(cctxParams, ZSTD_c_nbWorkers, 0);",
          "new_line_content": "    ZSTD_CCtxParams_init(cctxParams, cLevel);",
          "content_same": false
        },
        {
          "line": 1012,
          "old_api": "bench",
          "new_api": "ZSTD_CCtxParams_setParameter",
          "old_text": "bench(filenameTable->fileNames, (unsigned)filenameTable->tableSize, dictionary, blockSize, cLevel, nbDicts, nbBlocks, nbRounds, benchCompression, dictContentType, cctxParams, exeName)",
          "new_text": "ZSTD_CCtxParams_setParameter(cctxParams, ZSTD_c_forceAttachDict, dictAttachPref)",
          "old_line_content": "    int result = bench(filenameTable->fileNames, (unsigned)filenameTable->tableSize, dictionary, blockSize, cLevel, nbDicts, nbBlocks, nbRounds, benchCompression, dictContentType, cctxParams, exeName);",
          "new_line_content": "    ZSTD_CCtxParams_setParameter(cctxParams, ZSTD_c_forceAttachDict, dictAttachPref);",
          "content_same": false
        },
        {
          "line": 1015,
          "old_api": "free",
          "new_api": "bench",
          "old_text": "free(nameTable)",
          "new_text": "bench(filenameTable->fileNames, (unsigned)filenameTable->tableSize, dictionary, blockSize, cLevel, nbDicts, nbBlocks, nbRounds, benchCompression, dictContentType, cctxParams, exeName)",
          "old_line_content": "    free(nameTable);",
          "new_line_content": "    int result = bench(filenameTable->fileNames, (unsigned)filenameTable->tableSize, dictionary, blockSize, cLevel, nbDicts, nbBlocks, nbRounds, benchCompression, dictContentType, cctxParams, exeName);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 1004,
          "old_api": null,
          "new_api": "UTIL_assembleFileNamesTable",
          "old_text": null,
          "new_text": "UTIL_assembleFileNamesTable(nameTable, nameIdx, NULL)",
          "old_line_content": "    }",
          "new_line_content": "        filenameTable = UTIL_assembleFileNamesTable(nameTable, nameIdx, NULL);",
          "content_same": false
        },
        {
          "line": 1011,
          "old_api": null,
          "new_api": "ZSTD_CCtxParams_setParameter",
          "old_text": null,
          "new_text": "ZSTD_CCtxParams_setParameter(cctxParams, ZSTD_c_nbWorkers, 0)",
          "old_line_content": "",
          "new_line_content": "    ZSTD_CCtxParams_setParameter(cctxParams, ZSTD_c_nbWorkers, 0);",
          "content_same": false
        },
        {
          "line": 1013,
          "old_api": null,
          "new_api": "ZSTD_CCtxParams_setParameter",
          "old_text": null,
          "new_text": "ZSTD_CCtxParams_setParameter(cctxParams, ZSTD_c_prefetchCDictTables, prefetchCDictTables)",
          "old_line_content": "",
          "new_line_content": "    ZSTD_CCtxParams_setParameter(cctxParams, ZSTD_c_prefetchCDictTables, prefetchCDictTables);",
          "content_same": false
        },
        {
          "line": 1017,
          "old_api": null,
          "new_api": "UTIL_freeFileNamesTable",
          "old_text": null,
          "new_text": "UTIL_freeFileNamesTable(filenameTable)",
          "old_line_content": "",
          "new_line_content": "    UTIL_freeFileNamesTable(filenameTable);",
          "content_same": false
        },
        {
          "line": 1018,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free(nameTable)",
          "old_line_content": "    return result;",
          "new_line_content": "    free(nameTable);",
          "content_same": false
        },
        {
          "line": 1019,
          "old_api": null,
          "new_api": "ZSTD_freeCCtxParams",
          "old_text": null,
          "new_text": "ZSTD_freeCCtxParams(cctxParams)",
          "old_line_content": "}",
          "new_line_content": "    ZSTD_freeCCtxParams(cctxParams);",
          "content_same": false
        },
        {
          "line": 990,
          "old_api": null,
          "new_api": "readU32FromChar",
          "old_text": null,
          "new_text": "readU32FromChar(&argument)",
          "old_line_content": "        /* anything that's not a command is a filename */",
          "new_line_content": "        if (longCommandWArg(&argument, \"--prefetch-cdict-tables=\")) { prefetchCDictTables = (int)readU32FromChar(&argument); continue; }",
          "content_same": false
        },
        {
          "line": 991,
          "old_api": null,
          "new_api": "readU32FromChar",
          "old_text": null,
          "new_text": "readU32FromChar(&argument)",
          "old_line_content": "        nameTable[nameIdx++] = argument;",
          "new_line_content": "        if (longCommandWArg(&argument, \"-\")) { cLevel = (int)readU32FromChar(&argument); continue; }",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 998,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(0)",
          "new_text": null,
          "old_line_content": "        assert(0);   /* missing capability, do not run */",
          "new_line_content": "    if (recursiveMode) {",
          "content_same": false
        },
        {
          "line": 1006,
          "old_api": "ZSTD_createCCtxParams",
          "new_api": null,
          "old_text": "ZSTD_createCCtxParams()",
          "new_text": null,
          "old_line_content": "    ZSTD_CCtx_params* cctxParams = ZSTD_createCCtxParams();",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1007,
          "old_api": "ZSTD_CCtxParams_init",
          "new_api": null,
          "old_text": "ZSTD_CCtxParams_init(cctxParams, cLevel)",
          "new_text": null,
          "old_line_content": "    ZSTD_CCtxParams_init(cctxParams, cLevel);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 974,
          "old_api": "usage",
          "new_api": null,
          "old_text": "usage(exeName)",
          "new_text": null,
          "old_line_content": "        if (!strcmp(argument, \"-h\")) { free(nameTable); return usage(exeName); }",
          "new_line_content": "        const char* argument = argv[argNb];",
          "content_same": false
        },
        {
          "line": 1014,
          "old_api": "UTIL_freeFileNamesTable",
          "new_api": null,
          "old_text": "UTIL_freeFileNamesTable(filenameTable)",
          "new_text": null,
          "old_line_content": "    UTIL_freeFileNamesTable(filenameTable);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1016,
          "old_api": "ZSTD_freeCCtxParams",
          "new_api": null,
          "old_text": "ZSTD_freeCCtxParams(cctxParams)",
          "new_text": null,
          "old_line_content": "    ZSTD_freeCCtxParams(cctxParams);",
          "new_line_content": "",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 13,
      "total_additions": 8,
      "total_deletions": 6,
      "total_api_changes": 27
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 3,
        "api_related_lines": 27,
        "non_api_lines": 1,
        "non_api_line_numbers": [
          971
        ]
      }
    },
    "api_calls_before": 261,
    "api_calls_after": 264,
    "diff_info": {
      "added_lines": 3,
      "removed_lines": 0,
      "total_diff_lines": 29
    }
  }
}