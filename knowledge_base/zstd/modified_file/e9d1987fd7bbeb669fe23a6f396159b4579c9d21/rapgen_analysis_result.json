{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/zstd/modified_file/e9d1987fd7bbeb669fe23a6f396159b4579c9d21",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/zstd/modified_file/e9d1987fd7bbeb669fe23a6f396159b4579c9d21/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/zstd/modified_file/e9d1987fd7bbeb669fe23a6f396159b4579c9d21/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/zstd/modified_file/e9d1987fd7bbeb669fe23a6f396159b4579c9d21/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 548,
          "old_api": "ZSTD_getLiteralPrice",
          "new_api": "DEBUGLOG",
          "old_text": "ZSTD_getLiteralPrice(optStatePtr, litlen, anchor)",
          "new_text": "DEBUGLOG(7, \"rPos:%u : better price (%u<%u) using literal\",\n                                cur, price, opt[cur].price)",
          "old_line_content": "                    price = ZSTD_getLiteralPrice(optStatePtr, litlen, anchor);",
          "new_line_content": "                    DEBUGLOG(7, \"rPos:%u : better price (%u<%u) using literal\",",
          "content_same": false
        },
        {
          "line": 569,
          "old_api": "ZSTD_BtGetAllMatches",
          "new_api": "assert",
          "old_text": "ZSTD_BtGetAllMatches(ctx, inr, iend, extDict, maxSearches, mls, sufficient_len, opt[cur].rep, ll0, matches, minMatch)",
          "new_text": "assert(baseLiterals >= prefixStart)",
          "old_line_content": "                U32 const nbMatches = ZSTD_BtGetAllMatches(ctx, inr, iend, extDict, maxSearches, mls, sufficient_len, opt[cur].rep, ll0, matches, minMatch);",
          "new_line_content": "                assert(baseLiterals >= prefixStart);",
          "content_same": false
        },
        {
          "line": 572,
          "old_api": "assert",
          "new_api": "DEBUGLOG",
          "old_text": "assert(baseLiterals >= prefixStart)",
          "new_text": "DEBUGLOG(7, \"rPos:%u, found %u matches, of maxLength=%u\",\n                                cur, nbMatches, maxML)",
          "old_line_content": "                assert(baseLiterals >= prefixStart);",
          "new_line_content": "                    DEBUGLOG(7, \"rPos:%u, found %u matches, of maxLength=%u\",",
          "content_same": false
        },
        {
          "line": 600,
          "old_api": "ZSTD_getPrice",
          "new_api": "DEBUGLOG",
          "old_text": "ZSTD_getPrice(optStatePtr, litlen, baseLiterals, offset, mlen, optLevel)",
          "new_text": "DEBUGLOG(7, \"rPos:%u => new better price (%u<%u)\",\n                                        pos, price, opt[pos].price)",
          "old_line_content": "                        U32 const price = basePrice + ZSTD_getPrice(optStatePtr, litlen, baseLiterals, offset, mlen, optLevel);",
          "new_line_content": "                            DEBUGLOG(7, \"rPos:%u => new better price (%u<%u)\",",
          "content_same": false
        },
        {
          "line": 617,
          "old_api": "assert",
          "new_api": "DEBUGLOG",
          "old_text": "assert(opt[0].mlen == 1)",
          "new_text": "DEBUGLOG(7, \"start reverse traversal (last_pos:%u, cur:%u)\",\n                    last_pos, cur)",
          "old_line_content": "        assert(opt[0].mlen == 1);",
          "new_line_content": "        DEBUGLOG(7, \"start reverse traversal (last_pos:%u, cur:%u)\",",
          "content_same": false
        },
        {
          "line": 661,
          "old_api": "ZSTD_storeSeq",
          "new_api": "ZSTD_setLog2Prices",
          "old_text": "ZSTD_storeSeq(seqStorePtr, llen, anchor, offset, mlen-MINMATCH)",
          "new_text": "ZSTD_setLog2Prices(optStatePtr)",
          "old_line_content": "                ZSTD_storeSeq(seqStorePtr, llen, anchor, offset, mlen-MINMATCH);",
          "new_line_content": "        ZSTD_setLog2Prices(optStatePtr);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 528,
          "old_api": null,
          "new_api": "DEBUGLOG",
          "old_text": null,
          "new_text": "DEBUGLOG(7, \"rPos:%u => set initial price : %u\",\n                                    pos, matchPrice)",
          "old_line_content": "                        if (pos > last_pos || matchPrice < opt[pos].price) {",
          "new_line_content": "                        DEBUGLOG(7, \"rPos:%u => set initial price : %u\",",
          "content_same": false
        },
        {
          "line": 657,
          "old_api": null,
          "new_api": "ZSTD_updateStats",
          "old_text": null,
          "new_text": "ZSTD_updateStats(optStatePtr, llen, anchor, offset, mlen)",
          "old_line_content": "                    }",
          "new_line_content": "                ZSTD_updateStats(optStatePtr, llen, anchor, offset, mlen);",
          "content_same": false
        },
        {
          "line": 530,
          "old_api": null,
          "new_api": "SET_PRICE",
          "old_text": null,
          "new_text": "SET_PRICE(pos, pos, offset, litlen, matchPrice, repHistory)",
          "old_line_content": "                                        pos, matchPrice);",
          "new_line_content": "                        SET_PRICE(pos, pos, offset, litlen, matchPrice, repHistory);   /* note : macro modifies last_pos */",
          "content_same": false
        },
        {
          "line": 658,
          "old_api": null,
          "new_api": "ZSTD_storeSeq",
          "old_text": null,
          "new_text": "ZSTD_storeSeq(seqStorePtr, llen, anchor, offset, mlen-MINMATCH)",
          "old_line_content": "                }",
          "new_line_content": "                ZSTD_storeSeq(seqStorePtr, llen, anchor, offset, mlen-MINMATCH);",
          "content_same": false
        },
        {
          "line": 537,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(cur < ZSTD_OPT_NUM)",
          "old_line_content": "        /* check further positions */",
          "new_line_content": "            assert(cur < ZSTD_OPT_NUM);",
          "content_same": false
        },
        {
          "line": 543,
          "old_api": null,
          "new_api": "ZSTD_getLiteralPrice",
          "old_text": null,
          "new_text": "ZSTD_getLiteralPrice(optStatePtr, litlen, inr-litlen)",
          "old_line_content": "            {   U32 const litlen = (opt[cur-1].mlen == 1) ? opt[cur-1].litlen + 1 : 1;",
          "new_line_content": "                    price = opt[cur - litlen].price + ZSTD_getLiteralPrice(optStatePtr, litlen, inr-litlen);",
          "content_same": false
        },
        {
          "line": 545,
          "old_api": null,
          "new_api": "ZSTD_getLiteralPrice",
          "old_text": null,
          "new_text": "ZSTD_getLiteralPrice(optStatePtr, litlen, anchor)",
          "old_line_content": "                if (cur > litlen) {",
          "new_line_content": "                    price = ZSTD_getLiteralPrice(optStatePtr, litlen, anchor);",
          "content_same": false
        },
        {
          "line": 674,
          "old_api": null,
          "new_api": "DEBUGLOG",
          "old_text": null,
          "new_text": "DEBUGLOG(5, \"ZSTD_compressBlock_btopt\")",
          "old_line_content": "",
          "new_line_content": "    DEBUGLOG(5, \"ZSTD_compressBlock_btopt\");",
          "content_same": false
        },
        {
          "line": 675,
          "old_api": null,
          "new_api": "ZSTD_compressBlock_opt_generic",
          "old_text": null,
          "new_text": "ZSTD_compressBlock_opt_generic(ctx, src, srcSize, 0 /*optLevel*/, 0 /*extDict*/)",
          "old_line_content": "size_t ZSTD_compressBlock_btopt(ZSTD_CCtx* ctx, const void* src, size_t srcSize)",
          "new_line_content": "    return ZSTD_compressBlock_opt_generic(ctx, src, srcSize, 0 /*optLevel*/, 0 /*extDict*/);",
          "content_same": false
        },
        {
          "line": 550,
          "old_api": null,
          "new_api": "SET_PRICE",
          "old_text": null,
          "new_text": "SET_PRICE(cur, 1/*mlen*/, 0/*offset*/, litlen, price, opt[cur-1].rep)",
          "old_line_content": "                if (price <= opt[cur].price) {",
          "new_line_content": "                    SET_PRICE(cur, 1/*mlen*/, 0/*offset*/, litlen, price, opt[cur-1].rep);",
          "content_same": false
        },
        {
          "line": 680,
          "old_api": null,
          "new_api": "ZSTD_compressBlock_opt_generic",
          "old_text": null,
          "new_text": "ZSTD_compressBlock_opt_generic(ctx, src, srcSize, 2 /*optLevel*/, 0 /*extDict*/)",
          "old_line_content": "",
          "new_line_content": "    return ZSTD_compressBlock_opt_generic(ctx, src, srcSize, 2 /*optLevel*/, 0 /*extDict*/);",
          "content_same": false
        },
        {
          "line": 685,
          "old_api": null,
          "new_api": "ZSTD_compressBlock_opt_generic",
          "old_text": null,
          "new_text": "ZSTD_compressBlock_opt_generic(ctx, src, srcSize, 0 /*optLevel*/, 1 /*extDict*/)",
          "old_line_content": "",
          "new_line_content": "    return ZSTD_compressBlock_opt_generic(ctx, src, srcSize, 0 /*optLevel*/, 1 /*extDict*/);",
          "content_same": false
        },
        {
          "line": 690,
          "old_api": null,
          "new_api": "ZSTD_compressBlock_opt_generic",
          "old_text": null,
          "new_text": "ZSTD_compressBlock_opt_generic(ctx, src, srcSize, 2 /*optLevel*/, 1 /*extDict*/)",
          "old_line_content": "",
          "new_line_content": "    return ZSTD_compressBlock_opt_generic(ctx, src, srcSize, 2 /*optLevel*/, 1 /*extDict*/);",
          "content_same": false
        },
        {
          "line": 566,
          "old_api": null,
          "new_api": "ZSTD_BtGetAllMatches",
          "old_text": null,
          "new_text": "ZSTD_BtGetAllMatches(ctx, inr, iend, extDict, maxSearches, mls, sufficient_len, opt[cur].rep, ll0, matches, minMatch)",
          "old_line_content": "                U32 const litlen = (opt[cur].mlen == 1) ? opt[cur].litlen : 0;",
          "new_line_content": "                U32 const nbMatches = ZSTD_BtGetAllMatches(ctx, inr, iend, extDict, maxSearches, mls, sufficient_len, opt[cur].rep, ll0, matches, minMatch);",
          "content_same": false
        },
        {
          "line": 587,
          "old_api": null,
          "new_api": "ZSTD_updateRep",
          "old_text": null,
          "new_text": "ZSTD_updateRep(opt[cur].rep, offset, ll0)",
          "old_line_content": "                /* set prices using matches found at position == cur */",
          "new_line_content": "                    repcodes_t const repHistory = ZSTD_updateRep(opt[cur].rep, offset, ll0);",
          "content_same": false
        },
        {
          "line": 592,
          "old_api": null,
          "new_api": "DEBUGLOG",
          "old_text": null,
          "new_text": "DEBUGLOG(7, \"testing match %u => offCode=%u, mlen=%u, llen=%u\",\n                                matchNb, matches[matchNb].off, lastML, litlen)",
          "old_line_content": "                    U32 const startML = (matchNb>0) ? matches[matchNb-1].len+1 : minMatch;",
          "new_line_content": "                    DEBUGLOG(7, \"testing match %u => offCode=%u, mlen=%u, llen=%u\",",
          "content_same": false
        },
        {
          "line": 597,
          "old_api": null,
          "new_api": "ZSTD_getPrice",
          "old_text": null,
          "new_text": "ZSTD_getPrice(optStatePtr, litlen, baseLiterals, offset, mlen, optLevel)",
          "old_line_content": "",
          "new_line_content": "                        U32 const price = basePrice + ZSTD_getPrice(optStatePtr, litlen, baseLiterals, offset, mlen, optLevel);",
          "content_same": false
        },
        {
          "line": 602,
          "old_api": null,
          "new_api": "SET_PRICE",
          "old_text": null,
          "new_text": "SET_PRICE(pos, mlen, offset, litlen, price, repHistory)",
          "old_line_content": "                        if ((pos > last_pos) || (price < opt[pos].price)) {",
          "new_line_content": "                            SET_PRICE(pos, mlen, offset, litlen, price, repHistory);  /* note : macro modifies last_pos */",
          "content_same": false
        },
        {
          "line": 614,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(opt[0].mlen == 1)",
          "old_line_content": "        cur = last_pos - best_mlen;",
          "new_line_content": "        assert(opt[0].mlen == 1);",
          "content_same": false
        },
        {
          "line": 636,
          "old_api": null,
          "new_api": "U32)(ip - anchor)",
          "old_text": null,
          "new_text": "U32)(ip - anchor)",
          "old_line_content": "        /* save sequences */",
          "new_line_content": "                U32 const llen = (U32)(ip - anchor);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 529,
          "old_api": "DEBUGLOG",
          "new_api": null,
          "old_text": "DEBUGLOG(7, \"rPos:%u => set initial price : %u\",\n                                        pos, matchPrice)",
          "new_text": null,
          "old_line_content": "                            DEBUGLOG(7, \"rPos:%u => set initial price : %u\",",
          "new_line_content": "                                    pos, matchPrice);",
          "content_same": false
        },
        {
          "line": 531,
          "old_api": "SET_PRICE",
          "new_api": null,
          "old_text": "SET_PRICE(pos, pos, offset, litlen, matchPrice, repHistory)",
          "new_text": null,
          "old_line_content": "                            SET_PRICE(pos, pos, offset, litlen, matchPrice, repHistory);   /* note : macro modifies last_pos */",
          "new_line_content": "            }   }   }",
          "content_same": false
        },
        {
          "line": 660,
          "old_api": "ZSTD_updateStats",
          "new_api": null,
          "old_text": "ZSTD_updateStats(optStatePtr, llen, anchor, offset, mlen)",
          "new_text": null,
          "old_line_content": "                ZSTD_updateStats(optStatePtr, llen, anchor, offset, mlen);",
          "new_line_content": "        }   }",
          "content_same": false
        },
        {
          "line": 664,
          "old_api": "ZSTD_setLog2Prices",
          "new_api": null,
          "old_text": "ZSTD_setLog2Prices(optStatePtr)",
          "new_text": null,
          "old_line_content": "        ZSTD_setLog2Prices(optStatePtr);",
          "new_line_content": "    /* Save reps for next block */",
          "content_same": false
        },
        {
          "line": 540,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(cur < ZSTD_OPT_NUM)",
          "new_text": null,
          "old_line_content": "            assert(cur < ZSTD_OPT_NUM);",
          "new_line_content": "            {   U32 const litlen = (opt[cur-1].mlen == 1) ? opt[cur-1].litlen + 1 : 1;",
          "content_same": false
        },
        {
          "line": 546,
          "old_api": "ZSTD_getLiteralPrice",
          "new_api": null,
          "old_text": "ZSTD_getLiteralPrice(optStatePtr, litlen, inr-litlen)",
          "new_text": null,
          "old_line_content": "                    price = opt[cur - litlen].price + ZSTD_getLiteralPrice(optStatePtr, litlen, inr-litlen);",
          "new_line_content": "                }",
          "content_same": false
        },
        {
          "line": 677,
          "old_api": "DEBUGLOG",
          "new_api": null,
          "old_text": "DEBUGLOG(5, \"ZSTD_compressBlock_btopt\")",
          "new_text": null,
          "old_line_content": "    DEBUGLOG(5, \"ZSTD_compressBlock_btopt\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 678,
          "old_api": "ZSTD_compressBlock_opt_generic",
          "new_api": null,
          "old_text": "ZSTD_compressBlock_opt_generic(ctx, src, srcSize, 0 /*optLevel*/, 0 /*extDict*/)",
          "new_text": null,
          "old_line_content": "    return ZSTD_compressBlock_opt_generic(ctx, src, srcSize, 0 /*optLevel*/, 0 /*extDict*/);",
          "new_line_content": "size_t ZSTD_compressBlock_btultra(ZSTD_CCtx* ctx, const void* src, size_t srcSize)",
          "content_same": false
        },
        {
          "line": 551,
          "old_api": "DEBUGLOG",
          "new_api": null,
          "old_text": "DEBUGLOG(7, \"rPos:%u : better price (%u<%u) using literal\",\n                                cur, price, opt[cur].price)",
          "new_text": null,
          "old_line_content": "                    DEBUGLOG(7, \"rPos:%u : better price (%u<%u) using literal\",",
          "new_line_content": "            }   }",
          "content_same": false
        },
        {
          "line": 553,
          "old_api": "SET_PRICE",
          "new_api": null,
          "old_text": "SET_PRICE(cur, 1/*mlen*/, 0/*offset*/, litlen, price, opt[cur-1].rep)",
          "new_text": null,
          "old_line_content": "                    SET_PRICE(cur, 1/*mlen*/, 0/*offset*/, litlen, price, opt[cur-1].rep);",
          "new_line_content": "            /* last match must start at a minimum distance of 8 from oend */",
          "content_same": false
        },
        {
          "line": 683,
          "old_api": "ZSTD_compressBlock_opt_generic",
          "new_api": null,
          "old_text": "ZSTD_compressBlock_opt_generic(ctx, src, srcSize, 2 /*optLevel*/, 0 /*extDict*/)",
          "new_text": null,
          "old_line_content": "    return ZSTD_compressBlock_opt_generic(ctx, src, srcSize, 2 /*optLevel*/, 0 /*extDict*/);",
          "new_line_content": "size_t ZSTD_compressBlock_btopt_extDict(ZSTD_CCtx* ctx, const void* src, size_t srcSize)",
          "content_same": false
        },
        {
          "line": 688,
          "old_api": "ZSTD_compressBlock_opt_generic",
          "new_api": null,
          "old_text": "ZSTD_compressBlock_opt_generic(ctx, src, srcSize, 0 /*optLevel*/, 1 /*extDict*/)",
          "new_text": null,
          "old_line_content": "    return ZSTD_compressBlock_opt_generic(ctx, src, srcSize, 0 /*optLevel*/, 1 /*extDict*/);",
          "new_line_content": "size_t ZSTD_compressBlock_btultra_extDict(ZSTD_CCtx* ctx, const void* src, size_t srcSize)",
          "content_same": false
        },
        {
          "line": 693,
          "old_api": "ZSTD_compressBlock_opt_generic",
          "new_api": null,
          "old_text": "ZSTD_compressBlock_opt_generic(ctx, src, srcSize, 2 /*optLevel*/, 1 /*extDict*/)",
          "new_text": null,
          "old_line_content": "    return ZSTD_compressBlock_opt_generic(ctx, src, srcSize, 2 /*optLevel*/, 1 /*extDict*/);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 575,
          "old_api": "DEBUGLOG",
          "new_api": null,
          "old_text": "DEBUGLOG(7, \"rPos:%u, found %u matches, of maxLength=%u\",\n                                cur, nbMatches, maxML)",
          "new_text": null,
          "old_line_content": "                    DEBUGLOG(7, \"rPos:%u, found %u matches, of maxLength=%u\",",
          "new_line_content": "                    if ( (maxML > sufficient_len)",
          "content_same": false
        },
        {
          "line": 590,
          "old_api": "ZSTD_updateRep",
          "new_api": null,
          "old_text": "ZSTD_updateRep(opt[cur].rep, offset, ll0)",
          "new_text": null,
          "old_line_content": "                    repcodes_t const repHistory = ZSTD_updateRep(opt[cur].rep, offset, ll0);",
          "new_line_content": "                    U32 mlen;",
          "content_same": false
        },
        {
          "line": 595,
          "old_api": "DEBUGLOG",
          "new_api": null,
          "old_text": "DEBUGLOG(7, \"testing match %u => offCode=%u, mlen=%u, llen=%u\",\n                                matchNb, matches[matchNb].off, lastML, litlen)",
          "new_text": null,
          "old_line_content": "                    DEBUGLOG(7, \"testing match %u => offCode=%u, mlen=%u, llen=%u\",",
          "new_line_content": "                    for (mlen = lastML; mlen >= startML; mlen--) {",
          "content_same": false
        },
        {
          "line": 603,
          "old_api": "DEBUGLOG",
          "new_api": null,
          "old_text": "DEBUGLOG(7, \"rPos:%u => new better price (%u<%u)\",\n                                        pos, price, opt[pos].price)",
          "new_text": null,
          "old_line_content": "                            DEBUGLOG(7, \"rPos:%u => new better price (%u<%u)\",",
          "new_line_content": "                        } else {",
          "content_same": false
        },
        {
          "line": 605,
          "old_api": "SET_PRICE",
          "new_api": null,
          "old_text": "SET_PRICE(pos, mlen, offset, litlen, price, repHistory)",
          "new_text": null,
          "old_line_content": "                            SET_PRICE(pos, mlen, offset, litlen, price, repHistory);  /* note : macro modifies last_pos */",
          "new_line_content": "                        }",
          "content_same": false
        },
        {
          "line": 620,
          "old_api": "DEBUGLOG",
          "new_api": null,
          "old_text": "DEBUGLOG(7, \"start reverse traversal (last_pos:%u, cur:%u)\",\n                    last_pos, cur)",
          "new_text": null,
          "old_line_content": "        DEBUGLOG(7, \"start reverse traversal (last_pos:%u, cur:%u)\",",
          "new_line_content": "            U32 selectedOffset = best_off;",
          "content_same": false
        },
        {
          "line": 639,
          "old_api": "U32)(ip - anchor)",
          "new_api": null,
          "old_text": "U32)(ip - anchor)",
          "new_text": null,
          "old_line_content": "                U32 const llen = (U32)(ip - anchor);",
          "new_line_content": "                if (mlen == 1) { ip++; pos++; continue; }  /* literal position => move on */",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 6,
      "total_additions": 20,
      "total_deletions": 20,
      "total_api_changes": 46
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 7,
        "api_related_lines": 46,
        "non_api_lines": 3,
        "non_api_line_numbers": [
          532,
          533,
          526
        ]
      }
    },
    "api_calls_before": 103,
    "api_calls_after": 103,
    "diff_info": {
      "added_lines": 4,
      "removed_lines": 7,
      "total_diff_lines": 24
    }
  }
}