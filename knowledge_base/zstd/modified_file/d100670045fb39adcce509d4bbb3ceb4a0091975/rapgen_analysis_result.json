{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/zstd/modified_file/d100670045fb39adcce509d4bbb3ceb4a0091975",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/zstd/modified_file/d100670045fb39adcce509d4bbb3ceb4a0091975/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/zstd/modified_file/d100670045fb39adcce509d4bbb3ceb4a0091975/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/zstd/modified_file/d100670045fb39adcce509d4bbb3ceb4a0091975/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 659,
          "old_api": "ZSTD_setLog2Prices",
          "new_api": "ZSTD_updateStats",
          "old_text": "ZSTD_setLog2Prices(optStatePtr)",
          "new_text": "ZSTD_updateStats(optStatePtr, llen, anchor, offset, mlen)",
          "old_line_content": "        ZSTD_setLog2Prices(optStatePtr);",
          "new_line_content": "                ZSTD_updateStats(optStatePtr, llen, anchor, offset, mlen);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 676,
          "old_api": null,
          "new_api": "DEBUGLOG",
          "old_text": null,
          "new_text": "DEBUGLOG(5, \"ZSTD_compressBlock_btopt\")",
          "old_line_content": "size_t ZSTD_compressBlock_btultra(ZSTD_CCtx* ctx, const void* src, size_t srcSize)",
          "new_line_content": "    DEBUGLOG(5, \"ZSTD_compressBlock_btopt\");",
          "content_same": false
        },
        {
          "line": 677,
          "old_api": null,
          "new_api": "ZSTD_compressBlock_opt_generic",
          "old_text": null,
          "new_text": "ZSTD_compressBlock_opt_generic(ctx, src, srcSize, 0 /*optLevel*/, 0 /*extDict*/)",
          "old_line_content": "{",
          "new_line_content": "    return ZSTD_compressBlock_opt_generic(ctx, src, srcSize, 0 /*optLevel*/, 0 /*extDict*/);",
          "content_same": false
        },
        {
          "line": 616,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(opt[0].mlen == 1)",
          "old_line_content": "                    last_pos, cur);",
          "new_line_content": "        assert(opt[0].mlen == 1);",
          "content_same": false
        },
        {
          "line": 682,
          "old_api": null,
          "new_api": "ZSTD_compressBlock_opt_generic",
          "old_text": null,
          "new_text": "ZSTD_compressBlock_opt_generic(ctx, src, srcSize, 2 /*optLevel*/, 0 /*extDict*/)",
          "old_line_content": "{",
          "new_line_content": "    return ZSTD_compressBlock_opt_generic(ctx, src, srcSize, 2 /*optLevel*/, 0 /*extDict*/);",
          "content_same": false
        },
        {
          "line": 619,
          "old_api": null,
          "new_api": "DEBUGLOG",
          "old_text": null,
          "new_text": "DEBUGLOG(7, \"start reverse traversal (last_pos:%u, cur:%u)\",\n                    last_pos, cur)",
          "old_line_content": "            U32 pos = cur;",
          "new_line_content": "        DEBUGLOG(7, \"start reverse traversal (last_pos:%u, cur:%u)\",",
          "content_same": false
        },
        {
          "line": 590,
          "old_api": null,
          "new_api": "ZSTD_updateRep",
          "old_text": null,
          "new_text": "ZSTD_updateRep(opt[cur].rep, offset, ll0)",
          "old_line_content": "",
          "new_line_content": "                    repcodes_t const repHistory = ZSTD_updateRep(opt[cur].rep, offset, ll0);",
          "content_same": false
        },
        {
          "line": 687,
          "old_api": null,
          "new_api": "ZSTD_compressBlock_opt_generic",
          "old_text": null,
          "new_text": "ZSTD_compressBlock_opt_generic(ctx, src, srcSize, 1 /*optLevel*/, 1 /*extDict*/)",
          "old_line_content": "{",
          "new_line_content": "    return ZSTD_compressBlock_opt_generic(ctx, src, srcSize, 1 /*optLevel*/, 1 /*extDict*/);",
          "content_same": false
        },
        {
          "line": 595,
          "old_api": null,
          "new_api": "DEBUGLOG",
          "old_text": null,
          "new_text": "DEBUGLOG(7, \"testing match %u => offCode=%u, mlen=%u, llen=%u\",\n                                matchNb, matches[matchNb].off, lastML, litlen)",
          "old_line_content": "                        U32 const pos = cur + mlen;",
          "new_line_content": "                    DEBUGLOG(7, \"testing match %u => offCode=%u, mlen=%u, llen=%u\",",
          "content_same": false
        },
        {
          "line": 660,
          "old_api": null,
          "new_api": "ZSTD_storeSeq",
          "old_text": null,
          "new_text": "ZSTD_storeSeq(seqStorePtr, llen, anchor, offset, mlen-MINMATCH)",
          "old_line_content": "    }   /* for (cur=0; cur < last_pos; ) */",
          "new_line_content": "                ZSTD_storeSeq(seqStorePtr, llen, anchor, offset, mlen-MINMATCH);",
          "content_same": false
        },
        {
          "line": 692,
          "old_api": null,
          "new_api": "ZSTD_compressBlock_opt_generic",
          "old_text": null,
          "new_text": "ZSTD_compressBlock_opt_generic(ctx, src, srcSize, 2 /*optLevel*/, 1 /*extDict*/)",
          "old_line_content": "",
          "new_line_content": "    return ZSTD_compressBlock_opt_generic(ctx, src, srcSize, 2 /*optLevel*/, 1 /*extDict*/);",
          "content_same": false
        },
        {
          "line": 663,
          "old_api": null,
          "new_api": "ZSTD_setLog2Prices",
          "old_text": null,
          "new_text": "ZSTD_setLog2Prices(optStatePtr)",
          "old_line_content": "    { int i; for (i=0; i<ZSTD_REP_NUM; i++) seqStorePtr->repToConfirm[i] = rep[i]; }",
          "new_line_content": "        ZSTD_setLog2Prices(optStatePtr);",
          "content_same": false
        },
        {
          "line": 600,
          "old_api": null,
          "new_api": "ZSTD_getPrice",
          "old_text": null,
          "new_text": "ZSTD_getPrice(optStatePtr, litlen, baseLiterals, offset, mlen, optLevel)",
          "old_line_content": "                                        pos, price, opt[pos].price);",
          "new_line_content": "                        U32 const price = basePrice + ZSTD_getPrice(optStatePtr, litlen, baseLiterals, offset, mlen, optLevel);",
          "content_same": false
        },
        {
          "line": 569,
          "old_api": null,
          "new_api": "ZSTD_BtGetAllMatches",
          "old_text": null,
          "new_text": "ZSTD_BtGetAllMatches(ctx, inr, iend, extDict, maxSearches, mls, opt[cur].rep, ll0, matches, minMatch)",
          "old_line_content": "",
          "new_line_content": "                U32 const nbMatches = ZSTD_BtGetAllMatches(ctx, inr, iend, extDict, maxSearches, mls, opt[cur].rep, ll0, matches, minMatch);",
          "content_same": false
        },
        {
          "line": 603,
          "old_api": null,
          "new_api": "DEBUGLOG",
          "old_text": null,
          "new_text": "DEBUGLOG(7, \"rPos:%u => new better price (%u<%u)\",\n                                        pos, price, opt[pos].price)",
          "old_line_content": "                            if (optLevel==0) break;  /* gets ~+10% speed for about 0.01 ratio loss */",
          "new_line_content": "                            DEBUGLOG(7, \"rPos:%u => new better price (%u<%u)\",",
          "content_same": false
        },
        {
          "line": 572,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(baseLiterals >= prefixStart)",
          "old_line_content": "                                cur, nbMatches, maxML);",
          "new_line_content": "                assert(baseLiterals >= prefixStart);",
          "content_same": false
        },
        {
          "line": 605,
          "old_api": null,
          "new_api": "SET_PRICE",
          "old_text": null,
          "new_text": "SET_PRICE(pos, mlen, offset, litlen, price, repHistory)",
          "old_line_content": "        }   }   }   }",
          "new_line_content": "                            SET_PRICE(pos, mlen, offset, litlen, price, repHistory);  /* note : macro modifies last_pos */",
          "content_same": false
        },
        {
          "line": 638,
          "old_api": null,
          "new_api": "U32)(ip - anchor)",
          "old_text": null,
          "new_text": "U32)(ip - anchor)",
          "old_line_content": "                pos += mlen; ip += mlen;",
          "new_line_content": "                U32 const llen = (U32)(ip - anchor);",
          "content_same": false
        },
        {
          "line": 575,
          "old_api": null,
          "new_api": "DEBUGLOG",
          "old_text": null,
          "new_text": "DEBUGLOG(7, \"rPos:%u, found %u matches, of maxLength=%u\",\n                                cur, nbMatches, maxML)",
          "old_line_content": "                       | (cur + maxML >= ZSTD_OPT_NUM) ) {",
          "new_line_content": "                    DEBUGLOG(7, \"rPos:%u, found %u matches, of maxLength=%u\",",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 672,
          "old_api": "DEBUGLOG",
          "new_api": null,
          "old_text": "DEBUGLOG(5, \"ZSTD_compressBlock_btopt\")",
          "new_text": null,
          "old_line_content": "    DEBUGLOG(5, \"ZSTD_compressBlock_btopt\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 673,
          "old_api": "ZSTD_compressBlock_opt_generic",
          "new_api": null,
          "old_text": "ZSTD_compressBlock_opt_generic(ctx, src, srcSize, 0 /*optLevel*/, 0 /*extDict*/)",
          "new_text": null,
          "old_line_content": "    return ZSTD_compressBlock_opt_generic(ctx, src, srcSize, 0 /*optLevel*/, 0 /*extDict*/);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 612,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(opt[0].mlen == 1)",
          "new_text": null,
          "old_line_content": "        assert(opt[0].mlen == 1);",
          "new_line_content": "        best_off = opt[last_pos].off;",
          "content_same": false
        },
        {
          "line": 678,
          "old_api": "ZSTD_compressBlock_opt_generic",
          "new_api": null,
          "old_text": "ZSTD_compressBlock_opt_generic(ctx, src, srcSize, 2 /*optLevel*/, 0 /*extDict*/)",
          "new_text": null,
          "old_line_content": "    return ZSTD_compressBlock_opt_generic(ctx, src, srcSize, 2 /*optLevel*/, 0 /*extDict*/);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 615,
          "old_api": "DEBUGLOG",
          "new_api": null,
          "old_text": "DEBUGLOG(7, \"start reverse traversal (last_pos:%u, cur:%u)\",\n                    last_pos, cur)",
          "new_text": null,
          "old_line_content": "        DEBUGLOG(7, \"start reverse traversal (last_pos:%u, cur:%u)\",",
          "new_line_content": "_shortestPath:   /* cur, last_pos, best_mlen, best_off have to be set */",
          "content_same": false
        },
        {
          "line": 586,
          "old_api": "ZSTD_updateRep",
          "new_api": null,
          "old_text": "ZSTD_updateRep(opt[cur].rep, offset, ll0)",
          "new_text": null,
          "old_line_content": "                    repcodes_t const repHistory = ZSTD_updateRep(opt[cur].rep, offset, ll0);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 683,
          "old_api": "ZSTD_compressBlock_opt_generic",
          "new_api": null,
          "old_text": "ZSTD_compressBlock_opt_generic(ctx, src, srcSize, 1 /*optLevel*/, 1 /*extDict*/)",
          "new_text": null,
          "old_line_content": "    return ZSTD_compressBlock_opt_generic(ctx, src, srcSize, 1 /*optLevel*/, 1 /*extDict*/);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 591,
          "old_api": "DEBUGLOG",
          "new_api": null,
          "old_text": "DEBUGLOG(7, \"testing match %u => offCode=%u, mlen=%u, llen=%u\",\n                                matchNb, matches[matchNb].off, lastML, litlen)",
          "new_text": null,
          "old_line_content": "                    DEBUGLOG(7, \"testing match %u => offCode=%u, mlen=%u, llen=%u\",",
          "new_line_content": "                    U32 const lastML = matches[matchNb].len;",
          "content_same": false
        },
        {
          "line": 655,
          "old_api": "ZSTD_updateStats",
          "new_api": null,
          "old_text": "ZSTD_updateStats(optStatePtr, llen, anchor, offset, mlen)",
          "new_text": null,
          "old_line_content": "                ZSTD_updateStats(optStatePtr, llen, anchor, offset, mlen);",
          "new_line_content": "                        rep[0] = currentOffset;",
          "content_same": false
        },
        {
          "line": 656,
          "old_api": "ZSTD_storeSeq",
          "new_api": null,
          "old_text": "ZSTD_storeSeq(seqStorePtr, llen, anchor, offset, mlen-MINMATCH)",
          "new_text": null,
          "old_line_content": "                ZSTD_storeSeq(seqStorePtr, llen, anchor, offset, mlen-MINMATCH);",
          "new_line_content": "                    }",
          "content_same": false
        },
        {
          "line": 688,
          "old_api": "ZSTD_compressBlock_opt_generic",
          "new_api": null,
          "old_text": "ZSTD_compressBlock_opt_generic(ctx, src, srcSize, 2 /*optLevel*/, 1 /*extDict*/)",
          "new_text": null,
          "old_line_content": "    return ZSTD_compressBlock_opt_generic(ctx, src, srcSize, 2 /*optLevel*/, 1 /*extDict*/);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 596,
          "old_api": "ZSTD_getPrice",
          "new_api": null,
          "old_text": "ZSTD_getPrice(optStatePtr, litlen, baseLiterals, offset, mlen, optLevel)",
          "new_text": null,
          "old_line_content": "                        U32 const price = basePrice + ZSTD_getPrice(optStatePtr, litlen, baseLiterals, offset, mlen, optLevel);",
          "new_line_content": "                                matchNb, matches[matchNb].off, lastML, litlen);",
          "content_same": false
        },
        {
          "line": 565,
          "old_api": "ZSTD_BtGetAllMatches",
          "new_api": null,
          "old_text": "ZSTD_BtGetAllMatches(ctx, inr, iend, extDict, maxSearches, mls, opt[cur].rep, ll0, matches, minMatch)",
          "new_text": null,
          "old_line_content": "                U32 const nbMatches = ZSTD_BtGetAllMatches(ctx, inr, iend, extDict, maxSearches, mls, opt[cur].rep, ll0, matches, minMatch);",
          "new_line_content": "            {   U32 const ll0 = (opt[cur].mlen != 1);",
          "content_same": false
        },
        {
          "line": 599,
          "old_api": "DEBUGLOG",
          "new_api": null,
          "old_text": "DEBUGLOG(7, \"rPos:%u => new better price (%u<%u)\",\n                                        pos, price, opt[pos].price)",
          "new_text": null,
          "old_line_content": "                            DEBUGLOG(7, \"rPos:%u => new better price (%u<%u)\",",
          "new_line_content": "                        U32 const pos = cur + mlen;",
          "content_same": false
        },
        {
          "line": 568,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(baseLiterals >= prefixStart)",
          "new_text": null,
          "old_line_content": "                assert(baseLiterals >= prefixStart);",
          "new_line_content": "                const BYTE* const baseLiterals = ip + cur - litlen;",
          "content_same": false
        },
        {
          "line": 601,
          "old_api": "SET_PRICE",
          "new_api": null,
          "old_text": "SET_PRICE(pos, mlen, offset, litlen, price, repHistory)",
          "new_text": null,
          "old_line_content": "                            SET_PRICE(pos, mlen, offset, litlen, price, repHistory);  /* note : macro modifies last_pos */",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 634,
          "old_api": "U32)(ip - anchor)",
          "new_api": null,
          "old_text": "U32)(ip - anchor)",
          "new_text": null,
          "old_line_content": "                U32 const llen = (U32)(ip - anchor);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 571,
          "old_api": "DEBUGLOG",
          "new_api": null,
          "old_text": "DEBUGLOG(7, \"rPos:%u, found %u matches, of maxLength=%u\",\n                                cur, nbMatches, maxML)",
          "new_text": null,
          "old_line_content": "                    DEBUGLOG(7, \"rPos:%u, found %u matches, of maxLength=%u\",",
          "new_line_content": "                if (!nbMatches) continue;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 1,
      "total_additions": 18,
      "total_deletions": 18,
      "total_api_changes": 37
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 10,
        "api_related_lines": 37,
        "non_api_lines": 9,
        "non_api_line_numbers": [
          556,
          557,
          559,
          560,
          561,
          562,
          563,
          564,
          607
        ]
      }
    },
    "api_calls_before": 102,
    "api_calls_after": 102,
    "diff_info": {
      "added_lines": 7,
      "removed_lines": 3,
      "total_diff_lines": 32
    }
  }
}