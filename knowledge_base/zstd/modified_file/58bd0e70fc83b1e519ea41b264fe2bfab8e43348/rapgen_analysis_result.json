{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/zstd/modified_file/58bd0e70fc83b1e519ea41b264fe2bfab8e43348",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/zstd/modified_file/58bd0e70fc83b1e519ea41b264fe2bfab8e43348/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/zstd/modified_file/58bd0e70fc83b1e519ea41b264fe2bfab8e43348/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/zstd/modified_file/58bd0e70fc83b1e519ea41b264fe2bfab8e43348/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": true,
    "api_changes": {
      "replacements": [
        {
          "line": 477,
          "old_api": "ZSTD_compress_advanced",
          "new_api": "ZSTD_compress_usingCDict_advanced",
          "old_text": "ZSTD_compress_advanced(cctx, dst, dstCapacity, src, srcSize, NULL, 0, params)",
          "new_text": "ZSTD_compress_usingCDict_advanced(cctx, dst, dstCapacity, src, srcSize, cdict, params.fParams)",
          "old_line_content": "        return ZSTD_compress_advanced(cctx, dst, dstCapacity, src, srcSize, NULL, 0, params);",
          "new_line_content": "        if (cdict) return ZSTD_compress_usingCDict_advanced(cctx, dst, dstCapacity, src, srcSize, cdict, params.fParams);",
          "content_same": false
        },
        {
          "line": 485,
          "old_api": "ERROR",
          "new_api": "ZSTDMT_allocJobsTable",
          "old_text": "ERROR(memory_allocation)",
          "new_text": "ZSTDMT_allocJobsTable(&nbJobs, mtctx->cMem)",
          "old_line_content": "        if (mtctx->jobs==NULL) return ERROR(memory_allocation);",
          "new_line_content": "        mtctx->jobs = ZSTDMT_allocJobsTable(&nbJobs, mtctx->cMem);",
          "content_same": false
        },
        {
          "line": 492,
          "old_api": "ZSTD_compressBound",
          "new_api": "MIN",
          "old_text": "ZSTD_compressBound(chunkSize)",
          "new_text": "MIN(remainingSrcSize, avgChunkSize)",
          "old_line_content": "            size_t const dstBufferCapacity = ZSTD_compressBound(chunkSize);",
          "new_line_content": "            size_t const chunkSize = MIN(remainingSrcSize, avgChunkSize);",
          "content_same": false
        },
        {
          "line": 495,
          "old_api": "ZSTDMT_getCCtx",
          "new_api": "ZSTDMT_getBuffer",
          "old_text": "ZSTDMT_getCCtx(mtctx->cctxPool)",
          "new_text": "ZSTDMT_getBuffer(mtctx->buffPool, dstBufferCapacity)",
          "old_line_content": "            ZSTD_CCtx* const cctx = ZSTDMT_getCCtx(mtctx->cctxPool);",
          "new_line_content": "            buffer_t const dstBuffer = u < compressWithinDst ? dstAsBuffer : ZSTDMT_getBuffer(mtctx->buffPool, dstBufferCapacity);",
          "content_same": false
        },
        {
          "line": 522,
          "old_api": "DEBUG_PRINTHEX",
          "new_api": "DEBUGLOG",
          "old_text": "DEBUG_PRINTHEX(6, mtctx->jobs[u].srcStart, 12)",
          "new_text": "DEBUGLOG(5, \"posting job %u   (%u bytes)\", u, (U32)chunkSize)",
          "old_line_content": "            DEBUG_PRINTHEX(6, mtctx->jobs[u].srcStart, 12);",
          "new_line_content": "            DEBUGLOG(5, \"posting job %u   (%u bytes)\", u, (U32)chunkSize);",
          "content_same": false
        },
        {
          "line": 523,
          "old_api": "POOL_add",
          "new_api": "DEBUG_PRINTHEX",
          "old_text": "POOL_add(mtctx->factory, ZSTDMT_compressChunk, &mtctx->jobs[u])",
          "new_text": "DEBUG_PRINTHEX(6, mtctx->jobs[u].srcStart, 12)",
          "old_line_content": "            POOL_add(mtctx->factory, ZSTDMT_compressChunk, &mtctx->jobs[u]);",
          "new_line_content": "            DEBUG_PRINTHEX(6, mtctx->jobs[u].srcStart, 12);",
          "content_same": false
        },
        {
          "line": 535,
          "old_api": "PTHREAD_MUTEX_LOCK",
          "new_api": "DEBUGLOG",
          "old_text": "PTHREAD_MUTEX_LOCK(&mtctx->jobCompleted_mutex)",
          "new_text": "DEBUGLOG(5, \"waiting for chunk %u \", chunkID)",
          "old_line_content": "            PTHREAD_MUTEX_LOCK(&mtctx->jobCompleted_mutex);",
          "new_line_content": "            DEBUGLOG(5, \"waiting for chunk %u \", chunkID);",
          "content_same": false
        },
        {
          "line": 538,
          "old_api": "pthread_cond_wait",
          "new_api": "DEBUGLOG",
          "old_text": "pthread_cond_wait(&mtctx->jobCompleted_cond, &mtctx->jobCompleted_mutex)",
          "new_text": "DEBUGLOG(5, \"waiting for jobCompleted signal from chunk %u\", chunkID)",
          "old_line_content": "                pthread_cond_wait(&mtctx->jobCompleted_cond, &mtctx->jobCompleted_mutex);",
          "new_line_content": "                DEBUGLOG(5, \"waiting for jobCompleted signal from chunk %u\", chunkID);",
          "content_same": false
        },
        {
          "line": 541,
          "old_api": "DEBUGLOG",
          "new_api": "pthread_mutex_unlock",
          "old_text": "DEBUGLOG(5, \"ready to write chunk %u \", chunkID)",
          "new_text": "pthread_mutex_unlock(&mtctx->jobCompleted_mutex)",
          "old_line_content": "            DEBUGLOG(5, \"ready to write chunk %u \", chunkID);",
          "new_line_content": "            pthread_mutex_unlock(&mtctx->jobCompleted_mutex);",
          "content_same": false
        },
        {
          "line": 548,
          "old_api": "ERROR",
          "new_api": "ZSTD_isError",
          "old_text": "ERROR(dstSize_tooSmall)",
          "new_text": "ZSTD_isError(cSize)",
          "old_line_content": "                if ((!error) && (dstPos + cSize > dstCapacity)) error = ERROR(dstSize_tooSmall);",
          "new_line_content": "                if (ZSTD_isError(cSize)) error = cSize;",
          "content_same": false
        },
        {
          "line": 554,
          "old_api": "ZSTDMT_releaseBuffer",
          "new_api": "DEBUGLOG",
          "old_text": "ZSTDMT_releaseBuffer(mtctx->buffPool, mtctx->jobs[chunkID].dstBuff)",
          "new_text": "DEBUGLOG(5, \"releasing buffer %u>=%u\", chunkID, compressWithinDst)",
          "old_line_content": "                        ZSTDMT_releaseBuffer(mtctx->buffPool, mtctx->jobs[chunkID].dstBuff);",
          "new_line_content": "                        DEBUGLOG(5, \"releasing buffer %u>=%u\", chunkID, compressWithinDst);",
          "content_same": false
        },
        {
          "line": 573,
          "old_api": "ZSTD_getParams",
          "new_api": "ZSTD_maxCLevel",
          "old_text": "ZSTD_getParams(compressionLevel, srcSize, 0)",
          "new_text": "ZSTD_maxCLevel()",
          "old_line_content": "    ZSTD_parameters params = ZSTD_getParams(compressionLevel, srcSize, 0);",
          "new_line_content": "    U32 const overlapRLog = (compressionLevel >= ZSTD_maxCLevel()) ? 0 : 3;",
          "content_same": false
        },
        {
          "line": 591,
          "old_api": "pthread_cond_wait",
          "new_api": "DEBUGLOG",
          "old_text": "pthread_cond_wait(&zcs->jobCompleted_cond, &zcs->jobCompleted_mutex)",
          "new_text": "DEBUGLOG(5, \"waiting for jobCompleted signal from chunk %u\", zcs->doneJobID)",
          "old_line_content": "            pthread_cond_wait(&zcs->jobCompleted_cond, &zcs->jobCompleted_mutex);",
          "new_line_content": "            DEBUGLOG(5, \"waiting for jobCompleted signal from chunk %u\", zcs->doneJobID);   /* we want to block when waiting for data to flush */",
          "content_same": false
        },
        {
          "line": 608,
          "old_api": "assert",
          "new_api": "ZSTD_checkCParams",
          "old_text": "assert(!((dict) && (cdict)))",
          "new_text": "ZSTD_checkCParams(params.cParams)",
          "old_line_content": "    assert(!((dict) && (cdict)));  /* either dict or cdict, not both */",
          "new_line_content": "    assert(!ZSTD_isError(ZSTD_checkCParams(params.cParams)));",
          "content_same": false
        },
        {
          "line": 612,
          "old_api": "ZSTD_initCStream_internal",
          "new_api": "DEBUGLOG",
          "old_text": "ZSTD_initCStream_internal(zcs->cctxPool->cctx[0],\n                                dict, dictSize, cdict,\n                                params, pledgedSrcSize)",
          "new_text": "DEBUGLOG(4, \"single thread mode\")",
          "old_line_content": "        return ZSTD_initCStream_internal(zcs->cctxPool->cctx[0],",
          "new_line_content": "        DEBUGLOG(4, \"single thread mode\");",
          "content_same": false
        },
        {
          "line": 619,
          "old_api": "ZSTDMT_releaseAllJobResources",
          "new_api": "ZSTDMT_waitForAllJobsCompleted",
          "old_text": "ZSTDMT_releaseAllJobResources(zcs)",
          "new_text": "ZSTDMT_waitForAllJobsCompleted(zcs)",
          "old_line_content": "        ZSTDMT_releaseAllJobResources(zcs);",
          "new_line_content": "        ZSTDMT_waitForAllJobsCompleted(zcs);",
          "content_same": false
        },
        {
          "line": 627,
          "old_api": "ZSTD_freeCDict",
          "new_api": "DEBUGLOG",
          "old_text": "ZSTD_freeCDict(zcs->cdictLocal)",
          "new_text": "DEBUGLOG(4,\"cdictLocal: %08X\", (U32)(size_t)zcs->cdictLocal)",
          "old_line_content": "        ZSTD_freeCDict(zcs->cdictLocal);",
          "new_line_content": "        DEBUGLOG(4,\"cdictLocal: %08X\", (U32)(size_t)zcs->cdictLocal);",
          "content_same": false
        },
        {
          "line": 628,
          "old_api": "ZSTD_createCDict_advanced",
          "new_api": "ZSTD_freeCDict",
          "old_text": "ZSTD_createCDict_advanced(dict, dictSize,\n                                                    0 /* byRef */, ZSTD_dm_auto,   /* note : a loadPrefix becomes an internal CDict */\n                                                    params.cParams, zcs->cMem)",
          "new_text": "ZSTD_freeCDict(zcs->cdictLocal)",
          "old_line_content": "        zcs->cdictLocal = ZSTD_createCDict_advanced(dict, dictSize,",
          "new_line_content": "        ZSTD_freeCDict(zcs->cdictLocal);",
          "content_same": false
        },
        {
          "line": 635,
          "old_api": "ZSTD_freeCDict",
          "new_api": "DEBUGLOG",
          "old_text": "ZSTD_freeCDict(zcs->cdictLocal)",
          "new_text": "DEBUGLOG(4,\"cdictLocal: %08X\", (U32)(size_t)zcs->cdictLocal)",
          "old_line_content": "        ZSTD_freeCDict(zcs->cdictLocal);",
          "new_line_content": "        DEBUGLOG(4,\"cdictLocal: %08X\", (U32)(size_t)zcs->cdictLocal);",
          "content_same": false
        },
        {
          "line": 642,
          "old_api": "U32)(zcs->targetDictSize>>10)",
          "new_api": "DEBUGLOG",
          "old_text": "U32)(zcs->targetDictSize>>10)",
          "new_text": "DEBUGLOG(4, \"overlapRLog : %u \", zcs->overlapRLog)",
          "old_line_content": "    DEBUGLOG(4, \"overlap Size : %u KB\", (U32)(zcs->targetDictSize>>10));",
          "new_line_content": "    DEBUGLOG(4, \"overlapRLog : %u \", zcs->overlapRLog);",
          "content_same": false
        },
        {
          "line": 646,
          "old_api": "U32)(zcs->targetSectionSize>>10)",
          "new_api": "MAX",
          "old_text": "U32)(zcs->targetSectionSize>>10)",
          "new_text": "MAX(zcs->targetDictSize, zcs->targetSectionSize)",
          "old_line_content": "    DEBUGLOG(4, \"Section Size : %u KB\", (U32)(zcs->targetSectionSize>>10));",
          "new_line_content": "    zcs->targetSectionSize = MAX(zcs->targetDictSize, zcs->targetSectionSize);",
          "content_same": false
        },
        {
          "line": 650,
          "old_api": "ERROR",
          "new_api": "ZSTDMT_getBuffer",
          "old_text": "ERROR(memory_allocation)",
          "new_text": "ZSTDMT_getBuffer(zcs->buffPool, zcs->inBuffSize)",
          "old_line_content": "    if (zcs->inBuff.buffer.start == NULL) return ERROR(memory_allocation);",
          "new_line_content": "    zcs->inBuff.buffer = ZSTDMT_getBuffer(zcs->buffPool, zcs->inBuffSize);",
          "content_same": false
        },
        {
          "line": 666,
          "old_api": "ZSTDMT_initCStream_internal",
          "new_api": "DEBUGLOG",
          "old_text": "ZSTDMT_initCStream_internal(mtctx, dict, dictSize, NULL, params, pledgedSrcSize)",
          "new_text": "DEBUGLOG(5, \"ZSTDMT_initCStream_advanced\")",
          "old_line_content": "    return ZSTDMT_initCStream_internal(mtctx, dict, dictSize, NULL, params, pledgedSrcSize);",
          "new_line_content": "    DEBUGLOG(5, \"ZSTDMT_initCStream_advanced\");",
          "content_same": false
        },
        {
          "line": 675,
          "old_api": "ERROR",
          "new_api": "ZSTD_getParamsFromCDict",
          "old_text": "ERROR(dictionary_wrong)",
          "new_text": "ZSTD_getParamsFromCDict(cdict)",
          "old_line_content": "    if (cdict==NULL) return ERROR(dictionary_wrong);   /* method incompatible with NULL cdict */",
          "new_line_content": "    ZSTD_parameters params = ZSTD_getParamsFromCDict(cdict);",
          "content_same": false
        },
        {
          "line": 688,
          "old_api": "ZSTDMT_initCStream_internal",
          "new_api": "ZSTD_resetCStream",
          "old_text": "ZSTDMT_initCStream_internal(zcs, NULL, 0, 0, zcs->params, pledgedSrcSize)",
          "new_text": "ZSTD_resetCStream(zcs->cctxPool->cctx[0], pledgedSrcSize)",
          "old_line_content": "    return ZSTDMT_initCStream_internal(zcs, NULL, 0, 0, zcs->params, pledgedSrcSize);",
          "new_line_content": "        return ZSTD_resetCStream(zcs->cctxPool->cctx[0], pledgedSrcSize);",
          "content_same": false
        },
        {
          "line": 693,
          "old_api": "ZSTDMT_initCStream_internal",
          "new_api": "ZSTD_getParams",
          "old_text": "ZSTDMT_initCStream_internal(zcs, NULL, 0, NULL, params, 0)",
          "new_text": "ZSTD_getParams(compressionLevel, 0, 0)",
          "old_line_content": "    return ZSTDMT_initCStream_internal(zcs, NULL, 0, NULL, params, 0);",
          "new_line_content": "    ZSTD_parameters const params = ZSTD_getParams(compressionLevel, 0, 0);",
          "content_same": false
        },
        {
          "line": 700,
          "old_api": "ZSTDMT_getBuffer",
          "new_api": "ZSTD_compressBound",
          "old_text": "ZSTDMT_getBuffer(zcs->buffPool, dstBufferCapacity)",
          "new_text": "ZSTD_compressBound(srcSize)",
          "old_line_content": "    buffer_t const dstBuffer = ZSTDMT_getBuffer(zcs->buffPool, dstBufferCapacity);",
          "new_line_content": "    size_t const dstBufferCapacity = ZSTD_compressBound(srcSize);",
          "content_same": false
        },
        {
          "line": 701,
          "old_api": "ZSTDMT_getCCtx",
          "new_api": "ZSTDMT_getBuffer",
          "old_text": "ZSTDMT_getCCtx(zcs->cctxPool)",
          "new_text": "ZSTDMT_getBuffer(zcs->buffPool, dstBufferCapacity)",
          "old_line_content": "    ZSTD_CCtx* const cctx = ZSTDMT_getCCtx(zcs->cctxPool);",
          "new_line_content": "    buffer_t const dstBuffer = ZSTDMT_getBuffer(zcs->buffPool, dstBufferCapacity);",
          "content_same": false
        },
        {
          "line": 708,
          "old_api": "ZSTDMT_releaseAllJobResources",
          "new_api": "ZSTDMT_waitForAllJobsCompleted",
          "old_text": "ZSTDMT_releaseAllJobResources(zcs)",
          "new_text": "ZSTDMT_waitForAllJobsCompleted(zcs)",
          "old_line_content": "        ZSTDMT_releaseAllJobResources(zcs);",
          "new_line_content": "        ZSTDMT_waitForAllJobsCompleted(zcs);",
          "content_same": false
        },
        {
          "line": 709,
          "old_api": "ERROR",
          "new_api": "ZSTDMT_releaseAllJobResources",
          "old_text": "ERROR(memory_allocation)",
          "new_text": "ZSTDMT_releaseAllJobResources(zcs)",
          "old_line_content": "        return ERROR(memory_allocation);",
          "new_line_content": "        ZSTDMT_releaseAllJobResources(zcs);",
          "content_same": false
        },
        {
          "line": 736,
          "old_api": "DEBUGLOG",
          "new_api": "MIN",
          "old_text": "DEBUGLOG(5, \"ZSTDMT_createCompressionJob::endFrame = %u\", endFrame)",
          "new_text": "MIN(srcSize + zcs->dictSize, zcs->targetDictSize)",
          "old_line_content": "        DEBUGLOG(5, \"ZSTDMT_createCompressionJob::endFrame = %u\", endFrame);",
          "new_line_content": "        size_t const newDictSize = MIN(srcSize + zcs->dictSize, zcs->targetDictSize);",
          "content_same": false
        },
        {
          "line": 737,
          "old_api": "ZSTDMT_getBuffer",
          "new_api": "DEBUGLOG",
          "old_text": "ZSTDMT_getBuffer(zcs->buffPool, zcs->inBuffSize)",
          "new_text": "DEBUGLOG(5, \"ZSTDMT_createCompressionJob::endFrame = %u\", endFrame)",
          "old_line_content": "        zcs->inBuff.buffer = ZSTDMT_getBuffer(zcs->buffPool, zcs->inBuffSize);",
          "new_line_content": "        DEBUGLOG(5, \"ZSTDMT_createCompressionJob::endFrame = %u\", endFrame);",
          "content_same": false
        },
        {
          "line": 742,
          "old_api": "ZSTDMT_releaseAllJobResources",
          "new_api": "ZSTDMT_waitForAllJobsCompleted",
          "old_text": "ZSTDMT_releaseAllJobResources(zcs)",
          "new_text": "ZSTDMT_waitForAllJobsCompleted(zcs)",
          "old_line_content": "            ZSTDMT_releaseAllJobResources(zcs);",
          "new_line_content": "            ZSTDMT_waitForAllJobsCompleted(zcs);",
          "content_same": false
        },
        {
          "line": 743,
          "old_api": "ERROR",
          "new_api": "ZSTDMT_releaseAllJobResources",
          "old_text": "ERROR(memory_allocation)",
          "new_text": "ZSTDMT_releaseAllJobResources(zcs)",
          "old_line_content": "            return ERROR(memory_allocation);",
          "new_line_content": "            ZSTDMT_releaseAllJobResources(zcs);",
          "content_same": false
        },
        {
          "line": 750,
          "old_api": "memmove",
          "new_api": "U32)(zcs->inBuff.filled - newDictSize)",
          "old_text": "memmove(zcs->inBuff.buffer.start,\n            (const char*)zcs->jobs[jobID].srcStart + zcs->dictSize + srcSize - newDictSize,\n            zcs->inBuff.filled)",
          "new_text": "U32)(zcs->inBuff.filled - newDictSize)",
          "old_line_content": "        memmove(zcs->inBuff.buffer.start,",
          "new_line_content": "                    (U32)(zcs->inBuff.filled - newDictSize));",
          "content_same": false
        },
        {
          "line": 789,
          "old_api": "pthread_mutex_unlock",
          "new_api": "DEBUGLOG",
          "old_text": "pthread_mutex_unlock(&zcs->jobCompleted_mutex)",
          "new_text": "DEBUGLOG(5, \"waiting for jobCompleted signal from job %u\", zcs->doneJobID)",
          "old_line_content": "        if (!blockToFlush) { pthread_mutex_unlock(&zcs->jobCompleted_mutex); return 0; }  /* nothing ready to be flushed => skip */",
          "new_line_content": "        DEBUGLOG(5, \"waiting for jobCompleted signal from job %u\", zcs->doneJobID);",
          "content_same": false
        },
        {
          "line": 790,
          "old_api": "pthread_cond_wait",
          "new_api": "pthread_mutex_unlock",
          "old_text": "pthread_cond_wait(&zcs->jobCompleted_cond, &zcs->jobCompleted_mutex)",
          "new_text": "pthread_mutex_unlock(&zcs->jobCompleted_mutex)",
          "old_line_content": "        pthread_cond_wait(&zcs->jobCompleted_cond, &zcs->jobCompleted_mutex);  /* block when nothing available to flush */",
          "new_line_content": "        if (!blockToFlush) { pthread_mutex_unlock(&zcs->jobCompleted_mutex); return 0; }  /* nothing ready to be flushed => skip */",
          "content_same": false
        },
        {
          "line": 797,
          "old_api": "DEBUGLOG",
          "new_api": "ZSTD_isError",
          "old_text": "DEBUGLOG(5, \"compression error detected \")",
          "new_text": "ZSTD_isError(job.cSize)",
          "old_line_content": "                DEBUGLOG(5, \"compression error detected \");",
          "new_line_content": "            if (ZSTD_isError(job.cSize)) {",
          "content_same": false
        },
        {
          "line": 798,
          "old_api": "ZSTDMT_waitForAllJobsCompleted",
          "new_api": "DEBUGLOG",
          "old_text": "ZSTDMT_waitForAllJobsCompleted(zcs)",
          "new_text": "DEBUGLOG(5, \"compression error detected \")",
          "old_line_content": "                ZSTDMT_waitForAllJobsCompleted(zcs);",
          "new_line_content": "                DEBUGLOG(5, \"compression error detected \");",
          "content_same": false
        },
        {
          "line": 799,
          "old_api": "ZSTDMT_releaseAllJobResources",
          "new_api": "ZSTDMT_waitForAllJobsCompleted",
          "old_text": "ZSTDMT_releaseAllJobResources(zcs)",
          "new_text": "ZSTDMT_waitForAllJobsCompleted(zcs)",
          "old_line_content": "                ZSTDMT_releaseAllJobResources(zcs);",
          "new_line_content": "                ZSTDMT_waitForAllJobsCompleted(zcs);",
          "content_same": false
        },
        {
          "line": 809,
          "old_api": "DEBUGLOG",
          "new_api": "XXH64_digest",
          "old_text": "DEBUGLOG(5, \"writing checksum : %08X \\n\", checksum)",
          "new_text": "XXH64_digest(&zcs->xxhState)",
          "old_line_content": "                    DEBUGLOG(5, \"writing checksum : %08X \\n\", checksum);",
          "new_line_content": "                    U32 const checksum = (U32)XXH64_digest(&zcs->xxhState);",
          "content_same": false
        },
        {
          "line": 810,
          "old_api": "MEM_writeLE32",
          "new_api": "DEBUGLOG",
          "old_text": "MEM_writeLE32((char*)job.dstBuff.start + job.cSize, checksum)",
          "new_text": "DEBUGLOG(5, \"writing checksum : %08X \\n\", checksum)",
          "old_line_content": "                    MEM_writeLE32((char*)job.dstBuff.start + job.cSize, checksum);",
          "new_line_content": "                    DEBUGLOG(5, \"writing checksum : %08X \\n\", checksum);",
          "content_same": false
        },
        {
          "line": 820,
          "old_api": "DEBUGLOG",
          "new_api": "MIN",
          "old_text": "DEBUGLOG(5, \"Flushing %u bytes from job %u \", (U32)toWrite, zcs->doneJobID)",
          "new_text": "MIN(job.cSize - job.dstFlushed, output->size - output->pos)",
          "old_line_content": "            DEBUGLOG(5, \"Flushing %u bytes from job %u \", (U32)toWrite, zcs->doneJobID);",
          "new_line_content": "        {   size_t const toWrite = MIN(job.cSize - job.dstFlushed, output->size - output->pos);",
          "content_same": false
        },
        {
          "line": 821,
          "old_api": "memcpy",
          "new_api": "DEBUGLOG",
          "old_text": "memcpy((char*)output->dst + output->pos, (const char*)job.dstBuff.start + job.dstFlushed, toWrite)",
          "new_text": "DEBUGLOG(5, \"Flushing %u bytes from job %u \", (U32)toWrite, zcs->doneJobID)",
          "old_line_content": "            memcpy((char*)output->dst + output->pos, (const char*)job.dstBuff.start + job.dstFlushed, toWrite);",
          "new_line_content": "            DEBUGLOG(5, \"Flushing %u bytes from job %u \", (U32)toWrite, zcs->doneJobID);",
          "content_same": false
        },
        {
          "line": 866,
          "old_api": "ZSTDMT_compress_advanced",
          "new_api": "ZSTD_compressBound",
          "old_text": "ZSTDMT_compress_advanced(mtctx,\n                (char*)output->dst + output->pos, output->size - output->pos,\n                (const char*)input->src + input->pos, input->size - input->pos,\n                mtctx->cdict, mtctx->params, mtctx->overlapRLog)",
          "new_text": "ZSTD_compressBound(input->size - input->pos)",
          "old_line_content": "        size_t const cSize = ZSTDMT_compress_advanced(mtctx,",
          "new_line_content": "      && (output->size - output->pos >= ZSTD_compressBound(input->size - input->pos)) ) { /* enough room */",
          "content_same": false
        },
        {
          "line": 881,
          "old_api": "memcpy",
          "new_api": "MIN",
          "old_text": "memcpy((char*)mtctx->inBuff.buffer.start + mtctx->inBuff.filled, (const char*)input->src + input->pos, toLoad)",
          "new_text": "MIN(input->size - input->pos, mtctx->inBuffSize - mtctx->inBuff.filled)",
          "old_line_content": "        memcpy((char*)mtctx->inBuff.buffer.start + mtctx->inBuff.filled, (const char*)input->src + input->pos, toLoad);",
          "new_line_content": "    {   size_t const toLoad = MIN(input->size - input->pos, mtctx->inBuffSize - mtctx->inBuff.filled);",
          "content_same": false
        },
        {
          "line": 917,
          "old_api": "ERROR",
          "new_api": "DEBUGLOG",
          "old_text": "ERROR(stage_wrong)",
          "new_text": "DEBUGLOG(5, \"ZSTDMT_compressStream: zcs::frameEnded==1\")",
          "old_line_content": "        return ERROR(stage_wrong);",
          "new_line_content": "        DEBUGLOG(5, \"ZSTDMT_compressStream: zcs::frameEnded==1\");",
          "content_same": false
        },
        {
          "line": 925,
          "old_api": "memcpy",
          "new_api": "MIN",
          "old_text": "memcpy((char*)zcs->inBuff.buffer.start + zcs->inBuff.filled, (const char*)input->src + input->pos, toLoad)",
          "new_text": "MIN(input->size - input->pos, zcs->inBuffSize - zcs->inBuff.filled)",
          "old_line_content": "        memcpy((char*)zcs->inBuff.buffer.start + zcs->inBuff.filled, (const char*)input->src + input->pos, toLoad);",
          "new_line_content": "    {   size_t const toLoad = MIN(input->size - input->pos, zcs->inBuffSize - zcs->inBuff.filled);",
          "content_same": false
        },
        {
          "line": 962,
          "old_api": "ZSTDMT_flushStream_internal",
          "new_api": "ZSTD_flushStream",
          "old_text": "ZSTDMT_flushStream_internal(zcs, output, 0 /* endFrame */)",
          "new_text": "ZSTD_flushStream(zcs->cctxPool->cctx[0], output)",
          "old_line_content": "    return ZSTDMT_flushStream_internal(zcs, output, 0 /* endFrame */);",
          "new_line_content": "        return ZSTD_flushStream(zcs->cctxPool->cctx[0], output);",
          "content_same": false
        },
        {
          "line": 970,
          "old_api": "ZSTDMT_flushStream_internal",
          "new_api": "ZSTD_endStream",
          "old_text": "ZSTDMT_flushStream_internal(zcs, output, 1 /* endFrame */)",
          "new_text": "ZSTD_endStream(zcs->cctxPool->cctx[0], output)",
          "old_line_content": "    return ZSTDMT_flushStream_internal(zcs, output, 1 /* endFrame */);",
          "new_line_content": "        return ZSTD_endStream(zcs->cctxPool->cctx[0], output);",
          "content_same": false
        },
        {
          "line": 991,
          "old_api": "ZSTDMT_endStream",
          "new_api": "DEBUGLOG",
          "old_text": "ZSTDMT_endStream(mtctx, output)",
          "new_text": "DEBUGLOG(5, \"endOp:%u; calling ZSTDMT_endStream\", (U32)endOp)",
          "old_line_content": "            return ZSTDMT_endStream(mtctx, output);",
          "new_line_content": "            DEBUGLOG(5, \"endOp:%u; calling ZSTDMT_endStream\", (U32)endOp);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 524,
          "old_api": null,
          "new_api": "POOL_add",
          "old_text": null,
          "new_text": "POOL_add(mtctx->factory, ZSTDMT_compressChunk, &mtctx->jobs[u])",
          "old_line_content": "",
          "new_line_content": "            POOL_add(mtctx->factory, ZSTDMT_compressChunk, &mtctx->jobs[u]);",
          "content_same": false
        },
        {
          "line": 536,
          "old_api": null,
          "new_api": "PTHREAD_MUTEX_LOCK",
          "old_text": null,
          "new_text": "PTHREAD_MUTEX_LOCK(&mtctx->jobCompleted_mutex)",
          "old_line_content": "            while (mtctx->jobs[chunkID].jobCompleted==0) {",
          "new_line_content": "            PTHREAD_MUTEX_LOCK(&mtctx->jobCompleted_mutex);",
          "content_same": false
        },
        {
          "line": 539,
          "old_api": null,
          "new_api": "pthread_cond_wait",
          "old_text": null,
          "new_text": "pthread_cond_wait(&mtctx->jobCompleted_cond, &mtctx->jobCompleted_mutex)",
          "old_line_content": "            }",
          "new_line_content": "                pthread_cond_wait(&mtctx->jobCompleted_cond, &mtctx->jobCompleted_mutex);",
          "content_same": false
        },
        {
          "line": 542,
          "old_api": null,
          "new_api": "DEBUGLOG",
          "old_text": null,
          "new_text": "DEBUGLOG(5, \"ready to write chunk %u \", chunkID)",
          "old_line_content": "",
          "new_line_content": "            DEBUGLOG(5, \"ready to write chunk %u \", chunkID);",
          "content_same": false
        },
        {
          "line": 544,
          "old_api": null,
          "new_api": "ZSTDMT_releaseCCtx",
          "old_text": null,
          "new_text": "ZSTDMT_releaseCCtx(mtctx->cctxPool, mtctx->jobs[chunkID].cctx)",
          "old_line_content": "            mtctx->jobs[chunkID].cctx = NULL;",
          "new_line_content": "            ZSTDMT_releaseCCtx(mtctx->cctxPool, mtctx->jobs[chunkID].cctx);",
          "content_same": false
        },
        {
          "line": 549,
          "old_api": null,
          "new_api": "ERROR",
          "old_text": null,
          "new_text": "ERROR(dstSize_tooSmall)",
          "old_line_content": "                if (chunkID) {   /* note : chunk 0 is already written directly into dst */",
          "new_line_content": "                if ((!error) && (dstPos + cSize > dstCapacity)) error = ERROR(dstSize_tooSmall);",
          "content_same": false
        },
        {
          "line": 552,
          "old_api": null,
          "new_api": "memmove",
          "old_text": null,
          "new_text": "memmove((char*)dst + dstPos, mtctx->jobs[chunkID].dstBuff.start, cSize)",
          "old_line_content": "                    if (chunkID >= compressWithinDst) {  /* otherwise, it decompresses within dst */",
          "new_line_content": "                        memmove((char*)dst + dstPos, mtctx->jobs[chunkID].dstBuff.start, cSize);  /* may overlap if chunk decompressed within dst */",
          "content_same": false
        },
        {
          "line": 555,
          "old_api": null,
          "new_api": "ZSTDMT_releaseBuffer",
          "old_text": null,
          "new_text": "ZSTDMT_releaseBuffer(mtctx->buffPool, mtctx->jobs[chunkID].dstBuff)",
          "old_line_content": "                    }",
          "new_line_content": "                        ZSTDMT_releaseBuffer(mtctx->buffPool, mtctx->jobs[chunkID].dstBuff);",
          "content_same": false
        },
        {
          "line": 562,
          "old_api": null,
          "new_api": "DEBUGLOG",
          "old_text": null,
          "new_text": "DEBUGLOG(4, \"compressed size : %u  \", (U32)dstPos)",
          "old_line_content": "        return error ? error : dstPos;",
          "new_line_content": "        if (!error) DEBUGLOG(4, \"compressed size : %u  \", (U32)dstPos);",
          "content_same": false
        },
        {
          "line": 574,
          "old_api": null,
          "new_api": "ZSTD_getParams",
          "old_text": null,
          "new_text": "ZSTD_getParams(compressionLevel, srcSize, 0)",
          "old_line_content": "    params.fParams.contentSizeFlag = 1;",
          "new_line_content": "    ZSTD_parameters params = ZSTD_getParams(compressionLevel, srcSize, 0);",
          "content_same": false
        },
        {
          "line": 576,
          "old_api": null,
          "new_api": "ZSTDMT_compress_advanced",
          "old_text": null,
          "new_text": "ZSTDMT_compress_advanced(mtctx, dst, dstCapacity, src, srcSize, NULL, params, overlapRLog)",
          "old_line_content": "}",
          "new_line_content": "    return ZSTDMT_compress_advanced(mtctx, dst, dstCapacity, src, srcSize, NULL, params, overlapRLog);",
          "content_same": false
        },
        {
          "line": 586,
          "old_api": null,
          "new_api": "DEBUGLOG",
          "old_text": null,
          "new_text": "DEBUGLOG(4, \"ZSTDMT_waitForAllJobsCompleted\")",
          "old_line_content": "    while (zcs->doneJobID < zcs->nextJobID) {",
          "new_line_content": "    DEBUGLOG(4, \"ZSTDMT_waitForAllJobsCompleted\");",
          "content_same": false
        },
        {
          "line": 589,
          "old_api": null,
          "new_api": "PTHREAD_MUTEX_LOCK",
          "old_text": null,
          "new_text": "PTHREAD_MUTEX_LOCK(&zcs->jobCompleted_mutex)",
          "old_line_content": "        while (zcs->jobs[jobID].jobCompleted==0) {",
          "new_line_content": "        PTHREAD_MUTEX_LOCK(&zcs->jobCompleted_mutex);",
          "content_same": false
        },
        {
          "line": 592,
          "old_api": null,
          "new_api": "pthread_cond_wait",
          "old_text": null,
          "new_text": "pthread_cond_wait(&zcs->jobCompleted_cond, &zcs->jobCompleted_mutex)",
          "old_line_content": "        }",
          "new_line_content": "            pthread_cond_wait(&zcs->jobCompleted_cond, &zcs->jobCompleted_mutex);",
          "content_same": false
        },
        {
          "line": 594,
          "old_api": null,
          "new_api": "pthread_mutex_unlock",
          "old_text": null,
          "new_text": "pthread_mutex_unlock(&zcs->jobCompleted_mutex)",
          "old_line_content": "        zcs->doneJobID++;",
          "new_line_content": "        pthread_mutex_unlock(&zcs->jobCompleted_mutex);",
          "content_same": false
        },
        {
          "line": 606,
          "old_api": null,
          "new_api": "DEBUGLOG",
          "old_text": null,
          "new_text": "DEBUGLOG(4, \"ZSTDMT_initCStream_internal\")",
          "old_line_content": "    /* params are supposed to be fully validated at this point */",
          "new_line_content": "    DEBUGLOG(4, \"ZSTDMT_initCStream_internal\");",
          "content_same": false
        },
        {
          "line": 609,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(!((dict) && (cdict)))",
          "old_line_content": "",
          "new_line_content": "    assert(!((dict) && (cdict)));  /* either dict or cdict, not both */",
          "content_same": false
        },
        {
          "line": 613,
          "old_api": null,
          "new_api": "ZSTD_initCStream_internal",
          "old_text": null,
          "new_text": "ZSTD_initCStream_internal(zcs->cctxPool->cctx[0],\n                                dict, dictSize, cdict,\n                                params, pledgedSrcSize)",
          "old_line_content": "                                dict, dictSize, cdict,",
          "new_line_content": "        return ZSTD_initCStream_internal(zcs->cctxPool->cctx[0],",
          "content_same": false
        },
        {
          "line": 620,
          "old_api": null,
          "new_api": "ZSTDMT_releaseAllJobResources",
          "old_text": null,
          "new_text": "ZSTDMT_releaseAllJobResources(zcs)",
          "old_line_content": "        zcs->allJobsCompleted = 1;",
          "new_line_content": "        ZSTDMT_releaseAllJobResources(zcs);",
          "content_same": false
        },
        {
          "line": 629,
          "old_api": null,
          "new_api": "ZSTD_createCDict_advanced",
          "old_text": null,
          "new_text": "ZSTD_createCDict_advanced(dict, dictSize,\n                                                    0 /* byRef */, ZSTD_dm_auto,   /* note : a loadPrefix becomes an internal CDict */\n                                                    params.cParams, zcs->cMem)",
          "old_line_content": "                                                    0 /* byRef */, ZSTD_dm_auto,   /* note : a loadPrefix becomes an internal CDict */",
          "new_line_content": "        zcs->cdictLocal = ZSTD_createCDict_advanced(dict, dictSize,",
          "content_same": false
        },
        {
          "line": 633,
          "old_api": null,
          "new_api": "ERROR",
          "old_text": null,
          "new_text": "ERROR(memory_allocation)",
          "old_line_content": "    } else {",
          "new_line_content": "        if (zcs->cdictLocal == NULL) return ERROR(memory_allocation);",
          "content_same": false
        },
        {
          "line": 636,
          "old_api": null,
          "new_api": "ZSTD_freeCDict",
          "old_text": null,
          "new_text": "ZSTD_freeCDict(zcs->cdictLocal)",
          "old_line_content": "        zcs->cdictLocal = NULL;",
          "new_line_content": "        ZSTD_freeCDict(zcs->cdictLocal);",
          "content_same": false
        },
        {
          "line": 643,
          "old_api": null,
          "new_api": "U32)(zcs->targetDictSize>>10)",
          "old_text": null,
          "new_text": "U32)(zcs->targetDictSize>>10)",
          "old_line_content": "    zcs->targetSectionSize = zcs->sectionSize ? zcs->sectionSize : (size_t)1 << (zcs->params.cParams.windowLog + 2);",
          "new_line_content": "    DEBUGLOG(4, \"overlap Size : %u KB\", (U32)(zcs->targetDictSize>>10));",
          "content_same": false
        },
        {
          "line": 647,
          "old_api": null,
          "new_api": "U32)(zcs->targetSectionSize>>10)",
          "old_text": null,
          "new_text": "U32)(zcs->targetSectionSize>>10)",
          "old_line_content": "    zcs->marginSize = zcs->targetSectionSize >> 2;",
          "new_line_content": "    DEBUGLOG(4, \"Section Size : %u KB\", (U32)(zcs->targetSectionSize>>10));",
          "content_same": false
        },
        {
          "line": 651,
          "old_api": null,
          "new_api": "ERROR",
          "old_text": null,
          "new_text": "ERROR(memory_allocation)",
          "old_line_content": "    zcs->inBuff.filled = 0;",
          "new_line_content": "    if (zcs->inBuff.buffer.start == NULL) return ERROR(memory_allocation);",
          "content_same": false
        },
        {
          "line": 658,
          "old_api": null,
          "new_api": "XXH64_reset",
          "old_text": null,
          "new_text": "XXH64_reset(&zcs->xxhState, 0)",
          "old_line_content": "    return 0;",
          "new_line_content": "    if (params.fParams.checksumFlag) XXH64_reset(&zcs->xxhState, 0);",
          "content_same": false
        },
        {
          "line": 667,
          "old_api": null,
          "new_api": "ZSTDMT_initCStream_internal",
          "old_text": null,
          "new_text": "ZSTDMT_initCStream_internal(mtctx, dict, dictSize, NULL, params, pledgedSrcSize)",
          "old_line_content": "}",
          "new_line_content": "    return ZSTDMT_initCStream_internal(mtctx, dict, dictSize, NULL, params, pledgedSrcSize);",
          "content_same": false
        },
        {
          "line": 676,
          "old_api": null,
          "new_api": "ERROR",
          "old_text": null,
          "new_text": "ERROR(dictionary_wrong)",
          "old_line_content": "    params.fParams = fParams;",
          "new_line_content": "    if (cdict==NULL) return ERROR(dictionary_wrong);   /* method incompatible with NULL cdict */",
          "content_same": false
        },
        {
          "line": 678,
          "old_api": null,
          "new_api": "ZSTDMT_initCStream_internal",
          "old_text": null,
          "new_text": "ZSTDMT_initCStream_internal(mtctx, NULL, 0 /*dictSize*/, cdict,\n                                        params, pledgedSrcSize)",
          "old_line_content": "                                        params, pledgedSrcSize);",
          "new_line_content": "    return ZSTDMT_initCStream_internal(mtctx, NULL, 0 /*dictSize*/, cdict,",
          "content_same": false
        },
        {
          "line": 689,
          "old_api": null,
          "new_api": "ZSTDMT_initCStream_internal",
          "old_text": null,
          "new_text": "ZSTDMT_initCStream_internal(zcs, NULL, 0, 0, zcs->params, pledgedSrcSize)",
          "old_line_content": "}",
          "new_line_content": "    return ZSTDMT_initCStream_internal(zcs, NULL, 0, 0, zcs->params, pledgedSrcSize);",
          "content_same": false
        },
        {
          "line": 694,
          "old_api": null,
          "new_api": "ZSTDMT_initCStream_internal",
          "old_text": null,
          "new_text": "ZSTDMT_initCStream_internal(zcs, NULL, 0, NULL, params, 0)",
          "old_line_content": "}",
          "new_line_content": "    return ZSTDMT_initCStream_internal(zcs, NULL, 0, NULL, params, 0);",
          "content_same": false
        },
        {
          "line": 702,
          "old_api": null,
          "new_api": "ZSTDMT_getCCtx",
          "old_text": null,
          "new_text": "ZSTDMT_getCCtx(zcs->cctxPool)",
          "old_line_content": "    unsigned const jobID = zcs->nextJobID & zcs->jobIDMask;",
          "new_line_content": "    ZSTD_CCtx* const cctx = ZSTDMT_getCCtx(zcs->cctxPool);",
          "content_same": false
        },
        {
          "line": 710,
          "old_api": null,
          "new_api": "ERROR",
          "old_text": null,
          "new_text": "ERROR(memory_allocation)",
          "old_line_content": "    }",
          "new_line_content": "        return ERROR(memory_allocation);",
          "content_same": false
        },
        {
          "line": 713,
          "old_api": null,
          "new_api": "DEBUGLOG",
          "old_text": null,
          "new_text": "DEBUGLOG(4, \"preparing job %u to compress %u bytes with %u preload \",\n                zcs->nextJobID, (U32)srcSize, (U32)zcs->dictSize)",
          "old_line_content": "                zcs->nextJobID, (U32)srcSize, (U32)zcs->dictSize);",
          "new_line_content": "    DEBUGLOG(4, \"preparing job %u to compress %u bytes with %u preload \",",
          "content_same": false
        },
        {
          "line": 719,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(zcs->inBuff.filled >= srcSize + zcs->dictSize)",
          "old_line_content": "    zcs->jobs[jobID].params = zcs->params;",
          "new_line_content": "    assert(zcs->inBuff.filled >= srcSize + zcs->dictSize);",
          "content_same": false
        },
        {
          "line": 738,
          "old_api": null,
          "new_api": "ZSTDMT_getBuffer",
          "old_text": null,
          "new_text": "ZSTDMT_getBuffer(zcs->buffPool, zcs->inBuffSize)",
          "old_line_content": "        if (zcs->inBuff.buffer.start == NULL) {   /* not enough memory to allocate next input buffer */",
          "new_line_content": "        zcs->inBuff.buffer = ZSTDMT_getBuffer(zcs->buffPool, zcs->inBuffSize);",
          "content_same": false
        },
        {
          "line": 744,
          "old_api": null,
          "new_api": "ERROR",
          "old_text": null,
          "new_text": "ERROR(memory_allocation)",
          "old_line_content": "        }",
          "new_line_content": "            return ERROR(memory_allocation);",
          "content_same": false
        },
        {
          "line": 746,
          "old_api": null,
          "new_api": "DEBUGLOG",
          "old_text": null,
          "new_text": "DEBUGLOG(5, \"inBuff currently filled to %u\", (U32)zcs->inBuff.filled)",
          "old_line_content": "        zcs->inBuff.filled -= srcSize + zcs->dictSize - newDictSize;",
          "new_line_content": "        DEBUGLOG(5, \"inBuff currently filled to %u\", (U32)zcs->inBuff.filled);",
          "content_same": false
        },
        {
          "line": 748,
          "old_api": null,
          "new_api": "DEBUGLOG",
          "old_text": null,
          "new_text": "DEBUGLOG(5, \"new job : inBuff filled to %u, with %u dict and %u src\",\n                    (U32)zcs->inBuff.filled, (U32)newDictSize,\n                    (U32)(zcs->inBuff.filled - newDictSize))",
          "old_line_content": "                    (U32)zcs->inBuff.filled, (U32)newDictSize,",
          "new_line_content": "        DEBUGLOG(5, \"new job : inBuff filled to %u, with %u dict and %u src\",",
          "content_same": false
        },
        {
          "line": 751,
          "old_api": null,
          "new_api": "memmove",
          "old_text": null,
          "new_text": "memmove(zcs->inBuff.buffer.start,\n            (const char*)zcs->jobs[jobID].srcStart + zcs->dictSize + srcSize - newDictSize,\n            zcs->inBuff.filled)",
          "old_line_content": "            (const char*)zcs->jobs[jobID].srcStart + zcs->dictSize + srcSize - newDictSize,",
          "new_line_content": "        memmove(zcs->inBuff.buffer.start,",
          "content_same": false
        },
        {
          "line": 754,
          "old_api": null,
          "new_api": "DEBUGLOG",
          "old_text": null,
          "new_text": "DEBUGLOG(5, \"new inBuff pre-filled\")",
          "old_line_content": "        zcs->dictSize = newDictSize;",
          "new_line_content": "        DEBUGLOG(5, \"new inBuff pre-filled\");",
          "content_same": false
        },
        {
          "line": 757,
          "old_api": null,
          "new_api": "DEBUGLOG",
          "old_text": null,
          "new_text": "DEBUGLOG(5, \"ZSTDMT_createCompressionJob::endFrame = %u\", endFrame)",
          "old_line_content": "        zcs->inBuff.buffer = g_nullBuffer;",
          "new_line_content": "        DEBUGLOG(5, \"ZSTDMT_createCompressionJob::endFrame = %u\", endFrame);",
          "content_same": false
        },
        {
          "line": 767,
          "old_api": null,
          "new_api": "DEBUGLOG",
          "old_text": null,
          "new_text": "DEBUGLOG(4, \"posting job %u : %u bytes  (end:%u) (note : doneJob = %u=>%u)\",\n                zcs->nextJobID,\n                (U32)zcs->jobs[jobID].srcSize,\n                zcs->jobs[jobID].lastChunk,\n                zcs->doneJobID,\n                zcs->doneJobID & zcs->jobIDMask)",
          "old_line_content": "                zcs->nextJobID,",
          "new_line_content": "    DEBUGLOG(4, \"posting job %u : %u bytes  (end:%u) (note : doneJob = %u=>%u)\",",
          "content_same": false
        },
        {
          "line": 773,
          "old_api": null,
          "new_api": "POOL_add",
          "old_text": null,
          "new_text": "POOL_add(zcs->factory, ZSTDMT_compressChunk, &zcs->jobs[jobID])",
          "old_line_content": "    zcs->nextJobID++;",
          "new_line_content": "    POOL_add(zcs->factory, ZSTDMT_compressChunk, &zcs->jobs[jobID]);   /* this call is blocking when thread worker pool is exhausted */",
          "content_same": false
        },
        {
          "line": 787,
          "old_api": null,
          "new_api": "PTHREAD_MUTEX_LOCK",
          "old_text": null,
          "new_text": "PTHREAD_MUTEX_LOCK(&zcs->jobCompleted_mutex)",
          "old_line_content": "    while (zcs->jobs[wJobID].jobCompleted==0) {",
          "new_line_content": "    PTHREAD_MUTEX_LOCK(&zcs->jobCompleted_mutex);",
          "content_same": false
        },
        {
          "line": 791,
          "old_api": null,
          "new_api": "pthread_cond_wait",
          "old_text": null,
          "new_text": "pthread_cond_wait(&zcs->jobCompleted_cond, &zcs->jobCompleted_mutex)",
          "old_line_content": "    }",
          "new_line_content": "        pthread_cond_wait(&zcs->jobCompleted_cond, &zcs->jobCompleted_mutex);  /* block when nothing available to flush */",
          "content_same": false
        },
        {
          "line": 793,
          "old_api": null,
          "new_api": "pthread_mutex_unlock",
          "old_text": null,
          "new_text": "pthread_mutex_unlock(&zcs->jobCompleted_mutex)",
          "old_line_content": "    /* compression job completed : output can be flushed */",
          "new_line_content": "    pthread_mutex_unlock(&zcs->jobCompleted_mutex);",
          "content_same": false
        },
        {
          "line": 800,
          "old_api": null,
          "new_api": "ZSTDMT_releaseAllJobResources",
          "old_text": null,
          "new_text": "ZSTDMT_releaseAllJobResources(zcs)",
          "old_line_content": "                return job.cSize;",
          "new_line_content": "                ZSTDMT_releaseAllJobResources(zcs);",
          "content_same": false
        },
        {
          "line": 803,
          "old_api": null,
          "new_api": "ZSTDMT_releaseCCtx",
          "old_text": null,
          "new_text": "ZSTDMT_releaseCCtx(zcs->cctxPool, job.cctx)",
          "old_line_content": "            zcs->jobs[wJobID].cctx = NULL;",
          "new_line_content": "            ZSTDMT_releaseCCtx(zcs->cctxPool, job.cctx);",
          "content_same": false
        },
        {
          "line": 805,
          "old_api": null,
          "new_api": "DEBUGLOG",
          "old_text": null,
          "new_text": "DEBUGLOG(5, \"zcs->params.fParams.checksumFlag : %u \", zcs->params.fParams.checksumFlag)",
          "old_line_content": "            if (zcs->params.fParams.checksumFlag) {",
          "new_line_content": "            DEBUGLOG(5, \"zcs->params.fParams.checksumFlag : %u \", zcs->params.fParams.checksumFlag);",
          "content_same": false
        },
        {
          "line": 807,
          "old_api": null,
          "new_api": "XXH64_update",
          "old_text": null,
          "new_text": "XXH64_update(&zcs->xxhState, (const char*)job.srcStart + job.dictSize, job.srcSize)",
          "old_line_content": "                if (zcs->frameEnded && (zcs->doneJobID+1 == zcs->nextJobID)) {  /* write checksum at end of last section */",
          "new_line_content": "                XXH64_update(&zcs->xxhState, (const char*)job.srcStart + job.dictSize, job.srcSize);",
          "content_same": false
        },
        {
          "line": 811,
          "old_api": null,
          "new_api": "MEM_writeLE32",
          "old_text": null,
          "new_text": "MEM_writeLE32((char*)job.dstBuff.start + job.cSize, checksum)",
          "old_line_content": "                    job.cSize += 4;",
          "new_line_content": "                    MEM_writeLE32((char*)job.dstBuff.start + job.cSize, checksum);",
          "content_same": false
        },
        {
          "line": 815,
          "old_api": null,
          "new_api": "ZSTDMT_releaseBuffer",
          "old_text": null,
          "new_text": "ZSTDMT_releaseBuffer(zcs->buffPool, job.src)",
          "old_line_content": "            zcs->jobs[wJobID].srcStart = NULL;",
          "new_line_content": "            ZSTDMT_releaseBuffer(zcs->buffPool, job.src);",
          "content_same": false
        },
        {
          "line": 822,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy((char*)output->dst + output->pos, (const char*)job.dstBuff.start + job.dstFlushed, toWrite)",
          "old_line_content": "            output->pos += toWrite;",
          "new_line_content": "            memcpy((char*)output->dst + output->pos, (const char*)job.dstBuff.start + job.dstFlushed, toWrite);",
          "content_same": false
        },
        {
          "line": 827,
          "old_api": null,
          "new_api": "ZSTDMT_releaseBuffer",
          "old_text": null,
          "new_text": "ZSTDMT_releaseBuffer(zcs->buffPool, job.dstBuff)",
          "old_line_content": "            zcs->jobs[wJobID].dstBuff = g_nullBuffer;",
          "new_line_content": "            ZSTDMT_releaseBuffer(zcs->buffPool, job.dstBuff);",
          "content_same": false
        },
        {
          "line": 853,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(input->pos  <= input->size)",
          "old_line_content": "    if ((mtctx->frameEnded) && (endOp==ZSTD_e_continue)) {",
          "new_line_content": "    assert(input->pos  <= input->size);",
          "content_same": false
        },
        {
          "line": 856,
          "old_api": null,
          "new_api": "ERROR",
          "old_text": null,
          "new_text": "ERROR(stage_wrong)",
          "old_line_content": "    }",
          "new_line_content": "        return ERROR(stage_wrong);",
          "content_same": false
        },
        {
          "line": 859,
          "old_api": null,
          "new_api": "ZSTD_compressStream_generic",
          "old_text": null,
          "new_text": "ZSTD_compressStream_generic(mtctx->cctxPool->cctx[0], output, input, endOp)",
          "old_line_content": "    }",
          "new_line_content": "        return ZSTD_compressStream_generic(mtctx->cctxPool->cctx[0], output, input, endOp);",
          "content_same": false
        },
        {
          "line": 867,
          "old_api": null,
          "new_api": "ZSTDMT_compress_advanced",
          "old_text": null,
          "new_text": "ZSTDMT_compress_advanced(mtctx,\n                (char*)output->dst + output->pos, output->size - output->pos,\n                (const char*)input->src + input->pos, input->size - input->pos,\n                mtctx->cdict, mtctx->params, mtctx->overlapRLog)",
          "old_line_content": "                (char*)output->dst + output->pos, output->size - output->pos,",
          "new_line_content": "        size_t const cSize = ZSTDMT_compress_advanced(mtctx,",
          "content_same": false
        },
        {
          "line": 871,
          "old_api": null,
          "new_api": "ZSTD_isError",
          "old_text": null,
          "new_text": "ZSTD_isError(cSize)",
          "old_line_content": "        input->pos = input->size;",
          "new_line_content": "        if (ZSTD_isError(cSize)) return cSize;",
          "content_same": false
        },
        {
          "line": 874,
          "old_api": null,
          "new_api": "ZSTDMT_releaseBuffer",
          "old_text": null,
          "new_text": "ZSTDMT_releaseBuffer(mtctx->buffPool, mtctx->inBuff.buffer)",
          "old_line_content": "        mtctx->allJobsCompleted = 1;",
          "new_line_content": "        ZSTDMT_releaseBuffer(mtctx->buffPool, mtctx->inBuff.buffer);  /* was allocated in initStream */",
          "content_same": false
        },
        {
          "line": 882,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy((char*)mtctx->inBuff.buffer.start + mtctx->inBuff.filled, (const char*)input->src + input->pos, toLoad)",
          "old_line_content": "        input->pos += toLoad;",
          "new_line_content": "        memcpy((char*)mtctx->inBuff.buffer.start + mtctx->inBuff.filled, (const char*)input->src + input->pos, toLoad);",
          "content_same": false
        },
        {
          "line": 889,
          "old_api": null,
          "new_api": "ZSTDMT_createCompressionJob",
          "old_text": null,
          "new_text": "ZSTDMT_createCompressionJob(mtctx, mtctx->targetSectionSize, 0 /* endFrame */)",
          "old_line_content": "    }",
          "new_line_content": "        CHECK_F( ZSTDMT_createCompressionJob(mtctx, mtctx->targetSectionSize, 0 /* endFrame */) );",
          "content_same": false
        },
        {
          "line": 893,
          "old_api": null,
          "new_api": "ZSTDMT_flushNextJob",
          "old_text": null,
          "new_text": "ZSTDMT_flushNextJob(mtctx, output, (mtctx->inBuff.filled == mtctx->inBuffSize) /* blockToFlush */)",
          "old_line_content": "",
          "new_line_content": "    CHECK_F( ZSTDMT_flushNextJob(mtctx, output, (mtctx->inBuff.filled == mtctx->inBuffSize) /* blockToFlush */) ); /* block if it wasn't possible to create new job due to saturation */",
          "content_same": false
        },
        {
          "line": 901,
          "old_api": null,
          "new_api": "ZSTDMT_flushStream",
          "old_text": null,
          "new_text": "ZSTDMT_flushStream(mtctx, output)",
          "old_line_content": "        case ZSTD_e_end:",
          "new_line_content": "            return ZSTDMT_flushStream(mtctx, output);",
          "content_same": false
        },
        {
          "line": 903,
          "old_api": null,
          "new_api": "ZSTDMT_endStream",
          "old_text": null,
          "new_text": "ZSTDMT_endStream(mtctx, output)",
          "old_line_content": "        case ZSTD_e_continue:",
          "new_line_content": "            return ZSTDMT_endStream(mtctx, output);",
          "content_same": false
        },
        {
          "line": 907,
          "old_api": null,
          "new_api": "ERROR",
          "old_text": null,
          "new_text": "ERROR(GENERIC)",
          "old_line_content": "    }",
          "new_line_content": "            return ERROR(GENERIC);   /* invalid endDirective */",
          "content_same": false
        },
        {
          "line": 918,
          "old_api": null,
          "new_api": "ERROR",
          "old_text": null,
          "new_text": "ERROR(stage_wrong)",
          "old_line_content": "    }",
          "new_line_content": "        return ERROR(stage_wrong);",
          "content_same": false
        },
        {
          "line": 921,
          "old_api": null,
          "new_api": "ZSTD_compressStream",
          "old_text": null,
          "new_text": "ZSTD_compressStream(zcs->cctxPool->cctx[0], output, input)",
          "old_line_content": "    }",
          "new_line_content": "        return ZSTD_compressStream(zcs->cctxPool->cctx[0], output, input);",
          "content_same": false
        },
        {
          "line": 926,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy((char*)zcs->inBuff.buffer.start + zcs->inBuff.filled, (const char*)input->src + input->pos, toLoad)",
          "old_line_content": "        input->pos += toLoad;",
          "new_line_content": "        memcpy((char*)zcs->inBuff.buffer.start + zcs->inBuff.filled, (const char*)input->src + input->pos, toLoad);",
          "content_same": false
        },
        {
          "line": 933,
          "old_api": null,
          "new_api": "ZSTDMT_createCompressionJob",
          "old_text": null,
          "new_text": "ZSTDMT_createCompressionJob(zcs, zcs->targetSectionSize, 0 /* endFrame */)",
          "old_line_content": "    }",
          "new_line_content": "        CHECK_F( ZSTDMT_createCompressionJob(zcs, zcs->targetSectionSize, 0 /* endFrame */) );",
          "content_same": false
        },
        {
          "line": 937,
          "old_api": null,
          "new_api": "ZSTDMT_flushNextJob",
          "old_text": null,
          "new_text": "ZSTDMT_flushNextJob(zcs, output, (zcs->inBuff.filled == zcs->inBuffSize) /* blockToFlush */)",
          "old_line_content": "",
          "new_line_content": "    CHECK_F( ZSTDMT_flushNextJob(zcs, output, (zcs->inBuff.filled == zcs->inBuffSize) /* blockToFlush */) ); /* block if it wasn't possible to create new job due to saturation */",
          "content_same": false
        },
        {
          "line": 950,
          "old_api": null,
          "new_api": "ZSTDMT_createCompressionJob",
          "old_text": null,
          "new_text": "ZSTDMT_createCompressionJob(zcs, srcSize, endFrame)",
          "old_line_content": "    }",
          "new_line_content": "        CHECK_F( ZSTDMT_createCompressionJob(zcs, srcSize, endFrame) );",
          "content_same": false
        },
        {
          "line": 954,
          "old_api": null,
          "new_api": "ZSTDMT_flushNextJob",
          "old_text": null,
          "new_text": "ZSTDMT_flushNextJob(zcs, output, 1 /* blockToFlush */)",
          "old_line_content": "}",
          "new_line_content": "    return ZSTDMT_flushNextJob(zcs, output, 1 /* blockToFlush */);",
          "content_same": false
        },
        {
          "line": 960,
          "old_api": null,
          "new_api": "DEBUGLOG",
          "old_text": null,
          "new_text": "DEBUGLOG(5, \"ZSTDMT_flushStream\")",
          "old_line_content": "    if (zcs->nbThreads==1)",
          "new_line_content": "    DEBUGLOG(5, \"ZSTDMT_flushStream\");",
          "content_same": false
        },
        {
          "line": 963,
          "old_api": null,
          "new_api": "ZSTDMT_flushStream_internal",
          "old_text": null,
          "new_text": "ZSTDMT_flushStream_internal(zcs, output, 0 /* endFrame */)",
          "old_line_content": "}",
          "new_line_content": "    return ZSTDMT_flushStream_internal(zcs, output, 0 /* endFrame */);",
          "content_same": false
        },
        {
          "line": 968,
          "old_api": null,
          "new_api": "DEBUGLOG",
          "old_text": null,
          "new_text": "DEBUGLOG(4, \"ZSTDMT_endStream\")",
          "old_line_content": "    if (zcs->nbThreads==1)",
          "new_line_content": "    DEBUGLOG(4, \"ZSTDMT_endStream\");",
          "content_same": false
        },
        {
          "line": 971,
          "old_api": null,
          "new_api": "ZSTDMT_flushStream_internal",
          "old_text": null,
          "new_text": "ZSTDMT_flushStream_internal(zcs, output, 1 /* endFrame */)",
          "old_line_content": "}",
          "new_line_content": "    return ZSTDMT_flushStream_internal(zcs, output, 1 /* endFrame */);",
          "content_same": false
        },
        {
          "line": 980,
          "old_api": null,
          "new_api": "DEBUGLOG",
          "old_text": null,
          "new_text": "DEBUGLOG(5, \"in: pos:%u / size:%u ; endOp=%u\",\n                (U32)input->pos, (U32)input->size, (U32)endOp)",
          "old_line_content": "                (U32)input->pos, (U32)input->size, (U32)endOp);",
          "new_line_content": "    DEBUGLOG(5, \"in: pos:%u / size:%u ; endOp=%u\",",
          "content_same": false
        },
        {
          "line": 983,
          "old_api": null,
          "new_api": "ZSTDMT_compressStream",
          "old_text": null,
          "new_text": "ZSTDMT_compressStream(mtctx, output, input)",
          "old_line_content": "    if (input->pos < input->size)  /* input not consumed : do not flush yet */",
          "new_line_content": "        CHECK_F(ZSTDMT_compressStream(mtctx, output, input));",
          "content_same": false
        },
        {
          "line": 989,
          "old_api": null,
          "new_api": "ZSTDMT_flushStream",
          "old_text": null,
          "new_text": "ZSTDMT_flushStream(mtctx, output)",
          "old_line_content": "        case ZSTD_e_end:",
          "new_line_content": "            return ZSTDMT_flushStream(mtctx, output);",
          "content_same": false
        },
        {
          "line": 478,
          "old_api": null,
          "new_api": "ZSTD_compress_advanced",
          "old_text": null,
          "new_text": "ZSTD_compress_advanced(cctx, dst, dstCapacity, src, srcSize, NULL, 0, params)",
          "old_line_content": "    }",
          "new_line_content": "        return ZSTD_compress_advanced(cctx, dst, dstCapacity, src, srcSize, NULL, 0, params);",
          "content_same": false
        },
        {
          "line": 992,
          "old_api": null,
          "new_api": "ZSTDMT_endStream",
          "old_text": null,
          "new_text": "ZSTDMT_endStream(mtctx, output)",
          "old_line_content": "        case ZSTD_e_continue:",
          "new_line_content": "            return ZSTDMT_endStream(mtctx, output);",
          "content_same": false
        },
        {
          "line": 483,
          "old_api": null,
          "new_api": "ZSTD_free",
          "old_text": null,
          "new_text": "ZSTD_free(mtctx->jobs, mtctx->cMem)",
          "old_line_content": "        mtctx->jobIDMask = 0;",
          "new_line_content": "        ZSTD_free(mtctx->jobs, mtctx->cMem);",
          "content_same": false
        },
        {
          "line": 996,
          "old_api": null,
          "new_api": "ERROR",
          "old_text": null,
          "new_text": "ERROR(GENERIC)",
          "old_line_content": "    }",
          "new_line_content": "            return ERROR(GENERIC);   /* invalid endDirective */",
          "content_same": false
        },
        {
          "line": 486,
          "old_api": null,
          "new_api": "ERROR",
          "old_text": null,
          "new_text": "ERROR(memory_allocation)",
          "old_line_content": "        mtctx->jobIDMask = nbJobs - 1;",
          "new_line_content": "        if (mtctx->jobs==NULL) return ERROR(memory_allocation);",
          "content_same": false
        },
        {
          "line": 493,
          "old_api": null,
          "new_api": "ZSTD_compressBound",
          "old_text": null,
          "new_text": "ZSTD_compressBound(chunkSize)",
          "old_line_content": "            buffer_t const dstAsBuffer = { (char*)dst + dstBufferPos, dstBufferCapacity };",
          "new_line_content": "            size_t const dstBufferCapacity = ZSTD_compressBound(chunkSize);",
          "content_same": false
        },
        {
          "line": 496,
          "old_api": null,
          "new_api": "ZSTDMT_getCCtx",
          "old_text": null,
          "new_text": "ZSTDMT_getCCtx(mtctx->cctxPool)",
          "old_line_content": "            size_t dictSize = u ? overlapSize : 0;",
          "new_line_content": "            ZSTD_CCtx* const cctx = ZSTDMT_getCCtx(mtctx->cctxPool);",
          "content_same": false
        },
        {
          "line": 500,
          "old_api": null,
          "new_api": "ERROR",
          "old_text": null,
          "new_text": "ERROR(memory_allocation)",
          "old_line_content": "                mtctx->jobs[u].jobCompleted = 1;",
          "new_line_content": "                mtctx->jobs[u].cSize = ERROR(memory_allocation);   /* job result */",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 521,
          "old_api": "DEBUGLOG",
          "new_api": null,
          "old_text": "DEBUGLOG(5, \"posting job %u   (%u bytes)\", u, (U32)chunkSize)",
          "new_text": null,
          "old_line_content": "            DEBUGLOG(5, \"posting job %u   (%u bytes)\", u, (U32)chunkSize);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 534,
          "old_api": "DEBUGLOG",
          "new_api": null,
          "old_text": "DEBUGLOG(5, \"waiting for chunk %u \", chunkID)",
          "new_text": null,
          "old_line_content": "            DEBUGLOG(5, \"waiting for chunk %u \", chunkID);",
          "new_line_content": "        for (chunkID=0; chunkID<nbChunks; chunkID++) {",
          "content_same": false
        },
        {
          "line": 537,
          "old_api": "DEBUGLOG",
          "new_api": null,
          "old_text": "DEBUGLOG(5, \"waiting for jobCompleted signal from chunk %u\", chunkID)",
          "new_text": null,
          "old_line_content": "                DEBUGLOG(5, \"waiting for jobCompleted signal from chunk %u\", chunkID);",
          "new_line_content": "            while (mtctx->jobs[chunkID].jobCompleted==0) {",
          "content_same": false
        },
        {
          "line": 540,
          "old_api": "pthread_mutex_unlock",
          "new_api": null,
          "old_text": "pthread_mutex_unlock(&mtctx->jobCompleted_mutex)",
          "new_text": null,
          "old_line_content": "            pthread_mutex_unlock(&mtctx->jobCompleted_mutex);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 543,
          "old_api": "ZSTDMT_releaseCCtx",
          "new_api": null,
          "old_text": "ZSTDMT_releaseCCtx(mtctx->cctxPool, mtctx->jobs[chunkID].cctx)",
          "new_text": null,
          "old_line_content": "            ZSTDMT_releaseCCtx(mtctx->cctxPool, mtctx->jobs[chunkID].cctx);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 547,
          "old_api": "ZSTD_isError",
          "new_api": null,
          "old_text": "ZSTD_isError(cSize)",
          "new_text": null,
          "old_line_content": "                if (ZSTD_isError(cSize)) error = cSize;",
          "new_line_content": "            {   size_t const cSize = mtctx->jobs[chunkID].cSize;",
          "content_same": false
        },
        {
          "line": 551,
          "old_api": "memmove",
          "new_api": null,
          "old_text": "memmove((char*)dst + dstPos, mtctx->jobs[chunkID].dstBuff.start, cSize)",
          "new_text": null,
          "old_line_content": "                        memmove((char*)dst + dstPos, mtctx->jobs[chunkID].dstBuff.start, cSize);  /* may overlap if chunk decompressed within dst */",
          "new_line_content": "                    if (!error)",
          "content_same": false
        },
        {
          "line": 553,
          "old_api": "DEBUGLOG",
          "new_api": null,
          "old_text": "DEBUGLOG(5, \"releasing buffer %u>=%u\", chunkID, compressWithinDst)",
          "new_text": null,
          "old_line_content": "                        DEBUGLOG(5, \"releasing buffer %u>=%u\", chunkID, compressWithinDst);",
          "new_line_content": "                    if (chunkID >= compressWithinDst) {  /* otherwise, it decompresses within dst */",
          "content_same": false
        },
        {
          "line": 561,
          "old_api": "DEBUGLOG",
          "new_api": null,
          "old_text": "DEBUGLOG(4, \"compressed size : %u  \", (U32)dstPos)",
          "new_text": null,
          "old_line_content": "        if (!error) DEBUGLOG(4, \"compressed size : %u  \", (U32)dstPos);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 572,
          "old_api": "ZSTD_maxCLevel",
          "new_api": null,
          "old_text": "ZSTD_maxCLevel()",
          "new_text": null,
          "old_line_content": "    U32 const overlapRLog = (compressionLevel >= ZSTD_maxCLevel()) ? 0 : 3;",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 575,
          "old_api": "ZSTDMT_compress_advanced",
          "new_api": null,
          "old_text": "ZSTDMT_compress_advanced(mtctx, dst, dstCapacity, src, srcSize, NULL, params, overlapRLog)",
          "new_text": null,
          "old_line_content": "    return ZSTDMT_compress_advanced(mtctx, dst, dstCapacity, src, srcSize, NULL, params, overlapRLog);",
          "new_line_content": "    params.fParams.contentSizeFlag = 1;",
          "content_same": false
        },
        {
          "line": 585,
          "old_api": "DEBUGLOG",
          "new_api": null,
          "old_text": "DEBUGLOG(4, \"ZSTDMT_waitForAllJobsCompleted\")",
          "new_text": null,
          "old_line_content": "    DEBUGLOG(4, \"ZSTDMT_waitForAllJobsCompleted\");",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 588,
          "old_api": "PTHREAD_MUTEX_LOCK",
          "new_api": null,
          "old_text": "PTHREAD_MUTEX_LOCK(&zcs->jobCompleted_mutex)",
          "new_text": null,
          "old_line_content": "        PTHREAD_MUTEX_LOCK(&zcs->jobCompleted_mutex);",
          "new_line_content": "        unsigned const jobID = zcs->doneJobID & zcs->jobIDMask;",
          "content_same": false
        },
        {
          "line": 590,
          "old_api": "DEBUGLOG",
          "new_api": null,
          "old_text": "DEBUGLOG(5, \"waiting for jobCompleted signal from chunk %u\", zcs->doneJobID)",
          "new_text": null,
          "old_line_content": "            DEBUGLOG(5, \"waiting for jobCompleted signal from chunk %u\", zcs->doneJobID);   /* we want to block when waiting for data to flush */",
          "new_line_content": "        while (zcs->jobs[jobID].jobCompleted==0) {",
          "content_same": false
        },
        {
          "line": 593,
          "old_api": "pthread_mutex_unlock",
          "new_api": null,
          "old_text": "pthread_mutex_unlock(&zcs->jobCompleted_mutex)",
          "new_text": null,
          "old_line_content": "        pthread_mutex_unlock(&zcs->jobCompleted_mutex);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 605,
          "old_api": "DEBUGLOG",
          "new_api": null,
          "old_text": "DEBUGLOG(4, \"ZSTDMT_initCStream_internal\")",
          "new_text": null,
          "old_line_content": "    DEBUGLOG(4, \"ZSTDMT_initCStream_internal\");",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 607,
          "old_api": "ZSTD_checkCParams",
          "new_api": null,
          "old_text": "ZSTD_checkCParams(params.cParams)",
          "new_text": null,
          "old_line_content": "    assert(!ZSTD_isError(ZSTD_checkCParams(params.cParams)));",
          "new_line_content": "    /* params are supposed to be fully validated at this point */",
          "content_same": false
        },
        {
          "line": 611,
          "old_api": "DEBUGLOG",
          "new_api": null,
          "old_text": "DEBUGLOG(4, \"single thread mode\")",
          "new_text": null,
          "old_line_content": "        DEBUGLOG(4, \"single thread mode\");",
          "new_line_content": "    if (zcs->nbThreads==1) {",
          "content_same": false
        },
        {
          "line": 618,
          "old_api": "ZSTDMT_waitForAllJobsCompleted",
          "new_api": null,
          "old_text": "ZSTDMT_waitForAllJobsCompleted(zcs)",
          "new_text": null,
          "old_line_content": "        ZSTDMT_waitForAllJobsCompleted(zcs);",
          "new_line_content": "    if (zcs->allJobsCompleted == 0) {   /* previous compression not correctly finished */",
          "content_same": false
        },
        {
          "line": 626,
          "old_api": "DEBUGLOG",
          "new_api": null,
          "old_text": "DEBUGLOG(4,\"cdictLocal: %08X\", (U32)(size_t)zcs->cdictLocal)",
          "new_text": null,
          "old_line_content": "        DEBUGLOG(4,\"cdictLocal: %08X\", (U32)(size_t)zcs->cdictLocal);",
          "new_line_content": "    if (dict) {",
          "content_same": false
        },
        {
          "line": 632,
          "old_api": "ERROR",
          "new_api": null,
          "old_text": "ERROR(memory_allocation)",
          "new_text": null,
          "old_line_content": "        if (zcs->cdictLocal == NULL) return ERROR(memory_allocation);",
          "new_line_content": "        zcs->cdict = zcs->cdictLocal;",
          "content_same": false
        },
        {
          "line": 634,
          "old_api": "DEBUGLOG",
          "new_api": null,
          "old_text": "DEBUGLOG(4,\"cdictLocal: %08X\", (U32)(size_t)zcs->cdictLocal)",
          "new_text": null,
          "old_line_content": "        DEBUGLOG(4,\"cdictLocal: %08X\", (U32)(size_t)zcs->cdictLocal);",
          "new_line_content": "    } else {",
          "content_same": false
        },
        {
          "line": 641,
          "old_api": "DEBUGLOG",
          "new_api": null,
          "old_text": "DEBUGLOG(4, \"overlapRLog : %u \", zcs->overlapRLog)",
          "new_text": null,
          "old_line_content": "    DEBUGLOG(4, \"overlapRLog : %u \", zcs->overlapRLog);",
          "new_line_content": "    zcs->targetDictSize = (zcs->overlapRLog>=9) ? 0 : (size_t)1 << (zcs->params.cParams.windowLog - zcs->overlapRLog);",
          "content_same": false
        },
        {
          "line": 644,
          "old_api": "MAX",
          "new_api": null,
          "old_text": "MAX(ZSTDMT_SECTION_SIZE_MIN, zcs->targetSectionSize)",
          "new_text": null,
          "old_line_content": "    zcs->targetSectionSize = MAX(ZSTDMT_SECTION_SIZE_MIN, zcs->targetSectionSize);",
          "new_line_content": "    zcs->targetSectionSize = zcs->sectionSize ? zcs->sectionSize : (size_t)1 << (zcs->params.cParams.windowLog + 2);",
          "content_same": false
        },
        {
          "line": 649,
          "old_api": "ZSTDMT_getBuffer",
          "new_api": null,
          "old_text": "ZSTDMT_getBuffer(zcs->buffPool, zcs->inBuffSize)",
          "new_text": null,
          "old_line_content": "    zcs->inBuff.buffer = ZSTDMT_getBuffer(zcs->buffPool, zcs->inBuffSize);",
          "new_line_content": "    zcs->inBuffSize = zcs->targetDictSize + zcs->targetSectionSize + zcs->marginSize;",
          "content_same": false
        },
        {
          "line": 657,
          "old_api": "XXH64_reset",
          "new_api": null,
          "old_text": "XXH64_reset(&zcs->xxhState, 0)",
          "new_text": null,
          "old_line_content": "    if (params.fParams.checksumFlag) XXH64_reset(&zcs->xxhState, 0);",
          "new_line_content": "    zcs->allJobsCompleted = 0;",
          "content_same": false
        },
        {
          "line": 665,
          "old_api": "DEBUGLOG",
          "new_api": null,
          "old_text": "DEBUGLOG(5, \"ZSTDMT_initCStream_advanced\")",
          "new_text": null,
          "old_line_content": "    DEBUGLOG(5, \"ZSTDMT_initCStream_advanced\");",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 674,
          "old_api": "ZSTD_getParamsFromCDict",
          "new_api": null,
          "old_text": "ZSTD_getParamsFromCDict(cdict)",
          "new_text": null,
          "old_line_content": "    ZSTD_parameters params = ZSTD_getParamsFromCDict(cdict);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 677,
          "old_api": "ZSTDMT_initCStream_internal",
          "new_api": null,
          "old_text": "ZSTDMT_initCStream_internal(mtctx, NULL, 0 /*dictSize*/, cdict,\n                                        params, pledgedSrcSize)",
          "new_text": null,
          "old_line_content": "    return ZSTDMT_initCStream_internal(mtctx, NULL, 0 /*dictSize*/, cdict,",
          "new_line_content": "    params.fParams = fParams;",
          "content_same": false
        },
        {
          "line": 687,
          "old_api": "ZSTD_resetCStream",
          "new_api": null,
          "old_text": "ZSTD_resetCStream(zcs->cctxPool->cctx[0], pledgedSrcSize)",
          "new_text": null,
          "old_line_content": "        return ZSTD_resetCStream(zcs->cctxPool->cctx[0], pledgedSrcSize);",
          "new_line_content": "    if (zcs->nbThreads==1)",
          "content_same": false
        },
        {
          "line": 692,
          "old_api": "ZSTD_getParams",
          "new_api": null,
          "old_text": "ZSTD_getParams(compressionLevel, 0, 0)",
          "new_text": null,
          "old_line_content": "    ZSTD_parameters const params = ZSTD_getParams(compressionLevel, 0, 0);",
          "new_line_content": "size_t ZSTDMT_initCStream(ZSTDMT_CCtx* zcs, int compressionLevel) {",
          "content_same": false
        },
        {
          "line": 699,
          "old_api": "ZSTD_compressBound",
          "new_api": null,
          "old_text": "ZSTD_compressBound(srcSize)",
          "new_text": null,
          "old_line_content": "    size_t const dstBufferCapacity = ZSTD_compressBound(srcSize);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 707,
          "old_api": "ZSTDMT_waitForAllJobsCompleted",
          "new_api": null,
          "old_text": "ZSTDMT_waitForAllJobsCompleted(zcs)",
          "new_text": null,
          "old_line_content": "        ZSTDMT_waitForAllJobsCompleted(zcs);",
          "new_line_content": "        zcs->nextJobID++;",
          "content_same": false
        },
        {
          "line": 712,
          "old_api": "DEBUGLOG",
          "new_api": null,
          "old_text": "DEBUGLOG(4, \"preparing job %u to compress %u bytes with %u preload \",\n                zcs->nextJobID, (U32)srcSize, (U32)zcs->dictSize)",
          "new_text": null,
          "old_line_content": "    DEBUGLOG(4, \"preparing job %u to compress %u bytes with %u preload \",",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 718,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(zcs->inBuff.filled >= srcSize + zcs->dictSize)",
          "new_text": null,
          "old_line_content": "    assert(zcs->inBuff.filled >= srcSize + zcs->dictSize);",
          "new_line_content": "    zcs->jobs[jobID].dictSize = zcs->dictSize;",
          "content_same": false
        },
        {
          "line": 735,
          "old_api": "MIN",
          "new_api": null,
          "old_text": "MIN(srcSize + zcs->dictSize, zcs->targetDictSize)",
          "new_text": null,
          "old_line_content": "        size_t const newDictSize = MIN(srcSize + zcs->dictSize, zcs->targetDictSize);",
          "new_line_content": "    if (!endFrame) {",
          "content_same": false
        },
        {
          "line": 741,
          "old_api": "ZSTDMT_waitForAllJobsCompleted",
          "new_api": null,
          "old_text": "ZSTDMT_waitForAllJobsCompleted(zcs)",
          "new_text": null,
          "old_line_content": "            ZSTDMT_waitForAllJobsCompleted(zcs);",
          "new_line_content": "            zcs->nextJobID++;",
          "content_same": false
        },
        {
          "line": 745,
          "old_api": "DEBUGLOG",
          "new_api": null,
          "old_text": "DEBUGLOG(5, \"inBuff currently filled to %u\", (U32)zcs->inBuff.filled)",
          "new_text": null,
          "old_line_content": "        DEBUGLOG(5, \"inBuff currently filled to %u\", (U32)zcs->inBuff.filled);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 747,
          "old_api": "DEBUGLOG",
          "new_api": null,
          "old_text": "DEBUGLOG(5, \"new job : inBuff filled to %u, with %u dict and %u src\",\n                    (U32)zcs->inBuff.filled, (U32)newDictSize,\n                    (U32)(zcs->inBuff.filled - newDictSize))",
          "new_text": null,
          "old_line_content": "        DEBUGLOG(5, \"new job : inBuff filled to %u, with %u dict and %u src\",",
          "new_line_content": "        zcs->inBuff.filled -= srcSize + zcs->dictSize - newDictSize;",
          "content_same": false
        },
        {
          "line": 749,
          "old_api": "U32)(zcs->inBuff.filled - newDictSize)",
          "new_api": null,
          "old_text": "U32)(zcs->inBuff.filled - newDictSize)",
          "new_text": null,
          "old_line_content": "                    (U32)(zcs->inBuff.filled - newDictSize));",
          "new_line_content": "                    (U32)zcs->inBuff.filled, (U32)newDictSize,",
          "content_same": false
        },
        {
          "line": 753,
          "old_api": "DEBUGLOG",
          "new_api": null,
          "old_text": "DEBUGLOG(5, \"new inBuff pre-filled\")",
          "new_text": null,
          "old_line_content": "        DEBUGLOG(5, \"new inBuff pre-filled\");",
          "new_line_content": "            zcs->inBuff.filled);",
          "content_same": false
        },
        {
          "line": 756,
          "old_api": "DEBUGLOG",
          "new_api": null,
          "old_text": "DEBUGLOG(5, \"ZSTDMT_createCompressionJob::endFrame = %u\", endFrame)",
          "new_text": null,
          "old_line_content": "        DEBUGLOG(5, \"ZSTDMT_createCompressionJob::endFrame = %u\", endFrame);",
          "new_line_content": "    } else {   /* if (endFrame==1) */",
          "content_same": false
        },
        {
          "line": 766,
          "old_api": "DEBUGLOG",
          "new_api": null,
          "old_text": "DEBUGLOG(4, \"posting job %u : %u bytes  (end:%u) (note : doneJob = %u=>%u)\",\n                zcs->nextJobID,\n                (U32)zcs->jobs[jobID].srcSize,\n                zcs->jobs[jobID].lastChunk,\n                zcs->doneJobID,\n                zcs->doneJobID & zcs->jobIDMask)",
          "new_text": null,
          "old_line_content": "    DEBUGLOG(4, \"posting job %u : %u bytes  (end:%u) (note : doneJob = %u=>%u)\",",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 772,
          "old_api": "POOL_add",
          "new_api": null,
          "old_text": "POOL_add(zcs->factory, ZSTDMT_compressChunk, &zcs->jobs[jobID])",
          "new_text": null,
          "old_line_content": "    POOL_add(zcs->factory, ZSTDMT_compressChunk, &zcs->jobs[jobID]);   /* this call is blocking when thread worker pool is exhausted */",
          "new_line_content": "                zcs->doneJobID & zcs->jobIDMask);",
          "content_same": false
        },
        {
          "line": 786,
          "old_api": "PTHREAD_MUTEX_LOCK",
          "new_api": null,
          "old_text": "PTHREAD_MUTEX_LOCK(&zcs->jobCompleted_mutex)",
          "new_text": null,
          "old_line_content": "    PTHREAD_MUTEX_LOCK(&zcs->jobCompleted_mutex);",
          "new_line_content": "    if (zcs->doneJobID == zcs->nextJobID) return 0;   /* all flushed ! */",
          "content_same": false
        },
        {
          "line": 788,
          "old_api": "DEBUGLOG",
          "new_api": null,
          "old_text": "DEBUGLOG(5, \"waiting for jobCompleted signal from job %u\", zcs->doneJobID)",
          "new_text": null,
          "old_line_content": "        DEBUGLOG(5, \"waiting for jobCompleted signal from job %u\", zcs->doneJobID);",
          "new_line_content": "    while (zcs->jobs[wJobID].jobCompleted==0) {",
          "content_same": false
        },
        {
          "line": 792,
          "old_api": "pthread_mutex_unlock",
          "new_api": null,
          "old_text": "pthread_mutex_unlock(&zcs->jobCompleted_mutex)",
          "new_text": null,
          "old_line_content": "    pthread_mutex_unlock(&zcs->jobCompleted_mutex);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 796,
          "old_api": "ZSTD_isError",
          "new_api": null,
          "old_text": "ZSTD_isError(job.cSize)",
          "new_text": null,
          "old_line_content": "            if (ZSTD_isError(job.cSize)) {",
          "new_line_content": "        if (!job.jobScanned) {",
          "content_same": false
        },
        {
          "line": 802,
          "old_api": "ZSTDMT_releaseCCtx",
          "new_api": null,
          "old_text": "ZSTDMT_releaseCCtx(zcs->cctxPool, job.cctx)",
          "new_text": null,
          "old_line_content": "            ZSTDMT_releaseCCtx(zcs->cctxPool, job.cctx);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 804,
          "old_api": "DEBUGLOG",
          "new_api": null,
          "old_text": "DEBUGLOG(5, \"zcs->params.fParams.checksumFlag : %u \", zcs->params.fParams.checksumFlag)",
          "new_text": null,
          "old_line_content": "            DEBUGLOG(5, \"zcs->params.fParams.checksumFlag : %u \", zcs->params.fParams.checksumFlag);",
          "new_line_content": "            zcs->jobs[wJobID].cctx = NULL;",
          "content_same": false
        },
        {
          "line": 806,
          "old_api": "XXH64_update",
          "new_api": null,
          "old_text": "XXH64_update(&zcs->xxhState, (const char*)job.srcStart + job.dictSize, job.srcSize)",
          "new_text": null,
          "old_line_content": "                XXH64_update(&zcs->xxhState, (const char*)job.srcStart + job.dictSize, job.srcSize);",
          "new_line_content": "            if (zcs->params.fParams.checksumFlag) {",
          "content_same": false
        },
        {
          "line": 808,
          "old_api": "XXH64_digest",
          "new_api": null,
          "old_text": "XXH64_digest(&zcs->xxhState)",
          "new_text": null,
          "old_line_content": "                    U32 const checksum = (U32)XXH64_digest(&zcs->xxhState);",
          "new_line_content": "                if (zcs->frameEnded && (zcs->doneJobID+1 == zcs->nextJobID)) {  /* write checksum at end of last section */",
          "content_same": false
        },
        {
          "line": 814,
          "old_api": "ZSTDMT_releaseBuffer",
          "new_api": null,
          "old_text": "ZSTDMT_releaseBuffer(zcs->buffPool, job.src)",
          "new_text": null,
          "old_line_content": "            ZSTDMT_releaseBuffer(zcs->buffPool, job.src);",
          "new_line_content": "            }   }",
          "content_same": false
        },
        {
          "line": 819,
          "old_api": "MIN",
          "new_api": null,
          "old_text": "MIN(job.cSize - job.dstFlushed, output->size - output->pos)",
          "new_text": null,
          "old_line_content": "        {   size_t const toWrite = MIN(job.cSize - job.dstFlushed, output->size - output->pos);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 826,
          "old_api": "ZSTDMT_releaseBuffer",
          "new_api": null,
          "old_text": "ZSTDMT_releaseBuffer(zcs->buffPool, job.dstBuff)",
          "new_text": null,
          "old_line_content": "            ZSTDMT_releaseBuffer(zcs->buffPool, job.dstBuff);",
          "new_line_content": "        if (job.dstFlushed == job.cSize) {   /* output buffer fully flushed => move to next one */",
          "content_same": false
        },
        {
          "line": 851,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(output->pos <= output->size)",
          "new_text": null,
          "old_line_content": "    assert(output->pos <= output->size);",
          "new_line_content": "    size_t const newJobThreshold = mtctx->dictSize + mtctx->targetSectionSize + mtctx->marginSize;",
          "content_same": false
        },
        {
          "line": 855,
          "old_api": "ERROR",
          "new_api": null,
          "old_text": "ERROR(stage_wrong)",
          "new_text": null,
          "old_line_content": "        return ERROR(stage_wrong);",
          "new_line_content": "        /* current frame being ended. Only flush/end are allowed. Or start new job with init */",
          "content_same": false
        },
        {
          "line": 858,
          "old_api": "ZSTD_compressStream_generic",
          "new_api": null,
          "old_text": "ZSTD_compressStream_generic(mtctx->cctxPool->cctx[0], output, input, endOp)",
          "new_text": null,
          "old_line_content": "        return ZSTD_compressStream_generic(mtctx->cctxPool->cctx[0], output, input, endOp);",
          "new_line_content": "    if (mtctx->nbThreads==1) {",
          "content_same": false
        },
        {
          "line": 865,
          "old_api": "ZSTD_compressBound",
          "new_api": null,
          "old_text": "ZSTD_compressBound(input->size - input->pos)",
          "new_text": null,
          "old_line_content": "      && (output->size - output->pos >= ZSTD_compressBound(input->size - input->pos)) ) { /* enough room */",
          "new_line_content": "      && (endOp==ZSTD_e_end)        /* end order, immediately at beginning */",
          "content_same": false
        },
        {
          "line": 870,
          "old_api": "ZSTD_isError",
          "new_api": null,
          "old_text": "ZSTD_isError(cSize)",
          "new_text": null,
          "old_line_content": "        if (ZSTD_isError(cSize)) return cSize;",
          "new_line_content": "                mtctx->cdict, mtctx->params, mtctx->overlapRLog);",
          "content_same": false
        },
        {
          "line": 873,
          "old_api": "ZSTDMT_releaseBuffer",
          "new_api": null,
          "old_text": "ZSTDMT_releaseBuffer(mtctx->buffPool, mtctx->inBuff.buffer)",
          "new_text": null,
          "old_line_content": "        ZSTDMT_releaseBuffer(mtctx->buffPool, mtctx->inBuff.buffer);  /* was allocated in initStream */",
          "new_line_content": "        output->pos += cSize;",
          "content_same": false
        },
        {
          "line": 880,
          "old_api": "MIN",
          "new_api": null,
          "old_text": "MIN(input->size - input->pos, mtctx->inBuffSize - mtctx->inBuff.filled)",
          "new_text": null,
          "old_line_content": "    {   size_t const toLoad = MIN(input->size - input->pos, mtctx->inBuffSize - mtctx->inBuff.filled);",
          "new_line_content": "    /* fill input buffer */",
          "content_same": false
        },
        {
          "line": 888,
          "old_api": "ZSTDMT_createCompressionJob",
          "new_api": null,
          "old_text": "ZSTDMT_createCompressionJob(mtctx, mtctx->targetSectionSize, 0 /* endFrame */)",
          "new_text": null,
          "old_line_content": "        CHECK_F( ZSTDMT_createCompressionJob(mtctx, mtctx->targetSectionSize, 0 /* endFrame */) );",
          "new_line_content": "      && (mtctx->nextJobID <= mtctx->doneJobID + mtctx->jobIDMask) ) {   /* avoid overwriting job round buffer */",
          "content_same": false
        },
        {
          "line": 892,
          "old_api": "ZSTDMT_flushNextJob",
          "new_api": null,
          "old_text": "ZSTDMT_flushNextJob(mtctx, output, (mtctx->inBuff.filled == mtctx->inBuffSize) /* blockToFlush */)",
          "new_text": null,
          "old_line_content": "    CHECK_F( ZSTDMT_flushNextJob(mtctx, output, (mtctx->inBuff.filled == mtctx->inBuffSize) /* blockToFlush */) ); /* block if it wasn't possible to create new job due to saturation */",
          "new_line_content": "    /* check for potential compressed data ready to be flushed */",
          "content_same": false
        },
        {
          "line": 900,
          "old_api": "ZSTDMT_flushStream",
          "new_api": null,
          "old_text": "ZSTDMT_flushStream(mtctx, output)",
          "new_text": null,
          "old_line_content": "            return ZSTDMT_flushStream(mtctx, output);",
          "new_line_content": "        case ZSTD_e_flush:",
          "content_same": false
        },
        {
          "line": 902,
          "old_api": "ZSTDMT_endStream",
          "new_api": null,
          "old_text": "ZSTDMT_endStream(mtctx, output)",
          "new_text": null,
          "old_line_content": "            return ZSTDMT_endStream(mtctx, output);",
          "new_line_content": "        case ZSTD_e_end:",
          "content_same": false
        },
        {
          "line": 906,
          "old_api": "ERROR",
          "new_api": null,
          "old_text": "ERROR(GENERIC)",
          "new_text": null,
          "old_line_content": "            return ERROR(GENERIC);   /* invalid endDirective */",
          "new_line_content": "        default:",
          "content_same": false
        },
        {
          "line": 916,
          "old_api": "DEBUGLOG",
          "new_api": null,
          "old_text": "DEBUGLOG(5, \"ZSTDMT_compressStream: zcs::frameEnded==1\")",
          "new_text": null,
          "old_line_content": "        DEBUGLOG(5, \"ZSTDMT_compressStream: zcs::frameEnded==1\");",
          "new_line_content": "        /* current frame being ended. Only flush is allowed. Or start new job with init */",
          "content_same": false
        },
        {
          "line": 920,
          "old_api": "ZSTD_compressStream",
          "new_api": null,
          "old_text": "ZSTD_compressStream(zcs->cctxPool->cctx[0], output, input)",
          "new_text": null,
          "old_line_content": "        return ZSTD_compressStream(zcs->cctxPool->cctx[0], output, input);",
          "new_line_content": "    if (zcs->nbThreads==1) {",
          "content_same": false
        },
        {
          "line": 924,
          "old_api": "MIN",
          "new_api": null,
          "old_text": "MIN(input->size - input->pos, zcs->inBuffSize - zcs->inBuff.filled)",
          "new_text": null,
          "old_line_content": "    {   size_t const toLoad = MIN(input->size - input->pos, zcs->inBuffSize - zcs->inBuff.filled);",
          "new_line_content": "    /* fill input buffer */",
          "content_same": false
        },
        {
          "line": 932,
          "old_api": "ZSTDMT_createCompressionJob",
          "new_api": null,
          "old_text": "ZSTDMT_createCompressionJob(zcs, zcs->targetSectionSize, 0 /* endFrame */)",
          "new_text": null,
          "old_line_content": "        CHECK_F( ZSTDMT_createCompressionJob(zcs, zcs->targetSectionSize, 0 /* endFrame */) );",
          "new_line_content": "        && (zcs->nextJobID <= zcs->doneJobID + zcs->jobIDMask) ) {   /* avoid overwriting job round buffer */",
          "content_same": false
        },
        {
          "line": 936,
          "old_api": "ZSTDMT_flushNextJob",
          "new_api": null,
          "old_text": "ZSTDMT_flushNextJob(zcs, output, (zcs->inBuff.filled == zcs->inBuffSize) /* blockToFlush */)",
          "new_text": null,
          "old_line_content": "    CHECK_F( ZSTDMT_flushNextJob(zcs, output, (zcs->inBuff.filled == zcs->inBuffSize) /* blockToFlush */) ); /* block if it wasn't possible to create new job due to saturation */",
          "new_line_content": "    /* check for data to flush */",
          "content_same": false
        },
        {
          "line": 949,
          "old_api": "ZSTDMT_createCompressionJob",
          "new_api": null,
          "old_text": "ZSTDMT_createCompressionJob(zcs, srcSize, endFrame)",
          "new_text": null,
          "old_line_content": "        CHECK_F( ZSTDMT_createCompressionJob(zcs, srcSize, endFrame) );",
          "new_line_content": "       && (zcs->nextJobID <= zcs->doneJobID + zcs->jobIDMask) ) {",
          "content_same": false
        },
        {
          "line": 953,
          "old_api": "ZSTDMT_flushNextJob",
          "new_api": null,
          "old_text": "ZSTDMT_flushNextJob(zcs, output, 1 /* blockToFlush */)",
          "new_text": null,
          "old_line_content": "    return ZSTDMT_flushNextJob(zcs, output, 1 /* blockToFlush */);",
          "new_line_content": "    /* check if there is any data available to flush */",
          "content_same": false
        },
        {
          "line": 959,
          "old_api": "DEBUGLOG",
          "new_api": null,
          "old_text": "DEBUGLOG(5, \"ZSTDMT_flushStream\")",
          "new_text": null,
          "old_line_content": "    DEBUGLOG(5, \"ZSTDMT_flushStream\");",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 961,
          "old_api": "ZSTD_flushStream",
          "new_api": null,
          "old_text": "ZSTD_flushStream(zcs->cctxPool->cctx[0], output)",
          "new_text": null,
          "old_line_content": "        return ZSTD_flushStream(zcs->cctxPool->cctx[0], output);",
          "new_line_content": "    if (zcs->nbThreads==1)",
          "content_same": false
        },
        {
          "line": 967,
          "old_api": "DEBUGLOG",
          "new_api": null,
          "old_text": "DEBUGLOG(4, \"ZSTDMT_endStream\")",
          "new_text": null,
          "old_line_content": "    DEBUGLOG(4, \"ZSTDMT_endStream\");",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 969,
          "old_api": "ZSTD_endStream",
          "new_api": null,
          "old_text": "ZSTD_endStream(zcs->cctxPool->cctx[0], output)",
          "new_text": null,
          "old_line_content": "        return ZSTD_endStream(zcs->cctxPool->cctx[0], output);",
          "new_line_content": "    if (zcs->nbThreads==1)",
          "content_same": false
        },
        {
          "line": 978,
          "old_api": "DEBUGLOG",
          "new_api": null,
          "old_text": "DEBUGLOG(5, \"ZSTDMT_compressStream_generic\")",
          "new_text": null,
          "old_line_content": "    DEBUGLOG(5, \"ZSTDMT_compressStream_generic\");",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 982,
          "old_api": "ZSTDMT_compressStream",
          "new_api": null,
          "old_text": "ZSTDMT_compressStream(mtctx, output, input)",
          "new_text": null,
          "old_line_content": "        CHECK_F(ZSTDMT_compressStream(mtctx, output, input));",
          "new_line_content": "    if (input->pos < input->size)  /* some input to consume */",
          "content_same": false
        },
        {
          "line": 988,
          "old_api": "ZSTDMT_flushStream",
          "new_api": null,
          "old_text": "ZSTDMT_flushStream(mtctx, output)",
          "new_text": null,
          "old_line_content": "            return ZSTDMT_flushStream(mtctx, output);",
          "new_line_content": "        case ZSTD_e_flush:",
          "content_same": false
        },
        {
          "line": 990,
          "old_api": "DEBUGLOG",
          "new_api": null,
          "old_text": "DEBUGLOG(5, \"endOp:%u; calling ZSTDMT_endStream\", (U32)endOp)",
          "new_text": null,
          "old_line_content": "            DEBUGLOG(5, \"endOp:%u; calling ZSTDMT_endStream\", (U32)endOp);",
          "new_line_content": "        case ZSTD_e_end:",
          "content_same": false
        },
        {
          "line": 482,
          "old_api": "ZSTD_free",
          "new_api": null,
          "old_text": "ZSTD_free(mtctx->jobs, mtctx->cMem)",
          "new_text": null,
          "old_line_content": "        ZSTD_free(mtctx->jobs, mtctx->cMem);",
          "new_line_content": "        U32 nbJobs = nbChunks;",
          "content_same": false
        },
        {
          "line": 995,
          "old_api": "ERROR",
          "new_api": null,
          "old_text": "ERROR(GENERIC)",
          "new_text": null,
          "old_line_content": "            return ERROR(GENERIC);   /* invalid endDirective */",
          "new_line_content": "        default:",
          "content_same": false
        },
        {
          "line": 484,
          "old_api": "ZSTDMT_allocJobsTable",
          "new_api": null,
          "old_text": "ZSTDMT_allocJobsTable(&nbJobs, mtctx->cMem)",
          "new_text": null,
          "old_line_content": "        mtctx->jobs = ZSTDMT_allocJobsTable(&nbJobs, mtctx->cMem);",
          "new_line_content": "        mtctx->jobIDMask = 0;",
          "content_same": false
        },
        {
          "line": 491,
          "old_api": "MIN",
          "new_api": null,
          "old_text": "MIN(remainingSrcSize, avgChunkSize)",
          "new_text": null,
          "old_line_content": "            size_t const chunkSize = MIN(remainingSrcSize, avgChunkSize);",
          "new_line_content": "        for (u=0; u<nbChunks; u++) {",
          "content_same": false
        },
        {
          "line": 494,
          "old_api": "ZSTDMT_getBuffer",
          "new_api": null,
          "old_text": "ZSTDMT_getBuffer(mtctx->buffPool, dstBufferCapacity)",
          "new_text": null,
          "old_line_content": "            buffer_t const dstBuffer = u < compressWithinDst ? dstAsBuffer : ZSTDMT_getBuffer(mtctx->buffPool, dstBufferCapacity);",
          "new_line_content": "            buffer_t const dstAsBuffer = { (char*)dst + dstBufferPos, dstBufferCapacity };",
          "content_same": false
        },
        {
          "line": 499,
          "old_api": "ERROR",
          "new_api": null,
          "old_text": "ERROR(memory_allocation)",
          "new_text": null,
          "old_line_content": "                mtctx->jobs[u].cSize = ERROR(memory_allocation);   /* job result */",
          "new_line_content": "            if ((cctx==NULL) || (dstBuffer.start==NULL)) {",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 51,
      "total_additions": 89,
      "total_deletions": 88,
      "total_api_changes": 228
    },
    "non_api_changes": {
      "has_non_api_changes": false,
      "evidence": {
        "total_diff_lines": 1,
        "api_related_lines": 228,
        "non_api_lines": 0,
        "non_api_line_numbers": []
      }
    },
    "api_calls_before": 231,
    "api_calls_after": 232,
    "diff_info": {
      "added_lines": 1,
      "removed_lines": 0,
      "total_diff_lines": 13
    }
  }
}