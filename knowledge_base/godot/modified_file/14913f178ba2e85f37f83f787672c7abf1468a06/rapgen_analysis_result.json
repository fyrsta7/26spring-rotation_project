{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/godot/modified_file/14913f178ba2e85f37f83f787672c7abf1468a06",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/godot/modified_file/14913f178ba2e85f37f83f787672c7abf1468a06/before.h",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/godot/modified_file/14913f178ba2e85f37f83f787672c7abf1468a06/after.h",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/godot/modified_file/14913f178ba2e85f37f83f787672c7abf1468a06/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 310,
          "old_api": "push_back",
          "new_api": "ptrw",
          "old_text": "triangles.push_back(tr[i].points[0])",
          "new_text": "triangles.ptrw()",
          "old_line_content": "\t\t\ttriangles.push_back(tr[i].points[0]);",
          "new_line_content": "\t\tint *ptr = triangles.ptrw();",
          "content_same": false
        },
        {
          "line": 311,
          "old_api": "push_back",
          "new_api": "size",
          "old_text": "triangles.push_back(tr[i].points[1])",
          "new_text": "tr.size()",
          "old_line_content": "\t\t\ttriangles.push_back(tr[i].points[1]);",
          "new_line_content": "\t\tfor (int i = 0; i < tr.size(); i++) {",
          "content_same": false
        },
        {
          "line": 354,
          "old_api": "MIN",
          "new_api": "MAX",
          "old_text": "MIN(p[i].x, further_away_opposite.x)",
          "new_text": "MAX(p[i].x, further_away.x)",
          "old_line_content": "\t\t\tfurther_away_opposite.x = MIN(p[i].x, further_away_opposite.x);",
          "new_line_content": "\t\t\tfurther_away.x = MAX(p[i].x, further_away.x);",
          "content_same": false
        },
        {
          "line": 355,
          "old_api": "MIN",
          "new_api": "MAX",
          "old_text": "MIN(p[i].y, further_away_opposite.y)",
          "new_text": "MAX(p[i].y, further_away.y)",
          "old_line_content": "\t\t\tfurther_away_opposite.y = MIN(p[i].y, further_away_opposite.y);",
          "new_line_content": "\t\t\tfurther_away.y = MAX(p[i].y, further_away.y);",
          "content_same": false
        },
        {
          "line": 369,
          "old_api": "is_equal_approx",
          "new_api": "segment_intersects_segment",
          "old_text": "res.is_equal_approx(p_point)",
          "new_text": "segment_intersects_segment(v1, v2, p_point, further_away, &res)",
          "old_line_content": "\t\t\t\tif (res.is_equal_approx(p_point)) {",
          "new_line_content": "\t\t\tif (segment_intersects_segment(v1, v2, p_point, further_away, &res)) {",
          "content_same": false
        },
        {
          "line": 401,
          "old_api": "resize",
          "new_api": "size",
          "old_text": "H.resize(2 * n)",
          "new_text": "P.size()",
          "old_line_content": "\t\tH.resize(2 * n);",
          "new_line_content": "\t\tint n = P.size(), k = 0;",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 387,
          "old_api": null,
          "new_api": "segment_intersects_segment",
          "old_text": null,
          "new_text": "segment_intersects_segment(p_from, p_to, v1, v2, nullptr)",
          "old_line_content": "\t\t\t}",
          "new_line_content": "\t\t\tif (segment_intersects_segment(p_from, p_to, v1, v2, nullptr)) {",
          "content_same": false
        },
        {
          "line": 395,
          "old_api": null,
          "new_api": "real_t)(A.y - O.y)",
          "old_text": null,
          "new_text": "real_t)(A.y - O.y)",
          "old_line_content": "",
          "new_line_content": "\t\treturn (real_t)(A.x - O.x) * (B.y - O.y) - (real_t)(A.y - O.y) * (B.x - O.x);",
          "content_same": false
        },
        {
          "line": 403,
          "old_api": null,
          "new_api": "resize",
          "old_text": null,
          "new_text": "H.resize(2 * n)",
          "old_line_content": "\t\t// Sort points lexicographically.",
          "new_line_content": "\t\tH.resize(2 * n);",
          "content_same": false
        },
        {
          "line": 406,
          "old_api": null,
          "new_api": "sort",
          "old_text": null,
          "new_text": "P.sort()",
          "old_line_content": "\t\t// Build lower hull.",
          "new_line_content": "\t\tP.sort();",
          "content_same": false
        },
        {
          "line": 410,
          "old_api": null,
          "new_api": "vec2_cross",
          "old_text": null,
          "new_text": "vec2_cross(H[k - 2], H[k - 1], P[i])",
          "old_line_content": "\t\t\t}",
          "new_line_content": "\t\t\twhile (k >= 2 && vec2_cross(H[k - 2], H[k - 1], P[i]) <= 0) {",
          "content_same": false
        },
        {
          "line": 418,
          "old_api": null,
          "new_api": "vec2_cross",
          "old_text": null,
          "new_text": "vec2_cross(H[k - 2], H[k - 1], P[i])",
          "old_line_content": "\t\t\t}",
          "new_line_content": "\t\t\twhile (k >= t && vec2_cross(H[k - 2], H[k - 1], P[i]) <= 0) {",
          "content_same": false
        },
        {
          "line": 424,
          "old_api": null,
          "new_api": "resize",
          "old_text": null,
          "new_text": "H.resize(k)",
          "old_line_content": "\t}",
          "new_line_content": "\t\tH.resize(k);",
          "content_same": false
        },
        {
          "line": 431,
          "old_api": null,
          "new_api": "abs",
          "old_text": null,
          "new_text": "p_end - p_start).abs()",
          "old_line_content": "\t\tVector2i current = p_start;",
          "new_line_content": "\t\tVector2i delta = (p_end - p_start).abs() * 2;",
          "content_same": false
        },
        {
          "line": 432,
          "old_api": null,
          "new_api": "sign",
          "old_text": null,
          "new_text": "p_end - p_start).sign()",
          "old_line_content": "",
          "new_line_content": "\t\tVector2i step = (p_end - p_start).sign();",
          "content_same": false
        },
        {
          "line": 439,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "points.push_back(current)",
          "old_line_content": "\t\t\t\terr -= delta.y;",
          "new_line_content": "\t\t\t\tpoints.push_back(current);",
          "content_same": false
        },
        {
          "line": 321,
          "old_api": null,
          "new_api": "Triangulate::triangulate(p_polygon, triangles)",
          "old_text": null,
          "new_text": "Triangulate::triangulate(p_polygon, triangles)",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\tif (!Triangulate::triangulate(p_polygon, triangles)) {",
          "content_same": false
        },
        {
          "line": 322,
          "old_api": null,
          "new_api": "Vector<int>()",
          "old_text": null,
          "new_text": "Vector<int>()",
          "old_line_content": "\t\treturn triangles;",
          "new_line_content": "\t\t\treturn Vector<int>(); //fail",
          "content_same": false
        },
        {
          "line": 451,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "points.push_back(current)",
          "old_line_content": "\t\t\t\terr -= delta.x;",
          "new_line_content": "\t\t\t\tpoints.push_back(current);",
          "content_same": false
        },
        {
          "line": 328,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "p_polygon.size()",
          "old_line_content": "\t\t\treturn false;",
          "new_line_content": "\t\tint c = p_polygon.size();",
          "content_same": false
        },
        {
          "line": 332,
          "old_api": null,
          "new_api": "ptr",
          "old_text": null,
          "new_text": "p_polygon.ptr()",
          "old_line_content": "\t\tfor (int i = 0; i < c; i++) {",
          "new_line_content": "\t\tconst Vector2 *p = p_polygon.ptr();",
          "content_same": false
        },
        {
          "line": 461,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "points.push_back(current)",
          "old_line_content": "\t\treturn points;",
          "new_line_content": "\t\tpoints.push_back(current);",
          "content_same": false
        },
        {
          "line": 345,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "p_polygon.size()",
          "old_line_content": "\t\t\treturn false;",
          "new_line_content": "\t\tint c = p_polygon.size();",
          "content_same": false
        },
        {
          "line": 349,
          "old_api": null,
          "new_api": "ptr",
          "old_text": null,
          "new_text": "p_polygon.ptr()",
          "old_line_content": "\t\tVector2 further_away_opposite(1e20, 1e20);",
          "new_line_content": "\t\tconst Vector2 *p = p_polygon.ptr();",
          "content_same": false
        },
        {
          "line": 356,
          "old_api": null,
          "new_api": "MIN",
          "old_text": null,
          "new_text": "MIN(p[i].x, further_away_opposite.x)",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\t\tfurther_away_opposite.x = MIN(p[i].x, further_away_opposite.x);",
          "content_same": false
        },
        {
          "line": 357,
          "old_api": null,
          "new_api": "MIN",
          "old_text": null,
          "new_text": "MIN(p[i].y, further_away_opposite.y)",
          "old_line_content": "",
          "new_line_content": "\t\t\tfurther_away_opposite.y = MIN(p[i].y, further_away_opposite.y);",
          "content_same": false
        },
        {
          "line": 361,
          "old_api": null,
          "new_api": "Vector2",
          "old_text": null,
          "new_text": "Vector2(1.221313, 1.512312)",
          "old_line_content": "\t\tint intersections = 0;",
          "new_line_content": "\t\tfurther_away += (further_away - further_away_opposite) * Vector2(1.221313, 1.512312);",
          "content_same": false
        },
        {
          "line": 371,
          "old_api": null,
          "new_api": "is_equal_approx",
          "old_text": null,
          "new_text": "res.is_equal_approx(p_point)",
          "old_line_content": "\t\t\t\t\treturn true;",
          "new_line_content": "\t\t\t\tif (res.is_equal_approx(p_point)) {",
          "content_same": false
        },
        {
          "line": 382,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "p_polygon.size()",
          "old_line_content": "\t\tfor (int i = 0; i < c; i++) {",
          "new_line_content": "\t\tint c = p_polygon.size();",
          "content_same": false
        },
        {
          "line": 383,
          "old_api": null,
          "new_api": "ptr",
          "old_text": null,
          "new_text": "p_polygon.ptr()",
          "old_line_content": "\t\t\tconst Vector2 &v1 = p[i];",
          "new_line_content": "\t\tconst Vector2 *p = p_polygon.ptr();",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 385,
          "old_api": "segment_intersects_segment",
          "new_api": null,
          "old_text": "segment_intersects_segment(p_from, p_to, v1, v2, nullptr)",
          "new_text": null,
          "old_line_content": "\t\t\tif (segment_intersects_segment(p_from, p_to, v1, v2, nullptr)) {",
          "new_line_content": "\t\t\tconst Vector2 &v1 = p[i];",
          "content_same": false
        },
        {
          "line": 393,
          "old_api": "real_t)(A.y - O.y)",
          "new_api": null,
          "old_text": "real_t)(A.y - O.y)",
          "new_text": null,
          "old_line_content": "\t\treturn (real_t)(A.x - O.x) * (B.y - O.y) - (real_t)(A.y - O.y) * (B.x - O.x);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 399,
          "old_api": "size",
          "new_api": null,
          "old_text": "P.size()",
          "new_text": null,
          "old_line_content": "\t\tint n = P.size(), k = 0;",
          "new_line_content": "\t// Note: the last point in the returned list is the same as the first one.",
          "content_same": false
        },
        {
          "line": 404,
          "old_api": "sort",
          "new_api": null,
          "old_text": "P.sort()",
          "new_text": null,
          "old_line_content": "\t\tP.sort();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 408,
          "old_api": "vec2_cross",
          "new_api": null,
          "old_text": "vec2_cross(H[k - 2], H[k - 1], P[i])",
          "new_text": null,
          "old_line_content": "\t\t\twhile (k >= 2 && vec2_cross(H[k - 2], H[k - 1], P[i]) <= 0) {",
          "new_line_content": "\t\t// Build lower hull.",
          "content_same": false
        },
        {
          "line": 416,
          "old_api": "vec2_cross",
          "new_api": null,
          "old_text": "vec2_cross(H[k - 2], H[k - 1], P[i])",
          "new_text": null,
          "old_line_content": "\t\t\twhile (k >= t && vec2_cross(H[k - 2], H[k - 1], P[i]) <= 0) {",
          "new_line_content": "\t\t// Build upper hull.",
          "content_same": false
        },
        {
          "line": 422,
          "old_api": "resize",
          "new_api": null,
          "old_text": "H.resize(k)",
          "new_text": null,
          "old_line_content": "\t\tH.resize(k);",
          "new_line_content": "\t\t}",
          "content_same": false
        },
        {
          "line": 429,
          "old_api": "abs",
          "new_api": null,
          "old_text": "p_end - p_start).abs()",
          "new_text": null,
          "old_line_content": "\t\tVector2i delta = (p_end - p_start).abs() * 2;",
          "new_line_content": "\t\tVector<Point2i> points;",
          "content_same": false
        },
        {
          "line": 430,
          "old_api": "sign",
          "new_api": null,
          "old_text": "p_end - p_start).sign()",
          "new_text": null,
          "old_line_content": "\t\tVector2i step = (p_end - p_start).sign();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 437,
          "old_api": "push_back",
          "new_api": null,
          "old_text": "points.push_back(current)",
          "new_text": null,
          "old_line_content": "\t\t\t\tpoints.push_back(current);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 312,
          "old_api": "push_back",
          "new_api": null,
          "old_text": "triangles.push_back(tr[i].points[2])",
          "new_text": null,
          "old_line_content": "\t\t\ttriangles.push_back(tr[i].points[2]);",
          "new_line_content": "\t\t\t*ptr++ = tr[i].points[0];",
          "content_same": false
        },
        {
          "line": 319,
          "old_api": "Triangulate::triangulate(p_polygon, triangles)",
          "new_api": null,
          "old_text": "Triangulate::triangulate(p_polygon, triangles)",
          "new_text": null,
          "old_line_content": "\t\tif (!Triangulate::triangulate(p_polygon, triangles)) {",
          "new_line_content": "\tstatic Vector<int> triangulate_polygon(const Vector<Vector2> &p_polygon) {",
          "content_same": false
        },
        {
          "line": 320,
          "old_api": "Vector<int>()",
          "new_api": null,
          "old_text": "Vector<int>()",
          "new_text": null,
          "old_line_content": "\t\t\treturn Vector<int>(); //fail",
          "new_line_content": "\t\tVector<int> triangles;",
          "content_same": false
        },
        {
          "line": 449,
          "old_api": "push_back",
          "new_api": null,
          "old_text": "points.push_back(current)",
          "new_text": null,
          "old_line_content": "\t\t\t\tpoints.push_back(current);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 326,
          "old_api": "size",
          "new_api": null,
          "old_text": "p_polygon.size()",
          "new_text": null,
          "old_line_content": "\t\tint c = p_polygon.size();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 330,
          "old_api": "ptr",
          "new_api": null,
          "old_text": "p_polygon.ptr()",
          "new_text": null,
          "old_line_content": "\t\tconst Vector2 *p = p_polygon.ptr();",
          "new_line_content": "\t\t\treturn false;",
          "content_same": false
        },
        {
          "line": 459,
          "old_api": "push_back",
          "new_api": null,
          "old_text": "points.push_back(current)",
          "new_text": null,
          "old_line_content": "\t\tpoints.push_back(current);",
          "new_line_content": "\t\t}",
          "content_same": false
        },
        {
          "line": 343,
          "old_api": "size",
          "new_api": null,
          "old_text": "p_polygon.size()",
          "new_text": null,
          "old_line_content": "\t\tint c = p_polygon.size();",
          "new_line_content": "\t// Alternate implementation that should be faster.",
          "content_same": false
        },
        {
          "line": 347,
          "old_api": "ptr",
          "new_api": null,
          "old_text": "p_polygon.ptr()",
          "new_text": null,
          "old_line_content": "\t\tconst Vector2 *p = p_polygon.ptr();",
          "new_line_content": "\t\t\treturn false;",
          "content_same": false
        },
        {
          "line": 352,
          "old_api": "MAX",
          "new_api": null,
          "old_text": "MAX(p[i].x, further_away.x)",
          "new_text": null,
          "old_line_content": "\t\t\tfurther_away.x = MAX(p[i].x, further_away.x);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 353,
          "old_api": "MAX",
          "new_api": null,
          "old_text": "MAX(p[i].y, further_away.y)",
          "new_text": null,
          "old_line_content": "\t\t\tfurther_away.y = MAX(p[i].y, further_away.y);",
          "new_line_content": "\t\tfor (int i = 0; i < c; i++) {",
          "content_same": false
        },
        {
          "line": 359,
          "old_api": "Vector2",
          "new_api": null,
          "old_text": "Vector2(1.221313, 1.512312)",
          "new_text": null,
          "old_line_content": "\t\tfurther_away += (further_away - further_away_opposite) * Vector2(1.221313, 1.512312);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 367,
          "old_api": "segment_intersects_segment",
          "new_api": null,
          "old_text": "segment_intersects_segment(v1, v2, p_point, further_away, &res)",
          "new_text": null,
          "old_line_content": "\t\t\tif (segment_intersects_segment(v1, v2, p_point, further_away, &res)) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 380,
          "old_api": "size",
          "new_api": null,
          "old_text": "p_polygon.size()",
          "new_text": null,
          "old_line_content": "\t\tint c = p_polygon.size();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 381,
          "old_api": "ptr",
          "new_api": null,
          "old_text": "p_polygon.ptr()",
          "new_text": null,
          "old_line_content": "\t\tconst Vector2 *p = p_polygon.ptr();",
          "new_line_content": "\tstatic bool is_segment_intersecting_polygon(const Vector2 &p_from, const Vector2 &p_to, const Vector<Vector2> &p_polygon) {",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 6,
      "total_additions": 24,
      "total_deletions": 25,
      "total_api_changes": 55
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 8,
        "api_related_lines": 55,
        "non_api_lines": 5,
        "non_api_line_numbers": [
          323,
          325,
          314,
          316,
          318
        ]
      }
    },
    "api_calls_before": 75,
    "api_calls_after": 75,
    "diff_info": {
      "added_lines": 6,
      "removed_lines": 4,
      "total_diff_lines": 37
    }
  }
}