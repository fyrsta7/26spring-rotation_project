{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/godot/modified_file/1040766725113a3a0813740fe47eb0fe674be54e",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/godot/modified_file/1040766725113a3a0813740fe47eb0fe674be54e/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/godot/modified_file/1040766725113a3a0813740fe47eb0fe674be54e/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/godot/modified_file/1040766725113a3a0813740fe47eb0fe674be54e/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 1719,
          "old_api": "Vector3",
          "new_api": "xorshift32",
          "old_text": "Vector3(0, 0, 1)",
          "new_text": "xorshift32(&local_rng_state)",
          "old_line_content": "\t\tBasis rot(Vector3(0, 0, 1), random_angle2);",
          "new_line_content": "\t\tfloat random_angle1 = (((xorshift32(&local_rng_state) % 65535) / 65535.0) * 2.0 - 1.0) * spread;",
          "content_same": false
        },
        {
          "line": 1720,
          "old_api": "xform",
          "new_api": "cos",
          "old_text": "rot.xform(axis)",
          "new_text": "cos(random_angle1)",
          "old_line_content": "\t\taxis = rot.xform(axis);",
          "new_line_content": "\t\tVector3 axis(0, sin(random_angle1), cos(random_angle1));",
          "content_same": false
        },
        {
          "line": 1722,
          "old_api": "xform",
          "new_api": "Vector3",
          "old_text": "normal_xform.xform(axis).normalized()",
          "new_text": "Vector3(0, 0, 1)",
          "old_line_content": "\t\tVector3 direction = normal_xform.xform(axis).normalized();",
          "new_line_content": "\t\tBasis rot(Vector3(0, 0, 1), random_angle2);",
          "content_same": false
        },
        {
          "line": 1782,
          "old_api": "dot",
          "new_api": "unlikely",
          "old_text": "direction.dot(aniso_normal[i])",
          "new_text": "unlikely(cell != CHILD_EMPTY)",
          "old_line_content": "\t\t\t\tfloat amount = direction.dot(aniso_normal[i]);",
          "new_line_content": "\t\tif (unlikely(cell != CHILD_EMPTY)) {",
          "content_same": false
        },
        {
          "line": 1808,
          "old_api": "resize",
          "new_api": "get_lightmap_size_hint",
          "old_text": "lightmap.resize(width * height)",
          "new_text": "mesh->get_lightmap_size_hint()",
          "old_line_content": "\tlightmap.resize(width * height);",
          "new_line_content": "\tint width = mesh->get_lightmap_size_hint().x;",
          "content_same": false
        },
        {
          "line": 1813,
          "old_api": "get_surface_count",
          "new_api": "resize",
          "old_text": "mesh->get_surface_count()",
          "new_text": "lightmap.resize(width * height)",
          "old_line_content": "\tfor (int i = 0; i < mesh->get_surface_count(); i++) {",
          "new_line_content": "\tlightmap.resize(width * height);",
          "content_same": false
        },
        {
          "line": 1825,
          "old_api": "read",
          "new_api": "size",
          "old_text": "vertices.read()",
          "new_text": "vertices.size()",
          "old_line_content": "\t\tPoolVector<Vector3>::Read vr = vertices.read();",
          "new_line_content": "\t\tERR_FAIL_COND_V(vertices.size() == 0, ERR_INVALID_PARAMETER);",
          "content_same": false
        },
        {
          "line": 1826,
          "old_api": "read",
          "new_api": "size",
          "old_text": "normals.read()",
          "new_text": "normals.size()",
          "old_line_content": "\t\tPoolVector<Vector3>::Read nr = normals.read();",
          "new_line_content": "\t\tERR_FAIL_COND_V(normals.size() == 0, ERR_INVALID_PARAMETER);",
          "content_same": false
        },
        {
          "line": 1827,
          "old_api": "read",
          "new_api": "size",
          "old_text": "uv2.read()",
          "new_text": "uv2.size()",
          "old_line_content": "\t\tPoolVector<Vector2>::Read u2r = uv2.read();",
          "new_line_content": "\t\tERR_FAIL_COND_V(uv2.size() == 0, ERR_INVALID_PARAMETER);",
          "content_same": false
        },
        {
          "line": 1831,
          "old_api": "size",
          "new_api": "read",
          "old_text": "indices.size()",
          "new_text": "normals.read()",
          "old_line_content": "\t\tif (indices.size()) {",
          "new_line_content": "\t\tPoolVector<Vector3>::Read nr = normals.read();",
          "content_same": false
        },
        {
          "line": 1832,
          "old_api": "size",
          "new_api": "read",
          "old_text": "indices.size()",
          "new_text": "uv2.read()",
          "old_line_content": "\t\t\tic = indices.size();",
          "new_line_content": "\t\tPoolVector<Vector2>::Read u2r = uv2.read();",
          "content_same": false
        },
        {
          "line": 1849,
          "old_api": "ptrw",
          "new_api": "xform",
          "old_text": "lightmap.ptrw()",
          "new_text": "xform.xform(vr[idx])",
          "old_line_content": "\t\t\t_plot_triangle(uv, vertex, normal, lightmap.ptrw(), width, height);",
          "new_line_content": "\t\t\t\tvertex[j] = xform.xform(vr[idx]);",
          "content_same": false
        },
        {
          "line": 1860,
          "old_api": "get_ticks_usec",
          "new_api": "ptrw",
          "old_text": "OS::get_singleton()->get_ticks_usec()",
          "new_text": "lightmap.ptrw()",
          "old_line_content": "\t\tsrand(OS::get_singleton()->get_ticks_usec());",
          "new_line_content": "\t\tLightMap *lightmap_ptr = lightmap.ptrw();",
          "content_same": false
        },
        {
          "line": 1913,
          "old_api": "p_bake_time_func",
          "new_api": "MAX",
          "old_text": "p_bake_time_func(p_bake_time_ud, remaining, lines / float(height))",
          "new_text": "MAX(lines, i)",
          "old_line_content": "\t\t\t\tif (p_bake_time_func(p_bake_time_ud, remaining, lines / float(height))) {",
          "new_line_content": "\t\t\tlines = MAX(lines, i); //for multithread",
          "content_same": false
        },
        {
          "line": 2032,
          "old_api": "dot",
          "new_api": "_find_cell_at_pos",
          "old_text": "pixel->normal.dot(aniso_normal[l])",
          "new_text": "_find_cell_at_pos(cells, ofs_x, ofs_y, ofs_z)",
          "old_line_content": "\t\t\t\t\t\t\tfloat s = pixel->normal.dot(aniso_normal[l]);",
          "new_line_content": "\t\t\t\t\t\tuint32_t cell = _find_cell_at_pos(cells, ofs_x, ofs_y, ofs_z);",
          "content_same": false
        },
        {
          "line": 2117,
          "old_api": "CLAMP",
          "new_api": "size",
          "old_text": "CLAMP(lightmap_ptr[i].light.x * 255, 0, 255)",
          "new_text": "lightmap.size()",
          "old_line_content": "\t\t\t\t\tw[i * 3 + 0] = CLAMP(lightmap_ptr[i].light.x * 255, 0, 255);",
          "new_line_content": "\t\t\tint ls = lightmap.size();",
          "content_same": false
        },
        {
          "line": 2118,
          "old_api": "CLAMP",
          "new_api": "resize",
          "old_text": "CLAMP(lightmap_ptr[i].light.y * 255, 0, 255)",
          "new_text": "img.resize(ls * 3)",
          "old_line_content": "\t\t\t\t\tw[i * 3 + 1] = CLAMP(lightmap_ptr[i].light.y * 255, 0, 255);",
          "new_line_content": "\t\t\timg.resize(ls * 3);",
          "content_same": false
        },
        {
          "line": 2135,
          "old_api": "get_instance_id",
          "new_api": "instance",
          "old_text": "p_mesh->get_instance_id()",
          "new_text": "image.instance()",
          "old_line_content": "\t\t\t\tname = \"Mesh\" + itos(p_mesh->get_instance_id());",
          "new_line_content": "\t\t\timage.instance();",
          "content_same": false
        },
        {
          "line": 2154,
          "old_api": "get_longest_axis_index",
          "new_api": "resize",
          "old_text": "po2_bounds.get_longest_axis_index()",
          "new_text": "bake_cells.resize(1)",
          "old_line_content": "\tint longest_axis = po2_bounds.get_longest_axis_index();",
          "new_line_content": "\tbake_cells.resize(1);",
          "content_same": false
        },
        {
          "line": 2202,
          "old_api": "ptr",
          "new_api": "size",
          "old_text": "w.ptr()",
          "new_text": "bake_cells.size()",
          "old_line_content": "\t\tuint32_t *w32 = (uint32_t *)w.ptr();",
          "new_line_content": "\tdata.resize(16 + (8 + 1 + 1 + 1 + 1) * bake_cells.size()); //4 for header, rest for rest.",
          "content_same": false
        },
        {
          "line": 2237,
          "old_api": "CLAMP",
          "new_api": "normalize",
          "old_text": "CLAMP(e[1] * 255, 0, 255)",
          "new_text": "e.normalize()",
          "old_line_content": "\t\t\t\tem |= uint32_t(CLAMP(e[1] * 255, 0, 255)) << 16;",
          "new_line_content": "\t\t\t\t\te.normalize();",
          "content_same": false
        },
        {
          "line": 2253,
          "old_api": "CLAMP",
          "new_api": "Vector3",
          "old_text": "CLAMP(n.z * 255.0, 0, 255)",
          "new_text": "Vector3(0.5, 0.5, 0.5)",
          "old_line_content": "\t\t\t\tnorm |= uint32_t(CLAMP(n.z * 255.0, 0, 255)) << 0;",
          "new_line_content": "\t\t\t\tn = n * Vector3(0.5, 0.5, 0.5) + Vector3(0.5, 0.5, 0.5);",
          "content_same": false
        },
        {
          "line": 2330,
          "old_api": "itos",
          "new_api": "size",
          "old_text": "itos(leaf_voxel_count)",
          "new_text": "bake_light.size()",
          "old_line_content": "\tprint_line(\"leaf voxels: \" + itos(leaf_voxel_count));",
          "new_line_content": "\tERR_FAIL_COND_V(p_mode == DEBUG_LIGHT && bake_light.size() == 0, mm);",
          "content_same": false
        },
        {
          "line": 2331,
          "old_api": "set_instance_count",
          "new_api": "instance",
          "old_text": "mm->set_instance_count(leaf_voxel_count)",
          "new_text": "mm.instance()",
          "old_line_content": "\tmm->set_instance_count(leaf_voxel_count);",
          "new_line_content": "\tmm.instance();",
          "content_same": false
        },
        {
          "line": 2334,
          "old_api": "instance",
          "new_api": "set_color_format",
          "old_text": "mesh.instance()",
          "new_text": "mm->set_color_format(MultiMesh::COLOR_8BIT)",
          "old_line_content": "\tmesh.instance();",
          "new_line_content": "\tmm->set_color_format(MultiMesh::COLOR_8BIT);",
          "content_same": false
        },
        {
          "line": 2382,
          "old_api": "add_surface_from_arrays",
          "new_api": "ADD_VTX",
          "old_text": "mesh->add_surface_from_arrays(Mesh::PRIMITIVE_TRIANGLES, arr)",
          "new_text": "ADD_VTX(0)",
          "old_line_content": "\t\tmesh->add_surface_from_arrays(Mesh::PRIMITIVE_TRIANGLES, arr);",
          "new_line_content": "\t\t\tADD_VTX(0);",
          "content_same": false
        },
        {
          "line": 2387,
          "old_api": "instance",
          "new_api": "add_surface_from_arrays",
          "old_text": "fsm.instance()",
          "new_text": "mesh->add_surface_from_arrays(Mesh::PRIMITIVE_TRIANGLES, arr)",
          "old_line_content": "\t\tfsm.instance();",
          "new_line_content": "\t\tmesh->add_surface_from_arrays(Mesh::PRIMITIVE_TRIANGLES, arr);",
          "content_same": false
        },
        {
          "line": 2393,
          "old_api": "surface_set_material",
          "new_api": "set_flag",
          "old_text": "mesh->surface_set_material(0, fsm)",
          "new_text": "fsm->set_flag(SpatialMaterial::FLAG_SRGB_VERTEX_COLOR, true)",
          "old_line_content": "\t\tmesh->surface_set_material(0, fsm);",
          "new_line_content": "\t\tfsm->set_flag(SpatialMaterial::FLAG_SRGB_VERTEX_COLOR, true);",
          "content_same": false
        },
        {
          "line": 2396,
          "old_api": "set_mesh",
          "new_api": "Color",
          "old_text": "mm->set_mesh(mesh)",
          "new_text": "Color(1, 1, 1, 1)",
          "old_line_content": "\tmm->set_mesh(mesh);",
          "new_line_content": "\t\tfsm->set_albedo(Color(1, 1, 1, 1));",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 2061,
          "old_api": null,
          "new_api": "Vector3",
          "old_text": null,
          "new_text": "Vector3()",
          "old_line_content": "",
          "new_line_content": "\t\t\t\t\tif (lightmap_ptr[i * width + j].normal != Vector3()) {",
          "content_same": false
        },
        {
          "line": 2080,
          "old_api": null,
          "new_api": "Vector3",
          "old_text": null,
          "new_text": "Vector3()",
          "old_line_content": "\t\t\t\t\t\t\t\tcontinue;",
          "new_line_content": "\t\t\t\t\t\t\tif (lightmap_ptr[y * width + x].normal == Vector3())",
          "content_same": false
        },
        {
          "line": 2083,
          "old_api": null,
          "new_api": "length",
          "old_text": null,
          "new_text": "Vector2(i - y, j - x).length()",
          "old_line_content": "\t\t\t\t\t\t\tclosest_i = y;",
          "new_line_content": "\t\t\t\t\t\t\tfloat dist = Vector2(i - y, j - x).length();",
          "content_same": false
        },
        {
          "line": 2104,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "lightmap.size()",
          "old_line_content": "\t\t\t\tw[i * 3 + 2] = lightmap[i].light.z;",
          "new_line_content": "\t\t\tr_lightmap.light.resize(lightmap.size() * 3);",
          "content_same": false
        },
        {
          "line": 2105,
          "old_api": null,
          "new_api": "write",
          "old_text": null,
          "new_text": "r_lightmap.light.write()",
          "old_line_content": "\t\t\t}",
          "new_line_content": "\t\t\tPoolVector<float>::Write w = r_lightmap.light.write();",
          "content_same": false
        },
        {
          "line": 2106,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "lightmap.size()",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\t\tfor (int i = 0; i < lightmap.size(); i++) {",
          "content_same": false
        },
        {
          "line": 2120,
          "old_api": null,
          "new_api": "write",
          "old_text": null,
          "new_text": "img.write()",
          "old_line_content": "\t\t\t\t\t//w[i * 3 + 0] = CLAMP(lightmap_ptr[i].normal.x * 255, 0, 255);",
          "new_line_content": "\t\t\t\tPoolVector<uint8_t>::Write w = img.write();",
          "content_same": false
        },
        {
          "line": 2122,
          "old_api": null,
          "new_api": "CLAMP",
          "old_text": null,
          "new_text": "CLAMP(lightmap_ptr[i].light.x * 255, 0, 255)",
          "old_line_content": "\t\t\t\t\t//w[i * 3 + 2] = CLAMP(lightmap_ptr[i].normal.z * 255, 0, 255);",
          "new_line_content": "\t\t\t\t\tw[i * 3 + 0] = CLAMP(lightmap_ptr[i].light.x * 255, 0, 255);",
          "content_same": false
        },
        {
          "line": 2123,
          "old_api": null,
          "new_api": "CLAMP",
          "old_text": null,
          "new_text": "CLAMP(lightmap_ptr[i].light.y * 255, 0, 255)",
          "old_line_content": "\t\t\t\t\t//w[i * 3 + 0] = CLAMP(lightmap_ptr[i].pos.x / (1 << (cell_subdiv - 1)) * 255, 0, 255);",
          "new_line_content": "\t\t\t\t\tw[i * 3 + 1] = CLAMP(lightmap_ptr[i].light.y * 255, 0, 255);",
          "content_same": false
        },
        {
          "line": 2124,
          "old_api": null,
          "new_api": "CLAMP",
          "old_text": null,
          "new_text": "CLAMP(lightmap_ptr[i].light.z * 255, 0, 255)",
          "old_line_content": "\t\t\t\t\t//w[i * 3 + 1] = CLAMP(lightmap_ptr[i].pos.y / (1 << (cell_subdiv - 1)) * 255, 0, 255);",
          "new_line_content": "\t\t\t\t\tw[i * 3 + 2] = CLAMP(lightmap_ptr[i].light.z * 255, 0, 255);",
          "content_same": false
        },
        {
          "line": 2136,
          "old_api": null,
          "new_api": "create",
          "old_text": null,
          "new_text": "image->create(width, height, false, Image::FORMAT_RGB8, img)",
          "old_line_content": "\t\t\t}",
          "new_line_content": "\t\t\timage->create(width, height, false, Image::FORMAT_RGB8, img);",
          "content_same": false
        },
        {
          "line": 2138,
          "old_api": null,
          "new_api": "get_name",
          "old_text": null,
          "new_text": "p_mesh->get_name()",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\t\tString name = p_mesh->get_name();",
          "content_same": false
        },
        {
          "line": 2140,
          "old_api": null,
          "new_api": "get_instance_id",
          "old_text": null,
          "new_text": "p_mesh->get_instance_id()",
          "old_line_content": "\t}",
          "new_line_content": "\t\t\t\tname = \"Mesh\" + itos(p_mesh->get_instance_id());",
          "content_same": false
        },
        {
          "line": 2142,
          "old_api": null,
          "new_api": "save_png",
          "old_text": null,
          "new_text": "image->save_png(name + \".png\")",
          "old_line_content": "\treturn OK;",
          "new_line_content": "\t\t\timage->save_png(name + \".png\");",
          "content_same": false
        },
        {
          "line": 2155,
          "old_api": null,
          "new_api": "clear",
          "old_text": null,
          "new_text": "material_cache.clear()",
          "old_line_content": "\taxis_cell_size[longest_axis] = (1 << (cell_subdiv - 1));",
          "new_line_content": "\tmaterial_cache.clear();",
          "content_same": false
        },
        {
          "line": 2159,
          "old_api": null,
          "new_api": "get_longest_axis_index",
          "old_text": null,
          "new_text": "po2_bounds.get_longest_axis_index()",
          "old_line_content": "",
          "new_line_content": "\tint longest_axis = po2_bounds.get_longest_axis_index();",
          "content_same": false
        },
        {
          "line": 2181,
          "old_api": null,
          "new_api": "Vector3",
          "old_text": null,
          "new_text": "Vector3(po2_bounds.size[longest_axis], po2_bounds.size[longest_axis], po2_bounds.size[longest_axis])",
          "old_line_content": "",
          "new_line_content": "\tto_bounds.basis.scale(Vector3(po2_bounds.size[longest_axis], po2_bounds.size[longest_axis], po2_bounds.size[longest_axis]));",
          "content_same": false
        },
        {
          "line": 2185,
          "old_api": null,
          "new_api": "Vector3",
          "old_text": null,
          "new_text": "Vector3(axis_cell_size[longest_axis], axis_cell_size[longest_axis], axis_cell_size[longest_axis])",
          "old_line_content": "}",
          "new_line_content": "\tto_grid.basis.scale(Vector3(axis_cell_size[longest_axis], axis_cell_size[longest_axis], axis_cell_size[longest_axis]));",
          "content_same": false
        },
        {
          "line": 2187,
          "old_api": null,
          "new_api": "affine_inverse",
          "old_text": null,
          "new_text": "to_bounds.affine_inverse()",
          "old_line_content": "void VoxelLightBaker::end_bake() {",
          "new_line_content": "\tto_cell_space = to_grid * to_bounds.affine_inverse();",
          "content_same": false
        },
        {
          "line": 2193,
          "old_api": null,
          "new_api": "_fixup_plot",
          "old_text": null,
          "new_text": "_fixup_plot(0, 0)",
          "old_line_content": "PoolVector<int> VoxelLightBaker::create_gi_probe_data() {",
          "new_line_content": "\t_fixup_plot(0, 0);",
          "content_same": false
        },
        {
          "line": 2205,
          "old_api": null,
          "new_api": "write",
          "old_text": null,
          "new_text": "data.write()",
          "old_line_content": "\t\tw32[1] = cell_subdiv; //subdiv",
          "new_line_content": "\t\tPoolVector<int>::Write w = data.write();",
          "content_same": false
        },
        {
          "line": 2207,
          "old_api": null,
          "new_api": "ptr",
          "old_text": null,
          "new_text": "w.ptr()",
          "old_line_content": "\t\tw32[3] = axis_cell_size[1];",
          "new_line_content": "\t\tuint32_t *w32 = (uint32_t *)w.ptr();",
          "content_same": false
        },
        {
          "line": 2219,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "bake_cells.size()",
          "old_line_content": "",
          "new_line_content": "\t\tfor (int i = 0; i < bake_cells.size(); i++) {",
          "content_same": false
        },
        {
          "line": 2226,
          "old_api": null,
          "new_api": "CLAMP",
          "old_text": null,
          "new_text": "CLAMP(bake_cells[i].albedo[0] * 255.0, 0, 255)",
          "old_line_content": "\t\t\t}",
          "new_line_content": "\t\t\t\tuint32_t rgba = uint32_t(CLAMP(bake_cells[i].albedo[0] * 255.0, 0, 255)) << 16;",
          "content_same": false
        },
        {
          "line": 2227,
          "old_api": null,
          "new_api": "CLAMP",
          "old_text": null,
          "new_text": "CLAMP(bake_cells[i].albedo[1] * 255.0, 0, 255)",
          "old_line_content": "\t\t\t{ //emission",
          "new_line_content": "\t\t\t\trgba |= uint32_t(CLAMP(bake_cells[i].albedo[1] * 255.0, 0, 255)) << 8;",
          "content_same": false
        },
        {
          "line": 2228,
          "old_api": null,
          "new_api": "CLAMP",
          "old_text": null,
          "new_text": "CLAMP(bake_cells[i].albedo[2] * 255.0, 0, 255)",
          "old_line_content": "",
          "new_line_content": "\t\t\t\trgba |= uint32_t(CLAMP(bake_cells[i].albedo[2] * 255.0, 0, 255)) << 0;",
          "content_same": false
        },
        {
          "line": 1721,
          "old_api": null,
          "new_api": "xorshift32",
          "old_text": null,
          "new_text": "xorshift32(&local_rng_state)",
          "old_line_content": "",
          "new_line_content": "\t\tfloat random_angle2 = ((xorshift32(&local_rng_state) % 65535) / 65535.0) * Math_PI * 2.0;",
          "content_same": false
        },
        {
          "line": 2235,
          "old_api": null,
          "new_api": "length",
          "old_text": null,
          "new_text": "e.length()",
          "old_line_content": "",
          "new_line_content": "\t\t\t\tfloat l = e.length();",
          "content_same": false
        },
        {
          "line": 1723,
          "old_api": null,
          "new_api": "xform",
          "old_text": null,
          "new_text": "rot.xform(axis)",
          "old_line_content": "",
          "new_line_content": "\t\taxis = rot.xform(axis);",
          "content_same": false
        },
        {
          "line": 1725,
          "old_api": null,
          "new_api": "xform",
          "old_text": null,
          "new_text": "normal_xform.xform(axis).normalized()",
          "old_line_content": "",
          "new_line_content": "\t\tVector3 direction = normal_xform.xform(axis).normalized();",
          "content_same": false
        },
        {
          "line": 1727,
          "old_api": null,
          "new_api": "_get_normal_advance",
          "old_text": null,
          "new_text": "_get_normal_advance(direction)",
          "old_line_content": "",
          "new_line_content": "\t\tVector3 advance = direction * _get_normal_advance(direction);",
          "content_same": false
        },
        {
          "line": 2241,
          "old_api": null,
          "new_api": "CLAMP",
          "old_text": null,
          "new_text": "CLAMP(e[0] * 255, 0, 255)",
          "old_line_content": "\t\t\t\tw32[ofs++] = em;",
          "new_line_content": "\t\t\t\tuint32_t em = uint32_t(CLAMP(e[0] * 255, 0, 255)) << 24;",
          "content_same": false
        },
        {
          "line": 2242,
          "old_api": null,
          "new_api": "CLAMP",
          "old_text": null,
          "new_text": "CLAMP(e[1] * 255, 0, 255)",
          "old_line_content": "\t\t\t}",
          "new_line_content": "\t\t\t\tem |= uint32_t(CLAMP(e[1] * 255, 0, 255)) << 16;",
          "content_same": false
        },
        {
          "line": 2243,
          "old_api": null,
          "new_api": "CLAMP",
          "old_text": null,
          "new_text": "CLAMP(e[2] * 255, 0, 255)",
          "old_line_content": "",
          "new_line_content": "\t\t\t\tem |= uint32_t(CLAMP(e[2] * 255, 0, 255)) << 8;",
          "content_same": false
        },
        {
          "line": 2244,
          "old_api": null,
          "new_api": "CLAMP",
          "old_text": null,
          "new_text": "CLAMP(l * 255, 0, 255)",
          "old_line_content": "\t\t\t//w32[ofs++]=bake_cells[i].used_sides;",
          "new_line_content": "\t\t\t\tem |= uint32_t(CLAMP(l * 255, 0, 255));",
          "content_same": false
        },
        {
          "line": 2256,
          "old_api": null,
          "new_api": "CLAMP",
          "old_text": null,
          "new_text": "CLAMP(n.x * 255.0, 0, 255)",
          "old_line_content": "\t\t\t}",
          "new_line_content": "\t\t\t\tnorm |= uint32_t(CLAMP(n.x * 255.0, 0, 255)) << 16;",
          "content_same": false
        },
        {
          "line": 2257,
          "old_api": null,
          "new_api": "CLAMP",
          "old_text": null,
          "new_text": "CLAMP(n.y * 255.0, 0, 255)",
          "old_line_content": "",
          "new_line_content": "\t\t\t\tnorm |= uint32_t(CLAMP(n.y * 255.0, 0, 255)) << 8;",
          "content_same": false
        },
        {
          "line": 2258,
          "old_api": null,
          "new_api": "CLAMP",
          "old_text": null,
          "new_text": "CLAMP(n.z * 255.0, 0, 255)",
          "old_line_content": "\t\t\t{",
          "new_line_content": "\t\t\t\tnorm |= uint32_t(CLAMP(n.z * 255.0, 0, 255)) << 0;",
          "content_same": false
        },
        {
          "line": 2264,
          "old_api": null,
          "new_api": "CLAMP",
          "old_text": null,
          "new_text": "CLAMP(uint32_t(bake_cells[i].alpha * 65535.0), 0, 65535)",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\t\t\tuint16_t alpha = CLAMP(uint32_t(bake_cells[i].alpha * 65535.0), 0, 65535);",
          "content_same": false
        },
        {
          "line": 2282,
          "old_api": null,
          "new_api": "scale",
          "old_text": null,
          "new_text": "xform.basis.scale(p_aabb.size * 0.5)",
          "old_line_content": "\t\t} else if (p_mode == DEBUG_LIGHT) {",
          "new_line_content": "\t\txform.basis.scale(p_aabb.size * 0.5);",
          "content_same": false
        },
        {
          "line": 2283,
          "old_api": null,
          "new_api": "set_instance_transform",
          "old_text": null,
          "new_text": "p_multimesh->set_instance_transform(idx, xform)",
          "old_line_content": "\t\t\tfor (int i = 0; i < 6; i++) {",
          "new_line_content": "\t\tp_multimesh->set_instance_transform(idx, xform);",
          "content_same": false
        },
        {
          "line": 1773,
          "old_api": null,
          "new_api": "unlikely",
          "old_text": null,
          "new_text": "unlikely(cell == CHILD_EMPTY)",
          "old_line_content": "\t\t\t\thalf >>= 1;",
          "new_line_content": "\t\t\t\tif (unlikely(cell == CHILD_EMPTY))",
          "content_same": false
        },
        {
          "line": 2286,
          "old_api": null,
          "new_api": "Color",
          "old_text": null,
          "new_text": "Color(bake_cells[p_idx].albedo[0], bake_cells[p_idx].albedo[1], bake_cells[p_idx].albedo[2])",
          "old_line_content": "\t\t\t\tcol.b += bake_light[p_idx].accum[i][2];",
          "new_line_content": "\t\t\tcol = Color(bake_cells[p_idx].albedo[0], bake_cells[p_idx].albedo[1], bake_cells[p_idx].albedo[2]);",
          "content_same": false
        },
        {
          "line": 1785,
          "old_api": null,
          "new_api": "dot",
          "old_text": null,
          "new_text": "direction.dot(aniso_normal[i])",
          "old_line_content": "\t\t\t\taccum.x += light[cell].accum[i][0] * amount;",
          "new_line_content": "\t\t\t\tfloat amount = direction.dot(aniso_normal[i]);",
          "content_same": false
        },
        {
          "line": 2298,
          "old_api": null,
          "new_api": "set_instance_color",
          "old_text": null,
          "new_text": "p_multimesh->set_instance_color(idx, col)",
          "old_line_content": "",
          "new_line_content": "\t\tp_multimesh->set_instance_color(idx, col);",
          "content_same": false
        },
        {
          "line": 2321,
          "old_api": null,
          "new_api": "_debug_mesh",
          "old_text": null,
          "new_text": "_debug_mesh(bake_cells[p_idx].childs[i], p_level + 1, aabb, p_multimesh, idx, p_mode)",
          "old_line_content": "Ref<MultiMesh> VoxelLightBaker::create_debug_multimesh(DebugMode p_mode) {",
          "new_line_content": "\t\t\t_debug_mesh(bake_cells[p_idx].childs[i], p_level + 1, aabb, p_multimesh, idx, p_mode);",
          "content_same": false
        },
        {
          "line": 1809,
          "old_api": null,
          "new_api": "get_lightmap_size_hint",
          "old_text": null,
          "new_text": "mesh->get_lightmap_size_hint()",
          "old_line_content": "",
          "new_line_content": "\tint height = mesh->get_lightmap_size_hint().y;",
          "content_same": false
        },
        {
          "line": 1818,
          "old_api": null,
          "new_api": "get_surface_count",
          "old_text": null,
          "new_text": "mesh->get_surface_count()",
          "old_line_content": "\t\tPoolVector<int> indices = arrays[Mesh::ARRAY_INDEX];",
          "new_line_content": "\tfor (int i = 0; i < mesh->get_surface_count(); i++) {",
          "content_same": false
        },
        {
          "line": 1819,
          "old_api": null,
          "new_api": "surface_get_arrays",
          "old_text": null,
          "new_text": "mesh->surface_get_arrays(i)",
          "old_line_content": "",
          "new_line_content": "\t\tArray arrays = mesh->surface_get_arrays(i);",
          "content_same": false
        },
        {
          "line": 2333,
          "old_api": null,
          "new_api": "set_transform_format",
          "old_text": null,
          "new_text": "mm->set_transform_format(MultiMesh::TRANSFORM_3D)",
          "old_line_content": "\tRef<ArrayMesh> mesh;",
          "new_line_content": "\tmm->set_transform_format(MultiMesh::TRANSFORM_3D);",
          "content_same": false
        },
        {
          "line": 2335,
          "old_api": null,
          "new_api": "itos",
          "old_text": null,
          "new_text": "itos(leaf_voxel_count)",
          "old_line_content": "",
          "new_line_content": "\tprint_line(\"leaf voxels: \" + itos(leaf_voxel_count));",
          "content_same": false
        },
        {
          "line": 2336,
          "old_api": null,
          "new_api": "set_instance_count",
          "old_text": null,
          "new_text": "mm->set_instance_count(leaf_voxel_count)",
          "old_line_content": "\t{",
          "new_line_content": "\tmm->set_instance_count(leaf_voxel_count);",
          "content_same": false
        },
        {
          "line": 2339,
          "old_api": null,
          "new_api": "instance",
          "old_text": null,
          "new_text": "mesh.instance()",
          "old_line_content": "",
          "new_line_content": "\tmesh.instance();",
          "content_same": false
        },
        {
          "line": 1829,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "vertices.size()",
          "old_line_content": "\t\tint ic = 0;",
          "new_line_content": "\t\tint vc = vertices.size();",
          "content_same": false
        },
        {
          "line": 1830,
          "old_api": null,
          "new_api": "read",
          "old_text": null,
          "new_text": "vertices.read()",
          "old_line_content": "",
          "new_line_content": "\t\tPoolVector<Vector3>::Read vr = vertices.read();",
          "content_same": false
        },
        {
          "line": 2343,
          "old_api": null,
          "new_api": "resize",
          "old_text": null,
          "new_text": "arr.resize(Mesh::ARRAY_MAX)",
          "old_line_content": "\t\tint vtx_idx = 0;",
          "new_line_content": "\t\tarr.resize(Mesh::ARRAY_MAX);",
          "content_same": false
        },
        {
          "line": 1836,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "indices.size()",
          "old_line_content": "\t\tint faces = ic ? ic / 3 : vc / 3;",
          "new_line_content": "\t\tif (indices.size()) {",
          "content_same": false
        },
        {
          "line": 1837,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "indices.size()",
          "old_line_content": "\t\tfor (int i = 0; i < faces; i++) {",
          "new_line_content": "\t\t\tic = indices.size();",
          "content_same": false
        },
        {
          "line": 1838,
          "old_api": null,
          "new_api": "read",
          "old_text": null,
          "new_text": "indices.read()",
          "old_line_content": "\t\t\tVector3 vertex[3];",
          "new_line_content": "\t\t\tir = indices.read();",
          "content_same": false
        },
        {
          "line": 1850,
          "old_api": null,
          "new_api": "xform",
          "old_text": null,
          "new_text": "xform.basis.xform(nr[idx]).normalized()",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\t\t\tnormal[j] = xform.basis.xform(nr[idx]).normalized();",
          "content_same": false
        },
        {
          "line": 1854,
          "old_api": null,
          "new_api": "ptrw",
          "old_text": null,
          "new_text": "lightmap.ptrw()",
          "old_line_content": "\t{",
          "new_line_content": "\t\t\t_plot_triangle(uv, vertex, normal, lightmap.ptrw(), width, height);",
          "content_same": false
        },
        {
          "line": 1861,
          "old_api": null,
          "new_api": "get_ticks_usec",
          "old_text": null,
          "new_text": "OS::get_singleton()->get_ticks_usec()",
          "old_line_content": "",
          "new_line_content": "\t\tuint64_t begin_time = OS::get_singleton()->get_ticks_usec();",
          "content_same": false
        },
        {
          "line": 1865,
          "old_api": null,
          "new_api": "get_ticks_usec",
          "old_text": null,
          "new_text": "OS::get_singleton()->get_ticks_usec()",
          "old_line_content": "#ifdef _OPENMP",
          "new_line_content": "\t\tsrand(OS::get_singleton()->get_ticks_usec());",
          "content_same": false
        },
        {
          "line": 2378,
          "old_api": null,
          "new_api": "ADD_VTX",
          "old_text": null,
          "new_text": "ADD_VTX(2)",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\t\tADD_VTX(2);",
          "content_same": false
        },
        {
          "line": 2380,
          "old_api": null,
          "new_api": "ADD_VTX",
          "old_text": null,
          "new_text": "ADD_VTX(2)",
          "old_line_content": "\t\tarr[Mesh::ARRAY_VERTEX] = vertices;",
          "new_line_content": "\t\t\tADD_VTX(2);",
          "content_same": false
        },
        {
          "line": 2381,
          "old_api": null,
          "new_api": "ADD_VTX",
          "old_text": null,
          "new_text": "ADD_VTX(3)",
          "old_line_content": "\t\tarr[Mesh::ARRAY_COLOR] = colors;",
          "new_line_content": "\t\t\tADD_VTX(3);",
          "content_same": false
        },
        {
          "line": 1871,
          "old_api": null,
          "new_api": "omp_get_max_threads",
          "old_text": null,
          "new_text": "omp_get_max_threads()",
          "old_line_content": "\t\t\tdo {",
          "new_line_content": "\t\tthreadcount = omp_get_max_threads();",
          "content_same": false
        },
        {
          "line": 1874,
          "old_api": null,
          "new_api": "resize",
          "old_text": null,
          "new_text": "rng_states.resize(threadcount)",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\trng_states.resize(threadcount);",
          "content_same": false
        },
        {
          "line": 1877,
          "old_api": null,
          "new_api": "rand",
          "old_text": null,
          "new_text": "rand()",
          "old_line_content": "\t\tfor (int i = 0; i < height; i++) {",
          "new_line_content": "\t\t\t\trng_states[i] = rand();",
          "content_same": false
        },
        {
          "line": 2392,
          "old_api": null,
          "new_api": "instance",
          "old_text": null,
          "new_text": "fsm.instance()",
          "old_line_content": "",
          "new_line_content": "\t\tfsm.instance();",
          "content_same": false
        },
        {
          "line": 1880,
          "old_api": null,
          "new_api": "ptrw",
          "old_text": null,
          "new_text": "rng_states.ptrw()",
          "old_line_content": "#ifdef _OPENMP",
          "new_line_content": "\t\tuint32_t *rng_states_p = rng_states.ptrw();",
          "content_same": false
        },
        {
          "line": 2394,
          "old_api": null,
          "new_api": "set_flag",
          "old_text": null,
          "new_text": "fsm->set_flag(SpatialMaterial::FLAG_ALBEDO_FROM_VERTEX_COLOR, true)",
          "old_line_content": "\t}",
          "new_line_content": "\t\tfsm->set_flag(SpatialMaterial::FLAG_ALBEDO_FROM_VERTEX_COLOR, true);",
          "content_same": false
        },
        {
          "line": 2395,
          "old_api": null,
          "new_api": "set_flag",
          "old_text": null,
          "new_text": "fsm->set_flag(SpatialMaterial::FLAG_UNSHADED, true)",
          "old_line_content": "",
          "new_line_content": "\t\tfsm->set_flag(SpatialMaterial::FLAG_UNSHADED, true);",
          "content_same": false
        },
        {
          "line": 2398,
          "old_api": null,
          "new_api": "surface_set_material",
          "old_text": null,
          "new_text": "mesh->surface_set_material(0, fsm)",
          "old_line_content": "\tint idx = 0;",
          "new_line_content": "\t\tmesh->surface_set_material(0, fsm);",
          "content_same": false
        },
        {
          "line": 2401,
          "old_api": null,
          "new_api": "set_mesh",
          "old_text": null,
          "new_text": "mm->set_mesh(mesh)",
          "old_line_content": "\treturn mm;",
          "new_line_content": "\tmm->set_mesh(mesh);",
          "content_same": false
        },
        {
          "line": 1891,
          "old_api": null,
          "new_api": "omp_get_thread_num",
          "old_text": null,
          "new_text": "omp_get_thread_num()",
          "old_line_content": "\t\t\t\tLightMap *pixel = &lightmap_ptr[i * width + j];",
          "new_line_content": "\t\t\t\tthreadnum = omp_get_thread_num();",
          "content_same": false
        },
        {
          "line": 2404,
          "old_api": null,
          "new_api": "_debug_mesh",
          "old_text": null,
          "new_text": "_debug_mesh(0, 0, po2_bounds, mm, idx, p_mode)",
          "old_line_content": "struct VoxelLightBakerOctree {",
          "new_line_content": "\t_debug_mesh(0, 0, po2_bounds, mm, idx, p_mode);",
          "content_same": false
        },
        {
          "line": 1897,
          "old_api": null,
          "new_api": "Vector3",
          "old_text": null,
          "new_text": "Vector3()",
          "old_line_content": "\t\t\t\t\tcase BAKE_MODE_CONE_TRACE: {",
          "new_line_content": "\t\t\t\tif (pixel->pos == Vector3())",
          "content_same": false
        },
        {
          "line": 1903,
          "old_api": null,
          "new_api": "_compute_pixel_light_at_pos",
          "old_text": null,
          "new_text": "_compute_pixel_light_at_pos(pixel->pos, pixel->normal)",
          "old_line_content": "\t\t\t\t\t\t//\tpixel->light = Vector3(1, 1, 1);",
          "new_line_content": "\t\t\t\t\t\tpixel->light = _compute_pixel_light_at_pos(pixel->pos, pixel->normal) * energy;",
          "content_same": false
        },
        {
          "line": 1906,
          "old_api": null,
          "new_api": "_compute_ray_trace_at_pos",
          "old_text": null,
          "new_text": "_compute_ray_trace_at_pos(pixel->pos, pixel->normal, &rng_states_p[threadnum])",
          "old_line_content": "\t\t\t}",
          "new_line_content": "\t\t\t\t\t\tpixel->light = _compute_ray_trace_at_pos(pixel->pos, pixel->normal, &rng_states_p[threadnum]) * energy;",
          "content_same": false
        },
        {
          "line": 2422,
          "old_api": null,
          "new_api": "MIN",
          "old_text": null,
          "new_text": "MIN(p_subdiv, cell_subdiv)",
          "old_line_content": "\tVector<uint32_t> demap;",
          "new_line_content": "\tp_subdiv = MIN(p_subdiv, cell_subdiv); // use the smaller one",
          "content_same": false
        },
        {
          "line": 2425,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "bake_cells.size()",
          "old_line_content": "\tfor (int i = 0; i < bc; i++) {",
          "new_line_content": "\tint bc = bake_cells.size();",
          "content_same": false
        },
        {
          "line": 2426,
          "old_api": null,
          "new_api": "resize",
          "old_text": null,
          "new_text": "remap.resize(bc)",
          "old_line_content": "\t\tuint32_t c = CHILD_EMPTY;",
          "new_line_content": "\tremap.resize(bc);",
          "content_same": false
        },
        {
          "line": 1915,
          "old_api": null,
          "new_api": "get_ticks_usec",
          "old_text": null,
          "new_text": "OS::get_singleton()->get_ticks_usec()",
          "old_line_content": "\t\t\t\t}",
          "new_line_content": "\t\t\t\tuint64_t elapsed = OS::get_singleton()->get_ticks_usec() - begin_time;",
          "content_same": false
        },
        {
          "line": 1918,
          "old_api": null,
          "new_api": "p_bake_time_func",
          "old_text": null,
          "new_text": "p_bake_time_func(p_bake_time_ud, remaining, lines / float(height))",
          "old_line_content": "",
          "new_line_content": "\t\t\t\tif (p_bake_time_func(p_bake_time_ud, remaining, lines / float(height))) {",
          "content_same": false
        },
        {
          "line": 2435,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "demap.push_back(i)",
          "old_line_content": "\tVector<VoxelLightBakerOctree> octree;",
          "new_line_content": "\t\t\tdemap.push_back(i);",
          "content_same": false
        },
        {
          "line": 1926,
          "old_api": null,
          "new_api": "print_line",
          "old_text": null,
          "new_text": "print_line(\"bluring, use pos for separatable copy\")",
          "old_line_content": "\t\t\t\tfor (int j = 0; j < width; j++) {",
          "new_line_content": "\t\t\tprint_line(\"bluring, use pos for separatable copy\");",
          "content_same": false
        },
        {
          "line": 2441,
          "old_api": null,
          "new_api": "resize",
          "old_text": null,
          "new_text": "octree.resize(new_size)",
          "old_line_content": "\t\t\tfor (int k = 0; k < 3; k++) {",
          "new_line_content": "\toctree.resize(new_size);",
          "content_same": false
        },
        {
          "line": 1932,
          "old_api": null,
          "new_api": "Vector3",
          "old_text": null,
          "new_text": "Vector3()",
          "old_line_content": "\t\t\t\t\tfor (int k = 1; k < 4; k++) {",
          "new_line_content": "\t\t\t\t\tif (lightmap_ptr[i * width + j].normal == Vector3()) {",
          "content_same": false
        },
        {
          "line": 2449,
          "old_api": null,
          "new_api": "CLAMP",
          "old_text": null,
          "new_text": "CLAMP(l * 1024, 0, 65535)",
          "old_line_content": "\t\t\tuint32_t child = bake_cells[demap[i]].childs[j];",
          "new_line_content": "\t\t\t\toctree[i].light[j][k] = CLAMP(l * 1024, 0, 65535); //give two more bits to octree",
          "content_same": false
        },
        {
          "line": 1939,
          "old_api": null,
          "new_api": "Vector3",
          "old_text": null,
          "new_text": "Vector3()",
          "old_line_content": "\t\t\t\t\tfor (int k = 1; k < 4; k++) {",
          "new_line_content": "\t\t\t\t\t\tif (new_x >= width || lightmap_ptr[i * width + new_x].normal == Vector3())",
          "content_same": false
        },
        {
          "line": 1946,
          "old_api": null,
          "new_api": "Vector3",
          "old_text": null,
          "new_text": "Vector3()",
          "old_line_content": "",
          "new_line_content": "\t\t\t\t\t\tif (new_x < 0 || lightmap_ptr[i * width + new_x].normal == Vector3())",
          "content_same": false
        },
        {
          "line": 2460,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "octree.size()",
          "old_line_content": "\t}",
          "new_line_content": "\tint ret_bytes = octree.size() * sizeof(VoxelLightBakerOctree);",
          "content_same": false
        },
        {
          "line": 2461,
          "old_api": null,
          "new_api": "resize",
          "old_text": null,
          "new_text": "ret.resize(ret_bytes)",
          "old_line_content": "",
          "new_line_content": "\tret.resize(ret_bytes);",
          "content_same": false
        },
        {
          "line": 2463,
          "old_api": null,
          "new_api": "write",
          "old_text": null,
          "new_text": "ret.write()",
          "old_line_content": "}",
          "new_line_content": "\t\tPoolVector<uint8_t>::Write w = ret.write();",
          "content_same": false
        },
        {
          "line": 2464,
          "old_api": null,
          "new_api": "ptr",
          "old_text": null,
          "new_text": "octree.ptr()",
          "old_line_content": "",
          "new_line_content": "\t\tcopymem(w.ptr(), octree.ptr(), ret_bytes);",
          "content_same": false
        },
        {
          "line": 1958,
          "old_api": null,
          "new_api": "Vector3",
          "old_text": null,
          "new_text": "Vector3()",
          "old_line_content": "\t\t\t\t\t\tint new_y = i + k;",
          "new_line_content": "\t\t\t\t\tif (lightmap_ptr[i * width + j].normal == Vector3())",
          "content_same": false
        },
        {
          "line": 1964,
          "old_api": null,
          "new_api": "Vector3",
          "old_text": null,
          "new_text": "Vector3()",
          "old_line_content": "\t\t\t\t\tfor (int k = 1; k < 4; k++) {",
          "new_line_content": "\t\t\t\t\t\tif (new_y >= height || lightmap_ptr[new_y * width + j].normal == Vector3())",
          "content_same": false
        },
        {
          "line": 1971,
          "old_api": null,
          "new_api": "Vector3",
          "old_text": null,
          "new_text": "Vector3()",
          "old_line_content": "",
          "new_line_content": "\t\t\t\t\t\tif (new_y < 0 || lightmap_ptr[new_y * width + j].normal == Vector3())",
          "content_same": false
        },
        {
          "line": 1984,
          "old_api": null,
          "new_api": "ptrw",
          "old_text": null,
          "new_text": "lightmap.ptrw()",
          "old_line_content": "#endif",
          "new_line_content": "\t\t\tLightMap *lightmap_ptr = lightmap.ptrw();",
          "content_same": false
        },
        {
          "line": 1985,
          "old_api": null,
          "new_api": "ptr",
          "old_text": null,
          "new_text": "bake_cells.ptr()",
          "old_line_content": "\t\t\tfor (int i = 0; i < height; i++) {",
          "new_line_content": "\t\t\tconst Cell *cells = bake_cells.ptr();",
          "content_same": false
        },
        {
          "line": 1986,
          "old_api": null,
          "new_api": "ptr",
          "old_text": null,
          "new_text": "bake_light.ptr()",
          "old_line_content": "",
          "new_line_content": "\t\t\tconst Light *light = bake_light.ptr();",
          "content_same": false
        },
        {
          "line": 2001,
          "old_api": null,
          "new_api": "Vector3",
          "old_text": null,
          "new_text": "Vector3()",
          "old_line_content": "\t\t\t\t\tint z = int(pixel->pos.z) - 1;",
          "new_line_content": "\t\t\t\t\tif (pixel->pos == Vector3())",
          "content_same": false
        },
        {
          "line": 2037,
          "old_api": null,
          "new_api": "dot",
          "old_text": null,
          "new_text": "pixel->normal.dot(aniso_normal[l])",
          "old_line_content": "\t\t\t\t\t\t\taccum.b += light[cell].direct_accum[l][2] * s;",
          "new_line_content": "\t\t\t\t\t\t\tfloat s = pixel->normal.dot(aniso_normal[l]);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 2056,
          "old_api": "Vector3",
          "new_api": null,
          "old_text": "Vector3()",
          "new_text": null,
          "old_line_content": "\t\t\t\t\tif (lightmap_ptr[i * width + j].normal != Vector3()) {",
          "new_line_content": "\t\t{",
          "content_same": false
        },
        {
          "line": 2075,
          "old_api": "Vector3",
          "new_api": null,
          "old_text": "Vector3()",
          "new_text": null,
          "old_line_content": "\t\t\t\t\t\t\tif (lightmap_ptr[y * width + x].normal == Vector3())",
          "new_line_content": "\t\t\t\t\t\t\t\tcontinue;",
          "content_same": false
        },
        {
          "line": 2078,
          "old_api": "length",
          "new_api": null,
          "old_text": "Vector2(i - y, j - x).length()",
          "new_text": null,
          "old_line_content": "\t\t\t\t\t\t\tfloat dist = Vector2(i - y, j - x).length();",
          "new_line_content": "\t\t\t\t\t\t\tif (y < 0 || y >= height)",
          "content_same": false
        },
        {
          "line": 2099,
          "old_api": "size",
          "new_api": null,
          "old_text": "lightmap.size()",
          "new_text": null,
          "old_line_content": "\t\t\tr_lightmap.light.resize(lightmap.size() * 3);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2100,
          "old_api": "write",
          "new_api": null,
          "old_text": "r_lightmap.light.write()",
          "new_text": null,
          "old_line_content": "\t\t\tPoolVector<float>::Write w = r_lightmap.light.write();",
          "new_line_content": "\t\t{",
          "content_same": false
        },
        {
          "line": 2101,
          "old_api": "size",
          "new_api": null,
          "old_text": "lightmap.size()",
          "new_text": null,
          "old_line_content": "\t\t\tfor (int i = 0; i < lightmap.size(); i++) {",
          "new_line_content": "\t\t\t//fill the lightmap data",
          "content_same": false
        },
        {
          "line": 2112,
          "old_api": "size",
          "new_api": null,
          "old_text": "lightmap.size()",
          "new_text": null,
          "old_line_content": "\t\t\tint ls = lightmap.size();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2113,
          "old_api": "resize",
          "new_api": null,
          "old_text": "img.resize(ls * 3)",
          "new_text": null,
          "old_line_content": "\t\t\timg.resize(ls * 3);",
          "new_line_content": "// Enable for debugging",
          "content_same": false
        },
        {
          "line": 2115,
          "old_api": "write",
          "new_api": null,
          "old_text": "img.write()",
          "new_text": null,
          "old_line_content": "\t\t\t\tPoolVector<uint8_t>::Write w = img.write();",
          "new_line_content": "\t\t{",
          "content_same": false
        },
        {
          "line": 2119,
          "old_api": "CLAMP",
          "new_api": null,
          "old_text": "CLAMP(lightmap_ptr[i].light.z * 255, 0, 255)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\tw[i * 3 + 2] = CLAMP(lightmap_ptr[i].light.z * 255, 0, 255);",
          "new_line_content": "\t\t\t{",
          "content_same": false
        },
        {
          "line": 2130,
          "old_api": "instance",
          "new_api": null,
          "old_text": "image.instance()",
          "new_text": null,
          "old_line_content": "\t\t\timage.instance();",
          "new_line_content": "\t\t\t\t\t//w[i * 3 + 2] = CLAMP(lightmap_ptr[i].pos.z / (1 << (cell_subdiv - 1)) * 255, 0, 255);",
          "content_same": false
        },
        {
          "line": 2131,
          "old_api": "create",
          "new_api": null,
          "old_text": "image->create(width, height, false, Image::FORMAT_RGB8, img)",
          "new_text": null,
          "old_line_content": "\t\t\timage->create(width, height, false, Image::FORMAT_RGB8, img);",
          "new_line_content": "\t\t\t\t}",
          "content_same": false
        },
        {
          "line": 2133,
          "old_api": "get_name",
          "new_api": null,
          "old_text": "p_mesh->get_name()",
          "new_text": null,
          "old_line_content": "\t\t\tString name = p_mesh->get_name();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2137,
          "old_api": "save_png",
          "new_api": null,
          "old_text": "image->save_png(name + \".png\")",
          "new_text": null,
          "old_line_content": "\t\t\timage->save_png(name + \".png\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2149,
          "old_api": "resize",
          "new_api": null,
          "old_text": "bake_cells.resize(1)",
          "new_text": null,
          "old_line_content": "\tbake_cells.resize(1);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2150,
          "old_api": "clear",
          "new_api": null,
          "old_text": "material_cache.clear()",
          "new_text": null,
          "old_line_content": "\tmaterial_cache.clear();",
          "new_line_content": "void VoxelLightBaker::begin_bake(int p_subdiv, const AABB &p_bounds) {",
          "content_same": false
        },
        {
          "line": 2176,
          "old_api": "Vector3",
          "new_api": null,
          "old_text": "Vector3(po2_bounds.size[longest_axis], po2_bounds.size[longest_axis], po2_bounds.size[longest_axis])",
          "new_text": null,
          "old_line_content": "\tto_bounds.basis.scale(Vector3(po2_bounds.size[longest_axis], po2_bounds.size[longest_axis], po2_bounds.size[longest_axis]));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2180,
          "old_api": "Vector3",
          "new_api": null,
          "old_text": "Vector3(axis_cell_size[longest_axis], axis_cell_size[longest_axis], axis_cell_size[longest_axis])",
          "new_text": null,
          "old_line_content": "\tto_grid.basis.scale(Vector3(axis_cell_size[longest_axis], axis_cell_size[longest_axis], axis_cell_size[longest_axis]));",
          "new_line_content": "\tTransform to_bounds;",
          "content_same": false
        },
        {
          "line": 2182,
          "old_api": "affine_inverse",
          "new_api": null,
          "old_text": "to_bounds.affine_inverse()",
          "new_text": null,
          "old_line_content": "\tto_cell_space = to_grid * to_bounds.affine_inverse();",
          "new_line_content": "\tto_bounds.origin = po2_bounds.position;",
          "content_same": false
        },
        {
          "line": 2188,
          "old_api": "_fixup_plot",
          "new_api": null,
          "old_text": "_fixup_plot(0, 0)",
          "new_text": null,
          "old_line_content": "\t_fixup_plot(0, 0);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2197,
          "old_api": "size",
          "new_api": null,
          "old_text": "bake_cells.size()",
          "new_text": null,
          "old_line_content": "\tdata.resize(16 + (8 + 1 + 1 + 1 + 1) * bake_cells.size()); //4 for header, rest for rest.",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2200,
          "old_api": "write",
          "new_api": null,
          "old_text": "data.write()",
          "new_text": null,
          "old_line_content": "\t\tPoolVector<int>::Write w = data.write();",
          "new_line_content": "\tPoolVector<int> data;",
          "content_same": false
        },
        {
          "line": 2209,
          "old_api": "size",
          "new_api": null,
          "old_text": "bake_cells.size()",
          "new_text": null,
          "old_line_content": "\t\tw32[5] = bake_cells.size();",
          "new_line_content": "\t\tw32[0] = 0; //version",
          "content_same": false
        },
        {
          "line": 2221,
          "old_api": "CLAMP",
          "new_api": null,
          "old_text": "CLAMP(bake_cells[i].albedo[0] * 255.0, 0, 255)",
          "new_text": null,
          "old_line_content": "\t\t\t\tuint32_t rgba = uint32_t(CLAMP(bake_cells[i].albedo[0] * 255.0, 0, 255)) << 16;",
          "new_line_content": "\t\t\tfor (int j = 0; j < 8; j++) {",
          "content_same": false
        },
        {
          "line": 2222,
          "old_api": "CLAMP",
          "new_api": null,
          "old_text": "CLAMP(bake_cells[i].albedo[1] * 255.0, 0, 255)",
          "new_text": null,
          "old_line_content": "\t\t\t\trgba |= uint32_t(CLAMP(bake_cells[i].albedo[1] * 255.0, 0, 255)) << 8;",
          "new_line_content": "\t\t\t\tw32[ofs++] = bake_cells[i].childs[j];",
          "content_same": false
        },
        {
          "line": 2223,
          "old_api": "CLAMP",
          "new_api": null,
          "old_text": "CLAMP(bake_cells[i].albedo[2] * 255.0, 0, 255)",
          "new_text": null,
          "old_line_content": "\t\t\t\trgba |= uint32_t(CLAMP(bake_cells[i].albedo[2] * 255.0, 0, 255)) << 0;",
          "new_line_content": "\t\t\t}",
          "content_same": false
        },
        {
          "line": 1716,
          "old_api": "xorshift32",
          "new_api": null,
          "old_text": "xorshift32(rng_state)",
          "new_text": null,
          "old_line_content": "\t\tfloat random_angle1 = (((xorshift32(rng_state) % 65535) / 65535.0) * 2.0 - 1.0) * spread;",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1717,
          "old_api": "cos",
          "new_api": null,
          "old_text": "cos(random_angle1)",
          "new_text": null,
          "old_line_content": "\t\tVector3 axis(0, sin(random_angle1), cos(random_angle1));",
          "new_line_content": "\tfor (int i = 0; i < samples; i++) {",
          "content_same": false
        },
        {
          "line": 2230,
          "old_api": "length",
          "new_api": null,
          "old_text": "e.length()",
          "new_text": null,
          "old_line_content": "\t\t\t\tfloat l = e.length();",
          "new_line_content": "\t\t\t\tw32[ofs++] = rgba;",
          "content_same": false
        },
        {
          "line": 1718,
          "old_api": "xorshift32",
          "new_api": null,
          "old_text": "xorshift32(rng_state)",
          "new_text": null,
          "old_line_content": "\t\tfloat random_angle2 = ((xorshift32(rng_state) % 65535) / 65535.0) * Math_PI * 2.0;",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2232,
          "old_api": "normalize",
          "new_api": null,
          "old_text": "e.normalize()",
          "new_text": null,
          "old_line_content": "\t\t\t\t\te.normalize();",
          "new_line_content": "\t\t\t{ //emission",
          "content_same": false
        },
        {
          "line": 2233,
          "old_api": "CLAMP",
          "new_api": null,
          "old_text": "CLAMP(l / 8.0, 0, 1.0)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\tl = CLAMP(l / 8.0, 0, 1.0);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2236,
          "old_api": "CLAMP",
          "new_api": null,
          "old_text": "CLAMP(e[0] * 255, 0, 255)",
          "new_text": null,
          "old_line_content": "\t\t\t\tuint32_t em = uint32_t(CLAMP(e[0] * 255, 0, 255)) << 24;",
          "new_line_content": "\t\t\t\tif (l > 0) {",
          "content_same": false
        },
        {
          "line": 1724,
          "old_api": "_get_normal_advance",
          "new_api": null,
          "old_text": "_get_normal_advance(direction)",
          "new_text": null,
          "old_line_content": "\t\tVector3 advance = direction * _get_normal_advance(direction);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2239,
          "old_api": "CLAMP",
          "new_api": null,
          "old_text": "CLAMP(l * 255, 0, 255)",
          "new_text": null,
          "old_line_content": "\t\t\t\tem |= uint32_t(CLAMP(l * 255, 0, 255));",
          "new_line_content": "\t\t\t\t}",
          "content_same": false
        },
        {
          "line": 2248,
          "old_api": "Vector3",
          "new_api": null,
          "old_text": "Vector3(0.5, 0.5, 0.5)",
          "new_text": null,
          "old_line_content": "\t\t\t\tn = n * Vector3(0.5, 0.5, 0.5) + Vector3(0.5, 0.5, 0.5);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2251,
          "old_api": "CLAMP",
          "new_api": null,
          "old_text": "CLAMP(n.x * 255.0, 0, 255)",
          "new_text": null,
          "old_line_content": "\t\t\t\tnorm |= uint32_t(CLAMP(n.x * 255.0, 0, 255)) << 16;",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2252,
          "old_api": "CLAMP",
          "new_api": null,
          "old_text": "CLAMP(n.y * 255.0, 0, 255)",
          "new_text": null,
          "old_line_content": "\t\t\t\tnorm |= uint32_t(CLAMP(n.y * 255.0, 0, 255)) << 8;",
          "new_line_content": "\t\t\t\tVector3 n(bake_cells[i].normal[0], bake_cells[i].normal[1], bake_cells[i].normal[2]);",
          "content_same": false
        },
        {
          "line": 2259,
          "old_api": "CLAMP",
          "new_api": null,
          "old_text": "CLAMP(uint32_t(bake_cells[i].alpha * 65535.0), 0, 65535)",
          "new_text": null,
          "old_line_content": "\t\t\t\tuint16_t alpha = CLAMP(uint32_t(bake_cells[i].alpha * 65535.0), 0, 65535);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2277,
          "old_api": "scale",
          "new_api": null,
          "old_text": "xform.basis.scale(p_aabb.size * 0.5)",
          "new_text": null,
          "old_line_content": "\t\txform.basis.scale(p_aabb.size * 0.5);",
          "new_line_content": "\tif (p_level == cell_subdiv - 1) {",
          "content_same": false
        },
        {
          "line": 2278,
          "old_api": "set_instance_transform",
          "new_api": null,
          "old_text": "p_multimesh->set_instance_transform(idx, xform)",
          "new_text": null,
          "old_line_content": "\t\tp_multimesh->set_instance_transform(idx, xform);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2281,
          "old_api": "Color",
          "new_api": null,
          "old_text": "Color(bake_cells[p_idx].albedo[0], bake_cells[p_idx].albedo[1], bake_cells[p_idx].albedo[2])",
          "new_text": null,
          "old_line_content": "\t\t\tcol = Color(bake_cells[p_idx].albedo[0], bake_cells[p_idx].albedo[1], bake_cells[p_idx].albedo[2]);",
          "new_line_content": "\t\txform.origin = center;",
          "content_same": false
        },
        {
          "line": 1770,
          "old_api": "unlikely",
          "new_api": null,
          "old_text": "unlikely(cell == CHILD_EMPTY)",
          "new_text": null,
          "old_line_content": "\t\t\t\tif (unlikely(cell == CHILD_EMPTY))",
          "new_line_content": "\t\t\t\t}",
          "content_same": false
        },
        {
          "line": 1779,
          "old_api": "unlikely",
          "new_api": null,
          "old_text": "unlikely(cell != CHILD_EMPTY)",
          "new_text": null,
          "old_line_content": "\t\tif (unlikely(cell != CHILD_EMPTY)) {",
          "new_line_content": "\t\t\tpos += advance;",
          "content_same": false
        },
        {
          "line": 2293,
          "old_api": "set_instance_color",
          "new_api": null,
          "old_text": "p_multimesh->set_instance_color(idx, col)",
          "new_text": null,
          "old_line_content": "\t\tp_multimesh->set_instance_color(idx, col);",
          "new_line_content": "\t\t\t\tcol.g += bake_light[p_idx].direct_accum[i][1];",
          "content_same": false
        },
        {
          "line": 1803,
          "old_api": "get_lightmap_size_hint",
          "new_api": null,
          "old_text": "mesh->get_lightmap_size_hint()",
          "new_text": null,
          "old_line_content": "\tint width = mesh->get_lightmap_size_hint().x;",
          "new_line_content": "Error VoxelLightBaker::make_lightmap(const Transform &p_xform, Ref<Mesh> &p_mesh, LightMapData &r_lightmap, bool (*p_bake_time_func)(void *, float, float), void *p_bake_time_ud) {",
          "content_same": false
        },
        {
          "line": 2316,
          "old_api": "_debug_mesh",
          "new_api": null,
          "old_text": "_debug_mesh(bake_cells[p_idx].childs[i], p_level + 1, aabb, p_multimesh, idx, p_mode)",
          "new_text": null,
          "old_line_content": "\t\t\t_debug_mesh(bake_cells[p_idx].childs[i], p_level + 1, aabb, p_multimesh, idx, p_mode);",
          "new_line_content": "\t\t\tif (i & 2)",
          "content_same": false
        },
        {
          "line": 1804,
          "old_api": "get_lightmap_size_hint",
          "new_api": null,
          "old_text": "mesh->get_lightmap_size_hint()",
          "new_text": null,
          "old_line_content": "\tint height = mesh->get_lightmap_size_hint().y;",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2325,
          "old_api": "size",
          "new_api": null,
          "old_text": "bake_light.size()",
          "new_text": null,
          "old_line_content": "\tERR_FAIL_COND_V(p_mode == DEBUG_LIGHT && bake_light.size() == 0, mm);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2326,
          "old_api": "instance",
          "new_api": null,
          "old_text": "mm.instance()",
          "new_text": null,
          "old_line_content": "\tmm.instance();",
          "new_line_content": "Ref<MultiMesh> VoxelLightBaker::create_debug_multimesh(DebugMode p_mode) {",
          "content_same": false
        },
        {
          "line": 1814,
          "old_api": "surface_get_arrays",
          "new_api": null,
          "old_text": "mesh->surface_get_arrays(i)",
          "new_text": null,
          "old_line_content": "\t\tArray arrays = mesh->surface_get_arrays(i);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2328,
          "old_api": "set_transform_format",
          "new_api": null,
          "old_text": "mm->set_transform_format(MultiMesh::TRANSFORM_3D)",
          "new_text": null,
          "old_line_content": "\tmm->set_transform_format(MultiMesh::TRANSFORM_3D);",
          "new_line_content": "\tRef<MultiMesh> mm;",
          "content_same": false
        },
        {
          "line": 2329,
          "old_api": "set_color_format",
          "new_api": null,
          "old_text": "mm->set_color_format(MultiMesh::COLOR_8BIT)",
          "new_text": null,
          "old_line_content": "\tmm->set_color_format(MultiMesh::COLOR_8BIT);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1820,
          "old_api": "size",
          "new_api": null,
          "old_text": "vertices.size()",
          "new_text": null,
          "old_line_content": "\t\tERR_FAIL_COND_V(vertices.size() == 0, ERR_INVALID_PARAMETER);",
          "new_line_content": "\t\tPoolVector<Vector3> vertices = arrays[Mesh::ARRAY_VERTEX];",
          "content_same": false
        },
        {
          "line": 1821,
          "old_api": "size",
          "new_api": null,
          "old_text": "normals.size()",
          "new_text": null,
          "old_line_content": "\t\tERR_FAIL_COND_V(normals.size() == 0, ERR_INVALID_PARAMETER);",
          "new_line_content": "\t\tPoolVector<Vector3> normals = arrays[Mesh::ARRAY_NORMAL];",
          "content_same": false
        },
        {
          "line": 1822,
          "old_api": "size",
          "new_api": null,
          "old_text": "uv2.size()",
          "new_text": null,
          "old_line_content": "\t\tERR_FAIL_COND_V(uv2.size() == 0, ERR_INVALID_PARAMETER);",
          "new_line_content": "\t\tPoolVector<Vector2> uv2 = arrays[Mesh::ARRAY_TEX_UV2];",
          "content_same": false
        },
        {
          "line": 1824,
          "old_api": "size",
          "new_api": null,
          "old_text": "vertices.size()",
          "new_text": null,
          "old_line_content": "\t\tint vc = vertices.size();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2338,
          "old_api": "resize",
          "new_api": null,
          "old_text": "arr.resize(Mesh::ARRAY_MAX)",
          "new_text": null,
          "old_line_content": "\t\tarr.resize(Mesh::ARRAY_MAX);",
          "new_line_content": "\tRef<ArrayMesh> mesh;",
          "content_same": false
        },
        {
          "line": 1833,
          "old_api": "read",
          "new_api": null,
          "old_text": "indices.read()",
          "new_text": null,
          "old_line_content": "\t\t\tir = indices.read();",
          "new_line_content": "\t\tPoolVector<int>::Read ir;",
          "content_same": false
        },
        {
          "line": 1844,
          "old_api": "xform",
          "new_api": null,
          "old_text": "xform.xform(vr[idx])",
          "new_text": null,
          "old_line_content": "\t\t\t\tvertex[j] = xform.xform(vr[idx]);",
          "new_line_content": "\t\t\tVector3 normal[3];",
          "content_same": false
        },
        {
          "line": 1845,
          "old_api": "xform",
          "new_api": null,
          "old_text": "xform.basis.xform(nr[idx]).normalized()",
          "new_text": null,
          "old_line_content": "\t\t\t\tnormal[j] = xform.basis.xform(nr[idx]).normalized();",
          "new_line_content": "\t\t\tVector2 uv[3];",
          "content_same": false
        },
        {
          "line": 1855,
          "old_api": "ptrw",
          "new_api": null,
          "old_text": "lightmap.ptrw()",
          "new_text": null,
          "old_line_content": "\t\tLightMap *lightmap_ptr = lightmap.ptrw();",
          "new_line_content": "\t\t}",
          "content_same": false
        },
        {
          "line": 1856,
          "old_api": "get_ticks_usec",
          "new_api": null,
          "old_text": "OS::get_singleton()->get_ticks_usec()",
          "new_text": null,
          "old_line_content": "\t\tuint64_t begin_time = OS::get_singleton()->get_ticks_usec();",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 2371,
          "old_api": "ADD_VTX",
          "new_api": null,
          "old_text": "ADD_VTX(0)",
          "new_text": null,
          "old_line_content": "\t\t\tADD_VTX(0);",
          "new_line_content": "\t\t\t\t\t\tface_points[3 - j][(i + k) % 3] = v[k] * (i >= 3 ? -1 : 1);",
          "content_same": false
        },
        {
          "line": 2372,
          "old_api": "ADD_VTX",
          "new_api": null,
          "old_text": "ADD_VTX(1)",
          "new_text": null,
          "old_line_content": "\t\t\tADD_VTX(1);",
          "new_line_content": "\t\t\t\t}",
          "content_same": false
        },
        {
          "line": 2373,
          "old_api": "ADD_VTX",
          "new_api": null,
          "old_text": "ADD_VTX(2)",
          "new_text": null,
          "old_line_content": "\t\t\tADD_VTX(2);",
          "new_line_content": "\t\t\t}",
          "content_same": false
        },
        {
          "line": 2375,
          "old_api": "ADD_VTX",
          "new_api": null,
          "old_text": "ADD_VTX(2)",
          "new_text": null,
          "old_line_content": "\t\t\tADD_VTX(2);",
          "new_line_content": "\t\t\t//tri 1",
          "content_same": false
        },
        {
          "line": 1866,
          "old_api": "omp_get_max_threads",
          "new_api": null,
          "old_text": "omp_get_max_threads()",
          "new_text": null,
          "old_line_content": "\t\tthreadcount = omp_get_max_threads();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1869,
          "old_api": "resize",
          "new_api": null,
          "old_text": "rng_states.resize(threadcount)",
          "new_text": null,
          "old_line_content": "\t\trng_states.resize(threadcount);",
          "new_line_content": "\t\tuint32_t threadnum = 0;",
          "content_same": false
        },
        {
          "line": 1872,
          "old_api": "rand",
          "new_api": null,
          "old_text": "rand()",
          "new_text": null,
          "old_line_content": "\t\t\t\trng_states[i] = rand();",
          "new_line_content": "#endif",
          "content_same": false
        },
        {
          "line": 1875,
          "old_api": "ptrw",
          "new_api": null,
          "old_text": "rng_states.ptrw()",
          "new_text": null,
          "old_line_content": "\t\tuint32_t *rng_states_p = rng_states.ptrw();",
          "new_line_content": "\t\tfor (uint32_t i = 0; i < threadcount; i++) {",
          "content_same": false
        },
        {
          "line": 2388,
          "old_api": "set_flag",
          "new_api": null,
          "old_text": "fsm->set_flag(SpatialMaterial::FLAG_SRGB_VERTEX_COLOR, true)",
          "new_text": null,
          "old_line_content": "\t\tfsm->set_flag(SpatialMaterial::FLAG_SRGB_VERTEX_COLOR, true);",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 2389,
          "old_api": "set_flag",
          "new_api": null,
          "old_text": "fsm->set_flag(SpatialMaterial::FLAG_ALBEDO_FROM_VERTEX_COLOR, true)",
          "new_text": null,
          "old_line_content": "\t\tfsm->set_flag(SpatialMaterial::FLAG_ALBEDO_FROM_VERTEX_COLOR, true);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2390,
          "old_api": "set_flag",
          "new_api": null,
          "old_text": "fsm->set_flag(SpatialMaterial::FLAG_UNSHADED, true)",
          "new_text": null,
          "old_line_content": "\t\tfsm->set_flag(SpatialMaterial::FLAG_UNSHADED, true);",
          "new_line_content": "\t{",
          "content_same": false
        },
        {
          "line": 2391,
          "old_api": "Color",
          "new_api": null,
          "old_text": "Color(1, 1, 1, 1)",
          "new_text": null,
          "old_line_content": "\t\tfsm->set_albedo(Color(1, 1, 1, 1));",
          "new_line_content": "\t\tRef<SpatialMaterial> fsm;",
          "content_same": false
        },
        {
          "line": 1886,
          "old_api": "omp_get_thread_num",
          "new_api": null,
          "old_text": "omp_get_thread_num()",
          "new_text": null,
          "old_line_content": "\t\t\t\tthreadnum = omp_get_thread_num();",
          "new_line_content": "#pragma omp parallel for schedule(dynamic, 1) private(threadnum)",
          "content_same": false
        },
        {
          "line": 2399,
          "old_api": "_debug_mesh",
          "new_api": null,
          "old_text": "_debug_mesh(0, 0, po2_bounds, mm, idx, p_mode)",
          "new_text": null,
          "old_line_content": "\t_debug_mesh(0, 0, po2_bounds, mm, idx, p_mode);",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 1892,
          "old_api": "Vector3",
          "new_api": null,
          "old_text": "Vector3()",
          "new_text": null,
          "old_line_content": "\t\t\t\tif (pixel->pos == Vector3())",
          "new_line_content": "#endif",
          "content_same": false
        },
        {
          "line": 1898,
          "old_api": "_compute_pixel_light_at_pos",
          "new_api": null,
          "old_text": "_compute_pixel_light_at_pos(pixel->pos, pixel->normal)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\t\tpixel->light = _compute_pixel_light_at_pos(pixel->pos, pixel->normal) * energy;",
          "new_line_content": "\t\t\t\t\tcontinue; //unused, skipe",
          "content_same": false
        },
        {
          "line": 1901,
          "old_api": "_compute_ray_trace_at_pos",
          "new_api": null,
          "old_text": "_compute_ray_trace_at_pos(pixel->pos, pixel->normal, &rng_states_p[threadnum])",
          "new_text": null,
          "old_line_content": "\t\t\t\t\t\tpixel->light = _compute_ray_trace_at_pos(pixel->pos, pixel->normal, &rng_states_p[threadnum]) * energy;",
          "new_line_content": "\t\t\t\tswitch (bake_mode) {",
          "content_same": false
        },
        {
          "line": 2417,
          "old_api": "MIN",
          "new_api": null,
          "old_text": "MIN(p_subdiv, cell_subdiv)",
          "new_text": null,
          "old_line_content": "\tp_subdiv = MIN(p_subdiv, cell_subdiv); // use the smaller one",
          "new_line_content": "\tuint32_t children[8];",
          "content_same": false
        },
        {
          "line": 2420,
          "old_api": "size",
          "new_api": null,
          "old_text": "bake_cells.size()",
          "new_text": null,
          "old_line_content": "\tint bc = bake_cells.size();",
          "new_line_content": "PoolVector<uint8_t> VoxelLightBaker::create_capture_octree(int p_subdiv) {",
          "content_same": false
        },
        {
          "line": 2421,
          "old_api": "resize",
          "new_api": null,
          "old_text": "remap.resize(bc)",
          "new_text": null,
          "old_line_content": "\tremap.resize(bc);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1908,
          "old_api": "MAX",
          "new_api": null,
          "old_text": "MAX(lines, i)",
          "new_text": null,
          "old_line_content": "\t\t\tlines = MAX(lines, i); //for multithread",
          "new_line_content": "\t\t\t\t\t\t//\tpixel->light = Vector3(1, 1, 1);",
          "content_same": false
        },
        {
          "line": 1910,
          "old_api": "get_ticks_usec",
          "new_api": null,
          "old_text": "OS::get_singleton()->get_ticks_usec()",
          "new_text": null,
          "old_line_content": "\t\t\t\tuint64_t elapsed = OS::get_singleton()->get_ticks_usec() - begin_time;",
          "new_line_content": "\t\t\t\t}",
          "content_same": false
        },
        {
          "line": 2430,
          "old_api": "push_back",
          "new_api": null,
          "old_text": "demap.push_back(i)",
          "new_text": null,
          "old_line_content": "\t\t\tdemap.push_back(i);",
          "new_line_content": "\tfor (int i = 0; i < bc; i++) {",
          "content_same": false
        },
        {
          "line": 1921,
          "old_api": "print_line",
          "new_api": null,
          "old_text": "print_line(\"bluring, use pos for separatable copy\")",
          "new_text": null,
          "old_line_content": "\t\t\tprint_line(\"bluring, use pos for separatable copy\");",
          "new_line_content": "\t\t\t}",
          "content_same": false
        },
        {
          "line": 2436,
          "old_api": "resize",
          "new_api": null,
          "old_text": "octree.resize(new_size)",
          "new_text": null,
          "old_line_content": "\toctree.resize(new_size);",
          "new_line_content": "\t\t}",
          "content_same": false
        },
        {
          "line": 1927,
          "old_api": "Vector3",
          "new_api": null,
          "old_text": "Vector3()",
          "new_text": null,
          "old_line_content": "\t\t\t\t\tif (lightmap_ptr[i * width + j].normal == Vector3()) {",
          "new_line_content": "\t\t\t//gauss kernel, 7 step sigma 2",
          "content_same": false
        },
        {
          "line": 2444,
          "old_api": "CLAMP",
          "new_api": null,
          "old_text": "CLAMP(l * 1024, 0, 65535)",
          "new_text": null,
          "old_line_content": "\t\t\t\toctree[i].light[j][k] = CLAMP(l * 1024, 0, 65535); //give two more bits to octree",
          "new_line_content": "\t\toctree[i].alpha = bake_cells[demap[i]].alpha;",
          "content_same": false
        },
        {
          "line": 1934,
          "old_api": "Vector3",
          "new_api": null,
          "old_text": "Vector3()",
          "new_text": null,
          "old_line_content": "\t\t\t\t\t\tif (new_x >= width || lightmap_ptr[i * width + new_x].normal == Vector3())",
          "new_line_content": "\t\t\t\t\t}",
          "content_same": false
        },
        {
          "line": 1941,
          "old_api": "Vector3",
          "new_api": null,
          "old_text": "Vector3()",
          "new_text": null,
          "old_line_content": "\t\t\t\t\t\tif (new_x < 0 || lightmap_ptr[i * width + new_x].normal == Vector3())",
          "new_line_content": "\t\t\t\t\t\tgauss_sum += gauss_kernel[k];",
          "content_same": false
        },
        {
          "line": 2455,
          "old_api": "size",
          "new_api": null,
          "old_text": "octree.size()",
          "new_text": null,
          "old_line_content": "\tint ret_bytes = octree.size() * sizeof(VoxelLightBakerOctree);",
          "new_line_content": "\t\t\toctree[i].children[j] = child == CHILD_EMPTY ? CHILD_EMPTY : remap[child];",
          "content_same": false
        },
        {
          "line": 2456,
          "old_api": "resize",
          "new_api": null,
          "old_text": "ret.resize(ret_bytes)",
          "new_text": null,
          "old_line_content": "\tret.resize(ret_bytes);",
          "new_line_content": "\t\t}",
          "content_same": false
        },
        {
          "line": 2458,
          "old_api": "write",
          "new_api": null,
          "old_text": "ret.write()",
          "new_text": null,
          "old_line_content": "\t\tPoolVector<uint8_t>::Write w = ret.write();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2459,
          "old_api": "ptr",
          "new_api": null,
          "old_text": "octree.ptr()",
          "new_text": null,
          "old_line_content": "\t\tcopymem(w.ptr(), octree.ptr(), ret_bytes);",
          "new_line_content": "\tPoolVector<uint8_t> ret;",
          "content_same": false
        },
        {
          "line": 1953,
          "old_api": "Vector3",
          "new_api": null,
          "old_text": "Vector3()",
          "new_text": null,
          "old_line_content": "\t\t\t\t\tif (lightmap_ptr[i * width + j].normal == Vector3())",
          "new_line_content": "\t\t\t\t}",
          "content_same": false
        },
        {
          "line": 1959,
          "old_api": "Vector3",
          "new_api": null,
          "old_text": "Vector3()",
          "new_text": null,
          "old_line_content": "\t\t\t\t\t\tif (new_y >= height || lightmap_ptr[new_y * width + j].normal == Vector3())",
          "new_line_content": "\t\t\t\t\t\tcontinue; //empty, dont write over it anyway",
          "content_same": false
        },
        {
          "line": 1966,
          "old_api": "Vector3",
          "new_api": null,
          "old_text": "Vector3()",
          "new_text": null,
          "old_line_content": "\t\t\t\t\t\tif (new_y < 0 || lightmap_ptr[new_y * width + j].normal == Vector3())",
          "new_line_content": "\t\t\t\t\t\tgauss_sum += gauss_kernel[k];",
          "content_same": false
        },
        {
          "line": 1979,
          "old_api": "ptrw",
          "new_api": null,
          "old_text": "lightmap.ptrw()",
          "new_text": null,
          "old_line_content": "\t\t\tLightMap *lightmap_ptr = lightmap.ptrw();",
          "new_line_content": "\t\t\t}",
          "content_same": false
        },
        {
          "line": 1980,
          "old_api": "ptr",
          "new_api": null,
          "old_text": "bake_cells.ptr()",
          "new_text": null,
          "old_line_content": "\t\t\tconst Cell *cells = bake_cells.ptr();",
          "new_line_content": "\t\t}",
          "content_same": false
        },
        {
          "line": 1981,
          "old_api": "ptr",
          "new_api": null,
          "old_text": "bake_light.ptr()",
          "new_text": null,
          "old_line_content": "\t\t\tconst Light *light = bake_light.ptr();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1996,
          "old_api": "Vector3",
          "new_api": null,
          "old_text": "Vector3()",
          "new_text": null,
          "old_line_content": "\t\t\t\t\tif (pixel->pos == Vector3())",
          "new_line_content": "\t\t\t\tfor (int j = 0; j < width; j++) {",
          "content_same": false
        },
        {
          "line": 2027,
          "old_api": "_find_cell_at_pos",
          "new_api": null,
          "old_text": "_find_cell_at_pos(cells, ofs_x, ofs_y, ofs_z)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\t\tuint32_t cell = _find_cell_at_pos(cells, ofs_x, ofs_y, ofs_z);",
          "new_line_content": "\t\t\t\t\t\tif (y < 0 || y >= size)",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 29,
      "total_additions": 104,
      "total_deletions": 104,
      "total_api_changes": 237
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 9,
        "api_related_lines": 237,
        "non_api_lines": 4,
        "non_api_line_numbers": [
          1728,
          1729,
          1733,
          1801
        ]
      }
    },
    "api_calls_before": 522,
    "api_calls_after": 522,
    "diff_info": {
      "added_lines": 8,
      "removed_lines": 3,
      "total_diff_lines": 56
    }
  }
}