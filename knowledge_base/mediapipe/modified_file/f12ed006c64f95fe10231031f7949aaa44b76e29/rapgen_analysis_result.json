{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mediapipe/modified_file/f12ed006c64f95fe10231031f7949aaa44b76e29",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mediapipe/modified_file/f12ed006c64f95fe10231031f7949aaa44b76e29/before.cc",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mediapipe/modified_file/f12ed006c64f95fe10231031f7949aaa44b76e29/after.cc",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/mediapipe/modified_file/f12ed006c64f95fe10231031f7949aaa44b76e29/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 114,
          "old_api": "VLOG",
          "new_api": "CreateContextInternal",
          "old_text": "VLOG(1)",
          "new_text": "CreateContextInternal(external_context, 2)",
          "old_line_content": "  VLOG(1) << \"Successfully created a WebGL context with major version \"",
          "new_line_content": "  auto status = CreateContextInternal(external_context, 2);",
          "content_same": false
        },
        {
          "line": 116,
          "old_api": "absl::OkStatus()",
          "new_api": "ABSL_LOG",
          "old_text": "absl::OkStatus()",
          "new_text": "ABSL_LOG(WARNING)",
          "old_line_content": "  return absl::OkStatus();",
          "new_line_content": "    ABSL_LOG(WARNING) << \"Creating a context with WebGL 2 failed: \" << status;",
          "content_same": false
        },
        {
          "line": 122,
          "old_api": "ABSL_LOG",
          "new_api": "VLOG",
          "old_text": "ABSL_LOG(ERROR)",
          "new_text": "VLOG(1)",
          "old_line_content": "    ABSL_LOG(ERROR) << \"thread_ should not exist in DestroyContext() on web.\";",
          "new_line_content": "  VLOG(1) << \"Successfully created a WebGL context with major version \"",
          "content_same": false
        },
        {
          "line": 169,
          "old_api": "emscripten_webgl_get_current_context",
          "new_api": "RET_CHECK",
          "old_text": "emscripten_webgl_get_current_context()",
          "new_text": "RET_CHECK(res == EMSCRIPTEN_RESULT_SUCCESS)",
          "old_line_content": "  return HasContext() && (emscripten_webgl_get_current_context() == context_);",
          "new_line_content": "  RET_CHECK(res == EMSCRIPTEN_RESULT_SUCCESS)",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 130,
          "old_api": null,
          "new_api": "ABSL_LOG",
          "old_text": null,
          "new_text": "ABSL_LOG(ERROR)",
          "old_line_content": "                      << res;",
          "new_line_content": "    ABSL_LOG(ERROR) << \"thread_ should not exist in DestroyContext() on web.\";",
          "content_same": false
        },
        {
          "line": 135,
          "old_api": null,
          "new_api": "emscripten_webgl_destroy_context",
          "old_text": null,
          "new_text": "emscripten_webgl_destroy_context(context_)",
          "old_line_content": "    context_ = 0;",
          "new_line_content": "    EMSCRIPTEN_RESULT res = emscripten_webgl_destroy_context(context_);",
          "content_same": false
        },
        {
          "line": 137,
          "old_api": null,
          "new_api": "ABSL_LOG",
          "old_text": null,
          "new_text": "ABSL_LOG(ERROR)",
          "old_line_content": "}",
          "new_line_content": "      ABSL_LOG(ERROR) << \"emscripten_webgl_destroy_context() returned error \"",
          "content_same": false
        },
        {
          "line": 140,
          "old_api": null,
          "new_api": "ABSL_LOG",
          "old_text": null,
          "new_text": "ABSL_LOG(INFO)",
          "old_line_content": "  GlContext::ContextBinding result;",
          "new_line_content": "      ABSL_LOG(INFO) << \"Successfully destroyed WebGL context with handle \"",
          "content_same": false
        },
        {
          "line": 154,
          "old_api": null,
          "new_api": "emscripten_webgl_get_current_context",
          "old_text": null,
          "new_text": "emscripten_webgl_get_current_context()",
          "old_line_content": "    // perhaps create a separate \"do-nothing\" context for this.",
          "new_line_content": "  binding->context = emscripten_webgl_get_current_context();",
          "content_same": false
        },
        {
          "line": 168,
          "old_api": null,
          "new_api": "emscripten_webgl_make_context_current",
          "old_text": null,
          "new_text": "emscripten_webgl_make_context_current(new_binding.context)",
          "old_line_content": "bool GlContext::IsCurrent() const {",
          "new_line_content": "      emscripten_webgl_make_context_current(new_binding.context);",
          "content_same": false
        },
        {
          "line": 171,
          "old_api": null,
          "new_api": "absl::OkStatus()",
          "old_text": null,
          "new_text": "absl::OkStatus()",
          "old_line_content": "",
          "new_line_content": "  return absl::OkStatus();",
          "content_same": false
        },
        {
          "line": 177,
          "old_api": null,
          "new_api": "emscripten_webgl_get_current_context",
          "old_text": null,
          "new_text": "emscripten_webgl_get_current_context()",
          "old_line_content": "",
          "new_line_content": "  return HasContext() && (emscripten_webgl_get_current_context() == context_);",
          "content_same": false
        },
        {
          "line": 85,
          "old_api": null,
          "new_api": "EM_ASM",
          "old_text": null,
          "new_text": "EM_ASM({ specialHTMLTargets[\"#canvas\"] = Module.canvas; })",
          "old_line_content": "           << \"emscripten_webgl_create_context() returned error \"",
          "new_line_content": "  EM_ASM({ specialHTMLTargets[\"#canvas\"] = Module.canvas; });",
          "content_same": false
        },
        {
          "line": 87,
          "old_api": null,
          "new_api": "emscripten_webgl_create_context",
          "old_text": null,
          "new_text": "emscripten_webgl_create_context(\"#canvas\", &attrs)",
          "old_line_content": "  } else {",
          "new_line_content": "      emscripten_webgl_create_context(\"#canvas\", &attrs);",
          "content_same": false
        },
        {
          "line": 91,
          "old_api": null,
          "new_api": "ABSL_LOG",
          "old_text": null,
          "new_text": "ABSL_LOG(INFO)",
          "old_line_content": "  context_ = context_handle;",
          "new_line_content": "    ABSL_LOG(INFO) << \"Couldn't create webGL \" << webgl_version << \" context.\";",
          "content_same": false
        },
        {
          "line": 92,
          "old_api": null,
          "new_api": "::mediapipe::UnknownErrorBuilder(MEDIAPIPE_LOC)",
          "old_text": null,
          "new_text": "::mediapipe::UnknownErrorBuilder(MEDIAPIPE_LOC)",
          "old_line_content": "  attrs_ = attrs;",
          "new_line_content": "    return ::mediapipe::UnknownErrorBuilder(MEDIAPIPE_LOC)",
          "content_same": false
        },
        {
          "line": 96,
          "old_api": null,
          "new_api": "emscripten_webgl_get_context_attributes",
          "old_text": null,
          "new_text": "emscripten_webgl_get_context_attributes(context_handle, &attrs)",
          "old_line_content": "  gl_major_version_ = webgl_version + 1;",
          "new_line_content": "    emscripten_webgl_get_context_attributes(context_handle, &attrs);",
          "content_same": false
        },
        {
          "line": 105,
          "old_api": null,
          "new_api": "absl::OkStatus()",
          "old_text": null,
          "new_text": "absl::OkStatus()",
          "old_line_content": "",
          "new_line_content": "  return absl::OkStatus();",
          "content_same": false
        },
        {
          "line": 115,
          "old_api": null,
          "new_api": "ok",
          "old_text": null,
          "new_text": "status.ok()",
          "old_line_content": "          << gl_major_version_ << \" and handle \" << context_;",
          "new_line_content": "  if (!status.ok()) {",
          "content_same": false
        },
        {
          "line": 117,
          "old_api": null,
          "new_api": "ABSL_LOG",
          "old_text": null,
          "new_text": "ABSL_LOG(WARNING)",
          "old_line_content": "}",
          "new_line_content": "    ABSL_LOG(WARNING) << \"Fall back on WebGL 1.\";",
          "content_same": false
        },
        {
          "line": 118,
          "old_api": null,
          "new_api": "CreateContextInternal",
          "old_text": null,
          "new_text": "CreateContextInternal(external_context, 1)",
          "old_line_content": "",
          "new_line_content": "    status = CreateContextInternal(external_context, 1);",
          "content_same": false
        },
        {
          "line": 120,
          "old_api": null,
          "new_api": "MP_RETURN_IF_ERROR",
          "old_text": null,
          "new_text": "MP_RETURN_IF_ERROR(status)",
          "old_line_content": "  if (thread_) {",
          "new_line_content": "  MP_RETURN_IF_ERROR(status);",
          "content_same": false
        },
        {
          "line": 124,
          "old_api": null,
          "new_api": "absl::OkStatus()",
          "old_text": null,
          "new_text": "absl::OkStatus()",
          "old_line_content": "",
          "new_line_content": "  return absl::OkStatus();",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 129,
          "old_api": "ABSL_LOG",
          "new_api": null,
          "old_text": "ABSL_LOG(ERROR)",
          "new_text": null,
          "old_line_content": "      ABSL_LOG(ERROR) << \"emscripten_webgl_destroy_context() returned error \"",
          "new_line_content": "    // For now, we force web MediaPipe to be single-threaded, so error here.",
          "content_same": false
        },
        {
          "line": 132,
          "old_api": "ABSL_LOG",
          "new_api": null,
          "old_text": "ABSL_LOG(INFO)",
          "new_text": null,
          "old_line_content": "      ABSL_LOG(INFO) << \"Successfully destroyed WebGL context with handle \"",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 146,
          "old_api": "emscripten_webgl_get_current_context",
          "new_api": null,
          "old_text": "emscripten_webgl_get_current_context()",
          "new_text": null,
          "old_line_content": "  binding->context = emscripten_webgl_get_current_context();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 155,
          "old_api": "absl::OkStatus()",
          "new_api": null,
          "old_text": "absl::OkStatus()",
          "new_text": null,
          "old_line_content": "    return absl::OkStatus();",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 160,
          "old_api": "emscripten_webgl_make_context_current",
          "new_api": null,
          "old_text": "emscripten_webgl_make_context_current(new_binding.context)",
          "new_text": null,
          "old_line_content": "      emscripten_webgl_make_context_current(new_binding.context);",
          "new_line_content": "    // Calling emscripten_webgl_make_context_current(0) is resulting in an error",
          "content_same": false
        },
        {
          "line": 161,
          "old_api": "RET_CHECK",
          "new_api": null,
          "old_text": "RET_CHECK(res == EMSCRIPTEN_RESULT_SUCCESS)",
          "new_text": null,
          "old_line_content": "  RET_CHECK(res == EMSCRIPTEN_RESULT_SUCCESS)",
          "new_line_content": "    // so don't remove context for now, only replace!  In the future, can",
          "content_same": false
        },
        {
          "line": 77,
          "old_api": "EM_ASM",
          "new_api": null,
          "old_text": "EM_ASM({ specialHTMLTargets[\"#canvas\"] = Module.canvas; })",
          "new_text": null,
          "old_line_content": "  EM_ASM({ specialHTMLTargets[\"#canvas\"] = Module.canvas; });",
          "new_line_content": "  // context manually before initializing the graph.",
          "content_same": false
        },
        {
          "line": 79,
          "old_api": "emscripten_webgl_create_context",
          "new_api": null,
          "old_text": "emscripten_webgl_create_context(\"#canvas\", &attrs)",
          "new_text": null,
          "old_line_content": "      emscripten_webgl_create_context(\"#canvas\", &attrs);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 83,
          "old_api": "ABSL_LOG",
          "new_api": null,
          "old_text": "ABSL_LOG(INFO)",
          "new_text": null,
          "old_line_content": "    ABSL_LOG(INFO) << \"Couldn't create webGL \" << webgl_version << \" context.\";",
          "new_line_content": "  // event target behavior, but it was never supposed to be tapping into our",
          "content_same": false
        },
        {
          "line": 84,
          "old_api": "::mediapipe::UnknownErrorBuilder(MEDIAPIPE_LOC)",
          "new_api": null,
          "old_text": "::mediapipe::UnknownErrorBuilder(MEDIAPIPE_LOC)",
          "new_text": null,
          "old_line_content": "    return ::mediapipe::UnknownErrorBuilder(MEDIAPIPE_LOC)",
          "new_line_content": "  // canvas anyways. See b/278155946 for more background.",
          "content_same": false
        },
        {
          "line": 88,
          "old_api": "emscripten_webgl_get_context_attributes",
          "new_api": null,
          "old_text": "emscripten_webgl_get_context_attributes(context_handle, &attrs)",
          "new_text": null,
          "old_line_content": "    emscripten_webgl_get_context_attributes(context_handle, &attrs);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 97,
          "old_api": "absl::OkStatus()",
          "new_api": null,
          "old_text": "absl::OkStatus()",
          "new_text": null,
          "old_line_content": "  return absl::OkStatus();",
          "new_line_content": "    webgl_version = attrs.majorVersion;",
          "content_same": false
        },
        {
          "line": 106,
          "old_api": "CreateContextInternal",
          "new_api": null,
          "old_text": "CreateContextInternal(external_context, 2)",
          "new_text": null,
          "old_line_content": "  auto status = CreateContextInternal(external_context, 2);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 107,
          "old_api": "ok",
          "new_api": null,
          "old_text": "status.ok()",
          "new_text": null,
          "old_line_content": "  if (!status.ok()) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 108,
          "old_api": "ABSL_LOG",
          "new_api": null,
          "old_text": "ABSL_LOG(WARNING)",
          "new_text": null,
          "old_line_content": "    ABSL_LOG(WARNING) << \"Creating a context with WebGL 2 failed: \" << status;",
          "new_line_content": "absl::Status GlContext::CreateContext(",
          "content_same": false
        },
        {
          "line": 109,
          "old_api": "ABSL_LOG",
          "new_api": null,
          "old_text": "ABSL_LOG(WARNING)",
          "new_text": null,
          "old_line_content": "    ABSL_LOG(WARNING) << \"Fall back on WebGL 1.\";",
          "new_line_content": "    EMSCRIPTEN_WEBGL_CONTEXT_HANDLE external_context) {",
          "content_same": false
        },
        {
          "line": 110,
          "old_api": "CreateContextInternal",
          "new_api": null,
          "old_text": "CreateContextInternal(external_context, 1)",
          "new_text": null,
          "old_line_content": "    status = CreateContextInternal(external_context, 1);",
          "new_line_content": "  // TODO: If we're given a non-0 external_context, could try to use",
          "content_same": false
        },
        {
          "line": 112,
          "old_api": "MP_RETURN_IF_ERROR",
          "new_api": null,
          "old_text": "MP_RETURN_IF_ERROR(status)",
          "new_text": null,
          "old_line_content": "  MP_RETURN_IF_ERROR(status);",
          "new_line_content": "  // environment anyways now.",
          "content_same": false
        },
        {
          "line": 127,
          "old_api": "emscripten_webgl_destroy_context",
          "new_api": null,
          "old_text": "emscripten_webgl_destroy_context(context_)",
          "new_text": null,
          "old_line_content": "    EMSCRIPTEN_RESULT res = emscripten_webgl_destroy_context(context_);",
          "new_line_content": "void GlContext::DestroyContext() {",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 4,
      "total_additions": 19,
      "total_deletions": 19,
      "total_api_changes": 42
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 8,
        "api_related_lines": 42,
        "non_api_lines": 6,
        "non_api_line_numbers": [
          72,
          73,
          74,
          75,
          76,
          78
        ]
      }
    },
    "api_calls_before": 35,
    "api_calls_after": 35,
    "diff_info": {
      "added_lines": 8,
      "removed_lines": 0,
      "total_diff_lines": 20
    }
  }
}