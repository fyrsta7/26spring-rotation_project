{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/nginx/modified_file/9683528550836a35cb24c61bf3fd99175bcbd82f",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/nginx/modified_file/9683528550836a35cb24c61bf3fd99175bcbd82f/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/nginx/modified_file/9683528550836a35cb24c61bf3fd99175bcbd82f/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/nginx/modified_file/9683528550836a35cb24c61bf3fd99175bcbd82f/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 83,
          "old_api": "ngx_log_error",
          "new_api": "ngx_buf_special",
          "old_text": "ngx_log_error(NGX_LOG_ALERT, c->log, 0,\n                          \"zero size buf in writer \"\n                          \"t:%d r:%d f:%d %p %p-%p %p %O-%O\",\n                          cl->buf->temporary,\n                          cl->buf->recycled,\n                          cl->buf->in_file,\n                          cl->buf->start,\n                          cl->buf->pos,\n                          cl->buf->last,\n                          cl->buf->file,\n                          cl->buf->file_pos,\n                          cl->buf->file_last)",
          "new_text": "ngx_buf_special(cl->buf)",
          "old_line_content": "            ngx_log_error(NGX_LOG_ALERT, c->log, 0,",
          "new_line_content": "        if (ngx_buf_size(cl->buf) == 0 && !ngx_buf_special(cl->buf)) {",
          "content_same": false
        },
        {
          "line": 135,
          "old_api": "ngx_log_error",
          "new_api": "ngx_buf_special",
          "old_text": "ngx_log_error(NGX_LOG_ALERT, c->log, 0,\n                          \"zero size buf in writer \"\n                          \"t:%d r:%d f:%d %p %p-%p %p %O-%O\",\n                          cl->buf->temporary,\n                          cl->buf->recycled,\n                          cl->buf->in_file,\n                          cl->buf->start,\n                          cl->buf->pos,\n                          cl->buf->last,\n                          cl->buf->file,\n                          cl->buf->file_pos,\n                          cl->buf->file_last)",
          "new_text": "ngx_buf_special(cl->buf)",
          "old_line_content": "            ngx_log_error(NGX_LOG_ALERT, c->log, 0,",
          "new_line_content": "        if (ngx_buf_size(cl->buf) == 0 && !ngx_buf_special(cl->buf)) {",
          "content_same": false
        },
        {
          "line": 218,
          "old_api": "ngx_msec_t) (- limit * 1000 / r->limit_rate + 1)",
          "new_api": "ngx_add_timer",
          "old_text": "ngx_msec_t) (- limit * 1000 / r->limit_rate + 1)",
          "new_text": "ngx_add_timer(c->write,\n                          (ngx_msec_t) (- limit * 1000 / r->limit_rate + 1))",
          "old_line_content": "                          (ngx_msec_t) (- limit * 1000 / r->limit_rate + 1));",
          "new_line_content": "            ngx_add_timer(c->write,",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 262,
          "old_api": null,
          "new_api": "ngx_add_timer",
          "old_text": null,
          "new_text": "ngx_add_timer(c->write, 1)",
          "old_line_content": "        ln = cl;",
          "new_line_content": "        ngx_add_timer(c->write, 1);",
          "content_same": false
        },
        {
          "line": 136,
          "old_api": null,
          "new_api": "ngx_log_error",
          "old_text": null,
          "new_text": "ngx_log_error(NGX_LOG_ALERT, c->log, 0,\n                          \"zero size buf in writer \"\n                          \"t:%d r:%d f:%d %p %p-%p %p %O-%O\",\n                          cl->buf->temporary,\n                          cl->buf->recycled,\n                          cl->buf->in_file,\n                          cl->buf->start,\n                          cl->buf->pos,\n                          cl->buf->last,\n                          cl->buf->file,\n                          cl->buf->file_pos,\n                          cl->buf->file_last)",
          "old_line_content": "                          \"zero size buf in writer \"",
          "new_line_content": "            ngx_log_error(NGX_LOG_ALERT, c->log, 0,",
          "content_same": false
        },
        {
          "line": 268,
          "old_api": null,
          "new_api": "ngx_free_chain",
          "old_text": null,
          "new_text": "ngx_free_chain(r->pool, ln)",
          "old_line_content": "",
          "new_line_content": "        ngx_free_chain(r->pool, ln);",
          "content_same": false
        },
        {
          "line": 149,
          "old_api": null,
          "new_api": "ngx_debug_point",
          "old_text": null,
          "new_text": "ngx_debug_point()",
          "old_line_content": "            return NGX_ERROR;",
          "new_line_content": "            ngx_debug_point();",
          "content_same": false
        },
        {
          "line": 154,
          "old_api": null,
          "new_api": "ngx_buf_size",
          "old_text": null,
          "new_text": "ngx_buf_size(cl->buf)",
          "old_line_content": "",
          "new_line_content": "        size += ngx_buf_size(cl->buf);",
          "content_same": false
        },
        {
          "line": 167,
          "old_api": null,
          "new_api": "ngx_log_debug3",
          "old_text": null,
          "new_text": "ngx_log_debug3(NGX_LOG_DEBUG_HTTP, c->log, 0,\n                   \"http write filter: l:%d f:%d s:%O\", last, flush, size)",
          "old_line_content": "                   \"http write filter: l:%d f:%d s:%O\", last, flush, size);",
          "new_line_content": "    ngx_log_debug3(NGX_LOG_DEBUG_HTTP, c->log, 0,",
          "content_same": false
        },
        {
          "line": 170,
          "old_api": null,
          "new_api": "ngx_http_get_module_loc_conf",
          "old_text": null,
          "new_text": "ngx_http_get_module_loc_conf(r, ngx_http_core_module)",
          "old_line_content": "",
          "new_line_content": "    clcf = ngx_http_get_module_loc_conf(r, ngx_http_core_module);",
          "content_same": false
        },
        {
          "line": 73,
          "old_api": null,
          "new_api": "ngx_log_debug7",
          "old_text": null,
          "new_text": "ngx_log_debug7(NGX_LOG_DEBUG_EVENT, c->log, 0,\n                       \"write old buf t:%d f:%d %p, pos %p, size: %z \"\n                       \"file: %O, size: %z\",\n                       cl->buf->temporary, cl->buf->in_file,\n                       cl->buf->start, cl->buf->pos,\n                       cl->buf->last - cl->buf->pos,\n                       cl->buf->file_pos,\n                       cl->buf->file_last - cl->buf->file_pos)",
          "old_line_content": "                       \"write old buf t:%d f:%d %p, pos %p, size: %z \"",
          "new_line_content": "        ngx_log_debug7(NGX_LOG_DEBUG_EVENT, c->log, 0,",
          "content_same": false
        },
        {
          "line": 205,
          "old_api": null,
          "new_api": "ngx_log_error",
          "old_text": null,
          "new_text": "ngx_log_error(NGX_LOG_ALERT, c->log, 0,\n                      \"the http output chain is empty\")",
          "old_line_content": "                      \"the http output chain is empty\");",
          "new_line_content": "        ngx_log_error(NGX_LOG_ALERT, c->log, 0,",
          "content_same": false
        },
        {
          "line": 208,
          "old_api": null,
          "new_api": "ngx_debug_point",
          "old_text": null,
          "new_text": "ngx_debug_point()",
          "old_line_content": "",
          "new_line_content": "        ngx_debug_point();",
          "content_same": false
        },
        {
          "line": 84,
          "old_api": null,
          "new_api": "ngx_log_error",
          "old_text": null,
          "new_text": "ngx_log_error(NGX_LOG_ALERT, c->log, 0,\n                          \"zero size buf in writer \"\n                          \"t:%d r:%d f:%d %p %p-%p %p %O-%O\",\n                          cl->buf->temporary,\n                          cl->buf->recycled,\n                          cl->buf->in_file,\n                          cl->buf->start,\n                          cl->buf->pos,\n                          cl->buf->last,\n                          cl->buf->file,\n                          cl->buf->file_pos,\n                          cl->buf->file_last)",
          "old_line_content": "                          \"zero size buf in writer \"",
          "new_line_content": "            ngx_log_error(NGX_LOG_ALERT, c->log, 0,",
          "content_same": false
        },
        {
          "line": 214,
          "old_api": null,
          "new_api": "ngx_time",
          "old_text": null,
          "new_text": "ngx_time()",
          "old_line_content": "",
          "new_line_content": "        limit = r->limit_rate * (ngx_time() - r->start_sec + 1) - c->sent;",
          "content_same": false
        },
        {
          "line": 219,
          "old_api": null,
          "new_api": "ngx_msec_t) (- limit * 1000 / r->limit_rate + 1)",
          "old_text": null,
          "new_text": "ngx_msec_t) (- limit * 1000 / r->limit_rate + 1)",
          "old_line_content": "",
          "new_line_content": "                          (ngx_msec_t) (- limit * 1000 / r->limit_rate + 1));",
          "content_same": false
        },
        {
          "line": 97,
          "old_api": null,
          "new_api": "ngx_debug_point",
          "old_text": null,
          "new_text": "ngx_debug_point()",
          "old_line_content": "            return NGX_ERROR;",
          "new_line_content": "            ngx_debug_point();",
          "content_same": false
        },
        {
          "line": 102,
          "old_api": null,
          "new_api": "ngx_buf_size",
          "old_text": null,
          "new_text": "ngx_buf_size(cl->buf)",
          "old_line_content": "",
          "new_line_content": "        size += ngx_buf_size(cl->buf);",
          "content_same": false
        },
        {
          "line": 235,
          "old_api": null,
          "new_api": "ngx_log_debug1",
          "old_text": null,
          "new_text": "ngx_log_debug1(NGX_LOG_DEBUG_HTTP, c->log, 0,\n                   \"http write filter limit %O\", limit)",
          "old_line_content": "                   \"http write filter limit %O\", limit);",
          "new_line_content": "    ngx_log_debug1(NGX_LOG_DEBUG_HTTP, c->log, 0,",
          "content_same": false
        },
        {
          "line": 238,
          "old_api": null,
          "new_api": "send_chain",
          "old_text": null,
          "new_text": "c->send_chain(c, r->out, limit)",
          "old_line_content": "",
          "new_line_content": "    chain = c->send_chain(c, r->out, limit);",
          "content_same": false
        },
        {
          "line": 240,
          "old_api": null,
          "new_api": "ngx_log_debug1",
          "old_text": null,
          "new_text": "ngx_log_debug1(NGX_LOG_DEBUG_HTTP, c->log, 0,\n                   \"http write filter %p\", chain)",
          "old_line_content": "                   \"http write filter %p\", chain);",
          "new_line_content": "    ngx_log_debug1(NGX_LOG_DEBUG_HTTP, c->log, 0,",
          "content_same": false
        },
        {
          "line": 116,
          "old_api": null,
          "new_api": "ngx_alloc_chain_link",
          "old_text": null,
          "new_text": "ngx_alloc_chain_link(r->pool)",
          "old_line_content": "        if (cl == NULL) {",
          "new_line_content": "        cl = ngx_alloc_chain_link(r->pool);",
          "content_same": false
        },
        {
          "line": 125,
          "old_api": null,
          "new_api": "ngx_log_debug7",
          "old_text": null,
          "new_text": "ngx_log_debug7(NGX_LOG_DEBUG_EVENT, c->log, 0,\n                       \"write new buf t:%d f:%d %p, pos %p, size: %z \"\n                       \"file: %O, size: %z\",\n                       cl->buf->temporary, cl->buf->in_file,\n                       cl->buf->start, cl->buf->pos,\n                       cl->buf->last - cl->buf->pos,\n                       cl->buf->file_pos,\n                       cl->buf->file_last - cl->buf->file_pos)",
          "old_line_content": "                       \"write new buf t:%d f:%d %p, pos %p, size: %z \"",
          "new_line_content": "        ngx_log_debug7(NGX_LOG_DEBUG_EVENT, c->log, 0,",
          "content_same": false
        },
        {
          "line": 249,
          "old_api": null,
          "new_api": "ngx_msec_t) ((c->sent - sent) * 1000 / r->limit_rate + 1)",
          "old_text": null,
          "new_text": "ngx_msec_t) ((c->sent - sent) * 1000 / r->limit_rate + 1)",
          "old_line_content": "        c->write->delayed = 1;",
          "new_line_content": "        delay = (ngx_msec_t) ((c->sent - sent) * 1000 / r->limit_rate + 1);",
          "content_same": false
        },
        {
          "line": 253,
          "old_api": null,
          "new_api": "ngx_add_timer",
          "old_text": null,
          "new_text": "ngx_add_timer(c->write, delay)",
          "old_line_content": "               && clcf->sendfile_max_chunk",
          "new_line_content": "            ngx_add_timer(c->write, delay);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 258,
          "old_api": "ngx_add_timer",
          "new_api": null,
          "old_text": "ngx_add_timer(c->write, 1)",
          "new_text": null,
          "old_line_content": "        ngx_add_timer(c->write, 1);",
          "new_line_content": "               && (size_t) (c->sent - sent)",
          "content_same": false
        },
        {
          "line": 134,
          "old_api": "ngx_buf_special",
          "new_api": null,
          "old_text": "ngx_buf_special(cl->buf)",
          "new_text": null,
          "old_line_content": "        if (ngx_buf_size(cl->buf) == 0 && !ngx_buf_special(cl->buf)) {",
          "new_line_content": "#if 1",
          "content_same": false
        },
        {
          "line": 264,
          "old_api": "ngx_free_chain",
          "new_api": null,
          "old_text": "ngx_free_chain(r->pool, ln)",
          "new_text": null,
          "old_line_content": "        ngx_free_chain(r->pool, ln);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 148,
          "old_api": "ngx_debug_point",
          "new_api": null,
          "old_text": "ngx_debug_point()",
          "new_text": null,
          "old_line_content": "            ngx_debug_point();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 153,
          "old_api": "ngx_buf_size",
          "new_api": null,
          "old_text": "ngx_buf_size(cl->buf)",
          "new_text": null,
          "old_line_content": "        size += ngx_buf_size(cl->buf);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 166,
          "old_api": "ngx_log_debug3",
          "new_api": null,
          "old_text": "ngx_log_debug3(NGX_LOG_DEBUG_HTTP, c->log, 0,\n                   \"http write filter: l:%d f:%d s:%O\", last, flush, size)",
          "new_text": null,
          "old_line_content": "    ngx_log_debug3(NGX_LOG_DEBUG_HTTP, c->log, 0,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 169,
          "old_api": "ngx_http_get_module_loc_conf",
          "new_api": null,
          "old_text": "ngx_http_get_module_loc_conf(r, ngx_http_core_module)",
          "new_text": null,
          "old_line_content": "    clcf = ngx_http_get_module_loc_conf(r, ngx_http_core_module);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 72,
          "old_api": "ngx_log_debug7",
          "new_api": null,
          "old_text": "ngx_log_debug7(NGX_LOG_DEBUG_EVENT, c->log, 0,\n                       \"write old buf t:%d f:%d %p, pos %p, size: %z \"\n                       \"file: %O, size: %z\",\n                       cl->buf->temporary, cl->buf->in_file,\n                       cl->buf->start, cl->buf->pos,\n                       cl->buf->last - cl->buf->pos,\n                       cl->buf->file_pos,\n                       cl->buf->file_last - cl->buf->file_pos)",
          "new_text": null,
          "old_line_content": "        ngx_log_debug7(NGX_LOG_DEBUG_EVENT, c->log, 0,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 204,
          "old_api": "ngx_log_error",
          "new_api": null,
          "old_text": "ngx_log_error(NGX_LOG_ALERT, c->log, 0,\n                      \"the http output chain is empty\")",
          "new_text": null,
          "old_line_content": "        ngx_log_error(NGX_LOG_ALERT, c->log, 0,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 207,
          "old_api": "ngx_debug_point",
          "new_api": null,
          "old_text": "ngx_debug_point()",
          "new_text": null,
          "old_line_content": "        ngx_debug_point();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 82,
          "old_api": "ngx_buf_special",
          "new_api": null,
          "old_text": "ngx_buf_special(cl->buf)",
          "new_text": null,
          "old_line_content": "        if (ngx_buf_size(cl->buf) == 0 && !ngx_buf_special(cl->buf)) {",
          "new_line_content": "#if 1",
          "content_same": false
        },
        {
          "line": 213,
          "old_api": "ngx_time",
          "new_api": null,
          "old_text": "ngx_time()",
          "new_text": null,
          "old_line_content": "        limit = r->limit_rate * (ngx_time() - r->start_sec + 1) - c->sent;",
          "new_line_content": "    if (r->limit_rate) {",
          "content_same": false
        },
        {
          "line": 217,
          "old_api": "ngx_add_timer",
          "new_api": null,
          "old_text": "ngx_add_timer(c->write,\n                          (ngx_msec_t) (- limit * 1000 / r->limit_rate + 1))",
          "new_text": null,
          "old_line_content": "            ngx_add_timer(c->write,",
          "new_line_content": "            c->write->delayed = 1;",
          "content_same": false
        },
        {
          "line": 96,
          "old_api": "ngx_debug_point",
          "new_api": null,
          "old_text": "ngx_debug_point()",
          "new_text": null,
          "old_line_content": "            ngx_debug_point();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 101,
          "old_api": "ngx_buf_size",
          "new_api": null,
          "old_text": "ngx_buf_size(cl->buf)",
          "new_text": null,
          "old_line_content": "        size += ngx_buf_size(cl->buf);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 234,
          "old_api": "ngx_log_debug1",
          "new_api": null,
          "old_text": "ngx_log_debug1(NGX_LOG_DEBUG_HTTP, c->log, 0,\n                   \"http write filter limit %O\", limit)",
          "new_text": null,
          "old_line_content": "    ngx_log_debug1(NGX_LOG_DEBUG_HTTP, c->log, 0,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 237,
          "old_api": "send_chain",
          "new_api": null,
          "old_text": "c->send_chain(c, r->out, limit)",
          "new_text": null,
          "old_line_content": "    chain = c->send_chain(c, r->out, limit);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 239,
          "old_api": "ngx_log_debug1",
          "new_api": null,
          "old_text": "ngx_log_debug1(NGX_LOG_DEBUG_HTTP, c->log, 0,\n                   \"http write filter %p\", chain)",
          "new_text": null,
          "old_line_content": "    ngx_log_debug1(NGX_LOG_DEBUG_HTTP, c->log, 0,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 115,
          "old_api": "ngx_alloc_chain_link",
          "new_api": null,
          "old_text": "ngx_alloc_chain_link(r->pool)",
          "new_text": null,
          "old_line_content": "        cl = ngx_alloc_chain_link(r->pool);",
          "new_line_content": "    for (ln = in; ln; ln = ln->next) {",
          "content_same": false
        },
        {
          "line": 250,
          "old_api": "ngx_msec_t) (sent * 1000 / r->limit_rate + 1)",
          "new_api": null,
          "old_text": "ngx_msec_t) (sent * 1000 / r->limit_rate + 1)",
          "new_text": null,
          "old_line_content": "        ngx_add_timer(c->write, (ngx_msec_t) (sent * 1000 / r->limit_rate + 1));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 124,
          "old_api": "ngx_log_debug7",
          "new_api": null,
          "old_text": "ngx_log_debug7(NGX_LOG_DEBUG_EVENT, c->log, 0,\n                       \"write new buf t:%d f:%d %p, pos %p, size: %z \"\n                       \"file: %O, size: %z\",\n                       cl->buf->temporary, cl->buf->in_file,\n                       cl->buf->start, cl->buf->pos,\n                       cl->buf->last - cl->buf->pos,\n                       cl->buf->file_pos,\n                       cl->buf->file_last - cl->buf->file_pos)",
          "new_text": null,
          "old_line_content": "        ngx_log_debug7(NGX_LOG_DEBUG_EVENT, c->log, 0,",
          "new_line_content": "",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 3,
      "total_additions": 22,
      "total_deletions": 21,
      "total_api_changes": 46
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 10,
        "api_related_lines": 46,
        "non_api_lines": 7,
        "non_api_line_numbers": [
          259,
          52,
          248,
          251,
          252,
          254,
          255
        ]
      }
    },
    "api_calls_before": 27,
    "api_calls_after": 27,
    "diff_info": {
      "added_lines": 8,
      "removed_lines": 4,
      "total_diff_lines": 35
    }
  }
}