{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/nginx/modified_file/ae0e919135b7e1e80167d09b5bd2fef7903f7659",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/nginx/modified_file/ae0e919135b7e1e80167d09b5bd2fef7903f7659/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/nginx/modified_file/ae0e919135b7e1e80167d09b5bd2fef7903f7659/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/nginx/modified_file/ae0e919135b7e1e80167d09b5bd2fef7903f7659/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 324,
          "old_api": "writev",
          "new_api": "ngx_log_debug4",
          "old_text": "writev(c->fd, header.elts, header.nelts)",
          "new_text": "ngx_log_debug4(NGX_LOG_DEBUG_EVENT, c->log, 0,\n                           \"sendfile: %d, @%O %O:%uz\",\n                           rc, file->file_pos, sent, file_size + header_size)",
          "old_line_content": "            rc = writev(c->fd, header.elts, header.nelts);",
          "new_line_content": "            ngx_log_debug4(NGX_LOG_DEBUG_EVENT, c->log, 0,",
          "content_same": false
        },
        {
          "line": 374,
          "old_api": "ngx_buf_in_memory",
          "new_api": "ngx_buf_size",
          "old_text": "ngx_buf_in_memory(cl->buf)",
          "new_text": "ngx_buf_size(cl->buf)",
          "old_line_content": "                if (ngx_buf_in_memory(cl->buf)) {",
          "new_line_content": "            size = ngx_buf_size(cl->buf);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 390,
          "old_api": null,
          "new_api": "ngx_buf_in_memory",
          "old_text": null,
          "new_text": "ngx_buf_in_memory(cl->buf)",
          "old_line_content": "                cl->buf->file_pos += sent;",
          "new_line_content": "            if (ngx_buf_in_memory(cl->buf)) {",
          "content_same": false
        },
        {
          "line": 297,
          "old_api": null,
          "new_api": "ngx_connection_error",
          "old_text": null,
          "new_text": "ngx_connection_error(c, err, \"sendfile() failed\")",
          "old_line_content": "                               \"sendfile() sent only %O bytes\", sent);",
          "new_line_content": "                    (void) ngx_connection_error(c, err, \"sendfile() failed\");",
          "content_same": false
        },
        {
          "line": 329,
          "old_api": null,
          "new_api": "writev",
          "old_text": null,
          "new_text": "writev(c->fd, header.elts, header.nelts)",
          "old_line_content": "            if (rc == -1) {",
          "new_line_content": "            rc = writev(c->fd, header.elts, header.nelts);",
          "content_same": false
        },
        {
          "line": 331,
          "old_api": null,
          "new_api": "ngx_log_debug2",
          "old_text": null,
          "new_text": "ngx_log_debug2(NGX_LOG_DEBUG_EVENT, c->log, 0,\n                           \"writev: %d of %uz\", rc, header_size)",
          "old_line_content": "",
          "new_line_content": "            ngx_log_debug2(NGX_LOG_DEBUG_EVENT, c->log, 0,",
          "content_same": false
        },
        {
          "line": 301,
          "old_api": null,
          "new_api": "ngx_log_debug1",
          "old_text": null,
          "new_text": "ngx_log_debug1(NGX_LOG_DEBUG_EVENT, c->log, err,\n                               \"sendfile() sent only %O bytes\", sent)",
          "old_line_content": "             * on success, although only 0 is documented",
          "new_line_content": "                ngx_log_debug1(NGX_LOG_DEBUG_EVENT, c->log, err,",
          "content_same": false
        },
        {
          "line": 366,
          "old_api": null,
          "new_api": "ngx_buf_special",
          "old_text": null,
          "new_text": "ngx_buf_special(cl->buf)",
          "old_line_content": "                break;",
          "new_line_content": "            if (ngx_buf_special(cl->buf)) {",
          "content_same": false
        },
        {
          "line": 274,
          "old_api": null,
          "new_api": "sendfile",
          "old_text": null,
          "new_text": "sendfile(file->file->fd, c->fd, file->file_pos,\n                          file_size + header_size, &hdtr, &sent, flags)",
          "old_line_content": "",
          "new_line_content": "            rc = sendfile(file->file->fd, c->fd, file->file_pos,",
          "content_same": false
        },
        {
          "line": 379,
          "old_api": null,
          "new_api": "ngx_buf_in_memory",
          "old_text": null,
          "new_text": "ngx_buf_in_memory(cl->buf)",
          "old_line_content": "                    cl->buf->file_pos = cl->buf->file_last;",
          "new_line_content": "                if (ngx_buf_in_memory(cl->buf)) {",
          "content_same": false
        },
        {
          "line": 347,
          "old_api": null,
          "new_api": "ngx_connection_error",
          "old_text": null,
          "new_text": "ngx_connection_error(c, err, \"writev() failed\")",
          "old_line_content": "                               \"writev() not ready\");",
          "new_line_content": "                    ngx_connection_error(c, err, \"writev() failed\");",
          "content_same": false
        },
        {
          "line": 317,
          "old_api": null,
          "new_api": "ngx_log_error",
          "old_text": null,
          "new_text": "ngx_log_error(NGX_LOG_ALERT, c->log, 0,\n                         \"sendfile() reported that \\\"%s\\\" was truncated at %O\",\n                         file->file->name.data, file->file_pos)",
          "old_line_content": "            }",
          "new_line_content": "                ngx_log_error(NGX_LOG_ALERT, c->log, 0,",
          "content_same": false
        },
        {
          "line": 351,
          "old_api": null,
          "new_api": "ngx_log_debug0",
          "old_text": null,
          "new_text": "ngx_log_debug0(NGX_LOG_DEBUG_EVENT, c->log, err,\n                               \"writev() not ready\")",
          "old_line_content": "        }",
          "new_line_content": "                ngx_log_debug0(NGX_LOG_DEBUG_EVENT, c->log, err,",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 385,
          "old_api": "ngx_buf_in_memory",
          "new_api": null,
          "old_text": "ngx_buf_in_memory(cl->buf)",
          "new_text": null,
          "old_line_content": "            if (ngx_buf_in_memory(cl->buf)) {",
          "new_line_content": "                }",
          "content_same": false
        },
        {
          "line": 292,
          "old_api": "ngx_connection_error",
          "new_api": null,
          "old_text": "ngx_connection_error(c, err, \"sendfile() failed\")",
          "new_text": null,
          "old_line_content": "                    (void) ngx_connection_error(c, err, \"sendfile() failed\");",
          "new_line_content": "                    break;",
          "content_same": false
        },
        {
          "line": 326,
          "old_api": "ngx_log_debug2",
          "new_api": null,
          "old_text": "ngx_log_debug2(NGX_LOG_DEBUG_EVENT, c->log, 0,\n                           \"writev: %d of %uz\", rc, header_size)",
          "new_text": null,
          "old_line_content": "            ngx_log_debug2(NGX_LOG_DEBUG_EVENT, c->log, 0,",
          "new_line_content": "                           rc, file->file_pos, sent, file_size + header_size);",
          "content_same": false
        },
        {
          "line": 296,
          "old_api": "ngx_log_debug1",
          "new_api": null,
          "old_text": "ngx_log_debug1(NGX_LOG_DEBUG_EVENT, c->log, err,\n                               \"sendfile() sent only %O bytes\", sent)",
          "new_text": null,
          "old_line_content": "                ngx_log_debug1(NGX_LOG_DEBUG_EVENT, c->log, err,",
          "new_line_content": "                    wev->error = 1;",
          "content_same": false
        },
        {
          "line": 361,
          "old_api": "ngx_buf_special",
          "new_api": null,
          "old_text": "ngx_buf_special(cl->buf)",
          "new_text": null,
          "old_line_content": "            if (ngx_buf_special(cl->buf)) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 269,
          "old_api": "sendfile",
          "new_api": null,
          "old_text": "sendfile(file->file->fd, c->fd, file->file_pos,\n                          file_size + header_size, &hdtr, &sent, flags)",
          "new_text": null,
          "old_line_content": "            rc = sendfile(file->file->fd, c->fd, file->file_pos,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 369,
          "old_api": "ngx_buf_size",
          "new_api": null,
          "old_text": "ngx_buf_size(cl->buf)",
          "new_text": null,
          "old_line_content": "            size = ngx_buf_size(cl->buf);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 342,
          "old_api": "ngx_connection_error",
          "new_api": null,
          "old_text": "ngx_connection_error(c, err, \"writev() failed\")",
          "new_text": null,
          "old_line_content": "                    ngx_connection_error(c, err, \"writev() failed\");",
          "new_line_content": "                    eintr = 1;",
          "content_same": false
        },
        {
          "line": 312,
          "old_api": "ngx_log_error",
          "new_api": null,
          "old_text": "ngx_log_error(NGX_LOG_ALERT, c->log, 0,\n                         \"sendfile() reported that \\\"%s\\\" was truncated at %O\",\n                         file->file->name.data, file->file_pos)",
          "new_text": null,
          "old_line_content": "                ngx_log_error(NGX_LOG_ALERT, c->log, 0,",
          "new_line_content": "                 * if rc is OK and sent equal to zero, then someone",
          "content_same": false
        },
        {
          "line": 346,
          "old_api": "ngx_log_debug0",
          "new_api": null,
          "old_text": "ngx_log_debug0(NGX_LOG_DEBUG_EVENT, c->log, err,\n                               \"writev() not ready\")",
          "new_text": null,
          "old_line_content": "                ngx_log_debug0(NGX_LOG_DEBUG_EVENT, c->log, err,",
          "new_line_content": "                    wev->error = 1;",
          "content_same": false
        },
        {
          "line": 319,
          "old_api": "ngx_log_debug4",
          "new_api": null,
          "old_text": "ngx_log_debug4(NGX_LOG_DEBUG_EVENT, c->log, 0,\n                           \"sendfile: %d, @%O %O:%uz\",\n                           rc, file->file_pos, sent, file_size + header_size)",
          "new_text": null,
          "old_line_content": "            ngx_log_debug4(NGX_LOG_DEBUG_EVENT, c->log, 0,",
          "new_line_content": "                         file->file->name.data, file->file_pos);",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 2,
      "total_additions": 11,
      "total_deletions": 11,
      "total_api_changes": 24
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 7,
        "api_related_lines": 24,
        "non_api_lines": 7,
        "non_api_line_numbers": [
          256,
          249,
          250,
          251,
          252,
          253,
          254
        ]
      }
    },
    "api_calls_before": 24,
    "api_calls_after": 24,
    "diff_info": {
      "added_lines": 7,
      "removed_lines": 2,
      "total_diff_lines": 22
    }
  }
}