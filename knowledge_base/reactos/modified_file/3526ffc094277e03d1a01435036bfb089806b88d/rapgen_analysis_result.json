{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/reactos/modified_file/3526ffc094277e03d1a01435036bfb089806b88d",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/reactos/modified_file/3526ffc094277e03d1a01435036bfb089806b88d/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/reactos/modified_file/3526ffc094277e03d1a01435036bfb089806b88d/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/reactos/modified_file/3526ffc094277e03d1a01435036bfb089806b88d/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 1512,
          "old_api": "xAllocatePoolWithTag",
          "new_api": "SSERT",
          "old_text": "xAllocatePoolWithTag(NonPagedPool, 256 * 8, TAG_BLUE);",
          "new_text": "SSERT(Irp->AssociatedIrp.SystemBuffer);",
          "old_line_content": "            DeviceExtension->FontBitfield = ExAllocatePoolWithTag(NonPagedPool, 256 * 8, TAG_BLUE);",
          "new_line_content": "            ASSERT(Irp->AssociatedIrp.SystemBuffer);",
          "content_same": false
        },
        {
          "line": 1522,
          "old_api": "crSetFont",
          "new_api": "tlCopyMemory",
          "old_text": "crSetFont(DeviceExtension->FontBitfield);",
          "new_text": "tlCopyMemory(DeviceExtension->FontBitfield, Irp->AssociatedIrp.SystemBuffer, 256 * 8);",
          "old_line_content": "                ScrSetFont(DeviceExtension->FontBitfield);",
          "new_line_content": "            RtlCopyMemory(DeviceExtension->FontBitfield, Irp->AssociatedIrp.SystemBuffer, 256 * 8);",
          "content_same": false
        },
        {
          "line": 1550,
          "old_api": "PRINT1",
          "new_api": "oGetCurrentIrpStackLocation",
          "old_text": "PRINT1(\"ScrDispatch(0x%p): stk->MajorFunction = %lu UNIMPLEMENTED\\n\",\n            DeviceObject, stk->MajorFunction);",
          "new_text": "oGetCurrentIrpStackLocation(Irp);",
          "old_line_content": "    DPRINT1(\"ScrDispatch(0x%p): stk->MajorFunction = %lu UNIMPLEMENTED\\n\",",
          "new_line_content": "    PIO_STACK_LOCATION stk = IoGetCurrentIrpStackLocation(Irp);",
          "content_same": false
        },
        {
          "line": 1554,
          "old_api": "oCompleteRequest",
          "new_api": "PRINT1",
          "old_text": "oCompleteRequest(Irp, IO_NO_INCREMENT);",
          "new_text": "PRINT1(\"ScrDispatch(0x%p): stk->MajorFunction = %lu UNIMPLEMENTED\\n\",\n            DeviceObject, stk->MajorFunction);",
          "old_line_content": "    IoCompleteRequest(Irp, IO_NO_INCREMENT);",
          "new_line_content": "    DPRINT1(\"ScrDispatch(0x%p): stk->MajorFunction = %lu UNIMPLEMENTED\\n\",",
          "content_same": false
        },
        {
          "line": 1596,
          "old_api": "crResetScreen",
          "new_api": "oCreateSymbolicLink",
          "old_text": "crResetScreen(DeviceObject->DeviceExtension, TRUE, FALSE);",
          "new_text": "oCreateSymbolicLink(&SymlinkName, &DeviceName);",
          "old_line_content": "        ScrResetScreen(DeviceObject->DeviceExtension, TRUE, FALSE);",
          "new_line_content": "    Status = IoCreateSymbolicLink(&SymlinkName, &DeviceName);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 1408,
          "old_api": null,
          "new_api": "in",
          "old_text": null,
          "new_text": "in(nMaxLength,\n                                 (DeviceExtension->Rows - dwCoord.Y)\n                                    * DeviceExtension->Columns - dwCoord.X);",
          "old_line_content": "                for (dwCount = 0; dwCount < nMaxLength; dwCount++, pChar++)",
          "new_line_content": "                nMaxLength = min(nMaxLength,",
          "content_same": false
        },
        {
          "line": 1281,
          "old_api": null,
          "new_api": "in",
          "old_text": null,
          "new_text": "in(nMaxLength,\n                                 (DeviceExtension->Rows - Buf->dwCoord.Y)\n                                    * DeviceExtension->Columns - Buf->dwCoord.X);",
          "old_line_content": "                for (dwCount = 0; dwCount < nMaxLength; dwCount++)",
          "new_line_content": "                nMaxLength = min(nMaxLength,",
          "content_same": false
        },
        {
          "line": 1538,
          "old_api": null,
          "new_api": "oCompleteRequest",
          "old_text": null,
          "new_text": "oCompleteRequest(Irp, IO_VIDEO_INCREMENT);",
          "old_line_content": "",
          "new_line_content": "    IoCompleteRequest(Irp, IO_VIDEO_INCREMENT);",
          "content_same": false
        },
        {
          "line": 1401,
          "old_api": null,
          "new_api": "CHAR)(pCoord + 1);",
          "old_text": null,
          "new_text": "CHAR)(pCoord + 1);",
          "old_line_content": "                vidmem = DeviceExtension->VideoMemory;",
          "new_line_content": "            pChar = (PCHAR)(pCoord + 1);",
          "content_same": false
        },
        {
          "line": 1552,
          "old_api": null,
          "new_api": "NREFERENCED_PARAMETER",
          "old_text": null,
          "new_text": "NREFERENCED_PARAMETER(DeviceObject);",
          "old_line_content": "",
          "new_line_content": "    UNREFERENCED_PARAMETER(DeviceObject);",
          "content_same": false
        },
        {
          "line": 1558,
          "old_api": null,
          "new_api": "oCompleteRequest",
          "old_text": null,
          "new_text": "oCompleteRequest(Irp, IO_NO_INCREMENT);",
          "old_line_content": "/*",
          "new_line_content": "    IoCompleteRequest(Irp, IO_NO_INCREMENT);",
          "content_same": false
        },
        {
          "line": 1436,
          "old_api": null,
          "new_api": "SSERT",
          "old_text": null,
          "new_text": "SSERT(Irp->MdlAddress);",
          "old_line_content": "                Status = STATUS_INSUFFICIENT_RESOURCES;",
          "new_line_content": "            ASSERT(Irp->MdlAddress);",
          "content_same": false
        },
        {
          "line": 1181,
          "old_api": null,
          "new_api": "SSERT",
          "old_text": null,
          "new_text": "SSERT(Irp->MdlAddress);",
          "old_line_content": "            if (pCoord == NULL)",
          "new_line_content": "            ASSERT(Irp->MdlAddress);",
          "content_same": false
        },
        {
          "line": 1182,
          "old_api": null,
          "new_api": "mGetSystemAddressForMdlSafe",
          "old_text": null,
          "new_text": "mGetSystemAddressForMdlSafe(Irp->MdlAddress, NormalPagePriority);",
          "old_line_content": "            {",
          "new_line_content": "            pCoord = MmGetSystemAddressForMdlSafe(Irp->MdlAddress, NormalPagePriority);",
          "content_same": false
        },
        {
          "line": 1311,
          "old_api": null,
          "new_api": "SSERT",
          "old_text": null,
          "new_text": "SSERT(Irp->AssociatedIrp.SystemBuffer);",
          "old_line_content": "",
          "new_line_content": "            ASSERT(Irp->AssociatedIrp.SystemBuffer);",
          "content_same": false
        },
        {
          "line": 1437,
          "old_api": null,
          "new_api": "mGetSystemAddressForMdlSafe",
          "old_text": null,
          "new_text": "mGetSystemAddressForMdlSafe(Irp->MdlAddress, NormalPagePriority);",
          "old_line_content": "                break;",
          "new_line_content": "            pConsoleDraw = MmGetSystemAddressForMdlSafe(Irp->MdlAddress, NormalPagePriority);",
          "content_same": false
        },
        {
          "line": 1573,
          "old_api": null,
          "new_api": "TL_CONSTANT_STRING",
          "old_text": null,
          "new_text": "TL_CONSTANT_STRING(L\"\\\\Device\\\\BlueScreen\");",
          "old_line_content": "",
          "new_line_content": "    UNICODE_STRING DeviceName = RTL_CONSTANT_STRING(L\"\\\\Device\\\\BlueScreen\");",
          "content_same": false
        },
        {
          "line": 1574,
          "old_api": null,
          "new_api": "TL_CONSTANT_STRING",
          "old_text": null,
          "new_text": "TL_CONSTANT_STRING(L\"\\\\??\\\\BlueScreen\");",
          "old_line_content": "    DriverObject->MajorFunction[IRP_MJ_CREATE] = ScrCreateClose;",
          "new_line_content": "    UNICODE_STRING SymlinkName = RTL_CONSTANT_STRING(L\"\\\\??\\\\BlueScreen\");",
          "content_same": false
        },
        {
          "line": 1576,
          "old_api": null,
          "new_api": "PRINT",
          "old_text": null,
          "new_text": "PRINT(\"Screen Driver 0.0.6\\n\");",
          "old_line_content": "    DriverObject->MajorFunction[IRP_MJ_READ]   = ScrDispatch;",
          "new_line_content": "    DPRINT(\"Screen Driver 0.0.6\\n\");",
          "content_same": false
        },
        {
          "line": 1322,
          "old_api": null,
          "new_api": "SSERT",
          "old_text": null,
          "new_text": "SSERT(Irp->MdlAddress);",
          "old_line_content": "                Status = STATUS_INSUFFICIENT_RESOURCES;",
          "new_line_content": "            ASSERT(Irp->MdlAddress);",
          "content_same": false
        },
        {
          "line": 1323,
          "old_api": null,
          "new_api": "mGetSystemAddressForMdlSafe",
          "old_text": null,
          "new_text": "mGetSystemAddressForMdlSafe(Irp->MdlAddress, NormalPagePriority);",
          "old_line_content": "                break;",
          "new_line_content": "            pChar = MmGetSystemAddressForMdlSafe(Irp->MdlAddress, NormalPagePriority);",
          "content_same": false
        },
        {
          "line": 1584,
          "old_api": null,
          "new_api": "oCreateDevice",
          "old_text": null,
          "new_text": "oCreateDevice(DriverObject,\n                            sizeof(DEVICE_EXTENSION),\n                            &DeviceName,\n                            FILE_DEVICE_SCREEN,\n                            FILE_DEVICE_SECURE_OPEN,\n                            TRUE,\n                            &DeviceObject);",
          "old_line_content": "                            FILE_DEVICE_SECURE_OPEN,",
          "new_line_content": "    Status = IoCreateDevice(DriverObject,",
          "content_same": false
        },
        {
          "line": 1457,
          "old_api": null,
          "new_api": "ax",
          "old_text": null,
          "new_text": "ax(ConsoleDraw.CursorX, 0),",
          "old_line_content": "",
          "new_line_content": "            DeviceExtension->CursorX = min(max(ConsoleDraw.CursorX, 0), DeviceExtension->Columns - 1);",
          "content_same": false
        },
        {
          "line": 1458,
          "old_api": null,
          "new_api": "ax",
          "old_text": null,
          "new_text": "ax(ConsoleDraw.CursorY, 0),",
          "old_line_content": "            // TODO: For the moment if the ConsoleDraw rectangle has borders",
          "new_line_content": "            DeviceExtension->CursorY = min(max(ConsoleDraw.CursorY, 0), DeviceExtension->Rows    - 1);",
          "content_same": false
        },
        {
          "line": 1204,
          "old_api": null,
          "new_api": "USHORT)(pCoord + 1);",
          "old_text": null,
          "new_text": "USHORT)(pCoord + 1);",
          "old_line_content": "            if (DeviceExtension->Enabled && DeviceExtension->VideoMemory)",
          "new_line_content": "            pAttr = (PUSHORT)(pCoord + 1);",
          "content_same": false
        },
        {
          "line": 1460,
          "old_api": null,
          "new_api": "crSetCursor",
          "old_text": null,
          "new_text": "crSetCursor(DeviceExtension);",
          "old_line_content": "            // to actually clip the rectangle within its borders instead?",
          "new_line_content": "                ScrSetCursor(DeviceExtension);",
          "content_same": false
        },
        {
          "line": 1591,
          "old_api": null,
          "new_api": "T_SUCCESS",
          "old_text": null,
          "new_text": "T_SUCCESS(Status))",
          "old_line_content": "",
          "new_line_content": "    if (!NT_SUCCESS(Status))",
          "content_same": false
        },
        {
          "line": 1081,
          "old_api": null,
          "new_api": "in",
          "old_text": null,
          "new_text": "in(nMaxLength,\n                                 (DeviceExtension->Rows - Buf->dwCoord.Y)\n                                    * DeviceExtension->Columns - Buf->dwCoord.X);",
          "old_line_content": "                                    * DeviceExtension->Columns - Buf->dwCoord.X);",
          "new_line_content": "                nMaxLength = min(nMaxLength,",
          "content_same": false
        },
        {
          "line": 1211,
          "old_api": null,
          "new_api": "in",
          "old_text": null,
          "new_text": "in(nMaxLength,\n                                 (DeviceExtension->Rows - dwCoord.Y)\n                                    * DeviceExtension->Columns - dwCoord.X);",
          "old_line_content": "                                    * DeviceExtension->Columns - dwCoord.X);",
          "new_line_content": "                nMaxLength = min(nMaxLength,",
          "content_same": false
        },
        {
          "line": 1597,
          "old_api": null,
          "new_api": "T_SUCCESS",
          "old_text": null,
          "new_text": "T_SUCCESS(Status))",
          "old_line_content": "        /* Now set ResetDisplayParametersDeviceExtension to enable synchronizing with INBV */",
          "new_line_content": "    if (NT_SUCCESS(Status))",
          "content_same": false
        },
        {
          "line": 1600,
          "old_api": null,
          "new_api": "crResetScreen",
          "old_text": null,
          "new_text": "crResetScreen(DeviceObject->DeviceExtension, TRUE, FALSE);",
          "old_line_content": "    }",
          "new_line_content": "        ScrResetScreen(DeviceObject->DeviceExtension, TRUE, FALSE);",
          "content_same": false
        },
        {
          "line": 1344,
          "old_api": null,
          "new_api": "in",
          "old_text": null,
          "new_text": "in(nMaxLength,\n                                 (DeviceExtension->Rows - Buf->dwCoord.Y)\n                                    * DeviceExtension->Columns - Buf->dwCoord.X);",
          "old_line_content": "                for (dwCount = 0; dwCount < nMaxLength; dwCount++, pChar++)",
          "new_line_content": "                nMaxLength = min(nMaxLength,",
          "content_same": false
        },
        {
          "line": 1607,
          "old_api": null,
          "new_api": "oDeleteDevice",
          "old_text": null,
          "new_text": "oDeleteDevice(DeviceObject);",
          "old_line_content": "",
          "new_line_content": "        IoDeleteDevice(DeviceObject);",
          "content_same": false
        },
        {
          "line": 1480,
          "old_api": null,
          "new_api": "UCHAR)(pConsoleDraw + 1);",
          "old_text": null,
          "new_text": "UCHAR)(pConsoleDraw + 1);",
          "old_line_content": "                DestDelta = DeviceExtension->Columns * 2;",
          "new_line_content": "                Src = (PUCHAR)(pConsoleDraw + 1);",
          "content_same": false
        },
        {
          "line": 1234,
          "old_api": null,
          "new_api": "SSERT",
          "old_text": null,
          "new_text": "SSERT(Irp->AssociatedIrp.SystemBuffer);",
          "old_line_content": "            DeviceExtension->CharAttribute = *(PUSHORT)Irp->AssociatedIrp.SystemBuffer;",
          "new_line_content": "            ASSERT(Irp->AssociatedIrp.SystemBuffer);",
          "content_same": false
        },
        {
          "line": 1490,
          "old_api": null,
          "new_api": "tlCopyMemory",
          "old_text": null,
          "new_text": "tlCopyMemory(Dest, Src, SrcDelta);",
          "old_line_content": "            }",
          "new_line_content": "                    RtlCopyMemory(Dest, Src, SrcDelta);",
          "content_same": false
        },
        {
          "line": 1111,
          "old_api": null,
          "new_api": "SSERT",
          "old_text": null,
          "new_text": "SSERT(Irp->AssociatedIrp.SystemBuffer);",
          "old_line_content": "            Buf = (POUTPUT_ATTRIBUTE)Irp->AssociatedIrp.SystemBuffer;",
          "new_line_content": "            ASSERT(Irp->AssociatedIrp.SystemBuffer);",
          "content_same": false
        },
        {
          "line": 1122,
          "old_api": null,
          "new_api": "SSERT",
          "old_text": null,
          "new_text": "SSERT(Irp->MdlAddress);",
          "old_line_content": "            if (pAttr == NULL)",
          "new_line_content": "            ASSERT(Irp->MdlAddress);",
          "content_same": false
        },
        {
          "line": 1123,
          "old_api": null,
          "new_api": "mGetSystemAddressForMdlSafe",
          "old_text": null,
          "new_text": "mGetSystemAddressForMdlSafe(Irp->MdlAddress, NormalPagePriority);",
          "old_line_content": "            {",
          "new_line_content": "            pAttr = MmGetSystemAddressForMdlSafe(Irp->MdlAddress, NormalPagePriority);",
          "content_same": false
        },
        {
          "line": 1380,
          "old_api": null,
          "new_api": "SSERT",
          "old_text": null,
          "new_text": "SSERT(Irp->MdlAddress);",
          "old_line_content": "                Status = STATUS_INSUFFICIENT_RESOURCES;",
          "new_line_content": "            ASSERT(Irp->MdlAddress);",
          "content_same": false
        },
        {
          "line": 1381,
          "old_api": null,
          "new_api": "mGetSystemAddressForMdlSafe",
          "old_text": null,
          "new_text": "mGetSystemAddressForMdlSafe(Irp->MdlAddress, NormalPagePriority);",
          "old_line_content": "                break;",
          "new_line_content": "            pCoord = MmGetSystemAddressForMdlSafe(Irp->MdlAddress, NormalPagePriority);",
          "content_same": false
        },
        {
          "line": 1258,
          "old_api": null,
          "new_api": "SSERT",
          "old_text": null,
          "new_text": "SSERT(Irp->AssociatedIrp.SystemBuffer);",
          "old_line_content": "            Buf = (POUTPUT_CHARACTER)Irp->AssociatedIrp.SystemBuffer;",
          "new_line_content": "            ASSERT(Irp->AssociatedIrp.SystemBuffer);",
          "content_same": false
        },
        {
          "line": 1515,
          "old_api": null,
          "new_api": "xFreePoolWithTag",
          "old_text": null,
          "new_text": "xFreePoolWithTag(DeviceExtension->FontBitfield, TAG_BLUE);",
          "old_line_content": "                Status = STATUS_NO_MEMORY;",
          "new_line_content": "                ExFreePoolWithTag(DeviceExtension->FontBitfield, TAG_BLUE);",
          "content_same": false
        },
        {
          "line": 1516,
          "old_api": null,
          "new_api": "xAllocatePoolWithTag",
          "old_text": null,
          "new_text": "xAllocatePoolWithTag(NonPagedPool, 256 * 8, TAG_BLUE);",
          "old_line_content": "                break;",
          "new_line_content": "            DeviceExtension->FontBitfield = ExAllocatePoolWithTag(NonPagedPool, 256 * 8, TAG_BLUE);",
          "content_same": false
        },
        {
          "line": 1526,
          "old_api": null,
          "new_api": "crSetFont",
          "old_text": null,
          "new_text": "crSetFont(DeviceExtension->FontBitfield);",
          "old_line_content": "            break;",
          "new_line_content": "                ScrSetFont(DeviceExtension->FontBitfield);",
          "content_same": false
        },
        {
          "line": 1145,
          "old_api": null,
          "new_api": "in",
          "old_text": null,
          "new_text": "in(nMaxLength,\n                                 (DeviceExtension->Rows - Buf->dwCoord.Y)\n                                    * DeviceExtension->Columns - Buf->dwCoord.X);",
          "old_line_content": "                                    * DeviceExtension->Columns - Buf->dwCoord.X);",
          "new_line_content": "                nMaxLength = min(nMaxLength,",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 1546,
          "old_api": "oGetCurrentIrpStackLocation",
          "new_api": null,
          "old_text": "oGetCurrentIrpStackLocation(Irp);",
          "new_text": null,
          "old_line_content": "    PIO_STACK_LOCATION stk = IoGetCurrentIrpStackLocation(Irp);",
          "new_line_content": "ScrDispatch(",
          "content_same": false
        },
        {
          "line": 1548,
          "old_api": "NREFERENCED_PARAMETER",
          "new_api": null,
          "old_text": "NREFERENCED_PARAMETER(DeviceObject);",
          "new_text": null,
          "old_line_content": "    UNREFERENCED_PARAMETER(DeviceObject);",
          "new_line_content": "    _In_ PIRP Irp)",
          "content_same": false
        },
        {
          "line": 1432,
          "old_api": "SSERT",
          "new_api": null,
          "old_text": "SSERT(Irp->MdlAddress);",
          "new_text": null,
          "old_line_content": "            ASSERT(Irp->MdlAddress);",
          "new_line_content": "            {",
          "content_same": false
        },
        {
          "line": 1433,
          "old_api": "mGetSystemAddressForMdlSafe",
          "new_api": null,
          "old_text": "mGetSystemAddressForMdlSafe(Irp->MdlAddress, NormalPagePriority);",
          "new_text": null,
          "old_line_content": "            pConsoleDraw = MmGetSystemAddressForMdlSafe(Irp->MdlAddress, NormalPagePriority);",
          "new_line_content": "                Status = STATUS_INVALID_PARAMETER;",
          "content_same": false
        },
        {
          "line": 1179,
          "old_api": "SSERT",
          "new_api": null,
          "old_text": "SSERT(Irp->MdlAddress);",
          "new_text": null,
          "old_line_content": "            ASSERT(Irp->MdlAddress);",
          "new_line_content": "                break;",
          "content_same": false
        },
        {
          "line": 1180,
          "old_api": "mGetSystemAddressForMdlSafe",
          "new_api": null,
          "old_text": "mGetSystemAddressForMdlSafe(Irp->MdlAddress, NormalPagePriority);",
          "new_text": null,
          "old_line_content": "            pCoord = MmGetSystemAddressForMdlSafe(Irp->MdlAddress, NormalPagePriority);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 1307,
          "old_api": "SSERT",
          "new_api": null,
          "old_text": "SSERT(Irp->AssociatedIrp.SystemBuffer);",
          "new_text": null,
          "old_line_content": "            ASSERT(Irp->AssociatedIrp.SystemBuffer);",
          "new_line_content": "            {",
          "content_same": false
        },
        {
          "line": 1569,
          "old_api": "TL_CONSTANT_STRING",
          "new_api": null,
          "old_text": "TL_CONSTANT_STRING(L\"\\\\Device\\\\BlueScreen\");",
          "new_text": null,
          "old_line_content": "    UNICODE_STRING DeviceName = RTL_CONSTANT_STRING(L\"\\\\Device\\\\BlueScreen\");",
          "new_line_content": "    _In_ PUNICODE_STRING RegistryPath)",
          "content_same": false
        },
        {
          "line": 1570,
          "old_api": "TL_CONSTANT_STRING",
          "new_api": null,
          "old_text": "TL_CONSTANT_STRING(L\"\\\\??\\\\BlueScreen\");",
          "new_text": null,
          "old_line_content": "    UNICODE_STRING SymlinkName = RTL_CONSTANT_STRING(L\"\\\\??\\\\BlueScreen\");",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 1572,
          "old_api": "PRINT",
          "new_api": null,
          "old_text": "PRINT(\"Screen Driver 0.0.6\\n\");",
          "new_text": null,
          "old_line_content": "    DPRINT(\"Screen Driver 0.0.6\\n\");",
          "new_line_content": "    PDEVICE_OBJECT DeviceObject;",
          "content_same": false
        },
        {
          "line": 1318,
          "old_api": "SSERT",
          "new_api": null,
          "old_text": "SSERT(Irp->MdlAddress);",
          "new_text": null,
          "old_line_content": "            ASSERT(Irp->MdlAddress);",
          "new_line_content": "            {",
          "content_same": false
        },
        {
          "line": 1319,
          "old_api": "mGetSystemAddressForMdlSafe",
          "new_api": null,
          "old_text": "mGetSystemAddressForMdlSafe(Irp->MdlAddress, NormalPagePriority);",
          "new_text": null,
          "old_line_content": "            pChar = MmGetSystemAddressForMdlSafe(Irp->MdlAddress, NormalPagePriority);",
          "new_line_content": "                Status = STATUS_SUCCESS;",
          "content_same": false
        },
        {
          "line": 1580,
          "old_api": "oCreateDevice",
          "new_api": null,
          "old_text": "oCreateDevice(DriverObject,\n                            sizeof(DEVICE_EXTENSION),\n                            &DeviceName,\n                            FILE_DEVICE_SCREEN,\n                            FILE_DEVICE_SECURE_OPEN,\n                            TRUE,\n                            &DeviceObject);",
          "new_text": null,
          "old_line_content": "    Status = IoCreateDevice(DriverObject,",
          "new_line_content": "    DriverObject->MajorFunction[IRP_MJ_READ]   = ScrDispatch;",
          "content_same": false
        },
        {
          "line": 1453,
          "old_api": "ax",
          "new_api": null,
          "old_text": "ax(ConsoleDraw.CursorX, 0),",
          "new_text": null,
          "old_line_content": "            DeviceExtension->CursorX = min(max(ConsoleDraw.CursorX, 0), DeviceExtension->Columns - 1);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1454,
          "old_api": "ax",
          "new_api": null,
          "old_text": "ax(ConsoleDraw.CursorY, 0),",
          "new_text": null,
          "old_line_content": "            DeviceExtension->CursorY = min(max(ConsoleDraw.CursorY, 0), DeviceExtension->Rows    - 1);",
          "new_line_content": "            Irp->IoStatus.Information = 0;",
          "content_same": false
        },
        {
          "line": 1456,
          "old_api": "crSetCursor",
          "new_api": null,
          "old_text": "crSetCursor(DeviceExtension);",
          "new_text": null,
          "old_line_content": "                ScrSetCursor(DeviceExtension);",
          "new_line_content": "            /* Set the cursor position, clipping it to the screen */",
          "content_same": false
        },
        {
          "line": 1202,
          "old_api": "USHORT)(pCoord + 1);",
          "new_api": null,
          "old_text": "USHORT)(pCoord + 1);",
          "new_text": null,
          "old_line_content": "            pAttr = (PUSHORT)(pCoord + 1);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 1587,
          "old_api": "T_SUCCESS",
          "new_api": null,
          "old_text": "T_SUCCESS(Status))",
          "new_text": null,
          "old_line_content": "    if (!NT_SUCCESS(Status))",
          "new_line_content": "                            FILE_DEVICE_SCREEN,",
          "content_same": false
        },
        {
          "line": 1079,
          "old_api": "in",
          "new_api": null,
          "old_text": "in(nMaxLength,\n                                 (DeviceExtension->Rows - Buf->dwCoord.Y)\n                                    * DeviceExtension->Columns - Buf->dwCoord.X);",
          "new_text": null,
          "old_line_content": "                nMaxLength = min(nMaxLength,",
          "new_line_content": "                offset = (Buf->dwCoord.X + Buf->dwCoord.Y * DeviceExtension->Columns) * 2 + 1;",
          "content_same": false
        },
        {
          "line": 1592,
          "old_api": "oCreateSymbolicLink",
          "new_api": null,
          "old_text": "oCreateSymbolicLink(&SymlinkName, &DeviceName);",
          "new_text": null,
          "old_line_content": "    Status = IoCreateSymbolicLink(&SymlinkName, &DeviceName);",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 1593,
          "old_api": "T_SUCCESS",
          "new_api": null,
          "old_text": "T_SUCCESS(Status))",
          "new_text": null,
          "old_line_content": "    if (NT_SUCCESS(Status))",
          "new_line_content": "        return Status;",
          "content_same": false
        },
        {
          "line": 1209,
          "old_api": "in",
          "new_api": null,
          "old_text": "in(nMaxLength,\n                                 (DeviceExtension->Rows - dwCoord.Y)\n                                    * DeviceExtension->Columns - dwCoord.X);",
          "new_text": null,
          "old_line_content": "                nMaxLength = min(nMaxLength,",
          "new_line_content": "                offset = (dwCoord.X + dwCoord.Y * DeviceExtension->Columns) * 2 + 1;",
          "content_same": false
        },
        {
          "line": 1340,
          "old_api": "in",
          "new_api": null,
          "old_text": "in(nMaxLength,\n                                 (DeviceExtension->Rows - Buf->dwCoord.Y)\n                                    * DeviceExtension->Columns - Buf->dwCoord.X);",
          "new_text": null,
          "old_line_content": "                nMaxLength = min(nMaxLength,",
          "new_line_content": "            {",
          "content_same": false
        },
        {
          "line": 1603,
          "old_api": "oDeleteDevice",
          "new_api": null,
          "old_text": "oDeleteDevice(DeviceObject);",
          "new_text": null,
          "old_line_content": "        IoDeleteDevice(DeviceObject);",
          "new_line_content": "        DeviceObject->Flags &= ~DO_DEVICE_INITIALIZING;",
          "content_same": false
        },
        {
          "line": 1476,
          "old_api": "UCHAR)(pConsoleDraw + 1);",
          "new_api": null,
          "old_text": "UCHAR)(pConsoleDraw + 1);",
          "new_text": null,
          "old_line_content": "                Src = (PUCHAR)(pConsoleDraw + 1);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 1486,
          "old_api": "tlCopyMemory",
          "new_api": null,
          "old_text": "tlCopyMemory(Dest, Src, SrcDelta);",
          "new_text": null,
          "old_line_content": "                    RtlCopyMemory(Dest, Src, SrcDelta);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1232,
          "old_api": "SSERT",
          "new_api": null,
          "old_text": "SSERT(Irp->AssociatedIrp.SystemBuffer);",
          "new_text": null,
          "old_line_content": "            ASSERT(Irp->AssociatedIrp.SystemBuffer);",
          "new_line_content": "                break;",
          "content_same": false
        },
        {
          "line": 1109,
          "old_api": "SSERT",
          "new_api": null,
          "old_text": "SSERT(Irp->AssociatedIrp.SystemBuffer);",
          "new_text": null,
          "old_line_content": "            ASSERT(Irp->AssociatedIrp.SystemBuffer);",
          "new_line_content": "                break;",
          "content_same": false
        },
        {
          "line": 1120,
          "old_api": "SSERT",
          "new_api": null,
          "old_text": "SSERT(Irp->MdlAddress);",
          "new_text": null,
          "old_line_content": "            ASSERT(Irp->MdlAddress);",
          "new_line_content": "                break;",
          "content_same": false
        },
        {
          "line": 1121,
          "old_api": "mGetSystemAddressForMdlSafe",
          "new_api": null,
          "old_text": "mGetSystemAddressForMdlSafe(Irp->MdlAddress, NormalPagePriority);",
          "new_text": null,
          "old_line_content": "            pAttr = MmGetSystemAddressForMdlSafe(Irp->MdlAddress, NormalPagePriority);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 1376,
          "old_api": "SSERT",
          "new_api": null,
          "old_text": "SSERT(Irp->MdlAddress);",
          "new_text": null,
          "old_line_content": "            ASSERT(Irp->MdlAddress);",
          "new_line_content": "            {",
          "content_same": false
        },
        {
          "line": 1377,
          "old_api": "mGetSystemAddressForMdlSafe",
          "new_api": null,
          "old_text": "mGetSystemAddressForMdlSafe(Irp->MdlAddress, NormalPagePriority);",
          "new_text": null,
          "old_line_content": "            pCoord = MmGetSystemAddressForMdlSafe(Irp->MdlAddress, NormalPagePriority);",
          "new_line_content": "                Status = STATUS_INVALID_PARAMETER;",
          "content_same": false
        },
        {
          "line": 1508,
          "old_api": "SSERT",
          "new_api": null,
          "old_text": "SSERT(Irp->AssociatedIrp.SystemBuffer);",
          "new_text": null,
          "old_line_content": "            ASSERT(Irp->AssociatedIrp.SystemBuffer);",
          "new_line_content": "            {",
          "content_same": false
        },
        {
          "line": 1511,
          "old_api": "xFreePoolWithTag",
          "new_api": null,
          "old_text": "xFreePoolWithTag(DeviceExtension->FontBitfield, TAG_BLUE);",
          "new_text": null,
          "old_line_content": "                ExFreePoolWithTag(DeviceExtension->FontBitfield, TAG_BLUE);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 1256,
          "old_api": "SSERT",
          "new_api": null,
          "old_text": "SSERT(Irp->AssociatedIrp.SystemBuffer);",
          "new_text": null,
          "old_line_content": "            ASSERT(Irp->AssociatedIrp.SystemBuffer);",
          "new_line_content": "                break;",
          "content_same": false
        },
        {
          "line": 1518,
          "old_api": "tlCopyMemory",
          "new_api": null,
          "old_text": "tlCopyMemory(DeviceExtension->FontBitfield, Irp->AssociatedIrp.SystemBuffer, 256 * 8);",
          "new_text": null,
          "old_line_content": "            RtlCopyMemory(DeviceExtension->FontBitfield, Irp->AssociatedIrp.SystemBuffer, 256 * 8);",
          "new_line_content": "            {",
          "content_same": false
        },
        {
          "line": 1397,
          "old_api": "CHAR)(pCoord + 1);",
          "new_api": null,
          "old_text": "CHAR)(pCoord + 1);",
          "new_text": null,
          "old_line_content": "            pChar = (PCHAR)(pCoord + 1);",
          "new_line_content": "                Status = STATUS_SUCCESS;",
          "content_same": false
        },
        {
          "line": 1143,
          "old_api": "in",
          "new_api": null,
          "old_text": "in(nMaxLength,\n                                 (DeviceExtension->Rows - Buf->dwCoord.Y)\n                                    * DeviceExtension->Columns - Buf->dwCoord.X);",
          "new_text": null,
          "old_line_content": "                nMaxLength = min(nMaxLength,",
          "new_line_content": "                offset = (Buf->dwCoord.X + Buf->dwCoord.Y * DeviceExtension->Columns) * 2 + 1;",
          "content_same": false
        },
        {
          "line": 1404,
          "old_api": "in",
          "new_api": null,
          "old_text": "in(nMaxLength,\n                                 (DeviceExtension->Rows - dwCoord.Y)\n                                    * DeviceExtension->Columns - dwCoord.X);",
          "new_text": null,
          "old_line_content": "                nMaxLength = min(nMaxLength,",
          "new_line_content": "            {",
          "content_same": false
        },
        {
          "line": 1277,
          "old_api": "in",
          "new_api": null,
          "old_text": "in(nMaxLength,\n                                 (DeviceExtension->Rows - Buf->dwCoord.Y)\n                                    * DeviceExtension->Columns - Buf->dwCoord.X);",
          "new_text": null,
          "old_line_content": "                nMaxLength = min(nMaxLength,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1534,
          "old_api": "oCompleteRequest",
          "new_api": null,
          "old_text": "oCompleteRequest(Irp, IO_VIDEO_INCREMENT);",
          "new_text": null,
          "old_line_content": "    IoCompleteRequest(Irp, IO_VIDEO_INCREMENT);",
          "new_line_content": "            Status = STATUS_NOT_IMPLEMENTED;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 5,
      "total_additions": 41,
      "total_deletions": 41,
      "total_api_changes": 87
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 8,
        "api_related_lines": 87,
        "non_api_lines": 7,
        "non_api_line_numbers": [
          1283,
          1287,
          1076,
          1077,
          1276,
          1085,
          1087
        ]
      }
    },
    "api_calls_before": 198,
    "api_calls_after": 198,
    "diff_info": {
      "added_lines": 6,
      "removed_lines": 2,
      "total_diff_lines": 41
    }
  }
}