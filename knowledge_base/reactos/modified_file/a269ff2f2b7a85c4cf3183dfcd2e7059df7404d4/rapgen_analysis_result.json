{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/reactos/modified_file/a269ff2f2b7a85c4cf3183dfcd2e7059df7404d4",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/reactos/modified_file/a269ff2f2b7a85c4cf3183dfcd2e7059df7404d4/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/reactos/modified_file/a269ff2f2b7a85c4cf3183dfcd2e7059df7404d4/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/reactos/modified_file/a269ff2f2b7a85c4cf3183dfcd2e7059df7404d4/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 283,
          "old_api": "ExFreePool",
          "new_api": "PVOID)((ULONG_PTR)Privileges + sizeof(PRIVILEGE_SET) - sizeof(LUID_AND_ATTRIBUTES))",
          "old_text": "ExFreePool(AuxData->PrivilegeSet)",
          "new_text": "PVOID)((ULONG_PTR)Privileges + sizeof(PRIVILEGE_SET) - sizeof(LUID_AND_ATTRIBUTES))",
          "old_line_content": "            ExFreePool(AuxData->PrivilegeSet);",
          "new_line_content": "                      (PVOID)((ULONG_PTR)Privileges + sizeof(PRIVILEGE_SET) - sizeof(LUID_AND_ATTRIBUTES)),",
          "content_same": false
        },
        {
          "line": 453,
          "old_api": "FIELD_OFFSET",
          "new_api": "KeGetPreviousMode",
          "old_text": "FIELD_OFFSET(PRIVILEGE_SET,\n                                       Privilege)",
          "new_text": "KeGetPreviousMode()",
          "old_line_content": "                          FIELD_OFFSET(PRIVILEGE_SET,",
          "new_line_content": "    PreviousMode = KeGetPreviousMode();",
          "content_same": false
        },
        {
          "line": 469,
          "old_api": "ProbeForWrite",
          "new_api": "FIELD_OFFSET",
          "old_text": "ProbeForWrite(RequiredPrivileges,\n                          FIELD_OFFSET(PRIVILEGE_SET,\n                                       Privilege[PrivilegeCount]),\n                          sizeof(ULONG))",
          "new_text": "FIELD_OFFSET(PRIVILEGE_SET,\n                             Privilege[PrivilegeCount])",
          "old_line_content": "            ProbeForWrite(RequiredPrivileges,",
          "new_line_content": "            if (FIELD_OFFSET(PRIVILEGE_SET,",
          "content_same": false
        },
        {
          "line": 505,
          "old_api": "ObDereferenceObject",
          "new_api": "NT_SUCCESS",
          "old_text": "ObDereferenceObject(Token)",
          "new_text": "NT_SUCCESS(Status)",
          "old_line_content": "        ObDereferenceObject(Token);",
          "new_line_content": "    if (!NT_SUCCESS(Status))",
          "content_same": false
        },
        {
          "line": 544,
          "old_api": "_SEH2_GetExceptionCode",
          "new_api": "RtlCopyMemory",
          "old_text": "_SEH2_GetExceptionCode()",
          "new_text": "RtlCopyMemory(RequiredPrivileges->Privilege,\n                      Privileges,\n                      PrivilegeCount * sizeof(LUID_AND_ATTRIBUTES))",
          "old_line_content": "        Status = _SEH2_GetExceptionCode();",
          "new_line_content": "        RtlCopyMemory(RequiredPrivileges->Privilege,",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 513,
          "old_api": null,
          "new_api": "ObDereferenceObject",
          "old_text": null,
          "new_text": "ObDereferenceObject(Token)",
          "old_line_content": "                                             NULL,",
          "new_line_content": "        ObDereferenceObject(Token);",
          "content_same": false
        },
        {
          "line": 385,
          "old_api": null,
          "new_api": "SePrivilegedServiceAuditAlarm",
          "old_text": null,
          "new_text": "SePrivilegedServiceAuditAlarm(0,\n                                      &SubjectContext,\n                                      &PrivilegeValue)",
          "old_line_content": "    return Result;",
          "new_line_content": "        SePrivilegedServiceAuditAlarm(0,",
          "content_same": false
        },
        {
          "line": 518,
          "old_api": null,
          "new_api": "SeCaptureLuidAndAttributesArray",
          "old_text": null,
          "new_text": "SeCaptureLuidAndAttributesArray(RequiredPrivileges->Privilege,\n                                             PrivilegeCount,\n                                             PreviousMode,\n                                             NULL,\n                                             0,\n                                             PagedPool,\n                                             TRUE,\n                                             &Privileges,\n                                             &Length)",
          "old_line_content": "                                             &Length);",
          "new_line_content": "    Status = SeCaptureLuidAndAttributesArray(RequiredPrivileges->Privilege,",
          "content_same": false
        },
        {
          "line": 391,
          "old_api": null,
          "new_api": "SeReleaseSubjectContext",
          "old_text": null,
          "new_text": "SeReleaseSubjectContext(&SubjectContext)",
          "old_line_content": "                        IN HANDLE ObjectHandle,",
          "new_line_content": "    SeReleaseSubjectContext(&SubjectContext);",
          "content_same": false
        },
        {
          "line": 527,
          "old_api": null,
          "new_api": "NT_SUCCESS",
          "old_text": null,
          "new_text": "NT_SUCCESS(Status)",
          "old_line_content": "                                    PrivilegeCount,",
          "new_line_content": "    if (!NT_SUCCESS(Status))",
          "content_same": false
        },
        {
          "line": 272,
          "old_api": null,
          "new_api": "ExAllocatePool",
          "old_text": null,
          "new_text": "ExAllocatePool(PagedPool, NewPrivilegeSetSize)",
          "old_line_content": "",
          "new_line_content": "        PrivilegeSet = ExAllocatePool(PagedPool, NewPrivilegeSetSize);",
          "content_same": false
        },
        {
          "line": 529,
          "old_api": null,
          "new_api": "ObDereferenceObject (Token)",
          "old_text": null,
          "new_text": "ObDereferenceObject (Token)",
          "old_line_content": "                                    PreviousMode);",
          "new_line_content": "        ObDereferenceObject (Token);",
          "content_same": false
        },
        {
          "line": 145,
          "old_api": null,
          "new_api": "PAGED_CODE",
          "old_text": null,
          "new_text": "PAGED_CODE()",
          "old_line_content": "",
          "new_line_content": "    PAGED_CODE();",
          "content_same": false
        },
        {
          "line": 533,
          "old_api": null,
          "new_api": "SepPrivilegeCheck",
          "old_text": null,
          "new_text": "SepPrivilegeCheck(Token,\n                                    Privileges,\n                                    PrivilegeCount,\n                                    PrivilegeControl,\n                                    PreviousMode)",
          "old_line_content": "    /* return the array */",
          "new_line_content": "    CheckResult = SepPrivilegeCheck(Token,",
          "content_same": false
        },
        {
          "line": 277,
          "old_api": null,
          "new_api": "RtlCopyMemory",
          "old_text": null,
          "new_text": "RtlCopyMemory(PrivilegeSet,\n                      AuxData->PrivilegeSet,\n                      OldPrivilegeSetSize)",
          "old_line_content": "",
          "new_line_content": "        RtlCopyMemory(PrivilegeSet,",
          "content_same": false
        },
        {
          "line": 407,
          "old_api": null,
          "new_api": "PAGED_CODE",
          "old_text": null,
          "new_text": "PAGED_CODE()",
          "old_line_content": "",
          "new_line_content": "    PAGED_CODE();",
          "content_same": false
        },
        {
          "line": 409,
          "old_api": null,
          "new_api": "SeCaptureSubjectContext",
          "old_text": null,
          "new_text": "SeCaptureSubjectContext(&SubjectContext)",
          "old_line_content": "    if (PreviousMode != KernelMode)",
          "new_line_content": "    SeCaptureSubjectContext(&SubjectContext);",
          "content_same": false
        },
        {
          "line": 282,
          "old_api": null,
          "new_api": "PVOID)((ULONG_PTR)PrivilegeSet + OldPrivilegeSetSize)",
          "old_text": null,
          "new_text": "PVOID)((ULONG_PTR)PrivilegeSet + OldPrivilegeSetSize)",
          "old_line_content": "        if (AccessState->PrivilegesAllocated == TRUE)",
          "new_line_content": "        RtlCopyMemory((PVOID)((ULONG_PTR)PrivilegeSet + OldPrivilegeSetSize),",
          "content_same": false
        },
        {
          "line": 539,
          "old_api": null,
          "new_api": "ObDereferenceObject",
          "old_text": null,
          "new_text": "ObDereferenceObject(Token)",
          "old_line_content": "        *Result = CheckResult;",
          "new_line_content": "    ObDereferenceObject(Token);",
          "content_same": false
        },
        {
          "line": 416,
          "old_api": null,
          "new_api": "SePrivilegeCheck",
          "old_text": null,
          "new_text": "SePrivilegeCheck(&Priv, &SubjectContext, PreviousMode)",
          "old_line_content": "                                    Result,",
          "new_line_content": "    Result = SePrivilegeCheck(&Priv, &SubjectContext, PreviousMode);",
          "content_same": false
        },
        {
          "line": 291,
          "old_api": null,
          "new_api": "ExFreePool",
          "old_text": null,
          "new_text": "ExFreePool(AuxData->PrivilegeSet)",
          "old_line_content": "    else",
          "new_line_content": "            ExFreePool(AuxData->PrivilegeSet);",
          "content_same": false
        },
        {
          "line": 164,
          "old_api": null,
          "new_api": "ROUND_UP",
          "old_text": null,
          "new_text": "ROUND_UP(BufferSize, 4)",
          "old_line_content": "                         BufferSize,",
          "new_line_content": "    *Length = ROUND_UP(BufferSize, 4); /* round up to a 4 byte alignment */",
          "content_same": false
        },
        {
          "line": 420,
          "old_api": null,
          "new_api": "SePrivilegeObjectAuditAlarm",
          "old_text": null,
          "new_text": "SePrivilegeObjectAuditAlarm(ObjectHandle,\n                                    &SubjectContext,\n                                    DesiredAccess,\n                                    &PrivilegeValue,\n                                    Result,\n                                    PreviousMode)",
          "old_line_content": "",
          "new_line_content": "        SePrivilegeObjectAuditAlarm(ObjectHandle,",
          "content_same": false
        },
        {
          "line": 552,
          "old_api": null,
          "new_api": "_SEH2_GetExceptionCode",
          "old_text": null,
          "new_text": "_SEH2_GetExceptionCode()",
          "old_line_content": "    return Status;",
          "new_line_content": "        Status = _SEH2_GetExceptionCode();",
          "content_same": false
        },
        {
          "line": 171,
          "old_api": null,
          "new_api": "ProbeForRead",
          "old_text": null,
          "new_text": "ProbeForRead(Src,\n                         BufferSize,\n                         sizeof(ULONG))",
          "old_line_content": "        }",
          "new_line_content": "            ProbeForRead(Src,",
          "content_same": false
        },
        {
          "line": 556,
          "old_api": null,
          "new_api": "SeReleaseLuidAndAttributesArray",
          "old_text": null,
          "new_text": "SeReleaseLuidAndAttributesArray(Privileges,\n                                    PreviousMode,\n                                    TRUE)",
          "old_line_content": "",
          "new_line_content": "    SeReleaseLuidAndAttributesArray(Privileges,",
          "content_same": false
        },
        {
          "line": 429,
          "old_api": null,
          "new_api": "SeReleaseSubjectContext",
          "old_text": null,
          "new_text": "SeReleaseSubjectContext(&SubjectContext)",
          "old_line_content": "NTAPI",
          "new_line_content": "    SeReleaseSubjectContext(&SubjectContext);",
          "content_same": false
        },
        {
          "line": 302,
          "old_api": null,
          "new_api": "PVOID)((ULONG_PTR)AuxData->PrivilegeSet + OldPrivilegeSetSize)",
          "old_text": null,
          "new_text": "PVOID)((ULONG_PTR)AuxData->PrivilegeSet + OldPrivilegeSetSize)",
          "old_line_content": "    return STATUS_SUCCESS;",
          "new_line_content": "        RtlCopyMemory((PVOID)((ULONG_PTR)AuxData->PrivilegeSet + OldPrivilegeSetSize),",
          "content_same": false
        },
        {
          "line": 303,
          "old_api": null,
          "new_api": "PVOID)((ULONG_PTR)Privileges + sizeof(PRIVILEGE_SET) - sizeof(LUID_AND_ATTRIBUTES))",
          "old_text": null,
          "new_text": "PVOID)((ULONG_PTR)Privileges + sizeof(PRIVILEGE_SET) - sizeof(LUID_AND_ATTRIBUTES))",
          "old_line_content": "}",
          "new_line_content": "                      (PVOID)((ULONG_PTR)Privileges + sizeof(PRIVILEGE_SET) - sizeof(LUID_AND_ATTRIBUTES)),",
          "content_same": false
        },
        {
          "line": 320,
          "old_api": null,
          "new_api": "PAGED_CODE",
          "old_text": null,
          "new_text": "PAGED_CODE()",
          "old_line_content": "NTAPI",
          "new_line_content": "    PAGED_CODE();",
          "content_same": false
        },
        {
          "line": 321,
          "old_api": null,
          "new_api": "ExFreePool",
          "old_text": null,
          "new_text": "ExFreePool(Privileges)",
          "old_line_content": "SePrivilegeCheck(PPRIVILEGE_SET Privileges,",
          "new_line_content": "    ExFreePool(Privileges);",
          "content_same": false
        },
        {
          "line": 451,
          "old_api": null,
          "new_api": "PAGED_CODE",
          "old_text": null,
          "new_text": "PAGED_CODE()",
          "old_line_content": "        {",
          "new_line_content": "    PAGED_CODE();",
          "content_same": false
        },
        {
          "line": 196,
          "old_api": null,
          "new_api": "ExAllocatePool",
          "old_text": null,
          "new_text": "ExAllocatePool(PoolType,\n                               BufferSize)",
          "old_line_content": "    /* copy the array to the buffer */",
          "new_line_content": "        *Dest = ExAllocatePool(PoolType,",
          "content_same": false
        },
        {
          "line": 460,
          "old_api": null,
          "new_api": "ProbeForWrite",
          "old_text": null,
          "new_text": "ProbeForWrite(RequiredPrivileges,\n                          FIELD_OFFSET(PRIVILEGE_SET,\n                                       Privilege),\n                          sizeof(ULONG))",
          "old_line_content": "            /* Check PrivilegeCount to avoid an integer overflow! */",
          "new_line_content": "            ProbeForWrite(RequiredPrivileges,",
          "content_same": false
        },
        {
          "line": 207,
          "old_api": null,
          "new_api": "RtlCopyMemory",
          "old_text": null,
          "new_text": "RtlCopyMemory(*Dest,\n                      Src,\n                      BufferSize)",
          "old_line_content": "    _SEH2_END;",
          "new_line_content": "        RtlCopyMemory(*Dest,",
          "content_same": false
        },
        {
          "line": 335,
          "old_api": null,
          "new_api": "PAGED_CODE",
          "old_text": null,
          "new_text": "PAGED_CODE()",
          "old_line_content": "        Token = SubjectContext->ClientToken;",
          "new_line_content": "    PAGED_CODE();",
          "content_same": false
        },
        {
          "line": 213,
          "old_api": null,
          "new_api": "_SEH2_GetExceptionCode",
          "old_text": null,
          "new_text": "_SEH2_GetExceptionCode()",
          "old_line_content": "",
          "new_line_content": "        Status = _SEH2_GetExceptionCode();",
          "content_same": false
        },
        {
          "line": 217,
          "old_api": null,
          "new_api": "NT_SUCCESS",
          "old_text": null,
          "new_text": "NT_SUCCESS(Status)",
          "old_line_content": "VOID",
          "new_line_content": "    if (!NT_SUCCESS(Status) && AllocatedMem == NULL)",
          "content_same": false
        },
        {
          "line": 219,
          "old_api": null,
          "new_api": "ExFreePool",
          "old_text": null,
          "new_text": "ExFreePool(*Dest)",
          "old_line_content": "SeReleaseLuidAndAttributesArray(PLUID_AND_ATTRIBUTES Privilege,",
          "new_line_content": "        ExFreePool(*Dest);",
          "content_same": false
        },
        {
          "line": 477,
          "old_api": null,
          "new_api": "ProbeForWrite",
          "old_text": null,
          "new_text": "ProbeForWrite(RequiredPrivileges,\n                          FIELD_OFFSET(PRIVILEGE_SET,\n                                       Privilege[PrivilegeCount]),\n                          sizeof(ULONG))",
          "old_line_content": "        {",
          "new_line_content": "            ProbeForWrite(RequiredPrivileges,",
          "content_same": false
        },
        {
          "line": 350,
          "old_api": null,
          "new_api": "SepPrivilegeCheck",
          "old_text": null,
          "new_text": "SepPrivilegeCheck(Token,\n                             Privileges->Privilege,\n                             Privileges->PrivilegeCount,\n                             Privileges->Control,\n                             PreviousMode)",
          "old_line_content": " * @implemented",
          "new_line_content": "    return SepPrivilegeCheck(Token,",
          "content_same": false
        },
        {
          "line": 478,
          "old_api": null,
          "new_api": "FIELD_OFFSET",
          "old_text": null,
          "new_text": "FIELD_OFFSET(PRIVILEGE_SET,\n                                       Privilege[PrivilegeCount])",
          "old_line_content": "            /* Return the exception code */",
          "new_line_content": "                          FIELD_OFFSET(PRIVILEGE_SET,",
          "content_same": false
        },
        {
          "line": 482,
          "old_api": null,
          "new_api": "ProbeForWriteBoolean",
          "old_text": null,
          "new_text": "ProbeForWriteBoolean(Result)",
          "old_line_content": "    }",
          "new_line_content": "            ProbeForWriteBoolean(Result);",
          "content_same": false
        },
        {
          "line": 231,
          "old_api": null,
          "new_api": "PAGED_CODE",
          "old_text": null,
          "new_text": "PAGED_CODE()",
          "old_line_content": "",
          "new_line_content": "    PAGED_CODE();",
          "content_same": false
        },
        {
          "line": 236,
          "old_api": null,
          "new_api": "ExFreePool",
          "old_text": null,
          "new_text": "ExFreePool(Privilege)",
          "old_line_content": " */",
          "new_line_content": "        ExFreePool(Privilege);",
          "content_same": false
        },
        {
          "line": 369,
          "old_api": null,
          "new_api": "PAGED_CODE",
          "old_text": null,
          "new_text": "PAGED_CODE()",
          "old_line_content": "",
          "new_line_content": "    PAGED_CODE();",
          "content_same": false
        },
        {
          "line": 371,
          "old_api": null,
          "new_api": "SeCaptureSubjectContext",
          "old_text": null,
          "new_text": "SeCaptureSubjectContext(&SubjectContext)",
          "old_line_content": "                              &SubjectContext,",
          "new_line_content": "    SeCaptureSubjectContext(&SubjectContext);",
          "content_same": false
        },
        {
          "line": 499,
          "old_api": null,
          "new_api": "ObReferenceObjectByHandle",
          "old_text": null,
          "new_text": "ObReferenceObjectByHandle(ClientToken,\n                                       TOKEN_QUERY,\n                                       SeTokenObjectType,\n                                       PreviousMode,\n                                       (PVOID*)&Token,\n                                       NULL)",
          "old_line_content": "        return Status;",
          "new_line_content": "    Status = ObReferenceObjectByHandle(ClientToken,",
          "content_same": false
        },
        {
          "line": 378,
          "old_api": null,
          "new_api": "SePrivilegeCheck",
          "old_text": null,
          "new_text": "SePrivilegeCheck(&Priv,\n                              &SubjectContext,\n                              PreviousMode)",
          "old_line_content": "                                      &SubjectContext,",
          "new_line_content": "    Result = SePrivilegeCheck(&Priv,",
          "content_same": false
        },
        {
          "line": 126,
          "old_api": null,
          "new_api": "NT_ASSERT",
          "old_text": null,
          "new_text": "NT_ASSERT(Required > 0)",
          "old_line_content": "                                KPROCESSOR_MODE PreviousMode,",
          "new_line_content": "    NT_ASSERT(Required > 0);",
          "content_same": false
        },
        {
          "line": 255,
          "old_api": null,
          "new_api": "PAGED_CODE",
          "old_text": null,
          "new_text": "PAGED_CODE()",
          "old_line_content": "",
          "new_line_content": "    PAGED_CODE();",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 519,
          "old_api": "NT_SUCCESS",
          "new_api": null,
          "old_text": "NT_SUCCESS(Status)",
          "new_text": null,
          "old_line_content": "    if (!NT_SUCCESS(Status))",
          "new_line_content": "                                             PrivilegeCount,",
          "content_same": false
        },
        {
          "line": 264,
          "old_api": "ExAllocatePool",
          "new_api": null,
          "old_text": "ExAllocatePool(PagedPool, NewPrivilegeSetSize)",
          "new_text": null,
          "old_line_content": "        PrivilegeSet = ExAllocatePool(PagedPool, NewPrivilegeSetSize);",
          "new_line_content": "    if (AuxData->PrivilegeSet->PrivilegeCount +",
          "content_same": false
        },
        {
          "line": 521,
          "old_api": "ObDereferenceObject (Token)",
          "new_api": null,
          "old_text": "ObDereferenceObject (Token)",
          "new_text": null,
          "old_line_content": "        ObDereferenceObject (Token);",
          "new_line_content": "                                             NULL,",
          "content_same": false
        },
        {
          "line": 137,
          "old_api": "PAGED_CODE",
          "new_api": null,
          "old_text": "PAGED_CODE()",
          "new_text": null,
          "old_line_content": "    PAGED_CODE();",
          "new_line_content": "                                POOL_TYPE PoolType,",
          "content_same": false
        },
        {
          "line": 525,
          "old_api": "SepPrivilegeCheck",
          "new_api": null,
          "old_text": "SepPrivilegeCheck(Token,\n                                    Privileges,\n                                    PrivilegeCount,\n                                    PrivilegeControl,\n                                    PreviousMode)",
          "new_text": null,
          "old_line_content": "    CheckResult = SepPrivilegeCheck(Token,",
          "new_line_content": "                                             &Privileges,",
          "content_same": false
        },
        {
          "line": 269,
          "old_api": "RtlCopyMemory",
          "new_api": null,
          "old_text": "RtlCopyMemory(PrivilegeSet,\n                      AuxData->PrivilegeSet,\n                      OldPrivilegeSetSize)",
          "new_text": null,
          "old_line_content": "        RtlCopyMemory(PrivilegeSet,",
          "new_line_content": "                              Privileges->PrivilegeCount * sizeof(LUID_AND_ATTRIBUTES);",
          "content_same": false
        },
        {
          "line": 399,
          "old_api": "PAGED_CODE",
          "new_api": null,
          "old_text": "PAGED_CODE()",
          "new_text": null,
          "old_line_content": "    PAGED_CODE();",
          "new_line_content": "                        IN HANDLE ObjectHandle,",
          "content_same": false
        },
        {
          "line": 401,
          "old_api": "SeCaptureSubjectContext",
          "new_api": null,
          "old_text": "SeCaptureSubjectContext(&SubjectContext)",
          "new_text": null,
          "old_line_content": "    SeCaptureSubjectContext(&SubjectContext);",
          "new_line_content": "                        IN KPROCESSOR_MODE PreviousMode)",
          "content_same": false
        },
        {
          "line": 274,
          "old_api": "PVOID)((ULONG_PTR)PrivilegeSet + OldPrivilegeSetSize)",
          "new_api": null,
          "old_text": "PVOID)((ULONG_PTR)PrivilegeSet + OldPrivilegeSetSize)",
          "new_text": null,
          "old_line_content": "        RtlCopyMemory((PVOID)((ULONG_PTR)PrivilegeSet + OldPrivilegeSetSize),",
          "new_line_content": "            return STATUS_INSUFFICIENT_RESOURCES;",
          "content_same": false
        },
        {
          "line": 531,
          "old_api": "ObDereferenceObject",
          "new_api": null,
          "old_text": "ObDereferenceObject(Token)",
          "new_text": null,
          "old_line_content": "    ObDereferenceObject(Token);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 275,
          "old_api": "PVOID)((ULONG_PTR)Privileges + sizeof(PRIVILEGE_SET) - sizeof(LUID_AND_ATTRIBUTES))",
          "new_api": null,
          "old_text": "PVOID)((ULONG_PTR)Privileges + sizeof(PRIVILEGE_SET) - sizeof(LUID_AND_ATTRIBUTES))",
          "new_text": null,
          "old_line_content": "                      (PVOID)((ULONG_PTR)Privileges + sizeof(PRIVILEGE_SET) - sizeof(LUID_AND_ATTRIBUTES)),",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 536,
          "old_api": "RtlCopyMemory",
          "new_api": null,
          "old_text": "RtlCopyMemory(RequiredPrivileges->Privilege,\n                      Privileges,\n                      PrivilegeCount * sizeof(LUID_AND_ATTRIBUTES))",
          "new_text": null,
          "old_line_content": "        RtlCopyMemory(RequiredPrivileges->Privilege,",
          "new_line_content": "                                    PrivilegeControl,",
          "content_same": false
        },
        {
          "line": 408,
          "old_api": "SePrivilegeCheck",
          "new_api": null,
          "old_text": "SePrivilegeCheck(&Priv, &SubjectContext, PreviousMode)",
          "new_text": null,
          "old_line_content": "    Result = SePrivilegeCheck(&Priv, &SubjectContext, PreviousMode);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 156,
          "old_api": "ROUND_UP",
          "new_api": null,
          "old_text": "ROUND_UP(BufferSize, 4)",
          "new_text": null,
          "old_line_content": "    *Length = ROUND_UP(BufferSize, 4); /* round up to a 4 byte alignment */",
          "new_line_content": "        *Dest = Src;",
          "content_same": false
        },
        {
          "line": 412,
          "old_api": "SePrivilegeObjectAuditAlarm",
          "new_api": null,
          "old_text": "SePrivilegeObjectAuditAlarm(ObjectHandle,\n                                    &SubjectContext,\n                                    DesiredAccess,\n                                    &PrivilegeValue,\n                                    Result,\n                                    PreviousMode)",
          "new_text": null,
          "old_line_content": "        SePrivilegeObjectAuditAlarm(ObjectHandle,",
          "new_line_content": "    Priv.Control = PRIVILEGE_SET_ALL_NECESSARY;",
          "content_same": false
        },
        {
          "line": 163,
          "old_api": "ProbeForRead",
          "new_api": null,
          "old_text": "ProbeForRead(Src,\n                         BufferSize,\n                         sizeof(ULONG))",
          "new_text": null,
          "old_line_content": "            ProbeForRead(Src,",
          "new_line_content": "    BufferSize = PrivilegeCount * sizeof(LUID_AND_ATTRIBUTES);",
          "content_same": false
        },
        {
          "line": 548,
          "old_api": "SeReleaseLuidAndAttributesArray",
          "new_api": null,
          "old_text": "SeReleaseLuidAndAttributesArray(Privileges,\n                                    PreviousMode,\n                                    TRUE)",
          "new_text": null,
          "old_line_content": "    SeReleaseLuidAndAttributesArray(Privileges,",
          "new_line_content": "        Status = STATUS_SUCCESS;",
          "content_same": false
        },
        {
          "line": 421,
          "old_api": "SeReleaseSubjectContext",
          "new_api": null,
          "old_text": "SeReleaseSubjectContext(&SubjectContext)",
          "new_text": null,
          "old_line_content": "    SeReleaseSubjectContext(&SubjectContext);",
          "new_line_content": "                                    &SubjectContext,",
          "content_same": false
        },
        {
          "line": 294,
          "old_api": "PVOID)((ULONG_PTR)AuxData->PrivilegeSet + OldPrivilegeSetSize)",
          "new_api": null,
          "old_text": "PVOID)((ULONG_PTR)AuxData->PrivilegeSet + OldPrivilegeSetSize)",
          "new_text": null,
          "old_line_content": "        RtlCopyMemory((PVOID)((ULONG_PTR)AuxData->PrivilegeSet + OldPrivilegeSetSize),",
          "new_line_content": "        AccessState->PrivilegesAllocated = TRUE;",
          "content_same": false
        },
        {
          "line": 295,
          "old_api": "PVOID)((ULONG_PTR)Privileges + sizeof(PRIVILEGE_SET) - sizeof(LUID_AND_ATTRIBUTES))",
          "new_api": null,
          "old_text": "PVOID)((ULONG_PTR)Privileges + sizeof(PRIVILEGE_SET) - sizeof(LUID_AND_ATTRIBUTES))",
          "new_text": null,
          "old_line_content": "                      (PVOID)((ULONG_PTR)Privileges + sizeof(PRIVILEGE_SET) - sizeof(LUID_AND_ATTRIBUTES)),",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 312,
          "old_api": "PAGED_CODE",
          "new_api": null,
          "old_text": "PAGED_CODE()",
          "new_text": null,
          "old_line_content": "    PAGED_CODE();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 313,
          "old_api": "ExFreePool",
          "new_api": null,
          "old_text": "ExFreePool(Privileges)",
          "new_text": null,
          "old_line_content": "    ExFreePool(Privileges);",
          "new_line_content": "/*",
          "content_same": false
        },
        {
          "line": 443,
          "old_api": "PAGED_CODE",
          "new_api": null,
          "old_text": "PAGED_CODE()",
          "new_text": null,
          "old_line_content": "    PAGED_CODE();",
          "new_line_content": "    PTOKEN Token;",
          "content_same": false
        },
        {
          "line": 188,
          "old_api": "ExAllocatePool",
          "new_api": null,
          "old_text": "ExAllocatePool(PoolType,\n                               BufferSize)",
          "new_text": null,
          "old_line_content": "        *Dest = ExAllocatePool(PoolType,",
          "new_line_content": "        {",
          "content_same": false
        },
        {
          "line": 445,
          "old_api": "KeGetPreviousMode",
          "new_api": null,
          "old_text": "KeGetPreviousMode()",
          "new_text": null,
          "old_line_content": "    PreviousMode = KeGetPreviousMode();",
          "new_line_content": "    ULONG PrivilegeControl = 0;",
          "content_same": false
        },
        {
          "line": 452,
          "old_api": "ProbeForWrite",
          "new_api": null,
          "old_text": "ProbeForWrite(RequiredPrivileges,\n                          FIELD_OFFSET(PRIVILEGE_SET,\n                                       Privilege),\n                          sizeof(ULONG))",
          "new_text": null,
          "old_line_content": "            ProbeForWrite(RequiredPrivileges,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 199,
          "old_api": "RtlCopyMemory",
          "new_api": null,
          "old_text": "RtlCopyMemory(*Dest,\n                      Src,\n                      BufferSize)",
          "new_text": null,
          "old_line_content": "        RtlCopyMemory(*Dest,",
          "new_line_content": "        {",
          "content_same": false
        },
        {
          "line": 327,
          "old_api": "PAGED_CODE",
          "new_api": null,
          "old_text": "PAGED_CODE()",
          "new_text": null,
          "old_line_content": "    PAGED_CODE();",
          "new_line_content": "BOOLEAN",
          "content_same": false
        },
        {
          "line": 205,
          "old_api": "_SEH2_GetExceptionCode",
          "new_api": null,
          "old_text": "_SEH2_GetExceptionCode()",
          "new_text": null,
          "old_line_content": "        Status = _SEH2_GetExceptionCode();",
          "new_line_content": "    _SEH2_TRY",
          "content_same": false
        },
        {
          "line": 209,
          "old_api": "NT_SUCCESS",
          "new_api": null,
          "old_text": "NT_SUCCESS(Status)",
          "new_text": null,
          "old_line_content": "    if (!NT_SUCCESS(Status) && AllocatedMem == NULL)",
          "new_line_content": "                      BufferSize);",
          "content_same": false
        },
        {
          "line": 211,
          "old_api": "ExFreePool",
          "new_api": null,
          "old_text": "ExFreePool(*Dest)",
          "new_text": null,
          "old_line_content": "        ExFreePool(*Dest);",
          "new_line_content": "    _SEH2_EXCEPT(EXCEPTION_EXECUTE_HANDLER)",
          "content_same": false
        },
        {
          "line": 342,
          "old_api": "SepPrivilegeCheck",
          "new_api": null,
          "old_text": "SepPrivilegeCheck(Token,\n                             Privileges->Privilege,\n                             Privileges->PrivilegeCount,\n                             Privileges->Control,\n                             PreviousMode)",
          "new_text": null,
          "old_line_content": "    return SepPrivilegeCheck(Token,",
          "new_line_content": "    {",
          "content_same": false
        },
        {
          "line": 470,
          "old_api": "FIELD_OFFSET",
          "new_api": null,
          "old_text": "FIELD_OFFSET(PRIVILEGE_SET,\n                                       Privilege[PrivilegeCount])",
          "new_text": null,
          "old_line_content": "                          FIELD_OFFSET(PRIVILEGE_SET,",
          "new_line_content": "                             Privilege[PrivilegeCount]) /",
          "content_same": false
        },
        {
          "line": 474,
          "old_api": "ProbeForWriteBoolean",
          "new_api": null,
          "old_text": "ProbeForWriteBoolean(Result)",
          "new_text": null,
          "old_line_content": "            ProbeForWriteBoolean(Result);",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 223,
          "old_api": "PAGED_CODE",
          "new_api": null,
          "old_text": "PAGED_CODE()",
          "new_text": null,
          "old_line_content": "    PAGED_CODE();",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 228,
          "old_api": "ExFreePool",
          "new_api": null,
          "old_text": "ExFreePool(Privilege)",
          "new_text": null,
          "old_line_content": "        ExFreePool(Privilege);",
          "new_line_content": "                                KPROCESSOR_MODE PreviousMode,",
          "content_same": false
        },
        {
          "line": 361,
          "old_api": "PAGED_CODE",
          "new_api": null,
          "old_text": "PAGED_CODE()",
          "new_text": null,
          "old_line_content": "    PAGED_CODE();",
          "new_line_content": "NTAPI",
          "content_same": false
        },
        {
          "line": 363,
          "old_api": "SeCaptureSubjectContext",
          "new_api": null,
          "old_text": "SeCaptureSubjectContext(&SubjectContext)",
          "new_text": null,
          "old_line_content": "    SeCaptureSubjectContext(&SubjectContext);",
          "new_line_content": "                       IN KPROCESSOR_MODE PreviousMode)",
          "content_same": false
        },
        {
          "line": 491,
          "old_api": "ObReferenceObjectByHandle",
          "new_api": null,
          "old_text": "ObReferenceObjectByHandle(ClientToken,\n                                       TOKEN_QUERY,\n                                       SeTokenObjectType,\n                                       PreviousMode,\n                                       (PVOID*)&Token,\n                                       NULL)",
          "new_text": null,
          "old_line_content": "    Status = ObReferenceObjectByHandle(ClientToken,",
          "new_line_content": "    else",
          "content_same": false
        },
        {
          "line": 497,
          "old_api": "NT_SUCCESS",
          "new_api": null,
          "old_text": "NT_SUCCESS(Status)",
          "new_text": null,
          "old_line_content": "    if (!NT_SUCCESS(Status))",
          "new_line_content": "    /* reference the token and make sure we're",
          "content_same": false
        },
        {
          "line": 370,
          "old_api": "SePrivilegeCheck",
          "new_api": null,
          "old_text": "SePrivilegeCheck(&Priv,\n                              &SubjectContext,\n                              PreviousMode)",
          "new_text": null,
          "old_line_content": "    Result = SePrivilegeCheck(&Priv,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 247,
          "old_api": "PAGED_CODE",
          "new_api": null,
          "old_text": "PAGED_CODE()",
          "new_text": null,
          "old_line_content": "    PAGED_CODE();",
          "new_line_content": "SeAppendPrivileges(IN OUT PACCESS_STATE AccessState,",
          "content_same": false
        },
        {
          "line": 377,
          "old_api": "SePrivilegedServiceAuditAlarm",
          "new_api": null,
          "old_text": "SePrivilegedServiceAuditAlarm(0,\n                                      &SubjectContext,\n                                      &PrivilegeValue)",
          "new_text": null,
          "old_line_content": "        SePrivilegedServiceAuditAlarm(0,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 510,
          "old_api": "SeCaptureLuidAndAttributesArray",
          "new_api": null,
          "old_text": "SeCaptureLuidAndAttributesArray(RequiredPrivileges->Privilege,\n                                             PrivilegeCount,\n                                             PreviousMode,\n                                             NULL,\n                                             0,\n                                             PagedPool,\n                                             TRUE,\n                                             &Privileges,\n                                             &Length)",
          "new_text": null,
          "old_line_content": "    Status = SeCaptureLuidAndAttributesArray(RequiredPrivileges->Privilege,",
          "new_line_content": "    if (Token->TokenType == TokenImpersonation &&",
          "content_same": false
        },
        {
          "line": 383,
          "old_api": "SeReleaseSubjectContext",
          "new_api": null,
          "old_text": "SeReleaseSubjectContext(&SubjectContext)",
          "new_text": null,
          "old_line_content": "    SeReleaseSubjectContext(&SubjectContext);",
          "new_line_content": "    {",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 5,
      "total_additions": 46,
      "total_deletions": 45,
      "total_api_changes": 96
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 13,
        "api_related_lines": 96,
        "non_api_lines": 12,
        "non_api_line_numbers": [
          110,
          111,
          112,
          113,
          114,
          115,
          116,
          93,
          118,
          119,
          125,
          127
        ]
      }
    },
    "api_calls_before": 90,
    "api_calls_after": 91,
    "diff_info": {
      "added_lines": 11,
      "removed_lines": 3,
      "total_diff_lines": 40
    }
  }
}