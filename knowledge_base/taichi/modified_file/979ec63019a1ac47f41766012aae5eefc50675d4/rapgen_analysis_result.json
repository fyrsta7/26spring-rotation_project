{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/taichi/modified_file/979ec63019a1ac47f41766012aae5eefc50675d4",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/taichi/modified_file/979ec63019a1ac47f41766012aae5eefc50675d4/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/taichi/modified_file/979ec63019a1ac47f41766012aae5eefc50675d4/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/taichi/modified_file/979ec63019a1ac47f41766012aae5eefc50675d4/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 511,
          "old_api": "std::getenv(\"PYTEST_CURRENT_TEST\")",
          "new_api": "TI_TRACE",
          "old_text": "std::getenv(\"PYTEST_CURRENT_TEST\")",
          "new_text": "TI_TRACE(\"Program finalizing...\")",
          "old_line_content": "    char *current_test = std::getenv(\"PYTEST_CURRENT_TEST\");",
          "new_line_content": "  TI_TRACE(\"Program finalizing...\");",
          "content_same": false
        },
        {
          "line": 516,
          "old_api": "substr",
          "new_api": "find_last_of",
          "old_text": "file_name.substr(slash_pos + 1)",
          "new_text": "file_name.find_last_of('/')",
          "old_line_content": "        file_name = file_name.substr(slash_pos + 1);",
          "new_line_content": "      auto slash_pos = file_name.find_last_of('/');",
          "content_same": false
        },
        {
          "line": 518,
          "old_api": "TI_ASSERT",
          "new_api": "substr",
          "old_text": "TI_ASSERT(py_pos != file_name.npos)",
          "new_text": "file_name.substr(slash_pos + 1)",
          "old_line_content": "      TI_ASSERT(py_pos != file_name.npos);",
          "new_line_content": "        file_name = file_name.substr(slash_pos + 1);",
          "content_same": false
        },
        {
          "line": 520,
          "old_api": "substr",
          "new_api": "TI_ASSERT",
          "old_text": "file_name.substr(py_pos + 5)",
          "new_text": "TI_ASSERT(py_pos != file_name.npos)",
          "old_line_content": "          file_name.substr(0, py_pos) + \"__\" + file_name.substr(py_pos + 5);",
          "new_line_content": "      TI_ASSERT(py_pos != file_name.npos);",
          "content_same": false
        },
        {
          "line": 522,
          "old_api": "TI_ASSERT",
          "new_api": "substr",
          "old_text": "TI_ASSERT(first_space_pos != file_name.npos)",
          "new_text": "file_name.substr(py_pos + 5)",
          "old_line_content": "      TI_ASSERT(first_space_pos != file_name.npos);",
          "new_line_content": "          file_name.substr(0, py_pos) + \"__\" + file_name.substr(py_pos + 5);",
          "content_same": false
        },
        {
          "line": 523,
          "old_api": "substr",
          "new_api": "find_first_of",
          "old_text": "file_name.substr(0, first_space_pos)",
          "new_text": "file_name.find_first_of(' ')",
          "old_line_content": "      file_name = file_name.substr(0, first_space_pos);",
          "new_line_content": "      auto first_space_pos = file_name.find_first_of(' ');",
          "content_same": false
        },
        {
          "line": 528,
          "old_api": "print",
          "new_api": "TI_ASSERT",
          "old_text": "stat.print(&stat_string)",
          "new_text": "TI_ASSERT(ofs)",
          "old_line_content": "      stat.print(&stat_string);",
          "new_line_content": "      TI_ASSERT(ofs);",
          "content_same": false
        },
        {
          "line": 536,
          "old_api": "terminate",
          "new_api": "synchronize",
          "old_text": "memory_pool->terminate()",
          "new_text": "synchronize()",
          "old_line_content": "  memory_pool->terminate();",
          "new_line_content": "  synchronize();",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 513,
          "old_api": null,
          "new_api": "std::getenv(\"PYTEST_CURRENT_TEST\")",
          "old_text": null,
          "new_text": "std::getenv(\"PYTEST_CURRENT_TEST\")",
          "old_line_content": "      std::string file_name = current_test;",
          "new_line_content": "    char *current_test = std::getenv(\"PYTEST_CURRENT_TEST\");",
          "content_same": false
        },
        {
          "line": 545,
          "old_api": null,
          "new_api": "fmt::ptr(this)",
          "old_text": null,
          "new_text": "fmt::ptr(this)",
          "old_line_content": "",
          "new_line_content": "  TI_TRACE(\"Program ({}) finalized.\", fmt::ptr(this));",
          "content_same": false
        },
        {
          "line": 549,
          "old_api": null,
          "new_api": "launch",
          "old_text": null,
          "new_text": "async_engine->launch(kernel)",
          "old_line_content": "",
          "new_line_content": "  async_engine->launch(kernel);",
          "content_same": false
        },
        {
          "line": 519,
          "old_api": null,
          "new_api": "find",
          "old_text": null,
          "new_text": "file_name.find(\".py::\")",
          "old_line_content": "      file_name =",
          "new_line_content": "      auto py_pos = file_name.find(\".py::\");",
          "content_same": false
        },
        {
          "line": 488,
          "old_api": null,
          "new_api": "synchronize",
          "old_text": null,
          "new_text": "synchronize()",
          "old_line_content": "  if (arch == Arch::cuda) {",
          "new_line_content": "  synchronize();",
          "content_same": false
        },
        {
          "line": 554,
          "old_api": null,
          "new_api": "finalize",
          "old_text": null,
          "new_text": "finalize()",
          "old_line_content": "",
          "new_line_content": "    finalize();",
          "content_same": false
        },
        {
          "line": 524,
          "old_api": null,
          "new_api": "TI_ASSERT",
          "old_text": null,
          "new_text": "TI_ASSERT(first_space_pos != file_name.npos)",
          "old_line_content": "      file_name += \".log\";",
          "new_line_content": "      TI_ASSERT(first_space_pos != file_name.npos);",
          "content_same": false
        },
        {
          "line": 525,
          "old_api": null,
          "new_api": "substr",
          "old_text": null,
          "new_text": "file_name.substr(0, first_space_pos)",
          "old_line_content": "      std::ofstream ofs(file_name);",
          "new_line_content": "      file_name = file_name.substr(0, first_space_pos);",
          "content_same": false
        },
        {
          "line": 495,
          "old_api": null,
          "new_api": "memcpy_device_to_host",
          "old_text": null,
          "new_text": "CUDADriver::get_instance().memcpy_device_to_host(\n          &ret, (uint64 *)result_buffer + i, sizeof(uint64))",
          "old_line_content": "        &ret, (uint64 *)result_buffer + i, sizeof(uint64));",
          "new_line_content": "      CUDADriver::get_instance().memcpy_device_to_host(",
          "content_same": false
        },
        {
          "line": 530,
          "old_api": null,
          "new_api": "print",
          "old_text": null,
          "new_text": "stat.print(&stat_string)",
          "old_line_content": "    }",
          "new_line_content": "      stat.print(&stat_string);",
          "content_same": false
        },
        {
          "line": 501,
          "old_api": null,
          "new_api": "arch_is_cpu",
          "old_text": null,
          "new_text": "arch_is_cpu(arch)",
          "old_line_content": "  } else {",
          "new_line_content": "  } else if (arch_is_cpu(arch)) {",
          "content_same": false
        },
        {
          "line": 535,
          "old_api": null,
          "new_api": "set_profiler",
          "old_text": null,
          "new_text": "runtime->set_profiler(nullptr)",
          "old_line_content": "  current_program = nullptr;",
          "new_line_content": "    runtime->set_profiler(nullptr);",
          "content_same": false
        },
        {
          "line": 504,
          "old_api": null,
          "new_api": "get_arg_as_uint64",
          "old_text": null,
          "new_text": "context.get_arg_as_uint64(i)",
          "old_line_content": "  return ret;",
          "new_line_content": "    ret = context.get_arg_as_uint64(i);",
          "content_same": false
        },
        {
          "line": 538,
          "old_api": null,
          "new_api": "terminate",
          "old_text": null,
          "new_text": "memory_pool->terminate()",
          "old_line_content": "  if (preallocated_device_buffer != nullptr)",
          "new_line_content": "  memory_pool->terminate();",
          "content_same": false
        },
        {
          "line": 541,
          "old_api": null,
          "new_api": "mem_free",
          "old_text": null,
          "new_text": "CUDADriver::get_instance().mem_free(preallocated_device_buffer)",
          "old_line_content": "  finalized = true;",
          "new_line_content": "    CUDADriver::get_instance().mem_free(preallocated_device_buffer);",
          "content_same": false
        },
        {
          "line": 510,
          "old_api": null,
          "new_api": "synchronize",
          "old_text": null,
          "new_text": "synchronize()",
          "old_line_content": "  if (config.print_benchmark_stat) {",
          "new_line_content": "  synchronize();",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 514,
          "old_api": "find_last_of",
          "new_api": null,
          "old_text": "file_name.find_last_of('/')",
          "new_text": null,
          "old_line_content": "      auto slash_pos = file_name.find_last_of('/');",
          "new_line_content": "    if (current_test != nullptr) {",
          "content_same": false
        },
        {
          "line": 547,
          "old_api": "launch",
          "new_api": null,
          "old_text": "async_engine->launch(kernel)",
          "new_text": null,
          "old_line_content": "  async_engine->launch(kernel);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 517,
          "old_api": "find",
          "new_api": null,
          "old_text": "file_name.find(\".py::\")",
          "new_text": null,
          "old_line_content": "      auto py_pos = file_name.find(\".py::\");",
          "new_line_content": "      if (slash_pos != file_name.npos)",
          "content_same": false
        },
        {
          "line": 552,
          "old_api": "finalize",
          "new_api": null,
          "old_text": "finalize()",
          "new_text": null,
          "old_line_content": "    finalize();",
          "new_line_content": "Program::~Program() {",
          "content_same": false
        },
        {
          "line": 521,
          "old_api": "find_first_of",
          "new_api": null,
          "old_text": "file_name.find_first_of(' ')",
          "new_text": null,
          "old_line_content": "      auto first_space_pos = file_name.find_first_of(' ');",
          "new_line_content": "      file_name =",
          "content_same": false
        },
        {
          "line": 526,
          "old_api": "TI_ASSERT",
          "new_api": null,
          "old_text": "TI_ASSERT(ofs)",
          "new_text": null,
          "old_line_content": "      TI_ASSERT(ofs);",
          "new_line_content": "      file_name += \".log\";",
          "content_same": false
        },
        {
          "line": 494,
          "old_api": "memcpy_device_to_host",
          "new_api": null,
          "old_text": "CUDADriver::get_instance().memcpy_device_to_host(\n        &ret, (uint64 *)result_buffer + i, sizeof(uint64))",
          "new_text": null,
          "old_line_content": "    CUDADriver::get_instance().memcpy_device_to_host(",
          "new_line_content": "    } else {",
          "content_same": false
        },
        {
          "line": 499,
          "old_api": "arch_is_cpu",
          "new_api": null,
          "old_text": "arch_is_cpu(arch)",
          "new_text": null,
          "old_line_content": "  } else if (arch_is_cpu(arch)) {",
          "new_line_content": "    TI_NOT_IMPLEMENTED;",
          "content_same": false
        },
        {
          "line": 533,
          "old_api": "set_profiler",
          "new_api": null,
          "old_text": "runtime->set_profiler(nullptr)",
          "new_text": null,
          "old_line_content": "    runtime->set_profiler(nullptr);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 534,
          "old_api": "synchronize",
          "new_api": null,
          "old_text": "synchronize()",
          "new_text": null,
          "old_line_content": "  synchronize();",
          "new_line_content": "  if (runtime)",
          "content_same": false
        },
        {
          "line": 502,
          "old_api": "get_arg_as_uint64",
          "new_api": null,
          "old_text": "context.get_arg_as_uint64(i)",
          "new_text": null,
          "old_line_content": "    ret = context.get_arg_as_uint64(i);",
          "new_line_content": "    ret = ((uint64 *)result_buffer)[i];",
          "content_same": false
        },
        {
          "line": 539,
          "old_api": "mem_free",
          "new_api": null,
          "old_text": "CUDADriver::get_instance().mem_free(preallocated_device_buffer)",
          "new_text": null,
          "old_line_content": "    CUDADriver::get_instance().mem_free(preallocated_device_buffer);",
          "new_line_content": "#if defined(TI_WITH_CUDA)",
          "content_same": false
        },
        {
          "line": 508,
          "old_api": "synchronize",
          "new_api": null,
          "old_text": "synchronize()",
          "new_text": null,
          "old_line_content": "  synchronize();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 509,
          "old_api": "TI_TRACE",
          "new_api": null,
          "old_text": "TI_TRACE(\"Program finalizing...\")",
          "new_text": null,
          "old_line_content": "  TI_TRACE(\"Program finalizing...\");",
          "new_line_content": "void Program::finalize() {",
          "content_same": false
        },
        {
          "line": 543,
          "old_api": "fmt::ptr(this)",
          "new_api": null,
          "old_text": "fmt::ptr(this)",
          "new_text": null,
          "old_line_content": "  TI_TRACE(\"Program ({}) finalized.\", fmt::ptr(this));",
          "new_line_content": "  finalized = true;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 8,
      "total_additions": 16,
      "total_deletions": 15,
      "total_api_changes": 39
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 10,
        "api_related_lines": 39,
        "non_api_lines": 7,
        "non_api_line_numbers": [
          489,
          490,
          491,
          492,
          493,
          496,
          497
        ]
      }
    },
    "api_calls_before": 218,
    "api_calls_after": 219,
    "diff_info": {
      "added_lines": 8,
      "removed_lines": 6,
      "total_diff_lines": 28
    }
  }
}