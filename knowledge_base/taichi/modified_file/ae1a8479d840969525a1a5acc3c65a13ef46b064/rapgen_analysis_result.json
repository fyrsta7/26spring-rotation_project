{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/taichi/modified_file/ae1a8479d840969525a1a5acc3c65a13ef46b064",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/taichi/modified_file/ae1a8479d840969525a1a5acc3c65a13ef46b064/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/taichi/modified_file/ae1a8479d840969525a1a5acc3c65a13ef46b064/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/taichi/modified_file/ae1a8479d840969525a1a5acc3c65a13ef46b064/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 68,
          "old_api": "TC_INFO",
          "new_api": "size",
          "old_text": "TC_INFO(\"Optimized load\")",
          "new_text": "ptr->ch.size()",
          "old_line_content": "          TC_INFO(\"Optimized load\");",
          "new_line_content": "          vload->ch.resize(ptr->ch.size());",
          "content_same": false
        },
        {
          "line": 69,
          "old_api": "Expr::create(NodeType::vload, addr_node)",
          "new_api": "size",
          "old_text": "Expr::create(NodeType::vload, addr_node)",
          "new_text": "ptr->ch.size()",
          "old_line_content": "          auto vload = Expr::create(NodeType::vload, addr_node);",
          "new_line_content": "          for (int i = 1; i < (int)ptr->ch.size(); i++) {",
          "content_same": false
        },
        {
          "line": 70,
          "old_api": "size",
          "new_api": "Expr::copy_from(ptr->ch[i])",
          "old_text": "ptr->ch.size()",
          "new_text": "Expr::copy_from(ptr->ch[i])",
          "old_line_content": "          vload->ch.resize(ptr->ch.size());",
          "new_line_content": "            auto c = Expr::copy_from(ptr->ch[i]);",
          "content_same": false
        },
        {
          "line": 71,
          "old_api": "size",
          "new_api": "TC_ASSERT",
          "old_text": "ptr->ch.size()",
          "new_text": "TC_ASSERT(c->lanes == 8)",
          "old_line_content": "          for (int i = 1; i < (int)ptr->ch.size(); i++) {",
          "new_line_content": "            TC_ASSERT(c->lanes == 8);",
          "content_same": false
        },
        {
          "line": 72,
          "old_api": "Expr::copy_from(ptr->ch[i])",
          "new_api": "set_lanes",
          "old_text": "Expr::copy_from(ptr->ch[i])",
          "new_text": "c->set_lanes(1)",
          "old_line_content": "            auto c = Expr::copy_from(ptr->ch[i]);",
          "new_line_content": "            c->set_lanes(1);",
          "content_same": false
        },
        {
          "line": 75,
          "old_api": "set_lanes",
          "new_api": "set_similar",
          "old_text": "c->set_lanes(1)",
          "new_text": "vload->set_similar(expr)",
          "old_line_content": "              c->set_lanes(1);",
          "new_line_content": "          vload->set_similar(expr);",
          "content_same": false
        },
        {
          "line": 82,
          "old_api": "TC_INFO",
          "new_api": "size",
          "old_text": "TC_INFO(\"Optimized store\")",
          "new_text": "ptr->ch.size()",
          "old_line_content": "          TC_INFO(\"Optimized store\");",
          "new_line_content": "          for (int i = 1; i < (int)ptr->ch.size(); i++) {",
          "content_same": false
        },
        {
          "line": 83,
          "old_api": "Expr::create(NodeType::vstore, addr_node, expr->ch[1])",
          "new_api": "Expr::copy_from(ptr->ch[i])",
          "old_text": "Expr::create(NodeType::vstore, addr_node, expr->ch[1])",
          "new_text": "Expr::copy_from(ptr->ch[i])",
          "old_line_content": "          auto vstore = Expr::create(NodeType::vstore, addr_node, expr->ch[1]);",
          "new_line_content": "            auto c = Expr::copy_from(ptr->ch[i]);",
          "content_same": false
        },
        {
          "line": 84,
          "old_api": "size",
          "new_api": "TC_ASSERT",
          "old_text": "ptr->ch.size()",
          "new_text": "TC_ASSERT(c->lanes == 8)",
          "old_line_content": "          vstore->ch.resize(ptr->ch.size() + 1);",
          "new_line_content": "            TC_ASSERT(c->lanes == 8);",
          "content_same": false
        },
        {
          "line": 85,
          "old_api": "size",
          "new_api": "set_lanes",
          "old_text": "ptr->ch.size()",
          "new_text": "c->set_lanes(1)",
          "old_line_content": "          for (int i = 1; i < (int)ptr->ch.size(); i++) {",
          "new_line_content": "            c->set_lanes(1);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 29,
          "old_api": null,
          "new_api": "index_offset",
          "old_text": null,
          "new_text": "index_node->index_offset(0)",
          "old_line_content": "      /*",
          "new_line_content": "      int offset_start = index_node->index_offset(0);",
          "content_same": false
        },
        {
          "line": 30,
          "old_api": null,
          "new_api": "index_offset",
          "old_text": null,
          "new_text": "index_node->index_offset(1)",
          "old_line_content": "      int offset_start = index_node->index_offset(0);",
          "new_line_content": "      int offset_inc = index_node->index_offset(1) - offset_start;",
          "content_same": false
        },
        {
          "line": 32,
          "old_api": null,
          "new_api": "index_offset",
          "old_text": null,
          "new_text": "index_node->index_offset(i)",
          "old_line_content": "      for (int i = 0; i + 1 < addr_node->lanes; i++) {",
          "new_line_content": "        if (index_node->index_offset(i) + offset_inc !=",
          "content_same": false
        },
        {
          "line": 33,
          "old_api": null,
          "new_api": "index_offset",
          "old_text": null,
          "new_text": "index_node->index_offset(i + 1)",
          "old_line_content": "        if (index_node->index_offset(i) + offset_inc !=",
          "new_line_content": "            index_node->index_offset(i + 1)) {",
          "content_same": false
        },
        {
          "line": 40,
          "old_api": null,
          "new_api": "new_addresses",
          "old_text": null,
          "new_text": "addr_node->new_addresses(i)",
          "old_line_content": "      for (int i = 0; i < addr_node->lanes; i++) {",
          "new_line_content": "        auto p = addr_node->new_addresses(i)->parent;",
          "content_same": false
        },
        {
          "line": 41,
          "old_api": null,
          "new_api": "new_addresses",
          "old_text": null,
          "new_text": "addr_node->new_addresses(0)",
          "old_line_content": "        auto p = addr_node->new_addresses(i)->parent;",
          "new_line_content": "        if (p != addr_node->new_addresses(0)->parent)",
          "content_same": false
        },
        {
          "line": 43,
          "old_api": null,
          "new_api": "new_addresses",
          "old_text": null,
          "new_text": "addr_node->new_addresses(i)",
          "old_line_content": "          regular_elements = false;",
          "new_line_content": "        if (p->child_id(addr_node->new_addresses(i)) != i)",
          "content_same": false
        },
        {
          "line": 47,
          "old_api": null,
          "new_api": "new_addresses",
          "old_text": null,
          "new_text": "addr_node->new_addresses(0)",
          "old_line_content": "",
          "new_line_content": "      auto snode = addr_node->new_addresses(0);",
          "content_same": false
        },
        {
          "line": 56,
          "old_api": null,
          "new_api": "TC_P",
          "old_text": null,
          "new_text": "TC_P(all_same)",
          "old_line_content": "      if (regular_elements && incremental) {",
          "new_line_content": "        TC_P(all_same);",
          "content_same": false
        },
        {
          "line": 57,
          "old_api": null,
          "new_api": "TC_P",
          "old_text": null,
          "new_text": "TC_P(offset_start)",
          "old_line_content": "        TC_P(all_same);",
          "new_line_content": "        TC_P(offset_start);",
          "content_same": false
        },
        {
          "line": 58,
          "old_api": null,
          "new_api": "TC_P",
          "old_text": null,
          "new_text": "TC_P(offset_inc)",
          "old_line_content": "        TC_P(offset_start);",
          "new_line_content": "        TC_P(offset_inc);",
          "content_same": false
        },
        {
          "line": 59,
          "old_api": null,
          "new_api": "TC_P",
          "old_text": null,
          "new_text": "TC_P(vpointer_case_2)",
          "old_line_content": "        TC_P(offset_inc);",
          "new_line_content": "        TC_P(vpointer_case_2);",
          "content_same": false
        },
        {
          "line": 60,
          "old_api": null,
          "new_api": "TC_P",
          "old_text": null,
          "new_text": "TC_P(vpointer)",
          "old_line_content": "        TC_P(vpointer_case_2);",
          "new_line_content": "        TC_P(vpointer);",
          "content_same": false
        },
        {
          "line": 66,
          "old_api": null,
          "new_api": "TC_INFO",
          "old_text": null,
          "new_text": "TC_INFO(\"Optimized load\")",
          "old_line_content": "        // replace load with vload",
          "new_line_content": "          TC_INFO(\"Optimized load\");",
          "content_same": false
        },
        {
          "line": 67,
          "old_api": null,
          "new_api": "Expr::create(NodeType::vload, addr_node)",
          "old_text": null,
          "new_text": "Expr::create(NodeType::vload, addr_node)",
          "old_line_content": "        if (expr->type == NodeType::load) {",
          "new_line_content": "          auto vload = Expr::create(NodeType::vload, addr_node);",
          "content_same": false
        },
        {
          "line": 79,
          "old_api": null,
          "new_api": "TC_INFO",
          "old_text": null,
          "new_text": "TC_INFO(\"Optimized store\")",
          "old_line_content": "          expr = vload;",
          "new_line_content": "          TC_INFO(\"Optimized store\");",
          "content_same": false
        },
        {
          "line": 80,
          "old_api": null,
          "new_api": "Expr::create(NodeType::vstore, addr_node, expr->ch[1])",
          "old_text": null,
          "new_text": "Expr::create(NodeType::vstore, addr_node, expr->ch[1])",
          "old_line_content": "          return true;",
          "new_line_content": "          auto vstore = Expr::create(NodeType::vstore, addr_node, expr->ch[1]);",
          "content_same": false
        },
        {
          "line": 81,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "ptr->ch.size()",
          "old_line_content": "        } else {",
          "new_line_content": "          vstore->ch.resize(ptr->ch.size() + 1);",
          "content_same": false
        },
        {
          "line": 88,
          "old_api": null,
          "new_api": "set_similar",
          "old_text": null,
          "new_text": "vstore->set_similar(expr)",
          "old_line_content": "            if (c->type == NodeType::index)",
          "new_line_content": "          vstore->set_similar(expr);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 73,
          "old_api": "TC_ASSERT",
          "new_api": null,
          "old_text": "TC_ASSERT(c->lanes == 8)",
          "new_text": null,
          "old_line_content": "            TC_ASSERT(c->lanes == 8);",
          "new_line_content": "            vload->ch[i] = c;",
          "content_same": false
        },
        {
          "line": 78,
          "old_api": "set_similar",
          "new_api": null,
          "old_text": "vload->set_similar(expr)",
          "new_text": null,
          "old_line_content": "          vload->set_similar(expr);",
          "new_line_content": "        } else {",
          "content_same": false
        },
        {
          "line": 86,
          "old_api": "Expr::copy_from(ptr->ch[i])",
          "new_api": null,
          "old_text": "Expr::copy_from(ptr->ch[i])",
          "new_text": null,
          "old_line_content": "            auto c = Expr::copy_from(ptr->ch[i]);",
          "new_line_content": "            vstore->ch[i + 1] = c;",
          "content_same": false
        },
        {
          "line": 87,
          "old_api": "TC_ASSERT",
          "new_api": null,
          "old_text": "TC_ASSERT(c->lanes == 8)",
          "new_text": null,
          "old_line_content": "            TC_ASSERT(c->lanes == 8);",
          "new_line_content": "          }",
          "content_same": false
        },
        {
          "line": 89,
          "old_api": "set_lanes",
          "new_api": null,
          "old_text": "c->set_lanes(1)",
          "new_text": null,
          "old_line_content": "              c->set_lanes(1);",
          "new_line_content": "          expr = vstore;",
          "content_same": false
        },
        {
          "line": 92,
          "old_api": "set_similar",
          "new_api": null,
          "old_text": "vstore->set_similar(expr)",
          "new_text": null,
          "old_line_content": "          vstore->set_similar(expr);",
          "new_line_content": "      }",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 10,
      "total_additions": 19,
      "total_deletions": 6,
      "total_api_changes": 35
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 10,
        "api_related_lines": 35,
        "non_api_lines": 4,
        "non_api_line_numbers": [
          65,
          74,
          28,
          63
        ]
      }
    },
    "api_calls_before": 26,
    "api_calls_after": 40,
    "diff_info": {
      "added_lines": 4,
      "removed_lines": 8,
      "total_diff_lines": 46
    }
  }
}