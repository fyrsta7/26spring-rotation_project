{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/taichi/modified_file/4eea1ec19429bf457bf117a752ae4479cabfd7ac",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/taichi/modified_file/4eea1ec19429bf457bf117a752ae4479cabfd7ac/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/taichi/modified_file/4eea1ec19429bf457bf117a752ae4479cabfd7ac/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/taichi/modified_file/4eea1ec19429bf457bf117a752ae4479cabfd7ac/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 2549,
          "old_api": "args",
          "new_api": "setAllowReassoc",
          "old_text": "func->args()",
          "new_text": "fast_flags.setAllowReassoc()",
          "old_line_content": "  for (auto &arg : func->args()) {",
          "new_line_content": "    fast_flags.setAllowReassoc();",
          "content_same": false
        },
        {
          "line": 2550,
          "old_api": "push_back",
          "new_api": "setFastMathFlags",
          "old_text": "args.push_back(&arg)",
          "new_text": "builder->setFastMathFlags(fast_flags)",
          "old_line_content": "    args.push_back(&arg);",
          "new_line_content": "    builder->setFastMathFlags(fast_flags);",
          "content_same": false
        },
        {
          "line": 2556,
          "old_api": "get_arg",
          "new_api": "args",
          "old_text": "get_arg(0)",
          "new_text": "func->args()",
          "old_line_content": "  return get_arg(0);",
          "new_line_content": "  for (auto &arg : func->args()) {",
          "content_same": false
        },
        {
          "line": 2595,
          "old_api": "get_runtime_type",
          "new_api": "get_runtime",
          "old_text": "get_runtime_type(\"LLVMRuntime\")",
          "new_text": "get_runtime()",
          "old_line_content": "      runtime_ptr, llvm::PointerType::get(get_runtime_type(\"LLVMRuntime\"), 0));",
          "new_line_content": "  return call(\"LLVMRuntime_get_roots\", get_runtime(),",
          "content_same": false
        },
        {
          "line": 2600,
          "old_api": "TI_ASSERT",
          "new_api": "get_context",
          "old_text": "TI_ASSERT(obj != nullptr)",
          "new_text": "get_context()",
          "old_line_content": "  TI_ASSERT(obj != nullptr);",
          "new_line_content": "  auto runtime_ptr = call(\"RuntimeContext_get_runtime\", get_context());",
          "content_same": false
        },
        {
          "line": 2624,
          "old_api": "is_extension_supported",
          "new_api": "irpass::offload_to_executable(\n        ir, config, kernel, verbose,\n        /*determine_ad_stack_size=*/kernel->autodiff_mode ==\n            AutodiffMode::kReverse,\n        /*lower_global_access=*/true,\n        /*make_thread_local=*/config.make_thread_local,\n        /*make_block_local=*/\n        is_extension_supported(config.arch, Extension::bls) &&\n            config.make_block_local)",
          "old_text": "is_extension_supported(config.arch, Extension::bls)",
          "new_text": "irpass::offload_to_executable(\n        ir, config, kernel, verbose,\n        /*determine_ad_stack_size=*/kernel->autodiff_mode ==\n            AutodiffMode::kReverse,\n        /*lower_global_access=*/true,\n        /*make_thread_local=*/config.make_thread_local,\n        /*make_block_local=*/\n        is_extension_supported(config.arch, Extension::bls) &&\n            config.make_block_local)",
          "old_line_content": "        is_extension_supported(config.arch, Extension::bls) &&",
          "new_line_content": "    irpass::offload_to_executable(",
          "content_same": false
        },
        {
          "line": 2631,
          "old_api": "eliminate_unused_functions",
          "new_api": "is_extension_supported",
          "old_text": "eliminate_unused_functions()",
          "new_text": "is_extension_supported(config.arch, Extension::bls)",
          "old_line_content": "  eliminate_unused_functions();",
          "new_line_content": "        is_extension_supported(config.arch, Extension::bls) &&",
          "content_same": false
        },
        {
          "line": 2637,
          "old_api": "TI_ASSERT",
          "new_api": "emit_to_module",
          "old_text": "TI_ASSERT(func)",
          "new_text": "emit_to_module()",
          "old_line_content": "      TI_ASSERT(func);",
          "new_line_content": "  emit_to_module();",
          "content_same": false
        },
        {
          "line": 2638,
          "old_api": "mark_function_as_cuda_kernel",
          "new_api": "eliminate_unused_functions",
          "old_text": "tlctx->mark_function_as_cuda_kernel(func, task.block_dim)",
          "new_text": "eliminate_unused_functions()",
          "old_line_content": "      tlctx->mark_function_as_cuda_kernel(func, task.block_dim);",
          "new_line_content": "  eliminate_unused_functions();",
          "content_same": false
        },
        {
          "line": 2643,
          "old_api": "TI_ASSERT",
          "new_api": "getFunction",
          "old_text": "TI_ASSERT(func)",
          "new_text": "module->getFunction(task.name)",
          "old_line_content": "      TI_ASSERT(func);",
          "new_line_content": "      llvm::Function *func = module->getFunction(task.name);",
          "content_same": false
        },
        {
          "line": 2644,
          "old_api": "mark_function_as_amdgpu_kernel",
          "new_api": "TI_ASSERT",
          "old_text": "tlctx->mark_function_as_amdgpu_kernel(func)",
          "new_text": "TI_ASSERT(func)",
          "old_line_content": "      tlctx->mark_function_as_amdgpu_kernel(func);",
          "new_line_content": "      TI_ASSERT(func);",
          "content_same": false
        },
        {
          "line": 2649,
          "old_api": "std::move(struct_for_tls_sizes)",
          "new_api": "getFunction",
          "old_text": "std::move(struct_for_tls_sizes)",
          "new_text": "module->getFunction(task.name)",
          "old_line_content": "          std::move(used_tree_ids), std::move(struct_for_tls_sizes)};",
          "new_line_content": "      llvm::Function *func = module->getFunction(task.name);",
          "content_same": false
        },
        {
          "line": 2655,
          "old_api": "get_xlogue_function_type",
          "new_api": "std::move(module)",
          "old_text": "get_xlogue_function_type()",
          "new_text": "std::move(module)",
          "old_line_content": "  auto xlogue_type = get_xlogue_function_type();",
          "new_line_content": "  return {std::move(offloaded_tasks), std::move(module),",
          "content_same": false
        },
        {
          "line": 2656,
          "old_api": "llvm::PointerType::get(xlogue_type, 0)",
          "new_api": "std::move(struct_for_tls_sizes)",
          "old_text": "llvm::PointerType::get(xlogue_type, 0)",
          "new_text": "std::move(struct_for_tls_sizes)",
          "old_line_content": "  auto xlogue_ptr_type = llvm::PointerType::get(xlogue_type, 0);",
          "new_line_content": "          std::move(used_tree_ids), std::move(struct_for_tls_sizes)};",
          "content_same": false
        },
        {
          "line": 2663,
          "old_api": "llvm::ConstantPointerNull::get(xlogue_ptr_type)",
          "new_api": "llvm::PointerType::get(xlogue_type, 0)",
          "old_text": "llvm::ConstantPointerNull::get(xlogue_ptr_type)",
          "new_text": "llvm::PointerType::get(xlogue_type, 0)",
          "old_line_content": "    xlogue = llvm::ConstantPointerNull::get(xlogue_ptr_type);",
          "new_line_content": "  auto xlogue_ptr_type = llvm::PointerType::get(xlogue_type, 0);",
          "content_same": false
        },
        {
          "line": 2681,
          "old_api": "llvm::ConstantPointerNull::get(xlogue_ptr_type)",
          "new_api": "llvm::PointerType::get(xlogue_type, 0)",
          "old_text": "llvm::ConstantPointerNull::get(xlogue_ptr_type)",
          "new_text": "llvm::PointerType::get(xlogue_type, 0)",
          "old_line_content": "    xlogue = llvm::ConstantPointerNull::get(xlogue_ptr_type);",
          "new_line_content": "  auto xlogue_ptr_type = llvm::PointerType::get(xlogue_type, 0);",
          "content_same": false
        },
        {
          "line": 2699,
          "old_api": "accept",
          "new_api": "count",
          "old_text": "stmt->func->ir->accept(this)",
          "new_text": "func_map.count(stmt->func)",
          "old_line_content": "    stmt->func->ir->accept(this);",
          "new_line_content": "  if (!func_map.count(stmt->func)) {",
          "content_same": false
        },
        {
          "line": 2705,
          "old_api": "empty",
          "new_api": "insert",
          "old_text": "stmt->func->parameter_list.empty()",
          "new_text": "func_map.insert({stmt->func, guard.body})",
          "old_line_content": "  if (!stmt->func->parameter_list.empty()) {",
          "new_line_content": "    func_map.insert({stmt->func, guard.body});",
          "content_same": false
        },
        {
          "line": 2714,
          "old_api": "CreateAlloca",
          "new_api": "get_data_type",
          "old_text": "builder->CreateAlloca(ret_type)",
          "new_text": "tlctx->get_data_type(stmt->func->args_type)",
          "old_line_content": "    result_buffer = builder->CreateAlloca(ret_type);",
          "new_line_content": "        builder->CreateAlloca(tlctx->get_data_type(stmt->func->args_type));",
          "content_same": false
        },
        {
          "line": 2715,
          "old_api": "CreatePointerCast",
          "new_api": "set_args_ptr",
          "old_text": "builder->CreatePointerCast(\n        result_buffer,\n        llvm::PointerType::get(tlctx->get_data_type<uint64>(), 0))",
          "new_text": "set_args_ptr(stmt->func, new_ctx, buffer)",
          "old_line_content": "    auto *result_buffer_u64 = builder->CreatePointerCast(",
          "new_line_content": "    set_args_ptr(stmt->func, new_ctx, buffer);",
          "content_same": false
        },
        {
          "line": 2720,
          "old_api": "call",
          "new_api": "get_data_type",
          "old_text": "call(llvm_func, new_ctx)",
          "new_text": "tlctx->get_data_type(stmt->func->ret_type)",
          "old_line_content": "  call(llvm_func, new_ctx);",
          "new_line_content": "    auto *ret_type = tlctx->get_data_type(stmt->func->ret_type);",
          "content_same": false
        },
        {
          "line": 2722,
          "old_api": "get_runtime",
          "new_api": "CreatePointerCast",
          "old_text": "get_runtime()",
          "new_text": "builder->CreatePointerCast(\n        result_buffer,\n        llvm::PointerType::get(tlctx->get_data_type<uint64>(), 0))",
          "old_line_content": "  call(\"recycle_runtime_context\", get_runtime(), new_ctx);",
          "new_line_content": "    auto *result_buffer_u64 = builder->CreatePointerCast(",
          "content_same": false
        },
        {
          "line": 2729,
          "old_api": "get_constant",
          "new_api": "get_runtime",
          "old_text": "tlctx->get_constant(0)",
          "new_text": "get_runtime()",
          "old_line_content": "  index.push_back(tlctx->get_constant(0));",
          "new_line_content": "  call(\"recycle_runtime_context\", get_runtime(), new_ctx);",
          "content_same": false
        },
        {
          "line": 2733,
          "old_api": "CreateGEP",
          "new_api": "ptr_removed",
          "old_text": "builder->CreateGEP(struct_type, llvm_val[stmt->src], index)",
          "new_text": "stmt->src->ret_type.ptr_removed()",
          "old_line_content": "  auto *gep = builder->CreateGEP(struct_type, llvm_val[stmt->src], index);",
          "new_line_content": "  auto *struct_type = tlctx->get_data_type(stmt->src->ret_type.ptr_removed());",
          "content_same": false
        },
        {
          "line": 2752,
          "old_api": "CreateGEP",
          "new_api": "current_type->cast<PrimitiveType>()",
          "old_text": "builder->CreateGEP(buffer_type, buffer, current_index)",
          "new_text": "current_type->cast<PrimitiveType>()",
          "old_line_content": "    auto *gep = builder->CreateGEP(buffer_type, buffer, current_index);",
          "new_line_content": "  if (auto primitive_type = current_type->cast<PrimitiveType>()) {",
          "content_same": false
        },
        {
          "line": 2753,
          "old_api": "CreateStore",
          "new_api": "TI_ASSERT",
          "old_text": "builder->CreateStore(llvm_val[elements[current_element]], gep)",
          "new_text": "TI_ASSERT((Type *)elements[current_element]->ret_type == current_type)",
          "old_line_content": "    builder->CreateStore(llvm_val[elements[current_element]], gep);",
          "new_line_content": "    TI_ASSERT((Type *)elements[current_element]->ret_type == current_type);",
          "content_same": false
        },
        {
          "line": 2755,
          "old_api": "current_type->cast<StructType>()",
          "new_api": "CreateStore",
          "old_text": "current_type->cast<StructType>()",
          "new_text": "builder->CreateStore(llvm_val[elements[current_element]], gep)",
          "old_line_content": "  } else if (auto struct_type = current_type->cast<StructType>()) {",
          "new_line_content": "    builder->CreateStore(llvm_val[elements[current_element]], gep);",
          "content_same": false
        },
        {
          "line": 2757,
          "old_api": "elements",
          "new_api": "current_type->cast<PointerType>()",
          "old_text": "struct_type->elements()",
          "new_text": "current_type->cast<PointerType>()",
          "old_line_content": "    for (const auto &element : struct_type->elements()) {",
          "new_line_content": "  } else if (auto pointer_type = current_type->cast<PointerType>()) {",
          "content_same": false
        },
        {
          "line": 2758,
          "old_api": "get_constant",
          "new_api": "TI_ASSERT",
          "old_text": "tlctx->get_constant(i++)",
          "new_text": "TI_ASSERT((Type *)elements[current_element]->ret_type == current_type)",
          "old_line_content": "      current_index.push_back(tlctx->get_constant(i++));",
          "new_line_content": "    TI_ASSERT((Type *)elements[current_element]->ret_type == current_type);",
          "content_same": false
        },
        {
          "line": 2759,
          "old_api": "set_struct_to_buffer",
          "new_api": "CreateGEP",
          "old_text": "set_struct_to_buffer(buffer, buffer_type, elements, element.type,\n                           current_element, current_index)",
          "new_text": "builder->CreateGEP(buffer_type, buffer, current_index)",
          "old_line_content": "      set_struct_to_buffer(buffer, buffer_type, elements, element.type,",
          "new_line_content": "    auto *gep = builder->CreateGEP(buffer_type, buffer, current_index);",
          "content_same": false
        },
        {
          "line": 2764,
          "old_api": "get_num_elements",
          "new_api": "elements",
          "old_text": "tensor_type->get_num_elements()",
          "new_text": "struct_type->elements()",
          "old_line_content": "    int num_elements = tensor_type->get_num_elements();",
          "new_line_content": "    for (const auto &element : struct_type->elements()) {",
          "content_same": false
        },
        {
          "line": 2765,
          "old_api": "get_element_type",
          "new_api": "get_constant",
          "old_text": "tensor_type->get_element_type()",
          "new_text": "tlctx->get_constant(i++)",
          "old_line_content": "    Type *element_type = tensor_type->get_element_type();",
          "new_line_content": "      current_index.push_back(tlctx->get_constant(i++));",
          "content_same": false
        },
        {
          "line": 2768,
          "old_api": "set_struct_to_buffer",
          "new_api": "pop_back",
          "old_text": "set_struct_to_buffer(buffer, buffer_type, elements, element_type,\n                           current_element, current_index)",
          "new_text": "current_index.pop_back()",
          "old_line_content": "      set_struct_to_buffer(buffer, buffer_type, elements, element_type,",
          "new_line_content": "      current_index.pop_back();",
          "content_same": false
        },
        {
          "line": 2770,
          "old_api": "pop_back",
          "new_api": "current_type->cast<TensorType>()",
          "old_text": "current_index.pop_back()",
          "new_text": "current_type->cast<TensorType>()",
          "old_line_content": "      current_index.pop_back();",
          "new_line_content": "  } else if (auto tensor_type = current_type->cast<TensorType>()) {",
          "content_same": false
        },
        {
          "line": 2793,
          "old_api": "get_context",
          "new_api": "get_constant",
          "old_text": "get_context()",
          "new_text": "tlctx->get_constant(0)",
          "old_line_content": "  auto *args_ptr = get_args_ptr(current_callable, get_context());",
          "new_line_content": "  std::vector<llvm::Value *> current_index = {tlctx->get_constant(0)};",
          "content_same": false
        },
        {
          "line": 2800,
          "old_api": "get_constant",
          "new_api": "get_context",
          "old_text": "tlctx->get_constant(ind)",
          "new_text": "get_context()",
          "old_line_content": "    gep_index.push_back(tlctx->get_constant(ind));",
          "new_line_content": "  auto *args_ptr = get_args_ptr(current_callable, get_context());",
          "content_same": false
        },
        {
          "line": 2807,
          "old_api": "get_data_type",
          "new_api": "get_constant",
          "old_text": "tlctx->get_data_type(arg_type)",
          "new_text": "tlctx->get_constant(ind)",
          "old_line_content": "  return builder->CreateLoad(tlctx->get_data_type(arg_type), gep);",
          "new_line_content": "    gep_index.push_back(tlctx->get_constant(ind));",
          "content_same": false
        },
        {
          "line": 2814,
          "old_api": "get_constant",
          "new_api": "get_data_type",
          "old_text": "tlctx->get_constant(0)",
          "new_text": "tlctx->get_data_type(arg_type)",
          "old_line_content": "  auto *zero = tlctx->get_constant(0);",
          "new_line_content": "  return builder->CreateLoad(tlctx->get_data_type(arg_type), gep);",
          "content_same": false
        },
        {
          "line": 2819,
          "old_api": "CreatePointerCast",
          "new_api": "get_runtime_type",
          "old_text": "builder->CreatePointerCast(\n      args_ptr,\n      llvm::PointerType::get(llvm::PointerType::get(args_type, 0), 0))",
          "new_text": "get_runtime_type(\"RuntimeContext\")",
          "old_line_content": "  args_ptr = builder->CreatePointerCast(",
          "new_line_content": "  auto *runtime_context_type = get_runtime_type(\"RuntimeContext\");",
          "content_same": false
        },
        {
          "line": 2821,
          "old_api": "llvm::PointerType::get(args_type, 0)",
          "new_api": "get_constant",
          "old_text": "llvm::PointerType::get(args_type, 0)",
          "new_text": "tlctx->get_constant(0)",
          "old_line_content": "      llvm::PointerType::get(llvm::PointerType::get(args_type, 0), 0));",
          "new_line_content": "  auto *zero = tlctx->get_constant(0);",
          "content_same": false
        },
        {
          "line": 2824,
          "old_api": "llvm::PointerType::get(args_type, 0)",
          "new_api": "CreateGEP",
          "old_text": "llvm::PointerType::get(args_type, 0)",
          "new_text": "builder->CreateGEP(runtime_context_type, context, {zero, zero})",
          "old_line_content": "      builder->CreateLoad(llvm::PointerType::get(args_type, 0), args_ptr);",
          "new_line_content": "      builder->CreateGEP(runtime_context_type, context, {zero, zero});",
          "content_same": false
        },
        {
          "line": 2831,
          "old_api": "get_data_type",
          "new_api": "llvm::PointerType::get(args_type, 0)",
          "old_text": "tlctx->get_data_type(callable->args_type)",
          "new_text": "llvm::PointerType::get(args_type, 0)",
          "old_line_content": "  auto *args_type = tlctx->get_data_type(callable->args_type);",
          "new_line_content": "      builder->CreateLoad(llvm::PointerType::get(args_type, 0), args_ptr);",
          "content_same": false
        },
        {
          "line": 2837,
          "old_api": "CreatePointerCast",
          "new_api": "get_runtime_type",
          "old_text": "builder->CreatePointerCast(\n      args_ptr,\n      llvm::PointerType::get(llvm::PointerType::get(args_type, 0), 0))",
          "new_text": "get_runtime_type(\"RuntimeContext\")",
          "old_line_content": "  args_ptr = builder->CreatePointerCast(",
          "new_line_content": "  auto *runtime_context_type = get_runtime_type(\"RuntimeContext\");",
          "content_same": false
        },
        {
          "line": 2839,
          "old_api": "llvm::PointerType::get(args_type, 0)",
          "new_api": "get_constant",
          "old_text": "llvm::PointerType::get(args_type, 0)",
          "new_text": "tlctx->get_constant(0)",
          "old_line_content": "      llvm::PointerType::get(llvm::PointerType::get(args_type, 0), 0));",
          "new_line_content": "  auto *zero = tlctx->get_constant(0);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 2688,
          "old_api": null,
          "new_api": "llvm::ConstantPointerNull::get(xlogue_ptr_type)",
          "old_text": null,
          "new_text": "llvm::ConstantPointerNull::get(xlogue_ptr_type)",
          "old_line_content": "  llvm_val[stmt] = llvm_val[stmt->var];",
          "new_line_content": "    xlogue = llvm::ConstantPointerNull::get(xlogue_ptr_type);",
          "content_same": false
        },
        {
          "line": 2563,
          "old_api": null,
          "new_api": "get_arg",
          "old_text": null,
          "new_text": "get_arg(0)",
          "old_line_content": "llvm::Type *TaskCodeGenLLVM::get_tls_buffer_type() {",
          "new_line_content": "  return get_arg(0);",
          "content_same": false
        },
        {
          "line": 2820,
          "old_api": null,
          "new_api": "get_data_type",
          "old_text": null,
          "new_text": "tlctx->get_data_type(callable->args_type)",
          "old_line_content": "      args_ptr,",
          "new_line_content": "  auto *args_type = tlctx->get_data_type(callable->args_type);",
          "content_same": false
        },
        {
          "line": 2567,
          "old_api": null,
          "new_api": "get_arg",
          "old_text": null,
          "new_text": "get_arg(1)",
          "old_line_content": "std::vector<llvm::Type *> TaskCodeGenLLVM::get_xlogue_argument_types() {",
          "new_line_content": "  return get_arg(1);",
          "content_same": false
        },
        {
          "line": 2826,
          "old_api": null,
          "new_api": "CreatePointerCast",
          "old_text": null,
          "new_text": "builder->CreatePointerCast(\n      args_ptr,\n      llvm::PointerType::get(llvm::PointerType::get(args_type, 0), 0))",
          "old_line_content": "}",
          "new_line_content": "  args_ptr = builder->CreatePointerCast(",
          "content_same": false
        },
        {
          "line": 2571,
          "old_api": null,
          "new_api": "llvm::Type::getInt8PtrTy(*llvm_context)",
          "old_text": null,
          "new_text": "llvm::Type::getInt8PtrTy(*llvm_context)",
          "old_line_content": "",
          "new_line_content": "  return llvm::Type::getInt8PtrTy(*llvm_context);",
          "content_same": false
        },
        {
          "line": 2700,
          "old_api": null,
          "new_api": "get_name",
          "old_text": null,
          "new_text": "get_function_creation_guard(\n        {llvm::PointerType::get(get_runtime_type(\"RuntimeContext\"), 0)},\n        stmt->func->get_name())",
          "old_line_content": "    current_callable = old_callable;",
          "new_line_content": "    auto guard = get_function_creation_guard(",
          "content_same": false
        },
        {
          "line": 2701,
          "old_api": null,
          "new_api": "get_runtime_type",
          "old_text": null,
          "new_text": "get_runtime_type(\"RuntimeContext\")",
          "old_line_content": "  }",
          "new_line_content": "        {llvm::PointerType::get(get_runtime_type(\"RuntimeContext\"), 0)},",
          "content_same": false
        },
        {
          "line": 2702,
          "old_api": null,
          "new_api": "get_name",
          "old_text": null,
          "new_text": "stmt->func->get_name()",
          "old_line_content": "  llvm::Function *llvm_func = func_map[stmt->func];",
          "new_line_content": "        stmt->func->get_name());",
          "content_same": false
        },
        {
          "line": 2575,
          "old_api": null,
          "new_api": "get_runtime_type",
          "old_text": null,
          "new_text": "get_runtime_type(\"RuntimeContext\")",
          "old_line_content": "}",
          "new_line_content": "  return {llvm::PointerType::get(get_runtime_type(\"RuntimeContext\"), 0),",
          "content_same": false
        },
        {
          "line": 2576,
          "old_api": null,
          "new_api": "get_tls_buffer_type",
          "old_text": null,
          "new_text": "get_tls_buffer_type()",
          "old_line_content": "",
          "new_line_content": "          get_tls_buffer_type()};",
          "content_same": false
        },
        {
          "line": 2828,
          "old_api": null,
          "new_api": "llvm::PointerType::get(args_type, 0)",
          "old_text": null,
          "new_text": "llvm::PointerType::get(args_type, 0)",
          "old_line_content": "                                   llvm::Value *context,",
          "new_line_content": "      llvm::PointerType::get(llvm::PointerType::get(args_type, 0), 0));",
          "content_same": false
        },
        {
          "line": 2706,
          "old_api": null,
          "new_api": "accept",
          "old_text": null,
          "new_text": "stmt->func->ir->accept(this)",
          "old_line_content": "    auto *buffer =",
          "new_line_content": "    stmt->func->ir->accept(this);",
          "content_same": false
        },
        {
          "line": 2580,
          "old_api": null,
          "new_api": "get_runtime_type",
          "old_text": null,
          "new_text": "get_runtime_type(\"RuntimeContext\")",
          "old_line_content": "}",
          "new_line_content": "  return {llvm::PointerType::get(get_runtime_type(\"RuntimeContext\"), 0),",
          "content_same": false
        },
        {
          "line": 2581,
          "old_api": null,
          "new_api": "tlctx->get_data_type<uint32_t>()",
          "old_text": null,
          "new_text": "tlctx->get_data_type<uint32_t>()",
          "old_line_content": "",
          "new_line_content": "          get_tls_buffer_type(), tlctx->get_data_type<uint32_t>()};",
          "content_same": false
        },
        {
          "line": 2710,
          "old_api": null,
          "new_api": "get_runtime",
          "old_text": null,
          "new_text": "get_runtime()",
          "old_line_content": "  }",
          "new_line_content": "  auto *new_ctx = call(\"allocate_runtime_context\", get_runtime());",
          "content_same": false
        },
        {
          "line": 2711,
          "old_api": null,
          "new_api": "get_runtime",
          "old_text": null,
          "new_text": "get_runtime()",
          "old_line_content": "  llvm::Value *result_buffer = nullptr;",
          "new_line_content": "  call(\"RuntimeContext_set_runtime\", new_ctx, get_runtime());",
          "content_same": false
        },
        {
          "line": 2838,
          "old_api": null,
          "new_api": "get_data_type",
          "old_text": null,
          "new_text": "tlctx->get_data_type(callable->args_type)",
          "old_line_content": "      args_ptr,",
          "new_line_content": "  auto *args_type = tlctx->get_data_type(callable->args_type);",
          "content_same": false
        },
        {
          "line": 2585,
          "old_api": null,
          "new_api": "llvm::Type::getVoidTy(*llvm_context)",
          "old_text": null,
          "new_text": "llvm::Type::getVoidTy(*llvm_context)",
          "old_line_content": "}",
          "new_line_content": "  return llvm::FunctionType::get(llvm::Type::getVoidTy(*llvm_context),",
          "content_same": false
        },
        {
          "line": 2586,
          "old_api": null,
          "new_api": "get_xlogue_argument_types",
          "old_text": null,
          "new_text": "get_xlogue_argument_types()",
          "old_line_content": "",
          "new_line_content": "                                 get_xlogue_argument_types(), false);",
          "content_same": false
        },
        {
          "line": 2842,
          "old_api": null,
          "new_api": "CreateGEP",
          "old_text": null,
          "new_text": "builder->CreateGEP(runtime_context_type, context, {zero, zero})",
          "old_line_content": "};",
          "new_line_content": "      builder->CreateGEP(runtime_context_type, context, {zero, zero});",
          "content_same": false
        },
        {
          "line": 2716,
          "old_api": null,
          "new_api": "set_struct_to_buffer",
          "old_text": null,
          "new_text": "set_struct_to_buffer(stmt->func->args_type, buffer, stmt->args)",
          "old_line_content": "        result_buffer,",
          "new_line_content": "    set_struct_to_buffer(stmt->func->args_type, buffer, stmt->args);",
          "content_same": false
        },
        {
          "line": 2844,
          "old_api": null,
          "new_api": "CreatePointerCast",
          "old_text": null,
          "new_text": "builder->CreatePointerCast(\n      args_ptr,\n      llvm::PointerType::get(llvm::PointerType::get(args_type, 0), 0))",
          "old_line_content": "LLVMCompiledTask LLVMCompiledTask::clone() const {",
          "new_line_content": "  args_ptr = builder->CreatePointerCast(",
          "content_same": false
        },
        {
          "line": 2590,
          "old_api": null,
          "new_api": "llvm::Type::getVoidTy(*llvm_context)",
          "old_text": null,
          "new_text": "llvm::Type::getVoidTy(*llvm_context)",
          "old_line_content": "}",
          "new_line_content": "  return llvm::FunctionType::get(llvm::Type::getVoidTy(*llvm_context),",
          "content_same": false
        },
        {
          "line": 2591,
          "old_api": null,
          "new_api": "get_mesh_xlogue_argument_types",
          "old_text": null,
          "new_text": "get_mesh_xlogue_argument_types()",
          "old_line_content": "",
          "new_line_content": "                                 get_mesh_xlogue_argument_types(), false);",
          "content_same": false
        },
        {
          "line": 2719,
          "old_api": null,
          "new_api": "empty",
          "old_text": null,
          "new_text": "stmt->func->rets.empty()",
          "old_line_content": "  }",
          "new_line_content": "  if (!stmt->func->rets.empty()) {",
          "content_same": false
        },
        {
          "line": 2846,
          "old_api": null,
          "new_api": "llvm::PointerType::get(args_type, 0)",
          "old_text": null,
          "new_text": "llvm::PointerType::get(args_type, 0)",
          "old_line_content": "          struct_for_tls_sizes};",
          "new_line_content": "      llvm::PointerType::get(llvm::PointerType::get(args_type, 0), 0));",
          "content_same": false
        },
        {
          "line": 2848,
          "old_api": null,
          "new_api": "CreateStore",
          "old_text": null,
          "new_text": "builder->CreateStore(ptr, args_ptr)",
          "old_line_content": "",
          "new_line_content": "  builder->CreateStore(ptr, args_ptr);",
          "content_same": false
        },
        {
          "line": 2721,
          "old_api": null,
          "new_api": "CreateAlloca",
          "old_text": null,
          "new_text": "builder->CreateAlloca(ret_type)",
          "old_line_content": "  llvm_val[stmt] = result_buffer;",
          "new_line_content": "    result_buffer = builder->CreateAlloca(ret_type);",
          "content_same": false
        },
        {
          "line": 2596,
          "old_api": null,
          "new_api": "get_constant",
          "old_text": null,
          "new_text": "tlctx->get_constant(snode_tree_id)",
          "old_line_content": "}",
          "new_line_content": "              tlctx->get_constant(snode_tree_id));",
          "content_same": false
        },
        {
          "line": 2724,
          "old_api": null,
          "new_api": "tlctx->get_data_type<uint64>()",
          "old_text": null,
          "new_text": "tlctx->get_data_type<uint64>()",
          "old_line_content": "",
          "new_line_content": "        llvm::PointerType::get(tlctx->get_data_type<uint64>(), 0));",
          "content_same": false
        },
        {
          "line": 2725,
          "old_api": null,
          "new_api": "call",
          "old_text": null,
          "new_text": "call(\"RuntimeContext_set_result_buffer\", new_ctx, result_buffer_u64)",
          "old_line_content": "void TaskCodeGenLLVM::visit(GetElementStmt *stmt) {",
          "new_line_content": "    call(\"RuntimeContext_set_result_buffer\", new_ctx, result_buffer_u64);",
          "content_same": false
        },
        {
          "line": 2727,
          "old_api": null,
          "new_api": "call",
          "old_text": null,
          "new_text": "call(llvm_func, new_ctx)",
          "old_line_content": "  std::vector<llvm::Value *> index;",
          "new_line_content": "  call(llvm_func, new_ctx);",
          "content_same": false
        },
        {
          "line": 2852,
          "old_api": null,
          "new_api": "llvm::CloneModule(*module)",
          "old_text": null,
          "new_text": "llvm::CloneModule(*module)",
          "old_line_content": "",
          "new_line_content": "  return {tasks, llvm::CloneModule(*module), used_tree_ids,",
          "content_same": false
        },
        {
          "line": 2601,
          "old_api": null,
          "new_api": "CreateBitCast",
          "old_text": null,
          "new_text": "builder->CreateBitCast(\n      runtime_ptr, llvm::PointerType::get(get_runtime_type(\"LLVMRuntime\"), 0))",
          "old_line_content": "  return obj->ptr;",
          "new_line_content": "  return builder->CreateBitCast(",
          "content_same": false
        },
        {
          "line": 2602,
          "old_api": null,
          "new_api": "get_runtime_type",
          "old_text": null,
          "new_text": "get_runtime_type(\"LLVMRuntime\")",
          "old_line_content": "}",
          "new_line_content": "      runtime_ptr, llvm::PointerType::get(get_runtime_type(\"LLVMRuntime\"), 0));",
          "content_same": false
        },
        {
          "line": 2857,
          "old_api": null,
          "new_api": "llvm::CloneModule(*module)",
          "old_text": null,
          "new_text": "llvm::CloneModule(*module)",
          "old_line_content": "",
          "new_line_content": "  return {tasks, llvm::CloneModule(*module)};",
          "content_same": false
        },
        {
          "line": 2606,
          "old_api": null,
          "new_api": "emit_struct_meta_object",
          "old_text": null,
          "new_text": "emit_struct_meta_object(snode)",
          "old_line_content": "  ir->accept(this);",
          "new_line_content": "  auto obj = emit_struct_meta_object(snode);",
          "content_same": false
        },
        {
          "line": 2607,
          "old_api": null,
          "new_api": "TI_ASSERT",
          "old_text": null,
          "new_text": "TI_ASSERT(obj != nullptr)",
          "old_line_content": "}",
          "new_line_content": "  TI_ASSERT(obj != nullptr);",
          "content_same": false
        },
        {
          "line": 2735,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "stmt->index.size()",
          "old_line_content": "  llvm_val[stmt] = val;",
          "new_line_content": "  index.reserve(stmt->index.size() + 1);",
          "content_same": false
        },
        {
          "line": 2736,
          "old_api": null,
          "new_api": "get_constant",
          "old_text": null,
          "new_text": "tlctx->get_constant(0)",
          "old_line_content": "}",
          "new_line_content": "  index.push_back(tlctx->get_constant(0));",
          "content_same": false
        },
        {
          "line": 2738,
          "old_api": null,
          "new_api": "get_constant",
          "old_text": null,
          "new_text": "tlctx->get_constant(i)",
          "old_line_content": "void TaskCodeGenLLVM::set_struct_to_buffer(",
          "new_line_content": "    index.push_back(tlctx->get_constant(i));",
          "content_same": false
        },
        {
          "line": 2740,
          "old_api": null,
          "new_api": "CreateGEP",
          "old_text": null,
          "new_text": "builder->CreateGEP(struct_type, llvm_val[stmt->src], index)",
          "old_line_content": "    llvm::Type *buffer_type,",
          "new_line_content": "  auto *gep = builder->CreateGEP(struct_type, llvm_val[stmt->src], index);",
          "content_same": false
        },
        {
          "line": 2741,
          "old_api": null,
          "new_api": "get_data_type",
          "old_text": null,
          "new_text": "tlctx->get_data_type(stmt->ret_type)",
          "old_line_content": "    const std::vector<Stmt *> &elements,",
          "new_line_content": "  auto *val = builder->CreateLoad(tlctx->get_data_type(stmt->ret_type), gep);",
          "content_same": false
        },
        {
          "line": 2754,
          "old_api": null,
          "new_api": "CreateGEP",
          "old_text": null,
          "new_text": "builder->CreateGEP(buffer_type, buffer, current_index)",
          "old_line_content": "    current_element++;",
          "new_line_content": "    auto *gep = builder->CreateGEP(buffer_type, buffer, current_index);",
          "content_same": false
        },
        {
          "line": 2685,
          "old_api": null,
          "new_api": "accept",
          "old_text": null,
          "new_text": "block->accept(this)",
          "old_line_content": "}",
          "new_line_content": "    block->accept(this);",
          "content_same": false
        },
        {
          "line": 2760,
          "old_api": null,
          "new_api": "CreateStore",
          "old_text": null,
          "new_text": "builder->CreateStore(llvm_val[elements[current_element]], gep)",
          "old_line_content": "                           current_element, current_index);",
          "new_line_content": "    builder->CreateStore(llvm_val[elements[current_element]], gep);",
          "content_same": false
        },
        {
          "line": 2762,
          "old_api": null,
          "new_api": "current_type->cast<StructType>()",
          "old_text": null,
          "new_text": "current_type->cast<StructType>()",
          "old_line_content": "    }",
          "new_line_content": "  } else if (auto struct_type = current_type->cast<StructType>()) {",
          "content_same": false
        },
        {
          "line": 2635,
          "old_api": null,
          "new_api": "offload_to_executable",
          "old_text": null,
          "new_text": "offload_to_executable(ir, compile_config, kernel)",
          "old_line_content": "    for (const auto &task : offloaded_tasks) {",
          "new_line_content": "  offload_to_executable(ir, compile_config, kernel);",
          "content_same": false
        },
        {
          "line": 2766,
          "old_api": null,
          "new_api": "set_struct_to_buffer",
          "old_text": null,
          "new_text": "set_struct_to_buffer(buffer, buffer_type, elements, element.type,\n                           current_element, current_index)",
          "old_line_content": "    for (int i = 0; i < num_elements; i++) {",
          "new_line_content": "      set_struct_to_buffer(buffer, buffer_type, elements, element.type,",
          "content_same": false
        },
        {
          "line": 2771,
          "old_api": null,
          "new_api": "get_num_elements",
          "old_text": null,
          "new_text": "tensor_type->get_num_elements()",
          "old_line_content": "    }",
          "new_line_content": "    int num_elements = tensor_type->get_num_elements();",
          "content_same": false
        },
        {
          "line": 2772,
          "old_api": null,
          "new_api": "get_element_type",
          "old_text": null,
          "new_text": "tensor_type->get_element_type()",
          "old_line_content": "  } else {",
          "new_line_content": "    Type *element_type = tensor_type->get_element_type();",
          "content_same": false
        },
        {
          "line": 2645,
          "old_api": null,
          "new_api": "mark_function_as_cuda_kernel",
          "old_text": null,
          "new_text": "tlctx->mark_function_as_cuda_kernel(func, task.block_dim)",
          "old_line_content": "    }",
          "new_line_content": "      tlctx->mark_function_as_cuda_kernel(func, task.block_dim);",
          "content_same": false
        },
        {
          "line": 2774,
          "old_api": null,
          "new_api": "get_constant",
          "old_text": null,
          "new_text": "tlctx->get_constant(i)",
          "old_line_content": "    TI_NOT_IMPLEMENTED",
          "new_line_content": "      current_index.push_back(tlctx->get_constant(i));",
          "content_same": false
        },
        {
          "line": 2775,
          "old_api": null,
          "new_api": "set_struct_to_buffer",
          "old_text": null,
          "new_text": "set_struct_to_buffer(buffer, buffer_type, elements, element_type,\n                           current_element, current_index)",
          "old_line_content": "  }",
          "new_line_content": "      set_struct_to_buffer(buffer, buffer_type, elements, element_type,",
          "content_same": false
        },
        {
          "line": 2777,
          "old_api": null,
          "new_api": "pop_back",
          "old_text": null,
          "new_text": "current_index.pop_back()",
          "old_line_content": "",
          "new_line_content": "      current_index.pop_back();",
          "content_same": false
        },
        {
          "line": 2650,
          "old_api": null,
          "new_api": "TI_ASSERT",
          "old_text": null,
          "new_text": "TI_ASSERT(func)",
          "old_line_content": "}",
          "new_line_content": "      TI_ASSERT(func);",
          "content_same": false
        },
        {
          "line": 2651,
          "old_api": null,
          "new_api": "mark_function_as_amdgpu_kernel",
          "old_text": null,
          "new_text": "tlctx->mark_function_as_amdgpu_kernel(func)",
          "old_line_content": "",
          "new_line_content": "      tlctx->mark_function_as_amdgpu_kernel(func);",
          "content_same": false
        },
        {
          "line": 2780,
          "old_api": null,
          "new_api": "to_string",
          "old_text": null,
          "new_text": "current_type->to_string()",
          "old_line_content": "    llvm::Value *buffer,",
          "new_line_content": "    TI_INFO(\"{}\", current_type->to_string());",
          "content_same": false
        },
        {
          "line": 2789,
          "old_api": null,
          "new_api": "get_data_type",
          "old_text": null,
          "new_text": "tlctx->get_data_type(struct_type)",
          "old_line_content": "}",
          "new_line_content": "  auto buffer_type = tlctx->get_data_type(struct_type);",
          "content_same": false
        },
        {
          "line": 2662,
          "old_api": null,
          "new_api": "get_xlogue_function_type",
          "old_text": null,
          "new_text": "get_xlogue_function_type()",
          "old_line_content": "  } else {",
          "new_line_content": "  auto xlogue_type = get_xlogue_function_type();",
          "content_same": false
        },
        {
          "line": 2790,
          "old_api": null,
          "new_api": "CreatePointerCast",
          "old_text": null,
          "new_text": "builder->CreatePointerCast(buffer,\n                                      llvm::PointerType::get(buffer_type, 0))",
          "old_line_content": "",
          "new_line_content": "  buffer = builder->CreatePointerCast(buffer,",
          "content_same": false
        },
        {
          "line": 2791,
          "old_api": null,
          "new_api": "llvm::PointerType::get(buffer_type, 0)",
          "old_text": null,
          "new_text": "llvm::PointerType::get(buffer_type, 0)",
          "old_line_content": "llvm::Value *TaskCodeGenLLVM::get_struct_arg(std::vector<int> index,",
          "new_line_content": "                                      llvm::PointerType::get(buffer_type, 0));",
          "content_same": false
        },
        {
          "line": 2666,
          "old_api": null,
          "new_api": "get_xlogue_argument_types",
          "old_text": null,
          "new_text": "get_xlogue_argument_types()",
          "old_line_content": "  return xlogue;",
          "new_line_content": "    auto guard = get_function_creation_guard(get_xlogue_argument_types());",
          "content_same": false
        },
        {
          "line": 2667,
          "old_api": null,
          "new_api": "accept",
          "old_text": null,
          "new_text": "block->accept(this)",
          "old_line_content": "}",
          "new_line_content": "    block->accept(this);",
          "content_same": false
        },
        {
          "line": 2794,
          "old_api": null,
          "new_api": "set_struct_to_buffer",
          "old_text": null,
          "new_text": "set_struct_to_buffer(buffer, buffer_type, elements, struct_type,\n                       current_element, current_index)",
          "old_line_content": "  auto *args_type = current_callable->args_type;",
          "new_line_content": "  set_struct_to_buffer(buffer, buffer_type, elements, struct_type,",
          "content_same": false
        },
        {
          "line": 2670,
          "old_api": null,
          "new_api": "llvm::ConstantPointerNull::get(xlogue_ptr_type)",
          "old_text": null,
          "new_text": "llvm::ConstantPointerNull::get(xlogue_ptr_type)",
          "old_line_content": "    std::unique_ptr<Block> &block) {",
          "new_line_content": "    xlogue = llvm::ConstantPointerNull::get(xlogue_ptr_type);",
          "content_same": false
        },
        {
          "line": 2802,
          "old_api": null,
          "new_api": "get_element_type",
          "old_text": null,
          "new_text": "args_type->get_element_type(index)",
          "old_line_content": "  auto *gep =",
          "new_line_content": "  auto *arg_type = args_type->get_element_type(index);",
          "content_same": false
        },
        {
          "line": 2547,
          "old_api": null,
          "new_api": "setNoInfs",
          "old_text": null,
          "new_text": "fast_flags.setNoInfs()",
          "old_line_content": "llvm::Value *TaskCodeGenLLVM::get_arg(int i) {",
          "new_line_content": "    fast_flags.setNoInfs();",
          "content_same": false
        },
        {
          "line": 2548,
          "old_api": null,
          "new_api": "setNoSignedZeros",
          "old_text": null,
          "new_text": "fast_flags.setNoSignedZeros()",
          "old_line_content": "  std::vector<llvm::Value *> args;",
          "new_line_content": "    fast_flags.setNoSignedZeros();",
          "content_same": false
        },
        {
          "line": 2804,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "index.size()",
          "old_line_content": "  if (!create_load) {",
          "new_line_content": "  gep_index.reserve(index.size() + 1);",
          "content_same": false
        },
        {
          "line": 2805,
          "old_api": null,
          "new_api": "get_constant",
          "old_text": null,
          "new_text": "tlctx->get_constant(0)",
          "old_line_content": "    return gep;",
          "new_line_content": "  gep_index.push_back(tlctx->get_constant(0));",
          "content_same": false
        },
        {
          "line": 2680,
          "old_api": null,
          "new_api": "get_mesh_xlogue_function_type",
          "old_text": null,
          "new_text": "get_mesh_xlogue_function_type()",
          "old_line_content": "  } else {",
          "new_line_content": "  auto xlogue_type = get_mesh_xlogue_function_type();",
          "content_same": false
        },
        {
          "line": 2810,
          "old_api": null,
          "new_api": "get_data_type",
          "old_text": null,
          "new_text": "tlctx->get_data_type(args_type)",
          "old_line_content": "llvm::Value *TaskCodeGenLLVM::get_args_ptr(const Callable *callable,",
          "new_line_content": "      builder->CreateGEP(tlctx->get_data_type(args_type), args_ptr, gep_index);",
          "content_same": false
        },
        {
          "line": 2684,
          "old_api": null,
          "new_api": "get_mesh_xlogue_argument_types",
          "old_text": null,
          "new_text": "get_mesh_xlogue_argument_types()",
          "old_line_content": "  return xlogue;",
          "new_line_content": "    auto guard = get_function_creation_guard(get_mesh_xlogue_argument_types());",
          "content_same": false
        },
        {
          "line": 2557,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "args.push_back(&arg)",
          "old_line_content": "}",
          "new_line_content": "    args.push_back(&arg);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 2560,
          "old_api": "get_arg",
          "new_api": null,
          "old_text": "get_arg(1)",
          "new_text": null,
          "old_line_content": "  return get_arg(1);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 2817,
          "old_api": "CreateGEP",
          "new_api": null,
          "old_text": "builder->CreateGEP(runtime_context_type, context, {zero, zero})",
          "new_text": null,
          "old_line_content": "      builder->CreateGEP(runtime_context_type, context, {zero, zero});",
          "new_line_content": "llvm::Value *TaskCodeGenLLVM::get_args_ptr(const Callable *callable,",
          "content_same": false
        },
        {
          "line": 2564,
          "old_api": "llvm::Type::getInt8PtrTy(*llvm_context)",
          "new_api": null,
          "old_text": "llvm::Type::getInt8PtrTy(*llvm_context)",
          "new_text": null,
          "old_line_content": "  return llvm::Type::getInt8PtrTy(*llvm_context);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 2692,
          "old_api": "count",
          "new_api": null,
          "old_text": "func_map.count(stmt->func)",
          "new_text": null,
          "old_line_content": "  if (!func_map.count(stmt->func)) {",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 2693,
          "old_api": "get_name",
          "new_api": null,
          "old_text": "get_function_creation_guard(\n        {llvm::PointerType::get(get_runtime_type(\"RuntimeContext\"), 0)},\n        stmt->func->get_name())",
          "new_text": null,
          "old_line_content": "    auto guard = get_function_creation_guard(",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2694,
          "old_api": "get_runtime_type",
          "new_api": null,
          "old_text": "get_runtime_type(\"RuntimeContext\")",
          "new_text": null,
          "old_line_content": "        {llvm::PointerType::get(get_runtime_type(\"RuntimeContext\"), 0)},",
          "new_line_content": "void TaskCodeGenLLVM::visit(ReferenceStmt *stmt) {",
          "content_same": false
        },
        {
          "line": 2568,
          "old_api": "get_runtime_type",
          "new_api": null,
          "old_text": "get_runtime_type(\"RuntimeContext\")",
          "new_text": null,
          "old_line_content": "  return {llvm::PointerType::get(get_runtime_type(\"RuntimeContext\"), 0),",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 2569,
          "old_api": "get_tls_buffer_type",
          "new_api": null,
          "old_text": "get_tls_buffer_type()",
          "new_text": null,
          "old_line_content": "          get_tls_buffer_type()};",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2695,
          "old_api": "get_name",
          "new_api": null,
          "old_text": "stmt->func->get_name()",
          "new_text": null,
          "old_line_content": "        stmt->func->get_name());",
          "new_line_content": "  llvm_val[stmt] = llvm_val[stmt->var];",
          "content_same": false
        },
        {
          "line": 2698,
          "old_api": "insert",
          "new_api": null,
          "old_text": "func_map.insert({stmt->func, guard.body})",
          "new_text": null,
          "old_line_content": "    func_map.insert({stmt->func, guard.body});",
          "new_line_content": "void TaskCodeGenLLVM::visit(FuncCallStmt *stmt) {",
          "content_same": false
        },
        {
          "line": 2573,
          "old_api": "get_runtime_type",
          "new_api": null,
          "old_text": "get_runtime_type(\"RuntimeContext\")",
          "new_text": null,
          "old_line_content": "  return {llvm::PointerType::get(get_runtime_type(\"RuntimeContext\"), 0),",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2574,
          "old_api": "tlctx->get_data_type<uint32_t>()",
          "new_api": null,
          "old_text": "tlctx->get_data_type<uint32_t>()",
          "new_text": null,
          "old_line_content": "          get_tls_buffer_type(), tlctx->get_data_type<uint32_t>()};",
          "new_line_content": "std::vector<llvm::Type *> TaskCodeGenLLVM::get_xlogue_argument_types() {",
          "content_same": false
        },
        {
          "line": 2703,
          "old_api": "get_runtime",
          "new_api": null,
          "old_text": "get_runtime()",
          "new_text": null,
          "old_line_content": "  auto *new_ctx = call(\"allocate_runtime_context\", get_runtime());",
          "new_line_content": "    const Callable *old_callable = current_callable;",
          "content_same": false
        },
        {
          "line": 2704,
          "old_api": "get_runtime",
          "new_api": null,
          "old_text": "get_runtime()",
          "new_text": null,
          "old_line_content": "  call(\"RuntimeContext_set_runtime\", new_ctx, get_runtime());",
          "new_line_content": "    current_callable = stmt->func;",
          "content_same": false
        },
        {
          "line": 2830,
          "old_api": "get_runtime_type",
          "new_api": null,
          "old_text": "get_runtime_type(\"RuntimeContext\")",
          "new_text": null,
          "old_line_content": "  auto *runtime_context_type = get_runtime_type(\"RuntimeContext\");",
          "new_line_content": "  args_ptr =",
          "content_same": false
        },
        {
          "line": 2578,
          "old_api": "llvm::Type::getVoidTy(*llvm_context)",
          "new_api": null,
          "old_text": "llvm::Type::getVoidTy(*llvm_context)",
          "new_text": null,
          "old_line_content": "  return llvm::FunctionType::get(llvm::Type::getVoidTy(*llvm_context),",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2579,
          "old_api": "get_xlogue_argument_types",
          "new_api": null,
          "old_text": "get_xlogue_argument_types()",
          "new_text": null,
          "old_line_content": "                                 get_xlogue_argument_types(), false);",
          "new_line_content": "std::vector<llvm::Type *> TaskCodeGenLLVM::get_mesh_xlogue_argument_types() {",
          "content_same": false
        },
        {
          "line": 2707,
          "old_api": "get_data_type",
          "new_api": null,
          "old_text": "tlctx->get_data_type(stmt->func->args_type)",
          "new_text": null,
          "old_line_content": "        builder->CreateAlloca(tlctx->get_data_type(stmt->func->args_type));",
          "new_line_content": "    current_callable = old_callable;",
          "content_same": false
        },
        {
          "line": 2708,
          "old_api": "set_args_ptr",
          "new_api": null,
          "old_text": "set_args_ptr(stmt->func, new_ctx, buffer)",
          "new_text": null,
          "old_line_content": "    set_args_ptr(stmt->func, new_ctx, buffer);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 2832,
          "old_api": "get_constant",
          "new_api": null,
          "old_text": "tlctx->get_constant(0)",
          "new_text": null,
          "old_line_content": "  auto *zero = tlctx->get_constant(0);",
          "new_line_content": "  return args_ptr;",
          "content_same": false
        },
        {
          "line": 2583,
          "old_api": "llvm::Type::getVoidTy(*llvm_context)",
          "new_api": null,
          "old_text": "llvm::Type::getVoidTy(*llvm_context)",
          "new_text": null,
          "old_line_content": "  return llvm::FunctionType::get(llvm::Type::getVoidTy(*llvm_context),",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2584,
          "old_api": "get_mesh_xlogue_argument_types",
          "new_api": null,
          "old_text": "get_mesh_xlogue_argument_types()",
          "new_text": null,
          "old_line_content": "                                 get_mesh_xlogue_argument_types(), false);",
          "new_line_content": "llvm::Type *TaskCodeGenLLVM::get_xlogue_function_type() {",
          "content_same": false
        },
        {
          "line": 2835,
          "old_api": "CreateGEP",
          "new_api": null,
          "old_text": "builder->CreateGEP(runtime_context_type, context, {zero, zero})",
          "new_text": null,
          "old_line_content": "      builder->CreateGEP(runtime_context_type, context, {zero, zero});",
          "new_line_content": "                                   llvm::Value *context,",
          "content_same": false
        },
        {
          "line": 2841,
          "old_api": "CreateStore",
          "new_api": null,
          "old_text": "builder->CreateStore(ptr, args_ptr)",
          "new_text": null,
          "old_line_content": "  builder->CreateStore(ptr, args_ptr);",
          "new_line_content": "  auto *args_ptr =",
          "content_same": false
        },
        {
          "line": 2709,
          "old_api": "set_struct_to_buffer",
          "new_api": null,
          "old_text": "set_struct_to_buffer(stmt->func->args_type, buffer, stmt->args)",
          "new_text": null,
          "old_line_content": "    set_struct_to_buffer(stmt->func->args_type, buffer, stmt->args);",
          "new_line_content": "  llvm::Function *llvm_func = func_map[stmt->func];",
          "content_same": false
        },
        {
          "line": 2588,
          "old_api": "get_runtime",
          "new_api": null,
          "old_text": "get_runtime()",
          "new_text": null,
          "old_line_content": "  return call(\"LLVMRuntime_get_roots\", get_runtime(),",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2589,
          "old_api": "get_constant",
          "new_api": null,
          "old_text": "tlctx->get_constant(snode_tree_id)",
          "new_text": null,
          "old_line_content": "              tlctx->get_constant(snode_tree_id));",
          "new_line_content": "llvm::Type *TaskCodeGenLLVM::get_mesh_xlogue_function_type() {",
          "content_same": false
        },
        {
          "line": 2717,
          "old_api": "tlctx->get_data_type<uint64>()",
          "new_api": null,
          "old_text": "tlctx->get_data_type<uint64>()",
          "new_text": null,
          "old_line_content": "        llvm::PointerType::get(tlctx->get_data_type<uint64>(), 0));",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 2718,
          "old_api": "call",
          "new_api": null,
          "old_text": "call(\"RuntimeContext_set_result_buffer\", new_ctx, result_buffer_u64)",
          "new_text": null,
          "old_line_content": "    call(\"RuntimeContext_set_result_buffer\", new_ctx, result_buffer_u64);",
          "new_line_content": "  llvm::Value *result_buffer = nullptr;",
          "content_same": false
        },
        {
          "line": 2845,
          "old_api": "llvm::CloneModule(*module)",
          "new_api": null,
          "old_text": "llvm::CloneModule(*module)",
          "new_text": null,
          "old_line_content": "  return {tasks, llvm::CloneModule(*module), used_tree_ids,",
          "new_line_content": "      args_ptr,",
          "content_same": false
        },
        {
          "line": 2593,
          "old_api": "get_context",
          "new_api": null,
          "old_text": "get_context()",
          "new_text": null,
          "old_line_content": "  auto runtime_ptr = call(\"RuntimeContext_get_runtime\", get_context());",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2594,
          "old_api": "CreateBitCast",
          "new_api": null,
          "old_text": "builder->CreateBitCast(\n      runtime_ptr, llvm::PointerType::get(get_runtime_type(\"LLVMRuntime\"), 0))",
          "new_text": null,
          "old_line_content": "  return builder->CreateBitCast(",
          "new_line_content": "llvm::Value *TaskCodeGenLLVM::get_root(int snode_tree_id) {",
          "content_same": false
        },
        {
          "line": 2850,
          "old_api": "llvm::CloneModule(*module)",
          "new_api": null,
          "old_text": "llvm::CloneModule(*module)",
          "new_text": null,
          "old_line_content": "  return {tasks, llvm::CloneModule(*module)};",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2726,
          "old_api": "ptr_removed",
          "new_api": null,
          "old_text": "stmt->src->ret_type.ptr_removed()",
          "new_text": null,
          "old_line_content": "  auto *struct_type = tlctx->get_data_type(stmt->src->ret_type.ptr_removed());",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 2599,
          "old_api": "emit_struct_meta_object",
          "new_api": null,
          "old_text": "emit_struct_meta_object(snode)",
          "new_text": null,
          "old_line_content": "  auto obj = emit_struct_meta_object(snode);",
          "new_line_content": "llvm::Value *TaskCodeGenLLVM::get_runtime() {",
          "content_same": false
        },
        {
          "line": 2728,
          "old_api": "size",
          "new_api": null,
          "old_text": "stmt->index.size()",
          "new_text": null,
          "old_line_content": "  index.reserve(stmt->index.size() + 1);",
          "new_line_content": "  llvm_val[stmt] = result_buffer;",
          "content_same": false
        },
        {
          "line": 2731,
          "old_api": "get_constant",
          "new_api": null,
          "old_text": "tlctx->get_constant(i)",
          "new_text": null,
          "old_line_content": "    index.push_back(tlctx->get_constant(i));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2734,
          "old_api": "get_data_type",
          "new_api": null,
          "old_text": "tlctx->get_data_type(stmt->ret_type)",
          "new_text": null,
          "old_line_content": "  auto *val = builder->CreateLoad(tlctx->get_data_type(stmt->ret_type), gep);",
          "new_line_content": "  std::vector<llvm::Value *> index;",
          "content_same": false
        },
        {
          "line": 2617,
          "old_api": "irpass::offload_to_executable(\n        ir, config, kernel, verbose,\n        /*determine_ad_stack_size=*/kernel->autodiff_mode ==\n            AutodiffMode::kReverse,\n        /*lower_global_access=*/true,\n        /*make_thread_local=*/config.make_thread_local,\n        /*make_block_local=*/\n        is_extension_supported(config.arch, Extension::bls) &&\n            config.make_block_local)",
          "new_api": null,
          "old_text": "irpass::offload_to_executable(\n        ir, config, kernel, verbose,\n        /*determine_ad_stack_size=*/kernel->autodiff_mode ==\n            AutodiffMode::kReverse,\n        /*lower_global_access=*/true,\n        /*make_thread_local=*/config.make_thread_local,\n        /*make_block_local=*/\n        is_extension_supported(config.arch, Extension::bls) &&\n            config.make_block_local)",
          "new_text": null,
          "old_line_content": "    irpass::offload_to_executable(",
          "new_line_content": "  // Final lowering",
          "content_same": false
        },
        {
          "line": 2745,
          "old_api": "current_type->cast<PrimitiveType>()",
          "new_api": null,
          "old_text": "current_type->cast<PrimitiveType>()",
          "new_text": null,
          "old_line_content": "  if (auto primitive_type = current_type->cast<PrimitiveType>()) {",
          "new_line_content": "void TaskCodeGenLLVM::set_struct_to_buffer(",
          "content_same": false
        },
        {
          "line": 2746,
          "old_api": "TI_ASSERT",
          "new_api": null,
          "old_text": "TI_ASSERT((Type *)elements[current_element]->ret_type == current_type)",
          "new_text": null,
          "old_line_content": "    TI_ASSERT((Type *)elements[current_element]->ret_type == current_type);",
          "new_line_content": "    llvm::Value *buffer,",
          "content_same": false
        },
        {
          "line": 2747,
          "old_api": "CreateGEP",
          "new_api": null,
          "old_text": "builder->CreateGEP(buffer_type, buffer, current_index)",
          "new_text": null,
          "old_line_content": "    auto *gep = builder->CreateGEP(buffer_type, buffer, current_index);",
          "new_line_content": "    llvm::Type *buffer_type,",
          "content_same": false
        },
        {
          "line": 2748,
          "old_api": "CreateStore",
          "new_api": null,
          "old_text": "builder->CreateStore(llvm_val[elements[current_element]], gep)",
          "new_text": null,
          "old_line_content": "    builder->CreateStore(llvm_val[elements[current_element]], gep);",
          "new_line_content": "    const std::vector<Stmt *> &elements,",
          "content_same": false
        },
        {
          "line": 2750,
          "old_api": "current_type->cast<PointerType>()",
          "new_api": null,
          "old_text": "current_type->cast<PointerType>()",
          "new_text": null,
          "old_line_content": "  } else if (auto pointer_type = current_type->cast<PointerType>()) {",
          "new_line_content": "    int &current_element,",
          "content_same": false
        },
        {
          "line": 2751,
          "old_api": "TI_ASSERT",
          "new_api": null,
          "old_text": "TI_ASSERT((Type *)elements[current_element]->ret_type == current_type)",
          "new_text": null,
          "old_line_content": "    TI_ASSERT((Type *)elements[current_element]->ret_type == current_type);",
          "new_line_content": "    std::vector<llvm::Value *> &current_index) {",
          "content_same": false
        },
        {
          "line": 2628,
          "old_api": "offload_to_executable",
          "new_api": null,
          "old_text": "offload_to_executable(ir, compile_config, kernel)",
          "new_text": null,
          "old_line_content": "  offload_to_executable(ir, compile_config, kernel);",
          "new_line_content": "        /*lower_global_access=*/true,",
          "content_same": false
        },
        {
          "line": 2630,
          "old_api": "emit_to_module",
          "new_api": null,
          "old_text": "emit_to_module()",
          "new_text": null,
          "old_line_content": "  emit_to_module();",
          "new_line_content": "        /*make_block_local=*/",
          "content_same": false
        },
        {
          "line": 2761,
          "old_api": "pop_back",
          "new_api": null,
          "old_text": "current_index.pop_back()",
          "new_text": null,
          "old_line_content": "      current_index.pop_back();",
          "new_line_content": "    current_element++;",
          "content_same": false
        },
        {
          "line": 2763,
          "old_api": "current_type->cast<TensorType>()",
          "new_api": null,
          "old_text": "current_type->cast<TensorType>()",
          "new_text": null,
          "old_line_content": "  } else if (auto tensor_type = current_type->cast<TensorType>()) {",
          "new_line_content": "    int i = 0;",
          "content_same": false
        },
        {
          "line": 2636,
          "old_api": "getFunction",
          "new_api": null,
          "old_text": "module->getFunction(task.name)",
          "new_text": null,
          "old_line_content": "      llvm::Function *func = module->getFunction(task.name);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2767,
          "old_api": "get_constant",
          "new_api": null,
          "old_text": "tlctx->get_constant(i)",
          "new_text": null,
          "old_line_content": "      current_index.push_back(tlctx->get_constant(i));",
          "new_line_content": "                           current_element, current_index);",
          "content_same": false
        },
        {
          "line": 2642,
          "old_api": "getFunction",
          "new_api": null,
          "old_text": "module->getFunction(task.name)",
          "new_text": null,
          "old_line_content": "      llvm::Function *func = module->getFunction(task.name);",
          "new_line_content": "    for (const auto &task : offloaded_tasks) {",
          "content_same": false
        },
        {
          "line": 2713,
          "old_api": "get_data_type",
          "new_api": null,
          "old_text": "tlctx->get_data_type(stmt->func->ret_type)",
          "new_text": null,
          "old_line_content": "    auto *ret_type = tlctx->get_data_type(stmt->func->ret_type);",
          "new_line_content": "    auto *buffer =",
          "content_same": false
        },
        {
          "line": 2773,
          "old_api": "to_string",
          "new_api": null,
          "old_text": "current_type->to_string()",
          "new_text": null,
          "old_line_content": "    TI_INFO(\"{}\", current_type->to_string());",
          "new_line_content": "    for (int i = 0; i < num_elements; i++) {",
          "content_same": false
        },
        {
          "line": 2648,
          "old_api": "std::move(module)",
          "new_api": null,
          "old_text": "std::move(module)",
          "new_text": null,
          "old_line_content": "  return {std::move(offloaded_tasks), std::move(module),",
          "new_line_content": "    for (const auto &task : offloaded_tasks) {",
          "content_same": false
        },
        {
          "line": 2782,
          "old_api": "get_data_type",
          "new_api": null,
          "old_text": "tlctx->get_data_type(struct_type)",
          "new_text": null,
          "old_line_content": "  auto buffer_type = tlctx->get_data_type(struct_type);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 2783,
          "old_api": "CreatePointerCast",
          "new_api": null,
          "old_text": "builder->CreatePointerCast(buffer,\n                                      llvm::PointerType::get(buffer_type, 0))",
          "new_text": null,
          "old_line_content": "  buffer = builder->CreatePointerCast(buffer,",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 2784,
          "old_api": "llvm::PointerType::get(buffer_type, 0)",
          "new_api": null,
          "old_text": "llvm::PointerType::get(buffer_type, 0)",
          "new_text": null,
          "old_line_content": "                                      llvm::PointerType::get(buffer_type, 0));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2786,
          "old_api": "get_constant",
          "new_api": null,
          "old_text": "tlctx->get_constant(0)",
          "new_text": null,
          "old_line_content": "  std::vector<llvm::Value *> current_index = {tlctx->get_constant(0)};",
          "new_line_content": "    const StructType *struct_type,",
          "content_same": false
        },
        {
          "line": 2659,
          "old_api": "get_xlogue_argument_types",
          "new_api": null,
          "old_text": "get_xlogue_argument_types()",
          "new_text": null,
          "old_line_content": "    auto guard = get_function_creation_guard(get_xlogue_argument_types());",
          "new_line_content": "llvm::Value *TaskCodeGenLLVM::create_xlogue(std::unique_ptr<Block> &block) {",
          "content_same": false
        },
        {
          "line": 2660,
          "old_api": "accept",
          "new_api": null,
          "old_text": "block->accept(this)",
          "new_text": null,
          "old_line_content": "    block->accept(this);",
          "new_line_content": "  llvm::Value *xlogue;",
          "content_same": false
        },
        {
          "line": 2787,
          "old_api": "set_struct_to_buffer",
          "new_api": null,
          "old_text": "set_struct_to_buffer(buffer, buffer_type, elements, struct_type,\n                       current_element, current_index)",
          "new_text": null,
          "old_line_content": "  set_struct_to_buffer(buffer, buffer_type, elements, struct_type,",
          "new_line_content": "    llvm::Value *buffer,",
          "content_same": false
        },
        {
          "line": 2795,
          "old_api": "get_element_type",
          "new_api": null,
          "old_text": "args_type->get_element_type(index)",
          "new_text": null,
          "old_line_content": "  auto *arg_type = args_type->get_element_type(index);",
          "new_line_content": "                       current_element, current_index);",
          "content_same": false
        },
        {
          "line": 2797,
          "old_api": "size",
          "new_api": null,
          "old_text": "index.size()",
          "new_text": null,
          "old_line_content": "  gep_index.reserve(index.size() + 1);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2798,
          "old_api": "get_constant",
          "new_api": null,
          "old_text": "tlctx->get_constant(0)",
          "new_text": null,
          "old_line_content": "  gep_index.push_back(tlctx->get_constant(0));",
          "new_line_content": "llvm::Value *TaskCodeGenLLVM::get_struct_arg(std::vector<int> index,",
          "content_same": false
        },
        {
          "line": 2673,
          "old_api": "get_mesh_xlogue_function_type",
          "new_api": null,
          "old_text": "get_mesh_xlogue_function_type()",
          "new_text": null,
          "old_line_content": "  auto xlogue_type = get_mesh_xlogue_function_type();",
          "new_line_content": "  return xlogue;",
          "content_same": false
        },
        {
          "line": 2674,
          "old_api": "llvm::PointerType::get(xlogue_type, 0)",
          "new_api": null,
          "old_text": "llvm::PointerType::get(xlogue_type, 0)",
          "new_text": null,
          "old_line_content": "  auto xlogue_ptr_type = llvm::PointerType::get(xlogue_type, 0);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 2803,
          "old_api": "get_data_type",
          "new_api": null,
          "old_text": "tlctx->get_data_type(args_type)",
          "new_text": null,
          "old_line_content": "      builder->CreateGEP(tlctx->get_data_type(args_type), args_ptr, gep_index);",
          "new_line_content": "  std::vector<llvm::Value *> gep_index;",
          "content_same": false
        },
        {
          "line": 2677,
          "old_api": "get_mesh_xlogue_argument_types",
          "new_api": null,
          "old_text": "get_mesh_xlogue_argument_types()",
          "new_text": null,
          "old_line_content": "    auto guard = get_function_creation_guard(get_mesh_xlogue_argument_types());",
          "new_line_content": "    std::unique_ptr<Block> &block) {",
          "content_same": false
        },
        {
          "line": 2678,
          "old_api": "accept",
          "new_api": null,
          "old_text": "block->accept(this)",
          "new_text": null,
          "old_line_content": "    block->accept(this);",
          "new_line_content": "  llvm::Value *xlogue;",
          "content_same": false
        },
        {
          "line": 2812,
          "old_api": "get_runtime_type",
          "new_api": null,
          "old_text": "get_runtime_type(\"RuntimeContext\")",
          "new_text": null,
          "old_line_content": "  auto *runtime_context_type = get_runtime_type(\"RuntimeContext\");",
          "new_line_content": "    return gep;",
          "content_same": false
        },
        {
          "line": 2813,
          "old_api": "get_data_type",
          "new_api": null,
          "old_text": "tlctx->get_data_type(callable->args_type)",
          "new_text": null,
          "old_line_content": "  auto *args_type = tlctx->get_data_type(callable->args_type);",
          "new_line_content": "  }",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 44,
      "total_additions": 76,
      "total_deletions": 72,
      "total_api_changes": 192
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 7,
        "api_related_lines": 192,
        "non_api_lines": 3,
        "non_api_line_numbers": [
          2545,
          2546,
          2551
        ]
      }
    },
    "api_calls_before": 1534,
    "api_calls_after": 1538,
    "diff_info": {
      "added_lines": 7,
      "removed_lines": 0,
      "total_diff_lines": 19
    }
  }
}