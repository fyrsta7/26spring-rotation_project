{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/v8/modified_file/abb072c20ee9f7b8e2c8e02d0490d5e6f158e30c",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/v8/modified_file/abb072c20ee9f7b8e2c8e02d0490d5e6f158e30c/before.cc",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/v8/modified_file/abb072c20ee9f7b8e2c8e02d0490d5e6f158e30c/after.cc",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/v8/modified_file/abb072c20ee9f7b8e2c8e02d0490d5e6f158e30c/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 64,
          "old_api": "icache_line_size",
          "new_api": "reinterpret_cast<uintptr_t>(address)",
          "old_text": "sizes.icache_line_size()",
          "new_text": "reinterpret_cast<uintptr_t>(address)",
          "old_line_content": "  uintptr_t isize = sizes.icache_line_size();",
          "new_line_content": "  uintptr_t start = reinterpret_cast<uintptr_t>(address);",
          "content_same": false
        },
        {
          "line": 67,
          "old_api": "CountSetBits",
          "new_api": "dcache_line_size",
          "old_text": "CountSetBits(isize, 64)",
          "new_text": "sizes.dcache_line_size()",
          "old_line_content": "  DCHECK_EQ(CountSetBits(isize, 64), 1);",
          "new_line_content": "  uintptr_t dsize = sizes.dcache_line_size();",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 68,
          "old_api": null,
          "new_api": "icache_line_size",
          "old_text": null,
          "new_text": "sizes.icache_line_size()",
          "old_line_content": "  uintptr_t dstart = start & ~(dsize - 1);",
          "new_line_content": "  uintptr_t isize = sizes.icache_line_size();",
          "content_same": false
        },
        {
          "line": 70,
          "old_api": null,
          "new_api": "CountSetBits",
          "old_text": null,
          "new_text": "CountSetBits(dsize, 64)",
          "old_line_content": "  uintptr_t end = start + length;",
          "new_line_content": "  DCHECK_EQ(CountSetBits(dsize, 64), 1);",
          "content_same": false
        },
        {
          "line": 71,
          "old_api": null,
          "new_api": "CountSetBits",
          "old_text": null,
          "new_text": "CountSetBits(isize, 64)",
          "old_line_content": "",
          "new_line_content": "  DCHECK_EQ(CountSetBits(isize, 64), 1);",
          "content_same": false
        },
        {
          "line": 76,
          "old_api": null,
          "new_api": "__volatile__",
          "old_text": null,
          "new_text": "__volatile__(\n      // Clean every line of the D cache containing the target data.\n      \"0:                                \\n\\t\"\n      // dc       : Data Cache maintenance\n      //    c     : Clean\n      //     i    : Invalidate\n      //      va  : by (Virtual) Address\n      //        c : to the point of Coherency\n      // See ARM DDI 0406B page B2-12 for more information.\n      // We would prefer to use \"cvau\" (clean to the point of unification) here\n      // but we use \"civac\" to work around Cortex-A53 errata 819472, 826319,\n      // 827319 and 824069.\n      \"dc   civac, %[dline]               \\n\\t\"\n      \"add  %[dline], %[dline], %[dsize]  \\n\\t\"\n      \"cmp  %[dline], %[end]              \\n\\t\"\n      \"b.lt 0b                            \\n\\t\"\n      // Barrier to make sure the effect of the code above is visible to the\n      // rest of the world. dsb    : Data Synchronisation Barrier\n      //    ish : Inner SHareable domain\n      // The point of unification for an Inner Shareable shareability domain is\n      // the point by which the instruction and data caches of all the\n      // processors in that Inner Shareable shareability domain are guaranteed\n      // to see the same copy of a memory location.  See ARM DDI 0406B page\n      // B2-12 for more information.\n      \"dsb  ish                           \\n\\t\"\n      // Invalidate every line of the I cache containing the target data.\n      \"1:                                 \\n\\t\"\n      // ic      : instruction cache maintenance\n      //    i    : invalidate\n      //     va  : by address\n      //       u : to the point of unification\n      \"ic   ivau, %[iline]                \\n\\t\"\n      \"add  %[iline], %[iline], %[isize]  \\n\\t\"\n      \"cmp  %[iline], %[end]              \\n\\t\"\n      \"b.lt 1b                            \\n\\t\"\n      // Barrier to make sure the effect of the code above is visible to the\n      // rest of the world.\n      \"dsb  ish                           \\n\\t\"\n      // Barrier to ensure any prefetching which happened before this code is\n      // discarded.\n      // isb : Instruction Synchronisation Barrier\n      \"isb                                \\n\\t\"\n      : [dline] \"+r\"(dstart)",
          "old_line_content": "      //    c     : Clean",
          "new_line_content": "  __asm__ __volatile__(",
          "content_same": false
        },
        {
          "line": 56,
          "old_api": null,
          "new_api": "reinterpret_cast<char*>(address)",
          "old_text": null,
          "new_text": "reinterpret_cast<char*>(address)",
          "old_line_content": "  // The code below assumes user space cache operations are allowed. The goal",
          "new_line_content": "  char* begin = reinterpret_cast<char*>(address);",
          "content_same": false
        },
        {
          "line": 58,
          "old_api": null,
          "new_api": "__builtin___clear_cache",
          "old_text": null,
          "new_text": "__builtin___clear_cache(begin, begin + length)",
          "old_line_content": "  // side of the CPU.",
          "new_line_content": "  __builtin___clear_cache(begin, begin + length);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 72,
          "old_api": "__volatile__",
          "new_api": null,
          "old_text": "__volatile__(\n      // Clean every line of the D cache containing the target data.\n      \"0:                                \\n\\t\"\n      // dc       : Data Cache maintenance\n      //    c     : Clean\n      //     i    : Invalidate\n      //      va  : by (Virtual) Address\n      //        c : to the point of Coherency\n      // See ARM DDI 0406B page B2-12 for more information.\n      // We would prefer to use \"cvau\" (clean to the point of unification) here\n      // but we use \"civac\" to work around Cortex-A53 errata 819472, 826319,\n      // 827319 and 824069.\n      \"dc   civac, %[dline]               \\n\\t\"\n      \"add  %[dline], %[dline], %[dsize]  \\n\\t\"\n      \"cmp  %[dline], %[end]              \\n\\t\"\n      \"b.lt 0b                            \\n\\t\"\n      // Barrier to make sure the effect of the code above is visible to the\n      // rest of the world. dsb    : Data Synchronisation Barrier\n      //    ish : Inner SHareable domain\n      // The point of unification for an Inner Shareable shareability domain is\n      // the point by which the instruction and data caches of all the\n      // processors in that Inner Shareable shareability domain are guaranteed\n      // to see the same copy of a memory location.  See ARM DDI 0406B page\n      // B2-12 for more information.\n      \"dsb  ish                           \\n\\t\"\n      // Invalidate every line of the I cache containing the target data.\n      \"1:                                 \\n\\t\"\n      // ic      : instruction cache maintenance\n      //    i    : invalidate\n      //     va  : by address\n      //       u : to the point of unification\n      \"ic   ivau, %[iline]                \\n\\t\"\n      \"add  %[iline], %[iline], %[isize]  \\n\\t\"\n      \"cmp  %[iline], %[end]              \\n\\t\"\n      \"b.lt 1b                            \\n\\t\"\n      // Barrier to make sure the effect of the code above is visible to the\n      // rest of the world.\n      \"dsb  ish                           \\n\\t\"\n      // Barrier to ensure any prefetching which happened before this code is\n      // discarded.\n      // isb : Instruction Synchronisation Barrier\n      \"isb                                \\n\\t\"\n      : [dline] \"+r\"(dstart)",
          "new_text": null,
          "old_line_content": "  __asm__ __volatile__(",
          "new_line_content": "  uintptr_t dstart = start & ~(dsize - 1);",
          "content_same": false
        },
        {
          "line": 66,
          "old_api": "CountSetBits",
          "new_api": null,
          "old_text": "CountSetBits(dsize, 64)",
          "new_text": null,
          "old_line_content": "  DCHECK_EQ(CountSetBits(dsize, 64), 1);",
          "new_line_content": "  CacheLineSizes sizes;",
          "content_same": false
        },
        {
          "line": 60,
          "old_api": "reinterpret_cast<uintptr_t>(address)",
          "new_api": null,
          "old_text": "reinterpret_cast<uintptr_t>(address)",
          "new_text": null,
          "old_line_content": "  uintptr_t start = reinterpret_cast<uintptr_t>(address);",
          "new_line_content": "  // The code below assumes user space cache operations are allowed. The goal",
          "content_same": false
        },
        {
          "line": 63,
          "old_api": "dcache_line_size",
          "new_api": null,
          "old_text": "sizes.dcache_line_size()",
          "new_text": null,
          "old_line_content": "  uintptr_t dsize = sizes.dcache_line_size();",
          "new_line_content": "",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 2,
      "total_additions": 6,
      "total_deletions": 4,
      "total_api_changes": 12
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 4,
        "api_related_lines": 12,
        "non_api_lines": 2,
        "non_api_line_numbers": [
          57,
          55
        ]
      }
    },
    "api_calls_before": 15,
    "api_calls_after": 17,
    "diff_info": {
      "added_lines": 4,
      "removed_lines": 0,
      "total_diff_lines": 16
    }
  }
}