{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/v8/modified_file/8937bfc1d165ff6d72dede1b0ce6f7c1ab9fb260",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/v8/modified_file/8937bfc1d165ff6d72dede1b0ce6f7c1ab9fb260/before.cc",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/v8/modified_file/8937bfc1d165ff6d72dede1b0ce6f7c1ab9fb260/after.cc",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/v8/modified_file/8937bfc1d165ff6d72dede1b0ce6f7c1ab9fb260/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": true,
    "api_changes": {
      "replacements": [
        {
          "line": 259,
          "old_api": "HasNoSpillType",
          "new_api": "HasSpillOperand",
          "old_text": "range->HasNoSpillType()",
          "new_text": "range->HasSpillOperand()",
          "old_line_content": "    if (range->HasNoSpillType()) continue;",
          "new_line_content": "    if (!range->HasSpillOperand()) continue;",
          "content_same": false
        },
        {
          "line": 276,
          "old_api": "pos",
          "new_api": "ToInstructionIndex",
          "old_text": "pos->pos()",
          "new_text": "GetSplitPositionForInstruction(\n          range, data()->code(), pos->pos().ToInstructionIndex())",
          "old_line_content": "      auto split_pos = pos->pos();",
          "new_line_content": "      auto split_pos = GetSplitPositionForInstruction(",
          "content_same": false
        },
        {
          "line": 277,
          "old_api": "Start",
          "new_api": "ToInstructionIndex",
          "old_text": "split_pos.Start()",
          "new_text": "pos->pos().ToInstructionIndex()",
          "old_line_content": "      if (data()->IsBlockBoundary(split_pos.Start())) {",
          "new_line_content": "          range, data()->code(), pos->pos().ToInstructionIndex());",
          "content_same": false
        },
        {
          "line": 282,
          "old_api": "data",
          "new_api": "Spill",
          "old_text": "data()",
          "new_text": "Spill(range)",
          "old_line_content": "      Split(range, data(), split_pos);",
          "new_line_content": "      Spill(range);",
          "content_same": false
        },
        {
          "line": 296,
          "old_api": "SplitAndSpillRangesDefinedByMemoryOperand",
          "new_api": "PreallocateFixedRanges",
          "old_text": "SplitAndSpillRangesDefinedByMemoryOperand()",
          "new_text": "PreallocateFixedRanges()",
          "old_line_content": "  SplitAndSpillRangesDefinedByMemoryOperand();",
          "new_line_content": "  PreallocateFixedRanges();",
          "content_same": false
        },
        {
          "line": 297,
          "old_api": "PreallocateFixedRanges",
          "new_api": "ScheduleAllocationCandidates",
          "old_text": "PreallocateFixedRanges()",
          "new_text": "ScheduleAllocationCandidates()",
          "old_line_content": "  PreallocateFixedRanges();",
          "new_line_content": "  ScheduleAllocationCandidates();",
          "content_same": false
        },
        {
          "line": 300,
          "old_api": "empty",
          "new_api": "GetNext",
          "old_text": "scheduler().empty()",
          "new_text": "scheduler().GetNext()",
          "old_line_content": "  while (!scheduler().empty()) {",
          "new_line_content": "    AllocationCandidate candidate = scheduler().GetNext();",
          "content_same": false
        },
        {
          "line": 301,
          "old_api": "GetNext",
          "new_api": "TryAllocateCandidate",
          "old_text": "scheduler().GetNext()",
          "new_text": "TryAllocateCandidate(candidate)",
          "old_line_content": "    AllocationCandidate candidate = scheduler().GetNext();",
          "new_line_content": "    TryAllocateCandidate(candidate);",
          "content_same": false
        },
        {
          "line": 308,
          "old_api": "live_ranges",
          "new_api": "HasRegisterAssigned",
          "old_text": "data()->live_ranges()",
          "new_text": "range->HasRegisterAssigned()",
          "old_line_content": "  for (auto range : data()->live_ranges()) {",
          "new_line_content": "    if (CanProcessRange(range) && range->HasRegisterAssigned()) {",
          "content_same": false
        },
        {
          "line": 309,
          "old_api": "HasRegisterAssigned",
          "new_api": "data",
          "old_text": "range->HasRegisterAssigned()",
          "new_text": "data()",
          "old_line_content": "    if (CanProcessRange(range) && range->HasRegisterAssigned()) {",
          "new_line_content": "      UpdateOperands(range, data());",
          "content_same": false
        },
        {
          "line": 314,
          "old_api": "size",
          "new_api": "empty",
          "old_text": "allocations_.size()",
          "new_text": "allocations_[i]->empty()",
          "old_line_content": "  for (size_t i = 0; i < allocations_.size(); ++i) {",
          "new_line_content": "    if (!allocations_[i]->empty()) {",
          "content_same": false
        },
        {
          "line": 315,
          "old_api": "empty",
          "new_api": "static_cast<int>(i)",
          "old_text": "allocations_[i]->empty()",
          "new_text": "static_cast<int>(i)",
          "old_line_content": "    if (!allocations_[i]->empty()) {",
          "new_line_content": "      data()->MarkAllocated(mode(), static_cast<int>(i));",
          "content_same": false
        },
        {
          "line": 330,
          "old_api": "GetConflicts",
          "new_api": "Current",
          "old_text": "current_allocations(reg_id)->GetConflicts(range)",
          "new_text": "conflicts.Current()",
          "old_line_content": "  auto conflicts = current_allocations(reg_id)->GetConflicts(range);",
          "new_line_content": "  for (LiveRange* conflict = conflicts.Current(); conflict != nullptr;",
          "content_same": false
        },
        {
          "line": 331,
          "old_api": "Current",
          "new_api": "GetNext",
          "old_text": "conflicts.Current()",
          "new_text": "conflicts.GetNext()",
          "old_line_content": "  for (LiveRange* conflict = conflicts.Current(); conflict != nullptr;",
          "new_line_content": "       conflict = conflicts.GetNext()) {",
          "content_same": false
        },
        {
          "line": 332,
          "old_api": "GetNext",
          "new_api": "weight",
          "old_text": "conflicts.GetNext()",
          "new_text": "conflict->weight()",
          "old_line_content": "       conflict = conflicts.GetNext()) {",
          "new_line_content": "    DCHECK_NE(conflict->weight(), LiveRange::kInvalidWeight);",
          "content_same": false
        },
        {
          "line": 348,
          "old_api": "TopLevel",
          "new_api": "set_weight",
          "old_text": "range->TopLevel()->IsFixed()",
          "new_text": "range->set_weight(LiveRange::kMaxWeight)",
          "old_line_content": "  if (range->TopLevel()->IsFixed()) {",
          "new_line_content": "    range->set_weight(LiveRange::kMaxWeight);",
          "content_same": false
        },
        {
          "line": 352,
          "old_api": "code",
          "new_api": "set_weight",
          "old_text": "code()",
          "new_text": "range->set_weight(LiveRange::kMaxWeight)",
          "old_line_content": "  if (!IsProgressPossible(range, code())) {",
          "new_line_content": "    range->set_weight(LiveRange::kMaxWeight);",
          "content_same": false
        },
        {
          "line": 366,
          "old_api": "Start",
          "new_api": "CanBeSpilled",
          "old_text": "range->Start()",
          "new_text": "range->CanBeSpilled(start)",
          "old_line_content": "  LifetimePosition start = range->Start();",
          "new_line_content": "  CHECK(range->CanBeSpilled(start));",
          "content_same": false
        },
        {
          "line": 369,
          "old_api": "NextRegisterPosition",
          "new_api": "Spill",
          "old_text": "range->NextRegisterPosition(start)",
          "new_text": "Spill(range)",
          "old_line_content": "  DCHECK(range->NextRegisterPosition(start) == nullptr);",
          "new_line_content": "  Spill(range);",
          "content_same": false
        },
        {
          "line": 377,
          "old_api": "code",
          "new_api": "IsValid",
          "old_text": "code()",
          "new_text": "pos.IsValid()",
          "old_line_content": "  auto pos = GetLastResortSplitPosition(range, code());",
          "new_line_content": "  if (pos.IsValid()) {",
          "content_same": false
        },
        {
          "line": 378,
          "old_api": "IsValid",
          "new_api": "data",
          "old_text": "pos.IsValid()",
          "new_text": "data()",
          "old_line_content": "  if (pos.IsValid()) {",
          "new_line_content": "    LiveRange* tail = Split(range, data(), pos);",
          "content_same": false
        },
        {
          "line": 379,
          "old_api": "data",
          "new_api": "DCHECK",
          "old_text": "data()",
          "new_text": "DCHECK(tail != range)",
          "old_line_content": "    LiveRange* tail = Split(range, data(), pos);",
          "new_line_content": "    DCHECK(tail != range);",
          "content_same": false
        },
        {
          "line": 380,
          "old_api": "DCHECK",
          "new_api": "Schedule",
          "old_text": "DCHECK(tail != range)",
          "new_text": "scheduler().Schedule(tail)",
          "old_line_content": "    DCHECK(tail != range);",
          "new_line_content": "    scheduler().Schedule(tail);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 384,
          "old_api": null,
          "new_api": "SpillRangeAsLastResort",
          "old_text": null,
          "new_text": "SpillRangeAsLastResort(range)",
          "old_line_content": "  }",
          "new_line_content": "  SpillRangeAsLastResort(range);",
          "content_same": false
        },
        {
          "line": 279,
          "old_api": null,
          "new_api": "NextFullStart",
          "old_text": null,
          "new_text": "range->Start().NextFullStart()",
          "old_line_content": "      } else {",
          "new_line_content": "          FindOptimalSplitPos(range->Start().NextFullStart(), split_pos);",
          "content_same": false
        },
        {
          "line": 281,
          "old_api": null,
          "new_api": "data",
          "old_text": null,
          "new_text": "data()",
          "old_line_content": "      }",
          "new_line_content": "      Split(range, data(), split_pos);",
          "content_same": false
        },
        {
          "line": 289,
          "old_api": null,
          "new_api": "empty",
          "old_text": null,
          "new_text": "scheduler().empty()",
          "old_line_content": "void GreedyAllocator::AllocateRegisters() {",
          "new_line_content": "  CHECK(scheduler().empty());",
          "content_same": false
        },
        {
          "line": 292,
          "old_api": null,
          "new_api": "debug_name",
          "old_text": null,
          "new_text": "TRACE(\"Begin allocating function %s with the Greedy Allocator\\n\",\n        data()->debug_name())",
          "old_line_content": "",
          "new_line_content": "  TRACE(\"Begin allocating function %s with the Greedy Allocator\\n\",",
          "content_same": false
        },
        {
          "line": 295,
          "old_api": null,
          "new_api": "SplitAndSpillRangesDefinedByMemoryOperand",
          "old_text": null,
          "new_text": "SplitAndSpillRangesDefinedByMemoryOperand()",
          "old_line_content": "",
          "new_line_content": "  SplitAndSpillRangesDefinedByMemoryOperand();",
          "content_same": false
        },
        {
          "line": 299,
          "old_api": null,
          "new_api": "empty",
          "old_text": null,
          "new_text": "scheduler().empty()",
          "old_line_content": "",
          "new_line_content": "  while (!scheduler().empty()) {",
          "content_same": false
        },
        {
          "line": 307,
          "old_api": null,
          "new_api": "live_ranges",
          "old_text": null,
          "new_text": "data()->live_ranges()",
          "old_line_content": "  // actively update/reset operands until the end.",
          "new_line_content": "  for (auto range : data()->live_ranges()) {",
          "content_same": false
        },
        {
          "line": 313,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "allocations_.size()",
          "old_line_content": "",
          "new_line_content": "  for (size_t i = 0; i < allocations_.size(); ++i) {",
          "content_same": false
        },
        {
          "line": 318,
          "old_api": null,
          "new_api": "clear",
          "old_text": null,
          "new_text": "allocations_.clear()",
          "old_line_content": "  }",
          "new_line_content": "  allocations_.clear();",
          "content_same": false
        },
        {
          "line": 320,
          "old_api": null,
          "new_api": "debug_name",
          "old_text": null,
          "new_text": "TRACE(\"End allocating function %s with the Greedy Allocator\\n\",\n        data()->debug_name())",
          "old_line_content": "",
          "new_line_content": "  TRACE(\"End allocating function %s with the Greedy Allocator\\n\",",
          "content_same": false
        },
        {
          "line": 329,
          "old_api": null,
          "new_api": "GetConflicts",
          "old_text": null,
          "new_text": "current_allocations(reg_id)->GetConflicts(range)",
          "old_line_content": "",
          "new_line_content": "  auto conflicts = current_allocations(reg_id)->GetConflicts(range);",
          "content_same": false
        },
        {
          "line": 345,
          "old_api": null,
          "new_api": "weight",
          "old_text": null,
          "new_text": "range->weight()",
          "old_line_content": "  // unallocated.",
          "new_line_content": "  if (range->weight() != LiveRange::kInvalidWeight) return;",
          "content_same": false
        },
        {
          "line": 347,
          "old_api": null,
          "new_api": "TopLevel",
          "old_text": null,
          "new_text": "range->TopLevel()->IsFixed()",
          "old_line_content": "",
          "new_line_content": "  if (range->TopLevel()->IsFixed()) {",
          "content_same": false
        },
        {
          "line": 351,
          "old_api": null,
          "new_api": "code",
          "old_text": null,
          "new_text": "code()",
          "old_line_content": "  }",
          "new_line_content": "  if (!IsProgressPossible(range, code())) {",
          "content_same": false
        },
        {
          "line": 357,
          "old_api": null,
          "new_api": "next",
          "old_text": null,
          "new_text": "pos->next()",
          "old_line_content": "  float use_count = 0.0;",
          "new_line_content": "  for (auto pos = range->first_pos(); pos != nullptr; pos = pos->next()) {",
          "content_same": false
        },
        {
          "line": 360,
          "old_api": null,
          "new_api": "GetSize",
          "old_text": null,
          "new_text": "range->GetSize()",
          "old_line_content": "  }",
          "new_line_content": "  range->set_weight(use_count / static_cast<float>(range->GetSize()));",
          "content_same": false
        },
        {
          "line": 365,
          "old_api": null,
          "new_api": "Start",
          "old_text": null,
          "new_text": "range->Start()",
          "old_line_content": "void GreedyAllocator::SpillRangeAsLastResort(LiveRange* range) {",
          "new_line_content": "  LifetimePosition start = range->Start();",
          "content_same": false
        },
        {
          "line": 368,
          "old_api": null,
          "new_api": "NextRegisterPosition",
          "old_text": null,
          "new_text": "range->NextRegisterPosition(start)",
          "old_line_content": "",
          "new_line_content": "  DCHECK(range->NextRegisterPosition(start) == nullptr);",
          "content_same": false
        },
        {
          "line": 376,
          "old_api": null,
          "new_api": "code",
          "old_text": null,
          "new_text": "code()",
          "old_line_content": "  // heuristics, once they exist, out of which GLRSP is the last one.",
          "new_line_content": "  auto pos = GetLastResortSplitPosition(range, code());",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 385,
          "old_api": "SpillRangeAsLastResort",
          "new_api": null,
          "old_text": "SpillRangeAsLastResort(range)",
          "new_text": null,
          "old_line_content": "  SpillRangeAsLastResort(range);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 278,
          "old_api": "Start",
          "new_api": null,
          "old_text": "split_pos.Start()",
          "new_text": null,
          "old_line_content": "        split_pos = split_pos.Start();",
          "new_line_content": "      split_pos =",
          "content_same": false
        },
        {
          "line": 280,
          "old_api": "PrevStart",
          "new_api": null,
          "old_text": "split_pos.PrevStart().End()",
          "new_text": null,
          "old_line_content": "        split_pos = split_pos.PrevStart().End();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 283,
          "old_api": "Spill",
          "new_api": null,
          "old_text": "Spill(range)",
          "new_text": null,
          "old_line_content": "      Spill(range);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 291,
          "old_api": "empty",
          "new_api": null,
          "old_text": "allocations_.empty()",
          "new_text": null,
          "old_line_content": "  CHECK(allocations_.empty());",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 294,
          "old_api": "debug_name",
          "new_api": null,
          "old_text": "data()->debug_name()",
          "new_text": null,
          "old_line_content": "        data()->debug_name());",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 298,
          "old_api": "ScheduleAllocationCandidates",
          "new_api": null,
          "old_text": "ScheduleAllocationCandidates()",
          "new_text": null,
          "old_line_content": "  ScheduleAllocationCandidates();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 302,
          "old_api": "TryAllocateCandidate",
          "new_api": null,
          "old_text": "TryAllocateCandidate(candidate)",
          "new_text": null,
          "old_line_content": "    TryAllocateCandidate(candidate);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 310,
          "old_api": "data",
          "new_api": null,
          "old_text": "data()",
          "new_text": null,
          "old_line_content": "      UpdateOperands(range, data());",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 316,
          "old_api": "static_cast<int>(i)",
          "new_api": null,
          "old_text": "static_cast<int>(i)",
          "new_text": null,
          "old_line_content": "      data()->MarkAllocated(mode(), static_cast<int>(i));",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 319,
          "old_api": "clear",
          "new_api": null,
          "old_text": "allocations_.clear()",
          "new_text": null,
          "old_line_content": "  allocations_.clear();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 322,
          "old_api": "debug_name",
          "new_api": null,
          "old_text": "data()->debug_name()",
          "new_text": null,
          "old_line_content": "        data()->debug_name());",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 334,
          "old_api": "weight",
          "new_api": null,
          "old_text": "conflict->weight()",
          "new_text": null,
          "old_line_content": "    ret = Max(ret, conflict->weight());",
          "new_line_content": "    if (ret == LiveRange::kMaxWeight) return ret;",
          "content_same": false
        },
        {
          "line": 346,
          "old_api": "weight",
          "new_api": null,
          "old_text": "range->weight()",
          "new_text": null,
          "old_line_content": "  if (range->weight() != LiveRange::kInvalidWeight) return;",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 349,
          "old_api": "set_weight",
          "new_api": null,
          "old_text": "range->set_weight(LiveRange::kMaxWeight)",
          "new_text": null,
          "old_line_content": "    range->set_weight(LiveRange::kMaxWeight);",
          "new_line_content": "    return;",
          "content_same": false
        },
        {
          "line": 353,
          "old_api": "set_weight",
          "new_api": null,
          "old_text": "range->set_weight(LiveRange::kMaxWeight)",
          "new_text": null,
          "old_line_content": "    range->set_weight(LiveRange::kMaxWeight);",
          "new_line_content": "    return;",
          "content_same": false
        },
        {
          "line": 358,
          "old_api": "next",
          "new_api": null,
          "old_text": "pos->next()",
          "new_text": null,
          "old_line_content": "  for (auto pos = range->first_pos(); pos != nullptr; pos = pos->next()) {",
          "new_line_content": "    ++use_count;",
          "content_same": false
        },
        {
          "line": 361,
          "old_api": "GetSize",
          "new_api": null,
          "old_text": "range->GetSize()",
          "new_text": null,
          "old_line_content": "  range->set_weight(use_count / static_cast<float>(range->GetSize()));",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 367,
          "old_api": "CanBeSpilled",
          "new_api": null,
          "old_text": "range->CanBeSpilled(start)",
          "new_text": null,
          "old_line_content": "  CHECK(range->CanBeSpilled(start));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 370,
          "old_api": "Spill",
          "new_api": null,
          "old_text": "Spill(range)",
          "new_text": null,
          "old_line_content": "  Spill(range);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 382,
          "old_api": "Schedule",
          "new_api": null,
          "old_text": "scheduler().Schedule(range)",
          "new_text": null,
          "old_line_content": "    scheduler().Schedule(range);",
          "new_line_content": "    return;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 23,
      "total_additions": 20,
      "total_deletions": 21,
      "total_api_changes": 64
    },
    "non_api_changes": {
      "has_non_api_changes": false,
      "evidence": {
        "total_diff_lines": 7,
        "api_related_lines": 64,
        "non_api_lines": 0,
        "non_api_line_numbers": []
      }
    },
    "api_calls_before": 239,
    "api_calls_after": 240,
    "diff_info": {
      "added_lines": 6,
      "removed_lines": 7,
      "total_diff_lines": 32
    }
  }
}