{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/v8/modified_file/f82b30cef9bf193301cd20a2b6d1650d8d297be0",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/v8/modified_file/f82b30cef9bf193301cd20a2b6d1650d8d297be0/before.cc",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/v8/modified_file/f82b30cef9bf193301cd20a2b6d1650d8d297be0/after.cc",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/v8/modified_file/f82b30cef9bf193301cd20a2b6d1650d8d297be0/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 903,
          "old_api": "OS::SetPermissions(address, size, access)",
          "new_api": "OS::DecommitPages(address, size)",
          "old_text": "OS::SetPermissions(address, size, access)",
          "new_text": "OS::DecommitPages(address, size)",
          "old_line_content": "  return OS::SetPermissions(address, size, access);",
          "new_line_content": "  return OS::DecommitPages(address, size);",
          "content_same": false
        },
        {
          "line": 908,
          "old_api": "OS::DiscardSystemPages(address, size)",
          "new_api": "Contains",
          "old_text": "OS::DiscardSystemPages(address, size)",
          "new_text": "Contains(address, size)",
          "old_line_content": "  return OS::DiscardSystemPages(address, size);",
          "new_line_content": "  DCHECK(Contains(address, size));",
          "content_same": false
        },
        {
          "line": 913,
          "old_api": "OS::DecommitPages(address, size)",
          "new_api": "Contains",
          "old_text": "OS::DecommitPages(address, size)",
          "new_text": "Contains(address, size)",
          "old_line_content": "  return OS::DecommitPages(address, size);",
          "new_line_content": "  DCHECK(Contains(address, size));",
          "content_same": false
        },
        {
          "line": 955,
          "old_api": "reinterpret_cast<void**>(&dynamic_pthread_setname_np)",
          "new_api": "STATIC_ASSERT",
          "old_text": "reinterpret_cast<void**>(&dynamic_pthread_setname_np)",
          "new_text": "STATIC_ASSERT(Thread::kMaxThreadNameLength <= PTHREAD_MAX_NAMELEN_NP)",
          "old_line_content": "  *reinterpret_cast<void**>(&dynamic_pthread_setname_np) =",
          "new_line_content": "  STATIC_ASSERT(Thread::kMaxThreadNameLength <= PTHREAD_MAX_NAMELEN_NP);",
          "content_same": false
        },
        {
          "line": 956,
          "old_api": "dlsym",
          "new_api": "pthread_self",
          "old_text": "dlsym(RTLD_DEFAULT, \"pthread_setname_np\")",
          "new_text": "pthread_self()",
          "old_line_content": "    dlsym(RTLD_DEFAULT, \"pthread_setname_np\");",
          "new_line_content": "  pthread_setname_np(pthread_self(), \"%s\", name);",
          "content_same": false
        },
        {
          "line": 961,
          "old_api": "STATIC_ASSERT",
          "new_api": "reinterpret_cast<void**>(&dynamic_pthread_setname_np)",
          "old_text": "STATIC_ASSERT(Thread::kMaxThreadNameLength <= kMaxNameLength)",
          "new_text": "reinterpret_cast<void**>(&dynamic_pthread_setname_np)",
          "old_line_content": "  STATIC_ASSERT(Thread::kMaxThreadNameLength <= kMaxNameLength);",
          "new_line_content": "  *reinterpret_cast<void**>(&dynamic_pthread_setname_np) =",
          "content_same": false
        },
        {
          "line": 962,
          "old_api": "dynamic_pthread_setname_np",
          "new_api": "dlsym",
          "old_text": "dynamic_pthread_setname_np(name)",
          "new_text": "dlsym(RTLD_DEFAULT, \"pthread_setname_np\")",
          "old_line_content": "  dynamic_pthread_setname_np(name);",
          "new_line_content": "    dlsym(RTLD_DEFAULT, \"pthread_setname_np\");",
          "content_same": false
        },
        {
          "line": 978,
          "old_api": "data",
          "new_api": "reinterpret_cast<Thread*>(arg)",
          "old_text": "thread->data()",
          "new_text": "reinterpret_cast<Thread*>(arg)",
          "old_line_content": "  DCHECK_NE(thread->data()->thread_, kNoThread);",
          "new_line_content": "  Thread* thread = reinterpret_cast<Thread*>(arg);",
          "content_same": false
        },
        {
          "line": 985,
          "old_api": "strncpy",
          "new_api": "NotifyStartedAndRun",
          "old_text": "strncpy(name_, name, sizeof(name_) - 1)",
          "new_text": "thread->NotifyStartedAndRun()",
          "old_line_content": "  strncpy(name_, name, sizeof(name_) - 1);",
          "new_line_content": "  thread->NotifyStartedAndRun();",
          "content_same": false
        },
        {
          "line": 1066,
          "old_api": "strchr",
          "new_api": "FATAL",
          "old_text": "strchr(buffer, '.')",
          "new_text": "FATAL(\"V8 failed to get kernel version\")",
          "old_line_content": "  char* period_pos = strchr(buffer, '.');",
          "new_line_content": "    FATAL(\"V8 failed to get kernel version\");",
          "content_same": false
        },
        {
          "line": 1090,
          "old_api": "Thread::SetThreadLocal(key, expected)",
          "new_api": "store",
          "old_text": "Thread::SetThreadLocal(key, expected)",
          "new_text": "tls_base_offset_initialized.store(true, std::memory_order_release)",
          "old_line_content": "  Thread::SetThreadLocal(key, expected);",
          "new_line_content": "  tls_base_offset_initialized.store(true, std::memory_order_release);",
          "content_same": false
        },
        {
          "line": 1095,
          "old_api": "Thread::SetThreadLocal(key, nullptr)",
          "new_api": "reinterpret_cast<void*>(0x1234CAFE)",
          "old_text": "Thread::SetThreadLocal(key, nullptr)",
          "new_text": "reinterpret_cast<void*>(0x1234CAFE)",
          "old_line_content": "  Thread::SetThreadLocal(key, nullptr);",
          "new_line_content": "  void* expected = reinterpret_cast<void*>(0x1234CAFE);",
          "content_same": false
        },
        {
          "line": 1110,
          "old_api": "pthread_key_create",
          "new_api": "load",
          "old_text": "pthread_key_create(&key, nullptr)",
          "new_text": "tls_base_offset_initialized.load(std::memory_order_acquire)",
          "old_line_content": "  int result = pthread_key_create(&key, nullptr);",
          "new_line_content": "  if (!tls_base_offset_initialized.load(std::memory_order_acquire)) {",
          "content_same": false
        },
        {
          "line": 1112,
          "old_api": "USE",
          "new_api": "InitializeTlsBaseOffset",
          "old_text": "USE(result)",
          "new_text": "InitializeTlsBaseOffset()",
          "old_line_content": "  USE(result);",
          "new_line_content": "    InitializeTlsBaseOffset();",
          "content_same": false
        },
        {
          "line": 1116,
          "old_api": "CheckFastTls",
          "new_api": "pthread_key_create",
          "old_text": "CheckFastTls(local_key)",
          "new_text": "pthread_key_create(&key, nullptr)",
          "old_line_content": "  if (check_fast_tls) CheckFastTls(local_key);",
          "new_line_content": "  int result = pthread_key_create(&key, nullptr);",
          "content_same": false
        },
        {
          "line": 1131,
          "old_api": "LocalKeyToPthreadKey",
          "new_api": "DCHECK_EQ",
          "old_text": "LocalKeyToPthreadKey(key)",
          "new_text": "DCHECK_EQ(0, result)",
          "old_line_content": "  pthread_key_t pthread_key = LocalKeyToPthreadKey(key);",
          "new_line_content": "  DCHECK_EQ(0, result);",
          "content_same": false
        },
        {
          "line": 1132,
          "old_api": "pthread_getspecific",
          "new_api": "USE",
          "old_text": "pthread_getspecific(pthread_key)",
          "new_text": "USE(result)",
          "old_line_content": "  return pthread_getspecific(pthread_key);",
          "new_line_content": "  USE(result);",
          "content_same": false
        },
        {
          "line": 1138,
          "old_api": "pthread_setspecific",
          "new_api": "pthread_getspecific",
          "old_text": "pthread_setspecific(pthread_key, value)",
          "new_text": "pthread_getspecific(pthread_key)",
          "old_line_content": "  int result = pthread_setspecific(pthread_key, value);",
          "new_line_content": "  return pthread_getspecific(pthread_key);",
          "content_same": false
        },
        {
          "line": 1158,
          "old_api": "pthread_attr_destroy",
          "new_api": "pthread_self",
          "old_text": "pthread_attr_destroy(&attr)",
          "new_text": "pthread_self()",
          "old_line_content": "    pthread_attr_destroy(&attr);",
          "new_line_content": "  int error = pthread_getattr_np(pthread_self(), &attr);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 1026,
          "old_api": null,
          "new_api": "pthread_join",
          "old_text": null,
          "new_text": "pthread_join(data_->thread_, nullptr)",
          "old_line_content": "  // work on 64-bit platforms, but Cygwin doesn't support 64-bit anyway.",
          "new_line_content": "void Thread::Join() { pthread_join(data_->thread_, nullptr); }",
          "content_same": false
        },
        {
          "line": 898,
          "old_api": null,
          "new_api": "OS::SetPermissions(address, size, access)",
          "old_text": null,
          "new_text": "OS::SetPermissions(address, size, access)",
          "old_line_content": "}",
          "new_line_content": "  return OS::SetPermissions(address, size, access);",
          "content_same": false
        },
        {
          "line": 1033,
          "old_api": null,
          "new_api": "STATIC_ASSERT",
          "old_text": null,
          "new_text": "STATIC_ASSERT(sizeof(Thread::LocalStorageKey) == sizeof(pthread_key_t))",
          "old_line_content": "}",
          "new_line_content": "  STATIC_ASSERT(sizeof(Thread::LocalStorageKey) == sizeof(pthread_key_t));",
          "content_same": false
        },
        {
          "line": 1034,
          "old_api": null,
          "new_api": "reinterpret_cast<intptr_t>(pthread_key)",
          "old_text": null,
          "new_text": "reinterpret_cast<intptr_t>(pthread_key)",
          "old_line_content": "",
          "new_line_content": "  intptr_t ptr_key = reinterpret_cast<intptr_t>(pthread_key);",
          "content_same": false
        },
        {
          "line": 1035,
          "old_api": null,
          "new_api": "static_cast<Thread::LocalStorageKey>(ptr_key)",
          "old_text": null,
          "new_text": "static_cast<Thread::LocalStorageKey>(ptr_key)",
          "old_line_content": "",
          "new_line_content": "  return static_cast<Thread::LocalStorageKey>(ptr_key);",
          "content_same": false
        },
        {
          "line": 1162,
          "old_api": null,
          "new_api": "pthread_attr_getstack",
          "old_text": null,
          "new_text": "pthread_attr_getstack(&attr, &base, &size)",
          "old_line_content": "#if defined(V8_LIBC_GLIBC)",
          "new_line_content": "    error = pthread_attr_getstack(&attr, &base, &size);",
          "content_same": false
        },
        {
          "line": 1037,
          "old_api": null,
          "new_api": "static_cast<Thread::LocalStorageKey>(pthread_key)",
          "old_text": null,
          "new_text": "static_cast<Thread::LocalStorageKey>(pthread_key)",
          "old_line_content": "#if V8_OS_CYGWIN",
          "new_line_content": "  return static_cast<Thread::LocalStorageKey>(pthread_key);",
          "content_same": false
        },
        {
          "line": 1163,
          "old_api": null,
          "new_api": "CHECK",
          "old_text": null,
          "new_text": "CHECK(!error)",
          "old_line_content": "  // pthread_getattr_np can fail for the main thread. In this case",
          "new_line_content": "    CHECK(!error);",
          "content_same": false
        },
        {
          "line": 1164,
          "old_api": null,
          "new_api": "pthread_attr_destroy",
          "old_text": null,
          "new_text": "pthread_attr_destroy(&attr)",
          "old_line_content": "  // just like NaCl we rely on the __libc_stack_end to give us",
          "new_line_content": "    pthread_attr_destroy(&attr);",
          "content_same": false
        },
        {
          "line": 1165,
          "old_api": null,
          "new_api": "reinterpret_cast<uint8_t*>(base)",
          "old_text": null,
          "new_text": "reinterpret_cast<uint8_t*>(base)",
          "old_line_content": "  // the start of the stack.",
          "new_line_content": "    return reinterpret_cast<uint8_t*>(base) + size;",
          "content_same": false
        },
        {
          "line": 909,
          "old_api": null,
          "new_api": "OS::SetPermissions(address, size, access)",
          "old_text": null,
          "new_text": "OS::SetPermissions(address, size, access)",
          "old_line_content": "}",
          "new_line_content": "  return OS::SetPermissions(address, size, access);",
          "content_same": false
        },
        {
          "line": 914,
          "old_api": null,
          "new_api": "OS::DiscardSystemPages(address, size)",
          "old_text": null,
          "new_text": "OS::DiscardSystemPages(address, size)",
          "old_line_content": "}",
          "new_line_content": "  return OS::DiscardSystemPages(address, size);",
          "content_same": false
        },
        {
          "line": 1044,
          "old_api": null,
          "new_api": "STATIC_ASSERT",
          "old_text": null,
          "new_text": "STATIC_ASSERT(sizeof(Thread::LocalStorageKey) == sizeof(pthread_key_t))",
          "old_line_content": "}",
          "new_line_content": "  STATIC_ASSERT(sizeof(Thread::LocalStorageKey) == sizeof(pthread_key_t));",
          "content_same": false
        },
        {
          "line": 1045,
          "old_api": null,
          "new_api": "static_cast<intptr_t>(local_key)",
          "old_text": null,
          "new_text": "static_cast<intptr_t>(local_key)",
          "old_line_content": "",
          "new_line_content": "  intptr_t ptr_key = static_cast<intptr_t>(local_key);",
          "content_same": false
        },
        {
          "line": 1046,
          "old_api": null,
          "new_api": "reinterpret_cast<pthread_key_t>(ptr_key)",
          "old_text": null,
          "new_text": "reinterpret_cast<pthread_key_t>(ptr_key)",
          "old_line_content": "",
          "new_line_content": "  return reinterpret_cast<pthread_key_t>(ptr_key);",
          "content_same": false
        },
        {
          "line": 918,
          "old_api": null,
          "new_api": "Contains",
          "old_text": null,
          "new_text": "Contains(address, size)",
          "old_line_content": "// ----------------------------------------------------------------------------",
          "new_line_content": "  DCHECK(Contains(address, size));",
          "content_same": false
        },
        {
          "line": 1048,
          "old_api": null,
          "new_api": "static_cast<pthread_key_t>(local_key)",
          "old_text": null,
          "new_text": "static_cast<pthread_key_t>(local_key)",
          "old_line_content": "",
          "new_line_content": "  return static_cast<pthread_key_t>(local_key);",
          "content_same": false
        },
        {
          "line": 919,
          "old_api": null,
          "new_api": "OS::DecommitPages(address, size)",
          "old_text": null,
          "new_text": "OS::DecommitPages(address, size)",
          "old_line_content": "// POSIX thread support.",
          "new_line_content": "  return OS::DecommitPages(address, size);",
          "content_same": false
        },
        {
          "line": 1184,
          "old_api": null,
          "new_api": "__builtin_frame_address",
          "old_text": null,
          "new_text": "__builtin_frame_address(0)",
          "old_line_content": "",
          "new_line_content": "  return __builtin_frame_address(0);",
          "content_same": false
        },
        {
          "line": 1065,
          "old_api": null,
          "new_api": "sysctl",
          "old_text": null,
          "new_text": "sysctl(ctl_name, 2, buffer, &buffer_size, nullptr, 0)",
          "old_line_content": "  buffer[kBufferSize - 1] = '\\0';",
          "new_line_content": "  if (sysctl(ctl_name, 2, buffer, &buffer_size, nullptr, 0) != 0) {",
          "content_same": false
        },
        {
          "line": 938,
          "old_api": null,
          "new_api": "stack_size",
          "old_text": null,
          "new_text": "options.stack_size()",
          "old_line_content": "",
          "new_line_content": "      stack_size_(options.stack_size()),",
          "content_same": false
        },
        {
          "line": 940,
          "old_api": null,
          "new_api": "static_cast<int>(PTHREAD_STACK_MIN)",
          "old_text": null,
          "new_text": "static_cast<int>(PTHREAD_STACK_MIN)",
          "old_line_content": "Thread::~Thread() {",
          "new_line_content": "  const int min_stack_size = static_cast<int>(PTHREAD_STACK_MIN);",
          "content_same": false
        },
        {
          "line": 941,
          "old_api": null,
          "new_api": "std::max(stack_size_, min_stack_size)",
          "old_text": null,
          "new_text": "std::max(stack_size_, min_stack_size)",
          "old_line_content": "  delete data_;",
          "new_line_content": "  if (stack_size_ > 0) stack_size_ = std::max(stack_size_, min_stack_size);",
          "content_same": false
        },
        {
          "line": 942,
          "old_api": null,
          "new_api": "name",
          "old_text": null,
          "new_text": "options.name()",
          "old_line_content": "}",
          "new_line_content": "  set_name(options.name());",
          "content_same": false
        },
        {
          "line": 1072,
          "old_api": null,
          "new_api": "strchr",
          "old_text": null,
          "new_text": "strchr(buffer, '.')",
          "old_line_content": "    // 8.x.x (Tiger), 9.x.x (Leopard), 10.x.x (Snow Leopard) have the",
          "new_line_content": "  char* period_pos = strchr(buffer, '.');",
          "content_same": false
        },
        {
          "line": 1074,
          "old_api": null,
          "new_api": "strtol",
          "old_text": null,
          "new_text": "strtol(buffer, nullptr, 10)",
          "old_line_content": "#if V8_HOST_ARCH_IA32",
          "new_line_content": "  int kernel_version_major = static_cast<int>(strtol(buffer, nullptr, 10));",
          "content_same": false
        },
        {
          "line": 953,
          "old_api": null,
          "new_api": "pthread_self",
          "old_text": null,
          "new_text": "pthread_self()",
          "old_line_content": "  // for it at runtime.",
          "new_line_content": "  pthread_set_name_np(pthread_self(), name);",
          "content_same": false
        },
        {
          "line": 967,
          "old_api": null,
          "new_api": "STATIC_ASSERT",
          "old_text": null,
          "new_text": "STATIC_ASSERT(Thread::kMaxThreadNameLength <= kMaxNameLength)",
          "old_line_content": "#endif",
          "new_line_content": "  STATIC_ASSERT(Thread::kMaxThreadNameLength <= kMaxNameLength);",
          "content_same": false
        },
        {
          "line": 1096,
          "old_api": null,
          "new_api": "Thread::SetThreadLocal(key, expected)",
          "old_text": null,
          "new_text": "Thread::SetThreadLocal(key, expected)",
          "old_line_content": "}",
          "new_line_content": "  Thread::SetThreadLocal(key, expected);",
          "content_same": false
        },
        {
          "line": 1097,
          "old_api": null,
          "new_api": "Thread::GetExistingThreadLocal(key)",
          "old_text": null,
          "new_text": "Thread::GetExistingThreadLocal(key)",
          "old_line_content": "",
          "new_line_content": "  void* actual = Thread::GetExistingThreadLocal(key);",
          "content_same": false
        },
        {
          "line": 968,
          "old_api": null,
          "new_api": "dynamic_pthread_setname_np",
          "old_text": null,
          "new_text": "dynamic_pthread_setname_np(name)",
          "old_line_content": "}",
          "new_line_content": "  dynamic_pthread_setname_np(name);",
          "content_same": false
        },
        {
          "line": 1099,
          "old_api": null,
          "new_api": "FATAL",
          "old_text": null,
          "new_text": "FATAL(\"V8 failed to initialize fast TLS on current kernel\")",
          "old_line_content": "",
          "new_line_content": "    FATAL(\"V8 failed to initialize fast TLS on current kernel\");",
          "content_same": false
        },
        {
          "line": 970,
          "old_api": null,
          "new_api": "prctl",
          "old_text": null,
          "new_text": "prctl(PR_SET_NAME,\n        reinterpret_cast<unsigned long>(name),  // NOLINT\n        0, 0, 0)",
          "old_line_content": "",
          "new_line_content": "  prctl(PR_SET_NAME,",
          "content_same": false
        },
        {
          "line": 1101,
          "old_api": null,
          "new_api": "Thread::SetThreadLocal(key, nullptr)",
          "old_text": null,
          "new_text": "Thread::SetThreadLocal(key, nullptr)",
          "old_line_content": "Thread::LocalStorageKey Thread::CreateThreadLocalKey() {",
          "new_line_content": "  Thread::SetThreadLocal(key, nullptr);",
          "content_same": false
        },
        {
          "line": 971,
          "old_api": null,
          "new_api": "reinterpret_cast<unsigned long>(name)",
          "old_text": null,
          "new_text": "reinterpret_cast<unsigned long>(name)",
          "old_line_content": "static void* ThreadEntry(void* arg) {",
          "new_line_content": "        reinterpret_cast<unsigned long>(name),  // NOLINT",
          "content_same": false
        },
        {
          "line": 982,
          "old_api": null,
          "new_api": "data",
          "old_text": null,
          "new_text": "thread->data()",
          "old_line_content": "",
          "new_line_content": "  { MutexGuard lock_guard(&thread->data()->thread_creation_mutex_); }",
          "content_same": false
        },
        {
          "line": 983,
          "old_api": null,
          "new_api": "name",
          "old_text": null,
          "new_text": "thread->name()",
          "old_line_content": "",
          "new_line_content": "  SetThreadName(thread->name());",
          "content_same": false
        },
        {
          "line": 984,
          "old_api": null,
          "new_api": "data",
          "old_text": null,
          "new_text": "thread->data()",
          "old_line_content": "void Thread::set_name(const char* name) {",
          "new_line_content": "  DCHECK_NE(thread->data()->thread_, kNoThread);",
          "content_same": false
        },
        {
          "line": 1117,
          "old_api": null,
          "new_api": "DCHECK_EQ",
          "old_text": null,
          "new_text": "DCHECK_EQ(0, result)",
          "old_line_content": "#endif",
          "new_line_content": "  DCHECK_EQ(0, result);",
          "content_same": false
        },
        {
          "line": 1118,
          "old_api": null,
          "new_api": "USE",
          "old_text": null,
          "new_text": "USE(result)",
          "old_line_content": "  return local_key;",
          "new_line_content": "  USE(result);",
          "content_same": false
        },
        {
          "line": 1119,
          "old_api": null,
          "new_api": "PthreadKeyToLocalKey",
          "old_text": null,
          "new_text": "PthreadKeyToLocalKey(key)",
          "old_line_content": "}",
          "new_line_content": "  LocalStorageKey local_key = PthreadKeyToLocalKey(key);",
          "content_same": false
        },
        {
          "line": 991,
          "old_api": null,
          "new_api": "strncpy",
          "old_text": null,
          "new_text": "strncpy(name_, name, sizeof(name_) - 1)",
          "old_line_content": "  pthread_attr_t attr;",
          "new_line_content": "  strncpy(name_, name, sizeof(name_) - 1);",
          "content_same": false
        },
        {
          "line": 1122,
          "old_api": null,
          "new_api": "CheckFastTls",
          "old_text": null,
          "new_text": "CheckFastTls(local_key)",
          "old_line_content": "void Thread::DeleteThreadLocalKey(LocalStorageKey key) {",
          "new_line_content": "  if (check_fast_tls) CheckFastTls(local_key);",
          "content_same": false
        },
        {
          "line": 998,
          "old_api": null,
          "new_api": "memset",
          "old_text": null,
          "new_text": "memset(&attr, 0, sizeof(attr))",
          "old_line_content": "    // Default on Mac OS X is 512kB -- bump up to 1MB",
          "new_line_content": "  memset(&attr, 0, sizeof(attr));",
          "content_same": false
        },
        {
          "line": 999,
          "old_api": null,
          "new_api": "pthread_attr_init",
          "old_text": null,
          "new_text": "pthread_attr_init(&attr)",
          "old_line_content": "    stack_size = 1 * 1024 * 1024;",
          "new_line_content": "  result = pthread_attr_init(&attr);",
          "content_same": false
        },
        {
          "line": 1129,
          "old_api": null,
          "new_api": "LocalKeyToPthreadKey",
          "old_text": null,
          "new_text": "LocalKeyToPthreadKey(key)",
          "old_line_content": "",
          "new_line_content": "  pthread_key_t pthread_key = LocalKeyToPthreadKey(key);",
          "content_same": false
        },
        {
          "line": 1130,
          "old_api": null,
          "new_api": "pthread_key_delete",
          "old_text": null,
          "new_text": "pthread_key_delete(pthread_key)",
          "old_line_content": "void* Thread::GetThreadLocal(LocalStorageKey key) {",
          "new_line_content": "  int result = pthread_key_delete(pthread_key);",
          "content_same": false
        },
        {
          "line": 1012,
          "old_api": null,
          "new_api": "pthread_attr_setstacksize",
          "old_text": null,
          "new_text": "pthread_attr_setstacksize(&attr, stack_size)",
          "old_line_content": "    if (result != 0 || data_->thread_ == kNoThread) {",
          "new_line_content": "    result = pthread_attr_setstacksize(&attr, stack_size);",
          "content_same": false
        },
        {
          "line": 1143,
          "old_api": null,
          "new_api": "LocalKeyToPthreadKey",
          "old_text": null,
          "new_text": "LocalKeyToPthreadKey(key)",
          "old_line_content": "// pthread_getattr_np used below is non portable (hence the _np suffix). We",
          "new_line_content": "  pthread_key_t pthread_key = LocalKeyToPthreadKey(key);",
          "content_same": false
        },
        {
          "line": 1144,
          "old_api": null,
          "new_api": "pthread_setspecific",
          "old_text": null,
          "new_text": "pthread_setspecific(pthread_key, value)",
          "old_line_content": "// keep this version in POSIX as most Linux-compatible derivatives will",
          "new_line_content": "  int result = pthread_setspecific(pthread_key, value);",
          "content_same": false
        },
        {
          "line": 1145,
          "old_api": null,
          "new_api": "DCHECK_EQ",
          "old_text": null,
          "new_text": "DCHECK_EQ(0, result)",
          "old_line_content": "// support it. MacOS and FreeBSD are different here.",
          "new_line_content": "  DCHECK_EQ(0, result);",
          "content_same": false
        },
        {
          "line": 1146,
          "old_api": null,
          "new_api": "USE",
          "old_text": null,
          "new_text": "USE(result)",
          "old_line_content": "#if !defined(V8_OS_FREEBSD) && !defined(V8_OS_MACOSX) && !defined(_AIX) && \\",
          "new_line_content": "  USE(result);",
          "content_same": false
        },
        {
          "line": 1019,
          "old_api": null,
          "new_api": "pthread_attr_destroy",
          "old_text": null,
          "new_text": "pthread_attr_destroy(&attr)",
          "old_line_content": "",
          "new_line_content": "      return pthread_attr_destroy(&attr), false;",
          "content_same": false
        },
        {
          "line": 1017,
          "old_api": null,
          "new_api": "pthread_create",
          "old_text": null,
          "new_text": "pthread_create(&data_->thread_, &attr, ThreadEntry, this)",
          "old_line_content": "  return result == 0;",
          "new_line_content": "    result = pthread_create(&data_->thread_, &attr, ThreadEntry, this);",
          "content_same": false
        },
        {
          "line": 1022,
          "old_api": null,
          "new_api": "pthread_attr_destroy",
          "old_text": null,
          "new_text": "pthread_attr_destroy(&attr)",
          "old_line_content": "static Thread::LocalStorageKey PthreadKeyToLocalKey(pthread_key_t pthread_key) {",
          "new_line_content": "  result = pthread_attr_destroy(&attr);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 1152,
          "old_api": "pthread_self",
          "new_api": null,
          "old_text": "pthread_self()",
          "new_text": null,
          "old_line_content": "  int error = pthread_getattr_np(pthread_self(), &attr);",
          "new_line_content": "#if !defined(V8_OS_FREEBSD) && !defined(V8_OS_MACOSX) && !defined(_AIX) && \\",
          "content_same": false
        },
        {
          "line": 896,
          "old_api": "Contains",
          "new_api": null,
          "old_text": "Contains(address, size)",
          "new_text": null,
          "old_line_content": "  DCHECK(Contains(address, size));",
          "new_line_content": "    return true;",
          "content_same": false
        },
        {
          "line": 897,
          "old_api": "OS::DecommitPages(address, size)",
          "new_api": null,
          "old_text": "OS::DecommitPages(address, size)",
          "new_text": null,
          "old_line_content": "  return OS::DecommitPages(address, size);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 1027,
          "old_api": "STATIC_ASSERT",
          "new_api": null,
          "old_text": "STATIC_ASSERT(sizeof(Thread::LocalStorageKey) == sizeof(pthread_key_t))",
          "new_text": null,
          "old_line_content": "  STATIC_ASSERT(sizeof(Thread::LocalStorageKey) == sizeof(pthread_key_t));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1028,
          "old_api": "reinterpret_cast<intptr_t>(pthread_key)",
          "new_api": null,
          "old_text": "reinterpret_cast<intptr_t>(pthread_key)",
          "new_text": null,
          "old_line_content": "  intptr_t ptr_key = reinterpret_cast<intptr_t>(pthread_key);",
          "new_line_content": "static Thread::LocalStorageKey PthreadKeyToLocalKey(pthread_key_t pthread_key) {",
          "content_same": false
        },
        {
          "line": 1029,
          "old_api": "static_cast<Thread::LocalStorageKey>(ptr_key)",
          "new_api": null,
          "old_text": "static_cast<Thread::LocalStorageKey>(ptr_key)",
          "new_text": null,
          "old_line_content": "  return static_cast<Thread::LocalStorageKey>(ptr_key);",
          "new_line_content": "#if V8_OS_CYGWIN",
          "content_same": false
        },
        {
          "line": 1156,
          "old_api": "pthread_attr_getstack",
          "new_api": null,
          "old_text": "pthread_attr_getstack(&attr, &base, &size)",
          "new_text": null,
          "old_line_content": "    error = pthread_attr_getstack(&attr, &base, &size);",
          "new_line_content": "Stack::StackSlot Stack::GetStackStart() {",
          "content_same": false
        },
        {
          "line": 1031,
          "old_api": "static_cast<Thread::LocalStorageKey>(pthread_key)",
          "new_api": null,
          "old_text": "static_cast<Thread::LocalStorageKey>(pthread_key)",
          "new_text": null,
          "old_line_content": "  return static_cast<Thread::LocalStorageKey>(pthread_key);",
          "new_line_content": "  // because pthread_key_t is a pointer type on Cygwin. This will probably not",
          "content_same": false
        },
        {
          "line": 1157,
          "old_api": "CHECK",
          "new_api": null,
          "old_text": "CHECK(!error)",
          "new_text": null,
          "old_line_content": "    CHECK(!error);",
          "new_line_content": "  pthread_attr_t attr;",
          "content_same": false
        },
        {
          "line": 1159,
          "old_api": "reinterpret_cast<uint8_t*>(base)",
          "new_api": null,
          "old_text": "reinterpret_cast<uint8_t*>(base)",
          "new_text": null,
          "old_line_content": "    return reinterpret_cast<uint8_t*>(base) + size;",
          "new_line_content": "  if (!error) {",
          "content_same": false
        },
        {
          "line": 907,
          "old_api": "Contains",
          "new_api": null,
          "old_text": "Contains(address, size)",
          "new_text": null,
          "old_line_content": "  DCHECK(Contains(address, size));",
          "new_line_content": "                                             OS::MemoryPermission access) {",
          "content_same": false
        },
        {
          "line": 1020,
          "old_api": "pthread_join",
          "new_api": null,
          "old_text": "pthread_join(data_->thread_, nullptr)",
          "new_text": null,
          "old_line_content": "void Thread::Join() { pthread_join(data_->thread_, nullptr); }",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1038,
          "old_api": "STATIC_ASSERT",
          "new_api": null,
          "old_text": "STATIC_ASSERT(sizeof(Thread::LocalStorageKey) == sizeof(pthread_key_t))",
          "new_text": null,
          "old_line_content": "  STATIC_ASSERT(sizeof(Thread::LocalStorageKey) == sizeof(pthread_key_t));",
          "new_line_content": "#endif",
          "content_same": false
        },
        {
          "line": 1039,
          "old_api": "static_cast<intptr_t>(local_key)",
          "new_api": null,
          "old_text": "static_cast<intptr_t>(local_key)",
          "new_text": null,
          "old_line_content": "  intptr_t ptr_key = static_cast<intptr_t>(local_key);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 1040,
          "old_api": "reinterpret_cast<pthread_key_t>(ptr_key)",
          "new_api": null,
          "old_text": "reinterpret_cast<pthread_key_t>(ptr_key)",
          "new_text": null,
          "old_line_content": "  return reinterpret_cast<pthread_key_t>(ptr_key);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 912,
          "old_api": "Contains",
          "new_api": null,
          "old_text": "Contains(address, size)",
          "new_text": null,
          "old_line_content": "  DCHECK(Contains(address, size));",
          "new_line_content": "bool AddressSpaceReservation::DiscardSystemPages(void* address, size_t size) {",
          "content_same": false
        },
        {
          "line": 1042,
          "old_api": "static_cast<pthread_key_t>(local_key)",
          "new_api": null,
          "old_text": "static_cast<pthread_key_t>(local_key)",
          "new_text": null,
          "old_line_content": "  return static_cast<pthread_key_t>(local_key);",
          "new_line_content": "static pthread_key_t LocalKeyToPthreadKey(Thread::LocalStorageKey local_key) {",
          "content_same": false
        },
        {
          "line": 1178,
          "old_api": "__builtin_frame_address",
          "new_api": null,
          "old_text": "__builtin_frame_address(0)",
          "new_text": null,
          "old_line_content": "  return __builtin_frame_address(0);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1059,
          "old_api": "sysctl",
          "new_api": null,
          "old_text": "sysctl(ctl_name, 2, buffer, &buffer_size, nullptr, 0)",
          "new_text": null,
          "old_line_content": "  if (sysctl(ctl_name, 2, buffer, &buffer_size, nullptr, 0) != 0) {",
          "new_line_content": "// done at least once.",
          "content_same": false
        },
        {
          "line": 1060,
          "old_api": "FATAL",
          "new_api": null,
          "old_text": "FATAL(\"V8 failed to get kernel version\")",
          "new_text": null,
          "old_line_content": "    FATAL(\"V8 failed to get kernel version\");",
          "new_line_content": "static void InitializeTlsBaseOffset() {",
          "content_same": false
        },
        {
          "line": 932,
          "old_api": "stack_size",
          "new_api": null,
          "old_text": "options.stack_size()",
          "new_text": null,
          "old_line_content": "      stack_size_(options.stack_size()),",
          "new_line_content": "  // Synchronizes thread creation",
          "content_same": false
        },
        {
          "line": 934,
          "old_api": "static_cast<int>(PTHREAD_STACK_MIN)",
          "new_api": null,
          "old_text": "static_cast<int>(PTHREAD_STACK_MIN)",
          "new_text": null,
          "old_line_content": "  const int min_stack_size = static_cast<int>(PTHREAD_STACK_MIN);",
          "new_line_content": "};",
          "content_same": false
        },
        {
          "line": 935,
          "old_api": "std::max(stack_size_, min_stack_size)",
          "new_api": null,
          "old_text": "std::max(stack_size_, min_stack_size)",
          "new_text": null,
          "old_line_content": "  if (stack_size_ > 0) stack_size_ = std::max(stack_size_, min_stack_size);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 936,
          "old_api": "name",
          "new_api": null,
          "old_text": "options.name()",
          "new_text": null,
          "old_line_content": "  set_name(options.name());",
          "new_line_content": "Thread::Thread(const Options& options)",
          "content_same": false
        },
        {
          "line": 1068,
          "old_api": "strtol",
          "new_api": null,
          "old_text": "strtol(buffer, nullptr, 10)",
          "new_text": null,
          "old_line_content": "  int kernel_version_major = static_cast<int>(strtol(buffer, nullptr, 10));",
          "new_line_content": "  // The buffer now contains a string of the form XX.YY.ZZ, where",
          "content_same": false
        },
        {
          "line": 947,
          "old_api": "pthread_self",
          "new_api": null,
          "old_text": "pthread_self()",
          "new_text": null,
          "old_line_content": "  pthread_set_name_np(pthread_self(), name);",
          "new_line_content": "  delete data_;",
          "content_same": false
        },
        {
          "line": 949,
          "old_api": "STATIC_ASSERT",
          "new_api": null,
          "old_text": "STATIC_ASSERT(Thread::kMaxThreadNameLength <= PTHREAD_MAX_NAMELEN_NP)",
          "new_text": null,
          "old_line_content": "  STATIC_ASSERT(Thread::kMaxThreadNameLength <= PTHREAD_MAX_NAMELEN_NP);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 950,
          "old_api": "pthread_self",
          "new_api": null,
          "old_text": "pthread_self()",
          "new_text": null,
          "old_line_content": "  pthread_setname_np(pthread_self(), \"%s\", name);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1084,
          "old_api": "store",
          "new_api": null,
          "old_text": "tls_base_offset_initialized.store(true, std::memory_order_release)",
          "new_text": null,
          "old_line_content": "  tls_base_offset_initialized.store(true, std::memory_order_release);",
          "new_line_content": "#endif",
          "content_same": false
        },
        {
          "line": 1089,
          "old_api": "reinterpret_cast<void*>(0x1234CAFE)",
          "new_api": null,
          "old_text": "reinterpret_cast<void*>(0x1234CAFE)",
          "new_text": null,
          "old_line_content": "  void* expected = reinterpret_cast<void*>(0x1234CAFE);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1091,
          "old_api": "Thread::GetExistingThreadLocal(key)",
          "new_api": null,
          "old_text": "Thread::GetExistingThreadLocal(key)",
          "new_text": null,
          "old_line_content": "  void* actual = Thread::GetExistingThreadLocal(key);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 964,
          "old_api": "prctl",
          "new_api": null,
          "old_text": "prctl(PR_SET_NAME,\n        reinterpret_cast<unsigned long>(name),  // NOLINT\n        0, 0, 0)",
          "new_text": null,
          "old_line_content": "  prctl(PR_SET_NAME,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1093,
          "old_api": "FATAL",
          "new_api": null,
          "old_text": "FATAL(\"V8 failed to initialize fast TLS on current kernel\")",
          "new_text": null,
          "old_line_content": "    FATAL(\"V8 failed to initialize fast TLS on current kernel\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 965,
          "old_api": "reinterpret_cast<unsigned long>(name)",
          "new_api": null,
          "old_text": "reinterpret_cast<unsigned long>(name)",
          "new_text": null,
          "old_line_content": "        reinterpret_cast<unsigned long>(name),  // NOLINT",
          "new_line_content": "  // Mac OS X does not expose the length limit of the name, so hardcode it.",
          "content_same": false
        },
        {
          "line": 972,
          "old_api": "reinterpret_cast<Thread*>(arg)",
          "new_api": null,
          "old_text": "reinterpret_cast<Thread*>(arg)",
          "new_text": null,
          "old_line_content": "  Thread* thread = reinterpret_cast<Thread*>(arg);",
          "new_line_content": "        0, 0, 0);",
          "content_same": false
        },
        {
          "line": 1104,
          "old_api": "load",
          "new_api": null,
          "old_text": "tls_base_offset_initialized.load(std::memory_order_acquire)",
          "new_text": null,
          "old_line_content": "  if (!tls_base_offset_initialized.load(std::memory_order_acquire)) {",
          "new_line_content": "#endif  // V8_FAST_TLS_SUPPORTED",
          "content_same": false
        },
        {
          "line": 976,
          "old_api": "data",
          "new_api": null,
          "old_text": "thread->data()",
          "new_text": null,
          "old_line_content": "  { MutexGuard lock_guard(&thread->data()->thread_creation_mutex_); }",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1106,
          "old_api": "InitializeTlsBaseOffset",
          "new_api": null,
          "old_text": "InitializeTlsBaseOffset()",
          "new_text": null,
          "old_line_content": "    InitializeTlsBaseOffset();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 977,
          "old_api": "name",
          "new_api": null,
          "old_text": "thread->name()",
          "new_text": null,
          "old_line_content": "  SetThreadName(thread->name());",
          "new_line_content": "static void* ThreadEntry(void* arg) {",
          "content_same": false
        },
        {
          "line": 979,
          "old_api": "NotifyStartedAndRun",
          "new_api": null,
          "old_text": "thread->NotifyStartedAndRun()",
          "new_text": null,
          "old_line_content": "  thread->NotifyStartedAndRun();",
          "new_line_content": "  // We take the lock here to make sure that pthread_create finished first since",
          "content_same": false
        },
        {
          "line": 1111,
          "old_api": "DCHECK_EQ",
          "new_api": null,
          "old_text": "DCHECK_EQ(0, result)",
          "new_text": null,
          "old_line_content": "  DCHECK_EQ(0, result);",
          "new_line_content": "    check_fast_tls = true;",
          "content_same": false
        },
        {
          "line": 1113,
          "old_api": "PthreadKeyToLocalKey",
          "new_api": null,
          "old_text": "PthreadKeyToLocalKey(key)",
          "new_text": null,
          "old_line_content": "  LocalStorageKey local_key = PthreadKeyToLocalKey(key);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 992,
          "old_api": "memset",
          "new_api": null,
          "old_text": "memset(&attr, 0, sizeof(attr))",
          "new_text": null,
          "old_line_content": "  memset(&attr, 0, sizeof(attr));",
          "new_line_content": "  name_[sizeof(name_) - 1] = '\\0';",
          "content_same": false
        },
        {
          "line": 993,
          "old_api": "pthread_attr_init",
          "new_api": null,
          "old_text": "pthread_attr_init(&attr)",
          "new_text": null,
          "old_line_content": "  result = pthread_attr_init(&attr);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 1123,
          "old_api": "LocalKeyToPthreadKey",
          "new_api": null,
          "old_text": "LocalKeyToPthreadKey(key)",
          "new_text": null,
          "old_line_content": "  pthread_key_t pthread_key = LocalKeyToPthreadKey(key);",
          "new_line_content": "#endif",
          "content_same": false
        },
        {
          "line": 1124,
          "old_api": "pthread_key_delete",
          "new_api": null,
          "old_text": "pthread_key_delete(pthread_key)",
          "new_text": null,
          "old_line_content": "  int result = pthread_key_delete(pthread_key);",
          "new_line_content": "  return local_key;",
          "content_same": false
        },
        {
          "line": 1125,
          "old_api": "DCHECK_EQ",
          "new_api": null,
          "old_text": "DCHECK_EQ(0, result)",
          "new_text": null,
          "old_line_content": "  DCHECK_EQ(0, result);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 1126,
          "old_api": "USE",
          "new_api": null,
          "old_text": "USE(result)",
          "new_text": null,
          "old_line_content": "  USE(result);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1006,
          "old_api": "pthread_attr_setstacksize",
          "new_api": null,
          "old_text": "pthread_attr_setstacksize(&attr, stack_size)",
          "new_text": null,
          "old_line_content": "    result = pthread_attr_setstacksize(&attr, stack_size);",
          "new_line_content": "#elif V8_OS_AIX",
          "content_same": false
        },
        {
          "line": 1007,
          "old_api": "pthread_attr_destroy",
          "new_api": null,
          "old_text": "pthread_attr_destroy(&attr)",
          "new_text": null,
          "old_line_content": "    if (result != 0) return pthread_attr_destroy(&attr), false;",
          "new_line_content": "    // Default on AIX is 96kB -- bump up to 2MB",
          "content_same": false
        },
        {
          "line": 1139,
          "old_api": "DCHECK_EQ",
          "new_api": null,
          "old_text": "DCHECK_EQ(0, result)",
          "new_text": null,
          "old_line_content": "  DCHECK_EQ(0, result);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 1140,
          "old_api": "USE",
          "new_api": null,
          "old_text": "USE(result)",
          "new_text": null,
          "old_line_content": "  USE(result);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1011,
          "old_api": "pthread_create",
          "new_api": null,
          "old_text": "pthread_create(&data_->thread_, &attr, ThreadEntry, this)",
          "new_text": null,
          "old_line_content": "    result = pthread_create(&data_->thread_, &attr, ThreadEntry, this);",
          "new_line_content": "  if (stack_size > 0) {",
          "content_same": false
        },
        {
          "line": 1016,
          "old_api": "pthread_attr_destroy",
          "new_api": null,
          "old_text": "pthread_attr_destroy(&attr)",
          "new_text": null,
          "old_line_content": "  result = pthread_attr_destroy(&attr);",
          "new_line_content": "    MutexGuard lock_guard(&data_->thread_creation_mutex_);",
          "content_same": false
        },
        {
          "line": 892,
          "old_api": "OS::SetPermissions(address, size, access)",
          "new_api": null,
          "old_text": "OS::SetPermissions(address, size, access)",
          "new_text": null,
          "old_line_content": "  return OS::SetPermissions(address, size, access);",
          "new_line_content": "  if (access == OS::MemoryPermission::kNoAccess) {",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 19,
      "total_additions": 55,
      "total_deletions": 55,
      "total_api_changes": 129
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 6,
        "api_related_lines": 129,
        "non_api_lines": 3,
        "non_api_line_numbers": [
          893,
          894,
          895
        ]
      }
    },
    "api_calls_before": 283,
    "api_calls_after": 283,
    "diff_info": {
      "added_lines": 6,
      "removed_lines": 0,
      "total_diff_lines": 18
    }
  }
}