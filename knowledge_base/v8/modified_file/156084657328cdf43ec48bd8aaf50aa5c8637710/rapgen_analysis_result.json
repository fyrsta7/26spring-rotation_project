{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/v8/modified_file/156084657328cdf43ec48bd8aaf50aa5c8637710",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/v8/modified_file/156084657328cdf43ec48bd8aaf50aa5c8637710/before.cc",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/v8/modified_file/156084657328cdf43ec48bd8aaf50aa5c8637710/after.cc",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/v8/modified_file/156084657328cdf43ec48bd8aaf50aa5c8637710/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 169,
          "old_api": "GetDeoptsExecutedCount",
          "new_api": "v8_fuzzer::FuzzerSupport::Get()",
          "old_text": "GetWasmEngine()->GetDeoptsExecutedCount()",
          "new_text": "v8_fuzzer::FuzzerSupport::Get()",
          "old_line_content": "  int deopt_count_before = GetWasmEngine()->GetDeoptsExecutedCount();",
          "new_line_content": "  v8_fuzzer::FuzzerSupport* support = v8_fuzzer::FuzzerSupport::Get();",
          "content_same": false
        },
        {
          "line": 170,
          "old_api": "v8_fuzzer::FuzzerSupport::Get()",
          "new_api": "GetIsolate",
          "old_text": "v8_fuzzer::FuzzerSupport::Get()",
          "new_text": "support->GetIsolate()",
          "old_line_content": "  v8_fuzzer::FuzzerSupport* support = v8_fuzzer::FuzzerSupport::Get();",
          "new_line_content": "  v8::Isolate* isolate = support->GetIsolate();",
          "content_same": false
        },
        {
          "line": 179,
          "old_api": "EmptyStorageForTesting",
          "new_api": "heap",
          "old_text": "GetTypeCanonicalizer()->EmptyStorageForTesting()",
          "new_text": "i_isolate->heap()->ClearWasmCanonicalRttsForTesting()",
          "old_line_content": "  GetTypeCanonicalizer()->EmptyStorageForTesting();",
          "new_line_content": "  i_isolate->heap()->ClearWasmCanonicalRttsForTesting();",
          "content_same": false
        },
        {
          "line": 218,
          "old_api": "testing::SetupIsolateForWasmModule(i_isolate)",
          "new_api": "end",
          "old_text": "testing::SetupIsolateForWasmModule(i_isolate)",
          "new_text": "buffer.end()",
          "old_line_content": "  testing::SetupIsolateForWasmModule(i_isolate);",
          "new_line_content": "  ModuleWireBytes wire_bytes(buffer.begin(), buffer.end());",
          "content_same": false
        },
        {
          "line": 219,
          "old_api": "end",
          "new_api": "WasmEnabledFeatures::FromIsolate(i_isolate)",
          "old_text": "buffer.end()",
          "new_text": "WasmEnabledFeatures::FromIsolate(i_isolate)",
          "old_line_content": "  ModuleWireBytes wire_bytes(buffer.begin(), buffer.end());",
          "new_line_content": "  auto enabled_features = WasmEnabledFeatures::FromIsolate(i_isolate);",
          "content_same": false
        },
        {
          "line": 220,
          "old_api": "WasmEnabledFeatures::FromIsolate(i_isolate)",
          "new_api": "SyncValidate",
          "old_text": "WasmEnabledFeatures::FromIsolate(i_isolate)",
          "new_text": "GetWasmEngine()->SyncValidate(\n      i_isolate, enabled_features, CompileTimeImportsForFuzzing(), wire_bytes)",
          "old_line_content": "  auto enabled_features = WasmEnabledFeatures::FromIsolate(i_isolate);",
          "new_line_content": "  bool valid = GetWasmEngine()->SyncValidate(",
          "content_same": false
        },
        {
          "line": 221,
          "old_api": "SyncValidate",
          "new_api": "CompileTimeImportsForFuzzing",
          "old_text": "GetWasmEngine()->SyncValidate(\n      i_isolate, enabled_features, CompileTimeImportsForFuzzing(), wire_bytes)",
          "new_text": "CompileTimeImportsForFuzzing()",
          "old_line_content": "  bool valid = GetWasmEngine()->SyncValidate(",
          "new_line_content": "      i_isolate, enabled_features, CompileTimeImportsForFuzzing(), wire_bytes);",
          "content_same": false
        },
        {
          "line": 229,
          "old_api": "SyncCompile",
          "new_api": "CompileTimeImportsForFuzzing",
          "old_text": "GetWasmEngine()->SyncCompile(\n      i_isolate, enabled_features, CompileTimeImportsForFuzzing(), &thrower,\n      wire_bytes)",
          "new_text": "CompileTimeImportsForFuzzing()",
          "old_line_content": "  MaybeHandle<WasmModuleObject> compiled = GetWasmEngine()->SyncCompile(",
          "new_line_content": "      i_isolate, enabled_features, CompileTimeImportsForFuzzing(), &thrower,",
          "content_same": false
        },
        {
          "line": 269,
          "old_api": "Smi::FromInt(i)",
          "new_api": "base::OwnedVector<Handle<Object>>::New(1)",
          "old_text": "Smi::FromInt(i)",
          "new_text": "base::OwnedVector<Handle<Object>>::New(1)",
          "old_line_content": "    arguments[0] = handle(Smi::FromInt(i), i_isolate);",
          "new_line_content": "    auto arguments = base::OwnedVector<Handle<Object>>::New(1);",
          "content_same": false
        },
        {
          "line": 284,
          "old_api": "UNREACHABLE",
          "new_api": "CHECK_EQ",
          "old_text": "UNREACHABLE()",
          "new_text": "CHECK_EQ(actual_result, reference_results[i])",
          "old_line_content": "      UNREACHABLE();",
          "new_line_content": "      CHECK_EQ(actual_result, reference_results[i]);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 256,
          "old_api": null,
          "new_api": "shared",
          "old_text": null,
          "new_text": "main_function->shared()->wasm_exported_function_data()->function_index()",
          "old_line_content": "  int function_to_optimize =",
          "new_line_content": "      main_function->shared()->wasm_exported_function_data()->function_index();",
          "content_same": false
        },
        {
          "line": 261,
          "old_api": null,
          "new_api": "last",
          "old_text": null,
          "new_text": "data.last()",
          "old_line_content": "  // parameters with all kinds of types.",
          "new_line_content": "  if (!inlinees.empty() && (data.last() & 1)) {",
          "content_same": false
        },
        {
          "line": 265,
          "old_api": null,
          "new_api": "GetDeoptsExecutedCount",
          "old_text": null,
          "new_text": "GetWasmEngine()->GetDeoptsExecutedCount()",
          "old_line_content": "",
          "new_line_content": "  int deopt_count_begin = GetWasmEngine()->GetDeoptsExecutedCount();",
          "content_same": false
        },
        {
          "line": 267,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "reference_results.size()",
          "old_line_content": "  for (uint32_t i = 0; i < num_callees; ++i) {",
          "new_line_content": "  size_t num_callees = reference_results.size();",
          "content_same": false
        },
        {
          "line": 270,
          "old_api": null,
          "new_api": "Smi::FromInt(i)",
          "old_text": null,
          "new_text": "Smi::FromInt(i)",
          "old_line_content": "    std::unique_ptr<const char[]> exception;",
          "new_line_content": "    arguments[0] = handle(Smi::FromInt(i), i_isolate);",
          "content_same": false
        },
        {
          "line": 273,
          "old_api": null,
          "new_api": "as_vector",
          "old_text": null,
          "new_text": "arguments.as_vector()",
          "old_line_content": "    ExecutionResult actual_result;",
          "new_line_content": "        i_isolate, instance, \"main\", arguments.as_vector(), &exception);",
          "content_same": false
        },
        {
          "line": 276,
          "old_api": null,
          "new_api": "get",
          "old_text": null,
          "new_text": "exception.get()",
          "old_line_content": "    } else {",
          "new_line_content": "      actual_result = exception.get();",
          "content_same": false
        },
        {
          "line": 285,
          "old_api": null,
          "new_api": "UNREACHABLE",
          "old_text": null,
          "new_text": "UNREACHABLE()",
          "old_line_content": "    }",
          "new_line_content": "      UNREACHABLE();",
          "content_same": false
        },
        {
          "line": 288,
          "old_api": null,
          "new_api": "GetDeoptsExecutedCount",
          "old_text": null,
          "new_text": "GetWasmEngine()->GetDeoptsExecutedCount()",
          "old_line_content": "                        function_to_optimize);",
          "new_line_content": "    int deopt_count = GetWasmEngine()->GetDeoptsExecutedCount();",
          "content_same": false
        },
        {
          "line": 298,
          "old_api": null,
          "new_api": "trusted_data",
          "old_text": null,
          "new_text": "instance->trusted_data(i_isolate)",
          "old_line_content": "}  // anonymous namespace",
          "new_line_content": "    TierUpNowForTesting(i_isolate, instance->trusted_data(i_isolate),",
          "content_same": false
        },
        {
          "line": 172,
          "old_api": null,
          "new_api": "reinterpret_cast<Isolate*>(isolate)",
          "old_text": null,
          "new_text": "reinterpret_cast<Isolate*>(isolate)",
          "old_line_content": "",
          "new_line_content": "  Isolate* i_isolate = reinterpret_cast<Isolate*>(isolate);",
          "content_same": false
        },
        {
          "line": 178,
          "old_api": null,
          "new_api": "EmptyStorageForTesting",
          "old_text": null,
          "new_text": "GetTypeCanonicalizer()->EmptyStorageForTesting()",
          "old_line_content": "  // from previous runs just waste memory.",
          "new_line_content": "  GetTypeCanonicalizer()->EmptyStorageForTesting();",
          "content_same": false
        },
        {
          "line": 308,
          "old_api": null,
          "new_api": "FuzzIt",
          "old_text": null,
          "new_text": "FuzzIt({data, size})",
          "old_line_content": "",
          "new_line_content": "  return FuzzIt({data, size});",
          "content_same": false
        },
        {
          "line": 182,
          "old_api": null,
          "new_api": "GetContext",
          "old_text": null,
          "new_text": "support->GetContext()",
          "old_line_content": "  v8::HandleScope handle_scope(isolate);",
          "new_line_content": "  v8::Context::Scope context_scope(support->GetContext());",
          "content_same": false
        },
        {
          "line": 205,
          "old_api": null,
          "new_api": "EnableExperimentalWasmFeatures",
          "old_text": null,
          "new_text": "EnableExperimentalWasmFeatures(isolate)",
          "old_line_content": "",
          "new_line_content": "  EnableExperimentalWasmFeatures(isolate);",
          "content_same": false
        },
        {
          "line": 215,
          "old_api": null,
          "new_api": "GenerateWasmModuleForDeopt",
          "old_text": null,
          "new_text": "GenerateWasmModuleForDeopt(&zone, data, callees, inlinees)",
          "old_line_content": "  base::Vector<const uint8_t> buffer =",
          "new_line_content": "      GenerateWasmModuleForDeopt(&zone, data, callees, inlinees);",
          "content_same": false
        },
        {
          "line": 217,
          "old_api": null,
          "new_api": "testing::SetupIsolateForWasmModule(i_isolate)",
          "old_text": null,
          "new_text": "testing::SetupIsolateForWasmModule(i_isolate)",
          "old_line_content": "",
          "new_line_content": "  testing::SetupIsolateForWasmModule(i_isolate);",
          "content_same": false
        },
        {
          "line": 224,
          "old_api": null,
          "new_api": "GenerateTestCase",
          "old_text": null,
          "new_text": "GenerateTestCase(i_isolate, wire_bytes, valid)",
          "old_line_content": "  if (v8_flags.wasm_fuzzer_gen_test) {",
          "new_line_content": "    GenerateTestCase(i_isolate, wire_bytes, valid);",
          "content_same": false
        },
        {
          "line": 228,
          "old_api": null,
          "new_api": "SyncCompile",
          "old_text": null,
          "new_text": "GetWasmEngine()->SyncCompile(\n      i_isolate, enabled_features, CompileTimeImportsForFuzzing(), &thrower,\n      wire_bytes)",
          "old_line_content": "  ErrorThrower thrower(i_isolate, \"WasmFuzzerSyncCompile\");",
          "new_line_content": "  MaybeHandle<WasmModuleObject> compiled = GetWasmEngine()->SyncCompile(",
          "content_same": false
        },
        {
          "line": 232,
          "old_api": null,
          "new_api": "error_msg",
          "old_text": null,
          "new_text": "FATAL(\"Generated module should validate, but got: %s\\n\",\n          thrower.error_msg())",
          "old_line_content": "  if (!valid) {",
          "new_line_content": "    FATAL(\"Generated module should validate, but got: %s\\n\",",
          "content_same": false
        },
        {
          "line": 236,
          "old_api": null,
          "new_api": "PerformReferenceRun",
          "old_text": null,
          "new_text": "PerformReferenceRun(\n      callees, wire_bytes, enabled_features, valid, i_isolate)",
          "old_line_content": "",
          "new_line_content": "  std::vector<ExecutionResult> reference_results = PerformReferenceRun(",
          "content_same": false
        },
        {
          "line": 239,
          "old_api": null,
          "new_api": "empty",
          "old_text": null,
          "new_text": "reference_results.empty()",
          "old_line_content": "",
          "new_line_content": "  if (reference_results.empty()) {",
          "content_same": false
        },
        {
          "line": 246,
          "old_api": null,
          "new_api": "ToHandleChecked",
          "old_text": null,
          "new_text": "compiled.ToHandleChecked()",
          "old_line_content": "",
          "new_line_content": "  Handle<WasmModuleObject> module_object = compiled.ToHandleChecked();",
          "content_same": false
        },
        {
          "line": 248,
          "old_api": null,
          "new_api": "ToHandleChecked",
          "old_text": null,
          "new_text": "GetWasmEngine()\n          ->SyncInstantiate(i_isolate, &thrower, module_object, {}, {})\n          .ToHandleChecked()",
          "old_line_content": "  Handle<WasmInstanceObject> instance =",
          "new_line_content": "      GetWasmEngine()",
          "content_same": false
        },
        {
          "line": 253,
          "old_api": null,
          "new_api": "ToHandleChecked",
          "old_text": null,
          "new_text": "testing::GetExportedFunction(i_isolate, instance, \"main\")\n          .ToHandleChecked()",
          "old_line_content": "  Handle<WasmExportedFunction> main_function =",
          "new_line_content": "      testing::GetExportedFunction(i_isolate, instance, \"main\")",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 257,
          "old_api": "shared",
          "new_api": null,
          "old_text": "main_function->shared()->wasm_exported_function_data()->function_index()",
          "new_text": null,
          "old_line_content": "      main_function->shared()->wasm_exported_function_data()->function_index();",
          "new_line_content": "  // As the main function has a fixed signature, it doesn't provide great",
          "content_same": false
        },
        {
          "line": 262,
          "old_api": "last",
          "new_api": null,
          "old_text": "data.last()",
          "new_text": null,
          "old_line_content": "  if (!inlinees.empty() && (data.last() & 1)) {",
          "new_line_content": "    function_to_optimize--;",
          "content_same": false
        },
        {
          "line": 266,
          "old_api": "size",
          "new_api": null,
          "old_text": "reference_results.size()",
          "new_text": null,
          "old_line_content": "  size_t num_callees = reference_results.size();",
          "new_line_content": "  int deopt_count_previous_iteration = deopt_count_begin;",
          "content_same": false
        },
        {
          "line": 268,
          "old_api": "base::OwnedVector<Handle<Object>>::New(1)",
          "new_api": null,
          "old_text": "base::OwnedVector<Handle<Object>>::New(1)",
          "new_text": null,
          "old_line_content": "    auto arguments = base::OwnedVector<Handle<Object>>::New(1);",
          "new_line_content": "  for (uint32_t i = 0; i < num_callees; ++i) {",
          "content_same": false
        },
        {
          "line": 271,
          "old_api": "as_vector",
          "new_api": null,
          "old_text": "testing::CallWasmFunctionForTesting(\n        i_isolate, instance, \"main\", arguments.as_vector(), &exception)",
          "new_text": null,
          "old_line_content": "    int32_t result_value = testing::CallWasmFunctionForTesting(",
          "new_line_content": "    std::unique_ptr<const char[]> exception;",
          "content_same": false
        },
        {
          "line": 275,
          "old_api": "get",
          "new_api": null,
          "old_text": "exception.get()",
          "new_text": null,
          "old_line_content": "      actual_result = exception.get();",
          "new_line_content": "    if (exception) {",
          "content_same": false
        },
        {
          "line": 283,
          "old_api": "CHECK_EQ",
          "new_api": null,
          "old_text": "CHECK_EQ(actual_result, reference_results[i])",
          "new_text": null,
          "old_line_content": "      CHECK_EQ(actual_result, reference_results[i]);",
          "new_line_content": "                << \"\\nActual: \" << actual_result << std::endl;",
          "content_same": false
        },
        {
          "line": 287,
          "old_api": "trusted_data",
          "new_api": null,
          "old_text": "instance->trusted_data(i_isolate)",
          "new_text": null,
          "old_line_content": "    TierUpNowForTesting(i_isolate, instance->trusted_data(i_isolate),",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 294,
          "old_api": "GetDeoptsExecutedCount",
          "new_api": null,
          "old_text": "GetWasmEngine()->GetDeoptsExecutedCount()",
          "new_text": null,
          "old_line_content": "      GetWasmEngine()->GetDeoptsExecutedCount() != deopt_count_before;",
          "new_line_content": "      return deopt_count == deopt_count_begin ? -1 : 0;",
          "content_same": false
        },
        {
          "line": 171,
          "old_api": "GetIsolate",
          "new_api": null,
          "old_text": "support->GetIsolate()",
          "new_text": null,
          "old_line_content": "  v8::Isolate* isolate = support->GetIsolate();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 173,
          "old_api": "reinterpret_cast<Isolate*>(isolate)",
          "new_api": null,
          "old_text": "reinterpret_cast<Isolate*>(isolate)",
          "new_text": null,
          "old_line_content": "  Isolate* i_isolate = reinterpret_cast<Isolate*>(isolate);",
          "new_line_content": "  v8::Isolate::Scope isolate_scope(isolate);",
          "content_same": false
        },
        {
          "line": 301,
          "old_api": "FuzzIt",
          "new_api": null,
          "old_text": "FuzzIt({data, size})",
          "new_text": null,
          "old_line_content": "  return FuzzIt({data, size});",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 180,
          "old_api": "heap",
          "new_api": null,
          "old_text": "i_isolate->heap()->ClearWasmCanonicalRttsForTesting()",
          "new_text": null,
          "old_line_content": "  i_isolate->heap()->ClearWasmCanonicalRttsForTesting();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 183,
          "old_api": "GetContext",
          "new_api": null,
          "old_text": "support->GetContext()",
          "new_text": null,
          "old_line_content": "  v8::Context::Scope context_scope(support->GetContext());",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 206,
          "old_api": "EnableExperimentalWasmFeatures",
          "new_api": null,
          "old_text": "EnableExperimentalWasmFeatures(isolate)",
          "new_text": null,
          "old_line_content": "  EnableExperimentalWasmFeatures(isolate);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 216,
          "old_api": "GenerateWasmModuleForDeopt",
          "new_api": null,
          "old_text": "GenerateWasmModuleForDeopt(&zone, data, callees, inlinees)",
          "new_text": null,
          "old_line_content": "      GenerateWasmModuleForDeopt(&zone, data, callees, inlinees);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 222,
          "old_api": "CompileTimeImportsForFuzzing",
          "new_api": null,
          "old_text": "CompileTimeImportsForFuzzing()",
          "new_text": null,
          "old_line_content": "      i_isolate, enabled_features, CompileTimeImportsForFuzzing(), wire_bytes);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 225,
          "old_api": "GenerateTestCase",
          "new_api": null,
          "old_text": "GenerateTestCase(i_isolate, wire_bytes, valid)",
          "new_text": null,
          "old_line_content": "    GenerateTestCase(i_isolate, wire_bytes, valid);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 230,
          "old_api": "CompileTimeImportsForFuzzing",
          "new_api": null,
          "old_text": "CompileTimeImportsForFuzzing()",
          "new_text": null,
          "old_line_content": "      i_isolate, enabled_features, CompileTimeImportsForFuzzing(), &thrower,",
          "new_line_content": "      wire_bytes);",
          "content_same": false
        },
        {
          "line": 234,
          "old_api": "error_msg",
          "new_api": null,
          "old_text": "thrower.error_msg()",
          "new_text": null,
          "old_line_content": "          thrower.error_msg());",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 237,
          "old_api": "PerformReferenceRun",
          "new_api": null,
          "old_text": "PerformReferenceRun(\n      callees, wire_bytes, enabled_features, valid, i_isolate)",
          "new_text": null,
          "old_line_content": "  std::vector<ExecutionResult> reference_results = PerformReferenceRun(",
          "new_line_content": "      callees, wire_bytes, enabled_features, valid, i_isolate);",
          "content_same": false
        },
        {
          "line": 240,
          "old_api": "empty",
          "new_api": null,
          "old_text": "reference_results.empty()",
          "new_text": null,
          "old_line_content": "  if (reference_results.empty()) {",
          "new_line_content": "    // If the first run already included non-determinism, there isn't any value",
          "content_same": false
        },
        {
          "line": 247,
          "old_api": "ToHandleChecked",
          "new_api": null,
          "old_text": "compiled.ToHandleChecked()",
          "new_text": null,
          "old_line_content": "  Handle<WasmModuleObject> module_object = compiled.ToHandleChecked();",
          "new_line_content": "  Handle<WasmInstanceObject> instance =",
          "content_same": false
        },
        {
          "line": 249,
          "old_api": "ToHandleChecked",
          "new_api": null,
          "old_text": "GetWasmEngine()\n          ->SyncInstantiate(i_isolate, &thrower, module_object, {}, {})\n          .ToHandleChecked()",
          "new_text": null,
          "old_line_content": "      GetWasmEngine()",
          "new_line_content": "          ->SyncInstantiate(i_isolate, &thrower, module_object, {}, {})",
          "content_same": false
        },
        {
          "line": 254,
          "old_api": "ToHandleChecked",
          "new_api": null,
          "old_text": "testing::GetExportedFunction(i_isolate, instance, \"main\")\n          .ToHandleChecked()",
          "new_text": null,
          "old_line_content": "      testing::GetExportedFunction(i_isolate, instance, \"main\")",
          "new_line_content": "          .ToHandleChecked();",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 10,
      "total_additions": 25,
      "total_deletions": 25,
      "total_api_changes": 60
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 14,
        "api_related_lines": 60,
        "non_api_lines": 9,
        "non_api_line_numbers": [
          289,
          290,
          291,
          292,
          293,
          295,
          296,
          297,
          302
        ]
      }
    },
    "api_calls_before": 84,
    "api_calls_after": 84,
    "diff_info": {
      "added_lines": 13,
      "removed_lines": 6,
      "total_diff_lines": 49
    }
  }
}