{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/v8/modified_file/7cadd21e3051205831ad07c1d7d863dc2abb3622",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/v8/modified_file/7cadd21e3051205831ad07c1d7d863dc2abb3622/before.cc",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/v8/modified_file/7cadd21e3051205831ad07c1d7d863dc2abb3622/after.cc",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/v8/modified_file/7cadd21e3051205831ad07c1d7d863dc2abb3622/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 278,
          "old_api": "feedback_vector",
          "new_api": "NextTier",
          "old_text": "function.feedback_vector().profiler_ticks()",
          "new_text": "function.NextTier()",
          "old_line_content": "  int ticks = function.feedback_vector().profiler_ticks();",
          "new_line_content": "    DCHECK_EQ(function.NextTier(), CodeKind::TURBOPROP);",
          "content_same": false
        },
        {
          "line": 299,
          "old_api": "length",
          "new_api": "PrintName",
          "old_text": "bytecode.length()",
          "new_text": "function.PrintName()",
          "old_line_content": "  } else if (ShouldOptimizeAsSmallFunction(bytecode.length(), ticks,",
          "new_line_content": "    function.PrintName();",
          "content_same": false
        },
        {
          "line": 339,
          "old_api": "function",
          "new_api": "has_feedback_vector",
          "old_text": "frame->function()",
          "new_text": "function.has_feedback_vector()",
          "old_line_content": "  JSFunction function = frame->function();",
          "new_line_content": "  if (!function.has_feedback_vector()) return;",
          "content_same": false
        },
        {
          "line": 342,
          "old_api": "shared",
          "new_api": "MaybeOptimizeFrame",
          "old_text": "function.shared().is_compiled()",
          "new_text": "MaybeOptimizeFrame(function, frame, code_kind)",
          "old_line_content": "  DCHECK(function.shared().is_compiled());",
          "new_line_content": "  MaybeOptimizeFrame(function, frame, code_kind);",
          "content_same": false
        },
        {
          "line": 347,
          "old_api": "has_feedback_vector",
          "new_api": "frame",
          "old_text": "function.has_feedback_vector()",
          "new_text": "it.frame()->is_interpreted()",
          "old_line_content": "  if (!function.has_feedback_vector()) return;",
          "new_line_content": "  DCHECK(it.frame()->is_interpreted());",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 264,
          "old_api": null,
          "new_api": "ActiveTierIsTurbofan",
          "old_text": null,
          "new_text": "function.ActiveTierIsTurbofan()",
          "old_line_content": "  return active_tier_is_turboprop &&",
          "new_line_content": "  if (function.ActiveTierIsTurbofan()) {",
          "content_same": false
        },
        {
          "line": 267,
          "old_api": null,
          "new_api": "ActiveTierIsToptierTurboprop",
          "old_text": null,
          "new_text": "function.ActiveTierIsToptierTurboprop()",
          "old_line_content": "",
          "new_line_content": "  if (V8_UNLIKELY(FLAG_turboprop) && function.ActiveTierIsToptierTurboprop()) {",
          "content_same": false
        },
        {
          "line": 270,
          "old_api": null,
          "new_api": "feedback_vector",
          "old_text": null,
          "new_text": "function.feedback_vector().profiler_ticks()",
          "old_line_content": "OptimizationReason RuntimeProfiler::ShouldOptimize(JSFunction function,",
          "new_line_content": "  int ticks = function.feedback_vector().profiler_ticks();",
          "content_same": false
        },
        {
          "line": 271,
          "old_api": null,
          "new_api": "ActiveTierIsMidtierTurboprop",
          "old_text": null,
          "new_text": "function.ActiveTierIsMidtierTurboprop()",
          "old_line_content": "                                                   BytecodeArray bytecode) {",
          "new_line_content": "  bool active_tier_is_turboprop = function.ActiveTierIsMidtierTurboprop();",
          "content_same": false
        },
        {
          "line": 276,
          "old_api": null,
          "new_api": "length",
          "old_text": null,
          "new_text": "bytecode.length()",
          "old_line_content": "    return OptimizationReason::kDoNotOptimize;",
          "new_line_content": "      (bytecode.length() / kBytecodeSizeAllowancePerTick);",
          "content_same": false
        },
        {
          "line": 281,
          "old_api": null,
          "new_api": "feedback_vector",
          "old_text": null,
          "new_text": "function.feedback_vector()\n             .global_ticks_at_last_runtime_profiler_interrupt()",
          "old_line_content": "      active_tier_is_turboprop ? FLAG_ticks_scale_factor_for_top_tier : 1;",
          "new_line_content": "         function.feedback_vector()",
          "content_same": false
        },
        {
          "line": 285,
          "old_api": null,
          "new_api": "std::min(global_ticks_diff / kMidTierGlobalTicksScaleFactor,\n                 kMaxAdditionalMidTierGlobalTicks)",
          "old_text": null,
          "new_text": "std::min(global_ticks_diff / kMidTierGlobalTicksScaleFactor,\n                 kMaxAdditionalMidTierGlobalTicks)",
          "old_line_content": "  if (FLAG_turboprop && !active_tier_is_turboprop) {",
          "new_line_content": "        std::min(global_ticks_diff / kMidTierGlobalTicksScaleFactor,",
          "content_same": false
        },
        {
          "line": 291,
          "old_api": null,
          "new_api": "length",
          "old_text": null,
          "new_text": "bytecode.length()",
          "old_line_content": "    ticks_for_optimization =",
          "new_line_content": "  } else if (ShouldOptimizeAsSmallFunction(bytecode.length(), ticks,",
          "content_same": false
        },
        {
          "line": 298,
          "old_api": null,
          "new_api": "PrintF",
          "old_text": null,
          "new_text": "PrintF(\"[not yet optimizing \")",
          "old_line_content": "    return OptimizationReason::kHotAndStable;",
          "new_line_content": "    PrintF(\"[not yet optimizing \");",
          "content_same": false
        },
        {
          "line": 300,
          "old_api": null,
          "new_api": "PrintF",
          "old_text": null,
          "new_text": "PrintF(\", not enough ticks: %d/%d and \", ticks, ticks_for_optimization)",
          "old_line_content": "                                           any_ic_changed_,",
          "new_line_content": "    PrintF(\", not enough ticks: %d/%d and \", ticks, ticks_for_optimization);",
          "content_same": false
        },
        {
          "line": 302,
          "old_api": null,
          "new_api": "PrintF",
          "old_text": null,
          "new_text": "PrintF(\"ICs changed]\\n\")",
          "old_line_content": "    // If no IC was patched since the last tick and this function is very",
          "new_line_content": "      PrintF(\"ICs changed]\\n\");",
          "content_same": false
        },
        {
          "line": 304,
          "old_api": null,
          "new_api": "length",
          "old_text": null,
          "new_text": "PrintF(\" too large for small function optimization: %d/%d]\\n\",\n             bytecode.length(), kMaxBytecodeSizeForEarlyOpt)",
          "old_line_content": "    return OptimizationReason::kSmallFunction;",
          "new_line_content": "      PrintF(\" too large for small function optimization: %d/%d]\\n\",",
          "content_same": false
        },
        {
          "line": 305,
          "old_api": null,
          "new_api": "length",
          "old_text": null,
          "new_text": "bytecode.length()",
          "old_line_content": "  } else if (FLAG_trace_opt_verbose) {",
          "new_line_content": "             bytecode.length(), kMaxBytecodeSizeForEarlyOpt);",
          "content_same": false
        },
        {
          "line": 314,
          "old_api": null,
          "new_api": "TRACE_DISABLED_BY_DEFAULT",
          "old_text": null,
          "new_text": "TRACE_DISABLED_BY_DEFAULT(\"v8.compile\")",
          "old_line_content": "    }",
          "new_line_content": "  TRACE_EVENT0(TRACE_DISABLED_BY_DEFAULT(\"v8.compile\"),",
          "content_same": false
        },
        {
          "line": 328,
          "old_api": null,
          "new_api": "use_optimizer",
          "old_text": null,
          "new_text": "isolate_->use_optimizer()",
          "old_line_content": "}",
          "new_line_content": "  if (!isolate_->use_optimizer()) return;",
          "content_same": false
        },
        {
          "line": 331,
          "old_api": null,
          "new_api": "function",
          "old_text": null,
          "new_text": "frame->function()",
          "old_line_content": "    ~MarkCandidatesForOptimizationScope() {",
          "new_line_content": "  JSFunction function = frame->function();",
          "content_same": false
        },
        {
          "line": 332,
          "old_api": null,
          "new_api": "GetActiveTier",
          "old_text": null,
          "new_text": "function.GetActiveTier()",
          "old_line_content": "  profiler_->any_ic_changed_ = false;",
          "new_line_content": "  CodeKind code_kind = function.GetActiveTier();",
          "content_same": false
        },
        {
          "line": 334,
          "old_api": null,
          "new_api": "shared",
          "old_text": null,
          "new_text": "function.shared().is_compiled()",
          "old_line_content": "",
          "new_line_content": "  DCHECK(function.shared().is_compiled());",
          "content_same": false
        },
        {
          "line": 335,
          "old_api": null,
          "new_api": "shared",
          "old_text": null,
          "new_text": "function.shared().IsInterpreted()",
          "old_line_content": "void RuntimeProfiler::MarkCandidatesForOptimization(JavaScriptFrame* frame) {",
          "new_line_content": "  DCHECK(function.shared().IsInterpreted());",
          "content_same": false
        },
        {
          "line": 337,
          "old_api": null,
          "new_api": "CodeKindIsOptimizedJSFunction",
          "old_text": null,
          "new_text": "CodeKindIsOptimizedJSFunction(code_kind)",
          "old_line_content": "  MarkCandidatesForOptimizationScope scope(this);",
          "new_line_content": "  DCHECK_IMPLIES(CodeKindIsOptimizedJSFunction(code_kind),",
          "content_same": false
        },
        {
          "line": 338,
          "old_api": null,
          "new_api": "has_feedback_vector",
          "old_text": null,
          "new_text": "function.has_feedback_vector()",
          "old_line_content": "",
          "new_line_content": "                 function.has_feedback_vector());",
          "content_same": false
        },
        {
          "line": 341,
          "old_api": null,
          "new_api": "feedback_vector",
          "old_text": null,
          "new_text": "function.feedback_vector().SaturatingIncrementProfilerTicks()",
          "old_line_content": "",
          "new_line_content": "  function.feedback_vector().SaturatingIncrementProfilerTicks();",
          "content_same": false
        },
        {
          "line": 348,
          "old_api": null,
          "new_api": "frame",
          "old_text": null,
          "new_text": "it.frame()",
          "old_line_content": "",
          "new_line_content": "  MarkCandidatesForOptimization(it.frame());",
          "content_same": false
        },
        {
          "line": 353,
          "old_api": null,
          "new_api": "frame",
          "old_text": null,
          "new_text": "it.frame()->is_optimized()",
          "old_line_content": "void RuntimeProfiler::MarkCandidatesForOptimizationFromBytecode() {",
          "new_line_content": "  DCHECK(it.frame()->is_optimized());",
          "content_same": false
        },
        {
          "line": 354,
          "old_api": null,
          "new_api": "frame",
          "old_text": null,
          "new_text": "it.frame()",
          "old_line_content": "  JavaScriptFrameIterator it(isolate_);",
          "new_line_content": "  MarkCandidatesForOptimization(it.frame());",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 272,
          "old_api": "ActiveTierIsTurbofan",
          "new_api": null,
          "old_text": "function.ActiveTierIsTurbofan()",
          "new_text": null,
          "old_line_content": "  if (function.ActiveTierIsTurbofan()) {",
          "new_line_content": "  int scale_factor =",
          "content_same": false
        },
        {
          "line": 275,
          "old_api": "ActiveTierIsToptierTurboprop",
          "new_api": null,
          "old_text": "function.ActiveTierIsToptierTurboprop()",
          "new_text": null,
          "old_line_content": "  if (V8_UNLIKELY(FLAG_turboprop) && function.ActiveTierIsToptierTurboprop()) {",
          "new_line_content": "      kProfilerTicksBeforeOptimization +",
          "content_same": false
        },
        {
          "line": 279,
          "old_api": "ActiveTierIsMidtierTurboprop",
          "new_api": null,
          "old_text": "function.ActiveTierIsMidtierTurboprop()",
          "new_text": null,
          "old_line_content": "  bool active_tier_is_turboprop = function.ActiveTierIsMidtierTurboprop();",
          "new_line_content": "    int global_ticks_diff =",
          "content_same": false
        },
        {
          "line": 284,
          "old_api": "length",
          "new_api": null,
          "old_text": "bytecode.length()",
          "new_text": null,
          "old_line_content": "      (bytecode.length() / kBytecodeSizeAllowancePerTick);",
          "new_line_content": "        ticks_for_optimization +",
          "content_same": false
        },
        {
          "line": 286,
          "old_api": "NextTier",
          "new_api": null,
          "old_text": "function.NextTier()",
          "new_text": null,
          "old_line_content": "    DCHECK_EQ(function.NextTier(), CodeKind::TURBOPROP);",
          "new_line_content": "                 kMaxAdditionalMidTierGlobalTicks);",
          "content_same": false
        },
        {
          "line": 289,
          "old_api": "feedback_vector",
          "new_api": null,
          "old_text": "function.feedback_vector()\n             .global_ticks_at_last_runtime_profiler_interrupt()",
          "new_text": null,
          "old_line_content": "         function.feedback_vector()",
          "new_line_content": "  if (ticks >= ticks_for_optimization) {",
          "content_same": false
        },
        {
          "line": 293,
          "old_api": "std::min(global_ticks_diff / kMidTierGlobalTicksScaleFactor,\n                 kMaxAdditionalMidTierGlobalTicks)",
          "new_api": null,
          "old_text": "std::min(global_ticks_diff / kMidTierGlobalTicksScaleFactor,\n                 kMaxAdditionalMidTierGlobalTicks)",
          "new_text": null,
          "old_line_content": "        std::min(global_ticks_diff / kMidTierGlobalTicksScaleFactor,",
          "new_line_content": "                                           active_tier_is_turboprop)) {",
          "content_same": false
        },
        {
          "line": 306,
          "old_api": "PrintF",
          "new_api": null,
          "old_text": "PrintF(\"[not yet optimizing \")",
          "new_text": null,
          "old_line_content": "    PrintF(\"[not yet optimizing \");",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 307,
          "old_api": "PrintName",
          "new_api": null,
          "old_text": "function.PrintName()",
          "new_text": null,
          "old_line_content": "    function.PrintName();",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 308,
          "old_api": "PrintF",
          "new_api": null,
          "old_text": "PrintF(\", not enough ticks: %d/%d and \", ticks, ticks_for_optimization)",
          "new_text": null,
          "old_line_content": "    PrintF(\", not enough ticks: %d/%d and \", ticks, ticks_for_optimization);",
          "new_line_content": "  return OptimizationReason::kDoNotOptimize;",
          "content_same": false
        },
        {
          "line": 310,
          "old_api": "PrintF",
          "new_api": null,
          "old_text": "PrintF(\"ICs changed]\\n\")",
          "new_text": null,
          "old_line_content": "      PrintF(\"ICs changed]\\n\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 312,
          "old_api": "length",
          "new_api": null,
          "old_text": "PrintF(\" too large for small function optimization: %d/%d]\\n\",\n             bytecode.length(), kMaxBytecodeSizeForEarlyOpt)",
          "new_text": null,
          "old_line_content": "      PrintF(\" too large for small function optimization: %d/%d]\\n\",",
          "new_line_content": "    MarkCandidatesForOptimizationScope(RuntimeProfiler* profiler)",
          "content_same": false
        },
        {
          "line": 313,
          "old_api": "length",
          "new_api": null,
          "old_text": "bytecode.length()",
          "new_text": null,
          "old_line_content": "             bytecode.length(), kMaxBytecodeSizeForEarlyOpt);",
          "new_line_content": "    : handle_scope_(profiler->isolate_), profiler_(profiler) {",
          "content_same": false
        },
        {
          "line": 322,
          "old_api": "TRACE_DISABLED_BY_DEFAULT",
          "new_api": null,
          "old_text": "TRACE_DISABLED_BY_DEFAULT(\"v8.compile\")",
          "new_text": null,
          "old_line_content": "  TRACE_EVENT0(TRACE_DISABLED_BY_DEFAULT(\"v8.compile\"),",
          "new_line_content": "RuntimeProfiler::MarkCandidatesForOptimizationScope::",
          "content_same": false
        },
        {
          "line": 336,
          "old_api": "use_optimizer",
          "new_api": null,
          "old_text": "isolate_->use_optimizer()",
          "new_text": null,
          "old_line_content": "  if (!isolate_->use_optimizer()) return;",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 340,
          "old_api": "GetActiveTier",
          "new_api": null,
          "old_text": "function.GetActiveTier()",
          "new_text": null,
          "old_line_content": "  CodeKind code_kind = function.GetActiveTier();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 343,
          "old_api": "shared",
          "new_api": null,
          "old_text": "function.shared().IsInterpreted()",
          "new_text": null,
          "old_line_content": "  DCHECK(function.shared().IsInterpreted());",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 345,
          "old_api": "CodeKindIsOptimizedJSFunction",
          "new_api": null,
          "old_text": "CodeKindIsOptimizedJSFunction(code_kind)",
          "new_text": null,
          "old_line_content": "  DCHECK_IMPLIES(CodeKindIsOptimizedJSFunction(code_kind),",
          "new_line_content": "void RuntimeProfiler::MarkCandidatesForOptimizationFromBytecode() {",
          "content_same": false
        },
        {
          "line": 346,
          "old_api": "has_feedback_vector",
          "new_api": null,
          "old_text": "function.has_feedback_vector()",
          "new_text": null,
          "old_line_content": "                 function.has_feedback_vector());",
          "new_line_content": "  JavaScriptFrameIterator it(isolate_);",
          "content_same": false
        },
        {
          "line": 349,
          "old_api": "feedback_vector",
          "new_api": null,
          "old_text": "function.feedback_vector().SaturatingIncrementProfilerTicks()",
          "new_text": null,
          "old_line_content": "  function.feedback_vector().SaturatingIncrementProfilerTicks();",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 350,
          "old_api": "MaybeOptimizeFrame",
          "new_api": null,
          "old_text": "MaybeOptimizeFrame(function, frame, code_kind)",
          "new_text": null,
          "old_line_content": "  MaybeOptimizeFrame(function, frame, code_kind);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 355,
          "old_api": "frame",
          "new_api": null,
          "old_text": "it.frame()->is_interpreted()",
          "new_text": null,
          "old_line_content": "  DCHECK(it.frame()->is_interpreted());",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 356,
          "old_api": "frame",
          "new_api": null,
          "old_text": "it.frame()",
          "new_text": null,
          "old_line_content": "  MarkCandidatesForOptimization(it.frame());",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 361,
          "old_api": "frame",
          "new_api": null,
          "old_text": "it.frame()->is_optimized()",
          "new_text": null,
          "old_line_content": "  DCHECK(it.frame()->is_optimized());",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 362,
          "old_api": "frame",
          "new_api": null,
          "old_text": "it.frame()",
          "new_text": null,
          "old_line_content": "  MarkCandidatesForOptimization(it.frame());",
          "new_line_content": "",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 5,
      "total_additions": 25,
      "total_deletions": 25,
      "total_api_changes": 55
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 11,
        "api_related_lines": 55,
        "non_api_lines": 10,
        "non_api_line_numbers": [
          256,
          257,
          258,
          259,
          260,
          261,
          262,
          263,
          265,
          254
        ]
      }
    },
    "api_calls_before": 120,
    "api_calls_after": 120,
    "diff_info": {
      "added_lines": 2,
      "removed_lines": 10,
      "total_diff_lines": 26
    }
  }
}