{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/emscripten/modified_file/e75930d8aa92d0b798e6f9290e525053b58be72c",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/emscripten/modified_file/e75930d8aa92d0b798e6f9290e525053b58be72c/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/emscripten/modified_file/e75930d8aa92d0b798e6f9290e525053b58be72c/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/emscripten/modified_file/e75930d8aa92d0b798e6f9290e525053b58be72c/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": true,
    "api_changes": {
      "replacements": [
        {
          "line": 140,
          "old_api": "pop_back",
          "new_api": "size",
          "old_text": "stack.pop_back()",
          "new_text": "stack.size()",
          "old_line_content": "      stack.pop_back();",
          "new_line_content": "      if (stack.size() == 1) break;",
          "content_same": false
        },
        {
          "line": 150,
          "old_api": "size",
          "new_api": "push_back",
          "old_text": "stack.size()",
          "new_text": "stack.push_back({ node, 0 })",
          "old_line_content": "  while (stack.size() > 0) {",
          "new_line_content": "  stack.push_back({ node, 0 });",
          "content_same": false
        },
        {
          "line": 151,
          "old_api": "back",
          "new_api": "size",
          "old_text": "stack.back()",
          "new_text": "stack.size()",
          "old_line_content": "    TraverseInfo& top = stack.back();",
          "new_line_content": "  while (stack.size() > 0) {",
          "content_same": false
        },
        {
          "line": 152,
          "old_api": "size",
          "new_api": "back",
          "old_text": "top.node->size()",
          "new_text": "stack.back()",
          "old_line_content": "    if (top.index < top.node->size()) {",
          "new_line_content": "    TraverseInfo& top = stack.back();",
          "content_same": false
        },
        {
          "line": 156,
          "old_api": "visitPre",
          "new_api": "visitable",
          "old_text": "visitPre(sub)",
          "new_text": "visitable(sub)",
          "old_line_content": "        visitPre(sub);",
          "new_line_content": "      if (visitable(sub)) {",
          "content_same": false
        },
        {
          "line": 157,
          "old_api": "push_back",
          "new_api": "visitPre",
          "old_text": "stack.push_back({ sub, 0 })",
          "new_text": "visitPre(sub)",
          "old_line_content": "        stack.push_back({ sub, 0 });",
          "new_line_content": "        visitPre(sub);",
          "content_same": false
        },
        {
          "line": 161,
          "old_api": "pop_back",
          "new_api": "visitPost",
          "old_text": "stack.pop_back()",
          "new_text": "visitPost(top.node)",
          "old_line_content": "      stack.pop_back();",
          "new_line_content": "      visitPost(top.node);",
          "content_same": false
        },
        {
          "line": 172,
          "old_api": "size",
          "new_api": "push_back",
          "old_text": "stack.size()",
          "new_text": "stack.push_back({ node, 0 })",
          "old_line_content": "  while (stack.size() > 0) {",
          "new_line_content": "  stack.push_back({ node, 0 });",
          "content_same": false
        },
        {
          "line": 173,
          "old_api": "back",
          "new_api": "size",
          "old_text": "stack.back()",
          "new_text": "stack.size()",
          "old_line_content": "    TraverseInfo& top = stack.back();",
          "new_line_content": "  while (stack.size() > 0) {",
          "content_same": false
        },
        {
          "line": 174,
          "old_api": "size",
          "new_api": "back",
          "old_text": "top.node->size()",
          "new_text": "stack.back()",
          "old_line_content": "    if (top.index < top.node->size()) {",
          "new_line_content": "    TraverseInfo& top = stack.back();",
          "content_same": false
        },
        {
          "line": 178,
          "old_api": "visitPre",
          "new_api": "visitable",
          "old_text": "visitPre(sub)",
          "new_text": "visitable(sub)",
          "old_line_content": "        if (visitPre(sub)) {",
          "new_line_content": "      if (visitable(sub)) {",
          "content_same": false
        },
        {
          "line": 179,
          "old_api": "push_back",
          "new_api": "visitPre",
          "old_text": "stack.push_back({ sub, 0 })",
          "new_text": "visitPre(sub)",
          "old_line_content": "          stack.push_back({ sub, 0 });",
          "new_line_content": "        if (visitPre(sub)) {",
          "content_same": false
        },
        {
          "line": 184,
          "old_api": "pop_back",
          "new_api": "visitPost",
          "old_text": "stack.pop_back()",
          "new_text": "visitPost(top.node)",
          "old_line_content": "      stack.pop_back();",
          "new_line_content": "      visitPost(top.node);",
          "content_same": false
        },
        {
          "line": 258,
          "old_api": "end",
          "new_api": "find",
          "old_text": "locals.end()",
          "new_text": "locals.find(name)",
          "old_line_content": "    if (ret != locals.end()) return ret->second.type;",
          "new_line_content": "    auto ret = locals.find(name);",
          "content_same": false
        },
        {
          "line": 286,
          "old_api": "count",
          "new_api": "getIString",
          "old_text": "locals.count(str)",
          "new_text": "name->getIString()",
          "old_line_content": "      if (locals.count(str) > 0) break; // already done that param, must be starting function body",
          "new_line_content": "      IString& str = name->getIString();",
          "content_same": false
        },
        {
          "line": 287,
          "old_api": "detectType",
          "new_api": "count",
          "old_text": "detectType(node[3])",
          "new_text": "locals.count(str)",
          "old_line_content": "      locals[str] = { detectType(node[3]), true };",
          "new_line_content": "      if (locals.count(str) > 0) break; // already done that param, must be starting function body",
          "content_same": false
        },
        {
          "line": 288,
          "old_api": "push_back",
          "new_api": "detectType",
          "old_text": "params.push_back(str)",
          "new_text": "detectType(node[3])",
          "old_line_content": "      params.push_back(str);",
          "new_line_content": "      locals[str] = { detectType(node[3]), true };",
          "content_same": false
        },
        {
          "line": 289,
          "old_api": "makeEmpty",
          "new_api": "push_back",
          "old_text": "makeEmpty()",
          "new_text": "params.push_back(str)",
          "old_line_content": "      stats[i] = makeEmpty();",
          "new_line_content": "      params.push_back(str);",
          "content_same": false
        },
        {
          "line": 301,
          "old_api": "detectType",
          "new_api": "count",
          "old_text": "detectType(value, nullptr, true)",
          "new_text": "locals.count(name)",
          "old_line_content": "          locals[name] = { detectType(value, nullptr, true), false };",
          "new_line_content": "        if (locals.count(name) == 0) {",
          "content_same": false
        },
        {
          "line": 302,
          "old_api": "push_back",
          "new_api": "detectType",
          "old_text": "vars.push_back(name)",
          "new_text": "detectType(value, nullptr, true)",
          "old_line_content": "          vars.push_back(name);",
          "new_line_content": "          locals[name] = { detectType(value, nullptr, true), false };",
          "content_same": false
        },
        {
          "line": 303,
          "old_api": "setSize",
          "new_api": "push_back",
          "old_text": "v->setSize(1)",
          "new_text": "vars.push_back(name)",
          "old_line_content": "          v->setSize(1); // make an un-assigning var",
          "new_line_content": "          vars.push_back(name);",
          "content_same": false
        },
        {
          "line": 314,
          "old_api": "stringify",
          "new_api": "size",
          "old_text": "traversePre(stats[i], [&](Ref node) {\n        Ref type = node[0];\n        if (type == VAR) {\n          dump(\"bad, seeing a var in need of fixing\", func);\n          assert(0); //, 'should be no vars to fix! ' + func[1] + ' : ' + JSON.stringify(node));\n        }\n      })",
          "new_text": "stats->size()",
          "old_line_content": "      traversePre(stats[i], [&](Ref node) {",
          "new_line_content": "    while (i < stats->size()) {",
          "content_same": false
        },
        {
          "line": 318,
          "old_api": "assert",
          "new_api": "dump",
          "old_text": "assert(0)",
          "new_text": "dump(\"bad, seeing a var in need of fixing\", func)",
          "old_line_content": "          assert(0); //, 'should be no vars to fix! ' + func[1] + ' : ' + JSON.stringify(node));",
          "new_line_content": "          dump(\"bad, seeing a var in need of fixing\", func);",
          "content_same": false
        },
        {
          "line": 351,
          "old_api": "isEmpty",
          "new_api": "size",
          "old_text": "isEmpty(stats[emptyNodes])",
          "new_text": "stats->size()",
          "old_line_content": "      if (!isEmpty(stats[emptyNodes])) break;",
          "new_line_content": "    while (emptyNodes < stats->size()) {",
          "content_same": false
        },
        {
          "line": 363,
          "old_api": "getIString",
          "new_api": "getArray",
          "old_text": "param->getIString()",
          "new_text": "func[2]->getArray()",
          "old_line_content": "      IString str = param->getIString();",
          "new_line_content": "    for (auto param : func[2]->getArray()) {",
          "content_same": false
        },
        {
          "line": 364,
          "old_api": "count",
          "new_api": "getIString",
          "old_text": "locals.count(str)",
          "new_text": "param->getIString()",
          "old_line_content": "      assert(locals.count(str) > 0);",
          "new_line_content": "      IString str = param->getIString();",
          "content_same": false
        },
        {
          "line": 365,
          "old_api": "c_str",
          "new_api": "count",
          "old_text": "str.c_str()",
          "new_text": "locals.count(str)",
          "old_line_content": "      stats[next++] = make1(STAT, make3(ASSIGN, &(arena.alloc())->setBool(true), makeName(str.c_str()), makeAsmCoercion(makeName(str.c_str()), locals[str].type)));",
          "new_line_content": "      assert(locals.count(str) > 0);",
          "content_same": false
        },
        {
          "line": 368,
          "old_api": "make1",
          "new_api": "size",
          "old_text": "make1(VAR, varDefs)",
          "new_text": "varDefs->size()",
          "old_line_content": "      stats[next] = make1(VAR, varDefs);",
          "new_line_content": "    if (varDefs->size()) {",
          "content_same": false
        },
        {
          "line": 401,
          "old_api": "size",
          "new_api": "erase",
          "old_text": "vars.size()",
          "new_text": "locals.erase(name)",
          "old_line_content": "    for (int i = 0; i < vars.size(); i++) {",
          "new_line_content": "    locals.erase(name);",
          "content_same": false
        },
        {
          "line": 458,
          "old_api": "assert",
          "new_api": "getIString",
          "old_text": "assert(node[1] == ASM_FLOAT_ZERO)",
          "new_text": "node[1]->getIString()",
          "old_line_content": "        else assert(node[1] == ASM_FLOAT_ZERO);",
          "new_line_content": "        if (ASM_FLOAT_ZERO.isNull()) ASM_FLOAT_ZERO = node[1]->getIString();",
          "content_same": false
        },
        {
          "line": 506,
          "old_api": "getCString",
          "new_api": "assert",
          "old_text": "node[1][1]->getCString()",
          "new_text": "assert(node[1][0] == NAME)",
          "old_line_content": "        HeapInfo info = parseHeap(node[1][1]->getCString());",
          "new_line_content": "        assert(node[1][0] == NAME);",
          "content_same": false
        },
        {
          "line": 514,
          "old_api": "assert",
          "new_api": "dump",
          "old_text": "assert(0)",
          "new_text": "dump(\"horrible\", node)",
          "old_line_content": "  assert(0);",
          "new_line_content": "  dump(\"horrible\", node);",
          "content_same": false
        },
        {
          "line": 531,
          "old_api": "makeArray",
          "new_api": "makeString",
          "old_text": "makeArray()",
          "new_text": "makeString(TOPLEVEL)",
          "old_line_content": "  ret->push_back(makeArray());",
          "new_line_content": "  ret->push_back(makeString(TOPLEVEL));",
          "content_same": false
        },
        {
          "line": 537,
          "old_api": "push_back",
          "new_api": "makeArray",
          "old_text": "ret->push_back(x)",
          "new_text": "makeArray()",
          "old_line_content": "  ret->push_back(x);",
          "new_line_content": "  Ref ret = makeArray();",
          "content_same": false
        },
        {
          "line": 545,
          "old_api": "alloc",
          "new_api": "makeString",
          "old_text": "arena.alloc()->setNumber(x)",
          "new_text": "makeString(NUM)",
          "old_line_content": "  ret->push_back(&arena.alloc()->setNumber(x));",
          "new_line_content": "  ret->push_back(makeString(NUM));",
          "content_same": false
        },
        {
          "line": 559,
          "old_api": "makeArray",
          "new_api": "makeString",
          "old_text": "makeArray()",
          "new_text": "makeString(BLOCK)",
          "old_line_content": "  ret->push_back(makeArray());",
          "new_line_content": "  ret->push_back(makeString(BLOCK));",
          "content_same": false
        },
        {
          "line": 566,
          "old_api": "push_back",
          "new_api": "makeString",
          "old_text": "ret->push_back(a)",
          "new_text": "makeString(type)",
          "old_line_content": "  ret->push_back(a);",
          "new_line_content": "  ret->push_back(makeString(type));",
          "content_same": false
        },
        {
          "line": 574,
          "old_api": "push_back",
          "new_api": "makeString",
          "old_text": "ret->push_back(b)",
          "new_text": "makeString(a)",
          "old_line_content": "  ret->push_back(b);",
          "new_line_content": "  ret->push_back(makeString(a));",
          "content_same": false
        },
        {
          "line": 581,
          "old_api": "push_back",
          "new_api": "makeString",
          "old_text": "ret->push_back(a)",
          "new_text": "makeString(type)",
          "old_line_content": "  ret->push_back(a);",
          "new_line_content": "  ret->push_back(makeString(type));",
          "content_same": false
        },
        {
          "line": 590,
          "old_api": "push_back",
          "new_api": "makeString",
          "old_text": "ret->push_back(b)",
          "new_text": "makeString(a)",
          "old_line_content": "  ret->push_back(b);",
          "new_line_content": "  ret->push_back(makeString(a));",
          "content_same": false
        },
        {
          "line": 598,
          "old_api": "push_back",
          "new_api": "makeString",
          "old_text": "ret->push_back(a)",
          "new_text": "makeString(type)",
          "old_line_content": "  ret->push_back(a);",
          "new_line_content": "  ret->push_back(makeString(type));",
          "content_same": false
        },
        {
          "line": 611,
          "old_api": "makeName",
          "new_api": "isNull",
          "old_text": "makeName(ASM_FLOAT_ZERO)",
          "new_text": "ASM_FLOAT_ZERO.isNull()",
          "old_line_content": "        val = makeName(ASM_FLOAT_ZERO);",
          "new_line_content": "      if (!ASM_FLOAT_ZERO.isNull()) {",
          "content_same": false
        },
        {
          "line": 633,
          "old_api": "make2",
          "new_api": "makeNum",
          "old_text": "make2(UNARY_PREFIX, PLUS, node)",
          "new_text": "makeNum(0)",
          "old_line_content": "    case ASM_DOUBLE: return make2(UNARY_PREFIX, PLUS, node);",
          "new_line_content": "    case ASM_INT: return make3(BINARY, OR, node, makeNum(0));",
          "content_same": false
        },
        {
          "line": 634,
          "old_api": "push_back",
          "new_api": "make2",
          "old_text": "makeArray())->push_back(node)",
          "new_text": "make2(UNARY_PREFIX, PLUS, node)",
          "old_line_content": "    case ASM_FLOAT: return make2(CALL, makeName(MATH_FROUND), &(makeArray())->push_back(node));",
          "new_line_content": "    case ASM_DOUBLE: return make2(UNARY_PREFIX, PLUS, node);",
          "content_same": false
        },
        {
          "line": 657,
          "old_api": "strncmp",
          "new_api": "strlen",
          "old_text": "strncmp(name, Math_, size)",
          "new_text": "strlen(Math_)",
          "old_line_content": "  return strncmp(name, Math_, size) == 0;",
          "new_line_content": "  static unsigned size = strlen(Math_);",
          "content_same": false
        },
        {
          "line": 689,
          "old_api": "hasSideEffects",
          "new_api": "getArray",
          "old_text": "hasSideEffects(arg)",
          "new_text": "node[2]->getArray()",
          "old_line_content": "          if (hasSideEffects(arg)) return true;",
          "new_line_content": "        for (auto arg : node[2]->getArray()) {",
          "content_same": false
        },
        {
          "line": 785,
          "old_api": "isEmpty",
          "new_api": "clearEmptyNodes",
          "old_text": "isEmpty(node[1])",
          "new_text": "clearEmptyNodes(node[1])",
          "old_line_content": "    } else if (node[0] == SEQ && isEmpty(node[1])) {",
          "new_line_content": "      clearEmptyNodes(node[1]);",
          "content_same": false
        },
        {
          "line": 786,
          "old_api": "safeCopy",
          "new_api": "isEmpty",
          "old_text": "safeCopy(node, node[2])",
          "new_text": "isEmpty(node[1])",
          "old_line_content": "      safeCopy(node, node[2]);",
          "new_line_content": "    } else if (node[0] == SEQ && isEmpty(node[1])) {",
          "content_same": false
        },
        {
          "line": 832,
          "old_api": "malloc",
          "new_api": "strlen",
          "old_text": "malloc(size+1)",
          "new_text": "strlen(init)",
          "old_line_content": "    char *curr = (char*)malloc(size+1); // leaked!",
          "new_line_content": "    int size = strlen(init);",
          "content_same": false
        },
        {
          "line": 833,
          "old_api": "strcpy",
          "new_api": "malloc",
          "old_text": "strcpy(curr, init)",
          "new_text": "malloc(size+1)",
          "old_line_content": "    strcpy(curr, init);",
          "new_line_content": "    char *curr = (char*)malloc(size+1); // leaked!",
          "content_same": false
        },
        {
          "line": 859,
          "old_api": "strncmp",
          "new_api": "strlen",
          "old_text": "strncmp(name, functionTable, size)",
          "new_text": "strlen(functionTable)",
          "old_line_content": "  return strncmp(name, functionTable, size) == 0;",
          "new_line_content": "  static unsigned size = strlen(functionTable);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 515,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(0)",
          "old_line_content": "  return ASM_NONE;",
          "new_line_content": "  assert(0);",
          "content_same": false
        },
        {
          "line": 522,
          "old_api": null,
          "new_api": "alloc",
          "old_text": null,
          "new_text": "arena.alloc()->setArray()",
          "old_line_content": "}",
          "new_line_content": "  return &arena.alloc()->setArray();",
          "content_same": false
        },
        {
          "line": 526,
          "old_api": null,
          "new_api": "alloc",
          "old_text": null,
          "new_text": "arena.alloc()->setString(s)",
          "old_line_content": "}",
          "new_line_content": "  return &arena.alloc()->setString(s);",
          "content_same": false
        },
        {
          "line": 532,
          "old_api": null,
          "new_api": "makeArray",
          "old_text": null,
          "new_text": "makeArray()",
          "old_line_content": "  return ret;",
          "new_line_content": "  ret->push_back(makeArray());",
          "content_same": false
        },
        {
          "line": 539,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "ret->push_back(y)",
          "old_line_content": "  return ret;",
          "new_line_content": "  ret->push_back(y);",
          "content_same": false
        },
        {
          "line": 546,
          "old_api": null,
          "new_api": "alloc",
          "old_text": null,
          "new_text": "arena.alloc()->setNumber(x)",
          "old_line_content": "  return ret;",
          "new_line_content": "  ret->push_back(&arena.alloc()->setNumber(x));",
          "content_same": false
        },
        {
          "line": 553,
          "old_api": null,
          "new_api": "makeString",
          "old_text": null,
          "new_text": "makeString(str)",
          "old_line_content": "  return ret;",
          "new_line_content": "  ret->push_back(makeString(str));",
          "content_same": false
        },
        {
          "line": 560,
          "old_api": null,
          "new_api": "makeArray",
          "old_text": null,
          "new_text": "makeArray()",
          "old_line_content": "  return ret;",
          "new_line_content": "  ret->push_back(makeArray());",
          "content_same": false
        },
        {
          "line": 567,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "ret->push_back(a)",
          "old_line_content": "  return ret;",
          "new_line_content": "  ret->push_back(a);",
          "content_same": false
        },
        {
          "line": 575,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "ret->push_back(b)",
          "old_line_content": "  return ret;",
          "new_line_content": "  ret->push_back(b);",
          "content_same": false
        },
        {
          "line": 583,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "ret->push_back(b)",
          "old_line_content": "  return ret;",
          "new_line_content": "  ret->push_back(b);",
          "content_same": false
        },
        {
          "line": 592,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "ret->push_back(c)",
          "old_line_content": "  return ret;",
          "new_line_content": "  ret->push_back(c);",
          "content_same": false
        },
        {
          "line": 601,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "ret->push_back(c)",
          "old_line_content": "  return ret;",
          "new_line_content": "  ret->push_back(c);",
          "content_same": false
        },
        {
          "line": 609,
          "old_api": null,
          "new_api": "makeNum",
          "old_text": null,
          "new_text": "makeNum(0)",
          "old_line_content": "    case ASM_FLOAT: {",
          "new_line_content": "    case ASM_DOUBLE: val = make2(UNARY_PREFIX, PLUS, makeNum(0)); break;",
          "content_same": false
        },
        {
          "line": 612,
          "old_api": null,
          "new_api": "makeName",
          "old_text": null,
          "new_text": "makeName(ASM_FLOAT_ZERO)",
          "old_line_content": "      } else {",
          "new_line_content": "        val = makeName(ASM_FLOAT_ZERO);",
          "content_same": false
        },
        {
          "line": 614,
          "old_api": null,
          "new_api": "makeNum",
          "old_text": null,
          "new_text": "makeNum(0)",
          "old_line_content": "      }",
          "new_line_content": "        val = make2(CALL, makeName(MATH_FROUND), &(makeArray())->push_back(makeNum(0)));",
          "content_same": false
        },
        {
          "line": 619,
          "old_api": null,
          "new_api": "makeNum",
          "old_text": null,
          "new_text": "makeNum(0)",
          "old_line_content": "      break;",
          "new_line_content": "      val = make2(CALL, makeName(SIMD_FLOAT32X4), &(makeArray())->push_back(makeNum(0)).push_back(makeNum(0)).push_back(makeNum(0)).push_back(makeNum(0)));",
          "content_same": false
        },
        {
          "line": 623,
          "old_api": null,
          "new_api": "makeNum",
          "old_text": null,
          "new_text": "makeNum(0)",
          "old_line_content": "      break;",
          "new_line_content": "      val = make2(CALL, makeName(SIMD_INT32X4), &(makeArray())->push_back(makeNum(0)).push_back(makeNum(0)).push_back(makeNum(0)).push_back(makeNum(0)));",
          "content_same": false
        },
        {
          "line": 626,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(0)",
          "old_line_content": "  }",
          "new_line_content": "    default: assert(0);",
          "content_same": false
        },
        {
          "line": 628,
          "old_api": null,
          "new_api": "alloc",
          "old_text": null,
          "new_text": "arena.alloc()->setString(v)",
          "old_line_content": "}",
          "new_line_content": "  return makePair(&(arena.alloc()->setString(v)), val);",
          "content_same": false
        },
        {
          "line": 637,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "makeArray())->push_back(node)",
          "old_line_content": "    case ASM_NONE:",
          "new_line_content": "    case ASM_INT32X4: return make2(CALL, makeName(SIMD_INT32X4), &(makeArray())->push_back(node));",
          "content_same": false
        },
        {
          "line": 646,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "node[1]->size()",
          "old_line_content": "}",
          "new_line_content": "  return node->size() == 2 && node[0] == TOPLEVEL && node[1]->size() == 0;",
          "content_same": false
        },
        {
          "line": 650,
          "old_api": null,
          "new_api": "getIString",
          "old_text": null,
          "new_text": "node[0]->getIString()",
          "old_line_content": "  if (type == ASSIGN || type == BINARY || type == UNARY_PREFIX || type == NAME || type == NUM || type == CALL || type == SEQ || type == CONDITIONAL || type == SUB) return true;",
          "new_line_content": "  IString type = node[0]->getIString();",
          "content_same": false
        },
        {
          "line": 141,
          "old_api": null,
          "new_api": "pop_back",
          "old_text": null,
          "new_text": "stack.pop_back()",
          "old_line_content": "    }",
          "new_line_content": "      stack.pop_back();",
          "content_same": false
        },
        {
          "line": 658,
          "old_api": null,
          "new_api": "strncmp",
          "old_text": null,
          "new_text": "strncmp(name, Math_, size)",
          "old_line_content": "}",
          "new_line_content": "  return strncmp(name, Math_, size) == 0;",
          "content_same": false
        },
        {
          "line": 148,
          "old_api": null,
          "new_api": "visitPre",
          "old_text": null,
          "new_text": "visitPre(node)",
          "old_line_content": "  std::vector<TraverseInfo> stack;",
          "new_line_content": "  visitPre(node);",
          "content_same": false
        },
        {
          "line": 662,
          "old_api": null,
          "new_api": "getCString",
          "old_text": null,
          "new_text": "value->getCString()",
          "old_line_content": "}",
          "new_line_content": "  return value->isString() && isMathFunc(value->getCString());",
          "content_same": false
        },
        {
          "line": 153,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "top.node->size()",
          "old_line_content": "      Ref sub = top.node[top.index];",
          "new_line_content": "    if (top.index < top.node->size()) {",
          "content_same": false
        },
        {
          "line": 666,
          "old_api": null,
          "new_api": "isMathFunc",
          "old_text": null,
          "new_text": "isMathFunc(node[1][1])",
          "old_line_content": "}",
          "new_line_content": "  return !(node[1][0] == NAME && isMathFunc(node[1][1]));",
          "content_same": false
        },
        {
          "line": 158,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "stack.push_back({ sub, 0 })",
          "old_line_content": "      }",
          "new_line_content": "        stack.push_back({ sub, 0 });",
          "content_same": false
        },
        {
          "line": 670,
          "old_api": null,
          "new_api": "getIString",
          "old_text": null,
          "new_text": "node[0]->getIString()",
          "old_line_content": "  switch (type[0]) {",
          "new_line_content": "  IString type = node[0]->getIString();",
          "content_same": false
        },
        {
          "line": 162,
          "old_api": null,
          "new_api": "pop_back",
          "old_text": null,
          "new_text": "stack.pop_back()",
          "old_line_content": "    }",
          "new_line_content": "      stack.pop_back();",
          "content_same": false
        },
        {
          "line": 165,
          "old_api": null,
          "new_api": "visitPost",
          "old_text": null,
          "new_text": "visitPost(node)",
          "old_line_content": "}",
          "new_line_content": "  visitPost(node);",
          "content_same": false
        },
        {
          "line": 677,
          "old_api": null,
          "new_api": "hasSideEffects",
          "old_text": null,
          "new_text": "hasSideEffects(node[2])",
          "old_line_content": "      break;",
          "new_line_content": "      if (type == SUB) return hasSideEffects(node[1]) || hasSideEffects(node[2]);",
          "content_same": false
        },
        {
          "line": 680,
          "old_api": null,
          "new_api": "hasSideEffects",
          "old_text": null,
          "new_text": "hasSideEffects(node[2])",
          "old_line_content": "      break;",
          "new_line_content": "      if (type == UNARY_PREFIX) return hasSideEffects(node[2]);",
          "content_same": false
        },
        {
          "line": 170,
          "old_api": null,
          "new_api": "visitPre",
          "old_text": null,
          "new_text": "visitPre(node)",
          "old_line_content": "  std::vector<TraverseInfo> stack;",
          "new_line_content": "  if (!visitPre(node)) return;",
          "content_same": false
        },
        {
          "line": 683,
          "old_api": null,
          "new_api": "hasSideEffects",
          "old_text": null,
          "new_text": "hasSideEffects(node[3])",
          "old_line_content": "      break;",
          "new_line_content": "      if (type == BINARY) return hasSideEffects(node[2]) || hasSideEffects(node[3]);",
          "content_same": false
        },
        {
          "line": 175,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "top.node->size()",
          "old_line_content": "      Ref sub = top.node[top.index];",
          "new_line_content": "    if (top.index < top.node->size()) {",
          "content_same": false
        },
        {
          "line": 687,
          "old_api": null,
          "new_api": "callHasSideEffects",
          "old_text": null,
          "new_text": "callHasSideEffects(node)",
          "old_line_content": "        // This is a statically known call, with no side effects. only args can side effect us",
          "new_line_content": "        if (callHasSideEffects(node)) return true;",
          "content_same": false
        },
        {
          "line": 690,
          "old_api": null,
          "new_api": "hasSideEffects",
          "old_text": null,
          "new_text": "hasSideEffects(arg)",
          "old_line_content": "        }",
          "new_line_content": "          if (hasSideEffects(arg)) return true;",
          "content_same": false
        },
        {
          "line": 180,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "stack.push_back({ sub, 0 })",
          "old_line_content": "        }",
          "new_line_content": "          stack.push_back({ sub, 0 });",
          "content_same": false
        },
        {
          "line": 693,
          "old_api": null,
          "new_api": "hasSideEffects",
          "old_text": null,
          "new_text": "hasSideEffects(node[3])",
          "old_line_content": "      break;",
          "new_line_content": "      } else if (type == CONDITIONAL) return hasSideEffects(node[1]) || hasSideEffects(node[2]) || hasSideEffects(node[3]); ",
          "content_same": false
        },
        {
          "line": 185,
          "old_api": null,
          "new_api": "pop_back",
          "old_text": null,
          "new_text": "stack.pop_back()",
          "old_line_content": "    }",
          "new_line_content": "      stack.pop_back();",
          "content_same": false
        },
        {
          "line": 188,
          "old_api": null,
          "new_api": "visitPost",
          "old_text": null,
          "new_text": "visitPost(node)",
          "old_line_content": "}",
          "new_line_content": "  visitPost(node);",
          "content_same": false
        },
        {
          "line": 703,
          "old_api": null,
          "new_api": "isLocal",
          "old_text": null,
          "new_text": "traversePre(node, [&](Ref node) {\n    Ref type = node[0];\n    if (type == STAT || type == BINARY || type == UNARY_PREFIX || type == ASSIGN || type == NUM) return;\n    else if (type == NAME) {\n      if (!asmData.isLocal(node[1]->getIString())) ok = false;\n    } else if (type == CALL) {\n      if (callHasSideEffects(node)) ok = false;\n    } else {\n      ok = false;\n    }  \n  })",
          "old_line_content": "    Ref type = node[0];",
          "new_line_content": "  traversePre(node, [&](Ref node) {",
          "content_same": false
        },
        {
          "line": 195,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "stats->size()",
          "old_line_content": "      Ref curr = stats[i];",
          "new_line_content": "    for (int i = 0; i < stats->size(); i++) {",
          "content_same": false
        },
        {
          "line": 707,
          "old_api": null,
          "new_api": "getIString",
          "old_text": null,
          "new_text": "node[1]->getIString()",
          "old_line_content": "    } else if (type == CALL) {",
          "new_line_content": "      if (!asmData.isLocal(node[1]->getIString())) ok = false;",
          "content_same": false
        },
        {
          "line": 197,
          "old_api": null,
          "new_api": "visit",
          "old_text": null,
          "new_text": "visit(curr)",
          "old_line_content": "    }",
          "new_line_content": "      if (curr[0] == DEFUN) visit(curr);",
          "content_same": false
        },
        {
          "line": 709,
          "old_api": null,
          "new_api": "callHasSideEffects",
          "old_text": null,
          "new_text": "callHasSideEffects(node)",
          "old_line_content": "    } else {",
          "new_line_content": "      if (callHasSideEffects(node)) ok = false;",
          "content_same": false
        },
        {
          "line": 200,
          "old_api": null,
          "new_api": "visit",
          "old_text": null,
          "new_text": "visit(ast)",
          "old_line_content": "  }",
          "new_line_content": "    visit(ast);",
          "content_same": false
        },
        {
          "line": 726,
          "old_api": null,
          "new_api": "detectType",
          "old_text": null,
          "new_text": "detectType(node[2][3])",
          "old_line_content": "      Ref op = node[2][1];",
          "new_line_content": "    if (node[2][0] == BINARY && (detectType(node[2][2]) == ASM_INT && detectType(node[2][3]) == ASM_INT)) {",
          "content_same": false
        },
        {
          "line": 215,
          "old_api": null,
          "new_api": "alloc",
          "old_text": null,
          "new_text": "arena.alloc()",
          "old_line_content": "  }",
          "new_line_content": "    return arena.alloc();",
          "content_same": false
        },
        {
          "line": 728,
          "old_api": null,
          "new_api": "getCString",
          "old_text": null,
          "new_text": "op->getCString()",
          "old_line_content": "        case '<': {",
          "new_line_content": "      switch(op->getCString()[0]) {",
          "content_same": false
        },
        {
          "line": 731,
          "old_api": null,
          "new_api": "setString",
          "old_text": null,
          "new_text": "op->setString(GT)",
          "old_line_content": "          return node;",
          "new_line_content": "          if (op == LE) { op->setString(GT); break; }",
          "content_same": false
        },
        {
          "line": 736,
          "old_api": null,
          "new_api": "setString",
          "old_text": null,
          "new_text": "op->setString(LT)",
          "old_line_content": "          return node;",
          "new_line_content": "          if (op == GE) { op->setString(LT); break; }",
          "content_same": false
        },
        {
          "line": 740,
          "old_api": null,
          "new_api": "setString",
          "old_text": null,
          "new_text": "op->setString(NE)",
          "old_line_content": "          return node;",
          "new_line_content": "          if (op == EQ) { op->setString(NE); break; }",
          "content_same": false
        },
        {
          "line": 744,
          "old_api": null,
          "new_api": "setString",
          "old_text": null,
          "new_text": "op->setString(EQ)",
          "old_line_content": "          return node;",
          "new_line_content": "          if (op == NE) { op->setString(EQ); break; }",
          "content_same": false
        },
        {
          "line": 749,
          "old_api": null,
          "new_api": "make3",
          "old_text": null,
          "new_text": "make3(BINARY, op, node[2][2], node[2][3])",
          "old_line_content": "    } else if (node[2][0] == UNARY_PREFIX && node[2][1] == L_NOT) {",
          "new_line_content": "      return make3(BINARY, op, node[2][2], node[2][3]);",
          "content_same": false
        },
        {
          "line": 758,
          "old_api": null,
          "new_api": "make2",
          "old_text": null,
          "new_text": "make2(UNARY_PREFIX, L_NOT, cond)",
          "old_line_content": "}",
          "new_line_content": "  return simplifyNotCompsDirect(make2(UNARY_PREFIX, L_NOT, cond));",
          "content_same": false
        },
        {
          "line": 768,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "arr->size()",
          "old_line_content": "    if (skip) {",
          "new_line_content": "  for (int i = 0; i < arr->size(); i++) {",
          "content_same": false
        },
        {
          "line": 259,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "locals.end()",
          "old_line_content": "    return ASM_NONE;",
          "new_line_content": "    if (ret != locals.end()) return ret->second.type;",
          "content_same": false
        },
        {
          "line": 772,
          "old_api": null,
          "new_api": "deStat",
          "old_text": null,
          "new_text": "deStat(arr[i])",
          "old_line_content": "      skip++;",
          "new_line_content": "    if (isEmpty(deStat(arr[i]))) {",
          "content_same": false
        },
        {
          "line": 776,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "arr->size()",
          "old_line_content": "}",
          "new_line_content": "  if (skip) arr->setSize(arr->size() - skip);",
          "content_same": false
        },
        {
          "line": 267,
          "old_api": null,
          "new_api": "count",
          "old_text": null,
          "new_text": "locals.count(name)",
          "old_line_content": "  }",
          "new_line_content": "    return locals.count(name) > 0;",
          "content_same": false
        },
        {
          "line": 780,
          "old_api": null,
          "new_api": "traversePre",
          "old_text": null,
          "new_text": "traversePre(ast, [](Ref node) {\n    int index = -1;\n    if (node[0] == DEFUN) {\n      clearEmptyNodes(node[3]);\n    } else if (node[0] == BLOCK && !!node[1]) {\n      clearEmptyNodes(node[1]);\n    } else if (node[0] == SEQ && isEmpty(node[1])) {\n      safeCopy(node, node[2]);\n    }\n  })",
          "old_line_content": "    int index = -1;",
          "new_line_content": "  traversePre(ast, [](Ref node) {",
          "content_same": false
        },
        {
          "line": 270,
          "old_api": null,
          "new_api": "isLocal",
          "old_text": null,
          "new_text": "isLocal(name)",
          "old_line_content": "  }",
          "new_line_content": "    return isLocal(name) && !locals[name].param;",
          "content_same": false
        },
        {
          "line": 783,
          "old_api": null,
          "new_api": "clearEmptyNodes",
          "old_text": null,
          "new_text": "clearEmptyNodes(node[3])",
          "old_line_content": "    } else if (node[0] == BLOCK && !!node[1]) {",
          "new_line_content": "      clearEmptyNodes(node[3]);",
          "content_same": false
        },
        {
          "line": 787,
          "old_api": null,
          "new_api": "safeCopy",
          "old_text": null,
          "new_text": "safeCopy(node, node[2])",
          "old_line_content": "    }",
          "new_line_content": "      safeCopy(node, node[2]);",
          "content_same": false
        },
        {
          "line": 279,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "stats->size()",
          "old_line_content": "      Ref node = stats[i];",
          "new_line_content": "    while (i < stats->size()) {",
          "content_same": false
        },
        {
          "line": 284,
          "old_api": null,
          "new_api": "indexOf",
          "old_text": null,
          "new_text": "func[2]->indexOf(name)",
          "old_line_content": "      if (index < 0) break; // not an assign into a parameter, but a global",
          "new_line_content": "      int index = func[2]->indexOf(name);",
          "content_same": false
        },
        {
          "line": 796,
          "old_api": null,
          "new_api": "getNumber",
          "old_text": null,
          "new_text": "traversePre(ast, [&size](Ref node) {\n    Ref type = node[0];\n    if (type == NUM || type == UNARY_PREFIX) size--;\n    else if (type == BINARY) {\n      if (node[3][0] == NUM && node[3][1]->getNumber() == 0) size--;\n      else if (node[1] == DIV || node[1] == MOD) size += 2;\n    }\n    else if (type == CALL && !callHasSideEffects(node)) size -= 2;\n    else if (type == SUB) size++;\n    size++;\n  })",
          "old_line_content": "    Ref type = node[0];",
          "new_line_content": "  traversePre(ast, [&size](Ref node) {",
          "content_same": false
        },
        {
          "line": 800,
          "old_api": null,
          "new_api": "getNumber",
          "old_text": null,
          "new_text": "node[3][1]->getNumber()",
          "old_line_content": "      else if (node[1] == DIV || node[1] == MOD) size += 2;",
          "new_line_content": "      if (node[3][0] == NUM && node[3][1]->getNumber() == 0) size--;",
          "content_same": false
        },
        {
          "line": 290,
          "old_api": null,
          "new_api": "makeEmpty",
          "old_text": null,
          "new_text": "makeEmpty()",
          "old_line_content": "      i++;",
          "new_line_content": "      stats[i] = makeEmpty();",
          "content_same": false
        },
        {
          "line": 803,
          "old_api": null,
          "new_api": "callHasSideEffects",
          "old_text": null,
          "new_text": "callHasSideEffects(node)",
          "old_line_content": "    else if (type == SUB) size++;",
          "new_line_content": "    else if (type == CALL && !callHasSideEffects(node)) size -= 2;",
          "content_same": false
        },
        {
          "line": 294,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "stats->size()",
          "old_line_content": "      Ref node = stats[i];",
          "new_line_content": "    while (i < stats->size()) {",
          "content_same": false
        },
        {
          "line": 297,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "node[1]->size()",
          "old_line_content": "        Ref v = node[1][j];",
          "new_line_content": "      for (int j = 0; j < node[1]->size(); j++) {",
          "content_same": false
        },
        {
          "line": 299,
          "old_api": null,
          "new_api": "getIString",
          "old_text": null,
          "new_text": "v[0]->getIString()",
          "old_line_content": "        Ref value = v[1];",
          "new_line_content": "        IString& name = v[0]->getIString();",
          "content_same": false
        },
        {
          "line": 304,
          "old_api": null,
          "new_api": "setSize",
          "old_text": null,
          "new_text": "v->setSize(1)",
          "old_line_content": "        } else {",
          "new_line_content": "          v->setSize(1); // make an un-assigning var",
          "content_same": false
        },
        {
          "line": 306,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(j == 0)",
          "old_line_content": "          goto outside;",
          "new_line_content": "          assert(j == 0); // cannot break in the middle",
          "content_same": false
        },
        {
          "line": 315,
          "old_api": null,
          "new_api": "stringify",
          "old_text": null,
          "new_text": "traversePre(stats[i], [&](Ref node) {\n        Ref type = node[0];\n        if (type == VAR) {\n          dump(\"bad, seeing a var in need of fixing\", func);\n          assert(0); //, 'should be no vars to fix! ' + func[1] + ' : ' + JSON.stringify(node));\n        }\n      })",
          "old_line_content": "        Ref type = node[0];",
          "new_line_content": "      traversePre(stats[i], [&](Ref node) {",
          "content_same": false
        },
        {
          "line": 319,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(0)",
          "old_line_content": "        }",
          "new_line_content": "          assert(0); //, 'should be no vars to fix! ' + func[1] + ' : ' + JSON.stringify(node));",
          "content_same": false
        },
        {
          "line": 834,
          "old_api": null,
          "new_api": "strcpy",
          "old_text": null,
          "new_text": "strcpy(curr, init)",
          "old_line_content": "    while (1) {",
          "new_line_content": "    strcpy(curr, init);",
          "content_same": false
        },
        {
          "line": 836,
          "old_api": null,
          "new_api": "strchr",
          "old_text": null,
          "new_text": "strchr(curr, ' ')",
          "old_line_content": "      if (end) *end = 0;",
          "new_line_content": "      char *end = strchr(curr, ' ');",
          "content_same": false
        },
        {
          "line": 325,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "stats->size()",
          "old_line_content": "    if (!!retStmt && retStmt[0] == RETURN && !!retStmt[1]) {",
          "new_line_content": "    Ref retStmt = stats[stats->size() - 1];",
          "content_same": false
        },
        {
          "line": 838,
          "old_api": null,
          "new_api": "insert",
          "old_text": null,
          "new_text": "insert(curr)",
          "old_line_content": "      if (!end) break;",
          "new_line_content": "      insert(curr);",
          "content_same": false
        },
        {
          "line": 327,
          "old_api": null,
          "new_api": "detectType",
          "old_text": null,
          "new_text": "detectType(retStmt[1])",
          "old_line_content": "    } else {",
          "new_line_content": "      ret = detectType(retStmt[1]);",
          "content_same": false
        },
        {
          "line": 336,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "stats->size()",
          "old_line_content": "      if (stats[i][0] == VAR) {",
          "new_line_content": "    for (int i = 0; i < stats->size(); i++) {",
          "content_same": false
        },
        {
          "line": 338,
          "old_api": null,
          "new_api": "makeEmpty",
          "old_text": null,
          "new_text": "makeEmpty()",
          "old_line_content": "      } else {",
          "new_line_content": "        stats[i] = makeEmpty();",
          "content_same": false
        },
        {
          "line": 340,
          "old_api": null,
          "new_api": "isEmpty",
          "old_text": null,
          "new_text": "isEmpty(stats[i])",
          "old_line_content": "      }",
          "new_line_content": "        if (!isEmpty(stats[i])) break;",
          "content_same": false
        },
        {
          "line": 344,
          "old_api": null,
          "new_api": "makeArray",
          "old_text": null,
          "new_text": "makeArray()",
          "old_line_content": "    for (auto v : vars) {",
          "new_line_content": "    Ref varDefs = makeArray();",
          "content_same": false
        },
        {
          "line": 346,
          "old_api": null,
          "new_api": "makeAsmVarDef",
          "old_text": null,
          "new_text": "makeAsmVarDef(v, locals[v].type)",
          "old_line_content": "    }",
          "new_line_content": "      varDefs->push_back(makeAsmVarDef(v, locals[v].type));",
          "content_same": false
        },
        {
          "line": 860,
          "old_api": null,
          "new_api": "strncmp",
          "old_text": null,
          "new_text": "strncmp(name, functionTable, size)",
          "old_line_content": "}",
          "new_line_content": "  return strncmp(name, functionTable, size) == 0;",
          "content_same": false
        },
        {
          "line": 349,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "params.size()",
          "old_line_content": "    int emptyNodes = 0;",
          "new_line_content": "    int numParams = params.size();",
          "content_same": false
        },
        {
          "line": 352,
          "old_api": null,
          "new_api": "isEmpty",
          "old_text": null,
          "new_text": "isEmpty(stats[emptyNodes])",
          "old_line_content": "      emptyNodes++;",
          "new_line_content": "      if (!isEmpty(stats[emptyNodes])) break;",
          "content_same": false
        },
        {
          "line": 864,
          "old_api": null,
          "new_api": "getCString",
          "old_text": null,
          "new_text": "value->getCString()",
          "old_line_content": "}",
          "new_line_content": "  return value->isString() && isFunctionTable(value->getCString());",
          "content_same": false
        },
        {
          "line": 355,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "varDefs->size()",
          "old_line_content": "    if (neededEmptyNodes > emptyNodes) {",
          "new_line_content": "    int neededEmptyNodes = numParams + (varDefs->size() ? 1 : 0); // params plus one big var if there are vars",
          "content_same": false
        },
        {
          "line": 357,
          "old_api": null,
          "new_api": "insert",
          "old_text": null,
          "new_text": "stats->insert(0, neededEmptyNodes - emptyNodes)",
          "old_line_content": "    } else if (neededEmptyNodes < emptyNodes) {",
          "new_line_content": "      stats->insert(0, neededEmptyNodes - emptyNodes);",
          "content_same": false
        },
        {
          "line": 359,
          "old_api": null,
          "new_api": "splice",
          "old_text": null,
          "new_text": "stats->splice(0, emptyNodes - neededEmptyNodes)",
          "old_line_content": "    }",
          "new_line_content": "      stats->splice(0, emptyNodes - neededEmptyNodes);",
          "content_same": false
        },
        {
          "line": 366,
          "old_api": null,
          "new_api": "c_str",
          "old_text": null,
          "new_text": "str.c_str()",
          "old_line_content": "    }",
          "new_line_content": "      stats[next++] = make1(STAT, make3(ASSIGN, &(arena.alloc())->setBool(true), makeName(str.c_str()), makeAsmCoercion(makeName(str.c_str()), locals[str].type)));",
          "content_same": false
        },
        {
          "line": 369,
          "old_api": null,
          "new_api": "make1",
          "old_text": null,
          "new_text": "make1(VAR, varDefs)",
          "old_line_content": "    }",
          "new_line_content": "      stats[next] = make1(VAR, varDefs);",
          "content_same": false
        },
        {
          "line": 383,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "stats->size()",
          "old_line_content": "      if (!retStmt || retStmt[0] != RETURN) {",
          "new_line_content": "      Ref retStmt = stats[stats->size() - 1];",
          "content_same": false
        },
        {
          "line": 385,
          "old_api": null,
          "new_api": "makeNum",
          "old_text": null,
          "new_text": "makeNum(0)",
          "old_line_content": "        if (ret != ASM_INT) {",
          "new_line_content": "        Ref retVal = makeNum(0);",
          "content_same": false
        },
        {
          "line": 387,
          "old_api": null,
          "new_api": "makeAsmCoercion",
          "old_text": null,
          "new_text": "makeAsmCoercion(retVal, ret)",
          "old_line_content": "        }",
          "new_line_content": "          retVal = makeAsmCoercion(retVal, ret);",
          "content_same": false
        },
        {
          "line": 389,
          "old_api": null,
          "new_api": "make1",
          "old_text": null,
          "new_text": "make1(RETURN, retVal)",
          "old_line_content": "      }",
          "new_line_content": "        stats->push_back(make1(RETURN, retVal));",
          "content_same": false
        },
        {
          "line": 906,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(node[0] == SUB)",
          "old_line_content": "  return (node[2][0] == NAME && node[2][1] == TEMP_DOUBLE_PTR) ||",
          "new_line_content": "  assert(node[0] == SUB);",
          "content_same": false
        },
        {
          "line": 397,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "vars.push_back(name)",
          "old_line_content": "  }",
          "new_line_content": "    vars.push_back(name);",
          "content_same": false
        },
        {
          "line": 402,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "vars.size()",
          "old_line_content": "      if (vars[i] == name) {",
          "new_line_content": "    for (int i = 0; i < vars.size(); i++) {",
          "content_same": false
        },
        {
          "line": 404,
          "old_api": null,
          "new_api": "begin",
          "old_text": null,
          "new_text": "vars.begin()",
          "old_line_content": "        break;",
          "new_line_content": "        vars.erase(vars.begin() + i);",
          "content_same": false
        },
        {
          "line": 426,
          "old_api": null,
          "new_api": "parseInt",
          "old_text": null,
          "new_text": "parseInt(name + (ret.unsign || ret.floaty ? 5 : 4))",
          "old_line_content": "  ret.type = !ret.floaty ? ASM_INT : (ret.bits == 64 ? ASM_DOUBLE : ASM_FLOAT);",
          "new_line_content": "  ret.bits = parseInt(name + (ret.unsign || ret.floaty ? 5 : 4));",
          "content_same": false
        },
        {
          "line": 432,
          "old_api": null,
          "new_api": "fmod",
          "old_text": null,
          "new_text": "fmod(x, 1)",
          "old_line_content": "}",
          "new_line_content": "  return fmod(x, 1) == 0;",
          "content_same": false
        },
        {
          "line": 436,
          "old_api": null,
          "new_api": "isInteger",
          "old_text": null,
          "new_text": "isInteger(x)",
          "old_line_content": "}",
          "new_line_content": "  return isInteger(x) && (x == (int32_t)x || x == (uint32_t)x);",
          "content_same": false
        },
        {
          "line": 442,
          "old_api": null,
          "new_api": "getCString",
          "old_text": null,
          "new_text": "node[0]->getCString()",
          "old_line_content": "    case 'n': {",
          "new_line_content": "  switch (node[0]->getCString()[0]) {",
          "content_same": false
        },
        {
          "line": 445,
          "old_api": null,
          "new_api": "getNumber",
          "old_text": null,
          "new_text": "node[1]->getNumber()",
          "old_line_content": "        return ASM_INT;",
          "new_line_content": "        if (!isInteger(node[1]->getNumber())) return ASM_DOUBLE;",
          "content_same": false
        },
        {
          "line": 449,
          "old_api": null,
          "new_api": "getCString",
          "old_text": null,
          "new_text": "node[1]->getCString()",
          "old_line_content": "          if (ret != ASM_NONE) return ret;",
          "new_line_content": "          AsmType ret = asmData->getType(node[1]->getCString());",
          "content_same": false
        },
        {
          "line": 459,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(node[1] == ASM_FLOAT_ZERO)",
          "old_line_content": "        return ASM_FLOAT;",
          "new_line_content": "        else assert(node[1] == ASM_FLOAT_ZERO);",
          "content_same": false
        },
        {
          "line": 466,
          "old_api": null,
          "new_api": "getCString",
          "old_text": null,
          "new_text": "node[1]->getCString()",
          "old_line_content": "          case '+': return ASM_DOUBLE;",
          "new_line_content": "        switch (node[1]->getCString()[0]) {",
          "content_same": false
        },
        {
          "line": 468,
          "old_api": null,
          "new_api": "detectType",
          "old_text": null,
          "new_text": "detectType(node[2], asmData, inVarDef)",
          "old_line_content": "          case '!': case '~': return ASM_INT;",
          "new_line_content": "          case '-': return detectType(node[2], asmData, inVarDef);",
          "content_same": false
        },
        {
          "line": 478,
          "old_api": null,
          "new_api": "getIString",
          "old_text": null,
          "new_text": "node[1][1]->getIString()",
          "old_line_content": "          if (name == MATH_FROUND) return ASM_FLOAT;",
          "new_line_content": "          IString name = node[1][1]->getIString();",
          "content_same": false
        },
        {
          "line": 485,
          "old_api": null,
          "new_api": "detectType",
          "old_text": null,
          "new_text": "detectType(node[2], asmData, inVarDef)",
          "old_line_content": "      }",
          "new_line_content": "        return detectType(node[2], asmData, inVarDef);",
          "content_same": false
        },
        {
          "line": 491,
          "old_api": null,
          "new_api": "getCString",
          "old_text": null,
          "new_text": "node[1]->getCString()",
          "old_line_content": "          case '+': case '-':",
          "new_line_content": "        switch (node[1]->getCString()[0]) {",
          "content_same": false
        },
        {
          "line": 493,
          "old_api": null,
          "new_api": "detectType",
          "old_text": null,
          "new_text": "detectType(node[2], asmData, inVarDef)",
          "old_line_content": "          case '|': case '&': case '^': case '<': case '>': // handles <<, >>, >>=, <=, >=",
          "new_line_content": "          case '*': case '/': case '%': return detectType(node[2], asmData, inVarDef);",
          "content_same": false
        },
        {
          "line": 504,
          "old_api": null,
          "new_api": "detectType",
          "old_text": null,
          "new_text": "detectType(node[2], asmData, inVarDef)",
          "old_line_content": "      } else if (node[0] == SUB) {",
          "new_line_content": "        return detectType(node[2], asmData, inVarDef);",
          "content_same": false
        },
        {
          "line": 507,
          "old_api": null,
          "new_api": "getCString",
          "old_text": null,
          "new_text": "node[1][1]->getCString()",
          "old_line_content": "        if (info.valid) return ASM_NONE;",
          "new_line_content": "        HeapInfo info = parseHeap(node[1][1]->getCString());",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 513,
          "old_api": "dump",
          "new_api": null,
          "old_text": "dump(\"horrible\", node)",
          "new_text": null,
          "old_line_content": "  dump(\"horrible\", node);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 521,
          "old_api": "alloc",
          "new_api": null,
          "old_text": "arena.alloc()->setArray()",
          "new_text": null,
          "old_line_content": "  return &arena.alloc()->setArray();",
          "new_line_content": "Ref makeArray() {",
          "content_same": false
        },
        {
          "line": 525,
          "old_api": "alloc",
          "new_api": null,
          "old_text": "arena.alloc()->setString(s)",
          "new_text": null,
          "old_line_content": "  return &arena.alloc()->setString(s);",
          "new_line_content": "Ref makeString(const IString& s) {",
          "content_same": false
        },
        {
          "line": 530,
          "old_api": "makeString",
          "new_api": null,
          "old_text": "makeString(TOPLEVEL)",
          "new_text": null,
          "old_line_content": "  ret->push_back(makeString(TOPLEVEL));",
          "new_line_content": "  Ref ret(makeArray());",
          "content_same": false
        },
        {
          "line": 536,
          "old_api": "makeArray",
          "new_api": null,
          "old_text": "makeArray()",
          "new_text": null,
          "old_line_content": "  Ref ret = makeArray();",
          "new_line_content": "Ref makePair(Ref x, Ref y) {",
          "content_same": false
        },
        {
          "line": 544,
          "old_api": "makeString",
          "new_api": null,
          "old_text": "makeString(NUM)",
          "new_text": null,
          "old_line_content": "  ret->push_back(makeString(NUM));",
          "new_line_content": "  Ref ret(makeArray());",
          "content_same": false
        },
        {
          "line": 551,
          "old_api": "makeString",
          "new_api": null,
          "old_text": "makeString(NAME)",
          "new_text": null,
          "old_line_content": "  ret->push_back(makeString(NAME));",
          "new_line_content": "  Ref ret(makeArray());",
          "content_same": false
        },
        {
          "line": 558,
          "old_api": "makeString",
          "new_api": null,
          "old_text": "makeString(BLOCK)",
          "new_text": null,
          "old_line_content": "  ret->push_back(makeString(BLOCK));",
          "new_line_content": "  Ref ret(makeArray());",
          "content_same": false
        },
        {
          "line": 565,
          "old_api": "makeString",
          "new_api": null,
          "old_text": "makeString(type)",
          "new_text": null,
          "old_line_content": "  ret->push_back(makeString(type));",
          "new_line_content": "  Ref ret(makeArray());",
          "content_same": false
        },
        {
          "line": 572,
          "old_api": "makeString",
          "new_api": null,
          "old_text": "makeString(type)",
          "new_text": null,
          "old_line_content": "  ret->push_back(makeString(type));",
          "new_line_content": "  Ref ret(makeArray());",
          "content_same": false
        },
        {
          "line": 580,
          "old_api": "makeString",
          "new_api": null,
          "old_text": "makeString(type)",
          "new_text": null,
          "old_line_content": "  ret->push_back(makeString(type));",
          "new_line_content": "  Ref ret(makeArray());",
          "content_same": false
        },
        {
          "line": 588,
          "old_api": "makeString",
          "new_api": null,
          "old_text": "makeString(type)",
          "new_text": null,
          "old_line_content": "  ret->push_back(makeString(type));",
          "new_line_content": "  Ref ret(makeArray());",
          "content_same": false
        },
        {
          "line": 597,
          "old_api": "makeString",
          "new_api": null,
          "old_text": "makeString(type)",
          "new_text": null,
          "old_line_content": "  ret->push_back(makeString(type));",
          "new_line_content": "  Ref ret(makeArray());",
          "content_same": false
        },
        {
          "line": 607,
          "old_api": "makeNum",
          "new_api": null,
          "old_text": "makeNum(0)",
          "new_text": null,
          "old_line_content": "    case ASM_INT: val = makeNum(0); break;",
          "new_line_content": "  switch (type) {",
          "content_same": false
        },
        {
          "line": 610,
          "old_api": "isNull",
          "new_api": null,
          "old_text": "ASM_FLOAT_ZERO.isNull()",
          "new_text": null,
          "old_line_content": "      if (!ASM_FLOAT_ZERO.isNull()) {",
          "new_line_content": "    case ASM_FLOAT: {",
          "content_same": false
        },
        {
          "line": 613,
          "old_api": "makeNum",
          "new_api": null,
          "old_text": "makeNum(0)",
          "new_text": null,
          "old_line_content": "        val = make2(CALL, makeName(MATH_FROUND), &(makeArray())->push_back(makeNum(0)));",
          "new_line_content": "      } else {",
          "content_same": false
        },
        {
          "line": 618,
          "old_api": "makeNum",
          "new_api": null,
          "old_text": "makeNum(0)",
          "new_text": null,
          "old_line_content": "      val = make2(CALL, makeName(SIMD_FLOAT32X4), &(makeArray())->push_back(makeNum(0)).push_back(makeNum(0)).push_back(makeNum(0)).push_back(makeNum(0)));",
          "new_line_content": "    case ASM_FLOAT32X4: {",
          "content_same": false
        },
        {
          "line": 622,
          "old_api": "makeNum",
          "new_api": null,
          "old_text": "makeNum(0)",
          "new_text": null,
          "old_line_content": "      val = make2(CALL, makeName(SIMD_INT32X4), &(makeArray())->push_back(makeNum(0)).push_back(makeNum(0)).push_back(makeNum(0)).push_back(makeNum(0)));",
          "new_line_content": "    case ASM_INT32X4: {",
          "content_same": false
        },
        {
          "line": 625,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(0)",
          "new_text": null,
          "old_line_content": "    default: assert(0);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 627,
          "old_api": "alloc",
          "new_api": null,
          "old_text": "arena.alloc()->setString(v)",
          "new_text": null,
          "old_line_content": "  return makePair(&(arena.alloc()->setString(v)), val);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 632,
          "old_api": "makeNum",
          "new_api": null,
          "old_text": "makeNum(0)",
          "new_text": null,
          "old_line_content": "    case ASM_INT: return make3(BINARY, OR, node, makeNum(0));",
          "new_line_content": "  switch (type) {",
          "content_same": false
        },
        {
          "line": 130,
          "old_api": "size",
          "new_api": null,
          "old_text": "stack.size()",
          "new_text": null,
          "old_line_content": "  while (stack.size() > 0) {",
          "new_line_content": "  while (1) {",
          "content_same": false
        },
        {
          "line": 645,
          "old_api": "size",
          "new_api": null,
          "old_text": "node[1]->size()",
          "new_text": null,
          "old_line_content": "  return node->size() == 2 && node[0] == TOPLEVEL && node[1]->size() == 0;",
          "new_line_content": "bool isEmpty(Ref node) {",
          "content_same": false
        },
        {
          "line": 649,
          "old_api": "getIString",
          "new_api": null,
          "old_text": "node[0]->getIString()",
          "new_text": null,
          "old_line_content": "  IString type = node[0]->getIString();",
          "new_line_content": "bool commable(Ref node) { // TODO: hashing",
          "content_same": false
        },
        {
          "line": 656,
          "old_api": "strlen",
          "new_api": null,
          "old_text": "strlen(Math_)",
          "new_text": null,
          "old_line_content": "  static unsigned size = strlen(Math_);",
          "new_line_content": "  static const char *Math_ = \"Math_\";",
          "content_same": false
        },
        {
          "line": 147,
          "old_api": "visitPre",
          "new_api": null,
          "old_text": "visitPre(node)",
          "new_text": null,
          "old_line_content": "  visitPre(node);",
          "new_line_content": "void traversePrePost(Ref node, std::function<void (Ref)> visitPre, std::function<void (Ref)> visitPost) {",
          "content_same": false
        },
        {
          "line": 149,
          "old_api": "push_back",
          "new_api": null,
          "old_text": "stack.push_back({ node, 0 })",
          "new_text": null,
          "old_line_content": "  stack.push_back({ node, 0 });",
          "new_line_content": "  std::vector<TraverseInfo> stack;",
          "content_same": false
        },
        {
          "line": 661,
          "old_api": "getCString",
          "new_api": null,
          "old_text": "value->getCString()",
          "new_text": null,
          "old_line_content": "  return value->isString() && isMathFunc(value->getCString());",
          "new_line_content": "bool isMathFunc(Ref value) {",
          "content_same": false
        },
        {
          "line": 665,
          "old_api": "isMathFunc",
          "new_api": null,
          "old_text": "isMathFunc(node[1][1])",
          "new_text": null,
          "old_line_content": "  return !(node[1][0] == NAME && isMathFunc(node[1][1]));",
          "new_line_content": "bool callHasSideEffects(Ref node) { // checks if the call itself (not the args) has side effects (or is not statically known)",
          "content_same": false
        },
        {
          "line": 155,
          "old_api": "visitable",
          "new_api": null,
          "old_text": "visitable(sub)",
          "new_text": null,
          "old_line_content": "      if (visitable(sub)) {",
          "new_line_content": "      top.index++;",
          "content_same": false
        },
        {
          "line": 669,
          "old_api": "getIString",
          "new_api": null,
          "old_text": "node[0]->getIString()",
          "new_text": null,
          "old_line_content": "  IString type = node[0]->getIString();",
          "new_line_content": "bool hasSideEffects(Ref node) { // this is 99% incomplete!",
          "content_same": false
        },
        {
          "line": 160,
          "old_api": "visitPost",
          "new_api": null,
          "old_text": "visitPost(top.node)",
          "new_text": null,
          "old_line_content": "      visitPost(top.node);",
          "new_line_content": "    } else {",
          "content_same": false
        },
        {
          "line": 164,
          "old_api": "visitPost",
          "new_api": null,
          "old_text": "visitPost(node)",
          "new_text": null,
          "old_line_content": "  visitPost(node);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 676,
          "old_api": "hasSideEffects",
          "new_api": null,
          "old_text": "hasSideEffects(node[2])",
          "new_text": null,
          "old_line_content": "      if (type == SUB) return hasSideEffects(node[1]) || hasSideEffects(node[2]);",
          "new_line_content": "      if (type == STRING) return false;",
          "content_same": false
        },
        {
          "line": 679,
          "old_api": "hasSideEffects",
          "new_api": null,
          "old_text": "hasSideEffects(node[2])",
          "new_text": null,
          "old_line_content": "      if (type == UNARY_PREFIX) return hasSideEffects(node[2]);",
          "new_line_content": "    case 'u':",
          "content_same": false
        },
        {
          "line": 169,
          "old_api": "visitPre",
          "new_api": null,
          "old_text": "visitPre(node)",
          "new_text": null,
          "old_line_content": "  if (!visitPre(node)) return;",
          "new_line_content": "void traversePrePostConditional(Ref node, std::function<bool (Ref)> visitPre, std::function<void (Ref)> visitPost) {",
          "content_same": false
        },
        {
          "line": 682,
          "old_api": "hasSideEffects",
          "new_api": null,
          "old_text": "hasSideEffects(node[3])",
          "new_text": null,
          "old_line_content": "      if (type == BINARY) return hasSideEffects(node[2]) || hasSideEffects(node[3]);",
          "new_line_content": "    case 'b':",
          "content_same": false
        },
        {
          "line": 171,
          "old_api": "push_back",
          "new_api": null,
          "old_text": "stack.push_back({ node, 0 })",
          "new_text": null,
          "old_line_content": "  stack.push_back({ node, 0 });",
          "new_line_content": "  std::vector<TraverseInfo> stack;",
          "content_same": false
        },
        {
          "line": 686,
          "old_api": "callHasSideEffects",
          "new_api": null,
          "old_text": "callHasSideEffects(node)",
          "new_text": null,
          "old_line_content": "        if (callHasSideEffects(node)) return true;",
          "new_line_content": "      if (type == CALL) {",
          "content_same": false
        },
        {
          "line": 688,
          "old_api": "getArray",
          "new_api": null,
          "old_text": "node[2]->getArray()",
          "new_text": null,
          "old_line_content": "        for (auto arg : node[2]->getArray()) {",
          "new_line_content": "        // This is a statically known call, with no side effects. only args can side effect us",
          "content_same": false
        },
        {
          "line": 177,
          "old_api": "visitable",
          "new_api": null,
          "old_text": "visitable(sub)",
          "new_text": null,
          "old_line_content": "      if (visitable(sub)) {",
          "new_line_content": "      top.index++;",
          "content_same": false
        },
        {
          "line": 692,
          "old_api": "hasSideEffects",
          "new_api": null,
          "old_text": "hasSideEffects(node[3])",
          "new_text": null,
          "old_line_content": "      } else if (type == CONDITIONAL) return hasSideEffects(node[1]) || hasSideEffects(node[2]) || hasSideEffects(node[3]); ",
          "new_line_content": "        return false;",
          "content_same": false
        },
        {
          "line": 183,
          "old_api": "visitPost",
          "new_api": null,
          "old_text": "visitPost(top.node)",
          "new_text": null,
          "old_line_content": "      visitPost(top.node);",
          "new_line_content": "    } else {",
          "content_same": false
        },
        {
          "line": 187,
          "old_api": "visitPost",
          "new_api": null,
          "old_text": "visitPost(node)",
          "new_text": null,
          "old_line_content": "  visitPost(node);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 702,
          "old_api": "isLocal",
          "new_api": null,
          "old_text": "traversePre(node, [&](Ref node) {\n    Ref type = node[0];\n    if (type == STAT || type == BINARY || type == UNARY_PREFIX || type == ASSIGN || type == NUM) return;\n    else if (type == NAME) {\n      if (!asmData.isLocal(node[1]->getIString())) ok = false;\n    } else if (type == CALL) {\n      if (callHasSideEffects(node)) ok = false;\n    } else {\n      ok = false;\n    }  \n  })",
          "new_text": null,
          "old_line_content": "  traversePre(node, [&](Ref node) {",
          "new_line_content": "  bool ok = true;",
          "content_same": false
        },
        {
          "line": 194,
          "old_api": "size",
          "new_api": null,
          "old_text": "stats->size()",
          "new_text": null,
          "old_line_content": "    for (int i = 0; i < stats->size(); i++) {",
          "new_line_content": "    Ref stats = ast[1];",
          "content_same": false
        },
        {
          "line": 706,
          "old_api": "getIString",
          "new_api": null,
          "old_text": "node[1]->getIString()",
          "new_text": null,
          "old_line_content": "      if (!asmData.isLocal(node[1]->getIString())) ok = false;",
          "new_line_content": "    else if (type == NAME) {",
          "content_same": false
        },
        {
          "line": 196,
          "old_api": "visit",
          "new_api": null,
          "old_text": "visit(curr)",
          "new_text": null,
          "old_line_content": "      if (curr[0] == DEFUN) visit(curr);",
          "new_line_content": "      Ref curr = stats[i];",
          "content_same": false
        },
        {
          "line": 708,
          "old_api": "callHasSideEffects",
          "new_api": null,
          "old_text": "callHasSideEffects(node)",
          "new_text": null,
          "old_line_content": "      if (callHasSideEffects(node)) ok = false;",
          "new_line_content": "    } else if (type == CALL) {",
          "content_same": false
        },
        {
          "line": 199,
          "old_api": "visit",
          "new_api": null,
          "old_text": "visit(ast)",
          "new_text": null,
          "old_line_content": "    visit(ast);",
          "new_line_content": "  } else if (ast[0] == DEFUN) {",
          "content_same": false
        },
        {
          "line": 725,
          "old_api": "detectType",
          "new_api": null,
          "old_text": "detectType(node[2][3])",
          "new_text": null,
          "old_line_content": "    if (node[2][0] == BINARY && (detectType(node[2][2]) == ASM_INT && detectType(node[2][3]) == ASM_INT)) {",
          "new_line_content": "    // de-morgan's laws do not work on floats, due to nans >:(",
          "content_same": false
        },
        {
          "line": 214,
          "old_api": "alloc",
          "new_api": null,
          "old_text": "arena.alloc()",
          "new_text": null,
          "old_line_content": "    return arena.alloc();",
          "new_line_content": "  } else {",
          "content_same": false
        },
        {
          "line": 727,
          "old_api": "getCString",
          "new_api": null,
          "old_text": "op->getCString()",
          "new_text": null,
          "old_line_content": "      switch(op->getCString()[0]) {",
          "new_line_content": "      Ref op = node[2][1];",
          "content_same": false
        },
        {
          "line": 729,
          "old_api": "setString",
          "new_api": null,
          "old_text": "op->setString(GE)",
          "new_text": null,
          "old_line_content": "          if (op == LT)  { op->setString(GE); break; }",
          "new_line_content": "        case '<': {",
          "content_same": false
        },
        {
          "line": 734,
          "old_api": "setString",
          "new_api": null,
          "old_text": "op->setString(LE)",
          "new_text": null,
          "old_line_content": "          if (op == GT)  { op->setString(LE); break; }",
          "new_line_content": "        case '>': {",
          "content_same": false
        },
        {
          "line": 739,
          "old_api": "setString",
          "new_api": null,
          "old_text": "op->setString(NE)",
          "new_text": null,
          "old_line_content": "          if (op == EQ) { op->setString(NE); break; }",
          "new_line_content": "        case '=': {",
          "content_same": false
        },
        {
          "line": 743,
          "old_api": "setString",
          "new_api": null,
          "old_text": "op->setString(EQ)",
          "new_text": null,
          "old_line_content": "          if (op == NE) { op->setString(EQ); break; }",
          "new_line_content": "        case '!': {",
          "content_same": false
        },
        {
          "line": 748,
          "old_api": "make3",
          "new_api": null,
          "old_text": "make3(BINARY, op, node[2][2], node[2][3])",
          "new_text": null,
          "old_line_content": "      return make3(BINARY, op, node[2][2], node[2][3]);",
          "new_line_content": "      }",
          "content_same": false
        },
        {
          "line": 757,
          "old_api": "make2",
          "new_api": null,
          "old_text": "make2(UNARY_PREFIX, L_NOT, cond)",
          "new_text": null,
          "old_line_content": "  return simplifyNotCompsDirect(make2(UNARY_PREFIX, L_NOT, cond));",
          "new_line_content": "Ref flipCondition(Ref cond) {",
          "content_same": false
        },
        {
          "line": 767,
          "old_api": "size",
          "new_api": null,
          "old_text": "arr->size()",
          "new_text": null,
          "old_line_content": "  for (int i = 0; i < arr->size(); i++) {",
          "new_line_content": "  int skip = 0;",
          "content_same": false
        },
        {
          "line": 257,
          "old_api": "find",
          "new_api": null,
          "old_text": "locals.find(name)",
          "new_text": null,
          "old_line_content": "    auto ret = locals.find(name);",
          "new_line_content": "  AsmType getType(const IString& name) {",
          "content_same": false
        },
        {
          "line": 771,
          "old_api": "deStat",
          "new_api": null,
          "old_text": "deStat(arr[i])",
          "new_text": null,
          "old_line_content": "    if (isEmpty(deStat(arr[i]))) {",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 775,
          "old_api": "size",
          "new_api": null,
          "old_text": "arr->size()",
          "new_text": null,
          "old_line_content": "  if (skip) arr->setSize(arr->size() - skip);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 266,
          "old_api": "count",
          "new_api": null,
          "old_text": "locals.count(name)",
          "new_text": null,
          "old_line_content": "    return locals.count(name) > 0;",
          "new_line_content": "  bool isLocal(const IString& name) {",
          "content_same": false
        },
        {
          "line": 779,
          "old_api": "traversePre",
          "new_api": null,
          "old_text": "traversePre(ast, [](Ref node) {\n    int index = -1;\n    if (node[0] == DEFUN) {\n      clearEmptyNodes(node[3]);\n    } else if (node[0] == BLOCK && !!node[1]) {\n      clearEmptyNodes(node[1]);\n    } else if (node[0] == SEQ && isEmpty(node[1])) {\n      safeCopy(node, node[2]);\n    }\n  })",
          "new_text": null,
          "old_line_content": "  traversePre(ast, [](Ref node) {",
          "new_line_content": "void removeAllEmptySubNodes(Ref ast) {",
          "content_same": false
        },
        {
          "line": 269,
          "old_api": "isLocal",
          "new_api": null,
          "old_text": "isLocal(name)",
          "new_text": null,
          "old_line_content": "    return isLocal(name) && !locals[name].param;",
          "new_line_content": "  bool isVar(const IString& name) {",
          "content_same": false
        },
        {
          "line": 782,
          "old_api": "clearEmptyNodes",
          "new_api": null,
          "old_text": "clearEmptyNodes(node[3])",
          "new_text": null,
          "old_line_content": "      clearEmptyNodes(node[3]);",
          "new_line_content": "    if (node[0] == DEFUN) {",
          "content_same": false
        },
        {
          "line": 784,
          "old_api": "clearEmptyNodes",
          "new_api": null,
          "old_text": "clearEmptyNodes(node[1])",
          "new_text": null,
          "old_line_content": "      clearEmptyNodes(node[1]);",
          "new_line_content": "    } else if (node[0] == BLOCK && !!node[1]) {",
          "content_same": false
        },
        {
          "line": 278,
          "old_api": "size",
          "new_api": null,
          "old_text": "stats->size()",
          "new_text": null,
          "old_line_content": "    while (i < stats->size()) {",
          "new_line_content": "    int i = 0;",
          "content_same": false
        },
        {
          "line": 283,
          "old_api": "indexOf",
          "new_api": null,
          "old_text": "func[2]->indexOf(name)",
          "new_text": null,
          "old_line_content": "      int index = func[2]->indexOf(name);",
          "new_line_content": "      Ref name = node[2][1];",
          "content_same": false
        },
        {
          "line": 795,
          "old_api": "getNumber",
          "new_api": null,
          "old_text": "traversePre(ast, [&size](Ref node) {\n    Ref type = node[0];\n    if (type == NUM || type == UNARY_PREFIX) size--;\n    else if (type == BINARY) {\n      if (node[3][0] == NUM && node[3][1]->getNumber() == 0) size--;\n      else if (node[1] == DIV || node[1] == MOD) size += 2;\n    }\n    else if (type == CALL && !callHasSideEffects(node)) size -= 2;\n    else if (type == SUB) size++;\n    size++;\n  })",
          "new_text": null,
          "old_line_content": "  traversePre(ast, [&size](Ref node) {",
          "new_line_content": "  int size = 0;",
          "content_same": false
        },
        {
          "line": 285,
          "old_api": "getIString",
          "new_api": null,
          "old_text": "name->getIString()",
          "new_text": null,
          "old_line_content": "      IString& str = name->getIString();",
          "new_line_content": "      if (index < 0) break; // not an assign into a parameter, but a global",
          "content_same": false
        },
        {
          "line": 799,
          "old_api": "getNumber",
          "new_api": null,
          "old_text": "node[3][1]->getNumber()",
          "new_text": null,
          "old_line_content": "      if (node[3][0] == NUM && node[3][1]->getNumber() == 0) size--;",
          "new_line_content": "    else if (type == BINARY) {",
          "content_same": false
        },
        {
          "line": 802,
          "old_api": "callHasSideEffects",
          "new_api": null,
          "old_text": "callHasSideEffects(node)",
          "new_text": null,
          "old_line_content": "    else if (type == CALL && !callHasSideEffects(node)) size -= 2;",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 293,
          "old_api": "size",
          "new_api": null,
          "old_text": "stats->size()",
          "new_text": null,
          "old_line_content": "    while (i < stats->size()) {",
          "new_line_content": "    // process initial variable definitions",
          "content_same": false
        },
        {
          "line": 296,
          "old_api": "size",
          "new_api": null,
          "old_text": "node[1]->size()",
          "new_text": null,
          "old_line_content": "      for (int j = 0; j < node[1]->size(); j++) {",
          "new_line_content": "      if (node[0] != VAR) break;",
          "content_same": false
        },
        {
          "line": 298,
          "old_api": "getIString",
          "new_api": null,
          "old_text": "v[0]->getIString()",
          "new_text": null,
          "old_line_content": "        IString& name = v[0]->getIString();",
          "new_line_content": "        Ref v = node[1][j];",
          "content_same": false
        },
        {
          "line": 300,
          "old_api": "count",
          "new_api": null,
          "old_text": "locals.count(name)",
          "new_text": null,
          "old_line_content": "        if (locals.count(name) == 0) {",
          "new_line_content": "        Ref value = v[1];",
          "content_same": false
        },
        {
          "line": 305,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(j == 0)",
          "new_text": null,
          "old_line_content": "          assert(j == 0); // cannot break in the middle",
          "new_line_content": "        } else {",
          "content_same": false
        },
        {
          "line": 313,
          "old_api": "size",
          "new_api": null,
          "old_text": "stats->size()",
          "new_text": null,
          "old_line_content": "    while (i < stats->size()) {",
          "new_line_content": "    // look for other var definitions and collect them",
          "content_same": false
        },
        {
          "line": 317,
          "old_api": "dump",
          "new_api": null,
          "old_text": "dump(\"bad, seeing a var in need of fixing\", func)",
          "new_text": null,
          "old_line_content": "          dump(\"bad, seeing a var in need of fixing\", func);",
          "new_line_content": "        if (type == VAR) {",
          "content_same": false
        },
        {
          "line": 831,
          "old_api": "strlen",
          "new_api": null,
          "old_text": "strlen(init)",
          "new_text": null,
          "old_line_content": "    int size = strlen(init);",
          "new_line_content": "  StringSet(const char *init) { // comma-delimited list",
          "content_same": false
        },
        {
          "line": 835,
          "old_api": "strchr",
          "new_api": null,
          "old_text": "strchr(curr, ' ')",
          "new_text": null,
          "old_line_content": "      char *end = strchr(curr, ' ');",
          "new_line_content": "    while (1) {",
          "content_same": false
        },
        {
          "line": 324,
          "old_api": "size",
          "new_api": null,
          "old_text": "stats->size()",
          "new_text": null,
          "old_line_content": "    Ref retStmt = stats[stats->size() - 1];",
          "new_line_content": "    // look for final RETURN statement to get return type.",
          "content_same": false
        },
        {
          "line": 837,
          "old_api": "insert",
          "new_api": null,
          "old_text": "insert(curr)",
          "new_text": null,
          "old_line_content": "      insert(curr);",
          "new_line_content": "      if (end) *end = 0;",
          "content_same": false
        },
        {
          "line": 326,
          "old_api": "detectType",
          "new_api": null,
          "old_text": "detectType(retStmt[1])",
          "new_text": null,
          "old_line_content": "      ret = detectType(retStmt[1]);",
          "new_line_content": "    if (!!retStmt && retStmt[0] == RETURN && !!retStmt[1]) {",
          "content_same": false
        },
        {
          "line": 335,
          "old_api": "size",
          "new_api": null,
          "old_text": "stats->size()",
          "new_text": null,
          "old_line_content": "    for (int i = 0; i < stats->size(); i++) {",
          "new_line_content": "    // Remove var definitions, if any",
          "content_same": false
        },
        {
          "line": 337,
          "old_api": "makeEmpty",
          "new_api": null,
          "old_text": "makeEmpty()",
          "new_text": null,
          "old_line_content": "        stats[i] = makeEmpty();",
          "new_line_content": "      if (stats[i][0] == VAR) {",
          "content_same": false
        },
        {
          "line": 339,
          "old_api": "isEmpty",
          "new_api": null,
          "old_text": "isEmpty(stats[i])",
          "new_text": null,
          "old_line_content": "        if (!isEmpty(stats[i])) break;",
          "new_line_content": "      } else {",
          "content_same": false
        },
        {
          "line": 343,
          "old_api": "makeArray",
          "new_api": null,
          "old_text": "makeArray()",
          "new_text": null,
          "old_line_content": "    Ref varDefs = makeArray();",
          "new_line_content": "    // calculate variable definitions",
          "content_same": false
        },
        {
          "line": 345,
          "old_api": "makeAsmVarDef",
          "new_api": null,
          "old_text": "makeAsmVarDef(v, locals[v].type)",
          "new_text": null,
          "old_line_content": "      varDefs->push_back(makeAsmVarDef(v, locals[v].type));",
          "new_line_content": "    for (auto v : vars) {",
          "content_same": false
        },
        {
          "line": 858,
          "old_api": "strlen",
          "new_api": null,
          "old_text": "strlen(functionTable)",
          "new_text": null,
          "old_line_content": "  static unsigned size = strlen(functionTable);",
          "new_line_content": "  static const char *functionTable = \"FUNCTION_TABLE\";",
          "content_same": false
        },
        {
          "line": 348,
          "old_api": "size",
          "new_api": null,
          "old_text": "params.size()",
          "new_text": null,
          "old_line_content": "    int numParams = params.size();",
          "new_line_content": "    // each param needs a line; reuse emptyNodes as much as we can",
          "content_same": false
        },
        {
          "line": 350,
          "old_api": "size",
          "new_api": null,
          "old_text": "stats->size()",
          "new_text": null,
          "old_line_content": "    while (emptyNodes < stats->size()) {",
          "new_line_content": "    int emptyNodes = 0;",
          "content_same": false
        },
        {
          "line": 863,
          "old_api": "getCString",
          "new_api": null,
          "old_text": "value->getCString()",
          "new_text": null,
          "old_line_content": "  return value->isString() && isFunctionTable(value->getCString());",
          "new_line_content": "bool isFunctionTable(Ref value) {",
          "content_same": false
        },
        {
          "line": 354,
          "old_api": "size",
          "new_api": null,
          "old_text": "varDefs->size()",
          "new_text": null,
          "old_line_content": "    int neededEmptyNodes = numParams + (varDefs->size() ? 1 : 0); // params plus one big var if there are vars",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 356,
          "old_api": "insert",
          "new_api": null,
          "old_text": "stats->insert(0, neededEmptyNodes - emptyNodes)",
          "new_text": null,
          "old_line_content": "      stats->insert(0, neededEmptyNodes - emptyNodes);",
          "new_line_content": "    if (neededEmptyNodes > emptyNodes) {",
          "content_same": false
        },
        {
          "line": 358,
          "old_api": "splice",
          "new_api": null,
          "old_text": "stats->splice(0, emptyNodes - neededEmptyNodes)",
          "new_text": null,
          "old_line_content": "      stats->splice(0, emptyNodes - neededEmptyNodes);",
          "new_line_content": "    } else if (neededEmptyNodes < emptyNodes) {",
          "content_same": false
        },
        {
          "line": 362,
          "old_api": "getArray",
          "new_api": null,
          "old_text": "func[2]->getArray()",
          "new_text": null,
          "old_line_content": "    for (auto param : func[2]->getArray()) {",
          "new_line_content": "    int next = 0;",
          "content_same": false
        },
        {
          "line": 367,
          "old_api": "size",
          "new_api": null,
          "old_text": "varDefs->size()",
          "new_text": null,
          "old_line_content": "    if (varDefs->size()) {",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 382,
          "old_api": "size",
          "new_api": null,
          "old_text": "stats->size()",
          "new_text": null,
          "old_line_content": "      Ref retStmt = stats[stats->size() - 1];",
          "new_line_content": "    if (ret != ASM_NONE) {",
          "content_same": false
        },
        {
          "line": 384,
          "old_api": "makeNum",
          "new_api": null,
          "old_text": "makeNum(0)",
          "new_text": null,
          "old_line_content": "        Ref retVal = makeNum(0);",
          "new_line_content": "      if (!retStmt || retStmt[0] != RETURN) {",
          "content_same": false
        },
        {
          "line": 386,
          "old_api": "makeAsmCoercion",
          "new_api": null,
          "old_text": "makeAsmCoercion(retVal, ret)",
          "new_text": null,
          "old_line_content": "          retVal = makeAsmCoercion(retVal, ret);",
          "new_line_content": "        if (ret != ASM_INT) {",
          "content_same": false
        },
        {
          "line": 388,
          "old_api": "make1",
          "new_api": null,
          "old_text": "make1(RETURN, retVal)",
          "new_text": null,
          "old_line_content": "        stats->push_back(make1(RETURN, retVal));",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 905,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(node[0] == SUB)",
          "new_text": null,
          "old_line_content": "  assert(node[0] == SUB);",
          "new_line_content": "bool isTempDoublePtrAccess(Ref node) { // these are used in bitcasts; they are not really affecting memory, and should cause no invalidation",
          "content_same": false
        },
        {
          "line": 396,
          "old_api": "push_back",
          "new_api": null,
          "old_text": "vars.push_back(name)",
          "new_text": null,
          "old_line_content": "    vars.push_back(name);",
          "new_line_content": "    locals[name] = { type, false };",
          "content_same": false
        },
        {
          "line": 400,
          "old_api": "erase",
          "new_api": null,
          "old_text": "locals.erase(name)",
          "new_text": null,
          "old_line_content": "    locals.erase(name);",
          "new_line_content": "  void deleteVar(IString name) {",
          "content_same": false
        },
        {
          "line": 403,
          "old_api": "begin",
          "new_api": null,
          "old_text": "vars.begin()",
          "new_text": null,
          "old_line_content": "        vars.erase(vars.begin() + i);",
          "new_line_content": "      if (vars[i] == name) {",
          "content_same": false
        },
        {
          "line": 425,
          "old_api": "parseInt",
          "new_api": null,
          "old_text": "parseInt(name + (ret.unsign || ret.floaty ? 5 : 4))",
          "new_text": null,
          "old_line_content": "  ret.bits = parseInt(name + (ret.unsign || ret.floaty ? 5 : 4));",
          "new_line_content": "  ret.floaty = name[4] == 'F';",
          "content_same": false
        },
        {
          "line": 431,
          "old_api": "fmod",
          "new_api": null,
          "old_text": "fmod(x, 1)",
          "new_text": null,
          "old_line_content": "  return fmod(x, 1) == 0;",
          "new_line_content": "bool isInteger(double x) {",
          "content_same": false
        },
        {
          "line": 435,
          "old_api": "isInteger",
          "new_api": null,
          "old_text": "isInteger(x)",
          "new_text": null,
          "old_line_content": "  return isInteger(x) && (x == (int32_t)x || x == (uint32_t)x);",
          "new_line_content": "bool isInteger32(double x) {",
          "content_same": false
        },
        {
          "line": 441,
          "old_api": "getCString",
          "new_api": null,
          "old_text": "node[0]->getCString()",
          "new_text": null,
          "old_line_content": "  switch (node[0]->getCString()[0]) {",
          "new_line_content": "AsmType detectType(Ref node, AsmData *asmData, bool inVarDef) {",
          "content_same": false
        },
        {
          "line": 444,
          "old_api": "getNumber",
          "new_api": null,
          "old_text": "node[1]->getNumber()",
          "new_text": null,
          "old_line_content": "        if (!isInteger(node[1]->getNumber())) return ASM_DOUBLE;",
          "new_line_content": "      if (node[0] == NUM) {",
          "content_same": false
        },
        {
          "line": 448,
          "old_api": "getCString",
          "new_api": null,
          "old_text": "node[1]->getCString()",
          "new_text": null,
          "old_line_content": "          AsmType ret = asmData->getType(node[1]->getCString());",
          "new_line_content": "        if (asmData) {",
          "content_same": false
        },
        {
          "line": 457,
          "old_api": "getIString",
          "new_api": null,
          "old_text": "node[1]->getIString()",
          "new_text": null,
          "old_line_content": "        if (ASM_FLOAT_ZERO.isNull()) ASM_FLOAT_ZERO = node[1]->getIString();",
          "new_line_content": "        // We are in a variable definition, where Math_fround(0) optimized into a global constant becomes f0 = Math_fround(0)",
          "content_same": false
        },
        {
          "line": 465,
          "old_api": "getCString",
          "new_api": null,
          "old_text": "node[1]->getCString()",
          "new_text": null,
          "old_line_content": "        switch (node[1]->getCString()[0]) {",
          "new_line_content": "      if (node[0] == UNARY_PREFIX) {",
          "content_same": false
        },
        {
          "line": 467,
          "old_api": "detectType",
          "new_api": null,
          "old_text": "detectType(node[2], asmData, inVarDef)",
          "new_text": null,
          "old_line_content": "          case '-': return detectType(node[2], asmData, inVarDef);",
          "new_line_content": "          case '+': return ASM_DOUBLE;",
          "content_same": false
        },
        {
          "line": 477,
          "old_api": "getIString",
          "new_api": null,
          "old_text": "node[1][1]->getIString()",
          "new_text": null,
          "old_line_content": "          IString name = node[1][1]->getIString();",
          "new_line_content": "        if (node[1][0] == NAME) {",
          "content_same": false
        },
        {
          "line": 484,
          "old_api": "detectType",
          "new_api": null,
          "old_text": "detectType(node[2], asmData, inVarDef)",
          "new_text": null,
          "old_line_content": "        return detectType(node[2], asmData, inVarDef);",
          "new_line_content": "      } else if (node[0] == CONDITIONAL) {",
          "content_same": false
        },
        {
          "line": 490,
          "old_api": "getCString",
          "new_api": null,
          "old_text": "node[1]->getCString()",
          "new_text": null,
          "old_line_content": "        switch (node[1]->getCString()[0]) {",
          "new_line_content": "      if (node[0] == BINARY) {",
          "content_same": false
        },
        {
          "line": 492,
          "old_api": "detectType",
          "new_api": null,
          "old_text": "detectType(node[2], asmData, inVarDef)",
          "new_text": null,
          "old_line_content": "          case '*': case '/': case '%': return detectType(node[2], asmData, inVarDef);",
          "new_line_content": "          case '+': case '-':",
          "content_same": false
        },
        {
          "line": 503,
          "old_api": "detectType",
          "new_api": null,
          "old_text": "detectType(node[2], asmData, inVarDef)",
          "new_text": null,
          "old_line_content": "        return detectType(node[2], asmData, inVarDef);",
          "new_line_content": "      if (node[0] == SEQ) {",
          "content_same": false
        },
        {
          "line": 505,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(node[1][0] == NAME)",
          "new_text": null,
          "old_line_content": "        assert(node[1][0] == NAME);",
          "new_line_content": "      } else if (node[0] == SUB) {",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 51,
      "total_additions": 123,
      "total_deletions": 123,
      "total_api_changes": 297
    },
    "non_api_changes": {
      "has_non_api_changes": false,
      "evidence": {
        "total_diff_lines": 2,
        "api_related_lines": 297,
        "non_api_lines": 0,
        "non_api_line_numbers": []
      }
    },
    "api_calls_before": 284,
    "api_calls_after": 284,
    "diff_info": {
      "added_lines": 2,
      "removed_lines": 1,
      "total_diff_lines": 22
    }
  }
}