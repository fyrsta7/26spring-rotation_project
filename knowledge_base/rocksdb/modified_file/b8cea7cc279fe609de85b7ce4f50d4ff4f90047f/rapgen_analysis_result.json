{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/rocksdb/modified_file/b8cea7cc279fe609de85b7ce4f50d4ff4f90047f",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/rocksdb/modified_file/b8cea7cc279fe609de85b7ce4f50d4ff4f90047f/before.cc",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/rocksdb/modified_file/b8cea7cc279fe609de85b7ce4f50d4ff4f90047f/after.cc",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/rocksdb/modified_file/b8cea7cc279fe609de85b7ce4f50d4ff4f90047f/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 280,
          "old_api": "count",
          "new_api": "find",
          "old_text": "invalid_levels_[level].count(number)",
          "new_text": "invalid_levels_[level].find(number)",
          "old_line_content": "        if (invalid_levels_[level].count(number) > 0) {",
          "new_line_content": "        auto exising = invalid_levels_[level].find(number);",
          "content_same": false
        },
        {
          "line": 281,
          "old_api": "erase",
          "new_api": "end",
          "old_text": "invalid_levels_[level].erase(number)",
          "new_text": "invalid_levels_[level].end()",
          "old_line_content": "          invalid_levels_[level].erase(number);",
          "new_line_content": "        if (exising != invalid_levels_[level].end()) {",
          "content_same": false
        },
        {
          "line": 297,
          "old_api": "end",
          "new_api": "GetNumber",
          "old_text": "levels_[level].added_files.end()",
          "new_text": "f->fd.GetNumber()",
          "old_line_content": "               levels_[level].added_files.end());",
          "new_line_content": "        assert(levels_[level].added_files.find(f->fd.GetNumber()) ==",
          "content_same": false
        },
        {
          "line": 298,
          "old_api": "GetNumber",
          "new_api": "end",
          "old_text": "f->fd.GetNumber()",
          "new_text": "levels_[level].added_files.end()",
          "old_line_content": "        levels_[level].deleted_files.erase(f->fd.GetNumber());",
          "new_line_content": "               levels_[level].added_files.end());",
          "content_same": false
        },
        {
          "line": 302,
          "old_api": "count",
          "new_api": "GetNumber",
          "old_text": "invalid_levels_[level].count(number)",
          "new_text": "new_file.second.fd.GetNumber()",
          "old_line_content": "        if (invalid_levels_[level].count(number) == 0) {",
          "new_line_content": "        uint64_t number = new_file.second.fd.GetNumber();",
          "content_same": false
        },
        {
          "line": 303,
          "old_api": "insert",
          "new_api": "count",
          "old_text": "invalid_levels_[level].insert(number)",
          "new_text": "invalid_levels_[level].count(number)",
          "old_line_content": "          invalid_levels_[level].insert(number);",
          "new_line_content": "        if (invalid_levels_[level].count(number) == 0) {",
          "content_same": false
        },
        {
          "line": 322,
          "old_api": "begin",
          "new_api": "LevelFiles",
          "old_text": "base_files.begin()",
          "new_text": "base_vstorage_->LevelFiles(level)",
          "old_line_content": "      auto base_iter = base_files.begin();",
          "new_line_content": "      const auto& base_files = base_vstorage_->LevelFiles(level);",
          "content_same": false
        },
        {
          "line": 323,
          "old_api": "end",
          "new_api": "begin",
          "old_text": "base_files.end()",
          "new_text": "base_files.begin()",
          "old_line_content": "      auto base_end = base_files.end();",
          "new_line_content": "      auto base_iter = base_files.begin();",
          "content_same": false
        },
        {
          "line": 376,
          "old_api": "emplace_back",
          "new_api": "assert",
          "old_text": "files_meta.emplace_back(file_meta, level)",
          "new_text": "assert(!file_meta->table_reader_handle)",
          "old_line_content": "        files_meta.emplace_back(file_meta, level);",
          "new_line_content": "        assert(!file_meta->table_reader_handle);",
          "content_same": false
        },
        {
          "line": 384,
          "old_api": "size",
          "new_api": "fetch_add",
          "old_text": "files_meta.size()",
          "new_text": "next_file_meta_idx.fetch_add(1)",
          "old_line_content": "        if (file_idx >= files_meta.size()) {",
          "new_line_content": "        size_t file_idx = next_file_meta_idx.fetch_add(1);",
          "content_same": false
        },
        {
          "line": 391,
          "old_api": "InternalComparator",
          "new_api": "FindTable",
          "old_text": "base_vstorage_->InternalComparator()",
          "new_text": "table_cache_->FindTable(env_options_,\n                                *(base_vstorage_->InternalComparator()),\n                                file_meta->fd, &file_meta->table_reader_handle,\n                                false /*no_io */, true /* record_read_stats */,\n                                internal_stats->GetFileReadHist(level), false,\n                                level, prefetch_index_and_filter_in_cache)",
          "old_line_content": "                                *(base_vstorage_->InternalComparator()),",
          "new_line_content": "        table_cache_->FindTable(env_options_,",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 385,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "files_meta.size()",
          "old_line_content": "          break;",
          "new_line_content": "        if (file_idx >= files_meta.size()) {",
          "content_same": false
        },
        {
          "line": 392,
          "old_api": null,
          "new_api": "InternalComparator",
          "old_text": null,
          "new_text": "base_vstorage_->InternalComparator()",
          "old_line_content": "                                file_meta->fd, &file_meta->table_reader_handle,",
          "new_line_content": "                                *(base_vstorage_->InternalComparator()),",
          "content_same": false
        },
        {
          "line": 395,
          "old_api": null,
          "new_api": "GetFileReadHist",
          "old_text": null,
          "new_text": "internal_stats->GetFileReadHist(level)",
          "old_line_content": "                                level, prefetch_index_and_filter_in_cache);",
          "new_line_content": "                                internal_stats->GetFileReadHist(level), false,",
          "content_same": false
        },
        {
          "line": 399,
          "old_api": null,
          "new_api": "GetTableReaderFromHandle",
          "old_text": null,
          "new_text": "table_cache_->GetTableReaderFromHandle(\n              file_meta->table_reader_handle)",
          "old_line_content": "              file_meta->table_reader_handle);",
          "new_line_content": "          file_meta->fd.table_reader = table_cache_->GetTableReaderFromHandle(",
          "content_same": false
        },
        {
          "line": 406,
          "old_api": null,
          "new_api": "load_handlers_func",
          "old_text": null,
          "new_text": "load_handlers_func()",
          "old_line_content": "    } else {",
          "new_line_content": "      load_handlers_func();",
          "content_same": false
        },
        {
          "line": 282,
          "old_api": null,
          "new_api": "erase",
          "old_text": null,
          "new_text": "invalid_levels_[level].erase(exising)",
          "old_line_content": "        } else {",
          "new_line_content": "          invalid_levels_[level].erase(exising);",
          "content_same": false
        },
        {
          "line": 410,
          "old_api": null,
          "new_api": "emplace_back",
          "old_text": null,
          "new_text": "threads.emplace_back(load_handlers_func)",
          "old_line_content": "      }",
          "new_line_content": "        threads.emplace_back(load_handlers_func);",
          "content_same": false
        },
        {
          "line": 414,
          "old_api": null,
          "new_api": "join",
          "old_text": null,
          "new_text": "t.join()",
          "old_line_content": "      }",
          "new_line_content": "        t.join();",
          "content_same": false
        },
        {
          "line": 291,
          "old_api": null,
          "new_api": "GetNewFiles",
          "old_text": null,
          "new_text": "edit->GetNewFiles()",
          "old_line_content": "      const int level = new_file.first;",
          "new_line_content": "    for (const auto& new_file : edit->GetNewFiles()) {",
          "content_same": false
        },
        {
          "line": 420,
          "old_api": null,
          "new_api": "GetNumber",
          "old_text": null,
          "new_text": "f->fd.GetNumber()",
          "old_line_content": "      // f is to-be-delected table file",
          "new_line_content": "    if (levels_[level].deleted_files.count(f->fd.GetNumber()) > 0) {",
          "content_same": false
        },
        {
          "line": 422,
          "old_api": null,
          "new_api": "RemoveCurrentStats",
          "old_text": null,
          "new_text": "vstorage->RemoveCurrentStats(f)",
          "old_line_content": "    } else {",
          "new_line_content": "      vstorage->RemoveCurrentStats(f);",
          "content_same": false
        },
        {
          "line": 424,
          "old_api": null,
          "new_api": "AddFile",
          "old_text": null,
          "new_text": "vstorage->AddFile(level, f, info_log_)",
          "old_line_content": "    }",
          "new_line_content": "      vstorage->AddFile(level, f, info_log_);",
          "content_same": false
        },
        {
          "line": 300,
          "old_api": null,
          "new_api": "GetNumber",
          "old_text": null,
          "new_text": "f->fd.GetNumber()",
          "old_line_content": "      } else {",
          "new_line_content": "        levels_[level].added_files[f->fd.GetNumber()] = f;",
          "content_same": false
        },
        {
          "line": 304,
          "old_api": null,
          "new_api": "insert",
          "old_text": null,
          "new_text": "invalid_levels_[level].insert(number)",
          "old_line_content": "        } else {",
          "new_line_content": "          invalid_levels_[level].insert(number);",
          "content_same": false
        },
        {
          "line": 438,
          "old_api": null,
          "new_api": "CheckConsistency",
          "old_text": null,
          "new_text": "rep_->CheckConsistency(vstorage)",
          "old_line_content": "}",
          "new_line_content": "  rep_->CheckConsistency(vstorage);",
          "content_same": false
        },
        {
          "line": 443,
          "old_api": null,
          "new_api": "CheckConsistencyForDeletes",
          "old_text": null,
          "new_text": "rep_->CheckConsistencyForDeletes(edit, number, level)",
          "old_line_content": "}",
          "new_line_content": "  rep_->CheckConsistencyForDeletes(edit, number, level);",
          "content_same": false
        },
        {
          "line": 316,
          "old_api": null,
          "new_api": "CheckConsistency",
          "old_text": null,
          "new_text": "CheckConsistency(vstorage)",
          "old_line_content": "",
          "new_line_content": "    CheckConsistency(vstorage);",
          "content_same": false
        },
        {
          "line": 447,
          "old_api": null,
          "new_api": "CheckConsistencyForNumLevels",
          "old_text": null,
          "new_text": "rep_->CheckConsistencyForNumLevels()",
          "old_line_content": "}",
          "new_line_content": "  return rep_->CheckConsistencyForNumLevels();",
          "content_same": false
        },
        {
          "line": 450,
          "old_api": null,
          "new_api": "Apply",
          "old_text": null,
          "new_text": "rep_->Apply(edit)",
          "old_line_content": "",
          "new_line_content": "void VersionBuilder::Apply(VersionEdit* edit) { rep_->Apply(edit); }",
          "content_same": false
        },
        {
          "line": 324,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "base_files.end()",
          "old_line_content": "      const auto& unordered_added_files = levels_[level].added_files;",
          "new_line_content": "      auto base_end = base_files.end();",
          "content_same": false
        },
        {
          "line": 453,
          "old_api": null,
          "new_api": "SaveTo",
          "old_text": null,
          "new_text": "rep_->SaveTo(vstorage)",
          "old_line_content": "}",
          "new_line_content": "  rep_->SaveTo(vstorage);",
          "content_same": false
        },
        {
          "line": 327,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "unordered_added_files.size()",
          "old_line_content": "",
          "new_line_content": "                        base_files.size() + unordered_added_files.size());",
          "content_same": false
        },
        {
          "line": 331,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "unordered_added_files.size()",
          "old_line_content": "      for (const auto& pair : unordered_added_files) {",
          "new_line_content": "      added_files.reserve(unordered_added_files.size());",
          "content_same": false
        },
        {
          "line": 459,
          "old_api": null,
          "new_api": "LoadTableHandlers",
          "old_text": null,
          "new_text": "rep_->LoadTableHandlers(internal_stats, max_threads,\n                          prefetch_index_and_filter_in_cache)",
          "old_line_content": "                          prefetch_index_and_filter_in_cache);",
          "new_line_content": "  rep_->LoadTableHandlers(internal_stats, max_threads,",
          "content_same": false
        },
        {
          "line": 333,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "added_files.push_back(pair.second)",
          "old_line_content": "      }",
          "new_line_content": "        added_files.push_back(pair.second);",
          "content_same": false
        },
        {
          "line": 335,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "added_files.end()",
          "old_line_content": "",
          "new_line_content": "      std::sort(added_files.begin(), added_files.end(), cmp);",
          "content_same": false
        },
        {
          "line": 465,
          "old_api": null,
          "new_api": "MaybeAddFile",
          "old_text": null,
          "new_text": "rep_->MaybeAddFile(vstorage, level, f)",
          "old_line_content": "}",
          "new_line_content": "  rep_->MaybeAddFile(vstorage, level, f);",
          "content_same": false
        },
        {
          "line": 344,
          "old_api": null,
          "new_api": "InternalComparator",
          "old_text": null,
          "new_text": "base_vstorage_->InternalComparator()->Compare(\n                     prev_file->smallest, added->smallest)",
          "old_line_content": "                     prev_file->smallest, added->smallest) <= 0);",
          "new_line_content": "          assert(base_vstorage_->InternalComparator()->Compare(",
          "content_same": false
        },
        {
          "line": 351,
          "old_api": null,
          "new_api": "std::upper_bound(base_iter, base_end, added, cmp)",
          "old_text": null,
          "new_text": "std::upper_bound(base_iter, base_end, added, cmp)",
          "old_line_content": "             base_iter != bpos; ++base_iter) {",
          "new_line_content": "        for (auto bpos = std::upper_bound(base_iter, base_end, added, cmp);",
          "content_same": false
        },
        {
          "line": 353,
          "old_api": null,
          "new_api": "MaybeAddFile",
          "old_text": null,
          "new_text": "MaybeAddFile(vstorage, level, *base_iter)",
          "old_line_content": "        }",
          "new_line_content": "          MaybeAddFile(vstorage, level, *base_iter);",
          "content_same": false
        },
        {
          "line": 356,
          "old_api": null,
          "new_api": "MaybeAddFile",
          "old_text": null,
          "new_text": "MaybeAddFile(vstorage, level, added)",
          "old_line_content": "      }",
          "new_line_content": "        MaybeAddFile(vstorage, level, added);",
          "content_same": false
        },
        {
          "line": 361,
          "old_api": null,
          "new_api": "MaybeAddFile",
          "old_text": null,
          "new_text": "MaybeAddFile(vstorage, level, *base_iter)",
          "old_line_content": "      }",
          "new_line_content": "        MaybeAddFile(vstorage, level, *base_iter);",
          "content_same": false
        },
        {
          "line": 365,
          "old_api": null,
          "new_api": "CheckConsistency",
          "old_text": null,
          "new_text": "CheckConsistency(vstorage)",
          "old_line_content": "  }",
          "new_line_content": "    CheckConsistency(vstorage);",
          "content_same": false
        },
        {
          "line": 370,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(table_cache_ != nullptr)",
          "old_line_content": "    // <file metadata, level>",
          "new_line_content": "    assert(table_cache_ != nullptr);",
          "content_same": false
        },
        {
          "line": 377,
          "old_api": null,
          "new_api": "emplace_back",
          "old_text": null,
          "new_text": "files_meta.emplace_back(file_meta, level)",
          "old_line_content": "      }",
          "new_line_content": "        files_meta.emplace_back(file_meta, level);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 390,
          "old_api": "FindTable",
          "new_api": null,
          "old_text": "table_cache_->FindTable(env_options_,\n                                *(base_vstorage_->InternalComparator()),\n                                file_meta->fd, &file_meta->table_reader_handle,\n                                false /*no_io */, true /* record_read_stats */,\n                                internal_stats->GetFileReadHist(level), false,\n                                level, prefetch_index_and_filter_in_cache)",
          "new_text": null,
          "old_line_content": "        table_cache_->FindTable(env_options_,",
          "new_line_content": "        int level = files_meta[file_idx].second;",
          "content_same": false
        },
        {
          "line": 394,
          "old_api": "GetFileReadHist",
          "new_api": null,
          "old_text": "internal_stats->GetFileReadHist(level)",
          "new_text": null,
          "old_line_content": "                                internal_stats->GetFileReadHist(level), false,",
          "new_line_content": "                                false /*no_io */, true /* record_read_stats */,",
          "content_same": false
        },
        {
          "line": 398,
          "old_api": "GetTableReaderFromHandle",
          "new_api": null,
          "old_text": "table_cache_->GetTableReaderFromHandle(\n              file_meta->table_reader_handle)",
          "new_text": null,
          "old_line_content": "          file_meta->fd.table_reader = table_cache_->GetTableReaderFromHandle(",
          "new_line_content": "          // Load table_reader",
          "content_same": false
        },
        {
          "line": 405,
          "old_api": "load_handlers_func",
          "new_api": null,
          "old_text": "load_handlers_func()",
          "new_text": null,
          "old_line_content": "      load_handlers_func();",
          "new_line_content": "    if (max_threads <= 1) {",
          "content_same": false
        },
        {
          "line": 409,
          "old_api": "emplace_back",
          "new_api": null,
          "old_text": "threads.emplace_back(load_handlers_func)",
          "new_text": null,
          "old_line_content": "        threads.emplace_back(load_handlers_func);",
          "new_line_content": "      for (int i = 0; i < max_threads; i++) {",
          "content_same": false
        },
        {
          "line": 413,
          "old_api": "join",
          "new_api": null,
          "old_text": "t.join()",
          "new_text": null,
          "old_line_content": "        t.join();",
          "new_line_content": "      for (auto& t : threads) {",
          "content_same": false
        },
        {
          "line": 290,
          "old_api": "GetNewFiles",
          "new_api": null,
          "old_text": "edit->GetNewFiles()",
          "new_text": null,
          "old_line_content": "    for (const auto& new_file : edit->GetNewFiles()) {",
          "new_line_content": "    // Add new files",
          "content_same": false
        },
        {
          "line": 419,
          "old_api": "GetNumber",
          "new_api": null,
          "old_text": "f->fd.GetNumber()",
          "new_text": null,
          "old_line_content": "    if (levels_[level].deleted_files.count(f->fd.GetNumber()) > 0) {",
          "new_line_content": "  void MaybeAddFile(VersionStorageInfo* vstorage, int level, FileMetaData* f) {",
          "content_same": false
        },
        {
          "line": 421,
          "old_api": "RemoveCurrentStats",
          "new_api": null,
          "old_text": "vstorage->RemoveCurrentStats(f)",
          "new_text": null,
          "old_line_content": "      vstorage->RemoveCurrentStats(f);",
          "new_line_content": "      // f is to-be-delected table file",
          "content_same": false
        },
        {
          "line": 423,
          "old_api": "AddFile",
          "new_api": null,
          "old_text": "vstorage->AddFile(level, f, info_log_)",
          "new_text": null,
          "old_line_content": "      vstorage->AddFile(level, f, info_log_);",
          "new_line_content": "    } else {",
          "content_same": false
        },
        {
          "line": 296,
          "old_api": "GetNumber",
          "new_api": null,
          "old_text": "f->fd.GetNumber()",
          "new_text": null,
          "old_line_content": "        assert(levels_[level].added_files.find(f->fd.GetNumber()) ==",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 301,
          "old_api": "GetNumber",
          "new_api": null,
          "old_text": "new_file.second.fd.GetNumber()",
          "new_text": null,
          "old_line_content": "        uint64_t number = new_file.second.fd.GetNumber();",
          "new_line_content": "      } else {",
          "content_same": false
        },
        {
          "line": 437,
          "old_api": "CheckConsistency",
          "new_api": null,
          "old_text": "rep_->CheckConsistency(vstorage)",
          "new_text": null,
          "old_line_content": "  rep_->CheckConsistency(vstorage);",
          "new_line_content": "void VersionBuilder::CheckConsistency(VersionStorageInfo* vstorage) {",
          "content_same": false
        },
        {
          "line": 314,
          "old_api": "CheckConsistency",
          "new_api": null,
          "old_text": "CheckConsistency(base_vstorage_)",
          "new_text": null,
          "old_line_content": "    CheckConsistency(base_vstorage_);",
          "new_line_content": "  void SaveTo(VersionStorageInfo* vstorage) {",
          "content_same": false
        },
        {
          "line": 442,
          "old_api": "CheckConsistencyForDeletes",
          "new_api": null,
          "old_text": "rep_->CheckConsistencyForDeletes(edit, number, level)",
          "new_text": null,
          "old_line_content": "  rep_->CheckConsistencyForDeletes(edit, number, level);",
          "new_line_content": "                                                uint64_t number, int level) {",
          "content_same": false
        },
        {
          "line": 446,
          "old_api": "CheckConsistencyForNumLevels",
          "new_api": null,
          "old_text": "rep_->CheckConsistencyForNumLevels()",
          "new_text": null,
          "old_line_content": "  return rep_->CheckConsistencyForNumLevels();",
          "new_line_content": "bool VersionBuilder::CheckConsistencyForNumLevels() {",
          "content_same": false
        },
        {
          "line": 321,
          "old_api": "LevelFiles",
          "new_api": null,
          "old_text": "base_vstorage_->LevelFiles(level)",
          "new_text": null,
          "old_line_content": "      const auto& base_files = base_vstorage_->LevelFiles(level);",
          "new_line_content": "      // Drop any deleted files.  Store the result in *v.",
          "content_same": false
        },
        {
          "line": 449,
          "old_api": "Apply",
          "new_api": null,
          "old_text": "rep_->Apply(edit)",
          "new_text": null,
          "old_line_content": "void VersionBuilder::Apply(VersionEdit* edit) { rep_->Apply(edit); }",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 452,
          "old_api": "SaveTo",
          "new_api": null,
          "old_text": "rep_->SaveTo(vstorage)",
          "new_text": null,
          "old_line_content": "  rep_->SaveTo(vstorage);",
          "new_line_content": "void VersionBuilder::SaveTo(VersionStorageInfo* vstorage) {",
          "content_same": false
        },
        {
          "line": 325,
          "old_api": "size",
          "new_api": null,
          "old_text": "vstorage->Reserve(level,\n                        base_files.size() + unordered_added_files.size())",
          "new_text": null,
          "old_line_content": "      vstorage->Reserve(level,",
          "new_line_content": "      const auto& unordered_added_files = levels_[level].added_files;",
          "content_same": false
        },
        {
          "line": 330,
          "old_api": "size",
          "new_api": null,
          "old_text": "unordered_added_files.size()",
          "new_text": null,
          "old_line_content": "      added_files.reserve(unordered_added_files.size());",
          "new_line_content": "      std::vector<FileMetaData*> added_files;",
          "content_same": false
        },
        {
          "line": 458,
          "old_api": "LoadTableHandlers",
          "new_api": null,
          "old_text": "rep_->LoadTableHandlers(internal_stats, max_threads,\n                          prefetch_index_and_filter_in_cache)",
          "new_text": null,
          "old_line_content": "  rep_->LoadTableHandlers(internal_stats, max_threads,",
          "new_line_content": "    bool prefetch_index_and_filter_in_cache) {",
          "content_same": false
        },
        {
          "line": 332,
          "old_api": "push_back",
          "new_api": null,
          "old_text": "added_files.push_back(pair.second)",
          "new_text": null,
          "old_line_content": "        added_files.push_back(pair.second);",
          "new_line_content": "      for (const auto& pair : unordered_added_files) {",
          "content_same": false
        },
        {
          "line": 334,
          "old_api": "end",
          "new_api": null,
          "old_text": "added_files.end()",
          "new_text": null,
          "old_line_content": "      std::sort(added_files.begin(), added_files.end(), cmp);",
          "new_line_content": "      }",
          "content_same": false
        },
        {
          "line": 464,
          "old_api": "MaybeAddFile",
          "new_api": null,
          "old_text": "rep_->MaybeAddFile(vstorage, level, f)",
          "new_text": null,
          "old_line_content": "  rep_->MaybeAddFile(vstorage, level, f);",
          "new_line_content": "                                  FileMetaData* f) {",
          "content_same": false
        },
        {
          "line": 343,
          "old_api": "InternalComparator",
          "new_api": null,
          "old_text": "base_vstorage_->InternalComparator()->Compare(\n                     prev_file->smallest, added->smallest)",
          "new_text": null,
          "old_line_content": "          assert(base_vstorage_->InternalComparator()->Compare(",
          "new_line_content": "        if (level > 0 && prev_file != nullptr) {",
          "content_same": false
        },
        {
          "line": 350,
          "old_api": "std::upper_bound(base_iter, base_end, added, cmp)",
          "new_api": null,
          "old_text": "std::upper_bound(base_iter, base_end, added, cmp)",
          "new_text": null,
          "old_line_content": "        for (auto bpos = std::upper_bound(base_iter, base_end, added, cmp);",
          "new_line_content": "        // Add all smaller files listed in base_",
          "content_same": false
        },
        {
          "line": 352,
          "old_api": "MaybeAddFile",
          "new_api": null,
          "old_text": "MaybeAddFile(vstorage, level, *base_iter)",
          "new_text": null,
          "old_line_content": "          MaybeAddFile(vstorage, level, *base_iter);",
          "new_line_content": "             base_iter != bpos; ++base_iter) {",
          "content_same": false
        },
        {
          "line": 355,
          "old_api": "MaybeAddFile",
          "new_api": null,
          "old_text": "MaybeAddFile(vstorage, level, added)",
          "new_text": null,
          "old_line_content": "        MaybeAddFile(vstorage, level, added);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 360,
          "old_api": "MaybeAddFile",
          "new_api": null,
          "old_text": "MaybeAddFile(vstorage, level, *base_iter)",
          "new_text": null,
          "old_line_content": "        MaybeAddFile(vstorage, level, *base_iter);",
          "new_line_content": "      for (; base_iter != base_end; ++base_iter) {",
          "content_same": false
        },
        {
          "line": 364,
          "old_api": "CheckConsistency",
          "new_api": null,
          "old_text": "CheckConsistency(vstorage)",
          "new_text": null,
          "old_line_content": "    CheckConsistency(vstorage);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 369,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(table_cache_ != nullptr)",
          "new_text": null,
          "old_line_content": "    assert(table_cache_ != nullptr);",
          "new_line_content": "                         bool prefetch_index_and_filter_in_cache) {",
          "content_same": false
        },
        {
          "line": 375,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(!file_meta->table_reader_handle)",
          "new_text": null,
          "old_line_content": "        assert(!file_meta->table_reader_handle);",
          "new_line_content": "        auto* file_meta = file_meta_pair.second;",
          "content_same": false
        },
        {
          "line": 383,
          "old_api": "fetch_add",
          "new_api": null,
          "old_text": "next_file_meta_idx.fetch_add(1)",
          "new_text": null,
          "old_line_content": "        size_t file_idx = next_file_meta_idx.fetch_add(1);",
          "new_line_content": "      while (true) {",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 11,
      "total_additions": 35,
      "total_deletions": 34,
      "total_api_changes": 80
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 4,
        "api_related_lines": 80,
        "non_api_lines": 1,
        "non_api_line_numbers": [
          277
        ]
      }
    },
    "api_calls_before": 108,
    "api_calls_after": 109,
    "diff_info": {
      "added_lines": 4,
      "removed_lines": 3,
      "total_diff_lines": 21
    }
  }
}