{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/rocksdb/modified_file/22028aa9ab27cf860b74d12e006f82ff551caee0",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/rocksdb/modified_file/22028aa9ab27cf860b74d12e006f82ff551caee0/before.cc",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/rocksdb/modified_file/22028aa9ab27cf860b74d12e006f82ff551caee0/after.cc",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/rocksdb/modified_file/22028aa9ab27cf860b74d12e006f82ff551caee0/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 806,
          "old_api": "std::min(max_readahead_size_, readahead_size_ * 2)",
          "new_api": "ok",
          "old_text": "std::min(max_readahead_size_, readahead_size_ * 2)",
          "new_text": "s.ok()",
          "old_line_content": "      readahead_size_ = std::min(max_readahead_size_, readahead_size_ * 2);",
          "new_line_content": "      if (!s.ok()) {",
          "content_same": false
        },
        {
          "line": 860,
          "old_api": "size",
          "new_api": "ToString",
          "old_text": "input_slice.size()",
          "new_text": "input_slice.ToString()",
          "old_line_content": "        *has_data = (input_slice.size() == kBufferSize);",
          "new_line_content": "        iss->str(line + input_slice.ToString());",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 804,
          "old_api": null,
          "new_api": "Prefetch",
          "old_text": null,
          "new_text": "Prefetch(file_reader_, offset, n + readahead_size_, for_compaction)",
          "old_line_content": "        return false;",
          "new_line_content": "        s = Prefetch(file_reader_, offset, n + readahead_size_, for_compaction);",
          "content_same": false
        },
        {
          "line": 809,
          "old_api": null,
          "new_api": "std::min(max_readahead_size_, readahead_size_ * 2)",
          "old_text": null,
          "new_text": "std::min(max_readahead_size_, readahead_size_ * 2)",
          "old_line_content": "    }",
          "new_line_content": "      readahead_size_ = std::min(max_readahead_size_, readahead_size_ * 2);",
          "content_same": false
        },
        {
          "line": 844,
          "old_api": null,
          "new_api": "std::getline(*iss, line)",
          "old_text": null,
          "new_text": "std::getline(*iss, line)",
          "old_line_content": "      has_complete_line = false;",
          "new_line_content": "    if (std::getline(*iss, line)) {",
          "content_same": false
        },
        {
          "line": 845,
          "old_api": null,
          "new_api": "eof",
          "old_text": null,
          "new_text": "iss->eof()",
          "old_line_content": "    }",
          "new_line_content": "      has_complete_line = !iss->eof();",
          "content_same": false
        },
        {
          "line": 855,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "input_slice.size()",
          "old_line_content": "        break;",
          "new_line_content": "      if (input_slice.size() == 0) {",
          "content_same": false
        },
        {
          "line": 816,
          "old_api": null,
          "new_api": "BufferStart",
          "old_text": null,
          "new_text": "buffer_.BufferStart()",
          "old_line_content": "",
          "new_line_content": "  *result = Slice(buffer_.BufferStart() + offset_in_buffer, n);",
          "content_same": false
        },
        {
          "line": 862,
          "old_api": null,
          "new_api": "clear",
          "old_text": null,
          "new_text": "iss->clear()",
          "old_line_content": "      }",
          "new_line_content": "        iss->clear();",
          "content_same": false
        },
        {
          "line": 853,
          "old_api": null,
          "new_api": "Read",
          "old_text": null,
          "new_text": "seq_file->Read(kBufferSize, &input_slice, buffer)",
          "old_line_content": "        // meaning we have read all the data",
          "new_line_content": "        *result = seq_file->Read(kBufferSize, &input_slice, buffer);",
          "content_same": false
        },
        {
          "line": 863,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "input_slice.size()",
          "old_line_content": "    }",
          "new_line_content": "        *has_data = (input_slice.size() == kBufferSize);",
          "content_same": false
        },
        {
          "line": 823,
          "old_api": null,
          "new_api": "std::move(file)",
          "old_text": null,
          "new_text": "std::move(file)",
          "old_line_content": "",
          "new_line_content": "    new ReadaheadRandomAccessFile(std::move(file), readahead_size));",
          "content_same": false
        },
        {
          "line": 830,
          "old_api": null,
          "new_api": "NewWritableFile",
          "old_text": null,
          "new_text": "env->NewWritableFile(fname, result, options)",
          "old_line_content": "}",
          "new_line_content": "  Status s = env->NewWritableFile(fname, result, options);",
          "content_same": false
        },
        {
          "line": 831,
          "old_api": null,
          "new_api": "TEST_KILL_RANDOM",
          "old_text": null,
          "new_text": "TEST_KILL_RANDOM(\"NewWritableFile:0\", rocksdb_kill_odds * REDUCE_ODDS2)",
          "old_line_content": "",
          "new_line_content": "  TEST_KILL_RANDOM(\"NewWritableFile:0\", rocksdb_kill_odds * REDUCE_ODDS2);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 859,
          "old_api": "clear",
          "new_api": null,
          "old_text": "iss->clear()",
          "new_text": null,
          "old_line_content": "        iss->clear();",
          "new_line_content": "      } else {",
          "content_same": false
        },
        {
          "line": 803,
          "old_api": "ok",
          "new_api": null,
          "old_text": "s.ok()",
          "new_text": null,
          "old_line_content": "      if (!s.ok()) {",
          "new_line_content": "      } else {",
          "content_same": false
        },
        {
          "line": 841,
          "old_api": "std::getline(*iss, line)",
          "new_api": null,
          "old_text": "std::getline(*iss, line)",
          "new_text": null,
          "old_line_content": "    if (std::getline(*iss, line)) {",
          "new_line_content": "  std::string line;",
          "content_same": false
        },
        {
          "line": 842,
          "old_api": "eof",
          "new_api": null,
          "old_text": "iss->eof()",
          "new_text": null,
          "old_line_content": "      has_complete_line = !iss->eof();",
          "new_line_content": "  bool has_complete_line = false;",
          "content_same": false
        },
        {
          "line": 813,
          "old_api": "BufferStart",
          "new_api": null,
          "old_text": "buffer_.BufferStart()",
          "new_text": null,
          "old_line_content": "  *result = Slice(buffer_.BufferStart() + offset_in_buffer, n);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 850,
          "old_api": "Read",
          "new_api": null,
          "old_text": "seq_file->Read(kBufferSize, &input_slice, buffer)",
          "new_text": null,
          "old_line_content": "        *result = seq_file->Read(kBufferSize, &input_slice, buffer);",
          "new_line_content": "      // if we're not sure whether we have a complete line,",
          "content_same": false
        },
        {
          "line": 820,
          "old_api": "std::move(file)",
          "new_api": null,
          "old_text": "std::move(file)",
          "new_text": null,
          "old_line_content": "    new ReadaheadRandomAccessFile(std::move(file), readahead_size));",
          "new_line_content": "std::unique_ptr<RandomAccessFile> NewReadaheadRandomAccessFile(",
          "content_same": false
        },
        {
          "line": 852,
          "old_api": "size",
          "new_api": null,
          "old_text": "input_slice.size()",
          "new_text": null,
          "old_line_content": "      if (input_slice.size() == 0) {",
          "new_line_content": "      if (*has_data) {",
          "content_same": false
        },
        {
          "line": 857,
          "old_api": "ToString",
          "new_api": null,
          "old_text": "input_slice.ToString()",
          "new_text": null,
          "old_line_content": "        iss->str(line + input_slice.ToString());",
          "new_line_content": "        *has_data = false;",
          "content_same": false
        },
        {
          "line": 827,
          "old_api": "NewWritableFile",
          "new_api": null,
          "old_text": "env->NewWritableFile(fname, result, options)",
          "new_text": null,
          "old_line_content": "  Status s = env->NewWritableFile(fname, result, options);",
          "new_line_content": "Status NewWritableFile(Env* env, const std::string& fname,",
          "content_same": false
        },
        {
          "line": 828,
          "old_api": "TEST_KILL_RANDOM",
          "new_api": null,
          "old_text": "TEST_KILL_RANDOM(\"NewWritableFile:0\", rocksdb_kill_odds * REDUCE_ODDS2)",
          "new_text": null,
          "old_line_content": "  TEST_KILL_RANDOM(\"NewWritableFile:0\", rocksdb_kill_odds * REDUCE_ODDS2);",
          "new_line_content": "                       std::unique_ptr<WritableFile>* result,",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 2,
      "total_additions": 12,
      "total_deletions": 11,
      "total_api_changes": 25
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 6,
        "api_related_lines": 25,
        "non_api_lines": 4,
        "non_api_line_numbers": [
          800,
          801,
          802,
          805
        ]
      }
    },
    "api_calls_before": 334,
    "api_calls_after": 335,
    "diff_info": {
      "added_lines": 6,
      "removed_lines": 3,
      "total_diff_lines": 21
    }
  }
}