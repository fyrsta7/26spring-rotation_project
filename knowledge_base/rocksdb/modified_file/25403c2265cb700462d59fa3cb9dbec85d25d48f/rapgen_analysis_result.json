{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/rocksdb/modified_file/25403c2265cb700462d59fa3cb9dbec85d25d48f",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/rocksdb/modified_file/25403c2265cb700462d59fa3cb9dbec85d25d48f/before.cc",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/rocksdb/modified_file/25403c2265cb700462d59fa3cb9dbec85d25d48f/after.cc",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/rocksdb/modified_file/25403c2265cb700462d59fa3cb9dbec85d25d48f/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": true,
    "api_changes": {
      "replacements": [
        {
          "line": 276,
          "old_api": "static_cast<char>(num_probes_)",
          "new_api": "size",
          "old_text": "static_cast<char>(num_probes_)",
          "new_text": "dst->size()",
          "old_line_content": "    dst->push_back(static_cast<char>(num_probes_));  // Remember # of probes",
          "new_line_content": "    const size_t init_size = dst->size();",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 295,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "bloom_filter.size()",
          "old_line_content": "",
          "new_line_content": "    const size_t len = bloom_filter.size();",
          "content_same": false
        },
        {
          "line": 231,
          "old_api": null,
          "new_api": "PREFETCH",
          "old_text": null,
          "new_text": "PREFETCH(&data[b / 8], 0 /* rw */, 1 /* locality */)",
          "old_line_content": "",
          "new_line_content": "  PREFETCH(&data[b / 8], 0 /* rw */, 1 /* locality */);",
          "content_same": false
        },
        {
          "line": 232,
          "old_api": null,
          "new_api": "PREFETCH",
          "old_text": null,
          "new_text": "PREFETCH(&data[b / 8 + cache_line_size - 1], 0 /* rw */, 1 /* locality */)",
          "old_line_content": "  for (uint32_t i = 0; i < num_probes; ++i) {",
          "new_line_content": "  PREFETCH(&data[b / 8 + cache_line_size - 1], 0 /* rw */, 1 /* locality */);",
          "content_same": false
        },
        {
          "line": 298,
          "old_api": null,
          "new_api": "data",
          "old_text": null,
          "new_text": "bloom_filter.data()",
          "old_line_content": "",
          "new_line_content": "    const char* array = bloom_filter.data();",
          "content_same": false
        },
        {
          "line": 251,
          "old_api": null,
          "new_api": "explicit",
          "old_text": null,
          "new_text": "explicit",
          "old_line_content": "        use_block_based_builder_(use_block_based_builder) {",
          "new_line_content": "  explicit BloomFilterPolicy(int bits_per_key, bool use_block_based_builder)",
          "content_same": false
        },
        {
          "line": 277,
          "old_api": null,
          "new_api": "resize",
          "old_text": null,
          "new_text": "dst->resize(init_size + bytes, 0)",
          "old_line_content": "    char* array = &(*dst)[init_size];",
          "new_line_content": "    dst->resize(init_size + bytes, 0);",
          "content_same": false
        },
        {
          "line": 278,
          "old_api": null,
          "new_api": "static_cast<char>(num_probes_)",
          "old_text": null,
          "new_text": "static_cast<char>(num_probes_)",
          "old_line_content": "    for (size_t i = 0; i < (size_t)n; i++) {",
          "new_line_content": "    dst->push_back(static_cast<char>(num_probes_));  // Remember # of probes",
          "content_same": false
        },
        {
          "line": 310,
          "old_api": null,
          "new_api": "hash_func_",
          "old_text": null,
          "new_text": "hash_func_(key)",
          "old_line_content": "    for (size_t j = 0; j < k; j++) {",
          "new_line_content": "    uint32_t h = hash_func_(key);",
          "content_same": false
        },
        {
          "line": 345,
          "old_api": null,
          "new_api": "static_cast<size_t>(bits_per_key_ * 0.69)",
          "old_text": null,
          "new_text": "static_cast<size_t>(bits_per_key_ * 0.69)",
          "old_line_content": "    if (num_probes_ > 30) num_probes_ = 30;",
          "new_line_content": "    num_probes_ = static_cast<size_t>(bits_per_key_ * 0.69);  // 0.69 =~ ln(2)",
          "content_same": false
        },
        {
          "line": 283,
          "old_api": null,
          "new_api": "hash_func_",
          "old_text": null,
          "new_text": "hash_func_(keys[i])",
          "old_line_content": "      for (size_t j = 0; j < num_probes_; j++) {",
          "new_line_content": "      uint32_t h = hash_func_(keys[i]);",
          "content_same": false
        },
        {
          "line": 254,
          "old_api": null,
          "new_api": "initialize",
          "old_text": null,
          "new_text": "initialize()",
          "old_line_content": "",
          "new_line_content": "    initialize();",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 293,
          "old_api": "size",
          "new_api": null,
          "old_text": "bloom_filter.size()",
          "new_text": null,
          "old_line_content": "    const size_t len = bloom_filter.size();",
          "new_line_content": "  virtual bool KeyMayMatch(const Slice& key,",
          "content_same": false
        },
        {
          "line": 249,
          "old_api": "explicit",
          "new_api": null,
          "old_text": "explicit",
          "new_text": null,
          "old_line_content": "  explicit BloomFilterPolicy(int bits_per_key, bool use_block_based_builder)",
          "new_line_content": "class BloomFilterPolicy : public FilterPolicy {",
          "content_same": false
        },
        {
          "line": 296,
          "old_api": "data",
          "new_api": null,
          "old_text": "bloom_filter.data()",
          "new_text": null,
          "old_line_content": "    const char* array = bloom_filter.data();",
          "new_line_content": "    if (len < 2) return false;",
          "content_same": false
        },
        {
          "line": 274,
          "old_api": "size",
          "new_api": null,
          "old_text": "dst->size()",
          "new_text": null,
          "old_line_content": "    const size_t init_size = dst->size();",
          "new_line_content": "    bits = bytes * 8;",
          "content_same": false
        },
        {
          "line": 275,
          "old_api": "resize",
          "new_api": null,
          "old_text": "dst->resize(init_size + bytes, 0)",
          "new_text": null,
          "old_line_content": "    dst->resize(init_size + bytes, 0);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 308,
          "old_api": "hash_func_",
          "new_api": null,
          "old_text": "hash_func_(key)",
          "new_text": null,
          "old_line_content": "    uint32_t h = hash_func_(key);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 343,
          "old_api": "static_cast<size_t>(bits_per_key_ * 0.69)",
          "new_api": null,
          "old_text": "static_cast<size_t>(bits_per_key_ * 0.69)",
          "new_text": null,
          "old_line_content": "    num_probes_ = static_cast<size_t>(bits_per_key_ * 0.69);  // 0.69 =~ ln(2)",
          "new_line_content": "  void initialize() {",
          "content_same": false
        },
        {
          "line": 281,
          "old_api": "hash_func_",
          "new_api": null,
          "old_text": "hash_func_(keys[i])",
          "new_text": null,
          "old_line_content": "      uint32_t h = hash_func_(keys[i]);",
          "new_line_content": "      // Use double-hashing to generate a sequence of hash values.",
          "content_same": false
        },
        {
          "line": 252,
          "old_api": "initialize",
          "new_api": null,
          "old_text": "initialize()",
          "new_text": null,
          "old_line_content": "    initialize();",
          "new_line_content": "      : bits_per_key_(bits_per_key), hash_func_(BloomHash),",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 1,
      "total_additions": 11,
      "total_deletions": 9,
      "total_api_changes": 21
    },
    "non_api_changes": {
      "has_non_api_changes": false,
      "evidence": {
        "total_diff_lines": 2,
        "api_related_lines": 21,
        "non_api_lines": 0,
        "non_api_line_numbers": []
      }
    },
    "api_calls_before": 58,
    "api_calls_after": 60,
    "diff_info": {
      "added_lines": 2,
      "removed_lines": 0,
      "total_diff_lines": 14
    }
  }
}