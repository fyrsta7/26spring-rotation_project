{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/rocksdb/modified_file/536e9973e30d70fd510e5ab6e423ef75248ed582",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/rocksdb/modified_file/536e9973e30d70fd510e5ab6e423ef75248ed582/before.cc",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/rocksdb/modified_file/536e9973e30d70fd510e5ab6e423ef75248ed582/after.cc",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/rocksdb/modified_file/536e9973e30d70fd510e5ab6e423ef75248ed582/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": true,
    "api_changes": {
      "replacements": [
        {
          "line": 111,
          "old_api": "assert",
          "new_api": "push_back",
          "old_text": "assert(!immutable_)",
          "new_text": "bucket_->push_back(key)",
          "old_line_content": "  assert(!immutable_);",
          "new_line_content": "  bucket_->push_back(key);",
          "content_same": false
        },
        {
          "line": 156,
          "old_api": "Compare",
          "new_api": "begin",
          "old_text": "Compare(compare_)",
          "new_text": "bucket_->begin()",
          "old_line_content": "      std::sort(bucket_->begin(), bucket_->end(), Compare(compare_));",
          "new_line_content": "      cit_ = bucket_->begin();",
          "content_same": false
        },
        {
          "line": 163,
          "old_api": "Compare",
          "new_api": "begin",
          "old_text": "Compare(compare_)",
          "new_text": "bucket_->begin()",
          "old_line_content": "    std::sort(bucket_->begin(), bucket_->end(), Compare(compare_));",
          "new_line_content": "    cit_ = bucket_->begin();",
          "content_same": false
        },
        {
          "line": 173,
          "old_api": "DoSort",
          "new_api": "end",
          "old_text": "DoSort()",
          "new_text": "bucket_->end()",
          "old_line_content": "  DoSort();",
          "new_line_content": "  return cit_ != bucket_->end();",
          "content_same": false
        },
        {
          "line": 187,
          "old_api": "Valid",
          "new_api": "end",
          "old_text": "Valid()",
          "new_text": "bucket_->end()",
          "old_line_content": "  assert(Valid());",
          "new_line_content": "  if (cit_ == bucket_->end()) {",
          "content_same": false
        },
        {
          "line": 197,
          "old_api": "Valid",
          "new_api": "begin",
          "old_text": "Valid()",
          "new_text": "bucket_->begin()",
          "old_line_content": "  assert(Valid());",
          "new_line_content": "  if (cit_ == bucket_->begin()) {",
          "content_same": false
        },
        {
          "line": 214,
          "old_api": "EncodeKey",
          "new_api": "begin",
          "old_text": "EncodeKey(&tmp_, user_key)",
          "new_text": "bucket_->begin()",
          "old_line_content": "      (memtable_key != nullptr) ? memtable_key : EncodeKey(&tmp_, user_key);",
          "new_line_content": "  cit_ = std::equal_range(bucket_->begin(),",
          "content_same": false
        },
        {
          "line": 215,
          "old_api": "begin",
          "new_api": "end",
          "old_text": "bucket_->begin()",
          "new_text": "bucket_->end()",
          "old_line_content": "  cit_ = std::equal_range(bucket_->begin(),",
          "new_line_content": "                          bucket_->end(),",
          "content_same": false
        },
        {
          "line": 226,
          "old_api": "DoSort",
          "new_api": "begin",
          "old_text": "DoSort()",
          "new_text": "bucket_->begin()",
          "old_line_content": "  DoSort();",
          "new_line_content": "  cit_ = bucket_->begin();",
          "content_same": false
        },
        {
          "line": 233,
          "old_api": "DoSort",
          "new_api": "end",
          "old_text": "DoSort()",
          "new_text": "bucket_->end()",
          "old_line_content": "  DoSort();",
          "new_line_content": "  cit_ = bucket_->end();",
          "content_same": false
        },
        {
          "line": 234,
          "old_api": "end",
          "new_api": "size",
          "old_text": "bucket_->end()",
          "new_text": "bucket_->size()",
          "old_line_content": "  cit_ = bucket_->end();",
          "new_line_content": "  if (bucket_->size() != 0) {",
          "content_same": false
        },
        {
          "line": 254,
          "old_api": "memtable_key",
          "new_api": "Next",
          "old_text": "k.memtable_key().data()",
          "new_text": "iter.Next()",
          "old_line_content": "  for (iter.Seek(k.user_key(), k.memtable_key().data());",
          "new_line_content": "       iter.Valid() && callback_func(callback_args, iter.key()); iter.Next()) {",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 128,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "bucket_->size()",
          "old_line_content": "    sizeof(bucket_) + sizeof(*bucket_) +",
          "new_line_content": "    bucket_->size() *",
          "content_same": false
        },
        {
          "line": 261,
          "old_api": null,
          "new_api": "AllocateAligned",
          "old_text": null,
          "new_text": "arena->AllocateAligned(sizeof(Iterator))",
          "old_line_content": "  if (arena != nullptr) {",
          "new_line_content": "    mem = arena->AllocateAligned(sizeof(Iterator));",
          "content_same": false
        },
        {
          "line": 139,
          "old_api": null,
          "new_api": "get",
          "old_text": null,
          "new_text": "bucket_.get()->reserve(count)",
          "old_line_content": "    sorted_(false),",
          "new_line_content": "    compare_(compare) { bucket_.get()->reserve(count); }",
          "content_same": false
        },
        {
          "line": 274,
          "old_api": null,
          "new_api": "reset",
          "old_text": null,
          "new_text": "tmp.reset(new Bucket(*bucket_))",
          "old_line_content": "    std::shared_ptr<Bucket> tmp;",
          "new_line_content": "    tmp.reset(new Bucket(*bucket_)); // make a copy",
          "content_same": false
        },
        {
          "line": 146,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "bucket_->end()",
          "old_line_content": "  bucket_(bucket),",
          "new_line_content": "  cit_(bucket_->end()),",
          "content_same": false
        },
        {
          "line": 155,
          "old_api": null,
          "new_api": "Compare",
          "old_text": null,
          "new_text": "Compare(compare_)",
          "old_line_content": "    if (!vrep_->sorted_) {",
          "new_line_content": "      std::sort(bucket_->begin(), bucket_->end(), Compare(compare_));",
          "content_same": false
        },
        {
          "line": 162,
          "old_api": null,
          "new_api": "Compare",
          "old_text": null,
          "new_text": "Compare(compare_)",
          "old_line_content": "  if (!sorted_) {",
          "new_line_content": "    std::sort(bucket_->begin(), bucket_->end(), Compare(compare_));",
          "content_same": false
        },
        {
          "line": 166,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(sorted_)",
          "old_line_content": "  }",
          "new_line_content": "  assert(sorted_);",
          "content_same": false
        },
        {
          "line": 172,
          "old_api": null,
          "new_api": "DoSort",
          "old_text": null,
          "new_text": "DoSort()",
          "old_line_content": "bool VectorRep::Iterator::Valid() const {",
          "new_line_content": "  DoSort();",
          "content_same": false
        },
        {
          "line": 179,
          "old_api": null,
          "new_api": "Valid",
          "old_text": null,
          "new_text": "Valid()",
          "old_line_content": "const char* VectorRep::Iterator::key() const {",
          "new_line_content": "  assert(Valid());",
          "content_same": false
        },
        {
          "line": 186,
          "old_api": null,
          "new_api": "Valid",
          "old_text": null,
          "new_text": "Valid()",
          "old_line_content": "void VectorRep::Iterator::Next() {",
          "new_line_content": "  assert(Valid());",
          "content_same": false
        },
        {
          "line": 196,
          "old_api": null,
          "new_api": "Valid",
          "old_text": null,
          "new_text": "Valid()",
          "old_line_content": "void VectorRep::Iterator::Prev() {",
          "new_line_content": "  assert(Valid());",
          "content_same": false
        },
        {
          "line": 201,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "bucket_->end()",
          "old_line_content": "    // treat the container circularly.",
          "new_line_content": "    cit_ = bucket_->end();",
          "content_same": false
        },
        {
          "line": 210,
          "old_api": null,
          "new_api": "DoSort",
          "old_text": null,
          "new_text": "DoSort()",
          "old_line_content": "                               const char* memtable_key) {",
          "new_line_content": "  DoSort();",
          "content_same": false
        },
        {
          "line": 213,
          "old_api": null,
          "new_api": "EncodeKey",
          "old_text": null,
          "new_text": "EncodeKey(&tmp_, user_key)",
          "old_line_content": "  const char* encoded_key =",
          "new_line_content": "      (memtable_key != nullptr) ? memtable_key : EncodeKey(&tmp_, user_key);",
          "content_same": false
        },
        {
          "line": 218,
          "old_api": null,
          "new_api": "compare_",
          "old_text": null,
          "new_text": "compare_(a, b)",
          "old_line_content": "                          [this] (const char* a, const char* b) {",
          "new_line_content": "                            return compare_(a, b) < 0;",
          "content_same": false
        },
        {
          "line": 225,
          "old_api": null,
          "new_api": "DoSort",
          "old_text": null,
          "new_text": "DoSort()",
          "old_line_content": "void VectorRep::Iterator::SeekToFirst() {",
          "new_line_content": "  DoSort();",
          "content_same": false
        },
        {
          "line": 232,
          "old_api": null,
          "new_api": "DoSort",
          "old_text": null,
          "new_text": "DoSort()",
          "old_line_content": "void VectorRep::Iterator::SeekToLast() {",
          "new_line_content": "  DoSort();",
          "content_same": false
        },
        {
          "line": 110,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(!immutable_)",
          "old_line_content": "  WriteLock l(&rwlock_);",
          "new_line_content": "  assert(!immutable_);",
          "content_same": false
        },
        {
          "line": 241,
          "old_api": null,
          "new_api": "ReadLock",
          "old_text": null,
          "new_text": "rwlock_.ReadLock()",
          "old_line_content": "                    bool (*callback_func)(void* arg, const char* entry)) {",
          "new_line_content": "  rwlock_.ReadLock();",
          "content_same": false
        },
        {
          "line": 117,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "bucket_->end()",
          "old_line_content": "  ReadLock l(&rwlock_);",
          "new_line_content": "  return std::find(bucket_->begin(), bucket_->end(), key) != bucket_->end();",
          "content_same": false
        },
        {
          "line": 248,
          "old_api": null,
          "new_api": "reset",
          "old_text": null,
          "new_text": "bucket.reset(new Bucket(*bucket_))",
          "old_line_content": "    vector_rep = nullptr;",
          "new_line_content": "    bucket.reset(new Bucket(*bucket_));  // make a copy",
          "content_same": false
        },
        {
          "line": 251,
          "old_api": null,
          "new_api": "ReadUnlock",
          "old_text": null,
          "new_text": "rwlock_.ReadUnlock()",
          "old_line_content": "  VectorRep::Iterator iter(vector_rep, immutable_ ? bucket_ : bucket, compare_);",
          "new_line_content": "  rwlock_.ReadUnlock();",
          "content_same": false
        },
        {
          "line": 253,
          "old_api": null,
          "new_api": "memtable_key",
          "old_text": null,
          "new_text": "k.memtable_key().data()",
          "old_line_content": "",
          "new_line_content": "  for (iter.Seek(k.user_key(), k.memtable_key().data());",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 129,
          "old_api": "size",
          "new_api": null,
          "old_text": "bucket_->size()",
          "new_text": null,
          "old_line_content": "    bucket_->size() *",
          "new_line_content": "    sizeof(",
          "content_same": false
        },
        {
          "line": 262,
          "old_api": "AllocateAligned",
          "new_api": null,
          "old_text": "arena->AllocateAligned(sizeof(Iterator))",
          "new_text": null,
          "old_line_content": "    mem = arena->AllocateAligned(sizeof(Iterator));",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 140,
          "old_api": "get",
          "new_api": null,
          "old_text": "bucket_.get()->reserve(count)",
          "new_text": null,
          "old_line_content": "    compare_(compare) { bucket_.get()->reserve(count); }",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 275,
          "old_api": "reset",
          "new_api": null,
          "old_text": "tmp.reset(new Bucket(*bucket_))",
          "new_text": null,
          "old_line_content": "    tmp.reset(new Bucket(*bucket_)); // make a copy",
          "new_line_content": "    if (arena == nullptr) {",
          "content_same": false
        },
        {
          "line": 147,
          "old_api": "end",
          "new_api": null,
          "old_text": "bucket_->end()",
          "new_text": null,
          "old_line_content": "  cit_(bucket_->end()),",
          "new_line_content": "  compare_(compare),",
          "content_same": false
        },
        {
          "line": 157,
          "old_api": "begin",
          "new_api": null,
          "old_text": "bucket_->begin()",
          "new_text": null,
          "old_line_content": "      cit_ = bucket_->begin();",
          "new_line_content": "      vrep_->sorted_ = true;",
          "content_same": false
        },
        {
          "line": 164,
          "old_api": "begin",
          "new_api": null,
          "old_text": "bucket_->begin()",
          "new_text": null,
          "old_line_content": "    cit_ = bucket_->begin();",
          "new_line_content": "    sorted_ = true;",
          "content_same": false
        },
        {
          "line": 168,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(vrep_ == nullptr || vrep_->sorted_)",
          "new_text": null,
          "old_line_content": "  assert(vrep_ == nullptr || vrep_->sorted_);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 174,
          "old_api": "end",
          "new_api": null,
          "old_text": "bucket_->end()",
          "new_text": null,
          "old_line_content": "  return cit_ != bucket_->end();",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 180,
          "old_api": "Valid",
          "new_api": null,
          "old_text": "Valid()",
          "new_text": null,
          "old_line_content": "  assert(Valid());",
          "new_line_content": "  return *cit_;",
          "content_same": false
        },
        {
          "line": 188,
          "old_api": "end",
          "new_api": null,
          "old_text": "bucket_->end()",
          "new_text": null,
          "old_line_content": "  if (cit_ == bucket_->end()) {",
          "new_line_content": "    return;",
          "content_same": false
        },
        {
          "line": 198,
          "old_api": "begin",
          "new_api": null,
          "old_text": "bucket_->begin()",
          "new_text": null,
          "old_line_content": "  if (cit_ == bucket_->begin()) {",
          "new_line_content": "    // If you try to go back from the first element, the iterator should be",
          "content_same": false
        },
        {
          "line": 202,
          "old_api": "end",
          "new_api": null,
          "old_text": "bucket_->end()",
          "new_text": null,
          "old_line_content": "    cit_ = bucket_->end();",
          "new_line_content": "  } else {",
          "content_same": false
        },
        {
          "line": 211,
          "old_api": "DoSort",
          "new_api": null,
          "old_text": "DoSort()",
          "new_text": null,
          "old_line_content": "  DoSort();",
          "new_line_content": "  // Do binary search to find first value not less than the target",
          "content_same": false
        },
        {
          "line": 216,
          "old_api": "end",
          "new_api": null,
          "old_text": "bucket_->end()",
          "new_text": null,
          "old_line_content": "                          bucket_->end(),",
          "new_line_content": "                          encoded_key,",
          "content_same": false
        },
        {
          "line": 219,
          "old_api": "compare_",
          "new_api": null,
          "old_text": "compare_(a, b)",
          "new_text": null,
          "old_line_content": "                            return compare_(a, b) < 0;",
          "new_line_content": "                          }).first;",
          "content_same": false
        },
        {
          "line": 227,
          "old_api": "begin",
          "new_api": null,
          "old_text": "bucket_->begin()",
          "new_text": null,
          "old_line_content": "  cit_ = bucket_->begin();",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 235,
          "old_api": "size",
          "new_api": null,
          "old_text": "bucket_->size()",
          "new_text": null,
          "old_line_content": "  if (bucket_->size() != 0) {",
          "new_line_content": "    --cit_;",
          "content_same": false
        },
        {
          "line": 109,
          "old_api": "Contains",
          "new_api": null,
          "old_text": "Contains(key)",
          "new_text": null,
          "old_line_content": "  assert(!Contains(key));",
          "new_line_content": "  WriteLock l(&rwlock_);",
          "content_same": false
        },
        {
          "line": 112,
          "old_api": "push_back",
          "new_api": null,
          "old_text": "bucket_->push_back(key)",
          "new_text": null,
          "old_line_content": "  bucket_->push_back(key);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 242,
          "old_api": "ReadLock",
          "new_api": null,
          "old_text": "rwlock_.ReadLock()",
          "new_text": null,
          "old_line_content": "  rwlock_.ReadLock();",
          "new_line_content": "  VectorRep* vector_rep;",
          "content_same": false
        },
        {
          "line": 118,
          "old_api": "end",
          "new_api": null,
          "old_text": "bucket_->end()",
          "new_text": null,
          "old_line_content": "  return std::find(bucket_->begin(), bucket_->end(), key) != bucket_->end();",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 249,
          "old_api": "reset",
          "new_api": null,
          "old_text": "bucket.reset(new Bucket(*bucket_))",
          "new_text": null,
          "old_line_content": "    bucket.reset(new Bucket(*bucket_));  // make a copy",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 252,
          "old_api": "ReadUnlock",
          "new_api": null,
          "old_text": "rwlock_.ReadUnlock()",
          "new_text": null,
          "old_line_content": "  rwlock_.ReadUnlock();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 255,
          "old_api": "Next",
          "new_api": null,
          "old_text": "iter.Next()",
          "new_text": null,
          "old_line_content": "       iter.Valid() && callback_func(callback_args, iter.key()); iter.Next()) {",
          "new_line_content": "  }",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 12,
      "total_additions": 24,
      "total_deletions": 25,
      "total_api_changes": 61
    },
    "non_api_changes": {
      "has_non_api_changes": false,
      "evidence": {
        "total_diff_lines": 1,
        "api_related_lines": 61,
        "non_api_lines": 0,
        "non_api_line_numbers": []
      }
    },
    "api_calls_before": 60,
    "api_calls_after": 58,
    "diff_info": {
      "added_lines": 0,
      "removed_lines": 1,
      "total_diff_lines": 13
    }
  }
}