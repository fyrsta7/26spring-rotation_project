{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/rocksdb/modified_file/d8df169b8498609eda28c0d6c2d91588b0aa925b",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/rocksdb/modified_file/d8df169b8498609eda28c0d6c2d91588b0aa925b/before.cc",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/rocksdb/modified_file/d8df169b8498609eda28c0d6c2d91588b0aa925b/after.cc",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/rocksdb/modified_file/d8df169b8498609eda28c0d6c2d91588b0aa925b/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 531,
          "old_api": "storage_info",
          "new_api": "Unlock",
          "old_text": "v->storage_info()->base_level()",
          "new_text": "db_mutex_->Unlock()",
          "old_line_content": "  int base_level = v->storage_info()->base_level();",
          "new_line_content": "    db_mutex_->Unlock();",
          "content_same": false
        },
        {
          "line": 532,
          "old_api": "mutable_cf_options",
          "new_api": "ApproximateSize",
          "old_text": "std::ceil(\n      sum / min_file_fill_percent /\n      MaxFileSizeForLevel(*(c->mutable_cf_options()), out_lvl,\n          c->immutable_cf_options()->compaction_style, base_level,\n          c->immutable_cf_options()->level_compaction_dynamic_level_bytes))",
          "new_text": "versions_->ApproximateSize(v, a, b, start_lvl, out_lvl + 1)",
          "old_line_content": "  uint64_t max_output_files = static_cast<uint64_t>(std::ceil(",
          "new_line_content": "    uint64_t size = versions_->ApproximateSize(v, a, b, start_lvl, out_lvl + 1);",
          "content_same": false
        },
        {
          "line": 534,
          "old_api": "mutable_cf_options",
          "new_api": "emplace_back",
          "old_text": "c->mutable_cf_options()",
          "new_text": "ranges.emplace_back(a, b, size)",
          "old_line_content": "      MaxFileSizeForLevel(*(c->mutable_cf_options()), out_lvl,",
          "new_line_content": "    ranges.emplace_back(a, b, size);",
          "content_same": false
        },
        {
          "line": 556,
          "old_api": "emplace_back",
          "new_api": "size",
          "old_text": "sizes_.emplace_back(sum)",
          "new_text": "ranges.size()",
          "old_line_content": "        sizes_.emplace_back(sum);",
          "new_line_content": "    for (size_t i = 0; i < ranges.size() - 1; i++) {",
          "content_same": false
        },
        {
          "line": 564,
          "old_api": "emplace_back",
          "new_api": "ExtractUserKey",
          "old_text": "sizes_.emplace_back(sum)",
          "new_text": "ExtractUserKey(ranges[i].range.limit)",
          "old_line_content": "    sizes_.emplace_back(sum);",
          "new_line_content": "        boundaries_.emplace_back(ExtractUserKey(ranges[i].range.limit));",
          "content_same": false
        },
        {
          "line": 573,
          "old_api": "LogCompaction",
          "new_api": "emplace_back",
          "old_text": "LogCompaction()",
          "new_text": "sizes_.emplace_back(sum)",
          "old_line_content": "  LogCompaction();",
          "new_line_content": "    sizes_.emplace_back(sum);",
          "content_same": false
        },
        {
          "line": 581,
          "old_api": "reserve",
          "new_api": "FlushBufferToLog",
          "old_text": "thread_pool.reserve(num_threads - 1)",
          "new_text": "log_buffer_->FlushBufferToLog()",
          "old_line_content": "  thread_pool.reserve(num_threads - 1);",
          "new_line_content": "  log_buffer_->FlushBufferToLog();",
          "content_same": false
        },
        {
          "line": 582,
          "old_api": "size",
          "new_api": "LogCompaction",
          "old_text": "compact_->sub_compact_states.size()",
          "new_text": "LogCompaction()",
          "old_line_content": "  for (size_t i = 1; i < compact_->sub_compact_states.size(); i++) {",
          "new_line_content": "  LogCompaction();",
          "content_same": false
        },
        {
          "line": 619,
          "old_api": "emplace_back",
          "new_api": "ok",
          "old_text": "files_meta.emplace_back(&output.meta)",
          "new_text": "status.ok()",
          "old_line_content": "        files_meta.emplace_back(&output.meta);",
          "new_line_content": "  if (status.ok() && output_directory_) {",
          "content_same": false
        },
        {
          "line": 624,
          "old_api": "get",
          "new_api": "clear",
          "old_text": "compact_->compaction->mutable_cf_options()->prefix_extractor.get()",
          "new_text": "thread_pool.clear()",
          "old_line_content": "        compact_->compaction->mutable_cf_options()->prefix_extractor.get();",
          "new_line_content": "    thread_pool.clear();",
          "content_same": false
        },
        {
          "line": 628,
          "old_api": "fetch_add",
          "new_api": "emplace_back",
          "old_text": "next_file_meta_idx.fetch_add(1)",
          "new_text": "files_meta.emplace_back(&output.meta)",
          "old_line_content": "        size_t file_idx = next_file_meta_idx.fetch_add(1);",
          "new_line_content": "        files_meta.emplace_back(&output.meta);",
          "content_same": false
        },
        {
          "line": 638,
          "old_api": "table_cache",
          "new_api": "size",
          "old_text": "cfd->table_cache()->NewIterator(\n            ReadOptions(), env_options_, cfd->internal_comparator(),\n            *files_meta[file_idx], nullptr /* range_del_agg */,\n            prefix_extractor, nullptr,\n            cfd->internal_stats()->GetFileReadHist(\n                compact_->compaction->output_level()),\n            false, nullptr /* arena */, false /* skip_filters */,\n            compact_->compaction->output_level())",
          "new_text": "files_meta.size()",
          "old_line_content": "        InternalIterator* iter = cfd->table_cache()->NewIterator(",
          "new_line_content": "        if (file_idx >= files_meta.size()) {",
          "content_same": false
        },
        {
          "line": 648,
          "old_api": "ok",
          "new_api": "internal_comparator",
          "old_text": "s.ok()",
          "new_text": "cfd->internal_comparator()",
          "old_line_content": "        if (s.ok() && paranoid_file_checks_) {",
          "new_line_content": "            ReadOptions(), env_options_, cfd->internal_comparator(),",
          "content_same": false
        },
        {
          "line": 655,
          "old_api": "ok",
          "new_api": "status",
          "old_text": "s.ok()",
          "new_text": "iter->status()",
          "old_line_content": "        if (!s.ok()) {",
          "new_line_content": "        auto s = iter->status();",
          "content_same": false
        },
        {
          "line": 670,
          "old_api": "ok",
          "new_api": "size",
          "old_text": "state.status.ok()",
          "new_text": "compact_->sub_compact_states.size()",
          "old_line_content": "      if (!state.status.ok()) {",
          "new_line_content": "    for (size_t i = 1; i < compact_->sub_compact_states.size(); i++) {",
          "content_same": false
        },
        {
          "line": 690,
          "old_api": "UpdateCompactionStats",
          "new_api": "immutable_cf_options",
          "old_text": "UpdateCompactionStats()",
          "new_text": "state.compaction->immutable_cf_options()",
          "old_line_content": "  UpdateCompactionStats();",
          "new_line_content": "          TableFileName(state.compaction->immutable_cf_options()->cf_paths,",
          "content_same": false
        },
        {
          "line": 691,
          "old_api": "RecordCompactionIOStats",
          "new_api": "GetPathId",
          "old_text": "RecordCompactionIOStats()",
          "new_text": "output.meta.fd.GetPathId()",
          "old_line_content": "  RecordCompactionIOStats();",
          "new_line_content": "                        output.meta.fd.GetNumber(), output.meta.fd.GetPathId());",
          "content_same": false
        },
        {
          "line": 702,
          "old_api": "AssertHeld",
          "new_api": "TEST_SYNC_POINT",
          "old_text": "db_mutex_->AssertHeld()",
          "new_text": "TEST_SYNC_POINT(\"CompactionJob::Run():End\")",
          "old_line_content": "  db_mutex_->AssertHeld();",
          "new_line_content": "  TEST_SYNC_POINT(\"CompactionJob::Run():End\");",
          "content_same": false
        },
        {
          "line": 732,
          "old_api": "static_cast<double>(stats.micros)",
          "new_api": "static_cast<double>(stats.bytes_read_non_output_levels)",
          "old_text": "static_cast<double>(stats.micros)",
          "new_text": "static_cast<double>(stats.bytes_read_non_output_levels)",
          "old_line_content": "        stats.bytes_written / static_cast<double>(stats.micros);",
          "new_line_content": "                     static_cast<double>(stats.bytes_read_non_output_levels);",
          "content_same": false
        },
        {
          "line": 751,
          "old_api": "output_compression",
          "new_api": "LevelSummary",
          "old_text": "compact_->compaction->output_compression()",
          "new_text": "vstorage->LevelSummary(&tmp)",
          "old_line_content": "      CompressionTypeToString(compact_->compaction->output_compression())",
          "new_line_content": "      cfd->GetName().c_str(), vstorage->LevelSummary(&tmp), bytes_read_per_sec,",
          "content_same": false
        },
        {
          "line": 760,
          "old_api": "output_level",
          "new_api": "output_compression",
          "old_text": "compact_->compaction->output_level()",
          "new_text": "compact_->compaction->output_compression()",
          "old_line_content": "         << \"output_level\" << compact_->compaction->output_level()",
          "new_line_content": "      CompressionTypeToString(compact_->compaction->output_compression())",
          "content_same": false
        },
        {
          "line": 765,
          "old_api": "size",
          "new_api": "LogToBuffer",
          "old_text": "compact_->sub_compact_states.size()",
          "new_text": "event_logger_->LogToBuffer(log_buffer_)",
          "old_line_content": "         << compact_->sub_compact_states.size() << \"output_compression\"",
          "new_line_content": "  auto stream = event_logger_->LogToBuffer(log_buffer_);",
          "content_same": false
        },
        {
          "line": 796,
          "old_api": "assert",
          "new_api": "NumLevelFiles",
          "old_text": "assert(sub_compact != nullptr)",
          "new_text": "vstorage->NumLevelFiles(level)",
          "old_line_content": "  assert(sub_compact != nullptr);",
          "new_line_content": "    stream << vstorage->NumLevelFiles(level);",
          "content_same": false
        },
        {
          "line": 800,
          "old_api": "get",
          "new_api": "CleanupCompaction",
          "old_text": "versions_->MakeInputIterator(\n      sub_compact->compaction, range_del_agg.get(), env_optiosn_for_read_)",
          "new_text": "CleanupCompaction()",
          "old_line_content": "  std::unique_ptr<InternalIterator> input(versions_->MakeInputIterator(",
          "new_line_content": "  CleanupCompaction();",
          "content_same": false
        },
        {
          "line": 823,
          "old_api": "mutable_cf_options",
          "new_api": "GetPerfLevel",
          "old_text": "sub_compact->compaction->mutable_cf_options()",
          "new_text": "GetPerfLevel()",
          "old_line_content": "      sub_compact->compaction->mutable_cf_options();",
          "new_line_content": "    prev_perf_level = GetPerfLevel();",
          "content_same": false
        },
        {
          "line": 843,
          "old_api": "output_level",
          "new_api": "output_compression_opts",
          "old_text": "compact_->compaction->output_level()",
          "new_text": "sub_compact->compaction->output_compression_opts()",
          "old_line_content": "            compact_->compaction->output_level(),",
          "new_line_content": "          ? sub_compact->compaction->output_compression_opts()",
          "content_same": false
        },
        {
          "line": 845,
          "old_api": "GetInputBaseLevel",
          "new_api": "output_compression_opts",
          "old_text": "compact_->compaction->GetInputBaseLevel()",
          "new_text": "sub_compact->compaction->output_compression_opts()",
          "old_line_content": "            compact_->compaction->GetInputBaseLevel(),",
          "new_line_content": "          : sub_compact->compaction->output_compression_opts().max_dict_bytes;",
          "content_same": false
        },
        {
          "line": 851,
          "old_api": "insert",
          "new_api": "output_level",
          "old_text": "sample_begin_offsets.insert(\n            static_cast<size_t>(generator.Uniform(kOutFileNumSamples))\n            << kSampleLenShift)",
          "new_text": "MaxFileSizeForLevel(*mutable_cf_options,\n            compact_->compaction->output_level(),\n            cfd->ioptions()->compaction_style,\n            compact_->compaction->GetInputBaseLevel(),\n            cfd->ioptions()->level_compaction_dynamic_level_bytes)",
          "old_line_content": "        sample_begin_offsets.insert(",
          "new_line_content": "        static_cast<size_t>(MaxFileSizeForLevel(*mutable_cf_options,",
          "content_same": false
        },
        {
          "line": 852,
          "old_api": "Uniform",
          "new_api": "output_level",
          "old_text": "generator.Uniform(kOutFileNumSamples)",
          "new_text": "compact_->compaction->output_level()",
          "old_line_content": "            static_cast<size_t>(generator.Uniform(kOutFileNumSamples))",
          "new_line_content": "            compact_->compaction->output_level(),",
          "content_same": false
        },
        {
          "line": 858,
          "old_api": "ioptions",
          "new_api": "NewFileNumber",
          "old_text": "cfd->ioptions()",
          "new_text": "versions_->NewFileNumber()",
          "old_line_content": "  auto compaction_filter = cfd->ioptions()->compaction_filter;",
          "new_line_content": "      Random64 generator{versions_->NewFileNumber()};",
          "content_same": false
        },
        {
          "line": 867,
          "old_api": "get",
          "new_api": "ioptions",
          "old_text": "db_options_.info_log.get()",
          "new_text": "cfd->ioptions()",
          "old_line_content": "      compaction_filter, db_options_.info_log.get(),",
          "new_line_content": "  auto compaction_filter = cfd->ioptions()->compaction_filter;",
          "content_same": false
        },
        {
          "line": 871,
          "old_api": "get",
          "new_api": "CreateCompactionFilter",
          "old_text": "db_options_.statistics.get()",
          "new_text": "sub_compact->compaction->CreateCompactionFilter()",
          "old_line_content": "      db_options_.statistics.get(), shutting_down_);",
          "new_line_content": "        sub_compact->compaction->CreateCompactionFilter();",
          "content_same": false
        },
        {
          "line": 879,
          "old_api": "SetInternalKey",
          "new_api": "level",
          "old_text": "start_iter.SetInternalKey(*start, kMaxSequenceNumber, kValueTypeForSeek)",
          "new_text": "compact_->compaction->level()",
          "old_line_content": "    start_iter.SetInternalKey(*start, kMaxSequenceNumber, kValueTypeForSeek);",
          "new_line_content": "      snapshot_checker_, compact_->compaction->level(),",
          "content_same": false
        },
        {
          "line": 880,
          "old_api": "GetInternalKey",
          "new_api": "get",
          "old_text": "start_iter.GetInternalKey()",
          "new_text": "db_options_.statistics.get()",
          "old_line_content": "    input->Seek(start_iter.GetInternalKey());",
          "new_line_content": "      db_options_.statistics.get(), shutting_down_);",
          "content_same": false
        },
        {
          "line": 882,
          "old_api": "SeekToFirst",
          "new_api": "TEST_SYNC_POINT",
          "old_text": "input->SeekToFirst()",
          "new_text": "TEST_SYNC_POINT(\"CompactionJob::Run():Inprogress\")",
          "old_line_content": "    input->SeekToFirst();",
          "new_line_content": "  TEST_SYNC_POINT(\"CompactionJob::Run():Inprogress\");",
          "content_same": false
        },
        {
          "line": 889,
          "old_api": "ShouldReportDetailedTime",
          "new_api": "GetInternalKey",
          "old_text": "ShouldReportDetailedTime(env_, stats_)",
          "new_text": "start_iter.GetInternalKey()",
          "old_line_content": "      snapshot_checker_, env_, ShouldReportDetailedTime(env_, stats_), false,",
          "new_line_content": "    input->Seek(start_iter.GetInternalKey());",
          "content_same": false
        },
        {
          "line": 898,
          "old_api": "key",
          "new_api": "ShouldReportDetailedTime",
          "old_text": "c_iter->key()",
          "new_text": "ShouldReportDetailedTime(env_, stats_)",
          "old_line_content": "    sub_compact->ShouldStopBefore(c_iter->key(),",
          "new_line_content": "      snapshot_checker_, env_, ShouldReportDetailedTime(env_, stats_), false,",
          "content_same": false
        },
        {
          "line": 901,
          "old_api": "iter_stats",
          "new_api": "get",
          "old_text": "c_iter->iter_stats()",
          "new_text": "sub_compact->c_iter.get()",
          "old_line_content": "  const auto& c_iter_stats = c_iter->iter_stats();",
          "new_line_content": "  auto c_iter = sub_compact->c_iter.get();",
          "content_same": false
        },
        {
          "line": 902,
          "old_api": "cbegin",
          "new_api": "SeekToFirst",
          "old_text": "sample_begin_offsets.cbegin()",
          "new_text": "c_iter->SeekToFirst()",
          "old_line_content": "  auto sample_begin_offset_iter = sample_begin_offsets.cbegin();",
          "new_line_content": "  c_iter->SeekToFirst();",
          "content_same": false
        },
        {
          "line": 907,
          "old_api": "reserve",
          "new_api": "key",
          "old_text": "dict_sample_data.reserve(kSampleBytes)",
          "new_text": "c_iter->key()",
          "old_line_content": "  dict_sample_data.reserve(kSampleBytes);",
          "new_line_content": "    sub_compact->ShouldStopBefore(c_iter->key(),",
          "content_same": false
        },
        {
          "line": 918,
          "old_api": "user_key",
          "new_api": "Valid",
          "old_text": "c_iter->user_key()",
          "new_text": "c_iter->Valid()",
          "old_line_content": "        cfd->user_comparator()->Compare(c_iter->user_key(), *end) >= 0) {",
          "new_line_content": "  while (status.ok() && !cfd->IsDropped() && c_iter->Valid()) {",
          "content_same": false
        },
        {
          "line": 939,
          "old_api": "UpdateBoundaries",
          "new_api": "OpenCompactionOutputFile",
          "old_text": "sub_compact->current_output()->meta.UpdateBoundaries(\n        key, c_iter->ikey().sequence)",
          "new_text": "OpenCompactionOutputFile(sub_compact)",
          "old_line_content": "    sub_compact->current_output()->meta.UpdateBoundaries(",
          "new_line_content": "      status = OpenCompactionOutputFile(sub_compact);",
          "content_same": false
        },
        {
          "line": 940,
          "old_api": "ikey",
          "new_api": "ok",
          "old_text": "c_iter->ikey()",
          "new_text": "status.ok()",
          "old_line_content": "        key, c_iter->ikey().sequence);",
          "new_line_content": "      if (!status.ok()) {",
          "content_same": false
        },
        {
          "line": 947,
          "old_api": "size",
          "new_api": "FileSize",
          "old_text": "data_elmt.size()",
          "new_text": "sub_compact->builder->FileSize()",
          "old_line_content": "        size_t data_end_offset = data_begin_offset + data_elmt.size();",
          "new_line_content": "    sub_compact->current_output_file_size = sub_compact->builder->FileSize();",
          "content_same": false
        },
        {
          "line": 948,
          "old_api": "cend",
          "new_api": "UpdateBoundaries",
          "old_text": "sample_begin_offsets.cend()",
          "new_text": "sub_compact->current_output()->meta.UpdateBoundaries(\n        key, c_iter->ikey().sequence)",
          "old_line_content": "        while (sample_begin_offset_iter != sample_begin_offsets.cend() &&",
          "new_line_content": "    sub_compact->current_output()->meta.UpdateBoundaries(",
          "content_same": false
        },
        {
          "line": 1011,
          "old_api": "Valid",
          "new_api": "output_level",
          "old_text": "c_iter->Valid()",
          "new_text": "sub_compact->compaction->output_level()",
          "old_line_content": "    if (!output_file_ended && c_iter->Valid() &&",
          "new_line_content": "    if (sub_compact->compaction->output_level() != 0 &&",
          "content_same": false
        },
        {
          "line": 1013,
          "old_api": "key",
          "new_api": "max_output_file_size",
          "old_text": "c_iter->key()",
          "new_text": "sub_compact->compaction->max_output_file_size()",
          "old_line_content": "        sub_compact->ShouldStopBefore(c_iter->key(),",
          "new_line_content": "            sub_compact->compaction->max_output_file_size()) {",
          "content_same": false
        },
        {
          "line": 1019,
          "old_api": "status",
          "new_api": "Next",
          "old_text": "input->status()",
          "new_text": "c_iter->Next()",
          "old_line_content": "      input_status = input->status();",
          "new_line_content": "    c_iter->Next();",
          "content_same": false
        },
        {
          "line": 1028,
          "old_api": "get",
          "new_api": "status",
          "old_text": "FinishCompactionOutputFile(input_status, sub_compact,\n                                          range_del_agg.get(),\n                                          &range_del_out_stats, next_key)",
          "new_text": "input->status()",
          "old_line_content": "      status = FinishCompactionOutputFile(input_status, sub_compact,",
          "new_line_content": "      input_status = input->status();",
          "content_same": false
        },
        {
          "line": 1033,
          "old_api": "size",
          "new_api": "Valid",
          "old_text": "sub_compact->outputs.size()",
          "new_text": "c_iter->Valid()",
          "old_line_content": "      if (sub_compact->outputs.size() == 1) {",
          "new_line_content": "      if (c_iter->Valid()) {",
          "content_same": false
        },
        {
          "line": 1037,
          "old_api": "output_compression_opts",
          "new_api": "get",
          "old_text": "ZSTD_TrainDictionary(\n              dict_sample_data, kSampleLenShift,\n              sub_compact->compaction->output_compression_opts()\n                  .max_dict_bytes)",
          "new_text": "FinishCompactionOutputFile(input_status, sub_compact,\n                                          range_del_agg.get(),\n                                          &range_del_out_stats, next_key)",
          "old_line_content": "          sub_compact->compression_dict = ZSTD_TrainDictionary(",
          "new_line_content": "      status = FinishCompactionOutputFile(input_status, sub_compact,",
          "content_same": false
        },
        {
          "line": 1042,
          "old_api": "std::move(dict_sample_data)",
          "new_api": "size",
          "old_text": "std::move(dict_sample_data)",
          "new_text": "sub_compact->outputs.size()",
          "old_line_content": "          sub_compact->compression_dict = std::move(dict_sample_data);",
          "new_line_content": "      if (sub_compact->outputs.size() == 1) {",
          "content_same": false
        },
        {
          "line": 1073,
          "old_api": "status",
          "new_api": "RecordDroppedKeys",
          "old_text": "input->status()",
          "new_text": "RecordDroppedKeys(c_iter_stats, &sub_compact->compaction_job_stats)",
          "old_line_content": "    status = input->status();",
          "new_line_content": "  RecordDroppedKeys(c_iter_stats, &sub_compact->compaction_job_stats);",
          "content_same": false
        },
        {
          "line": 1076,
          "old_api": "status",
          "new_api": "ok",
          "old_text": "c_iter->status()",
          "new_text": "status.ok()",
          "old_line_content": "    status = c_iter->status();",
          "new_line_content": "  if (status.ok() &&",
          "content_same": false
        },
        {
          "line": 1081,
          "old_api": "IsEmpty",
          "new_api": "ok",
          "old_text": "range_del_agg->IsEmpty()",
          "new_text": "status.ok()",
          "old_line_content": "      !range_del_agg->IsEmpty()) {",
          "new_line_content": "  if (status.ok()) {",
          "content_same": false
        },
        {
          "line": 1090,
          "old_api": "get",
          "new_api": "IsEmpty",
          "old_text": "FinishCompactionOutputFile(\n        status, sub_compact, range_del_agg.get(), &range_del_out_stats)",
          "new_text": "range_del_agg->IsEmpty()",
          "old_line_content": "    Status s = FinishCompactionOutputFile(",
          "new_line_content": "      !range_del_agg->IsEmpty()) {",
          "content_same": false
        },
        {
          "line": 1092,
          "old_api": "ok",
          "new_api": "OpenCompactionOutputFile",
          "old_text": "status.ok()",
          "new_text": "OpenCompactionOutputFile(sub_compact)",
          "old_line_content": "    if (status.ok()) {",
          "new_line_content": "    status = OpenCompactionOutputFile(sub_compact);",
          "content_same": false
        },
        {
          "line": 1100,
          "old_api": "IOSTATS",
          "new_api": "get",
          "old_text": "IOSTATS(write_nanos)",
          "new_text": "range_del_agg.get()",
          "old_line_content": "        IOSTATS(write_nanos) - prev_write_nanos;",
          "new_line_content": "        status, sub_compact, range_del_agg.get(), &range_del_out_stats);",
          "content_same": false
        },
        {
          "line": 1104,
          "old_api": "IOSTATS",
          "new_api": "RecordDroppedKeys",
          "old_text": "IOSTATS(range_sync_nanos)",
          "new_text": "RecordDroppedKeys(range_del_out_stats, &sub_compact->compaction_job_stats)",
          "old_line_content": "        IOSTATS(range_sync_nanos) - prev_range_sync_nanos;",
          "new_line_content": "    RecordDroppedKeys(range_del_out_stats, &sub_compact->compaction_job_stats);",
          "content_same": false
        },
        {
          "line": 1113,
          "old_api": "reset",
          "new_api": "IOSTATS",
          "old_text": "input.reset()",
          "new_text": "IOSTATS(range_sync_nanos)",
          "old_line_content": "  input.reset();",
          "new_line_content": "        IOSTATS(range_sync_nanos) - prev_range_sync_nanos;",
          "content_same": false
        },
        {
          "line": 1121,
          "old_api": "RecordTick",
          "new_api": "reset",
          "old_text": "RecordTick(stats_, COMPACTION_KEY_DROP_USER,\n               c_iter_stats.num_record_drop_user)",
          "new_text": "sub_compact->c_iter.reset()",
          "old_line_content": "    RecordTick(stats_, COMPACTION_KEY_DROP_USER,",
          "new_line_content": "  sub_compact->c_iter.reset();",
          "content_same": false
        },
        {
          "line": 1170,
          "old_api": "user_comparator",
          "new_api": "assert",
          "old_text": "cfd->user_comparator()",
          "new_text": "assert(sub_compact != nullptr)",
          "old_line_content": "  const Comparator* ucmp = cfd->user_comparator();",
          "new_line_content": "  assert(sub_compact != nullptr);",
          "content_same": false
        },
        {
          "line": 1175,
          "old_api": "assert",
          "new_api": "GetNumber",
          "old_text": "assert(meta != nullptr)",
          "new_text": "sub_compact->current_output()->meta.fd.GetNumber()",
          "old_line_content": "  assert(meta != nullptr);",
          "new_line_content": "  uint64_t output_number = sub_compact->current_output()->meta.fd.GetNumber();",
          "content_same": false
        },
        {
          "line": 1176,
          "old_api": "ok",
          "new_api": "assert",
          "old_text": "s.ok()",
          "new_text": "assert(output_number != 0)",
          "old_line_content": "  if (s.ok()) {",
          "new_line_content": "  assert(output_number != 0);",
          "content_same": false
        },
        {
          "line": 1184,
          "old_api": "size",
          "new_api": "assert",
          "old_text": "meta->smallest.size()",
          "new_text": "assert(meta != nullptr)",
          "old_line_content": "    } else if (meta->smallest.size() > 0) {",
          "new_line_content": "  assert(meta != nullptr);",
          "content_same": false
        },
        {
          "line": 1189,
          "old_api": "Slice",
          "new_api": "size",
          "old_text": "Slice(smallest_user_key)",
          "new_text": "sub_compact->outputs.size()",
          "old_line_content": "      lower_bound_guard = Slice(smallest_user_key);",
          "new_line_content": "    if (sub_compact->outputs.size() == 1) {",
          "content_same": false
        },
        {
          "line": 1197,
          "old_api": "ExtractUserKey",
          "new_api": "user_key",
          "old_text": "ExtractUserKey(*next_table_min_key)",
          "new_text": "meta->smallest.user_key().ToString(false /*hex*/)",
          "old_line_content": "      upper_bound_guard = ExtractUserKey(*next_table_min_key);",
          "new_line_content": "      smallest_user_key = meta->smallest.user_key().ToString(false /*hex*/);",
          "content_same": false
        },
        {
          "line": 1223,
          "old_api": "Compare",
          "new_api": "size",
          "old_text": "ucmp->Compare(*upper_bound, tombstone.start_key_)",
          "new_text": "meta->largest.size()",
          "old_line_content": "        int cmp = ucmp->Compare(*upper_bound, tombstone.start_key_);",
          "new_line_content": "    if (upper_bound != nullptr && meta->largest.size() > 0) {",
          "content_same": false
        },
        {
          "line": 1257,
          "old_api": "InternalKey",
          "new_api": "user_key",
          "old_text": "InternalKey(*lower_bound, 0, kTypeRangeDeletion)",
          "new_text": "smallest_candidate.user_key()",
          "old_line_content": "        smallest_candidate = InternalKey(*lower_bound, 0, kTypeRangeDeletion);",
          "new_line_content": "          ucmp->Compare(smallest_candidate.user_key(), *lower_bound) <= 0) {",
          "content_same": false
        },
        {
          "line": 1286,
          "old_api": "ok",
          "new_api": "InternalKey",
          "old_text": "s.ok()",
          "new_text": "InternalKey(*upper_bound, kMaxSequenceNumber, kTypeRangeDeletion)",
          "old_line_content": "  if (s.ok()) {",
          "new_line_content": "            InternalKey(*upper_bound, kMaxSequenceNumber, kTypeRangeDeletion);",
          "content_same": false
        },
        {
          "line": 1292,
          "old_api": "ok",
          "new_api": "NeedCompact",
          "old_text": "s.ok()",
          "new_text": "sub_compact->builder->NeedCompact()",
          "old_line_content": "  if (s.ok()) {",
          "new_line_content": "    meta->marked_for_compaction = sub_compact->builder->NeedCompact();",
          "content_same": false
        },
        {
          "line": 1295,
          "old_api": "current_output",
          "new_api": "ok",
          "old_text": "sub_compact->current_output()",
          "new_text": "s.ok()",
          "old_line_content": "  sub_compact->current_output()->finished = true;",
          "new_line_content": "  if (s.ok()) {",
          "content_same": false
        },
        {
          "line": 1301,
          "old_api": "Sync",
          "new_api": "ok",
          "old_text": "sub_compact->outfile->Sync(db_options_.use_fsync)",
          "new_text": "s.ok()",
          "old_line_content": "    s = sub_compact->outfile->Sync(db_options_.use_fsync);",
          "new_line_content": "  if (s.ok()) {",
          "content_same": false
        },
        {
          "line": 1304,
          "old_api": "Close",
          "new_api": "current_output",
          "old_text": "sub_compact->outfile->Close()",
          "new_text": "sub_compact->current_output()",
          "old_line_content": "    s = sub_compact->outfile->Close();",
          "new_line_content": "  sub_compact->current_output()->finished = true;",
          "content_same": false
        },
        {
          "line": 1310,
          "old_api": "GetTableProperties",
          "new_api": "Sync",
          "old_text": "sub_compact->builder->GetTableProperties()",
          "new_text": "sub_compact->outfile->Sync(db_options_.use_fsync)",
          "old_line_content": "    tp = sub_compact->builder->GetTableProperties();",
          "new_line_content": "    s = sub_compact->outfile->Sync(db_options_.use_fsync);",
          "content_same": false
        },
        {
          "line": 1313,
          "old_api": "ok",
          "new_api": "Close",
          "old_text": "s.ok()",
          "new_text": "sub_compact->outfile->Close()",
          "old_line_content": "  if (s.ok() && current_entries == 0 && tp.num_range_deletions == 0) {",
          "new_line_content": "    s = sub_compact->outfile->Close();",
          "content_same": false
        },
        {
          "line": 1318,
          "old_api": "immutable_cf_options",
          "new_api": "ok",
          "old_text": "sub_compact->compaction->immutable_cf_options()",
          "new_text": "s.ok()",
          "old_line_content": "        TableFileName(sub_compact->compaction->immutable_cf_options()->cf_paths,",
          "new_line_content": "  if (s.ok()) {",
          "content_same": false
        },
        {
          "line": 1319,
          "old_api": "GetPathId",
          "new_api": "GetTableProperties",
          "old_text": "meta->fd.GetPathId()",
          "new_text": "sub_compact->builder->GetTableProperties()",
          "old_line_content": "                      meta->fd.GetNumber(), meta->fd.GetPathId());",
          "new_line_content": "    tp = sub_compact->builder->GetTableProperties();",
          "content_same": false
        },
        {
          "line": 1329,
          "old_api": "ok",
          "new_api": "DeleteFile",
          "old_text": "s.ok()",
          "new_text": "env_->DeleteFile(fname)",
          "old_line_content": "  if (s.ok() && (current_entries > 0 || tp.num_range_deletions > 0)) {",
          "new_line_content": "    env_->DeleteFile(fname);",
          "content_same": false
        },
        {
          "line": 1333,
          "old_api": "c_str",
          "new_api": "empty",
          "old_text": "ROCKS_LOG_INFO(db_options_.info_log,\n                   \"[%s] [JOB %d] Generated table #%\" PRIu64 \": %\" PRIu64\n                   \" keys, %\" PRIu64 \" bytes%s\",\n                   cfd->GetName().c_str(), job_id_, output_number,\n                   current_entries, current_bytes,\n                   meta->marked_for_compaction ? \" (need compaction)\" : \"\")",
          "new_text": "sub_compact->outputs.empty()",
          "old_line_content": "    ROCKS_LOG_INFO(db_options_.info_log,",
          "new_line_content": "    assert(!sub_compact->outputs.empty());",
          "content_same": false
        },
        {
          "line": 1345,
          "old_api": "GetPathId",
          "new_api": "c_str",
          "old_text": "meta->fd.GetPathId()",
          "new_text": "cfd->GetName().c_str()",
          "old_line_content": "                      meta->fd.GetNumber(), meta->fd.GetPathId());",
          "new_line_content": "                   cfd->GetName().c_str(), job_id_, output_number,",
          "content_same": false
        },
        {
          "line": 1360,
          "old_api": "immutable_cf_options",
          "new_api": "GetName",
          "old_text": "sub_compact->compaction->immutable_cf_options()",
          "new_text": "cfd->GetName()",
          "old_line_content": "        TableFileName(sub_compact->compaction->immutable_cf_options()->cf_paths,",
          "new_line_content": "      event_logger_, cfd->ioptions()->listeners, dbname_, cfd->GetName(), fname,",
          "content_same": false
        },
        {
          "line": 1366,
          "old_api": "Status::SpaceLimit(\"Max allowed space was reached\")",
          "new_api": "get",
          "old_text": "Status::SpaceLimit(\"Max allowed space was reached\")",
          "new_text": "db_options_.sst_file_manager.get()",
          "old_line_content": "      s = Status::SpaceLimit(\"Max allowed space was reached\");",
          "new_line_content": "      static_cast<SstFileManagerImpl*>(db_options_.sst_file_manager.get());",
          "content_same": false
        },
        {
          "line": 1367,
          "old_api": "TEST_SYNC_POINT",
          "new_api": "GetPathId",
          "old_text": "TEST_SYNC_POINT(\n          \"CompactionJob::FinishCompactionOutputFile:\"\n          \"MaxAllowedSpaceReached\")",
          "new_text": "meta->fd.GetPathId()",
          "old_line_content": "      TEST_SYNC_POINT(",
          "new_line_content": "  if (sfm && meta != nullptr && meta->fd.GetPathId() == 0) {",
          "content_same": false
        },
        {
          "line": 1371,
          "old_api": "SetBGError",
          "new_api": "OnAddFile",
          "old_text": "db_error_handler_->SetBGError(s, BackgroundErrorReason::kCompaction)",
          "new_text": "sfm->OnAddFile(fn)",
          "old_line_content": "      db_error_handler_->SetBGError(s, BackgroundErrorReason::kCompaction);",
          "new_line_content": "    sfm->OnAddFile(fn);",
          "content_same": false
        },
        {
          "line": 1376,
          "old_api": "reset",
          "new_api": "TEST_SYNC_POINT",
          "old_text": "sub_compact->builder.reset()",
          "new_text": "TEST_SYNC_POINT(\n          \"CompactionJob::FinishCompactionOutputFile:\"\n          \"MaxAllowedSpaceReached\")",
          "old_line_content": "  sub_compact->builder.reset();",
          "new_line_content": "      TEST_SYNC_POINT(",
          "content_same": false
        },
        {
          "line": 1412,
          "old_api": "output_level",
          "new_api": "c_str",
          "old_text": "compaction->output_level()",
          "new_text": "compaction->column_family_data()->GetName().c_str()",
          "old_line_content": "      compaction->edit()->AddFile(compaction->output_level(), out.meta);",
          "new_line_content": "        compaction->column_family_data()->GetName().c_str(), job_id_,",
          "content_same": false
        },
        {
          "line": 1421,
          "old_api": "IOSTATS",
          "new_api": "output_level",
          "old_text": "IOSTATS(bytes_read)",
          "new_text": "compaction->output_level()",
          "old_line_content": "  RecordTick(stats_, COMPACT_READ_BYTES, IOSTATS(bytes_read));",
          "new_line_content": "      compaction->edit()->AddFile(compaction->output_level(), out.meta);",
          "content_same": false
        },
        {
          "line": 1424,
          "old_api": "IOSTATS_RESET",
          "new_api": "column_family_data",
          "old_text": "IOSTATS_RESET(bytes_read)",
          "new_text": "compaction->column_family_data()",
          "old_line_content": "  IOSTATS_RESET(bytes_read);",
          "new_line_content": "  return versions_->LogAndApply(compaction->column_family_data(),",
          "content_same": false
        },
        {
          "line": 1425,
          "old_api": "IOSTATS",
          "new_api": "edit",
          "old_text": "IOSTATS(bytes_written)",
          "new_text": "compaction->edit()",
          "old_line_content": "  RecordTick(stats_, COMPACT_WRITE_BYTES, IOSTATS(bytes_written));",
          "new_line_content": "                                mutable_cf_options, compaction->edit(),",
          "content_same": false
        },
        {
          "line": 1433,
          "old_api": "assert",
          "new_api": "IOSTATS_RESET",
          "old_text": "assert(sub_compact != nullptr)",
          "new_text": "IOSTATS_RESET(bytes_read)",
          "old_line_content": "  assert(sub_compact != nullptr);",
          "new_line_content": "  IOSTATS_RESET(bytes_read);",
          "content_same": false
        },
        {
          "line": 1434,
          "old_api": "assert",
          "new_api": "IOSTATS",
          "old_text": "assert(sub_compact->builder == nullptr)",
          "new_text": "IOSTATS(bytes_written)",
          "old_line_content": "  assert(sub_compact->builder == nullptr);",
          "new_line_content": "  RecordTick(stats_, COMPACT_WRITE_BYTES, IOSTATS(bytes_written));",
          "content_same": false
        },
        {
          "line": 1436,
          "old_api": "NewFileNumber",
          "new_api": "IOSTATS",
          "old_text": "versions_->NewFileNumber()",
          "new_text": "IOSTATS(bytes_written)",
          "old_line_content": "  uint64_t file_number = versions_->NewFileNumber();",
          "new_line_content": "      ThreadStatus::COMPACTION_BYTES_WRITTEN, IOSTATS(bytes_written));",
          "content_same": false
        },
        {
          "line": 1443,
          "old_api": "ioptions",
          "new_api": "assert",
          "old_text": "EventHelpers::NotifyTableFileCreationStarted(\n      cfd->ioptions()->listeners, dbname_, cfd->GetName(), fname, job_id_,\n      TableFileCreationReason::kCompaction)",
          "new_text": "assert(sub_compact->builder == nullptr)",
          "old_line_content": "  EventHelpers::NotifyTableFileCreationStarted(",
          "new_line_content": "  assert(sub_compact->builder == nullptr);",
          "content_same": false
        },
        {
          "line": 1460,
          "old_api": "c_str",
          "new_api": "TEST_SYNC_POINT_CALLBACK",
          "old_text": "sub_compact->compaction->column_family_data()->GetName().c_str()",
          "new_text": "TEST_SYNC_POINT_CALLBACK(\"CompactionJob::OpenCompactionOutputFile\",\n                           &syncpoint_arg)",
          "old_line_content": "        sub_compact->compaction->column_family_data()->GetName().c_str(),",
          "new_line_content": "  TEST_SYNC_POINT_CALLBACK(\"CompactionJob::OpenCompactionOutputFile\",",
          "content_same": false
        },
        {
          "line": 1463,
          "old_api": "ioptions",
          "new_api": "NewWritableFile",
          "old_text": "EventHelpers::LogAndNotifyTableFileCreationFinished(\n        event_logger_, cfd->ioptions()->listeners, dbname_, cfd->GetName(),\n        fname, job_id_, FileDescriptor(), TableProperties(),\n        TableFileCreationReason::kCompaction, s)",
          "new_text": "NewWritableFile(env_, fname, &writable_file, env_options_)",
          "old_line_content": "    EventHelpers::LogAndNotifyTableFileCreationFinished(",
          "new_line_content": "  Status s = NewWritableFile(env_, fname, &writable_file, env_options_);",
          "content_same": false
        },
        {
          "line": 1464,
          "old_api": "GetName",
          "new_api": "ok",
          "old_text": "cfd->GetName()",
          "new_text": "s.ok()",
          "old_line_content": "        event_logger_, cfd->ioptions()->listeners, dbname_, cfd->GetName(),",
          "new_line_content": "  if (!s.ok()) {",
          "content_same": false
        },
        {
          "line": 1465,
          "old_api": "TableProperties",
          "new_api": "c_str",
          "old_text": "TableProperties()",
          "new_text": "ROCKS_LOG_ERROR(\n        db_options_.info_log,\n        \"[%s] [JOB %d] OpenCompactionOutputFiles for table #%\" PRIu64\n        \" fails at NewWritableFile with status %s\",\n        sub_compact->compaction->column_family_data()->GetName().c_str(),\n        job_id_, file_number, s.ToString().c_str())",
          "old_line_content": "        fname, job_id_, FileDescriptor(), TableProperties(),",
          "new_line_content": "    ROCKS_LOG_ERROR(",
          "content_same": false
        },
        {
          "line": 1472,
          "old_api": "output_path_id",
          "new_api": "ioptions",
          "old_text": "sub_compact->compaction->output_path_id()",
          "new_text": "EventHelpers::LogAndNotifyTableFileCreationFinished(\n        event_logger_, cfd->ioptions()->listeners, dbname_, cfd->GetName(),\n        fname, job_id_, FileDescriptor(), TableProperties(),\n        TableFileCreationReason::kCompaction, s)",
          "old_line_content": "      FileDescriptor(file_number, sub_compact->compaction->output_path_id(), 0);",
          "new_line_content": "    EventHelpers::LogAndNotifyTableFileCreationFinished(",
          "content_same": false
        },
        {
          "line": 1481,
          "old_api": "immutable_cf_options",
          "new_api": "output_path_id",
          "old_text": "sub_compact->compaction->immutable_cf_options()",
          "new_text": "sub_compact->compaction->output_path_id()",
          "old_line_content": "      sub_compact->compaction->immutable_cf_options()->listeners;",
          "new_line_content": "      FileDescriptor(file_number, sub_compact->compaction->output_path_id(), 0);",
          "content_same": false
        },
        {
          "line": 1484,
          "old_api": "get",
          "new_api": "push_back",
          "old_text": "db_options_.statistics.get()",
          "new_text": "sub_compact->outputs.push_back(out)",
          "old_line_content": "                             db_options_.statistics.get(), listeners));",
          "new_line_content": "  sub_compact->outputs.push_back(out);",
          "content_same": false
        },
        {
          "line": 1490,
          "old_api": "ioptions",
          "new_api": "immutable_cf_options",
          "old_text": "cfd->ioptions()",
          "new_text": "sub_compact->compaction->immutable_cf_options()",
          "old_line_content": "      cfd->ioptions()->optimize_filters_for_hits && bottommost_level_;",
          "new_line_content": "      sub_compact->compaction->immutable_cf_options()->listeners;",
          "content_same": false
        },
        {
          "line": 1493,
          "old_api": "MaxInputFileCreationTime",
          "new_api": "get",
          "old_text": "sub_compact->compaction->MaxInputFileCreationTime()",
          "new_text": "db_options_.statistics.get()",
          "old_line_content": "      sub_compact->compaction->MaxInputFileCreationTime();",
          "new_line_content": "                             db_options_.statistics.get(), listeners));",
          "content_same": false
        },
        {
          "line": 1499,
          "old_api": "ToString",
          "new_api": "ioptions",
          "old_text": "ROCKS_LOG_WARN(\n          db_options_.info_log,\n          \"Failed to get current time to populate creation_time property. \"\n          \"Status: %s\",\n          status.ToString().c_str())",
          "new_text": "cfd->ioptions()",
          "old_line_content": "      ROCKS_LOG_WARN(",
          "new_line_content": "      cfd->ioptions()->optimize_filters_for_hits && bottommost_level_;",
          "content_same": false
        },
        {
          "line": 1505,
          "old_api": "static_cast<uint64_t>(_current_time)",
          "new_api": "GetCurrentTime",
          "old_text": "static_cast<uint64_t>(_current_time)",
          "new_text": "db_options_.env->GetCurrentTime(&_current_time)",
          "old_line_content": "    output_file_creation_time = static_cast<uint64_t>(_current_time);",
          "new_line_content": "    auto status = db_options_.env->GetCurrentTime(&_current_time);",
          "content_same": false
        },
        {
          "line": 1508,
          "old_api": "get",
          "new_api": "ToString",
          "old_text": "NewTableBuilder(\n      *cfd->ioptions(), *(sub_compact->compaction->mutable_cf_options()),\n      cfd->internal_comparator(), cfd->int_tbl_prop_collector_factories(),\n      cfd->GetID(), cfd->GetName(), sub_compact->outfile.get(),\n      sub_compact->compaction->output_compression(),\n      sub_compact->compaction->output_compression_opts(),\n      sub_compact->compaction->output_level(), &sub_compact->compression_dict,\n      skip_filters, output_file_creation_time)",
          "new_text": "ROCKS_LOG_WARN(\n          db_options_.info_log,\n          \"Failed to get current time to populate creation_time property. \"\n          \"Status: %s\",\n          status.ToString().c_str())",
          "old_line_content": "  sub_compact->builder.reset(NewTableBuilder(",
          "new_line_content": "      ROCKS_LOG_WARN(",
          "content_same": false
        },
        {
          "line": 1512,
          "old_api": "output_compression",
          "new_api": "ToString",
          "old_text": "sub_compact->compaction->output_compression()",
          "new_text": "status.ToString().c_str()",
          "old_line_content": "      sub_compact->compaction->output_compression(),",
          "new_line_content": "          status.ToString().c_str());",
          "content_same": false
        },
        {
          "line": 1514,
          "old_api": "output_level",
          "new_api": "static_cast<uint64_t>(_current_time)",
          "old_text": "sub_compact->compaction->output_level()",
          "new_text": "static_cast<uint64_t>(_current_time)",
          "old_line_content": "      sub_compact->compaction->output_level(), &sub_compact->compression_dict,",
          "new_line_content": "    output_file_creation_time = static_cast<uint64_t>(_current_time);",
          "content_same": false
        },
        {
          "line": 1535,
          "old_api": "GetNumber",
          "new_api": "Abandon",
          "old_text": "out.meta.fd.GetNumber()",
          "new_text": "sub_compact.builder->Abandon()",
          "old_line_content": "        TableCache::Evict(table_cache_.get(), out.meta.fd.GetNumber());",
          "new_line_content": "      sub_compact.builder->Abandon();",
          "content_same": false
        },
        {
          "line": 1652,
          "old_api": "score",
          "new_api": "column_family_data",
          "old_text": "compaction->score()",
          "new_text": "compaction->column_family_data()",
          "old_line_content": "        compaction->InputLevelSummary(&inputs_summary), compaction->score());",
          "new_line_content": "  ColumnFamilyData* cfd = compaction->column_family_data();",
          "content_same": false
        },
        {
          "line": 1658,
          "old_api": "Log",
          "new_api": "c_str",
          "old_text": "event_logger_->Log()",
          "new_text": "ROCKS_LOG_INFO(\n        db_options_.info_log, \"[%s] [JOB %d] Compacting %s, score %.2f\",\n        cfd->GetName().c_str(), job_id_,\n        compaction->InputLevelSummary(&inputs_summary), compaction->score())",
          "old_line_content": "    auto stream = event_logger_->Log();",
          "new_line_content": "    ROCKS_LOG_INFO(",
          "content_same": false
        },
        {
          "line": 1663,
          "old_api": "num_input_levels",
          "new_api": "Summary",
          "old_text": "compaction->num_input_levels()",
          "new_text": "compaction->Summary(scratch, sizeof(scratch))",
          "old_line_content": "    for (size_t i = 0; i < compaction->num_input_levels(); ++i) {",
          "new_line_content": "    compaction->Summary(scratch, sizeof(scratch));",
          "content_same": false
        },
        {
          "line": 1664,
          "old_api": "level",
          "new_api": "c_str",
          "old_text": "compaction->level(i)",
          "new_text": "ROCKS_LOG_INFO(db_options_.info_log, \"[%s] Compaction start summary: %s\\n\",\n                   cfd->GetName().c_str(), scratch)",
          "old_line_content": "      stream << (\"files_L\" + ToString(compaction->level(i)));",
          "new_line_content": "    ROCKS_LOG_INFO(db_options_.info_log, \"[%s] Compaction start summary: %s\\n\",",
          "content_same": false
        },
        {
          "line": 1665,
          "old_api": "StartArray",
          "new_api": "c_str",
          "old_text": "stream.StartArray()",
          "new_text": "cfd->GetName().c_str()",
          "old_line_content": "      stream.StartArray();",
          "new_line_content": "                   cfd->GetName().c_str(), scratch);",
          "content_same": false
        },
        {
          "line": 1667,
          "old_api": "GetNumber",
          "new_api": "Log",
          "old_text": "f->fd.GetNumber()",
          "new_text": "event_logger_->Log()",
          "old_line_content": "        stream << f->fd.GetNumber();",
          "new_line_content": "    auto stream = event_logger_->Log();",
          "content_same": false
        },
        {
          "line": 1671,
          "old_api": "score",
          "new_api": "compaction_reason",
          "old_text": "compaction->score()",
          "new_text": "compaction->compaction_reason()",
          "old_line_content": "    stream << \"score\" << compaction->score() << \"input_data_size\"",
          "new_line_content": "           << GetCompactionReasonString(compaction->compaction_reason());",
          "content_same": false
        },
        {
          "line": 1672,
          "old_api": "CalculateTotalInputSize",
          "new_api": "num_input_levels",
          "old_text": "compaction->CalculateTotalInputSize()",
          "new_text": "compaction->num_input_levels()",
          "old_line_content": "           << compaction->CalculateTotalInputSize();",
          "new_line_content": "    for (size_t i = 0; i < compaction->num_input_levels(); ++i) {",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 1536,
          "old_api": null,
          "new_api": "reset",
          "old_text": null,
          "new_text": "sub_compact.builder.reset()",
          "old_line_content": "      }",
          "new_line_content": "      sub_compact.builder.reset();",
          "content_same": false
        },
        {
          "line": 1538,
          "old_api": null,
          "new_api": "ok",
          "old_text": null,
          "new_text": "sub_status.ok()",
          "old_line_content": "  }",
          "new_line_content": "      assert(!sub_status.ok() || sub_compact.outfile == nullptr);",
          "content_same": false
        },
        {
          "line": 517,
          "old_api": null,
          "new_api": "input_version",
          "old_text": null,
          "new_text": "compact_->compaction->input_version()",
          "old_line_content": "    it++;",
          "new_line_content": "  auto* v = compact_->compaction->input_version();",
          "content_same": false
        },
        {
          "line": 518,
          "old_api": null,
          "new_api": "begin",
          "old_text": null,
          "new_text": "bounds.begin()",
          "old_line_content": "",
          "new_line_content": "  for (auto it = bounds.begin();;) {",
          "content_same": false
        },
        {
          "line": 1543,
          "old_api": null,
          "new_api": "ok",
          "old_text": null,
          "new_text": "sub_status.ok()",
          "old_line_content": "#ifndef ROCKSDB_LITE",
          "new_line_content": "      if (!sub_status.ok()) {",
          "content_same": false
        },
        {
          "line": 1544,
          "old_api": null,
          "new_api": "GetNumber",
          "old_text": null,
          "new_text": "out.meta.fd.GetNumber()",
          "old_line_content": "namespace {",
          "new_line_content": "        TableCache::Evict(table_cache_.get(), out.meta.fd.GetNumber());",
          "content_same": false
        },
        {
          "line": 522,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "bounds.end()",
          "old_line_content": "",
          "new_line_content": "    if (it == bounds.end()) {",
          "content_same": false
        },
        {
          "line": 1034,
          "old_api": null,
          "new_api": "key",
          "old_text": null,
          "new_text": "c_iter->key()",
          "old_line_content": "        // Use samples from first output file to create dictionary for",
          "new_line_content": "        next_key = &c_iter->key();",
          "content_same": false
        },
        {
          "line": 1038,
          "old_api": null,
          "new_api": "get",
          "old_text": null,
          "new_text": "range_del_agg.get()",
          "old_line_content": "              dict_sample_data, kSampleLenShift,",
          "new_line_content": "                                          range_del_agg.get(),",
          "content_same": false
        },
        {
          "line": 1040,
          "old_api": null,
          "new_api": "RecordDroppedKeys",
          "old_text": null,
          "new_text": "RecordDroppedKeys(range_del_out_stats,\n                        &sub_compact->compaction_job_stats)",
          "old_line_content": "                  .max_dict_bytes);",
          "new_line_content": "      RecordDroppedKeys(range_del_out_stats,",
          "content_same": false
        },
        {
          "line": 1555,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(prefix_length > 0)",
          "old_line_content": "  Compaction* compaction = compact_->compaction;",
          "new_line_content": "  assert(prefix_length > 0);",
          "content_same": false
        },
        {
          "line": 1556,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "src.size()",
          "old_line_content": "  compaction_stats_.num_input_files_in_non_output_levels = 0;",
          "new_line_content": "  size_t length = src.size() > prefix_length ? prefix_length : src.size();",
          "content_same": false
        },
        {
          "line": 533,
          "old_api": null,
          "new_api": "Lock",
          "old_text": null,
          "new_text": "db_mutex_->Lock()",
          "old_line_content": "      sum / min_file_fill_percent /",
          "new_line_content": "    db_mutex_->Lock();",
          "content_same": false
        },
        {
          "line": 1046,
          "old_api": null,
          "new_api": "output_compression_opts",
          "old_text": null,
          "new_text": "ZSTD_TrainDictionary(\n              dict_sample_data, kSampleLenShift,\n              sub_compact->compaction->output_compression_opts()\n                  .max_dict_bytes)",
          "old_line_content": "  }",
          "new_line_content": "          sub_compact->compression_dict = ZSTD_TrainDictionary(",
          "content_same": false
        },
        {
          "line": 1557,
          "old_api": null,
          "new_api": "data",
          "old_text": null,
          "new_text": "src.data()",
          "old_line_content": "  compaction_stats_.num_input_files_in_output_level = 0;",
          "new_line_content": "  dst->assign(src.data(), length);",
          "content_same": false
        },
        {
          "line": 1048,
          "old_api": null,
          "new_api": "output_compression_opts",
          "old_text": null,
          "new_text": "sub_compact->compaction->output_compression_opts()",
          "old_line_content": "  sub_compact->num_input_records = c_iter_stats.num_input_records;",
          "new_line_content": "              sub_compact->compaction->output_compression_opts()",
          "content_same": false
        },
        {
          "line": 1051,
          "old_api": null,
          "new_api": "std::move(dict_sample_data)",
          "old_text": null,
          "new_text": "std::move(dict_sample_data)",
          "old_line_content": "  sub_compact->compaction_job_stats.num_corrupt_keys =",
          "new_line_content": "          sub_compact->compression_dict = std::move(dict_sample_data);",
          "content_same": false
        },
        {
          "line": 540,
          "old_api": null,
          "new_api": "storage_info",
          "old_text": null,
          "new_text": "v->storage_info()->base_level()",
          "old_line_content": "                max_output_files});",
          "new_line_content": "  int base_level = v->storage_info()->base_level();",
          "content_same": false
        },
        {
          "line": 541,
          "old_api": null,
          "new_api": "mutable_cf_options",
          "old_text": null,
          "new_text": "std::ceil(\n      sum / min_file_fill_percent /\n      MaxFileSizeForLevel(*(c->mutable_cf_options()), out_lvl,\n          c->immutable_cf_options()->compaction_style, base_level,\n          c->immutable_cf_options()->level_compaction_dynamic_level_bytes))",
          "old_line_content": "",
          "new_line_content": "  uint64_t max_output_files = static_cast<uint64_t>(std::ceil(",
          "content_same": false
        },
        {
          "line": 543,
          "old_api": null,
          "new_api": "mutable_cf_options",
          "old_text": null,
          "new_text": "c->mutable_cf_options()",
          "old_line_content": "    double mean = sum * 1.0 / subcompactions;",
          "new_line_content": "      MaxFileSizeForLevel(*(c->mutable_cf_options()), out_lvl,",
          "content_same": false
        },
        {
          "line": 544,
          "old_api": null,
          "new_api": "immutable_cf_options",
          "old_text": null,
          "new_text": "c->immutable_cf_options()",
          "old_line_content": "    // Greedily add ranges to the subcompaction until the sum of the ranges'",
          "new_line_content": "          c->immutable_cf_options()->compaction_style, base_level,",
          "content_same": false
        },
        {
          "line": 545,
          "old_api": null,
          "new_api": "immutable_cf_options",
          "old_text": null,
          "new_text": "c->immutable_cf_options()",
          "old_line_content": "    // sizes becomes >= the expected mean size of a subcompaction",
          "new_line_content": "          c->immutable_cf_options()->level_compaction_dynamic_level_bytes)));",
          "content_same": false
        },
        {
          "line": 1568,
          "old_api": null,
          "new_api": "num_input_levels",
          "old_text": null,
          "new_text": "compaction->num_input_levels()",
          "old_line_content": "          &compaction_stats_.bytes_read_output_level, input_level);",
          "new_line_content": "       input_level < static_cast<int>(compaction->num_input_levels());",
          "content_same": false
        },
        {
          "line": 1570,
          "old_api": null,
          "new_api": "output_level",
          "old_text": null,
          "new_text": "compaction->output_level()",
          "old_line_content": "  }",
          "new_line_content": "    if (compaction->level(input_level) != compaction->output_level()) {",
          "content_same": false
        },
        {
          "line": 548,
          "old_api": null,
          "new_api": "max_subcompactions",
          "old_text": null,
          "new_text": "c->max_subcompactions()",
          "old_line_content": "      sum += ranges[i].size;",
          "new_line_content": "                static_cast<uint64_t>(c->max_subcompactions()),",
          "content_same": false
        },
        {
          "line": 1571,
          "old_api": null,
          "new_api": "UpdateCompactionInputStatsHelper",
          "old_text": null,
          "new_text": "UpdateCompactionInputStatsHelper(\n          &compaction_stats_.num_input_files_in_non_output_levels,\n          &compaction_stats_.bytes_read_non_output_levels, input_level)",
          "old_line_content": "",
          "new_line_content": "      UpdateCompactionInputStatsHelper(",
          "content_same": false
        },
        {
          "line": 1575,
          "old_api": null,
          "new_api": "UpdateCompactionInputStatsHelper",
          "old_text": null,
          "new_text": "UpdateCompactionInputStatsHelper(\n          &compaction_stats_.num_input_files_in_output_level,\n          &compaction_stats_.bytes_read_output_level, input_level)",
          "old_line_content": "      // An error occurred so ignore the last output.",
          "new_line_content": "      UpdateCompactionInputStatsHelper(",
          "content_same": false
        },
        {
          "line": 1582,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "sub_compact.outputs.size()",
          "old_line_content": "      compaction_stats_.bytes_written += out.meta.fd.file_size;",
          "new_line_content": "    size_t num_output_files = sub_compact.outputs.size();",
          "content_same": false
        },
        {
          "line": 1071,
          "old_api": null,
          "new_api": "RecordTick",
          "old_text": null,
          "new_text": "RecordTick(stats_, FILTER_OPERATION_TOTAL_TIME,\n             c_iter_stats.total_filter_time)",
          "old_line_content": "  }",
          "new_line_content": "  RecordTick(stats_, FILTER_OPERATION_TOTAL_TIME,",
          "content_same": false
        },
        {
          "line": 1585,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(num_output_files > 0)",
          "old_line_content": "      compaction_stats_.num_dropped_records +=",
          "new_line_content": "      assert(num_output_files > 0);",
          "content_same": false
        },
        {
          "line": 1074,
          "old_api": null,
          "new_api": "RecordCompactionIOStats",
          "old_text": null,
          "new_text": "RecordCompactionIOStats()",
          "old_line_content": "  }",
          "new_line_content": "  RecordCompactionIOStats();",
          "content_same": false
        },
        {
          "line": 1588,
          "old_api": null,
          "new_api": "static_cast<int>(num_output_files)",
          "old_text": null,
          "new_text": "static_cast<int>(num_output_files)",
          "old_line_content": "  }",
          "new_line_content": "    compaction_stats_.num_output_files += static_cast<int>(num_output_files);",
          "content_same": false
        },
        {
          "line": 565,
          "old_api": null,
          "new_api": "emplace_back",
          "old_text": null,
          "new_text": "sizes_.emplace_back(sum)",
          "old_line_content": "  }",
          "new_line_content": "        sizes_.emplace_back(sum);",
          "content_same": false
        },
        {
          "line": 1077,
          "old_api": null,
          "new_api": "IsDropped",
          "old_text": null,
          "new_text": "cfd->IsDropped()",
          "old_line_content": "  }",
          "new_line_content": "      (shutting_down_->load(std::memory_order_relaxed) || cfd->IsDropped())) {",
          "content_same": false
        },
        {
          "line": 1078,
          "old_api": null,
          "new_api": "Status::ShutdownInProgress(\n        \"Database shutdown or Column family drop during compaction\")",
          "old_text": null,
          "new_text": "Status::ShutdownInProgress(\n        \"Database shutdown or Column family drop during compaction\")",
          "old_line_content": "",
          "new_line_content": "    status = Status::ShutdownInProgress(",
          "content_same": false
        },
        {
          "line": 570,
          "old_api": null,
          "new_api": "back",
          "old_text": null,
          "new_text": "ranges.back()",
          "old_line_content": "      ThreadStatus::STAGE_COMPACTION_RUN);",
          "new_line_content": "    sizes_.emplace_back(sum + ranges.back().size);",
          "content_same": false
        },
        {
          "line": 1082,
          "old_api": null,
          "new_api": "status",
          "old_text": null,
          "new_text": "input->status()",
          "old_line_content": "    // handle subcompaction containing only range deletions",
          "new_line_content": "    status = input->status();",
          "content_same": false
        },
        {
          "line": 1084,
          "old_api": null,
          "new_api": "ok",
          "old_text": null,
          "new_text": "status.ok()",
          "old_line_content": "  }",
          "new_line_content": "  if (status.ok()) {",
          "content_same": false
        },
        {
          "line": 1085,
          "old_api": null,
          "new_api": "status",
          "old_text": null,
          "new_text": "c_iter->status()",
          "old_line_content": "",
          "new_line_content": "    status = c_iter->status();",
          "content_same": false
        },
        {
          "line": 1088,
          "old_api": null,
          "new_api": "ok",
          "old_text": null,
          "new_text": "status.ok()",
          "old_line_content": "  if (sub_compact->builder != nullptr) {",
          "new_line_content": "  if (status.ok() && sub_compact->builder == nullptr &&",
          "content_same": false
        },
        {
          "line": 1089,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "sub_compact->outputs.size()",
          "old_line_content": "    CompactionIterationStats range_del_out_stats;",
          "new_line_content": "      sub_compact->outputs.size() == 0 &&",
          "content_same": false
        },
        {
          "line": 580,
          "old_api": null,
          "new_api": "TEST_SYNC_POINT",
          "old_text": null,
          "new_text": "TEST_SYNC_POINT(\"CompactionJob::Run():Start\")",
          "old_line_content": "  std::vector<port::Thread> thread_pool;",
          "new_line_content": "  TEST_SYNC_POINT(\"CompactionJob::Run():Start\");",
          "content_same": false
        },
        {
          "line": 1604,
          "old_api": null,
          "new_api": "num_input_files",
          "old_text": null,
          "new_text": "compaction->num_input_files(input_level)",
          "old_line_content": "}",
          "new_line_content": "  auto num_input_files = compaction->num_input_files(input_level);",
          "content_same": false
        },
        {
          "line": 1605,
          "old_api": null,
          "new_api": "static_cast<int>(num_input_files)",
          "old_text": null,
          "new_text": "static_cast<int>(num_input_files)",
          "old_line_content": "",
          "new_line_content": "  *num_files += static_cast<int>(num_input_files);",
          "content_same": false
        },
        {
          "line": 584,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "compact_->sub_compact_states.size()",
          "old_line_content": "                             &compact_->sub_compact_states[i]);",
          "new_line_content": "  const size_t num_threads = compact_->sub_compact_states.size();",
          "content_same": false
        },
        {
          "line": 585,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(num_threads > 0)",
          "old_line_content": "  }",
          "new_line_content": "  assert(num_threads > 0);",
          "content_same": false
        },
        {
          "line": 586,
          "old_api": null,
          "new_api": "NowMicros",
          "old_text": null,
          "new_text": "env_->NowMicros()",
          "old_line_content": "",
          "new_line_content": "  const uint64_t start_micros = env_->NowMicros();",
          "content_same": false
        },
        {
          "line": 1099,
          "old_api": null,
          "new_api": "get",
          "old_text": null,
          "new_text": "FinishCompactionOutputFile(\n        status, sub_compact, range_del_agg.get(), &range_del_out_stats)",
          "old_line_content": "    sub_compact->compaction_job_stats.file_write_nanos +=",
          "new_line_content": "    Status s = FinishCompactionOutputFile(",
          "content_same": false
        },
        {
          "line": 1608,
          "old_api": null,
          "new_api": "input",
          "old_text": null,
          "new_text": "compaction->input(input_level, i)",
          "old_line_content": "#ifndef ROCKSDB_LITE",
          "new_line_content": "    const auto* file_meta = compaction->input(input_level, i);",
          "content_same": false
        },
        {
          "line": 1101,
          "old_api": null,
          "new_api": "ok",
          "old_text": null,
          "new_text": "status.ok()",
          "old_line_content": "    sub_compact->compaction_job_stats.file_fsync_nanos +=",
          "new_line_content": "    if (status.ok()) {",
          "content_same": false
        },
        {
          "line": 590,
          "old_api": null,
          "new_api": "reserve",
          "old_text": null,
          "new_text": "thread_pool.reserve(num_threads - 1)",
          "old_line_content": "",
          "new_line_content": "  thread_pool.reserve(num_threads - 1);",
          "content_same": false
        },
        {
          "line": 591,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "compact_->sub_compact_states.size()",
          "old_line_content": "  // Wait for all other threads (if there are any) to finish execution",
          "new_line_content": "  for (size_t i = 1; i < compact_->sub_compact_states.size(); i++) {",
          "content_same": false
        },
        {
          "line": 592,
          "old_api": null,
          "new_api": "emplace_back",
          "old_text": null,
          "new_text": "thread_pool.emplace_back(&CompactionJob::ProcessKeyValueCompaction, this,\n                             &compact_->sub_compact_states[i])",
          "old_line_content": "  for (auto& thread : thread_pool) {",
          "new_line_content": "    thread_pool.emplace_back(&CompactionJob::ProcessKeyValueCompaction, this,",
          "content_same": false
        },
        {
          "line": 1609,
          "old_api": null,
          "new_api": "GetFileSize",
          "old_text": null,
          "new_text": "file_meta->fd.GetFileSize()",
          "old_line_content": "  if (compaction_job_stats_) {",
          "new_line_content": "    *bytes_read += file_meta->fd.GetFileSize();",
          "content_same": false
        },
        {
          "line": 1611,
          "old_api": null,
          "new_api": "static_cast<uint64_t>(file_meta->num_entries)",
          "old_text": null,
          "new_text": "static_cast<uint64_t>(file_meta->num_entries)",
          "old_line_content": "",
          "new_line_content": "        static_cast<uint64_t>(file_meta->num_entries);",
          "content_same": false
        },
        {
          "line": 1109,
          "old_api": null,
          "new_api": "IOSTATS",
          "old_text": null,
          "new_text": "IOSTATS(write_nanos)",
          "old_line_content": "    }",
          "new_line_content": "        IOSTATS(write_nanos) - prev_write_nanos;",
          "content_same": false
        },
        {
          "line": 598,
          "old_api": null,
          "new_api": "ProcessKeyValueCompaction",
          "old_text": null,
          "new_text": "ProcessKeyValueCompaction(&compact_->sub_compact_states[0])",
          "old_line_content": "",
          "new_line_content": "  ProcessKeyValueCompaction(&compact_->sub_compact_states[0]);",
          "content_same": false
        },
        {
          "line": 1111,
          "old_api": null,
          "new_api": "IOSTATS",
          "old_text": null,
          "new_text": "IOSTATS(fsync_nanos)",
          "old_line_content": "",
          "new_line_content": "        IOSTATS(fsync_nanos) - prev_fsync_nanos;",
          "content_same": false
        },
        {
          "line": 602,
          "old_api": null,
          "new_api": "join",
          "old_text": null,
          "new_text": "thread.join()",
          "old_line_content": "  Status status;",
          "new_line_content": "    thread.join();",
          "content_same": false
        },
        {
          "line": 1115,
          "old_api": null,
          "new_api": "IOSTATS",
          "old_text": null,
          "new_text": "IOSTATS(prepare_write_nanos)",
          "old_line_content": "}",
          "new_line_content": "        IOSTATS(prepare_write_nanos) - prev_prepare_write_nanos;",
          "content_same": false
        },
        {
          "line": 605,
          "old_api": null,
          "new_api": "NowMicros",
          "old_text": null,
          "new_text": "env_->NowMicros()",
          "old_line_content": "      status = state.status;",
          "new_line_content": "  compaction_stats_.micros = env_->NowMicros() - start_micros;",
          "content_same": false
        },
        {
          "line": 606,
          "old_api": null,
          "new_api": "MeasureTime",
          "old_text": null,
          "new_text": "MeasureTime(stats_, COMPACTION_TIME, compaction_stats_.micros)",
          "old_line_content": "      break;",
          "new_line_content": "  MeasureTime(stats_, COMPACTION_TIME, compaction_stats_.micros);",
          "content_same": false
        },
        {
          "line": 1117,
          "old_api": null,
          "new_api": "SetPerfLevel",
          "old_text": null,
          "new_text": "SetPerfLevel(prev_perf_level)",
          "old_line_content": "void CompactionJob::RecordDroppedKeys(",
          "new_line_content": "      SetPerfLevel(prev_perf_level);",
          "content_same": false
        },
        {
          "line": 608,
          "old_api": null,
          "new_api": "TEST_SYNC_POINT",
          "old_text": null,
          "new_text": "TEST_SYNC_POINT(\"CompactionJob::Run:BeforeVerify\")",
          "old_line_content": "  }",
          "new_line_content": "  TEST_SYNC_POINT(\"CompactionJob::Run:BeforeVerify\");",
          "content_same": false
        },
        {
          "line": 1122,
          "old_api": null,
          "new_api": "reset",
          "old_text": null,
          "new_text": "input.reset()",
          "old_line_content": "               c_iter_stats.num_record_drop_user);",
          "new_line_content": "  input.reset();",
          "content_same": false
        },
        {
          "line": 1636,
          "old_api": null,
          "new_api": "NumOutputFiles",
          "old_text": null,
          "new_text": "compact_->NumOutputFiles()",
          "old_line_content": "#else",
          "new_line_content": "    if (compact_->NumOutputFiles() > 0U) {",
          "content_same": false
        },
        {
          "line": 613,
          "old_api": null,
          "new_api": "ok",
          "old_text": null,
          "new_text": "state.status.ok()",
          "old_line_content": "",
          "new_line_content": "    if (!state.status.ok()) {",
          "content_same": false
        },
        {
          "line": 1637,
          "old_api": null,
          "new_api": "SmallestUserKey",
          "old_text": null,
          "new_text": "compact_->SmallestUserKey()",
          "old_line_content": "  (void)stats;",
          "new_line_content": "      CopyPrefix(compact_->SmallestUserKey(),",
          "content_same": false
        },
        {
          "line": 1640,
          "old_api": null,
          "new_api": "LargestUserKey",
          "old_text": null,
          "new_text": "compact_->LargestUserKey()",
          "old_line_content": "",
          "new_line_content": "      CopyPrefix(compact_->LargestUserKey(),",
          "content_same": false
        },
        {
          "line": 1130,
          "old_api": null,
          "new_api": "RecordTick",
          "old_text": null,
          "new_text": "RecordTick(stats_, COMPACTION_KEY_DROP_USER,\n               c_iter_stats.num_record_drop_user)",
          "old_line_content": "    }",
          "new_line_content": "    RecordTick(stats_, COMPACTION_KEY_DROP_USER,",
          "content_same": false
        },
        {
          "line": 620,
          "old_api": null,
          "new_api": "Fsync",
          "old_text": null,
          "new_text": "output_directory_->Fsync()",
          "old_line_content": "      }",
          "new_line_content": "    status = output_directory_->Fsync();",
          "content_same": false
        },
        {
          "line": 1134,
          "old_api": null,
          "new_api": "RecordTick",
          "old_text": null,
          "new_text": "RecordTick(stats_, COMPACTION_KEY_DROP_NEWER_ENTRY,\n               c_iter_stats.num_record_drop_hidden)",
          "old_line_content": "               c_iter_stats.num_record_drop_obsolete);",
          "new_line_content": "    RecordTick(stats_, COMPACTION_KEY_DROP_NEWER_ENTRY,",
          "content_same": false
        },
        {
          "line": 623,
          "old_api": null,
          "new_api": "ok",
          "old_text": null,
          "new_text": "status.ok()",
          "old_line_content": "    auto prefix_extractor =",
          "new_line_content": "  if (status.ok()) {",
          "content_same": false
        },
        {
          "line": 1142,
          "old_api": null,
          "new_api": "RecordTick",
          "old_text": null,
          "new_text": "RecordTick(stats_, COMPACTION_KEY_DROP_OBSOLETE,\n               c_iter_stats.num_record_drop_obsolete)",
          "old_line_content": "               c_iter_stats.num_record_drop_range_del);",
          "new_line_content": "    RecordTick(stats_, COMPACTION_KEY_DROP_OBSOLETE,",
          "content_same": false
        },
        {
          "line": 631,
          "old_api": null,
          "new_api": "column_family_data",
          "old_text": null,
          "new_text": "compact_->compaction->column_family_data()",
          "old_line_content": "        }",
          "new_line_content": "    ColumnFamilyData* cfd = compact_->compaction->column_family_data();",
          "content_same": false
        },
        {
          "line": 633,
          "old_api": null,
          "new_api": "get",
          "old_text": null,
          "new_text": "compact_->compaction->mutable_cf_options()->prefix_extractor.get()",
          "old_line_content": "        // We set for_compaction to false and don't OptimizeForCompactionTableRead",
          "new_line_content": "        compact_->compaction->mutable_cf_options()->prefix_extractor.get();",
          "content_same": false
        },
        {
          "line": 1660,
          "old_api": null,
          "new_api": "c_str",
          "old_text": null,
          "new_text": "cfd->GetName().c_str()",
          "old_line_content": "           << \"compaction_started\"",
          "new_line_content": "        cfd->GetName().c_str(), job_id_,",
          "content_same": false
        },
        {
          "line": 637,
          "old_api": null,
          "new_api": "fetch_add",
          "old_text": null,
          "new_text": "next_file_meta_idx.fetch_add(1)",
          "old_line_content": "        // to cache it here for further user reads",
          "new_line_content": "        size_t file_idx = next_file_meta_idx.fetch_add(1);",
          "content_same": false
        },
        {
          "line": 1150,
          "old_api": null,
          "new_api": "RecordTick",
          "old_text": null,
          "new_text": "RecordTick(stats_, COMPACTION_KEY_DROP_RANGE_DEL,\n               c_iter_stats.num_record_drop_range_del)",
          "old_line_content": "               c_iter_stats.num_optimized_del_drop_obsolete);",
          "new_line_content": "    RecordTick(stats_, COMPACTION_KEY_DROP_RANGE_DEL,",
          "content_same": false
        },
        {
          "line": 1661,
          "old_api": null,
          "new_api": "score",
          "old_text": null,
          "new_text": "compaction->score()",
          "old_line_content": "           << \"compaction_reason\"",
          "new_line_content": "        compaction->InputLevelSummary(&inputs_summary), compaction->score());",
          "content_same": false
        },
        {
          "line": 1154,
          "old_api": null,
          "new_api": "RecordTick",
          "old_text": null,
          "new_text": "RecordTick(stats_, COMPACTION_RANGE_DEL_DROP_OBSOLETE,\n               c_iter_stats.num_range_del_drop_obsolete)",
          "old_line_content": "Status CompactionJob::FinishCompactionOutputFile(",
          "new_line_content": "    RecordTick(stats_, COMPACTION_RANGE_DEL_DROP_OBSOLETE,",
          "content_same": false
        },
        {
          "line": 1158,
          "old_api": null,
          "new_api": "RecordTick",
          "old_text": null,
          "new_text": "RecordTick(stats_, COMPACTION_OPTIMIZED_DEL_DROP_OBSOLETE,\n               c_iter_stats.num_optimized_del_drop_obsolete)",
          "old_line_content": "    const Slice* next_table_min_key /* = nullptr */) {",
          "new_line_content": "    RecordTick(stats_, COMPACTION_OPTIMIZED_DEL_DROP_OBSOLETE,",
          "content_same": false
        },
        {
          "line": 647,
          "old_api": null,
          "new_api": "table_cache",
          "old_text": null,
          "new_text": "cfd->table_cache()->NewIterator(\n            ReadOptions(), env_options_, cfd->internal_comparator(),\n            *files_meta[file_idx], nullptr /* range_del_agg */,\n            prefix_extractor, nullptr,\n            cfd->internal_stats()->GetFileReadHist(\n                compact_->compaction->output_level()),\n            false, nullptr /* arena */, false /* skip_filters */,\n            compact_->compaction->output_level())",
          "old_line_content": "",
          "new_line_content": "        InternalIterator* iter = cfd->table_cache()->NewIterator(",
          "content_same": false
        },
        {
          "line": 1673,
          "old_api": null,
          "new_api": "level",
          "old_text": null,
          "new_text": "compaction->level(i)",
          "old_line_content": "  }",
          "new_line_content": "      stream << (\"files_L\" + ToString(compaction->level(i)));",
          "content_same": false
        },
        {
          "line": 1674,
          "old_api": null,
          "new_api": "StartArray",
          "old_text": null,
          "new_text": "stream.StartArray()",
          "old_line_content": "}",
          "new_line_content": "      stream.StartArray();",
          "content_same": false
        },
        {
          "line": 651,
          "old_api": null,
          "new_api": "internal_stats",
          "old_text": null,
          "new_text": "cfd->internal_stats()->GetFileReadHist(\n                compact_->compaction->output_level())",
          "old_line_content": "        }",
          "new_line_content": "            cfd->internal_stats()->GetFileReadHist(",
          "content_same": false
        },
        {
          "line": 652,
          "old_api": null,
          "new_api": "output_level",
          "old_text": null,
          "new_text": "compact_->compaction->output_level()",
          "old_line_content": "",
          "new_line_content": "                compact_->compaction->output_level()),",
          "content_same": false
        },
        {
          "line": 1675,
          "old_api": null,
          "new_api": "inputs",
          "old_text": null,
          "new_text": "compaction->inputs(i)",
          "old_line_content": "",
          "new_line_content": "      for (auto f : *compaction->inputs(i)) {",
          "content_same": false
        },
        {
          "line": 654,
          "old_api": null,
          "new_api": "output_level",
          "old_text": null,
          "new_text": "compact_->compaction->output_level()",
          "old_line_content": "",
          "new_line_content": "            compact_->compaction->output_level());",
          "content_same": false
        },
        {
          "line": 1676,
          "old_api": null,
          "new_api": "GetNumber",
          "old_text": null,
          "new_text": "f->fd.GetNumber()",
          "old_line_content": "}  // namespace rocksdb",
          "new_line_content": "        stream << f->fd.GetNumber();",
          "content_same": false
        },
        {
          "line": 1678,
          "old_api": null,
          "new_api": "EndArray",
          "old_text": null,
          "new_text": "stream.EndArray()",
          "old_line_content": "",
          "new_line_content": "      stream.EndArray();",
          "content_same": false
        },
        {
          "line": 657,
          "old_api": null,
          "new_api": "ok",
          "old_text": null,
          "new_text": "s.ok()",
          "old_line_content": "          break;",
          "new_line_content": "        if (s.ok() && paranoid_file_checks_) {",
          "content_same": false
        },
        {
          "line": 658,
          "old_api": null,
          "new_api": "Next",
          "old_text": null,
          "new_text": "iter->Next()",
          "old_line_content": "        }",
          "new_line_content": "          for (iter->SeekToFirst(); iter->Valid(); iter->Next()) {}",
          "content_same": false
        },
        {
          "line": 659,
          "old_api": null,
          "new_api": "status",
          "old_text": null,
          "new_text": "iter->status()",
          "old_line_content": "      }",
          "new_line_content": "          s = iter->status();",
          "content_same": false
        },
        {
          "line": 1171,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(sub_compact->outfile)",
          "old_line_content": "",
          "new_line_content": "  assert(sub_compact->outfile);",
          "content_same": false
        },
        {
          "line": 1172,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(sub_compact->builder != nullptr)",
          "old_line_content": "  // Check for iterator errors",
          "new_line_content": "  assert(sub_compact->builder != nullptr);",
          "content_same": false
        },
        {
          "line": 1173,
          "old_api": null,
          "new_api": "current_output",
          "old_text": null,
          "new_text": "sub_compact->current_output()",
          "old_line_content": "  Status s = input_status;",
          "new_line_content": "  assert(sub_compact->current_output() != nullptr);",
          "content_same": false
        },
        {
          "line": 1680,
          "old_api": null,
          "new_api": "score",
          "old_text": null,
          "new_text": "compaction->score()",
          "old_line_content": "",
          "new_line_content": "    stream << \"score\" << compaction->score() << \"input_data_size\"",
          "content_same": false
        },
        {
          "line": 664,
          "old_api": null,
          "new_api": "ok",
          "old_text": null,
          "new_text": "s.ok()",
          "old_line_content": "    }",
          "new_line_content": "        if (!s.ok()) {",
          "content_same": false
        },
        {
          "line": 1681,
          "old_api": null,
          "new_api": "CalculateTotalInputSize",
          "old_text": null,
          "new_text": "compaction->CalculateTotalInputSize()",
          "old_line_content": "",
          "new_line_content": "           << compaction->CalculateTotalInputSize();",
          "content_same": false
        },
        {
          "line": 1178,
          "old_api": null,
          "new_api": "column_family_data",
          "old_text": null,
          "new_text": "sub_compact->compaction->column_family_data()",
          "old_line_content": "    std::string smallest_user_key;",
          "new_line_content": "  ColumnFamilyData* cfd = sub_compact->compaction->column_family_data();",
          "content_same": false
        },
        {
          "line": 1179,
          "old_api": null,
          "new_api": "user_comparator",
          "old_text": null,
          "new_text": "cfd->user_comparator()",
          "old_line_content": "    const Slice *lower_bound, *upper_bound;",
          "new_line_content": "  const Comparator* ucmp = cfd->user_comparator();",
          "content_same": false
        },
        {
          "line": 671,
          "old_api": null,
          "new_api": "emplace_back",
          "old_text": null,
          "new_text": "thread_pool.emplace_back(verify_table,\n                               std::ref(compact_->sub_compact_states[i].status))",
          "old_line_content": "        status = state.status;",
          "new_line_content": "      thread_pool.emplace_back(verify_table,",
          "content_same": false
        },
        {
          "line": 672,
          "old_api": null,
          "new_api": "std::ref(compact_->sub_compact_states[i].status)",
          "old_text": null,
          "new_text": "std::ref(compact_->sub_compact_states[i].status)",
          "old_line_content": "        break;",
          "new_line_content": "                               std::ref(compact_->sub_compact_states[i].status));",
          "content_same": false
        },
        {
          "line": 1183,
          "old_api": null,
          "new_api": "current_output",
          "old_text": null,
          "new_text": "sub_compact->current_output()",
          "old_line_content": "      lower_bound = sub_compact->start;",
          "new_line_content": "  auto meta = &sub_compact->current_output()->meta;",
          "content_same": false
        },
        {
          "line": 674,
          "old_api": null,
          "new_api": "verify_table",
          "old_text": null,
          "new_text": "verify_table(compact_->sub_compact_states[0].status)",
          "old_line_content": "    }",
          "new_line_content": "    verify_table(compact_->sub_compact_states[0].status);",
          "content_same": false
        },
        {
          "line": 1185,
          "old_api": null,
          "new_api": "ok",
          "old_text": null,
          "new_text": "s.ok()",
          "old_line_content": "      // For subsequent output tables, only include range tombstones from min",
          "new_line_content": "  if (s.ok()) {",
          "content_same": false
        },
        {
          "line": 676,
          "old_api": null,
          "new_api": "join",
          "old_text": null,
          "new_text": "thread.join()",
          "old_line_content": "",
          "new_line_content": "      thread.join();",
          "content_same": false
        },
        {
          "line": 679,
          "old_api": null,
          "new_api": "ok",
          "old_text": null,
          "new_text": "state.status.ok()",
          "old_line_content": "    for (const auto& output : state.outputs) {",
          "new_line_content": "      if (!state.status.ok()) {",
          "content_same": false
        },
        {
          "line": 1193,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "meta->smallest.size()",
          "old_line_content": "    }",
          "new_line_content": "    } else if (meta->smallest.size() > 0) {",
          "content_same": false
        },
        {
          "line": 1198,
          "old_api": null,
          "new_api": "Slice",
          "old_text": null,
          "new_text": "Slice(smallest_user_key)",
          "old_line_content": "      upper_bound = &upper_bound_guard;",
          "new_line_content": "      lower_bound_guard = Slice(smallest_user_key);",
          "content_same": false
        },
        {
          "line": 1206,
          "old_api": null,
          "new_api": "ExtractUserKey",
          "old_text": null,
          "new_text": "ExtractUserKey(*next_table_min_key)",
          "old_line_content": "      earliest_snapshot = existing_snapshots_[0];",
          "new_line_content": "      upper_bound_guard = ExtractUserKey(*next_table_min_key);",
          "content_same": false
        },
        {
          "line": 695,
          "old_api": null,
          "new_api": "std::move(tp)",
          "old_text": null,
          "new_text": "std::move(tp)",
          "old_line_content": "  compact_->status = status;",
          "new_line_content": "  compact_->compaction->SetOutputTableProperties(std::move(tp));",
          "content_same": false
        },
        {
          "line": 698,
          "old_api": null,
          "new_api": "AggregateStatistics",
          "old_text": null,
          "new_text": "AggregateStatistics()",
          "old_line_content": "",
          "new_line_content": "  AggregateStatistics();",
          "content_same": false
        },
        {
          "line": 699,
          "old_api": null,
          "new_api": "UpdateCompactionStats",
          "old_text": null,
          "new_text": "UpdateCompactionStats()",
          "old_line_content": "Status CompactionJob::Install(const MutableCFOptions& mutable_cf_options) {",
          "new_line_content": "  UpdateCompactionStats();",
          "content_same": false
        },
        {
          "line": 700,
          "old_api": null,
          "new_api": "RecordCompactionIOStats",
          "old_text": null,
          "new_text": "RecordCompactionIOStats()",
          "old_line_content": "  AutoThreadOperationStageUpdater stage_updater(",
          "new_line_content": "  RecordCompactionIOStats();",
          "content_same": false
        },
        {
          "line": 701,
          "old_api": null,
          "new_api": "LogFlush",
          "old_text": null,
          "new_text": "LogFlush(db_options_.info_log)",
          "old_line_content": "      ThreadStatus::STAGE_COMPACTION_INSTALL);",
          "new_line_content": "  LogFlush(db_options_.info_log);",
          "content_same": false
        },
        {
          "line": 1217,
          "old_api": null,
          "new_api": "NewIterator",
          "old_text": null,
          "new_text": "range_del_agg->NewIterator()",
          "old_line_content": "    } else {",
          "new_line_content": "    auto it = range_del_agg->NewIterator();",
          "content_same": false
        },
        {
          "line": 1219,
          "old_api": null,
          "new_api": "Seek",
          "old_text": null,
          "new_text": "it->Seek(*lower_bound)",
          "old_line_content": "    }",
          "new_line_content": "      it->Seek(*lower_bound);",
          "content_same": false
        },
        {
          "line": 711,
          "old_api": null,
          "new_api": "AssertHeld",
          "old_text": null,
          "new_text": "db_mutex_->AssertHeld()",
          "old_line_content": "  VersionStorageInfo::LevelSummaryStorage tmp;",
          "new_line_content": "  db_mutex_->AssertHeld();",
          "content_same": false
        },
        {
          "line": 713,
          "old_api": null,
          "new_api": "column_family_data",
          "old_text": null,
          "new_text": "compact_->compaction->column_family_data()",
          "old_line_content": "  const auto& stats = compaction_stats_;",
          "new_line_content": "  ColumnFamilyData* cfd = compact_->compaction->column_family_data();",
          "content_same": false
        },
        {
          "line": 714,
          "old_api": null,
          "new_api": "internal_stats",
          "old_text": null,
          "new_text": "cfd->internal_stats()->AddCompactionStats(\n      compact_->compaction->output_level(), compaction_stats_)",
          "old_line_content": "",
          "new_line_content": "  cfd->internal_stats()->AddCompactionStats(",
          "content_same": false
        },
        {
          "line": 715,
          "old_api": null,
          "new_api": "output_level",
          "old_text": null,
          "new_text": "compact_->compaction->output_level()",
          "old_line_content": "  double read_write_amp = 0.0;",
          "new_line_content": "      compact_->compaction->output_level(), compaction_stats_);",
          "content_same": false
        },
        {
          "line": 1225,
          "old_api": null,
          "new_api": "user_key",
          "old_text": null,
          "new_text": "meta->largest.user_key()",
          "old_line_content": "            (!has_overlapping_endpoints && cmp <= 0)) {",
          "new_line_content": "          ucmp->Compare(meta->largest.user_key(), *upper_bound) == 0;",
          "content_same": false
        },
        {
          "line": 717,
          "old_api": null,
          "new_api": "ok",
          "old_text": null,
          "new_text": "status.ok()",
          "old_line_content": "  double bytes_read_per_sec = 0;",
          "new_line_content": "  if (status.ok()) {",
          "content_same": false
        },
        {
          "line": 718,
          "old_api": null,
          "new_api": "InstallCompactionResults",
          "old_text": null,
          "new_text": "InstallCompactionResults(mutable_cf_options)",
          "old_line_content": "  double bytes_written_per_sec = 0;",
          "new_line_content": "    status = InstallCompactionResults(mutable_cf_options);",
          "content_same": false
        },
        {
          "line": 1229,
          "old_api": null,
          "new_api": "Next",
          "old_text": null,
          "new_text": "it->Next()",
          "old_line_content": "          // tombstones that start exactly at upper_bound. Such range tombstones",
          "new_line_content": "    for (; it->Valid(); it->Next()) {",
          "content_same": false
        },
        {
          "line": 1230,
          "old_api": null,
          "new_api": "Tombstone",
          "old_text": null,
          "new_text": "it->Tombstone()",
          "old_line_content": "          // will be included in the next file and are not relevant to the point",
          "new_line_content": "      auto tombstone = it->Tombstone();",
          "content_same": false
        },
        {
          "line": 721,
          "old_api": null,
          "new_api": "current",
          "old_text": null,
          "new_text": "cfd->current()->storage_info()",
          "old_line_content": "    read_write_amp = (stats.bytes_written + stats.bytes_read_output_level +",
          "new_line_content": "  auto vstorage = cfd->current()->storage_info();",
          "content_same": false
        },
        {
          "line": 1232,
          "old_api": null,
          "new_api": "Compare",
          "old_text": null,
          "new_text": "ucmp->Compare(*upper_bound, tombstone.start_key_)",
          "old_line_content": "          break;",
          "new_line_content": "        int cmp = ucmp->Compare(*upper_bound, tombstone.start_key_);",
          "content_same": false
        },
        {
          "line": 734,
          "old_api": null,
          "new_api": "static_cast<double>(stats.bytes_read_non_output_levels)",
          "old_text": null,
          "new_text": "static_cast<double>(stats.bytes_read_non_output_levels)",
          "old_line_content": "",
          "new_line_content": "                static_cast<double>(stats.bytes_read_non_output_levels);",
          "content_same": false
        },
        {
          "line": 739,
          "old_api": null,
          "new_api": "static_cast<double>(stats.micros)",
          "old_text": null,
          "new_text": "static_cast<double>(stats.micros)",
          "old_line_content": "      \"MB in(%.1f, %.1f) out(%.1f), read-write-amplify(%.1f) \"",
          "new_line_content": "        static_cast<double>(stats.micros);",
          "content_same": false
        },
        {
          "line": 741,
          "old_api": null,
          "new_api": "static_cast<double>(stats.micros)",
          "old_text": null,
          "new_text": "static_cast<double>(stats.micros)",
          "old_line_content": "      \", records dropped: %\" PRIu64 \" output_compression: %s\\n\",",
          "new_line_content": "        stats.bytes_written / static_cast<double>(stats.micros);",
          "content_same": false
        },
        {
          "line": 1253,
          "old_api": null,
          "new_api": "Serialize",
          "old_text": null,
          "new_text": "tombstone.Serialize()",
          "old_line_content": "        // Choose lowest seqnum so this file's smallest internal key comes",
          "new_line_content": "      auto kv = tombstone.Serialize();",
          "content_same": false
        },
        {
          "line": 1254,
          "old_api": null,
          "new_api": "Encode",
          "old_text": null,
          "new_text": "kv.first.Encode()",
          "old_line_content": "        // after the previous file's/subcompaction's largest. The fake seqnum",
          "new_line_content": "      sub_compact->builder->Add(kv.first.Encode(), kv.second);",
          "content_same": false
        },
        {
          "line": 744,
          "old_api": null,
          "new_api": "c_str",
          "old_text": null,
          "new_text": "ROCKS_LOG_BUFFER(\n      log_buffer_,\n      \"[%s] compacted to: %s, MB/sec: %.1f rd, %.1f wr, level %d, \"\n      \"files in(%d, %d) out(%d) \"\n      \"MB in(%.1f, %.1f) out(%.1f), read-write-amplify(%.1f) \"\n      \"write-amplify(%.1f) %s, records in: %\" PRIu64\n      \", records dropped: %\" PRIu64 \" output_compression: %s\\n\",\n      cfd->GetName().c_str(), vstorage->LevelSummary(&tmp), bytes_read_per_sec,\n      bytes_written_per_sec, compact_->compaction->output_level(),\n      stats.num_input_files_in_non_output_levels,\n      stats.num_input_files_in_output_level, stats.num_output_files,\n      stats.bytes_read_non_output_levels / 1048576.0,\n      stats.bytes_read_output_level / 1048576.0,\n      stats.bytes_written / 1048576.0, read_write_amp, write_amp,\n      status.ToString().c_str(), stats.num_input_records,\n      stats.num_dropped_records,\n      CompressionTypeToString(compact_->compaction->output_compression())\n          .c_str())",
          "old_line_content": "      stats.num_input_files_in_non_output_levels,",
          "new_line_content": "  ROCKS_LOG_BUFFER(",
          "content_same": false
        },
        {
          "line": 1255,
          "old_api": null,
          "new_api": "std::move(kv.first)",
          "old_text": null,
          "new_text": "std::move(kv.first)",
          "old_line_content": "        // is OK because the read path's file-picking code only considers user",
          "new_line_content": "      InternalKey smallest_candidate = std::move(kv.first);",
          "content_same": false
        },
        {
          "line": 752,
          "old_api": null,
          "new_api": "output_level",
          "old_text": null,
          "new_text": "compact_->compaction->output_level()",
          "old_line_content": "          .c_str());",
          "new_line_content": "      bytes_written_per_sec, compact_->compaction->output_level(),",
          "content_same": false
        },
        {
          "line": 1266,
          "old_api": null,
          "new_api": "InternalKey",
          "old_text": null,
          "new_text": "InternalKey(*lower_bound, 0, kTypeRangeDeletion)",
          "old_line_content": "        // Choose highest seqnum so this file's largest internal key comes",
          "new_line_content": "        smallest_candidate = InternalKey(*lower_bound, 0, kTypeRangeDeletion);",
          "content_same": false
        },
        {
          "line": 1268,
          "old_api": null,
          "new_api": "SerializeEndKey",
          "old_text": null,
          "new_text": "tombstone.SerializeEndKey()",
          "old_line_content": "        // OK because the read path's file-picking code only considers the user",
          "new_line_content": "      InternalKey largest_candidate = tombstone.SerializeEndKey();",
          "content_same": false
        },
        {
          "line": 758,
          "old_api": null,
          "new_api": "ToString",
          "old_text": null,
          "new_text": "status.ToString().c_str()",
          "old_line_content": "         << \"compaction_finished\"",
          "new_line_content": "      status.ToString().c_str(), stats.num_input_records,",
          "content_same": false
        },
        {
          "line": 1270,
          "old_api": null,
          "new_api": "user_key",
          "old_text": null,
          "new_text": "largest_candidate.user_key()",
          "old_line_content": "        //",
          "new_line_content": "          ucmp->Compare(*upper_bound, largest_candidate.user_key()) <= 0) {",
          "content_same": false
        },
        {
          "line": 763,
          "old_api": null,
          "new_api": "UpdateCompactionJobStats",
          "old_text": null,
          "new_text": "UpdateCompactionJobStats(stats)",
          "old_line_content": "         << compact_->num_input_records << \"num_output_records\"",
          "new_line_content": "  UpdateCompactionJobStats(stats);",
          "content_same": false
        },
        {
          "line": 769,
          "old_api": null,
          "new_api": "output_level",
          "old_text": null,
          "new_text": "compact_->compaction->output_level()",
          "old_line_content": "    stream << \"num_single_delete_mismatches\"",
          "new_line_content": "         << \"output_level\" << compact_->compaction->output_level()",
          "content_same": false
        },
        {
          "line": 770,
          "old_api": null,
          "new_api": "NumOutputFiles",
          "old_text": null,
          "new_text": "compact_->NumOutputFiles()",
          "old_line_content": "           << compaction_job_stats_->num_single_del_mismatch;",
          "new_line_content": "         << \"num_output_files\" << compact_->NumOutputFiles()",
          "content_same": false
        },
        {
          "line": 774,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "compact_->sub_compact_states.size()",
          "old_line_content": "",
          "new_line_content": "         << compact_->sub_compact_states.size() << \"output_compression\"",
          "content_same": false
        },
        {
          "line": 775,
          "old_api": null,
          "new_api": "output_compression",
          "old_text": null,
          "new_text": "compact_->compaction->output_compression()",
          "old_line_content": "  if (measure_io_stats_ && compaction_job_stats_ != nullptr) {",
          "new_line_content": "         << CompressionTypeToString(compact_->compaction->output_compression());",
          "content_same": false
        },
        {
          "line": 1288,
          "old_api": null,
          "new_api": "UpdateBoundariesForRange",
          "old_text": null,
          "new_text": "meta->UpdateBoundariesForRange(smallest_candidate, largest_candidate,\n                                     tombstone.seq_,\n                                     cfd->internal_comparator())",
          "old_line_content": "  } else {",
          "new_line_content": "      meta->UpdateBoundariesForRange(smallest_candidate, largest_candidate,",
          "content_same": false
        },
        {
          "line": 1290,
          "old_api": null,
          "new_api": "internal_comparator",
          "old_text": null,
          "new_text": "cfd->internal_comparator()",
          "old_line_content": "  }",
          "new_line_content": "                                     cfd->internal_comparator());",
          "content_same": false
        },
        {
          "line": 1294,
          "old_api": null,
          "new_api": "NumEntries",
          "old_text": null,
          "new_text": "sub_compact->builder->NumEntries()",
          "old_line_content": "  }",
          "new_line_content": "  const uint64_t current_entries = sub_compact->builder->NumEntries();",
          "content_same": false
        },
        {
          "line": 1296,
          "old_api": null,
          "new_api": "Finish",
          "old_text": null,
          "new_text": "sub_compact->builder->Finish()",
          "old_line_content": "  sub_compact->total_bytes += current_bytes;",
          "new_line_content": "    s = sub_compact->builder->Finish();",
          "content_same": false
        },
        {
          "line": 1298,
          "old_api": null,
          "new_api": "Abandon",
          "old_text": null,
          "new_text": "sub_compact->builder->Abandon()",
          "old_line_content": "  // Finish and check for file errors",
          "new_line_content": "    sub_compact->builder->Abandon();",
          "content_same": false
        },
        {
          "line": 1300,
          "old_api": null,
          "new_api": "FileSize",
          "old_text": null,
          "new_text": "sub_compact->builder->FileSize()",
          "old_line_content": "    StopWatch sw(env_, stats_, COMPACTION_OUTFILE_SYNC_MICROS);",
          "new_line_content": "  const uint64_t current_bytes = sub_compact->builder->FileSize();",
          "content_same": false
        },
        {
          "line": 794,
          "old_api": null,
          "new_api": "StartArray",
          "old_text": null,
          "new_text": "stream.StartArray()",
          "old_line_content": "",
          "new_line_content": "  stream.StartArray();",
          "content_same": false
        },
        {
          "line": 795,
          "old_api": null,
          "new_api": "num_levels",
          "old_text": null,
          "new_text": "vstorage->num_levels()",
          "old_line_content": "void CompactionJob::ProcessKeyValueCompaction(SubcompactionState* sub_compact) {",
          "new_line_content": "  for (int level = 0; level < vstorage->num_levels(); ++level) {",
          "content_same": false
        },
        {
          "line": 1308,
          "old_api": null,
          "new_api": "ok",
          "old_text": null,
          "new_text": "s.ok()",
          "old_line_content": "  TableProperties tp;",
          "new_line_content": "  if (s.ok()) {",
          "content_same": false
        },
        {
          "line": 798,
          "old_api": null,
          "new_api": "EndArray",
          "old_text": null,
          "new_text": "stream.EndArray()",
          "old_line_content": "  std::unique_ptr<RangeDelAggregator> range_del_agg(",
          "new_line_content": "  stream.EndArray();",
          "content_same": false
        },
        {
          "line": 1312,
          "old_api": null,
          "new_api": "ok",
          "old_text": null,
          "new_text": "s.ok()",
          "old_line_content": "",
          "new_line_content": "  if (s.ok()) {",
          "content_same": false
        },
        {
          "line": 1315,
          "old_api": null,
          "new_api": "reset",
          "old_text": null,
          "new_text": "sub_compact->outfile.reset()",
          "old_line_content": "    // This happens when the output level is bottom level, at the same time",
          "new_line_content": "  sub_compact->outfile.reset();",
          "content_same": false
        },
        {
          "line": 805,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(sub_compact != nullptr)",
          "old_line_content": "",
          "new_line_content": "  assert(sub_compact != nullptr);",
          "content_same": false
        },
        {
          "line": 806,
          "old_api": null,
          "new_api": "column_family_data",
          "old_text": null,
          "new_text": "sub_compact->compaction->column_family_data()",
          "old_line_content": "  // I/O measurement variables",
          "new_line_content": "  ColumnFamilyData* cfd = sub_compact->compaction->column_family_data();",
          "content_same": false
        },
        {
          "line": 808,
          "old_api": null,
          "new_api": "internal_comparator",
          "old_text": null,
          "new_text": "cfd->internal_comparator()",
          "old_line_content": "  const uint64_t kRecordStatsEvery = 1000;",
          "new_line_content": "      new RangeDelAggregator(cfd->internal_comparator(), existing_snapshots_));",
          "content_same": false
        },
        {
          "line": 809,
          "old_api": null,
          "new_api": "get",
          "old_text": null,
          "new_text": "versions_->MakeInputIterator(\n      sub_compact->compaction, range_del_agg.get(), env_optiosn_for_read_)",
          "old_line_content": "  uint64_t prev_write_nanos = 0;",
          "new_line_content": "  std::unique_ptr<InternalIterator> input(versions_->MakeInputIterator(",
          "content_same": false
        },
        {
          "line": 810,
          "old_api": null,
          "new_api": "get",
          "old_text": null,
          "new_text": "range_del_agg.get()",
          "old_line_content": "  uint64_t prev_fsync_nanos = 0;",
          "new_line_content": "      sub_compact->compaction, range_del_agg.get(), env_optiosn_for_read_));",
          "content_same": false
        },
        {
          "line": 1322,
          "old_api": null,
          "new_api": "ok",
          "old_text": null,
          "new_text": "s.ok()",
          "old_line_content": "    // Also need to remove the file from outputs, or it will be added to the",
          "new_line_content": "  if (s.ok() && current_entries == 0 && tp.num_range_deletions == 0) {",
          "content_same": false
        },
        {
          "line": 1327,
          "old_api": null,
          "new_api": "immutable_cf_options",
          "old_text": null,
          "new_text": "sub_compact->compaction->immutable_cf_options()",
          "old_line_content": "  }",
          "new_line_content": "        TableFileName(sub_compact->compaction->immutable_cf_options()->cf_paths,",
          "content_same": false
        },
        {
          "line": 1328,
          "old_api": null,
          "new_api": "GetPathId",
          "old_text": null,
          "new_text": "meta->fd.GetPathId()",
          "old_line_content": "",
          "new_line_content": "                      meta->fd.GetNumber(), meta->fd.GetPathId());",
          "content_same": false
        },
        {
          "line": 1334,
          "old_api": null,
          "new_api": "pop_back",
          "old_text": null,
          "new_text": "sub_compact->outputs.pop_back()",
          "old_line_content": "                   \"[%s] [JOB %d] Generated table #%\" PRIu64 \": %\" PRIu64",
          "new_line_content": "    sub_compact->outputs.pop_back();",
          "content_same": false
        },
        {
          "line": 824,
          "old_api": null,
          "new_api": "SetPerfLevel",
          "old_text": null,
          "new_text": "SetPerfLevel(PerfLevel::kEnableTime)",
          "old_line_content": "",
          "new_line_content": "    SetPerfLevel(PerfLevel::kEnableTime);",
          "content_same": false
        },
        {
          "line": 825,
          "old_api": null,
          "new_api": "IOSTATS",
          "old_text": null,
          "new_text": "IOSTATS(write_nanos)",
          "old_line_content": "  // To build compression dictionary, we sample the first output file, assuming",
          "new_line_content": "    prev_write_nanos = IOSTATS(write_nanos);",
          "content_same": false
        },
        {
          "line": 826,
          "old_api": null,
          "new_api": "IOSTATS",
          "old_text": null,
          "new_text": "IOSTATS(fsync_nanos)",
          "old_line_content": "  // it'll reach the maximum length. We optionally pass these samples through",
          "new_line_content": "    prev_fsync_nanos = IOSTATS(fsync_nanos);",
          "content_same": false
        },
        {
          "line": 827,
          "old_api": null,
          "new_api": "IOSTATS",
          "old_text": null,
          "new_text": "IOSTATS(range_sync_nanos)",
          "old_line_content": "  // zstd's dictionary trainer, or just use them directly. Then, the dictionary",
          "new_line_content": "    prev_range_sync_nanos = IOSTATS(range_sync_nanos);",
          "content_same": false
        },
        {
          "line": 828,
          "old_api": null,
          "new_api": "IOSTATS",
          "old_text": null,
          "new_text": "IOSTATS(prepare_write_nanos)",
          "old_line_content": "  // is used for compressing subsequent output files in the same subcompaction.",
          "new_line_content": "    prev_prepare_write_nanos = IOSTATS(prepare_write_nanos);",
          "content_same": false
        },
        {
          "line": 1338,
          "old_api": null,
          "new_api": "ok",
          "old_text": null,
          "new_text": "s.ok()",
          "old_line_content": "                   meta->marked_for_compaction ? \" (need compaction)\" : \"\");",
          "new_line_content": "  if (s.ok() && (current_entries > 0 || tp.num_range_deletions > 0)) {",
          "content_same": false
        },
        {
          "line": 1340,
          "old_api": null,
          "new_api": "current_output",
          "old_text": null,
          "new_text": "sub_compact->current_output()",
          "old_line_content": "  std::string fname;",
          "new_line_content": "    sub_compact->current_output()->table_properties =",
          "content_same": false
        },
        {
          "line": 1341,
          "old_api": null,
          "new_api": "std::make_shared<TableProperties>(tp)",
          "old_text": null,
          "new_text": "std::make_shared<TableProperties>(tp)",
          "old_line_content": "  FileDescriptor output_fd;",
          "new_line_content": "        std::make_shared<TableProperties>(tp);",
          "content_same": false
        },
        {
          "line": 832,
          "old_api": null,
          "new_api": "mutable_cf_options",
          "old_text": null,
          "new_text": "sub_compact->compaction->mutable_cf_options()",
          "old_line_content": "  const size_t kSampleBytes =",
          "new_line_content": "      sub_compact->compaction->mutable_cf_options();",
          "content_same": false
        },
        {
          "line": 1342,
          "old_api": null,
          "new_api": "c_str",
          "old_text": null,
          "new_text": "ROCKS_LOG_INFO(db_options_.info_log,\n                   \"[%s] [JOB %d] Generated table #%\" PRIu64 \": %\" PRIu64\n                   \" keys, %\" PRIu64 \" bytes%s\",\n                   cfd->GetName().c_str(), job_id_, output_number,\n                   current_entries, current_bytes,\n                   meta->marked_for_compaction ? \" (need compaction)\" : \"\")",
          "old_line_content": "  if (meta != nullptr) {",
          "new_line_content": "    ROCKS_LOG_INFO(db_options_.info_log,",
          "content_same": false
        },
        {
          "line": 839,
          "old_api": null,
          "new_api": "output_compression_opts",
          "old_text": null,
          "new_text": "sub_compact->compaction->output_compression_opts()",
          "old_line_content": "  if (bottommost_level_ && kSampleBytes > 0) {",
          "new_line_content": "      sub_compact->compaction->output_compression_opts().zstd_max_train_bytes >",
          "content_same": false
        },
        {
          "line": 1353,
          "old_api": null,
          "new_api": "immutable_cf_options",
          "old_text": null,
          "new_text": "sub_compact->compaction->immutable_cf_options()",
          "old_line_content": "",
          "new_line_content": "        TableFileName(sub_compact->compaction->immutable_cf_options()->cf_paths,",
          "content_same": false
        },
        {
          "line": 1354,
          "old_api": null,
          "new_api": "GetPathId",
          "old_text": null,
          "new_text": "meta->fd.GetPathId()",
          "old_line_content": "#ifndef ROCKSDB_LITE",
          "new_line_content": "                      meta->fd.GetNumber(), meta->fd.GetPathId());",
          "content_same": false
        },
        {
          "line": 1359,
          "old_api": null,
          "new_api": "ioptions",
          "old_text": null,
          "new_text": "EventHelpers::LogAndNotifyTableFileCreationFinished(\n      event_logger_, cfd->ioptions()->listeners, dbname_, cfd->GetName(), fname,\n      job_id_, output_fd, tp, TableFileCreationReason::kCompaction, s)",
          "old_line_content": "    auto fn =",
          "new_line_content": "  EventHelpers::LogAndNotifyTableFileCreationFinished(",
          "content_same": false
        },
        {
          "line": 853,
          "old_api": null,
          "new_api": "ioptions",
          "old_text": null,
          "new_text": "cfd->ioptions()",
          "old_line_content": "            << kSampleLenShift);",
          "new_line_content": "            cfd->ioptions()->compaction_style,",
          "content_same": false
        },
        {
          "line": 854,
          "old_api": null,
          "new_api": "GetInputBaseLevel",
          "old_text": null,
          "new_text": "compact_->compaction->GetInputBaseLevel()",
          "old_line_content": "      }",
          "new_line_content": "            compact_->compaction->GetInputBaseLevel(),",
          "content_same": false
        },
        {
          "line": 855,
          "old_api": null,
          "new_api": "ioptions",
          "old_text": null,
          "new_text": "cfd->ioptions()",
          "old_line_content": "    }",
          "new_line_content": "            cfd->ioptions()->level_compaction_dynamic_level_bytes));",
          "content_same": false
        },
        {
          "line": 1369,
          "old_api": null,
          "new_api": "immutable_cf_options",
          "old_text": null,
          "new_text": "sub_compact->compaction->immutable_cf_options()",
          "old_line_content": "          \"MaxAllowedSpaceReached\");",
          "new_line_content": "        TableFileName(sub_compact->compaction->immutable_cf_options()->cf_paths,",
          "content_same": false
        },
        {
          "line": 1370,
          "old_api": null,
          "new_api": "GetPathId",
          "old_text": null,
          "new_text": "meta->fd.GetPathId()",
          "old_line_content": "      InstrumentedMutexLock l(db_mutex_);",
          "new_line_content": "                      meta->fd.GetNumber(), meta->fd.GetPathId());",
          "content_same": false
        },
        {
          "line": 860,
          "old_api": null,
          "new_api": "insert",
          "old_text": null,
          "new_text": "sample_begin_offsets.insert(\n            static_cast<size_t>(generator.Uniform(kOutFileNumSamples))\n            << kSampleLenShift)",
          "old_line_content": "  if (compaction_filter == nullptr) {",
          "new_line_content": "        sample_begin_offsets.insert(",
          "content_same": false
        },
        {
          "line": 861,
          "old_api": null,
          "new_api": "Uniform",
          "old_text": null,
          "new_text": "generator.Uniform(kOutFileNumSamples)",
          "old_line_content": "    compaction_filter_from_factory =",
          "new_line_content": "            static_cast<size_t>(generator.Uniform(kOutFileNumSamples))",
          "content_same": false
        },
        {
          "line": 1372,
          "old_api": null,
          "new_api": "IsMaxAllowedSpaceReached",
          "old_text": null,
          "new_text": "sfm->IsMaxAllowedSpaceReached()",
          "old_line_content": "    }",
          "new_line_content": "    if (sfm->IsMaxAllowedSpaceReached()) {",
          "content_same": false
        },
        {
          "line": 1375,
          "old_api": null,
          "new_api": "Status::SpaceLimit(\"Max allowed space was reached\")",
          "old_text": null,
          "new_text": "Status::SpaceLimit(\"Max allowed space was reached\")",
          "old_line_content": "",
          "new_line_content": "      s = Status::SpaceLimit(\"Max allowed space was reached\");",
          "content_same": false
        },
        {
          "line": 1380,
          "old_api": null,
          "new_api": "SetBGError",
          "old_text": null,
          "new_text": "db_error_handler_->SetBGError(s, BackgroundErrorReason::kCompaction)",
          "old_line_content": "",
          "new_line_content": "      db_error_handler_->SetBGError(s, BackgroundErrorReason::kCompaction);",
          "content_same": false
        },
        {
          "line": 872,
          "old_api": null,
          "new_api": "get",
          "old_text": null,
          "new_text": "compaction_filter_from_factory.get()",
          "old_line_content": "",
          "new_line_content": "    compaction_filter = compaction_filter_from_factory.get();",
          "content_same": false
        },
        {
          "line": 1385,
          "old_api": null,
          "new_api": "reset",
          "old_text": null,
          "new_text": "sub_compact->builder.reset()",
          "old_line_content": "  auto* compaction = compact_->compaction;",
          "new_line_content": "  sub_compact->builder.reset();",
          "content_same": false
        },
        {
          "line": 875,
          "old_api": null,
          "new_api": "ioptions",
          "old_text": null,
          "new_text": "cfd->ioptions()",
          "old_line_content": "  Slice* start = sub_compact->start;",
          "new_line_content": "      env_, cfd->user_comparator(), cfd->ioptions()->merge_operator,",
          "content_same": false
        },
        {
          "line": 876,
          "old_api": null,
          "new_api": "get",
          "old_text": null,
          "new_text": "db_options_.info_log.get()",
          "old_line_content": "  Slice* end = sub_compact->end;",
          "new_line_content": "      compaction_filter, db_options_.info_log.get(),",
          "content_same": false
        },
        {
          "line": 878,
          "old_api": null,
          "new_api": "back",
          "old_text": null,
          "new_text": "existing_snapshots_.back()",
          "old_line_content": "    IterKey start_iter;",
          "new_line_content": "      existing_snapshots_.empty() ? 0 : existing_snapshots_.back(),",
          "content_same": false
        },
        {
          "line": 1392,
          "old_api": null,
          "new_api": "AssertHeld",
          "old_text": null,
          "new_text": "db_mutex_->AssertHeld()",
          "old_line_content": "",
          "new_line_content": "  db_mutex_->AssertHeld();",
          "content_same": false
        },
        {
          "line": 1399,
          "old_api": null,
          "new_api": "VerifyCompactionFileConsistency",
          "old_text": null,
          "new_text": "versions_->VerifyCompactionFileConsistency(compaction)",
          "old_line_content": "  {",
          "new_line_content": "  if (!versions_->VerifyCompactionFileConsistency(compaction)) {",
          "content_same": false
        },
        {
          "line": 888,
          "old_api": null,
          "new_api": "SetInternalKey",
          "old_text": null,
          "new_text": "start_iter.SetInternalKey(*start, kMaxSequenceNumber, kValueTypeForSeek)",
          "old_line_content": "      &existing_snapshots_, earliest_write_conflict_snapshot_,",
          "new_line_content": "    start_iter.SetInternalKey(*start, kMaxSequenceNumber, kValueTypeForSeek);",
          "content_same": false
        },
        {
          "line": 1402,
          "old_api": null,
          "new_api": "c_str",
          "old_text": null,
          "new_text": "ROCKS_LOG_ERROR(db_options_.info_log, \"[%s] [JOB %d] Compaction %s aborted\",\n                    compaction->column_family_data()->GetName().c_str(),\n                    job_id_, compaction->InputLevelSummary(&inputs_summary))",
          "old_line_content": "        db_options_.info_log, \"[%s] [JOB %d] Compacted %s => %\" PRIu64 \" bytes\",",
          "new_line_content": "    ROCKS_LOG_ERROR(db_options_.info_log, \"[%s] [JOB %d] Compaction %s aborted\",",
          "content_same": false
        },
        {
          "line": 891,
          "old_api": null,
          "new_api": "SeekToFirst",
          "old_text": null,
          "new_text": "input->SeekToFirst()",
          "old_line_content": "      shutting_down_, preserve_deletes_seqnum_));",
          "new_line_content": "    input->SeekToFirst();",
          "content_same": false
        },
        {
          "line": 1405,
          "old_api": null,
          "new_api": "Status::Corruption(\"Compaction input files inconsistent\")",
          "old_text": null,
          "new_text": "Status::Corruption(\"Compaction input files inconsistent\")",
          "old_line_content": "  }",
          "new_line_content": "    return Status::Corruption(\"Compaction input files inconsistent\");",
          "content_same": false
        },
        {
          "line": 895,
          "old_api": null,
          "new_api": "reset",
          "old_text": null,
          "new_text": "sub_compact->c_iter.reset(new CompactionIterator(\n      input.get(), cfd->user_comparator(), &merge, versions_->LastSequence(),\n      &existing_snapshots_, earliest_write_conflict_snapshot_,\n      snapshot_checker_, env_, ShouldReportDetailedTime(env_, stats_), false,\n      range_del_agg.get(), sub_compact->compaction, compaction_filter,\n      shutting_down_, preserve_deletes_seqnum_))",
          "old_line_content": "    // ShouldStopBefore() maintains state based on keys processed so far. The",
          "new_line_content": "  sub_compact->c_iter.reset(new CompactionIterator(",
          "content_same": false
        },
        {
          "line": 896,
          "old_api": null,
          "new_api": "LastSequence",
          "old_text": null,
          "new_text": "versions_->LastSequence()",
          "old_line_content": "    // compaction loop always calls it on the \"next\" key, thus won't tell it the",
          "new_line_content": "      input.get(), cfd->user_comparator(), &merge, versions_->LastSequence(),",
          "content_same": false
        },
        {
          "line": 1410,
          "old_api": null,
          "new_api": "c_str",
          "old_text": null,
          "new_text": "ROCKS_LOG_INFO(\n        db_options_.info_log, \"[%s] [JOB %d] Compacted %s => %\" PRIu64 \" bytes\",\n        compaction->column_family_data()->GetName().c_str(), job_id_,\n        compaction->InputLevelSummary(&inputs_summary), compact_->total_bytes)",
          "old_line_content": "  for (const auto& sub_compact : compact_->sub_compact_states) {",
          "new_line_content": "    ROCKS_LOG_INFO(",
          "content_same": false
        },
        {
          "line": 899,
          "old_api": null,
          "new_api": "get",
          "old_text": null,
          "new_text": "range_del_agg.get()",
          "old_line_content": "                                  sub_compact->current_output_file_size);",
          "new_line_content": "      range_del_agg.get(), sub_compact->compaction, compaction_filter,",
          "content_same": false
        },
        {
          "line": 1413,
          "old_api": null,
          "new_api": "InputLevelSummary",
          "old_text": null,
          "new_text": "compaction->InputLevelSummary(&inputs_summary)",
          "old_line_content": "    }",
          "new_line_content": "        compaction->InputLevelSummary(&inputs_summary), compact_->total_bytes);",
          "content_same": false
        },
        {
          "line": 903,
          "old_api": null,
          "new_api": "output_level",
          "old_text": null,
          "new_text": "sub_compact->compaction->output_level()",
          "old_line_content": "  // data_begin_offset and dict_sample_data are only valid while generating",
          "new_line_content": "  if (c_iter->Valid() && sub_compact->compaction->output_level() != 0) {",
          "content_same": false
        },
        {
          "line": 1417,
          "old_api": null,
          "new_api": "edit",
          "old_text": null,
          "new_text": "compact_->compaction->edit()",
          "old_line_content": "                                db_mutex_, db_directory_);",
          "new_line_content": "  compaction->AddInputDeletions(compact_->compaction->edit());",
          "content_same": false
        },
        {
          "line": 910,
          "old_api": null,
          "new_api": "iter_stats",
          "old_text": null,
          "new_text": "c_iter->iter_stats()",
          "old_line_content": "    // Invariant: c_iter.status() is guaranteed to be OK if c_iter->Valid()",
          "new_line_content": "  const auto& c_iter_stats = c_iter->iter_stats();",
          "content_same": false
        },
        {
          "line": 911,
          "old_api": null,
          "new_api": "cbegin",
          "old_text": null,
          "new_text": "sample_begin_offsets.cbegin()",
          "old_line_content": "    // returns true.",
          "new_line_content": "  auto sample_begin_offset_iter = sample_begin_offsets.cbegin();",
          "content_same": false
        },
        {
          "line": 916,
          "old_api": null,
          "new_api": "reserve",
          "old_text": null,
          "new_text": "dict_sample_data.reserve(kSampleBytes)",
          "old_line_content": "    // >= than it and exit if it is because the iterator is out of its range",
          "new_line_content": "  dict_sample_data.reserve(kSampleBytes);",
          "content_same": false
        },
        {
          "line": 1430,
          "old_api": null,
          "new_api": "IOSTATS",
          "old_text": null,
          "new_text": "IOSTATS(bytes_read)",
          "old_line_content": "",
          "new_line_content": "  RecordTick(stats_, COMPACT_READ_BYTES, IOSTATS(bytes_read));",
          "content_same": false
        },
        {
          "line": 1431,
          "old_api": null,
          "new_api": "ThreadStatusUtil::IncreaseThreadOperationProperty(\n      ThreadStatus::COMPACTION_BYTES_READ, IOSTATS(bytes_read))",
          "old_text": null,
          "new_text": "ThreadStatusUtil::IncreaseThreadOperationProperty(\n      ThreadStatus::COMPACTION_BYTES_READ, IOSTATS(bytes_read))",
          "old_line_content": "Status CompactionJob::OpenCompactionOutputFile(",
          "new_line_content": "  ThreadStatusUtil::IncreaseThreadOperationProperty(",
          "content_same": false
        },
        {
          "line": 1432,
          "old_api": null,
          "new_api": "IOSTATS",
          "old_text": null,
          "new_text": "IOSTATS(bytes_read)",
          "old_line_content": "    SubcompactionState* sub_compact) {",
          "new_line_content": "      ThreadStatus::COMPACTION_BYTES_READ, IOSTATS(bytes_read));",
          "content_same": false
        },
        {
          "line": 921,
          "old_api": null,
          "new_api": "key",
          "old_text": null,
          "new_text": "c_iter->key()",
          "old_line_content": "    if (c_iter_stats.num_input_records % kRecordStatsEvery ==",
          "new_line_content": "    const Slice& key = c_iter->key();",
          "content_same": false
        },
        {
          "line": 922,
          "old_api": null,
          "new_api": "value",
          "old_text": null,
          "new_text": "c_iter->value()",
          "old_line_content": "        kRecordStatsEvery - 1) {",
          "new_line_content": "    const Slice& value = c_iter->value();",
          "content_same": false
        },
        {
          "line": 1435,
          "old_api": null,
          "new_api": "ThreadStatusUtil::IncreaseThreadOperationProperty(\n      ThreadStatus::COMPACTION_BYTES_WRITTEN, IOSTATS(bytes_written))",
          "old_text": null,
          "new_text": "ThreadStatusUtil::IncreaseThreadOperationProperty(\n      ThreadStatus::COMPACTION_BYTES_WRITTEN, IOSTATS(bytes_written))",
          "old_line_content": "  // no need to lock because VersionSet::next_file_number_ is atomic",
          "new_line_content": "  ThreadStatusUtil::IncreaseThreadOperationProperty(",
          "content_same": false
        },
        {
          "line": 1437,
          "old_api": null,
          "new_api": "IOSTATS_RESET",
          "old_text": null,
          "new_text": "IOSTATS_RESET(bytes_written)",
          "old_line_content": "  std::string fname =",
          "new_line_content": "  IOSTATS_RESET(bytes_written);",
          "content_same": false
        },
        {
          "line": 927,
          "old_api": null,
          "new_api": "user_key",
          "old_text": null,
          "new_text": "c_iter->user_key()",
          "old_line_content": "",
          "new_line_content": "        cfd->user_comparator()->Compare(c_iter->user_key(), *end) >= 0) {",
          "content_same": false
        },
        {
          "line": 1442,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(sub_compact != nullptr)",
          "old_line_content": "#ifndef ROCKSDB_LITE",
          "new_line_content": "  assert(sub_compact != nullptr);",
          "content_same": false
        },
        {
          "line": 932,
          "old_api": null,
          "new_api": "RecordDroppedKeys",
          "old_text": null,
          "new_text": "RecordDroppedKeys(c_iter_stats, &sub_compact->compaction_job_stats)",
          "old_line_content": "        break;",
          "new_line_content": "      RecordDroppedKeys(c_iter_stats, &sub_compact->compaction_job_stats);",
          "content_same": false
        },
        {
          "line": 933,
          "old_api": null,
          "new_api": "ResetRecordCounts",
          "old_text": null,
          "new_text": "c_iter->ResetRecordCounts()",
          "old_line_content": "      }",
          "new_line_content": "      c_iter->ResetRecordCounts();",
          "content_same": false
        },
        {
          "line": 934,
          "old_api": null,
          "new_api": "RecordCompactionIOStats",
          "old_text": null,
          "new_text": "RecordCompactionIOStats()",
          "old_line_content": "    }",
          "new_line_content": "      RecordCompactionIOStats();",
          "content_same": false
        },
        {
          "line": 1445,
          "old_api": null,
          "new_api": "NewFileNumber",
          "old_text": null,
          "new_text": "versions_->NewFileNumber()",
          "old_line_content": "      TableFileCreationReason::kCompaction);",
          "new_line_content": "  uint64_t file_number = versions_->NewFileNumber();",
          "content_same": false
        },
        {
          "line": 1447,
          "old_api": null,
          "new_api": "immutable_cf_options",
          "old_text": null,
          "new_text": "sub_compact->compaction->immutable_cf_options()",
          "old_line_content": "  // Make the output file",
          "new_line_content": "      TableFileName(sub_compact->compaction->immutable_cf_options()->cf_paths,",
          "content_same": false
        },
        {
          "line": 1448,
          "old_api": null,
          "new_api": "output_path_id",
          "old_text": null,
          "new_text": "sub_compact->compaction->output_path_id()",
          "old_line_content": "  std::unique_ptr<WritableFile> writable_file;",
          "new_line_content": "                    file_number, sub_compact->compaction->output_path_id());",
          "content_same": false
        },
        {
          "line": 1450,
          "old_api": null,
          "new_api": "column_family_data",
          "old_text": null,
          "new_text": "sub_compact->compaction->column_family_data()",
          "old_line_content": "  bool syncpoint_arg = env_options_.use_direct_writes;",
          "new_line_content": "  ColumnFamilyData* cfd = sub_compact->compaction->column_family_data();",
          "content_same": false
        },
        {
          "line": 1452,
          "old_api": null,
          "new_api": "ioptions",
          "old_text": null,
          "new_text": "EventHelpers::NotifyTableFileCreationStarted(\n      cfd->ioptions()->listeners, dbname_, cfd->GetName(), fname, job_id_,\n      TableFileCreationReason::kCompaction)",
          "old_line_content": "                           &syncpoint_arg);",
          "new_line_content": "  EventHelpers::NotifyTableFileCreationStarted(",
          "content_same": false
        },
        {
          "line": 1453,
          "old_api": null,
          "new_api": "GetName",
          "old_text": null,
          "new_text": "cfd->GetName()",
          "old_line_content": "#endif",
          "new_line_content": "      cfd->ioptions()->listeners, dbname_, cfd->GetName(), fname, job_id_,",
          "content_same": false
        },
        {
          "line": 944,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(sub_compact->builder != nullptr)",
          "old_line_content": "      // Check if this key/value overlaps any sample intervals; if so, appends",
          "new_line_content": "    assert(sub_compact->builder != nullptr);",
          "content_same": false
        },
        {
          "line": 945,
          "old_api": null,
          "new_api": "current_output",
          "old_text": null,
          "new_text": "sub_compact->current_output()",
          "old_line_content": "      // overlapping portions to the dictionary.",
          "new_line_content": "    assert(sub_compact->current_output() != nullptr);",
          "content_same": false
        },
        {
          "line": 946,
          "old_api": null,
          "new_api": "Add",
          "old_text": null,
          "new_text": "sub_compact->builder->Add(key, value)",
          "old_line_content": "      for (const auto& data_elmt : {key, value}) {",
          "new_line_content": "    sub_compact->builder->Add(key, value);",
          "content_same": false
        },
        {
          "line": 949,
          "old_api": null,
          "new_api": "ikey",
          "old_text": null,
          "new_text": "c_iter->ikey()",
          "old_line_content": "               *sample_begin_offset_iter < data_end_offset) {",
          "new_line_content": "        key, c_iter->ikey().sequence);",
          "content_same": false
        },
        {
          "line": 952,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "sub_compact->outputs.size()",
          "old_line_content": "          // Invariant: Because we advance sample iterator while processing the",
          "new_line_content": "    if (sub_compact->outputs.size() == 1) {  // first output file",
          "content_same": false
        },
        {
          "line": 956,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "data_elmt.size()",
          "old_line_content": "",
          "new_line_content": "        size_t data_end_offset = data_begin_offset + data_elmt.size();",
          "content_same": false
        },
        {
          "line": 957,
          "old_api": null,
          "new_api": "cend",
          "old_text": null,
          "new_text": "sample_begin_offsets.cend()",
          "old_line_content": "          size_t data_elmt_copy_offset, data_elmt_copy_len;",
          "new_line_content": "        while (sample_begin_offset_iter != sample_begin_offsets.cend() &&",
          "content_same": false
        },
        {
          "line": 1469,
          "old_api": null,
          "new_api": "c_str",
          "old_text": null,
          "new_text": "sub_compact->compaction->column_family_data()->GetName().c_str()",
          "old_line_content": "",
          "new_line_content": "        sub_compact->compaction->column_family_data()->GetName().c_str(),",
          "content_same": false
        },
        {
          "line": 1470,
          "old_api": null,
          "new_api": "ToString",
          "old_text": null,
          "new_text": "s.ToString().c_str()",
          "old_line_content": "  SubcompactionState::Output out;",
          "new_line_content": "        job_id_, file_number, s.ToString().c_str());",
          "content_same": false
        },
        {
          "line": 1471,
          "old_api": null,
          "new_api": "LogFlush",
          "old_text": null,
          "new_text": "LogFlush(db_options_.info_log)",
          "old_line_content": "  out.meta.fd =",
          "new_line_content": "    LogFlush(db_options_.info_log);",
          "content_same": false
        },
        {
          "line": 1473,
          "old_api": null,
          "new_api": "GetName",
          "old_text": null,
          "new_text": "cfd->GetName()",
          "old_line_content": "  out.finished = false;",
          "new_line_content": "        event_logger_, cfd->ioptions()->listeners, dbname_, cfd->GetName(),",
          "content_same": false
        },
        {
          "line": 1474,
          "old_api": null,
          "new_api": "TableProperties",
          "old_text": null,
          "new_text": "TableProperties()",
          "old_line_content": "",
          "new_line_content": "        fname, job_id_, FileDescriptor(), TableProperties(),",
          "content_same": false
        },
        {
          "line": 964,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(data_begin_offset < sample_end_offset)",
          "old_line_content": "            // at the below offset into data_elmt.",
          "new_line_content": "          assert(data_begin_offset < sample_end_offset);",
          "content_same": false
        },
        {
          "line": 1485,
          "old_api": null,
          "new_api": "SetIOPriority",
          "old_text": null,
          "new_text": "writable_file->SetIOPriority(Env::IO_LOW)",
          "old_line_content": "",
          "new_line_content": "  writable_file->SetIOPriority(Env::IO_LOW);",
          "content_same": false
        },
        {
          "line": 1486,
          "old_api": null,
          "new_api": "SetWriteLifeTimeHint",
          "old_text": null,
          "new_text": "writable_file->SetWriteLifeTimeHint(write_hint_)",
          "old_line_content": "  // If the Column family flag is to only optimize filters for hits,",
          "new_line_content": "  writable_file->SetWriteLifeTimeHint(write_hint_);",
          "content_same": false
        },
        {
          "line": 1487,
          "old_api": null,
          "new_api": "OutputFilePreallocationSize",
          "old_text": null,
          "new_text": "static_cast<size_t>(\n      sub_compact->compaction->OutputFilePreallocationSize())",
          "old_line_content": "  // we can skip creating filters if this is the bottommost_level where",
          "new_line_content": "  writable_file->SetPreallocationBlockSize(static_cast<size_t>(",
          "content_same": false
        },
        {
          "line": 1488,
          "old_api": null,
          "new_api": "OutputFilePreallocationSize",
          "old_text": null,
          "new_text": "sub_compact->compaction->OutputFilePreallocationSize()",
          "old_line_content": "  // data is going to be found",
          "new_line_content": "      sub_compact->compaction->OutputFilePreallocationSize()));",
          "content_same": false
        },
        {
          "line": 1491,
          "old_api": null,
          "new_api": "reset",
          "old_text": null,
          "new_text": "sub_compact->outfile.reset(\n      new WritableFileWriter(std::move(writable_file), fname, env_options_,\n                             db_options_.statistics.get(), listeners))",
          "old_line_content": "",
          "new_line_content": "  sub_compact->outfile.reset(",
          "content_same": false
        },
        {
          "line": 1492,
          "old_api": null,
          "new_api": "std::move(writable_file)",
          "old_text": null,
          "new_text": "std::move(writable_file)",
          "old_line_content": "  uint64_t output_file_creation_time =",
          "new_line_content": "      new WritableFileWriter(std::move(writable_file), fname, env_options_,",
          "content_same": false
        },
        {
          "line": 988,
          "old_api": null,
          "new_api": "data",
          "old_text": null,
          "new_text": "data_elmt.data()",
          "old_line_content": "        data_begin_offset = data_end_offset;",
          "new_line_content": "          dict_sample_data.append(&data_elmt.data()[data_elmt_copy_offset],",
          "content_same": false
        },
        {
          "line": 1502,
          "old_api": null,
          "new_api": "MaxInputFileCreationTime",
          "old_text": null,
          "new_text": "sub_compact->compaction->MaxInputFileCreationTime()",
          "old_line_content": "          \"Status: %s\",",
          "new_line_content": "      sub_compact->compaction->MaxInputFileCreationTime();",
          "content_same": false
        },
        {
          "line": 1507,
          "old_api": null,
          "new_api": "ok",
          "old_text": null,
          "new_text": "status.ok()",
          "old_line_content": "",
          "new_line_content": "    if (!status.ok()) {",
          "content_same": false
        },
        {
          "line": 1517,
          "old_api": null,
          "new_api": "get",
          "old_text": null,
          "new_text": "NewTableBuilder(\n      *cfd->ioptions(), *(sub_compact->compaction->mutable_cf_options()),\n      cfd->internal_comparator(), cfd->int_tbl_prop_collector_factories(),\n      cfd->GetID(), cfd->GetName(), sub_compact->outfile.get(),\n      sub_compact->compaction->output_compression(),\n      sub_compact->compaction->output_compression_opts(),\n      sub_compact->compaction->output_level(), &sub_compact->compression_dict,\n      skip_filters, output_file_creation_time)",
          "old_line_content": "  return s;",
          "new_line_content": "  sub_compact->builder.reset(NewTableBuilder(",
          "content_same": false
        },
        {
          "line": 1518,
          "old_api": null,
          "new_api": "mutable_cf_options",
          "old_text": null,
          "new_text": "sub_compact->compaction->mutable_cf_options()",
          "old_line_content": "}",
          "new_line_content": "      *cfd->ioptions(), *(sub_compact->compaction->mutable_cf_options()),",
          "content_same": false
        },
        {
          "line": 1519,
          "old_api": null,
          "new_api": "int_tbl_prop_collector_factories",
          "old_text": null,
          "new_text": "cfd->int_tbl_prop_collector_factories()",
          "old_line_content": "",
          "new_line_content": "      cfd->internal_comparator(), cfd->int_tbl_prop_collector_factories(),",
          "content_same": false
        },
        {
          "line": 1520,
          "old_api": null,
          "new_api": "get",
          "old_text": null,
          "new_text": "sub_compact->outfile.get()",
          "old_line_content": "void CompactionJob::CleanupCompaction() {",
          "new_line_content": "      cfd->GetID(), cfd->GetName(), sub_compact->outfile.get(),",
          "content_same": false
        },
        {
          "line": 1521,
          "old_api": null,
          "new_api": "output_compression",
          "old_text": null,
          "new_text": "sub_compact->compaction->output_compression()",
          "old_line_content": "  for (SubcompactionState& sub_compact : compact_->sub_compact_states) {",
          "new_line_content": "      sub_compact->compaction->output_compression(),",
          "content_same": false
        },
        {
          "line": 1522,
          "old_api": null,
          "new_api": "output_compression_opts",
          "old_text": null,
          "new_text": "sub_compact->compaction->output_compression_opts()",
          "old_line_content": "    const auto& sub_status = sub_compact.status;",
          "new_line_content": "      sub_compact->compaction->output_compression_opts(),",
          "content_same": false
        },
        {
          "line": 1523,
          "old_api": null,
          "new_api": "output_level",
          "old_text": null,
          "new_text": "sub_compact->compaction->output_level()",
          "old_line_content": "",
          "new_line_content": "      sub_compact->compaction->output_level(), &sub_compact->compression_dict,",
          "content_same": false
        },
        {
          "line": 1525,
          "old_api": null,
          "new_api": "LogFlush",
          "old_text": null,
          "new_text": "LogFlush(db_options_.info_log)",
          "old_line_content": "      // May happen if we get a shutdown call in the middle of compaction",
          "new_line_content": "  LogFlush(db_options_.info_log);",
          "content_same": false
        },
        {
          "line": 1016,
          "old_api": null,
          "new_api": "status",
          "old_text": null,
          "new_text": "input->status()",
          "old_line_content": "      // (2) this key belongs to the next file. For historical reasons, the",
          "new_line_content": "      input_status = input->status();",
          "content_same": false
        },
        {
          "line": 1020,
          "old_api": null,
          "new_api": "Valid",
          "old_text": null,
          "new_text": "c_iter->Valid()",
          "old_line_content": "      output_file_ended = true;",
          "new_line_content": "    if (!output_file_ended && c_iter->Valid() &&",
          "content_same": false
        },
        {
          "line": 1021,
          "old_api": null,
          "new_api": "output_level",
          "old_text": null,
          "new_text": "sub_compact->compaction->output_level()",
          "old_line_content": "    }",
          "new_line_content": "        sub_compact->compaction->output_level() != 0 &&",
          "content_same": false
        },
        {
          "line": 1022,
          "old_api": null,
          "new_api": "key",
          "old_text": null,
          "new_text": "c_iter->key()",
          "old_line_content": "    if (output_file_ended) {",
          "new_line_content": "        sub_compact->ShouldStopBefore(c_iter->key(),",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 1024,
          "old_api": "Valid",
          "new_api": null,
          "old_text": "c_iter->Valid()",
          "new_text": null,
          "old_line_content": "      if (c_iter->Valid()) {",
          "new_line_content": "        sub_compact->builder != nullptr) {",
          "content_same": false
        },
        {
          "line": 1025,
          "old_api": "key",
          "new_api": null,
          "old_text": "c_iter->key()",
          "new_text": null,
          "old_line_content": "        next_key = &c_iter->key();",
          "new_line_content": "      // (2) this key belongs to the next file. For historical reasons, the",
          "content_same": false
        },
        {
          "line": 514,
          "old_api": "current",
          "new_api": null,
          "old_text": "cfd->current()",
          "new_text": null,
          "old_line_content": "  auto* v = cfd->current();",
          "new_line_content": "  // Get input version from CompactionState since it's already referenced",
          "content_same": false
        },
        {
          "line": 515,
          "old_api": "begin",
          "new_api": null,
          "old_text": "bounds.begin()",
          "new_text": null,
          "old_line_content": "  for (auto it = bounds.begin();;) {",
          "new_line_content": "  // earlier in SetInputVersioCompaction::SetInputVersion and will not change",
          "content_same": false
        },
        {
          "line": 1029,
          "old_api": "get",
          "new_api": null,
          "old_text": "range_del_agg.get()",
          "new_text": null,
          "old_line_content": "                                          range_del_agg.get(),",
          "new_line_content": "      output_file_ended = true;",
          "content_same": false
        },
        {
          "line": 519,
          "old_api": "end",
          "new_api": null,
          "old_text": "bounds.end()",
          "new_text": null,
          "old_line_content": "    if (it == bounds.end()) {",
          "new_line_content": "    const Slice a = *it;",
          "content_same": false
        },
        {
          "line": 1031,
          "old_api": "RecordDroppedKeys",
          "new_api": null,
          "old_text": "RecordDroppedKeys(range_del_out_stats,\n                        &sub_compact->compaction_job_stats)",
          "new_text": null,
          "old_line_content": "      RecordDroppedKeys(range_del_out_stats,",
          "new_line_content": "    if (output_file_ended) {",
          "content_same": false
        },
        {
          "line": 1546,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(prefix_length > 0)",
          "new_text": null,
          "old_line_content": "  assert(prefix_length > 0);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1547,
          "old_api": "size",
          "new_api": null,
          "old_text": "src.size()",
          "new_text": null,
          "old_line_content": "  size_t length = src.size() > prefix_length ? prefix_length : src.size();",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 524,
          "old_api": "ApproximateSize",
          "new_api": null,
          "old_text": "versions_->ApproximateSize(v, a, b, start_lvl, out_lvl + 1)",
          "new_text": null,
          "old_line_content": "    uint64_t size = versions_->ApproximateSize(v, a, b, start_lvl, out_lvl + 1);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 525,
          "old_api": "emplace_back",
          "new_api": null,
          "old_text": "ranges.emplace_back(a, b, size)",
          "new_text": null,
          "old_line_content": "    ranges.emplace_back(a, b, size);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1548,
          "old_api": "data",
          "new_api": null,
          "old_text": "src.data()",
          "new_text": null,
          "old_line_content": "  dst->assign(src.data(), length);",
          "new_line_content": "  delete compact_;",
          "content_same": false
        },
        {
          "line": 1039,
          "old_api": "output_compression_opts",
          "new_api": null,
          "old_text": "sub_compact->compaction->output_compression_opts()",
          "new_text": null,
          "old_line_content": "              sub_compact->compaction->output_compression_opts()",
          "new_line_content": "                                          &range_del_out_stats, next_key);",
          "content_same": false
        },
        {
          "line": 535,
          "old_api": "immutable_cf_options",
          "new_api": null,
          "old_text": "c->immutable_cf_options()",
          "new_text": null,
          "old_line_content": "          c->immutable_cf_options()->compaction_style, base_level,",
          "new_line_content": "    sum += size;",
          "content_same": false
        },
        {
          "line": 536,
          "old_api": "immutable_cf_options",
          "new_api": null,
          "old_text": "c->immutable_cf_options()",
          "new_text": null,
          "old_line_content": "          c->immutable_cf_options()->level_compaction_dynamic_level_bytes)));",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 1559,
          "old_api": "num_input_levels",
          "new_api": null,
          "old_text": "compaction->num_input_levels()",
          "new_text": null,
          "old_line_content": "       input_level < static_cast<int>(compaction->num_input_levels());",
          "new_line_content": "}  // namespace",
          "content_same": false
        },
        {
          "line": 538,
          "old_api": "size",
          "new_api": null,
          "old_text": "ranges.size()",
          "new_text": null,
          "old_line_content": "      std::min({static_cast<uint64_t>(ranges.size()),",
          "new_line_content": "  // Group the ranges into subcompactions",
          "content_same": false
        },
        {
          "line": 539,
          "old_api": "max_subcompactions",
          "new_api": null,
          "old_text": "c->max_subcompactions()",
          "new_text": null,
          "old_line_content": "                static_cast<uint64_t>(c->max_subcompactions()),",
          "new_line_content": "  const double min_file_fill_percent = 4.0 / 5;",
          "content_same": false
        },
        {
          "line": 1561,
          "old_api": "output_level",
          "new_api": null,
          "old_text": "compaction->output_level()",
          "new_text": null,
          "old_line_content": "    if (compaction->level(input_level) != compaction->output_level()) {",
          "new_line_content": "#endif  // !ROCKSDB_LITE",
          "content_same": false
        },
        {
          "line": 1562,
          "old_api": "UpdateCompactionInputStatsHelper",
          "new_api": null,
          "old_text": "UpdateCompactionInputStatsHelper(\n          &compaction_stats_.num_input_files_in_non_output_levels,\n          &compaction_stats_.bytes_read_non_output_levels, input_level)",
          "new_text": null,
          "old_line_content": "      UpdateCompactionInputStatsHelper(",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1566,
          "old_api": "UpdateCompactionInputStatsHelper",
          "new_api": null,
          "old_text": "UpdateCompactionInputStatsHelper(\n          &compaction_stats_.num_input_files_in_output_level,\n          &compaction_stats_.bytes_read_output_level, input_level)",
          "new_text": null,
          "old_line_content": "      UpdateCompactionInputStatsHelper(",
          "new_line_content": "  compaction_stats_.num_input_files_in_output_level = 0;",
          "content_same": false
        },
        {
          "line": 1573,
          "old_api": "size",
          "new_api": null,
          "old_text": "sub_compact.outputs.size()",
          "new_text": null,
          "old_line_content": "    size_t num_output_files = sub_compact.outputs.size();",
          "new_line_content": "          &compaction_stats_.bytes_read_non_output_levels, input_level);",
          "content_same": false
        },
        {
          "line": 1062,
          "old_api": "RecordTick",
          "new_api": null,
          "old_text": "RecordTick(stats_, FILTER_OPERATION_TOTAL_TIME,\n             c_iter_stats.total_filter_time)",
          "new_text": null,
          "old_line_content": "  RecordTick(stats_, FILTER_OPERATION_TOTAL_TIME,",
          "new_line_content": "  sub_compact->compaction_job_stats.num_single_del_fallthru =",
          "content_same": false
        },
        {
          "line": 1064,
          "old_api": "RecordDroppedKeys",
          "new_api": null,
          "old_text": "RecordDroppedKeys(c_iter_stats, &sub_compact->compaction_job_stats)",
          "new_text": null,
          "old_line_content": "  RecordDroppedKeys(c_iter_stats, &sub_compact->compaction_job_stats);",
          "new_line_content": "  sub_compact->compaction_job_stats.num_single_del_mismatch =",
          "content_same": false
        },
        {
          "line": 1065,
          "old_api": "RecordCompactionIOStats",
          "new_api": null,
          "old_text": "RecordCompactionIOStats()",
          "new_text": null,
          "old_line_content": "  RecordCompactionIOStats();",
          "new_line_content": "      c_iter_stats.num_single_del_mismatch;",
          "content_same": false
        },
        {
          "line": 1576,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(num_output_files > 0)",
          "new_text": null,
          "old_line_content": "      assert(num_output_files > 0);",
          "new_line_content": "          &compaction_stats_.num_input_files_in_output_level,",
          "content_same": false
        },
        {
          "line": 555,
          "old_api": "ExtractUserKey",
          "new_api": null,
          "old_text": "ExtractUserKey(ranges[i].range.limit)",
          "new_text": null,
          "old_line_content": "        boundaries_.emplace_back(ExtractUserKey(ranges[i].range.limit));",
          "new_line_content": "    sum = 0;",
          "content_same": false
        },
        {
          "line": 1067,
          "old_api": "ok",
          "new_api": null,
          "old_text": "status.ok()",
          "new_text": null,
          "old_line_content": "  if (status.ok() &&",
          "new_line_content": "      c_iter_stats.total_input_raw_key_bytes;",
          "content_same": false
        },
        {
          "line": 1068,
          "old_api": "IsDropped",
          "new_api": null,
          "old_text": "cfd->IsDropped()",
          "new_text": null,
          "old_line_content": "      (shutting_down_->load(std::memory_order_relaxed) || cfd->IsDropped())) {",
          "new_line_content": "  sub_compact->compaction_job_stats.total_input_raw_value_bytes +=",
          "content_same": false
        },
        {
          "line": 1069,
          "old_api": "Status::ShutdownInProgress(\n        \"Database shutdown or Column family drop during compaction\")",
          "new_api": null,
          "old_text": "Status::ShutdownInProgress(\n        \"Database shutdown or Column family drop during compaction\")",
          "new_text": null,
          "old_line_content": "    status = Status::ShutdownInProgress(",
          "new_line_content": "      c_iter_stats.total_input_raw_value_bytes;",
          "content_same": false
        },
        {
          "line": 1579,
          "old_api": "static_cast<int>(num_output_files)",
          "new_api": null,
          "old_text": "static_cast<int>(num_output_files)",
          "new_text": null,
          "old_line_content": "    compaction_stats_.num_output_files += static_cast<int>(num_output_files);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 1072,
          "old_api": "ok",
          "new_api": null,
          "old_text": "status.ok()",
          "new_text": null,
          "old_line_content": "  if (status.ok()) {",
          "new_line_content": "             c_iter_stats.total_filter_time);",
          "content_same": false
        },
        {
          "line": 561,
          "old_api": "back",
          "new_api": null,
          "old_text": "ranges.back()",
          "new_text": null,
          "old_line_content": "    sizes_.emplace_back(sum + ranges.back().size);",
          "new_line_content": "        continue;",
          "content_same": false
        },
        {
          "line": 1075,
          "old_api": "ok",
          "new_api": null,
          "old_text": "status.ok()",
          "new_text": null,
          "old_line_content": "  if (status.ok()) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1079,
          "old_api": "ok",
          "new_api": null,
          "old_text": "status.ok()",
          "new_text": null,
          "old_line_content": "  if (status.ok() && sub_compact->builder == nullptr &&",
          "new_line_content": "        \"Database shutdown or Column family drop during compaction\");",
          "content_same": false
        },
        {
          "line": 1080,
          "old_api": "size",
          "new_api": null,
          "old_text": "sub_compact->outputs.size()",
          "new_text": null,
          "old_line_content": "      sub_compact->outputs.size() == 0 &&",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 571,
          "old_api": "TEST_SYNC_POINT",
          "new_api": null,
          "old_text": "TEST_SYNC_POINT(\"CompactionJob::Run():Start\")",
          "new_text": null,
          "old_line_content": "  TEST_SYNC_POINT(\"CompactionJob::Run():Start\");",
          "new_line_content": "  } else {",
          "content_same": false
        },
        {
          "line": 572,
          "old_api": "FlushBufferToLog",
          "new_api": null,
          "old_text": "log_buffer_->FlushBufferToLog()",
          "new_text": null,
          "old_line_content": "  log_buffer_->FlushBufferToLog();",
          "new_line_content": "    // Only one range so its size is the total sum of sizes computed above",
          "content_same": false
        },
        {
          "line": 1083,
          "old_api": "OpenCompactionOutputFile",
          "new_api": null,
          "old_text": "OpenCompactionOutputFile(sub_compact)",
          "new_text": null,
          "old_line_content": "    status = OpenCompactionOutputFile(sub_compact);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 1595,
          "old_api": "num_input_files",
          "new_api": null,
          "old_text": "compaction->num_input_files(input_level)",
          "new_text": null,
          "old_line_content": "  auto num_input_files = compaction->num_input_files(input_level);",
          "new_line_content": "          sub_compact.num_input_records - sub_compact.num_output_records;",
          "content_same": false
        },
        {
          "line": 575,
          "old_api": "size",
          "new_api": null,
          "old_text": "compact_->sub_compact_states.size()",
          "new_text": null,
          "old_line_content": "  const size_t num_threads = compact_->sub_compact_states.size();",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 576,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(num_threads > 0)",
          "new_text": null,
          "old_line_content": "  assert(num_threads > 0);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 577,
          "old_api": "NowMicros",
          "new_api": null,
          "old_text": "env_->NowMicros()",
          "new_text": null,
          "old_line_content": "  const uint64_t start_micros = env_->NowMicros();",
          "new_line_content": "Status CompactionJob::Run() {",
          "content_same": false
        },
        {
          "line": 1596,
          "old_api": "static_cast<int>(num_input_files)",
          "new_api": null,
          "old_text": "static_cast<int>(num_input_files)",
          "new_text": null,
          "old_line_content": "  *num_files += static_cast<int>(num_input_files);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1091,
          "old_api": "get",
          "new_api": null,
          "old_text": "range_del_agg.get()",
          "new_text": null,
          "old_line_content": "        status, sub_compact, range_del_agg.get(), &range_del_out_stats);",
          "new_line_content": "    // handle subcompaction containing only range deletions",
          "content_same": false
        },
        {
          "line": 1599,
          "old_api": "input",
          "new_api": null,
          "old_text": "compaction->input(input_level, i)",
          "new_text": null,
          "old_line_content": "    const auto* file_meta = compaction->input(input_level, i);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1600,
          "old_api": "GetFileSize",
          "new_api": null,
          "old_text": "file_meta->fd.GetFileSize()",
          "new_text": null,
          "old_line_content": "    *bytes_read += file_meta->fd.GetFileSize();",
          "new_line_content": "void CompactionJob::UpdateCompactionInputStatsHelper(int* num_files,",
          "content_same": false
        },
        {
          "line": 1602,
          "old_api": "static_cast<uint64_t>(file_meta->num_entries)",
          "new_api": null,
          "old_text": "static_cast<uint64_t>(file_meta->num_entries)",
          "new_text": null,
          "old_line_content": "        static_cast<uint64_t>(file_meta->num_entries);",
          "new_line_content": "                                                     int input_level) {",
          "content_same": false
        },
        {
          "line": 583,
          "old_api": "emplace_back",
          "new_api": null,
          "old_text": "thread_pool.emplace_back(&CompactionJob::ProcessKeyValueCompaction, this,\n                             &compact_->sub_compact_states[i])",
          "new_text": null,
          "old_line_content": "    thread_pool.emplace_back(&CompactionJob::ProcessKeyValueCompaction, this,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1095,
          "old_api": "RecordDroppedKeys",
          "new_api": null,
          "old_text": "RecordDroppedKeys(range_del_out_stats, &sub_compact->compaction_job_stats)",
          "new_text": null,
          "old_line_content": "    RecordDroppedKeys(range_del_out_stats, &sub_compact->compaction_job_stats);",
          "new_line_content": "  // Call FinishCompactionOutputFile() even if status is not ok: it needs to",
          "content_same": false
        },
        {
          "line": 589,
          "old_api": "ProcessKeyValueCompaction",
          "new_api": null,
          "old_text": "ProcessKeyValueCompaction(&compact_->sub_compact_states[0])",
          "new_text": null,
          "old_line_content": "  ProcessKeyValueCompaction(&compact_->sub_compact_states[0]);",
          "new_line_content": "  std::vector<port::Thread> thread_pool;",
          "content_same": false
        },
        {
          "line": 1102,
          "old_api": "IOSTATS",
          "new_api": null,
          "old_text": "IOSTATS(fsync_nanos)",
          "new_text": null,
          "old_line_content": "        IOSTATS(fsync_nanos) - prev_fsync_nanos;",
          "new_line_content": "      status = s;",
          "content_same": false
        },
        {
          "line": 593,
          "old_api": "join",
          "new_api": null,
          "old_text": "thread.join()",
          "new_text": null,
          "old_line_content": "    thread.join();",
          "new_line_content": "                             &compact_->sub_compact_states[i]);",
          "content_same": false
        },
        {
          "line": 1106,
          "old_api": "IOSTATS",
          "new_api": null,
          "old_text": "IOSTATS(prepare_write_nanos)",
          "new_text": null,
          "old_line_content": "        IOSTATS(prepare_write_nanos) - prev_prepare_write_nanos;",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 596,
          "old_api": "NowMicros",
          "new_api": null,
          "old_text": "env_->NowMicros()",
          "new_text": null,
          "old_line_content": "  compaction_stats_.micros = env_->NowMicros() - start_micros;",
          "new_line_content": "  // Always schedule the first subcompaction (whether or not there are also",
          "content_same": false
        },
        {
          "line": 597,
          "old_api": "MeasureTime",
          "new_api": null,
          "old_text": "MeasureTime(stats_, COMPACTION_TIME, compaction_stats_.micros)",
          "new_text": null,
          "old_line_content": "  MeasureTime(stats_, COMPACTION_TIME, compaction_stats_.micros);",
          "new_line_content": "  // others) in the current thread to be efficient with resources",
          "content_same": false
        },
        {
          "line": 1108,
          "old_api": "SetPerfLevel",
          "new_api": null,
          "old_text": "SetPerfLevel(prev_perf_level)",
          "new_text": null,
          "old_line_content": "      SetPerfLevel(prev_perf_level);",
          "new_line_content": "    sub_compact->compaction_job_stats.file_write_nanos +=",
          "content_same": false
        },
        {
          "line": 599,
          "old_api": "TEST_SYNC_POINT",
          "new_api": null,
          "old_text": "TEST_SYNC_POINT(\"CompactionJob::Run:BeforeVerify\")",
          "new_text": null,
          "old_line_content": "  TEST_SYNC_POINT(\"CompactionJob::Run:BeforeVerify\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1112,
          "old_api": "reset",
          "new_api": null,
          "old_text": "sub_compact->c_iter.reset()",
          "new_text": null,
          "old_line_content": "  sub_compact->c_iter.reset();",
          "new_line_content": "    sub_compact->compaction_job_stats.file_range_sync_nanos +=",
          "content_same": false
        },
        {
          "line": 1627,
          "old_api": "NumOutputFiles",
          "new_api": null,
          "old_text": "compact_->NumOutputFiles()",
          "new_text": null,
          "old_line_content": "    if (compact_->NumOutputFiles() > 0U) {",
          "new_line_content": "        stats.num_input_files_in_output_level;",
          "content_same": false
        },
        {
          "line": 604,
          "old_api": "ok",
          "new_api": null,
          "old_text": "state.status.ok()",
          "new_text": null,
          "old_line_content": "    if (!state.status.ok()) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1628,
          "old_api": "SmallestUserKey",
          "new_api": null,
          "old_text": "compact_->SmallestUserKey()",
          "new_text": null,
          "old_line_content": "      CopyPrefix(compact_->SmallestUserKey(),",
          "new_line_content": "    compaction_job_stats_->num_input_files_at_output_level =",
          "content_same": false
        },
        {
          "line": 1631,
          "old_api": "LargestUserKey",
          "new_api": null,
          "old_text": "compact_->LargestUserKey()",
          "new_text": null,
          "old_line_content": "      CopyPrefix(compact_->LargestUserKey(),",
          "new_line_content": "    // output information",
          "content_same": false
        },
        {
          "line": 610,
          "old_api": "ok",
          "new_api": null,
          "old_text": "status.ok()",
          "new_text": null,
          "old_line_content": "  if (status.ok() && output_directory_) {",
          "new_line_content": "  // Check if any thread encountered an error during execution",
          "content_same": false
        },
        {
          "line": 611,
          "old_api": "Fsync",
          "new_api": null,
          "old_text": "output_directory_->Fsync()",
          "new_text": null,
          "old_line_content": "    status = output_directory_->Fsync();",
          "new_line_content": "  Status status;",
          "content_same": false
        },
        {
          "line": 1125,
          "old_api": "RecordTick",
          "new_api": null,
          "old_text": "RecordTick(stats_, COMPACTION_KEY_DROP_NEWER_ENTRY,\n               c_iter_stats.num_record_drop_hidden)",
          "new_text": null,
          "old_line_content": "    RecordTick(stats_, COMPACTION_KEY_DROP_NEWER_ENTRY,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 614,
          "old_api": "ok",
          "new_api": null,
          "old_text": "status.ok()",
          "new_text": null,
          "old_line_content": "  if (status.ok()) {",
          "new_line_content": "      status = state.status;",
          "content_same": false
        },
        {
          "line": 615,
          "old_api": "clear",
          "new_api": null,
          "old_text": "thread_pool.clear()",
          "new_text": null,
          "old_line_content": "    thread_pool.clear();",
          "new_line_content": "      break;",
          "content_same": false
        },
        {
          "line": 1643,
          "old_api": "column_family_data",
          "new_api": null,
          "old_text": "compaction->column_family_data()",
          "new_text": null,
          "old_line_content": "  ColumnFamilyData* cfd = compaction->column_family_data();",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1133,
          "old_api": "RecordTick",
          "new_api": null,
          "old_text": "RecordTick(stats_, COMPACTION_KEY_DROP_OBSOLETE,\n               c_iter_stats.num_record_drop_obsolete)",
          "new_text": null,
          "old_line_content": "    RecordTick(stats_, COMPACTION_KEY_DROP_OBSOLETE,",
          "new_line_content": "  if (c_iter_stats.num_record_drop_hidden > 0) {",
          "content_same": false
        },
        {
          "line": 622,
          "old_api": "column_family_data",
          "new_api": null,
          "old_text": "compact_->compaction->column_family_data()",
          "new_text": null,
          "old_line_content": "    ColumnFamilyData* cfd = compact_->compaction->column_family_data();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1649,
          "old_api": "c_str",
          "new_api": null,
          "old_text": "ROCKS_LOG_INFO(\n        db_options_.info_log, \"[%s] [JOB %d] Compacting %s, score %.2f\",\n        cfd->GetName().c_str(), job_id_,\n        compaction->InputLevelSummary(&inputs_summary), compaction->score())",
          "new_text": null,
          "old_line_content": "    ROCKS_LOG_INFO(",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1651,
          "old_api": "c_str",
          "new_api": null,
          "old_text": "cfd->GetName().c_str()",
          "new_text": null,
          "old_line_content": "        cfd->GetName().c_str(), job_id_,",
          "new_line_content": "  Compaction* compaction = compact_->compaction;",
          "content_same": false
        },
        {
          "line": 629,
          "old_api": "size",
          "new_api": null,
          "old_text": "files_meta.size()",
          "new_text": null,
          "old_line_content": "        if (file_idx >= files_meta.size()) {",
          "new_line_content": "      }",
          "content_same": false
        },
        {
          "line": 1141,
          "old_api": "RecordTick",
          "new_api": null,
          "old_text": "RecordTick(stats_, COMPACTION_KEY_DROP_RANGE_DEL,\n               c_iter_stats.num_record_drop_range_del)",
          "new_text": null,
          "old_line_content": "    RecordTick(stats_, COMPACTION_KEY_DROP_RANGE_DEL,",
          "new_line_content": "  if (c_iter_stats.num_record_drop_obsolete > 0) {",
          "content_same": false
        },
        {
          "line": 1654,
          "old_api": "Summary",
          "new_api": null,
          "old_text": "compaction->Summary(scratch, sizeof(scratch))",
          "new_text": null,
          "old_line_content": "    compaction->Summary(scratch, sizeof(scratch));",
          "new_line_content": "  // Let's check if anything will get logged. Don't prepare all the info if",
          "content_same": false
        },
        {
          "line": 1655,
          "old_api": "c_str",
          "new_api": null,
          "old_text": "ROCKS_LOG_INFO(db_options_.info_log, \"[%s] Compaction start summary: %s\\n\",\n                   cfd->GetName().c_str(), scratch)",
          "new_text": null,
          "old_line_content": "    ROCKS_LOG_INFO(db_options_.info_log, \"[%s] Compaction start summary: %s\\n\",",
          "new_line_content": "  // we're not logging",
          "content_same": false
        },
        {
          "line": 1145,
          "old_api": "RecordTick",
          "new_api": null,
          "old_text": "RecordTick(stats_, COMPACTION_RANGE_DEL_DROP_OBSOLETE,\n               c_iter_stats.num_range_del_drop_obsolete)",
          "new_text": null,
          "old_line_content": "    RecordTick(stats_, COMPACTION_RANGE_DEL_DROP_OBSOLETE,",
          "new_line_content": "      compaction_job_stats->num_expired_deletion_records +=",
          "content_same": false
        },
        {
          "line": 1656,
          "old_api": "c_str",
          "new_api": null,
          "old_text": "cfd->GetName().c_str()",
          "new_text": null,
          "old_line_content": "                   cfd->GetName().c_str(), scratch);",
          "new_line_content": "  if (db_options_.info_log_level <= InfoLogLevel::INFO_LEVEL) {",
          "content_same": false
        },
        {
          "line": 1149,
          "old_api": "RecordTick",
          "new_api": null,
          "old_text": "RecordTick(stats_, COMPACTION_OPTIMIZED_DEL_DROP_OBSOLETE,\n               c_iter_stats.num_optimized_del_drop_obsolete)",
          "new_text": null,
          "old_line_content": "    RecordTick(stats_, COMPACTION_OPTIMIZED_DEL_DROP_OBSOLETE,",
          "new_line_content": "  if (c_iter_stats.num_record_drop_range_del > 0) {",
          "content_same": false
        },
        {
          "line": 1662,
          "old_api": "compaction_reason",
          "new_api": null,
          "old_text": "compaction->compaction_reason()",
          "new_text": null,
          "old_line_content": "           << GetCompactionReasonString(compaction->compaction_reason());",
          "new_line_content": "    char scratch[2345];",
          "content_same": false
        },
        {
          "line": 639,
          "old_api": "internal_comparator",
          "new_api": null,
          "old_text": "cfd->internal_comparator()",
          "new_text": null,
          "old_line_content": "            ReadOptions(), env_options_, cfd->internal_comparator(),",
          "new_line_content": "          break;",
          "content_same": false
        },
        {
          "line": 642,
          "old_api": "internal_stats",
          "new_api": null,
          "old_text": "cfd->internal_stats()->GetFileReadHist(\n                compact_->compaction->output_level())",
          "new_text": null,
          "old_line_content": "            cfd->internal_stats()->GetFileReadHist(",
          "new_line_content": "        // We set for_compaction to false and don't OptimizeForCompactionTableRead",
          "content_same": false
        },
        {
          "line": 643,
          "old_api": "output_level",
          "new_api": null,
          "old_text": "compact_->compaction->output_level()",
          "new_text": null,
          "old_line_content": "                compact_->compaction->output_level()),",
          "new_line_content": "        // here because this is a special case after we finish the table building",
          "content_same": false
        },
        {
          "line": 1666,
          "old_api": "inputs",
          "new_api": null,
          "old_text": "compaction->inputs(i)",
          "new_text": null,
          "old_line_content": "      for (auto f : *compaction->inputs(i)) {",
          "new_line_content": "    // build event logger report",
          "content_same": false
        },
        {
          "line": 645,
          "old_api": "output_level",
          "new_api": null,
          "old_text": "compact_->compaction->output_level()",
          "new_text": null,
          "old_line_content": "            compact_->compaction->output_level());",
          "new_line_content": "        // we will regard this verification as user reads since the goal is",
          "content_same": false
        },
        {
          "line": 646,
          "old_api": "status",
          "new_api": null,
          "old_text": "iter->status()",
          "new_text": null,
          "old_line_content": "        auto s = iter->status();",
          "new_line_content": "        // to cache it here for further user reads",
          "content_same": false
        },
        {
          "line": 1669,
          "old_api": "EndArray",
          "new_api": null,
          "old_text": "stream.EndArray()",
          "new_text": null,
          "old_line_content": "      stream.EndArray();",
          "new_line_content": "           << \"compaction_started\"",
          "content_same": false
        },
        {
          "line": 649,
          "old_api": "Next",
          "new_api": null,
          "old_text": "iter->Next()",
          "new_text": null,
          "old_line_content": "          for (iter->SeekToFirst(); iter->Valid(); iter->Next()) {}",
          "new_line_content": "            *files_meta[file_idx], nullptr /* range_del_agg */,",
          "content_same": false
        },
        {
          "line": 650,
          "old_api": "status",
          "new_api": null,
          "old_text": "iter->status()",
          "new_text": null,
          "old_line_content": "          s = iter->status();",
          "new_line_content": "            prefix_extractor, nullptr,",
          "content_same": false
        },
        {
          "line": 1161,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(sub_compact != nullptr)",
          "new_text": null,
          "old_line_content": "  assert(sub_compact != nullptr);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 1162,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(sub_compact->outfile)",
          "new_text": null,
          "old_line_content": "  assert(sub_compact->outfile);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1163,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(sub_compact->builder != nullptr)",
          "new_text": null,
          "old_line_content": "  assert(sub_compact->builder != nullptr);",
          "new_line_content": "Status CompactionJob::FinishCompactionOutputFile(",
          "content_same": false
        },
        {
          "line": 1164,
          "old_api": "current_output",
          "new_api": null,
          "old_text": "sub_compact->current_output()",
          "new_text": null,
          "old_line_content": "  assert(sub_compact->current_output() != nullptr);",
          "new_line_content": "    const Status& input_status, SubcompactionState* sub_compact,",
          "content_same": false
        },
        {
          "line": 1166,
          "old_api": "GetNumber",
          "new_api": null,
          "old_text": "sub_compact->current_output()->meta.fd.GetNumber()",
          "new_text": null,
          "old_line_content": "  uint64_t output_number = sub_compact->current_output()->meta.fd.GetNumber();",
          "new_line_content": "    CompactionIterationStats* range_del_out_stats,",
          "content_same": false
        },
        {
          "line": 1167,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(output_number != 0)",
          "new_text": null,
          "old_line_content": "  assert(output_number != 0);",
          "new_line_content": "    const Slice* next_table_min_key /* = nullptr */) {",
          "content_same": false
        },
        {
          "line": 1169,
          "old_api": "column_family_data",
          "new_api": null,
          "old_text": "sub_compact->compaction->column_family_data()",
          "new_text": null,
          "old_line_content": "  ColumnFamilyData* cfd = sub_compact->compaction->column_family_data();",
          "new_line_content": "      ThreadStatus::STAGE_COMPACTION_SYNC_FILE);",
          "content_same": false
        },
        {
          "line": 661,
          "old_api": "size",
          "new_api": null,
          "old_text": "compact_->sub_compact_states.size()",
          "new_text": null,
          "old_line_content": "    for (size_t i = 1; i < compact_->sub_compact_states.size(); i++) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 662,
          "old_api": "emplace_back",
          "new_api": null,
          "old_text": "thread_pool.emplace_back(verify_table,\n                               std::ref(compact_->sub_compact_states[i].status))",
          "new_text": null,
          "old_line_content": "      thread_pool.emplace_back(verify_table,",
          "new_line_content": "        delete iter;",
          "content_same": false
        },
        {
          "line": 663,
          "old_api": "std::ref(compact_->sub_compact_states[i].status)",
          "new_api": null,
          "old_text": "std::ref(compact_->sub_compact_states[i].status)",
          "new_text": null,
          "old_line_content": "                               std::ref(compact_->sub_compact_states[i].status));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1174,
          "old_api": "current_output",
          "new_api": null,
          "old_text": "sub_compact->current_output()",
          "new_text": null,
          "old_line_content": "  auto meta = &sub_compact->current_output()->meta;",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 665,
          "old_api": "verify_table",
          "new_api": null,
          "old_text": "verify_table(compact_->sub_compact_states[0].status)",
          "new_text": null,
          "old_line_content": "    verify_table(compact_->sub_compact_states[0].status);",
          "new_line_content": "          output_status = s;",
          "content_same": false
        },
        {
          "line": 667,
          "old_api": "join",
          "new_api": null,
          "old_text": "thread.join()",
          "new_text": null,
          "old_line_content": "      thread.join();",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 1180,
          "old_api": "size",
          "new_api": null,
          "old_text": "sub_compact->outputs.size()",
          "new_text": null,
          "old_line_content": "    if (sub_compact->outputs.size() == 1) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1188,
          "old_api": "user_key",
          "new_api": null,
          "old_text": "meta->smallest.user_key().ToString(false /*hex*/)",
          "new_text": null,
          "old_line_content": "      smallest_user_key = meta->smallest.user_key().ToString(false /*hex*/);",
          "new_line_content": "    const Slice *lower_bound, *upper_bound;",
          "content_same": false
        },
        {
          "line": 681,
          "old_api": "immutable_cf_options",
          "new_api": null,
          "old_text": "state.compaction->immutable_cf_options()",
          "new_text": null,
          "old_line_content": "          TableFileName(state.compaction->immutable_cf_options()->cf_paths,",
          "new_line_content": "        break;",
          "content_same": false
        },
        {
          "line": 682,
          "old_api": "GetPathId",
          "new_api": null,
          "old_text": "output.meta.fd.GetPathId()",
          "new_text": null,
          "old_line_content": "                        output.meta.fd.GetNumber(), output.meta.fd.GetPathId());",
          "new_line_content": "      }",
          "content_same": false
        },
        {
          "line": 686,
          "old_api": "std::move(tp)",
          "new_api": null,
          "old_text": "std::move(tp)",
          "new_text": null,
          "old_line_content": "  compact_->compaction->SetOutputTableProperties(std::move(tp));",
          "new_line_content": "  TablePropertiesCollection tp;",
          "content_same": false
        },
        {
          "line": 689,
          "old_api": "AggregateStatistics",
          "new_api": null,
          "old_text": "AggregateStatistics()",
          "new_text": null,
          "old_line_content": "  AggregateStatistics();",
          "new_line_content": "      auto fn =",
          "content_same": false
        },
        {
          "line": 692,
          "old_api": "LogFlush",
          "new_api": null,
          "old_text": "LogFlush(db_options_.info_log)",
          "new_text": null,
          "old_line_content": "  LogFlush(db_options_.info_log);",
          "new_line_content": "      tp[fn] = output.table_properties;",
          "content_same": false
        },
        {
          "line": 693,
          "old_api": "TEST_SYNC_POINT",
          "new_api": null,
          "old_text": "TEST_SYNC_POINT(\"CompactionJob::Run():End\")",
          "new_text": null,
          "old_line_content": "  TEST_SYNC_POINT(\"CompactionJob::Run():End\");",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1205,
          "old_api": "size",
          "new_api": null,
          "old_text": "existing_snapshots_.size()",
          "new_text": null,
          "old_line_content": "    if (existing_snapshots_.size() > 0) {",
          "new_line_content": "      // file starts.",
          "content_same": false
        },
        {
          "line": 1208,
          "old_api": "NewIterator",
          "new_api": null,
          "old_text": "range_del_agg->NewIterator()",
          "new_text": null,
          "old_line_content": "    auto it = range_del_agg->NewIterator();",
          "new_line_content": "    } else {",
          "content_same": false
        },
        {
          "line": 1210,
          "old_api": "Seek",
          "new_api": null,
          "old_text": "it->Seek(*lower_bound)",
          "new_text": null,
          "old_line_content": "      it->Seek(*lower_bound);",
          "new_line_content": "      // subcompaction ends.",
          "content_same": false
        },
        {
          "line": 704,
          "old_api": "column_family_data",
          "new_api": null,
          "old_text": "compact_->compaction->column_family_data()",
          "new_text": null,
          "old_line_content": "  ColumnFamilyData* cfd = compact_->compaction->column_family_data();",
          "new_line_content": "  compact_->status = status;",
          "content_same": false
        },
        {
          "line": 705,
          "old_api": "internal_stats",
          "new_api": null,
          "old_text": "cfd->internal_stats()->AddCompactionStats(\n      compact_->compaction->output_level(), compaction_stats_)",
          "new_text": null,
          "old_line_content": "  cfd->internal_stats()->AddCompactionStats(",
          "new_line_content": "  return status;",
          "content_same": false
        },
        {
          "line": 706,
          "old_api": "output_level",
          "new_api": null,
          "old_text": "compact_->compaction->output_level()",
          "new_text": null,
          "old_line_content": "      compact_->compaction->output_level(), compaction_stats_);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 1216,
          "old_api": "user_key",
          "new_api": null,
          "old_text": "meta->largest.user_key()",
          "new_text": null,
          "old_line_content": "          ucmp->Compare(meta->largest.user_key(), *upper_bound) == 0;",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 708,
          "old_api": "ok",
          "new_api": null,
          "old_text": "status.ok()",
          "new_text": null,
          "old_line_content": "  if (status.ok()) {",
          "new_line_content": "Status CompactionJob::Install(const MutableCFOptions& mutable_cf_options) {",
          "content_same": false
        },
        {
          "line": 709,
          "old_api": "InstallCompactionResults",
          "new_api": null,
          "old_text": "InstallCompactionResults(mutable_cf_options)",
          "new_text": null,
          "old_line_content": "    status = InstallCompactionResults(mutable_cf_options);",
          "new_line_content": "  AutoThreadOperationStageUpdater stage_updater(",
          "content_same": false
        },
        {
          "line": 1220,
          "old_api": "Next",
          "new_api": null,
          "old_text": "it->Next()",
          "new_text": null,
          "old_line_content": "    for (; it->Valid(); it->Next()) {",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1221,
          "old_api": "Tombstone",
          "new_api": null,
          "old_text": "it->Tombstone()",
          "new_text": null,
          "old_line_content": "      auto tombstone = it->Tombstone();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 712,
          "old_api": "current",
          "new_api": null,
          "old_text": "cfd->current()->storage_info()",
          "new_text": null,
          "old_line_content": "  auto vstorage = cfd->current()->storage_info();",
          "new_line_content": "  Status status = compact_->status;",
          "content_same": false
        },
        {
          "line": 723,
          "old_api": "static_cast<double>(stats.bytes_read_non_output_levels)",
          "new_api": null,
          "old_text": "static_cast<double>(stats.bytes_read_non_output_levels)",
          "new_text": null,
          "old_line_content": "                     static_cast<double>(stats.bytes_read_non_output_levels);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 725,
          "old_api": "static_cast<double>(stats.bytes_read_non_output_levels)",
          "new_api": null,
          "old_text": "static_cast<double>(stats.bytes_read_non_output_levels)",
          "new_text": null,
          "old_line_content": "                static_cast<double>(stats.bytes_read_non_output_levels);",
          "new_line_content": "  double write_amp = 0.0;",
          "content_same": false
        },
        {
          "line": 730,
          "old_api": "static_cast<double>(stats.micros)",
          "new_api": null,
          "old_text": "static_cast<double>(stats.micros)",
          "new_text": null,
          "old_line_content": "        static_cast<double>(stats.micros);",
          "new_line_content": "    read_write_amp = (stats.bytes_written + stats.bytes_read_output_level +",
          "content_same": false
        },
        {
          "line": 1244,
          "old_api": "Serialize",
          "new_api": null,
          "old_text": "tombstone.Serialize()",
          "new_text": null,
          "old_line_content": "      auto kv = tombstone.Serialize();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1245,
          "old_api": "Encode",
          "new_api": null,
          "old_text": "kv.first.Encode()",
          "new_text": null,
          "old_line_content": "      sub_compact->builder->Add(kv.first.Encode(), kv.second);",
          "new_line_content": "      if (bottommost_level_ && tombstone.seq_ <= earliest_snapshot) {",
          "content_same": false
        },
        {
          "line": 1246,
          "old_api": "std::move(kv.first)",
          "new_api": null,
          "old_text": "std::move(kv.first)",
          "new_text": null,
          "old_line_content": "      InternalKey smallest_candidate = std::move(kv.first);",
          "new_line_content": "        // TODO(andrewkr): tombstones that span multiple output files are",
          "content_same": false
        },
        {
          "line": 735,
          "old_api": "c_str",
          "new_api": null,
          "old_text": "ROCKS_LOG_BUFFER(\n      log_buffer_,\n      \"[%s] compacted to: %s, MB/sec: %.1f rd, %.1f wr, level %d, \"\n      \"files in(%d, %d) out(%d) \"\n      \"MB in(%.1f, %.1f) out(%.1f), read-write-amplify(%.1f) \"\n      \"write-amplify(%.1f) %s, records in: %\" PRIu64\n      \", records dropped: %\" PRIu64 \" output_compression: %s\\n\",\n      cfd->GetName().c_str(), vstorage->LevelSummary(&tmp), bytes_read_per_sec,\n      bytes_written_per_sec, compact_->compaction->output_level(),\n      stats.num_input_files_in_non_output_levels,\n      stats.num_input_files_in_output_level, stats.num_output_files,\n      stats.bytes_read_non_output_levels / 1048576.0,\n      stats.bytes_read_output_level / 1048576.0,\n      stats.bytes_written / 1048576.0, read_write_amp, write_amp,\n      status.ToString().c_str(), stats.num_input_records,\n      stats.num_dropped_records,\n      CompressionTypeToString(compact_->compaction->output_compression())\n          .c_str())",
          "new_text": null,
          "old_line_content": "  ROCKS_LOG_BUFFER(",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 1248,
          "old_api": "user_key",
          "new_api": null,
          "old_text": "smallest_candidate.user_key()",
          "new_text": null,
          "old_line_content": "          ucmp->Compare(smallest_candidate.user_key(), *lower_bound) <= 0) {",
          "new_line_content": "        range_del_out_stats->num_range_del_drop_obsolete++;",
          "content_same": false
        },
        {
          "line": 742,
          "old_api": "LevelSummary",
          "new_api": null,
          "old_text": "vstorage->LevelSummary(&tmp)",
          "new_text": null,
          "old_line_content": "      cfd->GetName().c_str(), vstorage->LevelSummary(&tmp), bytes_read_per_sec,",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 743,
          "old_api": "output_level",
          "new_api": null,
          "old_text": "compact_->compaction->output_level()",
          "new_text": null,
          "old_line_content": "      bytes_written_per_sec, compact_->compaction->output_level(),",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1259,
          "old_api": "SerializeEndKey",
          "new_api": null,
          "old_text": "tombstone.SerializeEndKey()",
          "new_text": null,
          "old_line_content": "      InternalKey largest_candidate = tombstone.SerializeEndKey();",
          "new_line_content": "        // (the max key in the previous table or subcompaction) in order for",
          "content_same": false
        },
        {
          "line": 749,
          "old_api": "ToString",
          "new_api": null,
          "old_text": "status.ToString().c_str()",
          "new_text": null,
          "old_line_content": "      status.ToString().c_str(), stats.num_input_records,",
          "new_line_content": "      \"write-amplify(%.1f) %s, records in: %\" PRIu64",
          "content_same": false
        },
        {
          "line": 1261,
          "old_api": "user_key",
          "new_api": null,
          "old_text": "largest_candidate.user_key()",
          "new_text": null,
          "old_line_content": "          ucmp->Compare(*upper_bound, largest_candidate.user_key()) <= 0) {",
          "new_line_content": "        //",
          "content_same": false
        },
        {
          "line": 754,
          "old_api": "UpdateCompactionJobStats",
          "new_api": null,
          "old_text": "UpdateCompactionJobStats(stats)",
          "new_text": null,
          "old_line_content": "  UpdateCompactionJobStats(stats);",
          "new_line_content": "      stats.num_input_files_in_output_level, stats.num_output_files,",
          "content_same": false
        },
        {
          "line": 756,
          "old_api": "LogToBuffer",
          "new_api": null,
          "old_text": "event_logger_->LogToBuffer(log_buffer_)",
          "new_text": null,
          "old_line_content": "  auto stream = event_logger_->LogToBuffer(log_buffer_);",
          "new_line_content": "      stats.bytes_read_output_level / 1048576.0,",
          "content_same": false
        },
        {
          "line": 761,
          "old_api": "NumOutputFiles",
          "new_api": null,
          "old_text": "compact_->NumOutputFiles()",
          "new_text": null,
          "old_line_content": "         << \"num_output_files\" << compact_->NumOutputFiles()",
          "new_line_content": "          .c_str());",
          "content_same": false
        },
        {
          "line": 1277,
          "old_api": "InternalKey",
          "new_api": null,
          "old_text": "InternalKey(*upper_bound, kMaxSequenceNumber, kTypeRangeDeletion)",
          "new_text": null,
          "old_line_content": "            InternalKey(*upper_bound, kMaxSequenceNumber, kTypeRangeDeletion);",
          "new_line_content": "        // OK because the read path's file-picking code only considers the user",
          "content_same": false
        },
        {
          "line": 766,
          "old_api": "output_compression",
          "new_api": null,
          "old_text": "compact_->compaction->output_compression()",
          "new_text": null,
          "old_line_content": "         << CompressionTypeToString(compact_->compaction->output_compression());",
          "new_line_content": "  stream << \"job\" << job_id_ << \"event\"",
          "content_same": false
        },
        {
          "line": 1279,
          "old_api": "UpdateBoundariesForRange",
          "new_api": null,
          "old_text": "meta->UpdateBoundariesForRange(smallest_candidate, largest_candidate,\n                                     tombstone.seq_,\n                                     cfd->internal_comparator())",
          "new_text": null,
          "old_line_content": "      meta->UpdateBoundariesForRange(smallest_candidate, largest_candidate,",
          "new_line_content": "        //",
          "content_same": false
        },
        {
          "line": 1281,
          "old_api": "internal_comparator",
          "new_api": null,
          "old_text": "cfd->internal_comparator()",
          "new_text": null,
          "old_line_content": "                                     cfd->internal_comparator());",
          "new_line_content": "        // kMaxSequenceNumber), but with kTypeDeletion (0x7) instead of",
          "content_same": false
        },
        {
          "line": 1283,
          "old_api": "NeedCompact",
          "new_api": null,
          "old_text": "sub_compact->builder->NeedCompact()",
          "new_text": null,
          "old_line_content": "    meta->marked_for_compaction = sub_compact->builder->NeedCompact();",
          "new_line_content": "        // Seek() key in InternalKey's ordering. So Seek() will look in the",
          "content_same": false
        },
        {
          "line": 1285,
          "old_api": "NumEntries",
          "new_api": null,
          "old_text": "sub_compact->builder->NumEntries()",
          "new_text": null,
          "old_line_content": "  const uint64_t current_entries = sub_compact->builder->NumEntries();",
          "new_line_content": "        largest_candidate =",
          "content_same": false
        },
        {
          "line": 1287,
          "old_api": "Finish",
          "new_api": null,
          "old_text": "sub_compact->builder->Finish()",
          "new_text": null,
          "old_line_content": "    s = sub_compact->builder->Finish();",
          "new_line_content": "      }",
          "content_same": false
        },
        {
          "line": 1289,
          "old_api": "Abandon",
          "new_api": null,
          "old_text": "sub_compact->builder->Abandon()",
          "new_text": null,
          "old_line_content": "    sub_compact->builder->Abandon();",
          "new_line_content": "                                     tombstone.seq_,",
          "content_same": false
        },
        {
          "line": 1291,
          "old_api": "FileSize",
          "new_api": null,
          "old_text": "sub_compact->builder->FileSize()",
          "new_text": null,
          "old_line_content": "  const uint64_t current_bytes = sub_compact->builder->FileSize();",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 785,
          "old_api": "StartArray",
          "new_api": null,
          "old_text": "stream.StartArray()",
          "new_text": null,
          "old_line_content": "  stream.StartArray();",
          "new_line_content": "    stream << \"file_write_nanos\" << compaction_job_stats_->file_write_nanos;",
          "content_same": false
        },
        {
          "line": 786,
          "old_api": "num_levels",
          "new_api": null,
          "old_text": "vstorage->num_levels()",
          "new_text": null,
          "old_line_content": "  for (int level = 0; level < vstorage->num_levels(); ++level) {",
          "new_line_content": "    stream << \"file_range_sync_nanos\"",
          "content_same": false
        },
        {
          "line": 787,
          "old_api": "NumLevelFiles",
          "new_api": null,
          "old_text": "vstorage->NumLevelFiles(level)",
          "new_text": null,
          "old_line_content": "    stream << vstorage->NumLevelFiles(level);",
          "new_line_content": "           << compaction_job_stats_->file_range_sync_nanos;",
          "content_same": false
        },
        {
          "line": 1299,
          "old_api": "ok",
          "new_api": null,
          "old_text": "s.ok()",
          "new_text": null,
          "old_line_content": "  if (s.ok()) {",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 789,
          "old_api": "EndArray",
          "new_api": null,
          "old_text": "stream.EndArray()",
          "new_text": null,
          "old_line_content": "  stream.EndArray();",
          "new_line_content": "    stream << \"file_prepare_write_nanos\"",
          "content_same": false
        },
        {
          "line": 791,
          "old_api": "CleanupCompaction",
          "new_api": null,
          "old_text": "CleanupCompaction()",
          "new_text": null,
          "old_line_content": "  CleanupCompaction();",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 1303,
          "old_api": "ok",
          "new_api": null,
          "old_text": "s.ok()",
          "new_text": null,
          "old_line_content": "  if (s.ok()) {",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 1306,
          "old_api": "reset",
          "new_api": null,
          "old_text": "sub_compact->outfile.reset()",
          "new_text": null,
          "old_line_content": "  sub_compact->outfile.reset();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 797,
          "old_api": "column_family_data",
          "new_api": null,
          "old_text": "sub_compact->compaction->column_family_data()",
          "new_text": null,
          "old_line_content": "  ColumnFamilyData* cfd = sub_compact->compaction->column_family_data();",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 1309,
          "old_api": "ok",
          "new_api": null,
          "old_text": "s.ok()",
          "new_text": null,
          "old_line_content": "  if (s.ok()) {",
          "new_line_content": "    StopWatch sw(env_, stats_, COMPACTION_OUTFILE_SYNC_MICROS);",
          "content_same": false
        },
        {
          "line": 799,
          "old_api": "internal_comparator",
          "new_api": null,
          "old_text": "cfd->internal_comparator()",
          "new_text": null,
          "old_line_content": "      new RangeDelAggregator(cfd->internal_comparator(), existing_snapshots_));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 801,
          "old_api": "get",
          "new_api": null,
          "old_text": "range_del_agg.get()",
          "new_text": null,
          "old_line_content": "      sub_compact->compaction, range_del_agg.get(), env_optiosn_for_read_));",
          "new_line_content": "  return status;",
          "content_same": false
        },
        {
          "line": 1320,
          "old_api": "DeleteFile",
          "new_api": null,
          "old_text": "env_->DeleteFile(fname)",
          "new_text": null,
          "old_line_content": "    env_->DeleteFile(fname);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 1324,
          "old_api": "empty",
          "new_api": null,
          "old_text": "sub_compact->outputs.empty()",
          "new_text": null,
          "old_line_content": "    assert(!sub_compact->outputs.empty());",
          "new_line_content": "    // This happens when the output level is bottom level, at the same time",
          "content_same": false
        },
        {
          "line": 1325,
          "old_api": "pop_back",
          "new_api": null,
          "old_text": "sub_compact->outputs.pop_back()",
          "new_text": null,
          "old_line_content": "    sub_compact->outputs.pop_back();",
          "new_line_content": "    // the sub_compact output nothing.",
          "content_same": false
        },
        {
          "line": 814,
          "old_api": "GetPerfLevel",
          "new_api": null,
          "old_text": "GetPerfLevel()",
          "new_text": null,
          "old_line_content": "    prev_perf_level = GetPerfLevel();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 815,
          "old_api": "SetPerfLevel",
          "new_api": null,
          "old_text": "SetPerfLevel(PerfLevel::kEnableTime)",
          "new_text": null,
          "old_line_content": "    SetPerfLevel(PerfLevel::kEnableTime);",
          "new_line_content": "  // I/O measurement variables",
          "content_same": false
        },
        {
          "line": 816,
          "old_api": "IOSTATS",
          "new_api": null,
          "old_text": "IOSTATS(write_nanos)",
          "new_text": null,
          "old_line_content": "    prev_write_nanos = IOSTATS(write_nanos);",
          "new_line_content": "  PerfLevel prev_perf_level = PerfLevel::kEnableTime;",
          "content_same": false
        },
        {
          "line": 817,
          "old_api": "IOSTATS",
          "new_api": null,
          "old_text": "IOSTATS(fsync_nanos)",
          "new_text": null,
          "old_line_content": "    prev_fsync_nanos = IOSTATS(fsync_nanos);",
          "new_line_content": "  const uint64_t kRecordStatsEvery = 1000;",
          "content_same": false
        },
        {
          "line": 818,
          "old_api": "IOSTATS",
          "new_api": null,
          "old_text": "IOSTATS(range_sync_nanos)",
          "new_text": null,
          "old_line_content": "    prev_range_sync_nanos = IOSTATS(range_sync_nanos);",
          "new_line_content": "  uint64_t prev_write_nanos = 0;",
          "content_same": false
        },
        {
          "line": 819,
          "old_api": "IOSTATS",
          "new_api": null,
          "old_text": "IOSTATS(prepare_write_nanos)",
          "new_text": null,
          "old_line_content": "    prev_prepare_write_nanos = IOSTATS(prepare_write_nanos);",
          "new_line_content": "  uint64_t prev_fsync_nanos = 0;",
          "content_same": false
        },
        {
          "line": 1331,
          "old_api": "current_output",
          "new_api": null,
          "old_text": "sub_compact->current_output()",
          "new_text": null,
          "old_line_content": "    sub_compact->current_output()->table_properties =",
          "new_line_content": "    // Also need to remove the file from outputs, or it will be added to the",
          "content_same": false
        },
        {
          "line": 1332,
          "old_api": "std::make_shared<TableProperties>(tp)",
          "new_api": null,
          "old_text": "std::make_shared<TableProperties>(tp)",
          "new_text": null,
          "old_line_content": "        std::make_shared<TableProperties>(tp);",
          "new_line_content": "    // VersionEdit.",
          "content_same": false
        },
        {
          "line": 1336,
          "old_api": "c_str",
          "new_api": null,
          "old_text": "cfd->GetName().c_str()",
          "new_text": null,
          "old_line_content": "                   cfd->GetName().c_str(), job_id_, output_number,",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 830,
          "old_api": "output_compression_opts",
          "new_api": null,
          "old_text": "sub_compact->compaction->output_compression_opts()",
          "new_text": null,
          "old_line_content": "      sub_compact->compaction->output_compression_opts().zstd_max_train_bytes >",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1344,
          "old_api": "immutable_cf_options",
          "new_api": null,
          "old_text": "sub_compact->compaction->immutable_cf_options()",
          "new_text": null,
          "old_line_content": "        TableFileName(sub_compact->compaction->immutable_cf_options()->cf_paths,",
          "new_line_content": "                   \" keys, %\" PRIu64 \" bytes%s\",",
          "content_same": false
        },
        {
          "line": 834,
          "old_api": "output_compression_opts",
          "new_api": null,
          "old_text": "sub_compact->compaction->output_compression_opts()",
          "new_text": null,
          "old_line_content": "          ? sub_compact->compaction->output_compression_opts()",
          "new_line_content": "  // To build compression dictionary, we sample the first output file, assuming",
          "content_same": false
        },
        {
          "line": 836,
          "old_api": "output_compression_opts",
          "new_api": null,
          "old_text": "sub_compact->compaction->output_compression_opts()",
          "new_text": null,
          "old_line_content": "          : sub_compact->compaction->output_compression_opts().max_dict_bytes;",
          "new_line_content": "  // zstd's dictionary trainer, or just use them directly. Then, the dictionary",
          "content_same": false
        },
        {
          "line": 1350,
          "old_api": "ioptions",
          "new_api": null,
          "old_text": "EventHelpers::LogAndNotifyTableFileCreationFinished(\n      event_logger_, cfd->ioptions()->listeners, dbname_, cfd->GetName(), fname,\n      job_id_, output_fd, tp, TableFileCreationReason::kCompaction, s)",
          "new_text": null,
          "old_line_content": "  EventHelpers::LogAndNotifyTableFileCreationFinished(",
          "new_line_content": "  FileDescriptor output_fd;",
          "content_same": false
        },
        {
          "line": 1351,
          "old_api": "GetName",
          "new_api": null,
          "old_text": "cfd->GetName()",
          "new_text": null,
          "old_line_content": "      event_logger_, cfd->ioptions()->listeners, dbname_, cfd->GetName(), fname,",
          "new_line_content": "  if (meta != nullptr) {",
          "content_same": false
        },
        {
          "line": 842,
          "old_api": "output_level",
          "new_api": null,
          "old_text": "MaxFileSizeForLevel(*mutable_cf_options,\n            compact_->compaction->output_level(),\n            cfd->ioptions()->compaction_style,\n            compact_->compaction->GetInputBaseLevel(),\n            cfd->ioptions()->level_compaction_dynamic_level_bytes)",
          "new_text": null,
          "old_line_content": "        static_cast<size_t>(MaxFileSizeForLevel(*mutable_cf_options,",
          "new_line_content": "      kUseZstdTrainer",
          "content_same": false
        },
        {
          "line": 844,
          "old_api": "ioptions",
          "new_api": null,
          "old_text": "cfd->ioptions()",
          "new_text": null,
          "old_line_content": "            cfd->ioptions()->compaction_style,",
          "new_line_content": "                .zstd_max_train_bytes",
          "content_same": false
        },
        {
          "line": 1357,
          "old_api": "get",
          "new_api": null,
          "old_text": "db_options_.sst_file_manager.get()",
          "new_text": null,
          "old_line_content": "      static_cast<SstFileManagerImpl*>(db_options_.sst_file_manager.get());",
          "new_line_content": "    fname = \"(nil)\";",
          "content_same": false
        },
        {
          "line": 846,
          "old_api": "ioptions",
          "new_api": null,
          "old_text": "cfd->ioptions()",
          "new_text": null,
          "old_line_content": "            cfd->ioptions()->level_compaction_dynamic_level_bytes));",
          "new_line_content": "  const int kSampleLenShift = 6;  // 2^6 = 64-byte samples",
          "content_same": false
        },
        {
          "line": 1358,
          "old_api": "GetPathId",
          "new_api": null,
          "old_text": "meta->fd.GetPathId()",
          "new_text": null,
          "old_line_content": "  if (sfm && meta != nullptr && meta->fd.GetPathId() == 0) {",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 849,
          "old_api": "NewFileNumber",
          "new_api": null,
          "old_text": "versions_->NewFileNumber()",
          "new_text": null,
          "old_line_content": "      Random64 generator{versions_->NewFileNumber()};",
          "new_line_content": "    const size_t kMaxSamples = kSampleBytes >> kSampleLenShift;",
          "content_same": false
        },
        {
          "line": 1361,
          "old_api": "GetPathId",
          "new_api": null,
          "old_text": "meta->fd.GetPathId()",
          "new_text": null,
          "old_line_content": "                      meta->fd.GetNumber(), meta->fd.GetPathId());",
          "new_line_content": "      job_id_, output_fd, tp, TableFileCreationReason::kCompaction, s);",
          "content_same": false
        },
        {
          "line": 1362,
          "old_api": "OnAddFile",
          "new_api": null,
          "old_text": "sfm->OnAddFile(fn)",
          "new_text": null,
          "old_line_content": "    sfm->OnAddFile(fn);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1363,
          "old_api": "IsMaxAllowedSpaceReached",
          "new_api": null,
          "old_text": "sfm->IsMaxAllowedSpaceReached()",
          "new_text": null,
          "old_line_content": "    if (sfm->IsMaxAllowedSpaceReached()) {",
          "new_line_content": "#ifndef ROCKSDB_LITE",
          "content_same": false
        },
        {
          "line": 862,
          "old_api": "CreateCompactionFilter",
          "new_api": null,
          "old_text": "sub_compact->compaction->CreateCompactionFilter()",
          "new_text": null,
          "old_line_content": "        sub_compact->compaction->CreateCompactionFilter();",
          "new_line_content": "            << kSampleLenShift);",
          "content_same": false
        },
        {
          "line": 863,
          "old_api": "get",
          "new_api": null,
          "old_text": "compaction_filter_from_factory.get()",
          "new_text": null,
          "old_line_content": "    compaction_filter = compaction_filter_from_factory.get();",
          "new_line_content": "      }",
          "content_same": false
        },
        {
          "line": 866,
          "old_api": "ioptions",
          "new_api": null,
          "old_text": "cfd->ioptions()",
          "new_text": null,
          "old_line_content": "      env_, cfd->user_comparator(), cfd->ioptions()->merge_operator,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 869,
          "old_api": "back",
          "new_api": null,
          "old_text": "existing_snapshots_.back()",
          "new_text": null,
          "old_line_content": "      existing_snapshots_.empty() ? 0 : existing_snapshots_.back(),",
          "new_line_content": "  if (compaction_filter == nullptr) {",
          "content_same": false
        },
        {
          "line": 870,
          "old_api": "level",
          "new_api": null,
          "old_text": "compact_->compaction->level()",
          "new_text": null,
          "old_line_content": "      snapshot_checker_, compact_->compaction->level(),",
          "new_line_content": "    compaction_filter_from_factory =",
          "content_same": false
        },
        {
          "line": 1383,
          "old_api": "AssertHeld",
          "new_api": null,
          "old_text": "db_mutex_->AssertHeld()",
          "new_text": null,
          "old_line_content": "  db_mutex_->AssertHeld();",
          "new_line_content": "#endif",
          "content_same": false
        },
        {
          "line": 873,
          "old_api": "TEST_SYNC_POINT",
          "new_api": null,
          "old_text": "TEST_SYNC_POINT(\"CompactionJob::Run():Inprogress\")",
          "new_text": null,
          "old_line_content": "  TEST_SYNC_POINT(\"CompactionJob::Run():Inprogress\");",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 1390,
          "old_api": "VerifyCompactionFileConsistency",
          "new_api": null,
          "old_text": "versions_->VerifyCompactionFileConsistency(compaction)",
          "new_text": null,
          "old_line_content": "  if (!versions_->VerifyCompactionFileConsistency(compaction)) {",
          "new_line_content": "Status CompactionJob::InstallCompactionResults(",
          "content_same": false
        },
        {
          "line": 1393,
          "old_api": "c_str",
          "new_api": null,
          "old_text": "ROCKS_LOG_ERROR(db_options_.info_log, \"[%s] [JOB %d] Compaction %s aborted\",\n                    compaction->column_family_data()->GetName().c_str(),\n                    job_id_, compaction->InputLevelSummary(&inputs_summary))",
          "new_text": null,
          "old_line_content": "    ROCKS_LOG_ERROR(db_options_.info_log, \"[%s] [JOB %d] Compaction %s aborted\",",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1394,
          "old_api": "c_str",
          "new_api": null,
          "old_text": "compaction->column_family_data()->GetName().c_str()",
          "new_text": null,
          "old_line_content": "                    compaction->column_family_data()->GetName().c_str(),",
          "new_line_content": "  auto* compaction = compact_->compaction;",
          "content_same": false
        },
        {
          "line": 1395,
          "old_api": "InputLevelSummary",
          "new_api": null,
          "old_text": "compaction->InputLevelSummary(&inputs_summary)",
          "new_text": null,
          "old_line_content": "                    job_id_, compaction->InputLevelSummary(&inputs_summary));",
          "new_line_content": "  // paranoia: verify that the files that we started with",
          "content_same": false
        },
        {
          "line": 1396,
          "old_api": "Status::Corruption(\"Compaction input files inconsistent\")",
          "new_api": null,
          "old_text": "Status::Corruption(\"Compaction input files inconsistent\")",
          "new_text": null,
          "old_line_content": "    return Status::Corruption(\"Compaction input files inconsistent\");",
          "new_line_content": "  // still exist in the current version and in the same original level.",
          "content_same": false
        },
        {
          "line": 886,
          "old_api": "reset",
          "new_api": null,
          "old_text": "sub_compact->c_iter.reset(new CompactionIterator(\n      input.get(), cfd->user_comparator(), &merge, versions_->LastSequence(),\n      &existing_snapshots_, earliest_write_conflict_snapshot_,\n      snapshot_checker_, env_, ShouldReportDetailedTime(env_, stats_), false,\n      range_del_agg.get(), sub_compact->compaction, compaction_filter,\n      shutting_down_, preserve_deletes_seqnum_))",
          "new_text": null,
          "old_line_content": "  sub_compact->c_iter.reset(new CompactionIterator(",
          "new_line_content": "  if (start != nullptr) {",
          "content_same": false
        },
        {
          "line": 887,
          "old_api": "LastSequence",
          "new_api": null,
          "old_text": "versions_->LastSequence()",
          "new_text": null,
          "old_line_content": "      input.get(), cfd->user_comparator(), &merge, versions_->LastSequence(),",
          "new_line_content": "    IterKey start_iter;",
          "content_same": false
        },
        {
          "line": 1401,
          "old_api": "c_str",
          "new_api": null,
          "old_text": "ROCKS_LOG_INFO(\n        db_options_.info_log, \"[%s] [JOB %d] Compacted %s => %\" PRIu64 \" bytes\",\n        compaction->column_family_data()->GetName().c_str(), job_id_,\n        compaction->InputLevelSummary(&inputs_summary), compact_->total_bytes)",
          "new_text": null,
          "old_line_content": "    ROCKS_LOG_INFO(",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 890,
          "old_api": "get",
          "new_api": null,
          "old_text": "range_del_agg.get()",
          "new_text": null,
          "old_line_content": "      range_del_agg.get(), sub_compact->compaction, compaction_filter,",
          "new_line_content": "  } else {",
          "content_same": false
        },
        {
          "line": 892,
          "old_api": "get",
          "new_api": null,
          "old_text": "sub_compact->c_iter.get()",
          "new_text": null,
          "old_line_content": "  auto c_iter = sub_compact->c_iter.get();",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 893,
          "old_api": "SeekToFirst",
          "new_api": null,
          "old_text": "c_iter->SeekToFirst()",
          "new_text": null,
          "old_line_content": "  c_iter->SeekToFirst();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 894,
          "old_api": "output_level",
          "new_api": null,
          "old_text": "sub_compact->compaction->output_level()",
          "new_text": null,
          "old_line_content": "  if (c_iter->Valid() && sub_compact->compaction->output_level() != 0) {",
          "new_line_content": "  Status status;",
          "content_same": false
        },
        {
          "line": 1408,
          "old_api": "edit",
          "new_api": null,
          "old_text": "compact_->compaction->edit()",
          "new_text": null,
          "old_line_content": "  compaction->AddInputDeletions(compact_->compaction->edit());",
          "new_line_content": "  {",
          "content_same": false
        },
        {
          "line": 1415,
          "old_api": "column_family_data",
          "new_api": null,
          "old_text": "compaction->column_family_data()",
          "new_text": null,
          "old_line_content": "  return versions_->LogAndApply(compaction->column_family_data(),",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1416,
          "old_api": "edit",
          "new_api": null,
          "old_text": "compaction->edit()",
          "new_text": null,
          "old_line_content": "                                mutable_cf_options, compaction->edit(),",
          "new_line_content": "  // Add compaction inputs",
          "content_same": false
        },
        {
          "line": 909,
          "old_api": "Valid",
          "new_api": null,
          "old_text": "c_iter->Valid()",
          "new_text": null,
          "old_line_content": "  while (status.ok() && !cfd->IsDropped() && c_iter->Valid()) {",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 1422,
          "old_api": "ThreadStatusUtil::IncreaseThreadOperationProperty(\n      ThreadStatus::COMPACTION_BYTES_READ, IOSTATS(bytes_read))",
          "new_api": null,
          "old_text": "ThreadStatusUtil::IncreaseThreadOperationProperty(\n      ThreadStatus::COMPACTION_BYTES_READ, IOSTATS(bytes_read))",
          "new_text": null,
          "old_line_content": "  ThreadStatusUtil::IncreaseThreadOperationProperty(",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1423,
          "old_api": "IOSTATS",
          "new_api": null,
          "old_text": "IOSTATS(bytes_read)",
          "new_text": null,
          "old_line_content": "      ThreadStatus::COMPACTION_BYTES_READ, IOSTATS(bytes_read));",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 912,
          "old_api": "key",
          "new_api": null,
          "old_text": "c_iter->key()",
          "new_text": null,
          "old_line_content": "    const Slice& key = c_iter->key();",
          "new_line_content": "  // data_begin_offset and dict_sample_data are only valid while generating",
          "content_same": false
        },
        {
          "line": 913,
          "old_api": "value",
          "new_api": null,
          "old_text": "c_iter->value()",
          "new_text": null,
          "old_line_content": "    const Slice& value = c_iter->value();",
          "new_line_content": "  // dictionary from the first output file.",
          "content_same": false
        },
        {
          "line": 1426,
          "old_api": "ThreadStatusUtil::IncreaseThreadOperationProperty(\n      ThreadStatus::COMPACTION_BYTES_WRITTEN, IOSTATS(bytes_written))",
          "new_api": null,
          "old_text": "ThreadStatusUtil::IncreaseThreadOperationProperty(\n      ThreadStatus::COMPACTION_BYTES_WRITTEN, IOSTATS(bytes_written))",
          "new_text": null,
          "old_line_content": "  ThreadStatusUtil::IncreaseThreadOperationProperty(",
          "new_line_content": "                                db_mutex_, db_directory_);",
          "content_same": false
        },
        {
          "line": 1427,
          "old_api": "IOSTATS",
          "new_api": null,
          "old_text": "IOSTATS(bytes_written)",
          "new_text": null,
          "old_line_content": "      ThreadStatus::COMPACTION_BYTES_WRITTEN, IOSTATS(bytes_written));",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 1428,
          "old_api": "IOSTATS_RESET",
          "new_api": null,
          "old_text": "IOSTATS_RESET(bytes_written)",
          "new_text": null,
          "old_line_content": "  IOSTATS_RESET(bytes_written);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 923,
          "old_api": "RecordDroppedKeys",
          "new_api": null,
          "old_text": "RecordDroppedKeys(c_iter_stats, &sub_compact->compaction_job_stats)",
          "new_text": null,
          "old_line_content": "      RecordDroppedKeys(c_iter_stats, &sub_compact->compaction_job_stats);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 924,
          "old_api": "ResetRecordCounts",
          "new_api": null,
          "old_text": "c_iter->ResetRecordCounts()",
          "new_text": null,
          "old_line_content": "      c_iter->ResetRecordCounts();",
          "new_line_content": "    // If an end key (exclusive) is specified, check if the current key is",
          "content_same": false
        },
        {
          "line": 925,
          "old_api": "RecordCompactionIOStats",
          "new_api": null,
          "old_text": "RecordCompactionIOStats()",
          "new_text": null,
          "old_line_content": "      RecordCompactionIOStats();",
          "new_line_content": "    // >= than it and exit if it is because the iterator is out of its range",
          "content_same": false
        },
        {
          "line": 1438,
          "old_api": "immutable_cf_options",
          "new_api": null,
          "old_text": "sub_compact->compaction->immutable_cf_options()",
          "new_text": null,
          "old_line_content": "      TableFileName(sub_compact->compaction->immutable_cf_options()->cf_paths,",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 1439,
          "old_api": "output_path_id",
          "new_api": null,
          "old_text": "sub_compact->compaction->output_path_id()",
          "new_text": null,
          "old_line_content": "                    file_number, sub_compact->compaction->output_path_id());",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1441,
          "old_api": "column_family_data",
          "new_api": null,
          "old_text": "sub_compact->compaction->column_family_data()",
          "new_text": null,
          "old_line_content": "  ColumnFamilyData* cfd = sub_compact->compaction->column_family_data();",
          "new_line_content": "    SubcompactionState* sub_compact) {",
          "content_same": false
        },
        {
          "line": 930,
          "old_api": "OpenCompactionOutputFile",
          "new_api": null,
          "old_text": "OpenCompactionOutputFile(sub_compact)",
          "new_text": null,
          "old_line_content": "      status = OpenCompactionOutputFile(sub_compact);",
          "new_line_content": "    if (c_iter_stats.num_input_records % kRecordStatsEvery ==",
          "content_same": false
        },
        {
          "line": 931,
          "old_api": "ok",
          "new_api": null,
          "old_text": "status.ok()",
          "new_text": null,
          "old_line_content": "      if (!status.ok()) {",
          "new_line_content": "        kRecordStatsEvery - 1) {",
          "content_same": false
        },
        {
          "line": 1444,
          "old_api": "GetName",
          "new_api": null,
          "old_text": "cfd->GetName()",
          "new_text": null,
          "old_line_content": "      cfd->ioptions()->listeners, dbname_, cfd->GetName(), fname, job_id_,",
          "new_line_content": "  // no need to lock because VersionSet::next_file_number_ is atomic",
          "content_same": false
        },
        {
          "line": 935,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(sub_compact->builder != nullptr)",
          "new_text": null,
          "old_line_content": "    assert(sub_compact->builder != nullptr);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 936,
          "old_api": "current_output",
          "new_api": null,
          "old_text": "sub_compact->current_output()",
          "new_text": null,
          "old_line_content": "    assert(sub_compact->current_output() != nullptr);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 937,
          "old_api": "Add",
          "new_api": null,
          "old_text": "sub_compact->builder->Add(key, value)",
          "new_text": null,
          "old_line_content": "    sub_compact->builder->Add(key, value);",
          "new_line_content": "    // Open output file if necessary",
          "content_same": false
        },
        {
          "line": 938,
          "old_api": "FileSize",
          "new_api": null,
          "old_text": "sub_compact->builder->FileSize()",
          "new_text": null,
          "old_line_content": "    sub_compact->current_output_file_size = sub_compact->builder->FileSize();",
          "new_line_content": "    if (sub_compact->builder == nullptr) {",
          "content_same": false
        },
        {
          "line": 1451,
          "old_api": "TEST_SYNC_POINT_CALLBACK",
          "new_api": null,
          "old_text": "TEST_SYNC_POINT_CALLBACK(\"CompactionJob::OpenCompactionOutputFile\",\n                           &syncpoint_arg)",
          "new_text": null,
          "old_line_content": "  TEST_SYNC_POINT_CALLBACK(\"CompactionJob::OpenCompactionOutputFile\",",
          "new_line_content": "#ifndef ROCKSDB_LITE",
          "content_same": false
        },
        {
          "line": 1454,
          "old_api": "NewWritableFile",
          "new_api": null,
          "old_text": "NewWritableFile(env_, fname, &writable_file, env_options_)",
          "new_text": null,
          "old_line_content": "  Status s = NewWritableFile(env_, fname, &writable_file, env_options_);",
          "new_line_content": "      TableFileCreationReason::kCompaction);",
          "content_same": false
        },
        {
          "line": 943,
          "old_api": "size",
          "new_api": null,
          "old_text": "sub_compact->outputs.size()",
          "new_text": null,
          "old_line_content": "    if (sub_compact->outputs.size() == 1) {  // first output file",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1455,
          "old_api": "ok",
          "new_api": null,
          "old_text": "s.ok()",
          "new_text": null,
          "old_line_content": "  if (!s.ok()) {",
          "new_line_content": "#endif  // !ROCKSDB_LITE",
          "content_same": false
        },
        {
          "line": 1456,
          "old_api": "c_str",
          "new_api": null,
          "old_text": "ROCKS_LOG_ERROR(\n        db_options_.info_log,\n        \"[%s] [JOB %d] OpenCompactionOutputFiles for table #%\" PRIu64\n        \" fails at NewWritableFile with status %s\",\n        sub_compact->compaction->column_family_data()->GetName().c_str(),\n        job_id_, file_number, s.ToString().c_str())",
          "new_text": null,
          "old_line_content": "    ROCKS_LOG_ERROR(",
          "new_line_content": "  // Make the output file",
          "content_same": false
        },
        {
          "line": 1461,
          "old_api": "ToString",
          "new_api": null,
          "old_text": "s.ToString().c_str()",
          "new_text": null,
          "old_line_content": "        job_id_, file_number, s.ToString().c_str());",
          "new_line_content": "                           &syncpoint_arg);",
          "content_same": false
        },
        {
          "line": 1462,
          "old_api": "LogFlush",
          "new_api": null,
          "old_text": "LogFlush(db_options_.info_log)",
          "new_text": null,
          "old_line_content": "    LogFlush(db_options_.info_log);",
          "new_line_content": "#endif",
          "content_same": false
        },
        {
          "line": 955,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(data_begin_offset < sample_end_offset)",
          "new_text": null,
          "old_line_content": "          assert(data_begin_offset < sample_end_offset);",
          "new_line_content": "      for (const auto& data_elmt : {key, value}) {",
          "content_same": false
        },
        {
          "line": 1475,
          "old_api": "push_back",
          "new_api": null,
          "old_text": "sub_compact->outputs.push_back(out)",
          "new_text": null,
          "old_line_content": "  sub_compact->outputs.push_back(out);",
          "new_line_content": "        TableFileCreationReason::kCompaction, s);",
          "content_same": false
        },
        {
          "line": 1476,
          "old_api": "SetIOPriority",
          "new_api": null,
          "old_text": "writable_file->SetIOPriority(Env::IO_LOW)",
          "new_text": null,
          "old_line_content": "  writable_file->SetIOPriority(Env::IO_LOW);",
          "new_line_content": "    return s;",
          "content_same": false
        },
        {
          "line": 1477,
          "old_api": "SetWriteLifeTimeHint",
          "new_api": null,
          "old_text": "writable_file->SetWriteLifeTimeHint(write_hint_)",
          "new_text": null,
          "old_line_content": "  writable_file->SetWriteLifeTimeHint(write_hint_);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 1478,
          "old_api": "OutputFilePreallocationSize",
          "new_api": null,
          "old_text": "static_cast<size_t>(\n      sub_compact->compaction->OutputFilePreallocationSize())",
          "new_text": null,
          "old_line_content": "  writable_file->SetPreallocationBlockSize(static_cast<size_t>(",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1479,
          "old_api": "OutputFilePreallocationSize",
          "new_api": null,
          "old_text": "sub_compact->compaction->OutputFilePreallocationSize()",
          "new_text": null,
          "old_line_content": "      sub_compact->compaction->OutputFilePreallocationSize()));",
          "new_line_content": "  SubcompactionState::Output out;",
          "content_same": false
        },
        {
          "line": 1482,
          "old_api": "reset",
          "new_api": null,
          "old_text": "sub_compact->outfile.reset(\n      new WritableFileWriter(std::move(writable_file), fname, env_options_,\n                             db_options_.statistics.get(), listeners))",
          "new_text": null,
          "old_line_content": "  sub_compact->outfile.reset(",
          "new_line_content": "  out.finished = false;",
          "content_same": false
        },
        {
          "line": 1483,
          "old_api": "std::move(writable_file)",
          "new_api": null,
          "old_text": "std::move(writable_file)",
          "new_text": null,
          "old_line_content": "      new WritableFileWriter(std::move(writable_file), fname, env_options_,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 979,
          "old_api": "data",
          "new_api": null,
          "old_text": "data_elmt.data()",
          "new_text": null,
          "old_line_content": "          dict_sample_data.append(&data_elmt.data()[data_elmt_copy_offset],",
          "new_line_content": "            // needed.",
          "content_same": false
        },
        {
          "line": 1496,
          "old_api": "GetCurrentTime",
          "new_api": null,
          "old_text": "db_options_.env->GetCurrentTime(&_current_time)",
          "new_text": null,
          "old_line_content": "    auto status = db_options_.env->GetCurrentTime(&_current_time);",
          "new_line_content": "  // we can skip creating filters if this is the bottommost_level where",
          "content_same": false
        },
        {
          "line": 1498,
          "old_api": "ok",
          "new_api": null,
          "old_text": "status.ok()",
          "new_text": null,
          "old_line_content": "    if (!status.ok()) {",
          "new_line_content": "  bool skip_filters =",
          "content_same": false
        },
        {
          "line": 1503,
          "old_api": "ToString",
          "new_api": null,
          "old_text": "status.ToString().c_str()",
          "new_text": null,
          "old_line_content": "          status.ToString().c_str());",
          "new_line_content": "  if (output_file_creation_time == 0) {",
          "content_same": false
        },
        {
          "line": 1509,
          "old_api": "mutable_cf_options",
          "new_api": null,
          "old_text": "sub_compact->compaction->mutable_cf_options()",
          "new_text": null,
          "old_line_content": "      *cfd->ioptions(), *(sub_compact->compaction->mutable_cf_options()),",
          "new_line_content": "          db_options_.info_log,",
          "content_same": false
        },
        {
          "line": 1510,
          "old_api": "int_tbl_prop_collector_factories",
          "new_api": null,
          "old_text": "cfd->int_tbl_prop_collector_factories()",
          "new_text": null,
          "old_line_content": "      cfd->internal_comparator(), cfd->int_tbl_prop_collector_factories(),",
          "new_line_content": "          \"Failed to get current time to populate creation_time property. \"",
          "content_same": false
        },
        {
          "line": 1511,
          "old_api": "get",
          "new_api": null,
          "old_text": "sub_compact->outfile.get()",
          "new_text": null,
          "old_line_content": "      cfd->GetID(), cfd->GetName(), sub_compact->outfile.get(),",
          "new_line_content": "          \"Status: %s\",",
          "content_same": false
        },
        {
          "line": 1513,
          "old_api": "output_compression_opts",
          "new_api": null,
          "old_text": "sub_compact->compaction->output_compression_opts()",
          "new_text": null,
          "old_line_content": "      sub_compact->compaction->output_compression_opts(),",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1002,
          "old_api": "output_level",
          "new_api": null,
          "old_text": "sub_compact->compaction->output_level()",
          "new_text": null,
          "old_line_content": "    if (sub_compact->compaction->output_level() != 0 &&",
          "new_line_content": "    // time to close it: (1) the current key should be this file's last key, (2)",
          "content_same": false
        },
        {
          "line": 1004,
          "old_api": "max_output_file_size",
          "new_api": null,
          "old_text": "sub_compact->compaction->max_output_file_size()",
          "new_text": null,
          "old_line_content": "            sub_compact->compaction->max_output_file_size()) {",
          "new_line_content": "    //",
          "content_same": false
        },
        {
          "line": 1516,
          "old_api": "LogFlush",
          "new_api": null,
          "old_text": "LogFlush(db_options_.info_log)",
          "new_text": null,
          "old_line_content": "  LogFlush(db_options_.info_log);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1007,
          "old_api": "status",
          "new_api": null,
          "old_text": "input->status()",
          "new_text": null,
          "old_line_content": "      input_status = input->status();",
          "new_line_content": "    // going to be 1.2MB and max_output_file_size = 1MB, prefer to have 0.6MB",
          "content_same": false
        },
        {
          "line": 1010,
          "old_api": "Next",
          "new_api": null,
          "old_text": "c_iter->Next()",
          "new_text": null,
          "old_line_content": "    c_iter->Next();",
          "new_line_content": "    Status input_status;",
          "content_same": false
        },
        {
          "line": 1012,
          "old_api": "output_level",
          "new_api": null,
          "old_text": "sub_compact->compaction->output_level()",
          "new_text": null,
          "old_line_content": "        sub_compact->compaction->output_level() != 0 &&",
          "new_line_content": "        sub_compact->current_output_file_size >=",
          "content_same": false
        },
        {
          "line": 1526,
          "old_api": "Abandon",
          "new_api": null,
          "old_text": "sub_compact.builder->Abandon()",
          "new_text": null,
          "old_line_content": "      sub_compact.builder->Abandon();",
          "new_line_content": "  return s;",
          "content_same": false
        },
        {
          "line": 1527,
          "old_api": "reset",
          "new_api": null,
          "old_text": "sub_compact.builder.reset()",
          "new_text": null,
          "old_line_content": "      sub_compact.builder.reset();",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 1529,
          "old_api": "ok",
          "new_api": null,
          "old_text": "sub_status.ok()",
          "new_text": null,
          "old_line_content": "      assert(!sub_status.ok() || sub_compact.outfile == nullptr);",
          "new_line_content": "void CompactionJob::CleanupCompaction() {",
          "content_same": false
        },
        {
          "line": 1534,
          "old_api": "ok",
          "new_api": null,
          "old_text": "sub_status.ok()",
          "new_text": null,
          "old_line_content": "      if (!sub_status.ok()) {",
          "new_line_content": "      // May happen if we get a shutdown call in the middle of compaction",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 117,
      "total_additions": 265,
      "total_deletions": 263,
      "total_api_changes": 645
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 10,
        "api_related_lines": 645,
        "non_api_lines": 5,
        "non_api_line_numbers": [
          516,
          527,
          528,
          529,
          530
        ]
      }
    },
    "api_calls_before": 620,
    "api_calls_after": 622,
    "diff_info": {
      "added_lines": 10,
      "removed_lines": 1,
      "total_diff_lines": 31
    }
  }
}