{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/grpc/modified_file/e26af337263d0be3d16bb4abe36d9cb53b54c717",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/grpc/modified_file/e26af337263d0be3d16bb4abe36d9cb53b54c717/before.cc",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/grpc/modified_file/e26af337263d0be3d16bb4abe36d9cb53b54c717/after.cc",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/grpc/modified_file/e26af337263d0be3d16bb4abe36d9cb53b54c717/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 84,
          "old_api": "grpc_error_get_int",
          "new_api": "grpc_http2_error_to_grpc_status",
          "old_text": "grpc_error_get_int(found_error, GRPC_ERROR_INT_GRPC_STATUS,\n                                  &integer)",
          "new_text": "grpc_http2_error_to_grpc_status(\n        static_cast<grpc_http2_error_code>(integer), deadline)",
          "old_line_content": "    } else if (grpc_error_get_int(found_error, GRPC_ERROR_INT_GRPC_STATUS,",
          "new_line_content": "    status = grpc_http2_error_to_grpc_status(",
          "content_same": false
        },
        {
          "line": 99,
          "old_api": "grpc_slice_from_static_string",
          "new_api": "static_cast<grpc_status_code>(integer)",
          "old_text": "grpc_slice_from_static_string(\"unknown error\")",
          "new_text": "static_cast<grpc_status_code>(integer)",
          "old_line_content": "        *slice = grpc_slice_from_static_string(\"unknown error\");",
          "new_line_content": "          grpc_status_to_http2_error(static_cast<grpc_status_code>(integer));",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 96,
          "old_api": null,
          "new_api": "grpc_error_get_int",
          "old_text": null,
          "new_text": "grpc_error_get_int(found_error, GRPC_ERROR_INT_GRPC_STATUS,\n                                  &integer)",
          "old_line_content": "  if (slice != nullptr) {",
          "new_line_content": "    } else if (grpc_error_get_int(found_error, GRPC_ERROR_INT_GRPC_STATUS,",
          "content_same": false
        },
        {
          "line": 66,
          "old_api": null,
          "new_api": "recursively_find_error_with_field",
          "old_text": null,
          "new_text": "recursively_find_error_with_field(error, GRPC_ERROR_INT_GRPC_STATUS)",
          "old_line_content": "  grpc_status_code status = GRPC_STATUS_UNKNOWN;",
          "new_line_content": "      recursively_find_error_with_field(error, GRPC_ERROR_INT_GRPC_STATUS);",
          "content_same": false
        },
        {
          "line": 126,
          "old_api": null,
          "new_api": "grpc_error_has_clear_grpc_status",
          "old_text": null,
          "new_text": "grpc_error_has_clear_grpc_status(lerr->err)",
          "old_line_content": "",
          "new_line_content": "    if (grpc_error_has_clear_grpc_status(lerr->err)) {",
          "content_same": false
        },
        {
          "line": 71,
          "old_api": null,
          "new_api": "recursively_find_error_with_field",
          "old_text": null,
          "new_text": "recursively_find_error_with_field(error, GRPC_ERROR_INT_HTTP2_ERROR)",
          "old_line_content": "                                &integer)) {",
          "new_line_content": "        recursively_find_error_with_field(error, GRPC_ERROR_INT_HTTP2_ERROR);",
          "content_same": false
        },
        {
          "line": 109,
          "old_api": null,
          "new_api": "grpc_error_get_str",
          "old_text": null,
          "new_text": "grpc_error_get_str(found_error, GRPC_ERROR_STR_GRPC_MESSAGE, slice)",
          "old_line_content": "  }",
          "new_line_content": "    if (!grpc_error_get_str(found_error, GRPC_ERROR_STR_GRPC_MESSAGE, slice)) {",
          "content_same": false
        },
        {
          "line": 110,
          "old_api": null,
          "new_api": "grpc_error_get_str",
          "old_text": null,
          "new_text": "grpc_error_get_str(found_error, GRPC_ERROR_STR_DESCRIPTION, slice)",
          "old_line_content": "  uint8_t slot = error->first_err;",
          "new_line_content": "      if (!grpc_error_get_str(found_error, GRPC_ERROR_STR_DESCRIPTION, slice)) {",
          "content_same": false
        },
        {
          "line": 111,
          "old_api": null,
          "new_api": "grpc_slice_from_static_string",
          "old_text": null,
          "new_text": "grpc_slice_from_static_string(\"unknown error\")",
          "old_line_content": "  while (slot != UINT8_MAX) {",
          "new_line_content": "        *slice = grpc_slice_from_static_string(\"unknown error\");",
          "content_same": false
        },
        {
          "line": 80,
          "old_api": null,
          "new_api": "grpc_error_get_int",
          "old_text": null,
          "new_text": "grpc_error_get_int(found_error, GRPC_ERROR_INT_GRPC_STATUS, &integer)",
          "old_line_content": "",
          "new_line_content": "  if (grpc_error_get_int(found_error, GRPC_ERROR_INT_GRPC_STATUS, &integer)) {",
          "content_same": false
        },
        {
          "line": 81,
          "old_api": null,
          "new_api": "static_cast<grpc_status_code>(integer)",
          "old_text": null,
          "new_text": "static_cast<grpc_status_code>(integer)",
          "old_line_content": "  if (http_error != nullptr) {",
          "new_line_content": "    status = static_cast<grpc_status_code>(integer);",
          "content_same": false
        },
        {
          "line": 52,
          "old_api": null,
          "new_api": "GPR_LIKELY",
          "old_text": null,
          "new_text": "GPR_LIKELY(error == GRPC_ERROR_NONE)",
          "old_line_content": "  // until we find the first one that has a status code.",
          "new_line_content": "  if (GPR_LIKELY(error == GRPC_ERROR_NONE)) {",
          "content_same": false
        },
        {
          "line": 85,
          "old_api": null,
          "new_api": "static_cast<grpc_http2_error_code>(integer)",
          "old_text": null,
          "new_text": "static_cast<grpc_http2_error_code>(integer)",
          "old_line_content": "                                  &integer)) {",
          "new_line_content": "        static_cast<grpc_http2_error_code>(integer), deadline);",
          "content_same": false
        },
        {
          "line": 119,
          "old_api": null,
          "new_api": "grpc_error_get_int",
          "old_text": null,
          "new_text": "grpc_error_get_int(error, GRPC_ERROR_INT_GRPC_STATUS, &unused)",
          "old_line_content": "  return false;",
          "new_line_content": "  if (grpc_error_get_int(error, GRPC_ERROR_INT_GRPC_STATUS, &unused)) {",
          "content_same": false
        },
        {
          "line": 55,
          "old_api": null,
          "new_api": "grpc_error_get_str",
          "old_text": null,
          "new_text": "grpc_error_get_str(error, GRPC_ERROR_STR_GRPC_MESSAGE, slice)",
          "old_line_content": "  if (found_error == nullptr) {",
          "new_line_content": "      grpc_error_get_str(error, GRPC_ERROR_STR_GRPC_MESSAGE, slice);",
          "content_same": false
        },
        {
          "line": 90,
          "old_api": null,
          "new_api": "grpc_error_string",
          "old_text": null,
          "new_text": "grpc_error_string(error)",
          "old_line_content": "                                                   : GRPC_HTTP2_INTERNAL_ERROR;",
          "new_line_content": "    *error_string = gpr_strdup(grpc_error_string(error));",
          "content_same": false
        },
        {
          "line": 125,
          "old_api": null,
          "new_api": "reinterpret_cast<grpc_linked_error*>(error->arena + slot)",
          "old_text": null,
          "new_text": "reinterpret_cast<grpc_linked_error*>(error->arena + slot)",
          "old_line_content": "",
          "new_line_content": "        reinterpret_cast<grpc_linked_error*>(error->arena + slot);",
          "content_same": false
        },
        {
          "line": 94,
          "old_api": null,
          "new_api": "grpc_error_get_int",
          "old_text": null,
          "new_text": "grpc_error_get_int(found_error, GRPC_ERROR_INT_HTTP2_ERROR, &integer)",
          "old_line_content": "  // If the error has a status message, use it.  Otherwise, fall back to",
          "new_line_content": "    if (grpc_error_get_int(found_error, GRPC_ERROR_INT_HTTP2_ERROR, &integer)) {",
          "content_same": false
        },
        {
          "line": 95,
          "old_api": null,
          "new_api": "static_cast<grpc_http2_error_code>(integer)",
          "old_text": null,
          "new_text": "static_cast<grpc_http2_error_code>(integer)",
          "old_line_content": "  // the error description.",
          "new_line_content": "      *http_error = static_cast<grpc_http2_error_code>(integer);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 97,
          "old_api": "grpc_error_get_str",
          "new_api": null,
          "old_text": "grpc_error_get_str(found_error, GRPC_ERROR_STR_GRPC_MESSAGE, slice)",
          "new_text": null,
          "old_line_content": "    if (!grpc_error_get_str(found_error, GRPC_ERROR_STR_GRPC_MESSAGE, slice)) {",
          "new_line_content": "                                  &integer)) {",
          "content_same": false
        },
        {
          "line": 98,
          "old_api": "grpc_error_get_str",
          "new_api": null,
          "old_text": "grpc_error_get_str(found_error, GRPC_ERROR_STR_DESCRIPTION, slice)",
          "new_text": null,
          "old_line_content": "      if (!grpc_error_get_str(found_error, GRPC_ERROR_STR_DESCRIPTION, slice)) {",
          "new_line_content": "      *http_error =",
          "content_same": false
        },
        {
          "line": 68,
          "old_api": "grpc_error_get_int",
          "new_api": null,
          "old_text": "grpc_error_get_int(found_error, GRPC_ERROR_INT_GRPC_STATUS, &integer)",
          "new_text": null,
          "old_line_content": "  if (grpc_error_get_int(found_error, GRPC_ERROR_INT_GRPC_STATUS, &integer)) {",
          "new_line_content": "    /// If no grpc-status exists, retry through the tree to find a http2 error",
          "content_same": false
        },
        {
          "line": 69,
          "old_api": "static_cast<grpc_status_code>(integer)",
          "new_api": null,
          "old_text": "static_cast<grpc_status_code>(integer)",
          "new_text": null,
          "old_line_content": "    status = static_cast<grpc_status_code>(integer);",
          "new_line_content": "    /// code",
          "content_same": false
        },
        {
          "line": 70,
          "old_api": "grpc_error_get_int",
          "new_api": null,
          "old_text": "grpc_error_get_int(found_error, GRPC_ERROR_INT_HTTP2_ERROR,\n                                &integer)",
          "new_text": null,
          "old_line_content": "  } else if (grpc_error_get_int(found_error, GRPC_ERROR_INT_HTTP2_ERROR,",
          "new_line_content": "    found_error =",
          "content_same": false
        },
        {
          "line": 72,
          "old_api": "grpc_http2_error_to_grpc_status",
          "new_api": null,
          "old_text": "grpc_http2_error_to_grpc_status(\n        static_cast<grpc_http2_error_code>(integer), deadline)",
          "new_text": null,
          "old_line_content": "    status = grpc_http2_error_to_grpc_status(",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 73,
          "old_api": "static_cast<grpc_http2_error_code>(integer)",
          "new_api": null,
          "old_text": "static_cast<grpc_http2_error_code>(integer)",
          "new_text": null,
          "old_line_content": "        static_cast<grpc_http2_error_code>(integer), deadline);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 107,
          "old_api": "grpc_error_get_int",
          "new_api": null,
          "old_text": "grpc_error_get_int(error, GRPC_ERROR_INT_GRPC_STATUS, &unused)",
          "new_text": null,
          "old_line_content": "  if (grpc_error_get_int(error, GRPC_ERROR_INT_GRPC_STATUS, &unused)) {",
          "new_line_content": "  // the error description.",
          "content_same": false
        },
        {
          "line": 78,
          "old_api": "grpc_error_string",
          "new_api": null,
          "old_text": "grpc_error_string(error)",
          "new_text": null,
          "old_line_content": "    *error_string = gpr_strdup(grpc_error_string(error));",
          "new_line_content": "  grpc_status_code status = GRPC_STATUS_UNKNOWN;",
          "content_same": false
        },
        {
          "line": 113,
          "old_api": "reinterpret_cast<grpc_linked_error*>(error->arena + slot)",
          "new_api": null,
          "old_text": "reinterpret_cast<grpc_linked_error*>(error->arena + slot)",
          "new_text": null,
          "old_line_content": "        reinterpret_cast<grpc_linked_error*>(error->arena + slot);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 114,
          "old_api": "grpc_error_has_clear_grpc_status",
          "new_api": null,
          "old_text": "grpc_error_has_clear_grpc_status(lerr->err)",
          "new_text": null,
          "old_line_content": "    if (grpc_error_has_clear_grpc_status(lerr->err)) {",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 83,
          "old_api": "static_cast<grpc_http2_error_code>(integer)",
          "new_api": null,
          "old_text": "static_cast<grpc_http2_error_code>(integer)",
          "new_text": null,
          "old_line_content": "      *http_error = static_cast<grpc_http2_error_code>(integer);",
          "new_line_content": "                                &integer)) {",
          "content_same": false
        },
        {
          "line": 54,
          "old_api": "recursively_find_error_with_field",
          "new_api": null,
          "old_text": "recursively_find_error_with_field(error, GRPC_ERROR_INT_GRPC_STATUS)",
          "new_text": null,
          "old_line_content": "      recursively_find_error_with_field(error, GRPC_ERROR_INT_GRPC_STATUS);",
          "new_line_content": "    if (slice != nullptr) {",
          "content_same": false
        },
        {
          "line": 87,
          "old_api": "static_cast<grpc_status_code>(integer)",
          "new_api": null,
          "old_text": "static_cast<grpc_status_code>(integer)",
          "new_text": null,
          "old_line_content": "          grpc_status_to_http2_error(static_cast<grpc_status_code>(integer));",
          "new_line_content": "  if (code != nullptr) *code = status;",
          "content_same": false
        },
        {
          "line": 59,
          "old_api": "recursively_find_error_with_field",
          "new_api": null,
          "old_text": "recursively_find_error_with_field(error, GRPC_ERROR_INT_HTTP2_ERROR)",
          "new_text": null,
          "old_line_content": "        recursively_find_error_with_field(error, GRPC_ERROR_INT_HTTP2_ERROR);",
          "new_line_content": "    }",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 2,
      "total_additions": 17,
      "total_deletions": 15,
      "total_api_changes": 34
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 12,
        "api_related_lines": 34,
        "non_api_lines": 7,
        "non_api_line_numbers": [
          64,
          74,
          76,
          56,
          58,
          60,
          62
        ]
      }
    },
    "api_calls_before": 24,
    "api_calls_after": 26,
    "diff_info": {
      "added_lines": 13,
      "removed_lines": 1,
      "total_diff_lines": 43
    }
  }
}