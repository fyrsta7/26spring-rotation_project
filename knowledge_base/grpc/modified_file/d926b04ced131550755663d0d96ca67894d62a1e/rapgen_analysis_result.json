{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/grpc/modified_file/d926b04ced131550755663d0d96ca67894d62a1e",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/grpc/modified_file/d926b04ced131550755663d0d96ca67894d62a1e/before.cc",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/grpc/modified_file/d926b04ced131550755663d0d96ca67894d62a1e/after.cc",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/grpc/modified_file/d926b04ced131550755663d0d96ca67894d62a1e/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 165,
          "old_api": "CALL_ELEMS_FROM_STACK",
          "new_api": "reinterpret_cast<char*>(call_elems)",
          "old_text": "CALL_ELEMS_FROM_STACK(elem_args->call_stack)",
          "new_text": "reinterpret_cast<char*>(call_elems)",
          "old_line_content": "  call_elems = CALL_ELEMS_FROM_STACK(elem_args->call_stack);",
          "new_line_content": "  user_data = (reinterpret_cast<char*>(call_elems)) +",
          "content_same": false
        },
        {
          "line": 166,
          "old_api": "reinterpret_cast<char*>(call_elems)",
          "new_api": "GPR_ROUND_UP_TO_ALIGNMENT_SIZE",
          "old_text": "reinterpret_cast<char*>(call_elems)",
          "new_text": "GPR_ROUND_UP_TO_ALIGNMENT_SIZE(count * sizeof(grpc_call_element))",
          "old_line_content": "  user_data = (reinterpret_cast<char*>(call_elems)) +",
          "new_line_content": "              GPR_ROUND_UP_TO_ALIGNMENT_SIZE(count * sizeof(grpc_call_element));",
          "content_same": false
        },
        {
          "line": 226,
          "old_api": "start_transport_stream_op_batch",
          "new_api": "GRPC_CALL_LOG_OP",
          "old_text": "next_elem->filter->start_transport_stream_op_batch(next_elem, op)",
          "new_text": "GRPC_CALL_LOG_OP(GPR_INFO, next_elem, op)",
          "old_line_content": "  next_elem->filter->start_transport_stream_op_batch(next_elem, op);",
          "new_line_content": "  GRPC_CALL_LOG_OP(GPR_INFO, next_elem, op);",
          "content_same": false
        },
        {
          "line": 243,
          "old_api": "reinterpret_cast<char*>(elem)",
          "new_api": "reinterpret_cast<grpc_channel_stack*>(\n      reinterpret_cast<char*>(elem) -\n      GPR_ROUND_UP_TO_ALIGNMENT_SIZE(sizeof(grpc_channel_stack)))",
          "old_text": "reinterpret_cast<char*>(elem)",
          "new_text": "reinterpret_cast<grpc_channel_stack*>(\n      reinterpret_cast<char*>(elem) -\n      GPR_ROUND_UP_TO_ALIGNMENT_SIZE(sizeof(grpc_channel_stack)))",
          "old_line_content": "      reinterpret_cast<char*>(elem) -",
          "new_line_content": "  return reinterpret_cast<grpc_channel_stack*>(",
          "content_same": false
        },
        {
          "line": 244,
          "old_api": "GPR_ROUND_UP_TO_ALIGNMENT_SIZE",
          "new_api": "reinterpret_cast<char*>(elem)",
          "old_text": "GPR_ROUND_UP_TO_ALIGNMENT_SIZE(sizeof(grpc_channel_stack))",
          "new_text": "reinterpret_cast<char*>(elem)",
          "old_line_content": "      GPR_ROUND_UP_TO_ALIGNMENT_SIZE(sizeof(grpc_channel_stack)));",
          "new_line_content": "      reinterpret_cast<char*>(elem) -",
          "content_same": false
        },
        {
          "line": 249,
          "old_api": "reinterpret_cast<char*>(elem)",
          "new_api": "reinterpret_cast<grpc_call_stack*>(\n      reinterpret_cast<char*>(elem) -\n      GPR_ROUND_UP_TO_ALIGNMENT_SIZE(sizeof(grpc_call_stack)))",
          "old_text": "reinterpret_cast<char*>(elem)",
          "new_text": "reinterpret_cast<grpc_call_stack*>(\n      reinterpret_cast<char*>(elem) -\n      GPR_ROUND_UP_TO_ALIGNMENT_SIZE(sizeof(grpc_call_stack)))",
          "old_line_content": "      reinterpret_cast<char*>(elem) -",
          "new_line_content": "  return reinterpret_cast<grpc_call_stack*>(",
          "content_same": false
        },
        {
          "line": 250,
          "old_api": "GPR_ROUND_UP_TO_ALIGNMENT_SIZE",
          "new_api": "reinterpret_cast<char*>(elem)",
          "old_text": "GPR_ROUND_UP_TO_ALIGNMENT_SIZE(sizeof(grpc_call_stack))",
          "new_text": "reinterpret_cast<char*>(elem)",
          "old_line_content": "      GPR_ROUND_UP_TO_ALIGNMENT_SIZE(sizeof(grpc_call_stack)));",
          "new_line_content": "      reinterpret_cast<char*>(elem) -",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 162,
          "old_api": null,
          "new_api": "GRPC_STREAM_REF_INIT",
          "old_text": null,
          "new_text": "GRPC_STREAM_REF_INIT(&elem_args->call_stack->refcount, initial_refs, destroy,\n                       destroy_arg, \"CALL_STACK\")",
          "old_line_content": "  elem_args->call_stack->count = count;",
          "new_line_content": "  GRPC_STREAM_REF_INIT(&elem_args->call_stack->refcount, initial_refs, destroy,",
          "content_same": false
        },
        {
          "line": 227,
          "old_api": null,
          "new_api": "start_transport_stream_op_batch",
          "old_text": null,
          "new_text": "next_elem->filter->start_transport_stream_op_batch(next_elem, op)",
          "old_line_content": "}",
          "new_line_content": "  next_elem->filter->start_transport_stream_op_batch(next_elem, op);",
          "content_same": false
        },
        {
          "line": 164,
          "old_api": null,
          "new_api": "CALL_ELEMS_FROM_STACK",
          "old_text": null,
          "new_text": "CALL_ELEMS_FROM_STACK(elem_args->call_stack)",
          "old_line_content": "                       destroy_arg, \"CALL_STACK\");",
          "new_line_content": "  call_elems = CALL_ELEMS_FROM_STACK(elem_args->call_stack);",
          "content_same": false
        },
        {
          "line": 197,
          "old_api": null,
          "new_api": "CALL_ELEMS_FROM_STACK",
          "old_text": null,
          "new_text": "CALL_ELEMS_FROM_STACK(call_stack)",
          "old_line_content": "",
          "new_line_content": "  call_elems = CALL_ELEMS_FROM_STACK(call_stack);",
          "content_same": false
        },
        {
          "line": 201,
          "old_api": null,
          "new_api": "set_pollset_or_pollset_set",
          "old_text": null,
          "new_text": "call_elems[i].filter->set_pollset_or_pollset_set(&call_elems[i], pollent)",
          "old_line_content": "  }",
          "new_line_content": "    call_elems[i].filter->set_pollset_or_pollset_set(&call_elems[i], pollent);",
          "content_same": false
        },
        {
          "line": 233,
          "old_api": null,
          "new_api": "get_channel_info",
          "old_text": null,
          "new_text": "next_elem->filter->get_channel_info(next_elem, channel_info)",
          "old_line_content": "}",
          "new_line_content": "  next_elem->filter->get_channel_info(next_elem, channel_info);",
          "content_same": false
        },
        {
          "line": 238,
          "old_api": null,
          "new_api": "start_transport_op",
          "old_text": null,
          "new_text": "next_elem->filter->start_transport_op(next_elem, op)",
          "old_line_content": "}",
          "new_line_content": "  next_elem->filter->start_transport_op(next_elem, op);",
          "content_same": false
        },
        {
          "line": 175,
          "old_api": null,
          "new_api": "GPR_ROUND_UP_TO_ALIGNMENT_SIZE",
          "old_text": null,
          "new_text": "GPR_ROUND_UP_TO_ALIGNMENT_SIZE(call_elems[i].filter->sizeof_call_data)",
          "old_line_content": "    grpc_error* error =",
          "new_line_content": "        GPR_ROUND_UP_TO_ALIGNMENT_SIZE(call_elems[i].filter->sizeof_call_data);",
          "content_same": false
        },
        {
          "line": 179,
          "old_api": null,
          "new_api": "init_call_elem",
          "old_text": null,
          "new_text": "call_elems[i].filter->init_call_elem(&call_elems[i], elem_args)",
          "old_line_content": "        first_error = error;",
          "new_line_content": "        call_elems[i].filter->init_call_elem(&call_elems[i], elem_args);",
          "content_same": false
        },
        {
          "line": 211,
          "old_api": null,
          "new_api": "CALL_ELEMS_FROM_STACK",
          "old_text": null,
          "new_text": "CALL_ELEMS_FROM_STACK(stack)",
          "old_line_content": "  size_t count = stack->count;",
          "new_line_content": "  grpc_call_element* elems = CALL_ELEMS_FROM_STACK(stack);",
          "content_same": false
        },
        {
          "line": 245,
          "old_api": null,
          "new_api": "GPR_ROUND_UP_TO_ALIGNMENT_SIZE",
          "old_text": null,
          "new_text": "GPR_ROUND_UP_TO_ALIGNMENT_SIZE(sizeof(grpc_channel_stack))",
          "old_line_content": "}",
          "new_line_content": "      GPR_ROUND_UP_TO_ALIGNMENT_SIZE(sizeof(grpc_channel_stack)));",
          "content_same": false
        },
        {
          "line": 184,
          "old_api": null,
          "new_api": "GRPC_ERROR_UNREF",
          "old_text": null,
          "new_text": "GRPC_ERROR_UNREF(error)",
          "old_line_content": "    user_data +=",
          "new_line_content": "        GRPC_ERROR_UNREF(error);",
          "content_same": false
        },
        {
          "line": 217,
          "old_api": null,
          "new_api": "destroy_call_elem",
          "old_text": null,
          "new_text": "elems[i].filter->destroy_call_elem(\n        &elems[i], final_info,\n        i == count - 1 ? then_schedule_closure : nullptr)",
          "old_line_content": "        &elems[i], final_info,",
          "new_line_content": "    elems[i].filter->destroy_call_elem(",
          "content_same": false
        },
        {
          "line": 251,
          "old_api": null,
          "new_api": "GPR_ROUND_UP_TO_ALIGNMENT_SIZE",
          "old_text": null,
          "new_text": "GPR_ROUND_UP_TO_ALIGNMENT_SIZE(sizeof(grpc_call_stack))",
          "old_line_content": "}",
          "new_line_content": "      GPR_ROUND_UP_TO_ALIGNMENT_SIZE(sizeof(grpc_call_stack)));",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 248,
          "old_api": "reinterpret_cast<grpc_call_stack*>(\n      reinterpret_cast<char*>(elem) -\n      GPR_ROUND_UP_TO_ALIGNMENT_SIZE(sizeof(grpc_call_stack)))",
          "new_api": null,
          "old_text": "reinterpret_cast<grpc_call_stack*>(\n      reinterpret_cast<char*>(elem) -\n      GPR_ROUND_UP_TO_ALIGNMENT_SIZE(sizeof(grpc_call_stack)))",
          "new_text": null,
          "old_line_content": "  return reinterpret_cast<grpc_call_stack*>(",
          "new_line_content": "grpc_call_stack* grpc_call_stack_from_top_element(grpc_call_element* elem) {",
          "content_same": false
        },
        {
          "line": 225,
          "old_api": "GRPC_CALL_LOG_OP",
          "new_api": null,
          "old_text": "GRPC_CALL_LOG_OP(GPR_INFO, next_elem, op)",
          "new_text": null,
          "old_line_content": "  GRPC_CALL_LOG_OP(GPR_INFO, next_elem, op);",
          "new_line_content": "  grpc_call_element* next_elem = elem + 1;",
          "content_same": false
        },
        {
          "line": 163,
          "old_api": "GRPC_STREAM_REF_INIT",
          "new_api": null,
          "old_text": "GRPC_STREAM_REF_INIT(&elem_args->call_stack->refcount, initial_refs, destroy,\n                       destroy_arg, \"CALL_STACK\")",
          "new_text": null,
          "old_line_content": "  GRPC_STREAM_REF_INIT(&elem_args->call_stack->refcount, initial_refs, destroy,",
          "new_line_content": "                       destroy_arg, \"CALL_STACK\");",
          "content_same": false
        },
        {
          "line": 196,
          "old_api": "CALL_ELEMS_FROM_STACK",
          "new_api": null,
          "old_text": "CALL_ELEMS_FROM_STACK(call_stack)",
          "new_text": null,
          "old_line_content": "  call_elems = CALL_ELEMS_FROM_STACK(call_stack);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 167,
          "old_api": "GPR_ROUND_UP_TO_ALIGNMENT_SIZE",
          "new_api": null,
          "old_text": "GPR_ROUND_UP_TO_ALIGNMENT_SIZE(count * sizeof(grpc_call_element))",
          "new_text": null,
          "old_line_content": "              GPR_ROUND_UP_TO_ALIGNMENT_SIZE(count * sizeof(grpc_call_element));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 200,
          "old_api": "set_pollset_or_pollset_set",
          "new_api": null,
          "old_text": "call_elems[i].filter->set_pollset_or_pollset_set(&call_elems[i], pollent)",
          "new_text": null,
          "old_line_content": "    call_elems[i].filter->set_pollset_or_pollset_set(&call_elems[i], pollent);",
          "new_line_content": "  for (i = 0; i < count; i++) {",
          "content_same": false
        },
        {
          "line": 232,
          "old_api": "get_channel_info",
          "new_api": null,
          "old_text": "next_elem->filter->get_channel_info(next_elem, channel_info)",
          "new_text": null,
          "old_line_content": "  next_elem->filter->get_channel_info(next_elem, channel_info);",
          "new_line_content": "  grpc_channel_element* next_elem = elem + 1;",
          "content_same": false
        },
        {
          "line": 237,
          "old_api": "start_transport_op",
          "new_api": null,
          "old_text": "next_elem->filter->start_transport_op(next_elem, op)",
          "new_text": null,
          "old_line_content": "  next_elem->filter->start_transport_op(next_elem, op);",
          "new_line_content": "  grpc_channel_element* next_elem = elem + 1;",
          "content_same": false
        },
        {
          "line": 176,
          "old_api": "init_call_elem",
          "new_api": null,
          "old_text": "call_elems[i].filter->init_call_elem(&call_elems[i], elem_args)",
          "new_text": null,
          "old_line_content": "        call_elems[i].filter->init_call_elem(&call_elems[i], elem_args);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 210,
          "old_api": "CALL_ELEMS_FROM_STACK",
          "new_api": null,
          "old_text": "CALL_ELEMS_FROM_STACK(stack)",
          "new_text": null,
          "old_line_content": "  grpc_call_element* elems = CALL_ELEMS_FROM_STACK(stack);",
          "new_line_content": "                             grpc_closure* then_schedule_closure) {",
          "content_same": false
        },
        {
          "line": 242,
          "old_api": "reinterpret_cast<grpc_channel_stack*>(\n      reinterpret_cast<char*>(elem) -\n      GPR_ROUND_UP_TO_ALIGNMENT_SIZE(sizeof(grpc_channel_stack)))",
          "new_api": null,
          "old_text": "reinterpret_cast<grpc_channel_stack*>(\n      reinterpret_cast<char*>(elem) -\n      GPR_ROUND_UP_TO_ALIGNMENT_SIZE(sizeof(grpc_channel_stack)))",
          "new_text": null,
          "old_line_content": "  return reinterpret_cast<grpc_channel_stack*>(",
          "new_line_content": "    grpc_channel_element* elem) {",
          "content_same": false
        },
        {
          "line": 181,
          "old_api": "GRPC_ERROR_UNREF",
          "new_api": null,
          "old_text": "GRPC_ERROR_UNREF(error)",
          "new_text": null,
          "old_line_content": "        GRPC_ERROR_UNREF(error);",
          "new_line_content": "      if (first_error == GRPC_ERROR_NONE) {",
          "content_same": false
        },
        {
          "line": 216,
          "old_api": "destroy_call_elem",
          "new_api": null,
          "old_text": "elems[i].filter->destroy_call_elem(\n        &elems[i], final_info,\n        i == count - 1 ? then_schedule_closure : nullptr)",
          "new_text": null,
          "old_line_content": "    elems[i].filter->destroy_call_elem(",
          "new_line_content": "  for (i = 0; i < count; i++) {",
          "content_same": false
        },
        {
          "line": 185,
          "old_api": "GPR_ROUND_UP_TO_ALIGNMENT_SIZE",
          "new_api": null,
          "old_text": "GPR_ROUND_UP_TO_ALIGNMENT_SIZE(call_elems[i].filter->sizeof_call_data)",
          "new_text": null,
          "old_line_content": "        GPR_ROUND_UP_TO_ALIGNMENT_SIZE(call_elems[i].filter->sizeof_call_data);",
          "new_line_content": "      }",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 7,
      "total_additions": 14,
      "total_deletions": 14,
      "total_api_changes": 35
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 9,
        "api_related_lines": 35,
        "non_api_lines": 5,
        "non_api_line_numbers": [
          160,
          170,
          171,
          174,
          177
        ]
      }
    },
    "api_calls_before": 44,
    "api_calls_after": 44,
    "diff_info": {
      "added_lines": 5,
      "removed_lines": 4,
      "total_diff_lines": 38
    }
  }
}