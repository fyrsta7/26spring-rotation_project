{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/bcc/modified_file/42c00adb4181920d3e52f01e5020686ef470d6ce",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/bcc/modified_file/42c00adb4181920d3e52f01e5020686ef470d6ce/before.cc",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/bcc/modified_file/42c00adb4181920d3e52f01e5020686ef470d6ce/after.cc",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/bcc/modified_file/42c00adb4181920d3e52f01e5020686ef470d6ce/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 152,
          "old_api": "push_back",
          "new_api": "get_flags",
          "old_text": "kflags.push_back(\"/virtual/include/bcc/bpf.h\")",
          "new_text": "kbuild_helper.get_flags(un.machine, &kflags)",
          "old_line_content": "  kflags.push_back(\"/virtual/include/bcc/bpf.h\");",
          "new_line_content": "  if (kbuild_helper.get_flags(un.machine, &kflags))",
          "content_same": false
        },
        {
          "line": 157,
          "old_api": "end",
          "new_api": "push_back",
          "old_text": "kflags.end()",
          "new_text": "kflags.push_back(\"/virtual/include/bcc/helpers.h\")",
          "old_line_content": "  for (auto it = kflags.begin(); it != kflags.end(); ++it)",
          "new_line_content": "  kflags.push_back(\"/virtual/include/bcc/helpers.h\");",
          "content_same": false
        },
        {
          "line": 158,
          "old_api": "c_str",
          "new_api": "push_back",
          "old_text": "it->c_str()",
          "new_text": "kflags.push_back(\"-isystem\")",
          "old_line_content": "    flags_cstr.push_back(it->c_str());",
          "new_line_content": "  kflags.push_back(\"-isystem\");",
          "content_same": false
        },
        {
          "line": 161,
          "old_api": "push_back",
          "new_api": "c_str",
          "old_text": "flags_cstr.push_back(cflags[i])",
          "new_text": "it->c_str()",
          "old_line_content": "      flags_cstr.push_back(cflags[i]);",
          "new_line_content": "    flags_cstr.push_back(it->c_str());",
          "content_same": false
        },
        {
          "line": 164,
          "old_api": "string",
          "new_api": "push_back",
          "old_text": "string(\"-DCUR_CPU_IDENTIFIER=\")",
          "new_text": "flags_cstr.push_back(cflags[i])",
          "old_line_content": "  string cur_cpu_flag = string(\"-DCUR_CPU_IDENTIFIER=\") + CUR_CPU_IDENTIFIER;",
          "new_line_content": "      flags_cstr.push_back(cflags[i]);",
          "content_same": false
        },
        {
          "line": 192,
          "old_api": "BuildCompilation",
          "new_api": "setTitle",
          "old_text": "drv.BuildCompilation(flags_cstr)",
          "new_text": "drv.setTitle(\"bcc-clang-driver\")",
          "old_line_content": "  unique_ptr<driver::Compilation> compilation(drv.BuildCompilation(flags_cstr));",
          "new_line_content": "  drv.setTitle(\"bcc-clang-driver\");",
          "content_same": false
        },
        {
          "line": 201,
          "old_api": "Print",
          "new_api": "begin",
          "old_text": "jobs.Print(os, \"; \", true)",
          "new_text": "jobs.begin()",
          "old_line_content": "    jobs.Print(os, \"; \", true);",
          "new_line_content": "  if (jobs.size() != 1 || !isa<driver::Command>(*jobs.begin())) {",
          "content_same": false
        },
        {
          "line": 216,
          "old_api": "llvm::errs()",
          "new_api": "getArguments",
          "old_text": "llvm::errs()",
          "new_text": "cmd.getArguments()",
          "old_line_content": "    llvm::errs() << \"clang\";",
          "new_line_content": "  const driver::ArgStringList &ccargs = cmd.getArguments();",
          "content_same": false
        },
        {
          "line": 227,
          "old_api": "size",
          "new_api": "getInvocation",
          "old_text": "ccargs.size()",
          "new_text": "compiler0.getInvocation()",
          "old_line_content": "          const_cast<const char **>(ccargs.data()) + ccargs.size(), diags))",
          "new_line_content": "  CompilerInvocation &invocation0 = compiler0.getInvocation();",
          "content_same": false
        },
        {
          "line": 230,
          "old_api": "getPreprocessorOpts",
          "new_api": "size",
          "old_text": "invocation0.getPreprocessorOpts()",
          "new_text": "ccargs.size()",
          "old_line_content": "  invocation0.getPreprocessorOpts().RetainRemappedFileBuffers = true;",
          "new_line_content": "          const_cast<const char **>(ccargs.data()) + ccargs.size(), diags))",
          "content_same": false
        },
        {
          "line": 238,
          "old_api": "FrontendOptions::getInputKindForExtension(\"c\")",
          "new_api": "getPreprocessorOpts",
          "old_text": "FrontendOptions::getInputKindForExtension(\"c\")",
          "new_text": "invocation0.getPreprocessorOpts().addRemappedFile(main_path, &*main_buf)",
          "old_line_content": "        main_path, FrontendOptions::getInputKindForExtension(\"c\")));",
          "new_line_content": "    invocation0.getPreprocessorOpts().addRemappedFile(main_path, &*main_buf);",
          "content_same": false
        },
        {
          "line": 240,
          "old_api": "getFrontendOpts",
          "new_api": "FrontendInputFile",
          "old_text": "invocation0.getFrontendOpts()",
          "new_text": "FrontendInputFile(\n        main_path, FrontendOptions::getInputKindForExtension(\"c\"))",
          "old_line_content": "  invocation0.getFrontendOpts().DisableFree = false;",
          "new_line_content": "    invocation0.getFrontendOpts().Inputs.push_back(FrontendInputFile(",
          "content_same": false
        },
        {
          "line": 256,
          "old_api": "size",
          "new_api": "getInvocation",
          "old_text": "ccargs.size()",
          "new_text": "compiler1.getInvocation()",
          "old_line_content": "          const_cast<const char **>(ccargs.data()) + ccargs.size(), diags))",
          "new_line_content": "  CompilerInvocation &invocation1 = compiler1.getInvocation();",
          "content_same": false
        },
        {
          "line": 267,
          "old_api": "FrontendInputFile",
          "new_api": "getPreprocessorOpts",
          "old_text": "FrontendInputFile(\n      main_path, FrontendOptions::getInputKindForExtension(\"c\"))",
          "new_text": "invocation1.getPreprocessorOpts().addRemappedFile(f.first, &*f.second)",
          "old_line_content": "  invocation1.getFrontendOpts().Inputs.push_back(FrontendInputFile(",
          "new_line_content": "    invocation1.getPreprocessorOpts().addRemappedFile(f.first, &*f.second);",
          "content_same": false
        },
        {
          "line": 268,
          "old_api": "FrontendOptions::getInputKindForExtension(\"c\")",
          "new_api": "getPreprocessorOpts",
          "old_text": "FrontendOptions::getInputKindForExtension(\"c\")",
          "new_text": "invocation1.getPreprocessorOpts().addRemappedFile(main_path, &*out_buf)",
          "old_line_content": "      main_path, FrontendOptions::getInputKindForExtension(\"c\")));",
          "new_line_content": "  invocation1.getPreprocessorOpts().addRemappedFile(main_path, &*out_buf);",
          "content_same": false
        },
        {
          "line": 271,
          "old_api": "createDiagnostics",
          "new_api": "FrontendOptions::getInputKindForExtension(\"c\")",
          "old_text": "compiler1.createDiagnostics()",
          "new_text": "FrontendOptions::getInputKindForExtension(\"c\")",
          "old_line_content": "  compiler1.createDiagnostics();",
          "new_line_content": "      main_path, FrontendOptions::getInputKindForExtension(\"c\")));",
          "content_same": false
        },
        {
          "line": 286,
          "old_api": "size",
          "new_api": "getInvocation",
          "old_text": "ccargs.size()",
          "new_text": "compiler2.getInvocation()",
          "old_line_content": "          const_cast<const char **>(ccargs.data()) + ccargs.size(), diags))",
          "new_line_content": "  CompilerInvocation &invocation2 = compiler2.getInvocation();",
          "content_same": false
        },
        {
          "line": 288,
          "old_api": "getPreprocessorOpts",
          "new_api": "data",
          "old_text": "invocation2.getPreprocessorOpts()",
          "new_text": "ccargs.data()",
          "old_line_content": "  invocation2.getPreprocessorOpts().RetainRemappedFileBuffers = true;",
          "new_line_content": "          invocation2, const_cast<const char **>(ccargs.data()),",
          "content_same": false
        },
        {
          "line": 293,
          "old_api": "FrontendInputFile",
          "new_api": "getPreprocessorOpts",
          "old_text": "FrontendInputFile(\n      main_path, FrontendOptions::getInputKindForExtension(\"c\"))",
          "new_text": "invocation2.getPreprocessorOpts().addRemappedFile(f.first, &*f.second)",
          "old_line_content": "  invocation2.getFrontendOpts().Inputs.push_back(FrontendInputFile(",
          "new_line_content": "    invocation2.getPreprocessorOpts().addRemappedFile(f.first, &*f.second);",
          "content_same": false
        },
        {
          "line": 294,
          "old_api": "FrontendOptions::getInputKindForExtension(\"c\")",
          "new_api": "getPreprocessorOpts",
          "old_text": "FrontendOptions::getInputKindForExtension(\"c\")",
          "new_text": "invocation2.getPreprocessorOpts().addRemappedFile(main_path, &*out_buf1)",
          "old_line_content": "      main_path, FrontendOptions::getInputKindForExtension(\"c\")));",
          "new_line_content": "  invocation2.getPreprocessorOpts().addRemappedFile(main_path, &*out_buf1);",
          "content_same": false
        },
        {
          "line": 298,
          "old_api": "getCodeGenOpts",
          "new_api": "getFrontendOpts",
          "old_text": "invocation2.getCodeGenOpts().setInlining(CodeGenOptions::NormalInlining)",
          "new_text": "invocation2.getFrontendOpts()",
          "old_line_content": "  invocation2.getCodeGenOpts().setInlining(CodeGenOptions::NormalInlining);",
          "new_line_content": "  invocation2.getFrontendOpts().DisableFree = false;",
          "content_same": false
        },
        {
          "line": 301,
          "old_api": "createDiagnostics",
          "new_api": "getCodeGenOpts",
          "old_text": "compiler2.createDiagnostics()",
          "new_text": "invocation2.getCodeGenOpts().setInlining(CodeGenOptions::NormalInlining)",
          "old_line_content": "  compiler2.createDiagnostics();",
          "new_line_content": "  invocation2.getCodeGenOpts().setInlining(CodeGenOptions::NormalInlining);",
          "content_same": false
        },
        {
          "line": 304,
          "old_api": "ExecuteAction",
          "new_api": "createDiagnostics",
          "old_text": "compiler2.ExecuteAction(ir_act)",
          "new_text": "compiler2.createDiagnostics()",
          "old_line_content": "  if (!compiler2.ExecuteAction(ir_act))",
          "new_line_content": "  compiler2.createDiagnostics();",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 257,
          "old_api": null,
          "new_api": "data",
          "old_text": null,
          "new_text": "CompilerInvocation::CreateFromArgs(\n          invocation1, const_cast<const char **>(ccargs.data()),\n          const_cast<const char **>(ccargs.data()) + ccargs.size(), diags)",
          "old_line_content": "    return -1;",
          "new_line_content": "  if (!CompilerInvocation::CreateFromArgs(",
          "content_same": false
        },
        {
          "line": 258,
          "old_api": null,
          "new_api": "data",
          "old_text": null,
          "new_text": "ccargs.data()",
          "old_line_content": "",
          "new_line_content": "          invocation1, const_cast<const char **>(ccargs.data()),",
          "content_same": false
        },
        {
          "line": 259,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "ccargs.size()",
          "old_line_content": "  // This option instructs clang whether or not to free the file buffers that we",
          "new_line_content": "          const_cast<const char **>(ccargs.data()) + ccargs.size(), diags))",
          "content_same": false
        },
        {
          "line": 139,
          "old_api": null,
          "new_api": "cwd",
          "old_text": null,
          "new_text": "dstack.cwd()",
          "old_line_content": "                                   \"-Wno-pragma-once-outside-header\",",
          "new_line_content": "  vector<const char *> flags_cstr({\"-O0\", \"-O2\", \"-emit-llvm\", \"-I\", dstack.cwd(),",
          "content_same": false
        },
        {
          "line": 270,
          "old_api": null,
          "new_api": "FrontendInputFile",
          "old_text": null,
          "new_text": "FrontendInputFile(\n      main_path, FrontendOptions::getInputKindForExtension(\"c\"))",
          "old_line_content": "",
          "new_line_content": "  invocation1.getFrontendOpts().Inputs.push_back(FrontendInputFile(",
          "content_same": false
        },
        {
          "line": 272,
          "old_api": null,
          "new_api": "getFrontendOpts",
          "old_text": null,
          "new_text": "invocation1.getFrontendOpts()",
          "old_line_content": "",
          "new_line_content": "  invocation1.getFrontendOpts().DisableFree = false;",
          "content_same": false
        },
        {
          "line": 274,
          "old_api": null,
          "new_api": "createDiagnostics",
          "old_text": null,
          "new_text": "compiler1.createDiagnostics()",
          "old_line_content": "  string out_str1;",
          "new_line_content": "  compiler1.createDiagnostics();",
          "content_same": false
        },
        {
          "line": 148,
          "old_api": null,
          "new_api": "c_str",
          "old_text": null,
          "new_text": "abs_file.c_str()",
          "old_line_content": "  vector<string> kflags;",
          "new_line_content": "                                   \"-x\", \"c\", \"-c\", abs_file.c_str()});",
          "content_same": false
        },
        {
          "line": 280,
          "old_api": null,
          "new_api": "ExecuteAction",
          "old_text": null,
          "new_text": "compiler1.ExecuteAction(bact)",
          "old_line_content": "",
          "new_line_content": "  if (!compiler1.ExecuteAction(bact))",
          "content_same": false
        },
        {
          "line": 282,
          "old_api": null,
          "new_api": "llvm::MemoryBuffer::getMemBuffer(out_str1)",
          "old_text": null,
          "new_text": "llvm::MemoryBuffer::getMemBuffer(out_str1)",
          "old_line_content": "  CompilerInstance compiler2;",
          "new_line_content": "  unique_ptr<llvm::MemoryBuffer> out_buf1 = llvm::MemoryBuffer::getMemBuffer(out_str1);",
          "content_same": false
        },
        {
          "line": 159,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "kflags.push_back(\"/virtual/include\")",
          "old_line_content": "  if (cflags) {",
          "new_line_content": "  kflags.push_back(\"/virtual/include\");",
          "content_same": false
        },
        {
          "line": 160,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "kflags.end()",
          "old_line_content": "    for (auto i = 0; i < ncflags; ++i)",
          "new_line_content": "  for (auto it = kflags.begin(); it != kflags.end(); ++it)",
          "content_same": false
        },
        {
          "line": 287,
          "old_api": null,
          "new_api": "data",
          "old_text": null,
          "new_text": "CompilerInvocation::CreateFromArgs(\n          invocation2, const_cast<const char **>(ccargs.data()),\n          const_cast<const char **>(ccargs.data()) + ccargs.size(), diags)",
          "old_line_content": "    return -1;",
          "new_line_content": "  if (!CompilerInvocation::CreateFromArgs(",
          "content_same": false
        },
        {
          "line": 289,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "ccargs.size()",
          "old_line_content": "  for (const auto &f : remapped_files_)",
          "new_line_content": "          const_cast<const char **>(ccargs.data()) + ccargs.size(), diags))",
          "content_same": false
        },
        {
          "line": 167,
          "old_api": null,
          "new_api": "string",
          "old_text": null,
          "new_text": "string(\"-DCUR_CPU_IDENTIFIER=\")",
          "old_line_content": "",
          "new_line_content": "  string cur_cpu_flag = string(\"-DCUR_CPU_IDENTIFIER=\") + CUR_CPU_IDENTIFIER;",
          "content_same": false
        },
        {
          "line": 168,
          "old_api": null,
          "new_api": "c_str",
          "old_text": null,
          "new_text": "cur_cpu_flag.c_str()",
          "old_line_content": "  // set up the error reporting class",
          "new_line_content": "  flags_cstr.push_back(cur_cpu_flag.c_str());",
          "content_same": false
        },
        {
          "line": 296,
          "old_api": null,
          "new_api": "FrontendInputFile",
          "old_text": null,
          "new_text": "FrontendInputFile(\n      main_path, FrontendOptions::getInputKindForExtension(\"c\"))",
          "old_line_content": "  // Resort to normal inlining. In -O0 the default is OnlyAlwaysInlining and",
          "new_line_content": "  invocation2.getFrontendOpts().Inputs.push_back(FrontendInputFile(",
          "content_same": false
        },
        {
          "line": 297,
          "old_api": null,
          "new_api": "FrontendOptions::getInputKindForExtension(\"c\")",
          "old_text": null,
          "new_text": "FrontendOptions::getInputKindForExtension(\"c\")",
          "old_line_content": "  // clang might add noinline attribute even for functions with inline hint.",
          "new_line_content": "      main_path, FrontendOptions::getInputKindForExtension(\"c\")));",
          "content_same": false
        },
        {
          "line": 173,
          "old_api": null,
          "new_api": "llvm::errs()",
          "old_text": null,
          "new_text": "llvm::errs()",
          "old_line_content": "  DiagnosticsEngine diags(DiagID, &*diag_opts, diag_client);",
          "new_line_content": "  auto diag_client = new TextDiagnosticPrinter(llvm::errs(), &*diag_opts);",
          "content_same": false
        },
        {
          "line": 303,
          "old_api": null,
          "new_api": "getDiagnosticOpts",
          "old_text": null,
          "new_text": "invocation2.getDiagnosticOpts()",
          "old_line_content": "  EmitLLVMOnlyAction ir_act(&*ctx_);",
          "new_line_content": "  invocation2.getDiagnosticOpts().IgnoreWarnings = true;",
          "content_same": false
        },
        {
          "line": 307,
          "old_api": null,
          "new_api": "ExecuteAction",
          "old_text": null,
          "new_text": "compiler2.ExecuteAction(ir_act)",
          "old_line_content": "",
          "new_line_content": "  if (!compiler2.ExecuteAction(ir_act))",
          "content_same": false
        },
        {
          "line": 309,
          "old_api": null,
          "new_api": "takeModule",
          "old_text": null,
          "new_text": "ir_act.takeModule()",
          "old_line_content": "}",
          "new_line_content": "  *mod = ir_act.takeModule();",
          "content_same": false
        },
        {
          "line": 193,
          "old_api": null,
          "new_api": "setCheckInputsExist",
          "old_text": null,
          "new_text": "drv.setCheckInputsExist(false)",
          "old_line_content": "  if (!compilation)",
          "new_line_content": "  drv.setCheckInputsExist(false);",
          "content_same": false
        },
        {
          "line": 195,
          "old_api": null,
          "new_api": "BuildCompilation",
          "old_text": null,
          "new_text": "drv.BuildCompilation(flags_cstr)",
          "old_line_content": "",
          "new_line_content": "  unique_ptr<driver::Compilation> compilation(drv.BuildCompilation(flags_cstr));",
          "content_same": false
        },
        {
          "line": 200,
          "old_api": null,
          "new_api": "getJobs",
          "old_text": null,
          "new_text": "compilation->getJobs()",
          "old_line_content": "    llvm::raw_svector_ostream os(msg);",
          "new_line_content": "  const driver::JobList &jobs = compilation->getJobs();",
          "content_same": false
        },
        {
          "line": 204,
          "old_api": null,
          "new_api": "Print",
          "old_text": null,
          "new_text": "jobs.Print(os, \"; \", true)",
          "old_line_content": "  }",
          "new_line_content": "    jobs.Print(os, \"; \", true);",
          "content_same": false
        },
        {
          "line": 205,
          "old_api": null,
          "new_api": "str",
          "old_text": null,
          "new_text": "os.str()",
          "old_line_content": "",
          "new_line_content": "    diags.Report(diag::err_fe_expected_compiler_job) << os.str();",
          "content_same": false
        },
        {
          "line": 209,
          "old_api": null,
          "new_api": "begin",
          "old_text": null,
          "new_text": "jobs.begin()",
          "old_line_content": "    return -1;",
          "new_line_content": "  const driver::Command &cmd = cast<driver::Command>(*jobs.begin());",
          "content_same": false
        },
        {
          "line": 210,
          "old_api": null,
          "new_api": "getCreator",
          "old_text": null,
          "new_text": "cmd.getCreator().getName()",
          "old_line_content": "  }",
          "new_line_content": "  if (llvm::StringRef(cmd.getCreator().getName()) != \"clang\") {",
          "content_same": false
        },
        {
          "line": 211,
          "old_api": null,
          "new_api": "Report",
          "old_text": null,
          "new_text": "diags.Report(diag::err_fe_expected_clang_command)",
          "old_line_content": "",
          "new_line_content": "    diags.Report(diag::err_fe_expected_clang_command);",
          "content_same": false
        },
        {
          "line": 221,
          "old_api": null,
          "new_api": "llvm::errs()",
          "old_text": null,
          "new_text": "llvm::errs()",
          "old_line_content": "",
          "new_line_content": "      llvm::errs() << \" \" << arg;",
          "content_same": false
        },
        {
          "line": 222,
          "old_api": null,
          "new_api": "llvm::errs()",
          "old_text": null,
          "new_text": "llvm::errs()",
          "old_line_content": "  // pre-compilation pass for generating tracepoint structures",
          "new_line_content": "    llvm::errs() << \"\\n\";",
          "content_same": false
        },
        {
          "line": 228,
          "old_api": null,
          "new_api": "data",
          "old_text": null,
          "new_text": "CompilerInvocation::CreateFromArgs(\n          invocation0, const_cast<const char **>(ccargs.data()),\n          const_cast<const char **>(ccargs.data()) + ccargs.size(), diags)",
          "old_line_content": "    return -1;",
          "new_line_content": "  if (!CompilerInvocation::CreateFromArgs(",
          "content_same": false
        },
        {
          "line": 229,
          "old_api": null,
          "new_api": "data",
          "old_text": null,
          "new_text": "ccargs.data()",
          "old_line_content": "",
          "new_line_content": "          invocation0, const_cast<const char **>(ccargs.data()),",
          "content_same": false
        },
        {
          "line": 233,
          "old_api": null,
          "new_api": "getPreprocessorOpts",
          "old_text": null,
          "new_text": "invocation0.getPreprocessorOpts()",
          "old_line_content": "",
          "new_line_content": "  invocation0.getPreprocessorOpts().RetainRemappedFileBuffers = true;",
          "content_same": false
        },
        {
          "line": 239,
          "old_api": null,
          "new_api": "getFrontendOpts",
          "old_text": null,
          "new_text": "invocation0.getFrontendOpts().Inputs.clear()",
          "old_line_content": "  }",
          "new_line_content": "    invocation0.getFrontendOpts().Inputs.clear();",
          "content_same": false
        },
        {
          "line": 241,
          "old_api": null,
          "new_api": "FrontendOptions::getInputKindForExtension(\"c\")",
          "old_text": null,
          "new_text": "FrontendOptions::getInputKindForExtension(\"c\")",
          "old_line_content": "",
          "new_line_content": "        main_path, FrontendOptions::getInputKindForExtension(\"c\")));",
          "content_same": false
        },
        {
          "line": 243,
          "old_api": null,
          "new_api": "getFrontendOpts",
          "old_text": null,
          "new_text": "invocation0.getFrontendOpts()",
          "old_line_content": "",
          "new_line_content": "  invocation0.getFrontendOpts().DisableFree = false;",
          "content_same": false
        },
        {
          "line": 245,
          "old_api": null,
          "new_api": "createDiagnostics",
          "old_text": null,
          "new_text": "compiler0.createDiagnostics(new IgnoringDiagConsumer())",
          "old_line_content": "  string out_str;",
          "new_line_content": "  compiler0.createDiagnostics(new IgnoringDiagConsumer());",
          "content_same": false
        },
        {
          "line": 251,
          "old_api": null,
          "new_api": "ExecuteAction",
          "old_text": null,
          "new_text": "compiler0.ExecuteAction(tpact)",
          "old_line_content": "  // first pass",
          "new_line_content": "  compiler0.ExecuteAction(tpact); // ignore errors, they will be reported later",
          "content_same": false
        },
        {
          "line": 252,
          "old_api": null,
          "new_api": "llvm::MemoryBuffer::getMemBuffer(out_str)",
          "old_text": null,
          "new_text": "llvm::MemoryBuffer::getMemBuffer(out_str)",
          "old_line_content": "  CompilerInstance compiler1;",
          "new_line_content": "  unique_ptr<llvm::MemoryBuffer> out_buf = llvm::MemoryBuffer::getMemBuffer(out_str);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 262,
          "old_api": "getPreprocessorOpts",
          "new_api": null,
          "old_text": "invocation1.getPreprocessorOpts()",
          "new_text": null,
          "old_line_content": "  invocation1.getPreprocessorOpts().RetainRemappedFileBuffers = true;",
          "new_line_content": "  // This option instructs clang whether or not to free the file buffers that we",
          "content_same": false
        },
        {
          "line": 136,
          "old_api": "cwd",
          "new_api": null,
          "old_text": "dstack.cwd()",
          "new_text": null,
          "old_line_content": "  vector<const char *> flags_cstr({\"-O0\", \"-emit-llvm\", \"-I\", dstack.cwd(),",
          "new_line_content": "  // Enable -O2 for clang. In clang 5.0, -O0 may result in funciton marking as",
          "content_same": false
        },
        {
          "line": 264,
          "old_api": "getPreprocessorOpts",
          "new_api": null,
          "old_text": "invocation1.getPreprocessorOpts().addRemappedFile(f.first, &*f.second)",
          "new_text": null,
          "old_line_content": "    invocation1.getPreprocessorOpts().addRemappedFile(f.first, &*f.second);",
          "new_line_content": "  // and reused if possible, set this flag to true.",
          "content_same": false
        },
        {
          "line": 266,
          "old_api": "getFrontendOpts",
          "new_api": null,
          "old_text": "invocation1.getFrontendOpts().Inputs.clear()",
          "new_text": null,
          "old_line_content": "  invocation1.getFrontendOpts().Inputs.clear();",
          "new_line_content": "  for (const auto &f : remapped_files_)",
          "content_same": false
        },
        {
          "line": 145,
          "old_api": "c_str",
          "new_api": null,
          "old_text": "abs_file.c_str()",
          "new_text": null,
          "old_line_content": "                                   \"-x\", \"c\", \"-c\", abs_file.c_str()});",
          "new_line_content": "                                   \"-fno-color-diagnostics\",",
          "content_same": false
        },
        {
          "line": 149,
          "old_api": "get_flags",
          "new_api": null,
          "old_text": "kbuild_helper.get_flags(un.machine, &kflags)",
          "new_text": null,
          "old_line_content": "  if (kbuild_helper.get_flags(un.machine, &kflags))",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 277,
          "old_api": "ExecuteAction",
          "new_api": null,
          "old_text": "compiler1.ExecuteAction(bact)",
          "new_text": null,
          "old_line_content": "  if (!compiler1.ExecuteAction(bact))",
          "new_line_content": "  string out_str1;",
          "content_same": false
        },
        {
          "line": 151,
          "old_api": "push_back",
          "new_api": null,
          "old_text": "kflags.push_back(\"-include\")",
          "new_text": null,
          "old_line_content": "  kflags.push_back(\"-include\");",
          "new_line_content": "  vector<string> kflags;",
          "content_same": false
        },
        {
          "line": 279,
          "old_api": "llvm::MemoryBuffer::getMemBuffer(out_str1)",
          "new_api": null,
          "old_text": "llvm::MemoryBuffer::getMemBuffer(out_str1)",
          "new_text": null,
          "old_line_content": "  unique_ptr<llvm::MemoryBuffer> out_buf1 = llvm::MemoryBuffer::getMemBuffer(out_str1);",
          "new_line_content": "  BFrontendAction bact(os1, flags_, ts, id);",
          "content_same": false
        },
        {
          "line": 153,
          "old_api": "push_back",
          "new_api": null,
          "old_text": "kflags.push_back(\"-include\")",
          "new_text": null,
          "old_line_content": "  kflags.push_back(\"-include\");",
          "new_line_content": "    return -1;",
          "content_same": false
        },
        {
          "line": 283,
          "old_api": "getInvocation",
          "new_api": null,
          "old_text": "compiler2.getInvocation()",
          "new_text": null,
          "old_line_content": "  CompilerInvocation &invocation2 = compiler2.getInvocation();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 284,
          "old_api": "data",
          "new_api": null,
          "old_text": "CompilerInvocation::CreateFromArgs(\n          invocation2, const_cast<const char **>(ccargs.data()),\n          const_cast<const char **>(ccargs.data()) + ccargs.size(), diags)",
          "new_text": null,
          "old_line_content": "  if (!CompilerInvocation::CreateFromArgs(",
          "new_line_content": "  // second pass, clear input and take rewrite buffer",
          "content_same": false
        },
        {
          "line": 285,
          "old_api": "data",
          "new_api": null,
          "old_text": "ccargs.data()",
          "new_text": null,
          "old_line_content": "          invocation2, const_cast<const char **>(ccargs.data()),",
          "new_line_content": "  CompilerInstance compiler2;",
          "content_same": false
        },
        {
          "line": 290,
          "old_api": "getPreprocessorOpts",
          "new_api": null,
          "old_text": "invocation2.getPreprocessorOpts().addRemappedFile(f.first, &*f.second)",
          "new_text": null,
          "old_line_content": "    invocation2.getPreprocessorOpts().addRemappedFile(f.first, &*f.second);",
          "new_line_content": "    return -1;",
          "content_same": false
        },
        {
          "line": 292,
          "old_api": "getFrontendOpts",
          "new_api": null,
          "old_text": "invocation2.getFrontendOpts().Inputs.clear()",
          "new_text": null,
          "old_line_content": "  invocation2.getFrontendOpts().Inputs.clear();",
          "new_line_content": "  for (const auto &f : remapped_files_)",
          "content_same": false
        },
        {
          "line": 165,
          "old_api": "c_str",
          "new_api": null,
          "old_text": "cur_cpu_flag.c_str()",
          "new_text": null,
          "old_line_content": "  flags_cstr.push_back(cur_cpu_flag.c_str());",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 170,
          "old_api": "llvm::errs()",
          "new_api": null,
          "old_text": "llvm::errs()",
          "new_text": null,
          "old_line_content": "  auto diag_client = new TextDiagnosticPrinter(llvm::errs(), &*diag_opts);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 300,
          "old_api": "getDiagnosticOpts",
          "new_api": null,
          "old_text": "invocation2.getDiagnosticOpts()",
          "new_text": null,
          "old_line_content": "  invocation2.getDiagnosticOpts().IgnoreWarnings = true;",
          "new_line_content": "  // clang might add noinline attribute even for functions with inline hint.",
          "content_same": false
        },
        {
          "line": 306,
          "old_api": "takeModule",
          "new_api": null,
          "old_text": "ir_act.takeModule()",
          "new_text": null,
          "old_line_content": "  *mod = ir_act.takeModule();",
          "new_line_content": "  EmitLLVMOnlyAction ir_act(&*ctx_);",
          "content_same": false
        },
        {
          "line": 189,
          "old_api": "setTitle",
          "new_api": null,
          "old_text": "drv.setTitle(\"bcc-clang-driver\")",
          "new_text": null,
          "old_line_content": "  drv.setTitle(\"bcc-clang-driver\");",
          "new_line_content": "#else",
          "content_same": false
        },
        {
          "line": 190,
          "old_api": "setCheckInputsExist",
          "new_api": null,
          "old_text": "drv.setCheckInputsExist(false)",
          "new_text": null,
          "old_line_content": "  drv.setCheckInputsExist(false);",
          "new_line_content": "  driver::Driver drv(\"\", \"x86_64-unknown-linux-gnu\", diags);",
          "content_same": false
        },
        {
          "line": 197,
          "old_api": "getJobs",
          "new_api": null,
          "old_text": "compilation->getJobs()",
          "new_text": null,
          "old_line_content": "  const driver::JobList &jobs = compilation->getJobs();",
          "new_line_content": "    return -1;",
          "content_same": false
        },
        {
          "line": 198,
          "old_api": "begin",
          "new_api": null,
          "old_text": "jobs.begin()",
          "new_text": null,
          "old_line_content": "  if (jobs.size() != 1 || !isa<driver::Command>(*jobs.begin())) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 202,
          "old_api": "str",
          "new_api": null,
          "old_text": "os.str()",
          "new_text": null,
          "old_line_content": "    diags.Report(diag::err_fe_expected_compiler_job) << os.str();",
          "new_line_content": "    SmallString<256> msg;",
          "content_same": false
        },
        {
          "line": 206,
          "old_api": "begin",
          "new_api": null,
          "old_text": "jobs.begin()",
          "new_text": null,
          "old_line_content": "  const driver::Command &cmd = cast<driver::Command>(*jobs.begin());",
          "new_line_content": "    return -1;",
          "content_same": false
        },
        {
          "line": 207,
          "old_api": "getCreator",
          "new_api": null,
          "old_text": "cmd.getCreator().getName()",
          "new_text": null,
          "old_line_content": "  if (llvm::StringRef(cmd.getCreator().getName()) != \"clang\") {",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 208,
          "old_api": "Report",
          "new_api": null,
          "old_text": "diags.Report(diag::err_fe_expected_clang_command)",
          "new_text": null,
          "old_line_content": "    diags.Report(diag::err_fe_expected_clang_command);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 213,
          "old_api": "getArguments",
          "new_api": null,
          "old_text": "cmd.getArguments()",
          "new_text": null,
          "old_line_content": "  const driver::ArgStringList &ccargs = cmd.getArguments();",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 218,
          "old_api": "llvm::errs()",
          "new_api": null,
          "old_text": "llvm::errs()",
          "new_text": null,
          "old_line_content": "      llvm::errs() << \" \" << arg;",
          "new_line_content": "  if (flags_ & DEBUG_PREPROCESSOR) {",
          "content_same": false
        },
        {
          "line": 224,
          "old_api": "getInvocation",
          "new_api": null,
          "old_text": "compiler0.getInvocation()",
          "new_text": null,
          "old_line_content": "  CompilerInvocation &invocation0 = compiler0.getInvocation();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 225,
          "old_api": "data",
          "new_api": null,
          "old_text": "CompilerInvocation::CreateFromArgs(\n          invocation0, const_cast<const char **>(ccargs.data()),\n          const_cast<const char **>(ccargs.data()) + ccargs.size(), diags)",
          "new_text": null,
          "old_line_content": "  if (!CompilerInvocation::CreateFromArgs(",
          "new_line_content": "  // pre-compilation pass for generating tracepoint structures",
          "content_same": false
        },
        {
          "line": 226,
          "old_api": "data",
          "new_api": null,
          "old_text": "ccargs.data()",
          "new_text": null,
          "old_line_content": "          invocation0, const_cast<const char **>(ccargs.data()),",
          "new_line_content": "  CompilerInstance compiler0;",
          "content_same": false
        },
        {
          "line": 232,
          "old_api": "getPreprocessorOpts",
          "new_api": null,
          "old_text": "invocation0.getPreprocessorOpts().addRemappedFile(f.first, &*f.second)",
          "new_text": null,
          "old_line_content": "    invocation0.getPreprocessorOpts().addRemappedFile(f.first, &*f.second);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 236,
          "old_api": "getFrontendOpts",
          "new_api": null,
          "old_text": "invocation0.getFrontendOpts().Inputs.clear()",
          "new_text": null,
          "old_line_content": "    invocation0.getFrontendOpts().Inputs.clear();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 237,
          "old_api": "FrontendInputFile",
          "new_api": null,
          "old_text": "FrontendInputFile(\n        main_path, FrontendOptions::getInputKindForExtension(\"c\"))",
          "new_text": null,
          "old_line_content": "    invocation0.getFrontendOpts().Inputs.push_back(FrontendInputFile(",
          "new_line_content": "  if (in_memory) {",
          "content_same": false
        },
        {
          "line": 242,
          "old_api": "createDiagnostics",
          "new_api": null,
          "old_text": "compiler0.createDiagnostics(new IgnoringDiagConsumer())",
          "new_text": null,
          "old_line_content": "  compiler0.createDiagnostics(new IgnoringDiagConsumer());",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 248,
          "old_api": "ExecuteAction",
          "new_api": null,
          "old_text": "compiler0.ExecuteAction(tpact)",
          "new_text": null,
          "old_line_content": "  compiler0.ExecuteAction(tpact); // ignore errors, they will be reported later",
          "new_line_content": "  string out_str;",
          "content_same": false
        },
        {
          "line": 249,
          "old_api": "llvm::MemoryBuffer::getMemBuffer(out_str)",
          "new_api": null,
          "old_text": "llvm::MemoryBuffer::getMemBuffer(out_str)",
          "new_text": null,
          "old_line_content": "  unique_ptr<llvm::MemoryBuffer> out_buf = llvm::MemoryBuffer::getMemBuffer(out_str);",
          "new_line_content": "  llvm::raw_string_ostream os(out_str);",
          "content_same": false
        },
        {
          "line": 253,
          "old_api": "getInvocation",
          "new_api": null,
          "old_text": "compiler1.getInvocation()",
          "new_text": null,
          "old_line_content": "  CompilerInvocation &invocation1 = compiler1.getInvocation();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 254,
          "old_api": "data",
          "new_api": null,
          "old_text": "CompilerInvocation::CreateFromArgs(\n          invocation1, const_cast<const char **>(ccargs.data()),\n          const_cast<const char **>(ccargs.data()) + ccargs.size(), diags)",
          "new_text": null,
          "old_line_content": "  if (!CompilerInvocation::CreateFromArgs(",
          "new_line_content": "  // first pass",
          "content_same": false
        },
        {
          "line": 255,
          "old_api": "data",
          "new_api": null,
          "old_text": "ccargs.data()",
          "new_text": null,
          "old_line_content": "          invocation1, const_cast<const char **>(ccargs.data()),",
          "new_line_content": "  CompilerInstance compiler1;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 23,
      "total_additions": 41,
      "total_deletions": 41,
      "total_api_changes": 105
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 4,
        "api_related_lines": 105,
        "non_api_lines": 2,
        "non_api_line_numbers": [
          137,
          138
        ]
      }
    },
    "api_calls_before": 128,
    "api_calls_after": 128,
    "diff_info": {
      "added_lines": 4,
      "removed_lines": 1,
      "total_diff_lines": 17
    }
  }
}