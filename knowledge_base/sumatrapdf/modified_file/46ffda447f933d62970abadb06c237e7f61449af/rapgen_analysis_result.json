{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/sumatrapdf/modified_file/46ffda447f933d62970abadb06c237e7f61449af",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/sumatrapdf/modified_file/46ffda447f933d62970abadb06c237e7f61449af/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/sumatrapdf/modified_file/46ffda447f933d62970abadb06c237e7f61449af/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/sumatrapdf/modified_file/46ffda447f933d62970abadb06c237e7f61449af/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 482,
          "old_api": "return file",
          "new_api": "GetNamedDest",
          "old_text": " return file",
          "new_text": "GetNamedDest([[maybe",
          "old_line_content": "RectF EngineBase::PageContentBox(int pageNo, [[maybe_unused]] RenderTarget target) {",
          "new_line_content": "    return PageMediabox(pageNo);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 523,
          "old_api": null,
          "new_api": "SetCopy",
          "old_text": null,
          "new_text": "eNameBase.SetCopy(s);\n}\n\nP",
          "old_line_content": "WCHAR* EngineBase::GetPageLabel(int pageNo) const {",
          "new_line_content": "    return str::Format(L\"%d\", pageNo);",
          "content_same": false
        },
        {
          "line": 527,
          "old_api": null,
          "new_api": "ol inverse)",
          "old_text": null,
          "new_text": "ol inverse) ",
          "old_line_content": "int EngineBase::GetPageByLabel(const WCHAR* label) const {",
          "new_line_content": "    return _wtoi(label);",
          "content_same": false
        },
        {
          "line": 535,
          "old_api": null,
          "new_api": "e file:/// from s. It m",
          "old_text": null,
          "new_text": "e file:/// from s. It m",
          "old_line_content": "char* EngineBase::GetDecryptionKey() const {",
          "new_line_content": "    return str::Dup(decryptionKey);",
          "content_same": false
        },
        {
          "line": 539,
          "old_api": null,
          "new_api": "kipFileProtocol",
          "old_text": null,
          "new_text": "kipFileProtocol(co",
          "old_line_content": "const WCHAR* EngineBase::FileName() const {",
          "new_line_content": "    return fileNameBase.Get();",
          "content_same": false
        },
        {
          "line": 413,
          "old_api": null,
          "new_api": "return true;\n}\n\nstatic bool VisitTocTreeWith",
          "old_text": null,
          "new_text": "  return true;\n}\n\nstatic bool VisitTocTreeWith",
          "old_line_content": "    TocTree* res = new TocTree();",
          "new_line_content": "    res->root = CloneTocItemRecur(tree->root, removeUnchecked);",
          "content_same": false
        },
        {
          "line": 543,
          "old_api": null,
          "new_api": "}\n    s",
          "old_text": null,
          "new_text": " }\n    s ",
          "old_line_content": "RenderedBitmap* EngineBase::GetImageForPageElement(IPageElement*) {",
          "new_line_content": "    CrashMe();",
          "content_same": false
        },
        {
          "line": 548,
          "old_api": null,
          "new_api": "",
          "old_text": null,
          "new_text": "",
          "old_line_content": "void EngineBase::SetFileName(const WCHAR* s) {",
          "new_line_content": "    fileNameBase.SetCopy(s);",
          "content_same": false
        },
        {
          "line": 421,
          "old_api": null,
          "new_api": "co",
          "old_text": null,
          "new_text": "   co",
          "old_line_content": "    while (ti) {",
          "new_line_content": "        cont = f(ti);",
          "content_same": false
        },
        {
          "line": 423,
          "old_api": null,
          "new_api": "cont = VisitTocTr",
          "old_text": null,
          "new_text": "         cont = VisitTocTr",
          "old_line_content": "        if (cont && ti->child) {",
          "new_line_content": "            cont = VisitTocTree(ti->child, f);",
          "content_same": false
        },
        {
          "line": 552,
          "old_api": null,
          "new_api": "",
          "old_text": null,
          "new_text": "",
          "old_line_content": "PointF EngineBase::Transform(PointF pt, int pageNo, float zoom, int rotation, bool inverse) {",
          "new_line_content": "    RectF rc = RectF(pt, SizeF());",
          "content_same": false
        },
        {
          "line": 560,
          "old_api": null,
          "new_api": "",
          "old_text": null,
          "new_text": "",
          "old_line_content": "const WCHAR* SkipFileProtocol(const WCHAR* s) {",
          "new_line_content": "    if (!str::StartsWithI(s, L\"file://\")) {",
          "content_same": false
        },
        {
          "line": 437,
          "old_api": null,
          "new_api": "* ti, TocItem",
          "old_text": null,
          "new_text": "* ti, TocItem",
          "old_line_content": "    while (ti) {",
          "new_line_content": "        cont = f(ti, parent);",
          "content_same": false
        },
        {
          "line": 439,
          "old_api": null,
          "new_api": "void SetTocTreeParents(TocItem* treeRoot) {",
          "old_text": null,
          "new_text": "\nvoid SetTocTreeParents(TocItem* treeRoot) {\n    ",
          "old_line_content": "        if (cont && ti->child) {",
          "new_line_content": "            cont = VisitTocTreeWithParentRecursive(ti->child, ti, f);",
          "content_same": false
        },
        {
          "line": 450,
          "old_api": null,
          "new_api": "eNo;\n    this->zoom = zoom;\n    this->rotation",
          "old_text": null,
          "new_text": "eNo;\n    this->zoom = zoom;\n    this->rotation ",
          "old_line_content": "bool VisitTocTreeWithParent(TocItem* ti, const std::function<bool(TocItem* ti, TocItem* parent)>& f) {",
          "new_line_content": "    return VisitTocTreeWithParentRecursive(ti, nullptr, f);",
          "content_same": false
        },
        {
          "line": 459,
          "old_api": null,
          "new_api": "EngineBase::PageCount() const {\n    CrashIf(pageCo",
          "old_text": null,
          "new_text": "EngineBase::PageCount() const {\n    CrashIf(pageCo",
          "old_line_content": "void SetTocTreeParents(TocItem* treeRoot) {",
          "new_line_content": "    VisitTocTreeWithParent(treeRoot, setTocItemParent);",
          "content_same": false
        },
        {
          "line": 473,
          "old_api": null,
          "new_api": "Printing",
          "old_text": null,
          "new_text": "Printing() const {\n",
          "old_line_content": "EngineBase::~EngineBase() {",
          "new_line_content": "    free(decryptionKey);",
          "content_same": false
        },
        {
          "line": 477,
          "old_api": null,
          "new_api": "lowsCopyingText",
          "old_text": null,
          "new_text": "lowsCopyingText() cons",
          "old_line_content": "int EngineBase::PageCount() const {",
          "new_line_content": "    CrashIf(pageCount < 0);",
          "content_same": false
        },
        {
          "line": 481,
          "old_api": null,
          "new_api": "return fil",
          "old_text": null,
          "new_text": "  return fil",
          "old_line_content": "",
          "new_line_content": "RectF EngineBase::PageContentBox(int pageNo, [[maybe_unused]] RenderTarget target) {",
          "content_same": false
        },
        {
          "line": 485,
          "old_api": null,
          "new_api": "TocTree*",
          "old_text": null,
          "new_text": "   TocTree* ",
          "old_line_content": "",
          "new_line_content": "bool EngineBase::SaveFileAsPDF([[maybe_unused]] const char* pdfFileName, [[maybe_unused]] bool includeUserAnnots) {",
          "content_same": false
        },
        {
          "line": 505,
          "old_api": null,
          "new_api": "return isPa",
          "old_text": null,
          "new_text": " return isPa",
          "old_line_content": "",
          "new_line_content": "PageDestination* EngineBase::GetNamedDest([[maybe_unused]] const WCHAR* name) {",
          "content_same": false
        },
        {
          "line": 378,
          "old_api": null,
          "new_api": "RootAt",
          "old_text": null,
          "new_text": "RootAt(int n) {\n    auto node = root;\n    while (n > 0) {\n  ",
          "old_line_content": "    if (pageNo != dest->pageNo) {",
          "new_line_content": "        logf(\"pageNo: %d, dest->pageNo: %d\\n\", pageNo, dest->pageNo);",
          "content_same": false
        },
        {
          "line": 510,
          "old_api": null,
          "new_api": "}\n\ncons",
          "old_text": null,
          "new_text": "\n}\n\ncons",
          "old_line_content": "bool EngineBase::HacToc() {",
          "new_line_content": "    TocTree* tree = GetToc();",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 524,
          "old_api": "SetCopy",
          "new_api": null,
          "old_text": "NameBase.SetCopy(s);\n}\n\nPo",
          "new_text": null,
          "old_line_content": "    return str::Format(L\"%d\", pageNo);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 528,
          "old_api": "l inverse) {",
          "new_api": null,
          "old_text": "l inverse) {",
          "new_text": null,
          "old_line_content": "    return _wtoi(label);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 536,
          "old_api": "file:/// from s. It mi",
          "new_api": null,
          "old_text": " file:/// from s. It mi",
          "new_text": null,
          "old_line_content": "    return str::Dup(decryptionKey);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 540,
          "old_api": "ipFileProtocol",
          "new_api": null,
          "old_text": "ipFileProtocol(con",
          "new_text": null,
          "old_line_content": "    return fileNameBase.Get();",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 414,
          "old_api": "return true;\n}\n\nstatic bool VisitTocTreeWithP",
          "new_api": null,
          "old_text": " return true;\n}\n\nstatic bool VisitTocTreeWithP",
          "new_text": null,
          "old_line_content": "    res->root = CloneTocItemRecur(tree->root, removeUnchecked);",
          "new_line_content": "    return res;",
          "content_same": false
        },
        {
          "line": 544,
          "old_api": "}\n    s +",
          "new_api": null,
          "old_text": "}\n    s +",
          "new_text": null,
          "old_line_content": "    CrashMe();",
          "new_line_content": "    return nullptr;",
          "content_same": false
        },
        {
          "line": 549,
          "old_api": "",
          "new_api": null,
          "old_text": "",
          "new_text": null,
          "old_line_content": "    fileNameBase.SetCopy(s);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 422,
          "old_api": "con",
          "new_api": null,
          "old_text": "  con",
          "new_text": null,
          "old_line_content": "        cont = f(ti);",
          "new_line_content": "        if (cont && ti->child) {",
          "content_same": false
        },
        {
          "line": 424,
          "old_api": "cont = VisitTocTre",
          "new_api": null,
          "old_text": "        cont = VisitTocTre",
          "new_text": null,
          "old_line_content": "            cont = VisitTocTree(ti->child, f);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 555,
          "old_api": "",
          "new_api": null,
          "old_text": "",
          "new_text": null,
          "old_line_content": "    return rect.TL();",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 561,
          "old_api": "",
          "new_api": null,
          "old_text": "",
          "new_text": null,
          "old_line_content": "    if (!str::StartsWithI(s, L\"file://\")) {",
          "new_line_content": "        return s;",
          "content_same": false
        },
        {
          "line": 438,
          "old_api": "ti, TocItem*",
          "new_api": null,
          "old_text": " ti, TocItem*",
          "new_text": null,
          "old_line_content": "        cont = f(ti, parent);",
          "new_line_content": "        if (cont && ti->child) {",
          "content_same": false
        },
        {
          "line": 440,
          "old_api": "void SetTocTreeParents(TocItem* treeRoot) {\n    V",
          "new_api": null,
          "old_text": "void SetTocTreeParents(TocItem* treeRoot) {\n    V",
          "new_text": null,
          "old_line_content": "            cont = VisitTocTreeWithParentRecursive(ti->child, ti, f);",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 451,
          "old_api": "No;\n    this->zoom = zoom;\n    this->rotation =",
          "new_api": null,
          "old_text": "No;\n    this->zoom = zoom;\n    this->rotation =",
          "new_text": null,
          "old_line_content": "    return VisitTocTreeWithParentRecursive(ti, nullptr, f);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 460,
          "old_api": "ngineBase::PageCount() const {\n    CrashIf(pageCou",
          "new_api": null,
          "old_text": "ngineBase::PageCount() const {\n    CrashIf(pageCou",
          "new_text": null,
          "old_line_content": "    VisitTocTreeWithParent(treeRoot, setTocItemParent);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 474,
          "old_api": "rinting",
          "new_api": null,
          "old_text": "rinting() const {\n ",
          "new_text": null,
          "old_line_content": "    free(decryptionKey);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 478,
          "old_api": "owsCopyingText",
          "new_api": null,
          "old_text": "owsCopyingText() const",
          "new_text": null,
          "old_line_content": "    CrashIf(pageCount < 0);",
          "new_line_content": "    return pageCount;",
          "content_same": false
        },
        {
          "line": 483,
          "old_api": "etNamedDest",
          "new_api": null,
          "old_text": "etNamedDest([[maybe_",
          "new_text": null,
          "old_line_content": "    return PageMediabox(pageNo);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 486,
          "old_api": "TocTree* t",
          "new_api": null,
          "old_text": "  TocTree* t",
          "new_text": null,
          "old_line_content": "bool EngineBase::SaveFileAsPDF([[maybe_unused]] const char* pdfFileName, [[maybe_unused]] bool includeUserAnnots) {",
          "new_line_content": "    return false;",
          "content_same": false
        },
        {
          "line": 506,
          "old_api": "return isPas",
          "new_api": null,
          "old_text": "return isPas",
          "new_text": null,
          "old_line_content": "PageDestination* EngineBase::GetNamedDest([[maybe_unused]] const WCHAR* name) {",
          "new_line_content": "    return nullptr;",
          "content_same": false
        },
        {
          "line": 379,
          "old_api": "ootAt",
          "new_api": null,
          "old_text": "ootAt(int n) {\n    auto node = root;\n    while (n > 0) {\n   ",
          "new_text": null,
          "old_line_content": "        logf(\"pageNo: %d, dest->pageNo: %d\\n\", pageNo, dest->pageNo);",
          "new_line_content": "        return false;",
          "content_same": false
        },
        {
          "line": 511,
          "old_api": "}\n\nconst",
          "new_api": null,
          "old_text": "}\n\nconst",
          "new_text": null,
          "old_line_content": "    TocTree* tree = GetToc();",
          "new_line_content": "    return tree != nullptr;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 1,
      "total_additions": 22,
      "total_deletions": 22,
      "total_api_changes": 45
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 3,
        "api_related_lines": 45,
        "non_api_lines": 3,
        "non_api_line_numbers": [
          345,
          347,
          348
        ]
      }
    },
    "api_calls_before": 64,
    "api_calls_after": 64,
    "diff_info": {
      "added_lines": 1,
      "removed_lines": 2,
      "total_diff_lines": 17
    }
  }
}