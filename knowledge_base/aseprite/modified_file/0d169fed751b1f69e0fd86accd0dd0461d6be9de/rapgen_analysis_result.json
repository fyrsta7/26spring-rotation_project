{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/aseprite/modified_file/0d169fed751b1f69e0fd86accd0dd0461d6be9de",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/aseprite/modified_file/0d169fed751b1f69e0fd86accd0dd0461d6be9de/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/aseprite/modified_file/0d169fed751b1f69e0fd86accd0dd0461d6be9de/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/aseprite/modified_file/0d169fed751b1f69e0fd86accd0dd0461d6be9de/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 209,
          "old_api": "gfx::Rect(xout, y, len, textheight)",
          "new_api": "gfx::Point(xout, y)",
          "old_text": "gfx::Rect(xout, y, len, textheight)",
          "new_text": "gfx::Point(xout, y)",
          "old_line_content": "        gfx::Rect(xout, y, len, textheight));",
          "new_line_content": "      g->drawUIString(beg, fg, gfx::ColorNone, gfx::Point(xout, y));",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 163,
          "old_api": null,
          "new_api": "std::strpbrk(beg_end, \" \\n\")",
          "old_text": null,
          "new_text": "std::strpbrk(beg_end, \" \\n\")",
          "old_line_content": "        }",
          "new_line_content": "        end = std::strpbrk(beg_end, \" \\n\");",
          "content_same": false
        },
        {
          "line": 196,
          "old_api": null,
          "new_api": "textLength",
          "old_text": null,
          "new_text": "font->textLength(beg)",
          "old_line_content": "      int xout;",
          "new_line_content": "    len = font->textLength(beg);",
          "content_same": false
        },
        {
          "line": 136,
          "old_api": null,
          "new_api": "getScrollableSize",
          "old_text": null,
          "new_text": "view->getScrollableSize()",
          "old_line_content": "        width = vp.w;",
          "new_line_content": "        gfx::Size maxSize = view->getScrollableSize();",
          "content_same": false
        },
        {
          "line": 137,
          "old_api": null,
          "new_api": "MAX",
          "old_text": null,
          "new_text": "MAX(vp.w, maxSize.w)",
          "old_line_content": "      }",
          "new_line_content": "        width = MAX(vp.w, maxSize.w);",
          "content_same": false
        },
        {
          "line": 170,
          "old_api": null,
          "new_api": "textLength",
          "old_text": null,
          "new_text": "font->textLength(beg)",
          "old_line_content": "          end = old_end;",
          "new_line_content": "        if ((old_end) && (x+font->textLength(beg) > x1-scroll.x+width)) {",
          "content_same": false
        },
        {
          "line": 202,
          "old_api": null,
          "new_api": "align",
          "old_text": null,
          "new_text": "widget->align()",
          "old_line_content": "      else                      // Left align",
          "new_line_content": "      if (widget->align() & CENTER)",
          "content_same": false
        },
        {
          "line": 204,
          "old_api": null,
          "new_api": "align",
          "old_text": null,
          "new_text": "widget->align()",
          "old_line_content": "",
          "new_line_content": "      else if (widget->align() & RIGHT)",
          "content_same": false
        },
        {
          "line": 114,
          "old_api": null,
          "new_api": "fillRect",
          "old_text": null,
          "new_text": "g->fillRect(bg, vp)",
          "old_line_content": "  // Without word-wrap",
          "new_line_content": "    g->fillRect(bg, vp);",
          "content_same": false
        },
        {
          "line": 119,
          "old_api": null,
          "new_api": "align",
          "old_text": null,
          "new_text": "widget->align()",
          "old_line_content": "  else {",
          "new_line_content": "  if (!(widget->align() & WORDWRAP)) {",
          "content_same": false
        },
        {
          "line": 152,
          "old_api": null,
          "new_api": "align",
          "old_text": null,
          "new_text": "widget->align()",
          "old_line_content": "        *end = 0;",
          "new_line_content": "    if (!(widget->align() & WORDWRAP)) {",
          "content_same": false
        },
        {
          "line": 153,
          "old_api": null,
          "new_api": "std::strchr(beg, '\\n')",
          "old_text": null,
          "new_text": "std::strchr(beg, '\\n')",
          "old_line_content": "      }",
          "new_line_content": "      end = std::strchr(beg, '\\n');",
          "content_same": false
        },
        {
          "line": 120,
          "old_api": null,
          "new_api": "clientBounds",
          "old_text": null,
          "new_text": "widget->clientBounds()",
          "old_line_content": "    if (w) {",
          "new_line_content": "    width = widget->clientBounds().w;",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 192,
          "old_api": "textLength",
          "new_api": null,
          "old_text": "font->textLength(beg)",
          "new_text": null,
          "old_line_content": "    len = font->textLength(beg);",
          "new_line_content": "        old_end = end;",
          "content_same": false
        },
        {
          "line": 132,
          "old_api": "getScrollableSize",
          "new_api": null,
          "old_text": "view->getScrollableSize()",
          "new_text": null,
          "old_line_content": "        gfx::Size maxSize = view->getScrollableSize();",
          "new_line_content": "      width = vp.w;",
          "content_same": false
        },
        {
          "line": 133,
          "old_api": "MAX",
          "new_api": null,
          "old_text": "MAX(vp.w, maxSize.w)",
          "new_text": null,
          "old_line_content": "        width = MAX(vp.w, maxSize.w);",
          "new_line_content": "#else",
          "content_same": false
        },
        {
          "line": 166,
          "old_api": "textLength",
          "new_api": null,
          "old_text": "font->textLength(beg)",
          "new_text": null,
          "old_line_content": "        if ((old_end) && (x+font->textLength(beg) > x1-scroll.x+width)) {",
          "new_line_content": "          *end = 0;",
          "content_same": false
        },
        {
          "line": 198,
          "old_api": "align",
          "new_api": null,
          "old_text": "widget->align()",
          "new_text": null,
          "old_line_content": "      if (widget->align() & CENTER)",
          "new_line_content": "    // Render the text",
          "content_same": false
        },
        {
          "line": 200,
          "old_api": "align",
          "new_api": null,
          "old_text": "widget->align()",
          "new_text": null,
          "old_line_content": "      else if (widget->align() & RIGHT)",
          "new_line_content": "      int xout;",
          "content_same": false
        },
        {
          "line": 231,
          "old_api": "gfx::Rect(x1, y, x2 - x1, y2 - y)",
          "new_api": null,
          "old_text": "gfx::Rect(x1, y, x2 - x1, y2 - y)",
          "new_text": null,
          "old_line_content": "    g->fillRect(bg, gfx::Rect(x1, y, x2 - x1, y2 - y));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 205,
          "old_api": "gfx::Point(xout, y)",
          "new_api": null,
          "old_text": "gfx::Point(xout, y)",
          "new_text": null,
          "old_line_content": "      g->drawUIString(beg, fg, bg, gfx::Point(xout, y));",
          "new_line_content": "        xout = x + width - len;",
          "content_same": false
        },
        {
          "line": 206,
          "old_api": "fillAreaBetweenRects",
          "new_api": null,
          "old_text": "g->fillAreaBetweenRects(\n        bg,\n        gfx::Rect(x1, y, x2 - x1, textheight),\n        gfx::Rect(xout, y, len, textheight))",
          "new_text": null,
          "old_line_content": "      g->fillAreaBetweenRects(",
          "new_line_content": "      else                      // Left align",
          "content_same": false
        },
        {
          "line": 208,
          "old_api": "gfx::Rect(x1, y, x2 - x1, textheight)",
          "new_api": null,
          "old_text": "gfx::Rect(x1, y, x2 - x1, textheight)",
          "new_text": null,
          "old_line_content": "        gfx::Rect(x1, y, x2 - x1, textheight),",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 115,
          "old_api": "align",
          "new_api": null,
          "old_text": "widget->align()",
          "new_text": null,
          "old_line_content": "  if (!(widget->align() & WORDWRAP)) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 148,
          "old_api": "align",
          "new_api": null,
          "old_text": "widget->align()",
          "new_text": null,
          "old_line_content": "    if (!(widget->align() & WORDWRAP)) {",
          "new_line_content": "  for (beg=end=text; end; ) {",
          "content_same": false
        },
        {
          "line": 149,
          "old_api": "std::strchr(beg, '\\n')",
          "new_api": null,
          "old_text": "std::strchr(beg, '\\n')",
          "new_text": null,
          "old_line_content": "      end = std::strchr(beg, '\\n');",
          "new_line_content": "    x = x1;",
          "content_same": false
        },
        {
          "line": 116,
          "old_api": "clientBounds",
          "new_api": null,
          "old_text": "widget->clientBounds()",
          "new_text": null,
          "old_line_content": "    width = widget->clientBounds().w;",
          "new_line_content": "  chr = 0;",
          "content_same": false
        },
        {
          "line": 159,
          "old_api": "std::strpbrk(beg_end, \" \\n\")",
          "new_api": null,
          "old_text": "std::strpbrk(beg_end, \" \\n\")",
          "new_text": null,
          "old_line_content": "        end = std::strpbrk(beg_end, \" \\n\");",
          "new_line_content": "    // With word-wrap",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 1,
      "total_additions": 12,
      "total_deletions": 15,
      "total_api_changes": 28
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 13,
        "api_related_lines": 28,
        "non_api_lines": 6,
        "non_api_line_numbers": [
          228,
          229,
          230,
          207,
          112,
          113
        ]
      }
    },
    "api_calls_before": 51,
    "api_calls_after": 47,
    "diff_info": {
      "added_lines": 5,
      "removed_lines": 9,
      "total_diff_lines": 40
    }
  }
}