{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/aseprite/modified_file/47ff85e871cc0cdc9dcdaad1a2a3af726db5958f",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/aseprite/modified_file/47ff85e871cc0cdc9dcdaad1a2a3af726db5958f/before.cpp",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/aseprite/modified_file/47ff85e871cc0cdc9dcdaad1a2a3af726db5958f/after.cpp",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/aseprite/modified_file/47ff85e871cc0cdc9dcdaad1a2a3af726db5958f/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 743,
          "old_api": "size",
          "new_api": "angle",
          "old_text": "src->size()",
          "new_text": "m_currentData.angle()",
          "old_line_content": "      gfx::Rect(m_currentData.bounds()).size() == src->size()) {",
          "new_line_content": "  double angle = 180.0*m_currentData.angle()/PI;",
          "content_same": false
        },
        {
          "line": 756,
          "old_api": "leftTop",
          "new_api": "bitmap",
          "old_text": "corners.leftTop()",
          "new_text": "mask->bitmap()",
          "old_line_content": "        int(corners.leftTop().y-leftTop.y),",
          "new_line_content": "        dst, src, (mask ? mask->bitmap(): nullptr),",
          "content_same": false
        },
        {
          "line": 757,
          "old_api": "rightTop",
          "new_api": "leftTop",
          "old_text": "corners.rightTop()",
          "new_text": "corners.leftTop()",
          "old_line_content": "        int(corners.rightTop().x-leftTop.x),",
          "new_line_content": "        int(corners.leftTop().x-leftTop.x),",
          "content_same": false
        },
        {
          "line": 758,
          "old_api": "rightTop",
          "new_api": "leftTop",
          "old_text": "corners.rightTop()",
          "new_text": "corners.leftTop()",
          "old_line_content": "        int(corners.rightTop().y-leftTop.y),",
          "new_line_content": "        int(corners.leftTop().y-leftTop.y),",
          "content_same": false
        },
        {
          "line": 759,
          "old_api": "rightBottom",
          "new_api": "rightTop",
          "old_text": "corners.rightBottom()",
          "new_text": "corners.rightTop()",
          "old_line_content": "        int(corners.rightBottom().x-leftTop.x),",
          "new_line_content": "        int(corners.rightTop().x-leftTop.x),",
          "content_same": false
        },
        {
          "line": 760,
          "old_api": "rightBottom",
          "new_api": "rightTop",
          "old_text": "corners.rightBottom()",
          "new_text": "corners.rightTop()",
          "old_line_content": "        int(corners.rightBottom().y-leftTop.y),",
          "new_line_content": "        int(corners.rightTop().y-leftTop.y),",
          "content_same": false
        },
        {
          "line": 761,
          "old_api": "leftBottom",
          "new_api": "rightBottom",
          "old_text": "corners.leftBottom()",
          "new_text": "corners.rightBottom()",
          "old_line_content": "        int(corners.leftBottom().x-leftTop.x),",
          "new_line_content": "        int(corners.rightBottom().x-leftTop.x),",
          "content_same": false
        },
        {
          "line": 762,
          "old_api": "leftBottom",
          "new_api": "rightBottom",
          "old_text": "corners.leftBottom()",
          "new_text": "corners.rightBottom()",
          "old_line_content": "        int(corners.leftBottom().y-leftTop.y));",
          "new_line_content": "        int(corners.rightBottom().y-leftTop.y),",
          "content_same": false
        },
        {
          "line": 770,
          "old_api": "leftTop",
          "new_api": "bitmap",
          "old_text": "corners.leftTop()",
          "new_text": "mask->bitmap()",
          "old_line_content": "          int(corners.leftTop().y-leftTop.y),",
          "new_line_content": "          dst, src, (mask ? mask->bitmap(): nullptr),",
          "content_same": false
        },
        {
          "line": 771,
          "old_api": "rightTop",
          "new_api": "leftTop",
          "old_text": "corners.rightTop()",
          "new_text": "corners.leftTop()",
          "old_line_content": "          int(corners.rightTop().x-leftTop.x),",
          "new_line_content": "          int(corners.leftTop().x-leftTop.x),",
          "content_same": false
        },
        {
          "line": 772,
          "old_api": "rightTop",
          "new_api": "leftTop",
          "old_text": "corners.rightTop()",
          "new_text": "corners.leftTop()",
          "old_line_content": "          int(corners.rightTop().y-leftTop.y),",
          "new_line_content": "          int(corners.leftTop().y-leftTop.y),",
          "content_same": false
        },
        {
          "line": 773,
          "old_api": "rightBottom",
          "new_api": "rightTop",
          "old_text": "corners.rightBottom()",
          "new_text": "corners.rightTop()",
          "old_line_content": "          int(corners.rightBottom().x-leftTop.x),",
          "new_line_content": "          int(corners.rightTop().x-leftTop.x),",
          "content_same": false
        },
        {
          "line": 774,
          "old_api": "rightBottom",
          "new_api": "rightTop",
          "old_text": "corners.rightBottom()",
          "new_text": "corners.rightTop()",
          "old_line_content": "          int(corners.rightBottom().y-leftTop.y),",
          "new_line_content": "          int(corners.rightTop().y-leftTop.y),",
          "content_same": false
        },
        {
          "line": 775,
          "old_api": "leftBottom",
          "new_api": "rightBottom",
          "old_text": "corners.leftBottom()",
          "new_text": "corners.rightBottom()",
          "old_line_content": "          int(corners.leftBottom().x-leftTop.x),",
          "new_line_content": "          int(corners.rightBottom().x-leftTop.x),",
          "content_same": false
        },
        {
          "line": 776,
          "old_api": "leftBottom",
          "new_api": "rightBottom",
          "old_text": "corners.leftBottom()",
          "new_text": "corners.rightBottom()",
          "old_line_content": "          int(corners.leftBottom().y-leftTop.y));",
          "new_line_content": "          int(corners.rightBottom().y-leftTop.y),",
          "content_same": false
        },
        {
          "line": 801,
          "old_api": "updateDocumentMask",
          "new_api": "redrawExtraImage",
          "old_text": "updateDocumentMask()",
          "new_text": "redrawExtraImage()",
          "old_line_content": "    updateDocumentMask();",
          "new_line_content": "    redrawExtraImage();",
          "content_same": false
        },
        {
          "line": 803,
          "old_api": "update_screen_for_document",
          "new_api": "updateDocumentMask",
          "old_text": "update_screen_for_document(m_document)",
          "new_text": "updateDocumentMask()",
          "old_line_content": "    update_screen_for_document(m_document);",
          "new_line_content": "    updateDocumentMask();",
          "content_same": false
        },
        {
          "line": 819,
          "old_api": "generateMaskBoundaries",
          "new_api": "setNewMask",
          "old_text": "m_document->generateMaskBoundaries(m_currentMask)",
          "new_text": "m_setMaskCmd->setNewMask(m_currentMask)",
          "old_line_content": "  m_document->generateMaskBoundaries(m_currentMask);",
          "new_line_content": "    m_setMaskCmd->setNewMask(m_currentMask);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 795,
          "old_api": null,
          "new_api": "onRotationAlgorithmChange",
          "old_text": null,
          "new_text": "onRotationAlgorithmChange()",
          "old_line_content": "",
          "new_line_content": "  onRotationAlgorithmChange();",
          "content_same": false
        },
        {
          "line": 802,
          "old_api": null,
          "new_api": "redrawCurrentMask",
          "old_text": null,
          "new_text": "redrawCurrentMask()",
          "old_line_content": "",
          "new_line_content": "    redrawCurrentMask();",
          "content_same": false
        },
        {
          "line": 805,
          "old_api": null,
          "new_api": "update_screen_for_document",
          "old_text": null,
          "new_text": "update_screen_for_document(m_document)",
          "old_line_content": "  catch (const std::exception& ex) {",
          "new_line_content": "    update_screen_for_document(m_document);",
          "content_same": false
        },
        {
          "line": 744,
          "old_api": null,
          "new_api": "std::fabs(angle)",
          "old_text": null,
          "new_text": "std::fabs(angle)",
          "old_line_content": "    rotAlgo = tools::RotationAlgorithm::FAST;",
          "new_line_content": "  if (std::fabs(std::fmod(std::fabs(angle), 90.0)) < 0.01 ||",
          "content_same": false
        },
        {
          "line": 745,
          "old_api": null,
          "new_api": "std::fabs(angle)",
          "old_text": null,
          "new_text": "std::fabs(angle)",
          "old_line_content": "  }",
          "new_line_content": "      std::fabs(std::fmod(std::fabs(angle), 90.0)-90.0) < 0.01) {",
          "content_same": false
        },
        {
          "line": 777,
          "old_api": null,
          "new_api": "leftBottom",
          "old_text": null,
          "new_text": "corners.leftBottom()",
          "old_line_content": "      }",
          "new_line_content": "          int(corners.leftBottom().x-leftTop.x),",
          "content_same": false
        },
        {
          "line": 778,
          "old_api": null,
          "new_api": "leftBottom",
          "old_text": null,
          "new_text": "corners.leftBottom()",
          "old_line_content": "      catch (const std::bad_alloc&) {",
          "new_line_content": "          int(corners.leftBottom().y-leftTop.y));",
          "content_same": false
        },
        {
          "line": 808,
          "old_api": null,
          "new_api": "Console::showException(ex)",
          "old_text": null,
          "new_text": "Console::showException(ex)",
          "old_line_content": "}",
          "new_line_content": "    Console::showException(ex);",
          "content_same": false
        },
        {
          "line": 781,
          "old_api": null,
          "new_api": "showTip",
          "old_text": null,
          "new_text": "StatusBar::instance()->showTip(1000,\n          \"Not enough memory for RotSprite\")",
          "old_line_content": "",
          "new_line_content": "        StatusBar::instance()->showTip(1000,",
          "content_same": false
        },
        {
          "line": 816,
          "old_api": null,
          "new_api": "m_tx",
          "old_text": null,
          "new_text": "m_tx(m_setMaskCmd)",
          "old_line_content": "  else",
          "new_line_content": "    m_tx(m_setMaskCmd);",
          "content_same": false
        },
        {
          "line": 821,
          "old_api": null,
          "new_api": "generateMaskBoundaries",
          "old_text": null,
          "new_text": "m_document->generateMaskBoundaries(m_currentMask)",
          "old_line_content": "",
          "new_line_content": "  m_document->generateMaskBoundaries(m_currentMask);",
          "content_same": false
        },
        {
          "line": 794,
          "old_api": null,
          "new_api": "set_pivot_from_preferences",
          "old_text": null,
          "new_text": "set_pivot_from_preferences(m_currentData)",
          "old_line_content": "}",
          "new_line_content": "  set_pivot_from_preferences(m_currentData);",
          "content_same": false
        },
        {
          "line": 763,
          "old_api": null,
          "new_api": "leftBottom",
          "old_text": null,
          "new_text": "corners.leftBottom()",
          "old_line_content": "      break;",
          "new_line_content": "        int(corners.leftBottom().x-leftTop.x),",
          "content_same": false
        },
        {
          "line": 764,
          "old_api": null,
          "new_api": "leftBottom",
          "old_text": null,
          "new_text": "corners.leftBottom()",
          "old_line_content": "",
          "new_line_content": "        int(corners.leftBottom().y-leftTop.y));",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 768,
          "old_api": "bitmap",
          "new_api": null,
          "old_text": "mask->bitmap()",
          "new_text": null,
          "old_line_content": "          dst, src, (mask ? mask->bitmap(): nullptr),",
          "new_line_content": "      try {",
          "content_same": false
        },
        {
          "line": 800,
          "old_api": "redrawCurrentMask",
          "new_api": null,
          "old_text": "redrawCurrentMask()",
          "new_text": null,
          "old_line_content": "    redrawCurrentMask();",
          "new_line_content": "  try {",
          "content_same": false
        },
        {
          "line": 742,
          "old_api": "angle",
          "new_api": null,
          "old_text": "m_currentData.angle()",
          "new_text": null,
          "old_line_content": "  if (m_currentData.angle() == 0.0 &&",
          "new_line_content": "  // a translation is applied.",
          "content_same": false
        },
        {
          "line": 806,
          "old_api": "Console::showException(ex)",
          "new_api": null,
          "old_text": "Console::showException(ex)",
          "new_text": null,
          "old_line_content": "    Console::showException(ex);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 779,
          "old_api": "showTip",
          "new_api": null,
          "old_text": "StatusBar::instance()->showTip(1000,\n          \"Not enough memory for RotSprite\")",
          "new_text": null,
          "old_line_content": "        StatusBar::instance()->showTip(1000,",
          "new_line_content": "      }",
          "content_same": false
        },
        {
          "line": 814,
          "old_api": "m_tx",
          "new_api": null,
          "old_text": "m_tx(m_setMaskCmd)",
          "new_text": null,
          "old_line_content": "    m_tx(m_setMaskCmd);",
          "new_line_content": "  if (!m_setMaskCmd) {",
          "content_same": false
        },
        {
          "line": 753,
          "old_api": "leftTop",
          "new_api": null,
          "old_text": "doc::algorithm::parallelogram(\n        dst, src, (mask ? mask->bitmap(): nullptr),\n        int(corners.leftTop().x-leftTop.x),\n        int(corners.leftTop().y-leftTop.y),\n        int(corners.rightTop().x-leftTop.x),\n        int(corners.rightTop().y-leftTop.y),\n        int(corners.rightBottom().x-leftTop.x),\n        int(corners.rightBottom().y-leftTop.y),\n        int(corners.leftBottom().x-leftTop.x),\n        int(corners.leftBottom().y-leftTop.y))",
          "new_text": null,
          "old_line_content": "      doc::algorithm::parallelogram(",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 754,
          "old_api": "bitmap",
          "new_api": null,
          "old_text": "mask->bitmap()",
          "new_text": null,
          "old_line_content": "        dst, src, (mask ? mask->bitmap(): nullptr),",
          "new_line_content": "    case tools::RotationAlgorithm::FAST:",
          "content_same": false
        },
        {
          "line": 817,
          "old_api": "setNewMask",
          "new_api": null,
          "old_text": "m_setMaskCmd->setNewMask(m_currentMask)",
          "new_text": null,
          "old_line_content": "    m_setMaskCmd->setNewMask(m_currentMask);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 799,
          "old_api": "redrawExtraImage",
          "new_api": null,
          "old_text": "redrawExtraImage()",
          "new_text": null,
          "old_line_content": "    redrawExtraImage();",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 792,
          "old_api": "set_pivot_from_preferences",
          "new_api": null,
          "old_text": "set_pivot_from_preferences(m_currentData)",
          "new_text": null,
          "old_line_content": "  set_pivot_from_preferences(m_currentData);",
          "new_line_content": "void PixelsMovement::onPivotChange()",
          "content_same": false
        },
        {
          "line": 793,
          "old_api": "onRotationAlgorithmChange",
          "new_api": null,
          "old_text": "onRotationAlgorithmChange()",
          "new_text": null,
          "old_line_content": "  onRotationAlgorithmChange();",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 767,
          "old_api": "leftTop",
          "new_api": null,
          "old_text": "doc::algorithm::rotsprite_image(\n          dst, src, (mask ? mask->bitmap(): nullptr),\n          int(corners.leftTop().x-leftTop.x),\n          int(corners.leftTop().y-leftTop.y),\n          int(corners.rightTop().x-leftTop.x),\n          int(corners.rightTop().y-leftTop.y),\n          int(corners.rightBottom().x-leftTop.x),\n          int(corners.rightBottom().y-leftTop.y),\n          int(corners.leftBottom().x-leftTop.x),\n          int(corners.leftBottom().y-leftTop.y))",
          "new_text": null,
          "old_line_content": "        doc::algorithm::rotsprite_image(",
          "new_line_content": "    case tools::RotationAlgorithm::ROTSPRITE:",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 18,
      "total_additions": 14,
      "total_deletions": 13,
      "total_api_changes": 45
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 7,
        "api_related_lines": 45,
        "non_api_lines": 3,
        "non_api_line_numbers": [
          739,
          740,
          741
        ]
      }
    },
    "api_calls_before": 291,
    "api_calls_after": 293,
    "diff_info": {
      "added_lines": 7,
      "removed_lines": 5,
      "total_diff_lines": 24
    }
  }
}