{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/d35825da6d5570524234e1bfe4ff0f57957b6db3",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/d35825da6d5570524234e1bfe4ff0f57957b6db3/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/d35825da6d5570524234e1bfe4ff0f57957b6db3/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/d35825da6d5570524234e1bfe4ff0f57957b6db3/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 200,
          "old_api": "SHA1_Update",
          "new_api": "strerror",
          "old_text": "SHA1_Update(&new_sha1_ctx, buf, n)",
          "new_text": "strerror(errno)",
          "old_line_content": "\t\tSHA1_Update(&new_sha1_ctx, buf, n);",
          "new_line_content": "\t\t\tdie(\"Failed to checksum %s: %s\", pack_name, strerror(errno));",
          "content_same": false
        },
        {
          "line": 210,
          "old_api": "hashcmp",
          "new_api": "SHA1_Update",
          "old_text": "hashcmp(sha1, partial_pack_sha1)",
          "new_text": "SHA1_Update(&old_sha1_ctx, buf, n)",
          "old_line_content": "\t\t\tif (hashcmp(sha1, partial_pack_sha1) != 0)",
          "new_line_content": "\t\tSHA1_Update(&old_sha1_ctx, buf, n);",
          "content_same": false
        },
        {
          "line": 223,
          "old_api": "free",
          "new_api": "SHA1_Init",
          "old_text": "free(buf)",
          "new_text": "SHA1_Init(&old_sha1_ctx)",
          "old_line_content": "\tfree(buf);",
          "new_line_content": "\t\t\tSHA1_Init(&old_sha1_ctx);",
          "content_same": false
        },
        {
          "line": 228,
          "old_api": "write_or_die",
          "new_api": "free",
          "old_text": "write_or_die(pack_fd, new_pack_sha1, 20)",
          "new_text": "free(buf)",
          "old_line_content": "\twrite_or_die(pack_fd, new_pack_sha1, 20);",
          "new_line_content": "\tfree(buf);",
          "content_same": false
        },
        {
          "line": 248,
          "old_api": "get_object_directory",
          "new_api": "read_in_full",
          "old_text": "get_object_directory()",
          "new_text": "read_in_full(ip_out, packname, 46)",
          "old_line_content": "\t\t\t get_object_directory(), packname + 5);",
          "new_line_content": "\tif (read_in_full(ip_out, packname, 46) == 46 && packname[45] == '\\n' &&",
          "content_same": false
        },
        {
          "line": 249,
          "old_api": "xstrdup",
          "new_api": "memcmp",
          "old_text": "xstrdup(path)",
          "new_text": "memcmp(packname, \"keep\\t\", 5)",
          "old_line_content": "\t\treturn xstrdup(path);",
          "new_line_content": "\t    memcmp(packname, \"keep\\t\", 5) == 0) {",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 225,
          "old_api": null,
          "new_api": "MSB",
          "old_text": null,
          "new_text": "MSB(partial_pack_offset, 1)",
          "old_line_content": "\tif (partial_pack_sha1)",
          "new_line_content": "\t\t\tpartial_pack_offset -= MSB(partial_pack_offset, 1);",
          "content_same": false
        },
        {
          "line": 196,
          "old_api": null,
          "new_api": "xread",
          "old_text": null,
          "new_text": "xread(pack_fd, buf, m)",
          "old_line_content": "\t\tif (!n)",
          "new_line_content": "\t\tn = xread(pack_fd, buf, m);",
          "content_same": false
        },
        {
          "line": 231,
          "old_api": null,
          "new_api": "SHA1_Final",
          "old_text": null,
          "new_text": "SHA1_Final(partial_pack_sha1, &old_sha1_ctx)",
          "old_line_content": "",
          "new_line_content": "\t\tSHA1_Final(partial_pack_sha1, &old_sha1_ctx);",
          "content_same": false
        },
        {
          "line": 232,
          "old_api": null,
          "new_api": "SHA1_Final",
          "old_text": null,
          "new_text": "SHA1_Final(new_pack_sha1, &new_sha1_ctx)",
          "old_line_content": "char *index_pack_lockfile(int ip_out)",
          "new_line_content": "\tSHA1_Final(new_pack_sha1, &new_sha1_ctx);",
          "content_same": false
        },
        {
          "line": 201,
          "old_api": null,
          "new_api": "SHA1_Update",
          "old_text": null,
          "new_text": "SHA1_Update(&new_sha1_ctx, buf, n)",
          "old_line_content": "",
          "new_line_content": "\t\tSHA1_Update(&new_sha1_ctx, buf, n);",
          "content_same": false
        },
        {
          "line": 233,
          "old_api": null,
          "new_api": "write_or_die",
          "old_text": null,
          "new_text": "write_or_die(pack_fd, new_pack_sha1, 20)",
          "old_line_content": "{",
          "new_line_content": "\twrite_or_die(pack_fd, new_pack_sha1, 20);",
          "content_same": false
        },
        {
          "line": 234,
          "old_api": null,
          "new_api": "fsync_or_die",
          "old_text": null,
          "new_text": "fsync_or_die(pack_fd, pack_name)",
          "old_line_content": "\tchar packname[46];",
          "new_line_content": "\tfsync_or_die(pack_fd, pack_name);",
          "content_same": false
        },
        {
          "line": 214,
          "old_api": null,
          "new_api": "SHA1_Final",
          "old_text": null,
          "new_text": "SHA1_Final(sha1, &old_sha1_ctx)",
          "old_line_content": "\t\t\t * Now let's compute the SHA1 of the remainder of the",
          "new_line_content": "\t\t\tSHA1_Final(sha1, &old_sha1_ctx);",
          "content_same": false
        },
        {
          "line": 215,
          "old_api": null,
          "new_api": "hashcmp",
          "old_text": null,
          "new_text": "hashcmp(sha1, partial_pack_sha1)",
          "old_line_content": "\t\t\t * pack, which also means making partial_pack_offset",
          "new_line_content": "\t\t\tif (hashcmp(sha1, partial_pack_sha1) != 0)",
          "content_same": false
        },
        {
          "line": 216,
          "old_api": null,
          "new_api": "die",
          "old_text": null,
          "new_text": "die(\"Unexpected checksum for %s \"\n\t\t\t\t    \"(disk corruption?)\", pack_name)",
          "old_line_content": "\t\t\t * big enough not to matter anymore.",
          "new_line_content": "\t\t\t\tdie(\"Unexpected checksum for %s \"",
          "content_same": false
        },
        {
          "line": 252,
          "old_api": null,
          "new_api": "snprintf",
          "old_text": null,
          "new_text": "snprintf(path, sizeof(path), \"%s/pack/pack-%s.keep\",\n\t\t\t get_object_directory(), packname + 5)",
          "old_line_content": "}",
          "new_line_content": "\t\tsnprintf(path, sizeof(path), \"%s/pack/pack-%s.keep\",",
          "content_same": false
        },
        {
          "line": 253,
          "old_api": null,
          "new_api": "get_object_directory",
          "old_text": null,
          "new_text": "get_object_directory()",
          "old_line_content": "",
          "new_line_content": "\t\t\t get_object_directory(), packname + 5);",
          "content_same": false
        },
        {
          "line": 254,
          "old_api": null,
          "new_api": "xstrdup",
          "old_text": null,
          "new_text": "xstrdup(path)",
          "old_line_content": "",
          "new_line_content": "\t\treturn xstrdup(path);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 226,
          "old_api": "SHA1_Final",
          "new_api": null,
          "old_text": "SHA1_Final(partial_pack_sha1, &old_sha1_ctx)",
          "new_text": null,
          "old_line_content": "\t\tSHA1_Final(partial_pack_sha1, &old_sha1_ctx);",
          "new_line_content": "\t\t}",
          "content_same": false
        },
        {
          "line": 195,
          "old_api": "xread",
          "new_api": null,
          "old_text": "xread(pack_fd, buf, m)",
          "new_text": null,
          "old_line_content": "\t\tn = xread(pack_fd, buf, m);",
          "new_line_content": "\t\t\tpartial_pack_offset : aligned_sz;",
          "content_same": false
        },
        {
          "line": 227,
          "old_api": "SHA1_Final",
          "new_api": null,
          "old_text": "SHA1_Final(new_pack_sha1, &new_sha1_ctx)",
          "new_text": null,
          "old_line_content": "\tSHA1_Final(new_pack_sha1, &new_sha1_ctx);",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 229,
          "old_api": "fsync_or_die",
          "new_api": null,
          "old_text": "fsync_or_die(pack_fd, pack_name)",
          "new_text": null,
          "old_line_content": "\tfsync_or_die(pack_fd, pack_name);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 199,
          "old_api": "strerror",
          "new_api": null,
          "old_text": "strerror(errno)",
          "new_text": null,
          "old_line_content": "\t\t\tdie(\"Failed to checksum %s: %s\", pack_name, strerror(errno));",
          "new_line_content": "\t\tif (n < 0)",
          "content_same": false
        },
        {
          "line": 205,
          "old_api": "SHA1_Update",
          "new_api": null,
          "old_text": "SHA1_Update(&old_sha1_ctx, buf, n)",
          "new_text": null,
          "old_line_content": "\t\tSHA1_Update(&old_sha1_ctx, buf, n);",
          "new_line_content": "\t\t\taligned_sz = buf_sz;",
          "content_same": false
        },
        {
          "line": 209,
          "old_api": "SHA1_Final",
          "new_api": null,
          "old_text": "SHA1_Final(sha1, &old_sha1_ctx)",
          "new_text": null,
          "old_line_content": "\t\t\tSHA1_Final(sha1, &old_sha1_ctx);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 211,
          "old_api": "die",
          "new_api": null,
          "old_text": "die(\"Unexpected checksum for %s \"\n\t\t\t\t    \"(disk corruption?)\", pack_name)",
          "new_text": null,
          "old_line_content": "\t\t\t\tdie(\"Unexpected checksum for %s \"",
          "new_line_content": "\t\tpartial_pack_offset -= n;",
          "content_same": false
        },
        {
          "line": 243,
          "old_api": "read_in_full",
          "new_api": null,
          "old_text": "read_in_full(ip_out, packname, 46)",
          "new_text": null,
          "old_line_content": "\tif (read_in_full(ip_out, packname, 46) == 46 && packname[45] == '\\n' &&",
          "new_line_content": "\t * is \"pack\\t%40s\\n\" or \"keep\\t%40s\\n\" (46 bytes) where",
          "content_same": false
        },
        {
          "line": 244,
          "old_api": "memcmp",
          "new_api": null,
          "old_text": "memcmp(packname, \"keep\\t\", 5)",
          "new_text": null,
          "old_line_content": "\t    memcmp(packname, \"keep\\t\", 5) == 0) {",
          "new_line_content": "\t * %40s is the newly created pack SHA1 name.  In the \"keep\"",
          "content_same": false
        },
        {
          "line": 247,
          "old_api": "snprintf",
          "new_api": null,
          "old_text": "snprintf(path, sizeof(path), \"%s/pack/pack-%s.keep\",\n\t\t\t get_object_directory(), packname + 5)",
          "new_text": null,
          "old_line_content": "\t\tsnprintf(path, sizeof(path), \"%s/pack/pack-%s.keep\",",
          "new_line_content": "\t */",
          "content_same": false
        },
        {
          "line": 218,
          "old_api": "SHA1_Init",
          "new_api": null,
          "old_text": "SHA1_Init(&old_sha1_ctx)",
          "new_text": null,
          "old_line_content": "\t\t\tSHA1_Init(&old_sha1_ctx);",
          "new_line_content": "\t\t\t/*",
          "content_same": false
        },
        {
          "line": 220,
          "old_api": "MSB",
          "new_api": null,
          "old_text": "MSB(partial_pack_offset, 1)",
          "new_text": null,
          "old_line_content": "\t\t\tpartial_pack_offset -= MSB(partial_pack_offset, 1);",
          "new_line_content": "\t\t\t * pack, which also means making partial_pack_offset",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 6,
      "total_additions": 13,
      "total_deletions": 13,
      "total_api_changes": 32
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 9,
        "api_related_lines": 32,
        "non_api_lines": 7,
        "non_api_line_numbers": [
          193,
          194,
          170,
          203,
          204,
          206,
          191
        ]
      }
    },
    "api_calls_before": 67,
    "api_calls_after": 67,
    "diff_info": {
      "added_lines": 8,
      "removed_lines": 3,
      "total_diff_lines": 39
    }
  }
}