{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/e4c7292353dbef39feac1c6a60c5cde9140520a6",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/e4c7292353dbef39feac1c6a60c5cde9140520a6/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/e4c7292353dbef39feac1c6a60c5cde9140520a6/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/e4c7292353dbef39feac1c6a60c5cde9140520a6/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 109,
          "old_api": "sha1_to_hex",
          "new_api": "error",
          "old_text": "sha1_to_hex(ce->sha1)",
          "new_text": "error(\"git checkout-index: unable to read sha1 file of %s (%s)\",\n\t\t\t\tpath, sha1_to_hex(ce->sha1))",
          "old_line_content": "\t\t\t\tpath, sha1_to_hex(ce->sha1));",
          "new_line_content": "\t\t\treturn error(\"git checkout-index: unable to read sha1 file of %s (%s)\",",
          "content_same": false
        },
        {
          "line": 116,
          "old_api": "strerror",
          "new_api": "error",
          "old_text": "strerror(errno)",
          "new_text": "error(\"git checkout-index: unable to create symlink %s (%s)\",\n\t\t\t\t\t     path, strerror(errno))",
          "old_line_content": "\t\t\t\t\t     path, strerror(errno));",
          "new_line_content": "\t\t\t\treturn error(\"git checkout-index: unable to create symlink %s (%s)\",",
          "content_same": false
        },
        {
          "line": 135,
          "old_api": "mkstemp",
          "new_api": "strcpy",
          "old_text": "mkstemp(path)",
          "new_text": "strcpy(path, \".merge_link_XXXXXX\")",
          "old_line_content": "\t\t\tfd = mkstemp(path);",
          "new_line_content": "\t\t\t\tstrcpy(path, \".merge_link_XXXXXX\");",
          "content_same": false
        },
        {
          "line": 144,
          "old_api": "strerror",
          "new_api": "error",
          "old_text": "strerror(errno)",
          "new_text": "error(\"git checkout-index: unable to create file %s (%s)\",\n\t\t\t\tpath, strerror(errno))",
          "old_line_content": "\t\t\t\tpath, strerror(errno));",
          "new_line_content": "\t\t\treturn error(\"git checkout-index: unable to create file %s (%s)\",",
          "content_same": false
        },
        {
          "line": 148,
          "old_api": "close",
          "new_api": "write_in_full",
          "old_text": "close(fd)",
          "new_text": "write_in_full(fd, new, size)",
          "old_line_content": "\t\tclose(fd);",
          "new_line_content": "\t\twrote = write_in_full(fd, new, size);",
          "content_same": false
        },
        {
          "line": 151,
          "old_api": "error",
          "new_api": "fstat",
          "old_text": "error(\"git checkout-index: unable to write file %s\", path)",
          "new_text": "fstat(fd, &st)",
          "old_line_content": "\t\t\treturn error(\"git checkout-index: unable to write file %s\", path);",
          "new_line_content": "\t\t\tfstat(fd, &st);",
          "content_same": false
        },
        {
          "line": 166,
          "old_api": "fill_stat_cache_info",
          "new_api": "error",
          "old_text": "fill_stat_cache_info(ce, &st)",
          "new_text": "error(\"git checkout-index: unknown file mode for %s\", path)",
          "old_line_content": "\t\tfill_stat_cache_info(ce, &st);",
          "new_line_content": "\t\treturn error(\"git checkout-index: unknown file mode for %s\", path);",
          "content_same": false
        },
        {
          "line": 184,
          "old_api": "lstat",
          "new_api": "write_entry",
          "old_text": "lstat(path, &st)",
          "new_text": "write_entry(ce, topath, state, 1)",
          "old_line_content": "\tif (!lstat(path, &st)) {",
          "new_line_content": "\t\treturn write_entry(ce, topath, state, 1);",
          "content_same": false
        },
        {
          "line": 190,
          "old_api": "fprintf",
          "new_api": "lstat",
          "old_text": "fprintf(stderr, \"git-checkout-index: %s already exists\\n\", path)",
          "new_text": "lstat(path, &st)",
          "old_line_content": "\t\t\t\tfprintf(stderr, \"git-checkout-index: %s already exists\\n\", path);",
          "new_line_content": "\tif (!lstat(path, &st)) {",
          "content_same": false
        },
        {
          "line": 206,
          "old_api": "remove_subtree",
          "new_api": "S_ISDIR",
          "old_text": "remove_subtree(path)",
          "new_text": "S_ISDIR(st.st_mode)",
          "old_line_content": "\t\t\tremove_subtree(path);",
          "new_line_content": "\t\tif (S_ISDIR(st.st_mode)) {",
          "content_same": false
        },
        {
          "line": 208,
          "old_api": "strerror",
          "new_api": "S_ISGITLINK",
          "old_text": "strerror(errno)",
          "new_text": "S_ISGITLINK(ce->ce_mode)",
          "old_line_content": "\t\t\treturn error(\"unable to unlink old '%s' (%s)\", path, strerror(errno));",
          "new_line_content": "\t\t\tif (S_ISGITLINK(ce->ce_mode))",
          "content_same": false
        },
        {
          "line": 211,
          "old_api": "create_directories",
          "new_api": "error",
          "old_text": "create_directories(path, len, state)",
          "new_text": "error(\"%s is a directory\", path)",
          "old_line_content": "\tcreate_directories(path, len, state);",
          "new_line_content": "\t\t\t\treturn error(\"%s is a directory\", path);",
          "content_same": false
        },
        {
          "line": 212,
          "old_api": "write_entry",
          "new_api": "remove_subtree",
          "old_text": "write_entry(ce, path, state, 0)",
          "new_text": "remove_subtree(path)",
          "old_line_content": "\treturn write_entry(ce, path, state, 0);",
          "new_line_content": "\t\t\tremove_subtree(path);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 133,
          "old_api": null,
          "new_api": "strcpy",
          "old_text": null,
          "new_text": "strcpy(path, \".merge_file_XXXXXX\")",
          "old_line_content": "\t\t\telse",
          "new_line_content": "\t\t\t\tstrcpy(path, \".merge_file_XXXXXX\");",
          "content_same": false
        },
        {
          "line": 136,
          "old_api": null,
          "new_api": "mkstemp",
          "old_text": null,
          "new_text": "mkstemp(path)",
          "old_line_content": "\t\t} else if (ce_mode_s_ifmt == S_IFREG) {",
          "new_line_content": "\t\t\tfd = mkstemp(path);",
          "content_same": false
        },
        {
          "line": 138,
          "old_api": null,
          "new_api": "create_file",
          "old_text": null,
          "new_text": "create_file(path, ce->ce_mode)",
          "old_line_content": "\t\t} else {",
          "new_line_content": "\t\t\tfd = create_file(path, ce->ce_mode);",
          "content_same": false
        },
        {
          "line": 140,
          "old_api": null,
          "new_api": "create_file",
          "old_text": null,
          "new_text": "create_file(path, 0666)",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\t\tfd = create_file(path, 0666);",
          "content_same": false
        },
        {
          "line": 145,
          "old_api": null,
          "new_api": "strerror",
          "old_text": null,
          "new_text": "strerror(errno)",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\t\t\tpath, strerror(errno));",
          "content_same": false
        },
        {
          "line": 154,
          "old_api": null,
          "new_api": "close",
          "old_text": null,
          "new_text": "close(fd)",
          "old_line_content": "\t\tif (to_tempfile)",
          "new_line_content": "\t\tclose(fd);",
          "content_same": false
        },
        {
          "line": 161,
          "old_api": null,
          "new_api": "error",
          "old_text": null,
          "new_text": "error(\"git checkout-index: cannot create temporary subproject %s\", path)",
          "old_line_content": "\t}",
          "new_line_content": "\t\t\treturn error(\"git checkout-index: cannot create temporary subproject %s\", path);",
          "content_same": false
        },
        {
          "line": 162,
          "old_api": null,
          "new_api": "mkdir",
          "old_text": null,
          "new_text": "mkdir(path, 0777)",
          "old_line_content": "",
          "new_line_content": "\t\tif (mkdir(path, 0777) < 0)",
          "content_same": false
        },
        {
          "line": 163,
          "old_api": null,
          "new_api": "error",
          "old_text": null,
          "new_text": "error(\"git checkout-index: cannot create subproject directory %s\", path)",
          "old_line_content": "\tif (state->refresh_cache) {",
          "new_line_content": "\t\t\treturn error(\"git checkout-index: cannot create subproject directory %s\", path);",
          "content_same": false
        },
        {
          "line": 171,
          "old_api": null,
          "new_api": "lstat",
          "old_text": null,
          "new_text": "lstat(ce->name, &st)",
          "old_line_content": "int checkout_entry(struct cache_entry *ce, const struct checkout *state, char *topath)",
          "new_line_content": "\t\t\tlstat(ce->name, &st);",
          "content_same": false
        },
        {
          "line": 172,
          "old_api": null,
          "new_api": "fill_stat_cache_info",
          "old_text": null,
          "new_text": "fill_stat_cache_info(ce, &st)",
          "old_line_content": "{",
          "new_line_content": "\t\tfill_stat_cache_info(ce, &st);",
          "content_same": false
        },
        {
          "line": 186,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(path, state->base_dir, len)",
          "old_line_content": "\t\tif (!changed)",
          "new_line_content": "\tmemcpy(path, state->base_dir, len);",
          "content_same": false
        },
        {
          "line": 187,
          "old_api": null,
          "new_api": "strcpy",
          "old_text": null,
          "new_text": "strcpy(path + len, ce->name)",
          "old_line_content": "\t\t\treturn 0;",
          "new_line_content": "\tstrcpy(path + len, ce->name);",
          "content_same": false
        },
        {
          "line": 188,
          "old_api": null,
          "new_api": "ce_namelen",
          "old_text": null,
          "new_text": "ce_namelen(ce)",
          "old_line_content": "\t\tif (!state->force) {",
          "new_line_content": "\tlen += ce_namelen(ce);",
          "content_same": false
        },
        {
          "line": 191,
          "old_api": null,
          "new_api": "ce_match_stat",
          "old_text": null,
          "new_text": "ce_match_stat(ce, &st, CE_MATCH_IGNORE_VALID)",
          "old_line_content": "\t\t\treturn -1;",
          "new_line_content": "\t\tunsigned changed = ce_match_stat(ce, &st, CE_MATCH_IGNORE_VALID);",
          "content_same": false
        },
        {
          "line": 196,
          "old_api": null,
          "new_api": "fprintf",
          "old_text": null,
          "new_text": "fprintf(stderr, \"git-checkout-index: %s already exists\\n\", path)",
          "old_line_content": "\t\t * right permissions (including umask, which is nasty",
          "new_line_content": "\t\t\t\tfprintf(stderr, \"git-checkout-index: %s already exists\\n\", path);",
          "content_same": false
        },
        {
          "line": 213,
          "old_api": null,
          "new_api": "unlink",
          "old_text": null,
          "new_text": "unlink(path)",
          "old_line_content": "}",
          "new_line_content": "\t\t} else if (unlink(path))",
          "content_same": false
        },
        {
          "line": 214,
          "old_api": null,
          "new_api": "strerror",
          "old_text": null,
          "new_text": "strerror(errno)",
          "old_line_content": "",
          "new_line_content": "\t\t\treturn error(\"unable to unlink old '%s' (%s)\", path, strerror(errno));",
          "content_same": false
        },
        {
          "line": 217,
          "old_api": null,
          "new_api": "create_directories",
          "old_text": null,
          "new_text": "create_directories(path, len, state)",
          "old_line_content": "",
          "new_line_content": "\tcreate_directories(path, len, state);",
          "content_same": false
        },
        {
          "line": 218,
          "old_api": null,
          "new_api": "write_entry",
          "old_text": null,
          "new_text": "write_entry(ce, path, state, 0)",
          "old_line_content": "",
          "new_line_content": "\treturn write_entry(ce, path, state, 0);",
          "content_same": false
        },
        {
          "line": 110,
          "old_api": null,
          "new_api": "sha1_to_hex",
          "old_text": null,
          "new_text": "sha1_to_hex(ce->sha1)",
          "old_line_content": "",
          "new_line_content": "\t\t\t\tpath, sha1_to_hex(ce->sha1));",
          "content_same": false
        },
        {
          "line": 113,
          "old_api": null,
          "new_api": "symlink",
          "old_text": null,
          "new_text": "symlink(new, path)",
          "old_line_content": "\t\t\tfree(new);",
          "new_line_content": "\t\t\tret = symlink(new, path);",
          "content_same": false
        },
        {
          "line": 117,
          "old_api": null,
          "new_api": "strerror",
          "old_text": null,
          "new_text": "strerror(errno)",
          "old_line_content": "\t\t\tbreak;",
          "new_line_content": "\t\t\t\t\t     path, strerror(errno));",
          "content_same": false
        },
        {
          "line": 125,
          "old_api": null,
          "new_api": "convert_to_working_tree",
          "old_text": null,
          "new_text": "convert_to_working_tree(ce->name, new, size, &buf)",
          "old_line_content": "\t\t\tfree(new);",
          "new_line_content": "\t\t    convert_to_working_tree(ce->name, new, size, &buf)) {",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 132,
          "old_api": "strcpy",
          "new_api": null,
          "old_text": "strcpy(path, \".merge_file_XXXXXX\")",
          "new_text": null,
          "old_line_content": "\t\t\t\tstrcpy(path, \".merge_file_XXXXXX\");",
          "new_line_content": "\t\t\tif (ce_mode_s_ifmt == S_IFREG)",
          "content_same": false
        },
        {
          "line": 134,
          "old_api": "strcpy",
          "new_api": null,
          "old_text": "strcpy(path, \".merge_link_XXXXXX\")",
          "new_text": null,
          "old_line_content": "\t\t\t\tstrcpy(path, \".merge_link_XXXXXX\");",
          "new_line_content": "\t\t\telse",
          "content_same": false
        },
        {
          "line": 137,
          "old_api": "create_file",
          "new_api": null,
          "old_text": "create_file(path, ce->ce_mode)",
          "new_text": null,
          "old_line_content": "\t\t\tfd = create_file(path, ce->ce_mode);",
          "new_line_content": "\t\t} else if (ce_mode_s_ifmt == S_IFREG) {",
          "content_same": false
        },
        {
          "line": 139,
          "old_api": "create_file",
          "new_api": null,
          "old_text": "create_file(path, 0666)",
          "new_text": null,
          "old_line_content": "\t\t\tfd = create_file(path, 0666);",
          "new_line_content": "\t\t} else {",
          "content_same": false
        },
        {
          "line": 143,
          "old_api": "error",
          "new_api": null,
          "old_text": "error(\"git checkout-index: unable to create file %s (%s)\",\n\t\t\t\tpath, strerror(errno))",
          "new_text": null,
          "old_line_content": "\t\t\treturn error(\"git checkout-index: unable to create file %s (%s)\",",
          "new_line_content": "\t\t\tfree(new);",
          "content_same": false
        },
        {
          "line": 147,
          "old_api": "write_in_full",
          "new_api": null,
          "old_text": "write_in_full(fd, new, size)",
          "new_text": null,
          "old_line_content": "\t\twrote = write_in_full(fd, new, size);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 155,
          "old_api": "error",
          "new_api": null,
          "old_text": "error(\"git checkout-index: cannot create temporary subproject %s\", path)",
          "new_text": null,
          "old_line_content": "\t\t\treturn error(\"git checkout-index: cannot create temporary subproject %s\", path);",
          "new_line_content": "\t\tfree(new);",
          "content_same": false
        },
        {
          "line": 156,
          "old_api": "mkdir",
          "new_api": null,
          "old_text": "mkdir(path, 0777)",
          "new_text": null,
          "old_line_content": "\t\tif (mkdir(path, 0777) < 0)",
          "new_line_content": "\t\tif (wrote != size)",
          "content_same": false
        },
        {
          "line": 160,
          "old_api": "error",
          "new_api": null,
          "old_text": "error(\"git checkout-index: unknown file mode for %s\", path)",
          "new_text": null,
          "old_line_content": "\t\treturn error(\"git checkout-index: unknown file mode for %s\", path);",
          "new_line_content": "\t\tif (to_tempfile)",
          "content_same": false
        },
        {
          "line": 165,
          "old_api": "lstat",
          "new_api": null,
          "old_text": "lstat(ce->name, &st)",
          "new_text": null,
          "old_line_content": "\t\tlstat(ce->name, &st);",
          "new_line_content": "\tdefault:",
          "content_same": false
        },
        {
          "line": 178,
          "old_api": "write_entry",
          "new_api": null,
          "old_text": "write_entry(ce, topath, state, 1)",
          "new_text": null,
          "old_line_content": "\t\treturn write_entry(ce, topath, state, 1);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 180,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(path, state->base_dir, len)",
          "new_text": null,
          "old_line_content": "\tmemcpy(path, state->base_dir, len);",
          "new_line_content": "\tstruct stat st;",
          "content_same": false
        },
        {
          "line": 181,
          "old_api": "strcpy",
          "new_api": null,
          "old_text": "strcpy(path + len, ce->name)",
          "new_text": null,
          "old_line_content": "\tstrcpy(path + len, ce->name);",
          "new_line_content": "\tint len = state->base_dir_len;",
          "content_same": false
        },
        {
          "line": 182,
          "old_api": "ce_namelen",
          "new_api": null,
          "old_text": "ce_namelen(ce)",
          "new_text": null,
          "old_line_content": "\tlen += ce_namelen(ce);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 185,
          "old_api": "ce_match_stat",
          "new_api": null,
          "old_text": "ce_match_stat(ce, &st, CE_MATCH_IGNORE_VALID)",
          "new_text": null,
          "old_line_content": "\t\tunsigned changed = ce_match_stat(ce, &st, CE_MATCH_IGNORE_VALID);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 200,
          "old_api": "S_ISDIR",
          "new_api": null,
          "old_text": "S_ISDIR(st.st_mode)",
          "new_text": null,
          "old_line_content": "\t\tif (S_ISDIR(st.st_mode)) {",
          "new_line_content": "\t\t/*",
          "content_same": false
        },
        {
          "line": 202,
          "old_api": "S_ISGITLINK",
          "new_api": null,
          "old_text": "S_ISGITLINK(ce->ce_mode)",
          "new_text": null,
          "old_line_content": "\t\t\tif (S_ISGITLINK(ce->ce_mode))",
          "new_line_content": "\t\t * right permissions (including umask, which is nasty",
          "content_same": false
        },
        {
          "line": 205,
          "old_api": "error",
          "new_api": null,
          "old_text": "error(\"%s is a directory\", path)",
          "new_text": null,
          "old_line_content": "\t\t\t\treturn error(\"%s is a directory\", path);",
          "new_line_content": "\t\t */",
          "content_same": false
        },
        {
          "line": 207,
          "old_api": "unlink",
          "new_api": null,
          "old_text": "unlink(path)",
          "new_text": null,
          "old_line_content": "\t\t} else if (unlink(path))",
          "new_line_content": "\t\t\t/* If it is a gitlink, leave it alone! */",
          "content_same": false
        },
        {
          "line": 108,
          "old_api": "error",
          "new_api": null,
          "old_text": "error(\"git checkout-index: unable to read sha1 file of %s (%s)\",\n\t\t\t\tpath, sha1_to_hex(ce->sha1))",
          "new_text": null,
          "old_line_content": "\t\t\treturn error(\"git checkout-index: unable to read sha1 file of %s (%s)\",",
          "new_line_content": "\t\tif (!new)",
          "content_same": false
        },
        {
          "line": 112,
          "old_api": "symlink",
          "new_api": null,
          "old_text": "symlink(new, path)",
          "new_text": null,
          "old_line_content": "\t\t\tret = symlink(new, path);",
          "new_line_content": "\t\tif (ce_mode_s_ifmt == S_IFLNK && has_symlinks && !to_tempfile) {",
          "content_same": false
        },
        {
          "line": 115,
          "old_api": "error",
          "new_api": null,
          "old_text": "error(\"git checkout-index: unable to create symlink %s (%s)\",\n\t\t\t\t\t     path, strerror(errno))",
          "new_text": null,
          "old_line_content": "\t\t\t\treturn error(\"git checkout-index: unable to create symlink %s (%s)\",",
          "new_line_content": "\t\t\tif (ret)",
          "content_same": false
        },
        {
          "line": 124,
          "old_api": "convert_to_working_tree",
          "new_api": null,
          "old_text": "convert_to_working_tree(ce->name, new, size, &buf)",
          "new_text": null,
          "old_line_content": "\t\t    convert_to_working_tree(ce->name, new, size, &buf)) {",
          "new_line_content": "\t\tif (ce_mode_s_ifmt == S_IFREG &&",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 13,
      "total_additions": 24,
      "total_deletions": 23,
      "total_api_changes": 60
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 11,
        "api_related_lines": 60,
        "non_api_lines": 8,
        "non_api_line_numbers": [
          97,
          164,
          102,
          170,
          149,
          150,
          152,
          153
        ]
      }
    },
    "api_calls_before": 67,
    "api_calls_after": 68,
    "diff_info": {
      "added_lines": 9,
      "removed_lines": 3,
      "total_diff_lines": 42
    }
  }
}