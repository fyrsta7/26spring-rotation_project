{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/010e5eacfb004218087da054a61772da8fc40463",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/010e5eacfb004218087da054a61772da8fc40463/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/010e5eacfb004218087da054a61772da8fc40463/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/010e5eacfb004218087da054a61772da8fc40463/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 487,
          "old_api": "stop_progress",
          "new_api": "push_bitmapped_commit",
          "old_text": "stop_progress(&writer.progress)",
          "new_text": "push_bitmapped_commit(chosen, reused_bitmap)",
          "old_line_content": "\tstop_progress(&writer.progress);",
          "new_line_content": "\t\tpush_bitmapped_commit(chosen, reused_bitmap);",
          "content_same": false
        },
        {
          "line": 529,
          "old_api": "hashwrite_u8",
          "new_api": "sha1_pos",
          "old_text": "hashwrite_u8(f, stored->xor_offset)",
          "new_text": "sha1_pos(stored->commit->object.oid.hash, index, index_nr, sha1_access)",
          "old_line_content": "\t\thashwrite_u8(f, stored->xor_offset);",
          "new_line_content": "\t\t\tsha1_pos(stored->commit->object.oid.hash, index, index_nr, sha1_access);",
          "content_same": false
        },
        {
          "line": 532,
          "old_api": "dump_bitmap",
          "new_api": "BUG",
          "old_text": "dump_bitmap(f, stored->write_as)",
          "new_text": "BUG(\"trying to write commit not in index\")",
          "old_line_content": "\t\tdump_bitmap(f, stored->write_as);",
          "new_line_content": "\t\t\tBUG(\"trying to write commit not in index\");",
          "content_same": false
        },
        {
          "line": 550,
          "old_api": "hashcpy",
          "new_api": "hashwrite_be32",
          "old_text": "hashcpy(writer.pack_checksum, sha1)",
          "new_text": "hashwrite_be32(f, entry->hash)",
          "old_line_content": "\thashcpy(writer.pack_checksum, sha1);",
          "new_line_content": "\t\thashwrite_be32(f, entry->hash);",
          "content_same": false
        },
        {
          "line": 571,
          "old_api": "htons",
          "new_api": "odb_mkstemp",
          "old_text": "htons(flags | options)",
          "new_text": "odb_mkstemp(&tmp_file, \"pack/tmp_bitmap_XXXXXX\")",
          "old_line_content": "\theader.options = htons(flags | options);",
          "new_line_content": "\tint fd = odb_mkstemp(&tmp_file, \"pack/tmp_bitmap_XXXXXX\");",
          "content_same": false
        },
        {
          "line": 573,
          "old_api": "hashcpy",
          "new_api": "hashfd",
          "old_text": "hashcpy(header.checksum, writer.pack_checksum)",
          "new_text": "hashfd(fd, tmp_file.buf)",
          "old_line_content": "\thashcpy(header.checksum, writer.pack_checksum);",
          "new_line_content": "\tf = hashfd(fd, tmp_file.buf);",
          "content_same": false
        },
        {
          "line": 575,
          "old_api": "hashwrite",
          "new_api": "memcpy",
          "old_text": "hashwrite(f, &header, sizeof(header) - GIT_MAX_RAWSZ + the_hash_algo->rawsz)",
          "new_text": "memcpy(header.magic, BITMAP_IDX_SIGNATURE, sizeof(BITMAP_IDX_SIGNATURE))",
          "old_line_content": "\thashwrite(f, &header, sizeof(header) - GIT_MAX_RAWSZ + the_hash_algo->rawsz);",
          "new_line_content": "\tmemcpy(header.magic, BITMAP_IDX_SIGNATURE, sizeof(BITMAP_IDX_SIGNATURE));",
          "content_same": false
        },
        {
          "line": 576,
          "old_api": "dump_bitmap",
          "new_api": "htons",
          "old_text": "dump_bitmap(f, writer.commits)",
          "new_text": "htons(default_version)",
          "old_line_content": "\tdump_bitmap(f, writer.commits);",
          "new_line_content": "\theader.version = htons(default_version);",
          "content_same": false
        },
        {
          "line": 577,
          "old_api": "dump_bitmap",
          "new_api": "htons",
          "old_text": "dump_bitmap(f, writer.trees)",
          "new_text": "htons(flags | options)",
          "old_line_content": "\tdump_bitmap(f, writer.trees);",
          "new_line_content": "\theader.options = htons(flags | options);",
          "content_same": false
        },
        {
          "line": 578,
          "old_api": "dump_bitmap",
          "new_api": "htonl",
          "old_text": "dump_bitmap(f, writer.blobs)",
          "new_text": "htonl(writer.selected_nr)",
          "old_line_content": "\tdump_bitmap(f, writer.blobs);",
          "new_line_content": "\theader.entry_count = htonl(writer.selected_nr);",
          "content_same": false
        },
        {
          "line": 579,
          "old_api": "dump_bitmap",
          "new_api": "hashcpy",
          "old_text": "dump_bitmap(f, writer.tags)",
          "new_text": "hashcpy(header.checksum, writer.pack_checksum)",
          "old_line_content": "\tdump_bitmap(f, writer.tags);",
          "new_line_content": "\thashcpy(header.checksum, writer.pack_checksum);",
          "content_same": false
        },
        {
          "line": 583,
          "old_api": "write_hash_cache",
          "new_api": "dump_bitmap",
          "old_text": "write_hash_cache(f, index, index_nr)",
          "new_text": "dump_bitmap(f, writer.trees)",
          "old_line_content": "\t\twrite_hash_cache(f, index, index_nr);",
          "new_line_content": "\tdump_bitmap(f, writer.trees);",
          "content_same": false
        },
        {
          "line": 585,
          "old_api": "finalize_hashfile",
          "new_api": "dump_bitmap",
          "old_text": "finalize_hashfile(f, NULL, CSUM_HASH_IN_STREAM | CSUM_FSYNC | CSUM_CLOSE)",
          "new_text": "dump_bitmap(f, writer.tags)",
          "old_line_content": "\tfinalize_hashfile(f, NULL, CSUM_HASH_IN_STREAM | CSUM_FSYNC | CSUM_CLOSE);",
          "new_line_content": "\tdump_bitmap(f, writer.tags);",
          "content_same": false
        },
        {
          "line": 591,
          "old_api": "die_errno",
          "new_api": "finalize_hashfile",
          "old_text": "die_errno(\"unable to rename temporary bitmap file to '%s'\", filename)",
          "new_text": "finalize_hashfile(f, NULL, CSUM_HASH_IN_STREAM | CSUM_FSYNC | CSUM_CLOSE)",
          "old_line_content": "\t\tdie_errno(\"unable to rename temporary bitmap file to '%s'\", filename);",
          "new_line_content": "\tfinalize_hashfile(f, NULL, CSUM_HASH_IN_STREAM | CSUM_FSYNC | CSUM_CLOSE);",
          "content_same": false
        },
        {
          "line": 593,
          "old_api": "strbuf_release",
          "new_api": "adjust_shared_perm",
          "old_text": "strbuf_release(&tmp_file)",
          "new_text": "adjust_shared_perm(tmp_file.buf)",
          "old_line_content": "\tstrbuf_release(&tmp_file);",
          "new_line_content": "\tif (adjust_shared_perm(tmp_file.buf))",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 534,
          "old_api": null,
          "new_api": "hashwrite_be32",
          "old_text": null,
          "new_text": "hashwrite_be32(f, commit_pos)",
          "old_line_content": "}",
          "new_line_content": "\t\thashwrite_be32(f, commit_pos);",
          "content_same": false
        },
        {
          "line": 535,
          "old_api": null,
          "new_api": "hashwrite_u8",
          "old_text": null,
          "new_text": "hashwrite_u8(f, stored->xor_offset)",
          "old_line_content": "",
          "new_line_content": "\t\thashwrite_u8(f, stored->xor_offset);",
          "content_same": false
        },
        {
          "line": 536,
          "old_api": null,
          "new_api": "hashwrite_u8",
          "old_text": null,
          "new_text": "hashwrite_u8(f, stored->flags)",
          "old_line_content": "static void write_hash_cache(struct hashfile *f,",
          "new_line_content": "\t\thashwrite_u8(f, stored->flags);",
          "content_same": false
        },
        {
          "line": 538,
          "old_api": null,
          "new_api": "dump_bitmap",
          "old_text": null,
          "new_text": "dump_bitmap(f, stored->write_as)",
          "old_line_content": "\t\t\t     uint32_t index_nr)",
          "new_line_content": "\t\tdump_bitmap(f, stored->write_as);",
          "content_same": false
        },
        {
          "line": 410,
          "old_api": null,
          "new_api": "prepare_bitmap_git",
          "old_text": null,
          "new_text": "prepare_bitmap_git(to_pack->repo)",
          "old_line_content": "\t/*",
          "new_line_content": "\tif (!(bitmap_git = prepare_bitmap_git(to_pack->repo)))",
          "content_same": false
        },
        {
          "line": 413,
          "old_api": null,
          "new_api": "kh_init_oid_map",
          "old_text": null,
          "new_text": "kh_init_oid_map()",
          "old_line_content": "\t */",
          "new_line_content": "\twriter.reused = kh_init_oid_map();",
          "content_same": false
        },
        {
          "line": 414,
          "old_api": null,
          "new_api": "rebuild_existing_bitmaps",
          "old_text": null,
          "new_text": "rebuild_existing_bitmaps(bitmap_git, to_pack, writer.reused,\n\t\t\t\t writer.show_progress)",
          "old_line_content": "}",
          "new_line_content": "\trebuild_existing_bitmaps(bitmap_git, to_pack, writer.reused,",
          "content_same": false
        },
        {
          "line": 556,
          "old_api": null,
          "new_api": "hashcpy",
          "old_text": null,
          "new_text": "hashcpy(writer.pack_checksum, sha1)",
          "old_line_content": "\t\t\t  uint16_t options)",
          "new_line_content": "\thashcpy(writer.pack_checksum, sha1);",
          "content_same": false
        },
        {
          "line": 429,
          "old_api": null,
          "new_api": "kh_get_oid_map",
          "old_text": null,
          "new_text": "kh_get_oid_map(writer.reused, *oid)",
          "old_line_content": "",
          "new_line_content": "\thash_pos = kh_get_oid_map(writer.reused, *oid);",
          "content_same": false
        },
        {
          "line": 430,
          "old_api": null,
          "new_api": "kh_end",
          "old_text": null,
          "new_text": "kh_end(writer.reused)",
          "old_line_content": "void bitmap_writer_select_commits(struct commit **indexed_commits,",
          "new_line_content": "\tif (hash_pos >= kh_end(writer.reused))",
          "content_same": false
        },
        {
          "line": 433,
          "old_api": null,
          "new_api": "kh_value",
          "old_text": null,
          "new_text": "kh_value(writer.reused, hash_pos)",
          "old_line_content": "{",
          "new_line_content": "\treturn kh_value(writer.reused, hash_pos);",
          "content_same": false
        },
        {
          "line": 442,
          "old_api": null,
          "new_api": "QSORT",
          "old_text": null,
          "new_text": "QSORT(indexed_commits, indexed_commits_nr, date_compare)",
          "old_line_content": "\t\tfor (i = 0; i < indexed_commits_nr; ++i)",
          "new_line_content": "\tQSORT(indexed_commits, indexed_commits_nr, date_compare);",
          "content_same": false
        },
        {
          "line": 445,
          "old_api": null,
          "new_api": "start_progress",
          "old_text": null,
          "new_text": "start_progress(\"Selecting bitmap commits\", 0)",
          "old_line_content": "\t}",
          "new_line_content": "\t\twriter.progress = start_progress(\"Selecting bitmap commits\", 0);",
          "content_same": false
        },
        {
          "line": 449,
          "old_api": null,
          "new_api": "push_bitmapped_commit",
          "old_text": null,
          "new_text": "push_bitmapped_commit(indexed_commits[i], NULL)",
          "old_line_content": "\t\tstruct commit *chosen = NULL;",
          "new_line_content": "\t\t\tpush_bitmapped_commit(indexed_commits[i], NULL);",
          "content_same": false
        },
        {
          "line": 581,
          "old_api": null,
          "new_api": "hashwrite",
          "old_text": null,
          "new_text": "hashwrite(f, &header, sizeof(header) - GIT_MAX_RAWSZ + the_hash_algo->rawsz)",
          "old_line_content": "",
          "new_line_content": "\thashwrite(f, &header, sizeof(header) - GIT_MAX_RAWSZ + the_hash_algo->rawsz);",
          "content_same": false
        },
        {
          "line": 582,
          "old_api": null,
          "new_api": "dump_bitmap",
          "old_text": null,
          "new_text": "dump_bitmap(f, writer.commits)",
          "old_line_content": "\tif (options & BITMAP_OPT_HASH_CACHE)",
          "new_line_content": "\tdump_bitmap(f, writer.commits);",
          "content_same": false
        },
        {
          "line": 584,
          "old_api": null,
          "new_api": "dump_bitmap",
          "old_text": null,
          "new_text": "dump_bitmap(f, writer.blobs)",
          "old_line_content": "",
          "new_line_content": "\tdump_bitmap(f, writer.blobs);",
          "content_same": false
        },
        {
          "line": 457,
          "old_api": null,
          "new_api": "next_commit_index",
          "old_text": null,
          "new_text": "next_commit_index(i)",
          "old_line_content": "\t\t\twriter.selected_nr = max_bitmaps;",
          "new_line_content": "\t\tnext = next_commit_index(i);",
          "content_same": false
        },
        {
          "line": 586,
          "old_api": null,
          "new_api": "write_selected_commits_v1",
          "old_text": null,
          "new_text": "write_selected_commits_v1(f, index, index_nr)",
          "old_line_content": "",
          "new_line_content": "\twrite_selected_commits_v1(f, index, index_nr);",
          "content_same": false
        },
        {
          "line": 589,
          "old_api": null,
          "new_api": "write_hash_cache",
          "old_text": null,
          "new_text": "write_hash_cache(f, index, index_nr)",
          "old_line_content": "",
          "new_line_content": "\t\twrite_hash_cache(f, index, index_nr);",
          "content_same": false
        },
        {
          "line": 594,
          "old_api": null,
          "new_api": "die_errno",
          "old_text": null,
          "new_text": "die_errno(\"unable to make temporary bitmap file readable\")",
          "old_line_content": "}",
          "new_line_content": "\t\tdie_errno(\"unable to make temporary bitmap file readable\");",
          "content_same": false
        },
        {
          "line": 338,
          "old_api": null,
          "new_api": "fill_bitmap_commit",
          "old_text": null,
          "new_text": "fill_bitmap_commit(ent, commit)",
          "old_line_content": "",
          "new_line_content": "\t\tfill_bitmap_commit(ent, commit);",
          "content_same": false
        },
        {
          "line": 596,
          "old_api": null,
          "new_api": "rename",
          "old_text": null,
          "new_text": "rename(tmp_file.buf, filename)",
          "old_line_content": "",
          "new_line_content": "\tif (rename(tmp_file.buf, filename))",
          "content_same": false
        },
        {
          "line": 597,
          "old_api": null,
          "new_api": "die_errno",
          "old_text": null,
          "new_text": "die_errno(\"unable to rename temporary bitmap file to '%s'\", filename)",
          "old_line_content": "",
          "new_line_content": "\t\tdie_errno(\"unable to rename temporary bitmap file to '%s'\", filename);",
          "content_same": false
        },
        {
          "line": 341,
          "old_api": null,
          "new_api": "store_selected",
          "old_text": null,
          "new_text": "store_selected(ent, commit)",
          "old_line_content": "\t\t\tnr_stored++;",
          "new_line_content": "\t\t\tstore_selected(ent, commit);",
          "content_same": false
        },
        {
          "line": 599,
          "old_api": null,
          "new_api": "strbuf_release",
          "old_text": null,
          "new_text": "strbuf_release(&tmp_file)",
          "old_line_content": "",
          "new_line_content": "\tstrbuf_release(&tmp_file);",
          "content_same": false
        },
        {
          "line": 343,
          "old_api": null,
          "new_api": "display_progress",
          "old_text": null,
          "new_text": "display_progress(writer.progress, nr_stored)",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\t\tdisplay_progress(writer.progress, nr_stored);",
          "content_same": false
        },
        {
          "line": 469,
          "old_api": null,
          "new_api": "find_reused_bitmap",
          "old_text": null,
          "new_text": "find_reused_bitmap(&chosen->object.oid)",
          "old_line_content": "",
          "new_line_content": "\t\t\treused_bitmap = find_reused_bitmap(&chosen->object.oid);",
          "content_same": false
        },
        {
          "line": 346,
          "old_api": null,
          "new_api": "pop_commit",
          "old_text": null,
          "new_text": "pop_commit(&ent->children)",
          "old_line_content": "\t\t\tstruct bb_commit *child_ent =",
          "new_line_content": "\t\twhile ((child = pop_commit(&ent->children))) {",
          "content_same": false
        },
        {
          "line": 348,
          "old_api": null,
          "new_api": "bb_data_at",
          "old_text": null,
          "new_text": "bb_data_at(&bb.data, child)",
          "old_line_content": "",
          "new_line_content": "\t\t\t\tbb_data_at(&bb.data, child);",
          "content_same": false
        },
        {
          "line": 476,
          "old_api": null,
          "new_api": "find_reused_bitmap",
          "old_text": null,
          "new_text": "find_reused_bitmap(&cm->object.oid)",
          "old_line_content": "\t\t\t\tif (cm->parents && cm->parents->next)",
          "new_line_content": "\t\t\t\treused_bitmap = find_reused_bitmap(&cm->object.oid);",
          "content_same": false
        },
        {
          "line": 351,
          "old_api": null,
          "new_api": "bitmap_or",
          "old_text": null,
          "new_text": "bitmap_or(child_ent->bitmap, ent->bitmap)",
          "old_line_content": "\t\t\telse",
          "new_line_content": "\t\t\t\tbitmap_or(child_ent->bitmap, ent->bitmap);",
          "content_same": false
        },
        {
          "line": 353,
          "old_api": null,
          "new_api": "bitmap_dup",
          "old_text": null,
          "new_text": "bitmap_dup(ent->bitmap)",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\t\t\tchild_ent->bitmap = bitmap_dup(ent->bitmap);",
          "content_same": false
        },
        {
          "line": 360,
          "old_api": null,
          "new_api": "bitmap_free",
          "old_text": null,
          "new_text": "bitmap_free(ent->bitmap)",
          "old_line_content": "\t\t\t    the_repository);",
          "new_line_content": "\t\t\tbitmap_free(ent->bitmap);",
          "content_same": false
        },
        {
          "line": 490,
          "old_api": null,
          "new_api": "display_progress",
          "old_text": null,
          "new_text": "display_progress(writer.progress, i)",
          "old_line_content": "",
          "new_line_content": "\t\tdisplay_progress(writer.progress, i);",
          "content_same": false
        },
        {
          "line": 363,
          "old_api": null,
          "new_api": "bitmap_builder_clear",
          "old_text": null,
          "new_text": "bitmap_builder_clear(&bb)",
          "old_line_content": "",
          "new_line_content": "\tbitmap_builder_clear(&bb);",
          "content_same": false
        },
        {
          "line": 365,
          "old_api": null,
          "new_api": "trace2_region_leave",
          "old_text": null,
          "new_text": "trace2_region_leave(\"pack-bitmap-write\", \"building_bitmaps_total\",\n\t\t\t    the_repository)",
          "old_line_content": "}",
          "new_line_content": "\ttrace2_region_leave(\"pack-bitmap-write\", \"building_bitmaps_total\",",
          "content_same": false
        },
        {
          "line": 493,
          "old_api": null,
          "new_api": "stop_progress",
          "old_text": null,
          "new_text": "stop_progress(&writer.progress)",
          "old_line_content": "\t/* hashwrite will die on error */",
          "new_line_content": "\tstop_progress(&writer.progress);",
          "content_same": false
        },
        {
          "line": 368,
          "old_api": null,
          "new_api": "stop_progress",
          "old_text": null,
          "new_text": "stop_progress(&writer.progress)",
          "old_line_content": " * Select the commits that will be bitmapped",
          "new_line_content": "\tstop_progress(&writer.progress);",
          "content_same": false
        },
        {
          "line": 370,
          "old_api": null,
          "new_api": "compute_xor_offsets",
          "old_text": null,
          "new_text": "compute_xor_offsets()",
          "old_line_content": "static inline unsigned int next_commit_index(unsigned int idx)",
          "new_line_content": "\tcompute_xor_offsets();",
          "content_same": false
        },
        {
          "line": 500,
          "old_api": null,
          "new_api": "hashwrite",
          "old_text": null,
          "new_text": "hashwrite(f, buf, len)",
          "old_line_content": " */",
          "new_line_content": "\thashwrite(f, buf, len);",
          "content_same": false
        },
        {
          "line": 509,
          "old_api": null,
          "new_api": "ewah_serialize_to",
          "old_text": null,
          "new_text": "ewah_serialize_to(bitmap, hashwrite_ewah_helper, f)",
          "old_line_content": "\tstruct pack_idx_entry **index = table;",
          "new_line_content": "\tif (ewah_serialize_to(bitmap, hashwrite_ewah_helper, f) < 0)",
          "content_same": false
        },
        {
          "line": 510,
          "old_api": null,
          "new_api": "die",
          "old_text": null,
          "new_text": "die(\"Failed to write bitmap index\")",
          "old_line_content": "\treturn index[pos]->oid.hash;",
          "new_line_content": "\t\tdie(\"Failed to write bitmap index\");",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 523,
          "old_api": "sha1_pos",
          "new_api": null,
          "old_text": "sha1_pos(stored->commit->object.oid.hash, index, index_nr, sha1_access)",
          "new_text": null,
          "old_line_content": "\t\t\tsha1_pos(stored->commit->object.oid.hash, index, index_nr, sha1_access);",
          "new_line_content": "\tint i;",
          "content_same": false
        },
        {
          "line": 526,
          "old_api": "BUG",
          "new_api": null,
          "old_text": "BUG(\"trying to write commit not in index\")",
          "new_text": null,
          "old_line_content": "\t\t\tBUG(\"trying to write commit not in index\");",
          "new_line_content": "\t\tstruct bitmapped_commit *stored = &writer.selected[i];",
          "content_same": false
        },
        {
          "line": 528,
          "old_api": "hashwrite_be32",
          "new_api": null,
          "old_text": "hashwrite_be32(f, commit_pos)",
          "new_text": null,
          "old_line_content": "\t\thashwrite_be32(f, commit_pos);",
          "new_line_content": "\t\tint commit_pos =",
          "content_same": false
        },
        {
          "line": 530,
          "old_api": "hashwrite_u8",
          "new_api": null,
          "old_text": "hashwrite_u8(f, stored->flags)",
          "new_text": null,
          "old_line_content": "\t\thashwrite_u8(f, stored->flags);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 404,
          "old_api": "prepare_bitmap_git",
          "new_api": null,
          "old_text": "prepare_bitmap_git(to_pack->repo)",
          "new_text": null,
          "old_line_content": "\tif (!(bitmap_git = prepare_bitmap_git(to_pack->repo)))",
          "new_line_content": "\treturn (long)b->date - (long)a->date;",
          "content_same": false
        },
        {
          "line": 407,
          "old_api": "kh_init_oid_map",
          "new_api": null,
          "old_text": "kh_init_oid_map()",
          "new_text": null,
          "old_line_content": "\twriter.reused = kh_init_oid_map();",
          "new_line_content": "void bitmap_writer_reuse_bitmaps(struct packing_data *to_pack)",
          "content_same": false
        },
        {
          "line": 408,
          "old_api": "rebuild_existing_bitmaps",
          "new_api": null,
          "old_text": "rebuild_existing_bitmaps(bitmap_git, to_pack, writer.reused,\n\t\t\t\t writer.show_progress)",
          "new_text": null,
          "old_line_content": "\trebuild_existing_bitmaps(bitmap_git, to_pack, writer.reused,",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 544,
          "old_api": "hashwrite_be32",
          "new_api": null,
          "old_text": "hashwrite_be32(f, entry->hash)",
          "new_text": null,
          "old_line_content": "\t\thashwrite_be32(f, entry->hash);",
          "new_line_content": "\t\t\t     uint32_t index_nr)",
          "content_same": false
        },
        {
          "line": 423,
          "old_api": "kh_get_oid_map",
          "new_api": null,
          "old_text": "kh_get_oid_map(writer.reused, *oid)",
          "new_text": null,
          "old_line_content": "\thash_pos = kh_get_oid_map(writer.reused, *oid);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 424,
          "old_api": "kh_end",
          "new_api": null,
          "old_text": "kh_end(writer.reused)",
          "new_text": null,
          "old_line_content": "\tif (hash_pos >= kh_end(writer.reused))",
          "new_line_content": "\tkhiter_t hash_pos;",
          "content_same": false
        },
        {
          "line": 427,
          "old_api": "kh_value",
          "new_api": null,
          "old_text": "kh_value(writer.reused, hash_pos)",
          "new_text": null,
          "old_line_content": "\treturn kh_value(writer.reused, hash_pos);",
          "new_line_content": "\t\treturn NULL;",
          "content_same": false
        },
        {
          "line": 436,
          "old_api": "QSORT",
          "new_api": null,
          "old_text": "QSORT(indexed_commits, indexed_commits_nr, date_compare)",
          "new_text": null,
          "old_line_content": "\tQSORT(indexed_commits, indexed_commits_nr, date_compare);",
          "new_line_content": "void bitmap_writer_select_commits(struct commit **indexed_commits,",
          "content_same": false
        },
        {
          "line": 565,
          "old_api": "odb_mkstemp",
          "new_api": null,
          "old_text": "odb_mkstemp(&tmp_file, \"pack/tmp_bitmap_XXXXXX\")",
          "new_text": null,
          "old_line_content": "\tint fd = odb_mkstemp(&tmp_file, \"pack/tmp_bitmap_XXXXXX\");",
          "new_line_content": "\tstatic uint16_t flags = BITMAP_OPT_FULL_DAG;",
          "content_same": false
        },
        {
          "line": 567,
          "old_api": "hashfd",
          "new_api": null,
          "old_text": "hashfd(fd, tmp_file.buf)",
          "new_text": null,
          "old_line_content": "\tf = hashfd(fd, tmp_file.buf);",
          "new_line_content": "\tstruct hashfile *f;",
          "content_same": false
        },
        {
          "line": 439,
          "old_api": "start_progress",
          "new_api": null,
          "old_text": "start_progress(\"Selecting bitmap commits\", 0)",
          "new_text": null,
          "old_line_content": "\t\twriter.progress = start_progress(\"Selecting bitmap commits\", 0);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 569,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(header.magic, BITMAP_IDX_SIGNATURE, sizeof(BITMAP_IDX_SIGNATURE))",
          "new_text": null,
          "old_line_content": "\tmemcpy(header.magic, BITMAP_IDX_SIGNATURE, sizeof(BITMAP_IDX_SIGNATURE));",
          "new_line_content": "\tstruct bitmap_disk_header header;",
          "content_same": false
        },
        {
          "line": 570,
          "old_api": "htons",
          "new_api": null,
          "old_text": "htons(default_version)",
          "new_text": null,
          "old_line_content": "\theader.version = htons(default_version);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 443,
          "old_api": "push_bitmapped_commit",
          "new_api": null,
          "old_text": "push_bitmapped_commit(indexed_commits[i], NULL)",
          "new_text": null,
          "old_line_content": "\t\t\tpush_bitmapped_commit(indexed_commits[i], NULL);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 572,
          "old_api": "htonl",
          "new_api": null,
          "old_text": "htonl(writer.selected_nr)",
          "new_text": null,
          "old_line_content": "\theader.entry_count = htonl(writer.selected_nr);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 451,
          "old_api": "next_commit_index",
          "new_api": null,
          "old_text": "next_commit_index(i)",
          "new_text": null,
          "old_line_content": "\t\tnext = next_commit_index(i);",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 580,
          "old_api": "write_selected_commits_v1",
          "new_api": null,
          "old_text": "write_selected_commits_v1(f, index, index_nr)",
          "new_text": null,
          "old_line_content": "\twrite_selected_commits_v1(f, index, index_nr);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 587,
          "old_api": "adjust_shared_perm",
          "new_api": null,
          "old_text": "adjust_shared_perm(tmp_file.buf)",
          "new_text": null,
          "old_line_content": "\tif (adjust_shared_perm(tmp_file.buf))",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 588,
          "old_api": "die_errno",
          "new_api": null,
          "old_text": "die_errno(\"unable to make temporary bitmap file readable\")",
          "new_text": null,
          "old_line_content": "\t\tdie_errno(\"unable to make temporary bitmap file readable\");",
          "new_line_content": "\tif (options & BITMAP_OPT_HASH_CACHE)",
          "content_same": false
        },
        {
          "line": 590,
          "old_api": "rename",
          "new_api": null,
          "old_text": "rename(tmp_file.buf, filename)",
          "new_text": null,
          "old_line_content": "\tif (rename(tmp_file.buf, filename))",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 463,
          "old_api": "find_reused_bitmap",
          "new_api": null,
          "old_text": "find_reused_bitmap(&chosen->object.oid)",
          "new_text": null,
          "old_line_content": "\t\t\treused_bitmap = find_reused_bitmap(&chosen->object.oid);",
          "new_line_content": "\t\t\twriter.selected_nr = max_bitmaps;",
          "content_same": false
        },
        {
          "line": 337,
          "old_api": "fill_bitmap_commit",
          "new_api": null,
          "old_text": "fill_bitmap_commit(ent, commit)",
          "new_text": null,
          "old_line_content": "\t\tfill_bitmap_commit(ent, commit);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 340,
          "old_api": "store_selected",
          "new_api": null,
          "old_text": "store_selected(ent, commit)",
          "new_text": null,
          "old_line_content": "\t\t\tstore_selected(ent, commit);",
          "new_line_content": "\t\tif (ent->selected) {",
          "content_same": false
        },
        {
          "line": 342,
          "old_api": "display_progress",
          "new_api": null,
          "old_text": "display_progress(writer.progress, nr_stored)",
          "new_text": null,
          "old_line_content": "\t\t\tdisplay_progress(writer.progress, nr_stored);",
          "new_line_content": "\t\t\tnr_stored++;",
          "content_same": false
        },
        {
          "line": 470,
          "old_api": "find_reused_bitmap",
          "new_api": null,
          "old_text": "find_reused_bitmap(&cm->object.oid)",
          "new_text": null,
          "old_line_content": "\t\t\t\treused_bitmap = find_reused_bitmap(&cm->object.oid);",
          "new_line_content": "\t\t} else {",
          "content_same": false
        },
        {
          "line": 345,
          "old_api": "pop_commit",
          "new_api": null,
          "old_text": "pop_commit(&ent->children)",
          "new_text": null,
          "old_line_content": "\t\twhile ((child = pop_commit(&ent->children))) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 347,
          "old_api": "bb_data_at",
          "new_api": null,
          "old_text": "bb_data_at(&bb.data, child)",
          "new_text": null,
          "old_line_content": "\t\t\t\tbb_data_at(&bb.data, child);",
          "new_line_content": "\t\t\tstruct bb_commit *child_ent =",
          "content_same": false
        },
        {
          "line": 350,
          "old_api": "bitmap_or",
          "new_api": null,
          "old_text": "bitmap_or(child_ent->bitmap, ent->bitmap)",
          "new_text": null,
          "old_line_content": "\t\t\t\tbitmap_or(child_ent->bitmap, ent->bitmap);",
          "new_line_content": "\t\t\tif (child_ent->bitmap)",
          "content_same": false
        },
        {
          "line": 352,
          "old_api": "bitmap_dup",
          "new_api": null,
          "old_text": "bitmap_dup(ent->bitmap)",
          "new_text": null,
          "old_line_content": "\t\t\t\tchild_ent->bitmap = bitmap_dup(ent->bitmap);",
          "new_line_content": "\t\t\telse if (reused)",
          "content_same": false
        },
        {
          "line": 481,
          "old_api": "push_bitmapped_commit",
          "new_api": null,
          "old_text": "push_bitmapped_commit(chosen, reused_bitmap)",
          "new_text": null,
          "old_line_content": "\t\tpush_bitmapped_commit(chosen, reused_bitmap);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 354,
          "old_api": "bitmap_free",
          "new_api": null,
          "old_text": "bitmap_free(ent->bitmap)",
          "new_text": null,
          "old_line_content": "\t\tbitmap_free(ent->bitmap);",
          "new_line_content": "\t\t\telse {",
          "content_same": false
        },
        {
          "line": 484,
          "old_api": "display_progress",
          "new_api": null,
          "old_text": "display_progress(writer.progress, i)",
          "new_text": null,
          "old_line_content": "\t\tdisplay_progress(writer.progress, i);",
          "new_line_content": "\t\t\t}",
          "content_same": false
        },
        {
          "line": 357,
          "old_api": "bitmap_builder_clear",
          "new_api": null,
          "old_text": "bitmap_builder_clear(&bb)",
          "new_text": null,
          "old_line_content": "\tbitmap_builder_clear(&bb);",
          "new_line_content": "\t\t\t}",
          "content_same": false
        },
        {
          "line": 359,
          "old_api": "trace2_region_leave",
          "new_api": null,
          "old_text": "trace2_region_leave(\"pack-bitmap-write\", \"building_bitmaps_total\",\n\t\t\t    the_repository)",
          "new_text": null,
          "old_line_content": "\ttrace2_region_leave(\"pack-bitmap-write\", \"building_bitmaps_total\",",
          "new_line_content": "\t\tif (!reused)",
          "content_same": false
        },
        {
          "line": 362,
          "old_api": "stop_progress",
          "new_api": null,
          "old_text": "stop_progress(&writer.progress)",
          "new_text": null,
          "old_line_content": "\tstop_progress(&writer.progress);",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 364,
          "old_api": "compute_xor_offsets",
          "new_api": null,
          "old_text": "compute_xor_offsets()",
          "new_text": null,
          "old_line_content": "\tcompute_xor_offsets();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 494,
          "old_api": "hashwrite",
          "new_api": null,
          "old_text": "hashwrite(f, buf, len)",
          "new_text": null,
          "old_line_content": "\thashwrite(f, buf, len);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 503,
          "old_api": "ewah_serialize_to",
          "new_api": null,
          "old_text": "ewah_serialize_to(bitmap, hashwrite_ewah_helper, f)",
          "new_text": null,
          "old_line_content": "\tif (ewah_serialize_to(bitmap, hashwrite_ewah_helper, f) < 0)",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 504,
          "old_api": "die",
          "new_api": null,
          "old_text": "die(\"Failed to write bitmap index\")",
          "new_text": null,
          "old_line_content": "\t\tdie(\"Failed to write bitmap index\");",
          "new_line_content": "/**",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 15,
      "total_additions": 43,
      "total_deletions": 43,
      "total_api_changes": 101
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 9,
        "api_related_lines": 101,
        "non_api_lines": 3,
        "non_api_line_numbers": [
          336,
          355,
          356
        ]
      }
    },
    "api_calls_before": 128,
    "api_calls_after": 128,
    "diff_info": {
      "added_lines": 8,
      "removed_lines": 2,
      "total_diff_lines": 31
    }
  }
}