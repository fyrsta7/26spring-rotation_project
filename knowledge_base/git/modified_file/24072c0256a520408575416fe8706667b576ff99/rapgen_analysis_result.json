{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/24072c0256a520408575416fe8706667b576ff99",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/24072c0256a520408575416fe8706667b576ff99/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/24072c0256a520408575416fe8706667b576ff99/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/24072c0256a520408575416fe8706667b576ff99/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 708,
          "old_api": "should_lookahead",
          "new_api": "userdiff_find_by_path",
          "old_text": "should_lookahead(opt)",
          "new_text": "userdiff_find_by_path(name)",
          "old_line_content": "\ttry_lookahead = should_lookahead(opt);",
          "new_line_content": "\t\tstruct userdiff_driver *drv = userdiff_find_by_path(name);",
          "content_same": false
        },
        {
          "line": 735,
          "old_api": "match_line",
          "new_api": "end_of_line",
          "old_text": "match_line(opt, bol, eol, ctx, collect_hits)",
          "new_text": "end_of_line(bol, &left)",
          "old_line_content": "\t\thit = match_line(opt, bol, eol, ctx, collect_hits);",
          "new_line_content": "\t\teol = end_of_line(bol, &left);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 768,
          "old_api": null,
          "new_api": "show_name",
          "old_text": null,
          "new_text": "show_name(opt, name)",
          "old_line_content": "\t\t\t * deserves to get that ;-).",
          "new_line_content": "\t\t\t\tshow_name(opt, name);",
          "content_same": false
        },
        {
          "line": 647,
          "old_api": null,
          "new_api": "regexec",
          "old_text": null,
          "new_text": "regexec(&p->regexp, bol, 1, &m, REG_STARTEND)",
          "old_line_content": "\t\tif (earliest < 0 || m.rm_so < earliest)",
          "new_line_content": "\t\t\thit = !regexec(&p->regexp, bol, 1, &m, REG_STARTEND);",
          "content_same": false
        },
        {
          "line": 649,
          "old_api": null,
          "new_api": "regexec",
          "old_text": null,
          "new_text": "regexec(&p->regexp, bol, 1, &m, 0)",
          "old_line_content": "\t}",
          "new_line_content": "\t\t\thit = !regexec(&p->regexp, bol, 1, &m, 0);",
          "content_same": false
        },
        {
          "line": 778,
          "old_api": null,
          "new_api": "show_pre_context",
          "old_text": null,
          "new_text": "show_pre_context(opt, name, buf, bol, lno)",
          "old_line_content": "\t\telse if (last_hit &&",
          "new_line_content": "\t\t\t\tshow_pre_context(opt, name, buf, bol, lno);",
          "content_same": false
        },
        {
          "line": 780,
          "old_api": null,
          "new_api": "show_funcname_line",
          "old_text": null,
          "new_text": "show_funcname_line(opt, name, buf, bol, lno)",
          "old_line_content": "\t\t\t/* If the last hit is within the post context,",
          "new_line_content": "\t\t\t\tshow_funcname_line(opt, name, buf, bol, lno);",
          "content_same": false
        },
        {
          "line": 782,
          "old_api": null,
          "new_api": "show_line",
          "old_text": null,
          "new_text": "show_line(opt, bol, eol, name, lno, ':')",
          "old_line_content": "\t\t\t */",
          "new_line_content": "\t\t\t\tshow_line(opt, bol, eol, name, lno, ':');",
          "content_same": false
        },
        {
          "line": 790,
          "old_api": null,
          "new_api": "show_line",
          "old_text": null,
          "new_text": "show_line(opt, bol, eol, name, lno, '-')",
          "old_line_content": "\t\tleft--;",
          "new_line_content": "\t\t\tshow_line(opt, bol, eol, name, lno, '-');",
          "content_same": false
        },
        {
          "line": 808,
          "old_api": null,
          "new_api": "show_name",
          "old_text": null,
          "new_text": "show_name(opt, name)",
          "old_line_content": "\t/* NEEDSWORK:",
          "new_line_content": "\t\tshow_name(opt, name);",
          "content_same": false
        },
        {
          "line": 812,
          "old_api": null,
          "new_api": "xdiff_clear_find_func",
          "old_text": null,
          "new_text": "xdiff_clear_find_func(&xecfg)",
          "old_line_content": "\t */",
          "new_line_content": "\txdiff_clear_find_func(&xecfg);",
          "content_same": false
        },
        {
          "line": 692,
          "old_api": null,
          "new_api": "buffer_is_binary",
          "old_text": null,
          "new_text": "buffer_is_binary(buf, size)",
          "old_line_content": "\t\t\tbreak;",
          "new_line_content": "\tif (buffer_is_binary(buf, size)) {",
          "content_same": false
        },
        {
          "line": 821,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\"%s%c%u\\n\", name,\n\t\t       opt->null_following_name ? '\\0' : ':', count)",
          "old_line_content": "\t/* All-hit markers are meaningful only at the very top level",
          "new_line_content": "\t\tprintf(\"%s%c%u\\n\", name,",
          "content_same": false
        },
        {
          "line": 705,
          "old_api": null,
          "new_api": "memset",
          "old_text": null,
          "new_text": "memset(&xecfg, 0, sizeof(xecfg))",
          "old_line_content": "\t\t\topt->priv = &xecfg;",
          "new_line_content": "\tmemset(&xecfg, 0, sizeof(xecfg));",
          "content_same": false
        },
        {
          "line": 711,
          "old_api": null,
          "new_api": "xdiff_set_find_func",
          "old_text": null,
          "new_text": "xdiff_set_find_func(&xecfg, pe->pattern, pe->cflags)",
          "old_line_content": "\t\tchar *eol, ch;",
          "new_line_content": "\t\t\txdiff_set_find_func(&xecfg, pe->pattern, pe->cflags);",
          "content_same": false
        },
        {
          "line": 715,
          "old_api": null,
          "new_api": "should_lookahead",
          "old_text": null,
          "new_text": "should_lookahead(opt)",
          "old_line_content": "\t\t * look_ahead() skips quicly to the line that possibly",
          "new_line_content": "\ttry_lookahead = should_lookahead(opt);",
          "content_same": false
        },
        {
          "line": 859,
          "old_api": null,
          "new_api": "grep_buffer_1",
          "old_text": null,
          "new_text": "grep_buffer_1(opt, name, buf, size, 0)",
          "old_line_content": "",
          "new_line_content": "\t\treturn grep_buffer_1(opt, name, buf, size, 0);",
          "content_same": false
        },
        {
          "line": 733,
          "old_api": null,
          "new_api": "look_ahead",
          "old_text": null,
          "new_text": "look_ahead(opt, &left, &lno, &bol)",
          "old_line_content": "\t\t\tctx = GREP_CONTEXT_BODY;",
          "new_line_content": "\t\t    && look_ahead(opt, &left, &lno, &bol))",
          "content_same": false
        },
        {
          "line": 864,
          "old_api": null,
          "new_api": "clr_hit_marker",
          "old_text": null,
          "new_text": "clr_hit_marker(opt->pattern_expression)",
          "old_line_content": "}",
          "new_line_content": "\tclr_hit_marker(opt->pattern_expression);",
          "content_same": false
        },
        {
          "line": 865,
          "old_api": null,
          "new_api": "grep_buffer_1",
          "old_text": null,
          "new_text": "grep_buffer_1(opt, name, buf, size, 1)",
          "old_line_content": "",
          "new_line_content": "\tgrep_buffer_1(opt, name, buf, size, 1);",
          "content_same": false
        },
        {
          "line": 867,
          "old_api": null,
          "new_api": "chk_hit_marker",
          "old_text": null,
          "new_text": "chk_hit_marker(opt->pattern_expression)",
          "old_line_content": "",
          "new_line_content": "\tif (!chk_hit_marker(opt->pattern_expression))",
          "content_same": false
        },
        {
          "line": 742,
          "old_api": null,
          "new_api": "match_line",
          "old_text": null,
          "new_text": "match_line(opt, bol, eol, ctx, collect_hits)",
          "old_line_content": "\t\t * that do not have either, so inversion should",
          "new_line_content": "\t\thit = match_line(opt, bol, eol, ctx, collect_hits);",
          "content_same": false
        },
        {
          "line": 870,
          "old_api": null,
          "new_api": "grep_buffer_1",
          "old_text": null,
          "new_text": "grep_buffer_1(opt, name, buf, size, 0)",
          "old_line_content": "",
          "new_line_content": "\treturn grep_buffer_1(opt, name, buf, size, 0);",
          "content_same": false
        },
        {
          "line": 764,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\"Binary file %s matches\\n\", name)",
          "old_line_content": "\t\t\t/* Hit at this line.  If we haven't shown the",
          "new_line_content": "\t\t\t\tprintf(\"Binary file %s matches\\n\", name);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 771,
          "old_api": "show_pre_context",
          "new_api": null,
          "old_text": "show_pre_context(opt, name, buf, bol, lno)",
          "new_text": null,
          "old_line_content": "\t\t\t\tshow_pre_context(opt, name, buf, bol, lno);",
          "new_line_content": "\t\t\t/* Hit at this line.  If we haven't shown the",
          "content_same": false
        },
        {
          "line": 644,
          "old_api": "regexec",
          "new_api": null,
          "old_text": "regexec(&p->regexp, bol, 1, &m, 0)",
          "new_text": null,
          "old_line_content": "\t\t\thit = !regexec(&p->regexp, bol, 1, &m, 0);",
          "new_line_content": "#ifdef REG_STARTEND",
          "content_same": false
        },
        {
          "line": 773,
          "old_api": "show_funcname_line",
          "new_api": null,
          "old_text": "show_funcname_line(opt, name, buf, bol, lno)",
          "new_text": null,
          "old_line_content": "\t\t\t\tshow_funcname_line(opt, name, buf, bol, lno);",
          "new_line_content": "\t\t\t * When asked to do \"count\", this still show",
          "content_same": false
        },
        {
          "line": 775,
          "old_api": "show_line",
          "new_api": null,
          "old_text": "show_line(opt, bol, eol, name, lno, ':')",
          "new_text": null,
          "old_line_content": "\t\t\t\tshow_line(opt, bol, eol, name, lno, ':');",
          "new_line_content": "\t\t\t * deserves to get that ;-).",
          "content_same": false
        },
        {
          "line": 783,
          "old_api": "show_line",
          "new_api": null,
          "old_text": "show_line(opt, bol, eol, name, lno, '-')",
          "new_text": null,
          "old_line_content": "\t\t\tshow_line(opt, bol, eol, name, lno, '-');",
          "new_line_content": "\t\t\tlast_hit = lno;",
          "content_same": false
        },
        {
          "line": 801,
          "old_api": "show_name",
          "new_api": null,
          "old_text": "show_name(opt, name)",
          "new_text": null,
          "old_line_content": "\t\tshow_name(opt, name);",
          "new_line_content": "\tif (collect_hits)",
          "content_same": false
        },
        {
          "line": 805,
          "old_api": "xdiff_clear_find_func",
          "new_api": null,
          "old_text": "xdiff_clear_find_func(&xecfg)",
          "new_text": null,
          "old_line_content": "\txdiff_clear_find_func(&xecfg);",
          "new_line_content": "\t\treturn 0;",
          "content_same": false
        },
        {
          "line": 685,
          "old_api": "buffer_is_binary",
          "new_api": null,
          "old_text": "buffer_is_binary(buf, size)",
          "new_text": null,
          "old_line_content": "\tif (buffer_is_binary(buf, size)) {",
          "new_line_content": "\tunsigned count = 0;",
          "content_same": false
        },
        {
          "line": 814,
          "old_api": "printf",
          "new_api": null,
          "old_text": "printf(\"%s%c%u\\n\", name,\n\t\t       opt->null_following_name ? '\\0' : ':', count)",
          "new_text": null,
          "old_line_content": "\t\tprintf(\"%s%c%u\\n\", name,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 698,
          "old_api": "memset",
          "new_api": null,
          "old_text": "memset(&xecfg, 0, sizeof(xecfg))",
          "new_text": null,
          "old_line_content": "\tmemset(&xecfg, 0, sizeof(xecfg));",
          "new_line_content": "\t\t\treturn 0; /* Assume unmatch */",
          "content_same": false
        },
        {
          "line": 701,
          "old_api": "userdiff_find_by_path",
          "new_api": null,
          "old_text": "userdiff_find_by_path(name)",
          "new_text": null,
          "old_line_content": "\t\tstruct userdiff_driver *drv = userdiff_find_by_path(name);",
          "new_line_content": "\t\t\tbreak;",
          "content_same": false
        },
        {
          "line": 704,
          "old_api": "xdiff_set_find_func",
          "new_api": null,
          "old_text": "xdiff_set_find_func(&xecfg, pe->pattern, pe->cflags)",
          "new_text": null,
          "old_line_content": "\t\t\txdiff_set_find_func(&xecfg, pe->pattern, pe->cflags);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 852,
          "old_api": "grep_buffer_1",
          "new_api": null,
          "old_text": "grep_buffer_1(opt, name, buf, size, 0)",
          "new_text": null,
          "old_line_content": "\t\treturn grep_buffer_1(opt, name, buf, size, 0);",
          "new_line_content": "int grep_buffer(struct grep_opt *opt, const char *name, char *buf, unsigned long size)",
          "content_same": false
        },
        {
          "line": 726,
          "old_api": "look_ahead",
          "new_api": null,
          "old_text": "look_ahead(opt, &left, &lno, &bol)",
          "new_text": null,
          "old_line_content": "\t\t    && look_ahead(opt, &left, &lno, &bol))",
          "new_line_content": "\t\t * inside a post-context window, we will show the current",
          "content_same": false
        },
        {
          "line": 728,
          "old_api": "end_of_line",
          "new_api": null,
          "old_text": "end_of_line(bol, &left)",
          "new_text": null,
          "old_line_content": "\t\teol = end_of_line(bol, &left);",
          "new_line_content": "\t\t * doesn't hit.",
          "content_same": false
        },
        {
          "line": 857,
          "old_api": "clr_hit_marker",
          "new_api": null,
          "old_text": "clr_hit_marker(opt->pattern_expression)",
          "new_text": null,
          "old_line_content": "\tclr_hit_marker(opt->pattern_expression);",
          "new_line_content": "\t */",
          "content_same": false
        },
        {
          "line": 858,
          "old_api": "grep_buffer_1",
          "new_api": null,
          "old_text": "grep_buffer_1(opt, name, buf, size, 1)",
          "new_text": null,
          "old_line_content": "\tgrep_buffer_1(opt, name, buf, size, 1);",
          "new_line_content": "\tif (!opt->all_match)",
          "content_same": false
        },
        {
          "line": 860,
          "old_api": "chk_hit_marker",
          "new_api": null,
          "old_text": "chk_hit_marker(opt->pattern_expression)",
          "new_text": null,
          "old_line_content": "\tif (!chk_hit_marker(opt->pattern_expression))",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 863,
          "old_api": "grep_buffer_1",
          "new_api": null,
          "old_text": "grep_buffer_1(opt, name, buf, size, 0)",
          "new_text": null,
          "old_line_content": "\treturn grep_buffer_1(opt, name, buf, size, 0);",
          "new_line_content": "\t */",
          "content_same": false
        },
        {
          "line": 757,
          "old_api": "printf",
          "new_api": null,
          "old_text": "printf(\"Binary file %s matches\\n\", name)",
          "new_text": null,
          "old_line_content": "\t\t\t\tprintf(\"Binary file %s matches\\n\", name);",
          "new_line_content": "\t\t\tgoto next_line;",
          "content_same": false
        },
        {
          "line": 761,
          "old_api": "show_name",
          "new_api": null,
          "old_text": "show_name(opt, name)",
          "new_text": null,
          "old_line_content": "\t\t\t\tshow_name(opt, name);",
          "new_line_content": "\t\t\tif (opt->status_only)",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 2,
      "total_additions": 22,
      "total_deletions": 21,
      "total_api_changes": 45
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 8,
        "api_related_lines": 45,
        "non_api_lines": 6,
        "non_api_line_numbers": [
          643,
          645,
          646,
          648,
          650,
          651
        ]
      }
    },
    "api_calls_before": 104,
    "api_calls_after": 105,
    "diff_info": {
      "added_lines": 8,
      "removed_lines": 1,
      "total_diff_lines": 22
    }
  }
}