{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/fec501dae8bf6c8fdcd4124c94f37c4cbc26ba29",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/fec501dae8bf6c8fdcd4124c94f37c4cbc26ba29/before.h",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/fec501dae8bf6c8fdcd4124c94f37c4cbc26ba29/after.h",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/fec501dae8bf6c8fdcd4124c94f37c4cbc26ba29/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": true,
    "api_changes": {
      "replacements": [
        {
          "line": 208,
          "old_api": "strbuf_grow",
          "new_api": "strbuf_avail",
          "old_text": "strbuf_grow(sb, 1)",
          "new_text": "strbuf_avail(sb)",
          "old_line_content": "\tstrbuf_grow(sb, 1);",
          "new_line_content": "\tif (!strbuf_avail(sb))",
          "content_same": false
        },
        {
          "line": 268,
          "old_api": "strbuf_add",
          "new_api": "strbuf_grow",
          "old_text": "strbuf_add(sb, sb2->buf, sb2->len)",
          "new_text": "strbuf_grow(sb, sb2->len)",
          "old_line_content": "\tstrbuf_add(sb, sb2->buf, sb2->len);",
          "new_line_content": "\tstrbuf_grow(sb, sb2->len);",
          "content_same": false
        },
        {
          "line": 420,
          "old_api": "strbuf_setlen",
          "new_api": "strip_suffix_mem",
          "old_text": "strbuf_setlen(sb, sb->len)",
          "new_text": "strip_suffix_mem(sb->buf, &sb->len, suffix)",
          "old_line_content": "\t\tstrbuf_setlen(sb, sb->len);",
          "new_line_content": "\tif (strip_suffix_mem(sb->buf, &sb->len, suffix)) {",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 512,
          "old_api": null,
          "new_api": "format (printf, 1, 0)",
          "old_text": null,
          "new_text": "format (printf, 1, 0)",
          "old_line_content": "char *xstrvfmt(const char *fmt, va_list ap);",
          "new_line_content": "__attribute__((format (printf, 1, 0)))",
          "content_same": false
        },
        {
          "line": 514,
          "old_api": null,
          "new_api": "format (printf, 1, 2)",
          "old_text": null,
          "new_text": "format (printf, 1, 2)",
          "old_line_content": "char *xstrfmt(const char *fmt, ...);",
          "new_line_content": "__attribute__((format (printf, 1, 2)))",
          "content_same": false
        },
        {
          "line": 451,
          "old_api": null,
          "new_api": "strlen",
          "old_text": null,
          "new_text": "strlen(str)",
          "old_line_content": "}",
          "new_line_content": "\treturn strbuf_split_buf(str, strlen(str), terminator, max);",
          "content_same": false
        },
        {
          "line": 260,
          "old_api": null,
          "new_api": "strlen",
          "old_text": null,
          "new_text": "strlen(s)",
          "old_line_content": "}",
          "new_line_content": "\tstrbuf_add(sb, s, strlen(s));",
          "content_same": false
        },
        {
          "line": 421,
          "old_api": null,
          "new_api": "strbuf_setlen",
          "old_text": null,
          "new_text": "strbuf_setlen(sb, sb->len)",
          "old_line_content": "\t\treturn 1;",
          "new_line_content": "\t\tstrbuf_setlen(sb, sb->len);",
          "content_same": false
        },
        {
          "line": 457,
          "old_api": null,
          "new_api": "strbuf_split_buf",
          "old_text": null,
          "new_text": "strbuf_split_buf(sb->buf, sb->len, terminator, max)",
          "old_line_content": "}",
          "new_line_content": "\treturn strbuf_split_buf(sb->buf, sb->len, terminator, max);",
          "content_same": false
        },
        {
          "line": 492,
          "old_api": null,
          "new_api": "strbuf_addch",
          "old_text": null,
          "new_text": "strbuf_addch(sb, '\\n')",
          "old_line_content": "}",
          "new_line_content": "\t\tstrbuf_addch(sb, '\\n');",
          "content_same": false
        },
        {
          "line": 269,
          "old_api": null,
          "new_api": "strbuf_add",
          "old_text": null,
          "new_text": "strbuf_add(sb, sb2->buf, sb2->len)",
          "old_line_content": "}",
          "new_line_content": "\tstrbuf_add(sb, sb2->buf, sb2->len);",
          "content_same": false
        },
        {
          "line": 334,
          "old_api": null,
          "new_api": "format (printf,2,3)",
          "old_text": null,
          "new_text": "format (printf,2,3)",
          "old_line_content": "extern void strbuf_addf(struct strbuf *sb, const char *fmt, ...);",
          "new_line_content": "__attribute__((format (printf,2,3)))",
          "content_same": false
        },
        {
          "line": 463,
          "old_api": null,
          "new_api": "strbuf_split_max",
          "old_text": null,
          "new_text": "strbuf_split_max(sb, terminator, 0)",
          "old_line_content": "}",
          "new_line_content": "\treturn strbuf_split_max(sb, terminator, 0);",
          "content_same": false
        },
        {
          "line": 209,
          "old_api": null,
          "new_api": "strbuf_grow",
          "old_text": null,
          "new_text": "strbuf_grow(sb, 1)",
          "old_line_content": "\tsb->buf[sb->len++] = c;",
          "new_line_content": "\t\tstrbuf_grow(sb, 1);",
          "content_same": false
        },
        {
          "line": 341,
          "old_api": null,
          "new_api": "format (printf, 2, 3)",
          "old_text": null,
          "new_text": "format (printf, 2, 3)",
          "old_line_content": "extern void strbuf_commented_addf(struct strbuf *sb, const char *fmt, ...);",
          "new_line_content": "__attribute__((format (printf, 2, 3)))",
          "content_same": false
        },
        {
          "line": 501,
          "old_api": null,
          "new_api": "format (printf,1,2)",
          "old_text": null,
          "new_text": "format (printf,1,2)",
          "old_line_content": "extern int printf_ln(const char *fmt, ...);",
          "new_line_content": "__attribute__((format (printf,1,2)))",
          "content_same": false
        },
        {
          "line": 503,
          "old_api": null,
          "new_api": "format (printf,2,3)",
          "old_text": null,
          "new_text": "format (printf,2,3)",
          "old_line_content": "extern int fprintf_ln(FILE *fp, const char *fmt, ...);",
          "new_line_content": "__attribute__((format (printf,2,3)))",
          "content_same": false
        },
        {
          "line": 344,
          "old_api": null,
          "new_api": "format (printf,2,0)",
          "old_text": null,
          "new_text": "format (printf,2,0)",
          "old_line_content": "extern void strbuf_vaddf(struct strbuf *sb, const char *fmt, va_list ap);",
          "new_line_content": "__attribute__((format (printf,2,0)))",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 513,
          "old_api": "format (printf, 1, 2)",
          "new_api": null,
          "old_text": "format (printf, 1, 2)",
          "new_text": null,
          "old_line_content": "__attribute__((format (printf, 1, 2)))",
          "new_line_content": "char *xstrvfmt(const char *fmt, va_list ap);",
          "content_same": false
        },
        {
          "line": 450,
          "old_api": "strlen",
          "new_api": null,
          "old_text": "strlen(str)",
          "new_text": null,
          "old_line_content": "\treturn strbuf_split_buf(str, strlen(str), terminator, max);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 259,
          "old_api": "strlen",
          "new_api": null,
          "old_text": "strlen(s)",
          "new_text": null,
          "old_line_content": "\tstrbuf_add(sb, s, strlen(s));",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 419,
          "old_api": "strip_suffix_mem",
          "new_api": null,
          "old_text": "strip_suffix_mem(sb->buf, &sb->len, suffix)",
          "new_text": null,
          "old_line_content": "\tif (strip_suffix_mem(sb->buf, &sb->len, suffix)) {",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 456,
          "old_api": "strbuf_split_buf",
          "new_api": null,
          "old_text": "strbuf_split_buf(sb->buf, sb->len, terminator, max)",
          "new_text": null,
          "old_line_content": "\treturn strbuf_split_buf(sb->buf, sb->len, terminator, max);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 267,
          "old_api": "strbuf_grow",
          "new_api": null,
          "old_text": "strbuf_grow(sb, sb2->len)",
          "new_text": null,
          "old_line_content": "\tstrbuf_grow(sb, sb2->len);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 491,
          "old_api": "strbuf_addch",
          "new_api": null,
          "old_text": "strbuf_addch(sb, '\\n')",
          "new_text": null,
          "old_line_content": "\t\tstrbuf_addch(sb, '\\n');",
          "new_line_content": "\tif (sb->len && sb->buf[sb->len - 1] != '\\n')",
          "content_same": false
        },
        {
          "line": 333,
          "old_api": "format (printf,2,3)",
          "new_api": null,
          "old_text": "format (printf,2,3)",
          "new_text": null,
          "old_line_content": "__attribute__((format (printf,2,3)))",
          "new_line_content": " */",
          "content_same": false
        },
        {
          "line": 462,
          "old_api": "strbuf_split_max",
          "new_api": null,
          "old_text": "strbuf_split_max(sb, terminator, 0)",
          "new_text": null,
          "old_line_content": "\treturn strbuf_split_max(sb, terminator, 0);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 340,
          "old_api": "format (printf, 2, 3)",
          "new_api": null,
          "old_text": "format (printf, 2, 3)",
          "new_text": null,
          "old_line_content": "__attribute__((format (printf, 2, 3)))",
          "new_line_content": " */",
          "content_same": false
        },
        {
          "line": 500,
          "old_api": "format (printf,1,2)",
          "new_api": null,
          "old_text": "format (printf,1,2)",
          "new_text": null,
          "old_line_content": "__attribute__((format (printf,1,2)))",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 502,
          "old_api": "format (printf,2,3)",
          "new_api": null,
          "old_text": "format (printf,2,3)",
          "new_text": null,
          "old_line_content": "__attribute__((format (printf,2,3)))",
          "new_line_content": "extern int printf_ln(const char *fmt, ...);",
          "content_same": false
        },
        {
          "line": 343,
          "old_api": "format (printf,2,0)",
          "new_api": null,
          "old_text": "format (printf,2,0)",
          "new_text": null,
          "old_line_content": "__attribute__((format (printf,2,0)))",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 511,
          "old_api": "format (printf, 1, 0)",
          "new_api": null,
          "old_text": "format (printf, 1, 0)",
          "new_text": null,
          "old_line_content": "__attribute__((format (printf, 1, 0)))",
          "new_line_content": " */",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 3,
      "total_additions": 15,
      "total_deletions": 14,
      "total_api_changes": 32
    },
    "non_api_changes": {
      "has_non_api_changes": false,
      "evidence": {
        "total_diff_lines": 2,
        "api_related_lines": 32,
        "non_api_lines": 0,
        "non_api_line_numbers": []
      }
    },
    "api_calls_before": 27,
    "api_calls_after": 28,
    "diff_info": {
      "added_lines": 2,
      "removed_lines": 1,
      "total_diff_lines": 15
    }
  }
}