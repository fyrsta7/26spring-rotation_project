{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/0cd0afc9c6193dd4a762f5a2d1bc23e58629b23f",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/0cd0afc9c6193dd4a762f5a2d1bc23e58629b23f/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/0cd0afc9c6193dd4a762f5a2d1bc23e58629b23f/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/0cd0afc9c6193dd4a762f5a2d1bc23e58629b23f/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 6781,
          "old_api": "alloc_filespec",
          "new_api": "strncmp",
          "old_text": "alloc_filespec(path)",
          "new_text": "strncmp(path, options->prefix, options->prefix_length)",
          "old_line_content": "\tone = alloc_filespec(path);",
          "new_line_content": "\t    strncmp(path, options->prefix, options->prefix_length))",
          "content_same": false
        },
        {
          "line": 6817,
          "old_api": "finish_command",
          "new_api": "error",
          "old_text": "finish_command(&child)",
          "new_text": "error(\"error reading from textconv command '%s'\", pgm)",
          "old_line_content": "\tif (finish_command(&child) || err) {",
          "new_line_content": "\t\terr = error(\"error reading from textconv command '%s'\", pgm);",
          "content_same": false
        },
        {
          "line": 6818,
          "old_api": "strbuf_release",
          "new_api": "close",
          "old_text": "strbuf_release(&buf)",
          "new_text": "close(child.out)",
          "old_line_content": "\t\tstrbuf_release(&buf);",
          "new_line_content": "\tclose(child.out);",
          "content_same": false
        },
        {
          "line": 6849,
          "old_api": "notes_cache_get",
          "new_api": "BUG",
          "old_text": "notes_cache_get(driver->textconv_cache,\n\t\t\t\t\t  &df->oid,\n\t\t\t\t\t  &size)",
          "new_text": "BUG(\"fill_textconv called with non-textconv driver\")",
          "old_line_content": "\t\t*outbuf = notes_cache_get(driver->textconv_cache,",
          "new_line_content": "\t\tBUG(\"fill_textconv called with non-textconv driver\");",
          "content_same": false
        },
        {
          "line": 6891,
          "old_api": "free_filespec",
          "new_api": "fill_filespec",
          "old_text": "free_filespec(df)",
          "new_text": "fill_filespec(df, oid, oid_valid, mode)",
          "old_line_content": "\t\tfree_filespec(df);",
          "new_line_content": "\tfill_filespec(df, oid, oid_valid, mode);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 6784,
          "old_api": null,
          "new_api": "alloc_filespec",
          "old_text": null,
          "new_text": "alloc_filespec(path)",
          "old_line_content": "\tpair->is_unmerged = 1;",
          "new_line_content": "\tone = alloc_filespec(path);",
          "content_same": false
        },
        {
          "line": 6785,
          "old_api": null,
          "new_api": "alloc_filespec",
          "old_text": null,
          "new_text": "alloc_filespec(path)",
          "old_line_content": "\treturn pair;",
          "new_line_content": "\ttwo = alloc_filespec(path);",
          "content_same": false
        },
        {
          "line": 6786,
          "old_api": null,
          "new_api": "diff_queue",
          "old_text": null,
          "new_text": "diff_queue(&diff_queued_diff, one, two)",
          "old_line_content": "}",
          "new_line_content": "\tpair = diff_queue(&diff_queued_diff, one, two);",
          "content_same": false
        },
        {
          "line": 6915,
          "old_api": null,
          "new_api": "check_pager_config",
          "old_text": null,
          "new_text": "check_pager_config(\"diff\")",
          "old_line_content": "",
          "new_line_content": "\t    check_pager_config(\"diff\") != 0)",
          "content_same": false
        },
        {
          "line": 6916,
          "old_api": null,
          "new_api": "setup_pager",
          "old_text": null,
          "new_text": "setup_pager()",
          "old_line_content": "",
          "new_line_content": "\t\tsetup_pager();",
          "content_same": false
        },
        {
          "line": 6803,
          "old_api": null,
          "new_api": "prepare_temp_file",
          "old_text": null,
          "new_text": "prepare_temp_file(r, spec->path, spec)",
          "old_line_content": "\t*arg = NULL;",
          "new_line_content": "\ttemp = prepare_temp_file(r, spec->path, spec);",
          "content_same": false
        },
        {
          "line": 6811,
          "old_api": null,
          "new_api": "start_command",
          "old_text": null,
          "new_text": "start_command(&child)",
          "old_line_content": "\t}",
          "new_line_content": "\tif (start_command(&child)) {",
          "content_same": false
        },
        {
          "line": 6812,
          "old_api": null,
          "new_api": "remove_tempfile",
          "old_text": null,
          "new_text": "remove_tempfile()",
          "old_line_content": "",
          "new_line_content": "\t\tremove_tempfile();",
          "content_same": false
        },
        {
          "line": 6816,
          "old_api": null,
          "new_api": "strbuf_read",
          "old_text": null,
          "new_text": "strbuf_read(&buf, child.out, 0)",
          "old_line_content": "",
          "new_line_content": "\tif (strbuf_read(&buf, child.out, 0) < 0)",
          "content_same": false
        },
        {
          "line": 6820,
          "old_api": null,
          "new_api": "finish_command",
          "old_text": null,
          "new_text": "finish_command(&child)",
          "old_line_content": "\t\treturn NULL;",
          "new_line_content": "\tif (finish_command(&child) || err) {",
          "content_same": false
        },
        {
          "line": 6821,
          "old_api": null,
          "new_api": "strbuf_release",
          "old_text": null,
          "new_text": "strbuf_release(&buf)",
          "old_line_content": "\t}",
          "new_line_content": "\t\tstrbuf_release(&buf);",
          "content_same": false
        },
        {
          "line": 6825,
          "old_api": null,
          "new_api": "remove_tempfile",
          "old_text": null,
          "new_text": "remove_tempfile()",
          "old_line_content": "}",
          "new_line_content": "\tremove_tempfile();",
          "content_same": false
        },
        {
          "line": 6827,
          "old_api": null,
          "new_api": "strbuf_detach",
          "old_text": null,
          "new_text": "strbuf_detach(&buf, outsize)",
          "old_line_content": "size_t fill_textconv(struct repository *r,",
          "new_line_content": "\treturn strbuf_detach(&buf, outsize);",
          "content_same": false
        },
        {
          "line": 6838,
          "old_api": null,
          "new_api": "DIFF_FILE_VALID",
          "old_text": null,
          "new_text": "DIFF_FILE_VALID(df)",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\tif (!DIFF_FILE_VALID(df)) {",
          "content_same": false
        },
        {
          "line": 6842,
          "old_api": null,
          "new_api": "diff_populate_filespec",
          "old_text": null,
          "new_text": "diff_populate_filespec(r, df, NULL)",
          "old_line_content": "\t\treturn df->size;",
          "new_line_content": "\t\tif (diff_populate_filespec(r, df, NULL))",
          "content_same": false
        },
        {
          "line": 6843,
          "old_api": null,
          "new_api": "die",
          "old_text": null,
          "new_text": "die(\"unable to read files to diff\")",
          "old_line_content": "\t}",
          "new_line_content": "\t\t\tdie(\"unable to read files to diff\");",
          "content_same": false
        },
        {
          "line": 6852,
          "old_api": null,
          "new_api": "notes_cache_get",
          "old_text": null,
          "new_text": "notes_cache_get(driver->textconv_cache,\n\t\t\t\t\t  &df->oid,\n\t\t\t\t\t  &size)",
          "old_line_content": "\t\tif (*outbuf)",
          "new_line_content": "\t\t*outbuf = notes_cache_get(driver->textconv_cache,",
          "content_same": false
        },
        {
          "line": 6859,
          "old_api": null,
          "new_api": "run_textconv",
          "old_text": null,
          "new_text": "run_textconv(r, driver->textconv, df, &size)",
          "old_line_content": "",
          "new_line_content": "\t*outbuf = run_textconv(r, driver->textconv, df, &size);",
          "content_same": false
        },
        {
          "line": 6861,
          "old_api": null,
          "new_api": "die",
          "old_text": null,
          "new_text": "die(\"unable to read files to diff\")",
          "old_line_content": "\t\t/* ignore errors, as we might be in a readonly repository */",
          "new_line_content": "\t\tdie(\"unable to read files to diff\");",
          "content_same": false
        },
        {
          "line": 6865,
          "old_api": null,
          "new_api": "notes_cache_put",
          "old_text": null,
          "new_text": "notes_cache_put(driver->textconv_cache, &df->oid, *outbuf,\n\t\t\t\tsize)",
          "old_line_content": "\t\t * we could save up changes and flush them all at the end,",
          "new_line_content": "\t\tnotes_cache_put(driver->textconv_cache, &df->oid, *outbuf,",
          "content_same": false
        },
        {
          "line": 6873,
          "old_api": null,
          "new_api": "notes_cache_write",
          "old_text": null,
          "new_text": "notes_cache_write(driver->textconv_cache)",
          "old_line_content": "\treturn size;",
          "new_line_content": "\t\tnotes_cache_write(driver->textconv_cache);",
          "content_same": false
        },
        {
          "line": 6890,
          "old_api": null,
          "new_api": "alloc_filespec",
          "old_text": null,
          "new_text": "alloc_filespec(path)",
          "old_line_content": "\tif (!textconv) {",
          "new_line_content": "\tdf = alloc_filespec(path);",
          "content_same": false
        },
        {
          "line": 6892,
          "old_api": null,
          "new_api": "get_textconv",
          "old_text": null,
          "new_text": "get_textconv(r, df)",
          "old_line_content": "\t\treturn 0;",
          "new_line_content": "\ttextconv = get_textconv(r, df);",
          "content_same": false
        },
        {
          "line": 6894,
          "old_api": null,
          "new_api": "free_filespec",
          "old_text": null,
          "new_text": "free_filespec(df)",
          "old_line_content": "",
          "new_line_content": "\t\tfree_filespec(df);",
          "content_same": false
        },
        {
          "line": 6767,
          "old_api": null,
          "new_api": "diff_free_filespec_data",
          "old_text": null,
          "new_text": "diff_free_filespec_data(p->one)",
          "old_line_content": "\t\treturn;",
          "new_line_content": "\t\tdiff_free_filespec_data(p->one);",
          "content_same": false
        },
        {
          "line": 6768,
          "old_api": null,
          "new_api": "diff_free_filespec_data",
          "old_text": null,
          "new_text": "diff_free_filespec_data(p->two)",
          "old_line_content": "",
          "new_line_content": "\t\tdiff_free_filespec_data(p->two);",
          "content_same": false
        },
        {
          "line": 6898,
          "old_api": null,
          "new_api": "fill_textconv",
          "old_text": null,
          "new_text": "fill_textconv(r, textconv, df, buf)",
          "old_line_content": "}",
          "new_line_content": "\t*buf_size = fill_textconv(r, textconv, df, buf);",
          "content_same": false
        },
        {
          "line": 6899,
          "old_api": null,
          "new_api": "free_filespec",
          "old_text": null,
          "new_text": "free_filespec(df)",
          "old_line_content": "",
          "new_line_content": "\tfree_filespec(df);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 6912,
          "old_api": "check_pager_config",
          "new_api": null,
          "old_text": "check_pager_config(\"diff\")",
          "new_text": null,
          "old_line_content": "\t    check_pager_config(\"diff\") != 0)",
          "new_line_content": "\t * --exit-code\" in hooks and other scripts, we do not do so.",
          "content_same": false
        },
        {
          "line": 6913,
          "old_api": "setup_pager",
          "new_api": null,
          "old_text": "setup_pager()",
          "new_text": null,
          "old_line_content": "\t\tsetup_pager();",
          "new_line_content": "\t */",
          "content_same": false
        },
        {
          "line": 6800,
          "old_api": "prepare_temp_file",
          "new_api": null,
          "old_text": "prepare_temp_file(r, spec->path, spec)",
          "new_text": null,
          "old_line_content": "\ttemp = prepare_temp_file(r, spec->path, spec);",
          "new_line_content": "\tstruct strbuf buf = STRBUF_INIT;",
          "content_same": false
        },
        {
          "line": 6808,
          "old_api": "start_command",
          "new_api": null,
          "old_text": "start_command(&child)",
          "new_text": null,
          "old_line_content": "\tif (start_command(&child)) {",
          "new_line_content": "\tchild.use_shell = 1;",
          "content_same": false
        },
        {
          "line": 6809,
          "old_api": "remove_tempfile",
          "new_api": null,
          "old_text": "remove_tempfile()",
          "new_text": null,
          "old_line_content": "\t\tremove_tempfile();",
          "new_line_content": "\tchild.argv = argv;",
          "content_same": false
        },
        {
          "line": 6813,
          "old_api": "strbuf_read",
          "new_api": null,
          "old_text": "strbuf_read(&buf, child.out, 0)",
          "new_text": null,
          "old_line_content": "\tif (strbuf_read(&buf, child.out, 0) < 0)",
          "new_line_content": "\t\treturn NULL;",
          "content_same": false
        },
        {
          "line": 6814,
          "old_api": "error",
          "new_api": null,
          "old_text": "error(\"error reading from textconv command '%s'\", pgm)",
          "new_text": null,
          "old_line_content": "\t\terr = error(\"error reading from textconv command '%s'\", pgm);",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 6815,
          "old_api": "close",
          "new_api": null,
          "old_text": "close(child.out)",
          "new_text": null,
          "old_line_content": "\tclose(child.out);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 6819,
          "old_api": "remove_tempfile",
          "new_api": null,
          "old_text": "remove_tempfile()",
          "new_text": null,
          "old_line_content": "\t\tremove_tempfile();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 6824,
          "old_api": "strbuf_detach",
          "new_api": null,
          "old_text": "strbuf_detach(&buf, outsize)",
          "new_text": null,
          "old_line_content": "\treturn strbuf_detach(&buf, outsize);",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 6835,
          "old_api": "DIFF_FILE_VALID",
          "new_api": null,
          "old_text": "DIFF_FILE_VALID(df)",
          "new_text": null,
          "old_line_content": "\t\tif (!DIFF_FILE_VALID(df)) {",
          "new_line_content": "\tsize_t size;",
          "content_same": false
        },
        {
          "line": 6839,
          "old_api": "diff_populate_filespec",
          "new_api": null,
          "old_text": "diff_populate_filespec(r, df, NULL)",
          "new_text": null,
          "old_line_content": "\t\tif (diff_populate_filespec(r, df, NULL))",
          "new_line_content": "\t\t\t*outbuf = \"\";",
          "content_same": false
        },
        {
          "line": 6840,
          "old_api": "die",
          "new_api": null,
          "old_text": "die(\"unable to read files to diff\")",
          "new_text": null,
          "old_line_content": "\t\t\tdie(\"unable to read files to diff\");",
          "new_line_content": "\t\t\treturn 0;",
          "content_same": false
        },
        {
          "line": 6846,
          "old_api": "BUG",
          "new_api": null,
          "old_text": "BUG(\"fill_textconv called with non-textconv driver\")",
          "new_text": null,
          "old_line_content": "\t\tBUG(\"fill_textconv called with non-textconv driver\");",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 6856,
          "old_api": "run_textconv",
          "new_api": null,
          "old_text": "run_textconv(r, driver->textconv, df, &size)",
          "new_text": null,
          "old_line_content": "\t*outbuf = run_textconv(r, driver->textconv, df, &size);",
          "new_line_content": "\t\t\treturn size;",
          "content_same": false
        },
        {
          "line": 6858,
          "old_api": "die",
          "new_api": null,
          "old_text": "die(\"unable to read files to diff\")",
          "new_text": null,
          "old_line_content": "\t\tdie(\"unable to read files to diff\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 6862,
          "old_api": "notes_cache_put",
          "new_api": null,
          "old_text": "notes_cache_put(driver->textconv_cache, &df->oid, *outbuf,\n\t\t\t\tsize)",
          "new_text": null,
          "old_line_content": "\t\tnotes_cache_put(driver->textconv_cache, &df->oid, *outbuf,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 6870,
          "old_api": "notes_cache_write",
          "new_api": null,
          "old_text": "notes_cache_write(driver->textconv_cache)",
          "new_text": null,
          "old_line_content": "\t\tnotes_cache_write(driver->textconv_cache);",
          "new_line_content": "\t\t * Since generating a cache entry is the slow path anyway,",
          "content_same": false
        },
        {
          "line": 6887,
          "old_api": "alloc_filespec",
          "new_api": null,
          "old_text": "alloc_filespec(path)",
          "new_text": null,
          "old_line_content": "\tdf = alloc_filespec(path);",
          "new_line_content": "\tstruct diff_filespec *df;",
          "content_same": false
        },
        {
          "line": 6888,
          "old_api": "fill_filespec",
          "new_api": null,
          "old_text": "fill_filespec(df, oid, oid_valid, mode)",
          "new_text": null,
          "old_line_content": "\tfill_filespec(df, oid, oid_valid, mode);",
          "new_line_content": "\tstruct userdiff_driver *textconv;",
          "content_same": false
        },
        {
          "line": 6889,
          "old_api": "get_textconv",
          "new_api": null,
          "old_text": "get_textconv(r, df)",
          "new_text": null,
          "old_line_content": "\ttextconv = get_textconv(r, df);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 6895,
          "old_api": "fill_textconv",
          "new_api": null,
          "old_text": "fill_textconv(r, textconv, df, buf)",
          "new_text": null,
          "old_line_content": "\t*buf_size = fill_textconv(r, textconv, df, buf);",
          "new_line_content": "\t\treturn 0;",
          "content_same": false
        },
        {
          "line": 6896,
          "old_api": "free_filespec",
          "new_api": null,
          "old_text": "free_filespec(df)",
          "new_text": null,
          "old_line_content": "\tfree_filespec(df);",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 6778,
          "old_api": "strncmp",
          "new_api": null,
          "old_text": "strncmp(path, options->prefix, options->prefix_length)",
          "new_text": null,
          "old_line_content": "\t    strncmp(path, options->prefix, options->prefix_length))",
          "new_line_content": "\tstruct diff_filespec *one, *two;",
          "content_same": false
        },
        {
          "line": 6782,
          "old_api": "alloc_filespec",
          "new_api": null,
          "old_text": "alloc_filespec(path)",
          "new_text": null,
          "old_line_content": "\ttwo = alloc_filespec(path);",
          "new_line_content": "\t\treturn NULL;",
          "content_same": false
        },
        {
          "line": 6783,
          "old_api": "diff_queue",
          "new_api": null,
          "old_text": "diff_queue(&diff_queued_diff, one, two)",
          "new_text": null,
          "old_line_content": "\tpair = diff_queue(&diff_queued_diff, one, two);",
          "new_line_content": "",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 5,
      "total_additions": 28,
      "total_deletions": 26,
      "total_api_changes": 59
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 5,
        "api_related_lines": 59,
        "non_api_lines": 4,
        "non_api_line_numbers": [
          6769,
          6770,
          6772,
          6774
        ]
      }
    },
    "api_calls_before": 1633,
    "api_calls_after": 1635,
    "diff_info": {
      "added_lines": 5,
      "removed_lines": 2,
      "total_diff_lines": 31
    }
  }
}