{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/a64dd34d8cce018742badb49b87c5c565be655ce",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/a64dd34d8cce018742badb49b87c5c565be655ce/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/a64dd34d8cce018742badb49b87c5c565be655ce/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/a64dd34d8cce018742badb49b87c5c565be655ce/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 201,
          "old_api": "free",
          "new_api": "diff_queue",
          "old_text": "free(p)",
          "new_text": "diff_queue(&outq, null_two, p->two)",
          "old_line_content": "\t\t\t\tfree(p); /* not diff_free_filepair(), we are",
          "new_line_content": "\t\t\t\tdp = diff_queue(&outq, null_two, p->two);",
          "content_same": false
        },
        {
          "line": 235,
          "old_api": "diff_queue",
          "new_api": "die",
          "old_text": "diff_queue(outq, d->one, c->two)",
          "new_text": "die(\"internal error in merge #3\")",
          "old_line_content": "\tdp = diff_queue(outq, d->one, c->two);",
          "new_line_content": "\t\tdie(\"internal error in merge #3\");",
          "content_same": false
        },
        {
          "line": 237,
          "old_api": "diff_free_filespec_data",
          "new_api": "die",
          "old_text": "diff_free_filespec_data(d->two)",
          "new_text": "die(\"internal error in merge #4\")",
          "old_line_content": "\tdiff_free_filespec_data(d->two);",
          "new_line_content": "\t\tdie(\"internal error in merge #4\");",
          "content_same": false
        },
        {
          "line": 239,
          "old_api": "free",
          "new_api": "diff_queue",
          "old_text": "free(d)",
          "new_text": "diff_queue(outq, d->one, c->two)",
          "old_line_content": "\tfree(d);",
          "new_line_content": "\tdp = diff_queue(outq, d->one, c->two);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 262,
          "old_api": null,
          "new_api": "strcmp",
          "old_text": null,
          "new_text": "strcmp(p->one->path, p->two->path)",
          "old_line_content": "\t\t\tfor (j = i + 1; j < q->nr; j++) {",
          "new_line_content": "\t\t\t !strcmp(p->one->path, p->two->path)) {",
          "content_same": false
        },
        {
          "line": 269,
          "old_api": null,
          "new_api": "strcmp",
          "old_text": null,
          "new_text": "strcmp(pp->one->path, pp->two->path)",
          "old_line_content": "\t\t\t\t\tq->queue[j] = NULL;",
          "new_line_content": "\t\t\t\t    !strcmp(pp->one->path, pp->two->path) &&",
          "content_same": false
        },
        {
          "line": 270,
          "old_api": null,
          "new_api": "strcmp",
          "old_text": null,
          "new_text": "strcmp(p->one->path, pp->two->path)",
          "old_line_content": "\t\t\t\t\tbreak;",
          "new_line_content": "\t\t\t\t    !strcmp(p->one->path, pp->two->path)) {",
          "content_same": false
        },
        {
          "line": 272,
          "old_api": null,
          "new_api": "merge_broken",
          "old_text": null,
          "new_text": "merge_broken(p, pp, &outq)",
          "old_line_content": "\t\t\t}",
          "new_line_content": "\t\t\t\t\tmerge_broken(p, pp, &outq);",
          "content_same": false
        },
        {
          "line": 281,
          "old_api": null,
          "new_api": "diff_q",
          "old_text": null,
          "new_text": "diff_q(&outq, p)",
          "old_line_content": "\t}",
          "new_line_content": "\t\t\t\tdiff_q(&outq, p);",
          "content_same": false
        },
        {
          "line": 284,
          "old_api": null,
          "new_api": "diff_q",
          "old_text": null,
          "new_text": "diff_q(&outq, p)",
          "old_line_content": "",
          "new_line_content": "\t\t\tdiff_q(&outq, p);",
          "content_same": false
        },
        {
          "line": 286,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free(q->queue)",
          "old_line_content": "}",
          "new_line_content": "\tfree(q->queue);",
          "content_same": false
        },
        {
          "line": 175,
          "old_api": null,
          "new_api": "DIFF_FILE_VALID",
          "old_text": null,
          "new_text": "DIFF_FILE_VALID(p->two)",
          "old_line_content": "\t\t\t\t\t break_score, &score)) {",
          "new_line_content": "\t\tif (DIFF_FILE_VALID(p->one) && DIFF_FILE_VALID(p->two) &&",
          "content_same": false
        },
        {
          "line": 176,
          "old_api": null,
          "new_api": "S_ISDIR",
          "old_text": null,
          "new_text": "S_ISDIR(p->two->mode)",
          "old_line_content": "\t\t\t\t/* Split this into delete and create */",
          "new_line_content": "\t\t    !S_ISDIR(p->one->mode) && !S_ISDIR(p->two->mode) &&",
          "content_same": false
        },
        {
          "line": 177,
          "old_api": null,
          "new_api": "strcmp",
          "old_text": null,
          "new_text": "strcmp(p->one->path, p->two->path)",
          "old_line_content": "\t\t\t\tstruct diff_filespec *null_one, *null_two;",
          "new_line_content": "\t\t    !strcmp(p->one->path, p->two->path)) {",
          "content_same": false
        },
        {
          "line": 178,
          "old_api": null,
          "new_api": "should_break",
          "old_text": null,
          "new_text": "should_break(p->one, p->two,\n\t\t\t\t\t break_score, &score)",
          "old_line_content": "\t\t\t\tstruct diff_filepair *dp;",
          "new_line_content": "\t\t\tif (should_break(p->one, p->two,",
          "content_same": false
        },
        {
          "line": 62,
          "old_api": null,
          "new_api": "memcmp",
          "old_text": null,
          "new_text": "memcmp(src->sha1, dst->sha1, 20)",
          "old_line_content": "\t\treturn 0; /* error but caught downstream */",
          "new_line_content": "\t    !memcmp(src->sha1, dst->sha1, 20))",
          "content_same": false
        },
        {
          "line": 65,
          "old_api": null,
          "new_api": "diff_populate_filespec",
          "old_text": null,
          "new_text": "diff_populate_filespec(dst, 0)",
          "old_line_content": "\tif (base_size < MINIMUM_BREAK_SIZE)",
          "new_line_content": "\tif (diff_populate_filespec(src, 0) || diff_populate_filespec(dst, 0))",
          "content_same": false
        },
        {
          "line": 194,
          "old_api": null,
          "new_api": "alloc_filespec",
          "old_text": null,
          "new_text": "alloc_filespec(p->one->path)",
          "old_line_content": "",
          "new_line_content": "\t\t\t\tnull_one = alloc_filespec(p->one->path);",
          "content_same": false
        },
        {
          "line": 195,
          "old_api": null,
          "new_api": "diff_queue",
          "old_text": null,
          "new_text": "diff_queue(&outq, p->one, null_one)",
          "old_line_content": "\t\t\t\t/* creation of two */",
          "new_line_content": "\t\t\t\tdp = diff_queue(&outq, p->one, null_one);",
          "content_same": false
        },
        {
          "line": 72,
          "old_api": null,
          "new_api": "diff_delta",
          "old_text": null,
          "new_text": "diff_delta(src->data, src->size,\n\t\t\t   dst->data, dst->size,\n\t\t\t   &delta_size, 0)",
          "old_line_content": "\t\treturn 0; /* error but caught downstream */",
          "new_line_content": "\tdelta = diff_delta(src->data, src->size,",
          "content_same": false
        },
        {
          "line": 200,
          "old_api": null,
          "new_api": "alloc_filespec",
          "old_text": null,
          "new_text": "alloc_filespec(p->two->path)",
          "old_line_content": "",
          "new_line_content": "\t\t\t\tnull_two = alloc_filespec(p->two->path);",
          "content_same": false
        },
        {
          "line": 205,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free(p)",
          "old_line_content": "\t\t\t}",
          "new_line_content": "\t\t\t\tfree(p); /* not diff_free_filepair(), we are",
          "content_same": false
        },
        {
          "line": 79,
          "old_api": null,
          "new_api": "count_delta",
          "old_text": null,
          "new_text": "count_delta(delta, delta_size,\n\t\t\t&src_copied, &literal_added)",
          "old_line_content": "\t}",
          "new_line_content": "\tif (count_delta(delta, delta_size,",
          "content_same": false
        },
        {
          "line": 81,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free(delta)",
          "old_line_content": "",
          "new_line_content": "\t\tfree(delta);",
          "content_same": false
        },
        {
          "line": 211,
          "old_api": null,
          "new_api": "diff_q",
          "old_text": null,
          "new_text": "diff_q(&outq, p)",
          "old_line_content": "",
          "new_line_content": "\t\tdiff_q(&outq, p);",
          "content_same": false
        },
        {
          "line": 84,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free(delta)",
          "old_line_content": "\t * merge the surviving pair together if the score is",
          "new_line_content": "\tfree(delta);",
          "content_same": false
        },
        {
          "line": 213,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free(q->queue)",
          "old_line_content": "}",
          "new_line_content": "\tfree(q->queue);",
          "content_same": false
        },
        {
          "line": 225,
          "old_api": null,
          "new_api": "DIFF_FILE_VALID",
          "old_text": null,
          "new_text": "DIFF_FILE_VALID(p->one)",
          "old_line_content": "\t/* Sanity check */",
          "new_line_content": "\tif (DIFF_FILE_VALID(p->one)) {",
          "content_same": false
        },
        {
          "line": 234,
          "old_api": null,
          "new_api": "DIFF_FILE_VALID",
          "old_text": null,
          "new_text": "DIFF_FILE_VALID(c->one)",
          "old_line_content": "",
          "new_line_content": "\tif (DIFF_FILE_VALID(c->one))",
          "content_same": false
        },
        {
          "line": 236,
          "old_api": null,
          "new_api": "DIFF_FILE_VALID",
          "old_text": null,
          "new_text": "DIFF_FILE_VALID(c->two)",
          "old_line_content": "\tdp->score = p->score;",
          "new_line_content": "\tif (!DIFF_FILE_VALID(c->two))",
          "content_same": false
        },
        {
          "line": 241,
          "old_api": null,
          "new_api": "diff_free_filespec_data",
          "old_text": null,
          "new_text": "diff_free_filespec_data(d->two)",
          "old_line_content": "}",
          "new_line_content": "\tdiff_free_filespec_data(d->two);",
          "content_same": false
        },
        {
          "line": 242,
          "old_api": null,
          "new_api": "diff_free_filespec_data",
          "old_text": null,
          "new_text": "diff_free_filespec_data(c->one)",
          "old_line_content": "",
          "new_line_content": "\tdiff_free_filespec_data(c->one);",
          "content_same": false
        },
        {
          "line": 243,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free(d)",
          "old_line_content": "void diffcore_merge_broken(void)",
          "new_line_content": "\tfree(d);",
          "content_same": false
        },
        {
          "line": 244,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free(c)",
          "old_line_content": "{",
          "new_line_content": "\tfree(c);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 258,
          "old_api": "strcmp",
          "new_api": null,
          "old_text": "strcmp(p->one->path, p->two->path)",
          "new_text": null,
          "old_line_content": "\t\t\t !strcmp(p->one->path, p->two->path)) {",
          "new_line_content": "\t\tif (!p)",
          "content_same": false
        },
        {
          "line": 265,
          "old_api": "strcmp",
          "new_api": null,
          "old_text": "strcmp(pp->one->path, pp->two->path)",
          "new_text": null,
          "old_line_content": "\t\t\t\t    !strcmp(pp->one->path, pp->two->path) &&",
          "new_line_content": "\t\t\t */",
          "content_same": false
        },
        {
          "line": 266,
          "old_api": "strcmp",
          "new_api": null,
          "old_text": "strcmp(p->one->path, pp->two->path)",
          "new_text": null,
          "old_line_content": "\t\t\t\t    !strcmp(p->one->path, pp->two->path)) {",
          "new_line_content": "\t\t\tfor (j = i + 1; j < q->nr; j++) {",
          "content_same": false
        },
        {
          "line": 268,
          "old_api": "merge_broken",
          "new_api": null,
          "old_text": "merge_broken(p, pp, &outq)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\tmerge_broken(p, pp, &outq);",
          "new_line_content": "\t\t\t\tif (pp->broken_pair &&",
          "content_same": false
        },
        {
          "line": 277,
          "old_api": "diff_q",
          "new_api": null,
          "old_text": "diff_q(&outq, p)",
          "new_text": null,
          "old_line_content": "\t\t\t\tdiff_q(&outq, p);",
          "new_line_content": "\t\t\tif (q->nr <= j)",
          "content_same": false
        },
        {
          "line": 280,
          "old_api": "diff_q",
          "new_api": null,
          "old_text": "diff_q(&outq, p)",
          "new_text": null,
          "old_line_content": "\t\t\tdiff_q(&outq, p);",
          "new_line_content": "\t\t\t\t */",
          "content_same": false
        },
        {
          "line": 282,
          "old_api": "free",
          "new_api": null,
          "old_text": "free(q->queue)",
          "new_text": null,
          "old_line_content": "\tfree(q->queue);",
          "new_line_content": "\t\t}",
          "content_same": false
        },
        {
          "line": 171,
          "old_api": "DIFF_FILE_VALID",
          "new_api": null,
          "old_text": "DIFF_FILE_VALID(p->two)",
          "new_text": null,
          "old_line_content": "\t\tif (DIFF_FILE_VALID(p->one) && DIFF_FILE_VALID(p->two) &&",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 172,
          "old_api": "S_ISDIR",
          "new_api": null,
          "old_text": "S_ISDIR(p->two->mode)",
          "new_text": null,
          "old_line_content": "\t\t    !S_ISDIR(p->one->mode) && !S_ISDIR(p->two->mode) &&",
          "new_line_content": "\t\t/* We deal only with in-place edit of non directory.",
          "content_same": false
        },
        {
          "line": 173,
          "old_api": "strcmp",
          "new_api": null,
          "old_text": "strcmp(p->one->path, p->two->path)",
          "new_text": null,
          "old_line_content": "\t\t    !strcmp(p->one->path, p->two->path)) {",
          "new_line_content": "\t\t * We do not break anything else.",
          "content_same": false
        },
        {
          "line": 174,
          "old_api": "should_break",
          "new_api": null,
          "old_text": "should_break(p->one, p->two,\n\t\t\t\t\t break_score, &score)",
          "new_text": null,
          "old_line_content": "\t\t\tif (should_break(p->one, p->two,",
          "new_line_content": "\t\t */",
          "content_same": false
        },
        {
          "line": 61,
          "old_api": "diff_populate_filespec",
          "new_api": null,
          "old_text": "diff_populate_filespec(dst, 0)",
          "new_text": null,
          "old_line_content": "\tif (diff_populate_filespec(src, 0) || diff_populate_filespec(dst, 0))",
          "new_line_content": "\tif (src->sha1_valid && dst->sha1_valid &&",
          "content_same": false
        },
        {
          "line": 190,
          "old_api": "alloc_filespec",
          "new_api": null,
          "old_text": "alloc_filespec(p->one->path)",
          "new_text": null,
          "old_line_content": "\t\t\t\tnull_one = alloc_filespec(p->one->path);",
          "new_line_content": "\t\t\t\tif (score < merge_score)",
          "content_same": false
        },
        {
          "line": 191,
          "old_api": "diff_queue",
          "new_api": null,
          "old_text": "diff_queue(&outq, p->one, null_one)",
          "new_text": null,
          "old_line_content": "\t\t\t\tdp = diff_queue(&outq, p->one, null_one);",
          "new_line_content": "\t\t\t\t\tscore = 0;",
          "content_same": false
        },
        {
          "line": 68,
          "old_api": "diff_delta",
          "new_api": null,
          "old_text": "diff_delta(src->data, src->size,\n\t\t\t   dst->data, dst->size,\n\t\t\t   &delta_size, 0)",
          "new_text": null,
          "old_line_content": "\tdelta = diff_delta(src->data, src->size,",
          "new_line_content": "\tbase_size = ((src->size < dst->size) ? src->size : dst->size);",
          "content_same": false
        },
        {
          "line": 196,
          "old_api": "alloc_filespec",
          "new_api": null,
          "old_text": "alloc_filespec(p->two->path)",
          "new_text": null,
          "old_line_content": "\t\t\t\tnull_two = alloc_filespec(p->two->path);",
          "new_line_content": "\t\t\t\tdp->score = score;",
          "content_same": false
        },
        {
          "line": 197,
          "old_api": "diff_queue",
          "new_api": null,
          "old_text": "diff_queue(&outq, null_two, p->two)",
          "new_text": null,
          "old_line_content": "\t\t\t\tdp = diff_queue(&outq, null_two, p->two);",
          "new_line_content": "\t\t\t\tdp->broken_pair = 1;",
          "content_same": false
        },
        {
          "line": 75,
          "old_api": "count_delta",
          "new_api": null,
          "old_text": "count_delta(delta, delta_size,\n\t\t\t&src_copied, &literal_added)",
          "new_text": null,
          "old_line_content": "\tif (count_delta(delta, delta_size,",
          "new_line_content": "\tif (!delta)",
          "content_same": false
        },
        {
          "line": 77,
          "old_api": "free",
          "new_api": null,
          "old_text": "free(delta)",
          "new_text": null,
          "old_line_content": "\t\tfree(delta);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 207,
          "old_api": "diff_q",
          "new_api": null,
          "old_text": "diff_q(&outq, p)",
          "new_text": null,
          "old_line_content": "\t\tdiff_q(&outq, p);",
          "new_line_content": "\t\t\t\t\t  */",
          "content_same": false
        },
        {
          "line": 80,
          "old_api": "free",
          "new_api": null,
          "old_text": "free(delta)",
          "new_text": null,
          "old_line_content": "\tfree(delta);",
          "new_line_content": "\t\t\t&src_copied, &literal_added)) {",
          "content_same": false
        },
        {
          "line": 209,
          "old_api": "free",
          "new_api": null,
          "old_text": "free(q->queue)",
          "new_text": null,
          "old_line_content": "\tfree(q->queue);",
          "new_line_content": "\t\t\t}",
          "content_same": false
        },
        {
          "line": 221,
          "old_api": "DIFF_FILE_VALID",
          "new_api": null,
          "old_text": "DIFF_FILE_VALID(p->one)",
          "new_text": null,
          "old_line_content": "\tif (DIFF_FILE_VALID(p->one)) {",
          "new_line_content": "\t\t\t struct diff_queue_struct *outq)",
          "content_same": false
        },
        {
          "line": 226,
          "old_api": "DIFF_FILE_VALID",
          "new_api": null,
          "old_text": "DIFF_FILE_VALID(d->one)",
          "new_text": null,
          "old_line_content": "\tif (!DIFF_FILE_VALID(d->one))",
          "new_line_content": "\t\t/* this must be a delete half */",
          "content_same": false
        },
        {
          "line": 227,
          "old_api": "die",
          "new_api": null,
          "old_text": "die(\"internal error in merge #1\")",
          "new_text": null,
          "old_line_content": "\t\tdie(\"internal error in merge #1\");",
          "new_line_content": "\t\td = p; c = pp;",
          "content_same": false
        },
        {
          "line": 228,
          "old_api": "DIFF_FILE_VALID",
          "new_api": null,
          "old_text": "DIFF_FILE_VALID(d->two)",
          "new_text": null,
          "old_line_content": "\tif (DIFF_FILE_VALID(d->two))",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 229,
          "old_api": "die",
          "new_api": null,
          "old_text": "die(\"internal error in merge #2\")",
          "new_text": null,
          "old_line_content": "\t\tdie(\"internal error in merge #2\");",
          "new_line_content": "\t/* Sanity check */",
          "content_same": false
        },
        {
          "line": 238,
          "old_api": "diff_free_filespec_data",
          "new_api": null,
          "old_text": "diff_free_filespec_data(c->one)",
          "new_text": null,
          "old_line_content": "\tdiff_free_filespec_data(c->one);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 240,
          "old_api": "free",
          "new_api": null,
          "old_text": "free(c)",
          "new_text": null,
          "old_line_content": "\tfree(c);",
          "new_line_content": "\tdp->score = p->score;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 4,
      "total_additions": 30,
      "total_deletions": 29,
      "total_api_changes": 63
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 4,
        "api_related_lines": 63,
        "non_api_lines": 2,
        "non_api_line_numbers": [
          64,
          63
        ]
      }
    },
    "api_calls_before": 42,
    "api_calls_after": 43,
    "diff_info": {
      "added_lines": 4,
      "removed_lines": 0,
      "total_diff_lines": 16
    }
  }
}