{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/435c83323713066723e4194cd89c31bbec7011a2",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/435c83323713066723e4194cd89c31bbec7011a2/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/435c83323713066723e4194cd89c31bbec7011a2/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/435c83323713066723e4194cd89c31bbec7011a2/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 776,
          "old_api": "packet_flush",
          "new_api": "receive_needs",
          "old_text": "packet_flush(1)",
          "new_text": "receive_needs()",
          "old_line_content": "\t\tpacket_flush(1);",
          "new_line_content": "\treceive_needs();",
          "content_same": false
        },
        {
          "line": 778,
          "old_api": "head_ref_namespaced",
          "new_api": "get_common_commits",
          "old_text": "head_ref_namespaced(mark_our_ref, NULL)",
          "new_text": "get_common_commits()",
          "old_line_content": "\t\thead_ref_namespaced(mark_our_ref, NULL);",
          "new_line_content": "\t\tget_common_commits();",
          "content_same": false
        },
        {
          "line": 779,
          "old_api": "for_each_namespaced_ref",
          "new_api": "create_pack_file",
          "old_text": "for_each_namespaced_ref(mark_our_ref, NULL)",
          "new_text": "create_pack_file()",
          "old_line_content": "\t\tfor_each_namespaced_ref(mark_our_ref, NULL);",
          "new_line_content": "\t\tcreate_pack_file();",
          "content_same": false
        },
        {
          "line": 800,
          "old_api": "git_extract_argv0_path",
          "new_api": "strcmp",
          "old_text": "git_extract_argv0_path(argv[0])",
          "new_text": "strcmp(arg, \"--advertise-refs\")",
          "old_line_content": "\tgit_extract_argv0_path(argv[0]);",
          "new_line_content": "\t\tif (!strcmp(arg, \"--advertise-refs\")) {",
          "content_same": false
        },
        {
          "line": 812,
          "old_api": "strcmp",
          "new_api": "prefixcmp",
          "old_text": "strcmp(arg, \"--stateless-rpc\")",
          "new_text": "prefixcmp(arg, \"--timeout=\")",
          "old_line_content": "\t\tif (!strcmp(arg, \"--stateless-rpc\")) {",
          "new_line_content": "\t\tif (!prefixcmp(arg, \"--timeout=\")) {",
          "content_same": false
        },
        {
          "line": 832,
          "old_api": "usage",
          "new_api": "is_repository_shallow",
          "old_text": "usage(upload_pack_usage)",
          "new_text": "is_repository_shallow()",
          "old_line_content": "\t\tusage(upload_pack_usage);",
          "new_line_content": "\tif (is_repository_shallow())",
          "content_same": false
        },
        {
          "line": 834,
          "old_api": "setup_path",
          "new_api": "getenv",
          "old_text": "setup_path()",
          "new_text": "getenv(\"GIT_DEBUG_SEND_PACK\")",
          "old_line_content": "\tsetup_path();",
          "new_line_content": "\tif (getenv(\"GIT_DEBUG_SEND_PACK\"))",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 768,
          "old_api": null,
          "new_api": "packet_flush",
          "old_text": null,
          "new_text": "packet_flush(1)",
          "old_line_content": "}",
          "new_line_content": "\t\tpacket_flush(1);",
          "content_same": false
        },
        {
          "line": 770,
          "old_api": null,
          "new_api": "head_ref_namespaced",
          "old_text": null,
          "new_text": "head_ref_namespaced(mark_our_ref, NULL)",
          "old_line_content": "static void upload_pack(void)",
          "new_line_content": "\t\thead_ref_namespaced(mark_our_ref, NULL);",
          "content_same": false
        },
        {
          "line": 771,
          "old_api": null,
          "new_api": "for_each_namespaced_ref",
          "old_text": null,
          "new_text": "for_each_namespaced_ref(mark_our_ref, NULL)",
          "old_line_content": "{",
          "new_line_content": "\t\tfor_each_namespaced_ref(mark_our_ref, NULL);",
          "content_same": false
        },
        {
          "line": 789,
          "old_api": null,
          "new_api": "git_setup_gettext",
          "old_text": null,
          "new_text": "git_setup_gettext()",
          "old_line_content": "}",
          "new_line_content": "\tgit_setup_gettext();",
          "content_same": false
        },
        {
          "line": 791,
          "old_api": null,
          "new_api": "packet_trace_identity",
          "old_text": null,
          "new_text": "packet_trace_identity(\"upload-pack\")",
          "old_line_content": "int main(int argc, char **argv)",
          "new_line_content": "\tpacket_trace_identity(\"upload-pack\");",
          "content_same": false
        },
        {
          "line": 792,
          "old_api": null,
          "new_api": "git_extract_argv0_path",
          "old_text": null,
          "new_text": "git_extract_argv0_path(argv[0])",
          "old_line_content": "{",
          "new_line_content": "\tgit_extract_argv0_path(argv[0]);",
          "content_same": false
        },
        {
          "line": 804,
          "old_api": null,
          "new_api": "strcmp",
          "old_text": null,
          "new_text": "strcmp(arg, \"--stateless-rpc\")",
          "old_line_content": "\t\tchar *arg = argv[i];",
          "new_line_content": "\t\tif (!strcmp(arg, \"--stateless-rpc\")) {",
          "content_same": false
        },
        {
          "line": 813,
          "old_api": null,
          "new_api": "atoi",
          "old_text": null,
          "new_text": "atoi(arg+10)",
          "old_line_content": "\t\t\tstateless_rpc = 1;",
          "new_line_content": "\t\t\ttimeout = atoi(arg+10);",
          "content_same": false
        },
        {
          "line": 817,
          "old_api": null,
          "new_api": "strcmp",
          "old_text": null,
          "new_text": "strcmp(arg, \"--\")",
          "old_line_content": "\t\t\tstrict = 1;",
          "new_line_content": "\t\tif (!strcmp(arg, \"--\")) {",
          "content_same": false
        },
        {
          "line": 824,
          "old_api": null,
          "new_api": "usage",
          "old_text": null,
          "new_text": "usage(upload_pack_usage)",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\tusage(upload_pack_usage);",
          "content_same": false
        },
        {
          "line": 826,
          "old_api": null,
          "new_api": "setup_path",
          "old_text": null,
          "new_text": "setup_path()",
          "old_line_content": "\t\t\ti++;",
          "new_line_content": "\tsetup_path();",
          "content_same": false
        },
        {
          "line": 830,
          "old_api": null,
          "new_api": "enter_repo",
          "old_text": null,
          "new_text": "enter_repo(dir, strict)",
          "old_line_content": "",
          "new_line_content": "\tif (!enter_repo(dir, strict))",
          "content_same": false
        },
        {
          "line": 831,
          "old_api": null,
          "new_api": "die",
          "old_text": null,
          "new_text": "die(\"'%s' does not appear to be a git repository\", dir)",
          "old_line_content": "\tif (i != argc-1)",
          "new_line_content": "\t\tdie(\"'%s' does not appear to be a git repository\", dir);",
          "content_same": false
        },
        {
          "line": 833,
          "old_api": null,
          "new_api": "die",
          "old_text": null,
          "new_text": "die(\"attempt to fetch/clone from a shallow repository\")",
          "old_line_content": "",
          "new_line_content": "\t\tdie(\"attempt to fetch/clone from a shallow repository\");",
          "content_same": false
        },
        {
          "line": 835,
          "old_api": null,
          "new_api": "getenv",
          "old_text": null,
          "new_text": "getenv(\"GIT_DEBUG_SEND_PACK\")",
          "old_line_content": "",
          "new_line_content": "\t\tdebug_fd = atoi(getenv(\"GIT_DEBUG_SEND_PACK\"));",
          "content_same": false
        },
        {
          "line": 836,
          "old_api": null,
          "new_api": "upload_pack",
          "old_text": null,
          "new_text": "upload_pack()",
          "old_line_content": "\tdir = argv[i];",
          "new_line_content": "\tupload_pack();",
          "content_same": false
        },
        {
          "line": 733,
          "old_api": null,
          "new_api": "packet_write",
          "old_text": null,
          "new_text": "packet_write(1, \"%s %s%c%s%s agent=%s\\n\",\n\t\t\t     sha1_to_hex(sha1), refname_nons,\n\t\t\t     0, capabilities,\n\t\t\t     stateless_rpc ? \" no-done\" : \"\",\n\t\t\t     git_user_agent_sanitized())",
          "old_line_content": "\t\tif (o->type < 0)",
          "new_line_content": "\t\tpacket_write(1, \"%s %s%c%s%s agent=%s\\n\",",
          "content_same": false
        },
        {
          "line": 737,
          "old_api": null,
          "new_api": "git_user_agent_sanitized",
          "old_text": null,
          "new_text": "git_user_agent_sanitized()",
          "old_line_content": "\tif (capabilities)",
          "new_line_content": "\t\t\t     git_user_agent_sanitized());",
          "content_same": false
        },
        {
          "line": 745,
          "old_api": null,
          "new_api": "peel_ref",
          "old_text": null,
          "new_text": "peel_ref(refname, peeled)",
          "old_line_content": "\tcapabilities = NULL;",
          "new_line_content": "\tif (!peel_ref(refname, peeled))",
          "content_same": false
        },
        {
          "line": 746,
          "old_api": null,
          "new_api": "sha1_to_hex",
          "old_text": null,
          "new_text": "sha1_to_hex(peeled)",
          "old_line_content": "\tif (!(o->flags & OUR_REF)) {",
          "new_line_content": "\t\tpacket_write(1, \"%s %s^{}\\n\", sha1_to_hex(peeled), refname_nons);",
          "content_same": false
        },
        {
          "line": 752,
          "old_api": null,
          "new_api": "parse_object",
          "old_text": null,
          "new_text": "parse_object(sha1)",
          "old_line_content": "\t\tif (o)",
          "new_line_content": "\tstruct object *o = parse_object(sha1);",
          "content_same": false
        },
        {
          "line": 754,
          "old_api": null,
          "new_api": "sha1_to_hex",
          "old_text": null,
          "new_text": "sha1_to_hex(sha1)",
          "old_line_content": "\t}",
          "new_line_content": "\t\tdie(\"git upload-pack: cannot find object %s:\", sha1_to_hex(sha1));",
          "content_same": false
        },
        {
          "line": 765,
          "old_api": null,
          "new_api": "reset_timeout",
          "old_text": null,
          "new_text": "reset_timeout()",
          "old_line_content": "\t\tnr_our_refs++;",
          "new_line_content": "\t\treset_timeout();",
          "content_same": false
        },
        {
          "line": 766,
          "old_api": null,
          "new_api": "head_ref_namespaced",
          "old_text": null,
          "new_text": "head_ref_namespaced(send_ref, NULL)",
          "old_line_content": "\t}",
          "new_line_content": "\t\thead_ref_namespaced(send_ref, NULL);",
          "content_same": false
        },
        {
          "line": 767,
          "old_api": null,
          "new_api": "for_each_namespaced_ref",
          "old_text": null,
          "new_text": "for_each_namespaced_ref(send_ref, NULL)",
          "old_line_content": "\treturn 0;",
          "new_line_content": "\t\tfor_each_namespaced_ref(send_ref, NULL);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 773,
          "old_api": "reset_timeout",
          "new_api": null,
          "old_text": "reset_timeout()",
          "new_text": null,
          "old_line_content": "\t\treset_timeout();",
          "new_line_content": "\tif (advertise_refs)",
          "content_same": false
        },
        {
          "line": 774,
          "old_api": "head_ref_namespaced",
          "new_api": null,
          "old_text": "head_ref_namespaced(send_ref, NULL)",
          "new_text": null,
          "old_line_content": "\t\thead_ref_namespaced(send_ref, NULL);",
          "new_line_content": "\t\treturn;",
          "content_same": false
        },
        {
          "line": 775,
          "old_api": "for_each_namespaced_ref",
          "new_api": null,
          "old_text": "for_each_namespaced_ref(send_ref, NULL)",
          "new_text": null,
          "old_line_content": "\t\tfor_each_namespaced_ref(send_ref, NULL);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 784,
          "old_api": "receive_needs",
          "new_api": null,
          "old_text": "receive_needs()",
          "new_text": null,
          "old_line_content": "\treceive_needs();",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 786,
          "old_api": "get_common_commits",
          "new_api": null,
          "old_text": "get_common_commits()",
          "new_text": null,
          "old_line_content": "\t\tget_common_commits();",
          "new_line_content": "\tint i;",
          "content_same": false
        },
        {
          "line": 787,
          "old_api": "create_pack_file",
          "new_api": null,
          "old_text": "create_pack_file()",
          "new_text": null,
          "old_line_content": "\t\tcreate_pack_file();",
          "new_line_content": "\tint strict = 0;",
          "content_same": false
        },
        {
          "line": 797,
          "old_api": "git_setup_gettext",
          "new_api": null,
          "old_text": "git_setup_gettext()",
          "new_text": null,
          "old_line_content": "\tgit_setup_gettext();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 799,
          "old_api": "packet_trace_identity",
          "new_api": null,
          "old_text": "packet_trace_identity(\"upload-pack\")",
          "new_text": null,
          "old_line_content": "\tpacket_trace_identity(\"upload-pack\");",
          "new_line_content": "\t\t\tbreak;",
          "content_same": false
        },
        {
          "line": 816,
          "old_api": "strcmp",
          "new_api": null,
          "old_text": "strcmp(arg, \"--strict\")",
          "new_text": null,
          "old_line_content": "\t\tif (!strcmp(arg, \"--strict\")) {",
          "new_line_content": "\t\t}",
          "content_same": false
        },
        {
          "line": 820,
          "old_api": "prefixcmp",
          "new_api": null,
          "old_text": "prefixcmp(arg, \"--timeout=\")",
          "new_text": null,
          "old_line_content": "\t\tif (!prefixcmp(arg, \"--timeout=\")) {",
          "new_line_content": "\t\t}",
          "content_same": false
        },
        {
          "line": 821,
          "old_api": "atoi",
          "new_api": null,
          "old_text": "atoi(arg+10)",
          "new_text": null,
          "old_line_content": "\t\t\ttimeout = atoi(arg+10);",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 825,
          "old_api": "strcmp",
          "new_api": null,
          "old_text": "strcmp(arg, \"--\")",
          "new_text": null,
          "old_line_content": "\t\tif (!strcmp(arg, \"--\")) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 838,
          "old_api": "enter_repo",
          "new_api": null,
          "old_text": "enter_repo(dir, strict)",
          "new_text": null,
          "old_line_content": "\tif (!enter_repo(dir, strict))",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 839,
          "old_api": "die",
          "new_api": null,
          "old_text": "die(\"'%s' does not appear to be a git repository\", dir)",
          "new_text": null,
          "old_line_content": "\t\tdie(\"'%s' does not appear to be a git repository\", dir);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 840,
          "old_api": "is_repository_shallow",
          "new_api": null,
          "old_text": "is_repository_shallow()",
          "new_text": null,
          "old_line_content": "\tif (is_repository_shallow())",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 841,
          "old_api": "die",
          "new_api": null,
          "old_text": "die(\"attempt to fetch/clone from a shallow repository\")",
          "new_text": null,
          "old_line_content": "\t\tdie(\"attempt to fetch/clone from a shallow repository\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 842,
          "old_api": "getenv",
          "new_api": null,
          "old_text": "getenv(\"GIT_DEBUG_SEND_PACK\")",
          "new_text": null,
          "old_line_content": "\tif (getenv(\"GIT_DEBUG_SEND_PACK\"))",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 843,
          "old_api": "getenv",
          "new_api": null,
          "old_text": "getenv(\"GIT_DEBUG_SEND_PACK\")",
          "new_text": null,
          "old_line_content": "\t\tdebug_fd = atoi(getenv(\"GIT_DEBUG_SEND_PACK\"));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 844,
          "old_api": "upload_pack",
          "new_api": null,
          "old_text": "upload_pack()",
          "new_text": null,
          "old_line_content": "\tupload_pack();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 732,
          "old_api": "sha1_object_info",
          "new_api": null,
          "old_text": "sha1_object_info(sha1, NULL)",
          "new_text": null,
          "old_line_content": "\t\to->type = sha1_object_info(sha1, NULL);",
          "new_line_content": "\tif (capabilities)",
          "content_same": false
        },
        {
          "line": 738,
          "old_api": "packet_write",
          "new_api": null,
          "old_text": "packet_write(1, \"%s %s%c%s%s agent=%s\\n\",\n\t\t\t     sha1_to_hex(sha1), refname_nons,\n\t\t\t     0, capabilities,\n\t\t\t     stateless_rpc ? \" no-done\" : \"\",\n\t\t\t     git_user_agent_sanitized())",
          "new_text": null,
          "old_line_content": "\t\tpacket_write(1, \"%s %s%c%s%s agent=%s\\n\",",
          "new_line_content": "\telse",
          "content_same": false
        },
        {
          "line": 742,
          "old_api": "git_user_agent_sanitized",
          "new_api": null,
          "old_text": "git_user_agent_sanitized()",
          "new_text": null,
          "old_line_content": "\t\t\t     git_user_agent_sanitized());",
          "new_line_content": "\t\to->flags |= OUR_REF;",
          "content_same": false
        },
        {
          "line": 744,
          "old_api": "sha1_to_hex",
          "new_api": null,
          "old_text": "sha1_to_hex(sha1)",
          "new_text": null,
          "old_line_content": "\t\tpacket_write(1, \"%s %s\\n\", sha1_to_hex(sha1), refname_nons);",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 751,
          "old_api": "deref_tag_noverify",
          "new_api": null,
          "old_text": "deref_tag_noverify(o)",
          "new_text": null,
          "old_line_content": "\t\to = deref_tag_noverify(o);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 753,
          "old_api": "sha1_to_hex",
          "new_api": null,
          "old_text": "sha1_to_hex(o->sha1)",
          "new_text": null,
          "old_line_content": "\t\t\tpacket_write(1, \"%s %s^{}\\n\", sha1_to_hex(o->sha1), refname_nons);",
          "new_line_content": "\tif (!o)",
          "content_same": false
        },
        {
          "line": 760,
          "old_api": "parse_object",
          "new_api": null,
          "old_text": "parse_object(sha1)",
          "new_text": null,
          "old_line_content": "\tstruct object *o = parse_object(sha1);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 762,
          "old_api": "sha1_to_hex",
          "new_api": null,
          "old_text": "sha1_to_hex(sha1)",
          "new_text": null,
          "old_line_content": "\t\tdie(\"git upload-pack: cannot find object %s:\", sha1_to_hex(sha1));",
          "new_line_content": "static void upload_pack(void)",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 7,
      "total_additions": 25,
      "total_deletions": 27,
      "total_api_changes": 59
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 13,
        "api_related_lines": 59,
        "non_api_lines": 5,
        "non_api_line_numbers": [
          750,
          730,
          731,
          734,
          735
        ]
      }
    },
    "api_calls_before": 208,
    "api_calls_after": 205,
    "diff_info": {
      "added_lines": 3,
      "removed_lines": 11,
      "total_diff_lines": 33
    }
  }
}