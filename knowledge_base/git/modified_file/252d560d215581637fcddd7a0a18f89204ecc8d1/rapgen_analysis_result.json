{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/252d560d215581637fcddd7a0a18f89204ecc8d1",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/252d560d215581637fcddd7a0a18f89204ecc8d1/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/252d560d215581637fcddd7a0a18f89204ecc8d1/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/252d560d215581637fcddd7a0a18f89204ecc8d1/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 435,
          "old_api": "match_expr",
          "new_api": "match_one_pattern",
          "old_text": "match_expr(opt, bol, eol, ctx, collect_hits)",
          "new_text": "match_one_pattern(opt, p, bol, eol, ctx)",
          "old_line_content": "\t\treturn match_expr(opt, bol, eol, ctx, collect_hits);",
          "new_line_content": "\t\tif (match_one_pattern(opt, p, bol, eol, ctx))",
          "content_same": false
        },
        {
          "line": 513,
          "old_api": "printf",
          "new_api": "show_name",
          "old_text": "printf(\"Binary file %s matches\\n\", name)",
          "new_text": "show_name(opt, name)",
          "old_line_content": "\t\t\t\tprintf(\"Binary file %s matches\\n\", name);",
          "new_line_content": "\t\t\t\tshow_name(opt, name);",
          "content_same": false
        },
        {
          "line": 557,
          "old_api": "show_line",
          "new_api": "memmove",
          "old_text": "show_line(opt, bol, eol, name, lno, '-')",
          "new_text": "memmove(prev+1, prev,\n\t\t\t\t(opt->pre_context-1) * sizeof(*prev))",
          "old_line_content": "\t\t\tshow_line(opt, bol, eol, name, lno, '-');",
          "new_line_content": "\t\t\tmemmove(prev+1, prev,",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 397,
          "old_api": null,
          "new_api": "match_expr_eval",
          "old_text": null,
          "new_text": "match_expr_eval(o, x->u.binary.left, bol, eol, ctx, 0)",
          "old_line_content": "\t\tif (!collect_hits)",
          "new_line_content": "\t\tif (!match_expr_eval(o, x->u.binary.left, bol, eol, ctx, 0))",
          "content_same": false
        },
        {
          "line": 399,
          "old_api": null,
          "new_api": "match_expr_eval",
          "old_text": null,
          "new_text": "match_expr_eval(o, x->u.binary.right, bol, eol, ctx, 0)",
          "old_line_content": "\t\t\t\t\t\tbol, eol, ctx, 0) &&",
          "new_line_content": "\t\th = match_expr_eval(o, x->u.binary.right, bol, eol, ctx, 0);",
          "content_same": false
        },
        {
          "line": 531,
          "old_api": null,
          "new_api": "fputs",
          "old_text": null,
          "new_text": "fputs(hunk_mark, stdout)",
          "old_line_content": "\t\t\t\t\tfrom = 1;",
          "new_line_content": "\t\t\t\t\tfputs(hunk_mark, stdout);",
          "content_same": false
        },
        {
          "line": 405,
          "old_api": null,
          "new_api": "match_expr_eval",
          "old_text": null,
          "new_text": "match_expr_eval(o, x->u.binary.right,\n\t\t\t\t\t\tbol, eol, ctx, 0)",
          "old_line_content": "\tcase GREP_NODE_OR:",
          "new_line_content": "\t\t\t\tmatch_expr_eval(o, x->u.binary.right,",
          "content_same": false
        },
        {
          "line": 534,
          "old_api": null,
          "new_api": "show_line",
          "old_text": null,
          "new_text": "show_line(opt, pcl->bol, pcl->eol,\n\t\t\t\t\t\t  name, from, '-')",
          "old_line_content": "\t\t\t\tif (last_shown && from != last_shown + 1)",
          "new_line_content": "\t\t\t\t\tshow_line(opt, pcl->bol, pcl->eol,",
          "content_same": false
        },
        {
          "line": 412,
          "old_api": null,
          "new_api": "die",
          "old_text": null,
          "new_text": "die(\"Unexpected node type (internal error) %d\", x->node)",
          "old_line_content": "\t\tx->u.binary.left->hit |= h;",
          "new_line_content": "\t\tdie(\"Unexpected node type (internal error) %d\", x->node);",
          "content_same": false
        },
        {
          "line": 541,
          "old_api": null,
          "new_api": "fputs",
          "old_text": null,
          "new_text": "fputs(hunk_mark, stdout)",
          "old_line_content": "\t\t\t\t}",
          "new_line_content": "\t\t\t\tfputs(hunk_mark, stdout);",
          "content_same": false
        },
        {
          "line": 543,
          "old_api": null,
          "new_api": "show_line",
          "old_text": null,
          "new_text": "show_line(opt, bol, eol, name, lno, ':')",
          "old_line_content": "\t\t\t}",
          "new_line_content": "\t\t\t\tshow_line(opt, bol, eol, name, lno, ':');",
          "content_same": false
        },
        {
          "line": 423,
          "old_api": null,
          "new_api": "match_expr_eval",
          "old_text": null,
          "new_text": "match_expr_eval(opt, x, bol, eol, ctx, collect_hits)",
          "old_line_content": "static int match_expr(struct grep_opt *opt, char *bol, char *eol,",
          "new_line_content": "\treturn match_expr_eval(opt, x, bol, eol, ctx, collect_hits);",
          "content_same": false
        },
        {
          "line": 552,
          "old_api": null,
          "new_api": "fputs",
          "old_text": null,
          "new_text": "fputs(hunk_mark, stdout)",
          "old_line_content": "\t\t\t/* If the last hit is within the post context,",
          "new_line_content": "\t\t\t\tfputs(hunk_mark, stdout);",
          "content_same": false
        },
        {
          "line": 553,
          "old_api": null,
          "new_api": "show_line",
          "old_text": null,
          "new_text": "show_line(opt, bol, eol, name, lno, '-')",
          "old_line_content": "\t\t\t * we need to show this line.",
          "new_line_content": "\t\t\tshow_line(opt, bol, eol, name, lno, '-');",
          "content_same": false
        },
        {
          "line": 431,
          "old_api": null,
          "new_api": "match_expr",
          "old_text": null,
          "new_text": "match_expr(opt, bol, eol, ctx, collect_hits)",
          "old_line_content": "\t\t      enum grep_context ctx, int collect_hits)",
          "new_line_content": "\t\treturn match_expr(opt, bol, eol, ctx, collect_hits);",
          "content_same": false
        },
        {
          "line": 571,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free(prev)",
          "old_line_content": "\t\tleft--;",
          "new_line_content": "\tfree(prev);",
          "content_same": false
        },
        {
          "line": 579,
          "old_api": null,
          "new_api": "show_name",
          "old_text": null,
          "new_text": "show_name(opt, name)",
          "old_line_content": "\tif (opt->status_only)",
          "new_line_content": "\t\tshow_name(opt, name);",
          "content_same": false
        },
        {
          "line": 458,
          "old_api": null,
          "new_api": "buffer_is_binary",
          "old_text": null,
          "new_text": "buffer_is_binary(buf, size)",
          "old_line_content": "\tconst char *hunk_mark = \"\";",
          "new_line_content": "\tif (buffer_is_binary(buf, size)) {",
          "content_same": false
        },
        {
          "line": 589,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\"%s%c%u\\n\", name,\n\t\t       opt->null_following_name ? '\\0' : ':', count)",
          "old_line_content": "\t * which feels mostly useless but sometimes useful.  Maybe",
          "new_line_content": "\t\tprintf(\"%s%c%u\\n\", name,",
          "content_same": false
        },
        {
          "line": 472,
          "old_api": null,
          "new_api": "xcalloc",
          "old_text": null,
          "new_text": "xcalloc(opt->pre_context, sizeof(*prev))",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\tprev = xcalloc(opt->pre_context, sizeof(*prev));",
          "content_same": false
        },
        {
          "line": 480,
          "old_api": null,
          "new_api": "end_of_line",
          "old_text": null,
          "new_text": "end_of_line(bol, &left)",
          "old_line_content": "\twhile (left) {",
          "new_line_content": "\t\teol = end_of_line(bol, &left);",
          "content_same": false
        },
        {
          "line": 487,
          "old_api": null,
          "new_api": "match_line",
          "old_text": null,
          "new_text": "match_line(opt, bol, eol, ctx, collect_hits)",
          "old_line_content": "",
          "new_line_content": "\t\thit = match_line(opt, bol, eol, ctx, collect_hits);",
          "content_same": false
        },
        {
          "line": 627,
          "old_api": null,
          "new_api": "grep_buffer_1",
          "old_text": null,
          "new_text": "grep_buffer_1(opt, name, buf, size, 0)",
          "old_line_content": "\t * we do not have to do the two-pass grep when we do not check",
          "new_line_content": "\t\treturn grep_buffer_1(opt, name, buf, size, 0);",
          "content_same": false
        },
        {
          "line": 632,
          "old_api": null,
          "new_api": "clr_hit_marker",
          "old_text": null,
          "new_text": "clr_hit_marker(opt->pattern_expression)",
          "old_line_content": "",
          "new_line_content": "\tclr_hit_marker(opt->pattern_expression);",
          "content_same": false
        },
        {
          "line": 633,
          "old_api": null,
          "new_api": "grep_buffer_1",
          "old_text": null,
          "new_text": "grep_buffer_1(opt, name, buf, size, 1)",
          "old_line_content": "\t/* Otherwise the toplevel \"or\" terms hit a bit differently.",
          "new_line_content": "\tgrep_buffer_1(opt, name, buf, size, 1);",
          "content_same": false
        },
        {
          "line": 635,
          "old_api": null,
          "new_api": "chk_hit_marker",
          "old_text": null,
          "new_text": "chk_hit_marker(opt->pattern_expression)",
          "old_line_content": "\t */",
          "new_line_content": "\tif (!chk_hit_marker(opt->pattern_expression))",
          "content_same": false
        },
        {
          "line": 509,
          "old_api": null,
          "new_api": "printf",
          "old_text": null,
          "new_text": "printf(\"Binary file %s matches\\n\", name)",
          "old_line_content": "\t\t\tcount++;",
          "new_line_content": "\t\t\t\tprintf(\"Binary file %s matches\\n\", name);",
          "content_same": false
        },
        {
          "line": 638,
          "old_api": null,
          "new_api": "grep_buffer_1",
          "old_text": null,
          "new_text": "grep_buffer_1(opt, name, buf, size, 0)",
          "old_line_content": "",
          "new_line_content": "\treturn grep_buffer_1(opt, name, buf, size, 0);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 642,
          "old_api": "grep_buffer_1",
          "new_api": null,
          "old_text": "grep_buffer_1(opt, name, buf, size, 0)",
          "new_text": null,
          "old_line_content": "\treturn grep_buffer_1(opt, name, buf, size, 0);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 517,
          "old_api": "show_name",
          "new_api": null,
          "old_text": "show_name(opt, name)",
          "new_text": null,
          "old_line_content": "\t\t\t\tshow_name(opt, name);",
          "new_line_content": "\t\t\t * pre-context lines, we would need to show them.",
          "content_same": false
        },
        {
          "line": 398,
          "old_api": "match_expr_eval",
          "new_api": null,
          "old_text": "match_expr_eval(o, x->u.binary.left,\n\t\t\t\t\t\tbol, eol, ctx, 0)",
          "new_text": null,
          "old_line_content": "\t\t\treturn (match_expr_eval(o, x->u.binary.left,",
          "new_line_content": "\t\t\treturn 0;",
          "content_same": false
        },
        {
          "line": 400,
          "old_api": "match_expr_eval",
          "new_api": null,
          "old_text": "match_expr_eval(o, x->u.binary.right,\n\t\t\t\t\t\tbol, eol, ctx, 0)",
          "new_text": null,
          "old_line_content": "\t\t\t\tmatch_expr_eval(o, x->u.binary.right,",
          "new_line_content": "\t\tbreak;",
          "content_same": false
        },
        {
          "line": 402,
          "old_api": "match_expr_eval",
          "new_api": null,
          "old_text": "match_expr_eval(o, x->u.binary.left, bol, eol, ctx, 0)",
          "new_text": null,
          "old_line_content": "\t\th = match_expr_eval(o, x->u.binary.left, bol, eol, ctx, 0);",
          "new_line_content": "\t\tif (!collect_hits)",
          "content_same": false
        },
        {
          "line": 535,
          "old_api": "fputs",
          "new_api": null,
          "old_text": "fputs(hunk_mark, stdout)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\tfputs(hunk_mark, stdout);",
          "new_line_content": "\t\t\t\t\t\t  name, from, '-');",
          "content_same": false
        },
        {
          "line": 538,
          "old_api": "show_line",
          "new_api": null,
          "old_text": "show_line(opt, pcl->bol, pcl->eol,\n\t\t\t\t\t\t  name, from, '-')",
          "new_text": null,
          "old_line_content": "\t\t\t\t\tshow_line(opt, pcl->bol, pcl->eol,",
          "new_line_content": "\t\t\t\tlast_shown = lno-1;",
          "content_same": false
        },
        {
          "line": 411,
          "old_api": "match_expr_eval",
          "new_api": null,
          "old_text": "match_expr_eval(o, x->u.binary.left, bol, eol, ctx, 0)",
          "new_text": null,
          "old_line_content": "\t\th = match_expr_eval(o, x->u.binary.left, bol, eol, ctx, 0);",
          "new_line_content": "\tdefault:",
          "content_same": false
        },
        {
          "line": 413,
          "old_api": "match_expr_eval",
          "new_api": null,
          "old_text": "match_expr_eval(o, x->u.binary.right, bol, eol, ctx, 1)",
          "new_text": null,
          "old_line_content": "\t\th |= match_expr_eval(o, x->u.binary.right, bol, eol, ctx, 1);",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 416,
          "old_api": "die",
          "new_api": null,
          "old_text": "die(\"Unexpected node type (internal error) %d\", x->node)",
          "new_text": null,
          "old_line_content": "\t\tdie(\"Unexpected node type (internal error) %d\", x->node);",
          "new_line_content": "\treturn h;",
          "content_same": false
        },
        {
          "line": 545,
          "old_api": "fputs",
          "new_api": null,
          "old_text": "fputs(hunk_mark, stdout)",
          "new_text": null,
          "old_line_content": "\t\t\t\tfputs(hunk_mark, stdout);",
          "new_line_content": "\t\t}",
          "content_same": false
        },
        {
          "line": 547,
          "old_api": "show_line",
          "new_api": null,
          "old_text": "show_line(opt, bol, eol, name, lno, ':')",
          "new_text": null,
          "old_line_content": "\t\t\t\tshow_line(opt, bol, eol, name, lno, ':');",
          "new_line_content": "\t\t\t lno <= last_hit + opt->post_context) {",
          "content_same": false
        },
        {
          "line": 427,
          "old_api": "match_expr_eval",
          "new_api": null,
          "old_text": "match_expr_eval(opt, x, bol, eol, ctx, collect_hits)",
          "new_text": null,
          "old_line_content": "\treturn match_expr_eval(opt, x, bol, eol, ctx, collect_hits);",
          "new_line_content": "\t\t      enum grep_context ctx, int collect_hits)",
          "content_same": false
        },
        {
          "line": 556,
          "old_api": "fputs",
          "new_api": null,
          "old_text": "fputs(hunk_mark, stdout)",
          "new_text": null,
          "old_line_content": "\t\t\t\tfputs(hunk_mark, stdout);",
          "new_line_content": "\t\tif (opt->pre_context) {",
          "content_same": false
        },
        {
          "line": 561,
          "old_api": "memmove",
          "new_api": null,
          "old_text": "memmove(prev+1, prev,\n\t\t\t\t(opt->pre_context-1) * sizeof(*prev))",
          "new_text": null,
          "old_line_content": "\t\t\tmemmove(prev+1, prev,",
          "new_line_content": "\t\t}",
          "content_same": false
        },
        {
          "line": 439,
          "old_api": "match_one_pattern",
          "new_api": null,
          "old_text": "match_one_pattern(opt, p, bol, eol, ctx)",
          "new_text": null,
          "old_line_content": "\t\tif (match_one_pattern(opt, p, bol, eol, ctx))",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 575,
          "old_api": "free",
          "new_api": null,
          "old_text": "free(prev)",
          "new_text": null,
          "old_line_content": "\tfree(prev);",
          "new_line_content": "\tif (opt->status_only)",
          "content_same": false
        },
        {
          "line": 583,
          "old_api": "show_name",
          "new_api": null,
          "old_text": "show_name(opt, name)",
          "new_text": null,
          "old_line_content": "\t\tshow_name(opt, name);",
          "new_line_content": "\t/* NEEDSWORK:",
          "content_same": false
        },
        {
          "line": 462,
          "old_api": "buffer_is_binary",
          "new_api": null,
          "old_text": "buffer_is_binary(buf, size)",
          "new_text": null,
          "old_line_content": "\tif (buffer_is_binary(buf, size)) {",
          "new_line_content": "\t\t\tbreak;",
          "content_same": false
        },
        {
          "line": 593,
          "old_api": "printf",
          "new_api": null,
          "old_text": "printf(\"%s%c%u\\n\", name,\n\t\t       opt->null_following_name ? '\\0' : ':', count)",
          "new_text": null,
          "old_line_content": "\t\tprintf(\"%s%c%u\\n\", name,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 476,
          "old_api": "xcalloc",
          "new_api": null,
          "old_text": "xcalloc(opt->pre_context, sizeof(*prev))",
          "new_text": null,
          "old_line_content": "\t\tprev = xcalloc(opt->pre_context, sizeof(*prev));",
          "new_line_content": "\twhile (left) {",
          "content_same": false
        },
        {
          "line": 484,
          "old_api": "end_of_line",
          "new_api": null,
          "old_text": "end_of_line(bol, &left)",
          "new_text": null,
          "old_line_content": "\t\teol = end_of_line(bol, &left);",
          "new_line_content": "\t\tif ((ctx == GREP_CONTEXT_HEAD) && (eol == bol))",
          "content_same": false
        },
        {
          "line": 491,
          "old_api": "match_line",
          "new_api": null,
          "old_text": "match_line(opt, bol, eol, ctx, collect_hits)",
          "new_text": null,
          "old_line_content": "\t\thit = match_line(opt, bol, eol, ctx, collect_hits);",
          "new_line_content": "\t\t\tgoto next_line;",
          "content_same": false
        },
        {
          "line": 631,
          "old_api": "grep_buffer_1",
          "new_api": null,
          "old_text": "grep_buffer_1(opt, name, buf, size, 0)",
          "new_text": null,
          "old_line_content": "\t\treturn grep_buffer_1(opt, name, buf, size, 0);",
          "new_line_content": "\t */",
          "content_same": false
        },
        {
          "line": 636,
          "old_api": "clr_hit_marker",
          "new_api": null,
          "old_text": "clr_hit_marker(opt->pattern_expression)",
          "new_text": null,
          "old_line_content": "\tclr_hit_marker(opt->pattern_expression);",
          "new_line_content": "\t\treturn 0;",
          "content_same": false
        },
        {
          "line": 637,
          "old_api": "grep_buffer_1",
          "new_api": null,
          "old_text": "grep_buffer_1(opt, name, buf, size, 1)",
          "new_text": null,
          "old_line_content": "\tgrep_buffer_1(opt, name, buf, size, 1);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 639,
          "old_api": "chk_hit_marker",
          "new_api": null,
          "old_text": "chk_hit_marker(opt->pattern_expression)",
          "new_text": null,
          "old_line_content": "\tif (!chk_hit_marker(opt->pattern_expression))",
          "new_line_content": "}",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 3,
      "total_additions": 25,
      "total_deletions": 27,
      "total_api_changes": 55
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 7,
        "api_related_lines": 55,
        "non_api_lines": 2,
        "non_api_line_numbers": [
          401,
          403
        ]
      }
    },
    "api_calls_before": 91,
    "api_calls_after": 89,
    "diff_info": {
      "added_lines": 3,
      "removed_lines": 7,
      "total_diff_lines": 22
    }
  }
}