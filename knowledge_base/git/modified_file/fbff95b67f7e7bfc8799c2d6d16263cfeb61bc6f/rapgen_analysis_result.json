{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/fbff95b67f7e7bfc8799c2d6d16263cfeb61bc6f",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/fbff95b67f7e7bfc8799c2d6d16263cfeb61bc6f/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/fbff95b67f7e7bfc8799c2d6d16263cfeb61bc6f/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/fbff95b67f7e7bfc8799c2d6d16263cfeb61bc6f/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 1820,
          "old_api": "check_objects",
          "new_api": "parse_pack_header",
          "old_text": "check_objects()",
          "new_text": "parse_pack_header()",
          "old_line_content": "\t\tforeign_nr = check_objects();",
          "new_line_content": "\tparse_pack_header();",
          "content_same": false
        },
        {
          "line": 1823,
          "old_api": "show_pack_info",
          "new_api": "st_add",
          "old_text": "show_pack_info(stat_only)",
          "new_text": "st_add(nr_objects, 1)",
          "old_line_content": "\t\tshow_pack_info(stat_only);",
          "new_line_content": "\t\tobj_stat = xcalloc(st_add(nr_objects, 1), sizeof(struct object_stat));",
          "content_same": false
        },
        {
          "line": 1825,
          "old_api": "ALLOC_ARRAY",
          "new_api": "parse_pack_objects",
          "old_text": "ALLOC_ARRAY(idx_objects, nr_objects)",
          "new_text": "parse_pack_objects(pack_hash)",
          "old_line_content": "\tALLOC_ARRAY(idx_objects, nr_objects);",
          "new_line_content": "\tparse_pack_objects(pack_hash);",
          "content_same": false
        },
        {
          "line": 1828,
          "old_api": "write_idx_file",
          "new_api": "resolve_deltas",
          "old_text": "write_idx_file(index_name, idx_objects, nr_objects, &opts, pack_hash)",
          "new_text": "resolve_deltas()",
          "old_line_content": "\tcurr_index = write_idx_file(index_name, idx_objects, nr_objects, &opts, pack_hash);",
          "new_line_content": "\tresolve_deltas();",
          "content_same": false
        },
        {
          "line": 1829,
          "old_api": "free",
          "new_api": "conclude_pack",
          "old_text": "free(idx_objects)",
          "new_text": "conclude_pack(fix_thin_pack, curr_pack, pack_hash)",
          "old_line_content": "\tfree(idx_objects);",
          "new_line_content": "\tconclude_pack(fix_thin_pack, curr_pack, pack_hash);",
          "content_same": false
        },
        {
          "line": 1845,
          "old_api": "free",
          "new_api": "final",
          "old_text": "free((void *) curr_pack)",
          "new_text": "final(pack_name, curr_pack,\n\t\t      index_name, curr_index,\n\t\t      keep_msg, promisor_msg,\n\t\t      pack_hash)",
          "old_line_content": "\t\tfree((void *) curr_pack);",
          "new_line_content": "\t\tfinal(pack_name, curr_pack,",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 1824,
          "old_api": null,
          "new_api": "xcalloc",
          "old_text": null,
          "new_text": "xcalloc(nr_objects, sizeof(struct ofs_delta_entry))",
          "old_line_content": "",
          "new_line_content": "\tofs_deltas = xcalloc(nr_objects, sizeof(struct ofs_delta_entry));",
          "content_same": false
        },
        {
          "line": 1856,
          "old_api": null,
          "new_api": "strbuf_release",
          "old_text": null,
          "new_text": "strbuf_release(&index_name_buf)",
          "old_line_content": "}",
          "new_line_content": "\tstrbuf_release(&index_name_buf);",
          "content_same": false
        },
        {
          "line": 1858,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free((void *) curr_pack)",
          "old_line_content": "",
          "new_line_content": "\t\tfree((void *) curr_pack);",
          "content_same": false
        },
        {
          "line": 1827,
          "old_api": null,
          "new_api": "write_in_full",
          "old_text": null,
          "new_text": "write_in_full(2, \"\\0\", 1)",
          "old_line_content": "\t\tidx_objects[i] = &objects[i].idx;",
          "new_line_content": "\t\twrite_in_full(2, \"\\0\", 1);",
          "content_same": false
        },
        {
          "line": 1860,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free((void *) curr_index)",
          "old_line_content": "",
          "new_line_content": "\t\tfree((void *) curr_index);",
          "content_same": false
        },
        {
          "line": 1830,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free(ofs_deltas)",
          "old_line_content": "",
          "new_line_content": "\tfree(ofs_deltas);",
          "content_same": false
        },
        {
          "line": 1831,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free(ref_deltas)",
          "old_line_content": "\tif (!verify)",
          "new_line_content": "\tfree(ref_deltas);",
          "content_same": false
        },
        {
          "line": 1833,
          "old_api": null,
          "new_api": "check_objects",
          "old_text": null,
          "new_text": "check_objects()",
          "old_line_content": "\t\t      index_name, curr_index,",
          "new_line_content": "\t\tforeign_nr = check_objects();",
          "content_same": false
        },
        {
          "line": 1853,
          "old_api": null,
          "new_api": "_",
          "old_text": null,
          "new_text": "_(\"fsck error in pack objects\")",
          "old_line_content": "\t\treturn 1;",
          "new_line_content": "\t\tdie(_(\"fsck error in pack objects\"));",
          "content_same": false
        },
        {
          "line": 1836,
          "old_api": null,
          "new_api": "show_pack_info",
          "old_text": null,
          "new_text": "show_pack_info(stat_only)",
          "old_line_content": "\telse",
          "new_line_content": "\t\tshow_pack_info(stat_only);",
          "content_same": false
        },
        {
          "line": 1838,
          "old_api": null,
          "new_api": "ALLOC_ARRAY",
          "old_text": null,
          "new_text": "ALLOC_ARRAY(idx_objects, nr_objects)",
          "old_line_content": "",
          "new_line_content": "\tALLOC_ARRAY(idx_objects, nr_objects);",
          "content_same": false
        },
        {
          "line": 1841,
          "old_api": null,
          "new_api": "write_idx_file",
          "old_text": null,
          "new_text": "write_idx_file(index_name, idx_objects, nr_objects, &opts, pack_hash)",
          "old_line_content": "",
          "new_line_content": "\tcurr_index = write_idx_file(index_name, idx_objects, nr_objects, &opts, pack_hash);",
          "content_same": false
        },
        {
          "line": 1850,
          "old_api": null,
          "new_api": "close",
          "old_text": null,
          "new_text": "close(input_fd)",
          "old_line_content": "\t * Let the caller know this pack is not self contained",
          "new_line_content": "\t\tclose(input_fd);",
          "content_same": false
        },
        {
          "line": 1819,
          "old_api": null,
          "new_api": "open_pack_file",
          "old_text": null,
          "new_text": "open_pack_file(pack_name)",
          "old_line_content": "\tif (strict)",
          "new_line_content": "\tcurr_pack = open_pack_file(pack_name);",
          "content_same": false
        },
        {
          "line": 1852,
          "old_api": null,
          "new_api": "fsck_finish",
          "old_text": null,
          "new_text": "fsck_finish(&fsck_options)",
          "old_line_content": "\tif (check_self_contained_and_connected && foreign_nr)",
          "new_line_content": "\tif (do_fsck_object && fsck_finish(&fsck_options))",
          "content_same": false
        },
        {
          "line": 1821,
          "old_api": null,
          "new_api": "st_add",
          "old_text": null,
          "new_text": "st_add(nr_objects, 1)",
          "old_line_content": "",
          "new_line_content": "\tobjects = xcalloc(st_add(nr_objects, 1), sizeof(struct object_entry));",
          "content_same": false
        },
        {
          "line": 1855,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free(objects)",
          "old_line_content": "\treturn 0;",
          "new_line_content": "\tfree(objects);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 1847,
          "old_api": "free",
          "new_api": null,
          "old_text": "free((void *) curr_index)",
          "new_text": null,
          "old_line_content": "\t\tfree((void *) curr_index);",
          "new_line_content": "\t\t      keep_msg, promisor_msg,",
          "content_same": false
        },
        {
          "line": 1832,
          "old_api": "final",
          "new_api": null,
          "old_text": "final(pack_name, curr_pack,\n\t\t      index_name, curr_index,\n\t\t      keep_msg, promisor_msg,\n\t\t      pack_hash)",
          "new_text": null,
          "old_line_content": "\t\tfinal(pack_name, curr_pack,",
          "new_line_content": "\tif (strict)",
          "content_same": false
        },
        {
          "line": 1837,
          "old_api": "close",
          "new_api": null,
          "old_text": "close(input_fd)",
          "new_text": null,
          "old_line_content": "\t\tclose(input_fd);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1806,
          "old_api": "open_pack_file",
          "new_api": null,
          "old_text": "open_pack_file(pack_name)",
          "new_text": null,
          "old_line_content": "\tcurr_pack = open_pack_file(pack_name);",
          "new_line_content": "\t\t * never reduce the level below \"3\", though, to match a",
          "content_same": false
        },
        {
          "line": 1807,
          "old_api": "parse_pack_header",
          "new_api": null,
          "old_text": "parse_pack_header()",
          "new_text": null,
          "old_line_content": "\tparse_pack_header();",
          "new_line_content": "\t\t * historical value that nobody complained about.",
          "content_same": false
        },
        {
          "line": 1808,
          "old_api": "st_add",
          "new_api": null,
          "old_text": "st_add(nr_objects, 1)",
          "new_text": null,
          "old_line_content": "\tobjects = xcalloc(st_add(nr_objects, 1), sizeof(struct object_entry));",
          "new_line_content": "\t\t */",
          "content_same": false
        },
        {
          "line": 1839,
          "old_api": "fsck_finish",
          "new_api": null,
          "old_text": "fsck_finish(&fsck_options)",
          "new_text": null,
          "old_line_content": "\tif (do_fsck_object && fsck_finish(&fsck_options))",
          "new_line_content": "\tfor (i = 0; i < nr_objects; i++)",
          "content_same": false
        },
        {
          "line": 1810,
          "old_api": "st_add",
          "new_api": null,
          "old_text": "st_add(nr_objects, 1)",
          "new_text": null,
          "old_line_content": "\t\tobj_stat = xcalloc(st_add(nr_objects, 1), sizeof(struct object_stat));",
          "new_line_content": "\t\t\t; /* too few cores to consider capping */",
          "content_same": false
        },
        {
          "line": 1811,
          "old_api": "xcalloc",
          "new_api": null,
          "old_text": "xcalloc(nr_objects, sizeof(struct ofs_delta_entry))",
          "new_text": null,
          "old_line_content": "\tofs_deltas = xcalloc(nr_objects, sizeof(struct ofs_delta_entry));",
          "new_line_content": "\t\telse if (nr_threads < 6)",
          "content_same": false
        },
        {
          "line": 1812,
          "old_api": "parse_pack_objects",
          "new_api": null,
          "old_text": "parse_pack_objects(pack_hash)",
          "new_text": null,
          "old_line_content": "\tparse_pack_objects(pack_hash);",
          "new_line_content": "\t\t\tnr_threads = 3; /* historic cap */",
          "content_same": false
        },
        {
          "line": 1840,
          "old_api": "_",
          "new_api": null,
          "old_text": "_(\"fsck error in pack objects\")",
          "new_text": null,
          "old_line_content": "\t\tdie(_(\"fsck error in pack objects\"));",
          "new_line_content": "\t\tidx_objects[i] = &objects[i].idx;",
          "content_same": false
        },
        {
          "line": 1814,
          "old_api": "write_in_full",
          "new_api": null,
          "old_text": "write_in_full(2, \"\\0\", 1)",
          "new_text": null,
          "old_line_content": "\t\twrite_in_full(2, \"\\0\", 1);",
          "new_line_content": "\t\t\tnr_threads /= 2;",
          "content_same": false
        },
        {
          "line": 1815,
          "old_api": "resolve_deltas",
          "new_api": null,
          "old_text": "resolve_deltas()",
          "new_text": null,
          "old_line_content": "\tresolve_deltas();",
          "new_line_content": "\t\telse",
          "content_same": false
        },
        {
          "line": 1816,
          "old_api": "conclude_pack",
          "new_api": null,
          "old_text": "conclude_pack(fix_thin_pack, curr_pack, pack_hash)",
          "new_text": null,
          "old_line_content": "\tconclude_pack(fix_thin_pack, curr_pack, pack_hash);",
          "new_line_content": "\t\t\tnr_threads = 20; /* hard cap */",
          "content_same": false
        },
        {
          "line": 1817,
          "old_api": "free",
          "new_api": null,
          "old_text": "free(ofs_deltas)",
          "new_text": null,
          "old_line_content": "\tfree(ofs_deltas);",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 1818,
          "old_api": "free",
          "new_api": null,
          "old_text": "free(ref_deltas)",
          "new_text": null,
          "old_line_content": "\tfree(ref_deltas);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1843,
          "old_api": "strbuf_release",
          "new_api": null,
          "old_text": "strbuf_release(&index_name_buf)",
          "new_text": null,
          "old_line_content": "\tstrbuf_release(&index_name_buf);",
          "new_line_content": "",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 6,
      "total_additions": 17,
      "total_deletions": 17,
      "total_api_changes": 40
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 16,
        "api_related_lines": 40,
        "non_api_lines": 7,
        "non_api_line_numbers": [
          1801,
          1802,
          1803,
          1804,
          1805,
          1809,
          1813
        ]
      }
    },
    "api_calls_before": 561,
    "api_calls_after": 561,
    "diff_info": {
      "added_lines": 16,
      "removed_lines": 3,
      "total_diff_lines": 31
    }
  }
}