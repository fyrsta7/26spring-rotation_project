{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/5473aca3767b00eab502b34a37b595de099980ae",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/5473aca3767b00eab502b34a37b595de099980ae/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/5473aca3767b00eab502b34a37b595de099980ae/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/5473aca3767b00eab502b34a37b595de099980ae/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": true,
    "api_changes": {
      "replacements": [
        {
          "line": 139,
          "old_api": "merged_iter_next_entry",
          "new_api": "reftable_record_is_deletion",
          "old_text": "merged_iter_next_entry(mi, rec)",
          "new_text": "reftable_record_is_deletion(rec)",
          "old_line_content": "\t\tint err = merged_iter_next_entry(mi, rec);",
          "new_line_content": "\t\t    reftable_record_is_deletion(rec)) {",
          "content_same": false
        },
        {
          "line": 181,
          "old_api": "reftable_table_max_update_index",
          "new_api": "reftable_table_hash_id",
          "old_text": "reftable_table_max_update_index(&stack[i])",
          "new_text": "reftable_table_hash_id(&stack[i])",
          "old_line_content": "\t\tuint64_t max = reftable_table_max_update_index(&stack[i]);",
          "new_line_content": "\t\tif (reftable_table_hash_id(&stack[i]) != hash_id) {",
          "content_same": false
        },
        {
          "line": 269,
          "old_api": "reftable_iterator_destroy",
          "new_api": "reftable_free",
          "old_text": "reftable_iterator_destroy(&iters[i])",
          "new_text": "reftable_free(iters)",
          "old_line_content": "\t\t\treftable_iterator_destroy(&iters[i]);",
          "new_line_content": "\t\treftable_free(iters);",
          "content_same": false
        },
        {
          "line": 276,
          "old_api": "merged_iter_init",
          "new_api": "merged_iter_close",
          "old_text": "merged_iter_init(&merged)",
          "new_text": "merged_iter_close(&merged)",
          "old_line_content": "\terr = merged_iter_init(&merged);",
          "new_line_content": "\t\tmerged_iter_close(&merged);",
          "content_same": false
        },
        {
          "line": 282,
          "old_api": "reftable_malloc",
          "new_api": "iterator_from_merged_iter",
          "old_text": "reftable_malloc(sizeof(struct merged_iter))",
          "new_text": "iterator_from_merged_iter(it, p)",
          "old_line_content": "\t\t\treftable_malloc(sizeof(struct merged_iter));",
          "new_line_content": "\t\titerator_from_merged_iter(it, p);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 137,
          "old_api": null,
          "new_api": "merged_iter_next_entry",
          "old_text": null,
          "new_text": "merged_iter_next_entry(mi, rec)",
          "old_line_content": "{",
          "new_line_content": "\t\tint err = merged_iter_next_entry(mi, rec);",
          "content_same": false
        },
        {
          "line": 267,
          "old_api": null,
          "new_api": "reftable_iterator_destroy",
          "old_text": null,
          "new_text": "reftable_iterator_destroy(&iters[i])",
          "old_line_content": "\t\tint i = 0;",
          "new_line_content": "\t\t\treftable_iterator_destroy(&iters[i]);",
          "content_same": false
        },
        {
          "line": 274,
          "old_api": null,
          "new_api": "merged_iter_init",
          "old_text": null,
          "new_text": "merged_iter_init(&merged)",
          "old_line_content": "",
          "new_line_content": "\terr = merged_iter_init(&merged);",
          "content_same": false
        },
        {
          "line": 150,
          "old_api": null,
          "new_api": "merged_iter_pqueue_is_empty",
          "old_text": null,
          "new_text": "merged_iter_pqueue_is_empty(mi->pq)",
          "old_line_content": "{",
          "new_line_content": "\tif (merged_iter_pqueue_is_empty(mi->pq))",
          "content_same": false
        },
        {
          "line": 280,
          "old_api": null,
          "new_api": "reftable_malloc",
          "old_text": null,
          "new_text": "reftable_malloc(sizeof(struct merged_iter))",
          "old_line_content": "\t} else {",
          "new_line_content": "\t\t\treftable_malloc(sizeof(struct merged_iter));",
          "content_same": false
        },
        {
          "line": 153,
          "old_api": null,
          "new_api": "merged_iter_next",
          "old_text": null,
          "new_text": "merged_iter_next(mi, rec)",
          "old_line_content": "\t\treturn 1;",
          "new_line_content": "\treturn merged_iter_next(mi, rec);",
          "content_same": false
        },
        {
          "line": 164,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(!it->ops)",
          "old_line_content": "\t\t\t\t      struct merged_iter *mi)",
          "new_line_content": "\tassert(!it->ops);",
          "content_same": false
        },
        {
          "line": 297,
          "old_api": null,
          "new_api": "merged_table_seek_record",
          "old_text": null,
          "new_text": "merged_table_seek_record(mt, it, &rec)",
          "old_line_content": "\t\t},",
          "new_line_content": "\treturn merged_table_seek_record(mt, it, &rec);",
          "content_same": false
        },
        {
          "line": 178,
          "old_api": null,
          "new_api": "reftable_table_min_update_index",
          "old_text": null,
          "new_text": "reftable_table_min_update_index(&stack[i])",
          "old_line_content": "\tint i = 0;",
          "new_line_content": "\t\tuint64_t min = reftable_table_min_update_index(&stack[i]);",
          "content_same": false
        },
        {
          "line": 179,
          "old_api": null,
          "new_api": "reftable_table_max_update_index",
          "old_text": null,
          "new_text": "reftable_table_max_update_index(&stack[i])",
          "old_line_content": "\tfor (i = 0; i < n; i++) {",
          "new_line_content": "\t\tuint64_t max = reftable_table_max_update_index(&stack[i]);",
          "content_same": false
        },
        {
          "line": 309,
          "old_api": null,
          "new_api": "merged_table_seek_record",
          "old_text": null,
          "new_text": "merged_table_seek_record(mt, it, &rec)",
          "old_line_content": "\t\t\t\t\t       .update_index = update_index,",
          "new_line_content": "\treturn merged_table_seek_record(mt, it, &rec);",
          "content_same": false
        },
        {
          "line": 317,
          "old_api": null,
          "new_api": "reftable_merged_table_seek_log_at",
          "old_text": null,
          "new_text": "reftable_merged_table_seek_log_at(mt, it, name, max)",
          "old_line_content": "{",
          "new_line_content": "\treturn reftable_merged_table_seek_log_at(mt, it, name, max);",
          "content_same": false
        },
        {
          "line": 192,
          "old_api": null,
          "new_api": "reftable_calloc",
          "old_text": null,
          "new_text": "reftable_calloc(sizeof(struct reftable_merged_table))",
          "old_line_content": "\t}",
          "new_line_content": "\tm = reftable_calloc(sizeof(struct reftable_merged_table));",
          "content_same": false
        },
        {
          "line": 329,
          "old_api": null,
          "new_api": "merged_table_seek_record",
          "old_text": null,
          "new_text": "merged_table_seek_record(tab, it, rec)",
          "old_line_content": "\t\t\t\t\t   struct reftable_record *rec)",
          "new_line_content": "\treturn merged_table_seek_record(tab, it, rec);",
          "content_same": false
        },
        {
          "line": 205,
          "old_api": null,
          "new_api": "FREE_AND_NULL",
          "old_text": null,
          "new_text": "FREE_AND_NULL(mt->stack)",
          "old_line_content": "void merged_table_release(struct reftable_merged_table *mt)",
          "new_line_content": "\tFREE_AND_NULL(mt->stack);",
          "content_same": false
        },
        {
          "line": 334,
          "old_api": null,
          "new_api": "reftable_merged_table_hash_id",
          "old_text": null,
          "new_text": "reftable_merged_table_hash_id(tab)",
          "old_line_content": "static uint32_t reftable_merged_table_hash_id_void(void *tab)",
          "new_line_content": "\treturn reftable_merged_table_hash_id(tab);",
          "content_same": false
        },
        {
          "line": 339,
          "old_api": null,
          "new_api": "reftable_merged_table_min_update_index",
          "old_text": null,
          "new_text": "reftable_merged_table_min_update_index(tab)",
          "old_line_content": "static uint64_t reftable_merged_table_min_update_index_void(void *tab)",
          "new_line_content": "\treturn reftable_merged_table_min_update_index(tab);",
          "content_same": false
        },
        {
          "line": 214,
          "old_api": null,
          "new_api": "merged_table_release",
          "old_text": null,
          "new_text": "merged_table_release(mt)",
          "old_line_content": "\t\treturn;",
          "new_line_content": "\tmerged_table_release(mt);",
          "content_same": false
        },
        {
          "line": 215,
          "old_api": null,
          "new_api": "reftable_free",
          "old_text": null,
          "new_text": "reftable_free(mt)",
          "old_line_content": "\t}",
          "new_line_content": "\treftable_free(mt);",
          "content_same": false
        },
        {
          "line": 344,
          "old_api": null,
          "new_api": "reftable_merged_table_max_update_index",
          "old_text": null,
          "new_text": "reftable_merged_table_max_update_index(tab)",
          "old_line_content": "static uint64_t reftable_merged_table_max_update_index_void(void *tab)",
          "new_line_content": "\treturn reftable_merged_table_max_update_index(tab);",
          "content_same": false
        },
        {
          "line": 357,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(!tab->ops)",
          "old_line_content": "\t\t\t\t      struct reftable_merged_table *merged)",
          "new_line_content": "\tassert(!tab->ops);",
          "content_same": false
        },
        {
          "line": 234,
          "old_api": null,
          "new_api": "seek_record",
          "old_text": null,
          "new_text": "tab->ops->seek_record(tab->table_arg, it, rec)",
          "old_line_content": "\t\t\t\t      struct reftable_record *rec)",
          "new_line_content": "\treturn tab->ops->seek_record(tab->table_arg, it, rec);",
          "content_same": false
        },
        {
          "line": 241,
          "old_api": null,
          "new_api": "reftable_calloc",
          "old_text": null,
          "new_text": "reftable_calloc(\n\t\tsizeof(struct reftable_iterator) * mt->stack_len)",
          "old_line_content": "\t\t\t\t    struct reftable_record *rec)",
          "new_line_content": "\tstruct reftable_iterator *iters = reftable_calloc(",
          "content_same": false
        },
        {
          "line": 245,
          "old_api": null,
          "new_api": "reftable_record_type",
          "old_text": null,
          "new_text": "reftable_record_type(rec)",
          "old_line_content": "\tstruct merged_iter merged = {",
          "new_line_content": "\t\t.typ = reftable_record_type(rec),",
          "content_same": false
        },
        {
          "line": 255,
          "old_api": null,
          "new_api": "reftable_table_seek_record",
          "old_text": null,
          "new_text": "reftable_table_seek_record(&mt->stack[i], &iters[n],\n\t\t\t\t\t\t   rec)",
          "old_line_content": "\tint i = 0;",
          "new_line_content": "\t\tint e = reftable_table_seek_record(&mt->stack[i], &iters[n],",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 257,
          "old_api": "reftable_table_seek_record",
          "new_api": null,
          "old_text": "reftable_table_seek_record(&mt->stack[i], &iters[n],\n\t\t\t\t\t\t   rec)",
          "new_text": null,
          "old_line_content": "\t\tint e = reftable_table_seek_record(&mt->stack[i], &iters[n],",
          "new_line_content": "\t\tif (e < 0) {",
          "content_same": false
        },
        {
          "line": 131,
          "old_api": "strbuf_release",
          "new_api": null,
          "old_text": "strbuf_release(&mi->entry_key)",
          "new_text": null,
          "old_line_content": "\tstrbuf_release(&mi->entry_key);",
          "new_line_content": "\treturn err;",
          "content_same": false
        },
        {
          "line": 132,
          "old_api": "strbuf_release",
          "new_api": null,
          "old_text": "strbuf_release(&mi->key)",
          "new_text": null,
          "old_line_content": "\tstrbuf_release(&mi->key);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 141,
          "old_api": "reftable_record_is_deletion",
          "new_api": null,
          "old_text": "reftable_record_is_deletion(rec)",
          "new_text": null,
          "old_line_content": "\t\t    reftable_record_is_deletion(rec)) {",
          "new_line_content": "\t\t}",
          "content_same": false
        },
        {
          "line": 271,
          "old_api": "reftable_free",
          "new_api": null,
          "old_text": "reftable_free(iters)",
          "new_text": null,
          "old_line_content": "\t\treftable_free(iters);",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 278,
          "old_api": "merged_iter_close",
          "new_api": null,
          "old_text": "merged_iter_close(&merged)",
          "new_text": null,
          "old_line_content": "\t\tmerged_iter_close(&merged);",
          "new_line_content": "\t} else {",
          "content_same": false
        },
        {
          "line": 152,
          "old_api": "merged_iter_pqueue_is_empty",
          "new_api": null,
          "old_text": "merged_iter_pqueue_is_empty(mi->pq)",
          "new_text": null,
          "old_line_content": "\tif (merged_iter_pqueue_is_empty(mi->pq))",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 155,
          "old_api": "merged_iter_next",
          "new_api": null,
          "old_text": "merged_iter_next(mi, rec)",
          "new_text": null,
          "old_line_content": "\treturn merged_iter_next(mi, rec);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 284,
          "old_api": "iterator_from_merged_iter",
          "new_api": null,
          "old_text": "iterator_from_merged_iter(it, p)",
          "new_text": null,
          "old_line_content": "\t\titerator_from_merged_iter(it, p);",
          "new_line_content": "\treturn 0;",
          "content_same": false
        },
        {
          "line": 166,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(!it->ops)",
          "new_text": null,
          "old_line_content": "\tassert(!it->ops);",
          "new_line_content": "\tit->ops = &merged_iter_vtable;",
          "content_same": false
        },
        {
          "line": 299,
          "old_api": "merged_table_seek_record",
          "new_api": null,
          "old_text": "merged_table_seek_record(mt, it, &rec)",
          "new_text": null,
          "old_line_content": "\treturn merged_table_seek_record(mt, it, &rec);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 180,
          "old_api": "reftable_table_min_update_index",
          "new_api": null,
          "old_text": "reftable_table_min_update_index(&stack[i])",
          "new_text": null,
          "old_line_content": "\t\tuint64_t min = reftable_table_min_update_index(&stack[i]);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 183,
          "old_api": "reftable_table_hash_id",
          "new_api": null,
          "old_text": "reftable_table_hash_id(&stack[i])",
          "new_text": null,
          "old_line_content": "\t\tif (reftable_table_hash_id(&stack[i]) != hash_id) {",
          "new_line_content": "\t\t}",
          "content_same": false
        },
        {
          "line": 311,
          "old_api": "merged_table_seek_record",
          "new_api": null,
          "old_text": "merged_table_seek_record(mt, it, &rec)",
          "new_text": null,
          "old_line_content": "\treturn merged_table_seek_record(mt, it, &rec);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 319,
          "old_api": "reftable_merged_table_seek_log_at",
          "new_api": null,
          "old_text": "reftable_merged_table_seek_log_at(mt, it, name, max)",
          "new_text": null,
          "old_line_content": "\treturn reftable_merged_table_seek_log_at(mt, it, name, max);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 194,
          "old_api": "reftable_calloc",
          "new_api": null,
          "old_text": "reftable_calloc(sizeof(struct reftable_merged_table))",
          "new_text": null,
          "old_line_content": "\tm = reftable_calloc(sizeof(struct reftable_merged_table));",
          "new_line_content": "\tm->stack_len = n;",
          "content_same": false
        },
        {
          "line": 331,
          "old_api": "merged_table_seek_record",
          "new_api": null,
          "old_text": "merged_table_seek_record(tab, it, rec)",
          "new_text": null,
          "old_line_content": "\treturn merged_table_seek_record(tab, it, rec);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 207,
          "old_api": "FREE_AND_NULL",
          "new_api": null,
          "old_text": "FREE_AND_NULL(mt->stack)",
          "new_text": null,
          "old_line_content": "\tFREE_AND_NULL(mt->stack);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 336,
          "old_api": "reftable_merged_table_hash_id",
          "new_api": null,
          "old_text": "reftable_merged_table_hash_id(tab)",
          "new_text": null,
          "old_line_content": "\treturn reftable_merged_table_hash_id(tab);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 341,
          "old_api": "reftable_merged_table_min_update_index",
          "new_api": null,
          "old_text": "reftable_merged_table_min_update_index(tab)",
          "new_text": null,
          "old_line_content": "\treturn reftable_merged_table_min_update_index(tab);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 216,
          "old_api": "merged_table_release",
          "new_api": null,
          "old_text": "merged_table_release(mt)",
          "new_text": null,
          "old_line_content": "\tmerged_table_release(mt);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 217,
          "old_api": "reftable_free",
          "new_api": null,
          "old_text": "reftable_free(mt)",
          "new_text": null,
          "old_line_content": "\treftable_free(mt);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 346,
          "old_api": "reftable_merged_table_max_update_index",
          "new_api": null,
          "old_text": "reftable_merged_table_max_update_index(tab)",
          "new_text": null,
          "old_line_content": "\treturn reftable_merged_table_max_update_index(tab);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 359,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(!tab->ops)",
          "new_text": null,
          "old_line_content": "\tassert(!tab->ops);",
          "new_line_content": "\ttab->table_arg = merged;",
          "content_same": false
        },
        {
          "line": 236,
          "old_api": "seek_record",
          "new_api": null,
          "old_text": "tab->ops->seek_record(tab->table_arg, it, rec)",
          "new_text": null,
          "old_line_content": "\treturn tab->ops->seek_record(tab->table_arg, it, rec);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 243,
          "old_api": "reftable_calloc",
          "new_api": null,
          "old_text": "reftable_calloc(\n\t\tsizeof(struct reftable_iterator) * mt->stack_len)",
          "new_text": null,
          "old_line_content": "\tstruct reftable_iterator *iters = reftable_calloc(",
          "new_line_content": "\tstruct merged_iter merged = {",
          "content_same": false
        },
        {
          "line": 247,
          "old_api": "reftable_record_type",
          "new_api": null,
          "old_text": "reftable_record_type(rec)",
          "new_text": null,
          "old_line_content": "\t\t.typ = reftable_record_type(rec),",
          "new_line_content": "\t\t.suppress_deletions = mt->suppress_deletions,",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 5,
      "total_additions": 25,
      "total_deletions": 27,
      "total_api_changes": 57
    },
    "non_api_changes": {
      "has_non_api_changes": false,
      "evidence": {
        "total_diff_lines": 2,
        "api_related_lines": 57,
        "non_api_lines": 0,
        "non_api_line_numbers": []
      }
    },
    "api_calls_before": 63,
    "api_calls_after": 61,
    "diff_info": {
      "added_lines": 0,
      "removed_lines": 2,
      "total_diff_lines": 14
    }
  }
}