{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/86ef236c989285954384cccfd9cea847f034143c",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/86ef236c989285954384cccfd9cea847f034143c/before.h",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/86ef236c989285954384cccfd9cea847f034143c/after.h",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/86ef236c989285954384cccfd9cea847f034143c/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 1036,
          "old_api": "hashcmp",
          "new_api": "memcmp",
          "old_text": "hashcmp(sha1, null_sha1)",
          "new_text": "memcmp(sha1, sha2, the_hash_algo->rawsz)",
          "old_line_content": "\treturn !hashcmp(sha1, null_sha1);",
          "new_line_content": "\treturn memcmp(sha1, sha2, the_hash_algo->rawsz);",
          "content_same": false
        },
        {
          "line": 1046,
          "old_api": "memcpy",
          "new_api": "hashcmp",
          "old_text": "memcpy(sha_dst, sha_src, the_hash_algo->rawsz)",
          "new_text": "hashcmp(sha1, null_sha1)",
          "old_line_content": "\tmemcpy(sha_dst, sha_src, the_hash_algo->rawsz);",
          "new_line_content": "\treturn !hashcmp(sha1, null_sha1);",
          "content_same": false
        },
        {
          "line": 1051,
          "old_api": "hashcpy",
          "new_api": "hashcmp",
          "old_text": "hashcpy(dst->hash, src->hash)",
          "new_text": "hashcmp(oid->hash, null_sha1)",
          "old_line_content": "\thashcpy(dst->hash, src->hash);",
          "new_line_content": "\treturn !hashcmp(oid->hash, null_sha1);",
          "content_same": false
        },
        {
          "line": 1056,
          "old_api": "xmalloc",
          "new_api": "memcpy",
          "old_text": "xmalloc(sizeof(struct object_id))",
          "new_text": "memcpy(sha_dst, sha_src, the_hash_algo->rawsz)",
          "old_line_content": "\tstruct object_id *dst = xmalloc(sizeof(struct object_id));",
          "new_line_content": "\tmemcpy(sha_dst, sha_src, the_hash_algo->rawsz);",
          "content_same": false
        },
        {
          "line": 1073,
          "old_api": "memcpy",
          "new_api": "memset",
          "old_text": "memcpy(oid->hash, hash, the_hash_algo->rawsz)",
          "new_text": "memset(hash, 0, the_hash_algo->rawsz)",
          "old_line_content": "\tmemcpy(oid->hash, hash, the_hash_algo->rawsz);",
          "new_line_content": "\tmemset(hash, 0, the_hash_algo->rawsz);",
          "content_same": false
        },
        {
          "line": 1078,
          "old_api": "hashcmp",
          "new_api": "memset",
          "old_text": "hashcmp(sha1, the_hash_algo->empty_blob->hash)",
          "new_text": "memset(oid->hash, 0, GIT_MAX_RAWSZ)",
          "old_line_content": "\treturn !hashcmp(sha1, the_hash_algo->empty_blob->hash);",
          "new_line_content": "\tmemset(oid->hash, 0, GIT_MAX_RAWSZ);",
          "content_same": false
        },
        {
          "line": 1083,
          "old_api": "oidcmp",
          "new_api": "memcpy",
          "old_text": "oidcmp(oid, the_hash_algo->empty_blob)",
          "new_text": "memcpy(oid->hash, hash, the_hash_algo->rawsz)",
          "old_line_content": "\treturn !oidcmp(oid, the_hash_algo->empty_blob);",
          "new_line_content": "\tmemcpy(oid->hash, hash, the_hash_algo->rawsz);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 1280,
          "old_api": null,
          "new_api": "hexval",
          "old_text": null,
          "new_text": "hexval(s[0])",
          "old_line_content": "",
          "new_line_content": "\tunsigned int val = hexval(s[0]);",
          "content_same": false
        },
        {
          "line": 1281,
          "old_api": null,
          "new_api": "hexval",
          "old_text": null,
          "new_text": "hexval(s[1])",
          "old_line_content": "struct object_context {",
          "new_line_content": "\treturn (val & ~0xf) ? val : (val << 4) | hexval(s[1]);",
          "content_same": false
        },
        {
          "line": 1539,
          "old_api": null,
          "new_api": "strbuf_release",
          "old_text": null,
          "new_text": "strbuf_release(&cache->path)",
          "old_line_content": "struct pack_window {",
          "new_line_content": "\tstrbuf_release(&cache->path);",
          "content_same": false
        },
        {
          "line": 1061,
          "old_api": null,
          "new_api": "hashcpy",
          "old_text": null,
          "new_text": "hashcpy(dst->hash, src->hash)",
          "old_line_content": "static inline void hashclr(unsigned char *hash)",
          "new_line_content": "\thashcpy(dst->hash, src->hash);",
          "content_same": false
        },
        {
          "line": 1609,
          "old_api": null,
          "new_api": "format (printf, 2, 3)",
          "old_text": null,
          "new_text": "format (printf, 2, 3)",
          "old_line_content": "extern void fsync_or_die(int fd, const char *);",
          "new_line_content": "__attribute__((format (printf, 2, 3)))",
          "content_same": false
        },
        {
          "line": 1066,
          "old_api": null,
          "new_api": "xmalloc",
          "old_text": null,
          "new_text": "xmalloc(sizeof(struct object_id))",
          "old_line_content": "static inline void oidclr(struct object_id *oid)",
          "new_line_content": "\tstruct object_id *dst = xmalloc(sizeof(struct object_id));",
          "content_same": false
        },
        {
          "line": 1035,
          "old_api": null,
          "new_api": "BUG",
          "old_text": null,
          "new_text": "BUG(\"hash size not yet supported by hashcmp\")",
          "old_line_content": "{",
          "new_line_content": "\t\tBUG(\"hash size not yet supported by hashcmp\");",
          "content_same": false
        },
        {
          "line": 1067,
          "old_api": null,
          "new_api": "oidcpy",
          "old_text": null,
          "new_text": "oidcpy(dst, src)",
          "old_line_content": "{",
          "new_line_content": "\toidcpy(dst, src);",
          "content_same": false
        },
        {
          "line": 1098,
          "old_api": null,
          "new_api": "hashcmp",
          "old_text": null,
          "new_text": "hashcmp(sha1, the_hash_algo->empty_tree->hash)",
          "old_line_content": "",
          "new_line_content": "\treturn !hashcmp(sha1, the_hash_algo->empty_tree->hash);",
          "content_same": false
        },
        {
          "line": 1643,
          "old_api": null,
          "new_api": "format (printf, 2, 3)",
          "old_text": null,
          "new_text": "format (printf, 2, 3)",
          "old_line_content": "extern void prepare_pager_args(struct child_process *, const char *pager);",
          "new_line_content": "__attribute__((format (printf, 2, 3)))",
          "content_same": false
        },
        {
          "line": 1103,
          "old_api": null,
          "new_api": "oidcmp",
          "old_text": null,
          "new_text": "oidcmp(oid, the_hash_algo->empty_tree)",
          "old_line_content": "/*",
          "new_line_content": "\treturn !oidcmp(oid, the_hash_algo->empty_tree);",
          "content_same": false
        },
        {
          "line": 1207,
          "old_api": null,
          "new_api": "has_dos_drive_prefix",
          "old_text": null,
          "new_text": "has_dos_drive_prefix(path)",
          "old_line_content": "const char *remove_leading_path(const char *in, const char *prefix);",
          "new_line_content": "\treturn is_dir_sep(path[0]) || has_dos_drive_prefix(path);",
          "content_same": false
        },
        {
          "line": 1627,
          "old_api": null,
          "new_api": "strlen",
          "old_text": null,
          "new_text": "strlen(str)",
          "old_line_content": " * Like write_file_buf(), but format the contents into a buffer first.",
          "new_line_content": "\treturn write_in_full(fd, str, strlen(str));",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 1057,
          "old_api": "oidcpy",
          "new_api": null,
          "old_text": "oidcpy(dst, src)",
          "new_text": null,
          "old_line_content": "\toidcpy(dst, src);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 1026,
          "old_api": "memcmp",
          "new_api": null,
          "old_text": "memcmp(sha1, sha2, the_hash_algo->rawsz)",
          "new_text": null,
          "old_line_content": "\treturn memcmp(sha1, sha2, the_hash_algo->rawsz);",
          "new_line_content": "\t/*",
          "content_same": false
        },
        {
          "line": 1633,
          "old_api": "format (printf, 2, 3)",
          "new_api": null,
          "old_text": "format (printf, 2, 3)",
          "new_text": null,
          "old_line_content": "__attribute__((format (printf, 2, 3)))",
          "new_line_content": " */",
          "content_same": false
        },
        {
          "line": 1063,
          "old_api": "memset",
          "new_api": null,
          "old_text": "memset(hash, 0, the_hash_algo->rawsz)",
          "new_text": null,
          "old_line_content": "\tmemset(hash, 0, the_hash_algo->rawsz);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1031,
          "old_api": "hashcmp",
          "new_api": null,
          "old_text": "hashcmp(oid1->hash, oid2->hash)",
          "new_text": null,
          "old_line_content": "\treturn hashcmp(oid1->hash, oid2->hash);",
          "new_line_content": "\t * This will need to be extended or ripped out when we learn about",
          "content_same": false
        },
        {
          "line": 1068,
          "old_api": "memset",
          "new_api": null,
          "old_text": "memset(oid->hash, 0, GIT_MAX_RAWSZ)",
          "new_text": null,
          "old_line_content": "\tmemset(oid->hash, 0, GIT_MAX_RAWSZ);",
          "new_line_content": "\treturn dst;",
          "content_same": false
        },
        {
          "line": 1197,
          "old_api": "has_dos_drive_prefix",
          "new_api": null,
          "old_text": "has_dos_drive_prefix(path)",
          "new_text": null,
          "old_line_content": "\treturn is_dir_sep(path[0]) || has_dos_drive_prefix(path);",
          "new_line_content": " * recent call of fn. fn is always called at least once, and will be",
          "content_same": false
        },
        {
          "line": 1617,
          "old_api": "strlen",
          "new_api": null,
          "old_text": "strlen(str)",
          "new_text": null,
          "old_line_content": "\treturn write_in_full(fd, str, strlen(str));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1270,
          "old_api": "hexval",
          "new_api": null,
          "old_text": "hexval(s[0])",
          "new_text": null,
          "old_line_content": "\tunsigned int val = hexval(s[0]);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 1271,
          "old_api": "hexval",
          "new_api": null,
          "old_text": "hexval(s[1])",
          "new_text": null,
          "old_line_content": "\treturn (val & ~0xf) ? val : (val << 4) | hexval(s[1]);",
          "new_line_content": "\treturn hexval_table[c];",
          "content_same": false
        },
        {
          "line": 1529,
          "old_api": "strbuf_release",
          "new_api": null,
          "old_text": "strbuf_release(&cache->path)",
          "new_text": null,
          "old_line_content": "\tstrbuf_release(&cache->path);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1599,
          "old_api": "format (printf, 2, 3)",
          "new_api": null,
          "old_text": "format (printf, 2, 3)",
          "new_text": null,
          "old_line_content": "__attribute__((format (printf, 2, 3)))",
          "new_line_content": "extern int committer_ident_sufficiently_given(void);",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 7,
      "total_additions": 13,
      "total_deletions": 12,
      "total_api_changes": 32
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 10,
        "api_related_lines": 32,
        "non_api_lines": 8,
        "non_api_line_numbers": [
          1029,
          1033,
          1037,
          1039,
          1041,
          1043,
          1045,
          1047
        ]
      }
    },
    "api_calls_before": 50,
    "api_calls_after": 51,
    "diff_info": {
      "added_lines": 11,
      "removed_lines": 1,
      "total_diff_lines": 39
    }
  }
}