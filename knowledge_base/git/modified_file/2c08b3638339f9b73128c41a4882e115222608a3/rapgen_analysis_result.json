{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/2c08b3638339f9b73128c41a4882e115222608a3",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/2c08b3638339f9b73128c41a4882e115222608a3/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/2c08b3638339f9b73128c41a4882e115222608a3/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/2c08b3638339f9b73128c41a4882e115222608a3/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": true,
    "api_changes": {
      "replacements": [
        {
          "line": 167,
          "old_api": "fetch",
          "new_api": "report_missing",
          "old_text": "fetch(obj->sha1)",
          "new_text": "report_missing(obj->type\n\t\t\t\t\t       ? obj->type\n\t\t\t\t\t       : \"object\", obj->sha1)",
          "old_line_content": "\t\t\tif (!has_sha1_file(obj->sha1) && fetch(obj->sha1)) {",
          "new_line_content": "\t\t\t\treport_missing(obj->type",
          "content_same": false
        },
        {
          "line": 175,
          "old_api": "parse_object",
          "new_api": "process_object",
          "old_text": "parse_object(obj->sha1)",
          "new_text": "process_object(obj)",
          "old_line_content": "\t\t\tparse_object(obj->sha1);",
          "new_line_content": "\t\tif (process_object(obj))",
          "content_same": false
        },
        {
          "line": 186,
          "old_api": "check_ref_format",
          "new_api": "fetch_ref",
          "old_text": "check_ref_format(target)",
          "new_text": "fetch_ref(target, sha1)",
          "old_line_content": "\tif (!check_ref_format(target)) {",
          "new_line_content": "\t\tif (!fetch_ref(target, sha1)) {",
          "content_same": false
        },
        {
          "line": 218,
          "old_api": "interpret_target",
          "new_api": "error",
          "old_text": "interpret_target(target, sha1)",
          "new_text": "error(\"Could not interpret %s as something to pull\",\n\t\t\t     target)",
          "old_line_content": "\tif (interpret_target(target, sha1))",
          "new_line_content": "\t\treturn error(\"Could not interpret %s as something to pull\",",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 195,
          "old_api": null,
          "new_api": "lookup_commit_reference_gently",
          "old_text": null,
          "new_text": "lookup_commit_reference_gently(sha1, 1)",
          "old_line_content": "{",
          "new_line_content": "\tstruct commit *commit = lookup_commit_reference_gently(sha1, 1);",
          "content_same": false
        },
        {
          "line": 217,
          "old_api": null,
          "new_api": "interpret_target",
          "old_text": null,
          "new_text": "interpret_target(target, sha1)",
          "old_line_content": "",
          "new_line_content": "\tif (interpret_target(target, sha1))",
          "content_same": false
        },
        {
          "line": 227,
          "old_api": null,
          "new_api": "write_ref_sha1",
          "old_text": null,
          "new_text": "write_ref_sha1(write_ref, fd, sha1)",
          "old_line_content": "\t\tif (current_ref) {",
          "new_line_content": "\t\t\twrite_ref_sha1(write_ref, fd, sha1);",
          "content_same": false
        },
        {
          "line": 166,
          "old_api": null,
          "new_api": "fetch",
          "old_text": null,
          "new_text": "fetch(obj->sha1)",
          "old_line_content": "\t\tif (! (obj->flags & TO_SCAN)) {",
          "new_line_content": "\t\t\tif (!has_sha1_file(obj->sha1) && fetch(obj->sha1)) {",
          "content_same": false
        },
        {
          "line": 198,
          "old_api": null,
          "new_api": "insert_by_date",
          "old_text": null,
          "new_text": "insert_by_date(commit, &complete)",
          "old_line_content": "\t\tcommit->object.flags |= COMPLETE;",
          "new_line_content": "\t\tinsert_by_date(commit, &complete);",
          "content_same": false
        },
        {
          "line": 229,
          "old_api": null,
          "new_api": "write_ref_sha1_unlocked",
          "old_text": null,
          "new_text": "write_ref_sha1_unlocked(write_ref, sha1)",
          "old_line_content": "\t\t} else {",
          "new_line_content": "\t\t\twrite_ref_sha1_unlocked(write_ref, sha1);",
          "content_same": false
        },
        {
          "line": 174,
          "old_api": null,
          "new_api": "parse_object",
          "old_text": null,
          "new_text": "parse_object(obj->sha1)",
          "old_line_content": "\t\tif (!obj->type)",
          "new_line_content": "\t\t\tparse_object(obj->sha1);",
          "content_same": false
        },
        {
          "line": 142,
          "old_api": null,
          "new_api": "prefetch",
          "old_text": null,
          "new_text": "prefetch(obj->sha1)",
          "old_line_content": "\t\t\treturn 0;",
          "new_line_content": "\t\tprefetch(obj->sha1);",
          "content_same": false
        },
        {
          "line": 145,
          "old_api": null,
          "new_api": "object_list_insert",
          "old_text": null,
          "new_text": "object_list_insert(obj, process_queue_end)",
          "old_line_content": "\t\t",
          "new_line_content": "\tobject_list_insert(obj, process_queue_end);",
          "content_same": false
        },
        {
          "line": 210,
          "old_api": null,
          "new_api": "lock_ref_sha1",
          "old_text": null,
          "new_text": "lock_ref_sha1(write_ref, current_ref)",
          "old_line_content": "\tif (write_ref && current_ref) {",
          "new_line_content": "\t\tfd = lock_ref_sha1(write_ref, current_ref);",
          "content_same": false
        },
        {
          "line": 183,
          "old_api": null,
          "new_api": "get_sha1_hex",
          "old_text": null,
          "new_text": "get_sha1_hex(target, sha1)",
          "old_line_content": "{",
          "new_line_content": "\tif (!get_sha1_hex(target, sha1))",
          "content_same": false
        },
        {
          "line": 185,
          "old_api": null,
          "new_api": "check_ref_format",
          "old_text": null,
          "new_text": "check_ref_format(target)",
          "old_line_content": "\t\treturn 0;",
          "new_line_content": "\tif (!check_ref_format(target)) {",
          "content_same": false
        },
        {
          "line": 215,
          "old_api": null,
          "new_api": "for_each_ref",
          "old_text": null,
          "new_text": "for_each_ref(mark_complete)",
          "old_line_content": "",
          "new_line_content": "\tfor_each_ref(mark_complete);",
          "content_same": false
        },
        {
          "line": 220,
          "old_api": null,
          "new_api": "lookup_unknown_object",
          "old_text": null,
          "new_text": "lookup_unknown_object(sha1)",
          "old_line_content": "\t\t\t     target);",
          "new_line_content": "\tif (process(lookup_unknown_object(sha1)))",
          "content_same": false
        },
        {
          "line": 222,
          "old_api": null,
          "new_api": "loop",
          "old_text": null,
          "new_text": "loop()",
          "old_line_content": "\t\treturn -1;",
          "new_line_content": "\tif (loop())",
          "content_same": false
        },
        {
          "line": 158,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free(elem)",
          "old_line_content": "\t\tprocess_queue = elem->next;",
          "new_line_content": "\t\tfree(elem);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 223,
          "old_api": "loop",
          "new_api": null,
          "old_text": "loop()",
          "new_text": null,
          "old_line_content": "\tif (loop())",
          "new_line_content": "\t\treturn -1;",
          "content_same": false
        },
        {
          "line": 196,
          "old_api": "lookup_commit_reference_gently",
          "new_api": null,
          "old_text": "lookup_commit_reference_gently(sha1, 1)",
          "new_text": null,
          "old_line_content": "\tstruct commit *commit = lookup_commit_reference_gently(sha1, 1);",
          "new_line_content": "\tif (commit) {",
          "content_same": false
        },
        {
          "line": 228,
          "old_api": "write_ref_sha1",
          "new_api": null,
          "old_text": "write_ref_sha1(write_ref, fd, sha1)",
          "new_text": null,
          "old_line_content": "\t\t\twrite_ref_sha1(write_ref, fd, sha1);",
          "new_line_content": "\t\t} else {",
          "content_same": false
        },
        {
          "line": 230,
          "old_api": "write_ref_sha1_unlocked",
          "new_api": null,
          "old_text": "write_ref_sha1_unlocked(write_ref, sha1)",
          "new_text": null,
          "old_line_content": "\t\t\twrite_ref_sha1_unlocked(write_ref, sha1);",
          "new_line_content": "\t\t}",
          "content_same": false
        },
        {
          "line": 199,
          "old_api": "insert_by_date",
          "new_api": null,
          "old_text": "insert_by_date(commit, &complete)",
          "new_text": null,
          "old_line_content": "\t\tinsert_by_date(commit, &complete);",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 168,
          "old_api": "report_missing",
          "new_api": null,
          "old_text": "report_missing(obj->type\n\t\t\t\t\t       ? obj->type\n\t\t\t\t\t       : \"object\", obj->sha1)",
          "new_text": null,
          "old_line_content": "\t\t\t\treport_missing(obj->type",
          "new_line_content": "\t\t\t\t\t       ? obj->type",
          "content_same": false
        },
        {
          "line": 137,
          "old_api": "parse_object",
          "new_api": null,
          "old_text": "parse_object(obj->sha1)",
          "new_text": null,
          "old_line_content": "\t\tparse_object(obj->sha1);",
          "new_line_content": "\t\t/* We already have it, so we should scan it now. */",
          "content_same": false
        },
        {
          "line": 219,
          "old_api": "error",
          "new_api": null,
          "old_text": "error(\"Could not interpret %s as something to pull\",\n\t\t\t     target)",
          "new_text": null,
          "old_line_content": "\t\treturn error(\"Could not interpret %s as something to pull\",",
          "new_line_content": "\t\t\t     target);",
          "content_same": false
        },
        {
          "line": 143,
          "old_api": "prefetch",
          "new_api": null,
          "old_text": "prefetch(obj->sha1)",
          "new_text": null,
          "old_line_content": "\t\tprefetch(obj->sha1);",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 176,
          "old_api": "process_object",
          "new_api": null,
          "old_text": "process_object(obj)",
          "new_text": null,
          "old_line_content": "\t\tif (process_object(obj))",
          "new_line_content": "\t\t\treturn -1;",
          "content_same": false
        },
        {
          "line": 146,
          "old_api": "object_list_insert",
          "new_api": null,
          "old_text": "object_list_insert(obj, process_queue_end)",
          "new_text": null,
          "old_line_content": "\tobject_list_insert(obj, process_queue_end);",
          "new_line_content": "\tprocess_queue_end = &(*process_queue_end)->next;",
          "content_same": false
        },
        {
          "line": 211,
          "old_api": "lock_ref_sha1",
          "new_api": null,
          "old_text": "lock_ref_sha1(write_ref, current_ref)",
          "new_text": null,
          "old_line_content": "\t\tfd = lock_ref_sha1(write_ref, current_ref);",
          "new_line_content": "\t\tif (fd < 0)",
          "content_same": false
        },
        {
          "line": 184,
          "old_api": "get_sha1_hex",
          "new_api": null,
          "old_text": "get_sha1_hex(target, sha1)",
          "new_text": null,
          "old_line_content": "\tif (!get_sha1_hex(target, sha1))",
          "new_line_content": "\t\treturn 0;",
          "content_same": false
        },
        {
          "line": 187,
          "old_api": "fetch_ref",
          "new_api": null,
          "old_text": "fetch_ref(target, sha1)",
          "new_text": null,
          "old_line_content": "\t\tif (!fetch_ref(target, sha1)) {",
          "new_line_content": "\t\t\treturn 0;",
          "content_same": false
        },
        {
          "line": 216,
          "old_api": "for_each_ref",
          "new_api": null,
          "old_text": "for_each_ref(mark_complete)",
          "new_text": null,
          "old_line_content": "\tfor_each_ref(mark_complete);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 221,
          "old_api": "lookup_unknown_object",
          "new_api": null,
          "old_text": "lookup_unknown_object(sha1)",
          "new_text": null,
          "old_line_content": "\tif (process(lookup_unknown_object(sha1)))",
          "new_line_content": "\t\treturn -1;",
          "content_same": false
        },
        {
          "line": 159,
          "old_api": "free",
          "new_api": null,
          "old_text": "free(elem)",
          "new_text": null,
          "old_line_content": "\t\tfree(elem);",
          "new_line_content": "\t\tif (!process_queue)",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 4,
      "total_additions": 16,
      "total_deletions": 17,
      "total_api_changes": 37
    },
    "non_api_changes": {
      "has_non_api_changes": false,
      "evidence": {
        "total_diff_lines": 1,
        "api_related_lines": 37,
        "non_api_lines": 0,
        "non_api_line_numbers": []
      }
    },
    "api_calls_before": 46,
    "api_calls_after": 45,
    "diff_info": {
      "added_lines": 0,
      "removed_lines": 1,
      "total_diff_lines": 13
    }
  }
}