{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/caf388caa101be90b7ec43d7f78ca4e935fc0150",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/caf388caa101be90b7ec43d7f78ca4e935fc0150/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/caf388caa101be90b7ec43d7f78ca4e935fc0150/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/caf388caa101be90b7ec43d7f78ca4e935fc0150/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 199,
          "old_api": "diffcore_std",
          "new_api": "diff_tree_oid",
          "old_text": "diffcore_std(&diffopt)",
          "new_text": "diff_tree_oid(NULL, &c->object.oid, \"\", &diffopt)",
          "old_line_content": "\tdiffcore_std(&diffopt);",
          "new_line_content": "\t\tdiff_tree_oid(NULL, &c->object.oid, \"\", &diffopt);",
          "content_same": false
        },
        {
          "line": 222,
          "old_api": "strhash",
          "new_api": "FLEX_ALLOC_STR",
          "old_text": "strhash(path)",
          "new_text": "FLEX_ALLOC_STR(e, path, path)",
          "old_line_content": "\t\t\t\thashmap_entry_init(&e->entry, strhash(path));",
          "new_line_content": "\t\t\t\tFLEX_ALLOC_STR(e, path, path);",
          "content_same": false
        },
        {
          "line": 223,
          "old_api": "hashmap_add",
          "new_api": "strhash",
          "old_text": "hashmap_add(&pathmap, &e->entry)",
          "new_text": "strhash(path)",
          "old_line_content": "\t\t\t\thashmap_add(&pathmap, &e->entry);",
          "new_line_content": "\t\t\t\thashmap_entry_init(&e->entry, strhash(path));",
          "content_same": false
        },
        {
          "line": 235,
          "old_api": "xcalloc",
          "new_api": "hashmap_get_size",
          "old_text": "xcalloc(filter->len, sizeof(unsigned char))",
          "new_text": "hashmap_get_size(&pathmap)",
          "old_line_content": "\t\tfilter->data = xcalloc(filter->len, sizeof(unsigned char));",
          "new_line_content": "\t\tfilter->len = (hashmap_get_size(&pathmap) * settings.bits_per_entry + BITS_PER_WORD - 1) / BITS_PER_WORD;",
          "content_same": false
        },
        {
          "line": 240,
          "old_api": "add_key_to_filter",
          "new_api": "strlen",
          "old_text": "add_key_to_filter(&key, filter, &settings)",
          "new_text": "strlen(e->path)",
          "old_line_content": "\t\t\tadd_key_to_filter(&key, filter, &settings);",
          "new_line_content": "\t\t\tfill_bloom_key(e->path, strlen(e->path), &key, &settings);",
          "content_same": false
        },
        {
          "line": 252,
          "old_api": "DIFF_QUEUE_CLEAR",
          "new_api": "free",
          "old_text": "DIFF_QUEUE_CLEAR(&diff_queued_diff)",
          "new_text": "free(diff_queued_diff.queue)",
          "old_line_content": "\tDIFF_QUEUE_CLEAR(&diff_queued_diff);",
          "new_line_content": "\tfree(diff_queued_diff.queue);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 224,
          "old_api": null,
          "new_api": "hashmap_add",
          "old_text": null,
          "new_text": "hashmap_add(&pathmap, &e->entry)",
          "old_line_content": "",
          "new_line_content": "\t\t\t\thashmap_add(&pathmap, &e->entry);",
          "content_same": false
        },
        {
          "line": 194,
          "old_api": null,
          "new_api": "diff_setup_done",
          "old_text": null,
          "new_text": "diff_setup_done(&diffopt)",
          "old_line_content": "",
          "new_line_content": "\tdiff_setup_done(&diffopt);",
          "content_same": false
        },
        {
          "line": 197,
          "old_api": null,
          "new_api": "diff_tree_oid",
          "old_text": null,
          "new_text": "diff_tree_oid(&c->parents->item->object.oid, &c->object.oid, \"\", &diffopt)",
          "old_line_content": "\telse",
          "new_line_content": "\t\tdiff_tree_oid(&c->parents->item->object.oid, &c->object.oid, \"\", &diffopt);",
          "content_same": false
        },
        {
          "line": 200,
          "old_api": null,
          "new_api": "diffcore_std",
          "old_text": null,
          "new_text": "diffcore_std(&diffopt)",
          "old_line_content": "",
          "new_line_content": "\tdiffcore_std(&diffopt);",
          "content_same": false
        },
        {
          "line": 232,
          "old_api": null,
          "new_api": "diff_free_filepair",
          "old_text": null,
          "new_text": "diff_free_filepair(diff_queued_diff.queue[i])",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\t\tdiff_free_filepair(diff_queued_diff.queue[i]);",
          "content_same": false
        },
        {
          "line": 236,
          "old_api": null,
          "new_api": "xcalloc",
          "old_text": null,
          "new_text": "xcalloc(filter->len, sizeof(unsigned char))",
          "old_line_content": "",
          "new_line_content": "\t\tfilter->data = xcalloc(filter->len, sizeof(unsigned char));",
          "content_same": false
        },
        {
          "line": 206,
          "old_api": null,
          "new_api": "hashmap_init",
          "old_text": null,
          "new_text": "hashmap_init(&pathmap, NULL, NULL, 0)",
          "old_line_content": "",
          "new_line_content": "\t\thashmap_init(&pathmap, NULL, NULL, 0);",
          "content_same": false
        },
        {
          "line": 271,
          "old_api": null,
          "new_api": "get_bitmask",
          "old_text": null,
          "new_text": "get_bitmask(hash_mod)",
          "old_line_content": "\t\t\treturn 0;",
          "new_line_content": "\t\tif (!(filter->data[block_pos] & get_bitmask(hash_mod)))",
          "content_same": false
        },
        {
          "line": 238,
          "old_api": null,
          "new_api": "hashmap_for_each_entry",
          "old_text": null,
          "new_text": "hashmap_for_each_entry(&pathmap, &iter, e, entry)",
          "old_line_content": "\t\t\tstruct bloom_key key;",
          "new_line_content": "\t\thashmap_for_each_entry(&pathmap, &iter, e, entry) {",
          "content_same": false
        },
        {
          "line": 241,
          "old_api": null,
          "new_api": "add_key_to_filter",
          "old_text": null,
          "new_text": "add_key_to_filter(&key, filter, &settings)",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\t\tadd_key_to_filter(&key, filter, &settings);",
          "content_same": false
        },
        {
          "line": 244,
          "old_api": null,
          "new_api": "hashmap_free_entries",
          "old_text": null,
          "new_text": "hashmap_free_entries(&pathmap, struct pathmap_hash_entry, entry)",
          "old_line_content": "\t} else {",
          "new_line_content": "\t\thashmap_free_entries(&pathmap, struct pathmap_hash_entry, entry);",
          "content_same": false
        },
        {
          "line": 247,
          "old_api": null,
          "new_api": "diff_free_filepair",
          "old_text": null,
          "new_text": "diff_free_filepair(diff_queued_diff.queue[i])",
          "old_line_content": "\t\tfilter->data = NULL;",
          "new_line_content": "\t\t\tdiff_free_filepair(diff_queued_diff.queue[i]);",
          "content_same": false
        },
        {
          "line": 220,
          "old_api": null,
          "new_api": "strrchr",
          "old_text": null,
          "new_text": "strrchr(path, '/')",
          "old_line_content": "",
          "new_line_content": "\t\t\t\tchar *last_slash = strrchr(path, '/');",
          "content_same": false
        },
        {
          "line": 253,
          "old_api": null,
          "new_api": "DIFF_QUEUE_CLEAR",
          "old_text": null,
          "new_text": "DIFF_QUEUE_CLEAR(&diff_queued_diff)",
          "old_line_content": "",
          "new_line_content": "\tDIFF_QUEUE_CLEAR(&diff_queued_diff);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 193,
          "old_api": "diff_setup_done",
          "new_api": null,
          "old_text": "diff_setup_done(&diffopt)",
          "new_text": null,
          "old_line_content": "\tdiff_setup_done(&diffopt);",
          "new_line_content": "\tdiffopt.max_changes = max_changes;",
          "content_same": false
        },
        {
          "line": 196,
          "old_api": "diff_tree_oid",
          "new_api": null,
          "old_text": "diff_tree_oid(&c->parents->item->object.oid, &c->object.oid, \"\", &diffopt)",
          "new_text": null,
          "old_line_content": "\t\tdiff_tree_oid(&c->parents->item->object.oid, &c->object.oid, \"\", &diffopt);",
          "new_line_content": "\tif (c->parents)",
          "content_same": false
        },
        {
          "line": 198,
          "old_api": "diff_tree_oid",
          "new_api": null,
          "old_text": "diff_tree_oid(NULL, &c->object.oid, \"\", &diffopt)",
          "new_text": null,
          "old_line_content": "\t\tdiff_tree_oid(NULL, &c->object.oid, \"\", &diffopt);",
          "new_line_content": "\telse",
          "content_same": false
        },
        {
          "line": 231,
          "old_api": "diff_free_filepair",
          "new_api": null,
          "old_text": "diff_free_filepair(diff_queued_diff.queue[i])",
          "new_text": null,
          "old_line_content": "\t\t\tdiff_free_filepair(diff_queued_diff.queue[i]);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 234,
          "old_api": "hashmap_get_size",
          "new_api": null,
          "old_text": "hashmap_get_size(&pathmap)",
          "new_text": null,
          "old_line_content": "\t\tfilter->len = (hashmap_get_size(&pathmap) * settings.bits_per_entry + BITS_PER_WORD - 1) / BITS_PER_WORD;",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 205,
          "old_api": "hashmap_init",
          "new_api": null,
          "old_text": "hashmap_init(&pathmap, NULL, NULL, 0)",
          "new_text": null,
          "old_line_content": "\t\thashmap_init(&pathmap, NULL, NULL, 0);",
          "new_line_content": "\t\tstruct hashmap_iter iter;",
          "content_same": false
        },
        {
          "line": 270,
          "old_api": "get_bitmask",
          "new_api": null,
          "old_text": "get_bitmask(hash_mod)",
          "new_text": null,
          "old_line_content": "\t\tif (!(filter->data[block_pos] & get_bitmask(hash_mod)))",
          "new_line_content": "\t\tuint64_t block_pos = hash_mod / BITS_PER_WORD;",
          "content_same": false
        },
        {
          "line": 237,
          "old_api": "hashmap_for_each_entry",
          "new_api": null,
          "old_text": "hashmap_for_each_entry(&pathmap, &iter, e, entry)",
          "new_text": null,
          "old_line_content": "\t\thashmap_for_each_entry(&pathmap, &iter, e, entry) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 239,
          "old_api": "strlen",
          "new_api": null,
          "old_text": "strlen(e->path)",
          "new_text": null,
          "old_line_content": "\t\t\tfill_bloom_key(e->path, strlen(e->path), &key, &settings);",
          "new_line_content": "\t\t\tstruct bloom_key key;",
          "content_same": false
        },
        {
          "line": 251,
          "old_api": "free",
          "new_api": null,
          "old_text": "free(diff_queued_diff.queue)",
          "new_text": null,
          "old_line_content": "\tfree(diff_queued_diff.queue);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 243,
          "old_api": "hashmap_free_entries",
          "new_api": null,
          "old_text": "hashmap_free_entries(&pathmap, struct pathmap_hash_entry, entry)",
          "new_text": null,
          "old_line_content": "\t\thashmap_free_entries(&pathmap, struct pathmap_hash_entry, entry);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 246,
          "old_api": "diff_free_filepair",
          "new_api": null,
          "old_text": "diff_free_filepair(diff_queued_diff.queue[i])",
          "new_text": null,
          "old_line_content": "\t\t\tdiff_free_filepair(diff_queued_diff.queue[i]);",
          "new_line_content": "\t\tfor (i = 0; i < diff_queued_diff.nr; i++)",
          "content_same": false
        },
        {
          "line": 219,
          "old_api": "strrchr",
          "new_api": null,
          "old_text": "strrchr(path, '/')",
          "new_text": null,
          "old_line_content": "\t\t\t\tchar *last_slash = strrchr(path, '/');",
          "new_line_content": "\t\t\tdo {",
          "content_same": false
        },
        {
          "line": 221,
          "old_api": "FLEX_ALLOC_STR",
          "new_api": null,
          "old_text": "FLEX_ALLOC_STR(e, path, path)",
          "new_text": null,
          "old_line_content": "\t\t\t\tFLEX_ALLOC_STR(e, path, path);",
          "new_line_content": "",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 6,
      "total_additions": 14,
      "total_deletions": 14,
      "total_api_changes": 34
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 1,
        "api_related_lines": 34,
        "non_api_lines": 1,
        "non_api_line_numbers": [
          192
        ]
      }
    },
    "api_calls_before": 36,
    "api_calls_after": 36,
    "diff_info": {
      "added_lines": 1,
      "removed_lines": 0,
      "total_diff_lines": 13
    }
  }
}