{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/5730a9dccf1d26f4d98a6d3868614ec2bb0e05a0",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/5730a9dccf1d26f4d98a6d3868614ec2bb0e05a0/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/5730a9dccf1d26f4d98a6d3868614ec2bb0e05a0/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/git/modified_file/5730a9dccf1d26f4d98a6d3868614ec2bb0e05a0/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 118,
          "old_api": "reftable_record_release",
          "new_api": "reftable_record_cmp",
          "old_text": "reftable_record_release(&top.rec)",
          "new_text": "reftable_record_cmp(&top.rec, &entry.rec)",
          "old_line_content": "\t\treftable_record_release(&top.rec);",
          "new_line_content": "\t\tcmp = reftable_record_cmp(&top.rec, &entry.rec);",
          "content_same": false
        },
        {
          "line": 249,
          "old_api": "reftable_table_seek_record",
          "new_api": "reftable_record_type",
          "old_text": "reftable_table_seek_record(&mt->stack[i], &iters[n],\n\t\t\t\t\t\t   rec)",
          "new_text": "reftable_record_type(rec)",
          "old_line_content": "\t\tint e = reftable_table_seek_record(&mt->stack[i], &iters[n],",
          "new_line_content": "\t\t.typ = reftable_record_type(rec),",
          "content_same": false
        },
        {
          "line": 276,
          "old_api": "iterator_from_merged_iter",
          "new_api": "merged_iter_init",
          "old_text": "iterator_from_merged_iter(it, p)",
          "new_text": "merged_iter_init(&merged)",
          "old_line_content": "\t\titerator_from_merged_iter(it, p);",
          "new_line_content": "\terr = merged_iter_init(&merged);",
          "content_same": false
        },
        {
          "line": 311,
          "old_api": "reftable_merged_table_seek_log_at",
          "new_api": "merged_table_seek_record",
          "old_text": "reftable_merged_table_seek_log_at(mt, it, name, max)",
          "new_text": "merged_table_seek_record(mt, it, &rec)",
          "old_line_content": "\treturn reftable_merged_table_seek_log_at(mt, it, name, max);",
          "new_line_content": "\treturn merged_table_seek_record(mt, it, &rec);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 129,
          "old_api": null,
          "new_api": "reftable_record_release",
          "old_text": null,
          "new_text": "reftable_record_release(rec)",
          "old_line_content": "",
          "new_line_content": "\treftable_record_release(rec);",
          "content_same": false
        },
        {
          "line": 257,
          "old_api": null,
          "new_api": "reftable_table_seek_record",
          "old_text": null,
          "new_text": "reftable_table_seek_record(&mt->stack[i], &iters[n],\n\t\t\t\t\t\t   rec)",
          "old_line_content": "\t}",
          "new_line_content": "\t\tint e = reftable_table_seek_record(&mt->stack[i], &iters[n],",
          "content_same": false
        },
        {
          "line": 134,
          "old_api": null,
          "new_api": "reftable_record_release",
          "old_text": null,
          "new_text": "reftable_record_release(&entry.rec)",
          "old_line_content": "\t\tif (err == 0 && mi->suppress_deletions &&",
          "new_line_content": "\t\treftable_record_release(&entry.rec);",
          "content_same": false
        },
        {
          "line": 269,
          "old_api": null,
          "new_api": "reftable_iterator_destroy",
          "old_text": null,
          "new_text": "reftable_iterator_destroy(&iters[i])",
          "old_line_content": "\tif (err < 0) {",
          "new_line_content": "\t\t\treftable_iterator_destroy(&iters[i]);",
          "content_same": false
        },
        {
          "line": 141,
          "old_api": null,
          "new_api": "merged_iter_next_entry",
          "old_text": null,
          "new_text": "merged_iter_next_entry(mi, rec)",
          "old_line_content": "}",
          "new_line_content": "\t\tint err = merged_iter_next_entry(mi, rec);",
          "content_same": false
        },
        {
          "line": 143,
          "old_api": null,
          "new_api": "reftable_record_is_deletion",
          "old_text": null,
          "new_text": "reftable_record_is_deletion(rec)",
          "old_line_content": "static int merged_iter_next_void(void *p, struct reftable_record *rec)",
          "new_line_content": "\t\t    reftable_record_is_deletion(rec)) {",
          "content_same": false
        },
        {
          "line": 271,
          "old_api": null,
          "new_api": "reftable_free",
          "old_text": null,
          "new_text": "reftable_free(iters)",
          "old_line_content": "\t\treturn err;",
          "new_line_content": "\t\treftable_free(iters);",
          "content_same": false
        },
        {
          "line": 278,
          "old_api": null,
          "new_api": "merged_iter_close",
          "old_text": null,
          "new_text": "merged_iter_close(&merged)",
          "old_line_content": "\treturn 0;",
          "new_line_content": "\t\tmerged_iter_close(&merged);",
          "content_same": false
        },
        {
          "line": 282,
          "old_api": null,
          "new_api": "reftable_malloc",
          "old_text": null,
          "new_text": "reftable_malloc(sizeof(struct merged_iter))",
          "old_line_content": "\t\t\t\t   struct reftable_iterator *it,",
          "new_line_content": "\t\t\treftable_malloc(sizeof(struct merged_iter));",
          "content_same": false
        },
        {
          "line": 154,
          "old_api": null,
          "new_api": "merged_iter_pqueue_is_empty",
          "old_text": null,
          "new_text": "merged_iter_pqueue_is_empty(mi->pq)",
          "old_line_content": "\t.close = &merged_iter_close,",
          "new_line_content": "\tif (merged_iter_pqueue_is_empty(mi->pq))",
          "content_same": false
        },
        {
          "line": 284,
          "old_api": null,
          "new_api": "iterator_from_merged_iter",
          "old_text": null,
          "new_text": "iterator_from_merged_iter(it, p)",
          "old_line_content": "{",
          "new_line_content": "\t\titerator_from_merged_iter(it, p);",
          "content_same": false
        },
        {
          "line": 157,
          "old_api": null,
          "new_api": "merged_iter_next",
          "old_text": null,
          "new_text": "merged_iter_next(mi, rec)",
          "old_line_content": "static void iterator_from_merged_iter(struct reftable_iterator *it,",
          "new_line_content": "\treturn merged_iter_next(mi, rec);",
          "content_same": false
        },
        {
          "line": 168,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(!it->ops)",
          "old_line_content": "{",
          "new_line_content": "\tassert(!it->ops);",
          "content_same": false
        },
        {
          "line": 299,
          "old_api": null,
          "new_api": "merged_table_seek_record",
          "old_text": null,
          "new_text": "merged_table_seek_record(mt, it, &rec)",
          "old_line_content": "\t\t\t\t       .u.log = {",
          "new_line_content": "\treturn merged_table_seek_record(mt, it, &rec);",
          "content_same": false
        },
        {
          "line": 182,
          "old_api": null,
          "new_api": "reftable_table_min_update_index",
          "old_text": null,
          "new_text": "reftable_table_min_update_index(&stack[i])",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\tuint64_t min = reftable_table_min_update_index(&stack[i]);",
          "content_same": false
        },
        {
          "line": 183,
          "old_api": null,
          "new_api": "reftable_table_max_update_index",
          "old_text": null,
          "new_text": "reftable_table_max_update_index(&stack[i])",
          "old_line_content": "\t\tif (i == 0 || max > last_max) {",
          "new_line_content": "\t\tuint64_t max = reftable_table_max_update_index(&stack[i]);",
          "content_same": false
        },
        {
          "line": 185,
          "old_api": null,
          "new_api": "reftable_table_hash_id",
          "old_text": null,
          "new_text": "reftable_table_hash_id(&stack[i])",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\tif (reftable_table_hash_id(&stack[i]) != hash_id) {",
          "content_same": false
        },
        {
          "line": 319,
          "old_api": null,
          "new_api": "reftable_merged_table_seek_log_at",
          "old_text": null,
          "new_text": "reftable_merged_table_seek_log_at(mt, it, name, max)",
          "old_line_content": "static int reftable_merged_table_seek_void(void *tab,",
          "new_line_content": "\treturn reftable_merged_table_seek_log_at(mt, it, name, max);",
          "content_same": false
        },
        {
          "line": 196,
          "old_api": null,
          "new_api": "reftable_calloc",
          "old_text": null,
          "new_text": "reftable_calloc(sizeof(struct reftable_merged_table))",
          "old_line_content": "}",
          "new_line_content": "\tm = reftable_calloc(sizeof(struct reftable_merged_table));",
          "content_same": false
        },
        {
          "line": 331,
          "old_api": null,
          "new_api": "merged_table_seek_record",
          "old_text": null,
          "new_text": "merged_table_seek_record(tab, it, rec)",
          "old_line_content": "static uint64_t reftable_merged_table_min_update_index_void(void *tab)",
          "new_line_content": "\treturn merged_table_seek_record(tab, it, rec);",
          "content_same": false
        },
        {
          "line": 336,
          "old_api": null,
          "new_api": "reftable_merged_table_hash_id",
          "old_text": null,
          "new_text": "reftable_merged_table_hash_id(tab)",
          "old_line_content": "static uint64_t reftable_merged_table_max_update_index_void(void *tab)",
          "new_line_content": "\treturn reftable_merged_table_hash_id(tab);",
          "content_same": false
        },
        {
          "line": 209,
          "old_api": null,
          "new_api": "FREE_AND_NULL",
          "old_text": null,
          "new_text": "FREE_AND_NULL(mt->stack)",
          "old_line_content": "\t}",
          "new_line_content": "\tFREE_AND_NULL(mt->stack);",
          "content_same": false
        },
        {
          "line": 341,
          "old_api": null,
          "new_api": "reftable_merged_table_min_update_index",
          "old_text": null,
          "new_text": "reftable_merged_table_min_update_index(tab)",
          "old_line_content": "static struct reftable_table_vtable merged_table_vtable = {",
          "new_line_content": "\treturn reftable_merged_table_min_update_index(tab);",
          "content_same": false
        },
        {
          "line": 218,
          "old_api": null,
          "new_api": "merged_table_release",
          "old_text": null,
          "new_text": "merged_table_release(mt)",
          "old_line_content": "}",
          "new_line_content": "\tmerged_table_release(mt);",
          "content_same": false
        },
        {
          "line": 219,
          "old_api": null,
          "new_api": "reftable_free",
          "old_text": null,
          "new_text": "reftable_free(mt)",
          "old_line_content": "",
          "new_line_content": "\treftable_free(mt);",
          "content_same": false
        },
        {
          "line": 346,
          "old_api": null,
          "new_api": "reftable_merged_table_max_update_index",
          "old_text": null,
          "new_text": "reftable_merged_table_max_update_index(tab)",
          "old_line_content": "};",
          "new_line_content": "\treturn reftable_merged_table_max_update_index(tab);",
          "content_same": false
        },
        {
          "line": 359,
          "old_api": null,
          "new_api": "assert",
          "old_text": null,
          "new_text": "assert(!tab->ops)",
          "old_line_content": "",
          "new_line_content": "\tassert(!tab->ops);",
          "content_same": false
        },
        {
          "line": 238,
          "old_api": null,
          "new_api": "seek_record",
          "old_text": null,
          "new_text": "tab->ops->seek_record(tab->table_arg, it, rec)",
          "old_line_content": "\t\tsizeof(struct reftable_iterator) * mt->stack_len);",
          "new_line_content": "\treturn tab->ops->seek_record(tab->table_arg, it, rec);",
          "content_same": false
        },
        {
          "line": 245,
          "old_api": null,
          "new_api": "reftable_calloc",
          "old_text": null,
          "new_text": "reftable_calloc(\n\t\tsizeof(struct reftable_iterator) * mt->stack_len)",
          "old_line_content": "\tint n = 0;",
          "new_line_content": "\tstruct reftable_iterator *iters = reftable_calloc(",
          "content_same": false
        },
        {
          "line": 122,
          "old_api": null,
          "new_api": "merged_iter_pqueue_remove",
          "old_text": null,
          "new_text": "merged_iter_pqueue_remove(&mi->pq)",
          "old_line_content": "\t*rec = entry.rec;",
          "new_line_content": "\t\tmerged_iter_pqueue_remove(&mi->pq);",
          "content_same": false
        },
        {
          "line": 123,
          "old_api": null,
          "new_api": "merged_iter_advance_subiter",
          "old_text": null,
          "new_text": "merged_iter_advance_subiter(mi, top.index)",
          "old_line_content": "",
          "new_line_content": "\t\terr = merged_iter_advance_subiter(mi, top.index);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 261,
          "old_api": "reftable_iterator_destroy",
          "new_api": null,
          "old_text": "reftable_iterator_destroy(&iters[i])",
          "new_text": null,
          "old_line_content": "\t\t\treftable_iterator_destroy(&iters[i]);",
          "new_line_content": "\t\t}",
          "content_same": false
        },
        {
          "line": 133,
          "old_api": "merged_iter_next_entry",
          "new_api": null,
          "old_text": "merged_iter_next_entry(mi, rec)",
          "new_text": null,
          "old_line_content": "\t\tint err = merged_iter_next_entry(mi, rec);",
          "new_line_content": "\tif (err)",
          "content_same": false
        },
        {
          "line": 263,
          "old_api": "reftable_free",
          "new_api": null,
          "old_text": "reftable_free(iters)",
          "new_text": null,
          "old_line_content": "\t\treftable_free(iters);",
          "new_line_content": "\t\t\tn++;",
          "content_same": false
        },
        {
          "line": 135,
          "old_api": "reftable_record_is_deletion",
          "new_api": null,
          "old_text": "reftable_record_is_deletion(rec)",
          "new_text": null,
          "old_line_content": "\t\t    reftable_record_is_deletion(rec)) {",
          "new_line_content": "\treturn err;",
          "content_same": false
        },
        {
          "line": 268,
          "old_api": "merged_iter_init",
          "new_api": null,
          "old_text": "merged_iter_init(&merged)",
          "new_text": null,
          "old_line_content": "\terr = merged_iter_init(&merged);",
          "new_line_content": "\t\tfor (i = 0; i < n; i++) {",
          "content_same": false
        },
        {
          "line": 270,
          "old_api": "merged_iter_close",
          "new_api": null,
          "old_text": "merged_iter_close(&merged)",
          "new_text": null,
          "old_line_content": "\t\tmerged_iter_close(&merged);",
          "new_line_content": "\t\t}",
          "content_same": false
        },
        {
          "line": 146,
          "old_api": "merged_iter_pqueue_is_empty",
          "new_api": null,
          "old_text": "merged_iter_pqueue_is_empty(mi->pq)",
          "new_text": null,
          "old_line_content": "\tif (merged_iter_pqueue_is_empty(mi->pq))",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 274,
          "old_api": "reftable_malloc",
          "new_api": null,
          "old_text": "reftable_malloc(sizeof(struct merged_iter))",
          "new_text": null,
          "old_line_content": "\t\t\treftable_malloc(sizeof(struct merged_iter));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 149,
          "old_api": "merged_iter_next",
          "new_api": null,
          "old_text": "merged_iter_next(mi, rec)",
          "new_text": null,
          "old_line_content": "\treturn merged_iter_next(mi, rec);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 160,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(!it->ops)",
          "new_text": null,
          "old_line_content": "\tassert(!it->ops);",
          "new_line_content": "static struct reftable_iterator_vtable merged_iter_vtable = {",
          "content_same": false
        },
        {
          "line": 291,
          "old_api": "merged_table_seek_record",
          "new_api": null,
          "old_text": "merged_table_seek_record(mt, it, &rec)",
          "new_text": null,
          "old_line_content": "\treturn merged_table_seek_record(mt, it, &rec);",
          "new_line_content": "\t\t\t\t   const char *name)",
          "content_same": false
        },
        {
          "line": 174,
          "old_api": "reftable_table_min_update_index",
          "new_api": null,
          "old_text": "reftable_table_min_update_index(&stack[i])",
          "new_text": null,
          "old_line_content": "\t\tuint64_t min = reftable_table_min_update_index(&stack[i]);",
          "new_line_content": "\t\t\t      struct reftable_table *stack, int n,",
          "content_same": false
        },
        {
          "line": 175,
          "old_api": "reftable_table_max_update_index",
          "new_api": null,
          "old_text": "reftable_table_max_update_index(&stack[i])",
          "new_text": null,
          "old_line_content": "\t\tuint64_t max = reftable_table_max_update_index(&stack[i]);",
          "new_line_content": "\t\t\t      uint32_t hash_id)",
          "content_same": false
        },
        {
          "line": 303,
          "old_api": "merged_table_seek_record",
          "new_api": null,
          "old_text": "merged_table_seek_record(mt, it, &rec)",
          "new_text": null,
          "old_line_content": "\treturn merged_table_seek_record(mt, it, &rec);",
          "new_line_content": "\t\t\t\t      struct reftable_iterator *it,",
          "content_same": false
        },
        {
          "line": 177,
          "old_api": "reftable_table_hash_id",
          "new_api": null,
          "old_text": "reftable_table_hash_id(&stack[i])",
          "new_text": null,
          "old_line_content": "\t\tif (reftable_table_hash_id(&stack[i]) != hash_id) {",
          "new_line_content": "\tstruct reftable_merged_table *m = NULL;",
          "content_same": false
        },
        {
          "line": 188,
          "old_api": "reftable_calloc",
          "new_api": null,
          "old_text": "reftable_calloc(sizeof(struct reftable_merged_table))",
          "new_text": null,
          "old_line_content": "\tm = reftable_calloc(sizeof(struct reftable_merged_table));",
          "new_line_content": "\t\tif (i == 0 || min < first_min) {",
          "content_same": false
        },
        {
          "line": 323,
          "old_api": "merged_table_seek_record",
          "new_api": null,
          "old_text": "merged_table_seek_record(tab, it, rec)",
          "new_text": null,
          "old_line_content": "\treturn merged_table_seek_record(tab, it, rec);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 328,
          "old_api": "reftable_merged_table_hash_id",
          "new_api": null,
          "old_text": "reftable_merged_table_hash_id(tab)",
          "new_text": null,
          "old_line_content": "\treturn reftable_merged_table_hash_id(tab);",
          "new_line_content": "\t\t\t\t\t   struct reftable_iterator *it,",
          "content_same": false
        },
        {
          "line": 201,
          "old_api": "FREE_AND_NULL",
          "new_api": null,
          "old_text": "FREE_AND_NULL(mt->stack)",
          "new_text": null,
          "old_line_content": "\tFREE_AND_NULL(mt->stack);",
          "new_line_content": "\tm->hash_id = hash_id;",
          "content_same": false
        },
        {
          "line": 333,
          "old_api": "reftable_merged_table_min_update_index",
          "new_api": null,
          "old_text": "reftable_merged_table_min_update_index(tab)",
          "new_text": null,
          "old_line_content": "\treturn reftable_merged_table_min_update_index(tab);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 210,
          "old_api": "merged_table_release",
          "new_api": null,
          "old_text": "merged_table_release(mt)",
          "new_text": null,
          "old_line_content": "\tmerged_table_release(mt);",
          "new_line_content": "\tmt->stack_len = 0;",
          "content_same": false
        },
        {
          "line": 211,
          "old_api": "reftable_free",
          "new_api": null,
          "old_text": "reftable_free(mt)",
          "new_text": null,
          "old_line_content": "\treftable_free(mt);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 338,
          "old_api": "reftable_merged_table_max_update_index",
          "new_api": null,
          "old_text": "reftable_merged_table_max_update_index(tab)",
          "new_text": null,
          "old_line_content": "\treturn reftable_merged_table_max_update_index(tab);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 351,
          "old_api": "assert",
          "new_api": null,
          "old_text": "assert(!tab->ops)",
          "new_text": null,
          "old_line_content": "\tassert(!tab->ops);",
          "new_line_content": "\t.hash_id = reftable_merged_table_hash_id_void,",
          "content_same": false
        },
        {
          "line": 230,
          "old_api": "seek_record",
          "new_api": null,
          "old_text": "tab->ops->seek_record(tab->table_arg, it, rec)",
          "new_text": null,
          "old_line_content": "\treturn tab->ops->seek_record(tab->table_arg, it, rec);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 237,
          "old_api": "reftable_calloc",
          "new_api": null,
          "old_text": "reftable_calloc(\n\t\tsizeof(struct reftable_iterator) * mt->stack_len)",
          "new_text": null,
          "old_line_content": "\tstruct reftable_iterator *iters = reftable_calloc(",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 110,
          "old_api": "reftable_record_cmp",
          "new_api": null,
          "old_text": "reftable_record_cmp(&top.rec, &entry.rec)",
          "new_text": null,
          "old_line_content": "\t\tcmp = reftable_record_cmp(&top.rec, &entry.rec);",
          "new_line_content": "\t\t/*",
          "content_same": false
        },
        {
          "line": 241,
          "old_api": "reftable_record_type",
          "new_api": null,
          "old_text": "reftable_record_type(rec)",
          "new_text": null,
          "old_line_content": "\t\t.typ = reftable_record_type(rec),",
          "new_line_content": "static int merged_table_seek_record(struct reftable_merged_table *mt,",
          "content_same": false
        },
        {
          "line": 114,
          "old_api": "merged_iter_pqueue_remove",
          "new_api": null,
          "old_text": "merged_iter_pqueue_remove(&mi->pq)",
          "new_text": null,
          "old_line_content": "\t\tmerged_iter_pqueue_remove(&mi->pq);",
          "new_line_content": "\t\t */",
          "content_same": false
        },
        {
          "line": 115,
          "old_api": "merged_iter_advance_subiter",
          "new_api": null,
          "old_text": "merged_iter_advance_subiter(mi, top.index)",
          "new_text": null,
          "old_line_content": "\t\terr = merged_iter_advance_subiter(mi, top.index);",
          "new_line_content": "\t\tif (top.index == entry.index)",
          "content_same": false
        },
        {
          "line": 121,
          "old_api": "reftable_record_release",
          "new_api": null,
          "old_text": "reftable_record_release(rec)",
          "new_text": null,
          "old_line_content": "\treftable_record_release(rec);",
          "new_line_content": "",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 4,
      "total_additions": 31,
      "total_deletions": 31,
      "total_api_changes": 66
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 8,
        "api_related_lines": 66,
        "non_api_lines": 5,
        "non_api_line_numbers": [
          111,
          112,
          113,
          116,
          117
        ]
      }
    },
    "api_calls_before": 56,
    "api_calls_after": 56,
    "diff_info": {
      "added_lines": 8,
      "removed_lines": 0,
      "total_diff_lines": 20
    }
  }
}