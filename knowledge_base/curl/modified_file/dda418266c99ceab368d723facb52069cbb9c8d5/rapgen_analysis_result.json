{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/curl/modified_file/dda418266c99ceab368d723facb52069cbb9c8d5",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/curl/modified_file/dda418266c99ceab368d723facb52069cbb9c8d5/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/curl/modified_file/dda418266c99ceab368d723facb52069cbb9c8d5/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/curl/modified_file/dda418266c99ceab368d723facb52069cbb9c8d5/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 756,
          "old_api": "infof",
          "new_api": "msnprintf",
          "old_text": "infof(data, \"%s\\n\", buffer)",
          "new_text": "msnprintf(ptr, len, \"%s%02x%02x\", j?\":\":\"\", d->addr[i].ip.v6[j],\n                  d->addr[i].ip.v6[j + 1])",
          "old_line_content": "      infof(data, \"%s\\n\", buffer);",
          "new_line_content": "        msnprintf(ptr, len, \"%s%02x%02x\", j?\":\":\"\", d->addr[i].ip.v6[j],",
          "content_same": false
        },
        {
          "line": 825,
          "old_api": "calloc",
          "new_api": "strdup",
          "old_text": "calloc(1, ss_size)",
          "new_text": "strdup(hostname)",
          "old_line_content": "    ai->ai_addr = calloc(1, ss_size);",
          "new_line_content": "    ai->ai_canonname = strdup(hostname);",
          "content_same": false
        },
        {
          "line": 863,
          "old_api": "DEBUGASSERT",
          "new_api": "htons",
          "old_text": "DEBUGASSERT(sizeof(struct in6_addr) == sizeof(de->addr[i].ip.v6))",
          "new_text": "htons((unsigned short)port)",
          "old_line_content": "      DEBUGASSERT(sizeof(struct in6_addr) == sizeof(de->addr[i].ip.v6));",
          "new_line_content": "      addr->sin_port = htons((unsigned short)port);",
          "content_same": false
        },
        {
          "line": 919,
          "old_api": "init_dohentry",
          "new_api": "curl_multi_remove_handle",
          "old_text": "init_dohentry(&de)",
          "new_text": "curl_multi_remove_handle(data->multi, data->req.doh.probe[0].easy)",
          "old_line_content": "    init_dohentry(&de);",
          "new_line_content": "    curl_multi_remove_handle(data->multi, data->req.doh.probe[0].easy);",
          "content_same": false
        },
        {
          "line": 920,
          "old_api": "doh_decode",
          "new_api": "Curl_close",
          "old_text": "doh_decode(data->req.doh.probe[0].serverdoh.memory,\n                    data->req.doh.probe[0].serverdoh.size,\n                    data->req.doh.probe[0].dnstype,\n                    &de)",
          "new_text": "Curl_close(data->req.doh.probe[0].easy)",
          "old_line_content": "    rc = doh_decode(data->req.doh.probe[0].serverdoh.memory,",
          "new_line_content": "    Curl_close(data->req.doh.probe[0].easy);",
          "content_same": false
        },
        {
          "line": 926,
          "old_api": "doh_strerror",
          "new_api": "doh_decode",
          "old_text": "doh_strerror(rc)",
          "new_text": "doh_decode(data->req.doh.probe[0].serverdoh.memory,\n                    data->req.doh.probe[0].serverdoh.size,\n                    data->req.doh.probe[0].dnstype,\n                    &de)",
          "old_line_content": "      infof(data, \"DOH: %s type %s for %s\\n\", doh_strerror(rc),",
          "new_line_content": "    rc = doh_decode(data->req.doh.probe[0].serverdoh.memory,",
          "content_same": false
        },
        {
          "line": 930,
          "old_api": "doh_decode",
          "new_api": "free",
          "old_text": "doh_decode(data->req.doh.probe[1].serverdoh.memory,\n                     data->req.doh.probe[1].serverdoh.size,\n                     data->req.doh.probe[1].dnstype,\n                     &de)",
          "new_text": "free(data->req.doh.probe[0].serverdoh.memory)",
          "old_line_content": "    rc2 = doh_decode(data->req.doh.probe[1].serverdoh.memory,",
          "new_line_content": "    free(data->req.doh.probe[0].serverdoh.memory);",
          "content_same": false
        },
        {
          "line": 936,
          "old_api": "doh_strerror",
          "new_api": "doh_decode",
          "old_text": "doh_strerror(rc2)",
          "new_text": "doh_decode(data->req.doh.probe[1].serverdoh.memory,\n                     data->req.doh.probe[1].serverdoh.size,\n                     data->req.doh.probe[1].dnstype,\n                     &de)",
          "old_line_content": "      infof(data, \"DOH: %s type %s for %s\\n\", doh_strerror(rc2),",
          "new_line_content": "    rc2 = doh_decode(data->req.doh.probe[1].serverdoh.memory,",
          "content_same": false
        },
        {
          "line": 960,
          "old_api": "Curl_share_unlock",
          "new_api": "Curl_share_lock",
          "old_text": "Curl_share_unlock(data, CURL_LOCK_DATA_DNS)",
          "new_text": "Curl_share_lock(data, CURL_LOCK_DATA_DNS, CURL_LOCK_ACCESS_SINGLE)",
          "old_line_content": "        Curl_share_unlock(data, CURL_LOCK_DATA_DNS);",
          "new_line_content": "        Curl_share_lock(data, CURL_LOCK_DATA_DNS, CURL_LOCK_ACCESS_SINGLE);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 643,
          "old_api": null,
          "new_api": "get16bit",
          "old_text": null,
          "new_text": "get16bit(doh, index)",
          "old_line_content": "    if(dohlen < (index + 2))",
          "new_line_content": "    type = get16bit(doh, index);",
          "content_same": false
        },
        {
          "line": 899,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free(d->cname[i].alloc)",
          "old_line_content": "{",
          "new_line_content": "    free(d->cname[i].alloc);",
          "content_same": false
        },
        {
          "line": 910,
          "old_api": null,
          "new_api": "failf",
          "old_text": null,
          "new_text": "failf(data, \"Could not DOH-resolve: %s\", conn->async.hostname)",
          "old_line_content": "    DOHcode rc2;",
          "new_line_content": "    failf(data, \"Could not DOH-resolve: %s\", conn->async.hostname);",
          "content_same": false
        },
        {
          "line": 531,
          "old_api": null,
          "new_api": "cnameappend",
          "old_text": null,
          "new_text": "cnameappend(c, (unsigned char *)\".\", 1)",
          "old_line_content": "",
          "new_line_content": "        rc = cnameappend(c, (unsigned char *)\".\", 1);",
          "content_same": false
        },
        {
          "line": 659,
          "old_api": null,
          "new_api": "get32bit",
          "old_text": null,
          "new_text": "get32bit(doh, index)",
          "old_line_content": "      return DOH_DNS_OUT_OF_RANGE;",
          "new_line_content": "    ttl = get32bit(doh, index);",
          "content_same": false
        },
        {
          "line": 921,
          "old_api": null,
          "new_api": "curl_multi_remove_handle",
          "old_text": null,
          "new_text": "curl_multi_remove_handle(data->multi, data->req.doh.probe[1].easy)",
          "old_line_content": "                    data->req.doh.probe[0].serverdoh.size,",
          "new_line_content": "    curl_multi_remove_handle(data->multi, data->req.doh.probe[1].easy);",
          "content_same": false
        },
        {
          "line": 538,
          "old_api": null,
          "new_api": "cnameappend",
          "old_text": null,
          "new_text": "cnameappend(c, &doh[index], length)",
          "old_line_content": "",
          "new_line_content": "      rc = cnameappend(c, &doh[index], length);",
          "content_same": false
        },
        {
          "line": 667,
          "old_api": null,
          "new_api": "get16bit",
          "old_text": null,
          "new_text": "get16bit(doh, index)",
          "old_line_content": "    if(rc)",
          "new_line_content": "    rdlength = get16bit(doh, index);",
          "content_same": false
        },
        {
          "line": 922,
          "old_api": null,
          "new_api": "Curl_close",
          "old_text": null,
          "new_text": "Curl_close(data->req.doh.probe[1].easy)",
          "old_line_content": "                    data->req.doh.probe[0].dnstype,",
          "new_line_content": "    Curl_close(data->req.doh.probe[1].easy);",
          "content_same": false
        },
        {
          "line": 925,
          "old_api": null,
          "new_api": "init_dohentry",
          "old_text": null,
          "new_text": "init_dohentry(&de)",
          "old_line_content": "    if(rc) {",
          "new_line_content": "    init_dohentry(&de);",
          "content_same": false
        },
        {
          "line": 672,
          "old_api": null,
          "new_api": "rdata",
          "old_text": null,
          "new_text": "rdata(doh, dohlen, rdlength, type, index, d)",
          "old_line_content": "",
          "new_line_content": "    rc = rdata(doh, dohlen, rdlength, type, index, d);",
          "content_same": false
        },
        {
          "line": 932,
          "old_api": null,
          "new_api": "doh_strerror",
          "old_text": null,
          "new_text": "doh_strerror(rc)",
          "old_line_content": "                     data->req.doh.probe[1].dnstype,",
          "new_line_content": "      infof(data, \"DOH: %s type %s for %s\\n\", doh_strerror(rc),",
          "content_same": false
        },
        {
          "line": 933,
          "old_api": null,
          "new_api": "type2name",
          "old_text": null,
          "new_text": "type2name(data->req.doh.probe[0].dnstype)",
          "old_line_content": "                     &de);",
          "new_line_content": "            type2name(data->req.doh.probe[0].dnstype),",
          "content_same": false
        },
        {
          "line": 679,
          "old_api": null,
          "new_api": "get16bit",
          "old_text": null,
          "new_text": "get16bit(doh, 8)",
          "old_line_content": "    if(dohlen < (index + 8))",
          "new_line_content": "  nscount = get16bit(doh, 8);",
          "content_same": false
        },
        {
          "line": 681,
          "old_api": null,
          "new_api": "skipqname",
          "old_text": null,
          "new_text": "skipqname(doh, dohlen, &index)",
          "old_line_content": "",
          "new_line_content": "    rc = skipqname(doh, dohlen, &index);",
          "content_same": false
        },
        {
          "line": 940,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free(data->req.doh.probe[1].serverdoh.memory)",
          "old_line_content": "    if(!rc || !rc2) {",
          "new_line_content": "    free(data->req.doh.probe[1].serverdoh.memory);",
          "content_same": false
        },
        {
          "line": 942,
          "old_api": null,
          "new_api": "doh_strerror",
          "old_text": null,
          "new_text": "doh_strerror(rc2)",
          "old_line_content": "      struct Curl_addrinfo *ai;",
          "new_line_content": "      infof(data, \"DOH: %s type %s for %s\\n\", doh_strerror(rc2),",
          "content_same": false
        },
        {
          "line": 943,
          "old_api": null,
          "new_api": "type2name",
          "old_text": null,
          "new_text": "type2name(data->req.doh.probe[1].dnstype)",
          "old_line_content": "",
          "new_line_content": "            type2name(data->req.doh.probe[1].dnstype),",
          "content_same": false
        },
        {
          "line": 820,
          "old_api": null,
          "new_api": "calloc",
          "old_text": null,
          "new_text": "calloc(1, sizeof(Curl_addrinfo))",
          "old_line_content": "    if(!ai->ai_canonname) {",
          "new_line_content": "    ai = calloc(1, sizeof(Curl_addrinfo));",
          "content_same": false
        },
        {
          "line": 693,
          "old_api": null,
          "new_api": "get16bit",
          "old_text": null,
          "new_text": "get16bit(doh, index)",
          "old_line_content": "  }",
          "new_line_content": "    rdlength = get16bit(doh, index);",
          "content_same": false
        },
        {
          "line": 950,
          "old_api": null,
          "new_api": "infof",
          "old_text": null,
          "new_text": "infof(data, \"DOH Host name: %s\\n\", data->req.doh.host)",
          "old_line_content": "        return CURLE_OUT_OF_MEMORY;",
          "new_line_content": "      infof(data, \"DOH Host name: %s\\n\", data->req.doh.host);",
          "content_same": false
        },
        {
          "line": 567,
          "old_api": null,
          "new_api": "store_a",
          "old_text": null,
          "new_text": "store_a(doh, index, d)",
          "old_line_content": "      return DOH_DNS_RDATA_LEN;",
          "new_line_content": "    rc = store_a(doh, index, d);",
          "content_same": false
        },
        {
          "line": 951,
          "old_api": null,
          "new_api": "showdoh",
          "old_text": null,
          "new_text": "showdoh(data, &de)",
          "old_line_content": "      }",
          "new_line_content": "      showdoh(data, &de);",
          "content_same": false
        },
        {
          "line": 953,
          "old_api": null,
          "new_api": "doh2ai",
          "old_text": null,
          "new_text": "doh2ai(&de, data->req.doh.host, data->req.doh.port)",
          "old_line_content": "      if(data->share)",
          "new_line_content": "      ai = doh2ai(&de, data->req.doh.host, data->req.doh.port);",
          "content_same": false
        },
        {
          "line": 955,
          "old_api": null,
          "new_api": "de_cleanup",
          "old_text": null,
          "new_text": "de_cleanup(&de)",
          "old_line_content": "",
          "new_line_content": "        de_cleanup(&de);",
          "content_same": false
        },
        {
          "line": 701,
          "old_api": null,
          "new_api": "get16bit",
          "old_text": null,
          "new_text": "get16bit(doh, 10)",
          "old_line_content": "    if(dohlen < (index + 8))",
          "new_line_content": "  arcount = get16bit(doh, 10);",
          "content_same": false
        },
        {
          "line": 574,
          "old_api": null,
          "new_api": "store_aaaa",
          "old_text": null,
          "new_text": "store_aaaa(doh, index, d)",
          "old_line_content": "    if(rc)",
          "new_line_content": "    rc = store_aaaa(doh, index, d);",
          "content_same": false
        },
        {
          "line": 703,
          "old_api": null,
          "new_api": "skipqname",
          "old_text": null,
          "new_text": "skipqname(doh, dohlen, &index)",
          "old_line_content": "",
          "new_line_content": "    rc = skipqname(doh, dohlen, &index);",
          "content_same": false
        },
        {
          "line": 831,
          "old_api": null,
          "new_api": "calloc",
          "old_text": null,
          "new_text": "calloc(1, ss_size)",
          "old_line_content": "    }",
          "new_line_content": "    ai->ai_addr = calloc(1, ss_size);",
          "content_same": false
        },
        {
          "line": 834,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free(ai->ai_canonname)",
          "old_line_content": "      /* store the pointer we want to return from this function */",
          "new_line_content": "      free(ai->ai_canonname);",
          "content_same": false
        },
        {
          "line": 579,
          "old_api": null,
          "new_api": "store_cname",
          "old_text": null,
          "new_text": "store_cname(doh, dohlen, index, d)",
          "old_line_content": "    break;",
          "new_line_content": "    rc = store_cname(doh, dohlen, index, d);",
          "content_same": false
        },
        {
          "line": 835,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free(ai)",
          "old_line_content": "      firstai = ai;",
          "new_line_content": "      free(ai);",
          "content_same": false
        },
        {
          "line": 451,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(&a->ip.v4, &doh[index], 4)",
          "old_line_content": "static DOHcode store_aaaa(unsigned char *doh, int index, struct dohentry *d)",
          "new_line_content": "    memcpy(&a->ip.v4, &doh[index], 4);",
          "content_same": false
        },
        {
          "line": 963,
          "old_api": null,
          "new_api": "Curl_cache_addr",
          "old_text": null,
          "new_text": "Curl_cache_addr(data, ai, data->req.doh.host, data->req.doh.port)",
          "old_line_content": "      if(!dns)",
          "new_line_content": "      dns = Curl_cache_addr(data, ai, data->req.doh.host, data->req.doh.port);",
          "content_same": false
        },
        {
          "line": 966,
          "old_api": null,
          "new_api": "Curl_share_unlock",
          "old_text": null,
          "new_text": "Curl_share_unlock(data, CURL_LOCK_DATA_DNS)",
          "old_line_content": "      else {",
          "new_line_content": "        Curl_share_unlock(data, CURL_LOCK_DATA_DNS);",
          "content_same": false
        },
        {
          "line": 968,
          "old_api": null,
          "new_api": "de_cleanup",
          "old_text": null,
          "new_text": "de_cleanup(&de)",
          "old_line_content": "        *dnsp = dns;",
          "new_line_content": "      de_cleanup(&de);",
          "content_same": false
        },
        {
          "line": 715,
          "old_api": null,
          "new_api": "get16bit",
          "old_text": null,
          "new_text": "get16bit(doh, index)",
          "old_line_content": "  }",
          "new_line_content": "    rdlength = get16bit(doh, index);",
          "content_same": false
        },
        {
          "line": 971,
          "old_api": null,
          "new_api": "Curl_freeaddrinfo",
          "old_text": null,
          "new_text": "Curl_freeaddrinfo(ai)",
          "old_line_content": "    }",
          "new_line_content": "        Curl_freeaddrinfo(ai);",
          "content_same": false
        },
        {
          "line": 463,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(&a->ip.v6, &doh[index], 16)",
          "old_line_content": "static DOHcode cnameappend(struct cnamestore *c,",
          "new_line_content": "    memcpy(&a->ip.v6, &doh[index], 16);",
          "content_same": false
        },
        {
          "line": 592,
          "old_api": null,
          "new_api": "memset",
          "old_text": null,
          "new_text": "memset(de, 0, sizeof(*de))",
          "old_line_content": "                            size_t dohlen,",
          "new_line_content": "  memset(de, 0, sizeof(*de));",
          "content_same": false
        },
        {
          "line": 978,
          "old_api": null,
          "new_api": "de_cleanup",
          "old_text": null,
          "new_text": "de_cleanup(&de)",
          "old_line_content": "}",
          "new_line_content": "    de_cleanup(&de);",
          "content_same": false
        },
        {
          "line": 475,
          "old_api": null,
          "new_api": "malloc",
          "old_text": null,
          "new_text": "malloc(c->allocsize)",
          "old_line_content": "    c->allocsize += len + 1;",
          "new_line_content": "    c->alloc = malloc(c->allocsize);",
          "content_same": false
        },
        {
          "line": 860,
          "old_api": null,
          "new_api": "DEBUGASSERT",
          "old_text": null,
          "new_text": "DEBUGASSERT(sizeof(struct in_addr) == sizeof(de->addr[i].ip.v4))",
          "old_line_content": "#ifdef ENABLE_IPV6",
          "new_line_content": "      DEBUGASSERT(sizeof(struct in_addr) == sizeof(de->addr[i].ip.v4));",
          "content_same": false
        },
        {
          "line": 861,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(&addr->sin_addr, &de->addr[i].ip.v4, sizeof(struct in_addr))",
          "old_line_content": "    case AF_INET6:",
          "new_line_content": "      memcpy(&addr->sin_addr, &de->addr[i].ip.v4, sizeof(struct in_addr));",
          "content_same": false
        },
        {
          "line": 738,
          "old_api": null,
          "new_api": "infof",
          "old_text": null,
          "new_text": "infof(data, \"TTL: %u seconds\\n\", d->ttl)",
          "old_line_content": "            a->ip.v4[2], a->ip.v4[3]);",
          "new_line_content": "  infof(data, \"TTL: %u seconds\\n\", d->ttl);",
          "content_same": false
        },
        {
          "line": 482,
          "old_api": null,
          "new_api": "realloc",
          "old_text": null,
          "new_text": "realloc(c->alloc, c->allocsize)",
          "old_line_content": "  }",
          "new_line_content": "    ptr = realloc(c->alloc, c->allocsize);",
          "content_same": false
        },
        {
          "line": 484,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free(c->alloc)",
          "old_line_content": "  c->len += len;",
          "new_line_content": "      free(c->alloc);",
          "content_same": false
        },
        {
          "line": 869,
          "old_api": null,
          "new_api": "DEBUGASSERT",
          "old_text": null,
          "new_text": "DEBUGASSERT(sizeof(struct in6_addr) == sizeof(de->addr[i].ip.v6))",
          "old_line_content": "    }",
          "new_line_content": "      DEBUGASSERT(sizeof(struct in6_addr) == sizeof(de->addr[i].ip.v6));",
          "content_same": false
        },
        {
          "line": 742,
          "old_api": null,
          "new_api": "infof",
          "old_text": null,
          "new_text": "infof(data, \"DOH A: %u.%u.%u.%u\\n\",\n            a->ip.v4[0], a->ip.v4[1],\n            a->ip.v4[2], a->ip.v4[3])",
          "old_line_content": "      char buffer[128];",
          "new_line_content": "      infof(data, \"DOH A: %u.%u.%u.%u\\n\",",
          "content_same": false
        },
        {
          "line": 870,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(&addr6->sin6_addr, &de->addr[i].ip.v6, sizeof(struct in6_addr))",
          "old_line_content": "",
          "new_line_content": "      memcpy(&addr6->sin6_addr, &de->addr[i].ip.v6, sizeof(struct in6_addr));",
          "content_same": false
        },
        {
          "line": 872,
          "old_api": null,
          "new_api": "htons",
          "old_text": null,
          "new_text": "htons((unsigned short)port)",
          "old_line_content": "  }",
          "new_line_content": "      addr6->sin6_port = htons((unsigned short)port);",
          "content_same": false
        },
        {
          "line": 489,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(&c->alloc[c->len], src, len)",
          "old_line_content": "static DOHcode store_cname(unsigned char *doh,",
          "new_line_content": "  memcpy(&c->alloc[c->len], src, len);",
          "content_same": false
        },
        {
          "line": 620,
          "old_api": null,
          "new_api": "get16bit",
          "old_text": null,
          "new_text": "get16bit(doh, 4)",
          "old_line_content": "      return DOH_DNS_OUT_OF_RANGE;",
          "new_line_content": "  qdcount = get16bit(doh, 4);",
          "content_same": false
        },
        {
          "line": 622,
          "old_api": null,
          "new_api": "skipqname",
          "old_text": null,
          "new_text": "skipqname(doh, dohlen, &index)",
          "old_line_content": "    qdcount--;",
          "new_line_content": "    rc = skipqname(doh, dohlen, &index);",
          "content_same": false
        },
        {
          "line": 751,
          "old_api": null,
          "new_api": "msnprintf",
          "old_text": null,
          "new_text": "msnprintf(buffer, 128, \"DOH AAAA: \")",
          "old_line_content": "                  d->addr[i].ip.v6[j + 1]);",
          "new_line_content": "      msnprintf(buffer, 128, \"DOH AAAA: \");",
          "content_same": false
        },
        {
          "line": 881,
          "old_api": null,
          "new_api": "Curl_freeaddrinfo",
          "old_text": null,
          "new_text": "Curl_freeaddrinfo(firstai)",
          "old_line_content": "",
          "new_line_content": "    Curl_freeaddrinfo(firstai);",
          "content_same": false
        },
        {
          "line": 758,
          "old_api": null,
          "new_api": "strlen",
          "old_text": null,
          "new_text": "strlen(ptr)",
          "old_line_content": "  }",
          "new_line_content": "        l = strlen(ptr);",
          "content_same": false
        },
        {
          "line": 631,
          "old_api": null,
          "new_api": "get16bit",
          "old_text": null,
          "new_text": "get16bit(doh, 6)",
          "old_line_content": "    if(rc)",
          "new_line_content": "  ancount = get16bit(doh, 6);",
          "content_same": false
        },
        {
          "line": 762,
          "old_api": null,
          "new_api": "infof",
          "old_text": null,
          "new_text": "infof(data, \"%s\\n\", buffer)",
          "old_line_content": "}",
          "new_line_content": "      infof(data, \"%s\\n\", buffer);",
          "content_same": false
        },
        {
          "line": 636,
          "old_api": null,
          "new_api": "skipqname",
          "old_text": null,
          "new_text": "skipqname(doh, dohlen, &index)",
          "old_line_content": "",
          "new_line_content": "    rc = skipqname(doh, dohlen, &index);",
          "content_same": false
        },
        {
          "line": 766,
          "old_api": null,
          "new_api": "infof",
          "old_text": null,
          "new_text": "infof(data, \"CNAME: %s\\n\", d->cname[i].alloc)",
          "old_line_content": "",
          "new_line_content": "    infof(data, \"CNAME: %s\\n\", d->cname[i].alloc);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 904,
          "old_api": "failf",
          "new_api": null,
          "old_text": "failf(data, \"Could not DOH-resolve: %s\", conn->async.hostname)",
          "new_text": null,
          "old_line_content": "    failf(data, \"Could not DOH-resolve: %s\", conn->async.hostname);",
          "new_line_content": "                              struct Curl_dns_entry **dnsp)",
          "content_same": false
        },
        {
          "line": 525,
          "old_api": "cnameappend",
          "new_api": null,
          "old_text": "cnameappend(c, (unsigned char *)\".\", 1)",
          "new_text": null,
          "old_line_content": "        rc = cnameappend(c, (unsigned char *)\".\", 1);",
          "new_line_content": "    else",
          "content_same": false
        },
        {
          "line": 653,
          "old_api": "get32bit",
          "new_api": null,
          "old_text": "get32bit(doh, index)",
          "new_text": null,
          "old_line_content": "    ttl = get32bit(doh, index);",
          "new_line_content": "      return DOH_DNS_UNEXPECTED_CLASS; /* unsupported */",
          "content_same": false
        },
        {
          "line": 893,
          "old_api": "free",
          "new_api": null,
          "old_text": "free(d->cname[i].alloc)",
          "new_text": null,
          "old_line_content": "    free(d->cname[i].alloc);",
          "new_line_content": "#endif",
          "content_same": false
        },
        {
          "line": 913,
          "old_api": "curl_multi_remove_handle",
          "new_api": null,
          "old_text": "curl_multi_remove_handle(data->multi, data->req.doh.probe[0].easy)",
          "new_text": null,
          "old_line_content": "    curl_multi_remove_handle(data->multi, data->req.doh.probe[0].easy);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 914,
          "old_api": "Curl_close",
          "new_api": null,
          "old_text": "Curl_close(data->req.doh.probe[0].easy)",
          "new_text": null,
          "old_line_content": "    Curl_close(data->req.doh.probe[0].easy);",
          "new_line_content": "  else if(!data->req.doh.pending) {",
          "content_same": false
        },
        {
          "line": 915,
          "old_api": "curl_multi_remove_handle",
          "new_api": null,
          "old_text": "curl_multi_remove_handle(data->multi, data->req.doh.probe[1].easy)",
          "new_text": null,
          "old_line_content": "    curl_multi_remove_handle(data->multi, data->req.doh.probe[1].easy);",
          "new_line_content": "    DOHcode rc;",
          "content_same": false
        },
        {
          "line": 532,
          "old_api": "cnameappend",
          "new_api": null,
          "old_text": "cnameappend(c, &doh[index], length)",
          "new_text": null,
          "old_line_content": "      rc = cnameappend(c, &doh[index], length);",
          "new_line_content": "        if(rc)",
          "content_same": false
        },
        {
          "line": 661,
          "old_api": "get16bit",
          "new_api": null,
          "old_text": "get16bit(doh, index)",
          "new_text": null,
          "old_line_content": "    rdlength = get16bit(doh, index);",
          "new_line_content": "      d->ttl = ttl;",
          "content_same": false
        },
        {
          "line": 916,
          "old_api": "Curl_close",
          "new_api": null,
          "old_text": "Curl_close(data->req.doh.probe[1].easy)",
          "new_text": null,
          "old_line_content": "    Curl_close(data->req.doh.probe[1].easy);",
          "new_line_content": "    DOHcode rc2;",
          "content_same": false
        },
        {
          "line": 666,
          "old_api": "rdata",
          "new_api": null,
          "old_text": "rdata(doh, dohlen, rdlength, type, index, d)",
          "new_text": null,
          "old_line_content": "    rc = rdata(doh, dohlen, rdlength, type, index, d);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 924,
          "old_api": "free",
          "new_api": null,
          "old_text": "free(data->req.doh.probe[0].serverdoh.memory)",
          "new_text": null,
          "old_line_content": "    free(data->req.doh.probe[0].serverdoh.memory);",
          "new_line_content": "    /* parse the responses, create the struct and return it! */",
          "content_same": false
        },
        {
          "line": 927,
          "old_api": "type2name",
          "new_api": null,
          "old_text": "type2name(data->req.doh.probe[0].dnstype)",
          "new_text": null,
          "old_line_content": "            type2name(data->req.doh.probe[0].dnstype),",
          "new_line_content": "                    data->req.doh.probe[0].serverdoh.size,",
          "content_same": false
        },
        {
          "line": 673,
          "old_api": "get16bit",
          "new_api": null,
          "old_text": "get16bit(doh, 8)",
          "new_text": null,
          "old_line_content": "  nscount = get16bit(doh, 8);",
          "new_line_content": "    if(rc)",
          "content_same": false
        },
        {
          "line": 675,
          "old_api": "skipqname",
          "new_api": null,
          "old_text": "skipqname(doh, dohlen, &index)",
          "new_text": null,
          "old_line_content": "    rc = skipqname(doh, dohlen, &index);",
          "new_line_content": "    index += rdlength;",
          "content_same": false
        },
        {
          "line": 934,
          "old_api": "free",
          "new_api": null,
          "old_text": "free(data->req.doh.probe[1].serverdoh.memory)",
          "new_text": null,
          "old_line_content": "    free(data->req.doh.probe[1].serverdoh.memory);",
          "new_line_content": "            data->req.doh.host);",
          "content_same": false
        },
        {
          "line": 937,
          "old_api": "type2name",
          "new_api": null,
          "old_text": "type2name(data->req.doh.probe[1].dnstype)",
          "new_text": null,
          "old_line_content": "            type2name(data->req.doh.probe[1].dnstype),",
          "new_line_content": "                     data->req.doh.probe[1].serverdoh.size,",
          "content_same": false
        },
        {
          "line": 814,
          "old_api": "calloc",
          "new_api": null,
          "old_text": "calloc(1, sizeof(Curl_addrinfo))",
          "new_text": null,
          "old_line_content": "    ai = calloc(1, sizeof(Curl_addrinfo));",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 687,
          "old_api": "get16bit",
          "new_api": null,
          "old_text": "get16bit(doh, index)",
          "new_text": null,
          "old_line_content": "    rdlength = get16bit(doh, index);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 944,
          "old_api": "infof",
          "new_api": null,
          "old_text": "infof(data, \"DOH Host name: %s\\n\", data->req.doh.host)",
          "new_text": null,
          "old_line_content": "      infof(data, \"DOH Host name: %s\\n\", data->req.doh.host);",
          "new_line_content": "            data->req.doh.host);",
          "content_same": false
        },
        {
          "line": 561,
          "old_api": "store_a",
          "new_api": null,
          "old_text": "store_a(doh, index, d)",
          "new_text": null,
          "old_line_content": "    rc = store_a(doh, index, d);",
          "new_line_content": "  DOHcode rc;",
          "content_same": false
        },
        {
          "line": 945,
          "old_api": "showdoh",
          "new_api": null,
          "old_text": "showdoh(data, &de)",
          "new_text": null,
          "old_line_content": "      showdoh(data, &de);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 819,
          "old_api": "strdup",
          "new_api": null,
          "old_text": "strdup(hostname)",
          "new_text": null,
          "old_line_content": "    ai->ai_canonname = strdup(hostname);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 947,
          "old_api": "doh2ai",
          "new_api": null,
          "old_text": "doh2ai(&de, data->req.doh.host, data->req.doh.port)",
          "new_text": null,
          "old_line_content": "      ai = doh2ai(&de, data->req.doh.host, data->req.doh.port);",
          "new_line_content": "      struct Curl_dns_entry *dns;",
          "content_same": false
        },
        {
          "line": 949,
          "old_api": "de_cleanup",
          "new_api": null,
          "old_text": "de_cleanup(&de)",
          "new_text": null,
          "old_line_content": "        de_cleanup(&de);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 822,
          "old_api": "free",
          "new_api": null,
          "old_text": "free(ai)",
          "new_text": null,
          "old_line_content": "      free(ai);",
          "new_line_content": "      result = CURLE_OUT_OF_MEMORY;",
          "content_same": false
        },
        {
          "line": 695,
          "old_api": "get16bit",
          "new_api": null,
          "old_text": "get16bit(doh, 10)",
          "new_text": null,
          "old_line_content": "  arcount = get16bit(doh, 10);",
          "new_line_content": "    if(dohlen < (index + rdlength))",
          "content_same": false
        },
        {
          "line": 568,
          "old_api": "store_aaaa",
          "new_api": null,
          "old_text": "store_aaaa(doh, index, d)",
          "new_text": null,
          "old_line_content": "    rc = store_aaaa(doh, index, d);",
          "new_line_content": "    if(rc)",
          "content_same": false
        },
        {
          "line": 697,
          "old_api": "skipqname",
          "new_api": null,
          "old_text": "skipqname(doh, dohlen, &index)",
          "new_text": null,
          "old_line_content": "    rc = skipqname(doh, dohlen, &index);",
          "new_line_content": "    index += rdlength;",
          "content_same": false
        },
        {
          "line": 954,
          "old_api": "Curl_share_lock",
          "new_api": null,
          "old_text": "Curl_share_lock(data, CURL_LOCK_DATA_DNS, CURL_LOCK_ACCESS_SINGLE)",
          "new_text": null,
          "old_line_content": "        Curl_share_lock(data, CURL_LOCK_DATA_DNS, CURL_LOCK_ACCESS_SINGLE);",
          "new_line_content": "      if(!ai) {",
          "content_same": false
        },
        {
          "line": 573,
          "old_api": "store_cname",
          "new_api": null,
          "old_text": "store_cname(doh, dohlen, index, d)",
          "new_text": null,
          "old_line_content": "    rc = store_cname(doh, dohlen, index, d);",
          "new_line_content": "      return DOH_DNS_RDATA_LEN;",
          "content_same": false
        },
        {
          "line": 829,
          "old_api": "free",
          "new_api": null,
          "old_text": "free(ai)",
          "new_text": null,
          "old_line_content": "      free(ai);",
          "new_line_content": "      break;",
          "content_same": false
        },
        {
          "line": 445,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(&a->ip.v4, &doh[index], 4)",
          "new_text": null,
          "old_line_content": "    memcpy(&a->ip.v4, &doh[index], 4);",
          "new_line_content": "static DOHcode store_a(unsigned char *doh, int index, struct dohentry *d)",
          "content_same": false
        },
        {
          "line": 957,
          "old_api": "Curl_cache_addr",
          "new_api": null,
          "old_text": "Curl_cache_addr(data, ai, data->req.doh.host, data->req.doh.port)",
          "new_text": null,
          "old_line_content": "      dns = Curl_cache_addr(data, ai, data->req.doh.host, data->req.doh.port);",
          "new_line_content": "      }",
          "content_same": false
        },
        {
          "line": 962,
          "old_api": "de_cleanup",
          "new_api": null,
          "old_text": "de_cleanup(&de)",
          "new_text": null,
          "old_line_content": "      de_cleanup(&de);",
          "new_line_content": "      /* we got a response, store it in the cache */",
          "content_same": false
        },
        {
          "line": 709,
          "old_api": "get16bit",
          "new_api": null,
          "old_text": "get16bit(doh, index)",
          "new_text": null,
          "old_line_content": "    rdlength = get16bit(doh, index);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 965,
          "old_api": "Curl_freeaddrinfo",
          "new_api": null,
          "old_text": "Curl_freeaddrinfo(ai)",
          "new_text": null,
          "old_line_content": "        Curl_freeaddrinfo(ai);",
          "new_line_content": "      if(data->share)",
          "content_same": false
        },
        {
          "line": 457,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(&a->ip.v6, &doh[index], 16)",
          "new_text": null,
          "old_line_content": "    memcpy(&a->ip.v6, &doh[index], 16);",
          "new_line_content": "static DOHcode store_aaaa(unsigned char *doh, int index, struct dohentry *d)",
          "content_same": false
        },
        {
          "line": 586,
          "old_api": "memset",
          "new_api": null,
          "old_text": "memset(de, 0, sizeof(*de))",
          "new_text": null,
          "old_line_content": "  memset(de, 0, sizeof(*de));",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 972,
          "old_api": "de_cleanup",
          "new_api": null,
          "old_text": "de_cleanup(&de)",
          "new_text": null,
          "old_line_content": "    de_cleanup(&de);",
          "new_line_content": "      else {",
          "content_same": false
        },
        {
          "line": 469,
          "old_api": "malloc",
          "new_api": null,
          "old_text": "malloc(c->allocsize)",
          "new_text": null,
          "old_line_content": "    c->alloc = malloc(c->allocsize);",
          "new_line_content": "static DOHcode cnameappend(struct cnamestore *c,",
          "content_same": false
        },
        {
          "line": 854,
          "old_api": "DEBUGASSERT",
          "new_api": null,
          "old_text": "DEBUGASSERT(sizeof(struct in_addr) == sizeof(de->addr[i].ip.v4))",
          "new_text": null,
          "old_line_content": "      DEBUGASSERT(sizeof(struct in_addr) == sizeof(de->addr[i].ip.v4));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 855,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(&addr->sin_addr, &de->addr[i].ip.v4, sizeof(struct in_addr))",
          "new_text": null,
          "old_line_content": "      memcpy(&addr->sin_addr, &de->addr[i].ip.v4, sizeof(struct in_addr));",
          "new_line_content": "    /* leave the rest of the struct filled with zero */",
          "content_same": false
        },
        {
          "line": 857,
          "old_api": "htons",
          "new_api": null,
          "old_text": "htons((unsigned short)port)",
          "new_text": null,
          "old_line_content": "      addr->sin_port = htons((unsigned short)port);",
          "new_line_content": "    switch(ai->ai_family) {",
          "content_same": false
        },
        {
          "line": 732,
          "old_api": "infof",
          "new_api": null,
          "old_text": "infof(data, \"TTL: %u seconds\\n\", d->ttl)",
          "new_text": null,
          "old_line_content": "  infof(data, \"TTL: %u seconds\\n\", d->ttl);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 476,
          "old_api": "realloc",
          "new_api": null,
          "old_text": "realloc(c->alloc, c->allocsize)",
          "new_text": null,
          "old_line_content": "    ptr = realloc(c->alloc, c->allocsize);",
          "new_line_content": "    if(!c->alloc)",
          "content_same": false
        },
        {
          "line": 478,
          "old_api": "free",
          "new_api": null,
          "old_text": "free(c->alloc)",
          "new_text": null,
          "old_line_content": "      free(c->alloc);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 736,
          "old_api": "infof",
          "new_api": null,
          "old_text": "infof(data, \"DOH A: %u.%u.%u.%u\\n\",\n            a->ip.v4[0], a->ip.v4[1],\n            a->ip.v4[2], a->ip.v4[3])",
          "new_text": null,
          "old_line_content": "      infof(data, \"DOH A: %u.%u.%u.%u\\n\",",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 864,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(&addr6->sin6_addr, &de->addr[i].ip.v6, sizeof(struct in6_addr))",
          "new_text": null,
          "old_line_content": "      memcpy(&addr6->sin6_addr, &de->addr[i].ip.v6, sizeof(struct in6_addr));",
          "new_line_content": "      break;",
          "content_same": false
        },
        {
          "line": 866,
          "old_api": "htons",
          "new_api": null,
          "old_text": "htons((unsigned short)port)",
          "new_text": null,
          "old_line_content": "      addr6->sin6_port = htons((unsigned short)port);",
          "new_line_content": "#ifdef ENABLE_IPV6",
          "content_same": false
        },
        {
          "line": 483,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(&c->alloc[c->len], src, len)",
          "new_text": null,
          "old_line_content": "  memcpy(&c->alloc[c->len], src, len);",
          "new_line_content": "    if(!ptr) {",
          "content_same": false
        },
        {
          "line": 614,
          "old_api": "get16bit",
          "new_api": null,
          "old_text": "get16bit(doh, 4)",
          "new_text": null,
          "old_line_content": "  qdcount = get16bit(doh, 4);",
          "new_line_content": "  if(!doh || doh[0] || doh[1])",
          "content_same": false
        },
        {
          "line": 616,
          "old_api": "skipqname",
          "new_api": null,
          "old_text": "skipqname(doh, dohlen, &index)",
          "new_text": null,
          "old_line_content": "    rc = skipqname(doh, dohlen, &index);",
          "new_line_content": "  rcode = doh[3] & 0x0f;",
          "content_same": false
        },
        {
          "line": 745,
          "old_api": "msnprintf",
          "new_api": null,
          "old_text": "msnprintf(buffer, 128, \"DOH AAAA: \")",
          "new_text": null,
          "old_line_content": "      msnprintf(buffer, 128, \"DOH AAAA: \");",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 875,
          "old_api": "Curl_freeaddrinfo",
          "new_api": null,
          "old_text": "Curl_freeaddrinfo(firstai)",
          "new_text": null,
          "old_line_content": "    Curl_freeaddrinfo(firstai);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 750,
          "old_api": "msnprintf",
          "new_api": null,
          "old_text": "msnprintf(ptr, len, \"%s%02x%02x\", j?\":\":\"\", d->addr[i].ip.v6[j],\n                  d->addr[i].ip.v6[j + 1])",
          "new_text": null,
          "old_line_content": "        msnprintf(ptr, len, \"%s%02x%02x\", j?\":\":\"\", d->addr[i].ip.v6[j],",
          "new_line_content": "      size_t len;",
          "content_same": false
        },
        {
          "line": 752,
          "old_api": "strlen",
          "new_api": null,
          "old_text": "strlen(ptr)",
          "new_text": null,
          "old_line_content": "        l = strlen(ptr);",
          "new_line_content": "      ptr = &buffer[10];",
          "content_same": false
        },
        {
          "line": 625,
          "old_api": "get16bit",
          "new_api": null,
          "old_text": "get16bit(doh, 6)",
          "new_text": null,
          "old_line_content": "  ancount = get16bit(doh, 6);",
          "new_line_content": "    if(dohlen < (index + 4))",
          "content_same": false
        },
        {
          "line": 630,
          "old_api": "skipqname",
          "new_api": null,
          "old_text": "skipqname(doh, dohlen, &index)",
          "new_text": null,
          "old_line_content": "    rc = skipqname(doh, dohlen, &index);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 760,
          "old_api": "infof",
          "new_api": null,
          "old_text": "infof(data, \"CNAME: %s\\n\", d->cname[i].alloc)",
          "new_text": null,
          "old_line_content": "    infof(data, \"CNAME: %s\\n\", d->cname[i].alloc);",
          "new_line_content": "        ptr += l;",
          "content_same": false
        },
        {
          "line": 637,
          "old_api": "get16bit",
          "new_api": null,
          "old_text": "get16bit(doh, index)",
          "new_text": null,
          "old_line_content": "    type = get16bit(doh, index);",
          "new_line_content": "    if(rc)",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 9,
      "total_additions": 61,
      "total_deletions": 61,
      "total_api_changes": 131
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 8,
        "api_related_lines": 131,
        "non_api_lines": 8,
        "non_api_line_numbers": [
          435,
          436,
          437,
          438,
          439,
          440,
          441,
          442
        ]
      }
    },
    "api_calls_before": 133,
    "api_calls_after": 133,
    "diff_info": {
      "added_lines": 8,
      "removed_lines": 2,
      "total_diff_lines": 22
    }
  }
}