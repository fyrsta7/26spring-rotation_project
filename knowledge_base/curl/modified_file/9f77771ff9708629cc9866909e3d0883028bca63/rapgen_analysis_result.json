{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/curl/modified_file/9f77771ff9708629cc9866909e3d0883028bca63",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/curl/modified_file/9f77771ff9708629cc9866909e3d0883028bca63/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/curl/modified_file/9f77771ff9708629cc9866909e3d0883028bca63/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/curl/modified_file/9f77771ff9708629cc9866909e3d0883028bca63/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 254,
          "old_api": "connect",
          "new_api": "htons",
          "old_text": "connect(sockfd, (struct sockaddr *)&serv_addr,\n                 sizeof(serv_addr))",
          "new_text": "htons(port)",
          "old_line_content": "    rc = connect(sockfd, (struct sockaddr *)&serv_addr,",
          "new_line_content": "    serv_addr.sin_port = htons(port);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 256,
          "old_api": null,
          "new_api": "connect",
          "old_text": null,
          "new_text": "connect(sockfd, (struct sockaddr *)&serv_addr,\n                 sizeof(serv_addr))",
          "old_line_content": "",
          "new_line_content": "    rc = connect(sockfd, (struct sockaddr *)&serv_addr,",
          "content_same": false
        },
        {
          "line": 289,
          "old_api": null,
          "new_api": "Curl_tvdiff",
          "old_text": null,
          "new_text": "Curl_tvdiff(after, before)",
          "old_line_content": "      continue; /* try next address */",
          "new_line_content": "      timeout_ms -= (long)(Curl_tvdiff(after, before)*1000);",
          "content_same": false
        },
        {
          "line": 288,
          "old_api": null,
          "new_api": "Curl_tvnow",
          "old_text": null,
          "new_text": "Curl_tvnow()",
          "old_line_content": "      before = after;",
          "new_line_content": "      after = Curl_tvnow();",
          "content_same": false
        },
        {
          "line": 262,
          "old_api": null,
          "new_api": "GetLastError",
          "old_text": null,
          "new_text": "GetLastError()",
          "old_line_content": "      error = errno;",
          "new_line_content": "      error = (int)GetLastError();",
          "content_same": false
        },
        {
          "line": 233,
          "old_api": null,
          "new_api": "socket",
          "old_text": null,
          "new_text": "socket(AF_INET, SOCK_STREAM, 0)",
          "old_line_content": "  if(-1 == sockfd)",
          "new_line_content": "    sockfd = socket(AF_INET, SOCK_STREAM, 0);",
          "content_same": false
        },
        {
          "line": 298,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy((char *) &conn->serv_addr, &serv_addr,\n             sizeof(conn->serv_addr))",
          "old_line_content": "  }",
          "new_line_content": "      memcpy((char *) &conn->serv_addr, &serv_addr,",
          "content_same": false
        },
        {
          "line": 239,
          "old_api": null,
          "new_api": "nonblock",
          "old_text": null,
          "new_text": "nonblock(sockfd, TRUE)",
          "old_line_content": "  /* This is the loop that attempts to connect to all IP-addresses we",
          "new_line_content": "  nonblock(sockfd, TRUE);",
          "content_same": false
        },
        {
          "line": 305,
          "old_api": null,
          "new_api": "sclose",
          "old_text": null,
          "new_text": "sclose(sockfd)",
          "old_line_content": "  }",
          "new_line_content": "    sclose(sockfd);",
          "content_same": false
        },
        {
          "line": 307,
          "old_api": null,
          "new_api": "failf",
          "old_text": null,
          "new_text": "failf(data, \"Couldn't connect to (any) IP address\")",
          "old_line_content": "  /* now disable the non-blocking mode again */",
          "new_line_content": "    failf(data, \"Couldn't connect to (any) IP address\");",
          "content_same": false
        },
        {
          "line": 278,
          "old_api": null,
          "new_api": "waitconnect",
          "old_text": null,
          "new_text": "waitconnect(sockfd, timeout_ms)",
          "old_line_content": "      default:",
          "new_line_content": "        rc = waitconnect(sockfd, timeout_ms);",
          "content_same": false
        },
        {
          "line": 312,
          "old_api": null,
          "new_api": "nonblock",
          "old_text": null,
          "new_text": "nonblock(sockfd, FALSE)",
          "old_line_content": "  *socket = sockfd; /* pass this to our parent */",
          "new_line_content": "  nonblock(sockfd, FALSE);",
          "content_same": false
        },
        {
          "line": 249,
          "old_api": null,
          "new_api": "memset",
          "old_text": null,
          "new_text": "memset((char *) &serv_addr, '\\0', sizeof(serv_addr))",
          "old_line_content": "           (struct in_addr *)remotehost->h_addr_list[aliasindex],",
          "new_line_content": "    memset((char *) &serv_addr, '\\0', sizeof(serv_addr));",
          "content_same": false
        },
        {
          "line": 250,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy((char *)&(serv_addr.sin_addr),\n           (struct in_addr *)remotehost->h_addr_list[aliasindex],\n           sizeof(struct in_addr))",
          "old_line_content": "           sizeof(struct in_addr));",
          "new_line_content": "    memcpy((char *)&(serv_addr.sin_addr),",
          "content_same": false
        },
        {
          "line": 221,
          "old_api": null,
          "new_api": "strerror",
          "old_text": null,
          "new_text": "strerror(errno)",
          "old_line_content": "  }",
          "new_line_content": "    failf(data, strerror(errno));",
          "content_same": false
        },
        {
          "line": 216,
          "old_api": null,
          "new_api": "nonblock",
          "old_text": null,
          "new_text": "nonblock(sockfd, FALSE)",
          "old_line_content": "  }",
          "new_line_content": "    nonblock(sockfd, FALSE);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 260,
          "old_api": "GetLastError",
          "new_api": null,
          "old_text": "GetLastError()",
          "new_text": null,
          "old_line_content": "      error = (int)GetLastError();",
          "new_line_content": "      int error;",
          "content_same": false
        },
        {
          "line": 294,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy((char *) &conn->serv_addr, &serv_addr,\n             sizeof(conn->serv_addr))",
          "new_text": null,
          "old_line_content": "      memcpy((char *) &conn->serv_addr, &serv_addr,",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 231,
          "old_api": "socket",
          "new_api": null,
          "old_text": "socket(AF_INET, SOCK_STREAM, 0)",
          "new_text": null,
          "old_line_content": "    sockfd = socket(AF_INET, SOCK_STREAM, 0);",
          "new_line_content": "  if(-1 == sockfd)",
          "content_same": false
        },
        {
          "line": 301,
          "old_api": "sclose",
          "new_api": null,
          "old_text": "sclose(sockfd)",
          "new_text": null,
          "old_line_content": "    sclose(sockfd);",
          "new_line_content": "    break;",
          "content_same": false
        },
        {
          "line": 237,
          "old_api": "nonblock",
          "new_api": null,
          "old_text": "nonblock(sockfd, TRUE)",
          "new_text": null,
          "old_line_content": "  nonblock(sockfd, TRUE);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 303,
          "old_api": "failf",
          "new_api": null,
          "old_text": "failf(data, \"Couldn't connect to (any) IP address\")",
          "new_text": null,
          "old_line_content": "    failf(data, \"Couldn't connect to (any) IP address\");",
          "new_line_content": "  if(-1 == rc) {",
          "content_same": false
        },
        {
          "line": 276,
          "old_api": "waitconnect",
          "new_api": null,
          "old_text": "waitconnect(sockfd, timeout_ms)",
          "new_text": null,
          "old_line_content": "        rc = waitconnect(sockfd, timeout_ms);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 308,
          "old_api": "nonblock",
          "new_api": null,
          "old_text": "nonblock(sockfd, FALSE)",
          "new_text": null,
          "old_line_content": "  nonblock(sockfd, FALSE);",
          "new_line_content": "    return CURLE_COULDNT_CONNECT;",
          "content_same": false
        },
        {
          "line": 214,
          "old_api": "nonblock",
          "new_api": null,
          "old_text": "nonblock(sockfd, FALSE)",
          "new_text": null,
          "old_line_content": "    nonblock(sockfd, FALSE);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 247,
          "old_api": "memset",
          "new_api": null,
          "old_text": "memset((char *) &serv_addr, '\\0', sizeof(serv_addr))",
          "new_text": null,
          "old_line_content": "    memset((char *) &serv_addr, '\\0', sizeof(serv_addr));",
          "new_line_content": "    /* copy this particular name info to the conn struct as it might",
          "content_same": false
        },
        {
          "line": 248,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy((char *)&(serv_addr.sin_addr),\n           (struct in_addr *)remotehost->h_addr_list[aliasindex],\n           sizeof(struct in_addr))",
          "new_text": null,
          "old_line_content": "    memcpy((char *)&(serv_addr.sin_addr),",
          "new_line_content": "       be used later in the krb4 \"system\" */",
          "content_same": false
        },
        {
          "line": 219,
          "old_api": "strerror",
          "new_api": null,
          "old_text": "strerror(errno)",
          "new_text": null,
          "old_line_content": "    failf(data, strerror(errno));",
          "new_line_content": "  conn->ai = ai;",
          "content_same": false
        },
        {
          "line": 252,
          "old_api": "htons",
          "new_api": null,
          "old_text": "htons(port)",
          "new_text": null,
          "old_line_content": "    serv_addr.sin_port = htons(port);",
          "new_line_content": "           sizeof(struct in_addr));",
          "content_same": false
        },
        {
          "line": 286,
          "old_api": "Curl_tvnow",
          "new_api": null,
          "old_text": "Curl_tvnow()",
          "new_text": null,
          "old_line_content": "      after = Curl_tvnow();",
          "new_line_content": "    if(0 != rc) {",
          "content_same": false
        },
        {
          "line": 287,
          "old_api": "Curl_tvdiff",
          "new_api": null,
          "old_text": "Curl_tvdiff(after, before)",
          "new_text": null,
          "old_line_content": "      timeout_ms -= (long)(Curl_tvdiff(after, before)*1000);",
          "new_line_content": "      /* get a new timeout for next attempt */",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 1,
      "total_additions": 15,
      "total_deletions": 15,
      "total_api_changes": 31
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 4,
        "api_related_lines": 31,
        "non_api_lines": 4,
        "non_api_line_numbers": [
          209,
          210,
          291,
          290
        ]
      }
    },
    "api_calls_before": 35,
    "api_calls_after": 35,
    "diff_info": {
      "added_lines": 4,
      "removed_lines": 0,
      "total_diff_lines": 23
    }
  }
}