{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/sway/modified_file/cc8d318aa1ab380166aa8183dba84a8d2a9ab2aa",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/sway/modified_file/cc8d318aa1ab380166aa8183dba84a8d2a9ab2aa/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/sway/modified_file/cc8d318aa1ab380166aa8183dba84a8d2a9ab2aa/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/sway/modified_file/cc8d318aa1ab380166aa8183dba84a8d2a9ab2aa/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 373,
          "old_api": "transaction_commit",
          "new_api": "list_del",
          "old_text": "transaction_commit(transaction)",
          "new_text": "list_del(server.transactions, 0)",
          "old_line_content": "\ttransaction_commit(transaction);",
          "new_line_content": "\t\t\tlist_del(server.transactions, 0);",
          "content_same": false
        },
        {
          "line": 374,
          "old_api": "transaction_progress_queue",
          "new_api": "transaction_destroy",
          "old_text": "transaction_progress_queue()",
          "new_text": "transaction_destroy(txn)",
          "old_line_content": "\ttransaction_progress_queue();",
          "new_line_content": "\t\t\ttransaction_destroy(txn);",
          "content_same": false
        },
        {
          "line": 382,
          "old_api": "transaction_progress_queue",
          "new_api": "transaction_commit",
          "old_text": "transaction_progress_queue()",
          "new_text": "transaction_commit(transaction)",
          "old_line_content": "\ttransaction_progress_queue();",
          "new_line_content": "\ttransaction_commit(transaction);",
          "content_same": false
        },
        {
          "line": 388,
          "old_api": "node_is_view",
          "new_api": "sway_log",
          "old_text": "node_is_view(node)",
          "new_text": "sway_log(SWAY_DEBUG, \"Transaction %p timed out (%zi waiting)\",\n\t\t\ttransaction, transaction->num_waiting)",
          "old_line_content": "\tif (!node_is_view(node)) {",
          "new_line_content": "\tsway_log(SWAY_DEBUG, \"Transaction %p timed out (%zi waiting)\",",
          "content_same": false
        },
        {
          "line": 452,
          "old_api": "clock_gettime",
          "new_api": "view_save_buffer",
          "old_text": "clock_gettime(CLOCK_MONOTONIC, &transaction->commit_time)",
          "new_text": "view_save_buffer(node->sway_container->view)",
          "old_line_content": "\t\tclock_gettime(CLOCK_MONOTONIC, &transaction->commit_time);",
          "new_line_content": "\t\t\tview_save_buffer(node->sway_container->view);",
          "content_same": false
        },
        {
          "line": 553,
          "old_api": "transaction_commit",
          "new_api": "transaction_add_node",
          "old_text": "transaction_commit(transaction)",
          "new_text": "transaction_add_node(transaction, node)",
          "old_line_content": "\t\ttransaction_commit(transaction);",
          "new_line_content": "\t\ttransaction_add_node(transaction, node);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 518,
          "old_api": null,
          "new_api": "set_instruction_ready",
          "old_text": null,
          "new_text": "set_instruction_ready(instruction)",
          "old_line_content": "\t\t\t(int)instruction->container_state.content_x == (int)x &&",
          "new_line_content": "\t\tset_instruction_ready(instruction);",
          "content_same": false
        },
        {
          "line": 391,
          "old_api": null,
          "new_api": "transaction_progress_queue",
          "old_text": null,
          "new_text": "transaction_progress_queue()",
          "old_line_content": "\tif (node->destroying) {",
          "new_line_content": "\ttransaction_progress_queue();",
          "content_same": false
        },
        {
          "line": 397,
          "old_api": null,
          "new_api": "node_is_view",
          "old_text": null,
          "new_text": "node_is_view(node)",
          "old_line_content": "\t// Xwayland views are position-aware and need to be reconfigured",
          "new_line_content": "\tif (!node_is_view(node)) {",
          "content_same": false
        },
        {
          "line": 531,
          "old_api": null,
          "new_api": "set_instruction_ready",
          "old_text": null,
          "new_text": "set_instruction_ready(instruction)",
          "old_line_content": "\t}",
          "new_line_content": "\t\tset_instruction_ready(instruction);",
          "content_same": false
        },
        {
          "line": 539,
          "old_api": null,
          "new_api": "set_instruction_ready",
          "old_text": null,
          "new_text": "set_instruction_ready(instruction)",
          "old_line_content": "\tif (!transaction) {",
          "new_line_content": "\t\tset_instruction_ready(instruction);",
          "content_same": false
        },
        {
          "line": 547,
          "old_api": null,
          "new_api": "transaction_create",
          "old_text": null,
          "new_text": "transaction_create()",
          "old_line_content": "\tserver.dirty_nodes->length = 0;",
          "new_line_content": "\tstruct sway_transaction *transaction = transaction_create();",
          "content_same": false
        },
        {
          "line": 427,
          "old_api": null,
          "new_api": "sway_log",
          "old_text": null,
          "new_text": "sway_log(SWAY_DEBUG, \"Transaction %p committing with %i instructions\",\n\t\t\ttransaction, transaction->instructions->length)",
          "old_line_content": "\t\t\t\t\tinstruction->container_state.content_x,",
          "new_line_content": "\tsway_log(SWAY_DEBUG, \"Transaction %p committing with %i instructions\",",
          "content_same": false
        },
        {
          "line": 558,
          "old_api": null,
          "new_api": "list_add",
          "old_text": null,
          "new_text": "list_add(server.transactions, transaction)",
          "old_line_content": "}",
          "new_line_content": "\tlist_add(server.transactions, transaction);",
          "content_same": false
        },
        {
          "line": 562,
          "old_api": null,
          "new_api": "transaction_commit",
          "old_text": null,
          "new_text": "transaction_commit(transaction)",
          "old_line_content": "",
          "new_line_content": "\t\ttransaction_commit(transaction);",
          "content_same": false
        },
        {
          "line": 434,
          "old_api": null,
          "new_api": "should_configure",
          "old_text": null,
          "new_text": "should_configure(node, instruction)",
          "old_line_content": "\t\t\t// means we can send a frame done event to make the client redraw it",
          "new_line_content": "\t\tif (should_configure(node, instruction)) {",
          "content_same": false
        },
        {
          "line": 435,
          "old_api": null,
          "new_api": "view_configure",
          "old_text": null,
          "new_text": "view_configure(node->sway_container->view,\n\t\t\t\t\tinstruction->container_state.content_x,\n\t\t\t\t\tinstruction->container_state.content_y,\n\t\t\t\t\tinstruction->container_state.content_width,\n\t\t\t\t\tinstruction->container_state.content_height)",
          "old_line_content": "\t\t\t// as soon as possible. Additionally, this is required if a view is",
          "new_line_content": "\t\t\tinstruction->serial = view_configure(node->sway_container->view,",
          "content_same": false
        },
        {
          "line": 565,
          "old_api": null,
          "new_api": "transaction_progress_queue",
          "old_text": null,
          "new_text": "transaction_progress_queue()",
          "old_line_content": "",
          "new_line_content": "\t\ttransaction_progress_queue();",
          "content_same": false
        },
        {
          "line": 447,
          "old_api": null,
          "new_api": "clock_gettime",
          "old_text": null,
          "new_text": "clock_gettime(CLOCK_MONOTONIC, &now)",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\t\tclock_gettime(CLOCK_MONOTONIC, &now);",
          "content_same": false
        },
        {
          "line": 448,
          "old_api": null,
          "new_api": "wlr_surface_send_frame_done",
          "old_text": null,
          "new_text": "wlr_surface_send_frame_done(\n\t\t\t\t\tnode->sway_container->view->surface, &now)",
          "old_line_content": "\t\tnode->instruction = instruction;",
          "new_line_content": "\t\t\twlr_surface_send_frame_done(",
          "content_same": false
        },
        {
          "line": 451,
          "old_api": null,
          "new_api": "wl_list_empty",
          "old_text": null,
          "new_text": "wl_list_empty(&node->sway_container->view->saved_buffers)",
          "old_line_content": "\tif (debug.txn_timings) {",
          "new_line_content": "\t\tif (node_is_view(node) && wl_list_empty(&node->sway_container->view->saved_buffers)) {",
          "content_same": false
        },
        {
          "line": 453,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(&node->sway_container->view->saved_geometry,\n\t\t\t\t\t&node->sway_container->view->geometry,\n\t\t\t\t\tsizeof(struct wlr_box))",
          "old_line_content": "\t}",
          "new_line_content": "\t\t\tmemcpy(&node->sway_container->view->saved_geometry,",
          "content_same": false
        },
        {
          "line": 461,
          "old_api": null,
          "new_api": "clock_gettime",
          "old_text": null,
          "new_text": "clock_gettime(CLOCK_MONOTONIC, &transaction->commit_time)",
          "old_line_content": "",
          "new_line_content": "\t\tclock_gettime(CLOCK_MONOTONIC, &transaction->commit_time);",
          "content_same": false
        },
        {
          "line": 473,
          "old_api": null,
          "new_api": "wl_event_loop_add_timer",
          "old_text": null,
          "new_text": "wl_event_loop_add_timer(server.wl_event_loop,\n\t\t\t\thandle_timeout, transaction)",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\ttransaction->timer = wl_event_loop_add_timer(server.wl_event_loop,",
          "content_same": false
        },
        {
          "line": 476,
          "old_api": null,
          "new_api": "wl_event_source_timer_update",
          "old_text": null,
          "new_text": "wl_event_source_timer_update(transaction->timer,\n\t\t\t\t\tserver.txn_timeout_ms)",
          "old_line_content": "",
          "new_line_content": "\t\t\twl_event_source_timer_update(transaction->timer,",
          "content_same": false
        },
        {
          "line": 479,
          "old_api": null,
          "new_api": "sway_log_errno",
          "old_text": null,
          "new_text": "sway_log_errno(SWAY_ERROR, \"Unable to create transaction timer \"\n\t\t\t\t\t\"(some imperfect frames might be rendered)\")",
          "old_line_content": "\tstruct sway_transaction *transaction = instruction->transaction;",
          "new_line_content": "\t\t\tsway_log_errno(SWAY_ERROR, \"Unable to create transaction timer \"",
          "content_same": false
        },
        {
          "line": 492,
          "old_api": null,
          "new_api": "clock_gettime",
          "old_text": null,
          "new_text": "clock_gettime(CLOCK_MONOTONIC, &now)",
          "old_line_content": "\t}",
          "new_line_content": "\t\tclock_gettime(CLOCK_MONOTONIC, &now);",
          "content_same": false
        },
        {
          "line": 366,
          "old_api": null,
          "new_api": "transaction_same_nodes",
          "old_text": null,
          "new_text": "transaction_same_nodes(txn, maybe_dup)",
          "old_line_content": "\t\t} else {",
          "new_line_content": "\t\t\tif (transaction_same_nodes(txn, maybe_dup)) {",
          "content_same": false
        },
        {
          "line": 505,
          "old_api": null,
          "new_api": "sway_log",
          "old_text": null,
          "new_text": "sway_log(SWAY_DEBUG, \"Transaction %p is ready\", transaction)",
          "old_line_content": "\t\tuint32_t serial) {",
          "new_line_content": "\t\tsway_log(SWAY_DEBUG, \"Transaction %p is ready\", transaction);",
          "content_same": false
        },
        {
          "line": 506,
          "old_api": null,
          "new_api": "wl_event_source_timer_update",
          "old_text": null,
          "new_text": "wl_event_source_timer_update(transaction->timer, 0)",
          "old_line_content": "\tstruct sway_transaction_instruction *instruction =",
          "new_line_content": "\t\twl_event_source_timer_update(transaction->timer, 0);",
          "content_same": false
        },
        {
          "line": 510,
          "old_api": null,
          "new_api": "transaction_progress_queue",
          "old_text": null,
          "new_text": "transaction_progress_queue()",
          "old_line_content": "\t}",
          "new_line_content": "\ttransaction_progress_queue();",
          "content_same": false
        },
        {
          "line": 383,
          "old_api": null,
          "new_api": "transaction_progress_queue",
          "old_text": null,
          "new_text": "transaction_progress_queue()",
          "old_line_content": "\treturn 0;",
          "new_line_content": "\ttransaction_progress_queue();",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 522,
          "old_api": "set_instruction_ready",
          "new_api": null,
          "old_text": "set_instruction_ready(instruction)",
          "new_text": null,
          "old_line_content": "\t\tset_instruction_ready(instruction);",
          "new_line_content": "void transaction_notify_view_ready_by_geometry(struct sway_view *view,",
          "content_same": false
        },
        {
          "line": 530,
          "old_api": "set_instruction_ready",
          "new_api": null,
          "old_text": "set_instruction_ready(instruction)",
          "new_text": null,
          "old_line_content": "\t\tset_instruction_ready(instruction);",
          "new_line_content": "\t\t\tinstruction->container_state.content_height == height) {",
          "content_same": false
        },
        {
          "line": 538,
          "old_api": "transaction_create",
          "new_api": null,
          "old_text": "transaction_create()",
          "new_text": null,
          "old_line_content": "\tstruct sway_transaction *transaction = transaction_create();",
          "new_line_content": "\tif (instruction != NULL) {",
          "content_same": false
        },
        {
          "line": 544,
          "old_api": "transaction_add_node",
          "new_api": null,
          "old_text": "transaction_add_node(transaction, node)",
          "new_text": null,
          "old_line_content": "\t\ttransaction_add_node(transaction, node);",
          "new_line_content": "\tif (!server.dirty_nodes->length) {",
          "content_same": false
        },
        {
          "line": 418,
          "old_api": "sway_log",
          "new_api": null,
          "old_text": "sway_log(SWAY_DEBUG, \"Transaction %p committing with %i instructions\",\n\t\t\ttransaction, transaction->instructions->length)",
          "new_text": null,
          "old_line_content": "\tsway_log(SWAY_DEBUG, \"Transaction %p committing with %i instructions\",",
          "new_line_content": "#endif",
          "content_same": false
        },
        {
          "line": 549,
          "old_api": "list_add",
          "new_api": null,
          "old_text": "list_add(server.transactions, transaction)",
          "new_text": null,
          "old_line_content": "\tlist_add(server.transactions, transaction);",
          "new_line_content": "\t\treturn;",
          "content_same": false
        },
        {
          "line": 425,
          "old_api": "should_configure",
          "new_api": null,
          "old_text": "should_configure(node, instruction)",
          "new_text": null,
          "old_line_content": "\t\tif (should_configure(node, instruction)) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 426,
          "old_api": "view_configure",
          "new_api": null,
          "old_text": "view_configure(node->sway_container->view,\n\t\t\t\t\tinstruction->container_state.content_x,\n\t\t\t\t\tinstruction->container_state.content_y,\n\t\t\t\t\tinstruction->container_state.content_width,\n\t\t\t\t\tinstruction->container_state.content_height)",
          "new_text": null,
          "old_line_content": "\t\t\tinstruction->serial = view_configure(node->sway_container->view,",
          "new_line_content": "static void transaction_commit(struct sway_transaction *transaction) {",
          "content_same": false
        },
        {
          "line": 556,
          "old_api": "transaction_progress_queue",
          "new_api": null,
          "old_text": "transaction_progress_queue()",
          "new_text": null,
          "old_line_content": "\t\ttransaction_progress_queue();",
          "new_line_content": "\tserver.dirty_nodes->length = 0;",
          "content_same": false
        },
        {
          "line": 438,
          "old_api": "clock_gettime",
          "new_api": null,
          "old_text": "clock_gettime(CLOCK_MONOTONIC, &now)",
          "new_text": null,
          "old_line_content": "\t\t\tclock_gettime(CLOCK_MONOTONIC, &now);",
          "new_line_content": "\t\t\t\t\tinstruction->container_state.content_width,",
          "content_same": false
        },
        {
          "line": 439,
          "old_api": "wlr_surface_send_frame_done",
          "new_api": null,
          "old_text": "wlr_surface_send_frame_done(\n\t\t\t\t\tnode->sway_container->view->surface, &now)",
          "new_text": null,
          "old_line_content": "\t\t\twlr_surface_send_frame_done(",
          "new_line_content": "\t\t\t\t\tinstruction->container_state.content_height);",
          "content_same": false
        },
        {
          "line": 442,
          "old_api": "wl_list_empty",
          "new_api": null,
          "old_text": "wl_list_empty(&node->sway_container->view->saved_buffers)",
          "new_text": null,
          "old_line_content": "\t\tif (node_is_view(node) && wl_list_empty(&node->sway_container->view->saved_buffers)) {",
          "new_line_content": "\t\t\t// From here on we are rendering a saved buffer of the view, which",
          "content_same": false
        },
        {
          "line": 443,
          "old_api": "view_save_buffer",
          "new_api": null,
          "old_text": "view_save_buffer(node->sway_container->view)",
          "new_text": null,
          "old_line_content": "\t\t\tview_save_buffer(node->sway_container->view);",
          "new_line_content": "\t\t\t// means we can send a frame done event to make the client redraw it",
          "content_same": false
        },
        {
          "line": 444,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(&node->sway_container->view->saved_geometry,\n\t\t\t\t\t&node->sway_container->view->geometry,\n\t\t\t\t\tsizeof(struct wlr_box))",
          "new_text": null,
          "old_line_content": "\t\t\tmemcpy(&node->sway_container->view->saved_geometry,",
          "new_line_content": "\t\t\t// as soon as possible. Additionally, this is required if a view is",
          "content_same": false
        },
        {
          "line": 464,
          "old_api": "wl_event_loop_add_timer",
          "new_api": null,
          "old_text": "wl_event_loop_add_timer(server.wl_event_loop,\n\t\t\t\thandle_timeout, transaction)",
          "new_text": null,
          "old_line_content": "\t\ttransaction->timer = wl_event_loop_add_timer(server.wl_event_loop,",
          "new_line_content": "\t\ttransaction->num_waiting = 0;",
          "content_same": false
        },
        {
          "line": 467,
          "old_api": "wl_event_source_timer_update",
          "new_api": null,
          "old_text": "wl_event_source_timer_update(transaction->timer,\n\t\t\t\t\tserver.txn_timeout_ms)",
          "new_text": null,
          "old_line_content": "\t\t\twl_event_source_timer_update(transaction->timer,",
          "new_line_content": "\t\t// We do this by inflating the waiting counter.",
          "content_same": false
        },
        {
          "line": 470,
          "old_api": "sway_log_errno",
          "new_api": null,
          "old_text": "sway_log_errno(SWAY_ERROR, \"Unable to create transaction timer \"\n\t\t\t\t\t\"(some imperfect frames might be rendered)\")",
          "new_text": null,
          "old_line_content": "\t\t\tsway_log_errno(SWAY_ERROR, \"Unable to create transaction timer \"",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 483,
          "old_api": "clock_gettime",
          "new_api": null,
          "old_text": "clock_gettime(CLOCK_MONOTONIC, &now)",
          "new_text": null,
          "old_line_content": "\t\tclock_gettime(CLOCK_MONOTONIC, &now);",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 487,
          "old_api": "sway_log",
          "new_api": null,
          "old_text": "sway_log(SWAY_DEBUG, \"Transaction %p: %zi/%zi ready in %.1fms (%s)\",\n\t\t\t\ttransaction,\n\t\t\t\ttransaction->num_configures - transaction->num_waiting + 1,\n\t\t\t\ttransaction->num_configures, ms,\n\t\t\t\tinstruction->node->sway_container->title)",
          "new_text": null,
          "old_line_content": "\t\tsway_log(SWAY_DEBUG, \"Transaction %p: %zi/%zi ready in %.1fms (%s)\",",
          "new_line_content": "\t\tstruct sway_transaction_instruction *instruction) {",
          "content_same": false
        },
        {
          "line": 363,
          "old_api": "transaction_same_nodes",
          "new_api": null,
          "old_text": "transaction_same_nodes(a, b)",
          "new_text": null,
          "old_line_content": "\t\tif (transaction_same_nodes(a, b)) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 364,
          "old_api": "list_del",
          "new_api": null,
          "old_text": "list_del(server.transactions, 0)",
          "new_text": null,
          "old_line_content": "\t\t\tlist_del(server.transactions, 0);",
          "new_line_content": "\t\tfor (int i = 1; i < server.transactions->length; i++) {",
          "content_same": false
        },
        {
          "line": 365,
          "old_api": "transaction_destroy",
          "new_api": null,
          "old_text": "transaction_destroy(a)",
          "new_text": null,
          "old_line_content": "\t\t\ttransaction_destroy(a);",
          "new_line_content": "\t\t\tstruct sway_transaction *maybe_dup = server.transactions->items[i];",
          "content_same": false
        },
        {
          "line": 497,
          "old_api": "wl_event_source_timer_update",
          "new_api": null,
          "old_text": "wl_event_source_timer_update(transaction->timer, 0)",
          "new_text": null,
          "old_line_content": "\t\twl_event_source_timer_update(transaction->timer, 0);",
          "new_line_content": "\t\t\t\ttransaction,",
          "content_same": false
        },
        {
          "line": 501,
          "old_api": "transaction_progress_queue",
          "new_api": null,
          "old_text": "transaction_progress_queue()",
          "new_text": null,
          "old_line_content": "\ttransaction_progress_queue();",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 379,
          "old_api": "sway_log",
          "new_api": null,
          "old_text": "sway_log(SWAY_DEBUG, \"Transaction %p timed out (%zi waiting)\",\n\t\t\ttransaction, transaction->num_waiting)",
          "new_text": null,
          "old_line_content": "\tsway_log(SWAY_DEBUG, \"Transaction %p timed out (%zi waiting)\",",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 509,
          "old_api": "set_instruction_ready",
          "new_api": null,
          "old_text": "set_instruction_ready(instruction)",
          "new_text": null,
          "old_line_content": "\t\tset_instruction_ready(instruction);",
          "new_line_content": "\tinstruction->node->instruction = NULL;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 6,
      "total_additions": 26,
      "total_deletions": 26,
      "total_api_changes": 58
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 13,
        "api_related_lines": 58,
        "non_api_lines": 8,
        "non_api_line_numbers": [
          361,
          362,
          367,
          368,
          369,
          370,
          371,
          372
        ]
      }
    },
    "api_calls_before": 97,
    "api_calls_after": 97,
    "diff_info": {
      "added_lines": 13,
      "removed_lines": 4,
      "total_diff_lines": 30
    }
  }
}