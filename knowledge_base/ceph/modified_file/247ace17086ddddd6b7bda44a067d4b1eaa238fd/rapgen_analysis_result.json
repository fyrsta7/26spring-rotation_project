{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ceph/modified_file/247ace17086ddddd6b7bda44a067d4b1eaa238fd",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ceph/modified_file/247ace17086ddddd6b7bda44a067d4b1eaa238fd/before.cc",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ceph/modified_file/247ace17086ddddd6b7bda44a067d4b1eaa238fd/after.cc",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ceph/modified_file/247ace17086ddddd6b7bda44a067d4b1eaa238fd/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 97,
          "old_api": "to_str",
          "new_api": "PyErr_Print",
          "old_text": "outbl.to_str().c_str()",
          "new_text": "PyErr_Print()",
          "old_line_content": "      auto pyOutBl = PyUnicode_FromString(outbl.to_str().c_str());",
          "new_line_content": "        PyErr_Print();",
          "content_same": false
        },
        {
          "line": 99,
          "old_api": "PyTuple_Pack",
          "new_api": "Py_DECREF",
          "old_text": "PyTuple_Pack(3, pyR, pyOutBl, pyOutS)",
          "new_text": "Py_DECREF(rtn)",
          "old_line_content": "      auto args = PyTuple_Pack(3, pyR, pyOutBl, pyOutS);",
          "new_line_content": "        Py_DECREF(rtn);",
          "content_same": false
        },
        {
          "line": 135,
          "old_api": "PyArg_ParseTuple",
          "new_api": "PyObject_GetAttrString",
          "old_text": "PyArg_ParseTuple(args, \"Ossssz#:ceph_send_command\",\n        &completion, &type, &name, &cmd_json, &tag, &inbuf_ptr, &inbuf_len)",
          "new_text": "PyObject_GetAttrString(completion, \"complete\")",
          "old_line_content": "  if (!PyArg_ParseTuple(args, \"Ossssz#:ceph_send_command\",",
          "new_line_content": "  auto set_fn = PyObject_GetAttrString(completion, \"complete\");",
          "content_same": false
        },
        {
          "line": 141,
          "old_api": "append",
          "new_api": "Py_DECREF",
          "old_text": "inbuf.append(inbuf_ptr, (unsigned)inbuf_len)",
          "new_text": "Py_DECREF(set_fn)",
          "old_line_content": "    inbuf.append(inbuf_ptr, (unsigned)inbuf_len);",
          "new_line_content": "  Py_DECREF(set_fn);",
          "content_same": false
        },
        {
          "line": 144,
          "old_api": "PyObject_GetAttrString",
          "new_api": "PyThreadState_Get",
          "old_text": "PyObject_GetAttrString(completion, \"complete\")",
          "new_text": "PyThreadState_Get()",
          "old_line_content": "  auto set_fn = PyObject_GetAttrString(completion, \"complete\");",
          "new_line_content": "      completion, tag, PyThreadState_Get());",
          "content_same": false
        },
        {
          "line": 146,
          "old_api": "ceph_abort",
          "new_api": "PyEval_SaveThread",
          "old_text": "ceph_abort()",
          "new_text": "PyEval_SaveThread()",
          "old_line_content": "    ceph_abort();  // TODO raise python exception instead",
          "new_line_content": "  PyThreadState *tstate = PyEval_SaveThread();",
          "content_same": false
        },
        {
          "line": 148,
          "old_api": "PyCallable_Check",
          "new_api": "std::string(type)",
          "old_text": "PyCallable_Check(set_fn)",
          "new_text": "std::string(type)",
          "old_line_content": "    ceph_assert(PyCallable_Check(set_fn));",
          "new_line_content": "  if (std::string(type) == \"mon\") {",
          "content_same": false
        },
        {
          "line": 173,
          "old_api": "start_mon_command",
          "new_api": "strict_strtoll",
          "old_text": "self->py_modules->get_monc().start_mon_command(\n        name,\n        {cmd_json},\n        inbuf,\n        &command_c->outbl,\n        &command_c->outs,\n        new C_OnFinisher(c, &self->py_modules->cmd_finisher))",
          "new_text": "strict_strtoll(name, 10, &err)",
          "old_line_content": "    self->py_modules->get_monc().start_mon_command(",
          "new_line_content": "    uint64_t osd_id = strict_strtoll(name, 10, &err);",
          "content_same": false
        },
        {
          "line": 193,
          "old_api": "osd_command",
          "new_api": "queue",
          "old_text": "self->py_modules->get_objecter().osd_command(\n        osd_id,\n        {cmd_json},\n        inbuf,\n        &tid,\n\t[command_c, f = &self->py_modules->cmd_finisher]\n\t(boost::system::error_code ec, std::string s, ceph::buffer::list bl) {\n\t  command_c->outs = std::move(s);\n\t  command_c->outbl = std::move(bl);\n\t  f->queue(command_c);\n\t})",
          "new_text": "f->queue(command_c)",
          "old_line_content": "    self->py_modules->get_objecter().osd_command(",
          "new_line_content": "\t  f->queue(command_c);",
          "content_same": false
        },
        {
          "line": 205,
          "old_api": "mds_command",
          "new_api": "cpp_strerror",
          "old_text": "self->py_modules->get_client().mds_command(\n        name,\n        {cmd_json},\n        inbuf,\n        &command_c->outbl,\n        &command_c->outs,\n        new C_OnFinisher(command_c, &self->py_modules->cmd_finisher))",
          "new_text": "cpp_strerror(r)",
          "old_line_content": "    int r = self->py_modules->get_client().mds_command(",
          "new_line_content": "      msg.append(cpp_strerror(r));",
          "content_same": false
        },
        {
          "line": 215,
          "old_api": "PyEval_RestoreThread",
          "new_api": "append",
          "old_text": "PyEval_RestoreThread(tstate)",
          "new_text": "msg.append(\"\\\"\").append(name).append(\"\\\"\")",
          "old_line_content": "      PyEval_RestoreThread(tstate);",
          "new_line_content": "      msg.append(\"\\\"\").append(name).append(\"\\\"\");",
          "content_same": false
        },
        {
          "line": 216,
          "old_api": "c_str",
          "new_api": "PyEval_RestoreThread",
          "old_text": "msg.c_str()",
          "new_text": "PyEval_RestoreThread(tstate)",
          "old_line_content": "      PyErr_SetString(PyExc_RuntimeError, msg.c_str());",
          "new_line_content": "      PyEval_RestoreThread(tstate);",
          "content_same": false
        },
        {
          "line": 231,
          "old_api": "pg_command",
          "new_api": "queue",
          "old_text": "self->py_modules->get_objecter().pg_command(\n        pgid,\n        {cmd_json},\n        inbuf,\n        &tid,\n\t[command_c, f = &self->py_modules->cmd_finisher]\n\t(boost::system::error_code ec, std::string s, ceph::buffer::list bl) {\n\t  command_c->outs = std::move(s);\n\t  command_c->outbl = std::move(bl);\n\t  f->queue(command_c);\n\t})",
          "new_text": "f->queue(command_c)",
          "old_line_content": "    self->py_modules->get_objecter().pg_command(",
          "new_line_content": "\t  f->queue(command_c);",
          "content_same": false
        },
        {
          "line": 238,
          "old_api": "std::move(s)",
          "new_api": "append",
          "old_text": "std::move(s)",
          "new_text": "msg.append(type)",
          "old_line_content": "\t  command_c->outs = std::move(s);",
          "new_line_content": "    msg.append(type);",
          "content_same": false
        },
        {
          "line": 239,
          "old_api": "std::move(bl)",
          "new_api": "PyEval_RestoreThread",
          "old_text": "std::move(bl)",
          "new_text": "PyEval_RestoreThread(tstate)",
          "old_line_content": "\t  command_c->outbl = std::move(bl);",
          "new_line_content": "    PyEval_RestoreThread(tstate);",
          "content_same": false
        },
        {
          "line": 240,
          "old_api": "queue",
          "new_api": "c_str",
          "old_text": "f->queue(command_c)",
          "new_text": "msg.c_str()",
          "old_line_content": "\t  f->queue(command_c);",
          "new_line_content": "    PyErr_SetString(PyExc_ValueError, msg.c_str());",
          "content_same": false
        },
        {
          "line": 261,
          "old_api": "PyArg_ParseTuple",
          "new_api": "PyList_Size",
          "old_text": "PyArg_ParseTuple(args, \"O:ceph_set_health_checks\", &checks)",
          "new_text": "PyList_Size(checksls)",
          "old_line_content": "  if (!PyArg_ParseTuple(args, \"O:ceph_set_health_checks\", &checks)) {",
          "new_line_content": "  for (int i = 0; i < PyList_Size(checksls); ++i) {",
          "content_same": false
        },
        {
          "line": 270,
          "old_api": "PyList_Size",
          "new_api": "PyDict_Check",
          "old_text": "PyList_Size(checksls)",
          "new_text": "PyDict_Check(check_info)",
          "old_line_content": "  for (int i = 0; i < PyList_Size(checksls); ++i) {",
          "new_line_content": "    if (!PyDict_Check(check_info)) {",
          "content_same": false
        },
        {
          "line": 279,
          "old_api": "PyDict_Check",
          "new_api": "PyDict_Items",
          "old_text": "PyDict_Check(check_info)",
          "new_text": "PyDict_Items(check_info)",
          "old_line_content": "    if (!PyDict_Check(check_info)) {",
          "new_line_content": "    PyObject *infols = PyDict_Items(check_info);",
          "content_same": false
        },
        {
          "line": 289,
          "old_api": "PyList_Size",
          "new_api": "PyArg_ParseTuple",
          "old_text": "PyList_Size(infols)",
          "new_text": "PyArg_ParseTuple(pair, \"sO:pair\", &k, &v)",
          "old_line_content": "    for (int j = 0; j < PyList_Size(infols); ++j) {",
          "new_line_content": "      if (!PyArg_ParseTuple(pair, \"sO:pair\", &k, &v)) {",
          "content_same": false
        },
        {
          "line": 316,
          "old_api": "PyUnicode_Check",
          "new_api": "PyLong_AsLong",
          "old_text": "PyUnicode_Check(v)",
          "new_text": "PyLong_AsLong(v)",
          "old_line_content": "\tif (!PyUnicode_Check(v)) {",
          "new_line_content": "\t  count = PyLong_AsLong(v);",
          "content_same": false
        },
        {
          "line": 344,
          "old_api": "PyUnicode_AsUTF8",
          "new_api": "swap",
          "old_text": "PyUnicode_AsUTF8(di)",
          "new_text": "d.detail.swap(detail)",
          "old_line_content": "\t    detail.push_back(PyUnicode_AsUTF8(di));",
          "new_line_content": "    d.detail.swap(detail);",
          "content_same": false
        },
        {
          "line": 353,
          "old_api": "swap",
          "new_api": "set_health_checks",
          "old_text": "d.detail.swap(detail)",
          "new_text": "without_gil([&] {\n    self->py_modules->set_health_checks(self->this_module->get_name(),\n\t\t\t\t\tstd::move(out_checks));\n  })",
          "old_line_content": "    d.detail.swap(detail);",
          "new_line_content": "  without_gil([&] {",
          "content_same": false
        },
        {
          "line": 391,
          "old_api": "get_server_python",
          "new_api": "get_id",
          "old_text": "self->py_modules->get_server_python(hostname)",
          "new_text": "g_conf()->name.get_id().c_str()",
          "old_line_content": "    return self->py_modules->get_server_python(hostname);",
          "new_line_content": "  return PyUnicode_FromString(g_conf()->name.get_id().c_str());",
          "content_same": false
        },
        {
          "line": 417,
          "old_api": "PyErr_NoMemory",
          "new_api": "dout",
          "old_text": "PyErr_NoMemory()",
          "new_text": "dout(10)",
          "old_line_content": "      PyErr_NoMemory();",
          "new_line_content": "    dout(10) << \"ceph_option_get \" << what << \" found: \" << value << dendl;",
          "content_same": false
        },
        {
          "line": 420,
          "old_api": "PyErr_SetString",
          "new_api": "dout",
          "old_text": "PyErr_SetString(PyExc_ValueError, \"value too long\")",
          "new_text": "dout(4)",
          "old_line_content": "      PyErr_SetString(PyExc_ValueError, \"value too long\");",
          "new_line_content": "    dout(4) << \"ceph_option_get \" << what << \" not found \" << dendl;",
          "content_same": false
        },
        {
          "line": 444,
          "old_api": "get_foreign_config",
          "new_api": "PyArg_ParseTuple",
          "old_text": "self->py_modules->get_foreign_config(who, what)",
          "new_text": "PyArg_ParseTuple(args, \"ss|s:ceph_get_module_option\", &module, &key,\n\t\t\t&prefix)",
          "old_line_content": "  return self->py_modules->get_foreign_config(who, what);",
          "new_line_content": "  if (!PyArg_ParseTuple(args, \"ss|s:ceph_get_module_option\", &module, &key,",
          "content_same": false
        },
        {
          "line": 453,
          "old_api": "PyArg_ParseTuple",
          "new_api": "assert",
          "old_text": "PyArg_ParseTuple(args, \"ss|s:ceph_get_module_option\", &module, &key,\n\t\t\t&prefix)",
          "new_text": "assert(self->this_module->py_module)",
          "old_line_content": "  if (!PyArg_ParseTuple(args, \"ss|s:ceph_get_module_option\", &module, &key,",
          "new_line_content": "  assert(self->this_module->py_module);",
          "content_same": false
        },
        {
          "line": 462,
          "old_api": "assert",
          "new_api": "PyArg_ParseTuple",
          "old_text": "assert(self->this_module->py_module)",
          "new_text": "PyArg_ParseTuple(args, \"s:ceph_store_get_prefix\", &prefix)",
          "old_line_content": "  assert(self->this_module->py_module);",
          "new_line_content": "  if (!PyArg_ParseTuple(args, \"s:ceph_store_get_prefix\", &prefix)) {",
          "content_same": false
        },
        {
          "line": 486,
          "old_api": "PyArg_ParseTuple",
          "new_api": "set_config",
          "old_text": "PyArg_ParseTuple(args, \"ssz:ceph_set_module_option\",\n        &module, &key, &value)",
          "new_text": "without_gil([&] {\n    return self->py_modules->set_config(module, key, val);\n  })",
          "old_line_content": "  if (!PyArg_ParseTuple(args, \"ssz:ceph_set_module_option\",",
          "new_line_content": "  auto [ret, msg] = without_gil([&] {",
          "content_same": false
        },
        {
          "line": 509,
          "old_api": "PyArg_ParseTuple",
          "new_api": "c_str",
          "old_text": "PyArg_ParseTuple(args, \"s:ceph_store_get\", &what)",
          "new_text": "value.c_str()",
          "old_line_content": "  if (!PyArg_ParseTuple(args, \"s:ceph_store_get\", &what)) {",
          "new_line_content": "    dout(10) << \"ceph_store_get \" << what << \" found: \" << value.c_str() << dendl;",
          "content_same": false
        },
        {
          "line": 592,
          "old_api": "cluster_log",
          "new_api": "c_str",
          "old_text": "without_gil([&] {\n    self->py_modules->cluster_log(channel, (clog_type)prio, message);\n  })",
          "new_text": "pretty_version_to_str().c_str()",
          "old_line_content": "  without_gil([&] {",
          "new_line_content": "  return PyUnicode_FromString(pretty_version_to_str().c_str());",
          "content_same": false
        },
        {
          "line": 620,
          "old_api": "PyArg_ParseTuple",
          "new_api": "get_context",
          "old_text": "PyArg_ParseTuple(args, \"i:ceph_lookup_release_name\", &major)",
          "new_text": "self->py_modules->get_context()",
          "old_line_content": "  if (!PyArg_ParseTuple(args, \"i:ceph_lookup_release_name\", &major)) {",
          "new_line_content": "  return self->py_modules->get_context();",
          "content_same": false
        },
        {
          "line": 629,
          "old_api": "get_context",
          "new_api": "PyArg_ParseTuple",
          "old_text": "self->py_modules->get_context()",
          "new_text": "PyArg_ParseTuple(args, \"sss:get_counter\", &svc_name,\n                                                  &svc_id, &counter_path)",
          "old_line_content": "  return self->py_modules->get_context();",
          "new_line_content": "  if (!PyArg_ParseTuple(args, \"sss:get_counter\", &svc_name,",
          "content_same": false
        },
        {
          "line": 656,
          "old_api": "get_latest_counter_python",
          "new_api": "PyArg_ParseTuple",
          "old_text": "self->py_modules->get_latest_counter_python(\n      svc_name, svc_id, counter_path)",
          "new_text": "PyArg_ParseTuple(args, \"ss:get_perf_schema\", &type_str,\n                                                    &svc_id)",
          "old_line_content": "  return self->py_modules->get_latest_counter_python(",
          "new_line_content": "  if (!PyArg_ParseTuple(args, \"ss:get_perf_schema\", &type_str,",
          "content_same": false
        },
        {
          "line": 712,
          "old_api": "set_device_wear_level",
          "new_api": "is_connected",
          "old_text": "without_gil([&] {\n    self->py_modules->set_device_wear_level(devid, wear_level);\n  })",
          "new_text": "self->py_modules->get_monc().is_connected()",
          "old_line_content": "  without_gil([&] {",
          "new_line_content": "  if (self->py_modules->get_monc().is_connected()) {",
          "content_same": false
        },
        {
          "line": 740,
          "old_api": "update_progress_event",
          "new_api": "PyArg_ParseTuple",
          "old_text": "self->py_modules->update_progress_event(evid, desc, progress, add_to_ceph_s)",
          "new_text": "PyArg_ParseTuple(args, \"s:ceph_complete_progress_event\",\n\t\t\t&evid)",
          "old_line_content": "    self->py_modules->update_progress_event(evid, desc, progress, add_to_ceph_s);",
          "new_line_content": "  if (!PyArg_ParseTuple(args, \"s:ceph_complete_progress_event\",",
          "content_same": false
        },
        {
          "line": 753,
          "old_api": "complete_progress_event",
          "new_api": "clear_all_progress_events",
          "old_text": "without_gil([&] {\n    self->py_modules->complete_progress_event(evid);\n  })",
          "new_text": "without_gil([&] {\n    self->py_modules->clear_all_progress_events();\n  })",
          "old_line_content": null,
          "new_line_content": "  without_gil([&] {",
          "content_same": true
        },
        {
          "line": 754,
          "old_api": "complete_progress_event",
          "new_api": "clear_all_progress_events",
          "old_text": "self->py_modules->complete_progress_event(evid)",
          "new_text": "self->py_modules->clear_all_progress_events()",
          "old_line_content": "    self->py_modules->complete_progress_event(evid);",
          "new_line_content": "    self->py_modules->clear_all_progress_events();",
          "content_same": false
        },
        {
          "line": 787,
          "old_api": "PyErr_SetString",
          "new_api": "PyEval_RestoreThread",
          "old_text": "PyErr_SetString(PyExc_ImportError, \"Module not found\")",
          "new_text": "PyEval_RestoreThread(tstate)",
          "old_line_content": "    PyErr_SetString(PyExc_ImportError, \"Module not found\");",
          "new_line_content": "    PyEval_RestoreThread(tstate);",
          "content_same": false
        },
        {
          "line": 793,
          "old_api": "PyEval_SaveThread",
          "new_api": "dispatch_remote",
          "old_text": "PyEval_SaveThread()",
          "new_text": "self->py_modules->dispatch_remote(other_module, method,\n      remote_args, remote_kwargs, &err)",
          "old_line_content": "  PyThreadState *tstate = PyEval_SaveThread();",
          "new_line_content": "  auto result = self->py_modules->dispatch_remote(other_module, method,",
          "content_same": false
        },
        {
          "line": 802,
          "old_api": "dispatch_remote",
          "new_api": "str",
          "old_text": "self->py_modules->dispatch_remote(other_module, method,\n      remote_args, remote_kwargs, &err)",
          "new_text": "ss.str()",
          "old_line_content": "  auto result = self->py_modules->dispatch_remote(other_module, method,",
          "new_line_content": "    derr << ss.str() << dendl;",
          "content_same": false
        },
        {
          "line": 851,
          "old_api": "PyArg_ParseTuple",
          "new_api": "PyDict_Items",
          "old_text": "PyArg_ParseTuple(args, \"O:ceph_add_osd_perf_query\", &py_query)",
          "new_text": "PyDict_Items(py_query)",
          "old_line_content": "  if (!PyArg_ParseTuple(args, \"O:ceph_add_osd_perf_query\", &py_query)) {",
          "new_line_content": "  PyObject *query_params = PyDict_Items(py_query);",
          "content_same": false
        },
        {
          "line": 875,
          "old_api": "PyList_Size",
          "new_api": "PyList_Check",
          "old_text": "PyList_Size(query_params)",
          "new_text": "PyList_Check(query_param_val)",
          "old_line_content": "  for (int i = 0; i < PyList_Size(query_params); ++i) {",
          "new_line_content": "      if (!PyList_Check(query_param_val)) {",
          "content_same": false
        },
        {
          "line": 879,
          "old_api": "PyArg_ParseTuple",
          "new_api": "PyList_Size",
          "old_text": "PyArg_ParseTuple(kv, \"sO:pair\", &query_param_name, &query_param_val)",
          "new_text": "PyList_Size(query_param_val)",
          "old_line_content": "    if (!PyArg_ParseTuple(kv, \"sO:pair\", &query_param_name, &query_param_val)) {",
          "new_line_content": "      for (int j = 0; j < PyList_Size(query_param_val); j++) {",
          "content_same": false
        },
        {
          "line": 890,
          "old_api": "PyDict_Check",
          "new_api": "PyTuple_Check",
          "old_text": "PyDict_Check(sub_key)",
          "new_text": "PyTuple_Check(pair)",
          "old_line_content": "        if (!PyDict_Check(sub_key)) {",
          "new_line_content": "          if (!PyTuple_Check(pair)) {",
          "content_same": false
        },
        {
          "line": 897,
          "old_api": "PyList_Size",
          "new_api": "PyArg_ParseTuple",
          "old_text": "PyList_Size(sub_key_params)",
          "new_text": "PyArg_ParseTuple(pair, \"sO:pair\", &param_name, &param_value)",
          "old_line_content": "        for (int k = 0; k < PyList_Size(sub_key_params); ++k) {",
          "new_line_content": "          if (!PyArg_ParseTuple(pair, \"sO:pair\", &param_name, &param_value)) {",
          "content_same": false
        },
        {
          "line": 917,
          "old_api": "PyUnicode_AsUTF8",
          "new_api": "PyUnicode_Check",
          "old_text": "PyUnicode_AsUTF8(param_value)",
          "new_text": "PyUnicode_Check(param_value)",
          "old_line_content": "            auto type = PyUnicode_AsUTF8(param_value);",
          "new_line_content": "            if (!PyUnicode_Check(param_value)) {",
          "content_same": false
        },
        {
          "line": 951,
          "old_api": "static_cast<OSDPerfMetricSubKeyType>(-1)",
          "new_api": "PyList_Check",
          "old_text": "static_cast<OSDPerfMetricSubKeyType>(-1)",
          "new_text": "PyList_Check(query_param_val)",
          "old_line_content": "        if (d.type == static_cast<OSDPerfMetricSubKeyType>(-1) ||",
          "new_line_content": "      if (!PyList_Check(query_param_val)) {",
          "content_same": false
        },
        {
          "line": 957,
          "old_api": "push_back",
          "new_api": "PyUnicode_Check",
          "old_text": "query.key_descriptor.push_back(d)",
          "new_text": "PyUnicode_Check(py_type)",
          "old_line_content": "        query.key_descriptor.push_back(d);",
          "new_line_content": "        if (!PyUnicode_Check(py_type)) {",
          "content_same": false
        },
        {
          "line": 964,
          "old_api": "PyList_Size",
          "new_api": "end",
          "old_text": "PyList_Size(query_param_val)",
          "new_text": "counter_types.end()",
          "old_line_content": "      for (int j = 0; j < PyList_Size(query_param_val); j++) {",
          "new_line_content": "        if (it == counter_types.end()) {",
          "content_same": false
        },
        {
          "line": 972,
          "old_api": "find",
          "new_api": "PyDict_Check",
          "old_text": "counter_types.find(type)",
          "new_text": "PyDict_Check(query_param_val)",
          "old_line_content": "        auto it = counter_types.find(type);",
          "new_line_content": "      if (!PyDict_Check(query_param_val)) {",
          "content_same": false
        },
        {
          "line": 978,
          "old_api": "push_back",
          "new_api": "OSDPerfMetricLimit",
          "old_text": "query.performance_counter_descriptors.push_back(it->second)",
          "new_text": "OSDPerfMetricLimit()",
          "old_line_content": "        query.performance_counter_descriptors.push_back(it->second);",
          "new_line_content": "      limit = OSDPerfMetricLimit();",
          "content_same": false
        },
        {
          "line": 981,
          "old_api": "PyDict_Check",
          "new_api": "PyList_Size",
          "old_text": "PyDict_Check(query_param_val)",
          "new_text": "PyList_Size(limit_params)",
          "old_line_content": "      if (!PyDict_Check(query_param_val)) {",
          "new_line_content": "      for (int j = 0; j < PyList_Size(limit_params); ++j) {",
          "content_same": false
        },
        {
          "line": 1007,
          "old_api": "PyUnicode_AsUTF8",
          "new_api": "PyLong_Check",
          "old_text": "PyUnicode_AsUTF8(limit_param_val)",
          "new_text": "PyLong_Check(limit_param_val)",
          "old_line_content": "          auto order_by = PyUnicode_AsUTF8(limit_param_val);",
          "new_line_content": "          if (!PyLong_Check(limit_param_val)) {",
          "content_same": false
        },
        {
          "line": 1116,
          "old_api": "PyArg_ParseTuple",
          "new_api": "PyDict_Items",
          "old_text": "PyArg_ParseTuple(args, \"O:ceph_add_mds_perf_query\", &py_query)",
          "new_text": "PyDict_Items(py_query)",
          "old_line_content": "  if (!PyArg_ParseTuple(args, \"O:ceph_add_mds_perf_query\", &py_query)) {",
          "new_line_content": "  PyObject *query_params = PyDict_Items(py_query);",
          "content_same": false
        },
        {
          "line": 1140,
          "old_api": "PyList_Size",
          "new_api": "PyList_Check",
          "old_text": "PyList_Size(query_params)",
          "new_text": "PyList_Check(query_param_val)",
          "old_line_content": "  for (int i = 0; i < PyList_Size(query_params); ++i) {",
          "new_line_content": "      if (!PyList_Check(query_param_val)) {",
          "content_same": false
        },
        {
          "line": 1144,
          "old_api": "PyArg_ParseTuple",
          "new_api": "PyList_Size",
          "old_text": "PyArg_ParseTuple(kv, \"sO:pair\", &query_param_name, &query_param_val)",
          "new_text": "PyList_Size(query_param_val)",
          "old_line_content": "    if (!PyArg_ParseTuple(kv, \"sO:pair\", &query_param_name, &query_param_val)) {",
          "new_line_content": "      for (int j = 0; j < PyList_Size(query_param_val); j++) {",
          "content_same": false
        },
        {
          "line": 1155,
          "old_api": "PyDict_Check",
          "new_api": "PyTuple_Check",
          "old_text": "PyDict_Check(sub_key)",
          "new_text": "PyTuple_Check(pair)",
          "old_line_content": "        if (!PyDict_Check(sub_key)) {",
          "new_line_content": "          if (!PyTuple_Check(pair)) {",
          "content_same": false
        },
        {
          "line": 1162,
          "old_api": "PyList_Size",
          "new_api": "PyArg_ParseTuple",
          "old_text": "PyList_Size(sub_key_params)",
          "new_text": "PyArg_ParseTuple(pair, \"sO:pair\", &param_name, &param_value)",
          "old_line_content": "        for (int k = 0; k < PyList_Size(sub_key_params); ++k) {",
          "new_line_content": "          if (!PyArg_ParseTuple(pair, \"sO:pair\", &param_name, &param_value)) {",
          "content_same": false
        },
        {
          "line": 1182,
          "old_api": "PyUnicode_AsUTF8",
          "new_api": "PyUnicode_Check",
          "old_text": "PyUnicode_AsUTF8(param_value)",
          "new_text": "PyUnicode_Check(param_value)",
          "old_line_content": "            auto type = PyUnicode_AsUTF8(param_value);",
          "new_line_content": "            if (!PyUnicode_Check(param_value)) {",
          "content_same": false
        },
        {
          "line": 1216,
          "old_api": "static_cast<MDSPerfMetricSubKeyType>(-1)",
          "new_api": "PyList_Check",
          "old_text": "static_cast<MDSPerfMetricSubKeyType>(-1)",
          "new_text": "PyList_Check(query_param_val)",
          "old_line_content": "        if (d.type == static_cast<MDSPerfMetricSubKeyType>(-1) ||",
          "new_line_content": "      if (!PyList_Check(query_param_val)) {",
          "content_same": false
        },
        {
          "line": 1222,
          "old_api": "push_back",
          "new_api": "PyUnicode_Check",
          "old_text": "query.key_descriptor.push_back(d)",
          "new_text": "PyUnicode_Check(py_type)",
          "old_line_content": "        query.key_descriptor.push_back(d);",
          "new_line_content": "        if (!PyUnicode_Check(py_type)) {",
          "content_same": false
        },
        {
          "line": 1229,
          "old_api": "PyList_Size",
          "new_api": "end",
          "old_text": "PyList_Size(query_param_val)",
          "new_text": "counter_types.end()",
          "old_line_content": "      for (int j = 0; j < PyList_Size(query_param_val); j++) {",
          "new_line_content": "        if (it == counter_types.end()) {",
          "content_same": false
        },
        {
          "line": 1237,
          "old_api": "find",
          "new_api": "PyDict_Check",
          "old_text": "counter_types.find(type)",
          "new_text": "PyDict_Check(query_param_val)",
          "old_line_content": "        auto it = counter_types.find(type);",
          "new_line_content": "      if (!PyDict_Check(query_param_val)) {",
          "content_same": false
        },
        {
          "line": 1243,
          "old_api": "push_back",
          "new_api": "MDSPerfMetricLimit",
          "old_text": "query.performance_counter_descriptors.push_back(it->second)",
          "new_text": "MDSPerfMetricLimit()",
          "old_line_content": "        query.performance_counter_descriptors.push_back(it->second);",
          "new_line_content": "      limit = MDSPerfMetricLimit();",
          "content_same": false
        },
        {
          "line": 1246,
          "old_api": "PyDict_Check",
          "new_api": "PyList_Size",
          "old_text": "PyDict_Check(query_param_val)",
          "new_text": "PyList_Size(limit_params)",
          "old_line_content": "      if (!PyDict_Check(query_param_val)) {",
          "new_line_content": "      for (int j = 0; j < PyList_Size(limit_params); ++j) {",
          "content_same": false
        },
        {
          "line": 1272,
          "old_api": "PyUnicode_AsUTF8",
          "new_api": "PyLong_Check",
          "old_text": "PyUnicode_AsUTF8(limit_param_val)",
          "new_text": "PyLong_Check(limit_param_val)",
          "old_line_content": "          auto order_by = PyUnicode_AsUTF8(limit_param_val);",
          "new_line_content": "          if (!PyLong_Check(limit_param_val)) {",
          "content_same": false
        },
        {
          "line": 1357,
          "old_api": "PyDict_Check",
          "new_api": "PyList_GET_ITEM",
          "old_text": "PyDict_Check(args_dict)",
          "new_text": "PyList_GET_ITEM(args_list, i)",
          "old_line_content": "  if (!PyDict_Check(args_dict)) {",
          "new_line_content": "    PyObject *kv = PyList_GET_ITEM(args_list, i);",
          "content_same": false
        },
        {
          "line": 1370,
          "old_api": "PyArg_ParseTuple",
          "new_api": "is_authorized",
          "old_text": "PyArg_ParseTuple(kv, \"ss:pair\", &arg_key, &arg_value)",
          "new_text": "self->this_module->is_authorized(arguments)",
          "old_line_content": "    if (!PyArg_ParseTuple(kv, \"ss:pair\", &arg_key, &arg_value)) {",
          "new_line_content": "    return self->this_module->is_authorized(arguments);",
          "content_same": false
        },
        {
          "line": 1413,
          "old_api": "unregister_client",
          "new_api": "get_daemon_health_metrics",
          "old_text": "without_gil([&] {\n    self->py_modules->unregister_client(name, addrs);\n  })",
          "new_text": "self->py_modules->get_daemon_health_metrics()",
          "old_line_content": "  without_gil([&] {",
          "new_line_content": "  return self->py_modules->get_daemon_health_metrics();",
          "content_same": false
        },
        {
          "line": 1578,
          "old_api": "PyArg_ParseTupleAndKeywords",
          "new_api": "ceph_assert",
          "old_text": "PyArg_ParseTupleAndKeywords(args, kwds, \"OO\",\n                                      const_cast<char**>(kwlist),\n                                      &py_modules_capsule,\n                                      &this_module_capsule)",
          "new_text": "ceph_assert(self->py_modules)",
          "old_line_content": "    if (! PyArg_ParseTupleAndKeywords(args, kwds, \"OO\",",
          "new_line_content": "    ceph_assert(self->py_modules);",
          "content_same": false
        },
        {
          "line": 1579,
          "old_api": "const_cast<char**>(kwlist)",
          "new_api": "PyCapsule_GetPointer",
          "old_text": "const_cast<char**>(kwlist)",
          "new_text": "PyCapsule_GetPointer(\n        this_module_capsule, nullptr)",
          "old_line_content": "                                      const_cast<char**>(kwlist),",
          "new_line_content": "    self->this_module = static_cast<ActivePyModule*>(PyCapsule_GetPointer(",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 512,
          "old_api": null,
          "new_api": "dout",
          "old_text": null,
          "new_text": "dout(4)",
          "old_line_content": "  }",
          "new_line_content": "    dout(4) << \"ceph_store_get \" << what << \" not found \" << dendl;",
          "content_same": false
        },
        {
          "line": 1025,
          "old_api": null,
          "new_api": "empty",
          "old_text": null,
          "new_text": "query.key_descriptor.empty()",
          "old_line_content": "          Py_RETURN_NONE;",
          "new_line_content": "  if (query.key_descriptor.empty() ||",
          "content_same": false
        },
        {
          "line": 1026,
          "old_api": null,
          "new_api": "empty",
          "old_text": null,
          "new_text": "query.performance_counter_descriptors.empty()",
          "old_line_content": "        }",
          "new_line_content": "      query.performance_counter_descriptors.empty()) {",
          "content_same": false
        },
        {
          "line": 1033,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "ds.end()",
          "old_line_content": "",
          "new_line_content": "    if (std::find(ds.begin(), ds.end(), limit->order_by) == ds.end()) {",
          "content_same": false
        },
        {
          "line": 522,
          "old_api": null,
          "new_api": "PyArg_ParseTuple",
          "old_text": null,
          "new_text": "PyArg_ParseTuple(args, \"sz:ceph_store_set\", &key, &value)",
          "old_line_content": "    Py_RETURN_NONE;",
          "new_line_content": "  if (!PyArg_ParseTuple(args, \"sz:ceph_store_set\", &key, &value)) {",
          "content_same": false
        },
        {
          "line": 1040,
          "old_api": null,
          "new_api": "add_osd_perf_query",
          "old_text": null,
          "new_text": "self->py_modules->add_osd_perf_query(query, limit)",
          "old_line_content": "  if (limit) {",
          "new_line_content": "  auto query_id = self->py_modules->add_osd_perf_query(query, limit);",
          "content_same": false
        },
        {
          "line": 529,
          "old_api": null,
          "new_api": "set_store",
          "old_text": null,
          "new_text": "without_gil([&] {\n    self->py_modules->set_store(self->this_module->get_name(), key, val);\n  })",
          "old_line_content": "  char *key = nullptr;",
          "new_line_content": "  without_gil([&] {",
          "content_same": false
        },
        {
          "line": 530,
          "old_api": null,
          "new_api": "get_name",
          "old_text": null,
          "new_text": "self->this_module->get_name()",
          "old_line_content": "  char *value = nullptr;",
          "new_line_content": "    self->py_modules->set_store(self->this_module->get_name(), key, val);",
          "content_same": false
        },
        {
          "line": 1041,
          "old_api": null,
          "new_api": "PyLong_FromLong",
          "old_text": null,
          "new_text": "PyLong_FromLong(query_id)",
          "old_line_content": "    auto &ds = query.performance_counter_descriptors;",
          "new_line_content": "  return PyLong_FromLong(query_id);",
          "content_same": false
        },
        {
          "line": 1557,
          "old_api": null,
          "new_api": "tp_alloc",
          "old_text": null,
          "new_text": "type->tp_alloc(type, 0)",
          "old_line_content": "  {NULL, NULL, 0, NULL}",
          "new_line_content": "    self = (BaseMgrModule *)type->tp_alloc(type, 0);",
          "content_same": false
        },
        {
          "line": 1048,
          "old_api": null,
          "new_api": "PyArg_ParseTuple",
          "old_text": null,
          "new_text": "PyArg_ParseTuple(args, \"i:ceph_remove_osd_perf_query\", &query_id)",
          "old_line_content": "",
          "new_line_content": "  if (!PyArg_ParseTuple(args, \"i:ceph_remove_osd_perf_query\", &query_id)) {",
          "content_same": false
        },
        {
          "line": 540,
          "old_api": null,
          "new_api": "PyArg_ParseTuple",
          "old_text": null,
          "new_text": "PyArg_ParseTuple(args, \"ss:get_metadata\", &svc_name, &svc_id)",
          "old_line_content": "  });",
          "new_line_content": "  if (!PyArg_ParseTuple(args, \"ss:get_metadata\", &svc_name, &svc_id)) {",
          "content_same": false
        },
        {
          "line": 1053,
          "old_api": null,
          "new_api": "remove_osd_perf_query",
          "old_text": null,
          "new_text": "self->py_modules->remove_osd_perf_query(query_id)",
          "old_line_content": "static PyObject*",
          "new_line_content": "  self->py_modules->remove_osd_perf_query(query_id);",
          "content_same": false
        },
        {
          "line": 543,
          "old_api": null,
          "new_api": "get_metadata_python",
          "old_text": null,
          "new_text": "self->py_modules->get_metadata_python(svc_name, svc_id)",
          "old_line_content": "",
          "new_line_content": "  return self->py_modules->get_metadata_python(svc_name, svc_id);",
          "content_same": false
        },
        {
          "line": 1569,
          "old_api": null,
          "new_api": "PyArg_ParseTupleAndKeywords",
          "old_text": null,
          "new_text": "PyArg_ParseTupleAndKeywords(args, kwds, \"OO\",\n                                      const_cast<char**>(kwlist),\n                                      &py_modules_capsule,\n                                      &this_module_capsule)",
          "old_line_content": "}",
          "new_line_content": "    if (! PyArg_ParseTupleAndKeywords(args, kwds, \"OO\",",
          "content_same": false
        },
        {
          "line": 1570,
          "old_api": null,
          "new_api": "const_cast<char**>(kwlist)",
          "old_text": null,
          "new_text": "const_cast<char**>(kwlist)",
          "old_line_content": "",
          "new_line_content": "                                      const_cast<char**>(kwlist),",
          "content_same": false
        },
        {
          "line": 1061,
          "old_api": null,
          "new_api": "PyArg_ParseTuple",
          "old_text": null,
          "new_text": "PyArg_ParseTuple(args, \"i:ceph_get_osd_perf_counters\", &query_id)",
          "old_line_content": "",
          "new_line_content": "  if (!PyArg_ParseTuple(args, \"i:ceph_get_osd_perf_counters\", &query_id)) {",
          "content_same": false
        },
        {
          "line": 551,
          "old_api": null,
          "new_api": "PyArg_ParseTuple",
          "old_text": null,
          "new_text": "PyArg_ParseTuple(args, \"ss:get_daemon_status\", &svc_name,\n\t\t\t&svc_id)",
          "old_line_content": "  }",
          "new_line_content": "  if (!PyArg_ParseTuple(args, \"ss:get_daemon_status\", &svc_name,",
          "content_same": false
        },
        {
          "line": 1576,
          "old_api": null,
          "new_api": "PyCapsule_GetPointer",
          "old_text": null,
          "new_text": "PyCapsule_GetPointer(\n        py_modules_capsule, nullptr)",
          "old_line_content": "    static const char *kwlist[] = {\"py_modules\", \"this_module\", NULL};",
          "new_line_content": "    self->py_modules = static_cast<ActivePyModules*>(PyCapsule_GetPointer(",
          "content_same": false
        },
        {
          "line": 1066,
          "old_api": null,
          "new_api": "get_osd_perf_counters",
          "old_text": null,
          "new_text": "self->py_modules->get_osd_perf_counters(query_id)",
          "old_line_content": "static PyObject*",
          "new_line_content": "  return self->py_modules->get_osd_perf_counters(query_id);",
          "content_same": false
        },
        {
          "line": 555,
          "old_api": null,
          "new_api": "get_daemon_status_python",
          "old_text": null,
          "new_text": "self->py_modules->get_daemon_status_python(svc_name, svc_id)",
          "old_line_content": "static PyObject*",
          "new_line_content": "  return self->py_modules->get_daemon_status_python(svc_name, svc_id);",
          "content_same": false
        },
        {
          "line": 1581,
          "old_api": null,
          "new_api": "ceph_assert",
          "old_text": null,
          "new_text": "ceph_assert(self->this_module)",
          "old_line_content": "                                      &this_module_capsule)) {",
          "new_line_content": "    ceph_assert(self->this_module);",
          "content_same": false
        },
        {
          "line": 562,
          "old_api": null,
          "new_api": "PyArg_ParseTuple",
          "old_text": null,
          "new_text": "PyArg_ParseTuple(args, \"s:log\", &record)",
          "old_line_content": "    return nullptr;",
          "new_line_content": "  if (!PyArg_ParseTuple(args, \"s:log\", &record)) {",
          "content_same": false
        },
        {
          "line": 566,
          "old_api": null,
          "new_api": "ceph_assert",
          "old_text": null,
          "new_text": "ceph_assert(self->this_module)",
          "old_line_content": "",
          "new_line_content": "  ceph_assert(self->this_module);",
          "content_same": false
        },
        {
          "line": 568,
          "old_api": null,
          "new_api": "log",
          "old_text": null,
          "new_text": "self->this_module->log(record)",
          "old_line_content": "ceph_log(BaseMgrModule *self, PyObject *args)",
          "new_line_content": "  self->this_module->log(record);",
          "content_same": false
        },
        {
          "line": 580,
          "old_api": null,
          "new_api": "PyArg_ParseTuple",
          "old_text": null,
          "new_text": "PyArg_ParseTuple(args, \"sis:ceph_cluster_log\", &channel, &prio, &message)",
          "old_line_content": "}",
          "new_line_content": "  if (!PyArg_ParseTuple(args, \"sis:ceph_cluster_log\", &channel, &prio, &message)) {",
          "content_same": false
        },
        {
          "line": 583,
          "old_api": null,
          "new_api": "cluster_log",
          "old_text": null,
          "new_text": "without_gil([&] {\n    self->py_modules->cluster_log(channel, (clog_type)prio, message);\n  })",
          "old_line_content": "ceph_cluster_log(BaseMgrModule *self, PyObject *args)",
          "new_line_content": "  without_gil([&] {",
          "content_same": false
        },
        {
          "line": 584,
          "old_api": null,
          "new_api": "cluster_log",
          "old_text": null,
          "new_text": "self->py_modules->cluster_log(channel, (clog_type)prio, message)",
          "old_line_content": "{",
          "new_line_content": "    self->py_modules->cluster_log(channel, (clog_type)prio, message);",
          "content_same": false
        },
        {
          "line": 1107,
          "old_api": null,
          "new_api": "PyArg_ParseTuple",
          "old_text": null,
          "new_text": "PyArg_ParseTuple(args, \"O:ceph_add_mds_perf_query\", &py_query)",
          "old_line_content": "    {\"avg_read_latency\", MDSPerformanceCounterType::AVG_READ_LATENCY_METRIC},",
          "new_line_content": "  if (!PyArg_ParseTuple(args, \"O:ceph_add_mds_perf_query\", &py_query)) {",
          "content_same": false
        },
        {
          "line": 598,
          "old_api": null,
          "new_api": "get_conf_path",
          "old_text": null,
          "new_text": "g_conf().get_conf_path().c_str()",
          "old_line_content": "static PyObject *",
          "new_line_content": "  return PyUnicode_FromString(g_conf().get_conf_path().c_str());",
          "content_same": false
        },
        {
          "line": 1111,
          "old_api": null,
          "new_api": "PyDict_Check",
          "old_text": null,
          "new_text": "PyDict_Check(py_query)",
          "old_line_content": "    {\"avg_metadata_latency\", MDSPerformanceCounterType::AVG_METADATA_LATENCY_METRIC},",
          "new_line_content": "  if (!PyDict_Check(py_query)) {",
          "content_same": false
        },
        {
          "line": 604,
          "old_api": null,
          "new_api": "ceph_release_to_str",
          "old_text": null,
          "new_text": "ceph_release_to_str()",
          "old_line_content": "static PyObject *",
          "new_line_content": "  return PyUnicode_FromString(ceph_release_to_str());",
          "content_same": false
        },
        {
          "line": 95,
          "old_api": null,
          "new_api": "c_str",
          "old_text": null,
          "new_text": "outs.c_str()",
          "old_line_content": "",
          "new_line_content": "      auto rtn = PyObject_CallFunction(set_fn, \"(iss)\", r, outbl.to_str().c_str(), outs.c_str());",
          "content_same": false
        },
        {
          "line": 611,
          "old_api": null,
          "new_api": "PyArg_ParseTuple",
          "old_text": null,
          "new_text": "PyArg_ParseTuple(args, \"i:ceph_lookup_release_name\", &major)",
          "old_line_content": "ceph_get_release_name(BaseMgrModule *self, PyObject *args)",
          "new_line_content": "  if (!PyArg_ParseTuple(args, \"i:ceph_lookup_release_name\", &major)) {",
          "content_same": false
        },
        {
          "line": 614,
          "old_api": null,
          "new_api": "ceph_release_name",
          "old_text": null,
          "new_text": "ceph_release_name(major)",
          "old_line_content": "}",
          "new_line_content": "  return PyUnicode_FromString(ceph_release_name(major));",
          "content_same": false
        },
        {
          "line": 105,
          "old_api": null,
          "new_api": "notify_all",
          "old_text": null,
          "new_text": "py_modules->notify_all(\"command\", tag)",
          "old_line_content": "      if (rtn != nullptr) {",
          "new_line_content": "    py_modules->notify_all(\"command\", tag);",
          "content_same": false
        },
        {
          "line": 1131,
          "old_api": null,
          "new_api": "PyList_Size",
          "old_text": null,
          "new_text": "PyList_Size(query_params)",
          "old_line_content": "  //     {'type': subkey_type, 'regex': regex_pattern},",
          "new_line_content": "  for (int i = 0; i < PyList_Size(query_params); ++i) {",
          "content_same": false
        },
        {
          "line": 1132,
          "old_api": null,
          "new_api": "PyList_GET_ITEM",
          "old_text": null,
          "new_text": "PyList_GET_ITEM(query_params, i)",
          "old_line_content": "  //     ...",
          "new_line_content": "    PyObject *kv = PyList_GET_ITEM(query_params, i);",
          "content_same": false
        },
        {
          "line": 1135,
          "old_api": null,
          "new_api": "PyArg_ParseTuple",
          "old_text": null,
          "new_text": "PyArg_ParseTuple(kv, \"sO:pair\", &query_param_name, &query_param_val)",
          "old_line_content": "  //     list, of, descriptor, types",
          "new_line_content": "    if (!PyArg_ParseTuple(kv, \"sO:pair\", &query_param_name, &query_param_val)) {",
          "content_same": false
        },
        {
          "line": 1145,
          "old_api": null,
          "new_api": "PyList_GET_ITEM",
          "old_text": null,
          "new_text": "PyList_GET_ITEM(query_param_val, j)",
          "old_line_content": "      derr << __func__ << \" dict item \" << i << \" not a size 2 tuple\" << dendl;",
          "new_line_content": "        PyObject *sub_key = PyList_GET_ITEM(query_param_val, j);",
          "content_same": false
        },
        {
          "line": 633,
          "old_api": null,
          "new_api": "get_counter_python",
          "old_text": null,
          "new_text": "self->py_modules->get_counter_python(\n      svc_name, svc_id, counter_path)",
          "old_line_content": "get_counter(BaseMgrModule *self, PyObject *args)",
          "new_line_content": "  return self->py_modules->get_counter_python(",
          "content_same": false
        },
        {
          "line": 1146,
          "old_api": null,
          "new_api": "PyDict_Check",
          "old_text": null,
          "new_text": "PyDict_Check(sub_key)",
          "old_line_content": "      Py_RETURN_NONE;",
          "new_line_content": "        if (!PyDict_Check(sub_key)) {",
          "content_same": false
        },
        {
          "line": 126,
          "old_api": null,
          "new_api": "PyArg_ParseTuple",
          "old_text": null,
          "new_text": "PyArg_ParseTuple(args, \"Ossssz#:ceph_send_command\",\n        &completion, &type, &name, &cmd_json, &tag, &inbuf_ptr, &inbuf_len)",
          "old_line_content": "  char *name = nullptr;",
          "new_line_content": "  if (!PyArg_ParseTuple(args, \"Ossssz#:ceph_send_command\",",
          "content_same": false
        },
        {
          "line": 1152,
          "old_api": null,
          "new_api": "PyDict_Items",
          "old_text": null,
          "new_text": "PyDict_Items(sub_key)",
          "old_line_content": "      }",
          "new_line_content": "        PyObject *sub_key_params = PyDict_Items(sub_key);",
          "content_same": false
        },
        {
          "line": 643,
          "old_api": null,
          "new_api": "PyArg_ParseTuple",
          "old_text": null,
          "new_text": "PyArg_ParseTuple(args, \"sss:get_counter\", &svc_name,\n                                                  &svc_id, &counter_path)",
          "old_line_content": "      svc_name, svc_id, counter_path);",
          "new_line_content": "  if (!PyArg_ParseTuple(args, \"sss:get_counter\", &svc_name,",
          "content_same": false
        },
        {
          "line": 132,
          "old_api": null,
          "new_api": "append",
          "old_text": null,
          "new_text": "inbuf.append(inbuf_ptr, (unsigned)inbuf_len)",
          "old_line_content": "  bufferlist inbuf = {};",
          "new_line_content": "    inbuf.append(inbuf_ptr, (unsigned)inbuf_len);",
          "content_same": false
        },
        {
          "line": 647,
          "old_api": null,
          "new_api": "get_latest_counter_python",
          "old_text": null,
          "new_text": "self->py_modules->get_latest_counter_python(\n      svc_name, svc_id, counter_path)",
          "old_line_content": "get_latest_counter(BaseMgrModule *self, PyObject *args)",
          "new_line_content": "  return self->py_modules->get_latest_counter_python(",
          "content_same": false
        },
        {
          "line": 137,
          "old_api": null,
          "new_api": "ceph_abort",
          "old_text": null,
          "new_text": "ceph_abort()",
          "old_line_content": "    return nullptr;",
          "new_line_content": "    ceph_abort();  // TODO raise python exception instead",
          "content_same": false
        },
        {
          "line": 139,
          "old_api": null,
          "new_api": "PyCallable_Check",
          "old_text": null,
          "new_text": "PyCallable_Check(set_fn)",
          "old_line_content": "",
          "new_line_content": "    ceph_assert(PyCallable_Check(set_fn));",
          "content_same": false
        },
        {
          "line": 1168,
          "old_api": null,
          "new_api": "PyUnicode_Check",
          "old_text": null,
          "new_text": "PyUnicode_Check(param_value)",
          "old_line_content": "          }",
          "new_line_content": "            if (!PyUnicode_Check(param_value)) {",
          "content_same": false
        },
        {
          "line": 661,
          "old_api": null,
          "new_api": "get_perf_schema_python",
          "old_text": null,
          "new_text": "self->py_modules->get_perf_schema_python(type_str, svc_id)",
          "old_line_content": "get_perf_schema(BaseMgrModule *self, PyObject *args)",
          "new_line_content": "  return self->py_modules->get_perf_schema_python(type_str, svc_id);",
          "content_same": false
        },
        {
          "line": 1173,
          "old_api": null,
          "new_api": "PyUnicode_AsUTF8",
          "old_text": null,
          "new_text": "PyUnicode_AsUTF8(param_value)",
          "old_line_content": "                 << \" pair \" << k << \" not a size 2 tuple\" << dendl;",
          "new_line_content": "            auto type = PyUnicode_AsUTF8(param_value);",
          "content_same": false
        },
        {
          "line": 1174,
          "old_api": null,
          "new_api": "find",
          "old_text": null,
          "new_text": "sub_key_types.find(type)",
          "old_line_content": "            Py_RETURN_NONE;",
          "new_line_content": "            auto it = sub_key_types.find(type);",
          "content_same": false
        },
        {
          "line": 1175,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "sub_key_types.end()",
          "old_line_content": "          }",
          "new_line_content": "            if (it == sub_key_types.end()) {",
          "content_same": false
        },
        {
          "line": 667,
          "old_api": null,
          "new_api": "get_rocksdb_version",
          "old_text": null,
          "new_text": "self->py_modules->get_rocksdb_version()",
          "old_line_content": "    return nullptr;",
          "new_line_content": "  return self->py_modules->get_rocksdb_version();",
          "content_same": false
        },
        {
          "line": 158,
          "old_api": null,
          "new_api": "wait_for_latest_osdmap",
          "old_text": null,
          "new_text": "self->py_modules->get_objecter().wait_for_latest_osdmap(\n\t[command_c, command_r](boost::system::error_code) {\n\t  command_c->complete(command_r);\n\t})",
          "old_line_content": "",
          "new_line_content": "      self->py_modules->get_objecter().wait_for_latest_osdmap(",
          "content_same": false
        },
        {
          "line": 160,
          "old_api": null,
          "new_api": "complete",
          "old_text": null,
          "new_text": "command_c->complete(command_r)",
          "old_line_content": "    // the mons.  This is a heavy-handed hack to make life simpler",
          "new_line_content": "\t  command_c->complete(command_r);",
          "content_same": false
        },
        {
          "line": 674,
          "old_api": null,
          "new_api": "get_osdmap",
          "old_text": null,
          "new_text": "self->py_modules->get_osdmap()",
          "old_line_content": "ceph_get_rocksdb_version(BaseMgrModule *self)",
          "new_line_content": "  return self->py_modules->get_osdmap();",
          "content_same": false
        },
        {
          "line": 1187,
          "old_api": null,
          "new_api": "PyUnicode_AsUTF8",
          "old_text": null,
          "new_text": "PyUnicode_AsUTF8(param_value)",
          "old_line_content": "              Py_RETURN_NONE;",
          "new_line_content": "            d.regex_str = PyUnicode_AsUTF8(param_value);",
          "content_same": false
        },
        {
          "line": 164,
          "old_api": null,
          "new_api": "start_mon_command",
          "old_text": null,
          "new_text": "self->py_modules->get_monc().start_mon_command(\n        name,\n        {cmd_json},\n        inbuf,\n        &command_c->outbl,\n        &command_c->outs,\n        new C_OnFinisher(c, &self->py_modules->cmd_finisher))",
          "old_line_content": "    // latest cluster map versions on completion, and callers",
          "new_line_content": "    self->py_modules->get_monc().start_mon_command(",
          "content_same": false
        },
        {
          "line": 1189,
          "old_api": null,
          "new_api": "c_str",
          "old_text": null,
          "new_text": "d.regex_str.c_str()",
          "old_line_content": "            d.type = it->second;",
          "new_line_content": "              d.regex = d.regex_str.c_str();",
          "content_same": false
        },
        {
          "line": 681,
          "old_api": null,
          "new_api": "PyArg_ParseTuple",
          "old_text": null,
          "new_text": "PyArg_ParseTuple(args, \"s:ceph_advertize_service\",\n        &svc_str)",
          "old_line_content": "ceph_get_osdmap(BaseMgrModule *self, PyObject *args)",
          "new_line_content": "  if (!PyArg_ParseTuple(args, \"s:ceph_advertize_service\",",
          "content_same": false
        },
        {
          "line": 171,
          "old_api": null,
          "new_api": "std::string(type)",
          "old_text": null,
          "new_text": "std::string(type)",
          "old_line_content": "    });",
          "new_line_content": "  } else if (std::string(type) == \"osd\") {",
          "content_same": false
        },
        {
          "line": 1195,
          "old_api": null,
          "new_api": "mark_count",
          "old_text": null,
          "new_text": "d.regex.mark_count()",
          "old_line_content": "            }",
          "new_line_content": "            if (d.regex.mark_count() == 0) {",
          "content_same": false
        },
        {
          "line": 174,
          "old_api": null,
          "new_api": "empty",
          "old_text": null,
          "new_text": "err.empty()",
          "old_line_content": "        name,",
          "new_line_content": "    if (!err.empty()) {",
          "content_same": false
        },
        {
          "line": 688,
          "old_api": null,
          "new_api": "set_uri",
          "old_text": null,
          "new_text": "without_gil([&] {\n    self->py_modules->set_uri(self->this_module->get_name(), svc_str);\n  })",
          "old_line_content": "{",
          "new_line_content": "  without_gil([&] {",
          "content_same": false
        },
        {
          "line": 177,
          "old_api": null,
          "new_api": "append",
          "old_text": null,
          "new_text": "msg.append(\"\\\"\").append(name).append(\"\\\"\")",
          "old_line_content": "        &command_c->outbl,",
          "new_line_content": "      msg.append(\"\\\"\").append(name).append(\"\\\"\");",
          "content_same": false
        },
        {
          "line": 178,
          "old_api": null,
          "new_api": "PyEval_RestoreThread",
          "old_text": null,
          "new_text": "PyEval_RestoreThread(tstate)",
          "old_line_content": "        &command_c->outs,",
          "new_line_content": "      PyEval_RestoreThread(tstate);",
          "content_same": false
        },
        {
          "line": 179,
          "old_api": null,
          "new_api": "c_str",
          "old_text": null,
          "new_text": "msg.c_str()",
          "old_line_content": "        new C_OnFinisher(c, &self->py_modules->cmd_finisher));",
          "new_line_content": "      PyErr_SetString(PyExc_ValueError, msg.c_str());",
          "content_same": false
        },
        {
          "line": 689,
          "old_api": null,
          "new_api": "get_name",
          "old_text": null,
          "new_text": "self->this_module->get_name()",
          "old_line_content": "  char *svc_str = nullptr;",
          "new_line_content": "    self->py_modules->set_uri(self->this_module->get_name(), svc_str);",
          "content_same": false
        },
        {
          "line": 1207,
          "old_api": null,
          "new_api": "static_cast<MDSPerfMetricSubKeyType>(-1)",
          "old_text": null,
          "new_text": "static_cast<MDSPerfMetricSubKeyType>(-1)",
          "old_line_content": "                   << dendl;",
          "new_line_content": "        if (d.type == static_cast<MDSPerfMetricSubKeyType>(-1) ||",
          "content_same": false
        },
        {
          "line": 184,
          "old_api": null,
          "new_api": "osd_command",
          "old_text": null,
          "new_text": "self->py_modules->get_objecter().osd_command(\n        osd_id,\n        {cmd_json},\n        inbuf,\n        &tid,\n\t[command_c, f = &self->py_modules->cmd_finisher]\n\t(boost::system::error_code ec, std::string s, ceph::buffer::list bl) {\n\t  command_c->outs = std::move(s);\n\t  command_c->outbl = std::move(bl);\n\t  f->queue(command_c);\n\t})",
          "old_line_content": "      delete command_c;",
          "new_line_content": "    self->py_modules->get_objecter().osd_command(",
          "content_same": false
        },
        {
          "line": 1208,
          "old_api": null,
          "new_api": "empty",
          "old_text": null,
          "new_text": "d.regex_str.empty()",
          "old_line_content": "              Py_RETURN_NONE;",
          "new_line_content": "            d.regex_str.empty()) {",
          "content_same": false
        },
        {
          "line": 699,
          "old_api": null,
          "new_api": "PyArg_ParseTuple",
          "old_text": null,
          "new_text": "PyArg_ParseTuple(args, \"sf:ceph_set_wear_level\",\n\t\t\t&devid, &wear_level)",
          "old_line_content": "  });",
          "new_line_content": "  if (!PyArg_ParseTuple(args, \"sf:ceph_set_wear_level\",",
          "content_same": false
        },
        {
          "line": 1213,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "query.key_descriptor.push_back(d)",
          "old_line_content": "            Py_RETURN_NONE;",
          "new_line_content": "        query.key_descriptor.push_back(d);",
          "content_same": false
        },
        {
          "line": 191,
          "old_api": null,
          "new_api": "std::move(s)",
          "old_text": null,
          "new_text": "std::move(s)",
          "old_line_content": "",
          "new_line_content": "\t  command_c->outs = std::move(s);",
          "content_same": false
        },
        {
          "line": 192,
          "old_api": null,
          "new_api": "std::move(bl)",
          "old_text": null,
          "new_text": "std::move(bl)",
          "old_line_content": "    ceph_tid_t tid;",
          "new_line_content": "\t  command_c->outbl = std::move(bl);",
          "content_same": false
        },
        {
          "line": 703,
          "old_api": null,
          "new_api": "set_device_wear_level",
          "old_text": null,
          "new_text": "without_gil([&] {\n    self->py_modules->set_device_wear_level(devid, wear_level);\n  })",
          "old_line_content": "static PyObject*",
          "new_line_content": "  without_gil([&] {",
          "content_same": false
        },
        {
          "line": 704,
          "old_api": null,
          "new_api": "set_device_wear_level",
          "old_text": null,
          "new_text": "self->py_modules->set_device_wear_level(devid, wear_level)",
          "old_line_content": "ceph_set_wear_level(BaseMgrModule *self, PyObject *args)",
          "new_line_content": "    self->py_modules->set_device_wear_level(devid, wear_level);",
          "content_same": false
        },
        {
          "line": 195,
          "old_api": null,
          "new_api": "std::string(type)",
          "old_text": null,
          "new_text": "std::string(type)",
          "old_line_content": "        {cmd_json},",
          "new_line_content": "  } else if (std::string(type) == \"mds\") {",
          "content_same": false
        },
        {
          "line": 196,
          "old_api": null,
          "new_api": "mds_command",
          "old_text": null,
          "new_text": "self->py_modules->get_client().mds_command(\n        name,\n        {cmd_json},\n        inbuf,\n        &command_c->outbl,\n        &command_c->outs,\n        new C_OnFinisher(command_c, &self->py_modules->cmd_finisher))",
          "old_line_content": "        inbuf,",
          "new_line_content": "    int r = self->py_modules->get_client().mds_command(",
          "content_same": false
        },
        {
          "line": 1220,
          "old_api": null,
          "new_api": "PyList_Size",
          "old_text": null,
          "new_text": "PyList_Size(query_param_val)",
          "old_line_content": "          Py_RETURN_NONE;",
          "new_line_content": "      for (int j = 0; j < PyList_Size(query_param_val); j++) {",
          "content_same": false
        },
        {
          "line": 1221,
          "old_api": null,
          "new_api": "PyList_GET_ITEM",
          "old_text": null,
          "new_text": "PyList_GET_ITEM(query_param_val, j)",
          "old_line_content": "        }",
          "new_line_content": "        PyObject *py_type = PyList_GET_ITEM(query_param_val, j);",
          "content_same": false
        },
        {
          "line": 1227,
          "old_api": null,
          "new_api": "PyUnicode_AsUTF8",
          "old_text": null,
          "new_text": "PyUnicode_AsUTF8(py_type)",
          "old_line_content": "        Py_RETURN_NONE;",
          "new_line_content": "        auto type = PyUnicode_AsUTF8(py_type);",
          "content_same": false
        },
        {
          "line": 1228,
          "old_api": null,
          "new_api": "find",
          "old_text": null,
          "new_text": "counter_types.find(type)",
          "old_line_content": "      }",
          "new_line_content": "        auto it = counter_types.find(type);",
          "content_same": false
        },
        {
          "line": 206,
          "old_api": null,
          "new_api": "PyEval_RestoreThread",
          "old_text": null,
          "new_text": "PyEval_RestoreThread(tstate)",
          "old_line_content": "        name,",
          "new_line_content": "      PyEval_RestoreThread(tstate);",
          "content_same": false
        },
        {
          "line": 207,
          "old_api": null,
          "new_api": "c_str",
          "old_text": null,
          "new_text": "msg.c_str()",
          "old_line_content": "        {cmd_json},",
          "new_line_content": "      PyErr_SetString(PyExc_RuntimeError, msg.c_str());",
          "content_same": false
        },
        {
          "line": 210,
          "old_api": null,
          "new_api": "std::string(type)",
          "old_text": null,
          "new_text": "std::string(type)",
          "old_line_content": "        &command_c->outs,",
          "new_line_content": "  } else if (std::string(type) == \"pg\") {",
          "content_same": false
        },
        {
          "line": 1234,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "query.performance_counter_descriptors.push_back(it->second)",
          "old_line_content": "          Py_RETURN_NONE;",
          "new_line_content": "        query.performance_counter_descriptors.push_back(it->second);",
          "content_same": false
        },
        {
          "line": 212,
          "old_api": null,
          "new_api": "parse",
          "old_text": null,
          "new_text": "pgid.parse(name)",
          "old_line_content": "    if (r != 0) {",
          "new_line_content": "    if (!pgid.parse(name)) {",
          "content_same": false
        },
        {
          "line": 726,
          "old_api": null,
          "new_api": "PyArg_ParseTuple",
          "old_text": null,
          "new_text": "PyArg_ParseTuple(args, \"ssfb:ceph_update_progress_event\",\n\t\t\t&evid, &desc, &progress, &add_to_ceph_s)",
          "old_line_content": "}",
          "new_line_content": "  if (!PyArg_ParseTuple(args, \"ssfb:ceph_update_progress_event\",",
          "content_same": false
        },
        {
          "line": 217,
          "old_api": null,
          "new_api": "c_str",
          "old_text": null,
          "new_text": "msg.c_str()",
          "old_line_content": "      return nullptr;",
          "new_line_content": "      PyErr_SetString(PyExc_ValueError, msg.c_str());",
          "content_same": false
        },
        {
          "line": 730,
          "old_api": null,
          "new_api": "update_progress_event",
          "old_text": null,
          "new_text": "without_gil([&] {\n    self->py_modules->update_progress_event(evid, desc, progress, add_to_ceph_s);\n  })",
          "old_line_content": "{",
          "new_line_content": "  without_gil([&] {",
          "content_same": false
        },
        {
          "line": 731,
          "old_api": null,
          "new_api": "update_progress_event",
          "old_text": null,
          "new_text": "self->py_modules->update_progress_event(evid, desc, progress, add_to_ceph_s)",
          "old_line_content": "  char *evid = nullptr;",
          "new_line_content": "    self->py_modules->update_progress_event(evid, desc, progress, add_to_ceph_s);",
          "content_same": false
        },
        {
          "line": 1244,
          "old_api": null,
          "new_api": "PyDict_Items",
          "old_text": null,
          "new_text": "PyDict_Items(query_param_val)",
          "old_line_content": "      }",
          "new_line_content": "      PyObject *limit_params = PyDict_Items(query_param_val);",
          "content_same": false
        },
        {
          "line": 222,
          "old_api": null,
          "new_api": "pg_command",
          "old_text": null,
          "new_text": "self->py_modules->get_objecter().pg_command(\n        pgid,\n        {cmd_json},\n        inbuf,\n        &tid,\n\t[command_c, f = &self->py_modules->cmd_finisher]\n\t(boost::system::error_code ec, std::string s, ceph::buffer::list bl) {\n\t  command_c->outs = std::move(s);\n\t  command_c->outbl = std::move(bl);\n\t  f->queue(command_c);\n\t})",
          "old_line_content": "      delete command_c;",
          "new_line_content": "    self->py_modules->get_objecter().pg_command(",
          "content_same": false
        },
        {
          "line": 1247,
          "old_api": null,
          "new_api": "PyList_GET_ITEM",
          "old_text": null,
          "new_text": "PyList_GET_ITEM(limit_params, j)",
          "old_line_content": "        derr << __func__ << \" query \" << query_param_name << \" not a dict\"",
          "new_line_content": "        PyObject *kv = PyList_GET_ITEM(limit_params, j);",
          "content_same": false
        },
        {
          "line": 1250,
          "old_api": null,
          "new_api": "PyArg_ParseTuple",
          "old_text": null,
          "new_text": "PyArg_ParseTuple(kv, \"sO:pair\", &limit_param_name,\n                              &limit_param_val)",
          "old_line_content": "      }",
          "new_line_content": "        if (!PyArg_ParseTuple(kv, \"sO:pair\", &limit_param_name,",
          "content_same": false
        },
        {
          "line": 229,
          "old_api": null,
          "new_api": "std::move(s)",
          "old_text": null,
          "new_text": "std::move(s)",
          "old_line_content": "",
          "new_line_content": "\t  command_c->outs = std::move(s);",
          "content_same": false
        },
        {
          "line": 230,
          "old_api": null,
          "new_api": "std::move(bl)",
          "old_text": null,
          "new_text": "std::move(bl)",
          "old_line_content": "    ceph_tid_t tid;",
          "new_line_content": "\t  command_c->outbl = std::move(bl);",
          "content_same": false
        },
        {
          "line": 744,
          "old_api": null,
          "new_api": "complete_progress_event",
          "old_text": null,
          "new_text": "without_gil([&] {\n    self->py_modules->complete_progress_event(evid);\n  })",
          "old_line_content": "",
          "new_line_content": "  without_gil([&] {",
          "content_same": false
        },
        {
          "line": 233,
          "old_api": null,
          "new_api": "PyEval_RestoreThread",
          "old_text": null,
          "new_text": "PyEval_RestoreThread(tstate)",
          "old_line_content": "        {cmd_json},",
          "new_line_content": "    PyEval_RestoreThread(tstate);",
          "content_same": false
        },
        {
          "line": 745,
          "old_api": null,
          "new_api": "complete_progress_event",
          "old_text": null,
          "new_text": "self->py_modules->complete_progress_event(evid)",
          "old_line_content": "static PyObject*",
          "new_line_content": "    self->py_modules->complete_progress_event(evid);",
          "content_same": false
        },
        {
          "line": 1258,
          "old_api": null,
          "new_api": "PyUnicode_Check",
          "old_text": null,
          "new_text": "PyUnicode_Check(limit_param_val)",
          "old_line_content": "        PyObject *limit_param_val = nullptr;",
          "new_line_content": "          if (!PyUnicode_Check(limit_param_val)) {",
          "content_same": false
        },
        {
          "line": 1263,
          "old_api": null,
          "new_api": "PyUnicode_AsUTF8",
          "old_text": null,
          "new_text": "PyUnicode_AsUTF8(limit_param_val)",
          "old_line_content": "          Py_RETURN_NONE;",
          "new_line_content": "          auto order_by = PyUnicode_AsUTF8(limit_param_val);",
          "content_same": false
        },
        {
          "line": 1264,
          "old_api": null,
          "new_api": "find",
          "old_text": null,
          "new_text": "counter_types.find(order_by)",
          "old_line_content": "        }",
          "new_line_content": "          auto it = counter_types.find(order_by);",
          "content_same": false
        },
        {
          "line": 1265,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "counter_types.end()",
          "old_line_content": "",
          "new_line_content": "          if (it == counter_types.end()) {",
          "content_same": false
        },
        {
          "line": 244,
          "old_api": null,
          "new_api": "PyEval_RestoreThread",
          "old_text": null,
          "new_text": "PyEval_RestoreThread(tstate)",
          "old_line_content": "  } else {",
          "new_line_content": "  PyEval_RestoreThread(tstate);",
          "content_same": false
        },
        {
          "line": 252,
          "old_api": null,
          "new_api": "PyArg_ParseTuple",
          "old_text": null,
          "new_text": "PyArg_ParseTuple(args, \"O:ceph_set_health_checks\", &checks)",
          "old_line_content": "",
          "new_line_content": "  if (!PyArg_ParseTuple(args, \"O:ceph_set_health_checks\", &checks)) {",
          "content_same": false
        },
        {
          "line": 1277,
          "old_api": null,
          "new_api": "PyLong_AsLong",
          "old_text": null,
          "new_text": "PyLong_AsLong(limit_param_val)",
          "old_line_content": "            Py_RETURN_NONE;",
          "new_line_content": "          limit->max_count = PyLong_AsLong(limit_param_val);",
          "content_same": false
        },
        {
          "line": 255,
          "old_api": null,
          "new_api": "PyDict_Check",
          "old_text": null,
          "new_text": "PyDict_Check(checks)",
          "old_line_content": "}",
          "new_line_content": "  if (!PyDict_Check(checks)) {",
          "content_same": false
        },
        {
          "line": 768,
          "old_api": null,
          "new_api": "PyArg_ParseTuple",
          "old_text": null,
          "new_text": "PyArg_ParseTuple(args, \"ssOO:ceph_dispatch_remote\",\n        &other_module, &method, &remote_args, &remote_kwargs)",
          "old_line_content": "",
          "new_line_content": "  if (!PyArg_ParseTuple(args, \"ssOO:ceph_dispatch_remote\",",
          "content_same": false
        },
        {
          "line": 259,
          "old_api": null,
          "new_api": "PyDict_Items",
          "old_text": null,
          "new_text": "PyDict_Items(checks)",
          "old_line_content": "{",
          "new_line_content": "  PyObject *checksls = PyDict_Items(checks);",
          "content_same": false
        },
        {
          "line": 262,
          "old_api": null,
          "new_api": "PyList_GET_ITEM",
          "old_text": null,
          "new_text": "PyList_GET_ITEM(checksls, i)",
          "old_line_content": "    return NULL;",
          "new_line_content": "    PyObject *kv = PyList_GET_ITEM(checksls, i);",
          "content_same": false
        },
        {
          "line": 776,
          "old_api": null,
          "new_api": "module_exists",
          "old_text": null,
          "new_text": "self->py_modules->module_exists(other_module)",
          "old_line_content": "  PyObject *remote_kwargs = nullptr;",
          "new_line_content": "  if (!self->py_modules->module_exists(other_module)) {",
          "content_same": false
        },
        {
          "line": 265,
          "old_api": null,
          "new_api": "PyArg_ParseTuple",
          "old_text": null,
          "new_text": "PyArg_ParseTuple(kv, \"sO:pair\", &check_name, &check_info)",
          "old_line_content": "    derr << __func__ << \" arg not a dict\" << dendl;",
          "new_line_content": "    if (!PyArg_ParseTuple(kv, \"sO:pair\", &check_name, &check_info)) {",
          "content_same": false
        },
        {
          "line": 778,
          "old_api": null,
          "new_api": "PyErr_SetString",
          "old_text": null,
          "new_text": "PyErr_SetString(PyExc_ImportError, \"Module not found\")",
          "old_line_content": "        &other_module, &method, &remote_args, &remote_kwargs)) {",
          "new_line_content": "    PyErr_SetString(PyExc_ImportError, \"Module not found\");",
          "content_same": false
        },
        {
          "line": 1290,
          "old_api": null,
          "new_api": "empty",
          "old_text": null,
          "new_text": "query.key_descriptor.empty()",
          "old_line_content": "          Py_RETURN_NONE;",
          "new_line_content": "  if (query.key_descriptor.empty()) {",
          "content_same": false
        },
        {
          "line": 784,
          "old_api": null,
          "new_api": "PyEval_SaveThread",
          "old_text": null,
          "new_text": "PyEval_SaveThread()",
          "old_line_content": "  // inside dispatch_remote().",
          "new_line_content": "  PyThreadState *tstate = PyEval_SaveThread();",
          "content_same": false
        },
        {
          "line": 1297,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "ds.end()",
          "old_line_content": "  }",
          "new_line_content": "    if (std::find(ds.begin(), ds.end(), limit->order_by) == ds.end()) {",
          "content_same": false
        },
        {
          "line": 786,
          "old_api": null,
          "new_api": "method_exists",
          "old_text": null,
          "new_text": "self->py_modules->method_exists(other_module, method)",
          "old_line_content": "    derr << \"no module '\" << other_module << \"'\" << dendl;",
          "new_line_content": "  if (!self->py_modules->method_exists(other_module, method)) {",
          "content_same": false
        },
        {
          "line": 788,
          "old_api": null,
          "new_api": "PyErr_SetString",
          "old_text": null,
          "new_text": "PyErr_SetString(PyExc_NameError, \"Method not found\")",
          "old_line_content": "    return nullptr;",
          "new_line_content": "    PyErr_SetString(PyExc_NameError, \"Method not found\");",
          "content_same": false
        },
        {
          "line": 280,
          "old_api": null,
          "new_api": "PyList_Size",
          "old_text": null,
          "new_text": "PyList_Size(infols)",
          "old_line_content": "      derr << __func__ << \" item \" << i << \" \" << check_name",
          "new_line_content": "    for (int j = 0; j < PyList_Size(infols); ++j) {",
          "content_same": false
        },
        {
          "line": 281,
          "old_api": null,
          "new_api": "PyList_GET_ITEM",
          "old_text": null,
          "new_text": "PyList_GET_ITEM(infols, j)",
          "old_line_content": "\t   << \" value not a dict\" << dendl;",
          "new_line_content": "      PyObject *pair = PyList_GET_ITEM(infols, j);",
          "content_same": false
        },
        {
          "line": 282,
          "old_api": null,
          "new_api": "PyTuple_Check",
          "old_text": null,
          "new_text": "PyTuple_Check(pair)",
          "old_line_content": "      continue;",
          "new_line_content": "      if (!PyTuple_Check(pair)) {",
          "content_same": false
        },
        {
          "line": 1304,
          "old_api": null,
          "new_api": "add_mds_perf_query",
          "old_text": null,
          "new_text": "self->py_modules->add_mds_perf_query(query, limit)",
          "old_line_content": "  if (limit) {",
          "new_line_content": "  auto query_id = self->py_modules->add_mds_perf_query(query, limit);",
          "content_same": false
        },
        {
          "line": 1305,
          "old_api": null,
          "new_api": "PyLong_FromLong",
          "old_text": null,
          "new_text": "PyLong_FromLong(query_id)",
          "old_line_content": "    auto &ds = query.performance_counter_descriptors;",
          "new_line_content": "  return PyLong_FromLong(query_id);",
          "content_same": false
        },
        {
          "line": 1312,
          "old_api": null,
          "new_api": "PyArg_ParseTuple",
          "old_text": null,
          "new_text": "PyArg_ParseTuple(args, \"i:ceph_remove_mds_perf_query\", &query_id)",
          "old_line_content": "",
          "new_line_content": "  if (!PyArg_ParseTuple(args, \"i:ceph_remove_mds_perf_query\", &query_id)) {",
          "content_same": false
        },
        {
          "line": 801,
          "old_api": null,
          "new_api": "str",
          "old_text": null,
          "new_text": "ss.str().c_str()",
          "old_line_content": "  std::string err;",
          "new_line_content": "    PyErr_SetString(PyExc_RuntimeError, ss.str().c_str());",
          "content_same": false
        },
        {
          "line": 1317,
          "old_api": null,
          "new_api": "remove_mds_perf_query",
          "old_text": null,
          "new_text": "self->py_modules->remove_mds_perf_query(query_id)",
          "old_line_content": "static PyObject*",
          "new_line_content": "  self->py_modules->remove_mds_perf_query(query_id);",
          "content_same": false
        },
        {
          "line": 296,
          "old_api": null,
          "new_api": "PyUnicode_Check",
          "old_text": null,
          "new_text": "PyUnicode_Check(v)",
          "old_line_content": "      char *k = nullptr;",
          "new_line_content": "\tif (!PyUnicode_Check(v)) {",
          "content_same": false
        },
        {
          "line": 1324,
          "old_api": null,
          "new_api": "reregister_mds_perf_queries",
          "old_text": null,
          "new_text": "self->py_modules->reregister_mds_perf_queries()",
          "old_line_content": "  }",
          "new_line_content": "  self->py_modules->reregister_mds_perf_queries();",
          "content_same": false
        },
        {
          "line": 301,
          "old_api": null,
          "new_api": "PyUnicode_AsUTF8",
          "old_text": null,
          "new_text": "PyUnicode_AsUTF8(v)",
          "old_line_content": "\tcontinue;",
          "new_line_content": "\tif (const string vs = PyUnicode_AsUTF8(v); vs == \"warning\") {",
          "content_same": false
        },
        {
          "line": 307,
          "old_api": null,
          "new_api": "PyUnicode_Check",
          "old_text": null,
          "new_text": "PyUnicode_Check(v)",
          "old_line_content": "\t       << \" severity value not string\" << dendl;",
          "new_line_content": "\tif (!PyUnicode_Check(v)) {",
          "content_same": false
        },
        {
          "line": 1332,
          "old_api": null,
          "new_api": "PyArg_ParseTuple",
          "old_text": null,
          "new_text": "PyArg_ParseTuple(args, \"i:ceph_get_mds_perf_counters\", &query_id)",
          "old_line_content": "{",
          "new_line_content": "  if (!PyArg_ParseTuple(args, \"i:ceph_get_mds_perf_counters\", &query_id)) {",
          "content_same": false
        },
        {
          "line": 312,
          "old_api": null,
          "new_api": "PyUnicode_AsUTF8",
          "old_text": null,
          "new_text": "PyUnicode_AsUTF8(v)",
          "old_line_content": "\t} else if (vs == \"error\") {",
          "new_line_content": "\t  summary = PyUnicode_AsUTF8(v);",
          "content_same": false
        },
        {
          "line": 1337,
          "old_api": null,
          "new_api": "get_mds_perf_counters",
          "old_text": null,
          "new_text": "self->py_modules->get_mds_perf_counters(query_id)",
          "old_line_content": "static PyObject*",
          "new_line_content": "  return self->py_modules->get_mds_perf_counters(query_id);",
          "content_same": false
        },
        {
          "line": 315,
          "old_api": null,
          "new_api": "PyLong_Check",
          "old_text": null,
          "new_text": "PyLong_Check(v)",
          "old_line_content": "      } else if (ks == \"summary\") {",
          "new_line_content": "\tif (PyLong_Check(v)) {",
          "content_same": false
        },
        {
          "line": 1344,
          "old_api": null,
          "new_api": "PyArg_ParseTuple",
          "old_text": null,
          "new_text": "PyArg_ParseTuple(args, \"O:ceph_is_authorized\", &args_dict)",
          "old_line_content": "  }",
          "new_line_content": "  if (!PyArg_ParseTuple(args, \"O:ceph_is_authorized\", &args_dict)) {",
          "content_same": false
        },
        {
          "line": 323,
          "old_api": null,
          "new_api": "PyList_Check",
          "old_text": null,
          "new_text": "PyList_Check(v)",
          "old_line_content": "      } else if (ks == \"count\") {",
          "new_line_content": "\tif (!PyList_Check(v)) {",
          "content_same": false
        },
        {
          "line": 1348,
          "old_api": null,
          "new_api": "PyDict_Check",
          "old_text": null,
          "new_text": "PyDict_Check(args_dict)",
          "old_line_content": "",
          "new_line_content": "  if (!PyDict_Check(args_dict)) {",
          "content_same": false
        },
        {
          "line": 328,
          "old_api": null,
          "new_api": "PyList_Size",
          "old_text": null,
          "new_text": "PyList_Size(v)",
          "old_line_content": "\t       << \" count value not int\" << dendl;",
          "new_line_content": "\tfor (int k = 0; k < PyList_Size(v); ++k) {",
          "content_same": false
        },
        {
          "line": 329,
          "old_api": null,
          "new_api": "PyList_GET_ITEM",
          "old_text": null,
          "new_text": "PyList_GET_ITEM(v, k)",
          "old_line_content": "\t  continue;",
          "new_line_content": "\t  PyObject *di = PyList_GET_ITEM(v, k);",
          "content_same": false
        },
        {
          "line": 330,
          "old_api": null,
          "new_api": "PyUnicode_Check",
          "old_text": null,
          "new_text": "PyUnicode_Check(di)",
          "old_line_content": "\t}",
          "new_line_content": "\t  if (!PyUnicode_Check(di)) {",
          "content_same": false
        },
        {
          "line": 842,
          "old_api": null,
          "new_api": "PyArg_ParseTuple",
          "old_text": null,
          "new_text": "PyArg_ParseTuple(args, \"O:ceph_add_osd_perf_query\", &py_query)",
          "old_line_content": "    {\"bytes\", PerformanceCounterType::BYTES},",
          "new_line_content": "  if (!PyArg_ParseTuple(args, \"O:ceph_add_osd_perf_query\", &py_query)) {",
          "content_same": false
        },
        {
          "line": 1355,
          "old_api": null,
          "new_api": "PyDict_Items",
          "old_text": null,
          "new_text": "PyDict_Items(args_dict)",
          "old_line_content": "  }",
          "new_line_content": "  PyObject *args_list = PyDict_Items(args_dict);",
          "content_same": false
        },
        {
          "line": 1356,
          "old_api": null,
          "new_api": "PyList_Size",
          "old_text": null,
          "new_text": "PyList_Size(args_list)",
          "old_line_content": "",
          "new_line_content": "  for (int i = 0; i < PyList_Size(args_list); ++i) {",
          "content_same": false
        },
        {
          "line": 846,
          "old_api": null,
          "new_api": "PyDict_Check",
          "old_text": null,
          "new_text": "PyDict_Check(py_query)",
          "old_line_content": "    {\"write_latency\", PerformanceCounterType::WRITE_LATENCY},",
          "new_line_content": "  if (!PyDict_Check(py_query)) {",
          "content_same": false
        },
        {
          "line": 335,
          "old_api": null,
          "new_api": "PyUnicode_AsUTF8",
          "old_text": null,
          "new_text": "PyUnicode_AsUTF8(di)",
          "old_line_content": "\t  continue;",
          "new_line_content": "\t    detail.push_back(PyUnicode_AsUTF8(di));",
          "content_same": false
        },
        {
          "line": 1361,
          "old_api": null,
          "new_api": "PyArg_ParseTuple",
          "old_text": null,
          "new_text": "PyArg_ParseTuple(kv, \"ss:pair\", &arg_key, &arg_value)",
          "old_line_content": "",
          "new_line_content": "    if (!PyArg_ParseTuple(kv, \"ss:pair\", &arg_key, &arg_value)) {",
          "content_same": false
        },
        {
          "line": 343,
          "old_api": null,
          "new_api": "add",
          "old_text": null,
          "new_text": "out_checks.add(check_name, severity, summary, count)",
          "old_line_content": "\t  } else {",
          "new_line_content": "    auto& d = out_checks.add(check_name, severity, summary, count);",
          "content_same": false
        },
        {
          "line": 1369,
          "old_api": null,
          "new_api": "is_authorized",
          "old_text": null,
          "new_text": "without_gil([&] {\n    return self->this_module->is_authorized(arguments);\n  })",
          "old_line_content": "    char *arg_value = nullptr;",
          "new_line_content": "  bool r = without_gil([&] {",
          "content_same": false
        },
        {
          "line": 348,
          "old_api": null,
          "new_api": "get_name",
          "old_text": null,
          "new_text": "self->this_module->get_name()",
          "old_line_content": "\tderr << __func__ << \" check \" << check_name",
          "new_line_content": "  dout(10) << \"module \" << self->this_module->get_name()",
          "content_same": false
        },
        {
          "line": 350,
          "old_api": null,
          "new_api": "dump",
          "old_text": null,
          "new_text": "out_checks.dump(&jf)",
          "old_line_content": "      }",
          "new_line_content": "  out_checks.dump(&jf);",
          "content_same": false
        },
        {
          "line": 351,
          "old_api": null,
          "new_api": "flush",
          "old_text": null,
          "new_text": "jf.flush(*_dout)",
          "old_line_content": "    }",
          "new_line_content": "  jf.flush(*_dout);",
          "content_same": false
        },
        {
          "line": 354,
          "old_api": null,
          "new_api": "get_name",
          "old_text": null,
          "new_text": "self->this_module->get_name()",
          "old_line_content": "  }",
          "new_line_content": "    self->py_modules->set_health_checks(self->this_module->get_name(),",
          "content_same": false
        },
        {
          "line": 355,
          "old_api": null,
          "new_api": "std::move(out_checks)",
          "old_text": null,
          "new_text": "std::move(out_checks)",
          "old_line_content": "",
          "new_line_content": "\t\t\t\t\tstd::move(out_checks));",
          "content_same": false
        },
        {
          "line": 866,
          "old_api": null,
          "new_api": "PyList_Size",
          "old_text": null,
          "new_text": "PyList_Size(query_params)",
          "old_line_content": "  //     {'type': subkey_type, 'regex': regex_pattern},",
          "new_line_content": "  for (int i = 0; i < PyList_Size(query_params); ++i) {",
          "content_same": false
        },
        {
          "line": 867,
          "old_api": null,
          "new_api": "PyList_GET_ITEM",
          "old_text": null,
          "new_text": "PyList_GET_ITEM(query_params, i)",
          "old_line_content": "  //     ...",
          "new_line_content": "    PyObject *kv = PyList_GET_ITEM(query_params, i);",
          "content_same": false
        },
        {
          "line": 870,
          "old_api": null,
          "new_api": "PyArg_ParseTuple",
          "old_text": null,
          "new_text": "PyArg_ParseTuple(kv, \"sO:pair\", &query_param_name, &query_param_val)",
          "old_line_content": "  //     list, of, descriptor, types",
          "new_line_content": "    if (!PyArg_ParseTuple(kv, \"sO:pair\", &query_param_name, &query_param_val)) {",
          "content_same": false
        },
        {
          "line": 1385,
          "old_api": null,
          "new_api": "PyArg_ParseTuple",
          "old_text": null,
          "new_text": "PyArg_ParseTuple(args, \"zsp:ceph_register_client\", &_name, &addrs, &replace)",
          "old_line_content": "  Py_RETURN_FALSE;",
          "new_line_content": "  if (!PyArg_ParseTuple(args, \"zsp:ceph_register_client\", &_name, &addrs, &replace)) {",
          "content_same": false
        },
        {
          "line": 1388,
          "old_api": null,
          "new_api": "get_name",
          "old_text": null,
          "new_text": "self->this_module->get_name()",
          "old_line_content": "static PyObject*",
          "new_line_content": "  auto name = _name ? std::string(_name) : std::string(self->this_module->get_name());",
          "content_same": false
        },
        {
          "line": 365,
          "old_api": null,
          "new_api": "PyArg_ParseTuple",
          "old_text": null,
          "new_text": "PyArg_ParseTuple(args, \"s:ceph_state_get\", &what)",
          "old_line_content": "  });",
          "new_line_content": "  if (!PyArg_ParseTuple(args, \"s:ceph_state_get\", &what)) {",
          "content_same": false
        },
        {
          "line": 1389,
          "old_api": null,
          "new_api": "register_client",
          "old_text": null,
          "new_text": "without_gil([&] {\n    self->py_modules->register_client(name, addrs, replace);\n  })",
          "old_line_content": "ceph_register_client(BaseMgrModule *self, PyObject *args)",
          "new_line_content": "  without_gil([&] {",
          "content_same": false
        },
        {
          "line": 1390,
          "old_api": null,
          "new_api": "register_client",
          "old_text": null,
          "new_text": "self->py_modules->register_client(name, addrs, replace)",
          "old_line_content": "{",
          "new_line_content": "    self->py_modules->register_client(name, addrs, replace);",
          "content_same": false
        },
        {
          "line": 880,
          "old_api": null,
          "new_api": "PyList_GET_ITEM",
          "old_text": null,
          "new_text": "PyList_GET_ITEM(query_param_val, j)",
          "old_line_content": "      derr << __func__ << \" dict item \" << i << \" not a size 2 tuple\" << dendl;",
          "new_line_content": "        PyObject *sub_key = PyList_GET_ITEM(query_param_val, j);",
          "content_same": false
        },
        {
          "line": 369,
          "old_api": null,
          "new_api": "cacheable_get_python",
          "old_text": null,
          "new_text": "self->py_modules->cacheable_get_python(what)",
          "old_line_content": "",
          "new_line_content": "  return self->py_modules->cacheable_get_python(what);",
          "content_same": false
        },
        {
          "line": 881,
          "old_api": null,
          "new_api": "PyDict_Check",
          "old_text": null,
          "new_text": "PyDict_Check(sub_key)",
          "old_line_content": "      Py_RETURN_NONE;",
          "new_line_content": "        if (!PyDict_Check(sub_key)) {",
          "content_same": false
        },
        {
          "line": 887,
          "old_api": null,
          "new_api": "PyDict_Items",
          "old_text": null,
          "new_text": "PyDict_Items(sub_key)",
          "old_line_content": "      }",
          "new_line_content": "        PyObject *sub_key_params = PyDict_Items(sub_key);",
          "content_same": false
        },
        {
          "line": 1400,
          "old_api": null,
          "new_api": "PyArg_ParseTuple",
          "old_text": null,
          "new_text": "PyArg_ParseTuple(args, \"zs:ceph_unregister_client\", &_name, &addrs)",
          "old_line_content": "  });",
          "new_line_content": "  if (!PyArg_ParseTuple(args, \"zs:ceph_unregister_client\", &_name, &addrs)) {",
          "content_same": false
        },
        {
          "line": 377,
          "old_api": null,
          "new_api": "PyArg_ParseTuple",
          "old_text": null,
          "new_text": "PyArg_ParseTuple(args, \"z:ceph_get_server\", &hostname)",
          "old_line_content": "",
          "new_line_content": "  if (!PyArg_ParseTuple(args, \"z:ceph_get_server\", &hostname)) {",
          "content_same": false
        },
        {
          "line": 1403,
          "old_api": null,
          "new_api": "get_name",
          "old_text": null,
          "new_text": "self->this_module->get_name()",
          "old_line_content": "",
          "new_line_content": "  auto name = _name ? std::string(_name) : std::string(self->this_module->get_name());",
          "content_same": false
        },
        {
          "line": 1404,
          "old_api": null,
          "new_api": "unregister_client",
          "old_text": null,
          "new_text": "without_gil([&] {\n    self->py_modules->unregister_client(name, addrs);\n  })",
          "old_line_content": "static PyObject*",
          "new_line_content": "  without_gil([&] {",
          "content_same": false
        },
        {
          "line": 1405,
          "old_api": null,
          "new_api": "unregister_client",
          "old_text": null,
          "new_text": "self->py_modules->unregister_client(name, addrs)",
          "old_line_content": "ceph_unregister_client(BaseMgrModule *self, PyObject *args)",
          "new_line_content": "    self->py_modules->unregister_client(name, addrs);",
          "content_same": false
        },
        {
          "line": 382,
          "old_api": null,
          "new_api": "get_server_python",
          "old_text": null,
          "new_text": "self->py_modules->get_server_python(hostname)",
          "old_line_content": "static PyObject*",
          "new_line_content": "    return self->py_modules->get_server_python(hostname);",
          "content_same": false
        },
        {
          "line": 384,
          "old_api": null,
          "new_api": "list_servers_python",
          "old_text": null,
          "new_text": "self->py_modules->list_servers_python()",
          "old_line_content": "{",
          "new_line_content": "    return self->py_modules->list_servers_python();",
          "content_same": false
        },
        {
          "line": 903,
          "old_api": null,
          "new_api": "PyUnicode_Check",
          "old_text": null,
          "new_text": "PyUnicode_Check(param_value)",
          "old_line_content": "          }",
          "new_line_content": "            if (!PyUnicode_Check(param_value)) {",
          "content_same": false
        },
        {
          "line": 908,
          "old_api": null,
          "new_api": "PyUnicode_AsUTF8",
          "old_text": null,
          "new_text": "PyUnicode_AsUTF8(param_value)",
          "old_line_content": "                 << \" pair \" << k << \" not a size 2 tuple\" << dendl;",
          "new_line_content": "            auto type = PyUnicode_AsUTF8(param_value);",
          "content_same": false
        },
        {
          "line": 909,
          "old_api": null,
          "new_api": "find",
          "old_text": null,
          "new_text": "sub_key_types.find(type)",
          "old_line_content": "            Py_RETURN_NONE;",
          "new_line_content": "            auto it = sub_key_types.find(type);",
          "content_same": false
        },
        {
          "line": 398,
          "old_api": null,
          "new_api": "PyArg_ParseTuple",
          "old_text": null,
          "new_text": "PyArg_ParseTuple(args, \"s:ceph_option_get\", &what)",
          "old_line_content": "ceph_get_mgr_id(BaseMgrModule *self, PyObject *args)",
          "new_line_content": "  if (!PyArg_ParseTuple(args, \"s:ceph_option_get\", &what)) {",
          "content_same": false
        },
        {
          "line": 910,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "sub_key_types.end()",
          "old_line_content": "          }",
          "new_line_content": "            if (it == sub_key_types.end()) {",
          "content_same": false
        },
        {
          "line": 403,
          "old_api": null,
          "new_api": "string",
          "old_text": null,
          "new_text": "string(what)",
          "old_line_content": "static PyObject*",
          "new_line_content": "  const Option *opt = g_conf().find_option(string(what));",
          "content_same": false
        },
        {
          "line": 406,
          "old_api": null,
          "new_api": "string",
          "old_text": null,
          "new_text": "string(what)",
          "old_line_content": "  char *what = nullptr;",
          "new_line_content": "    switch (int r = g_conf().get_val(string(what), &value); r) {",
          "content_same": false
        },
        {
          "line": 408,
          "old_api": null,
          "new_api": "PyErr_NoMemory",
          "old_text": null,
          "new_text": "PyErr_NoMemory()",
          "old_line_content": "    derr << \"Invalid args!\" << dendl;",
          "new_line_content": "      PyErr_NoMemory();",
          "content_same": false
        },
        {
          "line": 922,
          "old_api": null,
          "new_api": "PyUnicode_AsUTF8",
          "old_text": null,
          "new_text": "PyUnicode_AsUTF8(param_value)",
          "old_line_content": "              Py_RETURN_NONE;",
          "new_line_content": "            d.regex_str = PyUnicode_AsUTF8(param_value);",
          "content_same": false
        },
        {
          "line": 411,
          "old_api": null,
          "new_api": "PyErr_SetString",
          "old_text": null,
          "new_text": "PyErr_SetString(PyExc_ValueError, \"value too long\")",
          "old_line_content": "",
          "new_line_content": "      PyErr_SetString(PyExc_ValueError, \"value too long\");",
          "content_same": false
        },
        {
          "line": 924,
          "old_api": null,
          "new_api": "c_str",
          "old_text": null,
          "new_text": "d.regex_str.c_str()",
          "old_line_content": "            d.type = it->second;",
          "new_line_content": "              d.regex = d.regex_str.c_str();",
          "content_same": false
        },
        {
          "line": 414,
          "old_api": null,
          "new_api": "ceph_assert",
          "old_text": null,
          "new_text": "ceph_assert(r == 0)",
          "old_line_content": "    std::string value;",
          "new_line_content": "      ceph_assert(r == 0);",
          "content_same": false
        },
        {
          "line": 418,
          "old_api": null,
          "new_api": "get_python_typed_option_value",
          "old_text": null,
          "new_text": "get_python_typed_option_value(opt->type, value)",
          "old_line_content": "      return nullptr;",
          "new_line_content": "    return get_python_typed_option_value(opt->type, value);",
          "content_same": false
        },
        {
          "line": 930,
          "old_api": null,
          "new_api": "mark_count",
          "old_text": null,
          "new_text": "d.regex.mark_count()",
          "old_line_content": "            }",
          "new_line_content": "            if (d.regex.mark_count() == 0) {",
          "content_same": false
        },
        {
          "line": 421,
          "old_api": null,
          "new_api": "PyErr_Format",
          "old_text": null,
          "new_text": "PyErr_Format(PyExc_KeyError, \"option not found: %s\", what)",
          "old_line_content": "      return nullptr;",
          "new_line_content": "    PyErr_Format(PyExc_KeyError, \"option not found: %s\", what);",
          "content_same": false
        },
        {
          "line": 942,
          "old_api": null,
          "new_api": "static_cast<OSDPerfMetricSubKeyType>(-1)",
          "old_text": null,
          "new_text": "static_cast<OSDPerfMetricSubKeyType>(-1)",
          "old_line_content": "                   << dendl;",
          "new_line_content": "        if (d.type == static_cast<OSDPerfMetricSubKeyType>(-1) ||",
          "content_same": false
        },
        {
          "line": 431,
          "old_api": null,
          "new_api": "PyArg_ParseTuple",
          "old_text": null,
          "new_text": "PyArg_ParseTuple(args, \"ss:ceph_foreign_option_get\", &who, &what)",
          "old_line_content": "    return nullptr;",
          "new_line_content": "  if (!PyArg_ParseTuple(args, \"ss:ceph_foreign_option_get\", &who, &what)) {",
          "content_same": false
        },
        {
          "line": 943,
          "old_api": null,
          "new_api": "empty",
          "old_text": null,
          "new_text": "d.regex_str.empty()",
          "old_line_content": "              Py_RETURN_NONE;",
          "new_line_content": "            d.regex_str.empty()) {",
          "content_same": false
        },
        {
          "line": 435,
          "old_api": null,
          "new_api": "get_foreign_config",
          "old_text": null,
          "new_text": "self->py_modules->get_foreign_config(who, what)",
          "old_line_content": "static PyObject*",
          "new_line_content": "  return self->py_modules->get_foreign_config(who, what);",
          "content_same": false
        },
        {
          "line": 948,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "query.key_descriptor.push_back(d)",
          "old_line_content": "            Py_RETURN_NONE;",
          "new_line_content": "        query.key_descriptor.push_back(d);",
          "content_same": false
        },
        {
          "line": 955,
          "old_api": null,
          "new_api": "PyList_Size",
          "old_text": null,
          "new_text": "PyList_Size(query_param_val)",
          "old_line_content": "          Py_RETURN_NONE;",
          "new_line_content": "      for (int j = 0; j < PyList_Size(query_param_val); j++) {",
          "content_same": false
        },
        {
          "line": 956,
          "old_api": null,
          "new_api": "PyList_GET_ITEM",
          "old_text": null,
          "new_text": "PyList_GET_ITEM(query_param_val, j)",
          "old_line_content": "        }",
          "new_line_content": "        PyObject *py_type = PyList_GET_ITEM(query_param_val, j);",
          "content_same": false
        },
        {
          "line": 962,
          "old_api": null,
          "new_api": "PyUnicode_AsUTF8",
          "old_text": null,
          "new_text": "PyUnicode_AsUTF8(py_type)",
          "old_line_content": "        Py_RETURN_NONE;",
          "new_line_content": "        auto type = PyUnicode_AsUTF8(py_type);",
          "content_same": false
        },
        {
          "line": 963,
          "old_api": null,
          "new_api": "find",
          "old_text": null,
          "new_text": "counter_types.find(type)",
          "old_line_content": "      }",
          "new_line_content": "        auto it = counter_types.find(type);",
          "content_same": false
        },
        {
          "line": 454,
          "old_api": null,
          "new_api": "get_typed_config",
          "old_text": null,
          "new_text": "self->py_modules->get_typed_config(module, key, str_prefix)",
          "old_line_content": "\t\t\t&prefix)) {",
          "new_line_content": "  auto pResult = self->py_modules->get_typed_config(module, key, str_prefix);",
          "content_same": false
        },
        {
          "line": 969,
          "old_api": null,
          "new_api": "push_back",
          "old_text": null,
          "new_text": "query.performance_counter_descriptors.push_back(it->second)",
          "old_line_content": "          Py_RETURN_NONE;",
          "new_line_content": "        query.performance_counter_descriptors.push_back(it->second);",
          "content_same": false
        },
        {
          "line": 467,
          "old_api": null,
          "new_api": "get_name",
          "old_text": null,
          "new_text": "self->this_module->get_name()",
          "old_line_content": "static PyObject*",
          "new_line_content": "  return self->py_modules->get_store_prefix(self->this_module->get_name(),",
          "content_same": false
        },
        {
          "line": 979,
          "old_api": null,
          "new_api": "PyDict_Items",
          "old_text": null,
          "new_text": "PyDict_Items(query_param_val)",
          "old_line_content": "      }",
          "new_line_content": "      PyObject *limit_params = PyDict_Items(query_param_val);",
          "content_same": false
        },
        {
          "line": 982,
          "old_api": null,
          "new_api": "PyList_GET_ITEM",
          "old_text": null,
          "new_text": "PyList_GET_ITEM(limit_params, j)",
          "old_line_content": "        derr << __func__ << \" query \" << query_param_name << \" not a dict\"",
          "new_line_content": "        PyObject *kv = PyList_GET_ITEM(limit_params, j);",
          "content_same": false
        },
        {
          "line": 985,
          "old_api": null,
          "new_api": "PyArg_ParseTuple",
          "old_text": null,
          "new_text": "PyArg_ParseTuple(kv, \"sO:pair\", &limit_param_name,\n                              &limit_param_val)",
          "old_line_content": "      }",
          "new_line_content": "        if (!PyArg_ParseTuple(kv, \"sO:pair\", &limit_param_name,",
          "content_same": false
        },
        {
          "line": 477,
          "old_api": null,
          "new_api": "PyArg_ParseTuple",
          "old_text": null,
          "new_text": "PyArg_ParseTuple(args, \"ssz:ceph_set_module_option\",\n        &module, &key, &value)",
          "old_line_content": "      prefix);",
          "new_line_content": "  if (!PyArg_ParseTuple(args, \"ssz:ceph_set_module_option\",",
          "content_same": false
        },
        {
          "line": 993,
          "old_api": null,
          "new_api": "PyUnicode_Check",
          "old_text": null,
          "new_text": "PyUnicode_Check(limit_param_val)",
          "old_line_content": "        PyObject *limit_param_val = nullptr;",
          "new_line_content": "          if (!PyUnicode_Check(limit_param_val)) {",
          "content_same": false
        },
        {
          "line": 998,
          "old_api": null,
          "new_api": "PyUnicode_AsUTF8",
          "old_text": null,
          "new_text": "PyUnicode_AsUTF8(limit_param_val)",
          "old_line_content": "          Py_RETURN_NONE;",
          "new_line_content": "          auto order_by = PyUnicode_AsUTF8(limit_param_val);",
          "content_same": false
        },
        {
          "line": 487,
          "old_api": null,
          "new_api": "set_config",
          "old_text": null,
          "new_text": "self->py_modules->set_config(module, key, val)",
          "old_line_content": "        &module, &key, &value)) {",
          "new_line_content": "    return self->py_modules->set_config(module, key, val);",
          "content_same": false
        },
        {
          "line": 999,
          "old_api": null,
          "new_api": "find",
          "old_text": null,
          "new_text": "counter_types.find(order_by)",
          "old_line_content": "        }",
          "new_line_content": "          auto it = counter_types.find(order_by);",
          "content_same": false
        },
        {
          "line": 1000,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "counter_types.end()",
          "old_line_content": "",
          "new_line_content": "          if (it == counter_types.end()) {",
          "content_same": false
        },
        {
          "line": 490,
          "old_api": null,
          "new_api": "c_str",
          "old_text": null,
          "new_text": "msg.c_str()",
          "old_line_content": "  }",
          "new_line_content": "    PyErr_SetString(PyExc_ValueError, msg.c_str());",
          "content_same": false
        },
        {
          "line": 500,
          "old_api": null,
          "new_api": "PyArg_ParseTuple",
          "old_text": null,
          "new_text": "PyArg_ParseTuple(args, \"s:ceph_store_get\", &what)",
          "old_line_content": "    return nullptr;",
          "new_line_content": "  if (!PyArg_ParseTuple(args, \"s:ceph_store_get\", &what)) {",
          "content_same": false
        },
        {
          "line": 1012,
          "old_api": null,
          "new_api": "PyLong_AsLong",
          "old_text": null,
          "new_text": "PyLong_AsLong(limit_param_val)",
          "old_line_content": "            Py_RETURN_NONE;",
          "new_line_content": "          limit->max_count = PyLong_AsLong(limit_param_val);",
          "content_same": false
        },
        {
          "line": 506,
          "old_api": null,
          "new_api": "get_name",
          "old_text": null,
          "new_text": "self->this_module->get_name()",
          "old_line_content": "ceph_store_get(BaseMgrModule *self, PyObject *args)",
          "new_line_content": "  bool found = self->py_modules->get_store(self->this_module->get_name(),",
          "content_same": false
        },
        {
          "line": 510,
          "old_api": null,
          "new_api": "c_str",
          "old_text": null,
          "new_text": "value.c_str()",
          "old_line_content": "    derr << \"Invalid args!\" << dendl;",
          "new_line_content": "    return PyUnicode_FromString(value.c_str());",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 515,
          "old_api": "get_name",
          "new_api": null,
          "old_text": "self->this_module->get_name()",
          "new_text": null,
          "old_line_content": "  bool found = self->py_modules->get_store(self->this_module->get_name(),",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 518,
          "old_api": "c_str",
          "new_api": null,
          "old_text": "value.c_str()",
          "new_text": null,
          "old_line_content": "    dout(10) << \"ceph_store_get \" << what << \" found: \" << value.c_str() << dendl;",
          "new_line_content": "ceph_store_set(BaseMgrModule *self, PyObject *args)",
          "content_same": false
        },
        {
          "line": 519,
          "old_api": "c_str",
          "new_api": null,
          "old_text": "value.c_str()",
          "new_text": null,
          "old_line_content": "    return PyUnicode_FromString(value.c_str());",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 521,
          "old_api": "dout",
          "new_api": null,
          "old_text": "dout(4)",
          "new_text": null,
          "old_line_content": "    dout(4) << \"ceph_store_get \" << what << \" not found \" << dendl;",
          "new_line_content": "  char *value = nullptr;",
          "content_same": false
        },
        {
          "line": 1034,
          "old_api": "empty",
          "new_api": null,
          "old_text": "query.key_descriptor.empty()",
          "new_text": null,
          "old_line_content": "  if (query.key_descriptor.empty() ||",
          "new_line_content": "      derr << __func__ << \" limit order_by \" << limit->order_by",
          "content_same": false
        },
        {
          "line": 1035,
          "old_api": "empty",
          "new_api": null,
          "old_text": "query.performance_counter_descriptors.empty()",
          "new_text": null,
          "old_line_content": "      query.performance_counter_descriptors.empty()) {",
          "new_line_content": "           << \" not in performance_counter_descriptors\" << dendl;",
          "content_same": false
        },
        {
          "line": 1042,
          "old_api": "end",
          "new_api": null,
          "old_text": "ds.end()",
          "new_text": null,
          "old_line_content": "    if (std::find(ds.begin(), ds.end(), limit->order_by) == ds.end()) {",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 531,
          "old_api": "PyArg_ParseTuple",
          "new_api": null,
          "old_text": "PyArg_ParseTuple(args, \"sz:ceph_store_set\", &key, &value)",
          "new_text": null,
          "old_line_content": "  if (!PyArg_ParseTuple(args, \"sz:ceph_store_set\", &key, &value)) {",
          "new_line_content": "  });",
          "content_same": false
        },
        {
          "line": 1049,
          "old_api": "add_osd_perf_query",
          "new_api": null,
          "old_text": "self->py_modules->add_osd_perf_query(query, limit)",
          "new_text": null,
          "old_line_content": "  auto query_id = self->py_modules->add_osd_perf_query(query, limit);",
          "new_line_content": "    derr << \"Invalid args!\" << dendl;",
          "content_same": false
        },
        {
          "line": 538,
          "old_api": "set_store",
          "new_api": null,
          "old_text": "without_gil([&] {\n    self->py_modules->set_store(self->this_module->get_name(), key, val);\n  })",
          "new_text": null,
          "old_line_content": "  without_gil([&] {",
          "new_line_content": "  char *svc_name = NULL;",
          "content_same": false
        },
        {
          "line": 539,
          "old_api": "get_name",
          "new_api": null,
          "old_text": "self->this_module->get_name()",
          "new_text": null,
          "old_line_content": "    self->py_modules->set_store(self->this_module->get_name(), key, val);",
          "new_line_content": "  char *svc_id = NULL;",
          "content_same": false
        },
        {
          "line": 1050,
          "old_api": "PyLong_FromLong",
          "new_api": null,
          "old_text": "PyLong_FromLong(query_id)",
          "new_text": null,
          "old_line_content": "  return PyLong_FromLong(query_id);",
          "new_line_content": "    return nullptr;",
          "content_same": false
        },
        {
          "line": 1566,
          "old_api": "tp_alloc",
          "new_api": null,
          "old_text": "type->tp_alloc(type, 0)",
          "new_text": null,
          "old_line_content": "    self = (BaseMgrModule *)type->tp_alloc(type, 0);",
          "new_line_content": "    PyObject *this_module_capsule = nullptr;",
          "content_same": false
        },
        {
          "line": 1057,
          "old_api": "PyArg_ParseTuple",
          "new_api": null,
          "old_text": "PyArg_ParseTuple(args, \"i:ceph_remove_osd_perf_query\", &query_id)",
          "new_text": null,
          "old_line_content": "  if (!PyArg_ParseTuple(args, \"i:ceph_remove_osd_perf_query\", &query_id)) {",
          "new_line_content": "static PyObject*",
          "content_same": false
        },
        {
          "line": 549,
          "old_api": "PyArg_ParseTuple",
          "new_api": null,
          "old_text": "PyArg_ParseTuple(args, \"ss:get_metadata\", &svc_name, &svc_id)",
          "new_text": null,
          "old_line_content": "  if (!PyArg_ParseTuple(args, \"ss:get_metadata\", &svc_name, &svc_id)) {",
          "new_line_content": "  char *svc_name = NULL;",
          "content_same": false
        },
        {
          "line": 1062,
          "old_api": "remove_osd_perf_query",
          "new_api": null,
          "old_text": "self->py_modules->remove_osd_perf_query(query_id)",
          "new_text": null,
          "old_line_content": "  self->py_modules->remove_osd_perf_query(query_id);",
          "new_line_content": "    derr << \"Invalid args!\" << dendl;",
          "content_same": false
        },
        {
          "line": 552,
          "old_api": "get_metadata_python",
          "new_api": null,
          "old_text": "self->py_modules->get_metadata_python(svc_name, svc_id)",
          "new_text": null,
          "old_line_content": "  return self->py_modules->get_metadata_python(svc_name, svc_id);",
          "new_line_content": "\t\t\t&svc_id)) {",
          "content_same": false
        },
        {
          "line": 1070,
          "old_api": "PyArg_ParseTuple",
          "new_api": null,
          "old_text": "PyArg_ParseTuple(args, \"i:ceph_get_osd_perf_counters\", &query_id)",
          "new_text": null,
          "old_line_content": "  if (!PyArg_ParseTuple(args, \"i:ceph_get_osd_perf_counters\", &query_id)) {",
          "new_line_content": "// style",
          "content_same": false
        },
        {
          "line": 560,
          "old_api": "PyArg_ParseTuple",
          "new_api": null,
          "old_text": "PyArg_ParseTuple(args, \"ss:get_daemon_status\", &svc_name,\n\t\t\t&svc_id)",
          "new_text": null,
          "old_line_content": "  if (!PyArg_ParseTuple(args, \"ss:get_daemon_status\", &svc_name,",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 1585,
          "old_api": "PyCapsule_GetPointer",
          "new_api": null,
          "old_text": "PyCapsule_GetPointer(\n        py_modules_capsule, nullptr)",
          "new_text": null,
          "old_line_content": "    self->py_modules = static_cast<ActivePyModules*>(PyCapsule_GetPointer(",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1075,
          "old_api": "get_osd_perf_counters",
          "new_api": null,
          "old_text": "self->py_modules->get_osd_perf_counters(query_id)",
          "new_text": null,
          "old_line_content": "  return self->py_modules->get_osd_perf_counters(query_id);",
          "new_line_content": "  static const std::string NAME_KEY_DESCRIPTOR = \"key_descriptor\";",
          "content_same": false
        },
        {
          "line": 564,
          "old_api": "get_daemon_status_python",
          "new_api": null,
          "old_text": "self->py_modules->get_daemon_status_python(svc_name, svc_id)",
          "new_text": null,
          "old_line_content": "  return self->py_modules->get_daemon_status_python(svc_name, svc_id);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 1587,
          "old_api": "ceph_assert",
          "new_api": null,
          "old_text": "ceph_assert(self->py_modules)",
          "new_text": null,
          "old_line_content": "    ceph_assert(self->py_modules);",
          "new_line_content": "  PyVarObject_HEAD_INIT(NULL, 0)",
          "content_same": false
        },
        {
          "line": 1588,
          "old_api": "PyCapsule_GetPointer",
          "new_api": null,
          "old_text": "PyCapsule_GetPointer(\n        this_module_capsule, nullptr)",
          "new_text": null,
          "old_line_content": "    self->this_module = static_cast<ActivePyModule*>(PyCapsule_GetPointer(",
          "new_line_content": "  \"ceph_module.BaseMgrModule\", /* tp_name */",
          "content_same": false
        },
        {
          "line": 1590,
          "old_api": "ceph_assert",
          "new_api": null,
          "old_text": "ceph_assert(self->this_module)",
          "new_text": null,
          "old_line_content": "    ceph_assert(self->this_module);",
          "new_line_content": "  0,                         /* tp_itemsize */",
          "content_same": false
        },
        {
          "line": 571,
          "old_api": "PyArg_ParseTuple",
          "new_api": null,
          "old_text": "PyArg_ParseTuple(args, \"s:log\", &record)",
          "new_text": null,
          "old_line_content": "  if (!PyArg_ParseTuple(args, \"s:log\", &record)) {",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 575,
          "old_api": "ceph_assert",
          "new_api": null,
          "old_text": "ceph_assert(self->this_module)",
          "new_text": null,
          "old_line_content": "  ceph_assert(self->this_module);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 577,
          "old_api": "log",
          "new_api": null,
          "old_text": "self->this_module->log(record)",
          "new_text": null,
          "old_line_content": "  self->this_module->log(record);",
          "new_line_content": "  char *channel = nullptr;",
          "content_same": false
        },
        {
          "line": 589,
          "old_api": "PyArg_ParseTuple",
          "new_api": null,
          "old_text": "PyArg_ParseTuple(args, \"sis:ceph_cluster_log\", &channel, &prio, &message)",
          "new_text": null,
          "old_line_content": "  if (!PyArg_ParseTuple(args, \"sis:ceph_cluster_log\", &channel, &prio, &message)) {",
          "new_line_content": "static PyObject *",
          "content_same": false
        },
        {
          "line": 593,
          "old_api": "cluster_log",
          "new_api": null,
          "old_text": "self->py_modules->cluster_log(channel, (clog_type)prio, message)",
          "new_text": null,
          "old_line_content": "    self->py_modules->cluster_log(channel, (clog_type)prio, message);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 601,
          "old_api": "c_str",
          "new_api": null,
          "old_text": "pretty_version_to_str().c_str()",
          "new_text": null,
          "old_line_content": "  return PyUnicode_FromString(pretty_version_to_str().c_str());",
          "new_line_content": "static PyObject *",
          "content_same": false
        },
        {
          "line": 607,
          "old_api": "get_conf_path",
          "new_api": null,
          "old_text": "g_conf().get_conf_path().c_str()",
          "new_text": null,
          "old_line_content": "  return PyUnicode_FromString(g_conf().get_conf_path().c_str());",
          "new_line_content": "static PyObject *",
          "content_same": false
        },
        {
          "line": 96,
          "old_api": "PyLong_FromLong",
          "new_api": null,
          "old_text": "PyLong_FromLong(r)",
          "new_text": null,
          "old_line_content": "      auto pyR = PyLong_FromLong(r);",
          "new_line_content": "      if (rtn == nullptr) {",
          "content_same": false
        },
        {
          "line": 1120,
          "old_api": "PyDict_Check",
          "new_api": null,
          "old_text": "PyDict_Check(py_query)",
          "new_text": null,
          "old_line_content": "  if (!PyDict_Check(py_query)) {",
          "new_line_content": "  // {",
          "content_same": false
        },
        {
          "line": 98,
          "old_api": "c_str",
          "new_api": null,
          "old_text": "outs.c_str()",
          "new_text": null,
          "old_line_content": "      auto pyOutS = PyUnicode_FromString(outs.c_str());",
          "new_line_content": "      } else {",
          "content_same": false
        },
        {
          "line": 100,
          "old_api": "Py_DECREF",
          "new_api": null,
          "old_text": "Py_DECREF(pyR)",
          "new_text": null,
          "old_line_content": "      Py_DECREF(pyR);",
          "new_line_content": "      }",
          "content_same": false
        },
        {
          "line": 613,
          "old_api": "ceph_release_to_str",
          "new_api": null,
          "old_text": "ceph_release_to_str()",
          "new_text": null,
          "old_line_content": "  return PyUnicode_FromString(ceph_release_to_str());",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 1125,
          "old_api": "PyDict_Items",
          "new_api": null,
          "old_text": "PyDict_Items(py_query)",
          "new_text": null,
          "old_line_content": "  PyObject *query_params = PyDict_Items(py_query);",
          "new_line_content": "  //   'performance_counter_descriptors': [",
          "content_same": false
        },
        {
          "line": 104,
          "old_api": "PyObject_CallObject",
          "new_api": null,
          "old_text": "PyObject_CallObject(set_fn, args)",
          "new_text": null,
          "old_line_content": "      auto rtn = PyObject_CallObject(set_fn, args);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 106,
          "old_api": "Py_DECREF",
          "new_api": null,
          "old_text": "Py_DECREF(rtn)",
          "new_text": null,
          "old_line_content": "\tPy_DECREF(rtn);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 108,
          "old_api": "Py_DECREF",
          "new_api": null,
          "old_text": "Py_DECREF(args)",
          "new_text": null,
          "old_line_content": "      Py_DECREF(args);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 109,
          "old_api": "Py_DECREF",
          "new_api": null,
          "old_text": "Py_DECREF(set_fn)",
          "new_text": null,
          "old_line_content": "      Py_DECREF(set_fn);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 111,
          "old_api": "Py_DECREF",
          "new_api": null,
          "old_text": "Py_DECREF(python_completion)",
          "new_text": null,
          "old_line_content": "      Py_DECREF(python_completion);",
          "new_line_content": "ceph_send_command(BaseMgrModule *self, PyObject *args)",
          "content_same": false
        },
        {
          "line": 623,
          "old_api": "ceph_release_name",
          "new_api": null,
          "old_text": "ceph_release_name(major)",
          "new_text": null,
          "old_line_content": "  return PyUnicode_FromString(ceph_release_name(major));",
          "new_line_content": "static PyObject*",
          "content_same": false
        },
        {
          "line": 114,
          "old_api": "notify_all",
          "new_api": null,
          "old_text": "py_modules->notify_all(\"command\", tag)",
          "new_text": null,
          "old_line_content": "    py_modules->notify_all(\"command\", tag);",
          "new_line_content": "  char *type = nullptr;",
          "content_same": false
        },
        {
          "line": 1141,
          "old_api": "PyList_GET_ITEM",
          "new_api": null,
          "old_text": "PyList_GET_ITEM(query_params, i)",
          "new_text": null,
          "old_line_content": "    PyObject *kv = PyList_GET_ITEM(query_params, i);",
          "new_line_content": "        derr << __func__ << \" \" << query_param_name << \" not a list\" << dendl;",
          "content_same": false
        },
        {
          "line": 1149,
          "old_api": "PyList_Check",
          "new_api": null,
          "old_text": "PyList_Check(query_param_val)",
          "new_text": null,
          "old_line_content": "      if (!PyList_Check(query_param_val)) {",
          "new_line_content": "          Py_RETURN_NONE;",
          "content_same": false
        },
        {
          "line": 638,
          "old_api": "PyArg_ParseTuple",
          "new_api": null,
          "old_text": "PyArg_ParseTuple(args, \"sss:get_counter\", &svc_name,\n                                                  &svc_id, &counter_path)",
          "new_text": null,
          "old_line_content": "  if (!PyArg_ParseTuple(args, \"sss:get_counter\", &svc_name,",
          "new_line_content": "get_latest_counter(BaseMgrModule *self, PyObject *args)",
          "content_same": false
        },
        {
          "line": 642,
          "old_api": "get_counter_python",
          "new_api": null,
          "old_text": "self->py_modules->get_counter_python(\n      svc_name, svc_id, counter_path)",
          "new_text": null,
          "old_line_content": "  return self->py_modules->get_counter_python(",
          "new_line_content": "  char *counter_path = nullptr;",
          "content_same": false
        },
        {
          "line": 1161,
          "old_api": "PyDict_Items",
          "new_api": null,
          "old_text": "PyDict_Items(sub_key)",
          "new_text": null,
          "old_line_content": "        PyObject *sub_key_params = PyDict_Items(sub_key);",
          "new_line_content": "          PyObject *param_value = nullptr;",
          "content_same": false
        },
        {
          "line": 1163,
          "old_api": "PyList_GET_ITEM",
          "new_api": null,
          "old_text": "PyList_GET_ITEM(sub_key_params, k)",
          "new_text": null,
          "old_line_content": "          PyObject *pair = PyList_GET_ITEM(sub_key_params, k);",
          "new_line_content": "            derr << __func__ << \" query \" << query_param_name << \" item \" << j",
          "content_same": false
        },
        {
          "line": 652,
          "old_api": "PyArg_ParseTuple",
          "new_api": null,
          "old_text": "PyArg_ParseTuple(args, \"sss:get_counter\", &svc_name,\n                                                  &svc_id, &counter_path)",
          "new_text": null,
          "old_line_content": "  if (!PyArg_ParseTuple(args, \"sss:get_counter\", &svc_name,",
          "new_line_content": "get_perf_schema(BaseMgrModule *self, PyObject *args)",
          "content_same": false
        },
        {
          "line": 1164,
          "old_api": "PyTuple_Check",
          "new_api": null,
          "old_text": "PyTuple_Check(pair)",
          "new_text": null,
          "old_line_content": "          if (!PyTuple_Check(pair)) {",
          "new_line_content": "                 << \" pair \" << k << \" not a size 2 tuple\" << dendl;",
          "content_same": false
        },
        {
          "line": 1171,
          "old_api": "PyArg_ParseTuple",
          "new_api": null,
          "old_text": "PyArg_ParseTuple(pair, \"sO:pair\", &param_name, &param_value)",
          "new_text": null,
          "old_line_content": "          if (!PyArg_ParseTuple(pair, \"sO:pair\", &param_name, &param_value)) {",
          "new_line_content": "              Py_RETURN_NONE;",
          "content_same": false
        },
        {
          "line": 150,
          "old_api": "Py_DECREF",
          "new_api": null,
          "old_text": "Py_DECREF(set_fn)",
          "new_text": null,
          "old_line_content": "  Py_DECREF(set_fn);",
          "new_line_content": "    // Wait for the latest OSDMap after each command we send to",
          "content_same": false
        },
        {
          "line": 153,
          "old_api": "PyThreadState_Get",
          "new_api": null,
          "old_text": "PyThreadState_Get()",
          "new_text": null,
          "old_line_content": "      completion, tag, PyThreadState_Get());",
          "new_line_content": "    // run a command they've gt a fresh OSDMap afterwards.",
          "content_same": false
        },
        {
          "line": 665,
          "old_api": "PyArg_ParseTuple",
          "new_api": null,
          "old_text": "PyArg_ParseTuple(args, \"ss:get_perf_schema\", &type_str,\n                                                    &svc_id)",
          "new_text": null,
          "old_line_content": "  if (!PyArg_ParseTuple(args, \"ss:get_perf_schema\", &type_str,",
          "new_line_content": "ceph_get_rocksdb_version(BaseMgrModule *self)",
          "content_same": false
        },
        {
          "line": 155,
          "old_api": "PyEval_SaveThread",
          "new_api": null,
          "old_text": "PyEval_SaveThread()",
          "new_text": null,
          "old_line_content": "  PyThreadState *tstate = PyEval_SaveThread();",
          "new_line_content": "    // latest cluster map versions on completion, and callers",
          "content_same": false
        },
        {
          "line": 1177,
          "old_api": "PyUnicode_Check",
          "new_api": null,
          "old_text": "PyUnicode_Check(param_value)",
          "new_text": null,
          "old_line_content": "            if (!PyUnicode_Check(param_value)) {",
          "new_line_content": "                   << \" contains invalid type \" << dendl;",
          "content_same": false
        },
        {
          "line": 157,
          "old_api": "std::string(type)",
          "new_api": null,
          "old_text": "std::string(type)",
          "new_text": null,
          "old_line_content": "  if (std::string(type) == \"mon\") {",
          "new_line_content": "    auto c = new LambdaContext([command_c, self](int command_r){",
          "content_same": false
        },
        {
          "line": 670,
          "old_api": "get_perf_schema_python",
          "new_api": null,
          "old_text": "self->py_modules->get_perf_schema_python(type_str, svc_id)",
          "new_text": null,
          "old_line_content": "  return self->py_modules->get_perf_schema_python(type_str, svc_id);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1183,
          "old_api": "find",
          "new_api": null,
          "old_text": "sub_key_types.find(type)",
          "new_text": null,
          "old_line_content": "            auto it = sub_key_types.find(type);",
          "new_line_content": "              derr << __func__ << \" query \" << query_param_name << \" item \" << j",
          "content_same": false
        },
        {
          "line": 1184,
          "old_api": "end",
          "new_api": null,
          "old_text": "sub_key_types.end()",
          "new_text": null,
          "old_line_content": "            if (it == sub_key_types.end()) {",
          "new_line_content": "                   << \" contains invalid param \" << param_name << dendl;",
          "content_same": false
        },
        {
          "line": 676,
          "old_api": "get_rocksdb_version",
          "new_api": null,
          "old_text": "self->py_modules->get_rocksdb_version()",
          "new_text": null,
          "old_line_content": "  return self->py_modules->get_rocksdb_version();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 167,
          "old_api": "wait_for_latest_osdmap",
          "new_api": null,
          "old_text": "self->py_modules->get_objecter().wait_for_latest_osdmap(\n\t[command_c, command_r](boost::system::error_code) {\n\t  command_c->complete(command_r);\n\t})",
          "new_text": null,
          "old_line_content": "      self->py_modules->get_objecter().wait_for_latest_osdmap(",
          "new_line_content": "        inbuf,",
          "content_same": false
        },
        {
          "line": 1191,
          "old_api": "PyUnicode_Check",
          "new_api": null,
          "old_text": "PyUnicode_Check(param_value)",
          "new_text": null,
          "old_line_content": "            if (!PyUnicode_Check(param_value)) {",
          "new_line_content": "              derr << __func__ << \" query \" << query_param_name << \" item \" << j",
          "content_same": false
        },
        {
          "line": 169,
          "old_api": "complete",
          "new_api": null,
          "old_text": "command_c->complete(command_r)",
          "new_text": null,
          "old_line_content": "\t  command_c->complete(command_r);",
          "new_line_content": "        &command_c->outs,",
          "content_same": false
        },
        {
          "line": 683,
          "old_api": "get_osdmap",
          "new_api": null,
          "old_text": "self->py_modules->get_osdmap()",
          "new_text": null,
          "old_line_content": "  return self->py_modules->get_osdmap();",
          "new_line_content": "    return nullptr;",
          "content_same": false
        },
        {
          "line": 1196,
          "old_api": "PyUnicode_AsUTF8",
          "new_api": null,
          "old_text": "PyUnicode_AsUTF8(param_value)",
          "new_text": null,
          "old_line_content": "            d.regex_str = PyUnicode_AsUTF8(param_value);",
          "new_line_content": "              derr << __func__ << \" query \" << query_param_name << \" item \" << j",
          "content_same": false
        },
        {
          "line": 1198,
          "old_api": "c_str",
          "new_api": null,
          "old_text": "d.regex_str.c_str()",
          "new_text": null,
          "old_line_content": "              d.regex = d.regex_str.c_str();",
          "new_line_content": "                   << dendl;",
          "content_same": false
        },
        {
          "line": 690,
          "old_api": "PyArg_ParseTuple",
          "new_api": null,
          "old_text": "PyArg_ParseTuple(args, \"s:ceph_advertize_service\",\n        &svc_str)",
          "new_text": null,
          "old_line_content": "  if (!PyArg_ParseTuple(args, \"s:ceph_advertize_service\",",
          "new_line_content": "  });",
          "content_same": false
        },
        {
          "line": 180,
          "old_api": "std::string(type)",
          "new_api": null,
          "old_text": "std::string(type)",
          "new_text": null,
          "old_line_content": "  } else if (std::string(type) == \"osd\") {",
          "new_line_content": "      return nullptr;",
          "content_same": false
        },
        {
          "line": 1204,
          "old_api": "mark_count",
          "new_api": null,
          "old_text": "d.regex.mark_count()",
          "new_text": null,
          "old_line_content": "            if (d.regex.mark_count() == 0) {",
          "new_line_content": "            Py_RETURN_NONE;",
          "content_same": false
        },
        {
          "line": 182,
          "old_api": "strict_strtoll",
          "new_api": null,
          "old_text": "strict_strtoll(name, 10, &err)",
          "new_text": null,
          "old_line_content": "    uint64_t osd_id = strict_strtoll(name, 10, &err);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 183,
          "old_api": "empty",
          "new_api": null,
          "old_text": "err.empty()",
          "new_text": null,
          "old_line_content": "    if (!err.empty()) {",
          "new_line_content": "    ceph_tid_t tid;",
          "content_same": false
        },
        {
          "line": 697,
          "old_api": "set_uri",
          "new_api": null,
          "old_text": "without_gil([&] {\n    self->py_modules->set_uri(self->this_module->get_name(), svc_str);\n  })",
          "new_text": null,
          "old_line_content": "  without_gil([&] {",
          "new_line_content": "  char *devid = nullptr;",
          "content_same": false
        },
        {
          "line": 186,
          "old_api": "append",
          "new_api": null,
          "old_text": "msg.append(\"\\\"\").append(name).append(\"\\\"\")",
          "new_text": null,
          "old_line_content": "      msg.append(\"\\\"\").append(name).append(\"\\\"\");",
          "new_line_content": "        {cmd_json},",
          "content_same": false
        },
        {
          "line": 187,
          "old_api": "PyEval_RestoreThread",
          "new_api": null,
          "old_text": "PyEval_RestoreThread(tstate)",
          "new_text": null,
          "old_line_content": "      PyEval_RestoreThread(tstate);",
          "new_line_content": "        inbuf,",
          "content_same": false
        },
        {
          "line": 188,
          "old_api": "c_str",
          "new_api": null,
          "old_text": "msg.c_str()",
          "new_text": null,
          "old_line_content": "      PyErr_SetString(PyExc_ValueError, msg.c_str());",
          "new_line_content": "        &tid,",
          "content_same": false
        },
        {
          "line": 698,
          "old_api": "get_name",
          "new_api": null,
          "old_text": "self->this_module->get_name()",
          "new_text": null,
          "old_line_content": "    self->py_modules->set_uri(self->this_module->get_name(), svc_str);",
          "new_line_content": "  float wear_level;",
          "content_same": false
        },
        {
          "line": 1217,
          "old_api": "empty",
          "new_api": null,
          "old_text": "d.regex_str.empty()",
          "new_text": null,
          "old_line_content": "            d.regex_str.empty()) {",
          "new_line_content": "        derr << __func__ << \" \" << query_param_name << \" not a list\" << dendl;",
          "content_same": false
        },
        {
          "line": 708,
          "old_api": "PyArg_ParseTuple",
          "new_api": null,
          "old_text": "PyArg_ParseTuple(args, \"sf:ceph_set_wear_level\",\n\t\t\t&devid, &wear_level)",
          "new_text": null,
          "old_line_content": "  if (!PyArg_ParseTuple(args, \"sf:ceph_set_wear_level\",",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 200,
          "old_api": "std::move(s)",
          "new_api": null,
          "old_text": "std::move(s)",
          "new_text": null,
          "old_line_content": "\t  command_c->outs = std::move(s);",
          "new_line_content": "        &command_c->outbl,",
          "content_same": false
        },
        {
          "line": 201,
          "old_api": "std::move(bl)",
          "new_api": null,
          "old_text": "std::move(bl)",
          "new_text": null,
          "old_line_content": "\t  command_c->outbl = std::move(bl);",
          "new_line_content": "        &command_c->outs,",
          "content_same": false
        },
        {
          "line": 202,
          "old_api": "queue",
          "new_api": null,
          "old_text": "f->queue(command_c)",
          "new_text": null,
          "old_line_content": "\t  f->queue(command_c);",
          "new_line_content": "        new C_OnFinisher(command_c, &self->py_modules->cmd_finisher));",
          "content_same": false
        },
        {
          "line": 713,
          "old_api": "set_device_wear_level",
          "new_api": null,
          "old_text": "self->py_modules->set_device_wear_level(devid, wear_level)",
          "new_text": null,
          "old_line_content": "    self->py_modules->set_device_wear_level(devid, wear_level);",
          "new_line_content": "    Py_RETURN_TRUE;",
          "content_same": false
        },
        {
          "line": 204,
          "old_api": "std::string(type)",
          "new_api": null,
          "old_text": "std::string(type)",
          "new_text": null,
          "old_line_content": "  } else if (std::string(type) == \"mds\") {",
          "new_line_content": "      string msg(\"failed to send command to mds: \");",
          "content_same": false
        },
        {
          "line": 1225,
          "old_api": "PyList_Check",
          "new_api": null,
          "old_text": "PyList_Check(query_param_val)",
          "new_text": null,
          "old_line_content": "      if (!PyList_Check(query_param_val)) {",
          "new_line_content": "          Py_RETURN_NONE;",
          "content_same": false
        },
        {
          "line": 1230,
          "old_api": "PyList_GET_ITEM",
          "new_api": null,
          "old_text": "PyList_GET_ITEM(query_param_val, j)",
          "new_text": null,
          "old_line_content": "        PyObject *py_type = PyList_GET_ITEM(query_param_val, j);",
          "new_line_content": "          derr << __func__ << \" query \" << query_param_name << \" item \" << type",
          "content_same": false
        },
        {
          "line": 1231,
          "old_api": "PyUnicode_Check",
          "new_api": null,
          "old_text": "PyUnicode_Check(py_type)",
          "new_text": null,
          "old_line_content": "        if (!PyUnicode_Check(py_type)) {",
          "new_line_content": "               << \" is not valid type\" << dendl;",
          "content_same": false
        },
        {
          "line": 721,
          "old_api": "is_connected",
          "new_api": null,
          "old_text": "self->py_modules->get_monc().is_connected()",
          "new_text": null,
          "old_line_content": "  if (self->py_modules->get_monc().is_connected()) {",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 1236,
          "old_api": "PyUnicode_AsUTF8",
          "new_api": null,
          "old_text": "PyUnicode_AsUTF8(py_type)",
          "new_text": null,
          "old_line_content": "        auto type = PyUnicode_AsUTF8(py_type);",
          "new_line_content": "    } else if (query_param_name == NAME_LIMIT) {",
          "content_same": false
        },
        {
          "line": 214,
          "old_api": "cpp_strerror",
          "new_api": null,
          "old_text": "cpp_strerror(r)",
          "new_text": null,
          "old_line_content": "      msg.append(cpp_strerror(r));",
          "new_line_content": "      string msg(\"invalid pgid: \");",
          "content_same": false
        },
        {
          "line": 1238,
          "old_api": "end",
          "new_api": null,
          "old_text": "counter_types.end()",
          "new_text": null,
          "old_line_content": "        if (it == counter_types.end()) {",
          "new_line_content": "        derr << __func__ << \" query \" << query_param_name << \" not a dict\"",
          "content_same": false
        },
        {
          "line": 219,
          "old_api": "std::string(type)",
          "new_api": null,
          "old_text": "std::string(type)",
          "new_text": null,
          "old_line_content": "  } else if (std::string(type) == \"pg\") {",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 221,
          "old_api": "parse",
          "new_api": null,
          "old_text": "pgid.parse(name)",
          "new_text": null,
          "old_line_content": "    if (!pgid.parse(name)) {",
          "new_line_content": "    ceph_tid_t tid;",
          "content_same": false
        },
        {
          "line": 735,
          "old_api": "PyArg_ParseTuple",
          "new_api": null,
          "old_text": "PyArg_ParseTuple(args, \"ssfb:ceph_update_progress_event\",\n\t\t\t&evid, &desc, &progress, &add_to_ceph_s)",
          "new_text": null,
          "old_line_content": "  if (!PyArg_ParseTuple(args, \"ssfb:ceph_update_progress_event\",",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 224,
          "old_api": "append",
          "new_api": null,
          "old_text": "msg.append(\"\\\"\").append(name).append(\"\\\"\")",
          "new_text": null,
          "old_line_content": "      msg.append(\"\\\"\").append(name).append(\"\\\"\");",
          "new_line_content": "        {cmd_json},",
          "content_same": false
        },
        {
          "line": 225,
          "old_api": "PyEval_RestoreThread",
          "new_api": null,
          "old_text": "PyEval_RestoreThread(tstate)",
          "new_text": null,
          "old_line_content": "      PyEval_RestoreThread(tstate);",
          "new_line_content": "        inbuf,",
          "content_same": false
        },
        {
          "line": 226,
          "old_api": "c_str",
          "new_api": null,
          "old_text": "msg.c_str()",
          "new_text": null,
          "old_line_content": "      PyErr_SetString(PyExc_ValueError, msg.c_str());",
          "new_line_content": "        &tid,",
          "content_same": false
        },
        {
          "line": 739,
          "old_api": "update_progress_event",
          "new_api": null,
          "old_text": "without_gil([&] {\n    self->py_modules->update_progress_event(evid, desc, progress, add_to_ceph_s);\n  })",
          "new_text": null,
          "old_line_content": "  without_gil([&] {",
          "new_line_content": "  char *evid = nullptr;",
          "content_same": false
        },
        {
          "line": 1252,
          "old_api": "MDSPerfMetricLimit",
          "new_api": null,
          "old_text": "MDSPerfMetricLimit()",
          "new_text": null,
          "old_line_content": "      limit = MDSPerfMetricLimit();",
          "new_line_content": "          derr << __func__ << \" limit item \" << j << \" not a size 2 tuple\"",
          "content_same": false
        },
        {
          "line": 1253,
          "old_api": "PyDict_Items",
          "new_api": null,
          "old_text": "PyDict_Items(query_param_val)",
          "new_text": null,
          "old_line_content": "      PyObject *limit_params = PyDict_Items(query_param_val);",
          "new_line_content": "               << dendl;",
          "content_same": false
        },
        {
          "line": 1255,
          "old_api": "PyList_Size",
          "new_api": null,
          "old_text": "PyList_Size(limit_params)",
          "new_text": null,
          "old_line_content": "      for (int j = 0; j < PyList_Size(limit_params); ++j) {",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 1256,
          "old_api": "PyList_GET_ITEM",
          "new_api": null,
          "old_text": "PyList_GET_ITEM(limit_params, j)",
          "new_text": null,
          "old_line_content": "        PyObject *kv = PyList_GET_ITEM(limit_params, j);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1259,
          "old_api": "PyArg_ParseTuple",
          "new_api": null,
          "old_text": "PyArg_ParseTuple(kv, \"sO:pair\", &limit_param_name,\n                              &limit_param_val)",
          "new_text": null,
          "old_line_content": "        if (!PyArg_ParseTuple(kv, \"sO:pair\", &limit_param_name,",
          "new_line_content": "            derr << __func__ << \" \" << limit_param_name << \" not a string\"",
          "content_same": false
        },
        {
          "line": 749,
          "old_api": "PyArg_ParseTuple",
          "new_api": null,
          "old_text": "PyArg_ParseTuple(args, \"s:ceph_complete_progress_event\",\n\t\t\t&evid)",
          "new_text": null,
          "old_line_content": "  if (!PyArg_ParseTuple(args, \"s:ceph_complete_progress_event\",",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 242,
          "old_api": "PyEval_RestoreThread",
          "new_api": null,
          "old_text": "PyEval_RestoreThread(tstate)",
          "new_text": null,
          "old_line_content": "    PyEval_RestoreThread(tstate);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 1267,
          "old_api": "PyUnicode_Check",
          "new_api": null,
          "old_text": "PyUnicode_Check(limit_param_val)",
          "new_text": null,
          "old_line_content": "          if (!PyUnicode_Check(limit_param_val)) {",
          "new_line_content": "                 << \" not a valid counter type\" << dendl;",
          "content_same": false
        },
        {
          "line": 247,
          "old_api": "append",
          "new_api": null,
          "old_text": "msg.append(type)",
          "new_text": null,
          "old_line_content": "    msg.append(type);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 248,
          "old_api": "PyEval_RestoreThread",
          "new_api": null,
          "old_text": "PyEval_RestoreThread(tstate)",
          "new_text": null,
          "old_line_content": "    PyEval_RestoreThread(tstate);",
          "new_line_content": "static PyObject*",
          "content_same": false
        },
        {
          "line": 249,
          "old_api": "c_str",
          "new_api": null,
          "old_text": "msg.c_str()",
          "new_text": null,
          "old_line_content": "    PyErr_SetString(PyExc_ValueError, msg.c_str());",
          "new_line_content": "ceph_set_health_checks(BaseMgrModule *self, PyObject *args)",
          "content_same": false
        },
        {
          "line": 762,
          "old_api": "clear_all_progress_events",
          "new_api": null,
          "old_text": "without_gil([&] {\n    self->py_modules->clear_all_progress_events();\n  })",
          "new_text": null,
          "old_line_content": "  without_gil([&] {",
          "new_line_content": "ceph_dispatch_remote(BaseMgrModule *self, PyObject *args)",
          "content_same": false
        },
        {
          "line": 763,
          "old_api": "clear_all_progress_events",
          "new_api": null,
          "old_text": "self->py_modules->clear_all_progress_events()",
          "new_text": null,
          "old_line_content": "    self->py_modules->clear_all_progress_events();",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 1273,
          "old_api": "find",
          "new_api": null,
          "old_text": "counter_types.find(order_by)",
          "new_text": null,
          "old_line_content": "          auto it = counter_types.find(order_by);",
          "new_line_content": "            derr << __func__ << \" \" << limit_param_name << \" not an int\"",
          "content_same": false
        },
        {
          "line": 253,
          "old_api": "PyEval_RestoreThread",
          "new_api": null,
          "old_text": "PyEval_RestoreThread(tstate)",
          "new_text": null,
          "old_line_content": "  PyEval_RestoreThread(tstate);",
          "new_line_content": "    return NULL;",
          "content_same": false
        },
        {
          "line": 1274,
          "old_api": "end",
          "new_api": null,
          "old_text": "counter_types.end()",
          "new_text": null,
          "old_line_content": "          if (it == counter_types.end()) {",
          "new_line_content": "                 << dendl;",
          "content_same": false
        },
        {
          "line": 1281,
          "old_api": "PyLong_Check",
          "new_api": null,
          "old_text": "PyLong_Check(limit_param_val)",
          "new_text": null,
          "old_line_content": "          if (!PyLong_Check(limit_param_val)) {",
          "new_line_content": "          Py_RETURN_NONE;",
          "content_same": false
        },
        {
          "line": 1286,
          "old_api": "PyLong_AsLong",
          "new_api": null,
          "old_text": "PyLong_AsLong(limit_param_val)",
          "new_text": null,
          "old_line_content": "          limit->max_count = PyLong_AsLong(limit_param_val);",
          "new_line_content": "      Py_RETURN_NONE;",
          "content_same": false
        },
        {
          "line": 264,
          "old_api": "PyDict_Check",
          "new_api": null,
          "old_text": "PyDict_Check(checks)",
          "new_text": null,
          "old_line_content": "  if (!PyDict_Check(checks)) {",
          "new_line_content": "    PyObject *check_info = nullptr;",
          "content_same": false
        },
        {
          "line": 777,
          "old_api": "PyArg_ParseTuple",
          "new_api": null,
          "old_text": "PyArg_ParseTuple(args, \"ssOO:ceph_dispatch_remote\",\n        &other_module, &method, &remote_args, &remote_kwargs)",
          "new_text": null,
          "old_line_content": "  if (!PyArg_ParseTuple(args, \"ssOO:ceph_dispatch_remote\",",
          "new_line_content": "    derr << \"no module '\" << other_module << \"'\" << dendl;",
          "content_same": false
        },
        {
          "line": 268,
          "old_api": "PyDict_Items",
          "new_api": null,
          "old_text": "PyDict_Items(checks)",
          "new_text": null,
          "old_line_content": "  PyObject *checksls = PyDict_Items(checks);",
          "new_line_content": "      continue;",
          "content_same": false
        },
        {
          "line": 271,
          "old_api": "PyList_GET_ITEM",
          "new_api": null,
          "old_text": "PyList_GET_ITEM(checksls, i)",
          "new_text": null,
          "old_line_content": "    PyObject *kv = PyList_GET_ITEM(checksls, i);",
          "new_line_content": "      derr << __func__ << \" item \" << i << \" \" << check_name",
          "content_same": false
        },
        {
          "line": 785,
          "old_api": "module_exists",
          "new_api": null,
          "old_text": "self->py_modules->module_exists(other_module)",
          "new_text": null,
          "old_line_content": "  if (!self->py_modules->module_exists(other_module)) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 274,
          "old_api": "PyArg_ParseTuple",
          "new_api": null,
          "old_text": "PyArg_ParseTuple(kv, \"sO:pair\", &check_name, &check_info)",
          "new_text": null,
          "old_line_content": "    if (!PyArg_ParseTuple(kv, \"sO:pair\", &check_name, &check_info)) {",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1299,
          "old_api": "empty",
          "new_api": null,
          "old_text": "query.key_descriptor.empty()",
          "new_text": null,
          "old_line_content": "  if (query.key_descriptor.empty()) {",
          "new_line_content": "           << \" not in performance_counter_descriptors\" << dendl;",
          "content_same": false
        },
        {
          "line": 1306,
          "old_api": "end",
          "new_api": null,
          "old_text": "ds.end()",
          "new_text": null,
          "old_line_content": "    if (std::find(ds.begin(), ds.end(), limit->order_by) == ds.end()) {",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 795,
          "old_api": "method_exists",
          "new_api": null,
          "old_text": "self->py_modules->method_exists(other_module, method)",
          "new_text": null,
          "old_line_content": "  if (!self->py_modules->method_exists(other_module, method)) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 797,
          "old_api": "PyErr_SetString",
          "new_api": null,
          "old_text": "PyErr_SetString(PyExc_NameError, \"Method not found\")",
          "new_text": null,
          "old_line_content": "    PyErr_SetString(PyExc_NameError, \"Method not found\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 288,
          "old_api": "PyDict_Items",
          "new_api": null,
          "old_text": "PyDict_Items(check_info)",
          "new_text": null,
          "old_line_content": "    PyObject *infols = PyDict_Items(check_info);",
          "new_line_content": "      PyObject *v = nullptr;",
          "content_same": false
        },
        {
          "line": 1313,
          "old_api": "add_mds_perf_query",
          "new_api": null,
          "old_text": "self->py_modules->add_mds_perf_query(query, limit)",
          "new_text": null,
          "old_line_content": "  auto query_id = self->py_modules->add_mds_perf_query(query, limit);",
          "new_line_content": "    derr << \"Invalid args!\" << dendl;",
          "content_same": false
        },
        {
          "line": 290,
          "old_api": "PyList_GET_ITEM",
          "new_api": null,
          "old_text": "PyList_GET_ITEM(infols, j)",
          "new_text": null,
          "old_line_content": "      PyObject *pair = PyList_GET_ITEM(infols, j);",
          "new_line_content": "\tderr << __func__ << \" item \" << i << \" pair \" << j",
          "content_same": false
        },
        {
          "line": 291,
          "old_api": "PyTuple_Check",
          "new_api": null,
          "old_text": "PyTuple_Check(pair)",
          "new_text": null,
          "old_line_content": "      if (!PyTuple_Check(pair)) {",
          "new_line_content": "\t     << \" not a size 2 tuple\" << dendl;",
          "content_same": false
        },
        {
          "line": 1314,
          "old_api": "PyLong_FromLong",
          "new_api": null,
          "old_text": "PyLong_FromLong(query_id)",
          "new_text": null,
          "old_line_content": "  return PyLong_FromLong(query_id);",
          "new_line_content": "    return nullptr;",
          "content_same": false
        },
        {
          "line": 805,
          "old_api": "PyEval_RestoreThread",
          "new_api": null,
          "old_text": "PyEval_RestoreThread(tstate)",
          "new_text": null,
          "old_line_content": "  PyEval_RestoreThread(tstate);",
          "new_line_content": "  return result;",
          "content_same": false
        },
        {
          "line": 1321,
          "old_api": "PyArg_ParseTuple",
          "new_api": null,
          "old_text": "PyArg_ParseTuple(args, \"i:ceph_remove_mds_perf_query\", &query_id)",
          "new_text": null,
          "old_line_content": "  if (!PyArg_ParseTuple(args, \"i:ceph_remove_mds_perf_query\", &query_id)) {",
          "new_line_content": "static PyObject*",
          "content_same": false
        },
        {
          "line": 298,
          "old_api": "PyArg_ParseTuple",
          "new_api": null,
          "old_text": "PyArg_ParseTuple(pair, \"sO:pair\", &k, &v)",
          "new_text": null,
          "old_line_content": "      if (!PyArg_ParseTuple(pair, \"sO:pair\", &k, &v)) {",
          "new_line_content": "\t       << \" severity value not string\" << dendl;",
          "content_same": false
        },
        {
          "line": 810,
          "old_api": "str",
          "new_api": null,
          "old_text": "ss.str().c_str()",
          "new_text": null,
          "old_line_content": "    PyErr_SetString(PyExc_RuntimeError, ss.str().c_str());",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 811,
          "old_api": "str",
          "new_api": null,
          "old_text": "ss.str()",
          "new_text": null,
          "old_line_content": "    derr << ss.str() << dendl;",
          "new_line_content": "  static const std::string NAME_KEY_DESCRIPTOR = \"key_descriptor\";",
          "content_same": false
        },
        {
          "line": 1326,
          "old_api": "remove_mds_perf_query",
          "new_api": null,
          "old_text": "self->py_modules->remove_mds_perf_query(query_id)",
          "new_text": null,
          "old_line_content": "  self->py_modules->remove_mds_perf_query(query_id);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 305,
          "old_api": "PyUnicode_Check",
          "new_api": null,
          "old_text": "PyUnicode_Check(v)",
          "new_text": null,
          "old_line_content": "\tif (!PyUnicode_Check(v)) {",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 1333,
          "old_api": "reregister_mds_perf_queries",
          "new_api": null,
          "old_text": "self->py_modules->reregister_mds_perf_queries()",
          "new_text": null,
          "old_line_content": "  self->py_modules->reregister_mds_perf_queries();",
          "new_line_content": "    derr << \"Invalid args!\" << dendl;",
          "content_same": false
        },
        {
          "line": 310,
          "old_api": "PyUnicode_AsUTF8",
          "new_api": null,
          "old_text": "PyUnicode_AsUTF8(v)",
          "new_text": null,
          "old_line_content": "\tif (const string vs = PyUnicode_AsUTF8(v); vs == \"warning\") {",
          "new_line_content": "\t  continue;",
          "content_same": false
        },
        {
          "line": 1341,
          "old_api": "PyArg_ParseTuple",
          "new_api": null,
          "old_text": "PyArg_ParseTuple(args, \"i:ceph_get_mds_perf_counters\", &query_id)",
          "new_text": null,
          "old_line_content": "  if (!PyArg_ParseTuple(args, \"i:ceph_get_mds_perf_counters\", &query_id)) {",
          "new_line_content": "ceph_is_authorized(BaseMgrModule *self, PyObject *args)",
          "content_same": false
        },
        {
          "line": 321,
          "old_api": "PyUnicode_AsUTF8",
          "new_api": null,
          "old_text": "PyUnicode_AsUTF8(v)",
          "new_text": null,
          "old_line_content": "\t  summary = PyUnicode_AsUTF8(v);",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 1346,
          "old_api": "get_mds_perf_counters",
          "new_api": null,
          "old_text": "self->py_modules->get_mds_perf_counters(query_id)",
          "new_text": null,
          "old_line_content": "  return self->py_modules->get_mds_perf_counters(query_id);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 324,
          "old_api": "PyLong_Check",
          "new_api": null,
          "old_text": "PyLong_Check(v)",
          "new_text": null,
          "old_line_content": "\tif (PyLong_Check(v)) {",
          "new_line_content": "\t  derr << __func__ << \" check \" << check_name",
          "content_same": false
        },
        {
          "line": 325,
          "old_api": "PyLong_AsLong",
          "new_api": null,
          "old_text": "PyLong_AsLong(v)",
          "new_text": null,
          "old_line_content": "\t  count = PyLong_AsLong(v);",
          "new_line_content": "\t       << \" detail value not list\" << dendl;",
          "content_same": false
        },
        {
          "line": 1353,
          "old_api": "PyArg_ParseTuple",
          "new_api": null,
          "old_text": "PyArg_ParseTuple(args, \"O:ceph_is_authorized\", &args_dict)",
          "new_text": null,
          "old_line_content": "  if (!PyArg_ParseTuple(args, \"O:ceph_is_authorized\", &args_dict)) {",
          "new_line_content": "  std::map<std::string, std::string> arguments;",
          "content_same": false
        },
        {
          "line": 332,
          "old_api": "PyList_Check",
          "new_api": null,
          "old_text": "PyList_Check(v)",
          "new_text": null,
          "old_line_content": "\tif (!PyList_Check(v)) {",
          "new_line_content": "\t\t << \" detail item \" << k << \" not a [unicode] string\" << dendl;",
          "content_same": false
        },
        {
          "line": 337,
          "old_api": "PyList_Size",
          "new_api": null,
          "old_text": "PyList_Size(v)",
          "new_text": null,
          "old_line_content": "\tfor (int k = 0; k < PyList_Size(v); ++k) {",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 338,
          "old_api": "PyList_GET_ITEM",
          "new_api": null,
          "old_text": "PyList_GET_ITEM(v, k)",
          "new_text": null,
          "old_line_content": "\t  PyObject *di = PyList_GET_ITEM(v, k);",
          "new_line_content": "      } else {",
          "content_same": false
        },
        {
          "line": 339,
          "old_api": "PyUnicode_Check",
          "new_api": null,
          "old_text": "PyUnicode_Check(di)",
          "new_text": null,
          "old_line_content": "\t  if (!PyUnicode_Check(di)) {",
          "new_line_content": "\tderr << __func__ << \" check \" << check_name",
          "content_same": false
        },
        {
          "line": 1364,
          "old_api": "PyDict_Items",
          "new_api": null,
          "old_text": "PyDict_Items(args_dict)",
          "new_text": null,
          "old_line_content": "  PyObject *args_list = PyDict_Items(args_dict);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1365,
          "old_api": "PyList_Size",
          "new_api": null,
          "old_text": "PyList_Size(args_list)",
          "new_text": null,
          "old_line_content": "  for (int i = 0; i < PyList_Size(args_list); ++i) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1366,
          "old_api": "PyList_GET_ITEM",
          "new_api": null,
          "old_text": "PyList_GET_ITEM(args_list, i)",
          "new_text": null,
          "old_line_content": "    PyObject *kv = PyList_GET_ITEM(args_list, i);",
          "new_line_content": "    arguments[arg_key] = arg_value;",
          "content_same": false
        },
        {
          "line": 855,
          "old_api": "PyDict_Check",
          "new_api": null,
          "old_text": "PyDict_Check(py_query)",
          "new_text": null,
          "old_line_content": "  if (!PyDict_Check(py_query)) {",
          "new_line_content": "  // {",
          "content_same": false
        },
        {
          "line": 860,
          "old_api": "PyDict_Items",
          "new_api": null,
          "old_text": "PyDict_Items(py_query)",
          "new_text": null,
          "old_line_content": "  PyObject *query_params = PyDict_Items(py_query);",
          "new_line_content": "  //   'performance_counter_descriptors': [",
          "content_same": false
        },
        {
          "line": 352,
          "old_api": "add",
          "new_api": null,
          "old_text": "out_checks.add(check_name, severity, summary, count)",
          "new_text": null,
          "old_line_content": "    auto& d = out_checks.add(check_name, severity, summary, count);",
          "new_line_content": "  *_dout << dendl;",
          "content_same": false
        },
        {
          "line": 1378,
          "old_api": "is_authorized",
          "new_api": null,
          "old_text": "without_gil([&] {\n    return self->this_module->is_authorized(arguments);\n  })",
          "new_text": null,
          "old_line_content": "  bool r = without_gil([&] {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1379,
          "old_api": "is_authorized",
          "new_api": null,
          "old_text": "self->this_module->is_authorized(arguments)",
          "new_text": null,
          "old_line_content": "    return self->this_module->is_authorized(arguments);",
          "new_line_content": "static PyObject*",
          "content_same": false
        },
        {
          "line": 357,
          "old_api": "get_name",
          "new_api": null,
          "old_text": "self->this_module->get_name()",
          "new_text": null,
          "old_line_content": "  dout(10) << \"module \" << self->this_module->get_name()",
          "new_line_content": "  Py_RETURN_NONE;",
          "content_same": false
        },
        {
          "line": 359,
          "old_api": "dump",
          "new_api": null,
          "old_text": "out_checks.dump(&jf)",
          "new_text": null,
          "old_line_content": "  out_checks.dump(&jf);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 360,
          "old_api": "flush",
          "new_api": null,
          "old_text": "jf.flush(*_dout)",
          "new_text": null,
          "old_line_content": "  jf.flush(*_dout);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 362,
          "old_api": "set_health_checks",
          "new_api": null,
          "old_text": "without_gil([&] {\n    self->py_modules->set_health_checks(self->this_module->get_name(),\n\t\t\t\t\tstd::move(out_checks));\n  })",
          "new_text": null,
          "old_line_content": "  without_gil([&] {",
          "new_line_content": "ceph_state_get(BaseMgrModule *self, PyObject *args)",
          "content_same": false
        },
        {
          "line": 363,
          "old_api": "get_name",
          "new_api": null,
          "old_text": "self->this_module->get_name()",
          "new_text": null,
          "old_line_content": "    self->py_modules->set_health_checks(self->this_module->get_name(),",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 364,
          "old_api": "std::move(out_checks)",
          "new_api": null,
          "old_text": "std::move(out_checks)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\tstd::move(out_checks));",
          "new_line_content": "  char *what = NULL;",
          "content_same": false
        },
        {
          "line": 876,
          "old_api": "PyList_GET_ITEM",
          "new_api": null,
          "old_text": "PyList_GET_ITEM(query_params, i)",
          "new_text": null,
          "old_line_content": "    PyObject *kv = PyList_GET_ITEM(query_params, i);",
          "new_line_content": "        derr << __func__ << \" \" << query_param_name << \" not a list\" << dendl;",
          "content_same": false
        },
        {
          "line": 1394,
          "old_api": "PyArg_ParseTuple",
          "new_api": null,
          "old_text": "PyArg_ParseTuple(args, \"zsp:ceph_register_client\", &_name, &addrs, &replace)",
          "new_text": null,
          "old_line_content": "  if (!PyArg_ParseTuple(args, \"zsp:ceph_register_client\", &_name, &addrs, &replace)) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 884,
          "old_api": "PyList_Check",
          "new_api": null,
          "old_text": "PyList_Check(query_param_val)",
          "new_text": null,
          "old_line_content": "      if (!PyList_Check(query_param_val)) {",
          "new_line_content": "          Py_RETURN_NONE;",
          "content_same": false
        },
        {
          "line": 1397,
          "old_api": "get_name",
          "new_api": null,
          "old_text": "self->this_module->get_name()",
          "new_text": null,
          "old_line_content": "  auto name = _name ? std::string(_name) : std::string(self->this_module->get_name());",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 374,
          "old_api": "PyArg_ParseTuple",
          "new_api": null,
          "old_text": "PyArg_ParseTuple(args, \"s:ceph_state_get\", &what)",
          "new_text": null,
          "old_line_content": "  if (!PyArg_ParseTuple(args, \"s:ceph_state_get\", &what)) {",
          "new_line_content": "ceph_get_server(BaseMgrModule *self, PyObject *args)",
          "content_same": false
        },
        {
          "line": 1398,
          "old_api": "register_client",
          "new_api": null,
          "old_text": "without_gil([&] {\n    self->py_modules->register_client(name, addrs, replace);\n  })",
          "new_text": null,
          "old_line_content": "  without_gil([&] {",
          "new_line_content": "  const char* _name = nullptr;",
          "content_same": false
        },
        {
          "line": 1399,
          "old_api": "register_client",
          "new_api": null,
          "old_text": "self->py_modules->register_client(name, addrs, replace)",
          "new_text": null,
          "old_line_content": "    self->py_modules->register_client(name, addrs, replace);",
          "new_line_content": "  char* addrs = nullptr;",
          "content_same": false
        },
        {
          "line": 378,
          "old_api": "cacheable_get_python",
          "new_api": null,
          "old_text": "self->py_modules->cacheable_get_python(what)",
          "new_text": null,
          "old_line_content": "  return self->py_modules->cacheable_get_python(what);",
          "new_line_content": "    return NULL;",
          "content_same": false
        },
        {
          "line": 896,
          "old_api": "PyDict_Items",
          "new_api": null,
          "old_text": "PyDict_Items(sub_key)",
          "new_text": null,
          "old_line_content": "        PyObject *sub_key_params = PyDict_Items(sub_key);",
          "new_line_content": "          PyObject *param_value = nullptr;",
          "content_same": false
        },
        {
          "line": 1409,
          "old_api": "PyArg_ParseTuple",
          "new_api": null,
          "old_text": "PyArg_ParseTuple(args, \"zs:ceph_unregister_client\", &_name, &addrs)",
          "new_text": null,
          "old_line_content": "  if (!PyArg_ParseTuple(args, \"zs:ceph_unregister_client\", &_name, &addrs)) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 386,
          "old_api": "PyArg_ParseTuple",
          "new_api": null,
          "old_text": "PyArg_ParseTuple(args, \"z:ceph_get_server\", &hostname)",
          "new_text": null,
          "old_line_content": "  if (!PyArg_ParseTuple(args, \"z:ceph_get_server\", &hostname)) {",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 898,
          "old_api": "PyList_GET_ITEM",
          "new_api": null,
          "old_text": "PyList_GET_ITEM(sub_key_params, k)",
          "new_text": null,
          "old_line_content": "          PyObject *pair = PyList_GET_ITEM(sub_key_params, k);",
          "new_line_content": "            derr << __func__ << \" query \" << query_param_name << \" item \" << j",
          "content_same": false
        },
        {
          "line": 899,
          "old_api": "PyTuple_Check",
          "new_api": null,
          "old_text": "PyTuple_Check(pair)",
          "new_text": null,
          "old_line_content": "          if (!PyTuple_Check(pair)) {",
          "new_line_content": "                 << \" pair \" << k << \" not a size 2 tuple\" << dendl;",
          "content_same": false
        },
        {
          "line": 1412,
          "old_api": "get_name",
          "new_api": null,
          "old_text": "self->this_module->get_name()",
          "new_text": null,
          "old_line_content": "  auto name = _name ? std::string(_name) : std::string(self->this_module->get_name());",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 1414,
          "old_api": "unregister_client",
          "new_api": null,
          "old_text": "self->py_modules->unregister_client(name, addrs)",
          "new_text": null,
          "old_line_content": "    self->py_modules->unregister_client(name, addrs);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 393,
          "old_api": "list_servers_python",
          "new_api": null,
          "old_text": "self->py_modules->list_servers_python()",
          "new_text": null,
          "old_line_content": "    return self->py_modules->list_servers_python();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 906,
          "old_api": "PyArg_ParseTuple",
          "new_api": null,
          "old_text": "PyArg_ParseTuple(pair, \"sO:pair\", &param_name, &param_value)",
          "new_text": null,
          "old_line_content": "          if (!PyArg_ParseTuple(pair, \"sO:pair\", &param_name, &param_value)) {",
          "new_line_content": "              Py_RETURN_NONE;",
          "content_same": false
        },
        {
          "line": 1422,
          "old_api": "get_daemon_health_metrics",
          "new_api": null,
          "old_text": "self->py_modules->get_daemon_health_metrics()",
          "new_text": null,
          "old_line_content": "  return self->py_modules->get_daemon_health_metrics();",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 400,
          "old_api": "get_id",
          "new_api": null,
          "old_text": "g_conf()->name.get_id().c_str()",
          "new_text": null,
          "old_line_content": "  return PyUnicode_FromString(g_conf()->name.get_id().c_str());",
          "new_line_content": "    return nullptr;",
          "content_same": false
        },
        {
          "line": 912,
          "old_api": "PyUnicode_Check",
          "new_api": null,
          "old_text": "PyUnicode_Check(param_value)",
          "new_text": null,
          "old_line_content": "            if (!PyUnicode_Check(param_value)) {",
          "new_line_content": "                   << \" contains invalid type \" << dendl;",
          "content_same": false
        },
        {
          "line": 918,
          "old_api": "find",
          "new_api": null,
          "old_text": "sub_key_types.find(type)",
          "new_text": null,
          "old_line_content": "            auto it = sub_key_types.find(type);",
          "new_line_content": "              derr << __func__ << \" query \" << query_param_name << \" item \" << j",
          "content_same": false
        },
        {
          "line": 407,
          "old_api": "PyArg_ParseTuple",
          "new_api": null,
          "old_text": "PyArg_ParseTuple(args, \"s:ceph_option_get\", &what)",
          "new_text": null,
          "old_line_content": "  if (!PyArg_ParseTuple(args, \"s:ceph_option_get\", &what)) {",
          "new_line_content": "    case -ENOMEM:",
          "content_same": false
        },
        {
          "line": 919,
          "old_api": "end",
          "new_api": null,
          "old_text": "sub_key_types.end()",
          "new_text": null,
          "old_line_content": "            if (it == sub_key_types.end()) {",
          "new_line_content": "                   << \" contains invalid param \" << param_name << dendl;",
          "content_same": false
        },
        {
          "line": 412,
          "old_api": "string",
          "new_api": null,
          "old_text": "string(what)",
          "new_text": null,
          "old_line_content": "  const Option *opt = g_conf().find_option(string(what));",
          "new_line_content": "      return nullptr;",
          "content_same": false
        },
        {
          "line": 926,
          "old_api": "PyUnicode_Check",
          "new_api": null,
          "old_text": "PyUnicode_Check(param_value)",
          "new_text": null,
          "old_line_content": "            if (!PyUnicode_Check(param_value)) {",
          "new_line_content": "              derr << __func__ << \" query \" << query_param_name << \" item \" << j",
          "content_same": false
        },
        {
          "line": 415,
          "old_api": "string",
          "new_api": null,
          "old_text": "string(what)",
          "new_text": null,
          "old_line_content": "    switch (int r = g_conf().get_val(string(what), &value); r) {",
          "new_line_content": "      break;",
          "content_same": false
        },
        {
          "line": 931,
          "old_api": "PyUnicode_AsUTF8",
          "new_api": null,
          "old_text": "PyUnicode_AsUTF8(param_value)",
          "new_text": null,
          "old_line_content": "            d.regex_str = PyUnicode_AsUTF8(param_value);",
          "new_line_content": "              derr << __func__ << \" query \" << query_param_name << \" item \" << j",
          "content_same": false
        },
        {
          "line": 933,
          "old_api": "c_str",
          "new_api": null,
          "old_text": "d.regex_str.c_str()",
          "new_text": null,
          "old_line_content": "              d.regex = d.regex_str.c_str();",
          "new_line_content": "                   << dendl;",
          "content_same": false
        },
        {
          "line": 423,
          "old_api": "ceph_assert",
          "new_api": null,
          "old_text": "ceph_assert(r == 0)",
          "new_text": null,
          "old_line_content": "      ceph_assert(r == 0);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 426,
          "old_api": "dout",
          "new_api": null,
          "old_text": "dout(10)",
          "new_text": null,
          "old_line_content": "    dout(10) << \"ceph_option_get \" << what << \" found: \" << value << dendl;",
          "new_line_content": "static PyObject*",
          "content_same": false
        },
        {
          "line": 427,
          "old_api": "get_python_typed_option_value",
          "new_api": null,
          "old_text": "get_python_typed_option_value(opt->type, value)",
          "new_text": null,
          "old_line_content": "    return get_python_typed_option_value(opt->type, value);",
          "new_line_content": "ceph_foreign_option_get(BaseMgrModule *self, PyObject *args)",
          "content_same": false
        },
        {
          "line": 939,
          "old_api": "mark_count",
          "new_api": null,
          "old_text": "d.regex.mark_count()",
          "new_text": null,
          "old_line_content": "            if (d.regex.mark_count() == 0) {",
          "new_line_content": "            Py_RETURN_NONE;",
          "content_same": false
        },
        {
          "line": 429,
          "old_api": "dout",
          "new_api": null,
          "old_text": "dout(4)",
          "new_text": null,
          "old_line_content": "    dout(4) << \"ceph_option_get \" << what << \" not found \" << dendl;",
          "new_line_content": "  char *who = nullptr;",
          "content_same": false
        },
        {
          "line": 430,
          "old_api": "PyErr_Format",
          "new_api": null,
          "old_text": "PyErr_Format(PyExc_KeyError, \"option not found: %s\", what)",
          "new_text": null,
          "old_line_content": "    PyErr_Format(PyExc_KeyError, \"option not found: %s\", what);",
          "new_line_content": "  char *what = nullptr;",
          "content_same": false
        },
        {
          "line": 440,
          "old_api": "PyArg_ParseTuple",
          "new_api": null,
          "old_text": "PyArg_ParseTuple(args, \"ss:ceph_foreign_option_get\", &who, &what)",
          "new_text": null,
          "old_line_content": "  if (!PyArg_ParseTuple(args, \"ss:ceph_foreign_option_get\", &who, &what)) {",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 952,
          "old_api": "empty",
          "new_api": null,
          "old_text": "d.regex_str.empty()",
          "new_text": null,
          "old_line_content": "            d.regex_str.empty()) {",
          "new_line_content": "        derr << __func__ << \" \" << query_param_name << \" not a list\" << dendl;",
          "content_same": false
        },
        {
          "line": 960,
          "old_api": "PyList_Check",
          "new_api": null,
          "old_text": "PyList_Check(query_param_val)",
          "new_text": null,
          "old_line_content": "      if (!PyList_Check(query_param_val)) {",
          "new_line_content": "          Py_RETURN_NONE;",
          "content_same": false
        },
        {
          "line": 965,
          "old_api": "PyList_GET_ITEM",
          "new_api": null,
          "old_text": "PyList_GET_ITEM(query_param_val, j)",
          "new_text": null,
          "old_line_content": "        PyObject *py_type = PyList_GET_ITEM(query_param_val, j);",
          "new_line_content": "          derr << __func__ << \" query \" << query_param_name << \" item \" << type",
          "content_same": false
        },
        {
          "line": 966,
          "old_api": "PyUnicode_Check",
          "new_api": null,
          "old_text": "PyUnicode_Check(py_type)",
          "new_text": null,
          "old_line_content": "        if (!PyUnicode_Check(py_type)) {",
          "new_line_content": "               << \" is not valid type\" << dendl;",
          "content_same": false
        },
        {
          "line": 971,
          "old_api": "PyUnicode_AsUTF8",
          "new_api": null,
          "old_text": "PyUnicode_AsUTF8(py_type)",
          "new_text": null,
          "old_line_content": "        auto type = PyUnicode_AsUTF8(py_type);",
          "new_line_content": "    } else if (query_param_name == NAME_LIMIT) {",
          "content_same": false
        },
        {
          "line": 973,
          "old_api": "end",
          "new_api": null,
          "old_text": "counter_types.end()",
          "new_text": null,
          "old_line_content": "        if (it == counter_types.end()) {",
          "new_line_content": "        derr << __func__ << \" query \" << query_param_name << \" not a dict\"",
          "content_same": false
        },
        {
          "line": 463,
          "old_api": "get_typed_config",
          "new_api": null,
          "old_text": "self->py_modules->get_typed_config(module, key, str_prefix)",
          "new_text": null,
          "old_line_content": "  auto pResult = self->py_modules->get_typed_config(module, key, str_prefix);",
          "new_line_content": "    derr << \"Invalid args!\" << dendl;",
          "content_same": false
        },
        {
          "line": 471,
          "old_api": "PyArg_ParseTuple",
          "new_api": null,
          "old_text": "PyArg_ParseTuple(args, \"s:ceph_store_get_prefix\", &prefix)",
          "new_text": null,
          "old_line_content": "  if (!PyArg_ParseTuple(args, \"s:ceph_store_get_prefix\", &prefix)) {",
          "new_line_content": "static PyObject*",
          "content_same": false
        },
        {
          "line": 987,
          "old_api": "OSDPerfMetricLimit",
          "new_api": null,
          "old_text": "OSDPerfMetricLimit()",
          "new_text": null,
          "old_line_content": "      limit = OSDPerfMetricLimit();",
          "new_line_content": "          derr << __func__ << \" limit item \" << j << \" not a size 2 tuple\"",
          "content_same": false
        },
        {
          "line": 476,
          "old_api": "get_name",
          "new_api": null,
          "old_text": "self->this_module->get_name()",
          "new_text": null,
          "old_line_content": "  return self->py_modules->get_store_prefix(self->this_module->get_name(),",
          "new_line_content": "  char *value = nullptr;",
          "content_same": false
        },
        {
          "line": 988,
          "old_api": "PyDict_Items",
          "new_api": null,
          "old_text": "PyDict_Items(query_param_val)",
          "new_text": null,
          "old_line_content": "      PyObject *limit_params = PyDict_Items(query_param_val);",
          "new_line_content": "               << dendl;",
          "content_same": false
        },
        {
          "line": 990,
          "old_api": "PyList_Size",
          "new_api": null,
          "old_text": "PyList_Size(limit_params)",
          "new_text": null,
          "old_line_content": "      for (int j = 0; j < PyList_Size(limit_params); ++j) {",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 991,
          "old_api": "PyList_GET_ITEM",
          "new_api": null,
          "old_text": "PyList_GET_ITEM(limit_params, j)",
          "new_text": null,
          "old_line_content": "        PyObject *kv = PyList_GET_ITEM(limit_params, j);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 994,
          "old_api": "PyArg_ParseTuple",
          "new_api": null,
          "old_text": "PyArg_ParseTuple(kv, \"sO:pair\", &limit_param_name,\n                              &limit_param_val)",
          "new_text": null,
          "old_line_content": "        if (!PyArg_ParseTuple(kv, \"sO:pair\", &limit_param_name,",
          "new_line_content": "            derr << __func__ << \" \" << limit_param_name << \" not a string\"",
          "content_same": false
        },
        {
          "line": 1002,
          "old_api": "PyUnicode_Check",
          "new_api": null,
          "old_text": "PyUnicode_Check(limit_param_val)",
          "new_text": null,
          "old_line_content": "          if (!PyUnicode_Check(limit_param_val)) {",
          "new_line_content": "                 << \" not a valid counter type\" << dendl;",
          "content_same": false
        },
        {
          "line": 495,
          "old_api": "set_config",
          "new_api": null,
          "old_text": "without_gil([&] {\n    return self->py_modules->set_config(module, key, val);\n  })",
          "new_text": null,
          "old_line_content": "  auto [ret, msg] = without_gil([&] {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 496,
          "old_api": "set_config",
          "new_api": null,
          "old_text": "self->py_modules->set_config(module, key, val)",
          "new_text": null,
          "old_line_content": "    return self->py_modules->set_config(module, key, val);",
          "new_line_content": "static PyObject*",
          "content_same": false
        },
        {
          "line": 1008,
          "old_api": "find",
          "new_api": null,
          "old_text": "counter_types.find(order_by)",
          "new_text": null,
          "old_line_content": "          auto it = counter_types.find(order_by);",
          "new_line_content": "            derr << __func__ << \" \" << limit_param_name << \" not an int\"",
          "content_same": false
        },
        {
          "line": 1009,
          "old_api": "end",
          "new_api": null,
          "old_text": "counter_types.end()",
          "new_text": null,
          "old_line_content": "          if (it == counter_types.end()) {",
          "new_line_content": "                 << dendl;",
          "content_same": false
        },
        {
          "line": 499,
          "old_api": "c_str",
          "new_api": null,
          "old_text": "msg.c_str()",
          "new_text": null,
          "old_line_content": "    PyErr_SetString(PyExc_ValueError, msg.c_str());",
          "new_line_content": "  char *what = nullptr;",
          "content_same": false
        },
        {
          "line": 1016,
          "old_api": "PyLong_Check",
          "new_api": null,
          "old_text": "PyLong_Check(limit_param_val)",
          "new_text": null,
          "old_line_content": "          if (!PyLong_Check(limit_param_val)) {",
          "new_line_content": "          Py_RETURN_NONE;",
          "content_same": false
        },
        {
          "line": 1021,
          "old_api": "PyLong_AsLong",
          "new_api": null,
          "old_text": "PyLong_AsLong(limit_param_val)",
          "new_text": null,
          "old_line_content": "          limit->max_count = PyLong_AsLong(limit_param_val);",
          "new_line_content": "      Py_RETURN_NONE;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 73,
      "total_additions": 217,
      "total_deletions": 224,
      "total_api_changes": 514
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 14,
        "api_related_lines": 514,
        "non_api_lines": 4,
        "non_api_line_numbers": [
          110,
          101,
          102,
          103
        ]
      }
    },
    "api_calls_before": 368,
    "api_calls_after": 361,
    "diff_info": {
      "added_lines": 5,
      "removed_lines": 14,
      "total_diff_lines": 33
    }
  }
}