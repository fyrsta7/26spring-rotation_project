{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ceph/modified_file/601bcc9db3a1fb8b6798eb528f9b15d7d5388ea4",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ceph/modified_file/601bcc9db3a1fb8b6798eb528f9b15d7d5388ea4/before.h",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ceph/modified_file/601bcc9db3a1fb8b6798eb528f9b15d7d5388ea4/after.h",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ceph/modified_file/601bcc9db3a1fb8b6798eb528f9b15d7d5388ea4/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 103,
          "old_api": "count",
          "new_api": "find",
          "old_text": "segments.count(seq)",
          "new_text": "segments.find(seq)",
          "old_line_content": "    if (segments.count(seq))",
          "new_line_content": "    auto it = segments.find(seq);",
          "content_same": false
        },
        {
          "line": 208,
          "old_api": "_recovery_thread",
          "new_api": "explicit",
          "old_text": "log->_recovery_thread(completion)",
          "new_text": "explicit",
          "old_line_content": "      log->_recovery_thread(completion);",
          "new_line_content": "    explicit RecoveryThread(MDLog *l) : log(l) {}",
          "content_same": false
        },
        {
          "line": 255,
          "old_api": "begin",
          "new_api": "rbegin",
          "old_text": "segments.begin()",
          "new_text": "segments.rbegin()",
          "old_line_content": "    return segments.begin()->second;",
          "new_line_content": "    return segments.rbegin()->first;",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 131,
          "old_api": null,
          "new_api": "empty",
          "old_text": null,
          "new_text": "segments.empty()",
          "old_line_content": "  void cap();",
          "new_line_content": "  bool empty() const { return segments.empty(); }",
          "content_same": false
        },
        {
          "line": 261,
          "old_api": null,
          "new_api": "begin",
          "old_text": null,
          "new_text": "segments.begin()",
          "old_line_content": "  }",
          "new_line_content": "    std::map<uint64_t, LogSegment*>::iterator p = segments.begin();",
          "content_same": false
        },
        {
          "line": 263,
          "old_api": null,
          "new_api": "erase",
          "old_text": null,
          "new_text": "segments.erase(p)",
          "old_line_content": "  int num_events = 0; // in events",
          "new_line_content": "    segments.erase(p);",
          "content_same": false
        },
        {
          "line": 142,
          "old_api": null,
          "new_api": "_start_entry",
          "old_text": null,
          "new_text": "_start_entry(e)",
          "old_line_content": "  void _submit_entry(LogEvent *e, MDSLogContextBase *c);",
          "new_line_content": "    _start_entry(e);",
          "content_same": false
        },
        {
          "line": 148,
          "old_api": null,
          "new_api": "_submit_entry",
          "old_text": null,
          "new_text": "_submit_entry(e, c)",
          "old_line_content": "  void start_submit_entry(LogEvent *e, MDSLogContextBase *c = 0) {",
          "new_line_content": "    _submit_entry(e, c);",
          "content_same": false
        },
        {
          "line": 149,
          "old_api": null,
          "new_api": "notify_all",
          "old_text": null,
          "new_text": "submit_cond.notify_all()",
          "old_line_content": "    std::lock_guard l(submit_mutex);",
          "new_line_content": "    submit_cond.notify_all();",
          "content_same": false
        },
        {
          "line": 153,
          "old_api": null,
          "new_api": "_start_entry",
          "old_text": null,
          "new_text": "_start_entry(e)",
          "old_line_content": "  }",
          "new_line_content": "    _start_entry(e);",
          "content_same": false
        },
        {
          "line": 154,
          "old_api": null,
          "new_api": "_submit_entry",
          "old_text": null,
          "new_text": "_submit_entry(e, c)",
          "old_line_content": "  bool entry_is_open() const { return cur_event != NULL; }",
          "new_line_content": "    _submit_entry(e, c);",
          "content_same": false
        },
        {
          "line": 155,
          "old_api": null,
          "new_api": "notify_all",
          "old_text": null,
          "new_text": "submit_cond.notify_all()",
          "old_line_content": "",
          "new_line_content": "    submit_cond.notify_all();",
          "content_same": false
        },
        {
          "line": 196,
          "old_api": null,
          "new_api": "explicit",
          "old_text": null,
          "new_text": "explicit",
          "old_line_content": "      return 0;",
          "new_line_content": "    explicit ReplayThread(MDLog *l) : log(l) {}",
          "content_same": false
        },
        {
          "line": 198,
          "old_api": null,
          "new_api": "_replay_thread",
          "old_text": null,
          "new_text": "log->_replay_thread()",
          "old_line_content": "  private:",
          "new_line_content": "      log->_replay_thread();",
          "content_same": false
        },
        {
          "line": 211,
          "old_api": null,
          "new_api": "_recovery_thread",
          "old_text": null,
          "new_text": "log->_recovery_thread(completion)",
          "old_line_content": "  private:",
          "new_line_content": "      log->_recovery_thread(completion);",
          "content_same": false
        },
        {
          "line": 221,
          "old_api": null,
          "new_api": "explicit",
          "old_text": null,
          "new_text": "explicit",
          "old_line_content": "      return 0;",
          "new_line_content": "    explicit SubmitThread(MDLog *l) : log(l) {}",
          "content_same": false
        },
        {
          "line": 223,
          "old_api": null,
          "new_api": "_submit_thread",
          "old_text": null,
          "new_text": "log->_submit_thread()",
          "old_line_content": "  private:",
          "new_line_content": "      log->_submit_thread();",
          "content_same": false
        },
        {
          "line": 104,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "segments.end()",
          "old_line_content": "      return segments[seq];",
          "new_line_content": "    if (it != segments.end()) {",
          "content_same": false
        },
        {
          "line": 112,
          "old_api": null,
          "new_api": "empty",
          "old_text": null,
          "new_text": "segments.empty()",
          "old_line_content": "  void flush_logger();",
          "new_line_content": "    return !segments.empty();",
          "content_same": false
        },
        {
          "line": 118,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "segments.size()",
          "old_line_content": "    return events_per_segment;",
          "new_line_content": "  size_t get_num_segments() const { return segments.size(); }",
          "content_same": false
        },
        {
          "line": 247,
          "old_api": null,
          "new_api": "ceph_assert",
          "old_text": null,
          "new_text": "ceph_assert(pos >= safe_pos)",
          "old_line_content": "",
          "new_line_content": "    ceph_assert(pos >= safe_pos);",
          "content_same": false
        },
        {
          "line": 254,
          "old_api": null,
          "new_api": "empty",
          "old_text": null,
          "new_text": "segments.empty()",
          "old_line_content": "  LogSegment *get_oldest_segment() {",
          "new_line_content": "    ceph_assert(!segments.empty());",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 128,
          "old_api": "empty",
          "new_api": null,
          "old_text": "segments.empty()",
          "new_text": null,
          "old_line_content": "  bool empty() const { return segments.empty(); }",
          "new_line_content": "  uint64_t get_write_pos() const;",
          "content_same": false
        },
        {
          "line": 193,
          "old_api": "explicit",
          "new_api": null,
          "old_text": "explicit",
          "new_text": null,
          "old_line_content": "    explicit ReplayThread(MDLog *l) : log(l) {}",
          "new_line_content": "  // -- replay --",
          "content_same": false
        },
        {
          "line": 195,
          "old_api": "_replay_thread",
          "new_api": null,
          "old_text": "log->_replay_thread()",
          "new_text": null,
          "old_line_content": "      log->_replay_thread();",
          "new_line_content": "  public:",
          "content_same": false
        },
        {
          "line": 260,
          "old_api": "erase",
          "new_api": null,
          "old_text": "segments.erase(p)",
          "new_text": null,
          "old_line_content": "    segments.erase(p);",
          "new_line_content": "  void remove_oldest_segment() {",
          "content_same": false
        },
        {
          "line": 139,
          "old_api": "_start_entry",
          "new_api": null,
          "old_text": "_start_entry(e)",
          "new_text": null,
          "old_line_content": "    _start_entry(e);",
          "new_line_content": "  void _start_entry(LogEvent *e);",
          "content_same": false
        },
        {
          "line": 205,
          "old_api": "explicit",
          "new_api": null,
          "old_text": "explicit",
          "new_text": null,
          "old_line_content": "    explicit RecoveryThread(MDLog *l) : log(l) {}",
          "new_line_content": "  // Journal recovery/rewrite logic",
          "content_same": false
        },
        {
          "line": 109,
          "old_api": "empty",
          "new_api": null,
          "old_text": "segments.empty()",
          "new_text": null,
          "old_line_content": "    return !segments.empty();",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 145,
          "old_api": "_submit_entry",
          "new_api": null,
          "old_text": "_submit_entry(e, c)",
          "new_text": null,
          "old_line_content": "    _submit_entry(e, c);",
          "new_line_content": "  void _submit_entry(LogEvent *e, MDSLogContextBase *c);",
          "content_same": false
        },
        {
          "line": 146,
          "old_api": "notify_all",
          "new_api": null,
          "old_text": "submit_cond.notify_all()",
          "new_text": null,
          "old_line_content": "    submit_cond.notify_all();",
          "new_line_content": "  void submit_entry(LogEvent *e, MDSLogContextBase *c = 0) {",
          "content_same": false
        },
        {
          "line": 115,
          "old_api": "size",
          "new_api": null,
          "old_text": "segments.size()",
          "new_text": null,
          "old_line_content": "  size_t get_num_segments() const { return segments.size(); }",
          "new_line_content": "  void flush_logger();",
          "content_same": false
        },
        {
          "line": 244,
          "old_api": "ceph_assert",
          "new_api": null,
          "old_text": "ceph_assert(pos >= safe_pos)",
          "new_text": null,
          "old_line_content": "    ceph_assert(pos >= safe_pos);",
          "new_line_content": "  void set_safe_pos(uint64_t pos)",
          "content_same": false
        },
        {
          "line": 252,
          "old_api": "rbegin",
          "new_api": null,
          "old_text": "segments.rbegin()",
          "new_text": null,
          "old_line_content": "    return segments.rbegin()->first;",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 150,
          "old_api": "_start_entry",
          "new_api": null,
          "old_text": "_start_entry(e)",
          "new_text": null,
          "old_line_content": "    _start_entry(e);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 151,
          "old_api": "_submit_entry",
          "new_api": null,
          "old_text": "_submit_entry(e, c)",
          "new_text": null,
          "old_line_content": "    _submit_entry(e, c);",
          "new_line_content": "  void start_submit_entry(LogEvent *e, MDSLogContextBase *c = 0) {",
          "content_same": false
        },
        {
          "line": 152,
          "old_api": "notify_all",
          "new_api": null,
          "old_text": "submit_cond.notify_all()",
          "new_text": null,
          "old_line_content": "    submit_cond.notify_all();",
          "new_line_content": "    std::lock_guard l(submit_mutex);",
          "content_same": false
        },
        {
          "line": 218,
          "old_api": "explicit",
          "new_api": null,
          "old_text": "explicit",
          "new_text": null,
          "old_line_content": "    explicit SubmitThread(MDLog *l) : log(l) {}",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 251,
          "old_api": "empty",
          "new_api": null,
          "old_text": "segments.empty()",
          "new_text": null,
          "old_line_content": "    ceph_assert(!segments.empty());",
          "new_line_content": "  void _submit_thread();",
          "content_same": false
        },
        {
          "line": 220,
          "old_api": "_submit_thread",
          "new_api": null,
          "old_text": "log->_submit_thread()",
          "new_text": null,
          "old_line_content": "      log->_submit_thread();",
          "new_line_content": "  public:",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 3,
      "total_additions": 19,
      "total_deletions": 18,
      "total_api_changes": 40
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 6,
        "api_related_lines": 40,
        "non_api_lines": 4,
        "non_api_line_numbers": [
          105,
          106,
          107,
          108
        ]
      }
    },
    "api_calls_before": 32,
    "api_calls_after": 33,
    "diff_info": {
      "added_lines": 6,
      "removed_lines": 3,
      "total_diff_lines": 21
    }
  }
}