{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ceph/modified_file/26bb7bc6e6827a3db7611218f4b23b15feb42648",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ceph/modified_file/26bb7bc6e6827a3db7611218f4b23b15feb42648/before.cc",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ceph/modified_file/26bb7bc6e6827a3db7611218f4b23b15feb42648/after.cc",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/ceph/modified_file/26bb7bc6e6827a3db7611218f4b23b15feb42648/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 1763,
          "old_api": "compare",
          "new_api": "exists",
          "old_text": "mm.compare(\"delete\")",
          "new_text": "s->info.args.exists(\"extract-archive\")",
          "old_line_content": "  const bool multipart_delete = (mm.compare(\"delete\") == 0);",
          "new_line_content": "                                s->info.args.exists(\"extract-archive\");",
          "content_same": false
        },
        {
          "line": 1868,
          "old_api": "get_type",
          "new_api": "get_identity_type",
          "old_text": "op->get_type()",
          "new_text": "s->auth.identity->get_identity_type()",
          "old_line_content": "  if (op->get_type() == RGW_OP_CREATE_BUCKET) {",
          "new_line_content": "    if (! s->user->get_id().empty() && s->auth.identity->get_identity_type() != TYPE_ROLE) {",
          "content_same": false
        },
        {
          "line": 1870,
          "old_api": "get_identity_type",
          "new_api": "read_attrs",
          "old_text": "s->auth.identity->get_identity_type()",
          "new_text": "s->user->read_attrs(s, y)",
          "old_line_content": "    if (! s->user->get_id().empty() && s->auth.identity->get_identity_type() != TYPE_ROLE) {",
          "new_line_content": "        if (auto ret = s->user->read_attrs(s, y); ! ret) {",
          "content_same": false
        },
        {
          "line": 1872,
          "old_api": "read_attrs",
          "new_api": "end",
          "old_text": "s->user->read_attrs(s, y)",
          "new_text": "s->iam_user_policies.end()",
          "old_line_content": "        if (auto ret = s->user->read_attrs(s, y); ! ret) {",
          "new_line_content": "          s->iam_user_policies.insert(s->iam_user_policies.end(),",
          "content_same": false
        },
        {
          "line": 1873,
          "old_api": "get_tenant",
          "new_api": "begin",
          "old_text": "s->user->get_tenant()",
          "new_text": "user_policies.begin()",
          "old_line_content": "          auto user_policies = get_iam_user_policy_from_attr(s->cct, s->user->get_attrs(), s->user->get_tenant());",
          "new_line_content": "                                      std::make_move_iterator(user_policies.begin()),",
          "content_same": false
        },
        {
          "line": 1950,
          "old_api": "find",
          "new_api": "size",
          "old_text": "r.find('/', 1)",
          "new_text": "r.size()",
          "old_line_content": "  size_t pos = r.find('/', 1);",
          "new_line_content": "  while (pos != r.size() - 1 && pos != string::npos) {",
          "content_same": false
        },
        {
          "line": 1953,
          "old_api": "substr",
          "new_api": "find",
          "old_text": "r.substr(0, pos)",
          "new_text": "resource_mgrs.find(s)",
          "old_line_content": "    string s = r.substr(0, pos);",
          "new_line_content": "    iter = resource_mgrs.find(s);",
          "content_same": false
        },
        {
          "line": 1956,
          "old_api": "end",
          "new_api": "size",
          "old_text": "resource_mgrs.end()",
          "new_text": "s.size()",
          "old_line_content": "    if (iter == resource_mgrs.end()) { /* only register it if one does not exist */",
          "new_line_content": "      resources_by_size.insert(pair<size_t, string>(s.size(), s));",
          "content_same": false
        },
        {
          "line": 1979,
          "old_api": "rend",
          "new_api": "compare",
          "old_text": "resources_by_size.rend()",
          "new_text": "uri.compare(0, iter->first, resource)",
          "old_line_content": "  for (iter = resources_by_size.rbegin(); iter != resources_by_size.rend(); ++iter) {",
          "new_line_content": "    if (uri.compare(0, iter->first, resource) == 0 &&",
          "content_same": false
        },
        {
          "line": 1982,
          "old_api": "size",
          "new_api": "substr",
          "old_text": "uri.size()",
          "new_text": "uri.substr(iter->first)",
          "old_line_content": "\t(uri.size() == iter->first ||",
          "new_line_content": "      std::string suffix = uri.substr(iter->first);",
          "content_same": false
        },
        {
          "line": 1998,
          "old_api": "get_str_vec",
          "new_api": "boost::algorithm::to_upper(hdr)",
          "old_text": "get_str_vec(s_headers)",
          "new_text": "boost::algorithm::to_upper(hdr)",
          "old_line_content": "  std::vector<std::string> hdrs = get_str_vec(s_headers);",
          "new_line_content": "    boost::algorithm::to_upper(hdr); // XXX",
          "content_same": false
        },
        {
          "line": 2052,
          "old_api": "end",
          "new_api": "begin",
          "old_text": "apis.end()",
          "new_text": "apis.begin()",
          "old_line_content": "  auto api_s3_priority_rawpos = std::find(apis.begin(), apis.end(), \"s3\");",
          "new_line_content": "    api_priority_s3 = apis.size() - std::distance(apis.begin(), api_s3_priority_rawpos);",
          "content_same": false
        },
        {
          "line": 2054,
          "old_api": "begin",
          "new_api": "end",
          "old_text": "apis.begin()",
          "new_text": "apis.end()",
          "old_line_content": "    api_priority_s3 = apis.size() - std::distance(apis.begin(), api_s3_priority_rawpos);",
          "new_line_content": "  if (api_s3website_priority_rawpos != apis.end()) {",
          "content_same": false
        },
        {
          "line": 2057,
          "old_api": "begin",
          "new_api": "ldpp_dout",
          "old_text": "apis.begin()",
          "new_text": "ldpp_dout(s, 10)",
          "old_line_content": "    api_priority_s3website = apis.size() - std::distance(apis.begin(), api_s3website_priority_rawpos);",
          "new_line_content": "  ldpp_dout(s, 10) << \"rgw api priority: s3=\" << api_priority_s3 << \" s3website=\" << api_priority_s3website << dendl;",
          "content_same": false
        },
        {
          "line": 2062,
          "old_api": "size",
          "new_api": "find",
          "old_text": "info.host.size()",
          "new_text": "info.host.find('[')",
          "old_line_content": "  if (info.host.size()) {",
          "new_line_content": "    if (info.host.find('[') == 0) {",
          "content_same": false
        },
        {
          "line": 2065,
          "old_api": "find",
          "new_api": "substr",
          "old_text": "info.host.find(']')",
          "new_text": "info.host.substr(1, pos-1)",
          "old_line_content": "      pos = info.host.find(']');",
          "new_line_content": "        info.host = info.host.substr(1, pos-1);",
          "content_same": false
        },
        {
          "line": 2070,
          "old_api": "find",
          "new_api": "substr",
          "old_text": "info.host.find(':')",
          "new_text": "info.host.substr(0, pos)",
          "old_line_content": "      pos = info.host.find(':');",
          "new_line_content": "        info.host = info.host.substr(0, pos);",
          "content_same": false
        },
        {
          "line": 2105,
          "old_api": "resolve_cname",
          "new_api": "ldpp_dout",
          "old_text": "rgw_resolver->resolve_cname(info.host, cname, &found)",
          "new_text": "ldpp_dout(s, 0)",
          "old_line_content": "      int r = rgw_resolver->resolve_cname(info.host, cname, &found);",
          "new_line_content": "\tldpp_dout(s, 0)",
          "content_same": false
        },
        {
          "line": 2150,
          "old_api": "empty",
          "new_api": "c_str",
          "old_text": "subdomain.empty()",
          "new_text": "info.host.c_str()",
          "old_line_content": "    if (subdomain.empty()",
          "new_line_content": "        && !looks_like_ip_address(info.host.c_str())",
          "content_same": false
        },
        {
          "line": 2151,
          "old_api": "empty",
          "new_api": "RGWHandler_REST::validate_bucket_name(info.host)",
          "old_text": "domain.empty()",
          "new_text": "RGWHandler_REST::validate_bucket_name(info.host)",
          "old_line_content": "        && (domain.empty() || domain != info.host)",
          "new_line_content": "        && RGWHandler_REST::validate_bucket_name(info.host) == 0",
          "content_same": false
        },
        {
          "line": 2152,
          "old_api": "c_str",
          "new_api": "empty",
          "old_text": "info.host.c_str()",
          "new_text": "hostnames_s3website_set.empty()",
          "old_line_content": "        && !looks_like_ip_address(info.host.c_str())",
          "new_line_content": "        && !(hostnames_set.empty() && hostnames_s3website_set.empty())) {",
          "content_same": false
        },
        {
          "line": 2153,
          "old_api": "RGWHandler_REST::validate_bucket_name(info.host)",
          "new_api": "append",
          "old_text": "RGWHandler_REST::validate_bucket_name(info.host)",
          "new_text": "subdomain.append(info.host)",
          "old_line_content": "        && RGWHandler_REST::validate_bucket_name(info.host) == 0",
          "new_line_content": "      subdomain.append(info.host);",
          "content_same": false
        },
        {
          "line": 2168,
          "old_api": "empty",
          "new_api": "append",
          "old_text": "subdomain.empty()",
          "new_text": "encoded_bucket.append(subdomain)",
          "old_line_content": "    if (in_hosted_domain && !subdomain.empty()) {",
          "new_line_content": "      encoded_bucket.append(subdomain);",
          "content_same": false
        },
        {
          "line": 2196,
          "old_api": "url_decode",
          "new_api": "length",
          "old_text": "url_decode(s->info.request_uri)",
          "new_text": "s->decoded_uri.length()",
          "old_line_content": "  s->decoded_uri = url_decode(s->info.request_uri);",
          "new_line_content": "  if (std::strlen(s->decoded_uri.c_str()) != s->decoded_uri.length()) {",
          "content_same": false
        },
        {
          "line": 2259,
          "old_api": "strict_strtoll",
          "new_api": "ldpp_dout",
          "old_text": "strict_strtoll(s->length, 10, &err)",
          "new_text": "ldpp_dout(s, 10)",
          "old_line_content": "      s->content_length = strict_strtoll(s->length, 10, &err);",
          "new_line_content": "\tldpp_dout(s, 10) << \"bad content length, aborting\" << dendl;",
          "content_same": false
        },
        {
          "line": 2273,
          "old_api": "end",
          "new_api": "c_str",
          "old_text": "generic_attrs_map.end()",
          "new_text": "giter->first.c_str()",
          "old_line_content": "  for (giter = generic_attrs_map.begin(); giter != generic_attrs_map.end();",
          "new_line_content": "    const char *env = info.env->get(giter->first.c_str());",
          "content_same": false
        },
        {
          "line": 2281,
          "old_api": "g_conf",
          "new_api": "strcasecmp",
          "old_text": "g_conf()",
          "new_text": "strcasecmp(expect, \"100-continue\")",
          "old_line_content": "  if (g_conf()->rgw_print_continue) {",
          "new_line_content": "    s->expect_cont = (expect && !strcasecmp(expect, \"100-continue\"));",
          "content_same": false
        },
        {
          "line": 2283,
          "old_api": "strcasecmp",
          "new_api": "op_from_method",
          "old_text": "strcasecmp(expect, \"100-continue\")",
          "new_text": "op_from_method(info.method)",
          "old_line_content": "    s->expect_cont = (expect && !strcasecmp(expect, \"100-continue\"));",
          "new_line_content": "  s->op = op_from_method(info.method);",
          "content_same": false
        },
        {
          "line": 2285,
          "old_api": "op_from_method",
          "new_api": "init_meta_info",
          "old_text": "op_from_method(info.method)",
          "new_text": "info.init_meta_info(s, &s->has_bad_meta)",
          "old_line_content": "  s->op = op_from_method(info.method);",
          "new_line_content": "  info.init_meta_info(s, &s->has_bad_meta);",
          "content_same": false
        },
        {
          "line": 2323,
          "old_api": "name",
          "new_api": "init",
          "old_text": "typeid(*handler).name()",
          "new_text": "handler->init(driver, s, rio)",
          "old_line_content": "  ldpp_dout(s, 20) << __func__ << \" handler=\" << typeid(*handler).name() << dendl;",
          "new_line_content": "  *init_error = handler->init(driver, s, rio);",
          "content_same": false
        },
        {
          "line": 2325,
          "old_api": "init",
          "new_api": "put_handler",
          "old_text": "handler->init(driver, s, rio)",
          "new_text": "m->put_handler(handler)",
          "old_line_content": "  *init_error = handler->init(driver, s, rio);",
          "new_line_content": "    m->put_handler(handler);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 2049,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "apis.end()",
          "old_line_content": "  int api_priority_s3 = -1;",
          "new_line_content": "  auto api_s3website_priority_rawpos = std::find(apis.begin(), apis.end(), \"s3website\");",
          "content_same": false
        },
        {
          "line": 2050,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "apis.end()",
          "old_line_content": "  int api_priority_s3website = -1;",
          "new_line_content": "  auto api_s3_priority_rawpos = std::find(apis.begin(), apis.end(), \"s3\");",
          "content_same": false
        },
        {
          "line": 2055,
          "old_api": null,
          "new_api": "begin",
          "old_text": null,
          "new_text": "apis.begin()",
          "old_line_content": "  }",
          "new_line_content": "    api_priority_s3website = apis.size() - std::distance(apis.begin(), api_s3website_priority_rawpos);",
          "content_same": false
        },
        {
          "line": 2060,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "info.host.size()",
          "old_line_content": "  bool s3website_enabled = api_priority_s3website >= 0;",
          "new_line_content": "  if (info.host.size()) {",
          "content_same": false
        },
        {
          "line": 2063,
          "old_api": null,
          "new_api": "find",
          "old_text": null,
          "new_text": "info.host.find(']')",
          "old_line_content": "    ssize_t pos;",
          "new_line_content": "      pos = info.host.find(']');",
          "content_same": false
        },
        {
          "line": 2068,
          "old_api": null,
          "new_api": "find",
          "old_text": null,
          "new_text": "info.host.find(':')",
          "old_line_content": "      }",
          "new_line_content": "      pos = info.host.find(':');",
          "content_same": false
        },
        {
          "line": 2073,
          "old_api": null,
          "new_api": "ldpp_dout",
          "old_text": null,
          "new_text": "ldpp_dout(s, 10)",
          "old_line_content": "      }",
          "new_line_content": "    ldpp_dout(s, 10) << \"host=\" << info.host << dendl;",
          "content_same": false
        },
        {
          "line": 2077,
          "old_api": null,
          "new_api": "rgw_find_host_in_domains",
          "old_text": null,
          "new_text": "rgw_find_host_in_domains(info.host, &domain, &subdomain, hostnames_set)",
          "old_line_content": "    string subdomain;",
          "new_line_content": "    bool in_hosted_domain = rgw_find_host_in_domains(info.host, &domain, &subdomain, hostnames_set);",
          "content_same": false
        },
        {
          "line": 2083,
          "old_api": null,
          "new_api": "rgw_find_host_in_domains",
          "old_text": null,
          "new_text": "rgw_find_host_in_domains(info.host, &s3website_domain, &s3website_subdomain, hostnames_s3website_set)",
          "old_line_content": "",
          "new_line_content": "      in_hosted_domain_s3website = rgw_find_host_in_domains(info.host, &s3website_domain, &s3website_subdomain, hostnames_s3website_set);",
          "content_same": false
        },
        {
          "line": 2091,
          "old_api": null,
          "new_api": "ldpp_dout",
          "old_text": null,
          "new_text": "ldpp_dout(s, 20)",
          "old_line_content": "    }",
          "new_line_content": "    ldpp_dout(s, 20)",
          "content_same": false
        },
        {
          "line": 2098,
          "old_api": null,
          "new_api": "g_conf",
          "old_text": null,
          "new_text": "g_conf()",
          "old_line_content": "      << dendl;",
          "new_line_content": "    if (g_conf()->rgw_resolve_cname",
          "content_same": false
        },
        {
          "line": 2103,
          "old_api": null,
          "new_api": "resolve_cname",
          "old_text": null,
          "new_text": "rgw_resolver->resolve_cname(info.host, cname, &found)",
          "old_line_content": "      string cname;",
          "new_line_content": "      int r = rgw_resolver->resolve_cname(info.host, cname, &found);",
          "content_same": false
        },
        {
          "line": 2111,
          "old_api": null,
          "new_api": "ldpp_dout",
          "old_text": null,
          "new_text": "ldpp_dout(s, 5)",
          "old_line_content": "",
          "new_line_content": "\tldpp_dout(s, 5) << \"resolved host cname \" << info.host << \" -> \"",
          "content_same": false
        },
        {
          "line": 2114,
          "old_api": null,
          "new_api": "rgw_find_host_in_domains",
          "old_text": null,
          "new_text": "rgw_find_host_in_domains(cname, &domain, &subdomain, hostnames_set)",
          "old_line_content": "\t\t\t << cname << dendl;",
          "new_line_content": "\t  rgw_find_host_in_domains(cname, &domain, &subdomain, hostnames_set);",
          "content_same": false
        },
        {
          "line": 2119,
          "old_api": null,
          "new_api": "rgw_find_host_in_domains",
          "old_text": null,
          "new_text": "rgw_find_host_in_domains(cname, &s3website_domain,\n\t\t\t\t     &s3website_subdomain,\n\t\t\t\t     hostnames_s3website_set)",
          "old_line_content": "\t    && !in_hosted_domain_s3website) {",
          "new_line_content": "\t    rgw_find_host_in_domains(cname, &s3website_domain,",
          "content_same": false
        },
        {
          "line": 2130,
          "old_api": null,
          "new_api": "ldpp_dout",
          "old_text": null,
          "new_text": "ldpp_dout(s, 20)",
          "old_line_content": "        }",
          "new_line_content": "        ldpp_dout(s, 20)",
          "content_same": false
        },
        {
          "line": 2148,
          "old_api": null,
          "new_api": "empty",
          "old_text": null,
          "new_text": "subdomain.empty()",
          "old_line_content": "    // - Also check that the Host header is a valid bucket name before using it.",
          "new_line_content": "    if (subdomain.empty()",
          "content_same": false
        },
        {
          "line": 2149,
          "old_api": null,
          "new_api": "empty",
          "old_text": null,
          "new_text": "domain.empty()",
          "old_line_content": "    // - Don't enable virtual hosting if no hostnames are configured",
          "new_line_content": "        && (domain.empty() || domain != info.host)",
          "content_same": false
        },
        {
          "line": 2166,
          "old_api": null,
          "new_api": "empty",
          "old_text": null,
          "new_text": "subdomain.empty()",
          "old_line_content": "",
          "new_line_content": "    if (in_hosted_domain && !subdomain.empty()) {",
          "content_same": false
        },
        {
          "line": 2171,
          "old_api": null,
          "new_api": "append",
          "old_text": null,
          "new_text": "encoded_bucket.append(s->info.request_uri)",
          "old_line_content": "      if (s->info.request_uri[0] != '/')",
          "new_line_content": "      encoded_bucket.append(s->info.request_uri);",
          "content_same": false
        },
        {
          "line": 2175,
          "old_api": null,
          "new_api": "empty",
          "old_text": null,
          "new_text": "domain.empty()",
          "old_line_content": "    }",
          "new_line_content": "    if (!domain.empty()) {",
          "content_same": false
        },
        {
          "line": 2179,
          "old_api": null,
          "new_api": "ldpp_dout",
          "old_text": null,
          "new_text": "ldpp_dout(s, 20)",
          "old_line_content": "    }",
          "new_line_content": "    ldpp_dout(s, 20)",
          "content_same": false
        },
        {
          "line": 2190,
          "old_api": null,
          "new_api": "empty",
          "old_text": null,
          "new_text": "s->info.domain.empty()",
          "old_line_content": "  }",
          "new_line_content": "  if (s->info.domain.empty()) {",
          "content_same": false
        },
        {
          "line": 2194,
          "old_api": null,
          "new_api": "url_decode",
          "old_text": null,
          "new_text": "url_decode(s->info.request_uri)",
          "old_line_content": "  }",
          "new_line_content": "  s->decoded_uri = url_decode(s->info.request_uri);",
          "content_same": false
        },
        {
          "line": 2215,
          "old_api": null,
          "new_api": "get",
          "old_text": null,
          "new_text": "info.env->get(\"CONTENT_LENGTH\")",
          "old_line_content": "   * both headers and can't always simply pick A or B.",
          "new_line_content": "  const char* content_length = info.env->get(\"CONTENT_LENGTH\");",
          "content_same": false
        },
        {
          "line": 2216,
          "old_api": null,
          "new_api": "get",
          "old_text": null,
          "new_text": "info.env->get(\"HTTP_CONTENT_LENGTH\")",
          "old_line_content": "   */",
          "new_line_content": "  const char* http_content_length = info.env->get(\"HTTP_CONTENT_LENGTH\");",
          "content_same": false
        },
        {
          "line": 2225,
          "old_api": null,
          "new_api": "parse_content_length",
          "old_text": null,
          "new_text": "parse_content_length(content_length)",
          "old_line_content": "    int64_t content_length_i, http_content_length_i;",
          "new_line_content": "    content_length_i = parse_content_length(content_length);",
          "content_same": false
        },
        {
          "line": 2226,
          "old_api": null,
          "new_api": "parse_content_length",
          "old_text": null,
          "new_text": "parse_content_length(http_content_length)",
          "old_line_content": "",
          "new_line_content": "    http_content_length_i = parse_content_length(http_content_length);",
          "content_same": false
        },
        {
          "line": 1732,
          "old_api": null,
          "new_api": "find",
          "old_text": null,
          "new_text": "format.find(';')",
          "old_line_content": "        for (; i < sizeof(format_buf) - 1 && accept[i] && accept[i] != ';'; ++i) {",
          "new_line_content": "        format = format.substr(0, format.find(';'));",
          "content_same": false
        },
        {
          "line": 1744,
          "old_api": null,
          "new_api": "RGWHandler_REST::reallocate_formatter(s, type)",
          "old_text": null,
          "new_text": "RGWHandler_REST::reallocate_formatter(s, type)",
          "old_line_content": "    }",
          "new_line_content": "  return RGWHandler_REST::reallocate_formatter(s, type);",
          "content_same": false
        },
        {
          "line": 2257,
          "old_api": null,
          "new_api": "strict_strtoll",
          "old_text": null,
          "new_text": "strict_strtoll(s->length, 10, &err)",
          "old_line_content": "    } else {",
          "new_line_content": "      s->content_length = strict_strtoll(s->length, 10, &err);",
          "content_same": false
        },
        {
          "line": 2258,
          "old_api": null,
          "new_api": "empty",
          "old_text": null,
          "new_text": "err.empty()",
          "old_line_content": "      string err;",
          "new_line_content": "      if (!err.empty()) {",
          "content_same": false
        },
        {
          "line": 1751,
          "old_api": null,
          "new_api": "ceph_assert",
          "old_text": null,
          "new_text": "ceph_assert(s->formatter)",
          "old_line_content": "  if (s->format == type) {",
          "new_line_content": "    ceph_assert(s->formatter);",
          "content_same": false
        },
        {
          "line": 1752,
          "old_api": null,
          "new_api": "reset",
          "old_text": null,
          "new_text": "s->formatter->reset()",
          "old_line_content": "    // do nothing, just reset",
          "new_line_content": "    s->formatter->reset();",
          "content_same": false
        },
        {
          "line": 2266,
          "old_api": null,
          "new_api": "ldpp_dout",
          "old_text": null,
          "new_text": "ldpp_dout(s, 10)",
          "old_line_content": "",
          "new_line_content": "    ldpp_dout(s, 10) << \"negative content length, aborting\" << dendl;",
          "content_same": false
        },
        {
          "line": 2271,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "generic_attrs_map.end()",
          "old_line_content": "",
          "new_line_content": "  for (giter = generic_attrs_map.begin(); giter != generic_attrs_map.end();",
          "content_same": false
        },
        {
          "line": 1760,
          "old_api": null,
          "new_api": "get",
          "old_text": null,
          "new_text": "s->info.args.get(\"multipart-manifest\")",
          "old_line_content": "  s->format = type;",
          "new_line_content": "  const string& mm = s->info.args.get(\"multipart-manifest\");",
          "content_same": false
        },
        {
          "line": 1761,
          "old_api": null,
          "new_api": "compare",
          "old_text": null,
          "new_text": "mm.compare(\"delete\")",
          "old_line_content": "",
          "new_line_content": "  const bool multipart_delete = (mm.compare(\"delete\") == 0);",
          "content_same": false
        },
        {
          "line": 2279,
          "old_api": null,
          "new_api": "g_conf",
          "old_text": null,
          "new_text": "g_conf()",
          "old_line_content": "  }",
          "new_line_content": "  if (g_conf()->rgw_print_continue) {",
          "content_same": false
        },
        {
          "line": 2280,
          "old_api": null,
          "new_api": "get",
          "old_text": null,
          "new_text": "info.env->get(\"HTTP_EXPECT\")",
          "old_line_content": "",
          "new_line_content": "    const char *expect = info.env->get(\"HTTP_EXPECT\");",
          "content_same": false
        },
        {
          "line": 1767,
          "old_api": null,
          "new_api": "exists",
          "old_text": null,
          "new_text": "s->info.args.exists(\"bulk-delete\")",
          "old_line_content": "    case RGWFormat::PLAIN:",
          "new_line_content": "        const bool use_kv_syntax = s->info.args.exists(\"bulk-delete\") ||",
          "content_same": false
        },
        {
          "line": 1774,
          "old_api": null,
          "new_api": "exists",
          "old_text": null,
          "new_text": "s->info.args.exists(\"bulk-delete\")",
          "old_line_content": "    case RGWFormat::XML:",
          "new_line_content": "        const bool lowercase_underscore = s->info.args.exists(\"bulk-delete\") ||",
          "content_same": false
        },
        {
          "line": 2299,
          "old_api": null,
          "new_api": "preprocess",
          "old_text": null,
          "new_text": "preprocess(s, rio)",
          "old_line_content": "  int* const init_error",
          "new_line_content": "  *init_error = preprocess(s, rio);",
          "content_same": false
        },
        {
          "line": 2304,
          "old_api": null,
          "new_api": "get_manager",
          "old_text": null,
          "new_text": "mgr.get_manager(s, frontend_prefix, s->decoded_uri,\n                                  &s->relative_uri)",
          "old_line_content": "  }",
          "new_line_content": "  RGWRESTMgr *m = mgr.get_manager(s, frontend_prefix, s->decoded_uri,",
          "content_same": false
        },
        {
          "line": 1798,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "bucket.size()",
          "old_line_content": "int RGWHandler_REST::validate_bucket_name(const string& bucket)",
          "new_line_content": "  int len = bucket.size();",
          "content_same": false
        },
        {
          "line": 2315,
          "old_api": null,
          "new_api": "get_handler",
          "old_text": null,
          "new_text": "m->get_handler(driver, s, auth_registry, frontend_prefix)",
          "old_line_content": "  }",
          "new_line_content": "  RGWHandler_REST* handler = m->get_handler(driver, s, auth_registry, frontend_prefix);",
          "content_same": false
        },
        {
          "line": 2321,
          "old_api": null,
          "new_api": "name",
          "old_text": null,
          "new_text": "typeid(*handler).name()",
          "old_line_content": "  }",
          "new_line_content": "  ldpp_dout(s, 20) << __func__ << \" handler=\" << typeid(*handler).name() << dendl;",
          "content_same": false
        },
        {
          "line": 1812,
          "old_api": null,
          "new_api": "c_str",
          "old_text": null,
          "new_text": "bucket.c_str()",
          "old_line_content": "  }",
          "new_line_content": "  const char *s = bucket.c_str();",
          "content_same": false
        },
        {
          "line": 1829,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "object.size()",
          "old_line_content": "int RGWHandler_REST::validate_object_name(const string& object)",
          "new_line_content": "  int len = object.size();",
          "content_same": false
        },
        {
          "line": 1835,
          "old_api": null,
          "new_api": "c_str",
          "old_text": null,
          "new_text": "object.c_str()",
          "old_line_content": "  }",
          "new_line_content": "  if (check_utf8(object.c_str(), len)) {",
          "content_same": false
        },
        {
          "line": 1846,
          "old_api": null,
          "new_api": "strcmp",
          "old_text": null,
          "new_text": "strcmp(method, \"GET\")",
          "old_line_content": "  if (!method)",
          "new_line_content": "  if (strcmp(method, \"GET\") == 0)",
          "content_same": false
        },
        {
          "line": 1866,
          "old_api": null,
          "new_api": "get_type",
          "old_text": null,
          "new_text": "op->get_type()",
          "old_line_content": "int RGWHandler_REST::init_permissions(RGWOp* op, optional_yield y)",
          "new_line_content": "  if (op->get_type() == RGW_OP_CREATE_BUCKET) {",
          "content_same": false
        },
        {
          "line": 1871,
          "old_api": null,
          "new_api": "get_tenant",
          "old_text": null,
          "new_text": "s->user->get_tenant()",
          "old_line_content": "      try {",
          "new_line_content": "          auto user_policies = get_iam_user_policy_from_attr(s->cct, s->user->get_attrs(), s->user->get_tenant());",
          "content_same": false
        },
        {
          "line": 1878,
          "old_api": null,
          "new_api": "what",
          "old_text": null,
          "new_text": "e.what()",
          "old_line_content": "        }",
          "new_line_content": "        ldpp_dout(op, -1) << \"Error reading IAM User Policy: \" << e.what() << dendl;",
          "content_same": false
        },
        {
          "line": 1881,
          "old_api": null,
          "new_api": "rgw_build_iam_environment",
          "old_text": null,
          "new_text": "rgw_build_iam_environment(driver, s)",
          "old_line_content": "      }",
          "new_line_content": "    rgw_build_iam_environment(driver, s);",
          "content_same": false
        },
        {
          "line": 1885,
          "old_api": null,
          "new_api": "do_init_permissions",
          "old_text": null,
          "new_text": "do_init_permissions(op, y)",
          "old_line_content": "  }",
          "new_line_content": "  return do_init_permissions(op, y);",
          "content_same": false
        },
        {
          "line": 1901,
          "old_api": null,
          "new_api": "exists",
          "old_text": null,
          "new_text": "s->info.args.exists(\"delete\")",
          "old_line_content": "  case OP_COPY:",
          "new_line_content": "    if (s->info.args.exists(\"delete\")) {",
          "content_same": false
        },
        {
          "line": 1905,
          "old_api": null,
          "new_api": "is_obj_update_op",
          "old_text": null,
          "new_text": "is_obj_update_op()",
          "old_line_content": "      break;",
          "new_line_content": "    if (is_obj_update_op()) {",
          "content_same": false
        },
        {
          "line": 1910,
          "old_api": null,
          "new_api": "get_type",
          "old_text": null,
          "new_text": "op_obj->get_type()",
          "old_line_content": "    }",
          "new_line_content": "    if (op_obj->get_type() == RGW_OP_CREATE_BUCKET)",
          "content_same": false
        },
        {
          "line": 1916,
          "old_api": null,
          "new_api": "exists",
          "old_text": null,
          "new_text": "s->info.args.exists(\"tagging\")",
          "old_line_content": "    break;",
          "new_line_content": "    if (!s->info.args.exists(\"tagging\")){",
          "content_same": false
        },
        {
          "line": 1927,
          "old_api": null,
          "new_api": "do_read_permissions",
          "old_text": null,
          "new_text": "do_read_permissions(op_obj, only_bucket, y)",
          "old_line_content": "  }",
          "new_line_content": "  return do_read_permissions(op_obj, only_bucket, y);",
          "content_same": false
        },
        {
          "line": 1933,
          "old_api": null,
          "new_api": "append",
          "old_text": null,
          "new_text": "r.append(resource)",
          "old_line_content": "{",
          "new_line_content": "  r.append(resource);",
          "content_same": false
        },
        {
          "line": 1936,
          "old_api": null,
          "new_api": "find",
          "old_text": null,
          "new_text": "resource_mgrs.find(r)",
          "old_line_content": "",
          "new_line_content": "  map<string, RGWRESTMgr *>::iterator iter = resource_mgrs.find(r);",
          "content_same": false
        },
        {
          "line": 1937,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "resource_mgrs.end()",
          "old_line_content": "  /* do we have a resource manager registered for this entry point? */",
          "new_line_content": "  if (iter != resource_mgrs.end()) {",
          "content_same": false
        },
        {
          "line": 1941,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "r.size()",
          "old_line_content": "  }",
          "new_line_content": "  resources_by_size.insert(pair<size_t, string>(r.size(), r));",
          "content_same": false
        },
        {
          "line": 1948,
          "old_api": null,
          "new_api": "find",
          "old_text": null,
          "new_text": "r.find('/', 1)",
          "old_line_content": "   */",
          "new_line_content": "  size_t pos = r.find('/', 1);",
          "content_same": false
        },
        {
          "line": 1951,
          "old_api": null,
          "new_api": "substr",
          "old_text": null,
          "new_text": "r.substr(0, pos)",
          "old_line_content": "",
          "new_line_content": "    string s = r.substr(0, pos);",
          "content_same": false
        },
        {
          "line": 1954,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "resource_mgrs.end()",
          "old_line_content": "",
          "new_line_content": "    if (iter == resource_mgrs.end()) { /* only register it if one does not exist */",
          "content_same": false
        },
        {
          "line": 1959,
          "old_api": null,
          "new_api": "find",
          "old_text": null,
          "new_text": "r.find('/', pos + 1)",
          "old_line_content": "    }",
          "new_line_content": "    pos = r.find('/', pos + 1);",
          "content_same": false
        },
        {
          "line": 1977,
          "old_api": null,
          "new_api": "rend",
          "old_text": null,
          "new_text": "resources_by_size.rend()",
          "old_line_content": "  multimap<size_t, string>::reverse_iterator iter;",
          "new_line_content": "  for (iter = resources_by_size.rbegin(); iter != resources_by_size.rend(); ++iter) {",
          "content_same": false
        },
        {
          "line": 1980,
          "old_api": null,
          "new_api": "size",
          "old_text": null,
          "new_text": "uri.size()",
          "old_line_content": "    string& resource = iter->second;",
          "new_line_content": "\t(uri.size() == iter->first ||",
          "content_same": false
        },
        {
          "line": 1983,
          "old_api": null,
          "new_api": "get_resource_mgr",
          "old_text": null,
          "new_text": "resource_mgrs[resource]->get_resource_mgr(s, suffix, out_uri)",
          "old_line_content": "\t uri[iter->first] == '/')) {",
          "new_line_content": "      return resource_mgrs[resource]->get_resource_mgr(s, suffix, out_uri);",
          "content_same": false
        },
        {
          "line": 1988,
          "old_api": null,
          "new_api": "get_resource_mgr_as_default",
          "old_text": null,
          "new_text": "default_mgr->get_resource_mgr_as_default(s, uri, out_uri)",
          "old_line_content": "",
          "new_line_content": "    return default_mgr->get_resource_mgr_as_default(s, uri, out_uri);",
          "content_same": false
        },
        {
          "line": 1996,
          "old_api": null,
          "new_api": "get_str_vec",
          "old_text": null,
          "new_text": "get_str_vec(s_headers)",
          "old_line_content": "void RGWREST::register_x_headers(const string& s_headers)",
          "new_line_content": "  std::vector<std::string> hdrs = get_str_vec(s_headers);",
          "content_same": false
        },
        {
          "line": 1999,
          "old_api": null,
          "new_api": "insert",
          "old_text": null,
          "new_text": "x_headers.insert(hdr)",
          "old_line_content": "  for (auto& hdr : hdrs) {",
          "new_line_content": "    (void) x_headers.insert(hdr);",
          "content_same": false
        },
        {
          "line": 2006,
          "old_api": null,
          "new_api": "end",
          "old_text": null,
          "new_text": "resource_mgrs.end()",
          "old_line_content": "{",
          "new_line_content": "  for (iter = resource_mgrs.begin(); iter != resource_mgrs.end(); ++iter) {",
          "content_same": false
        },
        {
          "line": 2020,
          "old_api": null,
          "new_api": "strict_strtoll",
          "old_text": null,
          "new_text": "strict_strtoll(content_length, 10, &err)",
          "old_line_content": "  } else {",
          "new_line_content": "    len = strict_strtoll(content_length, 10, &err);",
          "content_same": false
        },
        {
          "line": 2021,
          "old_api": null,
          "new_api": "empty",
          "old_text": null,
          "new_text": "err.empty()",
          "old_line_content": "    string err;",
          "new_line_content": "    if (!err.empty()) {",
          "content_same": false
        },
        {
          "line": 2046,
          "old_api": null,
          "new_api": "g_conf",
          "old_text": null,
          "new_text": "g_conf()",
          "old_line_content": "  // the front of the list have a higher number assigned (and -1 for items not in the list).",
          "new_line_content": "  get_str_list(g_conf()->rgw_enable_apis, apis);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 2048,
          "old_api": "g_conf",
          "new_api": null,
          "old_text": "g_conf()",
          "new_text": null,
          "old_line_content": "  get_str_list(g_conf()->rgw_enable_apis, apis);",
          "new_line_content": "  int api_priority_s3website = -1;",
          "content_same": false
        },
        {
          "line": 2053,
          "old_api": "end",
          "new_api": null,
          "old_text": "apis.end()",
          "new_text": null,
          "old_line_content": "  if (api_s3_priority_rawpos != apis.end()) {",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 2056,
          "old_api": "end",
          "new_api": null,
          "old_text": "apis.end()",
          "new_text": null,
          "old_line_content": "  if (api_s3website_priority_rawpos != apis.end()) {",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 2059,
          "old_api": "ldpp_dout",
          "new_api": null,
          "old_text": "ldpp_dout(s, 10)",
          "new_text": null,
          "old_line_content": "  ldpp_dout(s, 10) << \"rgw api priority: s3=\" << api_priority_s3 << \" s3website=\" << api_priority_s3website << dendl;",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2064,
          "old_api": "find",
          "new_api": null,
          "old_text": "info.host.find('[')",
          "new_text": null,
          "old_line_content": "    if (info.host.find('[') == 0) {",
          "new_line_content": "      if (pos >=1) {",
          "content_same": false
        },
        {
          "line": 2067,
          "old_api": "substr",
          "new_api": null,
          "old_text": "info.host.substr(1, pos-1)",
          "new_text": null,
          "old_line_content": "        info.host = info.host.substr(1, pos-1);",
          "new_line_content": "    } else {",
          "content_same": false
        },
        {
          "line": 2072,
          "old_api": "substr",
          "new_api": null,
          "old_text": "info.host.substr(0, pos)",
          "new_text": null,
          "old_line_content": "        info.host = info.host.substr(0, pos);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 2075,
          "old_api": "ldpp_dout",
          "new_api": null,
          "old_text": "ldpp_dout(s, 10)",
          "new_text": null,
          "old_line_content": "    ldpp_dout(s, 10) << \"host=\" << info.host << dendl;",
          "new_line_content": "    string subdomain;",
          "content_same": false
        },
        {
          "line": 2079,
          "old_api": "rgw_find_host_in_domains",
          "new_api": null,
          "old_text": "rgw_find_host_in_domains(info.host, &domain, &subdomain, hostnames_set)",
          "new_text": null,
          "old_line_content": "    bool in_hosted_domain = rgw_find_host_in_domains(info.host, &domain, &subdomain, hostnames_set);",
          "new_line_content": "    string s3website_domain;",
          "content_same": false
        },
        {
          "line": 2085,
          "old_api": "rgw_find_host_in_domains",
          "new_api": null,
          "old_text": "rgw_find_host_in_domains(info.host, &s3website_domain, &s3website_subdomain, hostnames_s3website_set)",
          "new_text": null,
          "old_line_content": "      in_hosted_domain_s3website = rgw_find_host_in_domains(info.host, &s3website_domain, &s3website_subdomain, hostnames_s3website_set);",
          "new_line_content": "\tin_hosted_domain = true; // TODO: should hostnames be a strict superset of hostnames_s3website?",
          "content_same": false
        },
        {
          "line": 2093,
          "old_api": "ldpp_dout",
          "new_api": null,
          "old_text": "ldpp_dout(s, 20)",
          "new_text": null,
          "old_line_content": "    ldpp_dout(s, 20)",
          "new_line_content": "      << \" domain=\" << domain ",
          "content_same": false
        },
        {
          "line": 2100,
          "old_api": "g_conf",
          "new_api": null,
          "old_text": "g_conf()",
          "new_text": null,
          "old_line_content": "    if (g_conf()->rgw_resolve_cname",
          "new_line_content": "\t&& !in_hosted_domain_s3website) {",
          "content_same": false
        },
        {
          "line": 2107,
          "old_api": "ldpp_dout",
          "new_api": null,
          "old_text": "ldpp_dout(s, 0)",
          "new_text": null,
          "old_line_content": "\tldpp_dout(s, 0)",
          "new_line_content": "\t  << dendl;",
          "content_same": false
        },
        {
          "line": 2113,
          "old_api": "ldpp_dout",
          "new_api": null,
          "old_text": "ldpp_dout(s, 5)",
          "new_text": null,
          "old_line_content": "\tldpp_dout(s, 5) << \"resolved host cname \" << info.host << \" -> \"",
          "new_line_content": "\tin_hosted_domain =",
          "content_same": false
        },
        {
          "line": 2116,
          "old_api": "rgw_find_host_in_domains",
          "new_api": null,
          "old_text": "rgw_find_host_in_domains(cname, &domain, &subdomain, hostnames_set)",
          "new_text": null,
          "old_line_content": "\t  rgw_find_host_in_domains(cname, &domain, &subdomain, hostnames_set);",
          "new_line_content": "        if (s3website_enabled",
          "content_same": false
        },
        {
          "line": 2121,
          "old_api": "rgw_find_host_in_domains",
          "new_api": null,
          "old_text": "rgw_find_host_in_domains(cname, &s3website_domain,\n\t\t\t\t     &s3website_subdomain,\n\t\t\t\t     hostnames_s3website_set)",
          "new_text": null,
          "old_line_content": "\t    rgw_find_host_in_domains(cname, &s3website_domain,",
          "new_line_content": "\t\t\t\t     hostnames_s3website_set);",
          "content_same": false
        },
        {
          "line": 2132,
          "old_api": "ldpp_dout",
          "new_api": null,
          "old_text": "ldpp_dout(s, 20)",
          "new_text": null,
          "old_line_content": "        ldpp_dout(s, 20)",
          "new_line_content": "          << \" domain=\" << domain ",
          "content_same": false
        },
        {
          "line": 2154,
          "old_api": "empty",
          "new_api": null,
          "old_text": "hostnames_s3website_set.empty()",
          "new_text": null,
          "old_line_content": "        && !(hostnames_set.empty() && hostnames_s3website_set.empty())) {",
          "new_line_content": "      in_hosted_domain = 1;",
          "content_same": false
        },
        {
          "line": 2155,
          "old_api": "append",
          "new_api": null,
          "old_text": "subdomain.append(info.host)",
          "new_text": null,
          "old_line_content": "      subdomain.append(info.host);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 2172,
          "old_api": "append",
          "new_api": null,
          "old_text": "encoded_bucket.append(\"/\")",
          "new_text": null,
          "old_line_content": "        encoded_bucket.append(\"/\");",
          "new_line_content": "      s->info.request_uri = encoded_bucket;",
          "content_same": false
        },
        {
          "line": 2173,
          "old_api": "append",
          "new_api": null,
          "old_text": "encoded_bucket.append(s->info.request_uri)",
          "new_text": null,
          "old_line_content": "      encoded_bucket.append(s->info.request_uri);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 2177,
          "old_api": "empty",
          "new_api": null,
          "old_text": "domain.empty()",
          "new_text": null,
          "old_line_content": "    if (!domain.empty()) {",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 2181,
          "old_api": "ldpp_dout",
          "new_api": null,
          "old_text": "ldpp_dout(s, 20)",
          "new_text": null,
          "old_line_content": "    ldpp_dout(s, 20)",
          "new_line_content": "      << \" subdomain=\" << subdomain",
          "content_same": false
        },
        {
          "line": 2192,
          "old_api": "empty",
          "new_api": null,
          "old_text": "s->info.domain.empty()",
          "new_text": null,
          "old_line_content": "  if (s->info.domain.empty()) {",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 2198,
          "old_api": "length",
          "new_api": null,
          "old_text": "s->decoded_uri.length()",
          "new_text": null,
          "old_line_content": "  if (std::strlen(s->decoded_uri.c_str()) != s->decoded_uri.length()) {",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 2217,
          "old_api": "get",
          "new_api": null,
          "old_text": "info.env->get(\"CONTENT_LENGTH\")",
          "new_text": null,
          "old_line_content": "  const char* content_length = info.env->get(\"CONTENT_LENGTH\");",
          "new_line_content": "  if (!http_content_length != !content_length) {",
          "content_same": false
        },
        {
          "line": 2218,
          "old_api": "get",
          "new_api": null,
          "old_text": "info.env->get(\"HTTP_CONTENT_LENGTH\")",
          "new_text": null,
          "old_line_content": "  const char* http_content_length = info.env->get(\"HTTP_CONTENT_LENGTH\");",
          "new_line_content": "    /* Easy case: one or the other is missing */",
          "content_same": false
        },
        {
          "line": 2227,
          "old_api": "parse_content_length",
          "new_api": null,
          "old_text": "parse_content_length(content_length)",
          "new_text": null,
          "old_line_content": "    content_length_i = parse_content_length(content_length);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2228,
          "old_api": "parse_content_length",
          "new_api": null,
          "old_text": "parse_content_length(http_content_length)",
          "new_text": null,
          "old_line_content": "    http_content_length_i = parse_content_length(http_content_length);",
          "new_line_content": "    // Now check them:",
          "content_same": false
        },
        {
          "line": 1736,
          "old_api": "strcmp",
          "new_api": null,
          "old_text": "strcmp(format_buf, \"application/xml\")",
          "new_text": null,
          "old_line_content": "        if ((strcmp(format_buf, \"text/xml\") == 0) || (strcmp(format_buf, \"application/xml\") == 0)) {",
          "new_line_content": "        } else if (format == \"application/json\") {",
          "content_same": false
        },
        {
          "line": 1738,
          "old_api": "strcmp",
          "new_api": null,
          "old_text": "strcmp(format_buf, \"application/json\")",
          "new_text": null,
          "old_line_content": "        } else if (strcmp(format_buf, \"application/json\") == 0) {",
          "new_line_content": "        } else if (format == \"text/html\") {",
          "content_same": false
        },
        {
          "line": 1740,
          "old_api": "strcmp",
          "new_api": null,
          "old_text": "strcmp(format_buf, \"text/html\")",
          "new_text": null,
          "old_line_content": "        } else if (strcmp(format_buf, \"text/html\") == 0) {",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 1746,
          "old_api": "RGWHandler_REST::reallocate_formatter(s, type)",
          "new_api": null,
          "old_text": "RGWHandler_REST::reallocate_formatter(s, type)",
          "new_text": null,
          "old_line_content": "  return RGWHandler_REST::reallocate_formatter(s, type);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2260,
          "old_api": "empty",
          "new_api": null,
          "old_text": "err.empty()",
          "new_text": null,
          "old_line_content": "      if (!err.empty()) {",
          "new_line_content": "\treturn -EINVAL;",
          "content_same": false
        },
        {
          "line": 2261,
          "old_api": "ldpp_dout",
          "new_api": null,
          "old_text": "ldpp_dout(s, 10)",
          "new_text": null,
          "old_line_content": "\tldpp_dout(s, 10) << \"bad content length, aborting\" << dendl;",
          "new_line_content": "      }",
          "content_same": false
        },
        {
          "line": 1753,
          "old_api": "ceph_assert",
          "new_api": null,
          "old_text": "ceph_assert(s->formatter)",
          "new_text": null,
          "old_line_content": "    ceph_assert(s->formatter);",
          "new_line_content": "    return 0;",
          "content_same": false
        },
        {
          "line": 1754,
          "old_api": "reset",
          "new_api": null,
          "old_text": "s->formatter->reset()",
          "new_text": null,
          "old_line_content": "    s->formatter->reset();",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 2268,
          "old_api": "ldpp_dout",
          "new_api": null,
          "old_text": "ldpp_dout(s, 10)",
          "new_text": null,
          "old_line_content": "    ldpp_dout(s, 10) << \"negative content length, aborting\" << dendl;",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 1762,
          "old_api": "get",
          "new_api": null,
          "old_text": "s->info.args.get(\"multipart-manifest\")",
          "new_text": null,
          "old_line_content": "  const string& mm = s->info.args.get(\"multipart-manifest\");",
          "new_line_content": "  const bool swift_bulkupload = s->prot_flags & RGW_REST_SWIFT &&",
          "content_same": false
        },
        {
          "line": 2275,
          "old_api": "c_str",
          "new_api": null,
          "old_text": "giter->first.c_str()",
          "new_text": null,
          "old_line_content": "    const char *env = info.env->get(giter->first.c_str());",
          "new_line_content": "      s->generic_attrs[giter->second] = env;",
          "content_same": false
        },
        {
          "line": 1765,
          "old_api": "exists",
          "new_api": null,
          "old_text": "s->info.args.exists(\"extract-archive\")",
          "new_text": null,
          "old_line_content": "                                s->info.args.exists(\"extract-archive\");",
          "new_line_content": "    case RGWFormat::PLAIN:",
          "content_same": false
        },
        {
          "line": 1769,
          "old_api": "exists",
          "new_api": null,
          "old_text": "s->info.args.exists(\"bulk-delete\")",
          "new_text": null,
          "old_line_content": "        const bool use_kv_syntax = s->info.args.exists(\"bulk-delete\") ||",
          "new_line_content": "        s->formatter = new RGWFormatter_Plain(use_kv_syntax);",
          "content_same": false
        },
        {
          "line": 2282,
          "old_api": "get",
          "new_api": null,
          "old_text": "info.env->get(\"HTTP_EXPECT\")",
          "new_text": null,
          "old_line_content": "    const char *expect = info.env->get(\"HTTP_EXPECT\");",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 2287,
          "old_api": "init_meta_info",
          "new_api": null,
          "old_text": "info.init_meta_info(s, &s->has_bad_meta)",
          "new_text": null,
          "old_line_content": "  info.init_meta_info(s, &s->has_bad_meta);",
          "new_line_content": "  return 0;",
          "content_same": false
        },
        {
          "line": 1776,
          "old_api": "exists",
          "new_api": null,
          "old_text": "s->info.args.exists(\"bulk-delete\")",
          "new_text": null,
          "old_line_content": "        const bool lowercase_underscore = s->info.args.exists(\"bulk-delete\") ||",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2301,
          "old_api": "preprocess",
          "new_api": null,
          "old_text": "preprocess(s, rio)",
          "new_text": null,
          "old_line_content": "  *init_error = preprocess(s, rio);",
          "new_line_content": "    return nullptr;",
          "content_same": false
        },
        {
          "line": 2306,
          "old_api": "get_manager",
          "new_api": null,
          "old_text": "mgr.get_manager(s, frontend_prefix, s->decoded_uri,\n                                  &s->relative_uri)",
          "new_text": null,
          "old_line_content": "  RGWRESTMgr *m = mgr.get_manager(s, frontend_prefix, s->decoded_uri,",
          "new_line_content": "  if (! m) {",
          "content_same": false
        },
        {
          "line": 1800,
          "old_api": "size",
          "new_api": null,
          "old_text": "bucket.size()",
          "new_text": null,
          "old_line_content": "  int len = bucket.size();",
          "new_line_content": "    if (len == 0) {",
          "content_same": false
        },
        {
          "line": 2317,
          "old_api": "get_handler",
          "new_api": null,
          "old_text": "m->get_handler(driver, s, auth_registry, frontend_prefix)",
          "new_text": null,
          "old_line_content": "  RGWHandler_REST* handler = m->get_handler(driver, s, auth_registry, frontend_prefix);",
          "new_line_content": "    *init_error = -ERR_METHOD_NOT_ALLOWED;",
          "content_same": false
        },
        {
          "line": 1814,
          "old_api": "c_str",
          "new_api": null,
          "old_text": "bucket.c_str()",
          "new_text": null,
          "old_line_content": "  const char *s = bucket.c_str();",
          "new_line_content": "    if (*(unsigned char *)s == 0xff)",
          "content_same": false
        },
        {
          "line": 2327,
          "old_api": "put_handler",
          "new_api": null,
          "old_text": "m->put_handler(handler)",
          "new_text": null,
          "old_line_content": "    m->put_handler(handler);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 1831,
          "old_api": "size",
          "new_api": null,
          "old_text": "object.size()",
          "new_text": null,
          "old_line_content": "  int len = object.size();",
          "new_line_content": "    // Name too long",
          "content_same": false
        },
        {
          "line": 1837,
          "old_api": "c_str",
          "new_api": null,
          "old_text": "object.c_str()",
          "new_text": null,
          "old_line_content": "  if (check_utf8(object.c_str(), len)) {",
          "new_line_content": "    return -ERR_INVALID_OBJECT_NAME;",
          "content_same": false
        },
        {
          "line": 1860,
          "old_api": "strcmp",
          "new_api": null,
          "old_text": "strcmp(method, \"OPTIONS\")",
          "new_text": null,
          "old_line_content": "  if (strcmp(method, \"OPTIONS\") == 0)",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1875,
          "old_api": "begin",
          "new_api": null,
          "old_text": "user_policies.begin()",
          "new_text": null,
          "old_line_content": "                                      std::make_move_iterator(user_policies.begin()),",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1876,
          "old_api": "end",
          "new_api": null,
          "old_text": "user_policies.end()",
          "new_text": null,
          "old_line_content": "                                      std::make_move_iterator(user_policies.end()));",
          "new_line_content": "        }",
          "content_same": false
        },
        {
          "line": 1880,
          "old_api": "what",
          "new_api": null,
          "old_text": "e.what()",
          "new_text": null,
          "old_line_content": "        ldpp_dout(op, -1) << \"Error reading IAM User Policy: \" << e.what() << dendl;",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1883,
          "old_api": "rgw_build_iam_environment",
          "new_api": null,
          "old_text": "rgw_build_iam_environment(driver, s)",
          "new_text": null,
          "old_line_content": "    rgw_build_iam_environment(driver, s);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 1887,
          "old_api": "do_init_permissions",
          "new_api": null,
          "old_text": "do_init_permissions(op, y)",
          "new_text": null,
          "old_line_content": "  return do_init_permissions(op, y);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1903,
          "old_api": "exists",
          "new_api": null,
          "old_text": "s->info.args.exists(\"delete\")",
          "new_text": null,
          "old_line_content": "    if (s->info.args.exists(\"delete\")) {",
          "new_line_content": "      break;",
          "content_same": false
        },
        {
          "line": 1907,
          "old_api": "is_obj_update_op",
          "new_api": null,
          "old_text": "is_obj_update_op()",
          "new_text": null,
          "old_line_content": "    if (is_obj_update_op()) {",
          "new_line_content": "      break;",
          "content_same": false
        },
        {
          "line": 1912,
          "old_api": "get_type",
          "new_api": null,
          "old_text": "op_obj->get_type()",
          "new_text": null,
          "old_line_content": "    if (op_obj->get_type() == RGW_OP_CREATE_BUCKET)",
          "new_line_content": "    ",
          "content_same": false
        },
        {
          "line": 1918,
          "old_api": "exists",
          "new_api": null,
          "old_text": "s->info.args.exists(\"tagging\")",
          "new_text": null,
          "old_line_content": "    if (!s->info.args.exists(\"tagging\")){",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1929,
          "old_api": "do_read_permissions",
          "new_api": null,
          "old_text": "do_read_permissions(op_obj, only_bucket, y)",
          "new_text": null,
          "old_line_content": "  return do_read_permissions(op_obj, only_bucket, y);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1935,
          "old_api": "append",
          "new_api": null,
          "old_text": "r.append(resource)",
          "new_text": null,
          "old_line_content": "  r.append(resource);",
          "new_line_content": "  /* do we have a resource manager registered for this entry point? */",
          "content_same": false
        },
        {
          "line": 1938,
          "old_api": "find",
          "new_api": null,
          "old_text": "resource_mgrs.find(r)",
          "new_text": null,
          "old_line_content": "  map<string, RGWRESTMgr *>::iterator iter = resource_mgrs.find(r);",
          "new_line_content": "    delete iter->second;",
          "content_same": false
        },
        {
          "line": 1939,
          "old_api": "end",
          "new_api": null,
          "old_text": "resource_mgrs.end()",
          "new_text": null,
          "old_line_content": "  if (iter != resource_mgrs.end()) {",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 1943,
          "old_api": "size",
          "new_api": null,
          "old_text": "r.size()",
          "new_text": null,
          "old_line_content": "  resources_by_size.insert(pair<size_t, string>(r.size(), r));",
          "new_line_content": "  /* now build default resource managers for the path (instead of nested entry points)",
          "content_same": false
        },
        {
          "line": 1952,
          "old_api": "size",
          "new_api": null,
          "old_text": "r.size()",
          "new_text": null,
          "old_line_content": "  while (pos != r.size() - 1 && pos != string::npos) {",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1955,
          "old_api": "find",
          "new_api": null,
          "old_text": "resource_mgrs.find(s)",
          "new_text": null,
          "old_line_content": "    iter = resource_mgrs.find(s);",
          "new_line_content": "      resource_mgrs[s] = new RGWRESTMgr; /* a default do-nothing manager */",
          "content_same": false
        },
        {
          "line": 1958,
          "old_api": "size",
          "new_api": null,
          "old_text": "s.size()",
          "new_text": null,
          "old_line_content": "      resources_by_size.insert(pair<size_t, string>(s.size(), s));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1961,
          "old_api": "find",
          "new_api": null,
          "old_text": "r.find('/', pos + 1)",
          "new_text": null,
          "old_line_content": "    pos = r.find('/', pos + 1);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 1981,
          "old_api": "compare",
          "new_api": null,
          "old_text": "uri.compare(0, iter->first, resource)",
          "new_text": null,
          "old_line_content": "    if (uri.compare(0, iter->first, resource) == 0 &&",
          "new_line_content": "\t uri[iter->first] == '/')) {",
          "content_same": false
        },
        {
          "line": 1984,
          "old_api": "substr",
          "new_api": null,
          "old_text": "uri.substr(iter->first)",
          "new_text": null,
          "old_line_content": "      std::string suffix = uri.substr(iter->first);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 1985,
          "old_api": "get_resource_mgr",
          "new_api": null,
          "old_text": "resource_mgrs[resource]->get_resource_mgr(s, suffix, out_uri)",
          "new_text": null,
          "old_line_content": "      return resource_mgrs[resource]->get_resource_mgr(s, suffix, out_uri);",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 1990,
          "old_api": "get_resource_mgr_as_default",
          "new_api": null,
          "old_text": "default_mgr->get_resource_mgr_as_default(s, uri, out_uri)",
          "new_text": null,
          "old_line_content": "    return default_mgr->get_resource_mgr_as_default(s, uri, out_uri);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2000,
          "old_api": "boost::algorithm::to_upper(hdr)",
          "new_api": null,
          "old_text": "boost::algorithm::to_upper(hdr)",
          "new_text": null,
          "old_line_content": "    boost::algorithm::to_upper(hdr); // XXX",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 2001,
          "old_api": "insert",
          "new_api": null,
          "old_text": "x_headers.insert(hdr)",
          "new_text": null,
          "old_line_content": "    (void) x_headers.insert(hdr);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 2008,
          "old_api": "end",
          "new_api": null,
          "old_text": "resource_mgrs.end()",
          "new_text": null,
          "old_line_content": "  for (iter = resource_mgrs.begin(); iter != resource_mgrs.end(); ++iter) {",
          "new_line_content": "  }",
          "content_same": false
        },
        {
          "line": 2022,
          "old_api": "strict_strtoll",
          "new_api": null,
          "old_text": "strict_strtoll(content_length, 10, &err)",
          "new_text": null,
          "old_line_content": "    len = strict_strtoll(content_length, 10, &err);",
          "new_line_content": "      len = -1;",
          "content_same": false
        },
        {
          "line": 2023,
          "old_api": "empty",
          "new_api": null,
          "old_text": "err.empty()",
          "new_text": null,
          "old_line_content": "    if (!err.empty()) {",
          "new_line_content": "    }",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 31,
      "total_additions": 79,
      "total_deletions": 81,
      "total_api_changes": 191
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 9,
        "api_related_lines": 191,
        "non_api_lines": 5,
        "non_api_line_numbers": [
          1730,
          1731,
          1733,
          1734,
          1735
        ]
      }
    },
    "api_calls_before": 622,
    "api_calls_after": 620,
    "diff_info": {
      "added_lines": 7,
      "removed_lines": 9,
      "total_diff_lines": 30
    }
  }
}