{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/postgres/modified_file/ed5699dd1b883e193930448b7ad532e233de0bd7",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/postgres/modified_file/ed5699dd1b883e193930448b7ad532e233de0bd7/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/postgres/modified_file/ed5699dd1b883e193930448b7ad532e233de0bd7/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/postgres/modified_file/ed5699dd1b883e193930448b7ad532e233de0bd7/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 239,
          "old_api": "PQfinish",
          "new_api": "PQstatus",
          "old_text": "PQfinish(conn)",
          "new_text": "PQstatus(conn)",
          "old_line_content": "\t\t\tPQfinish(conn);",
          "new_line_content": "\t\tPQstatus(conn) != CONNECTION_OK)",
          "content_same": false
        },
        {
          "line": 242,
          "old_api": "CLUSTER_NAME",
          "new_api": "PQerrorMessage",
          "old_text": "CLUSTER_NAME(cluster)",
          "new_text": "PQerrorMessage(conn)",
          "old_line_content": "\t\t\t   CLUSTER_NAME(cluster), cmd);",
          "new_line_content": "\t\t\t   PQerrorMessage(conn));",
          "content_same": false
        },
        {
          "line": 249,
          "old_api": "CLUSTER_NAME",
          "new_api": "PQfinish",
          "old_text": "CLUSTER_NAME(cluster)",
          "new_text": "PQfinish(conn)",
          "old_line_content": "\t\t\t   CLUSTER_NAME(cluster));",
          "new_line_content": "\tPQfinish(conn);",
          "content_same": false
        },
        {
          "line": 295,
          "old_api": "strcmp",
          "new_api": "PQconndefaults",
          "old_text": "strcmp(option->envvar, \"PGHOSTADDR\")",
          "new_text": "PQconndefaults()",
          "old_line_content": "\t\t\t\t\t\t\t   strcmp(option->envvar, \"PGHOSTADDR\") == 0))",
          "new_line_content": "\tstart = PQconndefaults();",
          "content_same": false
        },
        {
          "line": 299,
          "old_api": "strlen",
          "new_api": "strcmp",
          "old_text": "strlen(value)",
          "new_text": "strcmp(option->envvar, \"PGHOST\")",
          "old_line_content": "\t\t\tif (value && strlen(value) > 0 &&",
          "new_line_content": "\t\tif (option->envvar && (strcmp(option->envvar, \"PGHOST\") == 0 ||",
          "content_same": false
        },
        {
          "line": 302,
          "old_api": "strcmp",
          "new_api": "getenv",
          "old_text": "strcmp(value, \"::1\")",
          "new_text": "getenv(option->envvar)",
          "old_line_content": "\t\t\t\t strcmp(value, \"::1\") != 0 && value[0] != '/'))",
          "new_line_content": "\t\t\tconst char *value = getenv(option->envvar);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 229,
          "old_api": null,
          "new_api": "exec_prog",
          "old_text": null,
          "new_text": "exec_prog(SERVER_START_LOG_FILE,\n\t\t\t\t\t\t\t  /* pass both file names if they differ */\n\t\t\t\t\t\t\t  (strcmp(SERVER_LOG_FILE,\n\t\t\t\t\t\t\t\t\t  SERVER_START_LOG_FILE) != 0) ?\n\t\t\t\t\t\t\t  SERVER_LOG_FILE : NULL,\n\t\t\t\t\t\t\t  false,\n\t\t\t\t\t\t\t  \"%s\", cmd)",
          "old_line_content": "\t\t\t\t\t\t\t  false,",
          "new_line_content": "\tpg_ctl_return = exec_prog(SERVER_START_LOG_FILE,",
          "content_same": false
        },
        {
          "line": 231,
          "old_api": null,
          "new_api": "strcmp",
          "old_text": null,
          "new_text": "strcmp(SERVER_LOG_FILE,\n\t\t\t\t\t\t\t\t\t  SERVER_START_LOG_FILE)",
          "old_line_content": "",
          "new_line_content": "\t\t\t\t\t\t\t  (strcmp(SERVER_LOG_FILE,",
          "content_same": false
        },
        {
          "line": 300,
          "old_api": null,
          "new_api": "strcmp",
          "old_text": null,
          "new_text": "strcmp(option->envvar, \"PGHOSTADDR\")",
          "old_line_content": "\t\t\t/* check for 'local' host values */",
          "new_line_content": "\t\t\t\t\t\t\t   strcmp(option->envvar, \"PGHOSTADDR\") == 0))",
          "content_same": false
        },
        {
          "line": 238,
          "old_api": null,
          "new_api": "get_db_conn",
          "old_text": null,
          "new_text": "get_db_conn(cluster, \"template1\")",
          "old_line_content": "\t\tif (conn)",
          "new_line_content": "\tif ((conn = get_db_conn(cluster, \"template1\")) == NULL ||",
          "content_same": false
        },
        {
          "line": 272,
          "old_api": null,
          "new_api": "exec_prog",
          "old_text": null,
          "new_text": "exec_prog(SERVER_STOP_LOG_FILE, NULL, !fast,\n\t\t\t  \"\\\"%s/pg_ctl\\\" -w -D \\\"%s\\\" -o \\\"%s\\\" %s stop\",\n\t\t\t  cluster->bindir, cluster->pgconfig,\n\t\t\t  cluster->pgopts ? cluster->pgopts : \"\",\n\t\t\t  fast ? \"-m fast\" : \"\")",
          "old_line_content": "",
          "new_line_content": "\texec_prog(SERVER_STOP_LOG_FILE, NULL, !fast,",
          "content_same": false
        },
        {
          "line": 304,
          "old_api": null,
          "new_api": "strlen",
          "old_text": null,
          "new_text": "strlen(value)",
          "old_line_content": "\t\t\t\t\t   \"libpq environment variable %s has a non-local server value: %s\\n\",",
          "new_line_content": "\t\t\tif (value && strlen(value) > 0 &&",
          "content_same": false
        },
        {
          "line": 306,
          "old_api": null,
          "new_api": "strcmp",
          "old_text": null,
          "new_text": "strcmp(value, \"127.0.0.1\")",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\t\t\t(strcmp(value, \"localhost\") != 0 && strcmp(value, \"127.0.0.1\") != 0 &&",
          "content_same": false
        },
        {
          "line": 307,
          "old_api": null,
          "new_api": "strcmp",
          "old_text": null,
          "new_text": "strcmp(value, \"::1\")",
          "old_line_content": "\t}",
          "new_line_content": "\t\t\t\t strcmp(value, \"::1\") != 0 && value[0] != '/'))",
          "content_same": false
        },
        {
          "line": 308,
          "old_api": null,
          "new_api": "pg_log",
          "old_text": null,
          "new_text": "pg_log(PG_FATAL,\n\t\t\t\t\t   \"libpq environment variable %s has a non-local server value: %s\\n\",\n\t\t\t\t\t   option->envvar, value)",
          "old_line_content": "",
          "new_line_content": "\t\t\t\tpg_log(PG_FATAL,",
          "content_same": false
        },
        {
          "line": 241,
          "old_api": null,
          "new_api": "pg_log",
          "old_text": null,
          "new_text": "pg_log(PG_REPORT, \"\\nconnection to database failed: %s\\n\",\n\t\t\t   PQerrorMessage(conn))",
          "old_line_content": "\t\t\t   \"%s\\n\",",
          "new_line_content": "\t\tpg_log(PG_REPORT, \"\\nconnection to database failed: %s\\n\",",
          "content_same": false
        },
        {
          "line": 245,
          "old_api": null,
          "new_api": "pg_log",
          "old_text": null,
          "new_text": "pg_log(PG_FATAL, \"could not connect to %s postmaster started with the command:\\n\"\n\t\t\t   \"%s\\n\",\n\t\t\t   CLUSTER_NAME(cluster), cmd)",
          "old_line_content": "",
          "new_line_content": "\t\tpg_log(PG_FATAL, \"could not connect to %s postmaster started with the command:\\n\"",
          "content_same": false
        },
        {
          "line": 247,
          "old_api": null,
          "new_api": "CLUSTER_NAME",
          "old_text": null,
          "new_text": "CLUSTER_NAME(cluster)",
          "old_line_content": "\tif (!pg_ctl_return)",
          "new_line_content": "\t\t\t   CLUSTER_NAME(cluster), cmd);",
          "content_same": false
        },
        {
          "line": 216,
          "old_api": null,
          "new_api": "snprintf",
          "old_text": null,
          "new_text": "snprintf(cmd, sizeof(cmd),\n\t\t\t \"\\\"%s/pg_ctl\\\" -w -l \\\"%s\\\" -D \\\"%s\\\" -o \\\"-p %d%s%s%s%s\\\" start\",\n\t\t  cluster->bindir, SERVER_LOG_FILE, cluster->pgconfig, cluster->port,\n\t\t\t (cluster->controldata.cat_ver >=\n\t\t\t  BINARY_UPGRADE_SERVER_FLAG_CAT_VER) ? \" -b\" :\n\t\t\t \" -c autovacuum=off -c autovacuum_freeze_max_age=2000000000\",\n\t\t\t (cluster == &new_cluster) ? \" -c synchronous_commit=off\" : \"\",\n\t\t\t cluster->pgopts ? cluster->pgopts : \"\", socket_string)",
          "old_line_content": "\t\t\t  BINARY_UPGRADE_SERVER_FLAG_CAT_VER) ? \"-b\" :",
          "new_line_content": "\tsnprintf(cmd, sizeof(cmd),",
          "content_same": false
        },
        {
          "line": 315,
          "old_api": null,
          "new_api": "PQconninfoFree",
          "old_text": null,
          "new_text": "PQconninfoFree(start)",
          "old_line_content": "",
          "new_line_content": "\tPQconninfoFree(start);",
          "content_same": false
        },
        {
          "line": 253,
          "old_api": null,
          "new_api": "pg_log",
          "old_text": null,
          "new_text": "pg_log(PG_FATAL, \"pg_ctl failed to start the %s server, or connection failed\\n\",\n\t\t\t   CLUSTER_NAME(cluster))",
          "old_line_content": "",
          "new_line_content": "\t\tpg_log(PG_FATAL, \"pg_ctl failed to start the %s server, or connection failed\\n\",",
          "content_same": false
        },
        {
          "line": 254,
          "old_api": null,
          "new_api": "CLUSTER_NAME",
          "old_text": null,
          "new_text": "CLUSTER_NAME(cluster)",
          "old_line_content": "",
          "new_line_content": "\t\t\t   CLUSTER_NAME(cluster));",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 224,
          "old_api": "exec_prog",
          "new_api": null,
          "old_text": "exec_prog(SERVER_START_LOG_FILE,\n\t\t\t\t\t\t\t  /* pass both file names if they differ */\n\t\t\t\t\t\t\t  (strcmp(SERVER_LOG_FILE,\n\t\t\t\t\t\t\t\t\t  SERVER_START_LOG_FILE) != 0) ?\n\t\t\t\t\t\t\t  SERVER_LOG_FILE : NULL,\n\t\t\t\t\t\t\t  false,\n\t\t\t\t\t\t\t  \"%s\", cmd)",
          "new_text": null,
          "old_line_content": "\tpg_ctl_return = exec_prog(SERVER_START_LOG_FILE,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 290,
          "old_api": "PQconndefaults",
          "new_api": null,
          "old_text": "PQconndefaults()",
          "new_text": null,
          "old_line_content": "\tstart = PQconndefaults();",
          "new_line_content": "\tPQconninfoOption *option;",
          "content_same": false
        },
        {
          "line": 226,
          "old_api": "strcmp",
          "new_api": null,
          "old_text": "strcmp(SERVER_LOG_FILE,\n\t\t\t\t\t\t\t\t\t  SERVER_START_LOG_FILE)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\t\t\t  (strcmp(SERVER_LOG_FILE,",
          "new_line_content": "\t * Don't throw an error right away, let connecting throw the error because",
          "content_same": false
        },
        {
          "line": 294,
          "old_api": "strcmp",
          "new_api": null,
          "old_text": "strcmp(option->envvar, \"PGHOST\")",
          "new_text": null,
          "old_line_content": "\t\tif (option->envvar && (strcmp(option->envvar, \"PGHOST\") == 0 ||",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 297,
          "old_api": "getenv",
          "new_api": null,
          "old_text": "getenv(option->envvar)",
          "new_text": null,
          "old_line_content": "\t\t\tconst char *value = getenv(option->envvar);",
          "new_line_content": "\tfor (option = start; option->keyword != NULL; option++)",
          "content_same": false
        },
        {
          "line": 233,
          "old_api": "get_db_conn",
          "new_api": null,
          "old_text": "get_db_conn(cluster, \"template1\")",
          "new_text": null,
          "old_line_content": "\tif ((conn = get_db_conn(cluster, \"template1\")) == NULL ||",
          "new_line_content": "\t\t\t\t\t\t\t  SERVER_LOG_FILE : NULL,",
          "content_same": false
        },
        {
          "line": 267,
          "old_api": "exec_prog",
          "new_api": null,
          "old_text": "exec_prog(SERVER_STOP_LOG_FILE, NULL, !fast,\n\t\t\t  \"\\\"%s/pg_ctl\\\" -w -D \\\"%s\\\" -o \\\"%s\\\" %s stop\",\n\t\t\t  cluster->bindir, cluster->pgconfig,\n\t\t\t  cluster->pgopts ? cluster->pgopts : \"\",\n\t\t\t  fast ? \"-m fast\" : \"\")",
          "new_text": null,
          "old_line_content": "\texec_prog(SERVER_STOP_LOG_FILE, NULL, !fast,",
          "new_line_content": "\telse if (os_info.running_cluster == &new_cluster)",
          "content_same": false
        },
        {
          "line": 234,
          "old_api": "PQstatus",
          "new_api": null,
          "old_text": "PQstatus(conn)",
          "new_text": null,
          "old_line_content": "\t\tPQstatus(conn) != CONNECTION_OK)",
          "new_line_content": "\t\t\t\t\t\t\t  false,",
          "content_same": false
        },
        {
          "line": 301,
          "old_api": "strcmp",
          "new_api": null,
          "old_text": "strcmp(value, \"127.0.0.1\")",
          "new_text": null,
          "old_line_content": "\t\t\t\t(strcmp(value, \"localhost\") != 0 && strcmp(value, \"127.0.0.1\") != 0 &&",
          "new_line_content": "\t\t{",
          "content_same": false
        },
        {
          "line": 236,
          "old_api": "pg_log",
          "new_api": null,
          "old_text": "pg_log(PG_REPORT, \"\\nconnection to database failed: %s\\n\",\n\t\t\t   PQerrorMessage(conn))",
          "new_text": null,
          "old_line_content": "\t\tpg_log(PG_REPORT, \"\\nconnection to database failed: %s\\n\",",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 303,
          "old_api": "pg_log",
          "new_api": null,
          "old_text": "pg_log(PG_FATAL,\n\t\t\t\t\t   \"libpq environment variable %s has a non-local server value: %s\\n\",\n\t\t\t\t\t   option->envvar, value)",
          "new_text": null,
          "old_line_content": "\t\t\t\tpg_log(PG_FATAL,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 237,
          "old_api": "PQerrorMessage",
          "new_api": null,
          "old_text": "PQerrorMessage(conn)",
          "new_text": null,
          "old_line_content": "\t\t\t   PQerrorMessage(conn));",
          "new_line_content": "\t/* Check to see if we can connect to the server; if not, report it. */",
          "content_same": false
        },
        {
          "line": 240,
          "old_api": "pg_log",
          "new_api": null,
          "old_text": "pg_log(PG_FATAL, \"could not connect to %s postmaster started with the command:\\n\"\n\t\t\t   \"%s\\n\",\n\t\t\t   CLUSTER_NAME(cluster), cmd)",
          "new_text": null,
          "old_line_content": "\t\tpg_log(PG_FATAL, \"could not connect to %s postmaster started with the command:\\n\"",
          "new_line_content": "\t{",
          "content_same": false
        },
        {
          "line": 212,
          "old_api": "snprintf",
          "new_api": null,
          "old_text": "snprintf(cmd, sizeof(cmd),\n\t\t\t \"\\\"%s/pg_ctl\\\" -w -l \\\"%s\\\" -D \\\"%s\\\" -o \\\"-p %d %s %s%s\\\" start\",\n\t\t  cluster->bindir, SERVER_LOG_FILE, cluster->pgconfig, cluster->port,\n\t\t\t (cluster->controldata.cat_ver >=\n\t\t\t  BINARY_UPGRADE_SERVER_FLAG_CAT_VER) ? \"-b\" :\n\t\t\t \"-c autovacuum=off -c autovacuum_freeze_max_age=2000000000\",\n\t\t\t cluster->pgopts ? cluster->pgopts : \"\", socket_string)",
          "new_text": null,
          "old_line_content": "\tsnprintf(cmd, sizeof(cmd),",
          "new_line_content": "\t *\tsynchronous_commit=off improves object creation speed, and we only",
          "content_same": false
        },
        {
          "line": 310,
          "old_api": "PQconninfoFree",
          "new_api": null,
          "old_text": "PQconninfoFree(start)",
          "new_text": null,
          "old_line_content": "\tPQconninfoFree(start);",
          "new_line_content": "\t\t\t\t\t   option->envvar, value);",
          "content_same": false
        },
        {
          "line": 248,
          "old_api": "pg_log",
          "new_api": null,
          "old_text": "pg_log(PG_FATAL, \"pg_ctl failed to start the %s server, or connection failed\\n\",\n\t\t\t   CLUSTER_NAME(cluster))",
          "new_text": null,
          "old_line_content": "\t\tpg_log(PG_FATAL, \"pg_ctl failed to start the %s server, or connection failed\\n\",",
          "new_line_content": "\t}",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 6,
      "total_additions": 16,
      "total_deletions": 16,
      "total_api_changes": 38
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 9,
        "api_related_lines": 38,
        "non_api_lines": 7,
        "non_api_line_numbers": [
          211,
          213,
          214,
          217,
          220,
          221,
          222
        ]
      }
    },
    "api_calls_before": 62,
    "api_calls_after": 62,
    "diff_info": {
      "added_lines": 8,
      "removed_lines": 3,
      "total_diff_lines": 27
    }
  }
}