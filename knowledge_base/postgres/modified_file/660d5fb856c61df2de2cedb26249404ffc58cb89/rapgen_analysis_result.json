{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/postgres/modified_file/660d5fb856c61df2de2cedb26249404ffc58cb89",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/postgres/modified_file/660d5fb856c61df2de2cedb26249404ffc58cb89/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/postgres/modified_file/660d5fb856c61df2de2cedb26249404ffc58cb89/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/postgres/modified_file/660d5fb856c61df2de2cedb26249404ffc58cb89/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 361,
          "old_api": "memcpy",
          "new_api": "computeDelta",
          "old_text": "memcpy(page, pageData->image, BLCKSZ)",
          "new_text": "computeDelta(pageData, page, (Page) pageData->image)",
          "old_line_content": "\t\t\t\tmemcpy(page, pageData->image, BLCKSZ);",
          "new_line_content": "\t\t\t\tcomputeDelta(pageData, page, (Page) pageData->image);",
          "content_same": false
        },
        {
          "line": 362,
          "old_api": "XLogRegisterBuffer",
          "new_api": "memcpy",
          "old_text": "XLogRegisterBuffer(i, pageData->buffer, REGBUF_STANDARD)",
          "new_text": "memcpy(page, pageData->image, BLCKSZ)",
          "old_line_content": "\t\t\t\tXLogRegisterBuffer(i, pageData->buffer, REGBUF_STANDARD);",
          "new_line_content": "\t\t\t\tmemcpy(page, pageData->image, BLCKSZ);",
          "content_same": false
        },
        {
          "line": 363,
          "old_api": "XLogRegisterBufData",
          "new_api": "XLogRegisterBuffer",
          "old_text": "XLogRegisterBufData(i, pageData->delta, pageData->deltaLen)",
          "new_text": "XLogRegisterBuffer(i, pageData->buffer, REGBUF_STANDARD)",
          "old_line_content": "\t\t\t\tXLogRegisterBufData(i, pageData->delta, pageData->deltaLen);",
          "new_line_content": "\t\t\t\tXLogRegisterBuffer(i, pageData->buffer, REGBUF_STANDARD);",
          "content_same": false
        },
        {
          "line": 481,
          "old_api": "applyPageRedo",
          "new_api": "XLogRecGetBlockData",
          "old_text": "applyPageRedo(page, blockDelta, blockDeltaSize)",
          "new_text": "XLogRecGetBlockData(record, block_id, &blockDeltaSize)",
          "old_line_content": "\t\t\tapplyPageRedo(page, blockDelta, blockDeltaSize);",
          "new_line_content": "\t\t\tblockDelta = XLogRecGetBlockData(record, block_id, &blockDeltaSize);",
          "content_same": false
        },
        {
          "line": 484,
          "old_api": "MarkBufferDirty",
          "new_api": "PageSetLSN",
          "old_text": "MarkBufferDirty(buffers[block_id])",
          "new_text": "PageSetLSN(page, lsn)",
          "old_line_content": "\t\t\tMarkBufferDirty(buffers[block_id]);",
          "new_line_content": "\t\t\tPageSetLSN(page, lsn);",
          "content_same": false
        },
        {
          "line": 492,
          "old_api": "UnlockReleaseBuffer",
          "new_api": "BufferIsValid",
          "old_text": "UnlockReleaseBuffer(buffers[block_id])",
          "new_text": "BufferIsValid(buffers[block_id])",
          "old_line_content": "\t\t\tUnlockReleaseBuffer(buffers[block_id]);",
          "new_line_content": "\t\tif (BufferIsValid(buffers[block_id]))",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 387,
          "old_api": null,
          "new_api": "START_CRIT_SECTION",
          "old_text": null,
          "new_text": "START_CRIT_SECTION()",
          "old_line_content": "\t\tfor (i = 0; i < MAX_GENERIC_XLOG_PAGES; i++)",
          "new_line_content": "\t\tSTART_CRIT_SECTION();",
          "content_same": false
        },
        {
          "line": 392,
          "old_api": null,
          "new_api": "BufferIsInvalid",
          "old_text": null,
          "new_text": "BufferIsInvalid(pageData->buffer)",
          "old_line_content": "\t\t\t\tcontinue;",
          "new_line_content": "\t\t\tif (BufferIsInvalid(pageData->buffer))",
          "content_same": false
        },
        {
          "line": 394,
          "old_api": null,
          "new_api": "BufferGetPage",
          "old_text": null,
          "new_text": "BufferGetPage(pageData->buffer, NULL, NULL,\n\t\t\t\t\t\t\t\t BGP_NO_SNAPSHOT_TEST)",
          "old_line_content": "\t\t\t\t\t\t\t\t BGP_NO_SNAPSHOT_TEST),",
          "new_line_content": "\t\t\tmemcpy(BufferGetPage(pageData->buffer, NULL, NULL,",
          "content_same": false
        },
        {
          "line": 398,
          "old_api": null,
          "new_api": "MarkBufferDirty",
          "old_text": null,
          "new_text": "MarkBufferDirty(pageData->buffer)",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\t\tMarkBufferDirty(pageData->buffer);",
          "content_same": false
        },
        {
          "line": 400,
          "old_api": null,
          "new_api": "END_CRIT_SECTION",
          "old_text": null,
          "new_text": "END_CRIT_SECTION()",
          "old_line_content": "\t\t/* We don't have a LSN to return, in this case */",
          "new_line_content": "\t\tEND_CRIT_SECTION();",
          "content_same": false
        },
        {
          "line": 405,
          "old_api": null,
          "new_api": "pfree",
          "old_text": null,
          "new_text": "pfree(state)",
          "old_line_content": "",
          "new_line_content": "\tpfree(state);",
          "content_same": false
        },
        {
          "line": 418,
          "old_api": null,
          "new_api": "pfree",
          "old_text": null,
          "new_text": "pfree(state)",
          "old_line_content": "}",
          "new_line_content": "\tpfree(state);",
          "content_same": false
        },
        {
          "line": 435,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(&offset, ptr, sizeof(offset))",
          "old_line_content": "\t\tptr += sizeof(offset);",
          "new_line_content": "\t\tmemcpy(&offset, ptr, sizeof(offset));",
          "content_same": false
        },
        {
          "line": 437,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(&length, ptr, sizeof(length))",
          "old_line_content": "\t\tptr += sizeof(length);",
          "new_line_content": "\t\tmemcpy(&length, ptr, sizeof(length));",
          "content_same": false
        },
        {
          "line": 440,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(page + offset, ptr, length)",
          "old_line_content": "",
          "new_line_content": "\t\tmemcpy(page + offset, ptr, length);",
          "content_same": false
        },
        {
          "line": 457,
          "old_api": null,
          "new_api": "Assert",
          "old_text": null,
          "new_text": "Assert(record->max_block_id < MAX_GENERIC_XLOG_PAGES)",
          "old_line_content": "",
          "new_line_content": "\tAssert(record->max_block_id < MAX_GENERIC_XLOG_PAGES);",
          "content_same": false
        },
        {
          "line": 464,
          "old_api": null,
          "new_api": "XLogRecHasBlockRef",
          "old_text": null,
          "new_text": "XLogRecHasBlockRef(record, block_id)",
          "old_line_content": "\t\t{",
          "new_line_content": "\t\tif (!XLogRecHasBlockRef(record, block_id))",
          "content_same": false
        },
        {
          "line": 470,
          "old_api": null,
          "new_api": "XLogReadBufferForRedo",
          "old_text": null,
          "new_text": "XLogReadBufferForRedo(record, block_id, &buffers[block_id])",
          "old_line_content": "",
          "new_line_content": "\t\taction = XLogReadBufferForRedo(record, block_id, &buffers[block_id]);",
          "content_same": false
        },
        {
          "line": 479,
          "old_api": null,
          "new_api": "BufferGetPage",
          "old_text": null,
          "new_text": "BufferGetPage(buffers[block_id], NULL, NULL,\n\t\t\t\t\t\t\t\t BGP_NO_SNAPSHOT_TEST)",
          "old_line_content": "\t\t\t\t\t\t\t\t BGP_NO_SNAPSHOT_TEST);",
          "new_line_content": "\t\t\tpage = BufferGetPage(buffers[block_id], NULL, NULL,",
          "content_same": false
        },
        {
          "line": 482,
          "old_api": null,
          "new_api": "applyPageRedo",
          "old_text": null,
          "new_text": "applyPageRedo(page, blockDelta, blockDeltaSize)",
          "old_line_content": "",
          "new_line_content": "\t\t\tapplyPageRedo(page, blockDelta, blockDeltaSize);",
          "content_same": false
        },
        {
          "line": 485,
          "old_api": null,
          "new_api": "MarkBufferDirty",
          "old_text": null,
          "new_text": "MarkBufferDirty(buffers[block_id])",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\t\tMarkBufferDirty(buffers[block_id]);",
          "content_same": false
        },
        {
          "line": 364,
          "old_api": null,
          "new_api": "XLogRegisterBufData",
          "old_text": null,
          "new_text": "XLogRegisterBufData(i, pageData->delta, pageData->deltaLen)",
          "old_line_content": "\t\t\t}",
          "new_line_content": "\t\t\t\tXLogRegisterBufData(i, pageData->delta, pageData->deltaLen);",
          "content_same": false
        },
        {
          "line": 493,
          "old_api": null,
          "new_api": "UnlockReleaseBuffer",
          "old_text": null,
          "new_text": "UnlockReleaseBuffer(buffers[block_id])",
          "old_line_content": "\t}",
          "new_line_content": "\t\t\tUnlockReleaseBuffer(buffers[block_id]);",
          "content_same": false
        },
        {
          "line": 369,
          "old_api": null,
          "new_api": "XLogInsert",
          "old_text": null,
          "new_text": "XLogInsert(RM_GENERIC_ID, 0)",
          "old_line_content": "",
          "new_line_content": "\t\tlsn = XLogInsert(RM_GENERIC_ID, 0);",
          "content_same": false
        },
        {
          "line": 376,
          "old_api": null,
          "new_api": "BufferIsInvalid",
          "old_text": null,
          "new_text": "BufferIsInvalid(pageData->buffer)",
          "old_line_content": "\t\t\t\tcontinue;",
          "new_line_content": "\t\t\tif (BufferIsInvalid(pageData->buffer))",
          "content_same": false
        },
        {
          "line": 378,
          "old_api": null,
          "new_api": "BufferGetPage",
          "old_text": null,
          "new_text": "BufferGetPage(pageData->buffer, NULL, NULL,\n\t\t\t\t\t\t\t\t\t BGP_NO_SNAPSHOT_TEST)",
          "old_line_content": "\t\t\t\t\t\t\t\t\t BGP_NO_SNAPSHOT_TEST), lsn);",
          "new_line_content": "\t\t\tPageSetLSN(BufferGetPage(pageData->buffer, NULL, NULL,",
          "content_same": false
        },
        {
          "line": 380,
          "old_api": null,
          "new_api": "MarkBufferDirty",
          "old_text": null,
          "new_text": "MarkBufferDirty(pageData->buffer)",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\t\tMarkBufferDirty(pageData->buffer);",
          "content_same": false
        },
        {
          "line": 382,
          "old_api": null,
          "new_api": "END_CRIT_SECTION",
          "old_text": null,
          "new_text": "END_CRIT_SECTION()",
          "old_line_content": "\t}",
          "new_line_content": "\t\tEND_CRIT_SECTION();",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 386,
          "old_api": "START_CRIT_SECTION",
          "new_api": null,
          "old_text": "START_CRIT_SECTION()",
          "new_text": null,
          "old_line_content": "\t\tSTART_CRIT_SECTION();",
          "new_line_content": "\t\t/* Unlogged relation: skip xlog-related stuff */",
          "content_same": false
        },
        {
          "line": 391,
          "old_api": "BufferIsInvalid",
          "new_api": null,
          "old_text": "BufferIsInvalid(pageData->buffer)",
          "new_text": null,
          "old_line_content": "\t\t\tif (BufferIsInvalid(pageData->buffer))",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 393,
          "old_api": "BufferGetPage",
          "new_api": null,
          "old_text": "BufferGetPage(pageData->buffer, NULL, NULL,\n\t\t\t\t\t\t\t\t BGP_NO_SNAPSHOT_TEST)",
          "new_text": null,
          "old_line_content": "\t\t\tmemcpy(BufferGetPage(pageData->buffer, NULL, NULL,",
          "new_line_content": "\t\t\t\tcontinue;",
          "content_same": false
        },
        {
          "line": 397,
          "old_api": "MarkBufferDirty",
          "new_api": null,
          "old_text": "MarkBufferDirty(pageData->buffer)",
          "new_text": null,
          "old_line_content": "\t\t\tMarkBufferDirty(pageData->buffer);",
          "new_line_content": "\t\t\t\t   BLCKSZ);",
          "content_same": false
        },
        {
          "line": 399,
          "old_api": "END_CRIT_SECTION",
          "new_api": null,
          "old_text": "END_CRIT_SECTION()",
          "new_text": null,
          "old_line_content": "\t\tEND_CRIT_SECTION();",
          "new_line_content": "\t\t}",
          "content_same": false
        },
        {
          "line": 404,
          "old_api": "pfree",
          "new_api": null,
          "old_text": "pfree(state)",
          "new_text": null,
          "old_line_content": "\tpfree(state);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 417,
          "old_api": "pfree",
          "new_api": null,
          "old_text": "pfree(state)",
          "new_text": null,
          "old_line_content": "\tpfree(state);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 434,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(&offset, ptr, sizeof(offset))",
          "new_text": null,
          "old_line_content": "\t\tmemcpy(&offset, ptr, sizeof(offset));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 436,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(&length, ptr, sizeof(length))",
          "new_text": null,
          "old_line_content": "\t\tmemcpy(&length, ptr, sizeof(length));",
          "new_line_content": "\t\tptr += sizeof(offset);",
          "content_same": false
        },
        {
          "line": 439,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(page + offset, ptr, length)",
          "new_text": null,
          "old_line_content": "\t\tmemcpy(page + offset, ptr, length);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 456,
          "old_api": "Assert",
          "new_api": null,
          "old_text": "Assert(record->max_block_id < MAX_GENERIC_XLOG_PAGES)",
          "new_text": null,
          "old_line_content": "\tAssert(record->max_block_id < MAX_GENERIC_XLOG_PAGES);",
          "new_line_content": "\t/* Protect limited size of buffers[] array */",
          "content_same": false
        },
        {
          "line": 463,
          "old_api": "XLogRecHasBlockRef",
          "new_api": null,
          "old_text": "XLogRecHasBlockRef(record, block_id)",
          "new_text": null,
          "old_line_content": "\t\tif (!XLogRecHasBlockRef(record, block_id))",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 469,
          "old_api": "XLogReadBufferForRedo",
          "new_api": null,
          "old_text": "XLogReadBufferForRedo(record, block_id, &buffers[block_id])",
          "new_text": null,
          "old_line_content": "\t\taction = XLogReadBufferForRedo(record, block_id, &buffers[block_id]);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 478,
          "old_api": "BufferGetPage",
          "new_api": null,
          "old_text": "BufferGetPage(buffers[block_id], NULL, NULL,\n\t\t\t\t\t\t\t\t BGP_NO_SNAPSHOT_TEST)",
          "new_text": null,
          "old_line_content": "\t\t\tpage = BufferGetPage(buffers[block_id], NULL, NULL,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 480,
          "old_api": "XLogRecGetBlockData",
          "new_api": null,
          "old_text": "XLogRecGetBlockData(record, block_id, &blockDeltaSize)",
          "new_text": null,
          "old_line_content": "\t\t\tblockDelta = XLogRecGetBlockData(record, block_id, &blockDeltaSize);",
          "new_line_content": "\t\t\t\t\t\t\t\t BGP_NO_SNAPSHOT_TEST);",
          "content_same": false
        },
        {
          "line": 483,
          "old_api": "PageSetLSN",
          "new_api": null,
          "old_text": "PageSetLSN(page, lsn)",
          "new_text": null,
          "old_line_content": "\t\t\tPageSetLSN(page, lsn);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 360,
          "old_api": "computeDelta",
          "new_api": null,
          "old_text": "computeDelta(pageData, page, (Page) pageData->image)",
          "new_text": null,
          "old_line_content": "\t\t\t\tcomputeDelta(pageData, page, (Page) pageData->image);",
          "new_line_content": "\t\t\t\t */",
          "content_same": false
        },
        {
          "line": 491,
          "old_api": "BufferIsValid",
          "new_api": null,
          "old_text": "BufferIsValid(buffers[block_id])",
          "new_text": null,
          "old_line_content": "\t\tif (BufferIsValid(buffers[block_id]))",
          "new_line_content": "\t{",
          "content_same": false
        },
        {
          "line": 368,
          "old_api": "XLogInsert",
          "new_api": null,
          "old_text": "XLogInsert(RM_GENERIC_ID, 0)",
          "new_text": null,
          "old_line_content": "\t\tlsn = XLogInsert(RM_GENERIC_ID, 0);",
          "new_line_content": "\t\t/* Insert xlog record */",
          "content_same": false
        },
        {
          "line": 375,
          "old_api": "BufferIsInvalid",
          "new_api": null,
          "old_text": "BufferIsInvalid(pageData->buffer)",
          "new_text": null,
          "old_line_content": "\t\t\tif (BufferIsInvalid(pageData->buffer))",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 377,
          "old_api": "BufferGetPage",
          "new_api": null,
          "old_text": "BufferGetPage(pageData->buffer, NULL, NULL,\n\t\t\t\t\t\t\t\t\t BGP_NO_SNAPSHOT_TEST)",
          "new_text": null,
          "old_line_content": "\t\t\tPageSetLSN(BufferGetPage(pageData->buffer, NULL, NULL,",
          "new_line_content": "\t\t\t\tcontinue;",
          "content_same": false
        },
        {
          "line": 379,
          "old_api": "MarkBufferDirty",
          "new_api": null,
          "old_text": "MarkBufferDirty(pageData->buffer)",
          "new_text": null,
          "old_line_content": "\t\t\tMarkBufferDirty(pageData->buffer);",
          "new_line_content": "\t\t\t\t\t\t\t\t\t BGP_NO_SNAPSHOT_TEST), lsn);",
          "content_same": false
        },
        {
          "line": 381,
          "old_api": "END_CRIT_SECTION",
          "new_api": null,
          "old_text": "END_CRIT_SECTION()",
          "new_text": null,
          "old_line_content": "\t\tEND_CRIT_SECTION();",
          "new_line_content": "\t\t}",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 6,
      "total_additions": 23,
      "total_deletions": 23,
      "total_api_changes": 52
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 2,
        "api_related_lines": 52,
        "non_api_lines": 2,
        "non_api_line_numbers": [
          352,
          353
        ]
      }
    },
    "api_calls_before": 57,
    "api_calls_after": 57,
    "diff_info": {
      "added_lines": 2,
      "removed_lines": 1,
      "total_diff_lines": 15
    }
  }
}