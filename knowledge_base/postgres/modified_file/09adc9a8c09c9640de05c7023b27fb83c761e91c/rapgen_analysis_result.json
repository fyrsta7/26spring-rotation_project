{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/postgres/modified_file/09adc9a8c09c9640de05c7023b27fb83c761e91c",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/postgres/modified_file/09adc9a8c09c9640de05c7023b27fb83c761e91c/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/postgres/modified_file/09adc9a8c09c9640de05c7023b27fb83c761e91c/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/postgres/modified_file/09adc9a8c09c9640de05c7023b27fb83c761e91c/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 186,
          "old_api": "BUFFERALIGN",
          "new_api": "Assert",
          "old_text": "BUFFERALIGN(newStart)",
          "new_text": "Assert(ShmemSegHdr != NULL)",
          "old_line_content": "\t\tnewStart = BUFFERALIGN(newStart);",
          "new_line_content": "\tAssert(ShmemSegHdr != NULL);",
          "content_same": false
        },
        {
          "line": 364,
          "old_api": "LWLockRelease",
          "new_api": "ereport",
          "old_text": "LWLockRelease(ShmemIndexLock)",
          "new_text": "ereport(ERROR,\n\t\t\t\t\t\t(errcode(ERRCODE_OUT_OF_MEMORY),\n\t\t\t\t\t\t errmsg(\"not enough shared memory for data structure\"\n\t\t\t\t\t\t\t\t\" \\\"%s\\\" (%zu bytes requested)\",\n\t\t\t\t\t\t\t\tname, size)))",
          "old_line_content": "\t\tLWLockRelease(ShmemIndexLock);",
          "new_line_content": "\t\t\t\tereport(ERROR,",
          "content_same": false
        },
        {
          "line": 409,
          "old_api": "errmsg",
          "new_api": "ShmemAlloc",
          "old_text": "errmsg(\"not enough shared memory for data structure\"\n\t\t\t\t\t\t\t\" \\\"%s\\\" (%zu bytes requested)\",\n\t\t\t\t\t\t\tname, size)",
          "new_text": "ShmemAlloc(size)",
          "old_line_content": "\t\t\t\t\t errmsg(\"not enough shared memory for data structure\"",
          "new_line_content": "\t\tstructPtr = ShmemAlloc(size);",
          "content_same": false
        },
        {
          "line": 417,
          "old_api": "LWLockRelease",
          "new_api": "errmsg",
          "old_text": "LWLockRelease(ShmemIndexLock)",
          "new_text": "errmsg(\"not enough shared memory for data structure\"\n\t\t\t\t\t\t\t\" \\\"%s\\\" (%zu bytes requested)\",\n\t\t\t\t\t\t\tname, size)",
          "old_line_content": "\tLWLockRelease(ShmemIndexLock);",
          "new_line_content": "\t\t\t\t\t errmsg(\"not enough shared memory for data structure\"",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 384,
          "old_api": null,
          "new_api": "errcode",
          "old_text": null,
          "new_text": "errcode(ERRCODE_OUT_OF_MEMORY)",
          "old_line_content": "\t\t * Structure is in the shmem index so someone else has allocated it",
          "new_line_content": "\t\t\t\t(errcode(ERRCODE_OUT_OF_MEMORY),",
          "content_same": false
        },
        {
          "line": 385,
          "old_api": null,
          "new_api": "errmsg",
          "old_text": null,
          "new_text": "errmsg(\"could not create ShmemIndex entry for data structure \\\"%s\\\"\",\n\t\t\t   name)",
          "old_line_content": "\t\t * already.  The size better be the same as the size we are trying to",
          "new_line_content": "\t\terrmsg(\"could not create ShmemIndex entry for data structure \\\"%s\\\"\",",
          "content_same": false
        },
        {
          "line": 398,
          "old_api": null,
          "new_api": "LWLockRelease",
          "old_text": null,
          "new_text": "LWLockRelease(ShmemIndexLock)",
          "old_line_content": "\telse",
          "new_line_content": "\t\t\tLWLockRelease(ShmemIndexLock);",
          "content_same": false
        },
        {
          "line": 399,
          "old_api": null,
          "new_api": "ereport",
          "old_text": null,
          "new_text": "ereport(ERROR,\n\t\t\t\t  (errmsg(\"ShmemIndex entry size is wrong for data structure\"\n\t\t\t\t\t\t  \" \\\"%s\\\": expected %zu, actual %zu\",\n\t\t\t\t\t\t  name, size, result->size)))",
          "old_line_content": "\t{",
          "new_line_content": "\t\t\tereport(ERROR,",
          "content_same": false
        },
        {
          "line": 400,
          "old_api": null,
          "new_api": "errmsg",
          "old_text": null,
          "new_text": "errmsg(\"ShmemIndex entry size is wrong for data structure\"\n\t\t\t\t\t\t  \" \\\"%s\\\": expected %zu, actual %zu\",\n\t\t\t\t\t\t  name, size, result->size)",
          "old_line_content": "\t\t/* It isn't in the table yet. allocate and initialize it */",
          "new_line_content": "\t\t\t\t  (errmsg(\"ShmemIndex entry size is wrong for data structure\"",
          "content_same": false
        },
        {
          "line": 413,
          "old_api": null,
          "new_api": "hash_search",
          "old_text": null,
          "new_text": "hash_search(ShmemIndex, name, HASH_REMOVE, NULL)",
          "old_line_content": "\t\tresult->size = size;",
          "new_line_content": "\t\t\thash_search(ShmemIndex, name, HASH_REMOVE, NULL);",
          "content_same": false
        },
        {
          "line": 414,
          "old_api": null,
          "new_api": "LWLockRelease",
          "old_text": null,
          "new_text": "LWLockRelease(ShmemIndexLock)",
          "old_line_content": "\t\tresult->location = structPtr;",
          "new_line_content": "\t\t\tLWLockRelease(ShmemIndexLock);",
          "content_same": false
        },
        {
          "line": 415,
          "old_api": null,
          "new_api": "ereport",
          "old_text": null,
          "new_text": "ereport(ERROR,\n\t\t\t\t\t(errcode(ERRCODE_OUT_OF_MEMORY),\n\t\t\t\t\t errmsg(\"not enough shared memory for data structure\"\n\t\t\t\t\t\t\t\" \\\"%s\\\" (%zu bytes requested)\",\n\t\t\t\t\t\t\tname, size)))",
          "old_line_content": "\t}",
          "new_line_content": "\t\t\tereport(ERROR,",
          "content_same": false
        },
        {
          "line": 416,
          "old_api": null,
          "new_api": "errcode",
          "old_text": null,
          "new_text": "errcode(ERRCODE_OUT_OF_MEMORY)",
          "old_line_content": "",
          "new_line_content": "\t\t\t\t\t(errcode(ERRCODE_OUT_OF_MEMORY),",
          "content_same": false
        },
        {
          "line": 291,
          "old_api": null,
          "new_api": "hash_select_dirsize",
          "old_text": null,
          "new_text": "hash_select_dirsize(max_size)",
          "old_line_content": "",
          "new_line_content": "\tinfoP->dsize = infoP->max_dsize = hash_select_dirsize(max_size);",
          "content_same": false
        },
        {
          "line": 296,
          "old_api": null,
          "new_api": "ShmemInitStruct",
          "old_text": null,
          "new_text": "ShmemInitStruct(name,\n\t\t\t\t\t\t\t   hash_get_shared_size(infoP, hash_flags),\n\t\t\t\t\t\t\t   &found)",
          "old_line_content": "\tif (found)",
          "new_line_content": "\tlocation = ShmemInitStruct(name,",
          "content_same": false
        },
        {
          "line": 297,
          "old_api": null,
          "new_api": "hash_get_shared_size",
          "old_text": null,
          "new_text": "hash_get_shared_size(infoP, hash_flags)",
          "old_line_content": "\t\thash_flags |= HASH_ATTACH;",
          "new_line_content": "\t\t\t\t\t\t\t   hash_get_shared_size(infoP, hash_flags),",
          "content_same": false
        },
        {
          "line": 425,
          "old_api": null,
          "new_api": "LWLockRelease",
          "old_text": null,
          "new_text": "LWLockRelease(ShmemIndexLock)",
          "old_line_content": " * Add two Size values, checking for overflow",
          "new_line_content": "\tLWLockRelease(ShmemIndexLock);",
          "content_same": false
        },
        {
          "line": 427,
          "old_api": null,
          "new_api": "ShmemAddrIsValid",
          "old_text": null,
          "new_text": "ShmemAddrIsValid(structPtr)",
          "old_line_content": "Size",
          "new_line_content": "\tAssert(ShmemAddrIsValid(structPtr));",
          "content_same": false
        },
        {
          "line": 310,
          "old_api": null,
          "new_api": "hash_create",
          "old_text": null,
          "new_text": "hash_create(name, init_size, infoP, hash_flags)",
          "old_line_content": " *\t\thas created the structure, this routine allocates space",
          "new_line_content": "\treturn hash_create(name, init_size, infoP, hash_flags);",
          "content_same": false
        },
        {
          "line": 184,
          "old_api": null,
          "new_api": "CACHELINEALIGN",
          "old_text": null,
          "new_text": "CACHELINEALIGN(size)",
          "old_line_content": "\t/* extra alignment for large requests, since they are probably buffers */",
          "new_line_content": "\tsize = CACHELINEALIGN(size);",
          "content_same": false
        },
        {
          "line": 443,
          "old_api": null,
          "new_api": "ereport",
          "old_text": null,
          "new_text": "ereport(ERROR,\n\t\t\t\t(errcode(ERRCODE_PROGRAM_LIMIT_EXCEEDED),\n\t\t\t\t errmsg(\"requested shared memory size overflows size_t\")))",
          "old_line_content": " */",
          "new_line_content": "\t\tereport(ERROR,",
          "content_same": false
        },
        {
          "line": 188,
          "old_api": null,
          "new_api": "SpinLockAcquire",
          "old_text": null,
          "new_text": "SpinLockAcquire(ShmemLock)",
          "old_line_content": "\tnewFree = newStart + size;",
          "new_line_content": "\tSpinLockAcquire(ShmemLock);",
          "content_same": false
        },
        {
          "line": 444,
          "old_api": null,
          "new_api": "errcode",
          "old_text": null,
          "new_text": "errcode(ERRCODE_PROGRAM_LIMIT_EXCEEDED)",
          "old_line_content": "Size",
          "new_line_content": "\t\t\t\t(errcode(ERRCODE_PROGRAM_LIMIT_EXCEEDED),",
          "content_same": false
        },
        {
          "line": 445,
          "old_api": null,
          "new_api": "errmsg",
          "old_text": null,
          "new_text": "errmsg(\"requested shared memory size overflows size_t\")",
          "old_line_content": "mul_size(Size s1, Size s2)",
          "new_line_content": "\t\t\t\t errmsg(\"requested shared memory size overflows size_t\")));",
          "content_same": false
        },
        {
          "line": 194,
          "old_api": null,
          "new_api": "BUFFERALIGN",
          "old_text": null,
          "new_text": "BUFFERALIGN(newStart)",
          "old_line_content": "\telse",
          "new_line_content": "\t\tnewStart = BUFFERALIGN(newStart);",
          "content_same": false
        },
        {
          "line": 205,
          "old_api": null,
          "new_api": "SpinLockRelease",
          "old_text": null,
          "new_text": "SpinLockRelease(ShmemLock)",
          "old_line_content": "}",
          "new_line_content": "\tSpinLockRelease(ShmemLock);",
          "content_same": false
        },
        {
          "line": 462,
          "old_api": null,
          "new_api": "ereport",
          "old_text": null,
          "new_text": "ereport(ERROR,\n\t\t\t\t(errcode(ERRCODE_PROGRAM_LIMIT_EXCEEDED),\n\t\t\t\t errmsg(\"requested shared memory size overflows size_t\")))",
          "old_line_content": "",
          "new_line_content": "\t\tereport(ERROR,",
          "content_same": false
        },
        {
          "line": 335,
          "old_api": null,
          "new_api": "LWLockAcquire",
          "old_text": null,
          "new_text": "LWLockAcquire(ShmemIndexLock, LW_EXCLUSIVE)",
          "old_line_content": "",
          "new_line_content": "\tLWLockAcquire(ShmemIndexLock, LW_EXCLUSIVE);",
          "content_same": false
        },
        {
          "line": 208,
          "old_api": null,
          "new_api": "ereport",
          "old_text": null,
          "new_text": "ereport(WARNING,\n\t\t\t\t(errcode(ERRCODE_OUT_OF_MEMORY),\n\t\t\t\t errmsg(\"out of shared memory\")))",
          "old_line_content": " * ShmemAddrIsValid -- test if an address refers to shared memory",
          "new_line_content": "\t\tereport(WARNING,",
          "content_same": false
        },
        {
          "line": 209,
          "old_api": null,
          "new_api": "errcode",
          "old_text": null,
          "new_text": "errcode(ERRCODE_OUT_OF_MEMORY)",
          "old_line_content": " *",
          "new_line_content": "\t\t\t\t(errcode(ERRCODE_OUT_OF_MEMORY),",
          "content_same": false
        },
        {
          "line": 210,
          "old_api": null,
          "new_api": "errmsg",
          "old_text": null,
          "new_text": "errmsg(\"out of shared memory\")",
          "old_line_content": " * Returns TRUE if the pointer points within the shared memory segment.",
          "new_line_content": "\t\t\t\t errmsg(\"out of shared memory\")));",
          "content_same": false
        },
        {
          "line": 463,
          "old_api": null,
          "new_api": "errcode",
          "old_text": null,
          "new_text": "errcode(ERRCODE_PROGRAM_LIMIT_EXCEEDED)",
          "old_line_content": "",
          "new_line_content": "\t\t\t\t(errcode(ERRCODE_PROGRAM_LIMIT_EXCEEDED),",
          "content_same": false
        },
        {
          "line": 464,
          "old_api": null,
          "new_api": "errmsg",
          "old_text": null,
          "new_text": "errmsg(\"requested shared memory size overflows size_t\")",
          "old_line_content": "",
          "new_line_content": "\t\t\t\t errmsg(\"requested shared memory size overflows size_t\")));",
          "content_same": false
        },
        {
          "line": 342,
          "old_api": null,
          "new_api": "strcmp",
          "old_text": null,
          "new_text": "strcmp(name, \"ShmemIndex\")",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\tAssert(strcmp(name, \"ShmemIndex\") == 0);",
          "content_same": false
        },
        {
          "line": 347,
          "old_api": null,
          "new_api": "Assert",
          "old_text": null,
          "new_text": "Assert(shmemseghdr->index != NULL)",
          "old_line_content": "\t\t\t * be trying to init the shmem index itself.",
          "new_line_content": "\t\t\tAssert(shmemseghdr->index != NULL);",
          "content_same": false
        },
        {
          "line": 361,
          "old_api": null,
          "new_api": "Assert",
          "old_text": null,
          "new_text": "Assert(shmemseghdr->index == NULL)",
          "old_line_content": "\t\t\tshmemseghdr->index = structPtr;",
          "new_line_content": "\t\t\tAssert(shmemseghdr->index == NULL);",
          "content_same": false
        },
        {
          "line": 362,
          "old_api": null,
          "new_api": "ShmemAlloc",
          "old_text": null,
          "new_text": "ShmemAlloc(size)",
          "old_line_content": "\t\t\t*foundPtr = FALSE;",
          "new_line_content": "\t\t\tstructPtr = ShmemAlloc(size);",
          "content_same": false
        },
        {
          "line": 365,
          "old_api": null,
          "new_api": "errcode",
          "old_text": null,
          "new_text": "errcode(ERRCODE_OUT_OF_MEMORY)",
          "old_line_content": "\t\treturn structPtr;",
          "new_line_content": "\t\t\t\t\t\t(errcode(ERRCODE_OUT_OF_MEMORY),",
          "content_same": false
        },
        {
          "line": 366,
          "old_api": null,
          "new_api": "errmsg",
          "old_text": null,
          "new_text": "errmsg(\"not enough shared memory for data structure\"\n\t\t\t\t\t\t\t\t\" \\\"%s\\\" (%zu bytes requested)\",\n\t\t\t\t\t\t\t\tname, size)",
          "old_line_content": "\t}",
          "new_line_content": "\t\t\t\t\t\t errmsg(\"not enough shared memory for data structure\"",
          "content_same": false
        },
        {
          "line": 372,
          "old_api": null,
          "new_api": "LWLockRelease",
          "old_text": null,
          "new_text": "LWLockRelease(ShmemIndexLock)",
          "old_line_content": "\tif (!result)",
          "new_line_content": "\t\tLWLockRelease(ShmemIndexLock);",
          "content_same": false
        },
        {
          "line": 247,
          "old_api": null,
          "new_api": "ShmemInitHash",
          "old_text": null,
          "new_text": "ShmemInitHash(\"ShmemIndex\",\n\t\t\t\t\t\t\t   SHMEM_INDEX_SIZE, SHMEM_INDEX_SIZE,\n\t\t\t\t\t\t\t   &info, hash_flags)",
          "old_line_content": " *",
          "new_line_content": "\tShmemIndex = ShmemInitHash(\"ShmemIndex\",",
          "content_same": false
        },
        {
          "line": 378,
          "old_api": null,
          "new_api": "hash_search",
          "old_text": null,
          "new_text": "hash_search(ShmemIndex, name, HASH_ENTER_NULL, foundPtr)",
          "old_line_content": "\t\t\t   name)));",
          "new_line_content": "\t\thash_search(ShmemIndex, name, HASH_ENTER_NULL, foundPtr);",
          "content_same": false
        },
        {
          "line": 382,
          "old_api": null,
          "new_api": "LWLockRelease",
          "old_text": null,
          "new_text": "LWLockRelease(ShmemIndexLock)",
          "old_line_content": "\t{",
          "new_line_content": "\t\tLWLockRelease(ShmemIndexLock);",
          "content_same": false
        },
        {
          "line": 383,
          "old_api": null,
          "new_api": "ereport",
          "old_text": null,
          "new_text": "ereport(ERROR,\n\t\t\t\t(errcode(ERRCODE_OUT_OF_MEMORY),\n\t\terrmsg(\"could not create ShmemIndex entry for data structure \\\"%s\\\"\",\n\t\t\t   name)))",
          "old_line_content": "\t\t/*",
          "new_line_content": "\t\tereport(ERROR,",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 390,
          "old_api": "LWLockRelease",
          "new_api": null,
          "old_text": "LWLockRelease(ShmemIndexLock)",
          "new_text": null,
          "old_line_content": "\t\t\tLWLockRelease(ShmemIndexLock);",
          "new_line_content": "\t{",
          "content_same": false
        },
        {
          "line": 391,
          "old_api": "ereport",
          "new_api": null,
          "old_text": "ereport(ERROR,\n\t\t\t\t  (errmsg(\"ShmemIndex entry size is wrong for data structure\"\n\t\t\t\t\t\t  \" \\\"%s\\\": expected %zu, actual %zu\",\n\t\t\t\t\t\t  name, size, result->size)))",
          "new_text": null,
          "old_line_content": "\t\t\tereport(ERROR,",
          "new_line_content": "\t\t/*",
          "content_same": false
        },
        {
          "line": 392,
          "old_api": "errmsg",
          "new_api": null,
          "old_text": "errmsg(\"ShmemIndex entry size is wrong for data structure\"\n\t\t\t\t\t\t  \" \\\"%s\\\": expected %zu, actual %zu\",\n\t\t\t\t\t\t  name, size, result->size)",
          "new_text": null,
          "old_line_content": "\t\t\t\t  (errmsg(\"ShmemIndex entry size is wrong for data structure\"",
          "new_line_content": "\t\t * Structure is in the shmem index so someone else has allocated it",
          "content_same": false
        },
        {
          "line": 401,
          "old_api": "ShmemAlloc",
          "new_api": null,
          "old_text": "ShmemAlloc(size)",
          "new_text": null,
          "old_line_content": "\t\tstructPtr = ShmemAlloc(size);",
          "new_line_content": "\t\t\t\t\t\t  \" \\\"%s\\\": expected %zu, actual %zu\",",
          "content_same": false
        },
        {
          "line": 405,
          "old_api": "hash_search",
          "new_api": null,
          "old_text": "hash_search(ShmemIndex, name, HASH_REMOVE, NULL)",
          "new_text": null,
          "old_line_content": "\t\t\thash_search(ShmemIndex, name, HASH_REMOVE, NULL);",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 406,
          "old_api": "LWLockRelease",
          "new_api": null,
          "old_text": "LWLockRelease(ShmemIndexLock)",
          "new_text": null,
          "old_line_content": "\t\t\tLWLockRelease(ShmemIndexLock);",
          "new_line_content": "\telse",
          "content_same": false
        },
        {
          "line": 407,
          "old_api": "ereport",
          "new_api": null,
          "old_text": "ereport(ERROR,\n\t\t\t\t\t(errcode(ERRCODE_OUT_OF_MEMORY),\n\t\t\t\t\t errmsg(\"not enough shared memory for data structure\"\n\t\t\t\t\t\t\t\" \\\"%s\\\" (%zu bytes requested)\",\n\t\t\t\t\t\t\tname, size)))",
          "new_text": null,
          "old_line_content": "\t\t\tereport(ERROR,",
          "new_line_content": "\t{",
          "content_same": false
        },
        {
          "line": 408,
          "old_api": "errcode",
          "new_api": null,
          "old_text": "errcode(ERRCODE_OUT_OF_MEMORY)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\t(errcode(ERRCODE_OUT_OF_MEMORY),",
          "new_line_content": "\t\t/* It isn't in the table yet. allocate and initialize it */",
          "content_same": false
        },
        {
          "line": 283,
          "old_api": "hash_select_dirsize",
          "new_api": null,
          "old_text": "hash_select_dirsize(max_size)",
          "new_text": null,
          "old_line_content": "\tinfoP->dsize = infoP->max_dsize = hash_select_dirsize(max_size);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 288,
          "old_api": "ShmemInitStruct",
          "new_api": null,
          "old_text": "ShmemInitStruct(name,\n\t\t\t\t\t\t\t   hash_get_shared_size(infoP, hash_flags),\n\t\t\t\t\t\t\t   &found)",
          "new_text": null,
          "old_line_content": "\tlocation = ShmemInitStruct(name,",
          "new_line_content": "\t *",
          "content_same": false
        },
        {
          "line": 289,
          "old_api": "hash_get_shared_size",
          "new_api": null,
          "old_text": "hash_get_shared_size(infoP, hash_flags)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\t\t\t   hash_get_shared_size(infoP, hash_flags),",
          "new_line_content": "\t * The shared memory allocator must be specified too.",
          "content_same": false
        },
        {
          "line": 419,
          "old_api": "ShmemAddrIsValid",
          "new_api": null,
          "old_text": "ShmemAddrIsValid(structPtr)",
          "new_text": null,
          "old_line_content": "\tAssert(ShmemAddrIsValid(structPtr));",
          "new_line_content": "\t\t\t\t\t\t\tname, size)));",
          "content_same": false
        },
        {
          "line": 302,
          "old_api": "hash_create",
          "new_api": null,
          "old_text": "hash_create(name, init_size, infoP, hash_flags)",
          "new_text": null,
          "old_line_content": "\treturn hash_create(name, init_size, infoP, hash_flags);",
          "new_line_content": "\t * new space",
          "content_same": false
        },
        {
          "line": 176,
          "old_api": "MAXALIGN",
          "new_api": null,
          "old_text": "MAXALIGN(size)",
          "new_text": null,
          "old_line_content": "\tsize = MAXALIGN(size);",
          "new_line_content": "\t * enough.  Many parts of the system are very sensitive to critical data",
          "content_same": false
        },
        {
          "line": 178,
          "old_api": "Assert",
          "new_api": null,
          "old_text": "Assert(ShmemSegHdr != NULL)",
          "new_text": null,
          "old_line_content": "\tAssert(ShmemSegHdr != NULL);",
          "new_line_content": "\t * attempt to align the beginning of the allocation to a cache line",
          "content_same": false
        },
        {
          "line": 435,
          "old_api": "ereport",
          "new_api": null,
          "old_text": "ereport(ERROR,\n\t\t\t\t(errcode(ERRCODE_PROGRAM_LIMIT_EXCEEDED),\n\t\t\t\t errmsg(\"requested shared memory size overflows size_t\")))",
          "new_text": null,
          "old_line_content": "\t\tereport(ERROR,",
          "new_line_content": "Size",
          "content_same": false
        },
        {
          "line": 180,
          "old_api": "SpinLockAcquire",
          "new_api": null,
          "old_text": "SpinLockAcquire(ShmemLock)",
          "new_text": null,
          "old_line_content": "\tSpinLockAcquire(ShmemLock);",
          "new_line_content": "\t * uses the allocated space - e.g. by padding each element in an array of",
          "content_same": false
        },
        {
          "line": 436,
          "old_api": "errcode",
          "new_api": null,
          "old_text": "errcode(ERRCODE_PROGRAM_LIMIT_EXCEEDED)",
          "new_text": null,
          "old_line_content": "\t\t\t\t(errcode(ERRCODE_PROGRAM_LIMIT_EXCEEDED),",
          "new_line_content": "add_size(Size s1, Size s2)",
          "content_same": false
        },
        {
          "line": 437,
          "old_api": "errmsg",
          "new_api": null,
          "old_text": "errmsg(\"requested shared memory size overflows size_t\")",
          "new_text": null,
          "old_line_content": "\t\t\t\t errmsg(\"requested shared memory size overflows size_t\")));",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 197,
          "old_api": "SpinLockRelease",
          "new_api": null,
          "old_text": "SpinLockRelease(ShmemLock)",
          "new_text": null,
          "old_line_content": "\tSpinLockRelease(ShmemLock);",
          "new_line_content": "\tif (newFree <= ShmemSegHdr->totalsize)",
          "content_same": false
        },
        {
          "line": 454,
          "old_api": "ereport",
          "new_api": null,
          "old_text": "ereport(ERROR,\n\t\t\t\t(errcode(ERRCODE_PROGRAM_LIMIT_EXCEEDED),\n\t\t\t\t errmsg(\"requested shared memory size overflows size_t\")))",
          "new_text": null,
          "old_line_content": "\t\tereport(ERROR,",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 327,
          "old_api": "LWLockAcquire",
          "new_api": null,
          "old_text": "LWLockAcquire(ShmemIndexLock, LW_EXCLUSIVE)",
          "new_text": null,
          "old_line_content": "\tLWLockAcquire(ShmemIndexLock, LW_EXCLUSIVE);",
          "new_line_content": " *\tfor NULL.",
          "content_same": false
        },
        {
          "line": 200,
          "old_api": "ereport",
          "new_api": null,
          "old_text": "ereport(WARNING,\n\t\t\t\t(errcode(ERRCODE_OUT_OF_MEMORY),\n\t\t\t\t errmsg(\"out of shared memory\")))",
          "new_text": null,
          "old_line_content": "\t\tereport(WARNING,",
          "new_line_content": "\t\tShmemSegHdr->freeoffset = newFree;",
          "content_same": false
        },
        {
          "line": 201,
          "old_api": "errcode",
          "new_api": null,
          "old_text": "errcode(ERRCODE_OUT_OF_MEMORY)",
          "new_text": null,
          "old_line_content": "\t\t\t\t(errcode(ERRCODE_OUT_OF_MEMORY),",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 202,
          "old_api": "errmsg",
          "new_api": null,
          "old_text": "errmsg(\"out of shared memory\")",
          "new_text": null,
          "old_line_content": "\t\t\t\t errmsg(\"out of shared memory\")));",
          "new_line_content": "\telse",
          "content_same": false
        },
        {
          "line": 455,
          "old_api": "errcode",
          "new_api": null,
          "old_text": "errcode(ERRCODE_PROGRAM_LIMIT_EXCEEDED)",
          "new_text": null,
          "old_line_content": "\t\t\t\t(errcode(ERRCODE_PROGRAM_LIMIT_EXCEEDED),",
          "new_line_content": "\tSize\t\tresult;",
          "content_same": false
        },
        {
          "line": 456,
          "old_api": "errmsg",
          "new_api": null,
          "old_text": "errmsg(\"requested shared memory size overflows size_t\")",
          "new_text": null,
          "old_line_content": "\t\t\t\t errmsg(\"requested shared memory size overflows size_t\")));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 334,
          "old_api": "strcmp",
          "new_api": null,
          "old_text": "strcmp(name, \"ShmemIndex\")",
          "new_text": null,
          "old_line_content": "\t\tAssert(strcmp(name, \"ShmemIndex\") == 0);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 339,
          "old_api": "Assert",
          "new_api": null,
          "old_text": "Assert(shmemseghdr->index != NULL)",
          "new_text": null,
          "old_line_content": "\t\t\tAssert(shmemseghdr->index != NULL);",
          "new_line_content": "\t\tPGShmemHeader *shmemseghdr = ShmemSegHdr;",
          "content_same": false
        },
        {
          "line": 353,
          "old_api": "Assert",
          "new_api": null,
          "old_text": "Assert(shmemseghdr->index == NULL)",
          "new_text": null,
          "old_line_content": "\t\t\tAssert(shmemseghdr->index == NULL);",
          "new_line_content": "\t\t\t/*",
          "content_same": false
        },
        {
          "line": 354,
          "old_api": "ShmemAlloc",
          "new_api": null,
          "old_text": "ShmemAlloc(size)",
          "new_text": null,
          "old_line_content": "\t\t\tstructPtr = ShmemAlloc(size);",
          "new_line_content": "\t\t\t * If the shmem index doesn't exist, we are bootstrapping: we must",
          "content_same": false
        },
        {
          "line": 356,
          "old_api": "ereport",
          "new_api": null,
          "old_text": "ereport(ERROR,\n\t\t\t\t\t\t(errcode(ERRCODE_OUT_OF_MEMORY),\n\t\t\t\t\t\t errmsg(\"not enough shared memory for data structure\"\n\t\t\t\t\t\t\t\t\" \\\"%s\\\" (%zu bytes requested)\",\n\t\t\t\t\t\t\t\tname, size)))",
          "new_text": null,
          "old_line_content": "\t\t\t\tereport(ERROR,",
          "new_line_content": "\t\t\t *",
          "content_same": false
        },
        {
          "line": 357,
          "old_api": "errcode",
          "new_api": null,
          "old_text": "errcode(ERRCODE_OUT_OF_MEMORY)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\t\t(errcode(ERRCODE_OUT_OF_MEMORY),",
          "new_line_content": "\t\t\t * Notice that the ShmemIndexLock is released before the shmem",
          "content_same": false
        },
        {
          "line": 358,
          "old_api": "errmsg",
          "new_api": null,
          "old_text": "errmsg(\"not enough shared memory for data structure\"\n\t\t\t\t\t\t\t\t\" \\\"%s\\\" (%zu bytes requested)\",\n\t\t\t\t\t\t\t\tname, size)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\t\t errmsg(\"not enough shared memory for data structure\"",
          "new_line_content": "\t\t\t * index has been initialized.  This should be OK because no other",
          "content_same": false
        },
        {
          "line": 239,
          "old_api": "ShmemInitHash",
          "new_api": null,
          "old_text": "ShmemInitHash(\"ShmemIndex\",\n\t\t\t\t\t\t\t   SHMEM_INDEX_SIZE, SHMEM_INDEX_SIZE,\n\t\t\t\t\t\t\t   &info, hash_flags)",
          "new_text": null,
          "old_line_content": "\tShmemIndex = ShmemInitHash(\"ShmemIndex\",",
          "new_line_content": "\t * hashtable to exist already, we have a bit of a circularity problem in",
          "content_same": false
        },
        {
          "line": 370,
          "old_api": "hash_search",
          "new_api": null,
          "old_text": "hash_search(ShmemIndex, name, HASH_ENTER_NULL, foundPtr)",
          "new_text": null,
          "old_line_content": "\t\thash_search(ShmemIndex, name, HASH_ENTER_NULL, foundPtr);",
          "new_line_content": "\t\t\t*foundPtr = FALSE;",
          "content_same": false
        },
        {
          "line": 374,
          "old_api": "LWLockRelease",
          "new_api": null,
          "old_text": "LWLockRelease(ShmemIndexLock)",
          "new_text": null,
          "old_line_content": "\t\tLWLockRelease(ShmemIndexLock);",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 375,
          "old_api": "ereport",
          "new_api": null,
          "old_text": "ereport(ERROR,\n\t\t\t\t(errcode(ERRCODE_OUT_OF_MEMORY),\n\t\terrmsg(\"could not create ShmemIndex entry for data structure \\\"%s\\\"\",\n\t\t\t   name)))",
          "new_text": null,
          "old_line_content": "\t\tereport(ERROR,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 376,
          "old_api": "errcode",
          "new_api": null,
          "old_text": "errcode(ERRCODE_OUT_OF_MEMORY)",
          "new_text": null,
          "old_line_content": "\t\t\t\t(errcode(ERRCODE_OUT_OF_MEMORY),",
          "new_line_content": "\t/* look it up in the shmem index */",
          "content_same": false
        },
        {
          "line": 377,
          "old_api": "errmsg",
          "new_api": null,
          "old_text": "errmsg(\"could not create ShmemIndex entry for data structure \\\"%s\\\"\",\n\t\t\t   name)",
          "new_text": null,
          "old_line_content": "\t\terrmsg(\"could not create ShmemIndex entry for data structure \\\"%s\\\"\",",
          "new_line_content": "\tresult = (ShmemIndexEnt *)",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 4,
      "total_additions": 40,
      "total_deletions": 40,
      "total_api_changes": 84
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 10,
        "api_related_lines": 84,
        "non_api_lines": 6,
        "non_api_line_numbers": [
          174,
          175,
          177,
          179,
          181,
          182
        ]
      }
    },
    "api_calls_before": 57,
    "api_calls_after": 57,
    "diff_info": {
      "added_lines": 10,
      "removed_lines": 2,
      "total_diff_lines": 25
    }
  }
}