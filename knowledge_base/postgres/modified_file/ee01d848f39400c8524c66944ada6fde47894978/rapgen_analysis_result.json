{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/postgres/modified_file/ee01d848f39400c8524c66944ada6fde47894978",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/postgres/modified_file/ee01d848f39400c8524c66944ada6fde47894978/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/postgres/modified_file/ee01d848f39400c8524c66944ada6fde47894978/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/postgres/modified_file/ee01d848f39400c8524c66944ada6fde47894978/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 642,
          "old_api": "bms_make_singleton",
          "new_api": "BITMAPSET_SIZE",
          "old_text": "bms_make_singleton(x)",
          "new_text": "BITMAPSET_SIZE(wordnum + 1)",
          "old_line_content": "\t\tresult = bms_make_singleton(x);",
          "new_line_content": "\t\ta = (Bitmapset *) repalloc(a, BITMAPSET_SIZE(wordnum + 1));",
          "content_same": false
        },
        {
          "line": 671,
          "old_api": "WORDNUM",
          "new_api": "BITNUM",
          "old_text": "WORDNUM(x)",
          "new_text": "BITNUM(x)",
          "old_line_content": "\twordnum = WORDNUM(x);",
          "new_line_content": "\tbitnum = BITNUM(x);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 827,
          "old_api": null,
          "new_api": "RIGHTMOST_ONE",
          "old_text": null,
          "new_text": "RIGHTMOST_ONE(w)",
          "old_line_content": "",
          "new_line_content": "\t\t\tw = RIGHTMOST_ONE(w);",
          "content_same": false
        },
        {
          "line": 865,
          "old_api": null,
          "new_api": "hash_any",
          "old_text": null,
          "new_text": "hash_any((const unsigned char *) a->words,\n\t\t\t\t\t\t\t\t   (lastword + 1) * sizeof(bitmapword))",
          "old_line_content": "\t\treturn 0;\t\t\t\t/* All empty sets hash to 0 */",
          "new_line_content": "\treturn DatumGetUInt32(hash_any((const unsigned char *) a->words,",
          "content_same": false
        },
        {
          "line": 709,
          "old_api": null,
          "new_api": "pfree",
          "old_text": null,
          "new_text": "pfree(a)",
          "old_line_content": "\tif (result != a)",
          "new_line_content": "\t\tpfree(a);",
          "content_same": false
        },
        {
          "line": 696,
          "old_api": null,
          "new_api": "bms_copy",
          "old_text": null,
          "new_text": "bms_copy(b)",
          "old_line_content": "\t{",
          "new_line_content": "\t\tresult = bms_copy(b);",
          "content_same": false
        },
        {
          "line": 690,
          "old_api": null,
          "new_api": "bms_copy",
          "old_text": null,
          "new_text": "bms_copy(b)",
          "old_line_content": "\tif (a == NULL)",
          "new_line_content": "\t\treturn bms_copy(b);",
          "content_same": false
        },
        {
          "line": 754,
          "old_api": null,
          "new_api": "Min",
          "old_text": null,
          "new_text": "Min(a->nwords, b->nwords)",
          "old_line_content": "\t/* Remove b's bits from a; we need never copy */",
          "new_line_content": "\tshortlen = Min(a->nwords, b->nwords);",
          "content_same": false
        },
        {
          "line": 731,
          "old_api": null,
          "new_api": "Min",
          "old_text": null,
          "new_text": "Min(a->nwords, b->nwords)",
          "old_line_content": "\t/* Intersect b into a; we need never copy */",
          "new_line_content": "\tshortlen = Min(a->nwords, b->nwords);",
          "content_same": false
        },
        {
          "line": 727,
          "old_api": null,
          "new_api": "pfree",
          "old_text": null,
          "new_text": "pfree(a)",
          "old_line_content": "\t{",
          "new_line_content": "\t\tpfree(a);",
          "content_same": false
        },
        {
          "line": 792,
          "old_api": null,
          "new_api": "pfree",
          "old_text": null,
          "new_text": "pfree(other)",
          "old_line_content": "\tif (other != result)\t\t/* pure paranoia */",
          "new_line_content": "\t\tpfree(other);",
          "content_same": false
        },
        {
          "line": 667,
          "old_api": null,
          "new_api": "elog",
          "old_text": null,
          "new_text": "elog(ERROR, \"negative bitmapset member not allowed\")",
          "old_line_content": "\tif (x < 0)",
          "new_line_content": "\t\telog(ERROR, \"negative bitmapset member not allowed\");",
          "content_same": false
        },
        {
          "line": 670,
          "old_api": null,
          "new_api": "WORDNUM",
          "old_text": null,
          "new_text": "WORDNUM(x)",
          "old_line_content": "\t\treturn NULL;",
          "new_line_content": "\twordnum = WORDNUM(x);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 672,
          "old_api": "BITNUM",
          "new_api": null,
          "old_text": "BITNUM(x)",
          "new_text": null,
          "old_line_content": "\tbitnum = BITNUM(x);",
          "new_line_content": "\tif (wordnum < a->nwords)",
          "content_same": false
        },
        {
          "line": 866,
          "old_api": "hash_any",
          "new_api": null,
          "old_text": "hash_any((const unsigned char *) a->words,\n\t\t\t\t\t\t\t\t   (lastword + 1) * sizeof(bitmapword))",
          "new_text": null,
          "old_line_content": "\treturn DatumGetUInt32(hash_any((const unsigned char *) a->words,",
          "new_line_content": "\t\t\t\t\t\t\t\t   (lastword + 1) * sizeof(bitmapword)));",
          "content_same": false
        },
        {
          "line": 732,
          "old_api": "Min",
          "new_api": null,
          "old_text": "Min(a->nwords, b->nwords)",
          "new_text": null,
          "old_line_content": "\tshortlen = Min(a->nwords, b->nwords);",
          "new_line_content": "\tfor (i = 0; i < shortlen; i++)",
          "content_same": false
        },
        {
          "line": 646,
          "old_api": "pfree",
          "new_api": null,
          "old_text": "pfree(a)",
          "new_text": null,
          "old_line_content": "\t\tpfree(a);",
          "new_line_content": "\t\t\ta->words[i] = 0;",
          "content_same": false
        },
        {
          "line": 828,
          "old_api": "RIGHTMOST_ONE",
          "new_api": null,
          "old_text": "RIGHTMOST_ONE(w)",
          "new_text": null,
          "old_line_content": "\t\t\tw = RIGHTMOST_ONE(w);",
          "new_line_content": "\t\t\ta->words[wordnum] &= ~w;",
          "content_same": false
        },
        {
          "line": 710,
          "old_api": "pfree",
          "new_api": null,
          "old_text": "pfree(a)",
          "new_text": null,
          "old_line_content": "\t\tpfree(a);",
          "new_line_content": "\treturn result;",
          "content_same": false
        },
        {
          "line": 691,
          "old_api": "bms_copy",
          "new_api": null,
          "old_text": "bms_copy(b)",
          "new_text": null,
          "old_line_content": "\t\treturn bms_copy(b);",
          "new_line_content": "\tif (b == NULL)",
          "content_same": false
        },
        {
          "line": 697,
          "old_api": "bms_copy",
          "new_api": null,
          "old_text": "bms_copy(b)",
          "new_text": null,
          "old_line_content": "\t\tresult = bms_copy(b);",
          "new_line_content": "\t\tother = a;",
          "content_same": false
        },
        {
          "line": 755,
          "old_api": "Min",
          "new_api": null,
          "old_text": "Min(a->nwords, b->nwords)",
          "new_text": null,
          "old_line_content": "\tshortlen = Min(a->nwords, b->nwords);",
          "new_line_content": "\tfor (i = 0; i < shortlen; i++)",
          "content_same": false
        },
        {
          "line": 728,
          "old_api": "pfree",
          "new_api": null,
          "old_text": "pfree(a)",
          "new_text": null,
          "old_line_content": "\t\tpfree(a);",
          "new_line_content": "\t\treturn NULL;",
          "content_same": false
        },
        {
          "line": 793,
          "old_api": "pfree",
          "new_api": null,
          "old_text": "pfree(other)",
          "new_text": null,
          "old_line_content": "\t\tpfree(other);",
          "new_line_content": "\treturn result;",
          "content_same": false
        },
        {
          "line": 668,
          "old_api": "elog",
          "new_api": null,
          "old_text": "elog(ERROR, \"negative bitmapset member not allowed\")",
          "new_text": null,
          "old_line_content": "\t\telog(ERROR, \"negative bitmapset member not allowed\");",
          "new_line_content": "\tif (a == NULL)",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 2,
      "total_additions": 11,
      "total_deletions": 12,
      "total_api_changes": 25
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 13,
        "api_related_lines": 25,
        "non_api_lines": 11,
        "non_api_line_numbers": [
          643,
          644,
          645,
          647,
          648,
          649,
          635,
          636,
          637,
          638,
          639
        ]
      }
    },
    "api_calls_before": 55,
    "api_calls_after": 55,
    "diff_info": {
      "added_lines": 9,
      "removed_lines": 10,
      "total_diff_lines": 36
    }
  }
}