{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/postgres/modified_file/756e221db610f333649385f7fef96e7e9e23ed71",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/postgres/modified_file/756e221db610f333649385f7fef96e7e9e23ed71/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/postgres/modified_file/756e221db610f333649385f7fef96e7e9e23ed71/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/postgres/modified_file/756e221db610f333649385f7fef96e7e9e23ed71/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 787,
          "old_api": "ProcessConfigFile",
          "new_api": "ProcessProcSignalBarrier",
          "old_text": "ProcessConfigFile(PGC_SIGHUP)",
          "new_text": "ProcessProcSignalBarrier()",
          "old_line_content": "\t\tProcessConfigFile(PGC_SIGHUP);",
          "new_line_content": "\t\tProcessProcSignalBarrier();",
          "content_same": false
        },
        {
          "line": 860,
          "old_api": "shutdown_cb",
          "new_api": "errmsg",
          "old_text": "ArchiveContext.shutdown_cb()",
          "new_text": "errmsg(\"archive modules must register an archive callback\")",
          "old_line_content": "\t\tArchiveContext.shutdown_cb();",
          "new_line_content": "\t\t\t\t(errmsg(\"archive modules must register an archive callback\")));",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 791,
          "old_api": null,
          "new_api": "ProcessLogMemoryContextInterrupt",
          "old_text": null,
          "new_text": "ProcessLogMemoryContextInterrupt()",
          "old_line_content": "",
          "new_line_content": "\t\tProcessLogMemoryContextInterrupt();",
          "content_same": false
        },
        {
          "line": 795,
          "old_api": null,
          "new_api": "pstrdup",
          "old_text": null,
          "new_text": "pstrdup(XLogArchiveLibrary)",
          "old_line_content": "\t\t\t * Call the currently loaded archive module's shutdown callback,",
          "new_line_content": "\t\tchar\t   *archiveLib = pstrdup(XLogArchiveLibrary);",
          "content_same": false
        },
        {
          "line": 799,
          "old_api": null,
          "new_api": "ProcessConfigFile",
          "old_text": null,
          "new_text": "ProcessConfigFile(PGC_SIGHUP)",
          "old_line_content": "",
          "new_line_content": "\t\tProcessConfigFile(PGC_SIGHUP);",
          "content_same": false
        },
        {
          "line": 801,
          "old_api": null,
          "new_api": "strcmp",
          "old_text": null,
          "new_text": "strcmp(XLogArchiveLibrary, archiveLib)",
          "old_line_content": "\t\t\t * Ideally, we would simply unload the previous archive module and",
          "new_line_content": "\t\tarchiveLibChanged = strcmp(XLogArchiveLibrary, archiveLib) != 0;",
          "content_same": false
        },
        {
          "line": 802,
          "old_api": null,
          "new_api": "pfree",
          "old_text": null,
          "new_text": "pfree(archiveLib)",
          "old_line_content": "\t\t\t * load the new one, but there is presently no mechanism for",
          "new_line_content": "\t\tpfree(archiveLib);",
          "content_same": false
        },
        {
          "line": 810,
          "old_api": null,
          "new_api": "call_archive_module_shutdown_callback",
          "old_text": null,
          "new_text": "call_archive_module_shutdown_callback(0, 0)",
          "old_line_content": "\t\t\t\t\t\t\t\"\\\"archive_library\\\" was changed\")));",
          "new_line_content": "\t\t\tcall_archive_module_shutdown_callback(0, 0);",
          "content_same": false
        },
        {
          "line": 820,
          "old_api": null,
          "new_api": "ereport",
          "old_text": null,
          "new_text": "ereport(LOG,\n\t\t\t\t\t(errmsg(\"restarting archiver process because value of \"\n\t\t\t\t\t\t\t\"\\\"archive_library\\\" was changed\")))",
          "old_line_content": " * Loads the archiving callbacks into our local ArchiveContext.",
          "new_line_content": "\t\t\tereport(LOG,",
          "content_same": false
        },
        {
          "line": 821,
          "old_api": null,
          "new_api": "errmsg",
          "old_text": null,
          "new_text": "errmsg(\"restarting archiver process because value of \"\n\t\t\t\t\t\t\t\"\\\"archive_library\\\" was changed\")",
          "old_line_content": " */",
          "new_line_content": "\t\t\t\t\t(errmsg(\"restarting archiver process because value of \"",
          "content_same": false
        },
        {
          "line": 824,
          "old_api": null,
          "new_api": "proc_exit",
          "old_text": null,
          "new_text": "proc_exit(0)",
          "old_line_content": "{",
          "new_line_content": "\t\t\tproc_exit(0);",
          "content_same": false
        },
        {
          "line": 839,
          "old_api": null,
          "new_api": "memset",
          "old_text": null,
          "new_text": "memset(&ArchiveContext, 0, sizeof(ArchiveModuleCallbacks))",
          "old_line_content": "",
          "new_line_content": "\tmemset(&ArchiveContext, 0, sizeof(ArchiveModuleCallbacks));",
          "content_same": false
        },
        {
          "line": 849,
          "old_api": null,
          "new_api": "load_external_function",
          "old_text": null,
          "new_text": "load_external_function(XLogArchiveLibrary,\n\t\t\t\t\t\t\t\t   \"_PG_archive_module_init\", false, NULL)",
          "old_line_content": "}",
          "new_line_content": "\t\t\tload_external_function(XLogArchiveLibrary,",
          "content_same": false
        },
        {
          "line": 853,
          "old_api": null,
          "new_api": "ereport",
          "old_text": null,
          "new_text": "ereport(ERROR,\n\t\t\t\t(errmsg(\"archive modules have to declare the _PG_archive_module_init symbol\")))",
          "old_line_content": " *",
          "new_line_content": "\t\tereport(ERROR,",
          "content_same": false
        },
        {
          "line": 854,
          "old_api": null,
          "new_api": "errmsg",
          "old_text": null,
          "new_text": "errmsg(\"archive modules have to declare the _PG_archive_module_init symbol\")",
          "old_line_content": " * Calls the loaded archive module's shutdown callback, if one is defined.",
          "new_line_content": "\t\t\t\t(errmsg(\"archive modules have to declare the _PG_archive_module_init symbol\")));",
          "content_same": false
        },
        {
          "line": 856,
          "old_api": null,
          "new_api": "*archive_init) (&ArchiveContext)",
          "old_text": null,
          "new_text": "*archive_init) (&ArchiveContext)",
          "old_line_content": "static void",
          "new_line_content": "\t(*archive_init) (&ArchiveContext);",
          "content_same": false
        },
        {
          "line": 859,
          "old_api": null,
          "new_api": "ereport",
          "old_text": null,
          "new_text": "ereport(ERROR,\n\t\t\t\t(errmsg(\"archive modules must register an archive callback\")))",
          "old_line_content": "\tif (ArchiveContext.shutdown_cb != NULL)",
          "new_line_content": "\t\tereport(ERROR,",
          "content_same": false
        },
        {
          "line": 872,
          "old_api": null,
          "new_api": "shutdown_cb",
          "old_text": null,
          "new_text": "ArchiveContext.shutdown_cb()",
          "old_line_content": "",
          "new_line_content": "\t\tArchiveContext.shutdown_cb();",
          "content_same": false
        },
        {
          "line": 756,
          "old_api": null,
          "new_api": "rename",
          "old_text": null,
          "new_text": "rename(rlogready, rlogdone)",
          "old_line_content": " */",
          "new_line_content": "\tif (rename(rlogready, rlogdone) < 0)",
          "content_same": false
        },
        {
          "line": 757,
          "old_api": null,
          "new_api": "ereport",
          "old_text": null,
          "new_text": "ereport(WARNING,\n\t\t\t\t(errcode_for_file_access(),\n\t\t\t\t errmsg(\"could not rename file \\\"%s\\\" to \\\"%s\\\": %m\",\n\t\t\t\t\t\trlogready, rlogdone)))",
          "old_line_content": "static void",
          "new_line_content": "\t\tereport(WARNING,",
          "content_same": false
        },
        {
          "line": 758,
          "old_api": null,
          "new_api": "errcode_for_file_access",
          "old_text": null,
          "new_text": "errcode_for_file_access()",
          "old_line_content": "pgarch_die(int code, Datum arg)",
          "new_line_content": "\t\t\t\t(errcode_for_file_access(),",
          "content_same": false
        },
        {
          "line": 759,
          "old_api": null,
          "new_api": "errmsg",
          "old_text": null,
          "new_text": "errmsg(\"could not rename file \\\"%s\\\" to \\\"%s\\\": %m\",\n\t\t\t\t\t\trlogready, rlogdone)",
          "old_line_content": "{",
          "new_line_content": "\t\t\t\t errmsg(\"could not rename file \\\"%s\\\" to \\\"%s\\\": %m\",",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 837,
          "old_api": "load_external_function",
          "new_api": null,
          "old_text": "load_external_function(XLogArchiveLibrary,\n\t\t\t\t\t\t\t\t   \"_PG_archive_module_init\", false, NULL)",
          "new_text": null,
          "old_line_content": "\t\t\tload_external_function(XLogArchiveLibrary,",
          "new_line_content": "\tArchiveModuleInit archive_init;",
          "content_same": false
        },
        {
          "line": 775,
          "old_api": "ProcessProcSignalBarrier",
          "new_api": null,
          "old_text": "ProcessProcSignalBarrier()",
          "new_text": null,
          "old_line_content": "\t\tProcessProcSignalBarrier();",
          "new_line_content": "/*",
          "content_same": false
        },
        {
          "line": 808,
          "old_api": "ereport",
          "new_api": null,
          "old_text": "ereport(LOG,\n\t\t\t\t\t(errmsg(\"restarting archiver process because value of \"\n\t\t\t\t\t\t\t\"\\\"archive_library\\\" was changed\")))",
          "new_text": null,
          "old_line_content": "\t\t\tereport(LOG,",
          "new_line_content": "\t\t\t * if one is defined.",
          "content_same": false
        },
        {
          "line": 809,
          "old_api": "errmsg",
          "new_api": null,
          "old_text": "errmsg(\"restarting archiver process because value of \"\n\t\t\t\t\t\t\t\"\\\"archive_library\\\" was changed\")",
          "new_text": null,
          "old_line_content": "\t\t\t\t\t(errmsg(\"restarting archiver process because value of \"",
          "new_line_content": "\t\t\t */",
          "content_same": false
        },
        {
          "line": 841,
          "old_api": "ereport",
          "new_api": null,
          "old_text": "ereport(ERROR,\n\t\t\t\t(errmsg(\"archive modules have to declare the _PG_archive_module_init symbol\")))",
          "new_text": null,
          "old_line_content": "\t\tereport(ERROR,",
          "new_line_content": "\t/*",
          "content_same": false
        },
        {
          "line": 779,
          "old_api": "ProcessLogMemoryContextInterrupt",
          "new_api": null,
          "old_text": "ProcessLogMemoryContextInterrupt()",
          "new_text": null,
          "old_line_content": "\t\tProcessLogMemoryContextInterrupt();",
          "new_line_content": " * It checks for barrier events, config update and request for logging of",
          "content_same": false
        },
        {
          "line": 748,
          "old_api": "durable_rename",
          "new_api": null,
          "old_text": "durable_rename(rlogready, rlogdone, WARNING)",
          "new_text": null,
          "old_line_content": "\t(void) durable_rename(rlogready, rlogdone, WARNING);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 812,
          "old_api": "proc_exit",
          "new_api": null,
          "old_text": "proc_exit(0)",
          "new_text": null,
          "old_line_content": "\t\t\tproc_exit(0);",
          "new_line_content": "\t\t\t/*",
          "content_same": false
        },
        {
          "line": 842,
          "old_api": "errmsg",
          "new_api": null,
          "old_text": "errmsg(\"archive modules have to declare the _PG_archive_module_init symbol\")",
          "new_text": null,
          "old_line_content": "\t\t\t\t(errmsg(\"archive modules have to declare the _PG_archive_module_init symbol\")));",
          "new_line_content": "\t * If shell archiving is enabled, use our special initialization function.",
          "content_same": false
        },
        {
          "line": 783,
          "old_api": "pstrdup",
          "new_api": null,
          "old_text": "pstrdup(XLogArchiveLibrary)",
          "new_text": null,
          "old_line_content": "\t\tchar\t   *archiveLib = pstrdup(XLogArchiveLibrary);",
          "new_line_content": "static void",
          "content_same": false
        },
        {
          "line": 844,
          "old_api": "*archive_init) (&ArchiveContext)",
          "new_api": null,
          "old_text": "*archive_init) (&ArchiveContext)",
          "new_text": null,
          "old_line_content": "\t(*archive_init) (&ArchiveContext);",
          "new_line_content": "\t */",
          "content_same": false
        },
        {
          "line": 847,
          "old_api": "ereport",
          "new_api": null,
          "old_text": "ereport(ERROR,\n\t\t\t\t(errmsg(\"archive modules must register an archive callback\")))",
          "new_text": null,
          "old_line_content": "\t\tereport(ERROR,",
          "new_line_content": "\telse",
          "content_same": false
        },
        {
          "line": 848,
          "old_api": "errmsg",
          "new_api": null,
          "old_text": "errmsg(\"archive modules must register an archive callback\")",
          "new_text": null,
          "old_line_content": "\t\t\t\t(errmsg(\"archive modules must register an archive callback\")));",
          "new_line_content": "\t\tarchive_init = (ArchiveModuleInit)",
          "content_same": false
        },
        {
          "line": 789,
          "old_api": "strcmp",
          "new_api": null,
          "old_text": "strcmp(XLogArchiveLibrary, archiveLib)",
          "new_text": null,
          "old_line_content": "\t\tarchiveLibChanged = strcmp(XLogArchiveLibrary, archiveLib) != 0;",
          "new_line_content": "\t/* Perform logging of memory contexts of this process */",
          "content_same": false
        },
        {
          "line": 790,
          "old_api": "pfree",
          "new_api": null,
          "old_text": "pfree(archiveLib)",
          "new_text": null,
          "old_line_content": "\t\tpfree(archiveLib);",
          "new_line_content": "\tif (LogMemoryContextPending)",
          "content_same": false
        },
        {
          "line": 827,
          "old_api": "memset",
          "new_api": null,
          "old_text": "memset(&ArchiveContext, 0, sizeof(ArchiveModuleCallbacks))",
          "new_text": null,
          "old_line_content": "\tmemset(&ArchiveContext, 0, sizeof(ArchiveModuleCallbacks));",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 798,
          "old_api": "call_archive_module_shutdown_callback",
          "new_api": null,
          "old_text": "call_archive_module_shutdown_callback(0, 0)",
          "new_text": null,
          "old_line_content": "\t\t\tcall_archive_module_shutdown_callback(0, 0);",
          "new_line_content": "\t\tConfigReloadPending = false;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 2,
      "total_additions": 20,
      "total_deletions": 17,
      "total_api_changes": 39
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 13,
        "api_related_lines": 39,
        "non_api_lines": 8,
        "non_api_line_numbers": [
          749,
          750,
          751,
          752,
          753,
          754,
          755,
          760
        ]
      }
    },
    "api_calls_before": 126,
    "api_calls_after": 129,
    "diff_info": {
      "added_lines": 13,
      "removed_lines": 1,
      "total_diff_lines": 26
    }
  }
}