{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/postgres/modified_file/bfd4567b88496bf9669658e5ab381b296dd9ffe1",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/postgres/modified_file/bfd4567b88496bf9669658e5ab381b296dd9ffe1/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/postgres/modified_file/bfd4567b88496bf9669658e5ab381b296dd9ffe1/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/postgres/modified_file/bfd4567b88496bf9669658e5ab381b296dd9ffe1/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 6839,
          "old_api": "pg_time_now",
          "new_api": "doLog",
          "old_text": "pg_time_now()",
          "new_text": "doLog(thread, state, &aggs, false, 0, 0)",
          "old_line_content": "\tthread->conn_duration += pg_time_now() - start;",
          "new_line_content": "\t\t\tdoLog(thread, state, &aggs, false, 0, 0);",
          "content_same": false
        },
        {
          "line": 6899,
          "old_api": "CreateTimerQueue",
          "new_api": "exit",
          "old_text": "CreateTimerQueue()",
          "new_text": "exit(1)",
          "old_line_content": "\tqueue = CreateTimerQueue();",
          "new_line_content": "\t\texit(1);",
          "content_same": false
        },
        {
          "line": 7072,
          "old_api": "select",
          "new_api": "FD_ISSET",
          "old_text": "select(sa->maxfd + 1, &sa->fds, NULL, NULL, NULL)",
          "new_text": "FD_ISSET(fd, &sa->fds)",
          "old_line_content": "\t\treturn select(sa->maxfd + 1, &sa->fds, NULL, NULL, NULL);",
          "new_line_content": "\treturn (FD_ISSET(fd, &sa->fds) != 0);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 6660,
          "old_api": null,
          "new_api": "clear_socket_set",
          "old_text": null,
          "new_text": "clear_socket_set(sockets)",
          "old_line_content": "\t\tpg_time_usec_t min_usec;",
          "new_line_content": "\t\tclear_socket_set(sockets);",
          "content_same": false
        },
        {
          "line": 7044,
          "old_api": null,
          "new_api": "pg_log_fatal",
          "old_text": null,
          "new_text": "pg_log_fatal(\"too many client connections for select()\")",
          "old_line_content": "{",
          "new_line_content": "\t\tpg_log_fatal(\"too many client connections for select()\");",
          "content_same": false
        },
        {
          "line": 7045,
          "old_api": null,
          "new_api": "exit",
          "old_text": null,
          "new_text": "exit(1)",
          "old_line_content": "\tif (fd < 0 || fd >= FD_SETSIZE)",
          "new_line_content": "\t\texit(1);",
          "content_same": false
        },
        {
          "line": 6791,
          "old_api": null,
          "new_api": "advanceConnectionState",
          "old_text": null,
          "new_text": "advanceConnectionState(thread, st, &aggs)",
          "old_line_content": "\t\t\telse if (st->state == CSTATE_FINISHED ||",
          "new_line_content": "\t\t\tadvanceConnectionState(thread, st, &aggs);",
          "content_same": false
        },
        {
          "line": 7047,
          "old_api": null,
          "new_api": "FD_SET",
          "old_text": null,
          "new_text": "FD_SET(fd, &sa->fds)",
          "old_line_content": "\t\t/*",
          "new_line_content": "\tFD_SET(fd, &sa->fds);",
          "content_same": false
        },
        {
          "line": 6673,
          "old_api": null,
          "new_api": "pg_time_now_lazy",
          "old_text": null,
          "new_text": "pg_time_now_lazy(&now)",
          "old_line_content": "",
          "new_line_content": "\t\t\t\tpg_time_now_lazy(&now);",
          "content_same": false
        },
        {
          "line": 6804,
          "old_api": null,
          "new_api": "pg_time_now",
          "old_text": null,
          "new_text": "pg_time_now()",
          "old_line_content": "\t\t\tif (st->state == CSTATE_FINISHED || st->state == CSTATE_ABORTED)",
          "new_line_content": "\t\t\tpg_time_usec_t now = pg_time_now();",
          "content_same": false
        },
        {
          "line": 7061,
          "old_api": null,
          "new_api": "select",
          "old_text": null,
          "new_text": "select(sa->maxfd + 1, &sa->fds, NULL, NULL, &timeout)",
          "old_line_content": "{",
          "new_line_content": "\t\treturn select(sa->maxfd + 1, &sa->fds, NULL, NULL, &timeout);",
          "content_same": false
        },
        {
          "line": 7065,
          "old_api": null,
          "new_api": "select",
          "old_text": null,
          "new_text": "select(sa->maxfd + 1, &sa->fds, NULL, NULL, NULL)",
          "old_line_content": "",
          "new_line_content": "\t\treturn select(sa->maxfd + 1, &sa->fds, NULL, NULL, NULL);",
          "content_same": false
        },
        {
          "line": 6814,
          "old_api": null,
          "new_api": "printProgressReport",
          "old_text": null,
          "new_text": "printProgressReport(thread, thread_start, now,\n\t\t\t\t\t\t\t\t\t&last, &last_report)",
          "old_line_content": "\t\t\t{",
          "new_line_content": "\t\t\t\tprintProgressReport(thread, thread_start, now,",
          "content_same": false
        },
        {
          "line": 6687,
          "old_api": null,
          "new_api": "PQsocket",
          "old_text": null,
          "new_text": "PQsocket(st->con)",
          "old_line_content": "\t\t\t}",
          "new_line_content": "\t\t\t\tint\t\t\tsock = PQsocket(st->con);",
          "content_same": false
        },
        {
          "line": 6691,
          "old_api": null,
          "new_api": "PQerrorMessage",
          "old_text": null,
          "new_text": "PQerrorMessage(st->con)",
          "old_line_content": "\t\t\t\t * waiting for result from server - nothing to do unless the",
          "new_line_content": "\t\t\t\t\tpg_log_error(\"invalid socket: %s\", PQerrorMessage(st->con));",
          "content_same": false
        },
        {
          "line": 6948,
          "old_api": null,
          "new_api": "offsetof",
          "old_text": null,
          "new_text": "offsetof(socket_set, pollfds)",
          "old_line_content": "#ifdef POLL_USING_PPOLL",
          "new_line_content": "\tsa = (socket_set *) pg_malloc0(offsetof(socket_set, pollfds) +",
          "content_same": false
        },
        {
          "line": 6695,
          "old_api": null,
          "new_api": "add_socket_to_set",
          "old_text": null,
          "new_text": "add_socket_to_set(sockets, sock, nsocks++)",
          "old_line_content": "",
          "new_line_content": "\t\t\t\tadd_socket_to_set(sockets, sock, nsocks++);",
          "content_same": false
        },
        {
          "line": 6830,
          "old_api": null,
          "new_api": "pg_time_now",
          "old_text": null,
          "new_text": "pg_time_now()",
          "old_line_content": "\t\t\t\t\tnext_report += (int64) 1000000 * progress;",
          "new_line_content": "\tstart = pg_time_now();",
          "content_same": false
        },
        {
          "line": 6831,
          "old_api": null,
          "new_api": "disconnect_all",
          "old_text": null,
          "new_text": "disconnect_all(state, nstate)",
          "old_line_content": "\t\t\t\t} while (now >= next_report);",
          "new_line_content": "\tdisconnect_all(state, nstate);",
          "content_same": false
        },
        {
          "line": 6832,
          "old_api": null,
          "new_api": "pg_time_now",
          "old_text": null,
          "new_text": "pg_time_now()",
          "old_line_content": "\t\t\t}",
          "new_line_content": "\tthread->conn_duration += pg_time_now() - start;",
          "content_same": false
        },
        {
          "line": 6958,
          "old_api": null,
          "new_api": "pg_free",
          "old_text": null,
          "new_text": "pg_free(sa)",
          "old_line_content": "\tsa->curfds = 0;",
          "new_line_content": "\tpg_free(sa);",
          "content_same": false
        },
        {
          "line": 6712,
          "old_api": null,
          "new_api": "pg_time_now_lazy",
          "old_text": null,
          "new_text": "pg_time_now_lazy(&now)",
          "old_line_content": "\t\t\t\tbreak;",
          "new_line_content": "\t\t\tpg_time_now_lazy(&now);",
          "content_same": false
        },
        {
          "line": 6841,
          "old_api": null,
          "new_api": "fclose",
          "old_text": null,
          "new_text": "fclose(thread->logfile)",
          "old_line_content": "\tif (thread->logfile)",
          "new_line_content": "\t\tfclose(thread->logfile);",
          "content_same": false
        },
        {
          "line": 6970,
          "old_api": null,
          "new_api": "Assert",
          "old_text": null,
          "new_text": "Assert(idx < sa->maxfds && idx == sa->curfds)",
          "old_line_content": "{",
          "new_line_content": "\tAssert(idx < sa->maxfds && idx == sa->curfds);",
          "content_same": false
        },
        {
          "line": 6844,
          "old_api": null,
          "new_api": "free_socket_set",
          "old_text": null,
          "new_text": "free_socket_set(sockets)",
          "old_line_content": "\t\t{",
          "new_line_content": "\tfree_socket_set(sockets);",
          "content_same": false
        },
        {
          "line": 6853,
          "old_api": null,
          "new_api": "PQfinish",
          "old_text": null,
          "new_text": "PQfinish(st->con)",
          "old_line_content": "}",
          "new_line_content": "\t\tPQfinish(st->con);",
          "content_same": false
        },
        {
          "line": 6986,
          "old_api": null,
          "new_api": "ppoll",
          "old_text": null,
          "new_text": "ppoll(sa->pollfds, sa->curfds, &timeout, NULL)",
          "old_line_content": "{",
          "new_line_content": "\t\treturn ppoll(sa->pollfds, sa->curfds, &timeout, NULL);",
          "content_same": false
        },
        {
          "line": 6732,
          "old_api": null,
          "new_api": "wait_on_socket_set",
          "old_text": null,
          "new_text": "wait_on_socket_set(sockets, min_usec)",
          "old_line_content": "\t\t{",
          "new_line_content": "\t\t\t\t\trc = wait_on_socket_set(sockets, min_usec);",
          "content_same": false
        },
        {
          "line": 6990,
          "old_api": null,
          "new_api": "ppoll",
          "old_text": null,
          "new_text": "ppoll(sa->pollfds, sa->curfds, NULL, NULL)",
          "old_line_content": "",
          "new_line_content": "\t\treturn ppoll(sa->pollfds, sa->curfds, NULL, NULL);",
          "content_same": false
        },
        {
          "line": 6736,
          "old_api": null,
          "new_api": "pg_usleep",
          "old_text": null,
          "new_text": "pg_usleep(min_usec)",
          "old_line_content": "\t\t\t{",
          "new_line_content": "\t\t\t\t\tpg_usleep(min_usec);",
          "content_same": false
        },
        {
          "line": 6741,
          "old_api": null,
          "new_api": "wait_on_socket_set",
          "old_text": null,
          "new_text": "wait_on_socket_set(sockets, 0)",
          "old_line_content": "\t\t\t\telse\t\t\t/* nothing active, simple sleep */",
          "new_line_content": "\t\t\t\trc = wait_on_socket_set(sockets, 0);",
          "content_same": false
        },
        {
          "line": 6616,
          "old_api": null,
          "new_api": "doConnect",
          "old_text": null,
          "new_text": "doConnect()",
          "old_line_content": "\t\t\t{",
          "new_line_content": "\t\t\tif ((state[i].con = doConnect()) == NULL)",
          "content_same": false
        },
        {
          "line": 6873,
          "old_api": null,
          "new_api": "pqsignal",
          "old_text": null,
          "new_text": "pqsignal(SIGALRM, handle_sig_alarm)",
          "old_line_content": "{",
          "new_line_content": "\tpqsignal(SIGALRM, handle_sig_alarm);",
          "content_same": false
        },
        {
          "line": 6874,
          "old_api": null,
          "new_api": "alarm",
          "old_text": null,
          "new_text": "alarm(seconds)",
          "old_line_content": "\ttimer_exceeded = true;",
          "new_line_content": "\talarm(seconds);",
          "content_same": false
        },
        {
          "line": 6752,
          "old_api": null,
          "new_api": "pg_log_fatal",
          "old_text": null,
          "new_text": "pg_log_fatal(\"%s() failed: %m\", SOCKET_WAIT_METHOD)",
          "old_line_content": "\t\t\t{",
          "new_line_content": "\t\t\t\tpg_log_fatal(\"%s() failed: %m\", SOCKET_WAIT_METHOD);",
          "content_same": false
        },
        {
          "line": 7008,
          "old_api": null,
          "new_api": "Assert",
          "old_text": null,
          "new_text": "Assert(idx < sa->curfds && sa->pollfds[idx].fd == fd)",
          "old_line_content": "\t * early.  Hence, if the socket set is empty, silently return false",
          "new_line_content": "\tAssert(idx < sa->curfds && sa->pollfds[idx].fd == fd);",
          "content_same": false
        },
        {
          "line": 6626,
          "old_api": null,
          "new_api": "THREAD_BARRIER_WAIT",
          "old_text": null,
          "new_text": "THREAD_BARRIER_WAIT(&barrier)",
          "old_line_content": "\t\t\t\tgoto done;",
          "new_line_content": "\t\t\t\tTHREAD_BARRIER_WAIT(&barrier);",
          "content_same": false
        },
        {
          "line": 6633,
          "old_api": null,
          "new_api": "THREAD_BARRIER_WAIT",
          "old_text": null,
          "new_text": "THREAD_BARRIER_WAIT(&barrier)",
          "old_line_content": "\telse",
          "new_line_content": "\tTHREAD_BARRIER_WAIT(&barrier);",
          "content_same": false
        },
        {
          "line": 6761,
          "old_api": null,
          "new_api": "clear_socket_set",
          "old_text": null,
          "new_text": "clear_socket_set(sockets)",
          "old_line_content": "\t\t\t}",
          "new_line_content": "\t\t\tclear_socket_set(sockets);",
          "content_same": false
        },
        {
          "line": 6635,
          "old_api": null,
          "new_api": "pg_time_now",
          "old_text": null,
          "new_text": "pg_time_now()",
          "old_line_content": "\t\t/* no connection delay to record */",
          "new_line_content": "\tstart = pg_time_now();",
          "content_same": false
        },
        {
          "line": 6892,
          "old_api": null,
          "new_api": "CreateTimerQueue",
          "old_text": null,
          "new_text": "CreateTimerQueue()",
          "old_line_content": "static void",
          "new_line_content": "\tqueue = CreateTimerQueue();",
          "content_same": false
        },
        {
          "line": 7019,
          "old_api": null,
          "new_api": "pg_malloc0",
          "old_text": null,
          "new_text": "pg_malloc0(sizeof(socket_set))",
          "old_line_content": "#endif\t\t\t\t\t\t\t/* POLL_USING_PPOLL */",
          "new_line_content": "\treturn (socket_set *) pg_malloc0(sizeof(socket_set));",
          "content_same": false
        },
        {
          "line": 6894,
          "old_api": null,
          "new_api": "CreateTimerQueueTimer",
          "old_text": null,
          "new_text": "CreateTimerQueueTimer(&timer, queue,\n\t\t\t\t\t\t\t   win32_timer_callback, NULL, seconds * 1000, 0,\n\t\t\t\t\t\t\t   WT_EXECUTEINTIMERTHREAD | WT_EXECUTEONLYONCE)",
          "old_line_content": "{",
          "new_line_content": "\t\t!CreateTimerQueueTimer(&timer, queue,",
          "content_same": false
        },
        {
          "line": 7025,
          "old_api": null,
          "new_api": "pg_free",
          "old_text": null,
          "new_text": "pg_free(sa)",
          "old_line_content": "{",
          "new_line_content": "\tpg_free(sa);",
          "content_same": false
        },
        {
          "line": 6898,
          "old_api": null,
          "new_api": "pg_log_fatal",
          "old_text": null,
          "new_text": "pg_log_fatal(\"failed to set timer\")",
          "old_line_content": "\t/* This function will be called at most once, so we can cheat a bit. */",
          "new_line_content": "\t\tpg_log_fatal(\"failed to set timer\");",
          "content_same": false
        },
        {
          "line": 6773,
          "old_api": null,
          "new_api": "PQsocket",
          "old_text": null,
          "new_text": "PQsocket(st->con)",
          "old_line_content": "\t\tfor (int i = 0; i < nstate; i++)",
          "new_line_content": "\t\t\t\tint\t\t\tsock = PQsocket(st->con);",
          "content_same": false
        },
        {
          "line": 6646,
          "old_api": null,
          "new_api": "initStats",
          "old_text": null,
          "new_text": "initStats(&aggs, (start + epoch_shift) / 1000000 * 1000000)",
          "old_line_content": "\t/*",
          "new_line_content": "\tinitStats(&aggs, (start + epoch_shift) / 1000000 * 1000000);",
          "content_same": false
        },
        {
          "line": 7031,
          "old_api": null,
          "new_api": "FD_ZERO",
          "old_text": null,
          "new_text": "FD_ZERO(&sa->fds)",
          "old_line_content": "{",
          "new_line_content": "\tFD_ZERO(&sa->fds);",
          "content_same": false
        },
        {
          "line": 6777,
          "old_api": null,
          "new_api": "PQerrorMessage",
          "old_text": null,
          "new_text": "PQerrorMessage(st->con)",
          "old_line_content": "\t\t\tif (st->state == CSTATE_WAIT_RESULT)",
          "new_line_content": "\t\t\t\t\tpg_log_error(\"invalid socket: %s\", PQerrorMessage(st->con));",
          "content_same": false
        },
        {
          "line": 6781,
          "old_api": null,
          "new_api": "socket_has_input",
          "old_text": null,
          "new_text": "socket_has_input(sockets, sock, nsocks++)",
          "old_line_content": "",
          "new_line_content": "\t\t\t\tif (!socket_has_input(sockets, sock, nsocks++))",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 6784,
          "old_api": "PQerrorMessage",
          "new_api": null,
          "old_text": "PQerrorMessage(st->con)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\tpg_log_error(\"invalid socket: %s\", PQerrorMessage(st->con));",
          "new_line_content": "\t\t\telse if (st->state == CSTATE_FINISHED ||",
          "content_same": false
        },
        {
          "line": 6788,
          "old_api": "socket_has_input",
          "new_api": null,
          "old_text": "socket_has_input(sockets, sock, nsocks++)",
          "new_text": null,
          "old_line_content": "\t\t\t\tif (!socket_has_input(sockets, sock, nsocks++))",
          "new_line_content": "\t\t\t\tcontinue;",
          "content_same": false
        },
        {
          "line": 6667,
          "old_api": "clear_socket_set",
          "new_api": null,
          "old_text": "clear_socket_set(sockets)",
          "new_text": null,
          "old_line_content": "\t\tclear_socket_set(sockets);",
          "new_line_content": "\t\t\tif (st->state == CSTATE_SLEEP || st->state == CSTATE_THROTTLE)",
          "content_same": false
        },
        {
          "line": 7051,
          "old_api": "pg_log_fatal",
          "new_api": null,
          "old_text": "pg_log_fatal(\"too many client connections for select()\")",
          "new_text": null,
          "old_line_content": "\t\tpg_log_fatal(\"too many client connections for select()\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 7052,
          "old_api": "exit",
          "new_api": null,
          "old_text": "exit(1)",
          "new_text": null,
          "old_line_content": "\t\texit(1);",
          "new_line_content": "static int",
          "content_same": false
        },
        {
          "line": 6798,
          "old_api": "advanceConnectionState",
          "new_api": null,
          "old_text": "advanceConnectionState(thread, st, &aggs)",
          "new_text": null,
          "old_line_content": "\t\t\tadvanceConnectionState(thread, st, &aggs);",
          "new_line_content": "\t\t\t\tremains--;",
          "content_same": false
        },
        {
          "line": 7054,
          "old_api": "FD_SET",
          "new_api": null,
          "old_text": "FD_SET(fd, &sa->fds)",
          "new_text": null,
          "old_line_content": "\tFD_SET(fd, &sa->fds);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 6680,
          "old_api": "pg_time_now_lazy",
          "new_api": null,
          "old_text": "pg_time_now_lazy(&now)",
          "new_text": null,
          "old_line_content": "\t\t\t\tpg_time_now_lazy(&now);",
          "new_line_content": "\t\t\t}",
          "content_same": false
        },
        {
          "line": 6811,
          "old_api": "pg_time_now",
          "new_api": null,
          "old_text": "pg_time_now()",
          "new_text": null,
          "old_line_content": "\t\t\tpg_time_usec_t now = pg_time_now();",
          "new_line_content": "\t\t\t\t * entry of the threads array.  That is why this MUST be done",
          "content_same": false
        },
        {
          "line": 7068,
          "old_api": "select",
          "new_api": null,
          "old_text": "select(sa->maxfd + 1, &sa->fds, NULL, NULL, &timeout)",
          "new_text": null,
          "old_line_content": "\t\treturn select(sa->maxfd + 1, &sa->fds, NULL, NULL, &timeout);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 6821,
          "old_api": "printProgressReport",
          "new_api": null,
          "old_text": "printProgressReport(thread, thread_start, now,\n\t\t\t\t\t\t\t\t\t&last, &last_report)",
          "new_text": null,
          "old_line_content": "\t\t\t\tprintProgressReport(thread, thread_start, now,",
          "new_line_content": "\t\t\t\tdo",
          "content_same": false
        },
        {
          "line": 6694,
          "old_api": "PQsocket",
          "new_api": null,
          "old_text": "PQsocket(st->con)",
          "new_text": null,
          "old_line_content": "\t\t\t\tint\t\t\tsock = PQsocket(st->con);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 7079,
          "old_api": "FD_ISSET",
          "new_api": null,
          "old_text": "FD_ISSET(fd, &sa->fds)",
          "new_text": null,
          "old_line_content": "\treturn (FD_ISSET(fd, &sa->fds) != 0);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 6698,
          "old_api": "PQerrorMessage",
          "new_api": null,
          "old_text": "PQerrorMessage(st->con)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\tpg_log_error(\"invalid socket: %s\", PQerrorMessage(st->con));",
          "new_line_content": "\t\t\t\t\t st->state != CSTATE_FINISHED)",
          "content_same": false
        },
        {
          "line": 6955,
          "old_api": "offsetof",
          "new_api": null,
          "old_text": "offsetof(socket_set, pollfds)",
          "new_text": null,
          "old_line_content": "\tsa = (socket_set *) pg_malloc0(offsetof(socket_set, pollfds) +",
          "new_line_content": "static void",
          "content_same": false
        },
        {
          "line": 6702,
          "old_api": "add_socket_to_set",
          "new_api": null,
          "old_text": "add_socket_to_set(sockets, sock, nsocks++)",
          "new_text": null,
          "old_line_content": "\t\t\t\tadd_socket_to_set(sockets, sock, nsocks++);",
          "new_line_content": "\t\t\t\t * want to wait.  No need to examine additional clients.",
          "content_same": false
        },
        {
          "line": 6837,
          "old_api": "pg_time_now",
          "new_api": null,
          "old_text": "pg_time_now()",
          "new_text": null,
          "old_line_content": "\tstart = pg_time_now();",
          "new_line_content": "\t\t{",
          "content_same": false
        },
        {
          "line": 6838,
          "old_api": "disconnect_all",
          "new_api": null,
          "old_text": "disconnect_all(state, nstate)",
          "new_text": null,
          "old_line_content": "\tdisconnect_all(state, nstate);",
          "new_line_content": "\t\t\t/* log aggregated but not yet reported transactions */",
          "content_same": false
        },
        {
          "line": 6965,
          "old_api": "pg_free",
          "new_api": null,
          "old_text": "pg_free(sa)",
          "new_text": null,
          "old_line_content": "\tpg_free(sa);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 6846,
          "old_api": "doLog",
          "new_api": null,
          "old_text": "doLog(thread, state, &aggs, false, 0, 0)",
          "new_text": null,
          "old_line_content": "\t\t\tdoLog(thread, state, &aggs, false, 0, 0);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 6719,
          "old_api": "pg_time_now_lazy",
          "new_api": null,
          "old_text": "pg_time_now_lazy(&now)",
          "new_text": null,
          "old_line_content": "\t\t\tpg_time_now_lazy(&now);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 6848,
          "old_api": "fclose",
          "new_api": null,
          "old_text": "fclose(thread->logfile)",
          "new_text": null,
          "old_line_content": "\t\tfclose(thread->logfile);",
          "new_line_content": "static void",
          "content_same": false
        },
        {
          "line": 6977,
          "old_api": "Assert",
          "new_api": null,
          "old_text": "Assert(idx < sa->maxfds && idx == sa->curfds)",
          "new_text": null,
          "old_line_content": "\tAssert(idx < sa->maxfds && idx == sa->curfds);",
          "new_line_content": "static int",
          "content_same": false
        },
        {
          "line": 6851,
          "old_api": "free_socket_set",
          "new_api": null,
          "old_text": "free_socket_set(sockets)",
          "new_text": null,
          "old_line_content": "\tfree_socket_set(sockets);",
          "new_line_content": "\tif (st->con != NULL)",
          "content_same": false
        },
        {
          "line": 6860,
          "old_api": "PQfinish",
          "new_api": null,
          "old_text": "PQfinish(st->con)",
          "new_text": null,
          "old_line_content": "\t\tPQfinish(st->con);",
          "new_line_content": " */",
          "content_same": false
        },
        {
          "line": 6993,
          "old_api": "ppoll",
          "new_api": null,
          "old_text": "ppoll(sa->pollfds, sa->curfds, &timeout, NULL)",
          "new_text": null,
          "old_line_content": "\t\treturn ppoll(sa->pollfds, sa->curfds, &timeout, NULL);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 6739,
          "old_api": "wait_on_socket_set",
          "new_api": null,
          "old_text": "wait_on_socket_set(sockets, min_usec)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\trc = wait_on_socket_set(sockets, min_usec);",
          "new_line_content": "\t\t\telse\t\t\t\t/* no explicit delay, wait without timeout */",
          "content_same": false
        },
        {
          "line": 6997,
          "old_api": "ppoll",
          "new_api": null,
          "old_text": "ppoll(sa->pollfds, sa->curfds, NULL, NULL)",
          "new_text": null,
          "old_line_content": "\t\treturn ppoll(sa->pollfds, sa->curfds, NULL, NULL);",
          "new_line_content": "\t/*",
          "content_same": false
        },
        {
          "line": 6743,
          "old_api": "pg_usleep",
          "new_api": null,
          "old_text": "pg_usleep(min_usec)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\tpg_usleep(min_usec);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 6615,
          "old_api": "doConnect",
          "new_api": null,
          "old_text": "doConnect()",
          "new_text": null,
          "old_line_content": "\t\t\tif ((state[i].con = doConnect()) == NULL)",
          "new_line_content": "\t\t{",
          "content_same": false
        },
        {
          "line": 6748,
          "old_api": "wait_on_socket_set",
          "new_api": null,
          "old_text": "wait_on_socket_set(sockets, 0)",
          "new_text": null,
          "old_line_content": "\t\t\t\trc = wait_on_socket_set(sockets, 0);",
          "new_line_content": "\t\t\t\t\t/* On EINTR, go back to top of loop */",
          "content_same": false
        },
        {
          "line": 6880,
          "old_api": "pqsignal",
          "new_api": null,
          "old_text": "pqsignal(SIGALRM, handle_sig_alarm)",
          "new_text": null,
          "old_line_content": "\tpqsignal(SIGALRM, handle_sig_alarm);",
          "new_line_content": "win32_timer_callback(PVOID lpParameter, BOOLEAN TimerOrWaitFired)",
          "content_same": false
        },
        {
          "line": 6625,
          "old_api": "THREAD_BARRIER_WAIT",
          "new_api": null,
          "old_text": "THREAD_BARRIER_WAIT(&barrier)",
          "new_text": null,
          "old_line_content": "\t\t\t\tTHREAD_BARRIER_WAIT(&barrier);",
          "new_line_content": "\t\t\t\t */",
          "content_same": false
        },
        {
          "line": 6881,
          "old_api": "alarm",
          "new_api": null,
          "old_text": "alarm(seconds)",
          "new_text": null,
          "old_line_content": "\talarm(seconds);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 6631,
          "old_api": "pg_time_now",
          "new_api": null,
          "old_text": "pg_time_now()",
          "new_text": null,
          "old_line_content": "\t\tthread->conn_duration = pg_time_now() - thread->started_time;",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 6759,
          "old_api": "pg_log_fatal",
          "new_api": null,
          "old_text": "pg_log_fatal(\"%s() failed: %m\", SOCKET_WAIT_METHOD)",
          "new_text": null,
          "old_line_content": "\t\t\t\tpg_log_fatal(\"%s() failed: %m\", SOCKET_WAIT_METHOD);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 7015,
          "old_api": "Assert",
          "new_api": null,
          "old_text": "Assert(idx < sa->curfds && sa->pollfds[idx].fd == fd)",
          "new_text": null,
          "old_line_content": "\tAssert(idx < sa->curfds && sa->pollfds[idx].fd == fd);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 6640,
          "old_api": "THREAD_BARRIER_WAIT",
          "new_api": null,
          "old_text": "THREAD_BARRIER_WAIT(&barrier)",
          "new_text": null,
          "old_line_content": "\tTHREAD_BARRIER_WAIT(&barrier);",
          "new_line_content": "\t * The log format currently has Unix epoch timestamps with whole numbers",
          "content_same": false
        },
        {
          "line": 6768,
          "old_api": "clear_socket_set",
          "new_api": null,
          "old_text": "clear_socket_set(sockets)",
          "new_text": null,
          "old_line_content": "\t\t\tclear_socket_set(sockets);",
          "new_line_content": "\t\t\tCState\t   *st = &state[i];",
          "content_same": false
        },
        {
          "line": 6642,
          "old_api": "pg_time_now",
          "new_api": null,
          "old_text": "pg_time_now()",
          "new_text": null,
          "old_line_content": "\tstart = pg_time_now();",
          "new_line_content": "\t * Unix epoch second (the very first aggregate might really have started a",
          "content_same": false
        },
        {
          "line": 7026,
          "old_api": "pg_malloc0",
          "new_api": null,
          "old_text": "pg_malloc0(sizeof(socket_set))",
          "new_text": null,
          "old_line_content": "\treturn (socket_set *) pg_malloc0(sizeof(socket_set));",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 6901,
          "old_api": "CreateTimerQueueTimer",
          "new_api": null,
          "old_text": "CreateTimerQueueTimer(&timer, queue,\n\t\t\t\t\t\t\t   win32_timer_callback, NULL, seconds * 1000, 0,\n\t\t\t\t\t\t\t   WT_EXECUTEINTIMERTHREAD | WT_EXECUTEONLYONCE)",
          "new_text": null,
          "old_line_content": "\t\t!CreateTimerQueueTimer(&timer, queue,",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 7032,
          "old_api": "pg_free",
          "new_api": null,
          "old_text": "pg_free(sa)",
          "new_text": null,
          "old_line_content": "\tpg_free(sa);",
          "new_line_content": "\tsa->maxfd = -1;",
          "content_same": false
        },
        {
          "line": 6905,
          "old_api": "pg_log_fatal",
          "new_api": null,
          "old_text": "pg_log_fatal(\"failed to set timer\")",
          "new_text": null,
          "old_line_content": "\t\tpg_log_fatal(\"failed to set timer\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 6906,
          "old_api": "exit",
          "new_api": null,
          "old_text": "exit(1)",
          "new_text": null,
          "old_line_content": "\t\texit(1);",
          "new_line_content": "/*",
          "content_same": false
        },
        {
          "line": 6780,
          "old_api": "PQsocket",
          "new_api": null,
          "old_text": "PQsocket(st->con)",
          "new_text": null,
          "old_line_content": "\t\t\t\tint\t\t\tsock = PQsocket(st->con);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 6653,
          "old_api": "initStats",
          "new_api": null,
          "old_text": "initStats(&aggs, (start + epoch_shift) / 1000000 * 1000000)",
          "new_text": null,
          "old_line_content": "\tinitStats(&aggs, (start + epoch_shift) / 1000000 * 1000000);",
          "new_line_content": "\t\tpg_time_usec_t min_usec;",
          "content_same": false
        },
        {
          "line": 7038,
          "old_api": "FD_ZERO",
          "new_api": null,
          "old_text": "FD_ZERO(&sa->fds)",
          "new_text": null,
          "old_line_content": "\tFD_ZERO(&sa->fds);",
          "new_line_content": "\tif (fd < 0 || fd >= FD_SETSIZE)",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 3,
      "total_additions": 47,
      "total_deletions": 48,
      "total_api_changes": 98
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 9,
        "api_related_lines": 98,
        "non_api_lines": 6,
        "non_api_line_numbers": [
          6629,
          6630,
          6632,
          6634,
          6636,
          6606
        ]
      }
    },
    "api_calls_before": 1179,
    "api_calls_after": 1178,
    "diff_info": {
      "added_lines": 1,
      "removed_lines": 8,
      "total_diff_lines": 28
    }
  }
}