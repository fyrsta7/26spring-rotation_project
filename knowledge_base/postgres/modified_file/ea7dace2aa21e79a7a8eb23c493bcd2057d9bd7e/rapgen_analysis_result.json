{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/postgres/modified_file/ea7dace2aa21e79a7a8eb23c493bcd2057d9bd7e",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/postgres/modified_file/ea7dace2aa21e79a7a8eb23c493bcd2057d9bd7e/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/postgres/modified_file/ea7dace2aa21e79a7a8eb23c493bcd2057d9bd7e/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/postgres/modified_file/ea7dace2aa21e79a7a8eb23c493bcd2057d9bd7e/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 271,
          "old_api": "Assert",
          "new_api": "memcmp",
          "old_text": "Assert(ndecoded == totalpacked)",
          "new_text": "memcmp(tmp, ipd, ndecoded * sizeof(ItemPointerData))",
          "old_line_content": "\t\tAssert(ndecoded == totalpacked);",
          "new_line_content": "\t\tAssert(memcmp(tmp, ipd, ndecoded * sizeof(ItemPointerData)) == 0);",
          "content_same": false
        },
        {
          "line": 343,
          "old_api": "decode_varbyte",
          "new_api": "uint64_to_itemptr",
          "old_text": "decode_varbyte(&ptr)",
          "new_text": "uint64_to_itemptr(val, &result[ndecoded])",
          "old_line_content": "\t\t\tval += decode_varbyte(&ptr);",
          "new_line_content": "\t\t\tuint64_to_itemptr(val, &result[ndecoded]);",
          "content_same": false
        },
        {
          "line": 366,
          "old_api": "ginPostingListDecodeAllSegments",
          "new_api": "pfree",
          "old_text": "ginPostingListDecodeAllSegments(ptr, len, &ndecoded)",
          "new_text": "pfree(items)",
          "old_line_content": "\titems = ginPostingListDecodeAllSegments(ptr, len, &ndecoded);",
          "new_line_content": "\tpfree(items);",
          "content_same": false
        },
        {
          "line": 392,
          "old_api": "ginCompareItemPointers",
          "new_api": "memcpy",
          "old_text": "ginCompareItemPointers(&a[na - 1], &b[0])",
          "new_text": "memcpy(dst, a, na * sizeof(ItemPointerData))",
          "old_line_content": "\tif (na == 0 || nb == 0 || ginCompareItemPointers(&a[na - 1], &b[0]) < 0)",
          "new_line_content": "\t\tmemcpy(dst, a, na * sizeof(ItemPointerData));",
          "content_same": false
        },
        {
          "line": 398,
          "old_api": "ginCompareItemPointers",
          "new_api": "memcpy",
          "old_text": "ginCompareItemPointers(&b[nb - 1], &a[0])",
          "new_text": "memcpy(dst, b, nb * sizeof(ItemPointerData))",
          "old_line_content": "\telse if (ginCompareItemPointers(&b[nb - 1], &a[0]) < 0)",
          "new_line_content": "\t\tmemcpy(dst, b, nb * sizeof(ItemPointerData));",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 384,
          "old_api": null,
          "new_api": "palloc",
          "old_text": null,
          "new_text": "palloc((na + nb) * sizeof(ItemPointerData))",
          "old_line_content": "\tItemPointerData *dst;",
          "new_line_content": "\tdst = (ItemPointer) palloc((na + nb) * sizeof(ItemPointerData));",
          "content_same": false
        },
        {
          "line": 390,
          "old_api": null,
          "new_api": "ginCompareItemPointers",
          "old_text": null,
          "new_text": "ginCompareItemPointers(&a[na - 1], &b[0])",
          "old_line_content": "\t * other.",
          "new_line_content": "\tif (na == 0 || nb == 0 || ginCompareItemPointers(&a[na - 1], &b[0]) < 0)",
          "content_same": false
        },
        {
          "line": 393,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(&dst[na], b, nb * sizeof(ItemPointerData))",
          "old_line_content": "\t{",
          "new_line_content": "\t\tmemcpy(&dst[na], b, nb * sizeof(ItemPointerData));",
          "content_same": false
        },
        {
          "line": 396,
          "old_api": null,
          "new_api": "ginCompareItemPointers",
          "old_text": null,
          "new_text": "ginCompareItemPointers(&b[nb - 1], &a[0])",
          "old_line_content": "\t\t*nmerged = na + nb;",
          "new_line_content": "\telse if (ginCompareItemPointers(&b[nb - 1], &a[0]) < 0)",
          "content_same": false
        },
        {
          "line": 270,
          "old_api": null,
          "new_api": "Assert",
          "old_text": null,
          "new_text": "Assert(ndecoded == totalpacked)",
          "old_line_content": "",
          "new_line_content": "\t\tAssert(ndecoded == totalpacked);",
          "content_same": false
        },
        {
          "line": 399,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(&dst[nb], a, na * sizeof(ItemPointerData))",
          "old_line_content": "\t{",
          "new_line_content": "\t\tmemcpy(&dst[nb], a, na * sizeof(ItemPointerData));",
          "content_same": false
        },
        {
          "line": 272,
          "old_api": null,
          "new_api": "pfree",
          "old_text": null,
          "new_text": "pfree(tmp)",
          "old_line_content": "\t\tfor (i = 0; i < ndecoded; i++)",
          "new_line_content": "\t\tpfree(tmp);",
          "content_same": false
        },
        {
          "line": 410,
          "old_api": null,
          "new_api": "ginCompareItemPointers",
          "old_text": null,
          "new_text": "ginCompareItemPointers(aptr, bptr)",
          "old_line_content": "\t\twhile (aptr - a < na && bptr - b < nb)",
          "new_line_content": "\t\t\tint\t\t\tcmp = ginCompareItemPointers(aptr, bptr);",
          "content_same": false
        },
        {
          "line": 286,
          "old_api": null,
          "new_api": "ginPostingListDecodeAllSegments",
          "old_text": null,
          "new_text": "ginPostingListDecodeAllSegments(plist,\n\t\t\t\t\t\t\t\t\t\t   SizeOfGinPostingList(plist),\n\t\t\t\t\t\t\t\t\t\t   ndecoded)",
          "old_line_content": "ginPostingListDecode(GinPostingList *plist, int *ndecoded)",
          "new_line_content": "\treturn ginPostingListDecodeAllSegments(plist,",
          "content_same": false
        },
        {
          "line": 287,
          "old_api": null,
          "new_api": "SizeOfGinPostingList",
          "old_text": null,
          "new_text": "SizeOfGinPostingList(plist)",
          "old_line_content": "{",
          "new_line_content": "\t\t\t\t\t\t\t\t\t\t   SizeOfGinPostingList(plist),",
          "content_same": false
        },
        {
          "line": 311,
          "old_api": null,
          "new_api": "palloc",
          "old_text": null,
          "new_text": "palloc(nallocated * sizeof(ItemPointerData))",
          "old_line_content": "\t */",
          "new_line_content": "\tresult = palloc(nallocated * sizeof(ItemPointerData));",
          "content_same": false
        },
        {
          "line": 320,
          "old_api": null,
          "new_api": "repalloc",
          "old_text": null,
          "new_text": "repalloc(result, nallocated * sizeof(ItemPointerData))",
          "old_line_content": "\t\t{",
          "new_line_content": "\t\t\tresult = repalloc(result, nallocated * sizeof(ItemPointerData));",
          "content_same": false
        },
        {
          "line": 324,
          "old_api": null,
          "new_api": "ItemPointerGetOffsetNumber",
          "old_text": null,
          "new_text": "ItemPointerGetOffsetNumber(&segment->first)",
          "old_line_content": "",
          "new_line_content": "\t\tAssert(OffsetNumberIsValid(ItemPointerGetOffsetNumber(&segment->first)));",
          "content_same": false
        },
        {
          "line": 325,
          "old_api": null,
          "new_api": "ginCompareItemPointers",
          "old_text": null,
          "new_text": "ginCompareItemPointers(&segment->first, &result[ndecoded - 1])",
          "old_line_content": "\t\t/* copy the first item */",
          "new_line_content": "\t\tAssert(ndecoded == 0 || ginCompareItemPointers(&segment->first, &result[ndecoded - 1]) > 0);",
          "content_same": false
        },
        {
          "line": 329,
          "old_api": null,
          "new_api": "itemptr_to_uint64",
          "old_text": null,
          "new_text": "itemptr_to_uint64(&segment->first)",
          "old_line_content": "\t\tndecoded++;",
          "new_line_content": "\t\tval = itemptr_to_uint64(&segment->first);",
          "content_same": false
        },
        {
          "line": 338,
          "old_api": null,
          "new_api": "repalloc",
          "old_text": null,
          "new_text": "repalloc(result, nallocated * sizeof(ItemPointerData))",
          "old_line_content": "\t\t\t{",
          "new_line_content": "\t\t\t\tresult = repalloc(result, nallocated * sizeof(ItemPointerData));",
          "content_same": false
        },
        {
          "line": 341,
          "old_api": null,
          "new_api": "decode_varbyte",
          "old_text": null,
          "new_text": "decode_varbyte(&ptr)",
          "old_line_content": "\t\t\t}",
          "new_line_content": "\t\t\tval += decode_varbyte(&ptr);",
          "content_same": false
        },
        {
          "line": 346,
          "old_api": null,
          "new_api": "GinNextPostingListSegment",
          "old_text": null,
          "new_text": "GinNextPostingListSegment(segment)",
          "old_line_content": "\t\t\tndecoded++;",
          "new_line_content": "\t\tsegment = GinNextPostingListSegment(segment);",
          "content_same": false
        },
        {
          "line": 364,
          "old_api": null,
          "new_api": "ginPostingListDecodeAllSegments",
          "old_text": null,
          "new_text": "ginPostingListDecodeAllSegments(ptr, len, &ndecoded)",
          "old_line_content": "\tItemPointer items;",
          "new_line_content": "\titems = ginPostingListDecodeAllSegments(ptr, len, &ndecoded);",
          "content_same": false
        },
        {
          "line": 365,
          "old_api": null,
          "new_api": "tbm_add_tuples",
          "old_text": null,
          "new_text": "tbm_add_tuples(tbm, items, ndecoded, false)",
          "old_line_content": "",
          "new_line_content": "\ttbm_add_tuples(tbm, items, ndecoded, false);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 386,
          "old_api": "palloc",
          "new_api": null,
          "old_text": "palloc((na + nb) * sizeof(ItemPointerData))",
          "new_text": null,
          "old_line_content": "\tdst = (ItemPointer) palloc((na + nb) * sizeof(ItemPointerData));",
          "new_line_content": "\t/*",
          "content_same": false
        },
        {
          "line": 394,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(dst, a, na * sizeof(ItemPointerData))",
          "new_text": null,
          "old_line_content": "\t\tmemcpy(dst, a, na * sizeof(ItemPointerData));",
          "new_line_content": "\t\t*nmerged = na + nb;",
          "content_same": false
        },
        {
          "line": 395,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(&dst[na], b, nb * sizeof(ItemPointerData))",
          "new_text": null,
          "old_line_content": "\t\tmemcpy(&dst[na], b, nb * sizeof(ItemPointerData));",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 400,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(dst, b, nb * sizeof(ItemPointerData))",
          "new_text": null,
          "old_line_content": "\t\tmemcpy(dst, b, nb * sizeof(ItemPointerData));",
          "new_line_content": "\t\t*nmerged = na + nb;",
          "content_same": false
        },
        {
          "line": 273,
          "old_api": "memcmp",
          "new_api": null,
          "old_text": "memcmp(&tmp[i], &ipd[i], sizeof(ItemPointerData))",
          "new_text": null,
          "old_line_content": "\t\t\tAssert(memcmp(&tmp[i], &ipd[i], sizeof(ItemPointerData)) == 0);",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 274,
          "old_api": "pfree",
          "new_api": null,
          "old_text": "pfree(tmp)",
          "new_text": null,
          "old_line_content": "\t\tpfree(tmp);",
          "new_line_content": "#endif",
          "content_same": false
        },
        {
          "line": 401,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(&dst[nb], a, na * sizeof(ItemPointerData))",
          "new_text": null,
          "old_line_content": "\t\tmemcpy(&dst[nb], a, na * sizeof(ItemPointerData));",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 412,
          "old_api": "ginCompareItemPointers",
          "new_api": null,
          "old_text": "ginCompareItemPointers(aptr, bptr)",
          "new_text": null,
          "old_line_content": "\t\t\tint\t\t\tcmp = ginCompareItemPointers(aptr, bptr);",
          "new_line_content": "\t\t\tif (cmp > 0)",
          "content_same": false
        },
        {
          "line": 288,
          "old_api": "ginPostingListDecodeAllSegments",
          "new_api": null,
          "old_text": "ginPostingListDecodeAllSegments(plist,\n\t\t\t\t\t\t\t\t\t\t   SizeOfGinPostingList(plist),\n\t\t\t\t\t\t\t\t\t\t   ndecoded)",
          "new_text": null,
          "old_line_content": "\treturn ginPostingListDecodeAllSegments(plist,",
          "new_line_content": "\t\t\t\t\t\t\t\t\t\t   ndecoded);",
          "content_same": false
        },
        {
          "line": 289,
          "old_api": "SizeOfGinPostingList",
          "new_api": null,
          "old_text": "SizeOfGinPostingList(plist)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\t\t\t\t\t\t   SizeOfGinPostingList(plist),",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 313,
          "old_api": "palloc",
          "new_api": null,
          "old_text": "palloc(nallocated * sizeof(ItemPointerData))",
          "new_text": null,
          "old_line_content": "\tresult = palloc(nallocated * sizeof(ItemPointerData));",
          "new_line_content": "\tndecoded = 0;",
          "content_same": false
        },
        {
          "line": 322,
          "old_api": "repalloc",
          "new_api": null,
          "old_text": "repalloc(result, nallocated * sizeof(ItemPointerData))",
          "new_text": null,
          "old_line_content": "\t\t\tresult = repalloc(result, nallocated * sizeof(ItemPointerData));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 326,
          "old_api": "ItemPointerGetOffsetNumber",
          "new_api": null,
          "old_text": "ItemPointerGetOffsetNumber(&segment->first)",
          "new_text": null,
          "old_line_content": "\t\tAssert(OffsetNumberIsValid(ItemPointerGetOffsetNumber(&segment->first)));",
          "new_line_content": "\t\tresult[ndecoded] = segment->first;",
          "content_same": false
        },
        {
          "line": 327,
          "old_api": "ginCompareItemPointers",
          "new_api": null,
          "old_text": "ginCompareItemPointers(&segment->first, &result[ndecoded - 1])",
          "new_text": null,
          "old_line_content": "\t\tAssert(ndecoded == 0 || ginCompareItemPointers(&segment->first, &result[ndecoded - 1]) > 0);",
          "new_line_content": "\t\tndecoded++;",
          "content_same": false
        },
        {
          "line": 331,
          "old_api": "itemptr_to_uint64",
          "new_api": null,
          "old_text": "itemptr_to_uint64(&segment->first)",
          "new_text": null,
          "old_line_content": "\t\tval = itemptr_to_uint64(&segment->first);",
          "new_line_content": "\t\tendptr = segment->bytes + segment->nbytes;",
          "content_same": false
        },
        {
          "line": 340,
          "old_api": "repalloc",
          "new_api": null,
          "old_text": "repalloc(result, nallocated * sizeof(ItemPointerData))",
          "new_text": null,
          "old_line_content": "\t\t\t\tresult = repalloc(result, nallocated * sizeof(ItemPointerData));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 345,
          "old_api": "uint64_to_itemptr",
          "new_api": null,
          "old_text": "uint64_to_itemptr(val, &result[ndecoded])",
          "new_text": null,
          "old_line_content": "\t\t\tuint64_to_itemptr(val, &result[ndecoded]);",
          "new_line_content": "\t\t}",
          "content_same": false
        },
        {
          "line": 348,
          "old_api": "GinNextPostingListSegment",
          "new_api": null,
          "old_text": "GinNextPostingListSegment(segment)",
          "new_text": null,
          "old_line_content": "\t\tsegment = GinNextPostingListSegment(segment);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 367,
          "old_api": "tbm_add_tuples",
          "new_api": null,
          "old_text": "tbm_add_tuples(tbm, items, ndecoded, false)",
          "new_text": null,
          "old_line_content": "\ttbm_add_tuples(tbm, items, ndecoded, false);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 368,
          "old_api": "pfree",
          "new_api": null,
          "old_text": "pfree(items)",
          "new_text": null,
          "old_line_content": "\tpfree(items);",
          "new_line_content": "\treturn ndecoded;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 5,
      "total_additions": 20,
      "total_deletions": 20,
      "total_api_changes": 45
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 4,
        "api_related_lines": 45,
        "non_api_lines": 1,
        "non_api_line_numbers": [
          269
        ]
      }
    },
    "api_calls_before": 54,
    "api_calls_after": 54,
    "diff_info": {
      "added_lines": 1,
      "removed_lines": 3,
      "total_diff_lines": 18
    }
  }
}