{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/postgres/modified_file/5d4298e75f252b162008ad0475f29349023573cb",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/postgres/modified_file/5d4298e75f252b162008ad0475f29349023573cb/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/postgres/modified_file/5d4298e75f252b162008ad0475f29349023573cb/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/postgres/modified_file/5d4298e75f252b162008ad0475f29349023573cb/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 1911,
          "old_api": "Int64GetDatumFast",
          "new_api": "Float8GetDatumFast",
          "old_text": "Int64GetDatumFast(tmp.shared_blks_read)",
          "new_text": "Float8GetDatumFast(stddev)",
          "old_line_content": "\t\tvalues[i++] = Int64GetDatumFast(tmp.shared_blks_read);",
          "new_line_content": "\t\t\t\tvalues[i++] = Float8GetDatumFast(stddev);",
          "content_same": false
        },
        {
          "line": 1924,
          "old_api": "Float8GetDatumFast",
          "new_api": "Int64GetDatumFast",
          "old_text": "Float8GetDatumFast(tmp.shared_blk_read_time)",
          "new_text": "Int64GetDatumFast(tmp.local_blks_written)",
          "old_line_content": "\t\t\tvalues[i++] = Float8GetDatumFast(tmp.shared_blk_read_time);",
          "new_line_content": "\t\tvalues[i++] = Int64GetDatumFast(tmp.local_blks_written);",
          "content_same": false
        },
        {
          "line": 1925,
          "old_api": "Float8GetDatumFast",
          "new_api": "Int64GetDatumFast",
          "old_text": "Float8GetDatumFast(tmp.shared_blk_write_time)",
          "new_text": "Int64GetDatumFast(tmp.temp_blks_read)",
          "old_line_content": "\t\t\tvalues[i++] = Float8GetDatumFast(tmp.shared_blk_write_time);",
          "new_line_content": "\t\tvalues[i++] = Int64GetDatumFast(tmp.temp_blks_read);",
          "content_same": false
        },
        {
          "line": 1948,
          "old_api": "DirectFunctionCall3",
          "new_api": "Int64GetDatumFast",
          "old_text": "DirectFunctionCall3(numeric_in,\n\t\t\t\t\t\t\t\t\t\t\tCStringGetDatum(buf),\n\t\t\t\t\t\t\t\t\t\t\tObjectIdGetDatum(0),\n\t\t\t\t\t\t\t\t\t\t\tInt32GetDatum(-1))",
          "new_text": "Int64GetDatumFast(tmp.wal_fpi)",
          "old_line_content": "\t\t\twal_bytes = DirectFunctionCall3(numeric_in,",
          "new_line_content": "\t\t\tvalues[i++] = Int64GetDatumFast(tmp.wal_fpi);",
          "content_same": false
        },
        {
          "line": 1950,
          "old_api": "ObjectIdGetDatum",
          "new_api": "snprintf",
          "old_text": "ObjectIdGetDatum(0)",
          "new_text": "snprintf(buf, sizeof buf, UINT64_FORMAT, tmp.wal_bytes)",
          "old_line_content": "\t\t\t\t\t\t\t\t\t\t\tObjectIdGetDatum(0),",
          "new_line_content": "\t\t\tsnprintf(buf, sizeof buf, UINT64_FORMAT, tmp.wal_bytes);",
          "content_same": false
        },
        {
          "line": 1956,
          "old_api": "Int64GetDatumFast",
          "new_api": "Int32GetDatum",
          "old_text": "Int64GetDatumFast(tmp.jit_functions)",
          "new_text": "Int32GetDatum(-1)",
          "old_line_content": "\t\t\tvalues[i++] = Int64GetDatumFast(tmp.jit_functions);",
          "new_line_content": "\t\t\t\t\t\t\t\t\t\t\tInt32GetDatum(-1));",
          "content_same": false
        },
        {
          "line": 1961,
          "old_api": "Float8GetDatumFast",
          "new_api": "Int64GetDatumFast",
          "old_text": "Float8GetDatumFast(tmp.jit_optimization_time)",
          "new_text": "Int64GetDatumFast(tmp.jit_functions)",
          "old_line_content": "\t\t\tvalues[i++] = Float8GetDatumFast(tmp.jit_optimization_time);",
          "new_line_content": "\t\t\tvalues[i++] = Int64GetDatumFast(tmp.jit_functions);",
          "content_same": false
        },
        {
          "line": 1962,
          "old_api": "Int64GetDatumFast",
          "new_api": "Float8GetDatumFast",
          "old_text": "Int64GetDatumFast(tmp.jit_emission_count)",
          "new_text": "Float8GetDatumFast(tmp.jit_generation_time)",
          "old_line_content": "\t\t\tvalues[i++] = Int64GetDatumFast(tmp.jit_emission_count);",
          "new_line_content": "\t\t\tvalues[i++] = Float8GetDatumFast(tmp.jit_generation_time);",
          "content_same": false
        },
        {
          "line": 1963,
          "old_api": "Float8GetDatumFast",
          "new_api": "Int64GetDatumFast",
          "old_text": "Float8GetDatumFast(tmp.jit_emission_time)",
          "new_text": "Int64GetDatumFast(tmp.jit_inlining_count)",
          "old_line_content": "\t\t\tvalues[i++] = Float8GetDatumFast(tmp.jit_emission_time);",
          "new_line_content": "\t\t\tvalues[i++] = Int64GetDatumFast(tmp.jit_inlining_count);",
          "content_same": false
        },
        {
          "line": 1973,
          "old_api": "Int64GetDatumFast",
          "new_api": "Float8GetDatumFast",
          "old_text": "Int64GetDatumFast(tmp.parallel_workers_launched)",
          "new_text": "Float8GetDatumFast(tmp.jit_deform_time)",
          "old_line_content": "\t\t\tvalues[i++] = Int64GetDatumFast(tmp.parallel_workers_launched);",
          "new_line_content": "\t\t\tvalues[i++] = Float8GetDatumFast(tmp.jit_deform_time);",
          "content_same": false
        },
        {
          "line": 1977,
          "old_api": "TimestampTzGetDatum",
          "new_api": "Int64GetDatumFast",
          "old_text": "TimestampTzGetDatum(stats_since)",
          "new_text": "Int64GetDatumFast(tmp.parallel_workers_to_launch)",
          "old_line_content": "\t\t\tvalues[i++] = TimestampTzGetDatum(stats_since);",
          "new_line_content": "\t\t\tvalues[i++] = Int64GetDatumFast(tmp.parallel_workers_to_launch);",
          "content_same": false
        },
        {
          "line": 1978,
          "old_api": "TimestampTzGetDatum",
          "new_api": "Int64GetDatumFast",
          "old_text": "TimestampTzGetDatum(minmax_stats_since)",
          "new_text": "Int64GetDatumFast(tmp.parallel_workers_launched)",
          "old_line_content": "\t\t\tvalues[i++] = TimestampTzGetDatum(minmax_stats_since);",
          "new_line_content": "\t\t\tvalues[i++] = Int64GetDatumFast(tmp.parallel_workers_launched);",
          "content_same": false
        },
        {
          "line": 1997,
          "old_api": "free",
          "new_api": "tuplestore_putvalues",
          "old_text": "free(qbuffer)",
          "new_text": "tuplestore_putvalues(rsinfo->setResult, rsinfo->setDesc, values, nulls)",
          "old_line_content": "\tfree(qbuffer);",
          "new_line_content": "\t\ttuplestore_putvalues(rsinfo->setResult, rsinfo->setDesc, values, nulls);",
          "content_same": false
        },
        {
          "line": 2020,
          "old_api": "get_call_result_type",
          "new_api": "ereport",
          "old_text": "get_call_result_type(fcinfo, NULL, &tupdesc)",
          "new_text": "ereport(ERROR,\n\t\t\t\t(errcode(ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE),\n\t\t\t\t errmsg(\"pg_stat_statements must be loaded via \\\"shared_preload_libraries\\\"\")))",
          "old_line_content": "\tif (get_call_result_type(fcinfo, NULL, &tupdesc) != TYPEFUNC_COMPOSITE)",
          "new_line_content": "\t\tereport(ERROR,",
          "content_same": false
        },
        {
          "line": 2021,
          "old_api": "elog",
          "new_api": "errcode",
          "old_text": "elog(ERROR, \"return type must be a row type\")",
          "new_text": "errcode(ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE)",
          "old_line_content": "\t\telog(ERROR, \"return type must be a row type\");",
          "new_line_content": "\t\t\t\t(errcode(ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE),",
          "content_same": false
        },
        {
          "line": 2026,
          "old_api": "SpinLockRelease",
          "new_api": "elog",
          "old_text": "SpinLockRelease(&pgss->mutex)",
          "new_text": "elog(ERROR, \"return type must be a row type\")",
          "old_line_content": "\tSpinLockRelease(&pgss->mutex);",
          "new_line_content": "\t\telog(ERROR, \"return type must be a row type\");",
          "content_same": false
        },
        {
          "line": 2029,
          "old_api": "TimestampTzGetDatum",
          "new_api": "SpinLockAcquire",
          "old_text": "TimestampTzGetDatum(stats.stats_reset)",
          "new_text": "SpinLockAcquire(&pgss->mutex)",
          "old_line_content": "\tvalues[1] = TimestampTzGetDatum(stats.stats_reset);",
          "new_line_content": "\tSpinLockAcquire(&pgss->mutex);",
          "content_same": false
        },
        {
          "line": 2031,
          "old_api": "heap_form_tuple",
          "new_api": "SpinLockRelease",
          "old_text": "heap_form_tuple(tupdesc, values, nulls)",
          "new_text": "SpinLockRelease(&pgss->mutex)",
          "old_line_content": "\tPG_RETURN_DATUM(HeapTupleGetDatum(heap_form_tuple(tupdesc, values, nulls)));",
          "new_line_content": "\tSpinLockRelease(&pgss->mutex);",
          "content_same": false
        },
        {
          "line": 2157,
          "old_api": "IS_STICKY",
          "new_api": "hash_seq_init",
          "old_text": "IS_STICKY(entry->counters)",
          "new_text": "hash_seq_init(&hash_seq, pgss_hash)",
          "old_line_content": "\t\tif (IS_STICKY(entry->counters))",
          "new_line_content": "\thash_seq_init(&hash_seq, pgss_hash);",
          "content_same": false
        },
        {
          "line": 2187,
          "old_api": "hash_search",
          "new_api": "Max",
          "old_text": "hash_search(pgss_hash, &entries[i]->key, HASH_REMOVE, NULL)",
          "new_text": "Max(10, i * USAGE_DEALLOC_PERCENT / 100)",
          "old_line_content": "\t\thash_search(pgss_hash, &entries[i]->key, HASH_REMOVE, NULL);",
          "new_line_content": "\tnvictims = Max(10, i * USAGE_DEALLOC_PERCENT / 100);",
          "content_same": false
        },
        {
          "line": 2195,
          "old_api": "SpinLockRelease",
          "new_api": "pfree",
          "old_text": "SpinLockRelease(&pgss->mutex)",
          "new_text": "pfree(entries)",
          "old_line_content": "\tSpinLockRelease(&pgss->mutex);",
          "new_line_content": "\tpfree(entries);",
          "content_same": false
        },
        {
          "line": 2257,
          "old_api": "CloseTransientFile",
          "new_api": "pg_pwrite",
          "old_text": "CloseTransientFile(fd)",
          "new_text": "pg_pwrite(fd, query, query_len, off)",
          "old_line_content": "\tCloseTransientFile(fd);",
          "new_line_content": "\tif (pg_pwrite(fd, query, query_len, off) != query_len)",
          "content_same": false
        },
        {
          "line": 2262,
          "old_api": "SpinLockRelease",
          "new_api": "CloseTransientFile",
          "old_text": "SpinLockRelease(&pgss->mutex)",
          "new_text": "CloseTransientFile(fd)",
          "old_line_content": "\tSpinLockRelease(&pgss->mutex);",
          "new_line_content": "\tCloseTransientFile(fd);",
          "content_same": false
        },
        {
          "line": 2267,
          "old_api": "ereport",
          "new_api": "SpinLockRelease",
          "old_text": "ereport(LOG,\n\t\t\t(errcode_for_file_access(),\n\t\t\t errmsg(\"could not write file \\\"%s\\\": %m\",\n\t\t\t\t\tPGSS_TEXT_FILE)))",
          "new_text": "SpinLockRelease(&pgss->mutex)",
          "old_line_content": "\tereport(LOG,",
          "new_line_content": "\tSpinLockRelease(&pgss->mutex);",
          "content_same": false
        },
        {
          "line": 2273,
          "old_api": "CloseTransientFile",
          "new_api": "errcode_for_file_access",
          "old_text": "CloseTransientFile(fd)",
          "new_text": "errcode_for_file_access()",
          "old_line_content": "\t\tCloseTransientFile(fd);",
          "new_line_content": "\t\t\t(errcode_for_file_access(),",
          "content_same": false
        },
        {
          "line": 2278,
          "old_api": "SpinLockRelease",
          "new_api": "CloseTransientFile",
          "old_text": "SpinLockRelease(&pgss->mutex)",
          "new_text": "CloseTransientFile(fd)",
          "old_line_content": "\tSpinLockRelease(&pgss->mutex);",
          "new_line_content": "\t\tCloseTransientFile(fd);",
          "content_same": false
        },
        {
          "line": 2307,
          "old_api": "errcode_for_file_access",
          "new_api": "OpenTransientFile",
          "old_text": "errcode_for_file_access()",
          "new_text": "OpenTransientFile(PGSS_TEXT_FILE, O_RDONLY | PG_BINARY)",
          "old_line_content": "\t\t\t\t\t(errcode_for_file_access(),",
          "new_line_content": "\tfd = OpenTransientFile(PGSS_TEXT_FILE, O_RDONLY | PG_BINARY);",
          "content_same": false
        },
        {
          "line": 2331,
          "old_api": "ereport",
          "new_api": "malloc",
          "old_text": "ereport(LOG,\n\t\t\t\t(errcode(ERRCODE_OUT_OF_MEMORY),\n\t\t\t\t errmsg(\"out of memory\"),\n\t\t\t\t errdetail(\"Could not allocate enough memory to read file \\\"%s\\\".\",\n\t\t\t\t\t\t   PGSS_TEXT_FILE)))",
          "new_text": "malloc(stat.st_size)",
          "old_line_content": "\t\tereport(LOG,",
          "new_line_content": "\t\tbuf = (char *) malloc(stat.st_size);",
          "content_same": false
        },
        {
          "line": 2336,
          "old_api": "CloseTransientFile",
          "new_api": "ereport",
          "old_text": "CloseTransientFile(fd)",
          "new_text": "ereport(LOG,\n\t\t\t\t(errcode(ERRCODE_OUT_OF_MEMORY),\n\t\t\t\t errmsg(\"out of memory\"),\n\t\t\t\t errdetail(\"Could not allocate enough memory to read file \\\"%s\\\".\",\n\t\t\t\t\t\t   PGSS_TEXT_FILE)))",
          "old_line_content": "\t\tCloseTransientFile(fd);",
          "new_line_content": "\t\tereport(LOG,",
          "content_same": false
        },
        {
          "line": 2363,
          "old_api": "errmsg",
          "new_api": "read",
          "old_text": "errmsg(\"could not read file \\\"%s\\\": %m\",\n\t\t\t\t\t\t\t\tPGSS_TEXT_FILE)",
          "new_text": "read(fd, buf + nread, toread)",
          "old_line_content": "\t\t\t\t\t\t errmsg(\"could not read file \\\"%s\\\": %m\",",
          "new_line_content": "\t\tif (read(fd, buf + nread, toread) != toread)",
          "content_same": false
        },
        {
          "line": 2366,
          "old_api": "CloseTransientFile",
          "new_api": "ereport",
          "old_text": "CloseTransientFile(fd)",
          "new_text": "ereport(LOG,\n\t\t\t\t\t\t(errcode_for_file_access(),\n\t\t\t\t\t\t errmsg(\"could not read file \\\"%s\\\": %m\",\n\t\t\t\t\t\t\t\tPGSS_TEXT_FILE)))",
          "old_line_content": "\t\t\tCloseTransientFile(fd);",
          "new_line_content": "\t\t\t\tereport(LOG,",
          "content_same": false
        },
        {
          "line": 2500,
          "old_api": "errmsg",
          "new_api": "AllocateFile",
          "old_text": "errmsg(\"could not write file \\\"%s\\\": %m\",\n\t\t\t\t\t\tPGSS_TEXT_FILE)",
          "new_text": "AllocateFile(PGSS_TEXT_FILE, PG_BINARY_W)",
          "old_line_content": "\t\t\t\t errmsg(\"could not write file \\\"%s\\\": %m\",",
          "new_line_content": "\tqfile = AllocateFile(PGSS_TEXT_FILE, PG_BINARY_W);",
          "content_same": false
        },
        {
          "line": 2551,
          "old_api": "FreeFile",
          "new_api": "ereport",
          "old_text": "FreeFile(qfile)",
          "new_text": "ereport(LOG,\n\t\t\t\t(errcode_for_file_access(),\n\t\t\t\t errmsg(\"could not truncate file \\\"%s\\\": %m\",\n\t\t\t\t\t\tPGSS_TEXT_FILE)))",
          "old_line_content": "\tif (FreeFile(qfile))",
          "new_line_content": "\t\tereport(LOG,",
          "content_same": false
        },
        {
          "line": 2553,
          "old_api": "ereport",
          "new_api": "errmsg",
          "old_text": "ereport(LOG,\n\t\t\t\t(errcode_for_file_access(),\n\t\t\t\t errmsg(\"could not write file \\\"%s\\\": %m\",\n\t\t\t\t\t\tPGSS_TEXT_FILE)))",
          "new_text": "errmsg(\"could not truncate file \\\"%s\\\": %m\",\n\t\t\t\t\t\tPGSS_TEXT_FILE)",
          "old_line_content": "\t\tereport(LOG,",
          "new_line_content": "\t\t\t\t errmsg(\"could not truncate file \\\"%s\\\": %m\",",
          "content_same": false
        },
        {
          "line": 2614,
          "old_api": "errmsg",
          "new_api": "unlink",
          "old_text": "errmsg(\"could not recreate file \\\"%s\\\": %m\",\n\t\t\t\t\t\tPGSS_TEXT_FILE)",
          "new_text": "unlink(PGSS_TEXT_FILE)",
          "old_line_content": "\t\t\t\t errmsg(\"could not recreate file \\\"%s\\\": %m\",",
          "new_line_content": "\t(void) unlink(PGSS_TEXT_FILE);",
          "content_same": false
        },
        {
          "line": 2617,
          "old_api": "FreeFile",
          "new_api": "ereport",
          "old_text": "FreeFile(qfile)",
          "new_text": "ereport(LOG,\n\t\t\t\t(errcode_for_file_access(),\n\t\t\t\t errmsg(\"could not recreate file \\\"%s\\\": %m\",\n\t\t\t\t\t\tPGSS_TEXT_FILE)))",
          "old_line_content": "\t\tFreeFile(qfile);",
          "new_line_content": "\t\tereport(LOG,",
          "content_same": false
        },
        {
          "line": 2678,
          "old_api": "hash_get_num_entries",
          "new_api": "ereport",
          "old_text": "hash_get_num_entries(pgss_hash)",
          "new_text": "ereport(ERROR,\n\t\t\t\t(errcode(ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE),\n\t\t\t\t errmsg(\"pg_stat_statements must be loaded via \\\"shared_preload_libraries\\\"\")))",
          "old_line_content": "\tnum_entries = hash_get_num_entries(pgss_hash);",
          "new_line_content": "\t\tereport(ERROR,",
          "content_same": false
        },
        {
          "line": 2680,
          "old_api": "GetCurrentTimestamp",
          "new_api": "errmsg",
          "old_text": "GetCurrentTimestamp()",
          "new_text": "errmsg(\"pg_stat_statements must be loaded via \\\"shared_preload_libraries\\\"\")",
          "old_line_content": "\tstats_reset = GetCurrentTimestamp();",
          "new_line_content": "\t\t\t\t errmsg(\"pg_stat_statements must be loaded via \\\"shared_preload_libraries\\\"\")));",
          "content_same": false
        },
        {
          "line": 2682,
          "old_api": "UINT64CONST",
          "new_api": "LWLockAcquire",
          "old_text": "UINT64CONST(0)",
          "new_text": "LWLockAcquire(pgss->lock, LW_EXCLUSIVE)",
          "old_line_content": "\tif (userid != 0 && dbid != 0 && queryid != UINT64CONST(0))",
          "new_line_content": "\tLWLockAcquire(pgss->lock, LW_EXCLUSIVE);",
          "content_same": false
        },
        {
          "line": 2685,
          "old_api": "memset",
          "new_api": "GetCurrentTimestamp",
          "old_text": "memset(&key, 0, sizeof(pgssHashKey))",
          "new_text": "GetCurrentTimestamp()",
          "old_line_content": "\t\tmemset(&key, 0, sizeof(pgssHashKey));",
          "new_line_content": "\tstats_reset = GetCurrentTimestamp();",
          "content_same": false
        },
        {
          "line": 2708,
          "old_api": "hash_seq_init",
          "new_api": "SINGLE_ENTRY_RESET",
          "old_text": "hash_seq_init(&hash_seq, pgss_hash)",
          "new_text": "SINGLE_ENTRY_RESET(entry)",
          "old_line_content": "\t\thash_seq_init(&hash_seq, pgss_hash);",
          "new_line_content": "\t\tSINGLE_ENTRY_RESET(entry);",
          "content_same": false
        },
        {
          "line": 2751,
          "old_api": "errmsg",
          "new_api": "AllocateFile",
          "old_text": "errmsg(\"could not create file \\\"%s\\\": %m\",\n\t\t\t\t\t\tPGSS_TEXT_FILE)",
          "new_text": "AllocateFile(PGSS_TEXT_FILE, PG_BINARY_W)",
          "old_line_content": "\t\t\t\t errmsg(\"could not create file \\\"%s\\\": %m\",",
          "new_line_content": "\tqfile = AllocateFile(PGSS_TEXT_FILE, PG_BINARY_W);",
          "content_same": false
        },
        {
          "line": 2763,
          "old_api": "FreeFile",
          "new_api": "ereport",
          "old_text": "FreeFile(qfile)",
          "new_text": "ereport(LOG,\n\t\t\t\t(errcode_for_file_access(),\n\t\t\t\t errmsg(\"could not truncate file \\\"%s\\\": %m\",\n\t\t\t\t\t\tPGSS_TEXT_FILE)))",
          "old_line_content": "\tFreeFile(qfile);",
          "new_line_content": "\t\tereport(LOG,",
          "content_same": false
        },
        {
          "line": 2768,
          "old_api": "record_gc_qtexts",
          "new_api": "FreeFile",
          "old_text": "record_gc_qtexts()",
          "new_text": "FreeFile(qfile)",
          "old_line_content": "\trecord_gc_qtexts();",
          "new_line_content": "\tFreeFile(qfile);",
          "content_same": false
        },
        {
          "line": 2850,
          "old_api": "sprintf",
          "new_api": "Assert",
          "old_text": "sprintf(norm_query + n_quer_loc, \"$%d\",\n\t\t\t\t\t\t\t  i + 1 + jstate->highest_extern_param_id)",
          "new_text": "Assert(len_to_wrt >= 0)",
          "old_line_content": "\t\tn_quer_loc += sprintf(norm_query + n_quer_loc, \"$%d\",",
          "new_line_content": "\t\tAssert(len_to_wrt >= 0);",
          "content_same": false
        },
        {
          "line": 2924,
          "old_api": "scanner_init",
          "new_api": "qsort",
          "old_text": "scanner_init(query,\n\t\t\t\t\t\t\t &yyextra,\n\t\t\t\t\t\t\t &ScanKeywords,\n\t\t\t\t\t\t\t ScanKeywordTokens)",
          "new_text": "qsort(jstate->clocations, jstate->clocations_count,\n\t\t\t  sizeof(LocationLen), comp_location)",
          "old_line_content": "\tyyscanner = scanner_init(query,",
          "new_line_content": "\t\tqsort(jstate->clocations, jstate->clocations_count,",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 2048,
          "old_api": null,
          "new_api": "hash_estimate_size",
          "old_text": null,
          "new_text": "hash_estimate_size(pgss_max, sizeof(pgssEntry))",
          "old_line_content": "/*",
          "new_line_content": "\tsize = add_size(size, hash_estimate_size(pgss_max, sizeof(pgssEntry)));",
          "content_same": false
        },
        {
          "line": 2560,
          "old_api": null,
          "new_api": "errmsg",
          "old_text": null,
          "new_text": "errmsg(\"could not write file \\\"%s\\\": %m\",\n\t\t\t\t\t\tPGSS_TEXT_FILE)",
          "old_line_content": "",
          "new_line_content": "\t\t\t\t errmsg(\"could not write file \\\"%s\\\": %m\",",
          "content_same": false
        },
        {
          "line": 2566,
          "old_api": null,
          "new_api": "elog",
          "old_text": null,
          "new_text": "elog(DEBUG1, \"pgss gc of queries file shrunk size from %zu to %zu\",\n\t\t pgss->extent, extent)",
          "old_line_content": "",
          "new_line_content": "\telog(DEBUG1, \"pgss gc of queries file shrunk size from %zu to %zu\",",
          "content_same": false
        },
        {
          "line": 2581,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free(qbuffer)",
          "old_line_content": "\t * other processes may examine gc_count while holding only the mutex.",
          "new_line_content": "\tfree(qbuffer);",
          "content_same": false
        },
        {
          "line": 2078,
          "old_api": null,
          "new_api": "hash_get_num_entries",
          "old_text": null,
          "new_text": "hash_get_num_entries(pgss_hash)",
          "old_line_content": "",
          "new_line_content": "\twhile (hash_get_num_entries(pgss_hash) >= pgss_max)",
          "content_same": false
        },
        {
          "line": 2079,
          "old_api": null,
          "new_api": "entry_dealloc",
          "old_text": null,
          "new_text": "entry_dealloc()",
          "old_line_content": "\tif (!found)",
          "new_line_content": "\t\tentry_dealloc();",
          "content_same": false
        },
        {
          "line": 2590,
          "old_api": null,
          "new_api": "record_gc_qtexts",
          "old_text": null,
          "new_text": "record_gc_qtexts()",
          "old_line_content": "\t/* clean up resources */",
          "new_line_content": "\trecord_gc_qtexts();",
          "content_same": false
        },
        {
          "line": 2082,
          "old_api": null,
          "new_api": "hash_search",
          "old_text": null,
          "new_text": "hash_search(pgss_hash, key, HASH_ENTER, &found)",
          "old_line_content": "",
          "new_line_content": "\tentry = (pgssEntry *) hash_search(pgss_hash, key, HASH_ENTER, &found);",
          "content_same": false
        },
        {
          "line": 2597,
          "old_api": null,
          "new_api": "FreeFile",
          "old_text": null,
          "new_text": "FreeFile(qfile)",
          "old_line_content": "\t * hashtable entries as having invalid texts.",
          "new_line_content": "\t\tFreeFile(qfile);",
          "content_same": false
        },
        {
          "line": 2598,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free(qbuffer)",
          "old_line_content": "\t */",
          "new_line_content": "\tfree(qbuffer);",
          "content_same": false
        },
        {
          "line": 2089,
          "old_api": null,
          "new_api": "memset",
          "old_text": null,
          "new_text": "memset(&entry->counters, 0, sizeof(Counters))",
          "old_line_content": "\t\t/* ... and don't forget the query text metadata */",
          "new_line_content": "\t\tmemset(&entry->counters, 0, sizeof(Counters));",
          "content_same": false
        },
        {
          "line": 2604,
          "old_api": null,
          "new_api": "hash_seq_init",
          "old_text": null,
          "new_text": "hash_seq_init(&hash_seq, pgss_hash)",
          "old_line_content": "\t}",
          "new_line_content": "\thash_seq_init(&hash_seq, pgss_hash);",
          "content_same": false
        },
        {
          "line": 2093,
          "old_api": null,
          "new_api": "SpinLockInit",
          "old_text": null,
          "new_text": "SpinLockInit(&entry->mutex)",
          "old_line_content": "\t\tentry->encoding = encoding;",
          "new_line_content": "\t\tSpinLockInit(&entry->mutex);",
          "content_same": false
        },
        {
          "line": 2605,
          "old_api": null,
          "new_api": "hash_seq_search",
          "old_text": null,
          "new_text": "hash_seq_search(&hash_seq)",
          "old_line_content": "",
          "new_line_content": "\twhile ((entry = hash_seq_search(&hash_seq)) != NULL)",
          "content_same": false
        },
        {
          "line": 2095,
          "old_api": null,
          "new_api": "Assert",
          "old_text": null,
          "new_text": "Assert(query_len >= 0)",
          "old_line_content": "\t\tentry->minmax_stats_since = entry->stats_since;",
          "new_line_content": "\t\tAssert(query_len >= 0);",
          "content_same": false
        },
        {
          "line": 2099,
          "old_api": null,
          "new_api": "GetCurrentTimestamp",
          "old_text": null,
          "new_text": "GetCurrentTimestamp()",
          "old_line_content": "}",
          "new_line_content": "\t\tentry->stats_since = GetCurrentTimestamp();",
          "content_same": false
        },
        {
          "line": 2615,
          "old_api": null,
          "new_api": "AllocateFile",
          "old_text": null,
          "new_text": "AllocateFile(PGSS_TEXT_FILE, PG_BINARY_W)",
          "old_line_content": "\t\t\t\t\t\tPGSS_TEXT_FILE)));",
          "new_line_content": "\tqfile = AllocateFile(PGSS_TEXT_FILE, PG_BINARY_W);",
          "content_same": false
        },
        {
          "line": 2618,
          "old_api": null,
          "new_api": "errcode_for_file_access",
          "old_text": null,
          "new_text": "errcode_for_file_access()",
          "old_line_content": "",
          "new_line_content": "\t\t\t\t(errcode_for_file_access(),",
          "content_same": false
        },
        {
          "line": 2619,
          "old_api": null,
          "new_api": "errmsg",
          "old_text": null,
          "new_text": "errmsg(\"could not recreate file \\\"%s\\\": %m\",\n\t\t\t\t\t\tPGSS_TEXT_FILE)",
          "old_line_content": "\t/* Reset the shared extent pointer */",
          "new_line_content": "\t\t\t\t errmsg(\"could not recreate file \\\"%s\\\": %m\",",
          "content_same": false
        },
        {
          "line": 2047,
          "old_api": null,
          "new_api": "MAXALIGN",
          "old_text": null,
          "new_text": "MAXALIGN(sizeof(pgssSharedState))",
          "old_line_content": "",
          "new_line_content": "\tsize = MAXALIGN(sizeof(pgssSharedState));",
          "content_same": false
        },
        {
          "line": 2622,
          "old_api": null,
          "new_api": "FreeFile",
          "old_text": null,
          "new_text": "FreeFile(qfile)",
          "old_line_content": "\t/* Reset mean_query_len to match the new state */",
          "new_line_content": "\t\tFreeFile(qfile);",
          "content_same": false
        },
        {
          "line": 2641,
          "old_api": null,
          "new_api": "record_gc_qtexts",
          "old_text": null,
          "new_text": "record_gc_qtexts()",
          "old_line_content": "\tif (minmax_only) { \\",
          "new_line_content": "\trecord_gc_qtexts();",
          "content_same": false
        },
        {
          "line": 2658,
          "old_api": null,
          "new_api": "hash_search",
          "old_text": null,
          "new_text": "hash_search(pgss_hash, &e->key, HASH_REMOVE, NULL)",
          "old_line_content": "/*",
          "new_line_content": "\t\thash_search(pgss_hash, &e->key, HASH_REMOVE, NULL); \\",
          "content_same": false
        },
        {
          "line": 2151,
          "old_api": null,
          "new_api": "hash_get_num_entries",
          "old_text": null,
          "new_text": "hash_get_num_entries(pgss_hash)",
          "old_line_content": "",
          "new_line_content": "\tentries = palloc(hash_get_num_entries(pgss_hash) * sizeof(pgssEntry *));",
          "content_same": false
        },
        {
          "line": 2158,
          "old_api": null,
          "new_api": "hash_seq_search",
          "old_text": null,
          "new_text": "hash_seq_search(&hash_seq)",
          "old_line_content": "\t\t\tentry->counters.usage *= STICKY_DECREASE_FACTOR;",
          "new_line_content": "\twhile ((entry = hash_seq_search(&hash_seq)) != NULL)",
          "content_same": false
        },
        {
          "line": 2162,
          "old_api": null,
          "new_api": "IS_STICKY",
          "old_text": null,
          "new_text": "IS_STICKY(entry->counters)",
          "old_line_content": "\t\tif (entry->query_len >= 0)",
          "new_line_content": "\t\tif (IS_STICKY(entry->counters))",
          "content_same": false
        },
        {
          "line": 2679,
          "old_api": null,
          "new_api": "errcode",
          "old_text": null,
          "new_text": "errcode(ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE)",
          "old_line_content": "",
          "new_line_content": "\t\t\t\t(errcode(ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE),",
          "content_same": false
        },
        {
          "line": 2683,
          "old_api": null,
          "new_api": "hash_get_num_entries",
          "old_text": null,
          "new_text": "hash_get_num_entries(pgss_hash)",
          "old_line_content": "\t{",
          "new_line_content": "\tnum_entries = hash_get_num_entries(pgss_hash);",
          "content_same": false
        },
        {
          "line": 2175,
          "old_api": null,
          "new_api": "qsort",
          "old_text": null,
          "new_text": "qsort(entries, i, sizeof(pgssEntry *), entry_cmp)",
          "old_line_content": "\t/* Record the mean query length */",
          "new_line_content": "\tqsort(entries, i, sizeof(pgssEntry *), entry_cmp);",
          "content_same": false
        },
        {
          "line": 2687,
          "old_api": null,
          "new_api": "UINT64CONST",
          "old_text": null,
          "new_text": "UINT64CONST(0)",
          "old_line_content": "\t\tkey.dbid = dbid;",
          "new_line_content": "\tif (userid != 0 && dbid != 0 && queryid != UINT64CONST(0))",
          "content_same": false
        },
        {
          "line": 2690,
          "old_api": null,
          "new_api": "memset",
          "old_text": null,
          "new_text": "memset(&key, 0, sizeof(pgssHashKey))",
          "old_line_content": "\t\t/*",
          "new_line_content": "\t\tmemset(&key, 0, sizeof(pgssHashKey));",
          "content_same": false
        },
        {
          "line": 2188,
          "old_api": null,
          "new_api": "Min",
          "old_text": null,
          "new_text": "Min(nvictims, i)",
          "old_line_content": "\t}",
          "new_line_content": "\tnvictims = Min(nvictims, i);",
          "content_same": false
        },
        {
          "line": 2700,
          "old_api": null,
          "new_api": "hash_search",
          "old_text": null,
          "new_text": "hash_search(pgss_hash, &key, HASH_FIND, NULL)",
          "old_line_content": "\t\tkey.toplevel = true;",
          "new_line_content": "\t\tentry = (pgssEntry *) hash_search(pgss_hash, &key, HASH_FIND, NULL);",
          "content_same": false
        },
        {
          "line": 2702,
          "old_api": null,
          "new_api": "SINGLE_ENTRY_RESET",
          "old_text": null,
          "new_text": "SINGLE_ENTRY_RESET(entry)",
          "old_line_content": "",
          "new_line_content": "\t\tSINGLE_ENTRY_RESET(entry);",
          "content_same": false
        },
        {
          "line": 2192,
          "old_api": null,
          "new_api": "hash_search",
          "old_text": null,
          "new_text": "hash_search(pgss_hash, &entries[i]->key, HASH_REMOVE, NULL)",
          "old_line_content": "\t/* Increment the number of times entries are deallocated */",
          "new_line_content": "\t\thash_search(pgss_hash, &entries[i]->key, HASH_REMOVE, NULL);",
          "content_same": false
        },
        {
          "line": 2706,
          "old_api": null,
          "new_api": "hash_search",
          "old_text": null,
          "new_text": "hash_search(pgss_hash, &key, HASH_FIND, NULL)",
          "old_line_content": "\t{",
          "new_line_content": "\t\tentry = (pgssEntry *) hash_search(pgss_hash, &key, HASH_FIND, NULL);",
          "content_same": false
        },
        {
          "line": 2198,
          "old_api": null,
          "new_api": "SpinLockAcquire",
          "old_text": null,
          "new_text": "SpinLockAcquire(&pgss->mutex)",
          "old_line_content": "/*",
          "new_line_content": "\tSpinLockAcquire(&pgss->mutex);",
          "content_same": false
        },
        {
          "line": 2710,
          "old_api": null,
          "new_api": "UINT64CONST",
          "old_text": null,
          "new_text": "UINT64CONST(0)",
          "old_line_content": "\t\t{",
          "new_line_content": "\telse if (userid != 0 || dbid != 0 || queryid != UINT64CONST(0))",
          "content_same": false
        },
        {
          "line": 2200,
          "old_api": null,
          "new_api": "SpinLockRelease",
          "old_text": null,
          "new_text": "SpinLockRelease(&pgss->mutex)",
          "old_line_content": " * entry in the external query text file and store the string there.",
          "new_line_content": "\tSpinLockRelease(&pgss->mutex);",
          "content_same": false
        },
        {
          "line": 2713,
          "old_api": null,
          "new_api": "hash_seq_init",
          "old_text": null,
          "new_text": "hash_seq_init(&hash_seq, pgss_hash)",
          "old_line_content": "\t\t\t\t(!queryid || entry->key.queryid == queryid))",
          "new_line_content": "\t\thash_seq_init(&hash_seq, pgss_hash);",
          "content_same": false
        },
        {
          "line": 2714,
          "old_api": null,
          "new_api": "hash_seq_search",
          "old_text": null,
          "new_text": "hash_seq_search(&hash_seq)",
          "old_line_content": "\t\t\t{",
          "new_line_content": "\t\twhile ((entry = hash_seq_search(&hash_seq)) != NULL)",
          "content_same": false
        },
        {
          "line": 2720,
          "old_api": null,
          "new_api": "SINGLE_ENTRY_RESET",
          "old_text": null,
          "new_text": "SINGLE_ENTRY_RESET(entry)",
          "old_line_content": "\t{",
          "new_line_content": "\t\t\t\tSINGLE_ENTRY_RESET(entry);",
          "content_same": false
        },
        {
          "line": 2727,
          "old_api": null,
          "new_api": "hash_seq_init",
          "old_text": null,
          "new_text": "hash_seq_init(&hash_seq, pgss_hash)",
          "old_line_content": "\t}",
          "new_line_content": "\t\thash_seq_init(&hash_seq, pgss_hash);",
          "content_same": false
        },
        {
          "line": 2728,
          "old_api": null,
          "new_api": "hash_seq_search",
          "old_text": null,
          "new_text": "hash_seq_search(&hash_seq)",
          "old_line_content": "",
          "new_line_content": "\t\twhile ((entry = hash_seq_search(&hash_seq)) != NULL)",
          "content_same": false
        },
        {
          "line": 2730,
          "old_api": null,
          "new_api": "SINGLE_ENTRY_RESET",
          "old_text": null,
          "new_text": "SINGLE_ENTRY_RESET(entry)",
          "old_line_content": "\tif (num_entries != num_remove)",
          "new_line_content": "\t\t\tSINGLE_ENTRY_RESET(entry);",
          "content_same": false
        },
        {
          "line": 2230,
          "old_api": null,
          "new_api": "SpinLockAcquire",
          "old_text": null,
          "new_text": "SpinLockAcquire(&pgss->mutex)",
          "old_line_content": "\t\t*gc_count = pgss->gc_count;",
          "new_line_content": "\tSpinLockAcquire(&pgss->mutex);",
          "content_same": false
        },
        {
          "line": 2742,
          "old_api": null,
          "new_api": "SpinLockAcquire",
          "old_text": null,
          "new_text": "SpinLockAcquire(&pgss->mutex)",
          "old_line_content": "\t/*",
          "new_line_content": "\tSpinLockAcquire(&pgss->mutex);",
          "content_same": false
        },
        {
          "line": 2745,
          "old_api": null,
          "new_api": "SpinLockRelease",
          "old_text": null,
          "new_text": "SpinLockRelease(&pgss->mutex)",
          "old_line_content": "\t */",
          "new_line_content": "\tSpinLockRelease(&pgss->mutex);",
          "content_same": false
        },
        {
          "line": 2236,
          "old_api": null,
          "new_api": "SpinLockRelease",
          "old_text": null,
          "new_text": "SpinLockRelease(&pgss->mutex)",
          "old_line_content": "\t * Don't allow the file to grow larger than what qtext_load_file can",
          "new_line_content": "\tSpinLockRelease(&pgss->mutex);",
          "content_same": false
        },
        {
          "line": 2754,
          "old_api": null,
          "new_api": "ereport",
          "old_text": null,
          "new_text": "ereport(LOG,\n\t\t\t\t(errcode_for_file_access(),\n\t\t\t\t errmsg(\"could not create file \\\"%s\\\": %m\",\n\t\t\t\t\t\tPGSS_TEXT_FILE)))",
          "old_line_content": "\t}",
          "new_line_content": "\t\tereport(LOG,",
          "content_same": false
        },
        {
          "line": 2755,
          "old_api": null,
          "new_api": "errcode_for_file_access",
          "old_text": null,
          "new_text": "errcode_for_file_access()",
          "old_line_content": "",
          "new_line_content": "\t\t\t\t(errcode_for_file_access(),",
          "content_same": false
        },
        {
          "line": 2756,
          "old_api": null,
          "new_api": "errmsg",
          "old_text": null,
          "new_text": "errmsg(\"could not create file \\\"%s\\\": %m\",\n\t\t\t\t\t\tPGSS_TEXT_FILE)",
          "old_line_content": "\t/* If ftruncate fails, log it, but it's not a fatal problem */",
          "new_line_content": "\t\t\t\t errmsg(\"could not create file \\\"%s\\\": %m\",",
          "content_same": false
        },
        {
          "line": 2245,
          "old_api": null,
          "new_api": "unlikely",
          "old_text": null,
          "new_text": "unlikely(query_len >= MaxAllocHugeSize - off)",
          "old_line_content": "\t}",
          "new_line_content": "\tif (unlikely(query_len >= MaxAllocHugeSize - off))",
          "content_same": false
        },
        {
          "line": 2762,
          "old_api": null,
          "new_api": "fileno",
          "old_text": null,
          "new_text": "fileno(qfile)",
          "old_line_content": "",
          "new_line_content": "\tif (ftruncate(fileno(qfile), 0) != 0)",
          "content_same": false
        },
        {
          "line": 2764,
          "old_api": null,
          "new_api": "errcode_for_file_access",
          "old_text": null,
          "new_text": "errcode_for_file_access()",
          "old_line_content": "",
          "new_line_content": "\t\t\t\t(errcode_for_file_access(),",
          "content_same": false
        },
        {
          "line": 2253,
          "old_api": null,
          "new_api": "OpenTransientFile",
          "old_text": null,
          "new_text": "OpenTransientFile(PGSS_TEXT_FILE, O_RDWR | O_CREAT | PG_BINARY)",
          "old_line_content": "\t\tgoto error;",
          "new_line_content": "\tfd = OpenTransientFile(PGSS_TEXT_FILE, O_RDWR | O_CREAT | PG_BINARY);",
          "content_same": false
        },
        {
          "line": 2765,
          "old_api": null,
          "new_api": "errmsg",
          "old_text": null,
          "new_text": "errmsg(\"could not truncate file \\\"%s\\\": %m\",\n\t\t\t\t\t\tPGSS_TEXT_FILE)",
          "old_line_content": "done:",
          "new_line_content": "\t\t\t\t errmsg(\"could not truncate file \\\"%s\\\": %m\",",
          "content_same": false
        },
        {
          "line": 2259,
          "old_api": null,
          "new_api": "pg_pwrite",
          "old_text": null,
          "new_text": "pg_pwrite(fd, \"\\0\", 1, off + query_len)",
          "old_line_content": "\t/* Mark our write complete */",
          "new_line_content": "\tif (pg_pwrite(fd, \"\\0\", 1, off + query_len) != 1)",
          "content_same": false
        },
        {
          "line": 2773,
          "old_api": null,
          "new_api": "record_gc_qtexts",
          "old_text": null,
          "new_text": "record_gc_qtexts()",
          "old_line_content": "\treturn stats_reset;",
          "new_line_content": "\trecord_gc_qtexts();",
          "content_same": false
        },
        {
          "line": 2776,
          "old_api": null,
          "new_api": "LWLockRelease",
          "old_text": null,
          "new_text": "LWLockRelease(pgss->lock)",
          "old_line_content": "/*",
          "new_line_content": "\tLWLockRelease(pgss->lock);",
          "content_same": false
        },
        {
          "line": 2265,
          "old_api": null,
          "new_api": "SpinLockAcquire",
          "old_text": null,
          "new_text": "SpinLockAcquire(&pgss->mutex)",
          "old_line_content": "",
          "new_line_content": "\tSpinLockAcquire(&pgss->mutex);",
          "content_same": false
        },
        {
          "line": 2272,
          "old_api": null,
          "new_api": "ereport",
          "old_text": null,
          "new_text": "ereport(LOG,\n\t\t\t(errcode_for_file_access(),\n\t\t\t errmsg(\"could not write file \\\"%s\\\": %m\",\n\t\t\t\t\tPGSS_TEXT_FILE)))",
          "old_line_content": "\tif (fd >= 0)",
          "new_line_content": "\tereport(LOG,",
          "content_same": false
        },
        {
          "line": 2274,
          "old_api": null,
          "new_api": "errmsg",
          "old_text": null,
          "new_text": "errmsg(\"could not write file \\\"%s\\\": %m\",\n\t\t\t\t\tPGSS_TEXT_FILE)",
          "old_line_content": "",
          "new_line_content": "\t\t\t errmsg(\"could not write file \\\"%s\\\": %m\",",
          "content_same": false
        },
        {
          "line": 2281,
          "old_api": null,
          "new_api": "SpinLockAcquire",
          "old_text": null,
          "new_text": "SpinLockAcquire(&pgss->mutex)",
          "old_line_content": "}",
          "new_line_content": "\tSpinLockAcquire(&pgss->mutex);",
          "content_same": false
        },
        {
          "line": 2283,
          "old_api": null,
          "new_api": "SpinLockRelease",
          "old_text": null,
          "new_text": "SpinLockRelease(&pgss->mutex)",
          "old_line_content": "/*",
          "new_line_content": "\tSpinLockRelease(&pgss->mutex);",
          "content_same": false
        },
        {
          "line": 2818,
          "old_api": null,
          "new_api": "fill_in_constant_lengths",
          "old_text": null,
          "new_text": "fill_in_constant_lengths(jstate, query, query_loc)",
          "old_line_content": "\t * certainly isn't more than 11 bytes, even if n reaches INT_MAX.  We",
          "new_line_content": "\tfill_in_constant_lengths(jstate, query, query_loc);",
          "content_same": false
        },
        {
          "line": 2311,
          "old_api": null,
          "new_api": "ereport",
          "old_text": null,
          "new_text": "ereport(LOG,\n\t\t\t\t\t(errcode_for_file_access(),\n\t\t\t\t\t errmsg(\"could not read file \\\"%s\\\": %m\",\n\t\t\t\t\t\t\tPGSS_TEXT_FILE)))",
          "old_line_content": "\t}",
          "new_line_content": "\t\t\tereport(LOG,",
          "content_same": false
        },
        {
          "line": 2312,
          "old_api": null,
          "new_api": "errcode_for_file_access",
          "old_text": null,
          "new_text": "errcode_for_file_access()",
          "old_line_content": "",
          "new_line_content": "\t\t\t\t\t(errcode_for_file_access(),",
          "content_same": false
        },
        {
          "line": 2313,
          "old_api": null,
          "new_api": "errmsg",
          "old_text": null,
          "new_text": "errmsg(\"could not read file \\\"%s\\\": %m\",\n\t\t\t\t\t\t\tPGSS_TEXT_FILE)",
          "old_line_content": "\t/* Get file length */",
          "new_line_content": "\t\t\t\t\t errmsg(\"could not read file \\\"%s\\\": %m\",",
          "content_same": false
        },
        {
          "line": 2830,
          "old_api": null,
          "new_api": "palloc",
          "old_text": null,
          "new_text": "palloc(norm_query_buflen + 1)",
          "old_line_content": "\t\t\t\t\ttok_len;\t/* Length (in bytes) of that tok */",
          "new_line_content": "\tnorm_query = palloc(norm_query_buflen + 1);",
          "content_same": false
        },
        {
          "line": 2319,
          "old_api": null,
          "new_api": "fstat",
          "old_text": null,
          "new_text": "fstat(fd, &stat)",
          "old_line_content": "\t\t\t\t\t\tPGSS_TEXT_FILE)));",
          "new_line_content": "\tif (fstat(fd, &stat))",
          "content_same": false
        },
        {
          "line": 2321,
          "old_api": null,
          "new_api": "ereport",
          "old_text": null,
          "new_text": "ereport(LOG,\n\t\t\t\t(errcode_for_file_access(),\n\t\t\t\t errmsg(\"could not stat file \\\"%s\\\": %m\",\n\t\t\t\t\t\tPGSS_TEXT_FILE)))",
          "old_line_content": "\t\treturn NULL;",
          "new_line_content": "\t\tereport(LOG,",
          "content_same": false
        },
        {
          "line": 2322,
          "old_api": null,
          "new_api": "errcode_for_file_access",
          "old_text": null,
          "new_text": "errcode_for_file_access()",
          "old_line_content": "\t}",
          "new_line_content": "\t\t\t\t(errcode_for_file_access(),",
          "content_same": false
        },
        {
          "line": 2323,
          "old_api": null,
          "new_api": "errmsg",
          "old_text": null,
          "new_text": "errmsg(\"could not stat file \\\"%s\\\": %m\",\n\t\t\t\t\t\tPGSS_TEXT_FILE)",
          "old_line_content": "",
          "new_line_content": "\t\t\t\t errmsg(\"could not stat file \\\"%s\\\": %m\",",
          "content_same": false
        },
        {
          "line": 2325,
          "old_api": null,
          "new_api": "CloseTransientFile",
          "old_text": null,
          "new_text": "CloseTransientFile(fd)",
          "old_line_content": "\tif (stat.st_size <= MaxAllocHugeSize)",
          "new_line_content": "\t\tCloseTransientFile(fd);",
          "content_same": false
        },
        {
          "line": 2337,
          "old_api": null,
          "new_api": "errcode",
          "old_text": null,
          "new_text": "errcode(ERRCODE_OUT_OF_MEMORY)",
          "old_line_content": "\t\treturn NULL;",
          "new_line_content": "\t\t\t\t(errcode(ERRCODE_OUT_OF_MEMORY),",
          "content_same": false
        },
        {
          "line": 2338,
          "old_api": null,
          "new_api": "errmsg",
          "old_text": null,
          "new_text": "errmsg(\"out of memory\")",
          "old_line_content": "\t}",
          "new_line_content": "\t\t\t\t errmsg(\"out of memory\"),",
          "content_same": false
        },
        {
          "line": 2339,
          "old_api": null,
          "new_api": "errdetail",
          "old_text": null,
          "new_text": "errdetail(\"Could not allocate enough memory to read file \\\"%s\\\".\",\n\t\t\t\t\t\t   PGSS_TEXT_FILE)",
          "old_line_content": "",
          "new_line_content": "\t\t\t\t errdetail(\"Could not allocate enough memory to read file \\\"%s\\\".\",",
          "content_same": false
        },
        {
          "line": 2851,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(norm_query + n_quer_loc, query + quer_loc, len_to_wrt)",
          "old_line_content": "\t\t\t\t\t\t\t  i + 1 + jstate->highest_extern_param_id);",
          "new_line_content": "\t\tmemcpy(norm_query + n_quer_loc, query + quer_loc, len_to_wrt);",
          "content_same": false
        },
        {
          "line": 2341,
          "old_api": null,
          "new_api": "CloseTransientFile",
          "old_text": null,
          "new_text": "CloseTransientFile(fd)",
          "old_line_content": "\t * OK, slurp in the file.  Windows fails if we try to read more than",
          "new_line_content": "\t\tCloseTransientFile(fd);",
          "content_same": false
        },
        {
          "line": 2855,
          "old_api": null,
          "new_api": "sprintf",
          "old_text": null,
          "new_text": "sprintf(norm_query + n_quer_loc, \"$%d\",\n\t\t\t\t\t\t\t  i + 1 + jstate->highest_extern_param_id)",
          "old_line_content": "\t\tlast_tok_len = tok_len;",
          "new_line_content": "\t\tn_quer_loc += sprintf(norm_query + n_quer_loc, \"$%d\",",
          "content_same": false
        },
        {
          "line": 2353,
          "old_api": null,
          "new_api": "Min",
          "old_text": null,
          "new_text": "Min(1024 * 1024 * 1024, stat.st_size - nread)",
          "old_line_content": "\t\t * the fstat(), so we don't log a complaint --- but we don't return",
          "new_line_content": "\t\tint\t\t\ttoread = Min(1024 * 1024 * 1024, stat.st_size - nread);",
          "content_same": false
        },
        {
          "line": 2869,
          "old_api": null,
          "new_api": "Assert",
          "old_text": null,
          "new_text": "Assert(len_to_wrt >= 0)",
          "old_line_content": "\tnorm_query[n_quer_loc] = '\\0';",
          "new_line_content": "\tAssert(len_to_wrt >= 0);",
          "content_same": false
        },
        {
          "line": 2870,
          "old_api": null,
          "new_api": "memcpy",
          "old_text": null,
          "new_text": "memcpy(norm_query + n_quer_loc, query + quer_loc, len_to_wrt)",
          "old_line_content": "",
          "new_line_content": "\tmemcpy(norm_query + n_quer_loc, query + quer_loc, len_to_wrt);",
          "content_same": false
        },
        {
          "line": 2873,
          "old_api": null,
          "new_api": "Assert",
          "old_text": null,
          "new_text": "Assert(n_quer_loc <= norm_query_buflen)",
          "old_line_content": "}",
          "new_line_content": "\tAssert(n_quer_loc <= norm_query_buflen);",
          "content_same": false
        },
        {
          "line": 2367,
          "old_api": null,
          "new_api": "errcode_for_file_access",
          "old_text": null,
          "new_text": "errcode_for_file_access()",
          "old_line_content": "\t\t\treturn NULL;",
          "new_line_content": "\t\t\t\t\t\t(errcode_for_file_access(),",
          "content_same": false
        },
        {
          "line": 2368,
          "old_api": null,
          "new_api": "errmsg",
          "old_text": null,
          "new_text": "errmsg(\"could not read file \\\"%s\\\": %m\",\n\t\t\t\t\t\t\t\tPGSS_TEXT_FILE)",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\t\t\t\t\t errmsg(\"could not read file \\\"%s\\\": %m\",",
          "content_same": false
        },
        {
          "line": 2370,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free(buf)",
          "old_line_content": "\t}",
          "new_line_content": "\t\t\tfree(buf);",
          "content_same": false
        },
        {
          "line": 2371,
          "old_api": null,
          "new_api": "CloseTransientFile",
          "old_text": null,
          "new_text": "CloseTransientFile(fd)",
          "old_line_content": "",
          "new_line_content": "\t\t\tCloseTransientFile(fd);",
          "content_same": false
        },
        {
          "line": 2377,
          "old_api": null,
          "new_api": "CloseTransientFile",
          "old_text": null,
          "new_text": "CloseTransientFile(fd)",
          "old_line_content": "\t*buffer_size = nread;",
          "new_line_content": "\tif (CloseTransientFile(fd) != 0)",
          "content_same": false
        },
        {
          "line": 2378,
          "old_api": null,
          "new_api": "ereport",
          "old_text": null,
          "new_text": "ereport(LOG,\n\t\t\t\t(errcode_for_file_access(),\n\t\t\t\t errmsg(\"could not close file \\\"%s\\\": %m\", PGSS_TEXT_FILE)))",
          "old_line_content": "\treturn buf;",
          "new_line_content": "\t\tereport(LOG,",
          "content_same": false
        },
        {
          "line": 2379,
          "old_api": null,
          "new_api": "errcode_for_file_access",
          "old_text": null,
          "new_text": "errcode_for_file_access()",
          "old_line_content": "}",
          "new_line_content": "\t\t\t\t(errcode_for_file_access(),",
          "content_same": false
        },
        {
          "line": 2380,
          "old_api": null,
          "new_api": "errmsg",
          "old_text": null,
          "new_text": "errmsg(\"could not close file \\\"%s\\\": %m\", PGSS_TEXT_FILE)",
          "old_line_content": "",
          "new_line_content": "\t\t\t\t errmsg(\"could not close file \\\"%s\\\": %m\", PGSS_TEXT_FILE)));",
          "content_same": false
        },
        {
          "line": 1872,
          "old_api": null,
          "new_api": "SpinLockRelease",
          "old_text": null,
          "new_text": "SpinLockRelease(&entry->mutex)",
          "old_line_content": "\t\tstats_since = entry->stats_since;",
          "new_line_content": "\t\tSpinLockRelease(&entry->mutex);",
          "content_same": false
        },
        {
          "line": 1882,
          "old_api": null,
          "new_api": "IS_STICKY",
          "old_text": null,
          "new_text": "IS_STICKY(tmp)",
          "old_line_content": "\t\t{",
          "new_line_content": "\t\tif (IS_STICKY(tmp))",
          "content_same": false
        },
        {
          "line": 1890,
          "old_api": null,
          "new_api": "Int64GetDatumFast",
          "old_text": null,
          "new_text": "Int64GetDatumFast(tmp.calls[kind])",
          "old_line_content": "\t\t\t\tapi_version >= PGSS_V1_8)",
          "new_line_content": "\t\t\t\tvalues[i++] = Int64GetDatumFast(tmp.calls[kind]);",
          "content_same": false
        },
        {
          "line": 1891,
          "old_api": null,
          "new_api": "Float8GetDatumFast",
          "old_text": null,
          "new_text": "Float8GetDatumFast(tmp.total_time[kind])",
          "old_line_content": "\t\t\t{",
          "new_line_content": "\t\t\t\tvalues[i++] = Float8GetDatumFast(tmp.total_time[kind]);",
          "content_same": false
        },
        {
          "line": 1897,
          "old_api": null,
          "new_api": "Float8GetDatumFast",
          "old_text": null,
          "new_text": "Float8GetDatumFast(tmp.min_time[kind])",
          "old_line_content": "\t\t\t\t * Note we are calculating the population variance here, not",
          "new_line_content": "\t\t\t\tvalues[i++] = Float8GetDatumFast(tmp.min_time[kind]);",
          "content_same": false
        },
        {
          "line": 1898,
          "old_api": null,
          "new_api": "Float8GetDatumFast",
          "old_text": null,
          "new_text": "Float8GetDatumFast(tmp.max_time[kind])",
          "old_line_content": "\t\t\t\t * the sample variance, as we have data for the whole",
          "new_line_content": "\t\t\t\tvalues[i++] = Float8GetDatumFast(tmp.max_time[kind]);",
          "content_same": false
        },
        {
          "line": 1899,
          "old_api": null,
          "new_api": "Float8GetDatumFast",
          "old_text": null,
          "new_text": "Float8GetDatumFast(tmp.mean_time[kind])",
          "old_line_content": "\t\t\t\t * population, so Bessel's correction is not used, and we",
          "new_line_content": "\t\t\t\tvalues[i++] = Float8GetDatumFast(tmp.mean_time[kind]);",
          "content_same": false
        },
        {
          "line": 2929,
          "old_api": null,
          "new_api": "scanner_init",
          "old_text": null,
          "new_text": "scanner_init(query,\n\t\t\t\t\t\t\t &yyextra,\n\t\t\t\t\t\t\t &ScanKeywords,\n\t\t\t\t\t\t\t ScanKeywordTokens)",
          "old_line_content": "\t/* we don't want to re-emit any escape string warnings */",
          "new_line_content": "\tyyscanner = scanner_init(query,",
          "content_same": false
        },
        {
          "line": 1908,
          "old_api": null,
          "new_api": "sqrt",
          "old_text": null,
          "new_text": "sqrt(tmp.sum_var_time[kind] / tmp.calls[kind])",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\t\t\t\tstddev = sqrt(tmp.sum_var_time[kind] / tmp.calls[kind]);",
          "content_same": false
        },
        {
          "line": 2421,
          "old_api": null,
          "new_api": "SpinLockAcquire",
          "old_text": null,
          "new_text": "SpinLockAcquire(&pgss->mutex)",
          "old_line_content": "\t * Don't proceed if file does not exceed 512 bytes per possible entry.",
          "new_line_content": "\tSpinLockAcquire(&pgss->mutex);",
          "content_same": false
        },
        {
          "line": 2423,
          "old_api": null,
          "new_api": "SpinLockRelease",
          "old_text": null,
          "new_text": "SpinLockRelease(&pgss->mutex)",
          "old_line_content": "\t * Here and in the next test, 32-bit machines have overflow hazards if",
          "new_line_content": "\tSpinLockRelease(&pgss->mutex);",
          "content_same": false
        },
        {
          "line": 2946,
          "old_api": null,
          "new_api": "Assert",
          "old_text": null,
          "new_text": "Assert(loc >= 0)",
          "old_line_content": "\t\t/* Lex tokens until we find the desired constant */",
          "new_line_content": "\t\tAssert(loc >= 0);",
          "content_same": false
        },
        {
          "line": 1923,
          "old_api": null,
          "new_api": "Int64GetDatumFast",
          "old_text": null,
          "new_text": "Int64GetDatumFast(tmp.local_blks_dirtied)",
          "old_line_content": "\t\t{",
          "new_line_content": "\t\t\tvalues[i++] = Int64GetDatumFast(tmp.local_blks_dirtied);",
          "content_same": false
        },
        {
          "line": 1926,
          "old_api": null,
          "new_api": "Int64GetDatumFast",
          "old_text": null,
          "new_text": "Int64GetDatumFast(tmp.temp_blks_written)",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\tvalues[i++] = Int64GetDatumFast(tmp.temp_blks_written);",
          "content_same": false
        },
        {
          "line": 2954,
          "old_api": null,
          "new_api": "core_yylex",
          "old_text": null,
          "new_text": "core_yylex(&yylval, &yylloc, yyscanner)",
          "old_line_content": "",
          "new_line_content": "\t\t\ttok = core_yylex(&yylval, &yylloc, yyscanner);",
          "content_same": false
        },
        {
          "line": 1939,
          "old_api": null,
          "new_api": "Float8GetDatumFast",
          "old_text": null,
          "new_text": "Float8GetDatumFast(tmp.temp_blk_read_time)",
          "old_line_content": "\t\t\tchar\t\tbuf[256];",
          "new_line_content": "\t\t\tvalues[i++] = Float8GetDatumFast(tmp.temp_blk_read_time);",
          "content_same": false
        },
        {
          "line": 1940,
          "old_api": null,
          "new_api": "Float8GetDatumFast",
          "old_text": null,
          "new_text": "Float8GetDatumFast(tmp.temp_blk_write_time)",
          "old_line_content": "\t\t\tDatum\t\twal_bytes;",
          "new_line_content": "\t\t\tvalues[i++] = Float8GetDatumFast(tmp.temp_blk_write_time);",
          "content_same": false
        },
        {
          "line": 1947,
          "old_api": null,
          "new_api": "Int64GetDatumFast",
          "old_text": null,
          "new_text": "Int64GetDatumFast(tmp.wal_records)",
          "old_line_content": "\t\t\t/* Convert to numeric. */",
          "new_line_content": "\t\t\tvalues[i++] = Int64GetDatumFast(tmp.wal_records);",
          "content_same": false
        },
        {
          "line": 1953,
          "old_api": null,
          "new_api": "DirectFunctionCall3",
          "old_text": null,
          "new_text": "DirectFunctionCall3(numeric_in,\n\t\t\t\t\t\t\t\t\t\t\tCStringGetDatum(buf),\n\t\t\t\t\t\t\t\t\t\t\tObjectIdGetDatum(0),\n\t\t\t\t\t\t\t\t\t\t\tInt32GetDatum(-1))",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\t\twal_bytes = DirectFunctionCall3(numeric_in,",
          "content_same": false
        },
        {
          "line": 1954,
          "old_api": null,
          "new_api": "CStringGetDatum",
          "old_text": null,
          "new_text": "CStringGetDatum(buf)",
          "old_line_content": "\t\tif (api_version >= PGSS_V1_10)",
          "new_line_content": "\t\t\t\t\t\t\t\t\t\t\tCStringGetDatum(buf),",
          "content_same": false
        },
        {
          "line": 1955,
          "old_api": null,
          "new_api": "ObjectIdGetDatum",
          "old_text": null,
          "new_text": "ObjectIdGetDatum(0)",
          "old_line_content": "\t\t{",
          "new_line_content": "\t\t\t\t\t\t\t\t\t\t\tObjectIdGetDatum(0),",
          "content_same": false
        },
        {
          "line": 2980,
          "old_api": null,
          "new_api": "core_yylex",
          "old_text": null,
          "new_text": "core_yylex(&yylval, &yylloc, yyscanner)",
          "old_line_content": "\t\t\t\t/*",
          "new_line_content": "\t\t\t\t\ttok = core_yylex(&yylval, &yylloc, yyscanner);",
          "content_same": false
        },
        {
          "line": 1964,
          "old_api": null,
          "new_api": "Float8GetDatumFast",
          "old_text": null,
          "new_text": "Float8GetDatumFast(tmp.jit_inlining_time)",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\t\tvalues[i++] = Float8GetDatumFast(tmp.jit_inlining_time);",
          "content_same": false
        },
        {
          "line": 2989,
          "old_api": null,
          "new_api": "strlen",
          "old_text": null,
          "new_text": "strlen(yyextra.scanbuf + loc)",
          "old_line_content": "\t\t/* If we hit end-of-string, give up, leaving remaining lengths -1 */",
          "new_line_content": "\t\t\t\tlocs[i].length = strlen(yyextra.scanbuf + loc);",
          "content_same": false
        },
        {
          "line": 1965,
          "old_api": null,
          "new_api": "Int64GetDatumFast",
          "old_text": null,
          "new_text": "Int64GetDatumFast(tmp.jit_optimization_count)",
          "old_line_content": "\t\tif (api_version >= PGSS_V1_11)",
          "new_line_content": "\t\t\tvalues[i++] = Int64GetDatumFast(tmp.jit_optimization_count);",
          "content_same": false
        },
        {
          "line": 1966,
          "old_api": null,
          "new_api": "Float8GetDatumFast",
          "old_text": null,
          "new_text": "Float8GetDatumFast(tmp.jit_optimization_time)",
          "old_line_content": "\t\t{",
          "new_line_content": "\t\t\tvalues[i++] = Float8GetDatumFast(tmp.jit_optimization_time);",
          "content_same": false
        },
        {
          "line": 2480,
          "old_api": null,
          "new_api": "need_gc_qtexts",
          "old_text": null,
          "new_text": "need_gc_qtexts()",
          "old_line_content": "\t * invalidate query texts.  Hopefully this is rare.  It might seem better",
          "new_line_content": "\tif (!need_gc_qtexts())",
          "content_same": false
        },
        {
          "line": 3001,
          "old_api": null,
          "new_api": "scanner_finish",
          "old_text": null,
          "new_text": "scanner_finish(yyscanner)",
          "old_line_content": " */",
          "new_line_content": "\tscanner_finish(yyscanner);",
          "content_same": false
        },
        {
          "line": 2490,
          "old_api": null,
          "new_api": "qtext_load_file",
          "old_text": null,
          "new_text": "qtext_load_file(&qbuffer_size)",
          "old_line_content": "\t * We overwrite the query texts file in place, so as to reduce the risk of",
          "new_line_content": "\tqbuffer = qtext_load_file(&qbuffer_size);",
          "content_same": false
        },
        {
          "line": 1982,
          "old_api": null,
          "new_api": "TimestampTzGetDatum",
          "old_text": null,
          "new_text": "TimestampTzGetDatum(stats_since)",
          "old_line_content": "\t\t\t\t\t api_version == PGSS_V1_1 ? PG_STAT_STATEMENTS_COLS_V1_1 :",
          "new_line_content": "\t\t\tvalues[i++] = TimestampTzGetDatum(stats_since);",
          "content_same": false
        },
        {
          "line": 1983,
          "old_api": null,
          "new_api": "TimestampTzGetDatum",
          "old_text": null,
          "new_text": "TimestampTzGetDatum(minmax_stats_since)",
          "old_line_content": "\t\t\t\t\t api_version == PGSS_V1_2 ? PG_STAT_STATEMENTS_COLS_V1_2 :",
          "new_line_content": "\t\t\tvalues[i++] = TimestampTzGetDatum(minmax_stats_since);",
          "content_same": false
        },
        {
          "line": 1986,
          "old_api": null,
          "new_api": "Assert",
          "old_text": null,
          "new_text": "Assert(i == (api_version == PGSS_V1_0 ? PG_STAT_STATEMENTS_COLS_V1_0 :\n\t\t\t\t\t api_version == PGSS_V1_1 ? PG_STAT_STATEMENTS_COLS_V1_1 :\n\t\t\t\t\t api_version == PGSS_V1_2 ? PG_STAT_STATEMENTS_COLS_V1_2 :\n\t\t\t\t\t api_version == PGSS_V1_3 ? PG_STAT_STATEMENTS_COLS_V1_3 :\n\t\t\t\t\t api_version == PGSS_V1_8 ? PG_STAT_STATEMENTS_COLS_V1_8 :\n\t\t\t\t\t api_version == PGSS_V1_9 ? PG_STAT_STATEMENTS_COLS_V1_9 :\n\t\t\t\t\t api_version == PGSS_V1_10 ? PG_STAT_STATEMENTS_COLS_V1_10 :\n\t\t\t\t\t api_version == PGSS_V1_11 ? PG_STAT_STATEMENTS_COLS_V1_11 :\n\t\t\t\t\t api_version == PGSS_V1_12 ? PG_STAT_STATEMENTS_COLS_V1_12 :\n\t\t\t\t\t -1 /* fail if you forget to update this assert */ ))",
          "old_line_content": "\t\t\t\t\t api_version == PGSS_V1_9 ? PG_STAT_STATEMENTS_COLS_V1_9 :",
          "new_line_content": "\t\tAssert(i == (api_version == PGSS_V1_0 ? PG_STAT_STATEMENTS_COLS_V1_0 :",
          "content_same": false
        },
        {
          "line": 3013,
          "old_api": null,
          "new_api": "pg_cmp_s32",
          "old_text": null,
          "new_text": "pg_cmp_s32(l, r)",
          "old_line_content": "",
          "new_line_content": "\treturn pg_cmp_s32(l, r);",
          "content_same": false
        },
        {
          "line": 2503,
          "old_api": null,
          "new_api": "ereport",
          "old_text": null,
          "new_text": "ereport(LOG,\n\t\t\t\t(errcode_for_file_access(),\n\t\t\t\t errmsg(\"could not write file \\\"%s\\\": %m\",\n\t\t\t\t\t\tPGSS_TEXT_FILE)))",
          "old_line_content": "\t}",
          "new_line_content": "\t\tereport(LOG,",
          "content_same": false
        },
        {
          "line": 2504,
          "old_api": null,
          "new_api": "errcode_for_file_access",
          "old_text": null,
          "new_text": "errcode_for_file_access()",
          "old_line_content": "",
          "new_line_content": "\t\t\t\t(errcode_for_file_access(),",
          "content_same": false
        },
        {
          "line": 2505,
          "old_api": null,
          "new_api": "errmsg",
          "old_text": null,
          "new_text": "errmsg(\"could not write file \\\"%s\\\": %m\",\n\t\t\t\t\t\tPGSS_TEXT_FILE)",
          "old_line_content": "\textent = 0;",
          "new_line_content": "\t\t\t\t errmsg(\"could not write file \\\"%s\\\": %m\",",
          "content_same": false
        },
        {
          "line": 2000,
          "old_api": null,
          "new_api": "LWLockRelease",
          "old_text": null,
          "new_text": "LWLockRelease(pgss->lock)",
          "old_line_content": "/* Number of output arguments (columns) for pg_stat_statements_info */",
          "new_line_content": "\tLWLockRelease(pgss->lock);",
          "content_same": false
        },
        {
          "line": 2513,
          "old_api": null,
          "new_api": "hash_seq_init",
          "old_text": null,
          "new_text": "hash_seq_init(&hash_seq, pgss_hash)",
          "old_line_content": "\t\t\t\t\t\t\t\t\t  query_len,",
          "new_line_content": "\thash_seq_init(&hash_seq, pgss_hash);",
          "content_same": false
        },
        {
          "line": 2514,
          "old_api": null,
          "new_api": "hash_seq_search",
          "old_text": null,
          "new_text": "hash_seq_search(&hash_seq)",
          "old_line_content": "\t\t\t\t\t\t\t\t\t  qbuffer,",
          "new_line_content": "\twhile ((entry = hash_seq_search(&hash_seq)) != NULL)",
          "content_same": false
        },
        {
          "line": 2002,
          "old_api": null,
          "new_api": "free",
          "old_text": null,
          "new_text": "free(qbuffer)",
          "old_line_content": "",
          "new_line_content": "\tfree(qbuffer);",
          "content_same": false
        },
        {
          "line": 2517,
          "old_api": null,
          "new_api": "qtext_fetch",
          "old_text": null,
          "new_text": "qtext_fetch(entry->query_offset,\n\t\t\t\t\t\t\t\t\t  query_len,\n\t\t\t\t\t\t\t\t\t  qbuffer,\n\t\t\t\t\t\t\t\t\t  qbuffer_size)",
          "old_line_content": "\t\tif (qry == NULL)",
          "new_line_content": "\t\tchar\t   *qry = qtext_fetch(entry->query_offset,",
          "content_same": false
        },
        {
          "line": 2531,
          "old_api": null,
          "new_api": "fwrite",
          "old_text": null,
          "new_text": "fwrite(qry, 1, query_len + 1, qfile)",
          "old_line_content": "\t\t\t\t\t\t\tPGSS_TEXT_FILE)));",
          "new_line_content": "\t\tif (fwrite(qry, 1, query_len + 1, qfile) != query_len + 1)",
          "content_same": false
        },
        {
          "line": 2533,
          "old_api": null,
          "new_api": "ereport",
          "old_text": null,
          "new_text": "ereport(LOG,\n\t\t\t\t\t(errcode_for_file_access(),\n\t\t\t\t\t errmsg(\"could not write file \\\"%s\\\": %m\",\n\t\t\t\t\t\t\tPGSS_TEXT_FILE)))",
          "old_line_content": "\t\t\tgoto gc_fail;",
          "new_line_content": "\t\t\tereport(LOG,",
          "content_same": false
        },
        {
          "line": 2534,
          "old_api": null,
          "new_api": "errcode_for_file_access",
          "old_text": null,
          "new_text": "errcode_for_file_access()",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\t\t\t\t(errcode_for_file_access(),",
          "content_same": false
        },
        {
          "line": 2535,
          "old_api": null,
          "new_api": "errmsg",
          "old_text": null,
          "new_text": "errmsg(\"could not write file \\\"%s\\\": %m\",\n\t\t\t\t\t\t\tPGSS_TEXT_FILE)",
          "old_line_content": "",
          "new_line_content": "\t\t\t\t\t errmsg(\"could not write file \\\"%s\\\": %m\",",
          "content_same": false
        },
        {
          "line": 2022,
          "old_api": null,
          "new_api": "errmsg",
          "old_text": null,
          "new_text": "errmsg(\"pg_stat_statements must be loaded via \\\"shared_preload_libraries\\\"\")",
          "old_line_content": "",
          "new_line_content": "\t\t\t\t errmsg(\"pg_stat_statements must be loaded via \\\"shared_preload_libraries\\\"\")));",
          "content_same": false
        },
        {
          "line": 2537,
          "old_api": null,
          "new_api": "hash_seq_term",
          "old_text": null,
          "new_text": "hash_seq_term(&hash_seq)",
          "old_line_content": "\t\textent += query_len + 1;",
          "new_line_content": "\t\t\thash_seq_term(&hash_seq);",
          "content_same": false
        },
        {
          "line": 2025,
          "old_api": null,
          "new_api": "get_call_result_type",
          "old_text": null,
          "new_text": "get_call_result_type(fcinfo, NULL, &tupdesc)",
          "old_line_content": "\tstats = pgss->stats;",
          "new_line_content": "\tif (get_call_result_type(fcinfo, NULL, &tupdesc) != TYPEFUNC_COMPOSITE)",
          "content_same": false
        },
        {
          "line": 2033,
          "old_api": null,
          "new_api": "Int64GetDatum",
          "old_text": null,
          "new_text": "Int64GetDatum(stats.dealloc)",
          "old_line_content": "",
          "new_line_content": "\tvalues[0] = Int64GetDatum(stats.dealloc);",
          "content_same": false
        },
        {
          "line": 2034,
          "old_api": null,
          "new_api": "TimestampTzGetDatum",
          "old_text": null,
          "new_text": "TimestampTzGetDatum(stats.stats_reset)",
          "old_line_content": "/*",
          "new_line_content": "\tvalues[1] = TimestampTzGetDatum(stats.stats_reset);",
          "content_same": false
        },
        {
          "line": 2036,
          "old_api": null,
          "new_api": "heap_form_tuple",
          "old_text": null,
          "new_text": "heap_form_tuple(tupdesc, values, nulls)",
          "old_line_content": " */",
          "new_line_content": "\tPG_RETURN_DATUM(HeapTupleGetDatum(heap_form_tuple(tupdesc, values, nulls)));",
          "content_same": false
        },
        {
          "line": 2550,
          "old_api": null,
          "new_api": "fileno",
          "old_text": null,
          "new_text": "fileno(qfile)",
          "old_line_content": "",
          "new_line_content": "\tif (ftruncate(fileno(qfile), extent) != 0)",
          "content_same": false
        },
        {
          "line": 2552,
          "old_api": null,
          "new_api": "errcode_for_file_access",
          "old_text": null,
          "new_text": "errcode_for_file_access()",
          "old_line_content": "\t{",
          "new_line_content": "\t\t\t\t(errcode_for_file_access(),",
          "content_same": false
        },
        {
          "line": 2556,
          "old_api": null,
          "new_api": "FreeFile",
          "old_text": null,
          "new_text": "FreeFile(qfile)",
          "old_line_content": "\t\t\t\t\t\tPGSS_TEXT_FILE)));",
          "new_line_content": "\tif (FreeFile(qfile))",
          "content_same": false
        },
        {
          "line": 2558,
          "old_api": null,
          "new_api": "ereport",
          "old_text": null,
          "new_text": "ereport(LOG,\n\t\t\t\t(errcode_for_file_access(),\n\t\t\t\t errmsg(\"could not write file \\\"%s\\\": %m\",\n\t\t\t\t\t\tPGSS_TEXT_FILE)))",
          "old_line_content": "\t\tgoto gc_fail;",
          "new_line_content": "\t\tereport(LOG,",
          "content_same": false
        },
        {
          "line": 2559,
          "old_api": null,
          "new_api": "errcode_for_file_access",
          "old_text": null,
          "new_text": "errcode_for_file_access()",
          "old_line_content": "\t}",
          "new_line_content": "\t\t\t\t(errcode_for_file_access(),",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 2561,
          "old_api": "elog",
          "new_api": null,
          "old_text": "elog(DEBUG1, \"pgss gc of queries file shrunk size from %zu to %zu\",\n\t\t pgss->extent, extent)",
          "new_text": null,
          "old_line_content": "\telog(DEBUG1, \"pgss gc of queries file shrunk size from %zu to %zu\",",
          "new_line_content": "\t\t\t\t\t\tPGSS_TEXT_FILE)));",
          "content_same": false
        },
        {
          "line": 2576,
          "old_api": "free",
          "new_api": null,
          "old_text": "free(qbuffer)",
          "new_text": null,
          "old_line_content": "\tfree(qbuffer);",
          "new_line_content": "\tif (nentries > 0)",
          "content_same": false
        },
        {
          "line": 2073,
          "old_api": "hash_get_num_entries",
          "new_api": null,
          "old_text": "hash_get_num_entries(pgss_hash)",
          "new_text": null,
          "old_line_content": "\twhile (hash_get_num_entries(pgss_hash) >= pgss_max)",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 2074,
          "old_api": "entry_dealloc",
          "new_api": null,
          "old_text": "entry_dealloc()",
          "new_text": null,
          "old_line_content": "\t\tentry_dealloc();",
          "new_line_content": "\tpgssEntry  *entry;",
          "content_same": false
        },
        {
          "line": 2585,
          "old_api": "record_gc_qtexts",
          "new_api": null,
          "old_text": "record_gc_qtexts()",
          "new_text": null,
          "old_line_content": "\trecord_gc_qtexts();",
          "new_line_content": "\t * exclusive lock on pgss->lock, we must take pgss->mutex for this, since",
          "content_same": false
        },
        {
          "line": 2077,
          "old_api": "hash_search",
          "new_api": null,
          "old_text": "hash_search(pgss_hash, key, HASH_ENTER, &found)",
          "new_text": null,
          "old_line_content": "\tentry = (pgssEntry *) hash_search(pgss_hash, key, HASH_ENTER, &found);",
          "new_line_content": "\t/* Make space if needed */",
          "content_same": false
        },
        {
          "line": 2592,
          "old_api": "FreeFile",
          "new_api": null,
          "old_text": "FreeFile(qfile)",
          "new_text": null,
          "old_line_content": "\t\tFreeFile(qfile);",
          "new_line_content": "\treturn;",
          "content_same": false
        },
        {
          "line": 2593,
          "old_api": "free",
          "new_api": null,
          "old_text": "free(qbuffer)",
          "new_text": null,
          "old_line_content": "\tfree(qbuffer);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2042,
          "old_api": "MAXALIGN",
          "new_api": null,
          "old_text": "MAXALIGN(sizeof(pgssSharedState))",
          "new_text": null,
          "old_line_content": "\tsize = MAXALIGN(sizeof(pgssSharedState));",
          "new_line_content": "static Size",
          "content_same": false
        },
        {
          "line": 2084,
          "old_api": "memset",
          "new_api": null,
          "old_text": "memset(&entry->counters, 0, sizeof(Counters))",
          "new_text": null,
          "old_line_content": "\t\tmemset(&entry->counters, 0, sizeof(Counters));",
          "new_line_content": "\tif (!found)",
          "content_same": false
        },
        {
          "line": 2599,
          "old_api": "hash_seq_init",
          "new_api": null,
          "old_text": "hash_seq_init(&hash_seq, pgss_hash)",
          "new_text": null,
          "old_line_content": "\thash_seq_init(&hash_seq, pgss_hash);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2088,
          "old_api": "SpinLockInit",
          "new_api": null,
          "old_text": "SpinLockInit(&entry->mutex)",
          "new_text": null,
          "old_line_content": "\t\tSpinLockInit(&entry->mutex);",
          "new_line_content": "\t\t/* reset the statistics */",
          "content_same": false
        },
        {
          "line": 2600,
          "old_api": "hash_seq_search",
          "new_api": null,
          "old_text": "hash_seq_search(&hash_seq)",
          "new_text": null,
          "old_line_content": "\twhile ((entry = hash_seq_search(&hash_seq)) != NULL)",
          "new_line_content": "\t/*",
          "content_same": false
        },
        {
          "line": 2090,
          "old_api": "Assert",
          "new_api": null,
          "old_text": "Assert(query_len >= 0)",
          "new_text": null,
          "old_line_content": "\t\tAssert(query_len >= 0);",
          "new_line_content": "\t\t/* set the appropriate initial usage count */",
          "content_same": false
        },
        {
          "line": 2043,
          "old_api": "hash_estimate_size",
          "new_api": null,
          "old_text": "hash_estimate_size(pgss_max, sizeof(pgssEntry))",
          "new_text": null,
          "old_line_content": "\tsize = add_size(size, hash_estimate_size(pgss_max, sizeof(pgssEntry)));",
          "new_line_content": "pgss_memsize(void)",
          "content_same": false
        },
        {
          "line": 2094,
          "old_api": "GetCurrentTimestamp",
          "new_api": null,
          "old_text": "GetCurrentTimestamp()",
          "new_text": null,
          "old_line_content": "\t\tentry->stats_since = GetCurrentTimestamp();",
          "new_line_content": "\t\t/* ... and don't forget the query text metadata */",
          "content_same": false
        },
        {
          "line": 2609,
          "old_api": "unlink",
          "new_api": null,
          "old_text": "unlink(PGSS_TEXT_FILE)",
          "new_text": null,
          "old_line_content": "\t(void) unlink(PGSS_TEXT_FILE);",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 2610,
          "old_api": "AllocateFile",
          "new_api": null,
          "old_text": "AllocateFile(PGSS_TEXT_FILE, PG_BINARY_W)",
          "new_text": null,
          "old_line_content": "\tqfile = AllocateFile(PGSS_TEXT_FILE, PG_BINARY_W);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2612,
          "old_api": "ereport",
          "new_api": null,
          "old_text": "ereport(LOG,\n\t\t\t\t(errcode_for_file_access(),\n\t\t\t\t errmsg(\"could not recreate file \\\"%s\\\": %m\",\n\t\t\t\t\t\tPGSS_TEXT_FILE)))",
          "new_text": null,
          "old_line_content": "\t\tereport(LOG,",
          "new_line_content": "\t * Destroy the query text file and create a new, empty one",
          "content_same": false
        },
        {
          "line": 2613,
          "old_api": "errcode_for_file_access",
          "new_api": null,
          "old_text": "errcode_for_file_access()",
          "new_text": null,
          "old_line_content": "\t\t\t\t(errcode_for_file_access(),",
          "new_line_content": "\t */",
          "content_same": false
        },
        {
          "line": 2636,
          "old_api": "record_gc_qtexts",
          "new_api": null,
          "old_text": "record_gc_qtexts()",
          "new_text": null,
          "old_line_content": "\trecord_gc_qtexts();",
          "new_line_content": "\t * forces a safe reopen of file.  Writers also require that we bump here,",
          "content_same": false
        },
        {
          "line": 2653,
          "old_api": "hash_search",
          "new_api": null,
          "old_text": "hash_search(pgss_hash, &e->key, HASH_REMOVE, NULL)",
          "new_text": null,
          "old_line_content": "\t\thash_search(pgss_hash, &e->key, HASH_REMOVE, NULL); \\",
          "new_line_content": "\t\te->minmax_stats_since = stats_reset; \\",
          "content_same": false
        },
        {
          "line": 2146,
          "old_api": "hash_get_num_entries",
          "new_api": null,
          "old_text": "hash_get_num_entries(pgss_hash)",
          "new_text": null,
          "old_line_content": "\tentries = palloc(hash_get_num_entries(pgss_hash) * sizeof(pgssEntry *));",
          "new_line_content": "\t * Hopefully, that doesn't affect the mean too much; it doesn't seem worth",
          "content_same": false
        },
        {
          "line": 2152,
          "old_api": "hash_seq_init",
          "new_api": null,
          "old_text": "hash_seq_init(&hash_seq, pgss_hash)",
          "new_text": null,
          "old_line_content": "\thash_seq_init(&hash_seq, pgss_hash);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2153,
          "old_api": "hash_seq_search",
          "new_api": null,
          "old_text": "hash_seq_search(&hash_seq)",
          "new_text": null,
          "old_line_content": "\twhile ((entry = hash_seq_search(&hash_seq)) != NULL)",
          "new_line_content": "\ti = 0;",
          "content_same": false
        },
        {
          "line": 2673,
          "old_api": "ereport",
          "new_api": null,
          "old_text": "ereport(ERROR,\n\t\t\t\t(errcode(ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE),\n\t\t\t\t errmsg(\"pg_stat_statements must be loaded via \\\"shared_preload_libraries\\\"\")))",
          "new_text": null,
          "old_line_content": "\t\tereport(ERROR,",
          "new_line_content": "\tlong\t\tnum_remove = 0;",
          "content_same": false
        },
        {
          "line": 2674,
          "old_api": "errcode",
          "new_api": null,
          "old_text": "errcode(ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE)",
          "new_text": null,
          "old_line_content": "\t\t\t\t(errcode(ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE),",
          "new_line_content": "\tpgssHashKey key;",
          "content_same": false
        },
        {
          "line": 2675,
          "old_api": "errmsg",
          "new_api": null,
          "old_text": "errmsg(\"pg_stat_statements must be loaded via \\\"shared_preload_libraries\\\"\")",
          "new_text": null,
          "old_line_content": "\t\t\t\t errmsg(\"pg_stat_statements must be loaded via \\\"shared_preload_libraries\\\"\")));",
          "new_line_content": "\tTimestampTz stats_reset;",
          "content_same": false
        },
        {
          "line": 2677,
          "old_api": "LWLockAcquire",
          "new_api": null,
          "old_text": "LWLockAcquire(pgss->lock, LW_EXCLUSIVE)",
          "new_text": null,
          "old_line_content": "\tLWLockAcquire(pgss->lock, LW_EXCLUSIVE);",
          "new_line_content": "\tif (!pgss || !pgss_hash)",
          "content_same": false
        },
        {
          "line": 2170,
          "old_api": "qsort",
          "new_api": null,
          "old_text": "qsort(entries, i, sizeof(pgssEntry *), entry_cmp)",
          "new_text": null,
          "old_line_content": "\tqsort(entries, i, sizeof(pgssEntry *), entry_cmp);",
          "new_line_content": "\t\t\tnvalidtexts++;",
          "content_same": false
        },
        {
          "line": 2182,
          "old_api": "Max",
          "new_api": null,
          "old_text": "Max(10, i * USAGE_DEALLOC_PERCENT / 100)",
          "new_text": null,
          "old_line_content": "\tnvictims = Max(10, i * USAGE_DEALLOC_PERCENT / 100);",
          "new_line_content": "\t\tpgss->mean_query_len = tottextlen / nvalidtexts;",
          "content_same": false
        },
        {
          "line": 2183,
          "old_api": "Min",
          "new_api": null,
          "old_text": "Min(nvictims, i)",
          "new_text": null,
          "old_line_content": "\tnvictims = Min(nvictims, i);",
          "new_line_content": "\telse",
          "content_same": false
        },
        {
          "line": 2695,
          "old_api": "hash_search",
          "new_api": null,
          "old_text": "hash_search(pgss_hash, &key, HASH_FIND, NULL)",
          "new_text": null,
          "old_line_content": "\t\tentry = (pgssEntry *) hash_search(pgss_hash, &key, HASH_FIND, NULL);",
          "new_line_content": "\t\t/*",
          "content_same": false
        },
        {
          "line": 2697,
          "old_api": "SINGLE_ENTRY_RESET",
          "new_api": null,
          "old_text": "SINGLE_ENTRY_RESET(entry)",
          "new_text": null,
          "old_line_content": "\t\tSINGLE_ENTRY_RESET(entry);",
          "new_line_content": "\t\t * entry.",
          "content_same": false
        },
        {
          "line": 2701,
          "old_api": "hash_search",
          "new_api": null,
          "old_text": "hash_search(pgss_hash, &key, HASH_FIND, NULL)",
          "new_text": null,
          "old_line_content": "\t\tentry = (pgssEntry *) hash_search(pgss_hash, &key, HASH_FIND, NULL);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2190,
          "old_api": "pfree",
          "new_api": null,
          "old_text": "pfree(entries)",
          "new_text": null,
          "old_line_content": "\tpfree(entries);",
          "new_line_content": "\tfor (i = 0; i < nvictims; i++)",
          "content_same": false
        },
        {
          "line": 2703,
          "old_api": "SINGLE_ENTRY_RESET",
          "new_api": null,
          "old_text": "SINGLE_ENTRY_RESET(entry)",
          "new_text": null,
          "old_line_content": "\t\tSINGLE_ENTRY_RESET(entry);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2193,
          "old_api": "SpinLockAcquire",
          "new_api": null,
          "old_text": "SpinLockAcquire(&pgss->mutex)",
          "new_text": null,
          "old_line_content": "\tSpinLockAcquire(&pgss->mutex);",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 2705,
          "old_api": "UINT64CONST",
          "new_api": null,
          "old_text": "UINT64CONST(0)",
          "new_text": null,
          "old_line_content": "\telse if (userid != 0 || dbid != 0 || queryid != UINT64CONST(0))",
          "new_line_content": "\t\tkey.toplevel = true;",
          "content_same": false
        },
        {
          "line": 2709,
          "old_api": "hash_seq_search",
          "new_api": null,
          "old_text": "hash_seq_search(&hash_seq)",
          "new_text": null,
          "old_line_content": "\t\twhile ((entry = hash_seq_search(&hash_seq)) != NULL)",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 2715,
          "old_api": "SINGLE_ENTRY_RESET",
          "new_api": null,
          "old_text": "SINGLE_ENTRY_RESET(entry)",
          "new_text": null,
          "old_line_content": "\t\t\t\tSINGLE_ENTRY_RESET(entry);",
          "new_line_content": "\t\t{",
          "content_same": false
        },
        {
          "line": 2722,
          "old_api": "hash_seq_init",
          "new_api": null,
          "old_text": "hash_seq_init(&hash_seq, pgss_hash)",
          "new_text": null,
          "old_line_content": "\t\thash_seq_init(&hash_seq, pgss_hash);",
          "new_line_content": "\t\t}",
          "content_same": false
        },
        {
          "line": 2723,
          "old_api": "hash_seq_search",
          "new_api": null,
          "old_text": "hash_seq_search(&hash_seq)",
          "new_text": null,
          "old_line_content": "\t\twhile ((entry = hash_seq_search(&hash_seq)) != NULL)",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 2725,
          "old_api": "SINGLE_ENTRY_RESET",
          "new_api": null,
          "old_text": "SINGLE_ENTRY_RESET(entry)",
          "new_text": null,
          "old_line_content": "\t\t\tSINGLE_ENTRY_RESET(entry);",
          "new_line_content": "\t{",
          "content_same": false
        },
        {
          "line": 2225,
          "old_api": "SpinLockAcquire",
          "new_api": null,
          "old_text": "SpinLockAcquire(&pgss->mutex)",
          "new_text": null,
          "old_line_content": "\tSpinLockAcquire(&pgss->mutex);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2737,
          "old_api": "SpinLockAcquire",
          "new_api": null,
          "old_text": "SpinLockAcquire(&pgss->mutex)",
          "new_text": null,
          "old_line_content": "\tSpinLockAcquire(&pgss->mutex);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2740,
          "old_api": "SpinLockRelease",
          "new_api": null,
          "old_text": "SpinLockRelease(&pgss->mutex)",
          "new_text": null,
          "old_line_content": "\tSpinLockRelease(&pgss->mutex);",
          "new_line_content": "\t * removed.",
          "content_same": false
        },
        {
          "line": 2231,
          "old_api": "SpinLockRelease",
          "new_api": null,
          "old_text": "SpinLockRelease(&pgss->mutex)",
          "new_text": null,
          "old_line_content": "\tSpinLockRelease(&pgss->mutex);",
          "new_line_content": "\toff = pgss->extent;",
          "content_same": false
        },
        {
          "line": 2746,
          "old_api": "AllocateFile",
          "new_api": null,
          "old_text": "AllocateFile(PGSS_TEXT_FILE, PG_BINARY_W)",
          "new_text": null,
          "old_line_content": "\tqfile = AllocateFile(PGSS_TEXT_FILE, PG_BINARY_W);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2749,
          "old_api": "ereport",
          "new_api": null,
          "old_text": "ereport(LOG,\n\t\t\t\t(errcode_for_file_access(),\n\t\t\t\t errmsg(\"could not create file \\\"%s\\\": %m\",\n\t\t\t\t\t\tPGSS_TEXT_FILE)))",
          "new_text": null,
          "old_line_content": "\t\tereport(LOG,",
          "new_line_content": "\t * if the file was missing.",
          "content_same": false
        },
        {
          "line": 2750,
          "old_api": "errcode_for_file_access",
          "new_api": null,
          "old_text": "errcode_for_file_access()",
          "new_text": null,
          "old_line_content": "\t\t\t\t(errcode_for_file_access(),",
          "new_line_content": "\t */",
          "content_same": false
        },
        {
          "line": 2240,
          "old_api": "unlikely",
          "new_api": null,
          "old_text": "unlikely(query_len >= MaxAllocHugeSize - off)",
          "new_text": null,
          "old_line_content": "\tif (unlikely(query_len >= MaxAllocHugeSize - off))",
          "new_line_content": "\t/*",
          "content_same": false
        },
        {
          "line": 2757,
          "old_api": "fileno",
          "new_api": null,
          "old_text": "fileno(qfile)",
          "new_text": null,
          "old_line_content": "\tif (ftruncate(fileno(qfile), 0) != 0)",
          "new_line_content": "\t\t\t\t\t\tPGSS_TEXT_FILE)));",
          "content_same": false
        },
        {
          "line": 2758,
          "old_api": "ereport",
          "new_api": null,
          "old_text": "ereport(LOG,\n\t\t\t\t(errcode_for_file_access(),\n\t\t\t\t errmsg(\"could not truncate file \\\"%s\\\": %m\",\n\t\t\t\t\t\tPGSS_TEXT_FILE)))",
          "new_text": null,
          "old_line_content": "\t\tereport(LOG,",
          "new_line_content": "\t\tgoto done;",
          "content_same": false
        },
        {
          "line": 2759,
          "old_api": "errcode_for_file_access",
          "new_api": null,
          "old_text": "errcode_for_file_access()",
          "new_text": null,
          "old_line_content": "\t\t\t\t(errcode_for_file_access(),",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 2248,
          "old_api": "OpenTransientFile",
          "new_api": null,
          "old_text": "OpenTransientFile(PGSS_TEXT_FILE, O_RDWR | O_CREAT | PG_BINARY)",
          "new_text": null,
          "old_line_content": "\tfd = OpenTransientFile(PGSS_TEXT_FILE, O_RDWR | O_CREAT | PG_BINARY);",
          "new_line_content": "\t\tfd = -1;",
          "content_same": false
        },
        {
          "line": 2760,
          "old_api": "errmsg",
          "new_api": null,
          "old_text": "errmsg(\"could not truncate file \\\"%s\\\": %m\",\n\t\t\t\t\t\tPGSS_TEXT_FILE)",
          "new_text": null,
          "old_line_content": "\t\t\t\t errmsg(\"could not truncate file \\\"%s\\\": %m\",",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2252,
          "old_api": "pg_pwrite",
          "new_api": null,
          "old_text": "pg_pwrite(fd, query, query_len, off)",
          "new_text": null,
          "old_line_content": "\tif (pg_pwrite(fd, query, query_len, off) != query_len)",
          "new_line_content": "\t/* Now write the data into the successfully-reserved part of the file */",
          "content_same": false
        },
        {
          "line": 2254,
          "old_api": "pg_pwrite",
          "new_api": null,
          "old_text": "pg_pwrite(fd, \"\\0\", 1, off + query_len)",
          "new_text": null,
          "old_line_content": "\tif (pg_pwrite(fd, \"\\0\", 1, off + query_len) != 1)",
          "new_line_content": "\tif (fd < 0)",
          "content_same": false
        },
        {
          "line": 2771,
          "old_api": "LWLockRelease",
          "new_api": null,
          "old_text": "LWLockRelease(pgss->lock)",
          "new_text": null,
          "old_line_content": "\tLWLockRelease(pgss->lock);",
          "new_line_content": "\tpgss->extent = 0;",
          "content_same": false
        },
        {
          "line": 2260,
          "old_api": "SpinLockAcquire",
          "new_api": null,
          "old_text": "SpinLockAcquire(&pgss->mutex)",
          "new_text": null,
          "old_line_content": "\tSpinLockAcquire(&pgss->mutex);",
          "new_line_content": "\t\tgoto error;",
          "content_same": false
        },
        {
          "line": 2268,
          "old_api": "errcode_for_file_access",
          "new_api": null,
          "old_text": "errcode_for_file_access()",
          "new_text": null,
          "old_line_content": "\t\t\t(errcode_for_file_access(),",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2269,
          "old_api": "errmsg",
          "new_api": null,
          "old_text": "errmsg(\"could not write file \\\"%s\\\": %m\",\n\t\t\t\t\tPGSS_TEXT_FILE)",
          "new_text": null,
          "old_line_content": "\t\t\t errmsg(\"could not write file \\\"%s\\\": %m\",",
          "new_line_content": "\treturn true;",
          "content_same": false
        },
        {
          "line": 2276,
          "old_api": "SpinLockAcquire",
          "new_api": null,
          "old_text": "SpinLockAcquire(&pgss->mutex)",
          "new_text": null,
          "old_line_content": "\tSpinLockAcquire(&pgss->mutex);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2813,
          "old_api": "fill_in_constant_lengths",
          "new_api": null,
          "old_text": "fill_in_constant_lengths(jstate, query, query_loc)",
          "new_text": null,
          "old_line_content": "\tfill_in_constant_lengths(jstate, query, query_loc);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2302,
          "old_api": "OpenTransientFile",
          "new_api": null,
          "old_text": "OpenTransientFile(PGSS_TEXT_FILE, O_RDONLY | PG_BINARY)",
          "new_text": null,
          "old_line_content": "\tfd = OpenTransientFile(PGSS_TEXT_FILE, O_RDONLY | PG_BINARY);",
          "new_line_content": "\tchar\t   *buf;",
          "content_same": false
        },
        {
          "line": 2306,
          "old_api": "ereport",
          "new_api": null,
          "old_text": "ereport(LOG,\n\t\t\t\t\t(errcode_for_file_access(),\n\t\t\t\t\t errmsg(\"could not read file \\\"%s\\\": %m\",\n\t\t\t\t\t\t\tPGSS_TEXT_FILE)))",
          "new_text": null,
          "old_line_content": "\t\t\tereport(LOG,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2308,
          "old_api": "errmsg",
          "new_api": null,
          "old_text": "errmsg(\"could not read file \\\"%s\\\": %m\",\n\t\t\t\t\t\t\tPGSS_TEXT_FILE)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\t errmsg(\"could not read file \\\"%s\\\": %m\",",
          "new_line_content": "\tif (fd < 0)",
          "content_same": false
        },
        {
          "line": 2825,
          "old_api": "palloc",
          "new_api": null,
          "old_text": "palloc(norm_query_buflen + 1)",
          "new_text": null,
          "old_line_content": "\tnorm_query = palloc(norm_query_buflen + 1);",
          "new_line_content": "\t * query, but it hardly seems worth any extra effort to do so.",
          "content_same": false
        },
        {
          "line": 2314,
          "old_api": "fstat",
          "new_api": null,
          "old_text": "fstat(fd, &stat)",
          "new_text": null,
          "old_line_content": "\tif (fstat(fd, &stat))",
          "new_line_content": "\t\t\t\t\t\t\tPGSS_TEXT_FILE)));",
          "content_same": false
        },
        {
          "line": 2316,
          "old_api": "ereport",
          "new_api": null,
          "old_text": "ereport(LOG,\n\t\t\t\t(errcode_for_file_access(),\n\t\t\t\t errmsg(\"could not stat file \\\"%s\\\": %m\",\n\t\t\t\t\t\tPGSS_TEXT_FILE)))",
          "new_text": null,
          "old_line_content": "\t\tereport(LOG,",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 2317,
          "old_api": "errcode_for_file_access",
          "new_api": null,
          "old_text": "errcode_for_file_access()",
          "new_text": null,
          "old_line_content": "\t\t\t\t(errcode_for_file_access(),",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2318,
          "old_api": "errmsg",
          "new_api": null,
          "old_text": "errmsg(\"could not stat file \\\"%s\\\": %m\",\n\t\t\t\t\t\tPGSS_TEXT_FILE)",
          "new_text": null,
          "old_line_content": "\t\t\t\t errmsg(\"could not stat file \\\"%s\\\": %m\",",
          "new_line_content": "\t/* Get file length */",
          "content_same": false
        },
        {
          "line": 2320,
          "old_api": "CloseTransientFile",
          "new_api": null,
          "old_text": "CloseTransientFile(fd)",
          "new_text": null,
          "old_line_content": "\t\tCloseTransientFile(fd);",
          "new_line_content": "\t{",
          "content_same": false
        },
        {
          "line": 2326,
          "old_api": "malloc",
          "new_api": null,
          "old_text": "malloc(stat.st_size)",
          "new_text": null,
          "old_line_content": "\t\tbuf = (char *) malloc(stat.st_size);",
          "new_line_content": "\t\treturn NULL;",
          "content_same": false
        },
        {
          "line": 2332,
          "old_api": "errcode",
          "new_api": null,
          "old_text": "errcode(ERRCODE_OUT_OF_MEMORY)",
          "new_text": null,
          "old_line_content": "\t\t\t\t(errcode(ERRCODE_OUT_OF_MEMORY),",
          "new_line_content": "\telse",
          "content_same": false
        },
        {
          "line": 2333,
          "old_api": "errmsg",
          "new_api": null,
          "old_text": "errmsg(\"out of memory\")",
          "new_text": null,
          "old_line_content": "\t\t\t\t errmsg(\"out of memory\"),",
          "new_line_content": "\t\tbuf = NULL;",
          "content_same": false
        },
        {
          "line": 2334,
          "old_api": "errdetail",
          "new_api": null,
          "old_text": "errdetail(\"Could not allocate enough memory to read file \\\"%s\\\".\",\n\t\t\t\t\t\t   PGSS_TEXT_FILE)",
          "new_text": null,
          "old_line_content": "\t\t\t\t errdetail(\"Could not allocate enough memory to read file \\\"%s\\\".\",",
          "new_line_content": "\tif (buf == NULL)",
          "content_same": false
        },
        {
          "line": 2845,
          "old_api": "Assert",
          "new_api": null,
          "old_text": "Assert(len_to_wrt >= 0)",
          "new_text": null,
          "old_line_content": "\t\tAssert(len_to_wrt >= 0);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2846,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(norm_query + n_quer_loc, query + quer_loc, len_to_wrt)",
          "new_text": null,
          "old_line_content": "\t\tmemcpy(norm_query + n_quer_loc, query + quer_loc, len_to_wrt);",
          "new_line_content": "\t\t/* Copy next chunk (what precedes the next constant) */",
          "content_same": false
        },
        {
          "line": 2348,
          "old_api": "Min",
          "new_api": null,
          "old_text": "Min(1024 * 1024 * 1024, stat.st_size - nread)",
          "new_text": null,
          "old_line_content": "\t\tint\t\t\ttoread = Min(1024 * 1024 * 1024, stat.st_size - nread);",
          "new_line_content": "\t * so read a very large file in 1GB segments.",
          "content_same": false
        },
        {
          "line": 2864,
          "old_api": "Assert",
          "new_api": null,
          "old_text": "Assert(len_to_wrt >= 0)",
          "new_text": null,
          "old_line_content": "\tAssert(len_to_wrt >= 0);",
          "new_line_content": "\t * We've copied up until the last ignorable constant.  Copy over the",
          "content_same": false
        },
        {
          "line": 2865,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(norm_query + n_quer_loc, query + quer_loc, len_to_wrt)",
          "new_text": null,
          "old_line_content": "\tmemcpy(norm_query + n_quer_loc, query + quer_loc, len_to_wrt);",
          "new_line_content": "\t * remaining bytes of the original query string.",
          "content_same": false
        },
        {
          "line": 2868,
          "old_api": "Assert",
          "new_api": null,
          "old_text": "Assert(n_quer_loc <= norm_query_buflen)",
          "new_text": null,
          "old_line_content": "\tAssert(n_quer_loc <= norm_query_buflen);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2358,
          "old_api": "read",
          "new_api": null,
          "old_text": "read(fd, buf + nread, toread)",
          "new_text": null,
          "old_line_content": "\t\tif (read(fd, buf + nread, toread) != toread)",
          "new_line_content": "\t\t * the fstat(), so we don't log a complaint --- but we don't return",
          "content_same": false
        },
        {
          "line": 2361,
          "old_api": "ereport",
          "new_api": null,
          "old_text": "ereport(LOG,\n\t\t\t\t\t\t(errcode_for_file_access(),\n\t\t\t\t\t\t errmsg(\"could not read file \\\"%s\\\": %m\",\n\t\t\t\t\t\t\t\tPGSS_TEXT_FILE)))",
          "new_text": null,
          "old_line_content": "\t\t\t\tereport(LOG,",
          "new_line_content": "\t\t */",
          "content_same": false
        },
        {
          "line": 2362,
          "old_api": "errcode_for_file_access",
          "new_api": null,
          "old_text": "errcode_for_file_access()",
          "new_text": null,
          "old_line_content": "\t\t\t\t\t\t(errcode_for_file_access(),",
          "new_line_content": "\t\terrno = 0;",
          "content_same": false
        },
        {
          "line": 2365,
          "old_api": "free",
          "new_api": null,
          "old_text": "free(buf)",
          "new_text": null,
          "old_line_content": "\t\t\tfree(buf);",
          "new_line_content": "\t\t\tif (errno)",
          "content_same": false
        },
        {
          "line": 2372,
          "old_api": "CloseTransientFile",
          "new_api": null,
          "old_text": "CloseTransientFile(fd)",
          "new_text": null,
          "old_line_content": "\tif (CloseTransientFile(fd) != 0)",
          "new_line_content": "\t\t\treturn NULL;",
          "content_same": false
        },
        {
          "line": 2373,
          "old_api": "ereport",
          "new_api": null,
          "old_text": "ereport(LOG,\n\t\t\t\t(errcode_for_file_access(),\n\t\t\t\t errmsg(\"could not close file \\\"%s\\\": %m\", PGSS_TEXT_FILE)))",
          "new_text": null,
          "old_line_content": "\t\tereport(LOG,",
          "new_line_content": "\t\t}",
          "content_same": false
        },
        {
          "line": 2374,
          "old_api": "errcode_for_file_access",
          "new_api": null,
          "old_text": "errcode_for_file_access()",
          "new_text": null,
          "old_line_content": "\t\t\t\t(errcode_for_file_access(),",
          "new_line_content": "\t\tnread += toread;",
          "content_same": false
        },
        {
          "line": 2375,
          "old_api": "errmsg",
          "new_api": null,
          "old_text": "errmsg(\"could not close file \\\"%s\\\": %m\", PGSS_TEXT_FILE)",
          "new_text": null,
          "old_line_content": "\t\t\t\t errmsg(\"could not close file \\\"%s\\\": %m\", PGSS_TEXT_FILE)));",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 1874,
          "old_api": "SpinLockRelease",
          "new_api": null,
          "old_text": "SpinLockRelease(&entry->mutex)",
          "new_text": null,
          "old_line_content": "\t\tSpinLockRelease(&entry->mutex);",
          "new_line_content": "\t\t/*",
          "content_same": false
        },
        {
          "line": 1877,
          "old_api": "IS_STICKY",
          "new_api": null,
          "old_text": "IS_STICKY(tmp)",
          "new_text": null,
          "old_line_content": "\t\tif (IS_STICKY(tmp))",
          "new_line_content": "\t\t */",
          "content_same": false
        },
        {
          "line": 1885,
          "old_api": "Int64GetDatumFast",
          "new_api": null,
          "old_text": "Int64GetDatumFast(tmp.calls[kind])",
          "new_text": null,
          "old_line_content": "\t\t\t\tvalues[i++] = Int64GetDatumFast(tmp.calls[kind]);",
          "new_line_content": "\t\t/* Note that we rely on PGSS_PLAN being 0 and PGSS_EXEC being 1. */",
          "content_same": false
        },
        {
          "line": 1886,
          "old_api": "Float8GetDatumFast",
          "new_api": null,
          "old_text": "Float8GetDatumFast(tmp.total_time[kind])",
          "new_text": null,
          "old_line_content": "\t\t\t\tvalues[i++] = Float8GetDatumFast(tmp.total_time[kind]);",
          "new_line_content": "\t\tfor (int kind = 0; kind < PGSS_NUMKIND; kind++)",
          "content_same": false
        },
        {
          "line": 1892,
          "old_api": "Float8GetDatumFast",
          "new_api": null,
          "old_text": "Float8GetDatumFast(tmp.min_time[kind])",
          "new_text": null,
          "old_line_content": "\t\t\t\tvalues[i++] = Float8GetDatumFast(tmp.min_time[kind]);",
          "new_line_content": "\t\t\t}",
          "content_same": false
        },
        {
          "line": 1893,
          "old_api": "Float8GetDatumFast",
          "new_api": null,
          "old_text": "Float8GetDatumFast(tmp.max_time[kind])",
          "new_text": null,
          "old_line_content": "\t\t\t\tvalues[i++] = Float8GetDatumFast(tmp.max_time[kind]);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1894,
          "old_api": "Float8GetDatumFast",
          "new_api": null,
          "old_text": "Float8GetDatumFast(tmp.mean_time[kind])",
          "new_text": null,
          "old_line_content": "\t\t\t\tvalues[i++] = Float8GetDatumFast(tmp.mean_time[kind]);",
          "new_line_content": "\t\t\tif ((kind == PGSS_EXEC && api_version >= PGSS_V1_3) ||",
          "content_same": false
        },
        {
          "line": 2919,
          "old_api": "qsort",
          "new_api": null,
          "old_text": "qsort(jstate->clocations, jstate->clocations_count,\n\t\t\t  sizeof(LocationLen), comp_location)",
          "new_text": null,
          "old_line_content": "\t\tqsort(jstate->clocations, jstate->clocations_count,",
          "new_line_content": "\t/*",
          "content_same": false
        },
        {
          "line": 1903,
          "old_api": "sqrt",
          "new_api": null,
          "old_text": "sqrt(tmp.sum_var_time[kind] / tmp.calls[kind])",
          "new_text": null,
          "old_line_content": "\t\t\t\t\tstddev = sqrt(tmp.sum_var_time[kind] / tmp.calls[kind]);",
          "new_line_content": "\t\t\t\t * the sample variance, as we have data for the whole",
          "content_same": false
        },
        {
          "line": 2416,
          "old_api": "SpinLockAcquire",
          "new_api": null,
          "old_text": "SpinLockAcquire(&pgss->mutex)",
          "new_text": null,
          "old_line_content": "\tSpinLockAcquire(&pgss->mutex);",
          "new_line_content": "need_gc_qtexts(void)",
          "content_same": false
        },
        {
          "line": 2418,
          "old_api": "SpinLockRelease",
          "new_api": null,
          "old_text": "SpinLockRelease(&pgss->mutex)",
          "new_text": null,
          "old_line_content": "\tSpinLockRelease(&pgss->mutex);",
          "new_line_content": "\tSize\t\textent;",
          "content_same": false
        },
        {
          "line": 1906,
          "old_api": "Float8GetDatumFast",
          "new_api": null,
          "old_text": "Float8GetDatumFast(stddev)",
          "new_text": null,
          "old_line_content": "\t\t\t\tvalues[i++] = Float8GetDatumFast(stddev);",
          "new_line_content": "\t\t\t\t */",
          "content_same": false
        },
        {
          "line": 1909,
          "old_api": "Int64GetDatumFast",
          "new_api": null,
          "old_text": "Int64GetDatumFast(tmp.rows)",
          "new_text": null,
          "old_line_content": "\t\tvalues[i++] = Int64GetDatumFast(tmp.rows);",
          "new_line_content": "\t\t\t\telse",
          "content_same": false
        },
        {
          "line": 1910,
          "old_api": "Int64GetDatumFast",
          "new_api": null,
          "old_text": "Int64GetDatumFast(tmp.shared_blks_hit)",
          "new_text": null,
          "old_line_content": "\t\tvalues[i++] = Int64GetDatumFast(tmp.shared_blks_hit);",
          "new_line_content": "\t\t\t\t\tstddev = 0.0;",
          "content_same": false
        },
        {
          "line": 1913,
          "old_api": "Int64GetDatumFast",
          "new_api": null,
          "old_text": "Int64GetDatumFast(tmp.shared_blks_dirtied)",
          "new_text": null,
          "old_line_content": "\t\t\tvalues[i++] = Int64GetDatumFast(tmp.shared_blks_dirtied);",
          "new_line_content": "\t\t}",
          "content_same": false
        },
        {
          "line": 2941,
          "old_api": "Assert",
          "new_api": null,
          "old_text": "Assert(loc >= 0)",
          "new_text": null,
          "old_line_content": "\t\tAssert(loc >= 0);",
          "new_line_content": "\t\tint\t\t\ttok;",
          "content_same": false
        },
        {
          "line": 2949,
          "old_api": "core_yylex",
          "new_api": null,
          "old_text": "core_yylex(&yylval, &yylloc, yyscanner)",
          "new_text": null,
          "old_line_content": "\t\t\ttok = core_yylex(&yylval, &yylloc, yyscanner);",
          "new_line_content": "\t\t\tcontinue;\t\t\t/* Duplicate constant, ignore */",
          "content_same": false
        },
        {
          "line": 1942,
          "old_api": "Int64GetDatumFast",
          "new_api": null,
          "old_text": "Int64GetDatumFast(tmp.wal_records)",
          "new_text": null,
          "old_line_content": "\t\t\tvalues[i++] = Int64GetDatumFast(tmp.wal_records);",
          "new_line_content": "\t\tif (api_version >= PGSS_V1_8)",
          "content_same": false
        },
        {
          "line": 1943,
          "old_api": "Int64GetDatumFast",
          "new_api": null,
          "old_text": "Int64GetDatumFast(tmp.wal_fpi)",
          "new_text": null,
          "old_line_content": "\t\t\tvalues[i++] = Int64GetDatumFast(tmp.wal_fpi);",
          "new_line_content": "\t\t{",
          "content_same": false
        },
        {
          "line": 1945,
          "old_api": "snprintf",
          "new_api": null,
          "old_text": "snprintf(buf, sizeof buf, UINT64_FORMAT, tmp.wal_bytes)",
          "new_text": null,
          "old_line_content": "\t\t\tsnprintf(buf, sizeof buf, UINT64_FORMAT, tmp.wal_bytes);",
          "new_line_content": "\t\t\tDatum\t\twal_bytes;",
          "content_same": false
        },
        {
          "line": 1949,
          "old_api": "CStringGetDatum",
          "new_api": null,
          "old_text": "CStringGetDatum(buf)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\t\t\t\t\t\t\tCStringGetDatum(buf),",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2975,
          "old_api": "core_yylex",
          "new_api": null,
          "old_text": "core_yylex(&yylval, &yylloc, yyscanner)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\ttok = core_yylex(&yylval, &yylloc, yyscanner);",
          "new_line_content": "\t\t\t\t\t * also useful for our purposes to start from the minus",
          "content_same": false
        },
        {
          "line": 1951,
          "old_api": "Int32GetDatum",
          "new_api": null,
          "old_text": "Int32GetDatum(-1)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\t\t\t\t\t\t\tInt32GetDatum(-1));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1957,
          "old_api": "Float8GetDatumFast",
          "new_api": null,
          "old_text": "Float8GetDatumFast(tmp.jit_generation_time)",
          "new_text": null,
          "old_line_content": "\t\t\tvalues[i++] = Float8GetDatumFast(tmp.jit_generation_time);",
          "new_line_content": "\t\t\tvalues[i++] = wal_bytes;",
          "content_same": false
        },
        {
          "line": 1958,
          "old_api": "Int64GetDatumFast",
          "new_api": null,
          "old_text": "Int64GetDatumFast(tmp.jit_inlining_count)",
          "new_text": null,
          "old_line_content": "\t\t\tvalues[i++] = Int64GetDatumFast(tmp.jit_inlining_count);",
          "new_line_content": "\t\t}",
          "content_same": false
        },
        {
          "line": 1959,
          "old_api": "Float8GetDatumFast",
          "new_api": null,
          "old_text": "Float8GetDatumFast(tmp.jit_inlining_time)",
          "new_text": null,
          "old_line_content": "\t\t\tvalues[i++] = Float8GetDatumFast(tmp.jit_inlining_time);",
          "new_line_content": "\t\tif (api_version >= PGSS_V1_10)",
          "content_same": false
        },
        {
          "line": 2984,
          "old_api": "strlen",
          "new_api": null,
          "old_text": "strlen(yyextra.scanbuf + loc)",
          "new_text": null,
          "old_line_content": "\t\t\t\tlocs[i].length = strlen(yyextra.scanbuf + loc);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 1960,
          "old_api": "Int64GetDatumFast",
          "new_api": null,
          "old_text": "Int64GetDatumFast(tmp.jit_optimization_count)",
          "new_text": null,
          "old_line_content": "\t\t\tvalues[i++] = Int64GetDatumFast(tmp.jit_optimization_count);",
          "new_line_content": "\t\t{",
          "content_same": false
        },
        {
          "line": 2475,
          "old_api": "need_gc_qtexts",
          "new_api": null,
          "old_text": "need_gc_qtexts()",
          "new_text": null,
          "old_line_content": "\tif (!need_gc_qtexts())",
          "new_line_content": "\t/*",
          "content_same": false
        },
        {
          "line": 2996,
          "old_api": "scanner_finish",
          "new_api": null,
          "old_text": "scanner_finish(yyscanner)",
          "new_text": null,
          "old_line_content": "\tscanner_finish(yyscanner);",
          "new_line_content": "\t\t\tbreak;",
          "content_same": false
        },
        {
          "line": 2485,
          "old_api": "qtext_load_file",
          "new_api": null,
          "old_text": "qtext_load_file(&qbuffer_size)",
          "new_text": null,
          "old_line_content": "\tqbuffer = qtext_load_file(&qbuffer_size);",
          "new_line_content": "\t * invalidate query texts.  Hopefully this is rare.  It might seem better",
          "content_same": false
        },
        {
          "line": 1981,
          "old_api": "Assert",
          "new_api": null,
          "old_text": "Assert(i == (api_version == PGSS_V1_0 ? PG_STAT_STATEMENTS_COLS_V1_0 :\n\t\t\t\t\t api_version == PGSS_V1_1 ? PG_STAT_STATEMENTS_COLS_V1_1 :\n\t\t\t\t\t api_version == PGSS_V1_2 ? PG_STAT_STATEMENTS_COLS_V1_2 :\n\t\t\t\t\t api_version == PGSS_V1_3 ? PG_STAT_STATEMENTS_COLS_V1_3 :\n\t\t\t\t\t api_version == PGSS_V1_8 ? PG_STAT_STATEMENTS_COLS_V1_8 :\n\t\t\t\t\t api_version == PGSS_V1_9 ? PG_STAT_STATEMENTS_COLS_V1_9 :\n\t\t\t\t\t api_version == PGSS_V1_10 ? PG_STAT_STATEMENTS_COLS_V1_10 :\n\t\t\t\t\t api_version == PGSS_V1_11 ? PG_STAT_STATEMENTS_COLS_V1_11 :\n\t\t\t\t\t api_version == PGSS_V1_12 ? PG_STAT_STATEMENTS_COLS_V1_12 :\n\t\t\t\t\t -1 /* fail if you forget to update this assert */ ))",
          "new_text": null,
          "old_line_content": "\t\tAssert(i == (api_version == PGSS_V1_0 ? PG_STAT_STATEMENTS_COLS_V1_0 :",
          "new_line_content": "\t\t{",
          "content_same": false
        },
        {
          "line": 2495,
          "old_api": "AllocateFile",
          "new_api": null,
          "old_text": "AllocateFile(PGSS_TEXT_FILE, PG_BINARY_W)",
          "new_text": null,
          "old_line_content": "\tqfile = AllocateFile(PGSS_TEXT_FILE, PG_BINARY_W);",
          "new_line_content": "\t * We overwrite the query texts file in place, so as to reduce the risk of",
          "content_same": false
        },
        {
          "line": 3008,
          "old_api": "pg_cmp_s32",
          "new_api": null,
          "old_text": "pg_cmp_s32(l, r)",
          "new_text": null,
          "old_line_content": "\treturn pg_cmp_s32(l, r);",
          "new_line_content": "comp_location(const void *a, const void *b)",
          "content_same": false
        },
        {
          "line": 2498,
          "old_api": "ereport",
          "new_api": null,
          "old_text": "ereport(LOG,\n\t\t\t\t(errcode_for_file_access(),\n\t\t\t\t errmsg(\"could not write file \\\"%s\\\": %m\",\n\t\t\t\t\t\tPGSS_TEXT_FILE)))",
          "new_text": null,
          "old_line_content": "\t\tereport(LOG,",
          "new_line_content": "\t * could still lose on copy-on-write filesystems.",
          "content_same": false
        },
        {
          "line": 2499,
          "old_api": "errcode_for_file_access",
          "new_api": null,
          "old_text": "errcode_for_file_access()",
          "new_text": null,
          "old_line_content": "\t\t\t\t(errcode_for_file_access(),",
          "new_line_content": "\t */",
          "content_same": false
        },
        {
          "line": 1992,
          "old_api": "tuplestore_putvalues",
          "new_api": null,
          "old_text": "tuplestore_putvalues(rsinfo->setResult, rsinfo->setDesc, values, nulls)",
          "new_text": null,
          "old_line_content": "\t\ttuplestore_putvalues(rsinfo->setResult, rsinfo->setDesc, values, nulls);",
          "new_line_content": "\t\t\t\t\t api_version == PGSS_V1_10 ? PG_STAT_STATEMENTS_COLS_V1_10 :",
          "content_same": false
        },
        {
          "line": 1995,
          "old_api": "LWLockRelease",
          "new_api": null,
          "old_text": "LWLockRelease(pgss->lock)",
          "new_text": null,
          "old_line_content": "\tLWLockRelease(pgss->lock);",
          "new_line_content": "\t\t\t\t\t -1 /* fail if you forget to update this assert */ ));",
          "content_same": false
        },
        {
          "line": 2508,
          "old_api": "hash_seq_init",
          "new_api": null,
          "old_text": "hash_seq_init(&hash_seq, pgss_hash)",
          "new_text": null,
          "old_line_content": "\thash_seq_init(&hash_seq, pgss_hash);",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 2509,
          "old_api": "hash_seq_search",
          "new_api": null,
          "old_text": "hash_seq_search(&hash_seq)",
          "new_text": null,
          "old_line_content": "\twhile ((entry = hash_seq_search(&hash_seq)) != NULL)",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2512,
          "old_api": "qtext_fetch",
          "new_api": null,
          "old_text": "qtext_fetch(entry->query_offset,\n\t\t\t\t\t\t\t\t\t  query_len,\n\t\t\t\t\t\t\t\t\t  qbuffer,\n\t\t\t\t\t\t\t\t\t  qbuffer_size)",
          "new_text": null,
          "old_line_content": "\t\tchar\t   *qry = qtext_fetch(entry->query_offset,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2526,
          "old_api": "fwrite",
          "new_api": null,
          "old_text": "fwrite(qry, 1, query_len + 1, qfile)",
          "new_text": null,
          "old_line_content": "\t\tif (fwrite(qry, 1, query_len + 1, qfile) != query_len + 1)",
          "new_line_content": "\t\t\tentry->query_len = -1;",
          "content_same": false
        },
        {
          "line": 2015,
          "old_api": "ereport",
          "new_api": null,
          "old_text": "ereport(ERROR,\n\t\t\t\t(errcode(ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE),\n\t\t\t\t errmsg(\"pg_stat_statements must be loaded via \\\"shared_preload_libraries\\\"\")))",
          "new_text": null,
          "old_line_content": "\t\tereport(ERROR,",
          "new_line_content": "\tTupleDesc\ttupdesc;",
          "content_same": false
        },
        {
          "line": 2528,
          "old_api": "ereport",
          "new_api": null,
          "old_text": "ereport(LOG,\n\t\t\t\t\t(errcode_for_file_access(),\n\t\t\t\t\t errmsg(\"could not write file \\\"%s\\\": %m\",\n\t\t\t\t\t\t\tPGSS_TEXT_FILE)))",
          "new_text": null,
          "old_line_content": "\t\t\tereport(LOG,",
          "new_line_content": "\t\t\tcontinue;",
          "content_same": false
        },
        {
          "line": 2529,
          "old_api": "errcode_for_file_access",
          "new_api": null,
          "old_text": "errcode_for_file_access()",
          "new_text": null,
          "old_line_content": "\t\t\t\t\t(errcode_for_file_access(),",
          "new_line_content": "\t\t}",
          "content_same": false
        },
        {
          "line": 2530,
          "old_api": "errmsg",
          "new_api": null,
          "old_text": "errmsg(\"could not write file \\\"%s\\\": %m\",\n\t\t\t\t\t\t\tPGSS_TEXT_FILE)",
          "new_text": null,
          "old_line_content": "\t\t\t\t\t errmsg(\"could not write file \\\"%s\\\": %m\",",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2016,
          "old_api": "errcode",
          "new_api": null,
          "old_text": "errcode(ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE)",
          "new_text": null,
          "old_line_content": "\t\t\t\t(errcode(ERRCODE_OBJECT_NOT_IN_PREREQUISITE_STATE),",
          "new_line_content": "\tDatum\t\tvalues[PG_STAT_STATEMENTS_INFO_COLS] = {0};",
          "content_same": false
        },
        {
          "line": 2532,
          "old_api": "hash_seq_term",
          "new_api": null,
          "old_text": "hash_seq_term(&hash_seq)",
          "new_text": null,
          "old_line_content": "\t\t\thash_seq_term(&hash_seq);",
          "new_line_content": "\t\t{",
          "content_same": false
        },
        {
          "line": 2017,
          "old_api": "errmsg",
          "new_api": null,
          "old_text": "errmsg(\"pg_stat_statements must be loaded via \\\"shared_preload_libraries\\\"\")",
          "new_text": null,
          "old_line_content": "\t\t\t\t errmsg(\"pg_stat_statements must be loaded via \\\"shared_preload_libraries\\\"\")));",
          "new_line_content": "\tbool\t\tnulls[PG_STAT_STATEMENTS_INFO_COLS] = {0};",
          "content_same": false
        },
        {
          "line": 2024,
          "old_api": "SpinLockAcquire",
          "new_api": null,
          "old_text": "SpinLockAcquire(&pgss->mutex)",
          "new_text": null,
          "old_line_content": "\tSpinLockAcquire(&pgss->mutex);",
          "new_line_content": "\t/* Build a tuple descriptor for our result type */",
          "content_same": false
        },
        {
          "line": 2028,
          "old_api": "Int64GetDatum",
          "new_api": null,
          "old_text": "Int64GetDatum(stats.dealloc)",
          "new_text": null,
          "old_line_content": "\tvalues[0] = Int64GetDatum(stats.dealloc);",
          "new_line_content": "\t/* Read global statistics for pg_stat_statements */",
          "content_same": false
        },
        {
          "line": 2545,
          "old_api": "fileno",
          "new_api": null,
          "old_text": "fileno(qfile)",
          "new_text": null,
          "old_line_content": "\tif (ftruncate(fileno(qfile), extent) != 0)",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 2546,
          "old_api": "ereport",
          "new_api": null,
          "old_text": "ereport(LOG,\n\t\t\t\t(errcode_for_file_access(),\n\t\t\t\t errmsg(\"could not truncate file \\\"%s\\\": %m\",\n\t\t\t\t\t\tPGSS_TEXT_FILE)))",
          "new_text": null,
          "old_line_content": "\t\tereport(LOG,",
          "new_line_content": "\t/*",
          "content_same": false
        },
        {
          "line": 2547,
          "old_api": "errcode_for_file_access",
          "new_api": null,
          "old_text": "errcode_for_file_access()",
          "new_text": null,
          "old_line_content": "\t\t\t\t(errcode_for_file_access(),",
          "new_line_content": "\t * Truncate away any now-unused space.  If this fails for some odd reason,",
          "content_same": false
        },
        {
          "line": 2548,
          "old_api": "errmsg",
          "new_api": null,
          "old_text": "errmsg(\"could not truncate file \\\"%s\\\": %m\",\n\t\t\t\t\t\tPGSS_TEXT_FILE)",
          "new_text": null,
          "old_line_content": "\t\t\t\t errmsg(\"could not truncate file \\\"%s\\\": %m\",",
          "new_line_content": "\t * we log it, but there's no need to fail.",
          "content_same": false
        },
        {
          "line": 2554,
          "old_api": "errcode_for_file_access",
          "new_api": null,
          "old_text": "errcode_for_file_access()",
          "new_text": null,
          "old_line_content": "\t\t\t\t(errcode_for_file_access(),",
          "new_line_content": "\t\t\t\t\t\tPGSS_TEXT_FILE)));",
          "content_same": false
        },
        {
          "line": 2555,
          "old_api": "errmsg",
          "new_api": null,
          "old_text": "errmsg(\"could not write file \\\"%s\\\": %m\",\n\t\t\t\t\t\tPGSS_TEXT_FILE)",
          "new_text": null,
          "old_line_content": "\t\t\t\t errmsg(\"could not write file \\\"%s\\\": %m\",",
          "new_line_content": "",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 46,
      "total_additions": 149,
      "total_deletions": 149,
      "total_api_changes": 344
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 6,
        "api_related_lines": 344,
        "non_api_lines": 3,
        "non_api_line_numbers": [
          1873,
          1875,
          1876
        ]
      }
    },
    "api_calls_before": 484,
    "api_calls_after": 484,
    "diff_info": {
      "added_lines": 6,
      "removed_lines": 1,
      "total_diff_lines": 21
    }
  }
}