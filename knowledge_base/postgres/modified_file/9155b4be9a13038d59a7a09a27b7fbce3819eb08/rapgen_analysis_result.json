{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/postgres/modified_file/9155b4be9a13038d59a7a09a27b7fbce3819eb08",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/postgres/modified_file/9155b4be9a13038d59a7a09a27b7fbce3819eb08/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/postgres/modified_file/9155b4be9a13038d59a7a09a27b7fbce3819eb08/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/postgres/modified_file/9155b4be9a13038d59a7a09a27b7fbce3819eb08/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 1198,
          "old_api": "mul_size",
          "new_api": "offsetof",
          "old_text": "mul_size(pcxt->nworkers, sizeof(IncrementalSortInfo))",
          "new_text": "offsetof(SharedIncrementalSortInfo, sinfo)",
          "old_line_content": "\tsize = mul_size(pcxt->nworkers, sizeof(IncrementalSortInfo));",
          "new_line_content": "\tsize = add_size(size, offsetof(SharedIncrementalSortInfo, sinfo));",
          "content_same": false
        },
        {
          "line": 1199,
          "old_api": "offsetof",
          "new_api": "shm_toc_estimate_chunk",
          "old_text": "offsetof(SharedIncrementalSortInfo, sinfo)",
          "new_text": "shm_toc_estimate_chunk(&pcxt->estimator, size)",
          "old_line_content": "\tsize = add_size(size, offsetof(SharedIncrementalSortInfo, sinfo));",
          "new_line_content": "\tshm_toc_estimate_chunk(&pcxt->estimator, size);",
          "content_same": false
        },
        {
          "line": 1200,
          "old_api": "shm_toc_estimate_chunk",
          "new_api": "shm_toc_estimate_keys",
          "old_text": "shm_toc_estimate_chunk(&pcxt->estimator, size)",
          "new_text": "shm_toc_estimate_keys(&pcxt->estimator, 1)",
          "old_line_content": "\tshm_toc_estimate_chunk(&pcxt->estimator, size);",
          "new_line_content": "\tshm_toc_estimate_keys(&pcxt->estimator, 1);",
          "content_same": false
        },
        {
          "line": 1260,
          "old_api": "palloc",
          "new_api": "memcpy",
          "old_text": "palloc(size)",
          "new_text": "memcpy(si, node->shared_info, size)",
          "old_line_content": "\tsi = palloc(size);",
          "new_line_content": "\tmemcpy(si, node->shared_info, size);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 1218,
          "old_api": null,
          "new_api": "offsetof",
          "old_text": null,
          "new_text": "offsetof(SharedIncrementalSortInfo, sinfo)",
          "old_line_content": "",
          "new_line_content": "\tsize = offsetof(SharedIncrementalSortInfo, sinfo)",
          "content_same": false
        },
        {
          "line": 1220,
          "old_api": null,
          "new_api": "shm_toc_allocate",
          "old_text": null,
          "new_text": "shm_toc_allocate(pcxt->toc, size)",
          "old_line_content": "\t\t+ pcxt->nworkers * sizeof(IncrementalSortInfo);",
          "new_line_content": "\tnode->shared_info = shm_toc_allocate(pcxt->toc, size);",
          "content_same": false
        },
        {
          "line": 1222,
          "old_api": null,
          "new_api": "memset",
          "old_text": null,
          "new_text": "memset(node->shared_info, 0, size)",
          "old_line_content": "\t/* ensure any unfilled slots will contain zeroes */",
          "new_line_content": "\tmemset(node->shared_info, 0, size);",
          "content_same": false
        },
        {
          "line": 1160,
          "old_api": null,
          "new_api": "tuplesort_reset",
          "old_text": null,
          "new_text": "tuplesort_reset(node->fullsort_state)",
          "old_line_content": "\t{",
          "new_line_content": "\t\ttuplesort_reset(node->fullsort_state);",
          "content_same": false
        },
        {
          "line": 1224,
          "old_api": null,
          "new_api": "shm_toc_insert",
          "old_text": null,
          "new_text": "shm_toc_insert(pcxt->toc, node->ss.ps.plan->plan_node_id,\n\t\t\t\t   node->shared_info)",
          "old_line_content": "\tnode->shared_info->num_workers = pcxt->nworkers;",
          "new_line_content": "\tshm_toc_insert(pcxt->toc, node->ss.ps.plan->plan_node_id,",
          "content_same": false
        },
        {
          "line": 1257,
          "old_api": null,
          "new_api": "offsetof",
          "old_text": null,
          "new_text": "offsetof(SharedIncrementalSortInfo, sinfo)",
          "old_line_content": "",
          "new_line_content": "\tsize = offsetof(SharedIncrementalSortInfo, sinfo)",
          "content_same": false
        },
        {
          "line": 1259,
          "old_api": null,
          "new_api": "palloc",
          "old_text": null,
          "new_text": "palloc(size)",
          "old_line_content": "\t\t+ node->shared_info->num_workers * sizeof(IncrementalSortInfo);",
          "new_line_content": "\tsi = palloc(size);",
          "content_same": false
        },
        {
          "line": 1165,
          "old_api": null,
          "new_api": "tuplesort_reset",
          "old_text": null,
          "new_text": "tuplesort_reset(node->prefixsort_state)",
          "old_line_content": "\t{",
          "new_line_content": "\t\ttuplesort_reset(node->prefixsort_state);",
          "content_same": false
        },
        {
          "line": 1197,
          "old_api": null,
          "new_api": "mul_size",
          "old_text": null,
          "new_text": "mul_size(pcxt->nworkers, sizeof(IncrementalSortInfo))",
          "old_line_content": "",
          "new_line_content": "\tsize = mul_size(pcxt->nworkers, sizeof(IncrementalSortInfo));",
          "content_same": false
        },
        {
          "line": 1174,
          "old_api": null,
          "new_api": "ExecReScan",
          "old_text": null,
          "new_text": "ExecReScan(outerPlan)",
          "old_line_content": "\tif (outerPlan->chgParam == NULL)",
          "new_line_content": "\t\tExecReScan(outerPlan);",
          "content_same": false
        },
        {
          "line": 1238,
          "old_api": null,
          "new_api": "shm_toc_lookup",
          "old_text": null,
          "new_text": "shm_toc_lookup(pwcxt->toc, node->ss.ps.plan->plan_node_id, true)",
          "old_line_content": "\tnode->shared_info =",
          "new_line_content": "\t\tshm_toc_lookup(pwcxt->toc, node->ss.ps.plan->plan_node_id, true);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 1219,
          "old_api": "offsetof",
          "new_api": null,
          "old_text": "offsetof(SharedIncrementalSortInfo, sinfo)",
          "new_text": null,
          "old_line_content": "\tsize = offsetof(SharedIncrementalSortInfo, sinfo)",
          "new_line_content": "\t\t+ pcxt->nworkers * sizeof(IncrementalSortInfo);",
          "content_same": false
        },
        {
          "line": 1221,
          "old_api": "shm_toc_allocate",
          "new_api": null,
          "old_text": "shm_toc_allocate(pcxt->toc, size)",
          "new_text": null,
          "old_line_content": "\tnode->shared_info = shm_toc_allocate(pcxt->toc, size);",
          "new_line_content": "\t/* ensure any unfilled slots will contain zeroes */",
          "content_same": false
        },
        {
          "line": 1223,
          "old_api": "memset",
          "new_api": null,
          "old_text": "memset(node->shared_info, 0, size)",
          "new_text": null,
          "old_line_content": "\tmemset(node->shared_info, 0, size);",
          "new_line_content": "\tnode->shared_info->num_workers = pcxt->nworkers;",
          "content_same": false
        },
        {
          "line": 1161,
          "old_api": "tuplesort_reset",
          "new_api": null,
          "old_text": "tuplesort_reset(node->fullsort_state)",
          "new_text": null,
          "old_line_content": "\t\ttuplesort_reset(node->fullsort_state);",
          "new_line_content": "\t\tnode->fullsort_state = NULL;",
          "content_same": false
        },
        {
          "line": 1225,
          "old_api": "shm_toc_insert",
          "new_api": null,
          "old_text": "shm_toc_insert(pcxt->toc, node->ss.ps.plan->plan_node_id,\n\t\t\t\t   node->shared_info)",
          "new_text": null,
          "old_line_content": "\tshm_toc_insert(pcxt->toc, node->ss.ps.plan->plan_node_id,",
          "new_line_content": "\t\t\t\t   node->shared_info);",
          "content_same": false
        },
        {
          "line": 1258,
          "old_api": "offsetof",
          "new_api": null,
          "old_text": "offsetof(SharedIncrementalSortInfo, sinfo)",
          "new_text": null,
          "old_line_content": "\tsize = offsetof(SharedIncrementalSortInfo, sinfo)",
          "new_line_content": "\t\t+ node->shared_info->num_workers * sizeof(IncrementalSortInfo);",
          "content_same": false
        },
        {
          "line": 1261,
          "old_api": "memcpy",
          "new_api": null,
          "old_text": "memcpy(si, node->shared_info, size)",
          "new_text": null,
          "old_line_content": "\tmemcpy(si, node->shared_info, size);",
          "new_line_content": "\tnode->shared_info = si;",
          "content_same": false
        },
        {
          "line": 1166,
          "old_api": "tuplesort_reset",
          "new_api": null,
          "old_text": "tuplesort_reset(node->prefixsort_state)",
          "new_text": null,
          "old_line_content": "\t\ttuplesort_reset(node->prefixsort_state);",
          "new_line_content": "\t\tnode->prefixsort_state = NULL;",
          "content_same": false
        },
        {
          "line": 1201,
          "old_api": "shm_toc_estimate_keys",
          "new_api": null,
          "old_text": "shm_toc_estimate_keys(&pcxt->estimator, 1)",
          "new_text": null,
          "old_line_content": "\tshm_toc_estimate_keys(&pcxt->estimator, 1);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 1175,
          "old_api": "ExecReScan",
          "new_api": null,
          "old_text": "ExecReScan(outerPlan)",
          "new_text": null,
          "old_line_content": "\t\tExecReScan(outerPlan);",
          "new_line_content": "}",
          "content_same": false
        },
        {
          "line": 1239,
          "old_api": "shm_toc_lookup",
          "new_api": null,
          "old_text": "shm_toc_lookup(pwcxt->toc, node->ss.ps.plan->plan_node_id, true)",
          "new_text": null,
          "old_line_content": "\t\tshm_toc_lookup(pwcxt->toc, node->ss.ps.plan->plan_node_id, true);",
          "new_line_content": "\tnode->am_worker = true;",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 4,
      "total_additions": 11,
      "total_deletions": 11,
      "total_api_changes": 26
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 1,
        "api_related_lines": 26,
        "non_api_lines": 1,
        "non_api_line_numbers": [
          1145
        ]
      }
    },
    "api_calls_before": 155,
    "api_calls_after": 155,
    "diff_info": {
      "added_lines": 0,
      "removed_lines": 1,
      "total_diff_lines": 13
    }
  }
}