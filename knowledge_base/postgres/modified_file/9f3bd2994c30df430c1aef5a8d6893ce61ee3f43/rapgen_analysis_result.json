{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/postgres/modified_file/9f3bd2994c30df430c1aef5a8d6893ce61ee3f43",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/postgres/modified_file/9f3bd2994c30df430c1aef5a8d6893ce61ee3f43/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/postgres/modified_file/9f3bd2994c30df430c1aef5a8d6893ce61ee3f43/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/postgres/modified_file/9f3bd2994c30df430c1aef5a8d6893ce61ee3f43/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 314,
          "old_api": "elog",
          "new_api": "buf_finalize",
          "old_text": "elog(ERROR, \"invalid input for txid_snapshot: \\\"%s\\\"\", str_start)",
          "new_text": "buf_finalize(buf)",
          "old_line_content": "\telog(ERROR, \"invalid input for txid_snapshot: \\\"%s\\\"\", str_start);",
          "new_line_content": "\treturn buf_finalize(buf);",
          "content_same": false
        },
        {
          "line": 366,
          "old_api": "convert_xid",
          "new_api": "SET_VARSIZE",
          "old_text": "convert_xid(cur->xmin, &state)",
          "new_text": "SET_VARSIZE(snap, size)",
          "old_line_content": "\tsnap->xmin = convert_xid(cur->xmin, &state);",
          "new_line_content": "\tSET_VARSIZE(snap, size);",
          "content_same": false
        },
        {
          "line": 373,
          "old_api": "sort_snapshot",
          "new_api": "convert_xid",
          "old_text": "sort_snapshot(snap)",
          "new_text": "convert_xid(cur->xip[i], &state)",
          "old_line_content": "\tsort_snapshot(snap);",
          "new_line_content": "\t\tsnap->xip[i] = convert_xid(cur->xip[i], &state);",
          "content_same": false
        },
        {
          "line": 411,
          "old_api": "appendStringInfo",
          "new_api": "initStringInfo",
          "old_text": "appendStringInfo(&str, TXID_FMT \":\", snap->xmax)",
          "new_text": "initStringInfo(&str)",
          "old_line_content": "\tappendStringInfo(&str, TXID_FMT \":\", snap->xmax);",
          "new_line_content": "\tinitStringInfo(&str);",
          "content_same": false
        },
        {
          "line": 438,
          "old_api": "is_visible_txid",
          "new_api": "PG_GETARG_VARLENA_P",
          "old_text": "is_visible_txid(value, snap)",
          "new_text": "PG_GETARG_VARLENA_P(1)",
          "old_line_content": "\tres = is_visible_txid(value, snap) ? true : false;",
          "new_line_content": "\tTxidSnapshot *snap = (TxidSnapshot *) PG_GETARG_VARLENA_P(1);",
          "content_same": false
        },
        {
          "line": 441,
          "old_api": "PG_RETURN_BOOL",
          "new_api": "is_visible_txid",
          "old_text": "PG_RETURN_BOOL(res)",
          "new_text": "is_visible_txid(value, snap)",
          "old_line_content": "\tPG_RETURN_BOOL(res);",
          "new_line_content": "\tres = is_visible_txid(value, snap) ? true : false;",
          "content_same": false
        },
        {
          "line": 455,
          "old_api": "PG_RETURN_INT64",
          "new_api": "PG_GETARG_VARLENA_P",
          "old_text": "PG_RETURN_INT64(res)",
          "new_text": "PG_GETARG_VARLENA_P(0)",
          "old_line_content": "\tPG_RETURN_INT64(res);",
          "new_line_content": "\tTxidSnapshot *snap = (TxidSnapshot *) PG_GETARG_VARLENA_P(0);",
          "content_same": false
        },
        {
          "line": 469,
          "old_api": "PG_RETURN_INT64",
          "new_api": "PG_GETARG_VARLENA_P",
          "old_text": "PG_RETURN_INT64(res)",
          "new_text": "PG_GETARG_VARLENA_P(0)",
          "old_line_content": "\tPG_RETURN_INT64(res);",
          "new_line_content": "\tTxidSnapshot *snap = (TxidSnapshot *) PG_GETARG_VARLENA_P(0);",
          "content_same": false
        },
        {
          "line": 488,
          "old_api": "SRF_FIRSTCALL_INIT",
          "new_api": "SRF_IS_FIRSTCALL",
          "old_text": "SRF_FIRSTCALL_INIT()",
          "new_text": "SRF_IS_FIRSTCALL()",
          "old_line_content": "\t\tfctx = SRF_FIRSTCALL_INIT();",
          "new_line_content": "\tif (SRF_IS_FIRSTCALL()) {",
          "content_same": false
        },
        {
          "line": 491,
          "old_api": "PG_GETARG_VARLENA_P",
          "new_api": "SRF_FIRSTCALL_INIT",
          "old_text": "PG_GETARG_VARLENA_P(0)",
          "new_text": "SRF_FIRSTCALL_INIT()",
          "old_line_content": "\t\targ = (TxidSnapshot *) PG_GETARG_VARLENA_P(0);",
          "new_line_content": "\t\tfctx = SRF_FIRSTCALL_INIT();",
          "content_same": false
        },
        {
          "line": 494,
          "old_api": "PG_FREE_IF_COPY",
          "new_api": "PG_GETARG_VARLENA_P",
          "old_text": "PG_FREE_IF_COPY(arg, 0)",
          "new_text": "PG_GETARG_VARLENA_P(0)",
          "old_line_content": "\t\tPG_FREE_IF_COPY(arg, 0);",
          "new_line_content": "\t\targ = (TxidSnapshot *) PG_GETARG_VARLENA_P(0);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 390,
          "old_api": null,
          "new_api": "PG_GETARG_CSTRING",
          "old_text": null,
          "new_text": "PG_GETARG_CSTRING(0)",
          "old_line_content": "",
          "new_line_content": "\tchar\t   *str = PG_GETARG_CSTRING(0);",
          "content_same": false
        },
        {
          "line": 392,
          "old_api": null,
          "new_api": "parse_snapshot",
          "old_text": null,
          "new_text": "parse_snapshot(str)",
          "old_line_content": "}",
          "new_line_content": "\tsnap = parse_snapshot(str);",
          "content_same": false
        },
        {
          "line": 394,
          "old_api": null,
          "new_api": "PG_RETURN_POINTER",
          "old_text": null,
          "new_text": "PG_RETURN_POINTER(snap)",
          "old_line_content": "/*",
          "new_line_content": "\tPG_RETURN_POINTER(snap);",
          "content_same": false
        },
        {
          "line": 277,
          "old_api": null,
          "new_api": "str2txid",
          "old_text": null,
          "new_text": "str2txid(str, &endp)",
          "old_line_content": "\tstr = endp + 1;",
          "new_line_content": "\txmin = str2txid(str, &endp);",
          "content_same": false
        },
        {
          "line": 409,
          "old_api": null,
          "new_api": "PG_GETARG_VARLENA_P",
          "old_text": null,
          "new_text": "PG_GETARG_VARLENA_P(0)",
          "old_line_content": "",
          "new_line_content": "\tsnap = (TxidSnapshot *) PG_GETARG_VARLENA_P(0);",
          "content_same": false
        },
        {
          "line": 282,
          "old_api": null,
          "new_api": "str2txid",
          "old_text": null,
          "new_text": "str2txid(str, &endp)",
          "old_line_content": "\tstr = endp + 1;",
          "new_line_content": "\txmax = str2txid(str, &endp);",
          "content_same": false
        },
        {
          "line": 413,
          "old_api": null,
          "new_api": "appendStringInfo",
          "old_text": null,
          "new_text": "appendStringInfo(&str, TXID_FMT \":\", snap->xmin)",
          "old_line_content": "\tfor (i = 0; i < snap->nxip; i++)",
          "new_line_content": "\tappendStringInfo(&str, TXID_FMT \":\", snap->xmin);",
          "content_same": false
        },
        {
          "line": 414,
          "old_api": null,
          "new_api": "appendStringInfo",
          "old_text": null,
          "new_text": "appendStringInfo(&str, TXID_FMT \":\", snap->xmax)",
          "old_line_content": "\t{",
          "new_line_content": "\tappendStringInfo(&str, TXID_FMT \":\", snap->xmax);",
          "content_same": false
        },
        {
          "line": 418,
          "old_api": null,
          "new_api": "appendStringInfo",
          "old_text": null,
          "new_text": "appendStringInfo(&str, \"%s\" TXID_FMT,\n\t\t\t\t\t\t ((i > 0) ? \",\" : \"\"),\n\t\t\t\t\t\t snap->xip[i])",
          "old_line_content": "\t}",
          "new_line_content": "\t\tappendStringInfo(&str, \"%s\" TXID_FMT,",
          "content_same": false
        },
        {
          "line": 292,
          "old_api": null,
          "new_api": "buf_init",
          "old_text": null,
          "new_text": "buf_init(xmin, xmax)",
          "old_line_content": "\twhile (*str != '\\0')",
          "new_line_content": "\tbuf = buf_init(xmin, xmax);",
          "content_same": false
        },
        {
          "line": 423,
          "old_api": null,
          "new_api": "PG_FREE_IF_COPY",
          "old_text": null,
          "new_text": "PG_FREE_IF_COPY(snap, 0)",
          "old_line_content": "}",
          "new_line_content": "\tPG_FREE_IF_COPY(snap, 0);",
          "content_same": false
        },
        {
          "line": 425,
          "old_api": null,
          "new_api": "PG_RETURN_CSTRING",
          "old_text": null,
          "new_text": "PG_RETURN_CSTRING(str.data)",
          "old_line_content": "",
          "new_line_content": "\tPG_RETURN_CSTRING(str.data);",
          "content_same": false
        },
        {
          "line": 298,
          "old_api": null,
          "new_api": "str2txid",
          "old_text": null,
          "new_text": "str2txid(str, &endp)",
          "old_line_content": "\t\t/* require the input to be in order */",
          "new_line_content": "\t\tval = str2txid(str, &endp);",
          "content_same": false
        },
        {
          "line": 305,
          "old_api": null,
          "new_api": "buf_add_txid",
          "old_text": null,
          "new_text": "buf_add_txid(buf, val)",
          "old_line_content": "\t\tif (*str == ',')",
          "new_line_content": "\t\tbuf_add_txid(buf, val);",
          "content_same": false
        },
        {
          "line": 437,
          "old_api": null,
          "new_api": "PG_GETARG_INT64",
          "old_text": null,
          "new_text": "PG_GETARG_INT64(0)",
          "old_line_content": "\t",
          "new_line_content": "\ttxid value = PG_GETARG_INT64(0);",
          "content_same": false
        },
        {
          "line": 443,
          "old_api": null,
          "new_api": "PG_FREE_IF_COPY",
          "old_text": null,
          "new_text": "PG_FREE_IF_COPY(snap, 1)",
          "old_line_content": "",
          "new_line_content": "\tPG_FREE_IF_COPY(snap, 1);",
          "content_same": false
        },
        {
          "line": 444,
          "old_api": null,
          "new_api": "PG_RETURN_BOOL",
          "old_text": null,
          "new_text": "PG_RETURN_BOOL(res)",
          "old_line_content": "/*",
          "new_line_content": "\tPG_RETURN_BOOL(res);",
          "content_same": false
        },
        {
          "line": 317,
          "old_api": null,
          "new_api": "elog",
          "old_text": null,
          "new_text": "elog(ERROR, \"invalid input for txid_snapshot: \\\"%s\\\"\", str_start)",
          "old_line_content": "",
          "new_line_content": "\telog(ERROR, \"invalid input for txid_snapshot: \\\"%s\\\"\", str_start);",
          "content_same": false
        },
        {
          "line": 457,
          "old_api": null,
          "new_api": "PG_FREE_IF_COPY",
          "old_text": null,
          "new_text": "PG_FREE_IF_COPY(snap, 0)",
          "old_line_content": "",
          "new_line_content": "\tPG_FREE_IF_COPY(snap, 0);",
          "content_same": false
        },
        {
          "line": 458,
          "old_api": null,
          "new_api": "PG_RETURN_INT64",
          "old_text": null,
          "new_text": "PG_RETURN_INT64(res)",
          "old_line_content": "/*",
          "new_line_content": "\tPG_RETURN_INT64(res);",
          "content_same": false
        },
        {
          "line": 336,
          "old_api": null,
          "new_api": "load_xid_epoch",
          "old_text": null,
          "new_text": "load_xid_epoch(&state)",
          "old_line_content": "",
          "new_line_content": "\tload_xid_epoch(&state);",
          "content_same": false
        },
        {
          "line": 338,
          "old_api": null,
          "new_api": "GetTopTransactionId",
          "old_text": null,
          "new_text": "GetTopTransactionId()",
          "old_line_content": "}",
          "new_line_content": "\tval = convert_xid(GetTopTransactionId(), &state);",
          "content_same": false
        },
        {
          "line": 340,
          "old_api": null,
          "new_api": "PG_RETURN_INT64",
          "old_text": null,
          "new_text": "PG_RETURN_INT64(val)",
          "old_line_content": "/*",
          "new_line_content": "\tPG_RETURN_INT64(val);",
          "content_same": false
        },
        {
          "line": 471,
          "old_api": null,
          "new_api": "PG_FREE_IF_COPY",
          "old_text": null,
          "new_text": "PG_FREE_IF_COPY(snap, 0)",
          "old_line_content": "",
          "new_line_content": "\tPG_FREE_IF_COPY(snap, 0);",
          "content_same": false
        },
        {
          "line": 472,
          "old_api": null,
          "new_api": "PG_RETURN_INT64",
          "old_text": null,
          "new_text": "PG_RETURN_INT64(res)",
          "old_line_content": "/*",
          "new_line_content": "\tPG_RETURN_INT64(res);",
          "content_same": false
        },
        {
          "line": 358,
          "old_api": null,
          "new_api": "elog",
          "old_text": null,
          "new_text": "elog(ERROR, \"get_current_snapshot: SerializableSnapshot == NULL\")",
          "old_line_content": "",
          "new_line_content": "\t\telog(ERROR, \"get_current_snapshot: SerializableSnapshot == NULL\");",
          "content_same": false
        },
        {
          "line": 360,
          "old_api": null,
          "new_api": "load_xid_epoch",
          "old_text": null,
          "new_text": "load_xid_epoch(&state)",
          "old_line_content": "\tnxip = cur->xcnt;",
          "new_line_content": "\tload_xid_epoch(&state);",
          "content_same": false
        },
        {
          "line": 364,
          "old_api": null,
          "new_api": "TXID_SNAPSHOT_SIZE",
          "old_text": null,
          "new_text": "TXID_SNAPSHOT_SIZE(nxip)",
          "old_line_content": "",
          "new_line_content": "\tsize = TXID_SNAPSHOT_SIZE(nxip);",
          "content_same": false
        },
        {
          "line": 365,
          "old_api": null,
          "new_api": "palloc",
          "old_text": null,
          "new_text": "palloc(size)",
          "old_line_content": "\t/* fill */",
          "new_line_content": "\tsnap = palloc(size);",
          "content_same": false
        },
        {
          "line": 495,
          "old_api": null,
          "new_api": "VARSIZE",
          "old_text": null,
          "new_text": "VARSIZE(arg)",
          "old_line_content": "",
          "new_line_content": "\t\tsnap = MemoryContextAlloc(fctx->multi_call_memory_ctx, VARSIZE(arg));",
          "content_same": false
        },
        {
          "line": 496,
          "old_api": null,
          "new_api": "VARSIZE",
          "old_text": null,
          "new_text": "VARSIZE(arg)",
          "old_line_content": "\t\tfctx->user_fctx = snap;",
          "new_line_content": "\t\tmemcpy(snap, arg, VARSIZE(arg));",
          "content_same": false
        },
        {
          "line": 369,
          "old_api": null,
          "new_api": "convert_xid",
          "old_text": null,
          "new_text": "convert_xid(cur->xmin, &state)",
          "old_line_content": "\tfor (i = 0; i < nxip; i++)",
          "new_line_content": "\tsnap->xmin = convert_xid(cur->xmin, &state);",
          "content_same": false
        },
        {
          "line": 497,
          "old_api": null,
          "new_api": "PG_FREE_IF_COPY",
          "old_text": null,
          "new_text": "PG_FREE_IF_COPY(arg, 0)",
          "old_line_content": "\t}",
          "new_line_content": "\t\tPG_FREE_IF_COPY(arg, 0);",
          "content_same": false
        },
        {
          "line": 503,
          "old_api": null,
          "new_api": "SRF_PERCALL_SETUP",
          "old_text": null,
          "new_text": "SRF_PERCALL_SETUP()",
          "old_line_content": "\t\tvalue = snap->xip[fctx->call_cntr];",
          "new_line_content": "\tfctx = SRF_PERCALL_SETUP();",
          "content_same": false
        },
        {
          "line": 376,
          "old_api": null,
          "new_api": "sort_snapshot",
          "old_text": null,
          "new_text": "sort_snapshot(snap)",
          "old_line_content": "}",
          "new_line_content": "\tsort_snapshot(snap);",
          "content_same": false
        },
        {
          "line": 378,
          "old_api": null,
          "new_api": "PG_RETURN_POINTER",
          "old_text": null,
          "new_text": "PG_RETURN_POINTER(snap)",
          "old_line_content": "/*",
          "new_line_content": "\tPG_RETURN_POINTER(snap);",
          "content_same": false
        },
        {
          "line": 507,
          "old_api": null,
          "new_api": "Int64GetDatum",
          "old_text": null,
          "new_text": "Int64GetDatum(value)",
          "old_line_content": "\t}",
          "new_line_content": "\t\tSRF_RETURN_NEXT(fctx, Int64GetDatum(value));",
          "content_same": false
        },
        {
          "line": 509,
          "old_api": null,
          "new_api": "SRF_RETURN_DONE",
          "old_text": null,
          "new_text": "SRF_RETURN_DONE(fctx)",
          "old_line_content": "",
          "new_line_content": "\t\tSRF_RETURN_DONE(fctx);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 387,
          "old_api": "PG_GETARG_CSTRING",
          "new_api": null,
          "old_text": "PG_GETARG_CSTRING(0)",
          "new_text": null,
          "old_line_content": "\tchar\t   *str = PG_GETARG_CSTRING(0);",
          "new_line_content": "txid_snapshot_in(PG_FUNCTION_ARGS)",
          "content_same": false
        },
        {
          "line": 389,
          "old_api": "parse_snapshot",
          "new_api": null,
          "old_text": "parse_snapshot(str)",
          "new_text": null,
          "old_line_content": "\tsnap = parse_snapshot(str);",
          "new_line_content": "\tTxidSnapshot *snap;",
          "content_same": false
        },
        {
          "line": 391,
          "old_api": "PG_RETURN_POINTER",
          "new_api": null,
          "old_text": "PG_RETURN_POINTER(snap)",
          "new_text": null,
          "old_line_content": "\tPG_RETURN_POINTER(snap);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 274,
          "old_api": "str2txid",
          "new_api": null,
          "old_text": "str2txid(str, &endp)",
          "new_text": null,
          "old_line_content": "\txmin = str2txid(str, &endp);",
          "new_line_content": "\tconst char *endp;",
          "content_same": false
        },
        {
          "line": 406,
          "old_api": "PG_GETARG_VARLENA_P",
          "new_api": null,
          "old_text": "PG_GETARG_VARLENA_P(0)",
          "new_text": null,
          "old_line_content": "\tsnap = (TxidSnapshot *) PG_GETARG_VARLENA_P(0);",
          "new_line_content": "\tStringInfoData\tstr;",
          "content_same": false
        },
        {
          "line": 279,
          "old_api": "str2txid",
          "new_api": null,
          "old_text": "str2txid(str, &endp)",
          "new_text": null,
          "old_line_content": "\txmax = str2txid(str, &endp);",
          "new_line_content": "\t\tgoto bad_format;",
          "content_same": false
        },
        {
          "line": 408,
          "old_api": "initStringInfo",
          "new_api": null,
          "old_text": "initStringInfo(&str)",
          "new_text": null,
          "old_line_content": "\tinitStringInfo(&str);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 410,
          "old_api": "appendStringInfo",
          "new_api": null,
          "old_text": "appendStringInfo(&str, TXID_FMT \":\", snap->xmin)",
          "new_text": null,
          "old_line_content": "\tappendStringInfo(&str, TXID_FMT \":\", snap->xmin);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 415,
          "old_api": "appendStringInfo",
          "new_api": null,
          "old_text": "appendStringInfo(&str, \"%s\" TXID_FMT,\n\t\t\t\t\t\t ((i > 0) ? \",\" : \"\"),\n\t\t\t\t\t\t snap->xip[i])",
          "new_text": null,
          "old_line_content": "\t\tappendStringInfo(&str, \"%s\" TXID_FMT,",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 289,
          "old_api": "buf_init",
          "new_api": null,
          "old_text": "buf_init(xmin, xmax)",
          "new_text": null,
          "old_line_content": "\tbuf = buf_init(xmin, xmax);",
          "new_line_content": "\t\tgoto bad_format;",
          "content_same": false
        },
        {
          "line": 420,
          "old_api": "PG_FREE_IF_COPY",
          "new_api": null,
          "old_text": "PG_FREE_IF_COPY(snap, 0)",
          "new_text": null,
          "old_line_content": "\tPG_FREE_IF_COPY(snap, 0);",
          "new_line_content": "\t\t\t\t\t\t snap->xip[i]);",
          "content_same": false
        },
        {
          "line": 422,
          "old_api": "PG_RETURN_CSTRING",
          "new_api": null,
          "old_text": "PG_RETURN_CSTRING(str.data)",
          "new_text": null,
          "old_line_content": "\tPG_RETURN_CSTRING(str.data);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 295,
          "old_api": "str2txid",
          "new_api": null,
          "old_text": "str2txid(str, &endp)",
          "new_text": null,
          "old_line_content": "\t\tval = str2txid(str, &endp);",
          "new_line_content": "\twhile (*str != '\\0')",
          "content_same": false
        },
        {
          "line": 302,
          "old_api": "buf_add_txid",
          "new_api": null,
          "old_text": "buf_add_txid(buf, val)",
          "new_text": null,
          "old_line_content": "\t\tbuf_add_txid(buf, val);",
          "new_line_content": "\t\tif (val < xmin || val >= xmax || val <= last_val)",
          "content_same": false
        },
        {
          "line": 434,
          "old_api": "PG_GETARG_INT64",
          "new_api": null,
          "old_text": "PG_GETARG_INT64(0)",
          "new_text": null,
          "old_line_content": "\ttxid value = PG_GETARG_INT64(0);",
          "new_line_content": "Datum",
          "content_same": false
        },
        {
          "line": 435,
          "old_api": "PG_GETARG_VARLENA_P",
          "new_api": null,
          "old_text": "PG_GETARG_VARLENA_P(1)",
          "new_text": null,
          "old_line_content": "\tTxidSnapshot *snap = (TxidSnapshot *) PG_GETARG_VARLENA_P(1);",
          "new_line_content": "txid_visible_in_snapshot(PG_FUNCTION_ARGS)",
          "content_same": false
        },
        {
          "line": 311,
          "old_api": "buf_finalize",
          "new_api": null,
          "old_text": "buf_finalize(buf)",
          "new_text": null,
          "old_line_content": "\treturn buf_finalize(buf);",
          "new_line_content": "\t\t\tgoto bad_format;",
          "content_same": false
        },
        {
          "line": 440,
          "old_api": "PG_FREE_IF_COPY",
          "new_api": null,
          "old_text": "PG_FREE_IF_COPY(snap, 1)",
          "new_text": null,
          "old_line_content": "\tPG_FREE_IF_COPY(snap, 1);",
          "new_line_content": "\t",
          "content_same": false
        },
        {
          "line": 452,
          "old_api": "PG_GETARG_VARLENA_P",
          "new_api": null,
          "old_text": "PG_GETARG_VARLENA_P(0)",
          "new_text": null,
          "old_line_content": "\tTxidSnapshot *snap = (TxidSnapshot *) PG_GETARG_VARLENA_P(0);",
          "new_line_content": "Datum",
          "content_same": false
        },
        {
          "line": 454,
          "old_api": "PG_FREE_IF_COPY",
          "new_api": null,
          "old_text": "PG_FREE_IF_COPY(snap, 0)",
          "new_text": null,
          "old_line_content": "\tPG_FREE_IF_COPY(snap, 0);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 333,
          "old_api": "load_xid_epoch",
          "new_api": null,
          "old_text": "load_xid_epoch(&state)",
          "new_text": null,
          "old_line_content": "\tload_xid_epoch(&state);",
          "new_line_content": "\ttxid val;",
          "content_same": false
        },
        {
          "line": 335,
          "old_api": "GetTopTransactionId",
          "new_api": null,
          "old_text": "GetTopTransactionId()",
          "new_text": null,
          "old_line_content": "\tval = convert_xid(GetTopTransactionId(), &state);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 337,
          "old_api": "PG_RETURN_INT64",
          "new_api": null,
          "old_text": "PG_RETURN_INT64(val)",
          "new_text": null,
          "old_line_content": "\tPG_RETURN_INT64(val);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 466,
          "old_api": "PG_GETARG_VARLENA_P",
          "new_api": null,
          "old_text": "PG_GETARG_VARLENA_P(0)",
          "new_text": null,
          "old_line_content": "\tTxidSnapshot *snap = (TxidSnapshot *) PG_GETARG_VARLENA_P(0);",
          "new_line_content": "Datum",
          "content_same": false
        },
        {
          "line": 468,
          "old_api": "PG_FREE_IF_COPY",
          "new_api": null,
          "old_text": "PG_FREE_IF_COPY(snap, 0)",
          "new_text": null,
          "old_line_content": "\tPG_FREE_IF_COPY(snap, 0);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 355,
          "old_api": "elog",
          "new_api": null,
          "old_text": "elog(ERROR, \"get_current_snapshot: SerializableSnapshot == NULL\")",
          "new_text": null,
          "old_line_content": "\t\telog(ERROR, \"get_current_snapshot: SerializableSnapshot == NULL\");",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 357,
          "old_api": "load_xid_epoch",
          "new_api": null,
          "old_text": "load_xid_epoch(&state)",
          "new_text": null,
          "old_line_content": "\tload_xid_epoch(&state);",
          "new_line_content": "\tif (cur == NULL)",
          "content_same": false
        },
        {
          "line": 485,
          "old_api": "SRF_IS_FIRSTCALL",
          "new_api": null,
          "old_text": "SRF_IS_FIRSTCALL()",
          "new_text": null,
          "old_line_content": "\tif (SRF_IS_FIRSTCALL()) {",
          "new_line_content": "\ttxid value;",
          "content_same": false
        },
        {
          "line": 361,
          "old_api": "TXID_SNAPSHOT_SIZE",
          "new_api": null,
          "old_text": "TXID_SNAPSHOT_SIZE(nxip)",
          "new_text": null,
          "old_line_content": "\tsize = TXID_SNAPSHOT_SIZE(nxip);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 362,
          "old_api": "palloc",
          "new_api": null,
          "old_text": "palloc(size)",
          "new_text": null,
          "old_line_content": "\tsnap = palloc(size);",
          "new_line_content": "\t/* allocate */",
          "content_same": false
        },
        {
          "line": 363,
          "old_api": "SET_VARSIZE",
          "new_api": null,
          "old_text": "SET_VARSIZE(snap, size)",
          "new_text": null,
          "old_line_content": "\tSET_VARSIZE(snap, size);",
          "new_line_content": "\tnxip = cur->xcnt;",
          "content_same": false
        },
        {
          "line": 492,
          "old_api": "VARSIZE",
          "new_api": null,
          "old_text": "VARSIZE(arg)",
          "new_text": null,
          "old_line_content": "\t\tsnap = MemoryContextAlloc(fctx->multi_call_memory_ctx, VARSIZE(arg));",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 493,
          "old_api": "VARSIZE",
          "new_api": null,
          "old_text": "VARSIZE(arg)",
          "new_text": null,
          "old_line_content": "\t\tmemcpy(snap, arg, VARSIZE(arg));",
          "new_line_content": "\t\t/* make a copy of user snapshot */",
          "content_same": false
        },
        {
          "line": 367,
          "old_api": "convert_xid",
          "new_api": null,
          "old_text": "convert_xid(cur->xmax, &state)",
          "new_text": null,
          "old_line_content": "\tsnap->xmax = convert_xid(cur->xmax, &state);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 500,
          "old_api": "SRF_PERCALL_SETUP",
          "new_api": null,
          "old_text": "SRF_PERCALL_SETUP()",
          "new_text": null,
          "old_line_content": "\tfctx = SRF_PERCALL_SETUP();",
          "new_line_content": "\t}",
          "content_same": false
        },
        {
          "line": 375,
          "old_api": "PG_RETURN_POINTER",
          "new_api": null,
          "old_text": "PG_RETURN_POINTER(snap)",
          "new_text": null,
          "old_line_content": "\tPG_RETURN_POINTER(snap);",
          "new_line_content": "\t/* we want them guaranteed ascending order */",
          "content_same": false
        },
        {
          "line": 504,
          "old_api": "Int64GetDatum",
          "new_api": null,
          "old_text": "Int64GetDatum(value)",
          "new_text": null,
          "old_line_content": "\t\tSRF_RETURN_NEXT(fctx, Int64GetDatum(value));",
          "new_line_content": "\tsnap = fctx->user_fctx;",
          "content_same": false
        },
        {
          "line": 506,
          "old_api": "SRF_RETURN_DONE",
          "new_api": null,
          "old_text": "SRF_RETURN_DONE(fctx)",
          "new_text": null,
          "old_line_content": "\t\tSRF_RETURN_DONE(fctx);",
          "new_line_content": "\t\tvalue = snap->xip[fctx->call_cntr];",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 11,
      "total_additions": 38,
      "total_deletions": 38,
      "total_api_changes": 87
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 11,
        "api_related_lines": 87,
        "non_api_lines": 11,
        "non_api_line_numbers": [
          256,
          257,
          237,
          238,
          240,
          242,
          244,
          245,
          246,
          250,
          251
        ]
      }
    },
    "api_calls_before": 73,
    "api_calls_after": 73,
    "diff_info": {
      "added_lines": 7,
      "removed_lines": 4,
      "total_diff_lines": 37
    }
  }
}