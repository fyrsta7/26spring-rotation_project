{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/postgres/modified_file/08cdb079d4a8a82c687321e9ffe0a3d3fbcc0551",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/postgres/modified_file/08cdb079d4a8a82c687321e9ffe0a3d3fbcc0551/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/postgres/modified_file/08cdb079d4a8a82c687321e9ffe0a3d3fbcc0551/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/postgres/modified_file/08cdb079d4a8a82c687321e9ffe0a3d3fbcc0551/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 333,
          "old_api": "LookupTupleHashEntry_internal",
          "new_api": "TupleHashTableHash_internal",
          "old_text": "LookupTupleHashEntry_internal(hashtable, slot, isnew, local_hash)",
          "new_text": "TupleHashTableHash_internal(hashtable->hashtab, NULL)",
          "old_line_content": "\tentry = LookupTupleHashEntry_internal(hashtable, slot, isnew, local_hash);",
          "new_line_content": "\tlocal_hash = TupleHashTableHash_internal(hashtable->hashtab, NULL);",
          "content_same": false
        },
        {
          "line": 387,
          "old_api": "Assert",
          "new_api": "LookupTupleHashEntry_internal",
          "old_text": "Assert(entry == NULL || entry->hash == hash)",
          "new_text": "LookupTupleHashEntry_internal(hashtable, slot, isnew, hash)",
          "old_line_content": "\tAssert(entry == NULL || entry->hash == hash);",
          "new_line_content": "\tentry = LookupTupleHashEntry_internal(hashtable, slot, isnew, hash);",
          "content_same": false
        },
        {
          "line": 423,
          "old_api": "MemoryContextSwitchTo",
          "new_api": "tuplehash_lookup",
          "old_text": "MemoryContextSwitchTo(oldContext)",
          "new_text": "tuplehash_lookup(hashtable->hashtab, key)",
          "old_line_content": "\tMemoryContextSwitchTo(oldContext);",
          "new_line_content": "\tentry = tuplehash_lookup(hashtable->hashtab, key);",
          "content_same": false
        },
        {
          "line": 463,
          "old_api": "ExecEvalExpr",
          "new_api": "ExecStoreMinimalTuple",
          "old_text": "ExecEvalExpr(hashtable->tab_hash_expr,\n\t\t\t\t\t\t\t\t\t\t\t  hashtable->exprcontext,\n\t\t\t\t\t\t\t\t\t\t\t  &isnull)",
          "new_text": "ExecStoreMinimalTuple(tuple, slot, false)",
          "old_line_content": "\t\thashkey = DatumGetUInt32(ExecEvalExpr(hashtable->tab_hash_expr,",
          "new_line_content": "\t\tExecStoreMinimalTuple(tuple, slot, false);",
          "content_same": false
        },
        {
          "line": 542,
          "old_api": "Assert",
          "new_api": "ExecStoreMinimalTuple",
          "old_text": "Assert(tuple2 == NULL)",
          "new_text": "ExecStoreMinimalTuple(tuple1, slot1, false)",
          "old_line_content": "\tAssert(tuple2 == NULL);",
          "new_line_content": "\tExecStoreMinimalTuple(tuple1, slot1, false);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 512,
          "old_api": null,
          "new_api": "ExecCopySlotMinimalTuple",
          "old_text": null,
          "new_text": "ExecCopySlotMinimalTuple(slot)",
          "old_line_content": "\t\t}",
          "new_line_content": "\t\t\tentry->firstTuple = ExecCopySlotMinimalTuple(slot);",
          "content_same": false
        },
        {
          "line": 388,
          "old_api": null,
          "new_api": "Assert",
          "old_text": null,
          "new_text": "Assert(entry == NULL || entry->hash == hash)",
          "old_line_content": "",
          "new_line_content": "\tAssert(entry == NULL || entry->hash == hash);",
          "content_same": false
        },
        {
          "line": 517,
          "old_api": null,
          "new_api": "tuplehash_lookup_hash",
          "old_text": null,
          "new_text": "tuplehash_lookup_hash(hashtable->hashtab, key, hash)",
          "old_line_content": "\t}",
          "new_line_content": "\t\tentry = tuplehash_lookup_hash(hashtable->hashtab, key, hash);",
          "content_same": false
        },
        {
          "line": 390,
          "old_api": null,
          "new_api": "MemoryContextSwitchTo",
          "old_text": null,
          "new_text": "MemoryContextSwitchTo(oldContext)",
          "old_line_content": "",
          "new_line_content": "\tMemoryContextSwitchTo(oldContext);",
          "content_same": false
        },
        {
          "line": 277,
          "old_api": null,
          "new_api": "BuildTupleHashTableExt",
          "old_text": null,
          "new_text": "BuildTupleHashTableExt(parent,\n\t\t\t\t\t\t\t\t  inputDesc,\n\t\t\t\t\t\t\t\t  NULL,\n\t\t\t\t\t\t\t\t  numCols, keyColIdx,\n\t\t\t\t\t\t\t\t  eqfuncoids,\n\t\t\t\t\t\t\t\t  hashfunctions,\n\t\t\t\t\t\t\t\t  collations,\n\t\t\t\t\t\t\t\t  nbuckets, additionalsize,\n\t\t\t\t\t\t\t\t  tablecxt,\n\t\t\t\t\t\t\t\t  tablecxt,\n\t\t\t\t\t\t\t\t  tempcxt,\n\t\t\t\t\t\t\t\t  use_variable_hash_iv)",
          "old_line_content": "\t\t\t\t\t\t\t\t  inputDesc,",
          "new_line_content": "\treturn BuildTupleHashTableExt(parent,",
          "content_same": false
        },
        {
          "line": 540,
          "old_api": null,
          "new_api": "Assert",
          "old_text": null,
          "new_text": "Assert(tuple1 != NULL)",
          "old_line_content": "\tslot1 = hashtable->tableslot;",
          "new_line_content": "\tAssert(tuple1 != NULL);",
          "content_same": false
        },
        {
          "line": 414,
          "old_api": null,
          "new_api": "MemoryContextSwitchTo",
          "old_text": null,
          "new_text": "MemoryContextSwitchTo(hashtable->tempcxt)",
          "old_line_content": "",
          "new_line_content": "\toldContext = MemoryContextSwitchTo(hashtable->tempcxt);",
          "content_same": false
        },
        {
          "line": 543,
          "old_api": null,
          "new_api": "Assert",
          "old_text": null,
          "new_text": "Assert(tuple2 == NULL)",
          "old_line_content": "\tslot2 = hashtable->inputslot;",
          "new_line_content": "\tAssert(tuple2 == NULL);",
          "content_same": false
        },
        {
          "line": 549,
          "old_api": null,
          "new_api": "ExecQualAndReset",
          "old_text": null,
          "new_text": "ExecQualAndReset(hashtable->cur_eq_func, econtext)",
          "old_line_content": "}",
          "new_line_content": "\treturn !ExecQualAndReset(hashtable->cur_eq_func, econtext);",
          "content_same": false
        },
        {
          "line": 424,
          "old_api": null,
          "new_api": "MemoryContextSwitchTo",
          "old_text": null,
          "new_text": "MemoryContextSwitchTo(oldContext)",
          "old_line_content": "",
          "new_line_content": "\tMemoryContextSwitchTo(oldContext);",
          "content_same": false
        },
        {
          "line": 299,
          "old_api": null,
          "new_api": "tuplehash_reset",
          "old_text": null,
          "new_text": "tuplehash_reset(hashtable->hashtab)",
          "old_line_content": "}",
          "new_line_content": "\ttuplehash_reset(hashtable->hashtab);",
          "content_same": false
        },
        {
          "line": 450,
          "old_api": null,
          "new_api": "ExecEvalExpr",
          "old_text": null,
          "new_text": "ExecEvalExpr(hashtable->in_hash_expr,\n\t\t\t\t\t\t\t\t\t\t\t  hashtable->exprcontext,\n\t\t\t\t\t\t\t\t\t\t\t  &isnull)",
          "old_line_content": "\t\t\t\t\t\t\t\t\t\t\t  hashtable->exprcontext,",
          "new_line_content": "\t\thashkey = DatumGetUInt32(ExecEvalExpr(hashtable->in_hash_expr,",
          "content_same": false
        },
        {
          "line": 326,
          "old_api": null,
          "new_api": "MemoryContextSwitchTo",
          "old_text": null,
          "new_text": "MemoryContextSwitchTo(hashtable->tempcxt)",
          "old_line_content": "",
          "new_line_content": "\toldContext = MemoryContextSwitchTo(hashtable->tempcxt);",
          "content_same": false
        },
        {
          "line": 334,
          "old_api": null,
          "new_api": "LookupTupleHashEntry_internal",
          "old_text": null,
          "new_text": "LookupTupleHashEntry_internal(hashtable, slot, isnew, local_hash)",
          "old_line_content": "",
          "new_line_content": "\tentry = LookupTupleHashEntry_internal(hashtable, slot, isnew, local_hash);",
          "content_same": false
        },
        {
          "line": 464,
          "old_api": null,
          "new_api": "ExecEvalExpr",
          "old_text": null,
          "new_text": "ExecEvalExpr(hashtable->tab_hash_expr,\n\t\t\t\t\t\t\t\t\t\t\t  hashtable->exprcontext,\n\t\t\t\t\t\t\t\t\t\t\t  &isnull)",
          "old_line_content": "\t\t\t\t\t\t\t\t\t\t\t  hashtable->exprcontext,",
          "new_line_content": "\t\thashkey = DatumGetUInt32(ExecEvalExpr(hashtable->tab_hash_expr,",
          "content_same": false
        },
        {
          "line": 339,
          "old_api": null,
          "new_api": "Assert",
          "old_text": null,
          "new_text": "Assert(entry == NULL || entry->hash == local_hash)",
          "old_line_content": "",
          "new_line_content": "\tAssert(entry == NULL || entry->hash == local_hash);",
          "content_same": false
        },
        {
          "line": 341,
          "old_api": null,
          "new_api": "MemoryContextSwitchTo",
          "old_text": null,
          "new_text": "MemoryContextSwitchTo(oldContext)",
          "old_line_content": "",
          "new_line_content": "\tMemoryContextSwitchTo(oldContext);",
          "content_same": false
        },
        {
          "line": 474,
          "old_api": null,
          "new_api": "murmurhash32",
          "old_text": null,
          "new_text": "murmurhash32(hashkey)",
          "old_line_content": "}",
          "new_line_content": "\treturn murmurhash32(hashkey);",
          "content_same": false
        },
        {
          "line": 359,
          "old_api": null,
          "new_api": "MemoryContextSwitchTo",
          "old_text": null,
          "new_text": "MemoryContextSwitchTo(hashtable->tempcxt)",
          "old_line_content": "",
          "new_line_content": "\toldContext = MemoryContextSwitchTo(hashtable->tempcxt);",
          "content_same": false
        },
        {
          "line": 361,
          "old_api": null,
          "new_api": "TupleHashTableHash_internal",
          "old_text": null,
          "new_text": "TupleHashTableHash_internal(hashtable->hashtab, NULL)",
          "old_line_content": "",
          "new_line_content": "\thash = TupleHashTableHash_internal(hashtable->hashtab, NULL);",
          "content_same": false
        },
        {
          "line": 363,
          "old_api": null,
          "new_api": "MemoryContextSwitchTo",
          "old_text": null,
          "new_text": "MemoryContextSwitchTo(oldContext)",
          "old_line_content": "",
          "new_line_content": "\tMemoryContextSwitchTo(oldContext);",
          "content_same": false
        },
        {
          "line": 497,
          "old_api": null,
          "new_api": "tuplehash_insert_hash",
          "old_text": null,
          "new_text": "tuplehash_insert_hash(hashtable->hashtab, key, hash, &found)",
          "old_line_content": "",
          "new_line_content": "\t\tentry = tuplehash_insert_hash(hashtable->hashtab, key, hash, &found);",
          "content_same": false
        },
        {
          "line": 252,
          "old_api": null,
          "new_api": "CreateStandaloneExprContext",
          "old_text": null,
          "new_text": "CreateStandaloneExprContext()",
          "old_line_content": "",
          "new_line_content": "\thashtable->exprcontext = CreateStandaloneExprContext();",
          "content_same": false
        },
        {
          "line": 254,
          "old_api": null,
          "new_api": "MemoryContextSwitchTo",
          "old_text": null,
          "new_text": "MemoryContextSwitchTo(oldcontext)",
          "old_line_content": "",
          "new_line_content": "\tMemoryContextSwitchTo(oldcontext);",
          "content_same": false
        },
        {
          "line": 380,
          "old_api": null,
          "new_api": "MemoryContextSwitchTo",
          "old_text": null,
          "new_text": "MemoryContextSwitchTo(hashtable->tempcxt)",
          "old_line_content": "",
          "new_line_content": "\toldContext = MemoryContextSwitchTo(hashtable->tempcxt);",
          "content_same": false
        },
        {
          "line": 510,
          "old_api": null,
          "new_api": "MemoryContextSwitchTo",
          "old_text": null,
          "new_text": "MemoryContextSwitchTo(hashtable->tablecxt)",
          "old_line_content": "\t\t\t/* Copy the first tuple into the table context */",
          "new_line_content": "\t\t\tMemoryContextSwitchTo(hashtable->tablecxt);",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 386,
          "old_api": "LookupTupleHashEntry_internal",
          "new_api": null,
          "old_text": "LookupTupleHashEntry_internal(hashtable, slot, isnew, hash)",
          "new_text": null,
          "old_line_content": "\tentry = LookupTupleHashEntry_internal(hashtable, slot, isnew, hash);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 516,
          "old_api": "tuplehash_lookup_hash",
          "new_api": null,
          "old_text": "tuplehash_lookup_hash(hashtable->hashtab, key, hash)",
          "new_text": null,
          "old_line_content": "\t\tentry = tuplehash_lookup_hash(hashtable->hashtab, key, hash);",
          "new_line_content": "\t{",
          "content_same": false
        },
        {
          "line": 389,
          "old_api": "MemoryContextSwitchTo",
          "new_api": null,
          "old_text": "MemoryContextSwitchTo(oldContext)",
          "new_text": null,
          "old_line_content": "\tMemoryContextSwitchTo(oldContext);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 276,
          "old_api": "BuildTupleHashTableExt",
          "new_api": null,
          "old_text": "BuildTupleHashTableExt(parent,\n\t\t\t\t\t\t\t\t  inputDesc,\n\t\t\t\t\t\t\t\t  NULL,\n\t\t\t\t\t\t\t\t  numCols, keyColIdx,\n\t\t\t\t\t\t\t\t  eqfuncoids,\n\t\t\t\t\t\t\t\t  hashfunctions,\n\t\t\t\t\t\t\t\t  collations,\n\t\t\t\t\t\t\t\t  nbuckets, additionalsize,\n\t\t\t\t\t\t\t\t  tablecxt,\n\t\t\t\t\t\t\t\t  tablecxt,\n\t\t\t\t\t\t\t\t  tempcxt,\n\t\t\t\t\t\t\t\t  use_variable_hash_iv)",
          "new_text": null,
          "old_line_content": "\treturn BuildTupleHashTableExt(parent,",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 539,
          "old_api": "Assert",
          "new_api": null,
          "old_text": "Assert(tuple1 != NULL)",
          "new_text": null,
          "old_line_content": "\tAssert(tuple1 != NULL);",
          "new_line_content": "\t */",
          "content_same": false
        },
        {
          "line": 541,
          "old_api": "ExecStoreMinimalTuple",
          "new_api": null,
          "old_text": "ExecStoreMinimalTuple(tuple1, slot1, false)",
          "new_text": null,
          "old_line_content": "\tExecStoreMinimalTuple(tuple1, slot1, false);",
          "new_line_content": "\tslot1 = hashtable->tableslot;",
          "content_same": false
        },
        {
          "line": 413,
          "old_api": "MemoryContextSwitchTo",
          "new_api": null,
          "old_text": "MemoryContextSwitchTo(hashtable->tempcxt)",
          "new_text": null,
          "old_line_content": "\toldContext = MemoryContextSwitchTo(hashtable->tempcxt);",
          "new_line_content": "\t/* Need to run the hash functions in short-lived context */",
          "content_same": false
        },
        {
          "line": 548,
          "old_api": "ExecQualAndReset",
          "new_api": null,
          "old_text": "ExecQualAndReset(hashtable->cur_eq_func, econtext)",
          "new_text": null,
          "old_line_content": "\treturn !ExecQualAndReset(hashtable->cur_eq_func, econtext);",
          "new_line_content": "\tecontext->ecxt_outertuple = slot1;",
          "content_same": false
        },
        {
          "line": 422,
          "old_api": "tuplehash_lookup",
          "new_api": null,
          "old_text": "tuplehash_lookup(hashtable->hashtab, key)",
          "new_text": null,
          "old_line_content": "\tentry = tuplehash_lookup(hashtable->hashtab, key);",
          "new_line_content": "\tkey = NULL;\t\t\t\t\t/* flag to reference inputslot */",
          "content_same": false
        },
        {
          "line": 298,
          "old_api": "tuplehash_reset",
          "new_api": null,
          "old_text": "tuplehash_reset(hashtable->hashtab)",
          "new_text": null,
          "old_line_content": "\ttuplehash_reset(hashtable->hashtab);",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 449,
          "old_api": "ExecEvalExpr",
          "new_api": null,
          "old_text": "ExecEvalExpr(hashtable->in_hash_expr,\n\t\t\t\t\t\t\t\t\t\t\t  hashtable->exprcontext,\n\t\t\t\t\t\t\t\t\t\t\t  &isnull)",
          "new_text": null,
          "old_line_content": "\t\thashkey = DatumGetUInt32(ExecEvalExpr(hashtable->in_hash_expr,",
          "new_line_content": "\t\thashtable->exprcontext->ecxt_innertuple = hashtable->inputslot;",
          "content_same": false
        },
        {
          "line": 325,
          "old_api": "MemoryContextSwitchTo",
          "new_api": null,
          "old_text": "MemoryContextSwitchTo(hashtable->tempcxt)",
          "new_text": null,
          "old_line_content": "\toldContext = MemoryContextSwitchTo(hashtable->tempcxt);",
          "new_line_content": "\t/* Need to run the hash functions in short-lived context */",
          "content_same": false
        },
        {
          "line": 332,
          "old_api": "TupleHashTableHash_internal",
          "new_api": null,
          "old_text": "TupleHashTableHash_internal(hashtable->hashtab, NULL)",
          "new_text": null,
          "old_line_content": "\tlocal_hash = TupleHashTableHash_internal(hashtable->hashtab, NULL);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 462,
          "old_api": "ExecStoreMinimalTuple",
          "new_api": null,
          "old_text": "ExecStoreMinimalTuple(tuple, slot, false)",
          "new_text": null,
          "old_line_content": "\t\tExecStoreMinimalTuple(tuple, slot, false);",
          "new_line_content": "\t\tslot = hashtable->exprcontext->ecxt_innertuple = hashtable->tableslot;",
          "content_same": false
        },
        {
          "line": 338,
          "old_api": "Assert",
          "new_api": null,
          "old_text": "Assert(entry == NULL || entry->hash == local_hash)",
          "new_text": null,
          "old_line_content": "\tAssert(entry == NULL || entry->hash == local_hash);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 340,
          "old_api": "MemoryContextSwitchTo",
          "new_api": null,
          "old_text": "MemoryContextSwitchTo(oldContext)",
          "new_text": null,
          "old_line_content": "\tMemoryContextSwitchTo(oldContext);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 473,
          "old_api": "murmurhash32",
          "new_api": null,
          "old_text": "murmurhash32(hashkey)",
          "new_text": null,
          "old_line_content": "\treturn murmurhash32(hashkey);",
          "new_line_content": "\t */",
          "content_same": false
        },
        {
          "line": 358,
          "old_api": "MemoryContextSwitchTo",
          "new_api": null,
          "old_text": "MemoryContextSwitchTo(hashtable->tempcxt)",
          "new_text": null,
          "old_line_content": "\toldContext = MemoryContextSwitchTo(hashtable->tempcxt);",
          "new_line_content": "\t/* Need to run the hash functions in short-lived context */",
          "content_same": false
        },
        {
          "line": 360,
          "old_api": "TupleHashTableHash_internal",
          "new_api": null,
          "old_text": "TupleHashTableHash_internal(hashtable->hashtab, NULL)",
          "new_text": null,
          "old_line_content": "\thash = TupleHashTableHash_internal(hashtable->hashtab, NULL);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 362,
          "old_api": "MemoryContextSwitchTo",
          "new_api": null,
          "old_text": "MemoryContextSwitchTo(oldContext)",
          "new_text": null,
          "old_line_content": "\tMemoryContextSwitchTo(oldContext);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 251,
          "old_api": "CreateStandaloneExprContext",
          "new_api": null,
          "old_text": "CreateStandaloneExprContext()",
          "new_text": null,
          "old_line_content": "\thashtable->exprcontext = CreateStandaloneExprContext();",
          "new_line_content": "\t */",
          "content_same": false
        },
        {
          "line": 496,
          "old_api": "tuplehash_insert_hash",
          "new_api": null,
          "old_text": "tuplehash_insert_hash(hashtable->hashtab, key, hash, &found)",
          "new_text": null,
          "old_line_content": "\t\tentry = tuplehash_insert_hash(hashtable->hashtab, key, hash, &found);",
          "new_line_content": "\t{",
          "content_same": false
        },
        {
          "line": 253,
          "old_api": "MemoryContextSwitchTo",
          "new_api": null,
          "old_text": "MemoryContextSwitchTo(oldcontext)",
          "new_text": null,
          "old_line_content": "\tMemoryContextSwitchTo(oldcontext);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 379,
          "old_api": "MemoryContextSwitchTo",
          "new_api": null,
          "old_text": "MemoryContextSwitchTo(hashtable->tempcxt)",
          "new_text": null,
          "old_line_content": "\toldContext = MemoryContextSwitchTo(hashtable->tempcxt);",
          "new_line_content": "\t/* Need to run the hash functions in short-lived context */",
          "content_same": false
        },
        {
          "line": 509,
          "old_api": "MemoryContextSwitchTo",
          "new_api": null,
          "old_text": "MemoryContextSwitchTo(hashtable->tablecxt)",
          "new_text": null,
          "old_line_content": "\t\t\tMemoryContextSwitchTo(hashtable->tablecxt);",
          "new_line_content": "\t\t\tentry->additional = NULL;",
          "content_same": false
        },
        {
          "line": 511,
          "old_api": "ExecCopySlotMinimalTuple",
          "new_api": null,
          "old_text": "ExecCopySlotMinimalTuple(slot)",
          "new_text": null,
          "old_line_content": "\t\t\tentry->firstTuple = ExecCopySlotMinimalTuple(slot);",
          "new_line_content": "\t\t\t/* Copy the first tuple into the table context */",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 5,
      "total_additions": 26,
      "total_deletions": 26,
      "total_api_changes": 57
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 2,
        "api_related_lines": 57,
        "non_api_lines": 2,
        "non_api_line_numbers": [
          240,
          241
        ]
      }
    },
    "api_calls_before": 53,
    "api_calls_after": 53,
    "diff_info": {
      "added_lines": 2,
      "removed_lines": 1,
      "total_diff_lines": 15
    }
  }
}