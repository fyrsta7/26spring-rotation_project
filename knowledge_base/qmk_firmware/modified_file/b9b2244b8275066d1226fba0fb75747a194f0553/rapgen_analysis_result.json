{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/qmk_firmware/modified_file/b9b2244b8275066d1226fba0fb75747a194f0553",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/qmk_firmware/modified_file/b9b2244b8275066d1226fba0fb75747a194f0553/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/qmk_firmware/modified_file/b9b2244b8275066d1226fba0fb75747a194f0553/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/qmk_firmware/modified_file/b9b2244b8275066d1226fba0fb75747a194f0553/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 118,
          "old_api": "matrix_setup",
          "new_api": "ps2_mouse_init",
          "old_text": "matrix_setup()",
          "new_text": "ps2_mouse_init()",
          "old_line_content": "    matrix_setup();",
          "new_line_content": "    ps2_mouse_init();",
          "content_same": false
        },
        {
          "line": 233,
          "old_api": "host_keyboard_leds",
          "new_api": "debug",
          "old_text": "host_keyboard_leds()",
          "new_text": "debug(\"\\n\")",
          "old_line_content": "        led_status = host_keyboard_leds();",
          "new_line_content": "    if (debug_keyboard) { debug(\"keyboard_set_led: \"); debug_hex8(leds); debug(\"\\n\"); }",
          "content_same": false
        },
        {
          "line": 234,
          "old_api": "keyboard_set_leds",
          "new_api": "led_set",
          "old_text": "keyboard_set_leds(led_status)",
          "new_text": "led_set(leds)",
          "old_line_content": "        keyboard_set_leds(led_status);",
          "new_line_content": "    led_set(leds);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 129,
          "old_api": null,
          "new_api": "magic",
          "old_text": null,
          "new_text": "magic()",
          "old_line_content": "#endif",
          "new_line_content": "    magic();",
          "content_same": false
        },
        {
          "line": 132,
          "old_api": null,
          "new_api": "backlight_init",
          "old_text": null,
          "new_text": "backlight_init()",
          "old_line_content": "#endif",
          "new_line_content": "    backlight_init();",
          "content_same": false
        },
        {
          "line": 135,
          "old_api": null,
          "new_api": "rgblight_init",
          "old_text": null,
          "new_text": "rgblight_init()",
          "old_line_content": "#else",
          "new_line_content": "    rgblight_init();",
          "content_same": false
        },
        {
          "line": 138,
          "old_api": null,
          "new_api": "fauxclicky_init",
          "old_text": null,
          "new_text": "fauxclicky_init()",
          "old_line_content": "#ifdef BACKLIGHT_ENABLE",
          "new_line_content": "    fauxclicky_init();",
          "content_same": false
        },
        {
          "line": 159,
          "old_api": null,
          "new_api": "matrix_scan",
          "old_text": null,
          "new_text": "matrix_scan()",
          "old_line_content": "#ifdef MATRIX_HAS_GHOST",
          "new_line_content": "    matrix_scan();",
          "content_same": false
        },
        {
          "line": 161,
          "old_api": null,
          "new_api": "matrix_get_row",
          "old_text": null,
          "new_text": "matrix_get_row(r)",
          "old_line_content": "#endif",
          "new_line_content": "        matrix_row = matrix_get_row(r);",
          "content_same": false
        },
        {
          "line": 165,
          "old_api": null,
          "new_api": "has_ghost_in_row",
          "old_text": null,
          "new_text": "has_ghost_in_row(r, matrix_row)",
          "old_line_content": "",
          "new_line_content": "            if (has_ghost_in_row(r, matrix_row)) {",
          "content_same": false
        },
        {
          "line": 178,
          "old_api": null,
          "new_api": "matrix_print",
          "old_text": null,
          "new_text": "matrix_print()",
          "old_line_content": "                //    matrix_print();",
          "new_line_content": "            if (debug_matrix) matrix_print();",
          "content_same": false
        },
        {
          "line": 181,
          "old_api": null,
          "new_api": "action_exec",
          "old_text": null,
          "new_text": "action_exec((keyevent_t){\n                        .key = (keypos_t){ .row = r, .col = c },\n                        .pressed = (matrix_row & ((matrix_row_t)1<<c)),\n                        .time = (timer_read() | 1) /* time should not be 0 */\n                    })",
          "old_line_content": "                continue;",
          "new_line_content": "                    action_exec((keyevent_t){",
          "content_same": false
        },
        {
          "line": 184,
          "old_api": null,
          "new_api": "timer_read",
          "old_text": null,
          "new_text": "timer_read()",
          "old_line_content": "#endif",
          "new_line_content": "                        .time = (timer_read() | 1) /* time should not be 0 */",
          "content_same": false
        },
        {
          "line": 195,
          "old_api": null,
          "new_api": "action_exec",
          "old_text": null,
          "new_text": "action_exec(TICK)",
          "old_line_content": "                    // process a key per task call",
          "new_line_content": "    action_exec(TICK);",
          "content_same": false
        },
        {
          "line": 201,
          "old_api": null,
          "new_api": "mousekey_task",
          "old_text": null,
          "new_text": "mousekey_task()",
          "old_line_content": "    // call with pseudo tick event when no real key event.",
          "new_line_content": "    mousekey_task();",
          "content_same": false
        },
        {
          "line": 205,
          "old_api": null,
          "new_api": "ps2_mouse_task",
          "old_text": null,
          "new_text": "ps2_mouse_task()",
          "old_line_content": "",
          "new_line_content": "    ps2_mouse_task();",
          "content_same": false
        },
        {
          "line": 209,
          "old_api": null,
          "new_api": "serial_mouse_task",
          "old_text": null,
          "new_text": "serial_mouse_task()",
          "old_line_content": "#endif",
          "new_line_content": "    serial_mouse_task();",
          "content_same": false
        },
        {
          "line": 85,
          "old_api": null,
          "new_api": "get_real_keys",
          "old_text": null,
          "new_text": "get_real_keys(row, rowdata)",
          "old_line_content": "        return true;",
          "new_line_content": "    rowdata = get_real_keys(row, rowdata);",
          "content_same": false
        },
        {
          "line": 213,
          "old_api": null,
          "new_api": "adb_mouse_task",
          "old_text": null,
          "new_text": "adb_mouse_task()",
          "old_line_content": "#endif",
          "new_line_content": "    adb_mouse_task();",
          "content_same": false
        },
        {
          "line": 217,
          "old_api": null,
          "new_api": "serial_link_update",
          "old_text": null,
          "new_text": "serial_link_update()",
          "old_line_content": "#endif",
          "new_line_content": "\tserial_link_update();",
          "content_same": false
        },
        {
          "line": 221,
          "old_api": null,
          "new_api": "host_keyboard_leds",
          "old_text": null,
          "new_text": "host_keyboard_leds()",
          "old_line_content": "#endif",
          "new_line_content": "    visualizer_update(default_layer_state, layer_state, visualizer_get_mods(), host_keyboard_leds());",
          "content_same": false
        },
        {
          "line": 96,
          "old_api": null,
          "new_api": "matrix_get_row",
          "old_text": null,
          "new_text": "matrix_get_row(i)",
          "old_line_content": "    /* No ghost exists when less than 2 keys are down on the row.",
          "new_line_content": "        if (i != row && countones(get_real_keys(i, matrix_get_row(i)) & rowdata)){",
          "content_same": false
        },
        {
          "line": 225,
          "old_api": null,
          "new_api": "host_keyboard_leds",
          "old_text": null,
          "new_text": "host_keyboard_leds()",
          "old_line_content": "#endif",
          "new_line_content": "    if (led_status != host_keyboard_leds()) {",
          "content_same": false
        },
        {
          "line": 226,
          "old_api": null,
          "new_api": "host_keyboard_leds",
          "old_text": null,
          "new_text": "host_keyboard_leds()",
          "old_line_content": "",
          "new_line_content": "        led_status = host_keyboard_leds();",
          "content_same": false
        },
        {
          "line": 227,
          "old_api": null,
          "new_api": "keyboard_set_leds",
          "old_text": null,
          "new_text": "keyboard_set_leds(led_status)",
          "old_line_content": "#ifdef VISUALIZER_ENABLE",
          "new_line_content": "        keyboard_set_leds(led_status);",
          "content_same": false
        },
        {
          "line": 106,
          "old_api": null,
          "new_api": "__attribute__ ((weak))",
          "old_text": null,
          "new_text": "__attribute__ ((weak))",
          "old_line_content": "    }",
          "new_line_content": "__attribute__ ((weak))",
          "content_same": false
        },
        {
          "line": 111,
          "old_api": null,
          "new_api": "matrix_setup",
          "old_text": null,
          "new_text": "matrix_setup()",
          "old_line_content": "",
          "new_line_content": "    matrix_setup();",
          "content_same": false
        },
        {
          "line": 115,
          "old_api": null,
          "new_api": "timer_init",
          "old_text": null,
          "new_text": "timer_init()",
          "old_line_content": "}",
          "new_line_content": "    timer_init();",
          "content_same": false
        },
        {
          "line": 116,
          "old_api": null,
          "new_api": "matrix_init",
          "old_text": null,
          "new_text": "matrix_init()",
          "old_line_content": "",
          "new_line_content": "    matrix_init();",
          "content_same": false
        },
        {
          "line": 121,
          "old_api": null,
          "new_api": "serial_mouse_init",
          "old_text": null,
          "new_text": "serial_mouse_init()",
          "old_line_content": "void keyboard_init(void) {",
          "new_line_content": "    serial_mouse_init();",
          "content_same": false
        },
        {
          "line": 124,
          "old_api": null,
          "new_api": "adb_mouse_init",
          "old_text": null,
          "new_text": "adb_mouse_init()",
          "old_line_content": "#ifdef PS2_MOUSE_ENABLE",
          "new_line_content": "    adb_mouse_init();",
          "content_same": false
        },
        {
          "line": 127,
          "old_api": null,
          "new_api": "bootmagic",
          "old_text": null,
          "new_text": "bootmagic()",
          "old_line_content": "#ifdef SERIAL_MOUSE_ENABLE",
          "new_line_content": "    bootmagic();",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 128,
          "old_api": "serial_mouse_init",
          "new_api": null,
          "old_text": "serial_mouse_init()",
          "new_text": null,
          "old_line_content": "    serial_mouse_init();",
          "new_line_content": "#else",
          "content_same": false
        },
        {
          "line": 131,
          "old_api": "adb_mouse_init",
          "new_api": null,
          "old_text": "adb_mouse_init()",
          "new_text": null,
          "old_line_content": "    adb_mouse_init();",
          "new_line_content": "#ifdef BACKLIGHT_ENABLE",
          "content_same": false
        },
        {
          "line": 134,
          "old_api": "bootmagic",
          "new_api": null,
          "old_text": "bootmagic()",
          "new_text": null,
          "old_line_content": "    bootmagic();",
          "new_line_content": "#ifdef RGBLIGHT_ENABLE",
          "content_same": false
        },
        {
          "line": 136,
          "old_api": "magic",
          "new_api": null,
          "old_text": "magic()",
          "new_text": null,
          "old_line_content": "    magic();",
          "new_line_content": "#endif",
          "content_same": false
        },
        {
          "line": 139,
          "old_api": "backlight_init",
          "new_api": null,
          "old_text": "backlight_init()",
          "new_text": null,
          "old_line_content": "    backlight_init();",
          "new_line_content": "#endif",
          "content_same": false
        },
        {
          "line": 142,
          "old_api": "rgblight_init",
          "new_api": null,
          "old_text": "rgblight_init()",
          "new_text": null,
          "old_line_content": "    rgblight_init();",
          "new_line_content": "#endif",
          "content_same": false
        },
        {
          "line": 145,
          "old_api": "fauxclicky_init",
          "new_api": null,
          "old_text": "fauxclicky_init()",
          "new_text": null,
          "old_line_content": "    fauxclicky_init();",
          "new_line_content": "/*",
          "content_same": false
        },
        {
          "line": 166,
          "old_api": "matrix_scan",
          "new_api": null,
          "old_text": "matrix_scan()",
          "new_text": null,
          "old_line_content": "    matrix_scan();",
          "new_line_content": "                /* Keep track of whether ghosted status has changed for",
          "content_same": false
        },
        {
          "line": 168,
          "old_api": "matrix_get_row",
          "new_api": null,
          "old_text": "matrix_get_row(r)",
          "new_text": null,
          "old_line_content": "        matrix_row = matrix_get_row(r);",
          "new_line_content": "                 * the last key would be lost.",
          "content_same": false
        },
        {
          "line": 172,
          "old_api": "has_ghost_in_row",
          "new_api": null,
          "old_text": "has_ghost_in_row(r, matrix_row)",
          "new_text": null,
          "old_line_content": "            if (has_ghost_in_row(r, matrix_row)) {",
          "new_line_content": "                //}",
          "content_same": false
        },
        {
          "line": 185,
          "old_api": "matrix_print",
          "new_api": null,
          "old_text": "matrix_print()",
          "new_text": null,
          "old_line_content": "            if (debug_matrix) matrix_print();",
          "new_line_content": "                    });",
          "content_same": false
        },
        {
          "line": 188,
          "old_api": "action_exec",
          "new_api": null,
          "old_text": "action_exec((keyevent_t){\n                        .key = (keypos_t){ .row = r, .col = c },\n                        .pressed = (matrix_row & ((matrix_row_t)1<<c)),\n                        .time = (timer_read() | 1) /* time should not be 0 */\n                    })",
          "new_text": null,
          "old_line_content": "                    action_exec((keyevent_t){",
          "new_line_content": "                    // process a key per task call",
          "content_same": false
        },
        {
          "line": 191,
          "old_api": "timer_read",
          "new_api": null,
          "old_text": "timer_read()",
          "new_text": null,
          "old_line_content": "                        .time = (timer_read() | 1) /* time should not be 0 */",
          "new_line_content": "            }",
          "content_same": false
        },
        {
          "line": 202,
          "old_api": "action_exec",
          "new_api": null,
          "old_text": "action_exec(TICK)",
          "new_text": null,
          "old_line_content": "    action_exec(TICK);",
          "new_line_content": "#endif",
          "content_same": false
        },
        {
          "line": 208,
          "old_api": "mousekey_task",
          "new_api": null,
          "old_text": "mousekey_task()",
          "new_text": null,
          "old_line_content": "    mousekey_task();",
          "new_line_content": "#ifdef SERIAL_MOUSE_ENABLE",
          "content_same": false
        },
        {
          "line": 212,
          "old_api": "ps2_mouse_task",
          "new_api": null,
          "old_text": "ps2_mouse_task()",
          "new_text": null,
          "old_line_content": "    ps2_mouse_task();",
          "new_line_content": "#ifdef ADB_MOUSE_ENABLE",
          "content_same": false
        },
        {
          "line": 216,
          "old_api": "serial_mouse_task",
          "new_api": null,
          "old_text": "serial_mouse_task()",
          "new_text": null,
          "old_line_content": "    serial_mouse_task();",
          "new_line_content": "#ifdef SERIAL_LINK_ENABLE",
          "content_same": false
        },
        {
          "line": 92,
          "old_api": "get_real_keys",
          "new_api": null,
          "old_text": "get_real_keys(row, rowdata)",
          "new_text": null,
          "old_line_content": "    rowdata = get_real_keys(row, rowdata);",
          "new_line_content": "    The ghosts will be ignored, they are KC_NO.   */",
          "content_same": false
        },
        {
          "line": 220,
          "old_api": "adb_mouse_task",
          "new_api": null,
          "old_text": "adb_mouse_task()",
          "new_text": null,
          "old_line_content": "    adb_mouse_task();",
          "new_line_content": "#ifdef VISUALIZER_ENABLE",
          "content_same": false
        },
        {
          "line": 224,
          "old_api": "serial_link_update",
          "new_api": null,
          "old_text": "serial_link_update()",
          "new_text": null,
          "old_line_content": "\tserial_link_update();",
          "new_line_content": "    // update LED",
          "content_same": false
        },
        {
          "line": 228,
          "old_api": "host_keyboard_leds",
          "new_api": null,
          "old_text": "host_keyboard_leds()",
          "new_text": null,
          "old_line_content": "    visualizer_update(default_layer_state, layer_state, visualizer_get_mods(), host_keyboard_leds());",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 103,
          "old_api": "matrix_get_row",
          "new_api": null,
          "old_text": "matrix_get_row(i)",
          "new_text": null,
          "old_line_content": "        if (i != row && countones(get_real_keys(i, matrix_get_row(i)) & rowdata)){",
          "new_line_content": "#endif",
          "content_same": false
        },
        {
          "line": 232,
          "old_api": "host_keyboard_leds",
          "new_api": null,
          "old_text": "host_keyboard_leds()",
          "new_text": null,
          "old_line_content": "    if (led_status != host_keyboard_leds()) {",
          "new_line_content": "{",
          "content_same": false
        },
        {
          "line": 240,
          "old_api": "debug",
          "new_api": null,
          "old_text": "debug(\"\\n\")",
          "new_text": null,
          "old_line_content": "    if (debug_keyboard) { debug(\"keyboard_set_led: \"); debug_hex8(leds); debug(\"\\n\"); }",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 113,
          "old_api": "__attribute__ ((weak))",
          "new_api": null,
          "old_text": "__attribute__ ((weak))",
          "new_text": null,
          "old_line_content": "__attribute__ ((weak))",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 241,
          "old_api": "led_set",
          "new_api": null,
          "old_text": "led_set(leds)",
          "new_text": null,
          "old_line_content": "    led_set(leds);",
          "new_line_content": "",
          "content_same": false
        },
        {
          "line": 122,
          "old_api": "timer_init",
          "new_api": null,
          "old_text": "timer_init()",
          "new_text": null,
          "old_line_content": "    timer_init();",
          "new_line_content": "#endif",
          "content_same": false
        },
        {
          "line": 123,
          "old_api": "matrix_init",
          "new_api": null,
          "old_text": "matrix_init()",
          "new_text": null,
          "old_line_content": "    matrix_init();",
          "new_line_content": "#ifdef ADB_MOUSE_ENABLE",
          "content_same": false
        },
        {
          "line": 125,
          "old_api": "ps2_mouse_init",
          "new_api": null,
          "old_text": "ps2_mouse_init()",
          "new_text": null,
          "old_line_content": "    ps2_mouse_init();",
          "new_line_content": "#endif",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 3,
      "total_additions": 29,
      "total_deletions": 29,
      "total_api_changes": 61
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 9,
        "api_related_lines": 61,
        "non_api_lines": 8,
        "non_api_line_numbers": [
          79,
          80,
          81,
          82,
          83,
          84,
          86,
          87
        ]
      }
    },
    "api_calls_before": 39,
    "api_calls_after": 39,
    "diff_info": {
      "added_lines": 2,
      "removed_lines": 9,
      "total_diff_lines": 23
    }
  }
}