{
  "status": "completed",
  "commit_dir": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/qmk_firmware/modified_file/85f4c3ebb456c2d6feebf8934ab014436d7f8f17",
  "file_info": {
    "before_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/qmk_firmware/modified_file/85f4c3ebb456c2d6feebf8934ab014436d7f8f17/before.c",
    "after_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/qmk_firmware/modified_file/85f4c3ebb456c2d6feebf8934ab014436d7f8f17/after.c",
    "diff_file": "/home/zyw/llm_on_code/llm_on_code_optimization/knowledge_base/qmk_firmware/modified_file/85f4c3ebb456c2d6feebf8934ab014436d7f8f17/diff.txt"
  },
  "semgrep_analysis": {
    "is_api_change": false,
    "api_changes": {
      "replacements": [
        {
          "line": 303,
          "old_api": "timer_read",
          "new_api": "action_exec",
          "old_text": "timer_read()",
          "new_text": "action_exec((keyevent_t){\n                            .key = (keypos_t){.row = r, .col = c}, .pressed = (matrix_row & col_mask), .time = (timer_read() | 1) /* time should not be 0 */\n                        })",
          "old_line_content": "                            .key = (keypos_t){.row = r, .col = c}, .pressed = (matrix_row & ((matrix_row_t)1 << c)), .time = (timer_read() | 1) /* time should not be 0 */",
          "new_line_content": "                        action_exec((keyevent_t){",
          "content_same": false
        },
        {
          "line": 378,
          "old_api": "velocikey_decelerate",
          "new_api": "velocikey_enabled",
          "old_text": "velocikey_decelerate()",
          "new_text": "velocikey_enabled()",
          "old_line_content": "        velocikey_decelerate();",
          "new_line_content": "    if (velocikey_enabled()) {",
          "content_same": false
        },
        {
          "line": 385,
          "old_api": "keyboard_set_leds",
          "new_api": "host_keyboard_leds",
          "old_text": "keyboard_set_leds(led_status)",
          "new_text": "host_keyboard_leds()",
          "old_line_content": "        keyboard_set_leds(led_status);",
          "new_line_content": "        led_status = host_keyboard_leds();",
          "content_same": false
        },
        {
          "line": 396,
          "old_api": "debug_hex8",
          "new_api": "debug",
          "old_text": "debug_hex8(leds)",
          "new_text": "debug(\"keyboard_set_led: \")",
          "old_line_content": "        debug_hex8(leds);",
          "new_line_content": "        debug(\"keyboard_set_led: \");",
          "content_same": false
        },
        {
          "line": 397,
          "old_api": "debug",
          "new_api": "debug_hex8",
          "old_text": "debug(\"\\n\")",
          "new_text": "debug_hex8(leds)",
          "old_line_content": "        debug(\"\\n\");",
          "new_line_content": "        debug_hex8(leds);",
          "content_same": false
        }
      ],
      "additions": [
        {
          "line": 386,
          "old_api": null,
          "new_api": "keyboard_set_leds",
          "old_text": null,
          "new_text": "keyboard_set_leds(led_status)",
          "old_line_content": "    }",
          "new_line_content": "        keyboard_set_leds(led_status);",
          "content_same": false
        },
        {
          "line": 354,
          "old_api": null,
          "new_api": "serial_mouse_task",
          "old_text": null,
          "new_text": "serial_mouse_task()",
          "old_line_content": "#endif",
          "new_line_content": "    serial_mouse_task();",
          "content_same": false
        },
        {
          "line": 324,
          "old_api": null,
          "new_api": "action_exec",
          "old_text": null,
          "new_text": "action_exec(TICK)",
          "old_line_content": "",
          "new_line_content": "        action_exec(TICK);",
          "content_same": false
        },
        {
          "line": 358,
          "old_api": null,
          "new_api": "adb_mouse_task",
          "old_text": null,
          "new_text": "adb_mouse_task()",
          "old_line_content": "#endif",
          "new_line_content": "    adb_mouse_task();",
          "content_same": false
        },
        {
          "line": 329,
          "old_api": null,
          "new_api": "matrix_scan_perf_task",
          "old_text": null,
          "new_text": "matrix_scan_perf_task()",
          "old_line_content": "#endif",
          "new_line_content": "    matrix_scan_perf_task();",
          "content_same": false
        },
        {
          "line": 362,
          "old_api": null,
          "new_api": "serial_link_update",
          "old_text": null,
          "new_text": "serial_link_update()",
          "old_line_content": "#endif",
          "new_line_content": "    serial_link_update();",
          "content_same": false
        },
        {
          "line": 333,
          "old_api": null,
          "new_api": "qwiic_task",
          "old_text": null,
          "new_text": "qwiic_task()",
          "old_line_content": "#endif",
          "new_line_content": "    qwiic_task();",
          "content_same": false
        },
        {
          "line": 398,
          "old_api": null,
          "new_api": "debug",
          "old_text": null,
          "new_text": "debug(\"\\n\")",
          "old_line_content": "    }",
          "new_line_content": "        debug(\"\\n\");",
          "content_same": false
        },
        {
          "line": 366,
          "old_api": null,
          "new_api": "host_keyboard_leds",
          "old_text": null,
          "new_text": "host_keyboard_leds()",
          "old_line_content": "#endif",
          "new_line_content": "    visualizer_update(default_layer_state, layer_state, visualizer_get_mods(), host_keyboard_leds());",
          "content_same": false
        },
        {
          "line": 400,
          "old_api": null,
          "new_api": "led_set",
          "old_text": null,
          "new_text": "led_set(leds)",
          "old_line_content": "}",
          "new_line_content": "    led_set(leds);",
          "content_same": false
        },
        {
          "line": 304,
          "old_api": null,
          "new_api": "timer_read",
          "old_text": null,
          "new_text": "timer_read()",
          "old_line_content": "                        });",
          "new_line_content": "                            .key = (keypos_t){.row = r, .col = c}, .pressed = (matrix_row & col_mask), .time = (timer_read() | 1) /* time should not be 0 */",
          "content_same": false
        },
        {
          "line": 337,
          "old_api": null,
          "new_api": "oled_task",
          "old_text": null,
          "new_text": "oled_task()",
          "old_line_content": "#    ifndef OLED_DISABLE_TIMEOUT",
          "new_line_content": "    oled_task();",
          "content_same": false
        },
        {
          "line": 370,
          "old_api": null,
          "new_api": "pointing_device_task",
          "old_text": null,
          "new_text": "pointing_device_task()",
          "old_line_content": "#endif",
          "new_line_content": "    pointing_device_task();",
          "content_same": false
        },
        {
          "line": 340,
          "old_api": null,
          "new_api": "oled_on",
          "old_text": null,
          "new_text": "oled_on()",
          "old_line_content": "#    endif",
          "new_line_content": "    if (ret) oled_on();",
          "content_same": false
        },
        {
          "line": 374,
          "old_api": null,
          "new_api": "midi_task",
          "old_text": null,
          "new_text": "midi_task()",
          "old_line_content": "#endif",
          "new_line_content": "    midi_task();",
          "content_same": false
        },
        {
          "line": 346,
          "old_api": null,
          "new_api": "mousekey_task",
          "old_text": null,
          "new_text": "mousekey_task()",
          "old_line_content": "#endif",
          "new_line_content": "    mousekey_task();",
          "content_same": false
        },
        {
          "line": 379,
          "old_api": null,
          "new_api": "velocikey_decelerate",
          "old_text": null,
          "new_text": "velocikey_decelerate()",
          "old_line_content": "    }",
          "new_line_content": "        velocikey_decelerate();",
          "content_same": false
        },
        {
          "line": 350,
          "old_api": null,
          "new_api": "ps2_mouse_task",
          "old_text": null,
          "new_text": "ps2_mouse_task()",
          "old_line_content": "#endif",
          "new_line_content": "    ps2_mouse_task();",
          "content_same": false
        }
      ],
      "deletions": [
        {
          "line": 353,
          "old_api": "serial_mouse_task",
          "new_api": null,
          "old_text": "serial_mouse_task()",
          "new_text": null,
          "old_line_content": "    serial_mouse_task();",
          "new_line_content": "#ifdef SERIAL_MOUSE_ENABLE",
          "content_same": false
        },
        {
          "line": 323,
          "old_api": "action_exec",
          "new_api": null,
          "old_text": "action_exec(TICK)",
          "new_text": null,
          "old_line_content": "        action_exec(TICK);",
          "new_line_content": "#endif",
          "content_same": false
        },
        {
          "line": 357,
          "old_api": "adb_mouse_task",
          "new_api": null,
          "old_text": "adb_mouse_task()",
          "new_text": null,
          "old_line_content": "    adb_mouse_task();",
          "new_line_content": "#ifdef ADB_MOUSE_ENABLE",
          "content_same": false
        },
        {
          "line": 328,
          "old_api": "matrix_scan_perf_task",
          "new_api": null,
          "old_text": "matrix_scan_perf_task()",
          "new_text": null,
          "old_line_content": "    matrix_scan_perf_task();",
          "new_line_content": "#ifdef DEBUG_MATRIX_SCAN_RATE",
          "content_same": false
        },
        {
          "line": 361,
          "old_api": "serial_link_update",
          "new_api": null,
          "old_text": "serial_link_update()",
          "new_text": null,
          "old_line_content": "    serial_link_update();",
          "new_line_content": "#ifdef SERIAL_LINK_ENABLE",
          "content_same": false
        },
        {
          "line": 377,
          "old_api": "velocikey_enabled",
          "new_api": null,
          "old_text": "velocikey_enabled()",
          "new_text": null,
          "old_line_content": "    if (velocikey_enabled()) {",
          "new_line_content": "#ifdef VELOCIKEY_ENABLE",
          "content_same": false
        },
        {
          "line": 395,
          "old_api": "debug",
          "new_api": null,
          "old_text": "debug(\"keyboard_set_led: \")",
          "new_text": null,
          "old_line_content": "        debug(\"keyboard_set_led: \");",
          "new_line_content": "    if (debug_keyboard) {",
          "content_same": false
        },
        {
          "line": 332,
          "old_api": "qwiic_task",
          "new_api": null,
          "old_text": "qwiic_task()",
          "new_text": null,
          "old_line_content": "    qwiic_task();",
          "new_line_content": "#ifdef QWIIC_ENABLE",
          "content_same": false
        },
        {
          "line": 365,
          "old_api": "host_keyboard_leds",
          "new_api": null,
          "old_text": "host_keyboard_leds()",
          "new_text": null,
          "old_line_content": "    visualizer_update(default_layer_state, layer_state, visualizer_get_mods(), host_keyboard_leds());",
          "new_line_content": "#ifdef VISUALIZER_ENABLE",
          "content_same": false
        },
        {
          "line": 302,
          "old_api": "action_exec",
          "new_api": null,
          "old_text": "action_exec((keyevent_t){\n                            .key = (keypos_t){.row = r, .col = c}, .pressed = (matrix_row & ((matrix_row_t)1 << c)), .time = (timer_read() | 1) /* time should not be 0 */\n                        })",
          "new_text": null,
          "old_line_content": "                        action_exec((keyevent_t){",
          "new_line_content": "                    if (matrix_change & col_mask) {",
          "content_same": false
        },
        {
          "line": 399,
          "old_api": "led_set",
          "new_api": null,
          "old_text": "led_set(leds)",
          "new_text": null,
          "old_line_content": "    led_set(leds);",
          "new_line_content": "    }",
          "content_same": false
        },
        {
          "line": 336,
          "old_api": "oled_task",
          "new_api": null,
          "old_text": "oled_task()",
          "new_text": null,
          "old_line_content": "    oled_task();",
          "new_line_content": "#ifdef OLED_DRIVER_ENABLE",
          "content_same": false
        },
        {
          "line": 369,
          "old_api": "pointing_device_task",
          "new_api": null,
          "old_text": "pointing_device_task()",
          "new_text": null,
          "old_line_content": "    pointing_device_task();",
          "new_line_content": "#ifdef POINTING_DEVICE_ENABLE",
          "content_same": false
        },
        {
          "line": 339,
          "old_api": "oled_on",
          "new_api": null,
          "old_text": "oled_on()",
          "new_text": null,
          "old_line_content": "    if (ret) oled_on();",
          "new_line_content": "    // Wake up oled if user is using those fabulous keys!",
          "content_same": false
        },
        {
          "line": 373,
          "old_api": "midi_task",
          "new_api": null,
          "old_text": "midi_task()",
          "new_text": null,
          "old_line_content": "    midi_task();",
          "new_line_content": "#ifdef MIDI_ENABLE",
          "content_same": false
        },
        {
          "line": 345,
          "old_api": "mousekey_task",
          "new_api": null,
          "old_text": "mousekey_task()",
          "new_text": null,
          "old_line_content": "    mousekey_task();",
          "new_line_content": "    // mousekey repeat & acceleration",
          "content_same": false
        },
        {
          "line": 349,
          "old_api": "ps2_mouse_task",
          "new_api": null,
          "old_text": "ps2_mouse_task()",
          "new_text": null,
          "old_line_content": "    ps2_mouse_task();",
          "new_line_content": "#ifdef PS2_MOUSE_ENABLE",
          "content_same": false
        },
        {
          "line": 383,
          "old_api": "host_keyboard_leds",
          "new_api": null,
          "old_text": "host_keyboard_leds()",
          "new_text": null,
          "old_line_content": "    if (led_status != host_keyboard_leds()) {",
          "new_line_content": "    // update LED",
          "content_same": false
        }
      ]
    },
    "api_summary": {
      "total_replacements": 5,
      "total_additions": 18,
      "total_deletions": 18,
      "total_api_changes": 41
    },
    "non_api_changes": {
      "has_non_api_changes": true,
      "evidence": {
        "total_diff_lines": 7,
        "api_related_lines": 41,
        "non_api_lines": 4,
        "non_api_line_numbers": [
          306,
          307,
          300,
          301
        ]
      }
    },
    "api_calls_before": 72,
    "api_calls_after": 72,
    "diff_info": {
      "added_lines": 5,
      "removed_lines": 4,
      "total_diff_lines": 24
    }
  }
}